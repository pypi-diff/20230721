# Comparing `tmp/BioTEMPy-2.1.0.tar.gz` & `tmp/BioTEMPy-2.1.0a0.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist/BioTEMPy-2.1.0.tar", last modified: Fri Jul 21 09:29:12 2023, max compression
+gzip compressed data, was "dist/BioTEMPy-2.1.0a0.tar", last modified: Thu Apr 27 08:07:31 2023, max compression
```

## Comparing `BioTEMPy-2.1.0.tar` & `BioTEMPy-2.1.0a0.tar`

### file list

```diff
@@ -1,74 +1,73 @@
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/
--rw-r--r--   0 root         (0) root         (0)      497 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/PKG-INFO
--rw-r--r--   0 root         (0) root         (0)     1483 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/SOURCES.txt
--rw-r--r--   0 root         (0) root         (0)        1 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/dependency_links.txt
--rw-r--r--   0 root         (0) root         (0)      209 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/entry_points.txt
--rw-r--r--   0 root         (0) root         (0)       96 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/requires.txt
--rw-r--r--   0 root         (0) root         (0)        6 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/BioTEMPy.egg-info/top_level.txt
--rw-r--r--   0 root         (0) root         (0)      497 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/PKG-INFO
--rw-rw-rw-   0 root         (0) root         (0)     3137 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/README.md
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/
--rw-rw-rw-   0 root         (0) root         (0)       52 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)       26 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/_version.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/assembly/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/assembly/__init__.py
--rwxrwxrwx   0 root         (0) root         (0)    13073 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/assembly/assembly.py
--rw-rw-rw-   0 root         (0) root         (0)    46912 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/assembly/gamma.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/cli/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/cli/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    14120 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/cli/arg_parser.py
--rw-rw-rw-   0 root         (0) root         (0)    11044 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/cli/class_arg.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/core/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/core/__init__.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/core/data/
--rw-rw-rw-   0 root         (0) root         (0)       82 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/core/data/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)     1778 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/core/data/download.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/core/errors/
--rw-rw-rw-   0 root         (0) root         (0)       86 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/core/errors/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)      149 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/core/errors/instance.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/graphics/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/graphics/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    20832 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/graphics/show_plot.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/map_process/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/map_process/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    23863 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/map_process/map_filters.py
--rw-rw-rw-   0 root         (0) root         (0)    31367 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/map_process/process.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/maps/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/maps/__init__.py
--rwxrwxrwx   0 root         (0) root         (0)    95185 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/maps/em_map.py
--rwxrwxrwx   0 root         (0) root         (0)    17392 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/maps/map_parser.py
--rw-rw-rw-   0 root         (0) root         (0)     4070 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/maps/map_transform_score.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/math/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/math/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    29185 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/cluster.py
--rw-rw-rw-   0 root         (0) root         (0)    25634 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/consensus.py
--rw-rw-rw-   0 root         (0) root         (0)    11869 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/fourier.py
--rw-rw-rw-   0 root         (0) root         (0)     5064 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/quaternion.py
--rw-rw-rw-   0 root         (0) root         (0)     3201 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/transform_parser.py
--rwxrwxrwx   0 root         (0) root         (0)    16972 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/vector.py
--rwxrwxrwx   0 root         (0) root         (0)     4746 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/math/vq.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/optimisation/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/optimisation/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    10371 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/optimisation/ensemble_generation.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/protein/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/protein/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    14647 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/mmcif.py
--rw-rw-rw-   0 root         (0) root         (0)    70893 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/prot_rep_biopy.py
--rw-rw-rw-   0 root         (0) root         (0)    11687 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/rigid_body_parser.py
--rw-rw-rw-   0 root         (0) root         (0)   142456 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/scoring_functions.py
--rwxrwxrwx   0 root         (0) root         (0)    54324 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/structure_blurrer.py
--rw-rw-rw-   0 root         (0) root         (0)    19448 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/protein/structure_parser.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/script/
--rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 09:29:03.000000 BioTEMPy-2.1.0/TEMPy/script/__init__.py
--rw-rw-rw-   0 root         (0) root         (0)    10663 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/gamma.py
--rw-rw-rw-   0 root         (0) root         (0)     5045 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/loqfit.py
--rw-rw-rw-   0 root         (0) root         (0)     2538 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/mi.py
--rw-rw-rw-   0 root         (0) root         (0)    11963 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/output.py
--rw-rw-rw-   0 root         (0) root         (0)     2710 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/sccc.py
--rw-rw-rw-   0 root         (0) root         (0)     5725 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/scores.py
--rw-rw-rw-   0 root         (0) root         (0)     4028 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/script/smoc.py
-drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/TEMPy/tempy_data/
--rw-rw-rw-   0 root         (0) root         (0)   523370 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/TEMPy/tempy_data/quaternion_vectors_5000.pk
--rw-r--r--   0 root         (0) root         (0)       38 2023-07-21 09:29:12.000000 BioTEMPy-2.1.0/setup.cfg
--rw-rw-rw-   0 root         (0) root         (0)     1384 2023-07-21 09:29:02.000000 BioTEMPy-2.1.0/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/
+-rw-r--r--   0 root         (0) root         (0)      499 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)     1460 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)      169 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/entry_points.txt
+-rw-r--r--   0 root         (0) root         (0)       96 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)        6 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/BioTEMPy.egg-info/top_level.txt
+-rw-r--r--   0 root         (0) root         (0)      499 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/PKG-INFO
+-rw-rw-rw-   0 root         (0) root         (0)     3137 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/README.md
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/
+-rw-rw-rw-   0 root         (0) root         (0)       52 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)       26 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/_version.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/assembly/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/assembly/__init__.py
+-rwxrwxrwx   0 root         (0) root         (0)    13073 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/assembly/assembly.py
+-rw-rw-rw-   0 root         (0) root         (0)    46912 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/assembly/gamma.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/cli/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/cli/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    14120 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/cli/arg_parser.py
+-rw-rw-rw-   0 root         (0) root         (0)    11044 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/cli/class_arg.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/core/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/core/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/core/data/
+-rw-rw-rw-   0 root         (0) root         (0)       82 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/core/data/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1778 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/core/data/download.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/core/errors/
+-rw-rw-rw-   0 root         (0) root         (0)       86 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/core/errors/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)      149 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/core/errors/instance.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/graphics/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/graphics/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    20832 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/graphics/show_plot.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/map_process/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/map_process/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    23863 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/map_process/map_filters.py
+-rw-rw-rw-   0 root         (0) root         (0)    31367 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/map_process/process.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/maps/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/maps/__init__.py
+-rwxrwxrwx   0 root         (0) root         (0)    95185 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/maps/em_map.py
+-rwxrwxrwx   0 root         (0) root         (0)    17392 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/maps/map_parser.py
+-rw-rw-rw-   0 root         (0) root         (0)     4070 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/maps/map_transform_score.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/math/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    29185 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/cluster.py
+-rw-rw-rw-   0 root         (0) root         (0)    25634 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/consensus.py
+-rw-rw-rw-   0 root         (0) root         (0)    11869 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/fourier.py
+-rw-rw-rw-   0 root         (0) root         (0)     5064 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/quaternion.py
+-rw-rw-rw-   0 root         (0) root         (0)     3201 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/transform_parser.py
+-rwxrwxrwx   0 root         (0) root         (0)    16972 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/vector.py
+-rwxrwxrwx   0 root         (0) root         (0)     4746 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/math/vq.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/optimisation/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/optimisation/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    10371 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/optimisation/ensemble_generation.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/protein/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    14647 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/mmcif.py
+-rw-rw-rw-   0 root         (0) root         (0)    70893 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/prot_rep_biopy.py
+-rw-rw-rw-   0 root         (0) root         (0)    11687 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/rigid_body_parser.py
+-rw-rw-rw-   0 root         (0) root         (0)   142093 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/scoring_functions.py
+-rwxrwxrwx   0 root         (0) root         (0)    54324 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/structure_blurrer.py
+-rw-rw-rw-   0 root         (0) root         (0)    19448 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/protein/structure_parser.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/script/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    10663 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/gamma.py
+-rw-rw-rw-   0 root         (0) root         (0)     5045 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/loqfit.py
+-rw-rw-rw-   0 root         (0) root         (0)     2538 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/mi.py
+-rw-rw-rw-   0 root         (0) root         (0)    11963 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/output.py
+-rw-rw-rw-   0 root         (0) root         (0)     2710 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/sccc.py
+-rw-rw-rw-   0 root         (0) root         (0)     4028 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/script/smoc.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/TEMPy/tempy_data/
+-rw-rw-rw-   0 root         (0) root         (0)   523370 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/TEMPy/tempy_data/quaternion_vectors_5000.pk
+-rw-r--r--   0 root         (0) root         (0)       38 2023-04-27 08:07:31.000000 BioTEMPy-2.1.0a0/setup.cfg
+-rw-rw-rw-   0 root         (0) root         (0)     1321 2023-04-27 08:07:19.000000 BioTEMPy-2.1.0a0/setup.py
```

### Comparing `BioTEMPy-2.1.0/BioTEMPy.egg-info/SOURCES.txt` & `BioTEMPy-2.1.0a0/BioTEMPy.egg-info/SOURCES.txt`

 * *Files 2% similar despite different names*

```diff
@@ -47,10 +47,9 @@
 TEMPy/protein/structure_parser.py
 TEMPy/script/__init__.py
 TEMPy/script/gamma.py
 TEMPy/script/loqfit.py
 TEMPy/script/mi.py
 TEMPy/script/output.py
 TEMPy/script/sccc.py
-TEMPy/script/scores.py
 TEMPy/script/smoc.py
 TEMPy/tempy_data/quaternion_vectors_5000.pk
```

### Comparing `BioTEMPy-2.1.0/README.md` & `BioTEMPy-2.1.0a0/README.md`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/assembly/assembly.py` & `BioTEMPy-2.1.0a0/TEMPy/assembly/assembly.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/assembly/gamma.py` & `BioTEMPy-2.1.0a0/TEMPy/assembly/gamma.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/cli/arg_parser.py` & `BioTEMPy-2.1.0a0/TEMPy/cli/arg_parser.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/cli/class_arg.py` & `BioTEMPy-2.1.0a0/TEMPy/cli/class_arg.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/core/data/download.py` & `BioTEMPy-2.1.0a0/TEMPy/core/data/download.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/graphics/show_plot.py` & `BioTEMPy-2.1.0a0/TEMPy/graphics/show_plot.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/map_process/map_filters.py` & `BioTEMPy-2.1.0a0/TEMPy/map_process/map_filters.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/map_process/process.py` & `BioTEMPy-2.1.0a0/TEMPy/map_process/process.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/maps/em_map.py` & `BioTEMPy-2.1.0a0/TEMPy/maps/em_map.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/maps/map_parser.py` & `BioTEMPy-2.1.0a0/TEMPy/maps/map_parser.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/maps/map_transform_score.py` & `BioTEMPy-2.1.0a0/TEMPy/maps/map_transform_score.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/cluster.py` & `BioTEMPy-2.1.0a0/TEMPy/math/cluster.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/consensus.py` & `BioTEMPy-2.1.0a0/TEMPy/math/consensus.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/fourier.py` & `BioTEMPy-2.1.0a0/TEMPy/math/fourier.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/quaternion.py` & `BioTEMPy-2.1.0a0/TEMPy/math/quaternion.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/transform_parser.py` & `BioTEMPy-2.1.0a0/TEMPy/math/transform_parser.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/vector.py` & `BioTEMPy-2.1.0a0/TEMPy/math/vector.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/math/vq.py` & `BioTEMPy-2.1.0a0/TEMPy/math/vq.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/optimisation/ensemble_generation.py` & `BioTEMPy-2.1.0a0/TEMPy/optimisation/ensemble_generation.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/mmcif.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/mmcif.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/prot_rep_biopy.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/prot_rep_biopy.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/rigid_body_parser.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/rigid_body_parser.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/scoring_functions.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/scoring_functions.py`

 * *Files 1% similar despite different names*

```diff
@@ -383,8522 +383,8499 @@
 000017e0: 206d 6170 5f74 6172 6765 745f 7468 7265   map_target_thre
 000017f0: 7368 6f6c 642c 0a20 2020 2020 2020 2020  shold,.         
 00001800: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001810: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
 00001820: 5f74 6872 6573 686f 6c64 0a20 2020 2020  _threshold.     
 00001830: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00001840: 2020 2020 2020 2020 2020 2029 3a0a 2020             ):.  
-00001850: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00001860: 2020 2020 2020 6d61 736b 206d 6170 7320        mask maps 
-00001870: 7769 7468 2032 2063 7574 2d6f 6666 206d  with 2 cut-off m
-00001880: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
-00001890: 6f6c 6420 616e 640a 2020 2020 2020 2020  old and.        
-000018a0: 2020 2020 6d61 705f 7072 6f62 655f 7468      map_probe_th
-000018b0: 7265 7368 6f6c 6420 2876 6f6c 2074 6872  reshold (vol thr
-000018c0: 2e29 0a0a 2020 2020 2020 2020 2020 2020  .)..            
-000018d0: 7265 7475 726e 3a0a 2020 2020 2020 2020  return:.        
-000018e0: 2020 2020 6672 6163 7469 6f6e 206f 6620      fraction of 
-000018f0: 6f76 6572 6c61 7020 7769 7468 2072 6573  overlap with res
-00001900: 7065 6374 2074 6f20 7461 7267 6574 2c20  pect to target, 
-00001910: 7769 7468 2072 6573 7065 6374 2074 6f0a  with respect to.
-00001920: 2020 2020 2020 2020 2020 2020 7072 6f62              prob
-00001930: 6520 616e 6420 7769 7468 2072 6573 7065  e and with respe
-00001940: 6374 2074 6f20 7468 6520 746f 7461 6c20  ct to the total 
-00001950: 2875 6e69 6f6e 290a 2020 2020 2020 2020  (union).        
-00001960: 2222 220a 2020 2020 2020 2020 6966 206e  """.        if n
-00001970: 6f74 2073 656c 662e 6d61 7043 6f6d 7061  ot self.mapCompa
-00001980: 7269 736f 6e28 6d61 705f 7461 7267 6574  rison(map_target
-00001990: 2c20 6d61 705f 7072 6f62 6529 3a0a 2020  , map_probe):.  
-000019a0: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-000019b0: 5661 6c75 6545 7272 6f72 280a 2020 2020  ValueError(.    
-000019c0: 2020 2020 2020 2020 2020 2020 6622 436f              f"Co
-000019d0: 756c 6420 6e6f 7420 6361 6c63 756c 6174  uld not calculat
-000019e0: 6520 7363 6f72 6573 2066 6f72 2069 6e70  e scores for inp
-000019f0: 7574 206d 6170 7320 7769 7468 2070 6978  ut maps with pix
-00001a00: 656c 2073 697a 6573 207b 6d61 705f 7461  el sizes {map_ta
-00001a10: 7267 6574 2e61 7069 787d 2c20 7b6d 6170  rget.apix}, {map
-00001a20: 5f70 726f 6265 2e61 7069 787d 2c22 0a20  _probe.apix},". 
-00001a30: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00001a40: 2220 7368 6170 6573 207b 6d61 705f 7461  " shapes {map_ta
-00001a50: 7267 6574 2e62 6f78 5f73 697a 6528 297d  rget.box_size()}
-00001a60: 2c20 7b6d 6170 5f70 726f 6265 2e62 6f78  , {map_probe.box
-00001a70: 5f73 697a 6528 297d 2061 6e64 2022 0a20  _size()} and ". 
-00001a80: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00001a90: 226f 7269 6769 6e73 207b 6d61 705f 7461  "origins {map_ta
-00001aa0: 7267 6574 2e6f 7269 6769 6e7d 2c20 7b6d  rget.origin}, {m
-00001ab0: 6170 5f70 726f 6265 2e6f 7269 6769 6e7d  ap_probe.origin}
-00001ac0: 2e22 0a20 2020 2020 2020 2020 2020 2029  .".            )
-00001ad0: 0a20 2020 2020 2020 2062 696e 6d61 7031  .        binmap1
-00001ae0: 203d 206d 6170 5f74 6172 6765 742e 6675   = map_target.fu
-00001af0: 6c6c 4d61 7020 3e20 666c 6f61 7428 6d61  llMap > float(ma
-00001b00: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
-00001b10: 6c64 290a 2020 2020 2020 2020 6269 6e6d  ld).        binm
-00001b20: 6170 3220 3d20 6d61 705f 7072 6f62 652e  ap2 = map_probe.
-00001b30: 6675 6c6c 4d61 7020 3e20 666c 6f61 7428  fullMap > float(
-00001b40: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
-00001b50: 6f6c 6429 0a20 2020 2020 2020 206d 6173  old).        mas
-00001b60: 6b5f 6172 7261 7920 3d20 2862 696e 6d61  k_array = (binma
-00001b70: 7031 202a 2062 696e 6d61 7032 2920 3e20  p1 * binmap2) > 
-00001b80: 300a 0a20 2020 2020 2020 2073 697a 6531  0..        size1
-00001b90: 203d 206e 702e 7375 6d28 6269 6e6d 6170   = np.sum(binmap
-00001ba0: 3129 0a20 2020 2020 2020 2073 697a 6532  1).        size2
-00001bb0: 203d 206e 702e 7375 6d28 6269 6e6d 6170   = np.sum(binmap
-00001bc0: 3229 0a20 2020 2020 2020 2072 6574 7572  2).        retur
-00001bd0: 6e20 280a 2020 2020 2020 2020 2020 2020  n (.            
-00001be0: 666c 6f61 7428 6e70 2e73 756d 286d 6173  float(np.sum(mas
-00001bf0: 6b5f 6172 7261 7929 2920 2f20 7369 7a65  k_array)) / size
-00001c00: 312c 0a20 2020 2020 2020 2020 2020 2066  1,.            f
-00001c10: 6c6f 6174 286e 702e 7375 6d28 6d61 736b  loat(np.sum(mask
-00001c20: 5f61 7272 6179 2929 202f 2073 697a 6532  _array)) / size2
-00001c30: 2c0a 2020 2020 2020 2020 2020 2020 666c  ,.            fl
-00001c40: 6f61 7428 6e70 2e73 756d 286d 6173 6b5f  oat(np.sum(mask_
-00001c50: 6172 7261 7929 2920 2f20 2873 697a 6531  array)) / (size1
-00001c60: 202b 2073 697a 6532 292c 0a20 2020 2020   + size2),.     
-00001c70: 2020 2029 0a0a 2020 2020 6465 6620 5f6f     )..    def _o
-00001c80: 7665 726c 6170 5f6d 6170 5f61 7272 6179  verlap_map_array
-00001c90: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
-00001ca0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
-00001cb0: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
-00001cc0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-00001cd0: 6574 5f74 6872 6573 686f 6c64 2c0a 2020  et_threshold,.  
-00001ce0: 2020 2020 2020 2020 2020 6d61 705f 7072            map_pr
-00001cf0: 6f62 652c 0a20 2020 2020 2020 2020 2020  obe,.           
-00001d00: 206d 6170 5f70 726f 6265 5f74 6872 6573   map_probe_thres
-00001d10: 686f 6c64 2c0a 2020 2020 293a 0a20 2020  hold,.    ):.   
-00001d20: 2020 2020 2022 2222 4865 6c70 6572 2066       """Helper f
-00001d30: 756e 6374 696f 6e20 666f 7220 6d75 7475  unction for mutu
-00001d40: 616c 2069 6e66 6f72 6d61 7469 6f6e 2063  al information c
-00001d50: 616c 6375 6c61 7469 6f6e 2e0a 0a20 2020  alculation...   
-00001d60: 2020 2020 204d 6173 6b73 206d 6170 7320       Masks maps 
-00001d70: 7573 696e 6720 756e 6971 7565 2063 7574  using unique cut
-00001d80: 6f66 6620 666f 7220 6561 6368 2028 6d61  off for each (ma
-00001d90: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
-00001da0: 6c64 2061 6e64 0a20 2020 2020 2020 206d  ld and.        m
-00001db0: 6170 5f70 726f 6265 5f74 6872 6573 686f  ap_probe_thresho
-00001dc0: 6c64 2920 616e 6420 7265 7475 726e 7320  ld) and returns 
-00001dd0: 6120 6669 6e61 6c20 6d61 736b 2077 6869  a final mask whi
-00001de0: 6368 2069 7320 5472 7565 2077 6865 7265  ch is True where
-00001df0: 0a20 2020 2020 2020 2062 6f74 6820 6d61  .        both ma
-00001e00: 7073 2061 7265 2061 626f 7665 2074 6865  ps are above the
-00001e10: 6972 2072 6573 7065 6374 6976 6520 7468  ir respective th
-00001e20: 7265 7368 6f6c 6473 2e0a 0a20 2020 2020  resholds...     
-00001e30: 2020 2041 7267 733a 0a20 2020 2020 2020     Args:.       
-00001e40: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
-00001e50: 206d 6170 5f70 726f 6265 3a20 496e 7075   map_probe: Inpu
-00001e60: 7420 4d61 7020 696e 7374 616e 6365 0a20  t Map instance. 
-00001e70: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-00001e80: 6172 6765 745f 7468 7265 7368 6f6c 642c  arget_threshold,
-00001e90: 206d 6170 5f70 726f 6265 5f74 6872 6573   map_probe_thres
-00001ea0: 686f 6c64 3a20 5468 7265 7368 6f6c 6420  hold: Threshold 
-00001eb0: 7573 6564 2074 6f20 6d61 736b 0a20 2020  used to mask.   
-00001ec0: 2020 2020 2020 2020 2072 6573 7065 6374           respect
-00001ed0: 6976 6520 6d61 7020 696e 7374 616e 6365  ive map instance
-00001ee0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00001ef0: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
-00001f00: 6173 6b5f 6172 7261 793a 204d 6173 6b20  ask_array: Mask 
-00001f10: 7768 6963 6820 6973 2074 7275 6520 7768  which is true wh
-00001f20: 6572 6520 626f 7468 206d 6170 7320 6172  ere both maps ar
-00001f30: 6520 6162 6f76 6520 7468 6569 720a 2020  e above their.  
-00001f40: 2020 2020 2020 2020 2020 7265 7370 6563            respec
-00001f50: 7469 7665 2074 6872 6573 686f 6c64 732e  tive thresholds.
-00001f60: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-00001f70: 2020 2020 2062 696e 6d61 7031 203d 206d       binmap1 = m
-00001f80: 6170 5f74 6172 6765 742e 6675 6c6c 4d61  ap_target.fullMa
-00001f90: 7020 3e20 666c 6f61 7428 6d61 705f 7461  p > float(map_ta
-00001fa0: 7267 6574 5f74 6872 6573 686f 6c64 290a  rget_threshold).
-00001fb0: 2020 2020 2020 2020 6269 6e6d 6170 3220          binmap2 
-00001fc0: 3d20 6d61 705f 7072 6f62 652e 6675 6c6c  = map_probe.full
-00001fd0: 4d61 7020 3e20 666c 6f61 7428 6d61 705f  Map > float(map_
-00001fe0: 7072 6f62 655f 7468 7265 7368 6f6c 6429  probe_threshold)
-00001ff0: 0a20 2020 2020 2020 206d 6173 6b5f 6172  .        mask_ar
-00002000: 7261 7920 3d20 2862 696e 6d61 7031 202a  ray = (binmap1 *
-00002010: 2062 696e 6d61 7032 2920 3e20 300a 2020   binmap2) > 0.  
-00002020: 2020 2020 2020 7265 7475 726e 206d 6173        return mas
-00002030: 6b5f 6172 7261 790a 0a20 2020 2064 6566  k_array..    def
-00002040: 2063 616c 6375 6c61 7465 5f6d 6170 5f74   calculate_map_t
-00002050: 6872 6573 686f 6c64 2873 656c 662c 206d  hreshold(self, m
-00002060: 6170 5f74 6172 6765 7429 3a0a 2020 2020  ap_target):.    
-00002070: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
-00002080: 7320 6d61 7020 7468 7265 7368 6f6c 6420  s map threshold 
-00002090: 6173 206d 6561 6e20 7661 6c75 6520 2b20  as mean value + 
-000020a0: 2832 202a 206d 6170 2073 7461 6e64 6172  (2 * map standar
-000020b0: 6420 6465 7669 6174 696f 6e29 0a0a 2020  d deviation)..  
-000020c0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-000020d0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-000020e0: 6574 3a20 4d61 7020 696e 7374 616e 6365  et: Map instance
-000020f0: 0a0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-00002100: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00002110: 6c6f 6174 3a20 5468 7265 7368 6f6c 6420  loat: Threshold 
-00002120: 7661 6c75 650a 2020 2020 2020 2020 2222  value.        ""
-00002130: 220a 2020 2020 2020 2020 2320 4e4f 5445  ".        # NOTE
-00002140: 3a20 4d4f 5645 2054 4f20 5445 4d50 792e  : MOVE TO TEMPy.
-00002150: 6d61 7073 2e65 6d5f 6d61 702e 4d61 703f  maps.em_map.Map?
-00002160: 3f0a 2020 2020 2020 2020 7472 793a 0a20  ?.        try:. 
-00002170: 2020 2020 2020 2020 2020 2070 6561 6b2c             peak,
-00002180: 2061 7665 2c20 7369 676d 6120 3d20 6d61   ave, sigma = ma
-00002190: 705f 7461 7267 6574 2e5f 7065 616b 5f64  p_target._peak_d
-000021a0: 656e 7369 7479 2829 0a20 2020 2020 2020  ensity().       
-000021b0: 2020 2020 2076 6f6c 5f74 6872 6573 686f       vol_thresho
-000021c0: 6c64 203d 2066 6c6f 6174 2861 7665 2920  ld = float(ave) 
-000021d0: 2b20 2832 2e30 202a 2066 6c6f 6174 2873  + (2.0 * float(s
-000021e0: 6967 6d61 2929 0a20 2020 2020 2020 2065  igma)).        e
-000021f0: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00002200: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00002210: 6c65 6e28 6d61 705f 7461 7267 6574 2e68  len(map_target.h
-00002220: 6561 6465 7229 203d 3d20 303a 0a20 2020  eader) == 0:.   
-00002230: 2020 2020 2020 2020 2020 2020 2061 6d65               ame
-00002240: 616e 203d 206d 6170 5f74 6172 6765 742e  an = map_target.
-00002250: 6d65 616e 2829 0a20 2020 2020 2020 2020  mean().         
-00002260: 2020 2020 2020 2072 6d73 203d 206d 6170         rms = map
-00002270: 5f74 6172 6765 742e 7374 6428 290a 2020  _target.std().  
-00002280: 2020 2020 2020 2020 2020 2020 2020 766f                vo
-00002290: 6c5f 7468 7265 7368 6f6c 6420 3d20 666c  l_threshold = fl
-000022a0: 6f61 7428 616d 6561 6e29 202b 2028 312e  oat(amean) + (1.
-000022b0: 3520 2a20 666c 6f61 7428 726d 7329 290a  5 * float(rms)).
-000022c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000022d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000022e0: 2020 616d 6561 6e20 3d20 6d61 705f 7461    amean = map_ta
-000022f0: 7267 6574 2e6d 6561 6e28 290a 2020 2020  rget.mean().    
-00002300: 2020 2020 2020 2020 2020 2020 726d 7320              rms 
-00002310: 3d20 6d61 705f 7461 7267 6574 2e73 7464  = map_target.std
-00002320: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
-00002330: 2020 2076 6f6c 5f74 6872 6573 686f 6c64     vol_threshold
-00002340: 203d 2066 6c6f 6174 2861 6d65 616e 2920   = float(amean) 
-00002350: 2b20 2831 2e35 202a 2066 6c6f 6174 2872  + (1.5 * float(r
-00002360: 6d73 2929 0a20 2020 2020 2020 2072 6574  ms)).        ret
-00002370: 7572 6e20 766f 6c5f 7468 7265 7368 6f6c  urn vol_threshol
-00002380: 640a 0a20 2020 2064 6566 206d 6170 436f  d..    def mapCo
-00002390: 6d70 6172 6973 6f6e 2873 656c 662c 206d  mparison(self, m
-000023a0: 6170 5f74 6172 6765 742c 206d 6170 5f70  ap_target, map_p
-000023b0: 726f 6265 293a 0a20 2020 2020 2020 2022  robe):.        "
-000023c0: 2222 0a20 2020 2020 2020 2043 6865 636b  "".        Check
-000023d0: 7320 6966 2070 726f 7065 7274 6965 7320  s if properties 
-000023e0: 2873 616d 706c 696e 6720 7261 7465 2c20  (sampling rate, 
-000023f0: 626f 7820 7369 7a65 2061 6e64 206f 7269  box size and ori
-00002400: 6769 6e29 206f 6620 7477 6f20 6d61 7073  gin) of two maps
-00002410: 0a20 2020 2020 2020 2061 7265 2065 7175  .        are equ
-00002420: 616c 2e0a 0a20 2020 2020 2020 2041 7267  al...        Arg
-00002430: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
-00002440: 6170 5f74 6172 6765 742c 206d 6170 5f70  ap_target, map_p
-00002450: 726f 6265 0a20 2020 2020 2020 2020 2020  robe.           
-00002460: 2020 2020 204d 6170 2069 6e73 7461 6e63       Map instanc
-00002470: 6520 746f 2063 6f6d 7061 7265 2e0a 0a20  e to compare... 
-00002480: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00002490: 2020 2020 2020 2020 2020 2020 5472 7565              True
-000024a0: 2069 6620 7468 6520 6d61 7020 7072 6f70   if the map prop
-000024b0: 6572 7469 6573 2061 7265 2074 6865 2073  erties are the s
-000024c0: 616d 6520 6265 7477 6565 6e20 7477 6f20  ame between two 
-000024d0: 6d61 7073 2c20 4661 6c73 650a 2020 2020  maps, False.    
-000024e0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
-000024f0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-00002500: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00002510: 2020 2020 2020 2020 2020 2020 6e70 2e69              np.i
-00002520: 7363 6c6f 7365 286d 6170 5f74 6172 6765  sclose(map_targe
-00002530: 742e 6170 6978 2c0a 2020 2020 2020 2020  t.apix,.        
-00002540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002550: 2020 206d 6170 5f70 726f 6265 2e61 7069     map_probe.api
-00002560: 782c 0a20 2020 2020 2020 2020 2020 2020  x,.             
-00002570: 2020 2020 2020 2020 2020 2020 2020 6174                at
-00002580: 6f6c 3d31 452d 3629 2e61 6c6c 2829 2061  ol=1E-6).all() a
-00002590: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
-000025a0: 2020 206d 6170 5f74 6172 6765 742e 626f     map_target.bo
-000025b0: 785f 7369 7a65 2829 203d 3d20 6d61 705f  x_size() == map_
-000025c0: 7072 6f62 652e 626f 785f 7369 7a65 2829  probe.box_size()
-000025d0: 0a20 2020 2020 2020 2029 3a0a 2020 2020  .        ):.    
-000025e0: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
-000025f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002600: 2072 6f75 6e64 286d 6170 5f74 6172 6765   round(map_targe
-00002610: 742e 6f72 6967 696e 5b30 5d2c 2032 2920  t.origin[0], 2) 
-00002620: 3d3d 2072 6f75 6e64 286d 6170 5f70 726f  == round(map_pro
-00002630: 6265 2e6f 7269 6769 6e5b 305d 2c20 3229  be.origin[0], 2)
-00002640: 2061 6e64 2020 2320 6e6f 7161 3a45 3530   and  # noqa:E50
-00002650: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
-00002660: 2020 2020 2020 726f 756e 6428 6d61 705f        round(map_
-00002670: 7461 7267 6574 2e6f 7269 6769 6e5b 315d  target.origin[1]
-00002680: 2c20 3229 203d 3d20 726f 756e 6428 6d61  , 2) == round(ma
-00002690: 705f 7072 6f62 652e 6f72 6967 696e 5b31  p_probe.origin[1
-000026a0: 5d2c 2032 2920 616e 6420 2023 206e 6f71  ], 2) and  # noq
-000026b0: 613a 4535 3031 0a20 2020 2020 2020 2020  a:E501.         
-000026c0: 2020 2020 2020 2020 2020 2072 6f75 6e64             round
-000026d0: 286d 6170 5f74 6172 6765 742e 6f72 6967  (map_target.orig
-000026e0: 696e 5b32 5d2c 2032 2920 3d3d 2072 6f75  in[2], 2) == rou
-000026f0: 6e64 286d 6170 5f70 726f 6265 2e6f 7269  nd(map_probe.ori
-00002700: 6769 6e5b 325d 2c20 3229 2020 2320 6e6f  gin[2], 2)  # no
-00002710: 7161 3a45 3530 310a 2020 2020 2020 2020  qa:E501.        
-00002720: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-00002730: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-00002740: 7565 0a20 2020 2020 2020 2020 2020 2065  ue.            e
-00002750: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00002760: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
-00002770: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-00002780: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002790: 726e 2046 616c 7365 0a0a 2020 2020 6465  rn False..    de
-000027a0: 6620 5f66 6169 6c65 645f 6d61 7463 6828  f _failed_match(
-000027b0: 7365 6c66 293a 0a20 2020 2020 2020 2023  self):.        #
-000027c0: 2073 686f 756c 6420 696d 706c 656d 656e   should implemen
-000027d0: 7420 5445 4d50 7920 6572 726f 7273 2066  t TEMPy errors f
-000027e0: 6f72 206d 6f72 6520 656c 6567 616e 7420  or more elegant 
-000027f0: 6572 726f 7220 6861 6e64 6c69 6e67 0a20  error handling. 
-00002800: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
-00002810: 2020 2020 2020 2020 2020 2757 6172 6e69            'Warni
-00002820: 6e67 3a20 6361 6e5c 2774 206d 6174 6368  ng: can\'t match
-00002830: 2074 6865 206d 6170 2061 7420 7468 6520   the map at the 
-00002840: 6d6f 6d65 6e74 2c27 0a20 2020 2020 2020  moment,'.       
-00002850: 2020 2020 2027 7573 6520 6d61 7020 7769       'use map wi
-00002860: 7468 2073 616d 6520 626f 7820 7369 7a65  th same box size
-00002870: 2e27 0a20 2020 2020 2020 2029 0a20 2020  .'.        ).   
-00002880: 2020 2020 2073 7973 2e65 7869 7428 290a       sys.exit().
-00002890: 0a20 2020 2064 6566 2073 6361 6c65 5f6d  .    def scale_m
-000028a0: 6564 6961 6e28 7365 6c66 2c20 6172 7231  edian(self, arr1
-000028b0: 2c20 6172 7232 293a 0a20 2020 2020 2020  , arr2):.       
-000028c0: 2022 2222 5363 616c 6520 6f6e 6520 6c69   """Scale one li
-000028d0: 7374 2f61 7272 6179 206f 6620 7363 6f72  st/array of scor
-000028e0: 6573 2077 6974 6820 7265 7370 6563 7420  es with respect 
-000028f0: 746f 2061 6e6f 7468 6572 2062 6173 6564  to another based
-00002900: 206f 6e0a 2020 2020 2020 2020 6469 7374   on.        dist
-00002910: 7269 6275 7469 6f6e 2061 726f 756e 6420  ribution around 
-00002920: 6d65 6469 616e 2e0a 0a20 2020 2020 2020  median...       
-00002930: 2041 7267 756d 656e 7473 3a0a 2020 2020   Arguments:.    
-00002940: 2020 2020 2020 2020 6172 7231 2c20 6172          arr1, ar
-00002950: 7232 3a20 4172 7261 792f 6c69 7374 206f  r2: Array/list o
-00002960: 6620 7363 6f72 6573 0a0a 2020 2020 2020  f scores..      
-00002970: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
-00002980: 2020 2020 2020 2053 6361 6c65 6420 6172         Scaled ar
-00002990: 7231 2c20 6261 7365 6420 6f6e 2074 6865  r1, based on the
-000029a0: 2076 616c 7565 7320 696e 2061 7272 320a   values in arr2.
-000029b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000029c0: 2020 2020 6e70 6172 7231 203d 206e 702e      nparr1 = np.
-000029d0: 6172 7261 7928 6172 7231 290a 2020 2020  array(arr1).    
-000029e0: 2020 2020 6e70 6172 7232 203d 206e 702e      nparr2 = np.
-000029f0: 6172 7261 7928 6172 7232 290a 2020 2020  array(arr2).    
-00002a00: 2020 2020 6d65 645f 6465 765f 3120 3d20      med_dev_1 = 
-00002a10: 6e70 2e6d 6564 6961 6e28 6e70 2e61 6273  np.median(np.abs
-00002a20: 6f6c 7574 6528 6e70 6172 7231 202d 206e  olute(nparr1 - n
-00002a30: 702e 6d65 6469 616e 286e 7061 7272 3129  p.median(nparr1)
-00002a40: 2929 0a20 2020 2020 2020 206d 6564 5f64  )).        med_d
-00002a50: 6576 5f32 203d 206e 702e 6d65 6469 616e  ev_2 = np.median
-00002a60: 286e 702e 6162 736f 6c75 7465 286e 7061  (np.absolute(npa
-00002a70: 7272 3220 2d20 6e70 2e6d 6564 6961 6e28  rr2 - np.median(
-00002a80: 6e70 6172 7232 2929 290a 2020 2020 2020  nparr2))).      
-00002a90: 2020 6966 206d 6564 5f64 6576 5f31 203d    if med_dev_1 =
-00002aa0: 3d20 302e 303a 0a20 2020 2020 2020 2020  = 0.0:.         
-00002ab0: 2020 2073 6361 6c65 5f66 6163 746f 7220     scale_factor 
-00002ac0: 3d20 302e 300a 2020 2020 2020 2020 656c  = 0.0.        el
-00002ad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00002ae0: 7363 616c 655f 6661 6374 6f72 203d 206d  scale_factor = m
-00002af0: 6564 5f64 6576 5f32 202f 206d 6564 5f64  ed_dev_2 / med_d
-00002b00: 6576 5f31 0a20 2020 2020 2020 2073 6869  ev_1.        shi
-00002b10: 6674 5f66 6163 746f 7220 3d20 6e70 2e6d  ft_factor = np.m
-00002b20: 6564 6961 6e28 6e70 6172 7232 2920 2d20  edian(nparr2) - 
-00002b30: 2873 6361 6c65 5f66 6163 746f 7220 2a20  (scale_factor * 
-00002b40: 6e70 2e6d 6564 6961 6e28 6e70 6172 7231  np.median(nparr1
-00002b50: 2929 0a0a 2020 2020 2020 2020 2320 544f  ))..        # TO
-00002b60: 444f 3a20 6669 6e64 2061 2062 6574 7465  DO: find a bette
-00002b70: 7220 7761 7920 746f 2061 766f 6964 206f  r way to avoid o
-00002b80: 7574 6c69 6572 7320 696e 2067 656e 6572  utliers in gener
-00002b90: 616c 0a20 2020 2020 2020 2069 6620 286d  al.        if (m
-00002ba0: 6178 286e 7061 7272 3129 202d 206d 696e  ax(nparr1) - min
-00002bb0: 286e 7061 7272 3129 2920 3e20 302e 313a  (nparr1)) > 0.1:
-00002bc0: 0a20 2020 2020 2020 2020 2020 2073 6361  .            sca
-00002bd0: 6c65 645f 6172 7220 3d20 2828 7363 616c  led_arr = ((scal
-00002be0: 655f 6661 6374 6f72 202a 206e 7061 7272  e_factor * nparr
-00002bf0: 3120 2b20 7368 6966 745f 6661 6374 6f72  1 + shift_factor
-00002c00: 2920 2b20 6e70 6172 7232 2920 2f20 322e  ) + nparr2) / 2.
-00002c10: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00002c20: 2020 2020 2020 2020 2020 2073 6361 6c65             scale
-00002c30: 645f 6172 7220 3d20 6e70 6172 7232 0a20  d_arr = nparr2. 
-00002c40: 2020 2020 2020 2072 6574 7572 6e20 7363         return sc
-00002c50: 616c 6564 5f61 7272 0a0a 2020 2020 6465  aled_arr..    de
-00002c60: 6620 5f43 4343 5f63 616c 6328 7365 6c66  f _CCC_calc(self
-00002c70: 2c20 6d31 2c20 6d32 293a 0a20 2020 2020  , m1, m2):.     
-00002c80: 2020 2061 7272 3120 3d20 6d31 2e76 6965     arr1 = m1.vie
-00002c90: 7728 666c 6f61 7429 0a20 2020 2020 2020  w(float).       
-00002ca0: 2061 7272 3220 3d20 6d32 2e76 6965 7728   arr2 = m2.view(
-00002cb0: 666c 6f61 7429 2020 2320 6e6f 7161 3a46  float)  # noqa:F
-00002cc0: 3834 310a 2020 2020 2020 2020 6e64 203d  841.        nd =
-00002cd0: 206c 656e 2861 7272 312e 7368 6170 6529   len(arr1.shape)
-00002ce0: 0a20 2020 2020 2020 2069 6620 6e64 203d  .        if nd =
-00002cf0: 3d20 3220 616e 6420 6c65 6e28 6172 7231  = 2 and len(arr1
-00002d00: 2e73 6861 7065 295b 315d 203d 3d20 303a  .shape)[1] == 0:
-00002d10: 0a20 2020 2020 2020 2020 2020 206e 6420  .            nd 
-00002d20: 3d20 310a 2020 2020 2020 2020 6c20 3d20  = 1.        l = 
-00002d30: 3120 2023 206e 6f71 613a 4537 3431 0a20  1  # noqa:E741. 
-00002d40: 2020 2020 2020 2064 696d 203d 206e 702e         dim = np.
-00002d50: 7a65 726f 7328 332c 2064 7479 7065 3d69  zeros(3, dtype=i
-00002d60: 6e74 290a 2020 2020 2020 2020 666f 7220  nt).        for 
-00002d70: 6920 696e 2072 616e 6765 286e 6429 3a0a  i in range(nd):.
-00002d80: 2020 2020 2020 2020 2020 2020 6c20 2a3d              l *=
-00002d90: 2061 7272 312e 7368 6170 655b 695d 2020   arr1.shape[i]  
-00002da0: 2320 6e6f 7161 3a45 3734 310a 2020 2020  # noqa:E741.    
-00002db0: 2020 2020 2020 2020 6469 6d5b 695d 203d          dim[i] =
-00002dc0: 2061 7272 312e 7368 6170 655b 695d 0a20   arr1.shape[i]. 
-00002dd0: 2020 2020 2020 2063 6f72 7220 3d20 302e         corr = 0.
-00002de0: 300a 2020 2020 2020 2020 6e75 6d65 7220  0.        numer 
-00002df0: 3d20 302e 300a 2020 2020 2020 2020 7661  = 0.0.        va
-00002e00: 7231 203d 2030 2e30 0a20 2020 2020 2020  r1 = 0.0.       
-00002e10: 2076 6172 3220 3d20 302e 300a 2020 2020   var2 = 0.0.    
-00002e20: 2020 2020 6966 206e 6420 3d3d 2031 3a0a      if nd == 1:.
-00002e30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00002e40: 7a20 696e 2072 616e 6765 2864 696d 5b30  z in range(dim[0
-00002e50: 5d29 3a0a 2020 2020 2020 2020 2020 2020  ]):.            
-00002e60: 2020 2020 6e75 6d65 7220 2b3d 2061 7272      numer += arr
-00002e70: 315b 7a5d 2a61 7272 325b 7a5d 0a20 2020  1[z]*arr2[z].   
-00002e80: 2020 2020 2020 2020 2020 2020 2076 6172               var
-00002e90: 3120 2b3d 2061 7272 315b 7a5d 2a2a 320a  1 += arr1[z]**2.
-00002ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002eb0: 7661 7232 202b 3d20 6172 7232 5b7a 5d2a  var2 += arr2[z]*
-00002ec0: 2a32 0a20 2020 2020 2020 2065 6c69 6620  *2.        elif 
-00002ed0: 6e64 203d 3d20 333a 0a20 2020 2020 2020  nd == 3:.       
-00002ee0: 2020 2020 2066 6f72 207a 2069 6e20 7261       for z in ra
-00002ef0: 6e67 6528 6469 6d5b 305d 293a 0a20 2020  nge(dim[0]):.   
-00002f00: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00002f10: 2079 2069 6e20 7261 6e67 6528 6469 6d5b   y in range(dim[
-00002f20: 315d 293a 0a20 2020 2020 2020 2020 2020  1]):.           
-00002f30: 2020 2020 2020 2020 2066 6f72 2078 2069           for x i
-00002f40: 6e20 7261 6e67 6528 6469 6d5b 325d 293a  n range(dim[2]):
-00002f50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002f60: 2020 2020 2020 2020 206e 756d 6572 202b           numer +
-00002f70: 3d20 6172 7231 5b7a 2c20 792c 2078 5d2a  = arr1[z, y, x]*
-00002f80: 6172 7232 5b7a 2c20 792c 2078 5d0a 2020  arr2[z, y, x].  
-00002f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fa0: 2020 2020 2020 7661 7231 202b 3d20 6172        var1 += ar
-00002fb0: 7231 5b7a 2c20 792c 2078 5d2a 2a32 0a20  r1[z, y, x]**2. 
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fd0: 2020 2020 2020 2076 6172 3220 2b3d 2061         var2 += a
-00002fe0: 7272 325b 7a2c 2079 2c20 785d 2a2a 320a  rr2[z, y, x]**2.
-00002ff0: 2020 2020 2020 2020 636f 7272 203d 206e          corr = n
-00003000: 756d 6572 2f6d 6174 682e 7371 7274 2876  umer/math.sqrt(v
-00003010: 6172 312a 7661 7232 290a 2020 2020 2020  ar1*var2).      
-00003020: 2020 636f 7272 203d 206d 696e 2831 2e30    corr = min(1.0
-00003030: 2c20 636f 7272 290a 2020 2020 2020 2020  , corr).        
-00003040: 636f 7272 203d 206d 6178 282d 312e 302c  corr = max(-1.0,
-00003050: 2063 6f72 7229 0a20 2020 2020 2020 2072   corr).        r
-00003060: 6574 7572 6e20 636f 7272 0a0a 2020 2020  eturn corr..    
-00003070: 6465 6620 4343 435f 6d61 7028 0a20 2020  def CCC_map(.   
-00003080: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-00003090: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-000030a0: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
-000030b0: 2020 206d 6170 5f70 726f 6265 2c0a 2020     map_probe,.  
-000030c0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-000030d0: 7267 6574 5f74 6872 6573 686f 6c64 3d30  rget_threshold=0
-000030e0: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
-000030f0: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
-00003100: 6f6c 643d 302e 302c 0a20 2020 2020 2020  old=0.0,.       
-00003110: 2020 2020 206d 6f64 653d 312c 0a20 2020       mode=1,.   
-00003120: 2020 2020 2020 2020 206d 6561 6e44 6973           meanDis
-00003130: 743d 4661 6c73 652c 0a20 2020 2020 2020  t=False,.       
-00003140: 2020 2020 2063 6d6f 6465 3d54 7275 652c       cmode=True,
-00003150: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00003160: 2222 2243 616c 6375 6c61 7465 2063 726f  """Calculate cro
-00003170: 7373 2d63 6f72 7265 6c61 7469 6f6e 2062  ss-correlation b
-00003180: 6574 7765 656e 2074 776f 204d 6170 2069  etween two Map i
-00003190: 6e73 7461 6e63 6573 2075 7369 6e67 206f  nstances using o
-000031a0: 6e65 206f 660a 2020 2020 2020 2020 3320  ne of.        3 
-000031b0: 6d65 7468 6f64 732e 0a0a 2020 2020 2020  methods...      
-000031c0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-000031d0: 2020 2020 6d61 705f 7461 7267 6574 2c20      map_target, 
-000031e0: 6d61 705f 7072 6f62 653a 2045 4d4d 6170  map_probe: EMMap
-000031f0: 2069 6e73 7461 6e63 6520 746f 2063 6f6d   instance to com
-00003200: 7061 7265 2e0a 0a20 2020 2020 2020 2020  pare...         
-00003210: 2020 206d 6170 5f74 6172 6765 745f 7468     map_target_th
-00003220: 7265 7368 6f6c 642c 206d 6170 5f70 726f  reshold, map_pro
-00003230: 6265 5f74 6872 6573 686f 6c64 3a0a 2020  be_threshold:.  
-00003240: 2020 2020 2020 2020 2020 2020 2020 4d61                Ma
-00003250: 7020 7468 7265 7368 6f6c 642c 2075 7365  p threshold, use
-00003260: 6420 746f 2073 656c 6563 7420 7069 7865  d to select pixe
-00003270: 6c73 2077 6865 6e20 6361 6c63 756c 6174  ls when calculat
-00003280: 696e 6720 4343 4320 7769 7468 0a20 2020  ing CCC with.   
-00003290: 2020 2020 2020 2020 2020 2020 206d 6574               met
-000032a0: 686f 6420 322e 2049 6620 6e6f 7420 7370  hod 2. If not sp
-000032b0: 6563 6966 6965 642c 2077 696c 6c20 6265  ecified, will be
-000032c0: 2063 616c 6375 6c61 7465 6420 7573 696e   calculated usin
-000032d0: 670a 2020 2020 2020 2020 2020 2020 2020  g.              
-000032e0: 2020 3a6d 6574 683a 6063 616c 6375 6c61    :meth:`calcula
-000032f0: 7465 5f6d 6170 5f74 6872 6573 686f 6c64  te_map_threshold
-00003300: 203c 5445 4d50 792e 7072 6f74 6569 6e2e   <TEMPy.protein.
-00003310: 7363 6f72 696e 675f 6675 6e63 7469 6f6e  scoring_function
-00003320: 732e 5363 6f72 696e 6746 756e 6374 696f  s.ScoringFunctio
-00003330: 6e73 2e63 616c 6375 6c61 7465 5f6d 6170  ns.calculate_map
-00003340: 5f74 6872 6573 686f 6c64 3e60 2020 2320  _threshold>`  # 
-00003350: 6e6f 7161 3a45 3530 310a 0a20 2020 2020  noqa:E501..     
-00003360: 2020 2020 2020 206d 6f64 653a 0a20 2020         mode:.   
-00003370: 2020 2020 2020 2020 2020 2020 2031 2e20               1. 
-00003380: 4343 4320 6361 6c63 756c 6174 696f 6e20  CCC calculation 
-00003390: 6f6e 2061 6c6c 2070 6978 656c 7320 696e  on all pixels in
-000033a0: 206d 6170 0a20 2020 2020 2020 2020 2020   map.           
-000033b0: 2020 2020 2032 2e20 4343 4320 6f6e 6c79       2. CCC only
-000033c0: 206f 6e20 7069 7865 6c73 2077 6974 6820   on pixels with 
-000033d0: 6465 6e73 6974 7920 7661 6c75 6520 6162  density value ab
-000033e0: 6f76 6520 7265 7370 6563 7469 7665 2074  ove respective t
-000033f0: 6872 6573 686f 6c64 730a 2020 2020 2020  hresholds.      
-00003400: 2020 2020 2020 2020 2020 332e 2043 4343            3. CCC
-00003410: 206f 6e6c 7920 6f6e 2070 6978 656c 7320   only on pixels 
-00003420: 7769 7468 696e 2074 6865 206d 6173 6b0a  within the mask.
-00003430: 0a20 2020 2020 2020 2020 2020 206d 6561  .            mea
-00003440: 6e44 6973 743a 2054 7275 6520 6966 2074  nDist: True if t
-00003450: 6865 2064 6576 6961 7469 6f6e 2066 726f  he deviation fro
-00003460: 6d20 6d65 616e 206e 6565 6473 2074 6f20  m mean needs to 
-00003470: 6265 2063 616c 6375 6c61 7465 640a 0a20  be calculated.. 
-00003480: 2020 2020 2020 2020 2020 2063 6d6f 6465             cmode
-00003490: 3a20 4966 2054 7275 652c 2075 7365 2070  : If True, use p
-000034a0: 7572 6520 7079 7468 6f6e 2069 6d70 6c65  ure python imple
-000034b0: 6d65 6e74 6174 696f 6e20 746f 2063 616c  mentation to cal
-000034c0: 6375 6c61 7465 2043 4343 2e0a 2020 2020  culate CCC..    
-000034d0: 2020 2020 2020 2020 2020 2020 4966 2046              If F
-000034e0: 616c 7365 2c20 7573 6520 6e75 6d70 7920  alse, use numpy 
-000034f0: 696d 706c 656d 656e 7461 7469 6f6e 2e0a  implementation..
-00003500: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-00003510: 3a0a 0a20 2020 2020 2020 2020 2020 2043  :..            C
-00003520: 4343 2c20 7065 7263 656e 7461 6765 5f6f  CC, percentage_o
-00003530: 7665 726c 6170 3a20 5468 6520 6372 6f73  verlap: The cros
-00003540: 7320 636f 7272 656c 6174 696f 6e20 7363  s correlation sc
-00003550: 6f72 6520 616e 6420 7468 650a 2020 2020  ore and the.    
-00003560: 2020 2020 2020 2020 7065 7263 656e 7461          percenta
-00003570: 6765 206f 7665 726c 6170 2062 6574 7765  ge overlap betwe
-00003580: 656e 2074 6865 2074 776f 2069 6e70 7574  en the two input
-00003590: 206d 6170 730a 0a20 2020 2020 2020 2052   maps..        R
-000035a0: 6169 7365 733a 0a0a 2020 2020 2020 2020  aises:..        
-000035b0: 2020 2020 5761 726e 696e 673a 2057 696c      Warning: Wil
-000035c0: 6c20 7265 7475 726e 202d 312c 2030 2069  l return -1, 0 i
-000035d0: 6620 7468 6520 7477 6f20 696e 7075 7420  f the two input 
-000035e0: 6d61 7073 2064 6f20 6e6f 7420 6d61 7463  maps do not matc
-000035f0: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-00003600: 2020 7368 6170 652c 2070 6978 656c 2073    shape, pixel s
-00003610: 697a 6520 616e 6420 6f72 6967 696e 2e0a  ize and origin..
-00003620: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00003630: 2020 2020 6966 2073 656c 662e 6d61 7043      if self.mapC
-00003640: 6f6d 7061 7269 736f 6e28 6d61 705f 7461  omparison(map_ta
-00003650: 7267 6574 2c20 6d61 705f 7072 6f62 6529  rget, map_probe)
-00003660: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00003670: 206e 6f74 206d 6f64 6520 3d3d 2031 3a0a   not mode == 1:.
-00003680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003690: 6966 206d 6170 5f74 6172 6765 745f 7468  if map_target_th
-000036a0: 7265 7368 6f6c 6420 3d3d 2030 2061 6e64  reshold == 0 and
-000036b0: 206d 6170 5f70 726f 6265 5f74 6872 6573   map_probe_thres
-000036c0: 686f 6c64 203d 3d20 303a 0a20 2020 2020  hold == 0:.     
-000036d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000036e0: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
-000036f0: 6f6c 6420 3d20 7365 6c66 2e63 616c 6375  old = self.calcu
-00003700: 6c61 7465 5f6d 6170 5f74 6872 6573 686f  late_map_thresho
-00003710: 6c64 280a 2020 2020 2020 2020 2020 2020  ld(.            
-00003720: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-00003730: 7461 7267 6574 0a20 2020 2020 2020 2020  target.         
-00003740: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00003750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003760: 206d 6170 5f70 726f 6265 5f74 6872 6573   map_probe_thres
-00003770: 686f 6c64 203d 2073 656c 662e 6361 6c63  hold = self.calc
-00003780: 756c 6174 655f 6d61 705f 7468 7265 7368  ulate_map_thresh
-00003790: 6f6c 6428 0a20 2020 2020 2020 2020 2020  old(.           
-000037a0: 2020 2020 2020 2020 2020 2020 206d 6170               map
-000037b0: 5f70 726f 6265 0a20 2020 2020 2020 2020  _probe.         
-000037c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000037d0: 2020 2020 2020 2020 2020 2020 2062 696e               bin
-000037e0: 5f6d 6170 3120 3d20 6d61 705f 7461 7267  _map1 = map_targ
-000037f0: 6574 2e66 756c 6c4d 6170 203e 2066 6c6f  et.fullMap > flo
-00003800: 6174 286d 6170 5f74 6172 6765 745f 7468  at(map_target_th
-00003810: 7265 7368 6f6c 6429 0a20 2020 2020 2020  reshold).       
-00003820: 2020 2020 2020 2020 2062 696e 5f6d 6170           bin_map
-00003830: 3220 3d20 6d61 705f 7072 6f62 652e 6675  2 = map_probe.fu
-00003840: 6c6c 4d61 7020 3e20 666c 6f61 7428 6d61  llMap > float(ma
-00003850: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
-00003860: 6429 0a20 2020 2020 2020 2020 2020 2020  d).             
-00003870: 2020 206d 696e 696d 203d 206e 702e 7375     minim = np.su
-00003880: 6d28 6269 6e5f 6d61 7031 290a 2020 2020  m(bin_map1).    
-00003890: 2020 2020 2020 2020 2020 2020 6d69 6e69              mini
-000038a0: 6d32 203d 206e 702e 7375 6d28 6269 6e5f  m2 = np.sum(bin_
-000038b0: 6d61 7032 290a 2020 2020 2020 2020 2020  map2).          
-000038c0: 2020 2020 2020 6966 206d 696e 696d 3220        if minim2 
-000038d0: 3c20 6d69 6e69 6d3a 0a20 2020 2020 2020  < minim:.       
-000038e0: 2020 2020 2020 2020 2020 2020 206d 696e               min
-000038f0: 696d 203d 206d 696e 696d 320a 2020 2020  im = minim2.    
-00003900: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00003910: 5f61 7272 6179 203d 2028 6269 6e5f 6d61  _array = (bin_ma
-00003920: 7031 202a 2062 696e 5f6d 6170 3229 203e  p1 * bin_map2) >
-00003930: 2030 0a20 2020 2020 2020 2020 2020 2020   0.             
-00003940: 2020 2069 6620 6e6f 7420 6d69 6e69 6d20     if not minim 
-00003950: 3d3d 2030 2e30 3a0a 2020 2020 2020 2020  == 0.0:.        
-00003960: 2020 2020 2020 2020 2020 2020 7065 7263              perc
-00003970: 5f6f 7672 203d 2066 6c6f 6174 286e 702e  _ovr = float(np.
-00003980: 7375 6d28 6d61 736b 5f61 7272 6179 2929  sum(mask_array))
-00003990: 202f 206d 696e 696d 0a20 2020 2020 2020   / minim.       
-000039a0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000039b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039c0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-000039d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000039e0: 2020 274e 6f20 6d61 7020 6f76 6572 6c61    'No map overla
-000039f0: 7020 2843 726f 7373 2063 6f72 7265 6c61  p (Cross correla
-00003a00: 7469 6f6e 2073 636f 7265 292c 2065 7869  tion score), exi
-00003a10: 7469 6e67 2027 0a20 2020 2020 2020 2020  ting '.         
-00003a20: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00003a30: 7363 6f72 6520 6361 6c63 756c 6174 696f  score calculatio
-00003a40: 6e2e 2e27 0a20 2020 2020 2020 2020 2020  n..'.           
-00003a50: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00003a60: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00003a70: 6574 7572 6e20 2d31 2e30 2c20 302e 300a  eturn -1.0, 0.0.
-00003a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003a90: 6966 2070 6572 635f 6f76 7220 3c20 302e  if perc_ovr < 0.
-00003aa0: 3032 3a0a 2020 2020 2020 2020 2020 2020  02:.            
-00003ab0: 2020 2020 2020 2020 7265 7475 726e 202d          return -
-00003ac0: 312e 302c 2030 2e30 0a20 2020 2020 2020  1.0, 0.0.       
-00003ad0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00003ae0: 2020 2020 2020 2020 2020 2070 6572 635f             perc_
-00003af0: 6f76 7220 3d20 312e 300a 0a20 2020 2020  ovr = 1.0..     
-00003b00: 2020 2020 2020 2023 2063 616c 6375 6c61         # calcula
-00003b10: 7465 2043 4343 2077 6974 6869 6e20 766f  te CCC within vo
-00003b20: 6c75 6d65 206f 6620 6f76 6572 6c61 700a  lume of overlap.
-00003b30: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00003b40: 6f64 6520 3d3d 2033 3a0a 2020 2020 2020  ode == 3:.      
-00003b50: 2020 2020 2020 2020 2020 6966 206e 702e            if np.
-00003b60: 7375 6d28 6d61 736b 5f61 7272 6179 2920  sum(mask_array) 
-00003b70: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00003b80: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-00003b90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003ba0: 2020 2020 2020 2020 2027 4e6f 206d 6170           'No map
-00003bb0: 206f 7665 726c 6170 2028 4372 6f73 7320   overlap (Cross 
-00003bc0: 636f 7272 656c 6174 696f 6e20 7363 6f72  correlation scor
-00003bd0: 6529 2c20 270a 2020 2020 2020 2020 2020  e), '.          
-00003be0: 2020 2020 2020 2020 2020 2020 2020 2765                'e
-00003bf0: 7869 7469 6e67 2073 636f 7265 2063 616c  xiting score cal
-00003c00: 6375 6c61 7469 6f6e 2e2e 270a 2020 2020  culation..'.    
-00003c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003c20: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00003c30: 2020 2020 2020 7265 7475 726e 202d 312e        return -1.
-00003c40: 302c 2030 2e30 0a20 2020 2020 2020 2020  0, 0.0.         
-00003c50: 2020 2020 2020 206d 6170 315f 6d61 736b         map1_mask
-00003c60: 203d 206d 6170 5f74 6172 6765 742e 6675   = map_target.fu
-00003c70: 6c6c 4d61 705b 6d61 736b 5f61 7272 6179  llMap[mask_array
-00003c80: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00003c90: 2020 6d61 7032 5f6d 6173 6b20 3d20 6d61    map2_mask = ma
-00003ca0: 705f 7072 6f62 652e 6675 6c6c 4d61 705b  p_probe.fullMap[
-00003cb0: 6d61 736b 5f61 7272 6179 5d0a 2020 2020  mask_array].    
-00003cc0: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-00003cd0: 6561 6e44 6973 743a 0a20 2020 2020 2020  eanDist:.       
-00003ce0: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00003cf0: 315f 6d61 736b 203d 206d 6170 315f 6d61  1_mask = map1_ma
-00003d00: 736b 202d 206e 702e 6d65 616e 286d 6170  sk - np.mean(map
-00003d10: 315f 6d61 736b 290a 2020 2020 2020 2020  1_mask).        
-00003d20: 2020 2020 2020 2020 2020 2020 6d61 7032              map2
-00003d30: 5f6d 6173 6b20 3d20 6d61 7032 5f6d 6173  _mask = map2_mas
-00003d40: 6b20 2d20 6e70 2e6d 6561 6e28 6d61 7032  k - np.mean(map2
-00003d50: 5f6d 6173 6b29 0a20 2020 2020 2020 2020  _mask).         
-00003d60: 2020 2020 2020 2069 6620 636d 6f64 653a         if cmode:
-00003d70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003d80: 2020 2020 2063 6f72 7220 3d20 7365 6c66       corr = self
-00003d90: 2e5f 4343 435f 6361 6c63 280a 2020 2020  ._CCC_calc(.    
+00001850: 2020 2020 2020 2222 2243 7572 7265 6e74        """Current
+00001860: 6c79 2062 726f 6b65 6e3a 206e 702e 6e75  ly broken: np.nu
+00001870: 6d73 756d 2064 6f65 736e 2774 2065 7869  msum doesn't exi
+00001880: 7374 2069 6e20 6375 7272 656e 7420 6e75  st in current nu
+00001890: 6d70 7920 7665 7273 696f 6e0a 0a0a 2020  mpy version...  
+000018a0: 2020 2020 2020 2020 2020 6d61 736b 206d            mask m
+000018b0: 6170 7320 7769 7468 2032 2063 7574 2d6f  aps with 2 cut-o
+000018c0: 6666 206d 6170 5f74 6172 6765 745f 7468  ff map_target_th
+000018d0: 7265 7368 6f6c 6420 616e 640a 2020 2020  reshold and.    
+000018e0: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+000018f0: 655f 7468 7265 7368 6f6c 6420 2876 6f6c  e_threshold (vol
+00001900: 2074 6872 2e29 0a0a 2020 2020 2020 2020   thr.)..        
+00001910: 2020 2020 7265 7475 726e 3a0a 2020 2020      return:.    
+00001920: 2020 2020 2020 2020 6672 6163 7469 6f6e          fraction
+00001930: 206f 6620 6f76 6572 6c61 7020 7769 7468   of overlap with
+00001940: 2072 6573 7065 6374 2074 6f20 7461 7267   respect to targ
+00001950: 6574 2c20 616e 6420 7769 7468 2072 6573  et, and with res
+00001960: 7065 6374 2074 6f0a 2020 2020 2020 2020  pect to.        
+00001970: 2020 2020 7072 6f62 650a 2020 2020 2020      probe.      
+00001980: 2020 2222 220a 0a20 2020 2020 2020 2062    """..        b
+00001990: 696e 6d61 7031 203d 206d 6170 5f74 6172  inmap1 = map_tar
+000019a0: 6765 742e 6675 6c6c 4d61 7020 3e20 666c  get.fullMap > fl
+000019b0: 6f61 7428 6d61 705f 7461 7267 6574 5f74  oat(map_target_t
+000019c0: 6872 6573 686f 6c64 290a 2020 2020 2020  hreshold).      
+000019d0: 2020 6269 6e6d 6170 3220 3d20 6d61 705f    binmap2 = map_
+000019e0: 7072 6f62 652e 6675 6c6c 4d61 7020 3e20  probe.fullMap > 
+000019f0: 666c 6f61 7428 6d61 705f 7072 6f62 655f  float(map_probe_
+00001a00: 7468 7265 7368 6f6c 6429 0a20 2020 2020  threshold).     
+00001a10: 2020 206d 6173 6b5f 6172 7261 7920 3d20     mask_array = 
+00001a20: 2862 696e 6d61 7031 202a 2062 696e 6d61  (binmap1 * binma
+00001a30: 7032 2920 3e20 300a 0a20 2020 2020 2020  p2) > 0..       
+00001a40: 2073 697a 6531 203d 206e 702e 6e75 6d73   size1 = np.nums
+00001a50: 756d 2862 696e 6d61 7031 2920 2023 2063  um(binmap1)  # c
+00001a60: 616e 2774 2066 696e 6420 6e75 6d73 756d  an't find numsum
+00001a70: 2069 6e20 6e75 6d70 7920 646f 6373 0a20   in numpy docs. 
+00001a80: 2020 2020 2020 2073 697a 6532 203d 206e         size2 = n
+00001a90: 702e 6e75 6d73 756d 2862 696e 6d61 7032  p.numsum(binmap2
+00001aa0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00001ab0: 2066 6c6f 6174 286e 702e 6e75 6d73 756d   float(np.numsum
+00001ac0: 286d 6173 6b5f 6172 7261 7929 2920 2f20  (mask_array)) / 
+00001ad0: 7369 7a65 312c 205c 0a20 2020 2020 2020  size1, \.       
+00001ae0: 2020 2020 2066 6c6f 6174 286e 702e 6e75       float(np.nu
+00001af0: 6d73 756d 286d 6173 6b5f 6172 7261 7929  msum(mask_array)
+00001b00: 2920 2f20 7369 7a65 320a 0a20 2020 2064  ) / size2..    d
+00001b10: 6566 205f 6f76 6572 6c61 705f 6d61 705f  ef _overlap_map_
+00001b20: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+00001b30: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+00001b40: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
+00001b50: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+00001b60: 5f74 6172 6765 745f 7468 7265 7368 6f6c  _target_threshol
+00001b70: 642c 0a20 2020 2020 2020 2020 2020 206d  d,.            m
+00001b80: 6170 5f70 726f 6265 2c0a 2020 2020 2020  ap_probe,.      
+00001b90: 2020 2020 2020 6d61 705f 7072 6f62 655f        map_probe_
+00001ba0: 7468 7265 7368 6f6c 642c 0a20 2020 2029  threshold,.    )
+00001bb0: 3a0a 2020 2020 2020 2020 2222 2248 656c  :.        """Hel
+00001bc0: 7065 7220 6675 6e63 7469 6f6e 2066 6f72  per function for
+00001bd0: 206d 7574 7561 6c20 696e 666f 726d 6174   mutual informat
+00001be0: 696f 6e20 6361 6c63 756c 6174 696f 6e2e  ion calculation.
+00001bf0: 0a0a 2020 2020 2020 2020 4d61 736b 7320  ..        Masks 
+00001c00: 6d61 7073 2075 7369 6e67 2075 6e69 7175  maps using uniqu
+00001c10: 6520 6375 746f 6666 2066 6f72 2065 6163  e cutoff for eac
+00001c20: 6820 286d 6170 5f74 6172 6765 745f 7468  h (map_target_th
+00001c30: 7265 7368 6f6c 6420 616e 640a 2020 2020  reshold and.    
+00001c40: 2020 2020 6d61 705f 7072 6f62 655f 7468      map_probe_th
+00001c50: 7265 7368 6f6c 6429 2061 6e64 2072 6574  reshold) and ret
+00001c60: 7572 6e73 2061 2066 696e 616c 206d 6173  urns a final mas
+00001c70: 6b20 7768 6963 6820 6973 2054 7275 6520  k which is True 
+00001c80: 7768 6572 650a 2020 2020 2020 2020 626f  where.        bo
+00001c90: 7468 206d 6170 7320 6172 6520 6162 6f76  th maps are abov
+00001ca0: 6520 7468 6569 7220 7265 7370 6563 7469  e their respecti
+00001cb0: 7665 2074 6872 6573 686f 6c64 732e 0a0a  ve thresholds...
+00001cc0: 2020 2020 2020 2020 4172 6773 3a0a 2020          Args:.  
+00001cd0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
+00001ce0: 7267 6574 2c20 6d61 705f 7072 6f62 653a  rget, map_probe:
+00001cf0: 2049 6e70 7574 204d 6170 2069 6e73 7461   Input Map insta
+00001d00: 6e63 650a 2020 2020 2020 2020 2020 2020  nce.            
+00001d10: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
+00001d20: 686f 6c64 2c20 6d61 705f 7072 6f62 655f  hold, map_probe_
+00001d30: 7468 7265 7368 6f6c 643a 2054 6872 6573  threshold: Thres
+00001d40: 686f 6c64 2075 7365 6420 746f 206d 6173  hold used to mas
+00001d50: 6b0a 2020 2020 2020 2020 2020 2020 7265  k.            re
+00001d60: 7370 6563 7469 7665 206d 6170 2069 6e73  spective map ins
+00001d70: 7461 6e63 650a 0a20 2020 2020 2020 2052  tance..        R
+00001d80: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00001d90: 2020 2020 6d61 736b 5f61 7272 6179 3a20      mask_array: 
+00001da0: 4d61 736b 2077 6869 6368 2069 7320 7472  Mask which is tr
+00001db0: 7565 2077 6865 7265 2062 6f74 6820 6d61  ue where both ma
+00001dc0: 7073 2061 7265 2061 626f 7665 2074 6865  ps are above the
+00001dd0: 6972 0a20 2020 2020 2020 2020 2020 2072  ir.            r
+00001de0: 6573 7065 6374 6976 6520 7468 7265 7368  espective thresh
+00001df0: 6f6c 6473 2e0a 2020 2020 2020 2020 2222  olds..        ""
+00001e00: 220a 2020 2020 2020 2020 6269 6e6d 6170  ".        binmap
+00001e10: 3120 3d20 6d61 705f 7461 7267 6574 2e66  1 = map_target.f
+00001e20: 756c 6c4d 6170 203e 2066 6c6f 6174 286d  ullMap > float(m
+00001e30: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
+00001e40: 6f6c 6429 0a20 2020 2020 2020 2062 696e  old).        bin
+00001e50: 6d61 7032 203d 206d 6170 5f70 726f 6265  map2 = map_probe
+00001e60: 2e66 756c 6c4d 6170 203e 2066 6c6f 6174  .fullMap > float
+00001e70: 286d 6170 5f70 726f 6265 5f74 6872 6573  (map_probe_thres
+00001e80: 686f 6c64 290a 2020 2020 2020 2020 6d61  hold).        ma
+00001e90: 736b 5f61 7272 6179 203d 2028 6269 6e6d  sk_array = (binm
+00001ea0: 6170 3120 2a20 6269 6e6d 6170 3229 203e  ap1 * binmap2) >
+00001eb0: 2030 0a20 2020 2020 2020 2072 6574 7572   0.        retur
+00001ec0: 6e20 6d61 736b 5f61 7272 6179 0a0a 2020  n mask_array..  
+00001ed0: 2020 6465 6620 6361 6c63 756c 6174 655f    def calculate_
+00001ee0: 6d61 705f 7468 7265 7368 6f6c 6428 7365  map_threshold(se
+00001ef0: 6c66 2c20 6d61 705f 7461 7267 6574 293a  lf, map_target):
+00001f00: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
+00001f10: 756c 6174 6573 206d 6170 2074 6872 6573  ulates map thres
+00001f20: 686f 6c64 2061 7320 6d65 616e 2076 616c  hold as mean val
+00001f30: 7565 202b 2028 3220 2a20 6d61 7020 7374  ue + (2 * map st
+00001f40: 616e 6461 7264 2064 6576 6961 7469 6f6e  andard deviation
+00001f50: 290a 0a20 2020 2020 2020 2041 7267 733a  )..        Args:
+00001f60: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+00001f70: 5f74 6172 6765 743a 204d 6170 2069 6e73  _target: Map ins
+00001f80: 7461 6e63 650a 0a20 2020 2020 2020 2052  tance..        R
+00001f90: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00001fa0: 2020 2020 666c 6f61 743a 2054 6872 6573      float: Thres
+00001fb0: 686f 6c64 2076 616c 7565 0a20 2020 2020  hold value.     
+00001fc0: 2020 2022 2222 0a20 2020 2020 2020 2023     """.        #
+00001fd0: 204e 4f54 453a 204d 4f56 4520 544f 2054   NOTE: MOVE TO T
+00001fe0: 454d 5079 2e6d 6170 732e 656d 5f6d 6170  EMPy.maps.em_map
+00001ff0: 2e4d 6170 3f3f 0a20 2020 2020 2020 2074  .Map??.        t
+00002000: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00002010: 7065 616b 2c20 6176 652c 2073 6967 6d61  peak, ave, sigma
+00002020: 203d 206d 6170 5f74 6172 6765 742e 5f70   = map_target._p
+00002030: 6561 6b5f 6465 6e73 6974 7928 290a 2020  eak_density().  
+00002040: 2020 2020 2020 2020 2020 766f 6c5f 7468            vol_th
+00002050: 7265 7368 6f6c 6420 3d20 666c 6f61 7428  reshold = float(
+00002060: 6176 6529 202b 2028 322e 3020 2a20 666c  ave) + (2.0 * fl
+00002070: 6f61 7428 7369 676d 6129 290a 2020 2020  oat(sigma)).    
+00002080: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+00002090: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+000020a0: 2020 6966 206c 656e 286d 6170 5f74 6172    if len(map_tar
+000020b0: 6765 742e 6865 6164 6572 2920 3d3d 2030  get.header) == 0
+000020c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000020d0: 2020 616d 6561 6e20 3d20 6d61 705f 7461    amean = map_ta
+000020e0: 7267 6574 2e6d 6561 6e28 290a 2020 2020  rget.mean().    
+000020f0: 2020 2020 2020 2020 2020 2020 726d 7320              rms 
+00002100: 3d20 6d61 705f 7461 7267 6574 2e73 7464  = map_target.std
+00002110: 2829 0a20 2020 2020 2020 2020 2020 2020  ().             
+00002120: 2020 2076 6f6c 5f74 6872 6573 686f 6c64     vol_threshold
+00002130: 203d 2066 6c6f 6174 2861 6d65 616e 2920   = float(amean) 
+00002140: 2b20 2831 2e35 202a 2066 6c6f 6174 2872  + (1.5 * float(r
+00002150: 6d73 2929 0a20 2020 2020 2020 2020 2020  ms)).           
+00002160: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00002170: 2020 2020 2020 2061 6d65 616e 203d 206d         amean = m
+00002180: 6170 5f74 6172 6765 742e 6d65 616e 2829  ap_target.mean()
+00002190: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000021a0: 2072 6d73 203d 206d 6170 5f74 6172 6765   rms = map_targe
+000021b0: 742e 7374 6428 290a 2020 2020 2020 2020  t.std().        
+000021c0: 2020 2020 2020 2020 766f 6c5f 7468 7265          vol_thre
+000021d0: 7368 6f6c 6420 3d20 666c 6f61 7428 616d  shold = float(am
+000021e0: 6561 6e29 202b 2028 312e 3520 2a20 666c  ean) + (1.5 * fl
+000021f0: 6f61 7428 726d 7329 290a 2020 2020 2020  oat(rms)).      
+00002200: 2020 7265 7475 726e 2076 6f6c 5f74 6872    return vol_thr
+00002210: 6573 686f 6c64 0a0a 2020 2020 6465 6620  eshold..    def 
+00002220: 6d61 7043 6f6d 7061 7269 736f 6e28 7365  mapComparison(se
+00002230: 6c66 2c20 6d61 705f 7461 7267 6574 2c20  lf, map_target, 
+00002240: 6d61 705f 7072 6f62 6529 3a0a 2020 2020  map_probe):.    
+00002250: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002260: 4368 6563 6b73 2069 6620 7072 6f70 6572  Checks if proper
+00002270: 7469 6573 2028 7361 6d70 6c69 6e67 2072  ties (sampling r
+00002280: 6174 652c 2062 6f78 2073 697a 6520 616e  ate, box size an
+00002290: 6420 6f72 6967 696e 2920 6f66 2074 776f  d origin) of two
+000022a0: 206d 6170 730a 2020 2020 2020 2020 6172   maps.        ar
+000022b0: 6520 6571 7561 6c2e 0a0a 2020 2020 2020  e equal...      
+000022c0: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
+000022d0: 2020 2020 6d61 705f 7461 7267 6574 2c20      map_target, 
+000022e0: 6d61 705f 7072 6f62 650a 2020 2020 2020  map_probe.      
+000022f0: 2020 2020 2020 2020 2020 4d61 7020 696e            Map in
+00002300: 7374 616e 6365 2074 6f20 636f 6d70 6172  stance to compar
+00002310: 652e 0a0a 2020 2020 2020 2020 5265 7475  e...        Retu
+00002320: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00002330: 2054 7275 6520 6966 2074 6865 206d 6170   True if the map
+00002340: 2070 726f 7065 7274 6965 7320 6172 6520   properties are 
+00002350: 7468 6520 7361 6d65 2062 6574 7765 656e  the same between
+00002360: 2074 776f 206d 6170 732c 2046 616c 7365   two maps, False
+00002370: 0a20 2020 2020 2020 2020 2020 206f 7468  .            oth
+00002380: 6572 7769 7365 2e0a 2020 2020 2020 2020  erwise..        
+00002390: 2222 220a 2020 2020 2020 2020 6966 2028  """.        if (
+000023a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000023b0: 206e 702e 6973 636c 6f73 6528 6d61 705f   np.isclose(map_
+000023c0: 7461 7267 6574 2e61 7069 782c 0a20 2020  target.apix,.   
+000023d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000023e0: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+000023f0: 652e 6170 6978 2c0a 2020 2020 2020 2020  e.apix,.        
+00002400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002410: 2020 2061 746f 6c3d 3145 2d36 292e 616c     atol=1E-6).al
+00002420: 6c28 2920 616e 640a 2020 2020 2020 2020  l() and.        
+00002430: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+00002440: 6574 2e62 6f78 5f73 697a 6528 2920 3d3d  et.box_size() ==
+00002450: 206d 6170 5f70 726f 6265 2e62 6f78 5f73   map_probe.box_s
+00002460: 697a 6528 290a 2020 2020 2020 2020 293a  ize().        ):
+00002470: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00002480: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00002490: 2020 2020 2020 726f 756e 6428 6d61 705f        round(map_
+000024a0: 7461 7267 6574 2e6f 7269 6769 6e5b 305d  target.origin[0]
+000024b0: 2c20 3229 203d 3d20 726f 756e 6428 6d61  , 2) == round(ma
+000024c0: 705f 7072 6f62 652e 6f72 6967 696e 5b30  p_probe.origin[0
+000024d0: 5d2c 2032 2920 616e 6420 2023 206e 6f71  ], 2) and  # noq
+000024e0: 613a 4535 3031 0a20 2020 2020 2020 2020  a:E501.         
+000024f0: 2020 2020 2020 2020 2020 2072 6f75 6e64             round
+00002500: 286d 6170 5f74 6172 6765 742e 6f72 6967  (map_target.orig
+00002510: 696e 5b31 5d2c 2032 2920 3d3d 2072 6f75  in[1], 2) == rou
+00002520: 6e64 286d 6170 5f70 726f 6265 2e6f 7269  nd(map_probe.ori
+00002530: 6769 6e5b 315d 2c20 3229 2061 6e64 2020  gin[1], 2) and  
+00002540: 2320 6e6f 7161 3a45 3530 310a 2020 2020  # noqa:E501.    
+00002550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002560: 726f 756e 6428 6d61 705f 7461 7267 6574  round(map_target
+00002570: 2e6f 7269 6769 6e5b 325d 2c20 3229 203d  .origin[2], 2) =
+00002580: 3d20 726f 756e 6428 6d61 705f 7072 6f62  = round(map_prob
+00002590: 652e 6f72 6967 696e 5b32 5d2c 2032 2920  e.origin[2], 2) 
+000025a0: 2023 206e 6f71 613a 4535 3031 0a20 2020   # noqa:E501.   
+000025b0: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+000025c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000025d0: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+000025e0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000025f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00002600: 2046 616c 7365 0a20 2020 2020 2020 2065   False.        e
+00002610: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00002620: 2072 6574 7572 6e20 4661 6c73 650a 0a20   return False.. 
+00002630: 2020 2064 6566 205f 6661 696c 6564 5f6d     def _failed_m
+00002640: 6174 6368 2873 656c 6629 3a0a 2020 2020  atch(self):.    
+00002650: 2020 2020 2320 7368 6f75 6c64 2069 6d70      # should imp
+00002660: 6c65 6d65 6e74 2054 454d 5079 2065 7272  lement TEMPy err
+00002670: 6f72 7320 666f 7220 6d6f 7265 2065 6c65  ors for more ele
+00002680: 6761 6e74 2065 7272 6f72 2068 616e 646c  gant error handl
+00002690: 696e 670a 2020 2020 2020 2020 7072 696e  ing.        prin
+000026a0: 7428 0a20 2020 2020 2020 2020 2020 2027  t(.            '
+000026b0: 5761 726e 696e 673a 2063 616e 5c27 7420  Warning: can\'t 
+000026c0: 6d61 7463 6820 7468 6520 6d61 7020 6174  match the map at
+000026d0: 2074 6865 206d 6f6d 656e 742c 270a 2020   the moment,'.  
+000026e0: 2020 2020 2020 2020 2020 2775 7365 206d            'use m
+000026f0: 6170 2077 6974 6820 7361 6d65 2062 6f78  ap with same box
+00002700: 2073 697a 652e 270a 2020 2020 2020 2020   size.'.        
+00002710: 290a 2020 2020 2020 2020 7379 732e 6578  ).        sys.ex
+00002720: 6974 2829 0a0a 2020 2020 6465 6620 7363  it()..    def sc
+00002730: 616c 655f 6d65 6469 616e 2873 656c 662c  ale_median(self,
+00002740: 2061 7272 312c 2061 7272 3229 3a0a 2020   arr1, arr2):.  
+00002750: 2020 2020 2020 2222 2253 6361 6c65 206f        """Scale o
+00002760: 6e65 206c 6973 742f 6172 7261 7920 6f66  ne list/array of
+00002770: 2073 636f 7265 7320 7769 7468 2072 6573   scores with res
+00002780: 7065 6374 2074 6f20 616e 6f74 6865 7220  pect to another 
+00002790: 6261 7365 6420 6f6e 0a20 2020 2020 2020  based on.       
+000027a0: 2064 6973 7472 6962 7574 696f 6e20 6172   distribution ar
+000027b0: 6f75 6e64 206d 6564 6961 6e2e 0a0a 2020  ound median...  
+000027c0: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
+000027d0: 0a20 2020 2020 2020 2020 2020 2061 7272  .            arr
+000027e0: 312c 2061 7272 323a 2041 7272 6179 2f6c  1, arr2: Array/l
+000027f0: 6973 7420 6f66 2073 636f 7265 730a 0a20  ist of scores.. 
+00002800: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
+00002810: 2020 2020 2020 2020 2020 2020 5363 616c              Scal
+00002820: 6564 2061 7272 312c 2062 6173 6564 206f  ed arr1, based o
+00002830: 6e20 7468 6520 7661 6c75 6573 2069 6e20  n the values in 
+00002840: 6172 7232 0a20 2020 2020 2020 2022 2222  arr2.        """
+00002850: 0a20 2020 2020 2020 206e 7061 7272 3120  .        nparr1 
+00002860: 3d20 6e70 2e61 7272 6179 2861 7272 3129  = np.array(arr1)
+00002870: 0a20 2020 2020 2020 206e 7061 7272 3220  .        nparr2 
+00002880: 3d20 6e70 2e61 7272 6179 2861 7272 3229  = np.array(arr2)
+00002890: 0a20 2020 2020 2020 206d 6564 5f64 6576  .        med_dev
+000028a0: 5f31 203d 206e 702e 6d65 6469 616e 286e  _1 = np.median(n
+000028b0: 702e 6162 736f 6c75 7465 286e 7061 7272  p.absolute(nparr
+000028c0: 3120 2d20 6e70 2e6d 6564 6961 6e28 6e70  1 - np.median(np
+000028d0: 6172 7231 2929 290a 2020 2020 2020 2020  arr1))).        
+000028e0: 6d65 645f 6465 765f 3220 3d20 6e70 2e6d  med_dev_2 = np.m
+000028f0: 6564 6961 6e28 6e70 2e61 6273 6f6c 7574  edian(np.absolut
+00002900: 6528 6e70 6172 7232 202d 206e 702e 6d65  e(nparr2 - np.me
+00002910: 6469 616e 286e 7061 7272 3229 2929 0a20  dian(nparr2))). 
+00002920: 2020 2020 2020 2069 6620 6d65 645f 6465         if med_de
+00002930: 765f 3120 3d3d 2030 2e30 3a0a 2020 2020  v_1 == 0.0:.    
+00002940: 2020 2020 2020 2020 7363 616c 655f 6661          scale_fa
+00002950: 6374 6f72 203d 2030 2e30 0a20 2020 2020  ctor = 0.0.     
+00002960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00002970: 2020 2020 2073 6361 6c65 5f66 6163 746f       scale_facto
+00002980: 7220 3d20 6d65 645f 6465 765f 3220 2f20  r = med_dev_2 / 
+00002990: 6d65 645f 6465 765f 310a 2020 2020 2020  med_dev_1.      
+000029a0: 2020 7368 6966 745f 6661 6374 6f72 203d    shift_factor =
+000029b0: 206e 702e 6d65 6469 616e 286e 7061 7272   np.median(nparr
+000029c0: 3229 202d 2028 7363 616c 655f 6661 6374  2) - (scale_fact
+000029d0: 6f72 202a 206e 702e 6d65 6469 616e 286e  or * np.median(n
+000029e0: 7061 7272 3129 290a 0a20 2020 2020 2020  parr1))..       
+000029f0: 2023 2054 4f44 4f3a 2066 696e 6420 6120   # TODO: find a 
+00002a00: 6265 7474 6572 2077 6179 2074 6f20 6176  better way to av
+00002a10: 6f69 6420 6f75 746c 6965 7273 2069 6e20  oid outliers in 
+00002a20: 6765 6e65 7261 6c0a 2020 2020 2020 2020  general.        
+00002a30: 6966 2028 6d61 7828 6e70 6172 7231 2920  if (max(nparr1) 
+00002a40: 2d20 6d69 6e28 6e70 6172 7231 2929 203e  - min(nparr1)) >
+00002a50: 2030 2e31 3a0a 2020 2020 2020 2020 2020   0.1:.          
+00002a60: 2020 7363 616c 6564 5f61 7272 203d 2028    scaled_arr = (
+00002a70: 2873 6361 6c65 5f66 6163 746f 7220 2a20  (scale_factor * 
+00002a80: 6e70 6172 7231 202b 2073 6869 6674 5f66  nparr1 + shift_f
+00002a90: 6163 746f 7229 202b 206e 7061 7272 3229  actor) + nparr2)
+00002aa0: 202f 2032 2e0a 2020 2020 2020 2020 656c   / 2..        el
+00002ab0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00002ac0: 7363 616c 6564 5f61 7272 203d 206e 7061  scaled_arr = npa
+00002ad0: 7272 320a 2020 2020 2020 2020 7265 7475  rr2.        retu
+00002ae0: 726e 2073 6361 6c65 645f 6172 720a 0a20  rn scaled_arr.. 
+00002af0: 2020 2064 6566 205f 4343 435f 6361 6c63     def _CCC_calc
+00002b00: 2873 656c 662c 206d 312c 206d 3229 3a0a  (self, m1, m2):.
+00002b10: 2020 2020 2020 2020 6172 7231 203d 206d          arr1 = m
+00002b20: 312e 7669 6577 2866 6c6f 6174 290a 2020  1.view(float).  
+00002b30: 2020 2020 2020 6172 7232 203d 206d 322e        arr2 = m2.
+00002b40: 7669 6577 2866 6c6f 6174 2920 2023 206e  view(float)  # n
+00002b50: 6f71 613a 4638 3431 0a20 2020 2020 2020  oqa:F841.       
+00002b60: 206e 6420 3d20 6c65 6e28 6172 7231 2e73   nd = len(arr1.s
+00002b70: 6861 7065 290a 2020 2020 2020 2020 6966  hape).        if
+00002b80: 206e 6420 3d3d 2032 2061 6e64 206c 656e   nd == 2 and len
+00002b90: 2861 7272 312e 7368 6170 6529 5b31 5d20  (arr1.shape)[1] 
+00002ba0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00002bb0: 2020 6e64 203d 2031 0a20 2020 2020 2020    nd = 1.       
+00002bc0: 206c 203d 2031 2020 2320 6e6f 7161 3a45   l = 1  # noqa:E
+00002bd0: 3734 310a 2020 2020 2020 2020 6469 6d20  741.        dim 
+00002be0: 3d20 6e70 2e7a 6572 6f73 2833 2c20 6474  = np.zeros(3, dt
+00002bf0: 7970 653d 696e 7429 0a20 2020 2020 2020  ype=int).       
+00002c00: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00002c10: 6e64 293a 0a20 2020 2020 2020 2020 2020  nd):.           
+00002c20: 206c 202a 3d20 6172 7231 2e73 6861 7065   l *= arr1.shape
+00002c30: 5b69 5d20 2023 206e 6f71 613a 4537 3431  [i]  # noqa:E741
+00002c40: 0a20 2020 2020 2020 2020 2020 2064 696d  .            dim
+00002c50: 5b69 5d20 3d20 6172 7231 2e73 6861 7065  [i] = arr1.shape
+00002c60: 5b69 5d0a 2020 2020 2020 2020 636f 7272  [i].        corr
+00002c70: 203d 2030 2e30 0a20 2020 2020 2020 206e   = 0.0.        n
+00002c80: 756d 6572 203d 2030 2e30 0a20 2020 2020  umer = 0.0.     
+00002c90: 2020 2076 6172 3120 3d20 302e 300a 2020     var1 = 0.0.  
+00002ca0: 2020 2020 2020 7661 7232 203d 2030 2e30        var2 = 0.0
+00002cb0: 0a20 2020 2020 2020 2069 6620 6e64 203d  .        if nd =
+00002cc0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00002cd0: 2066 6f72 207a 2069 6e20 7261 6e67 6528   for z in range(
+00002ce0: 6469 6d5b 305d 293a 0a20 2020 2020 2020  dim[0]):.       
+00002cf0: 2020 2020 2020 2020 206e 756d 6572 202b           numer +
+00002d00: 3d20 6172 7231 5b7a 5d2a 6172 7232 5b7a  = arr1[z]*arr2[z
+00002d10: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00002d20: 2020 7661 7231 202b 3d20 6172 7231 5b7a    var1 += arr1[z
+00002d30: 5d2a 2a32 0a20 2020 2020 2020 2020 2020  ]**2.           
+00002d40: 2020 2020 2076 6172 3220 2b3d 2061 7272       var2 += arr
+00002d50: 325b 7a5d 2a2a 320a 2020 2020 2020 2020  2[z]**2.        
+00002d60: 656c 6966 206e 6420 3d3d 2033 3a0a 2020  elif nd == 3:.  
+00002d70: 2020 2020 2020 2020 2020 666f 7220 7a20            for z 
+00002d80: 696e 2072 616e 6765 2864 696d 5b30 5d29  in range(dim[0])
+00002d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00002da0: 2020 666f 7220 7920 696e 2072 616e 6765    for y in range
+00002db0: 2864 696d 5b31 5d29 3a0a 2020 2020 2020  (dim[1]):.      
+00002dc0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00002dd0: 7220 7820 696e 2072 616e 6765 2864 696d  r x in range(dim
+00002de0: 5b32 5d29 3a0a 2020 2020 2020 2020 2020  [2]):.          
+00002df0: 2020 2020 2020 2020 2020 2020 2020 6e75                nu
+00002e00: 6d65 7220 2b3d 2061 7272 315b 7a2c 2079  mer += arr1[z, y
+00002e10: 2c20 785d 2a61 7272 325b 7a2c 2079 2c20  , x]*arr2[z, y, 
+00002e20: 785d 0a20 2020 2020 2020 2020 2020 2020  x].             
+00002e30: 2020 2020 2020 2020 2020 2076 6172 3120             var1 
+00002e40: 2b3d 2061 7272 315b 7a2c 2079 2c20 785d  += arr1[z, y, x]
+00002e50: 2a2a 320a 2020 2020 2020 2020 2020 2020  **2.            
+00002e60: 2020 2020 2020 2020 2020 2020 7661 7232              var2
+00002e70: 202b 3d20 6172 7232 5b7a 2c20 792c 2078   += arr2[z, y, x
+00002e80: 5d2a 2a32 0a20 2020 2020 2020 2063 6f72  ]**2.        cor
+00002e90: 7220 3d20 6e75 6d65 722f 6d61 7468 2e73  r = numer/math.s
+00002ea0: 7172 7428 7661 7231 2a76 6172 3229 0a20  qrt(var1*var2). 
+00002eb0: 2020 2020 2020 2063 6f72 7220 3d20 6d69         corr = mi
+00002ec0: 6e28 312e 302c 2063 6f72 7229 0a20 2020  n(1.0, corr).   
+00002ed0: 2020 2020 2063 6f72 7220 3d20 6d61 7828       corr = max(
+00002ee0: 2d31 2e30 2c20 636f 7272 290a 2020 2020  -1.0, corr).    
+00002ef0: 2020 2020 7265 7475 726e 2063 6f72 720a      return corr.
+00002f00: 0a20 2020 2064 6566 2043 4343 5f6d 6170  .    def CCC_map
+00002f10: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+00002f20: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+00002f30: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
+00002f40: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+00002f50: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
+00002f60: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
+00002f70: 6f6c 643d 302e 302c 0a20 2020 2020 2020  old=0.0,.       
+00002f80: 2020 2020 206d 6170 5f70 726f 6265 5f74       map_probe_t
+00002f90: 6872 6573 686f 6c64 3d30 2e30 2c0a 2020  hreshold=0.0,.  
+00002fa0: 2020 2020 2020 2020 2020 6d6f 6465 3d31            mode=1
+00002fb0: 2c0a 2020 2020 2020 2020 2020 2020 6d65  ,.            me
+00002fc0: 616e 4469 7374 3d46 616c 7365 2c0a 2020  anDist=False,.  
+00002fd0: 2020 2020 2020 2020 2020 636d 6f64 653d            cmode=
+00002fe0: 5472 7565 2c0a 2020 2020 293a 0a20 2020  True,.    ):.   
+00002ff0: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00003000: 6520 6372 6f73 732d 636f 7272 656c 6174  e cross-correlat
+00003010: 696f 6e20 6265 7477 6565 6e20 7477 6f20  ion between two 
+00003020: 4d61 7020 696e 7374 616e 6365 7320 7573  Map instances us
+00003030: 696e 6720 6f6e 6520 6f66 0a20 2020 2020  ing one of.     
+00003040: 2020 2033 206d 6574 686f 6473 2e0a 0a20     3 methods... 
+00003050: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+00003060: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
+00003070: 6765 742c 206d 6170 5f70 726f 6265 3a20  get, map_probe: 
+00003080: 454d 4d61 7020 696e 7374 616e 6365 2074  EMMap instance t
+00003090: 6f20 636f 6d70 6172 652e 0a0a 2020 2020  o compare...    
+000030a0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+000030b0: 6574 5f74 6872 6573 686f 6c64 2c20 6d61  et_threshold, ma
+000030c0: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
+000030d0: 643a 0a20 2020 2020 2020 2020 2020 2020  d:.             
+000030e0: 2020 204d 6170 2074 6872 6573 686f 6c64     Map threshold
+000030f0: 2c20 7573 6564 2074 6f20 7365 6c65 6374  , used to select
+00003100: 2070 6978 656c 7320 7768 656e 2063 616c   pixels when cal
+00003110: 6375 6c61 7469 6e67 2043 4343 2077 6974  culating CCC wit
+00003120: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
+00003130: 2020 6d65 7468 6f64 2032 2e20 4966 206e    method 2. If n
+00003140: 6f74 2073 7065 6369 6669 6564 2c20 7769  ot specified, wi
+00003150: 6c6c 2062 6520 6361 6c63 756c 6174 6564  ll be calculated
+00003160: 2075 7369 6e67 0a20 2020 2020 2020 2020   using.         
+00003170: 2020 2020 2020 203a 6d65 7468 3a60 6361         :meth:`ca
+00003180: 6c63 756c 6174 655f 6d61 705f 7468 7265  lculate_map_thre
+00003190: 7368 6f6c 6420 3c54 454d 5079 2e70 726f  shold <TEMPy.pro
+000031a0: 7465 696e 2e73 636f 7269 6e67 5f66 756e  tein.scoring_fun
+000031b0: 6374 696f 6e73 2e53 636f 7269 6e67 4675  ctions.ScoringFu
+000031c0: 6e63 7469 6f6e 732e 6361 6c63 756c 6174  nctions.calculat
+000031d0: 655f 6d61 705f 7468 7265 7368 6f6c 643e  e_map_threshold>
+000031e0: 6020 2023 206e 6f71 613a 4535 3031 0a0a  `  # noqa:E501..
+000031f0: 2020 2020 2020 2020 2020 2020 6d6f 6465              mode
+00003200: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003210: 2020 312e 2043 4343 2063 616c 6375 6c61    1. CCC calcula
+00003220: 7469 6f6e 206f 6e20 616c 6c20 7069 7865  tion on all pixe
+00003230: 6c73 2069 6e20 6d61 700a 2020 2020 2020  ls in map.      
+00003240: 2020 2020 2020 2020 2020 322e 2043 4343            2. CCC
+00003250: 206f 6e6c 7920 6f6e 2070 6978 656c 7320   only on pixels 
+00003260: 7769 7468 2064 656e 7369 7479 2076 616c  with density val
+00003270: 7565 2061 626f 7665 2072 6573 7065 6374  ue above respect
+00003280: 6976 6520 7468 7265 7368 6f6c 6473 0a20  ive thresholds. 
+00003290: 2020 2020 2020 2020 2020 2020 2020 2033                 3
+000032a0: 2e20 4343 4320 6f6e 6c79 206f 6e20 7069  . CCC only on pi
+000032b0: 7865 6c73 2077 6974 6869 6e20 7468 6520  xels within the 
+000032c0: 6d61 736b 0a0a 2020 2020 2020 2020 2020  mask..          
+000032d0: 2020 6d65 616e 4469 7374 3a20 5472 7565    meanDist: True
+000032e0: 2069 6620 7468 6520 6465 7669 6174 696f   if the deviatio
+000032f0: 6e20 6672 6f6d 206d 6561 6e20 6e65 6564  n from mean need
+00003300: 7320 746f 2062 6520 6361 6c63 756c 6174  s to be calculat
+00003310: 6564 0a0a 2020 2020 2020 2020 2020 2020  ed..            
+00003320: 636d 6f64 653a 2049 6620 5472 7565 2c20  cmode: If True, 
+00003330: 7573 6520 7075 7265 2070 7974 686f 6e20  use pure python 
+00003340: 696d 706c 656d 656e 7461 7469 6f6e 2074  implementation t
+00003350: 6f20 6361 6c63 756c 6174 6520 4343 432e  o calculate CCC.
+00003360: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003370: 2049 6620 4661 6c73 652c 2075 7365 206e   If False, use n
+00003380: 756d 7079 2069 6d70 6c65 6d65 6e74 6174  umpy implementat
+00003390: 696f 6e2e 0a0a 2020 2020 2020 2020 5265  ion...        Re
+000033a0: 7475 726e 733a 0a0a 2020 2020 2020 2020  turns:..        
+000033b0: 2020 2020 4343 432c 2070 6572 6365 6e74      CCC, percent
+000033c0: 6167 655f 6f76 6572 6c61 703a 2054 6865  age_overlap: The
+000033d0: 2063 726f 7373 2063 6f72 7265 6c61 7469   cross correlati
+000033e0: 6f6e 2073 636f 7265 2061 6e64 2074 6865  on score and the
+000033f0: 0a20 2020 2020 2020 2020 2020 2070 6572  .            per
+00003400: 6365 6e74 6167 6520 6f76 6572 6c61 7020  centage overlap 
+00003410: 6265 7477 6565 6e20 7468 6520 7477 6f20  between the two 
+00003420: 696e 7075 7420 6d61 7073 0a0a 2020 2020  input maps..    
+00003430: 2020 2020 5261 6973 6573 3a0a 0a20 2020      Raises:..   
+00003440: 2020 2020 2020 2020 2057 6172 6e69 6e67           Warning
+00003450: 3a20 5769 6c6c 2072 6574 7572 6e20 2d31  : Will return -1
+00003460: 2c20 3020 6966 2074 6865 2074 776f 2069  , 0 if the two i
+00003470: 6e70 7574 206d 6170 7320 646f 206e 6f74  nput maps do not
+00003480: 206d 6174 6368 0a20 2020 2020 2020 2020   match.         
+00003490: 2020 2020 2020 2073 6861 7065 2c20 7069         shape, pi
+000034a0: 7865 6c20 7369 7a65 2061 6e64 206f 7269  xel size and ori
+000034b0: 6769 6e2e 0a20 2020 2020 2020 2022 2222  gin..        """
+000034c0: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+000034d0: 2e6d 6170 436f 6d70 6172 6973 6f6e 286d  .mapComparison(m
+000034e0: 6170 5f74 6172 6765 742c 206d 6170 5f70  ap_target, map_p
+000034f0: 726f 6265 293a 0a20 2020 2020 2020 2020  robe):.         
+00003500: 2020 2069 6620 6e6f 7420 6d6f 6465 203d     if not mode =
+00003510: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00003520: 2020 2020 2069 6620 6d61 705f 7461 7267       if map_targ
+00003530: 6574 5f74 6872 6573 686f 6c64 203d 3d20  et_threshold == 
+00003540: 3020 616e 6420 6d61 705f 7072 6f62 655f  0 and map_probe_
+00003550: 7468 7265 7368 6f6c 6420 3d3d 2030 3a0a  threshold == 0:.
+00003560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003570: 2020 2020 6d61 705f 7461 7267 6574 5f74      map_target_t
+00003580: 6872 6573 686f 6c64 203d 2073 656c 662e  hreshold = self.
+00003590: 6361 6c63 756c 6174 655f 6d61 705f 7468  calculate_map_th
+000035a0: 7265 7368 6f6c 6428 0a20 2020 2020 2020  reshold(.       
+000035b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035c0: 206d 6170 5f74 6172 6765 740a 2020 2020   map_target.    
+000035d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000035e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000035f0: 2020 2020 2020 6d61 705f 7072 6f62 655f        map_probe_
+00003600: 7468 7265 7368 6f6c 6420 3d20 7365 6c66  threshold = self
+00003610: 2e63 616c 6375 6c61 7465 5f6d 6170 5f74  .calculate_map_t
+00003620: 6872 6573 686f 6c64 280a 2020 2020 2020  hreshold(.      
+00003630: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003640: 2020 6d61 705f 7072 6f62 650a 2020 2020    map_probe.    
+00003650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003660: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00003670: 2020 6269 6e5f 6d61 7031 203d 206d 6170    bin_map1 = map
+00003680: 5f74 6172 6765 742e 6675 6c6c 4d61 7020  _target.fullMap 
+00003690: 3e20 666c 6f61 7428 6d61 705f 7461 7267  > float(map_targ
+000036a0: 6574 5f74 6872 6573 686f 6c64 290a 2020  et_threshold).  
+000036b0: 2020 2020 2020 2020 2020 2020 2020 6269                bi
+000036c0: 6e5f 6d61 7032 203d 206d 6170 5f70 726f  n_map2 = map_pro
+000036d0: 6265 2e66 756c 6c4d 6170 203e 2066 6c6f  be.fullMap > flo
+000036e0: 6174 286d 6170 5f70 726f 6265 5f74 6872  at(map_probe_thr
+000036f0: 6573 686f 6c64 290a 2020 2020 2020 2020  eshold).        
+00003700: 2020 2020 2020 2020 6d69 6e69 6d20 3d20          minim = 
+00003710: 6e70 2e73 756d 2862 696e 5f6d 6170 3129  np.sum(bin_map1)
+00003720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003730: 206d 696e 696d 3220 3d20 6e70 2e73 756d   minim2 = np.sum
+00003740: 2862 696e 5f6d 6170 3229 0a20 2020 2020  (bin_map2).     
+00003750: 2020 2020 2020 2020 2020 2069 6620 6d69             if mi
+00003760: 6e69 6d32 203c 206d 696e 696d 3a0a 2020  nim2 < minim:.  
+00003770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003780: 2020 6d69 6e69 6d20 3d20 6d69 6e69 6d32    minim = minim2
+00003790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000037a0: 206d 6173 6b5f 6172 7261 7920 3d20 2862   mask_array = (b
+000037b0: 696e 5f6d 6170 3120 2a20 6269 6e5f 6d61  in_map1 * bin_ma
+000037c0: 7032 2920 3e20 300a 2020 2020 2020 2020  p2) > 0.        
+000037d0: 2020 2020 2020 2020 6966 206e 6f74 206d          if not m
+000037e0: 696e 696d 203d 3d20 302e 303a 0a20 2020  inim == 0.0:.   
+000037f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003800: 2070 6572 635f 6f76 7220 3d20 666c 6f61   perc_ovr = floa
+00003810: 7428 6e70 2e73 756d 286d 6173 6b5f 6172  t(np.sum(mask_ar
+00003820: 7261 7929 2920 2f20 6d69 6e69 6d0a 2020  ray)) / minim.  
+00003830: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00003840: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00003850: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00003860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003870: 2020 2020 2020 2027 4e6f 206d 6170 206f         'No map o
+00003880: 7665 726c 6170 2028 4372 6f73 7320 636f  verlap (Cross co
+00003890: 7272 656c 6174 696f 6e20 7363 6f72 6529  rrelation score)
+000038a0: 2c20 6578 6974 696e 6720 270a 2020 2020  , exiting '.    
+000038b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000038c0: 2020 2020 2773 636f 7265 2063 616c 6375      'score calcu
+000038d0: 6c61 7469 6f6e 2e2e 270a 2020 2020 2020  lation..'.      
+000038e0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000038f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003900: 2020 2020 7265 7475 726e 202d 312e 302c      return -1.0,
+00003910: 2030 2e30 0a20 2020 2020 2020 2020 2020   0.0.           
+00003920: 2020 2020 2069 6620 7065 7263 5f6f 7672       if perc_ovr
+00003930: 203c 2030 2e30 323a 0a20 2020 2020 2020   < 0.02:.       
+00003940: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00003950: 7572 6e20 2d31 2e30 2c20 302e 300a 2020  urn -1.0, 0.0.  
+00003960: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00003970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003980: 7065 7263 5f6f 7672 203d 2031 2e30 0a0a  perc_ovr = 1.0..
+00003990: 2020 2020 2020 2020 2020 2020 2320 6361              # ca
+000039a0: 6c63 756c 6174 6520 4343 4320 7769 7468  lculate CCC with
+000039b0: 696e 2076 6f6c 756d 6520 6f66 206f 7665  in volume of ove
+000039c0: 726c 6170 0a20 2020 2020 2020 2020 2020  rlap.           
+000039d0: 2069 6620 6d6f 6465 203d 3d20 333a 0a20   if mode == 3:. 
+000039e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000039f0: 6620 6e70 2e73 756d 286d 6173 6b5f 6172  f np.sum(mask_ar
+00003a00: 7261 7929 203d 3d20 303a 0a20 2020 2020  ray) == 0:.     
+00003a10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00003a20: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
+00003a30: 2020 2020 2020 2020 2020 2020 2020 274e                'N
+00003a40: 6f20 6d61 7020 6f76 6572 6c61 7020 2843  o map overlap (C
+00003a50: 726f 7373 2063 6f72 7265 6c61 7469 6f6e  ross correlation
+00003a60: 2073 636f 7265 292c 2027 0a20 2020 2020   score), '.     
+00003a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003a80: 2020 2027 6578 6974 696e 6720 7363 6f72     'exiting scor
+00003a90: 6520 6361 6c63 756c 6174 696f 6e2e 2e27  e calculation..'
+00003aa0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003ab0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00003ac0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00003ad0: 6e20 2d31 2e30 2c20 302e 300a 2020 2020  n -1.0, 0.0.    
+00003ae0: 2020 2020 2020 2020 2020 2020 6d61 7031              map1
+00003af0: 5f6d 6173 6b20 3d20 6d61 705f 7461 7267  _mask = map_targ
+00003b00: 6574 2e66 756c 6c4d 6170 5b6d 6173 6b5f  et.fullMap[mask_
+00003b10: 6172 7261 795d 0a20 2020 2020 2020 2020  array].         
+00003b20: 2020 2020 2020 206d 6170 325f 6d61 736b         map2_mask
+00003b30: 203d 206d 6170 5f70 726f 6265 2e66 756c   = map_probe.ful
+00003b40: 6c4d 6170 5b6d 6173 6b5f 6172 7261 795d  lMap[mask_array]
+00003b50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003b60: 2069 6620 6d65 616e 4469 7374 3a0a 2020   if meanDist:.  
+00003b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003b80: 2020 6d61 7031 5f6d 6173 6b20 3d20 6d61    map1_mask = ma
+00003b90: 7031 5f6d 6173 6b20 2d20 6e70 2e6d 6561  p1_mask - np.mea
+00003ba0: 6e28 6d61 7031 5f6d 6173 6b29 0a20 2020  n(map1_mask).   
+00003bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003bc0: 206d 6170 325f 6d61 736b 203d 206d 6170   map2_mask = map
+00003bd0: 325f 6d61 736b 202d 206e 702e 6d65 616e  2_mask - np.mean
+00003be0: 286d 6170 325f 6d61 736b 290a 2020 2020  (map2_mask).    
+00003bf0: 2020 2020 2020 2020 2020 2020 6966 2063              if c
+00003c00: 6d6f 6465 3a0a 2020 2020 2020 2020 2020  mode:.          
+00003c10: 2020 2020 2020 2020 2020 636f 7272 203d            corr =
+00003c20: 2073 656c 662e 5f43 4343 5f63 616c 6328   self._CCC_calc(
+00003c30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003c40: 2020 2020 2020 2020 206d 6170 315f 6d61           map1_ma
+00003c50: 736b 2e66 6c61 7474 656e 2829 2c0a 2020  sk.flatten(),.  
+00003c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003c70: 2020 2020 2020 6d61 7032 5f6d 6173 6b2e        map2_mask.
+00003c80: 666c 6174 7465 6e28 292c 0a20 2020 2020  flatten(),.     
+00003c90: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00003ca0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00003cb0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00003cc0: 2020 2020 2020 2020 2020 2063 6f72 7220             corr 
+00003cd0: 3d20 4e6f 6e65 0a20 2020 2020 2020 2020  = None.         
+00003ce0: 2020 2020 2020 2069 6620 636f 7272 2069         if corr i
+00003cf0: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
+00003d00: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00003d10: 726e 2028 0a20 2020 2020 2020 2020 2020  rn (.           
+00003d20: 2020 2020 2020 2020 2020 2020 2028 0a20               (. 
+00003d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d40: 2020 2020 2020 2020 2020 206e 702e 7375             np.su
+00003d50: 6d28 6d61 7031 5f6d 6173 6b20 2a20 6d61  m(map1_mask * ma
+00003d60: 7032 5f6d 6173 6b29 202f 0a20 2020 2020  p2_mask) /.     
+00003d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003d80: 2020 2020 2020 206e 702e 7371 7274 280a         np.sqrt(.
+00003d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00003da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003db0: 2020 2020 6d61 7031 5f6d 6173 6b2e 666c      map1_mask.fl
-00003dc0: 6174 7465 6e28 292c 0a20 2020 2020 2020  atten(),.       
+00003db0: 6e70 2e73 756d 286e 702e 7371 7561 7265  np.sum(np.square
+00003dc0: 286d 6170 315f 6d61 736b 2929 202a 0a20  (map1_mask)) *. 
 00003dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003de0: 206d 6170 325f 6d61 736b 2e66 6c61 7474   map2_mask.flatt
-00003df0: 656e 2829 2c0a 2020 2020 2020 2020 2020  en(),.          
-00003e00: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003e10: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00003e20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00003e30: 2020 2020 2020 636f 7272 203d 204e 6f6e        corr = Non
-00003e40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00003e50: 2020 6966 2063 6f72 7220 6973 204e 6f6e    if corr is Non
-00003e60: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00003e70: 2020 2020 2020 2072 6574 7572 6e20 280a         return (.
-00003e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003e90: 2020 2020 2020 2020 280a 2020 2020 2020          (.      
-00003ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003eb0: 2020 2020 2020 6e70 2e73 756d 286d 6170        np.sum(map
-00003ec0: 315f 6d61 736b 202a 206d 6170 325f 6d61  1_mask * map2_ma
-00003ed0: 736b 2920 2f0a 2020 2020 2020 2020 2020  sk) /.          
-00003ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003ef0: 2020 6e70 2e73 7172 7428 0a20 2020 2020    np.sqrt(.     
-00003f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f10: 2020 2020 2020 2020 2020 206e 702e 7375             np.su
-00003f20: 6d28 6e70 2e73 7175 6172 6528 6d61 7031  m(np.square(map1
-00003f30: 5f6d 6173 6b29 2920 2a0a 2020 2020 2020  _mask)) *.      
-00003f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f50: 2020 2020 2020 2020 2020 6e70 2e73 756d            np.sum
-00003f60: 286e 702e 7371 7561 7265 286d 6170 325f  (np.square(map2_
-00003f70: 6d61 736b 2929 0a20 2020 2020 2020 2020  mask)).         
-00003f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003f90: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00003fa0: 2020 2020 2020 2020 2020 2020 2029 2c0a               ),.
-00003fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003fc0: 2020 2020 2020 2020 7065 7263 5f6f 7672          perc_ovr
-00003fd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003fe0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00003ff0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00003de0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00003df0: 702e 7375 6d28 6e70 2e73 7175 6172 6528  p.sum(np.square(
+00003e00: 6d61 7032 5f6d 6173 6b29 290a 2020 2020  map2_mask)).    
+00003e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e20: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00003e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003e40: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+00003e50: 2020 2020 2020 2020 2020 2020 2070 6572               per
+00003e60: 635f 6f76 720a 2020 2020 2020 2020 2020  c_ovr.          
+00003e70: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003e80: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00003e90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00003ea0: 2020 2020 2020 7265 7475 726e 2063 6f72        return cor
+00003eb0: 722c 2070 6572 635f 6f76 720a 0a20 2020  r, perc_ovr..   
+00003ec0: 2020 2020 2020 2020 2023 2063 616c 6375           # calcu
+00003ed0: 6c61 7465 2043 4343 2066 6f72 2063 6f6e  late CCC for con
+00003ee0: 746f 7572 6564 206d 6170 7320 6261 7365  toured maps base
+00003ef0: 6420 6f6e 2074 6872 6573 686f 6c64 0a20  d on threshold. 
+00003f00: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00003f10: 6d6f 6465 203d 3d20 323a 0a20 2020 2020  mode == 2:.     
+00003f20: 2020 2020 2020 2020 2020 206d 6170 315f             map1_
+00003f30: 6d61 736b 203d 206d 6170 5f74 6172 6765  mask = map_targe
+00003f40: 742e 6675 6c6c 4d61 7020 2a20 6269 6e5f  t.fullMap * bin_
+00003f50: 6d61 7031 0a20 2020 2020 2020 2020 2020  map1.           
+00003f60: 2020 2020 206d 6170 325f 6d61 736b 203d       map2_mask =
+00003f70: 206d 6170 5f70 726f 6265 2e66 756c 6c4d   map_probe.fullM
+00003f80: 6170 202a 2062 696e 5f6d 6170 320a 2020  ap * bin_map2.  
+00003f90: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00003fa0: 206d 6561 6e44 6973 743a 0a20 2020 2020   meanDist:.     
+00003fb0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00003fc0: 6170 315f 6d61 736b 203d 2028 0a20 2020  ap1_mask = (.   
+00003fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003fe0: 2020 2020 2020 2020 206d 6170 315f 6d61           map1_ma
+00003ff0: 736b 202d 0a20 2020 2020 2020 2020 2020  sk -.           
 00004000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004010: 2072 6574 7572 6e20 636f 7272 2c20 7065   return corr, pe
-00004020: 7263 5f6f 7672 0a0a 2020 2020 2020 2020  rc_ovr..        
-00004030: 2020 2020 2320 6361 6c63 756c 6174 6520      # calculate 
-00004040: 4343 4320 666f 7220 636f 6e74 6f75 7265  CCC for contoure
-00004050: 6420 6d61 7073 2062 6173 6564 206f 6e20  d maps based on 
-00004060: 7468 7265 7368 6f6c 640a 2020 2020 2020  threshold.      
-00004070: 2020 2020 2020 656c 6966 206d 6f64 6520        elif mode 
-00004080: 3d3d 2032 3a0a 2020 2020 2020 2020 2020  == 2:.          
-00004090: 2020 2020 2020 6d61 7031 5f6d 6173 6b20        map1_mask 
-000040a0: 3d20 6d61 705f 7461 7267 6574 2e66 756c  = map_target.ful
-000040b0: 6c4d 6170 202a 2062 696e 5f6d 6170 310a  lMap * bin_map1.
-000040c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000040d0: 6d61 7032 5f6d 6173 6b20 3d20 6d61 705f  map2_mask = map_
-000040e0: 7072 6f62 652e 6675 6c6c 4d61 7020 2a20  probe.fullMap * 
-000040f0: 6269 6e5f 6d61 7032 0a20 2020 2020 2020  bin_map2.       
-00004100: 2020 2020 2020 2020 2069 6620 6d65 616e           if mean
-00004110: 4469 7374 3a0a 2020 2020 2020 2020 2020  Dist:.          
-00004120: 2020 2020 2020 2020 2020 6d61 7031 5f6d            map1_m
-00004130: 6173 6b20 3d20 280a 2020 2020 2020 2020  ask = (.        
-00004140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004150: 2020 2020 6d61 7031 5f6d 6173 6b20 2d0a      map1_mask -.
-00004160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004170: 2020 2020 2020 2020 2020 2020 6e70 2e6d              np.m
-00004180: 6561 6e28 6d61 705f 7461 7267 6574 2e66  ean(map_target.f
-00004190: 756c 6c4d 6170 5b62 696e 5f6d 6170 315d  ullMap[bin_map1]
-000041a0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000041b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000041c0: 2020 2020 2020 2020 2020 2020 6d61 7032              map2
-000041d0: 5f6d 6173 6b20 3d20 280a 2020 2020 2020  _mask = (.      
-000041e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000041f0: 2020 2020 2020 6d61 7032 5f6d 6173 6b20        map2_mask 
-00004200: 2d0a 2020 2020 2020 2020 2020 2020 2020  -.              
-00004210: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00004220: 2e6d 6561 6e28 6d61 705f 7072 6f62 652e  .mean(map_probe.
-00004230: 6675 6c6c 4d61 705b 6269 6e5f 6d61 7032  fullMap[bin_map2
-00004240: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00004250: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00004260: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00004270: 315f 6d61 736b 203d 206d 6170 315f 6d61  1_mask = map1_ma
-00004280: 736b 202a 2062 696e 5f6d 6170 310a 2020  sk * bin_map1.  
-00004290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000042a0: 2020 6d61 7032 5f6d 6173 6b20 3d20 6d61    map2_mask = ma
-000042b0: 7032 5f6d 6173 6b20 2a20 6269 6e5f 6d61  p2_mask * bin_ma
-000042c0: 7032 0a20 2020 2020 2020 2020 2020 2020  p2.             
-000042d0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-000042e0: 2020 2020 2020 2020 2020 2020 206d 6170               map
-000042f0: 315f 6d61 736b 203d 206d 6170 5f74 6172  1_mask = map_tar
-00004300: 6765 742e 6675 6c6c 4d61 7020 2a20 6269  get.fullMap * bi
-00004310: 6e5f 6d61 7031 0a20 2020 2020 2020 2020  n_map1.         
-00004320: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
-00004330: 6d61 736b 203d 206d 6170 5f70 726f 6265  mask = map_probe
-00004340: 2e66 756c 6c4d 6170 202a 2062 696e 5f6d  .fullMap * bin_m
-00004350: 6170 320a 2020 2020 2020 2020 2020 2020  ap2.            
-00004360: 2020 2020 6966 2063 6d6f 6465 3a0a 2020      if cmode:.  
-00004370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004380: 2020 636f 7272 203d 2073 656c 662e 5f43    corr = self._C
-00004390: 4343 5f63 616c 6328 6d61 7031 5f6d 6173  CC_calc(map1_mas
-000043a0: 6b2c 206d 6170 325f 6d61 736b 290a 2020  k, map2_mask).  
-000043b0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000043c0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000043d0: 2020 2020 2020 2020 636f 7272 203d 204e          corr = N
-000043e0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-000043f0: 2020 2020 6966 2063 6f72 7220 6973 204e      if corr is N
-00004400: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00004410: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004420: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00004430: 2020 2020 2020 2020 2020 280a 2020 2020            (.    
-00004440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004450: 2020 2020 2020 2020 6e70 2e73 756d 286d          np.sum(m
-00004460: 6170 315f 6d61 736b 202a 206d 6170 325f  ap1_mask * map2_
-00004470: 6d61 736b 2920 2f0a 2020 2020 2020 2020  mask) /.        
-00004480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004490: 2020 2020 6e70 2e73 7172 7428 0a20 2020      np.sqrt(.   
-000044a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044b0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-000044c0: 7375 6d28 6e70 2e73 7175 6172 6528 6d61  sum(np.square(ma
-000044d0: 7031 5f6d 6173 6b29 2920 2a0a 2020 2020  p1_mask)) *.    
-000044e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000044f0: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
-00004500: 756d 286e 702e 7371 7561 7265 286d 6170  um(np.square(map
-00004510: 325f 6d61 736b 2929 0a20 2020 2020 2020  2_mask)).       
-00004520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004530: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00004540: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00004550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00004560: 2020 2020 2020 2020 2020 7065 7263 5f6f            perc_o
-00004570: 7672 0a20 2020 2020 2020 2020 2020 2020  vr.             
-00004580: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00004590: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000045a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000045b0: 2020 2072 6574 7572 6e20 636f 7272 2c20     return corr, 
-000045c0: 7065 7263 5f6f 7672 0a20 2020 2020 2020  perc_ovr.       
-000045d0: 2020 2020 2023 2063 616c 6375 6c61 7465       # calculate
-000045e0: 206f 6e20 7468 6520 636f 6d70 6c65 7465   on the complete
-000045f0: 206d 6170 0a20 2020 2020 2020 2020 2020   map.           
-00004600: 2069 6620 6d65 616e 4469 7374 3a0a 2020   if meanDist:.  
-00004610: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00004620: 2063 6d6f 6465 3a0a 2020 2020 2020 2020   cmode:.        
-00004630: 2020 2020 2020 2020 2020 2020 636f 7272              corr
-00004640: 203d 2073 656c 662e 5f43 4343 5f63 616c   = self._CCC_cal
-00004650: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
-00004660: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-00004670: 6172 6765 742e 6675 6c6c 4d61 7020 2d20  arget.fullMap - 
-00004680: 6e70 2e6d 6561 6e28 6d61 705f 7461 7267  np.mean(map_targ
-00004690: 6574 2e66 756c 6c4d 6170 292c 0a20 2020  et.fullMap),.   
+00004010: 206e 702e 6d65 616e 286d 6170 5f74 6172   np.mean(map_tar
+00004020: 6765 742e 6675 6c6c 4d61 705b 6269 6e5f  get.fullMap[bin_
+00004030: 6d61 7031 5d29 0a20 2020 2020 2020 2020  map1]).         
+00004040: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00004050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004060: 206d 6170 325f 6d61 736b 203d 2028 0a20   map2_mask = (. 
+00004070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004080: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
+00004090: 6d61 736b 202d 0a20 2020 2020 2020 2020  mask -.         
+000040a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000040b0: 2020 206e 702e 6d65 616e 286d 6170 5f70     np.mean(map_p
+000040c0: 726f 6265 2e66 756c 6c4d 6170 5b62 696e  robe.fullMap[bin
+000040d0: 5f6d 6170 325d 290a 2020 2020 2020 2020  _map2]).        
+000040e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000040f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004100: 2020 6d61 7031 5f6d 6173 6b20 3d20 6d61    map1_mask = ma
+00004110: 7031 5f6d 6173 6b20 2a20 6269 6e5f 6d61  p1_mask * bin_ma
+00004120: 7031 0a20 2020 2020 2020 2020 2020 2020  p1.             
+00004130: 2020 2020 2020 206d 6170 325f 6d61 736b         map2_mask
+00004140: 203d 206d 6170 325f 6d61 736b 202a 2062   = map2_mask * b
+00004150: 696e 5f6d 6170 320a 2020 2020 2020 2020  in_map2.        
+00004160: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00004170: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004180: 2020 6d61 7031 5f6d 6173 6b20 3d20 6d61    map1_mask = ma
+00004190: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
+000041a0: 202a 2062 696e 5f6d 6170 310a 2020 2020   * bin_map1.    
+000041b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000041c0: 6d61 7032 5f6d 6173 6b20 3d20 6d61 705f  map2_mask = map_
+000041d0: 7072 6f62 652e 6675 6c6c 4d61 7020 2a20  probe.fullMap * 
+000041e0: 6269 6e5f 6d61 7032 0a20 2020 2020 2020  bin_map2.       
+000041f0: 2020 2020 2020 2020 2069 6620 636d 6f64           if cmod
+00004200: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00004210: 2020 2020 2020 2063 6f72 7220 3d20 7365         corr = se
+00004220: 6c66 2e5f 4343 435f 6361 6c63 286d 6170  lf._CCC_calc(map
+00004230: 315f 6d61 736b 2c20 6d61 7032 5f6d 6173  1_mask, map2_mas
+00004240: 6b29 0a20 2020 2020 2020 2020 2020 2020  k).             
+00004250: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00004260: 2020 2020 2020 2020 2020 2020 2063 6f72               cor
+00004270: 7220 3d20 4e6f 6e65 0a20 2020 2020 2020  r = None.       
+00004280: 2020 2020 2020 2020 2069 6620 636f 7272           if corr
+00004290: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+000042a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000042b0: 7475 726e 2028 0a20 2020 2020 2020 2020  turn (.         
+000042c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000042d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000042e0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+000042f0: 7375 6d28 6d61 7031 5f6d 6173 6b20 2a20  sum(map1_mask * 
+00004300: 6d61 7032 5f6d 6173 6b29 202f 0a20 2020  map2_mask) /.   
+00004310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004320: 2020 2020 2020 2020 206e 702e 7371 7274           np.sqrt
+00004330: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004350: 2020 6e70 2e73 756d 286e 702e 7371 7561    np.sum(np.squa
+00004360: 7265 286d 6170 315f 6d61 736b 2929 202a  re(map1_mask)) *
+00004370: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004390: 206e 702e 7375 6d28 6e70 2e73 7175 6172   np.sum(np.squar
+000043a0: 6528 6d61 7032 5f6d 6173 6b29 290a 2020  e(map2_mask)).  
+000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043c0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000043d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043e0: 2020 2020 292c 0a20 2020 2020 2020 2020      ),.         
+000043f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00004400: 6572 635f 6f76 720a 2020 2020 2020 2020  erc_ovr.        
+00004410: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004420: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00004430: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00004440: 2020 2020 2020 2020 7265 7475 726e 2063          return c
+00004450: 6f72 722c 2070 6572 635f 6f76 720a 2020  orr, perc_ovr.  
+00004460: 2020 2020 2020 2020 2020 2320 6361 6c63            # calc
+00004470: 756c 6174 6520 6f6e 2074 6865 2063 6f6d  ulate on the com
+00004480: 706c 6574 6520 6d61 700a 2020 2020 2020  plete map.      
+00004490: 2020 2020 2020 6966 206d 6561 6e44 6973        if meanDis
+000044a0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+000044b0: 2020 2069 6620 636d 6f64 653a 0a20 2020     if cmode:.   
+000044c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000044d0: 2063 6f72 7220 3d20 7365 6c66 2e5f 4343   corr = self._CC
+000044e0: 435f 6361 6c63 280a 2020 2020 2020 2020  C_calc(.        
+000044f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004500: 6d61 705f 7461 7267 6574 2e66 756c 6c4d  map_target.fullM
+00004510: 6170 202d 206e 702e 6d65 616e 286d 6170  ap - np.mean(map
+00004520: 5f74 6172 6765 742e 6675 6c6c 4d61 7029  _target.fullMap)
+00004530: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00004540: 2020 2020 2020 2020 2020 6d61 705f 7072            map_pr
+00004550: 6f62 652e 6675 6c6c 4d61 7020 2d20 6e70  obe.fullMap - np
+00004560: 2e6d 6561 6e28 6d61 705f 7072 6f62 652e  .mean(map_probe.
+00004570: 6675 6c6c 4d61 7029 0a20 2020 2020 2020  fullMap).       
+00004580: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00004590: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000045a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000045b0: 2020 2020 2020 2020 2063 6f72 7220 3d20           corr = 
+000045c0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+000045d0: 2020 2020 2069 6620 636f 7272 2069 7320       if corr is 
+000045e0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+000045f0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00004600: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00004610: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+00004620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004630: 2020 2020 2020 2020 206e 702e 7375 6d28           np.sum(
+00004640: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004650: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004660: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00004670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004680: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
+00004690: 742e 6675 6c6c 4d61 7020 2d0a 2020 2020  t.fullMap -.    
 000046a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000046b0: 2020 2020 206d 6170 5f70 726f 6265 2e66       map_probe.f
-000046c0: 756c 6c4d 6170 202d 206e 702e 6d65 616e  ullMap - np.mean
-000046d0: 286d 6170 5f70 726f 6265 2e66 756c 6c4d  (map_probe.fullM
-000046e0: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
-000046f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00004700: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000046b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046c0: 6e70 2e6d 6561 6e28 6d61 705f 7461 7267  np.mean(map_targ
+000046d0: 6574 2e66 756c 6c4d 6170 290a 2020 2020  et.fullMap).    
+000046e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000046f0: 2020 2020 2020 2020 2020 2020 2920 2a0a              ) *.
+00004700: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004720: 2020 2020 636f 7272 203d 204e 6f6e 650a      corr = None.
+00004720: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
 00004730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004740: 6966 2063 6f72 7220 6973 204e 6f6e 653a  if corr is None:
-00004750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004760: 2020 2020 2072 6574 7572 6e20 280a 2020       return (.  
-00004770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004780: 2020 2020 2020 280a 2020 2020 2020 2020        (.        
-00004790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047a0: 2020 2020 6e70 2e73 756d 280a 2020 2020      np.sum(.    
-000047b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047c0: 2020 2020 2020 2020 2020 2020 280a 2020              (.  
-000047d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004740: 2020 2020 2020 6d61 705f 7072 6f62 652e        map_probe.
+00004750: 6675 6c6c 4d61 7020 2d0a 2020 2020 2020  fullMap -.      
+00004760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004770: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00004780: 2e6d 6561 6e28 6d61 705f 7072 6f62 652e  .mean(map_probe.
+00004790: 6675 6c6c 4d61 7029 0a20 2020 2020 2020  fullMap).       
+000047a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+000047c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000047d0: 2020 2020 2020 2029 202f 0a20 2020 2020         ) /.     
 000047e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000047f0: 2020 6d61 705f 7461 7267 6574 2e66 756c    map_target.ful
-00004800: 6c4d 6170 202d 0a20 2020 2020 2020 2020  lMap -.         
-00004810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004820: 2020 2020 2020 2020 2020 206e 702e 6d65             np.me
-00004830: 616e 286d 6170 5f74 6172 6765 742e 6675  an(map_target.fu
-00004840: 6c6c 4d61 7029 0a20 2020 2020 2020 2020  llMap).         
+000047f0: 2020 2020 2020 2028 0a20 2020 2020 2020         (.       
+00004800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004810: 2020 2020 2020 2020 206e 702e 7371 7274           np.sqrt
+00004820: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00004830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004840: 2020 2020 2020 6e70 2e73 756d 280a 2020        np.sum(.  
 00004850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004860: 2020 2020 2020 2029 202a 0a20 2020 2020         ) *.     
-00004870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004880: 2020 2020 2020 2020 2020 2028 0a20 2020             (.   
+00004860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004870: 2020 2020 2020 6e70 2e73 7175 6172 6528        np.square(
+00004880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
 00004890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048b0: 206d 6170 5f70 726f 6265 2e66 756c 6c4d   map_probe.fullM
-000048c0: 6170 202d 0a20 2020 2020 2020 2020 2020  ap -.           
+000048a0: 2020 2020 2020 2020 2020 2020 206d 6170               map
+000048b0: 5f74 6172 6765 742e 6675 6c6c 4d61 7020  _target.fullMap 
+000048c0: 2d0a 2020 2020 2020 2020 2020 2020 2020  -.              
 000048d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000048e0: 2020 2020 2020 2020 206e 702e 6d65 616e           np.mean
-000048f0: 286d 6170 5f70 726f 6265 2e66 756c 6c4d  (map_probe.fullM
-00004900: 6170 290a 2020 2020 2020 2020 2020 2020  ap).            
+000048e0: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+000048f0: 2e6d 6561 6e28 6d61 705f 7461 7267 6574  .mean(map_target
+00004900: 2e66 756c 6c4d 6170 290a 2020 2020 2020  .fullMap).      
 00004910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004920: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004940: 2020 2920 2f0a 2020 2020 2020 2020 2020    ) /.          
-00004950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004960: 2020 280a 2020 2020 2020 2020 2020 2020    (.            
+00004920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004930: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004950: 2020 2020 2020 2020 2920 2a0a 2020 2020          ) *.    
+00004960: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004980: 2020 2020 6e70 2e73 7172 7428 0a20 2020      np.sqrt(.   
+00004980: 6e70 2e73 756d 280a 2020 2020 2020 2020  np.sum(.        
 00004990: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000049a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049b0: 206e 702e 7375 6d28 0a20 2020 2020 2020   np.sum(.       
+000049b0: 6e70 2e73 7175 6172 6528 0a20 2020 2020  np.square(.     
 000049c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000049d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000049e0: 206e 702e 7371 7561 7265 280a 2020 2020   np.square(.    
-000049f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000049e0: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
+000049f0: 2e66 756c 6c4d 6170 202d 0a20 2020 2020  .fullMap -.     
 00004a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a10: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-00004a20: 6574 2e66 756c 6c4d 6170 202d 0a20 2020  et.fullMap -.   
-00004a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a50: 2020 2020 2020 2020 206e 702e 6d65 616e           np.mean
-00004a60: 286d 6170 5f74 6172 6765 742e 6675 6c6c  (map_target.full
-00004a70: 4d61 7029 0a20 2020 2020 2020 2020 2020  Map).           
+00004a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a20: 2020 2020 2020 206e 702e 6d65 616e 286d         np.mean(m
+00004a30: 6170 5f70 726f 6265 2e66 756c 6c4d 6170  ap_probe.fullMap
+00004a40: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004a60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00004a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00004a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004a90: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00004a90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
 00004aa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ac0: 2020 2029 202a 0a20 2020 2020 2020 2020     ) *.         
-00004ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ae0: 2020 2020 2020 2020 2020 206e 702e 7375             np.su
-00004af0: 6d28 0a20 2020 2020 2020 2020 2020 2020  m(.             
-00004b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b10: 2020 2020 2020 2020 2020 206e 702e 7371             np.sq
-00004b20: 7561 7265 280a 2020 2020 2020 2020 2020  uare(.          
-00004b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b50: 2020 6d61 705f 7072 6f62 652e 6675 6c6c    map_probe.full
-00004b60: 4d61 7020 2d0a 2020 2020 2020 2020 2020  Map -.          
-00004b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004b90: 2020 6e70 2e6d 6561 6e28 6d61 705f 7072    np.mean(map_pr
-00004ba0: 6f62 652e 6675 6c6c 4d61 7029 0a20 2020  obe.fullMap).   
-00004bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bd0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00004be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004bf0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c10: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00004c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00004c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c50: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
-00004c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004c70: 7065 7263 5f6f 7672 0a20 2020 2020 2020  perc_ovr.       
-00004c80: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-00004c90: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00004ca0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00004cb0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00004cc0: 636f 7272 2c20 7065 7263 5f6f 7672 0a20  corr, perc_ovr. 
-00004cd0: 2020 2020 2020 2020 2020 2069 6620 636d             if cm
-00004ce0: 6f64 653a 0a20 2020 2020 2020 2020 2020  ode:.           
-00004cf0: 2020 2020 2063 6f72 7220 3d20 7365 6c66       corr = self
-00004d00: 2e5f 4343 435f 6361 6c63 286d 6170 5f74  ._CCC_calc(map_t
-00004d10: 6172 6765 742e 6675 6c6c 4d61 702c 206d  arget.fullMap, m
-00004d20: 6170 5f70 726f 6265 2e66 756c 6c4d 6170  ap_probe.fullMap
-00004d30: 290a 2020 2020 2020 2020 2020 2020 656c  ).            el
-00004d40: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00004d50: 2020 2020 636f 7272 203d 204e 6f6e 650a      corr = None.
-00004d60: 2020 2020 2020 2020 2020 2020 6966 2063              if c
-00004d70: 6f72 7220 6973 204e 6f6e 653a 0a20 2020  orr is None:.   
-00004d80: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00004d90: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
-00004da0: 2020 2020 2020 2020 2020 6e70 2e73 756d            np.sum
-00004db0: 286d 6170 5f74 6172 6765 742e 6675 6c6c  (map_target.full
-00004dc0: 4d61 7020 2a20 6d61 705f 7072 6f62 652e  Map * map_probe.
-00004dd0: 6675 6c6c 4d61 7029 202f 0a20 2020 2020  fullMap) /.     
-00004de0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00004df0: 702e 7371 7274 280a 2020 2020 2020 2020  p.sqrt(.        
-00004e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e10: 6e70 2e73 756d 286e 702e 7371 7561 7265  np.sum(np.square
-00004e20: 286d 6170 5f74 6172 6765 742e 6675 6c6c  (map_target.full
-00004e30: 4d61 7029 2920 2a0a 2020 2020 2020 2020  Map)) *.        
-00004e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004e50: 6e70 2e73 756d 286e 702e 7371 7561 7265  np.sum(np.square
-00004e60: 286d 6170 5f70 726f 6265 2e66 756c 6c4d  (map_probe.fullM
-00004e70: 6170 2929 0a20 2020 2020 2020 2020 2020  ap)).           
-00004e80: 2020 2020 2020 2020 2029 2c0a 2020 2020           ),.    
-00004e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004ea0: 7065 7263 5f6f 7672 0a20 2020 2020 2020  perc_ovr.       
-00004eb0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00004ec0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00004ed0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00004ee0: 7572 6e20 636f 7272 2c20 7065 7263 5f6f  urn corr, perc_o
-00004ef0: 7672 0a20 2020 2020 2020 2065 6c73 653a  vr.        else:
-00004f00: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00004f10: 6e74 2827 4040 4020 4d61 7073 2063 6f75  nt('@@@ Maps cou
-00004f20: 6c64 206e 6f74 2062 6520 6d61 7463 6865  ld not be matche
-00004f30: 6427 290a 2020 2020 2020 2020 2020 2020  d').            
-00004f40: 7265 7475 726e 202d 312e 2c20 302e 0a0a  return -1., 0...
-00004f50: 2020 2020 6465 6620 4343 4328 7365 6c66      def CCC(self
-00004f60: 2c20 6d61 705f 7461 7267 6574 2c20 6d61  , map_target, ma
-00004f70: 705f 7072 6f62 6529 3a0a 2020 2020 2020  p_probe):.      
-00004f80: 2020 2222 2243 616c 6375 6c61 7465 2063    """Calculate c
-00004f90: 726f 7373 2d63 6f72 7265 6c61 7469 6f6e  ross-correlation
-00004fa0: 2062 6574 7765 656e 2074 776f 204d 6170   between two Map
-00004fb0: 2069 6e73 7461 6e63 6573 2e0a 0a20 2020   instances...   
-00004fc0: 2020 2020 2041 7267 733a 0a20 2020 2020       Args:.     
-00004fd0: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-00004fe0: 742c 206d 6170 5f70 726f 6265 0a20 2020  t, map_probe.   
-00004ff0: 2020 2020 2020 2020 2020 2020 204d 6170               Map
-00005000: 2069 6e73 7461 6e63 6520 746f 2063 6f6d   instance to com
-00005010: 7061 7265 2e0a 2020 2020 2020 2020 5265  pare..        Re
-00005020: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-00005030: 2020 2043 4343 2073 636f 7265 0a20 2020     CCC score.   
-00005040: 2020 2020 2052 6169 7365 733a 0a20 2020       Raises:.   
-00005050: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00005060: 743a 2049 6e70 7574 206d 6170 7320 646f  t: Input maps do
-00005070: 206e 6f74 206d 6174 6368 2069 6e20 7368   not match in sh
-00005080: 6170 652c 2070 6978 656c 2073 697a 6520  ape, pixel size 
-00005090: 6f72 206f 7269 6769 6e0a 2020 2020 2020  or origin.      
-000050a0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000050b0: 2073 656c 662e 6d61 7043 6f6d 7061 7269   self.mapCompari
-000050c0: 736f 6e28 6d61 705f 7461 7267 6574 2c20  son(map_target, 
-000050d0: 6d61 705f 7072 6f62 6529 3a0a 2020 2020  map_probe):.    
-000050e0: 2020 2020 2020 2020 7265 7475 726e 2028          return (
-000050f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005100: 206d 6170 5f74 6172 6765 742e 6e6f 726d   map_target.norm
-00005110: 616c 6973 6528 292e 6765 744d 6170 2829  alise().getMap()
-00005120: 2a6d 6170 5f70 726f 6265 2e6e 6f72 6d61  *map_probe.norma
-00005130: 6c69 7365 2829 2e67 6574 4d61 7028 290a  lise().getMap().
-00005140: 2020 2020 2020 2020 2020 2020 292e 6d65              ).me
-00005150: 616e 2829 0a20 2020 2020 2020 2065 6c73  an().        els
-00005160: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00005170: 656c 662e 5f66 6169 6c65 645f 6d61 7463  elf._failed_matc
-00005180: 6828 290a 0a20 2020 2064 6566 204c 5346  h()..    def LSF
-00005190: 2873 656c 662c 206d 6170 5f74 6172 6765  (self, map_targe
-000051a0: 742c 206d 6170 5f70 726f 6265 293a 0a20  t, map_probe):. 
-000051b0: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
-000051c0: 6174 6520 6c65 6173 742d 7371 7561 7265  ate least-square
-000051d0: 7320 6265 7477 6565 6e20 7477 6f20 4d61  s between two Ma
-000051e0: 7020 696e 7374 616e 6365 732e 0a0a 2020  p instances...  
-000051f0: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
-00005200: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00005210: 5f74 6172 6765 742c 206d 6170 5f70 726f  _target, map_pro
-00005220: 6265 3a20 4d61 7020 696e 7374 616e 6365  be: Map instance
-00005230: 2074 6f20 636f 6d70 6172 652e 0a20 2020   to compare..   
-00005240: 2020 2020 2052 6574 7572 6e3a 0a20 2020       Return:.   
-00005250: 2020 2020 2020 2020 204c 6561 7374 2d73           Least-s
-00005260: 7175 6172 6573 2076 616c 7565 0a20 2020  quares value.   
-00005270: 2020 2020 2052 6169 7365 733a 0a20 2020       Raises:.   
-00005280: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00005290: 743a 2049 6e70 7574 206d 6170 7320 646f  t: Input maps do
-000052a0: 206e 6f74 206d 6174 6368 2069 6e20 7368   not match in sh
-000052b0: 6170 652c 2070 6978 656c 2073 697a 6520  ape, pixel size 
-000052c0: 6f72 206f 7269 6769 6e0a 2020 2020 2020  or origin.      
-000052d0: 2020 2222 220a 2020 2020 2020 2020 6966    """.        if
-000052e0: 2073 656c 662e 6d61 7043 6f6d 7061 7269   self.mapCompari
-000052f0: 736f 6e28 6d61 705f 7461 7267 6574 2c20  son(map_target, 
-00005300: 6d61 705f 7072 6f62 6529 3a0a 2020 2020  map_probe):.    
-00005310: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-00005320: 6574 2c20 6d61 705f 7072 6f62 6520 3d20  et, map_probe = 
-00005330: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
-00005340: 7072 6f62 650a 2020 2020 2020 2020 656c  probe.        el
-00005350: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005360: 7365 6c66 2e5f 6661 696c 6564 5f6d 6174  self._failed_mat
-00005370: 6368 2829 0a20 2020 2020 2020 2072 6574  ch().        ret
-00005380: 7572 6e20 2828 6d61 705f 7461 7267 6574  urn ((map_target
-00005390: 2e67 6574 4d61 7028 2920 2d20 6d61 705f  .getMap() - map_
-000053a0: 7072 6f62 652e 6765 744d 6170 2829 292a  probe.getMap())*
-000053b0: 2a32 292e 6d65 616e 2829 0a0a 2020 2020  *2).mean()..    
-000053c0: 6465 6620 6c61 706c 6163 655f 4343 4328  def laplace_CCC(
-000053d0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000053e0: 662c 0a20 2020 2020 2020 2020 2020 206d  f,.            m
-000053f0: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
-00005400: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
-00005410: 2c0a 2020 2020 2020 2020 2020 2020 7072  ,.            pr
-00005420: 6566 696c 3d28 4661 6c73 652c 2046 616c  efil=(False, Fal
-00005430: 7365 290a 2020 2020 293a 0a20 2020 2020  se).    ):.     
-00005440: 2020 2022 2222 4361 6c63 756c 6174 6520     """Calculate 
-00005450: 4343 4320 6265 7477 6565 6e20 7477 6f20  CCC between two 
-00005460: 6c61 706c 6163 6961 6e20 6669 6c74 6572  laplacian filter
-00005470: 6564 204d 6170 2069 6e73 7461 6e63 6573  ed Map instances
-00005480: 2e0a 0a20 2020 2020 2020 2054 6865 206c  ...        The l
-00005490: 6170 6c61 6369 616e 2066 696c 7465 7220  aplacian filter 
-000054a0: 6973 2061 6e20 6564 6765 2064 6574 6563  is an edge detec
-000054b0: 7469 6f6e 2066 696c 7465 722c 2077 6869  tion filter, whi
-000054c0: 6368 2063 6f6d 7075 7465 7320 7468 650a  ch computes the.
-000054d0: 2020 2020 2020 2020 7365 636f 6e64 2064          second d
-000054e0: 6572 7669 6174 6976 6573 206f 6620 616e  erviatives of an
-000054f0: 2069 6d61 6765 2f76 6f6c 756d 652e 2055   image/volume. U
-00005500: 7369 6e67 204c 6170 6c61 6369 616e 2066  sing Laplacian f
-00005510: 696c 7465 7273 2069 6e0a 2020 2020 2020  ilters in.      
-00005520: 2020 636f 6d62 696e 6174 696f 6e20 7769    combination wi
-00005530: 7468 2043 4343 2073 636f 7269 6e67 206f  th CCC scoring o
-00005540: 6620 6372 796f 2045 4d20 6d6f 6465 6c73  f cryo EM models
-00005550: 2020 7761 7320 7368 6f77 6e20 746f 2062    was shown to b
-00005560: 6520 6d6f 7265 0a20 2020 2020 2020 2061  e more.        a
-00005570: 6363 7572 6174 6520 7468 616e 2043 4343  ccurate than CCC
-00005580: 2073 636f 7269 6e67 2061 6c6f 6e65 2066   scoring alone f
-00005590: 6f72 206c 6f77 2072 6573 6f6c 7574 696f  or low resolutio
-000055a0: 6e20 6d61 7073 2c20 696e 0a20 2020 2020  n maps, in.     
-000055b0: 2020 2060 2843 6861 636f 6e20 616e 6420     `(Chacon and 
-000055c0: 5772 6967 6765 7273 2c20 3230 3032 2920  Wriggers, 2002) 
-000055d0: 3c68 7474 7073 3a2f 2f70 7562 6d65 642e  <https://pubmed.
-000055e0: 6e63 6269 2e6e 6c6d 2e6e 6968 2e67 6f76  ncbi.nlm.nih.gov
-000055f0: 2f31 3139 3232 3637 312f 3e60 5f0a 0a20  /11922671/>`_.. 
-00005600: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
-00005610: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00005620: 705f 7461 7267 6574 2c20 6d61 705f 7072  p_target, map_pr
-00005630: 6f62 653a 204d 6170 2069 6e73 7461 6e63  obe: Map instanc
-00005640: 6573 2074 6f20 636f 6d70 6172 652e 0a0a  es to compare...
-00005650: 2020 2020 2020 2020 2020 2020 7072 6566              pref
-00005660: 696c 3a20 322d 7475 706c 6520 6f66 2062  il: 2-tuple of b
-00005670: 6f6f 6c65 616e 2076 616c 7565 732c 206f  oolean values, o
-00005680: 6e65 2066 6f72 2065 6163 6820 6d61 7020  ne for each map 
-00005690: 7265 7370 6563 7469 7665 6c79 2e0a 2020  respectively..  
-000056a0: 2020 2020 2020 2020 2020 2020 2020 5472                Tr
-000056b0: 7565 2069 6620 4d61 7020 696e 7374 616e  ue if Map instan
-000056c0: 6365 2069 7320 616c 7265 6164 7920 4c61  ce is already La
-000056d0: 706c 6163 6961 6e2d 6669 6c74 6572 6564  placian-filtered
-000056e0: 2e20 4661 6c73 650a 2020 2020 2020 2020  . False.        
-000056f0: 2020 2020 2020 2020 6f74 6865 7277 6973          otherwis
-00005700: 652e 0a20 2020 2020 2020 2052 6574 7572  e..        Retur
-00005710: 6e3a 0a20 2020 2020 2020 2020 2020 204c  n:.            L
-00005720: 6170 6c61 6369 616e 2063 726f 7373 2d63  aplacian cross-c
-00005730: 6f72 7265 6c61 7469 6f6e 2073 636f 7265  orrelation score
-00005740: 0a20 2020 2020 2020 2052 6169 7365 733a  .        Raises:
-00005750: 0a20 2020 2020 2020 2020 2020 2073 7973  .            sys
-00005760: 2e65 7869 743a 2049 6e70 7574 206d 6170  .exit: Input map
-00005770: 7320 646f 206e 6f74 206d 6174 6368 2069  s do not match i
-00005780: 6e20 7368 6170 652c 2070 6978 656c 2073  n shape, pixel s
-00005790: 697a 6520 6f72 206f 7269 6769 6e0a 2020  ize or origin.  
-000057a0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000057b0: 2020 2069 6620 7365 6c66 2e6d 6170 436f     if self.mapCo
-000057c0: 6d70 6172 6973 6f6e 286d 6170 5f74 6172  mparison(map_tar
-000057d0: 6765 742c 206d 6170 5f70 726f 6265 293a  get, map_probe):
-000057e0: 0a20 2020 2020 2020 2020 2020 2023 2049  .            # I
-000057f0: 2064 6f6e 2774 2075 6e64 6572 7374 616e   don't understan
-00005800: 6420 7468 6973 202d 2063 616e 2077 6520  d this - can we 
-00005810: 7265 706c 6163 6520 6974 2077 6974 6820  replace it with 
-00005820: 7061 7373 3f0a 2020 2020 2020 2020 2020  pass?.          
-00005830: 2020 5f2c 205f 203d 206d 6170 5f74 6172    _, _ = map_tar
-00005840: 6765 742c 206d 6170 5f70 726f 6265 2020  get, map_probe  
-00005850: 2320 6e6f 7161 3a46 3834 310a 2020 2020  # noqa:F841.    
-00005860: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005870: 2020 2020 2020 7365 6c66 2e5f 6661 696c        self._fail
-00005880: 6564 5f6d 6174 6368 2829 0a0a 2020 2020  ed_match()..    
-00005890: 2020 2020 6966 206e 6f74 2070 7265 6669      if not prefi
-000058a0: 6c5b 305d 3a0a 2020 2020 2020 2020 2020  l[0]:.          
-000058b0: 2020 6d61 705f 7461 7267 6574 203d 206d    map_target = m
-000058c0: 6170 5f74 6172 6765 742e 6c61 706c 6163  ap_target.laplac
-000058d0: 655f 6669 6c74 6572 6564 2829 0a20 2020  e_filtered().   
-000058e0: 2020 2020 2069 6620 6e6f 7420 7072 6566       if not pref
-000058f0: 696c 5b31 5d3a 0a20 2020 2020 2020 2020  il[1]:.         
-00005900: 2020 206d 6170 5f70 726f 6265 203d 206d     map_probe = m
-00005910: 6170 5f70 726f 6265 2e6c 6170 6c61 6365  ap_probe.laplace
-00005920: 5f66 696c 7465 7265 6428 290a 2020 2020  _filtered().    
-00005930: 2020 2020 6d61 705f 7461 7267 6574 203d      map_target =
-00005940: 206d 6170 5f74 6172 6765 742e 6e6f 726d   map_target.norm
-00005950: 616c 6973 6528 290a 2020 2020 2020 2020  alise().        
-00005960: 6d61 705f 7072 6f62 6520 3d20 6d61 705f  map_probe = map_
-00005970: 7072 6f62 652e 6e6f 726d 616c 6973 6528  probe.normalise(
-00005980: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-00005990: 2073 656c 662e 4343 4328 6d61 705f 7461   self.CCC(map_ta
-000059a0: 7267 6574 2c20 6d61 705f 7072 6f62 6529  rget, map_probe)
-000059b0: 0a0a 2020 2020 6465 6620 6e6f 726d 616c  ..    def normal
-000059c0: 5f76 6563 746f 725f 7363 6f72 6528 0a20  _vector_score(. 
-000059d0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-000059e0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-000059f0: 5f74 6172 6765 742c 0a20 2020 2020 2020  _target,.       
-00005a00: 2020 2020 206d 6170 5f70 726f 6265 2c0a       map_probe,.
-00005a10: 2020 2020 2020 2020 2020 2020 7072 696d              prim
-00005a20: 6172 795f 626f 756e 6461 7279 2c0a 2020  ary_boundary,.  
-00005a30: 2020 2020 2020 2020 2020 7365 636f 6e64            second
-00005a40: 6172 795f 626f 756e 6461 7279 3d30 2e30  ary_boundary=0.0
-00005a50: 2c0a 2020 2020 2020 2020 2020 2020 4669  ,.            Fi
-00005a60: 6c74 6572 3d4e 6f6e 652c 0a20 2020 2029  lter=None,.    )
-00005a70: 3a0a 2020 2020 2020 2020 2222 2243 616c  :.        """Cal
-00005a80: 6375 6c61 7465 2074 6865 204e 6f72 6d61  culate the Norma
-00005a90: 6c20 5665 6374 6f72 2053 636f 7265 2062  l Vector Score b
-00005aa0: 6574 7765 656e 2074 776f 204d 6170 2073  etween two Map s
-00005ab0: 7572 6661 6365 732e 0a0a 2020 2020 2020  urfaces...      
-00005ac0: 2020 4261 7365 6420 6f6e 2033 534f 4d20    Based on 3SOM 
-00005ad0: 616c 676f 7269 7468 6d20 2843 6575 6c65  algorithm (Ceule
-00005ae0: 6d61 6e73 2061 6e64 2052 7573 7365 6c6c  mans and Russell
-00005af0: 2c20 3230 3034 292e 0a0a 2020 2020 2020  , 2004)...      
-00005b00: 2020 4172 6775 6d65 6e74 733a 0a20 2020    Arguments:.   
-00005b10: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
-00005b20: 6765 742c 206d 6170 5f70 726f 6265 3a0a  get, map_probe:.
-00005b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005b40: 4d61 7020 696e 7374 616e 6365 7320 746f  Map instances to
-00005b50: 2063 6f6d 7061 7265 2e0a 2020 2020 2020   compare..      
-00005b60: 2020 2020 2020 7072 696d 6172 795f 626f        primary_bo
-00005b70: 756e 6461 7279 2c20 7365 636f 6e64 6172  undary, secondar
-00005b80: 795f 626f 756e 6461 7279 3a0a 2020 2020  y_boundary:.    
-00005b90: 2020 2020 2020 2020 2020 2020 4966 2061              If a
-00005ba0: 2066 696c 7465 7220 6973 2073 656c 6563   filter is selec
-00005bb0: 7465 642c 206a 7573 7420 696e 7075 7420  ted, just input 
-00005bc0: 6120 636f 6e74 6f75 7220 6c65 7665 6c20  a contour level 
-00005bd0: 6173 2070 7269 6d61 7279 0a20 2020 2020  as primary.     
-00005be0: 2020 2020 2020 2020 2020 2074 6872 6573             thres
-00005bf0: 686f 6c64 2e20 4f74 6865 7277 6973 652c  hold. Otherwise,
-00005c00: 206e 6565 6420 746f 2072 756e 2067 6574   need to run get
-00005c10: 5f70 7269 6d61 7279 5f62 6f75 6e64 6172  _primary_boundar
-00005c20: 7920 616e 640a 2020 2020 2020 2020 2020  y and.          
-00005c30: 2020 2020 2020 6765 745f 7365 636f 6e64        get_second
-00005c40: 5f62 6f75 6e64 6172 7920 6261 7365 6420  _boundary based 
-00005c50: 6f6e 206d 6170 2074 6172 6765 742e 0a20  on map target.. 
-00005c60: 2020 2020 2020 2020 2020 2046 696c 7465             Filte
-00005c70: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00005c80: 2020 2046 696c 7465 7220 746f 2062 6520     Filter to be 
-00005c90: 6170 706c 6965 6420 746f 2069 6e70 7574  applied to input
-00005ca0: 7320 6d61 7073 2062 6566 6f72 6520 6361  s maps before ca
-00005cb0: 6c63 756c 6174 696e 6720 7363 6f72 652e  lculating score.
-00005cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005cd0: 2020 2020 2031 2e20 536f 6265 6c20 4669       1. Sobel Fi
-00005ce0: 6c74 6572 2028 4669 6c74 6572 3d3d 2753  lter (Filter=='S
-00005cf0: 6f62 656c 2729 0a20 2020 2020 2020 2020  obel').         
-00005d00: 2020 2020 2020 2020 2020 2032 2e20 4c61             2. La
-00005d10: 706c 6163 6520 4669 6c74 6572 2028 4669  place Filter (Fi
-00005d20: 6c74 6572 3d3d 274c 6170 6c61 6365 2729  lter=='Laplace')
-00005d30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005d40: 2020 2020 2033 2e20 4d69 6e69 6d75 6d20       3. Minimum 
-00005d50: 4669 6c74 6572 2028 4669 6c74 6572 3d3d  Filter (Filter==
-00005d60: 274d 696e 696d 756d 2729 0a20 2020 2020  'Minimum').     
-00005d70: 2020 2020 2020 2020 2020 2020 2020 2034                 4
-00005d80: 2e20 4d65 616e 2046 696c 7465 7220 2846  . Mean Filter (F
-00005d90: 696c 7465 723d 3d27 4d65 616e 2729 0a20  ilter=='Mean'). 
-00005da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005db0: 2020 2035 2e20 4e6f 2066 696c 7465 7269     5. No filteri
-00005dc0: 6e67 2028 4669 6c74 6572 3d3d 4e6f 6e65  ng (Filter==None
-00005dd0: 290a 2020 2020 2020 2020 5265 7475 726e  ).        Return
-00005de0: 3a0a 2020 2020 2020 2020 2020 2020 4e6f  :.            No
-00005df0: 726d 616c 2076 6563 746f 7220 7363 6f72  rmal vector scor
-00005e00: 652e 0a20 2020 2020 2020 2052 6169 7365  e..        Raise
-00005e10: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-00005e20: 7973 2e65 7869 743a 2049 6e70 7574 206d  ys.exit: Input m
-00005e30: 6170 7320 646f 206e 6f74 206d 6174 6368  aps do not match
-00005e40: 2069 6e20 7368 6170 652c 2070 6978 656c   in shape, pixel
-00005e50: 2073 697a 6520 6f72 206f 7269 6769 6e0a   size or origin.
-00005e60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00005e70: 2020 2020 6966 2046 696c 7465 7220 6e6f      if Filter no
-00005e80: 7420 696e 205b 2753 6f62 656c 272c 2027  t in ['Sobel', '
-00005e90: 4c61 706c 6163 6527 2c20 274d 6561 6e27  Laplace', 'Mean'
-00005ea0: 2c20 274d 696e 696d 756d 272c 204e 6f6e  , 'Minimum', Non
-00005eb0: 655d 3a0a 2020 2020 2020 2020 2020 2020  e]:.            
-00005ec0: 7072 696e 7428 2749 6e63 6f72 7265 6374  print('Incorrect
-00005ed0: 206e 616d 6520 6f66 2066 696c 7465 723a   name of filter:
-00005ee0: 2025 7322 2025 2046 696c 7465 7227 290a   %s" % Filter').
-00005ef0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-00005f00: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00005f10: 2020 2027 5365 6c65 6374 206f 6e65 206f     'Select one o
-00005f20: 6620 7468 6520 666f 6c6c 6f77 696e 6720  f the following 
-00005f30: 4669 6c74 6572 7320 6966 2061 7070 6c69  Filters if appli
-00005f40: 6361 626c 653a 2025 735c 6e27 2025 0a20  cable: %s\n' %. 
-00005f50: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00005f60: 2c20 272e 6a6f 696e 285b 2753 6f62 656c  , '.join(['Sobel
-00005f70: 272c 2027 4c61 706c 6163 6527 5d29 0a20  ', 'Laplace']). 
-00005f80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00005f90: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
-00005fa0: 7428 290a 0a20 2020 2020 2020 2073 636f  t()..        sco
-00005fb0: 7265 7320 3d20 5b5d 0a20 2020 2020 2020  res = [].       
-00005fc0: 2069 6620 6e6f 7420 7365 6c66 2e6d 6170   if not self.map
-00005fd0: 436f 6d70 6172 6973 6f6e 286d 6170 5f74  Comparison(map_t
-00005fe0: 6172 6765 742c 206d 6170 5f70 726f 6265  arget, map_probe
-00005ff0: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-00006000: 656c 662e 5f66 6169 6c65 645f 6d61 7463  elf._failed_matc
-00006010: 6828 290a 2020 2020 2020 2020 6173 7365  h().        asse
-00006020: 7274 2069 7369 6e73 7461 6e63 6528 7072  rt isinstance(pr
-00006030: 696d 6172 795f 626f 756e 6461 7279 2c20  imary_boundary, 
-00006040: 666c 6f61 7429 0a20 2020 2020 2020 2061  float).        a
-00006050: 7373 6572 7420 6973 696e 7374 616e 6365  ssert isinstance
-00006060: 2873 6563 6f6e 6461 7279 5f62 6f75 6e64  (secondary_bound
-00006070: 6172 792c 2066 6c6f 6174 290a 2020 2020  ary, float).    
-00006080: 2020 2020 6966 2070 7269 6d61 7279 5f62      if primary_b
-00006090: 6f75 6e64 6172 7920 3e20 7365 636f 6e64  oundary > second
-000060a0: 6172 795f 626f 756e 6461 7279 3a0a 2020  ary_boundary:.  
-000060b0: 2020 2020 2020 2020 2020 7465 6d70 5f74            temp_t
-000060c0: 6872 203d 2073 6563 6f6e 6461 7279 5f62  hr = secondary_b
-000060d0: 6f75 6e64 6172 790a 2020 2020 2020 2020  oundary.        
-000060e0: 2020 2020 7365 636f 6e64 6172 795f 626f      secondary_bo
-000060f0: 756e 6461 7279 203d 2070 7269 6d61 7279  undary = primary
-00006100: 5f62 6f75 6e64 6172 790a 2020 2020 2020  _boundary.      
-00006110: 2020 2020 2020 7072 696d 6172 795f 626f        primary_bo
-00006120: 756e 6461 7279 203d 2074 656d 705f 7468  undary = temp_th
-00006130: 720a 0a20 2020 2020 2020 2070 6f69 6e74  r..        point
-00006140: 7320 3d20 6e70 2e61 7267 7768 6572 6528  s = np.argwhere(
-00006150: 0a20 2020 2020 2020 2020 2020 2028 6d61  .            (ma
-00006160: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
-00006170: 203e 2070 7269 6d61 7279 5f62 6f75 6e64   > primary_bound
-00006180: 6172 7929 2026 0a20 2020 2020 2020 2020  ary) &.         
-00006190: 2020 2028 6d61 705f 7461 7267 6574 2e66     (map_target.f
-000061a0: 756c 6c4d 6170 203c 2073 6563 6f6e 6461  ullMap < seconda
-000061b0: 7279 5f62 6f75 6e64 6172 7929 0a20 2020  ry_boundary).   
-000061c0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-000061d0: 6966 2046 696c 7465 7220 3d3d 2027 536f  if Filter == 'So
-000061e0: 6265 6c27 3a0a 2020 2020 2020 2020 2020  bel':.          
-000061f0: 2020 6d61 7031 5f73 7572 6661 6365 203d    map1_surface =
-00006200: 206d 6170 5f74 6172 6765 742e 5f73 6f62   map_target._sob
-00006210: 656c 5f66 696c 7465 725f 636f 6e74 6f75  el_filter_contou
-00006220: 7228 7072 696d 6172 795f 626f 756e 6461  r(primary_bounda
-00006230: 7279 290a 2020 2020 2020 2020 2020 2020  ry).            
-00006240: 706f 696e 7473 203d 206e 702e 6172 6777  points = np.argw
-00006250: 6865 7265 280a 2020 2020 2020 2020 2020  here(.          
-00006260: 2020 2020 2020 6d61 7031 5f73 7572 6661        map1_surfa
-00006270: 6365 2e66 756c 6c4d 6170 203e 2028 6d61  ce.fullMap > (ma
-00006280: 7031 5f73 7572 6661 6365 2e6d 6178 2829  p1_surface.max()
-00006290: 202f 2032 2e30 290a 2020 2020 2020 2020   / 2.0).        
-000062a0: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
-000062b0: 6966 2046 696c 7465 7220 3d3d 2027 4c61  if Filter == 'La
-000062c0: 706c 6163 6527 3a0a 2020 2020 2020 2020  place':.        
-000062d0: 2020 2020 6d61 7031 5f73 7572 6661 6365      map1_surface
-000062e0: 203d 206d 6170 5f74 6172 6765 742e 5f6c   = map_target._l
-000062f0: 6170 6c61 6365 5f66 696c 7465 7265 645f  aplace_filtered_
-00006300: 636f 6e74 6f75 7228 0a20 2020 2020 2020  contour(.       
-00006310: 2020 2020 2020 2020 2070 7269 6d61 7279           primary
-00006320: 5f62 6f75 6e64 6172 790a 2020 2020 2020  _boundary.      
-00006330: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006340: 2020 2020 706f 696e 7473 203d 206e 702e      points = np.
-00006350: 6172 6777 6865 7265 280a 2020 2020 2020  argwhere(.      
-00006360: 2020 2020 2020 2020 2020 6d61 7031 5f73            map1_s
-00006370: 7572 6661 6365 2e66 756c 6c4d 6170 203e  urface.fullMap >
-00006380: 2028 6d61 7031 5f73 7572 6661 6365 2e6d   (map1_surface.m
-00006390: 6178 2829 202f 2032 2e30 290a 2020 2020  ax() / 2.0).    
-000063a0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000063b0: 2020 656c 6966 2046 696c 7465 7220 3d3d    elif Filter ==
-000063c0: 2027 4d69 6e69 6d75 6d27 3a0a 2020 2020   'Minimum':.    
-000063d0: 2020 2020 2020 2020 6d61 7031 5f73 7572          map1_sur
-000063e0: 6661 6365 203d 206d 6170 5f74 6172 6765  face = map_targe
-000063f0: 742e 5f73 7572 6661 6365 5f6d 696e 696d  t._surface_minim
-00006400: 756d 5f66 696c 7465 7228 0a20 2020 2020  um_filter(.     
-00006410: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-00006420: 2870 7269 6d61 7279 5f62 6f75 6e64 6172  (primary_boundar
-00006430: 7929 0a20 2020 2020 2020 2020 2020 2029  y).            )
-00006440: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-00006450: 6e74 7320 3d20 6e70 2e61 7267 7768 6572  nts = np.argwher
-00006460: 6528 6d61 7031 5f73 7572 6661 6365 203d  e(map1_surface =
-00006470: 3d20 3129 0a20 2020 2020 2020 2065 6c69  = 1).        eli
-00006480: 6620 4669 6c74 6572 203d 3d20 274d 6561  f Filter == 'Mea
-00006490: 6e27 3a0a 2020 2020 2020 2020 2020 2020  n':.            
-000064a0: 6d61 7031 5f66 696c 7465 7220 3d20 6d61  map1_filter = ma
-000064b0: 705f 7461 7267 6574 2e5f 7375 7266 6163  p_target._surfac
-000064c0: 655f 6665 6174 7572 6573 2866 6c6f 6174  e_features(float
-000064d0: 2870 7269 6d61 7279 5f62 6f75 6e64 6172  (primary_boundar
-000064e0: 7929 290a 2020 2020 2020 2020 2020 2020  y)).            
-000064f0: 6269 6e5f 7465 7374 203d 205b 302e 3030  bin_test = [0.00
-00006500: 3031 5d0a 2020 2020 2020 2020 2020 2020  01].            
-00006510: 666f 7220 6969 2069 6e20 7261 6e67 6528  for ii in range(
-00006520: 312c 2034 3129 3a0a 2020 2020 2020 2020  1, 41):.        
-00006530: 2020 2020 2020 2020 6269 6e5f 7465 7374          bin_test
-00006540: 2e61 7070 656e 6428 302e 3032 3520 2a20  .append(0.025 * 
-00006550: 6969 290a 2020 2020 2020 2020 2020 2020  ii).            
-00006560: 6672 6571 5f74 6573 7420 3d20 6e70 2e68  freq_test = np.h
-00006570: 6973 746f 6772 616d 286d 6170 315f 6669  istogram(map1_fi
-00006580: 6c74 6572 2e66 756c 6c4d 6170 2c20 6269  lter.fullMap, bi
-00006590: 6e5f 7465 7374 295b 305d 0a20 2020 2020  n_test)[0].     
-000065a0: 2020 2020 2020 2073 756d 5f66 7265 7120         sum_freq 
-000065b0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
-000065c0: 2020 666f 7220 6672 2069 6e20 7261 6e67    for fr in rang
-000065d0: 6528 6c65 6e28 6672 6571 5f74 6573 7429  e(len(freq_test)
-000065e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000065f0: 2020 2073 756d 5f66 7265 7120 2b3d 2066     sum_freq += f
-00006600: 6c6f 6174 2866 7265 715f 7465 7374 5b66  loat(freq_test[f
-00006610: 725d 290a 2020 2020 2020 2020 2020 2020  r]).            
-00006620: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
-00006630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006640: 2073 756d 5f66 7265 7120 2f20 6e70 2e73   sum_freq / np.s
-00006650: 756d 2866 7265 715f 7465 7374 2920 3e20  um(freq_test) > 
-00006660: 302e 3035 2061 6e64 0a20 2020 2020 2020  0.05 and.       
-00006670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006680: 2062 696e 5f74 6573 745b 6672 2b31 5d20   bin_test[fr+1] 
-00006690: 3e3d 2030 2e33 0a20 2020 2020 2020 2020  >= 0.3.         
-000066a0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-000066b0: 2020 2020 2020 2020 2020 2020 2020 7431                t1
-000066c0: 203d 2062 696e 5f74 6573 745b 6672 2b31   = bin_test[fr+1
-000066d0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000066e0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
-000066f0: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00006700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00006710: 2020 2020 2020 2020 2073 756d 5f66 7265           sum_fre
-00006720: 7120 2f20 6e70 2e6e 756d 7375 6d28 6672  q / np.numsum(fr
-00006730: 6571 5f74 6573 7429 203e 2030 2e31 3020  eq_test) > 0.10 
-00006740: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-00006750: 2020 2020 2020 2020 2020 2073 756d 5f66             sum_f
-00006760: 7265 7120 3e20 3130 3030 3030 0a20 2020  req > 100000.   
-00006770: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
-00006780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006790: 2020 2020 7431 203d 2062 696e 5f74 6573      t1 = bin_tes
-000067a0: 745b 6672 2b31 5d0a 2020 2020 2020 2020  t[fr+1].        
-000067b0: 2020 2020 2020 2020 2020 2020 6272 6561              brea
-000067c0: 6b0a 2020 2020 2020 2020 2020 2020 706f  k.            po
-000067d0: 696e 7473 203d 206e 702e 6172 6777 6865  ints = np.argwhe
-000067e0: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
-000067f0: 2020 2020 286d 6170 315f 6669 6c74 6572      (map1_filter
-00006800: 2e66 756c 6c4d 6170 203e 2030 2e30 2920  .fullMap > 0.0) 
-00006810: 2620 286d 6170 315f 6669 6c74 6572 2e66  & (map1_filter.f
-00006820: 756c 6c4d 6170 203c 2074 3129 0a20 2020  ullMap < t1).   
-00006830: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00006840: 2020 2023 2043 2b2b 2063 616c 6375 6c61     # C++ calcula
-00006850: 7469 6f6e 0a20 2020 2020 2020 2066 6c61  tion.        fla
-00006860: 6763 203d 2031 0a20 2020 2020 2020 2074  gc = 1.        t
-00006870: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00006880: 7665 636e 6f72 6d5f 7461 7267 6574 203d  vecnorm_target =
-00006890: 206d 6170 5f74 6172 6765 742e 5f67 6574   map_target._get
-000068a0: 5f6e 6f72 6d61 6c5f 7665 6374 6f72 2870  _normal_vector(p
-000068b0: 6f69 6e74 7329 0a20 2020 2020 2020 2020  oints).         
-000068c0: 2020 2076 6563 6e6f 726d 5f70 726f 6265     vecnorm_probe
-000068d0: 203d 206d 6170 5f70 726f 6265 2e5f 6765   = map_probe._ge
-000068e0: 745f 6e6f 726d 616c 5f76 6563 746f 7228  t_normal_vector(
-000068f0: 706f 696e 7473 290a 2020 2020 2020 2020  points).        
-00006900: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00006910: 3a0a 2020 2020 2020 2020 2020 2020 666c  :.            fl
-00006920: 6167 6320 3d20 300a 2020 2020 2020 2020  agc = 0.        
-00006930: 6966 2076 6563 6e6f 726d 5f74 6172 6765  if vecnorm_targe
-00006940: 7420 6973 204e 6f6e 6520 6f72 2076 6563  t is None or vec
-00006950: 6e6f 726d 5f70 726f 6265 2069 7320 4e6f  norm_probe is No
-00006960: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-00006970: 666c 6167 6320 3d20 300a 2020 2020 2020  flagc = 0.      
-00006980: 2020 6374 203d 2030 0a0a 2020 2020 2020    ct = 0..      
-00006990: 2020 6966 2066 6c61 6763 203d 3d20 313a    if flagc == 1:
-000069a0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
-000069b0: 2069 2069 6e20 7261 6e67 6528 6c65 6e28   i in range(len(
-000069c0: 7665 636e 6f72 6d5f 7461 7267 6574 2929  vecnorm_target))
-000069d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000069e0: 2020 6374 202b 3d20 310a 2020 2020 2020    ct += 1.      
-000069f0: 2020 2020 2020 2020 2020 6e76 6563 203d            nvec =
-00006a00: 2076 6563 6e6f 726d 5f74 6172 6765 745b   vecnorm_target[
-00006a10: 695d 0a20 2020 2020 2020 2020 2020 2020  i].             
-00006a20: 2020 206f 7665 6320 3d20 7665 636e 6f72     ovec = vecnor
-00006a30: 6d5f 7072 6f62 655b 695d 0a20 2020 2020  m_probe[i].     
-00006a40: 2020 2020 2020 2020 2020 2023 2061 6464             # add
-00006a50: 206d 6178 2076 616c 7565 2066 6f72 2072   max value for r
-00006a60: 6567 696f 6e73 206f 6620 6e75 6c6c 2076  egions of null v
-00006a70: 6172 6961 7469 6f6e 0a20 2020 2020 2020  ariation.       
-00006a80: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
-00006a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006aa0: 2020 2020 2020 6e76 6563 5b30 5d20 3d3d        nvec[0] ==
-00006ab0: 2030 2e20 616e 640a 2020 2020 2020 2020   0. and.        
-00006ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ad0: 6e76 6563 5b31 5d20 3d3d 2030 2e20 616e  nvec[1] == 0. an
-00006ae0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00006af0: 2020 2020 2020 2020 2020 6e76 6563 5b32            nvec[2
-00006b00: 5d20 3d3d 2030 2e0a 2020 2020 2020 2020  ] == 0..        
-00006b10: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-00006b20: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00006b30: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00006b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006b50: 6f76 6563 5b30 5d20 3d3d 2030 2e20 616e  ovec[0] == 0. an
-00006b60: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-00006b70: 2020 2020 2020 2020 2020 2020 2020 6f76                ov
-00006b80: 6563 5b31 5d20 3d3d 2030 2e20 616e 640a  ec[1] == 0. and.
-00006b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ba0: 2020 2020 2020 2020 2020 2020 6f76 6563              ovec
-00006bb0: 5b32 5d20 3d3d 2030 2e30 0a20 2020 2020  [2] == 0.0.     
-00006bc0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00006bd0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00006be0: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00006bf0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00006c00: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00006c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c20: 2020 2020 2073 636f 7265 732e 6170 7065       scores.appe
-00006c30: 6e64 2833 2e31 3429 0a20 2020 2020 2020  nd(3.14).       
+00004ab0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ad0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004ae0: 2020 2020 2020 2020 2020 292c 0a20 2020            ),.   
+00004af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b00: 2020 2020 2070 6572 635f 6f76 720a 2020       perc_ovr.  
+00004b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004b20: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00004b30: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00004b40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00004b50: 7475 726e 2063 6f72 722c 2070 6572 635f  turn corr, perc_
+00004b60: 6f76 720a 2020 2020 2020 2020 2020 2020  ovr.            
+00004b70: 6966 2063 6d6f 6465 3a0a 2020 2020 2020  if cmode:.      
+00004b80: 2020 2020 2020 2020 2020 636f 7272 203d            corr =
+00004b90: 2073 656c 662e 5f43 4343 5f63 616c 6328   self._CCC_calc(
+00004ba0: 6d61 705f 7461 7267 6574 2e66 756c 6c4d  map_target.fullM
+00004bb0: 6170 2c20 6d61 705f 7072 6f62 652e 6675  ap, map_probe.fu
+00004bc0: 6c6c 4d61 7029 0a20 2020 2020 2020 2020  llMap).         
+00004bd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00004be0: 2020 2020 2020 2020 2063 6f72 7220 3d20           corr = 
+00004bf0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+00004c00: 2069 6620 636f 7272 2069 7320 4e6f 6e65   if corr is None
+00004c10: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004c20: 2020 7265 7475 726e 2028 0a20 2020 2020    return (.     
+00004c30: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00004c40: 702e 7375 6d28 6d61 705f 7461 7267 6574  p.sum(map_target
+00004c50: 2e66 756c 6c4d 6170 202a 206d 6170 5f70  .fullMap * map_p
+00004c60: 726f 6265 2e66 756c 6c4d 6170 2920 2f0a  robe.fullMap) /.
+00004c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004c80: 2020 2020 6e70 2e73 7172 7428 0a20 2020      np.sqrt(.   
+00004c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ca0: 2020 2020 206e 702e 7375 6d28 6e70 2e73       np.sum(np.s
+00004cb0: 7175 6172 6528 6d61 705f 7461 7267 6574  quare(map_target
+00004cc0: 2e66 756c 6c4d 6170 2929 202a 0a20 2020  .fullMap)) *.   
+00004cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00004ce0: 2020 2020 206e 702e 7375 6d28 6e70 2e73       np.sum(np.s
+00004cf0: 7175 6172 6528 6d61 705f 7072 6f62 652e  quare(map_probe.
+00004d00: 6675 6c6c 4d61 7029 290a 2020 2020 2020  fullMap)).      
+00004d10: 2020 2020 2020 2020 2020 2020 2020 292c                ),
+00004d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004d30: 2020 2020 2070 6572 635f 6f76 720a 2020       perc_ovr.  
+00004d40: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00004d50: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00004d60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00004d70: 2020 7265 7475 726e 2063 6f72 722c 2070    return corr, p
+00004d80: 6572 635f 6f76 720a 2020 2020 2020 2020  erc_ovr.        
+00004d90: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00004da0: 2020 7072 696e 7428 2740 4040 204d 6170    print('@@@ Map
+00004db0: 7320 636f 756c 6420 6e6f 7420 6265 206d  s could not be m
+00004dc0: 6174 6368 6564 2729 0a20 2020 2020 2020  atched').       
+00004dd0: 2020 2020 2072 6574 7572 6e20 2d31 2e2c       return -1.,
+00004de0: 2030 2e0a 0a20 2020 2064 6566 2043 4343   0...    def CCC
+00004df0: 2873 656c 662c 206d 6170 5f74 6172 6765  (self, map_targe
+00004e00: 742c 206d 6170 5f70 726f 6265 293a 0a20  t, map_probe):. 
+00004e10: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
+00004e20: 6174 6520 6372 6f73 732d 636f 7272 656c  ate cross-correl
+00004e30: 6174 696f 6e20 6265 7477 6565 6e20 7477  ation between tw
+00004e40: 6f20 4d61 7020 696e 7374 616e 6365 732e  o Map instances.
+00004e50: 0a0a 2020 2020 2020 2020 4172 6773 3a0a  ..        Args:.
+00004e60: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+00004e70: 7461 7267 6574 2c20 6d61 705f 7072 6f62  target, map_prob
+00004e80: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00004e90: 2020 4d61 7020 696e 7374 616e 6365 2074    Map instance t
+00004ea0: 6f20 636f 6d70 6172 652e 0a20 2020 2020  o compare..     
+00004eb0: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+00004ec0: 2020 2020 2020 2020 4343 4320 7363 6f72          CCC scor
+00004ed0: 650a 2020 2020 2020 2020 5261 6973 6573  e.        Raises
+00004ee0: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00004ef0: 732e 6578 6974 3a20 496e 7075 7420 6d61  s.exit: Input ma
+00004f00: 7073 2064 6f20 6e6f 7420 6d61 7463 6820  ps do not match 
+00004f10: 696e 2073 6861 7065 2c20 7069 7865 6c20  in shape, pixel 
+00004f20: 7369 7a65 206f 7220 6f72 6967 696e 0a20  size or origin. 
+00004f30: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00004f40: 2020 2069 6620 7365 6c66 2e6d 6170 436f     if self.mapCo
+00004f50: 6d70 6172 6973 6f6e 286d 6170 5f74 6172  mparison(map_tar
+00004f60: 6765 742c 206d 6170 5f70 726f 6265 293a  get, map_probe):
+00004f70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+00004f80: 7572 6e20 280a 2020 2020 2020 2020 2020  urn (.          
+00004f90: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
+00004fa0: 2e6e 6f72 6d61 6c69 7365 2829 2e67 6574  .normalise().get
+00004fb0: 4d61 7028 292a 6d61 705f 7072 6f62 652e  Map()*map_probe.
+00004fc0: 6e6f 726d 616c 6973 6528 292e 6765 744d  normalise().getM
+00004fd0: 6170 2829 0a20 2020 2020 2020 2020 2020  ap().           
+00004fe0: 2029 2e6d 6561 6e28 290a 2020 2020 2020   ).mean().      
+00004ff0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00005000: 2020 2020 7365 6c66 2e5f 6661 696c 6564      self._failed
+00005010: 5f6d 6174 6368 2829 0a0a 2020 2020 6465  _match()..    de
+00005020: 6620 4c53 4628 7365 6c66 2c20 6d61 705f  f LSF(self, map_
+00005030: 7461 7267 6574 2c20 6d61 705f 7072 6f62  target, map_prob
+00005040: 6529 3a0a 2020 2020 2020 2020 2222 2243  e):.        """C
+00005050: 616c 6375 6c61 7465 206c 6561 7374 2d73  alculate least-s
+00005060: 7175 6172 6573 2062 6574 7765 656e 2074  quares between t
+00005070: 776f 204d 6170 2069 6e73 7461 6e63 6573  wo Map instances
+00005080: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
+00005090: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+000050a0: 2020 6d61 705f 7461 7267 6574 2c20 6d61    map_target, ma
+000050b0: 705f 7072 6f62 653a 204d 6170 2069 6e73  p_probe: Map ins
+000050c0: 7461 6e63 6520 746f 2063 6f6d 7061 7265  tance to compare
+000050d0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
+000050e0: 3a0a 2020 2020 2020 2020 2020 2020 4c65  :.            Le
+000050f0: 6173 742d 7371 7561 7265 7320 7661 6c75  ast-squares valu
+00005100: 650a 2020 2020 2020 2020 5261 6973 6573  e.        Raises
+00005110: 3a0a 2020 2020 2020 2020 2020 2020 7379  :.            sy
+00005120: 732e 6578 6974 3a20 496e 7075 7420 6d61  s.exit: Input ma
+00005130: 7073 2064 6f20 6e6f 7420 6d61 7463 6820  ps do not match 
+00005140: 696e 2073 6861 7065 2c20 7069 7865 6c20  in shape, pixel 
+00005150: 7369 7a65 206f 7220 6f72 6967 696e 0a20  size or origin. 
+00005160: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005170: 2020 2069 6620 7365 6c66 2e6d 6170 436f     if self.mapCo
+00005180: 6d70 6172 6973 6f6e 286d 6170 5f74 6172  mparison(map_tar
+00005190: 6765 742c 206d 6170 5f70 726f 6265 293a  get, map_probe):
+000051a0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+000051b0: 5f74 6172 6765 742c 206d 6170 5f70 726f  _target, map_pro
+000051c0: 6265 203d 206d 6170 5f74 6172 6765 742c  be = map_target,
+000051d0: 206d 6170 5f70 726f 6265 0a20 2020 2020   map_probe.     
+000051e0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+000051f0: 2020 2020 2073 656c 662e 5f66 6169 6c65       self._faile
+00005200: 645f 6d61 7463 6828 290a 2020 2020 2020  d_match().      
+00005210: 2020 7265 7475 726e 2028 286d 6170 5f74    return ((map_t
+00005220: 6172 6765 742e 6765 744d 6170 2829 202d  arget.getMap() -
+00005230: 206d 6170 5f70 726f 6265 2e67 6574 4d61   map_probe.getMa
+00005240: 7028 2929 2a2a 3229 2e6d 6561 6e28 290a  p())**2).mean().
+00005250: 0a20 2020 2064 6566 206c 6170 6c61 6365  .    def laplace
+00005260: 5f43 4343 280a 2020 2020 2020 2020 2020  _CCC(.          
+00005270: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00005280: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
+00005290: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+000052a0: 7072 6f62 652c 0a20 2020 2020 2020 2020  probe,.         
+000052b0: 2020 2070 7265 6669 6c3d 2846 616c 7365     prefil=(False
+000052c0: 2c20 4661 6c73 6529 0a20 2020 2029 3a0a  , False).    ):.
+000052d0: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
+000052e0: 6c61 7465 2043 4343 2062 6574 7765 656e  late CCC between
+000052f0: 2074 776f 206c 6170 6c61 6369 616e 2066   two laplacian f
+00005300: 696c 7465 7265 6420 4d61 7020 696e 7374  iltered Map inst
+00005310: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
+00005320: 5468 6520 6c61 706c 6163 6961 6e20 6669  The laplacian fi
+00005330: 6c74 6572 2069 7320 616e 2065 6467 6520  lter is an edge 
+00005340: 6465 7465 6374 696f 6e20 6669 6c74 6572  detection filter
+00005350: 2c20 7768 6963 6820 636f 6d70 7574 6573  , which computes
+00005360: 2074 6865 0a20 2020 2020 2020 2073 6563   the.        sec
+00005370: 6f6e 6420 6465 7276 6961 7469 7665 7320  ond derviatives 
+00005380: 6f66 2061 6e20 696d 6167 652f 766f 6c75  of an image/volu
+00005390: 6d65 2e20 5573 696e 6720 4c61 706c 6163  me. Using Laplac
+000053a0: 6961 6e20 6669 6c74 6572 7320 696e 0a20  ian filters in. 
+000053b0: 2020 2020 2020 2063 6f6d 6269 6e61 7469         combinati
+000053c0: 6f6e 2077 6974 6820 4343 4320 7363 6f72  on with CCC scor
+000053d0: 696e 6720 6f66 2063 7279 6f20 454d 206d  ing of cryo EM m
+000053e0: 6f64 656c 7320 2077 6173 2073 686f 776e  odels  was shown
+000053f0: 2074 6f20 6265 206d 6f72 650a 2020 2020   to be more.    
+00005400: 2020 2020 6163 6375 7261 7465 2074 6861      accurate tha
+00005410: 6e20 4343 4320 7363 6f72 696e 6720 616c  n CCC scoring al
+00005420: 6f6e 6520 666f 7220 6c6f 7720 7265 736f  one for low reso
+00005430: 6c75 7469 6f6e 206d 6170 732c 2069 6e0a  lution maps, in.
+00005440: 2020 2020 2020 2020 6028 4368 6163 6f6e          `(Chacon
+00005450: 2061 6e64 2057 7269 6767 6572 732c 2032   and Wriggers, 2
+00005460: 3030 3229 203c 6874 7470 733a 2f2f 7075  002) <https://pu
+00005470: 626d 6564 2e6e 6362 692e 6e6c 6d2e 6e69  bmed.ncbi.nlm.ni
+00005480: 682e 676f 762f 3131 3932 3236 3731 2f3e  h.gov/11922671/>
+00005490: 605f 0a0a 2020 2020 2020 2020 4172 6775  `_..        Argu
+000054a0: 6d65 6e74 733a 0a20 2020 2020 2020 2020  ments:.         
+000054b0: 2020 206d 6170 5f74 6172 6765 742c 206d     map_target, m
+000054c0: 6170 5f70 726f 6265 3a20 4d61 7020 696e  ap_probe: Map in
+000054d0: 7374 616e 6365 7320 746f 2063 6f6d 7061  stances to compa
+000054e0: 7265 2e0a 0a20 2020 2020 2020 2020 2020  re...           
+000054f0: 2070 7265 6669 6c3a 2032 2d74 7570 6c65   prefil: 2-tuple
+00005500: 206f 6620 626f 6f6c 6561 6e20 7661 6c75   of boolean valu
+00005510: 6573 2c20 6f6e 6520 666f 7220 6561 6368  es, one for each
+00005520: 206d 6170 2072 6573 7065 6374 6976 656c   map respectivel
+00005530: 792e 0a20 2020 2020 2020 2020 2020 2020  y..             
+00005540: 2020 2054 7275 6520 6966 204d 6170 2069     True if Map i
+00005550: 6e73 7461 6e63 6520 6973 2061 6c72 6561  nstance is alrea
+00005560: 6479 204c 6170 6c61 6369 616e 2d66 696c  dy Laplacian-fil
+00005570: 7465 7265 642e 2046 616c 7365 0a20 2020  tered. False.   
+00005580: 2020 2020 2020 2020 2020 2020 206f 7468               oth
+00005590: 6572 7769 7365 2e0a 2020 2020 2020 2020  erwise..        
+000055a0: 5265 7475 726e 3a0a 2020 2020 2020 2020  Return:.        
+000055b0: 2020 2020 4c61 706c 6163 6961 6e20 6372      Laplacian cr
+000055c0: 6f73 732d 636f 7272 656c 6174 696f 6e20  oss-correlation 
+000055d0: 7363 6f72 650a 2020 2020 2020 2020 5261  score.        Ra
+000055e0: 6973 6573 3a0a 2020 2020 2020 2020 2020  ises:.          
+000055f0: 2020 7379 732e 6578 6974 3a20 496e 7075    sys.exit: Inpu
+00005600: 7420 6d61 7073 2064 6f20 6e6f 7420 6d61  t maps do not ma
+00005610: 7463 6820 696e 2073 6861 7065 2c20 7069  tch in shape, pi
+00005620: 7865 6c20 7369 7a65 206f 7220 6f72 6967  xel size or orig
+00005630: 696e 0a20 2020 2020 2020 2022 2222 0a0a  in.        """..
+00005640: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
+00005650: 6d61 7043 6f6d 7061 7269 736f 6e28 6d61  mapComparison(ma
+00005660: 705f 7461 7267 6574 2c20 6d61 705f 7072  p_target, map_pr
+00005670: 6f62 6529 3a0a 2020 2020 2020 2020 2020  obe):.          
+00005680: 2020 2320 4920 646f 6e27 7420 756e 6465    # I don't unde
+00005690: 7273 7461 6e64 2074 6869 7320 2d20 6361  rstand this - ca
+000056a0: 6e20 7765 2072 6570 6c61 6365 2069 7420  n we replace it 
+000056b0: 7769 7468 2070 6173 733f 0a20 2020 2020  with pass?.     
+000056c0: 2020 2020 2020 205f 2c20 5f20 3d20 6d61         _, _ = ma
+000056d0: 705f 7461 7267 6574 2c20 6d61 705f 7072  p_target, map_pr
+000056e0: 6f62 6520 2023 206e 6f71 613a 4638 3431  obe  # noqa:F841
+000056f0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
+00005700: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00005710: 5f66 6169 6c65 645f 6d61 7463 6828 290a  _failed_match().
+00005720: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00005730: 7072 6566 696c 5b30 5d3a 0a20 2020 2020  prefil[0]:.     
+00005740: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
+00005750: 7420 3d20 6d61 705f 7461 7267 6574 2e6c  t = map_target.l
+00005760: 6170 6c61 6365 5f66 696c 7465 7265 6428  aplace_filtered(
+00005770: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+00005780: 2070 7265 6669 6c5b 315d 3a0a 2020 2020   prefil[1]:.    
+00005790: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+000057a0: 6520 3d20 6d61 705f 7072 6f62 652e 6c61  e = map_probe.la
+000057b0: 706c 6163 655f 6669 6c74 6572 6564 2829  place_filtered()
+000057c0: 0a20 2020 2020 2020 206d 6170 5f74 6172  .        map_tar
+000057d0: 6765 7420 3d20 6d61 705f 7461 7267 6574  get = map_target
+000057e0: 2e6e 6f72 6d61 6c69 7365 2829 0a20 2020  .normalise().   
+000057f0: 2020 2020 206d 6170 5f70 726f 6265 203d       map_probe =
+00005800: 206d 6170 5f70 726f 6265 2e6e 6f72 6d61   map_probe.norma
+00005810: 6c69 7365 2829 0a20 2020 2020 2020 2072  lise().        r
+00005820: 6574 7572 6e20 7365 6c66 2e43 4343 286d  eturn self.CCC(m
+00005830: 6170 5f74 6172 6765 742c 206d 6170 5f70  ap_target, map_p
+00005840: 726f 6265 290a 0a20 2020 2064 6566 206e  robe)..    def n
+00005850: 6f72 6d61 6c5f 7665 6374 6f72 5f73 636f  ormal_vector_sco
+00005860: 7265 280a 2020 2020 2020 2020 2020 2020  re(.            
+00005870: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00005880: 2020 6d61 705f 7461 7267 6574 2c0a 2020    map_target,.  
+00005890: 2020 2020 2020 2020 2020 6d61 705f 7072            map_pr
+000058a0: 6f62 652c 0a20 2020 2020 2020 2020 2020  obe,.           
+000058b0: 2070 7269 6d61 7279 5f62 6f75 6e64 6172   primary_boundar
+000058c0: 792c 0a20 2020 2020 2020 2020 2020 2073  y,.            s
+000058d0: 6563 6f6e 6461 7279 5f62 6f75 6e64 6172  econdary_boundar
+000058e0: 793d 302e 302c 0a20 2020 2020 2020 2020  y=0.0,.         
+000058f0: 2020 2046 696c 7465 723d 4e6f 6e65 2c0a     Filter=None,.
+00005900: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00005910: 2222 4361 6c63 756c 6174 6520 7468 6520  ""Calculate the 
+00005920: 4e6f 726d 616c 2056 6563 746f 7220 5363  Normal Vector Sc
+00005930: 6f72 6520 6265 7477 6565 6e20 7477 6f20  ore between two 
+00005940: 4d61 7020 7375 7266 6163 6573 2e0a 0a20  Map surfaces... 
+00005950: 2020 2020 2020 2042 6173 6564 206f 6e20         Based on 
+00005960: 3353 4f4d 2061 6c67 6f72 6974 686d 2028  3SOM algorithm (
+00005970: 4365 756c 656d 616e 7320 616e 6420 5275  Ceulemans and Ru
+00005980: 7373 656c 6c2c 2032 3030 3429 2e0a 0a20  ssell, 2004)... 
+00005990: 2020 2020 2020 2041 7267 756d 656e 7473         Arguments
+000059a0: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+000059b0: 705f 7461 7267 6574 2c20 6d61 705f 7072  p_target, map_pr
+000059c0: 6f62 653a 0a20 2020 2020 2020 2020 2020  obe:.           
+000059d0: 2020 2020 204d 6170 2069 6e73 7461 6e63       Map instanc
+000059e0: 6573 2074 6f20 636f 6d70 6172 652e 0a20  es to compare.. 
+000059f0: 2020 2020 2020 2020 2020 2070 7269 6d61             prima
+00005a00: 7279 5f62 6f75 6e64 6172 792c 2073 6563  ry_boundary, sec
+00005a10: 6f6e 6461 7279 5f62 6f75 6e64 6172 793a  ondary_boundary:
+00005a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00005a30: 2049 6620 6120 6669 6c74 6572 2069 7320   If a filter is 
+00005a40: 7365 6c65 6374 6564 2c20 6a75 7374 2069  selected, just i
+00005a50: 6e70 7574 2061 2063 6f6e 746f 7572 206c  nput a contour l
+00005a60: 6576 656c 2061 7320 7072 696d 6172 790a  evel as primary.
+00005a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005a80: 7468 7265 7368 6f6c 642e 204f 7468 6572  threshold. Other
+00005a90: 7769 7365 2c20 6e65 6564 2074 6f20 7275  wise, need to ru
+00005aa0: 6e20 6765 745f 7072 696d 6172 795f 626f  n get_primary_bo
+00005ab0: 756e 6461 7279 2061 6e64 0a20 2020 2020  undary and.     
+00005ac0: 2020 2020 2020 2020 2020 2067 6574 5f73             get_s
+00005ad0: 6563 6f6e 645f 626f 756e 6461 7279 2062  econd_boundary b
+00005ae0: 6173 6564 206f 6e20 6d61 7020 7461 7267  ased on map targ
+00005af0: 6574 2e0a 2020 2020 2020 2020 2020 2020  et..            
+00005b00: 4669 6c74 6572 3a0a 2020 2020 2020 2020  Filter:.        
+00005b10: 2020 2020 2020 2020 4669 6c74 6572 2074          Filter t
+00005b20: 6f20 6265 2061 7070 6c69 6564 2074 6f20  o be applied to 
+00005b30: 696e 7075 7473 206d 6170 7320 6265 666f  inputs maps befo
+00005b40: 7265 2063 616c 6375 6c61 7469 6e67 2073  re calculating s
+00005b50: 636f 7265 2e0a 2020 2020 2020 2020 2020  core..          
+00005b60: 2020 2020 2020 2020 2020 312e 2053 6f62            1. Sob
+00005b70: 656c 2046 696c 7465 7220 2846 696c 7465  el Filter (Filte
+00005b80: 723d 3d27 536f 6265 6c27 290a 2020 2020  r=='Sobel').    
+00005b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005ba0: 322e 204c 6170 6c61 6365 2046 696c 7465  2. Laplace Filte
+00005bb0: 7220 2846 696c 7465 723d 3d27 4c61 706c  r (Filter=='Lapl
+00005bc0: 6163 6527 290a 2020 2020 2020 2020 2020  ace').          
+00005bd0: 2020 2020 2020 2020 2020 332e 204d 696e            3. Min
+00005be0: 696d 756d 2046 696c 7465 7220 2846 696c  imum Filter (Fil
+00005bf0: 7465 723d 3d27 4d69 6e69 6d75 6d27 290a  ter=='Minimum').
+00005c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005c10: 2020 2020 342e 204d 6561 6e20 4669 6c74      4. Mean Filt
+00005c20: 6572 2028 4669 6c74 6572 3d3d 274d 6561  er (Filter=='Mea
+00005c30: 6e27 290a 2020 2020 2020 2020 2020 2020  n').            
+00005c40: 2020 2020 2020 2020 352e 204e 6f20 6669          5. No fi
+00005c50: 6c74 6572 696e 6720 2846 696c 7465 723d  ltering (Filter=
+00005c60: 3d4e 6f6e 6529 0a20 2020 2020 2020 2052  =None).        R
+00005c70: 6574 7572 6e3a 0a20 2020 2020 2020 2020  eturn:.         
+00005c80: 2020 204e 6f72 6d61 6c20 7665 6374 6f72     Normal vector
+00005c90: 2073 636f 7265 2e0a 2020 2020 2020 2020   score..        
+00005ca0: 5261 6973 6573 3a0a 2020 2020 2020 2020  Raises:.        
+00005cb0: 2020 2020 7379 732e 6578 6974 3a20 496e      sys.exit: In
+00005cc0: 7075 7420 6d61 7073 2064 6f20 6e6f 7420  put maps do not 
+00005cd0: 6d61 7463 6820 696e 2073 6861 7065 2c20  match in shape, 
+00005ce0: 7069 7865 6c20 7369 7a65 206f 7220 6f72  pixel size or or
+00005cf0: 6967 696e 0a20 2020 2020 2020 2022 2222  igin.        """
+00005d00: 0a20 2020 2020 2020 2069 6620 4669 6c74  .        if Filt
+00005d10: 6572 206e 6f74 2069 6e20 5b27 536f 6265  er not in ['Sobe
+00005d20: 6c27 2c20 274c 6170 6c61 6365 272c 2027  l', 'Laplace', '
+00005d30: 4d65 616e 272c 2027 4d69 6e69 6d75 6d27  Mean', 'Minimum'
+00005d40: 2c20 4e6f 6e65 5d3a 0a20 2020 2020 2020  , None]:.       
+00005d50: 2020 2020 2070 7269 6e74 2827 496e 636f       print('Inco
+00005d60: 7272 6563 7420 6e61 6d65 206f 6620 6669  rrect name of fi
+00005d70: 6c74 6572 3a20 2573 2220 2520 4669 6c74  lter: %s" % Filt
+00005d80: 6572 2729 0a20 2020 2020 2020 2020 2020  er').           
+00005d90: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
+00005da0: 2020 2020 2020 2020 2753 656c 6563 7420          'Select 
+00005db0: 6f6e 6520 6f66 2074 6865 2066 6f6c 6c6f  one of the follo
+00005dc0: 7769 6e67 2046 696c 7465 7273 2069 6620  wing Filters if 
+00005dd0: 6170 706c 6963 6162 6c65 3a20 2573 5c6e  applicable: %s\n
+00005de0: 2720 250a 2020 2020 2020 2020 2020 2020  ' %.            
+00005df0: 2020 2020 272c 2027 2e6a 6f69 6e28 5b27      ', '.join(['
+00005e00: 536f 6265 6c27 2c20 274c 6170 6c61 6365  Sobel', 'Laplace
+00005e10: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
+00005e20: 290a 2020 2020 2020 2020 2020 2020 7379  ).            sy
+00005e30: 732e 6578 6974 2829 0a0a 2020 2020 2020  s.exit()..      
+00005e40: 2020 7363 6f72 6573 203d 205b 5d0a 2020    scores = [].  
+00005e50: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00005e60: 662e 6d61 7043 6f6d 7061 7269 736f 6e28  f.mapComparison(
+00005e70: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
+00005e80: 7072 6f62 6529 3a0a 2020 2020 2020 2020  probe):.        
+00005e90: 2020 2020 7365 6c66 2e5f 6661 696c 6564      self._failed
+00005ea0: 5f6d 6174 6368 2829 0a20 2020 2020 2020  _match().       
+00005eb0: 2061 7373 6572 7420 6973 696e 7374 616e   assert isinstan
+00005ec0: 6365 2870 7269 6d61 7279 5f62 6f75 6e64  ce(primary_bound
+00005ed0: 6172 792c 2066 6c6f 6174 290a 2020 2020  ary, float).    
+00005ee0: 2020 2020 6173 7365 7274 2069 7369 6e73      assert isins
+00005ef0: 7461 6e63 6528 7365 636f 6e64 6172 795f  tance(secondary_
+00005f00: 626f 756e 6461 7279 2c20 666c 6f61 7429  boundary, float)
+00005f10: 0a20 2020 2020 2020 2069 6620 7072 696d  .        if prim
+00005f20: 6172 795f 626f 756e 6461 7279 203e 2073  ary_boundary > s
+00005f30: 6563 6f6e 6461 7279 5f62 6f75 6e64 6172  econdary_boundar
+00005f40: 793a 0a20 2020 2020 2020 2020 2020 2074  y:.            t
+00005f50: 656d 705f 7468 7220 3d20 7365 636f 6e64  emp_thr = second
+00005f60: 6172 795f 626f 756e 6461 7279 0a20 2020  ary_boundary.   
+00005f70: 2020 2020 2020 2020 2073 6563 6f6e 6461           seconda
+00005f80: 7279 5f62 6f75 6e64 6172 7920 3d20 7072  ry_boundary = pr
+00005f90: 696d 6172 795f 626f 756e 6461 7279 0a20  imary_boundary. 
+00005fa0: 2020 2020 2020 2020 2020 2070 7269 6d61             prima
+00005fb0: 7279 5f62 6f75 6e64 6172 7920 3d20 7465  ry_boundary = te
+00005fc0: 6d70 5f74 6872 0a0a 2020 2020 2020 2020  mp_thr..        
+00005fd0: 706f 696e 7473 203d 206e 702e 6172 6777  points = np.argw
+00005fe0: 6865 7265 280a 2020 2020 2020 2020 2020  here(.          
+00005ff0: 2020 286d 6170 5f74 6172 6765 742e 6675    (map_target.fu
+00006000: 6c6c 4d61 7020 3e20 7072 696d 6172 795f  llMap > primary_
+00006010: 626f 756e 6461 7279 2920 260a 2020 2020  boundary) &.    
+00006020: 2020 2020 2020 2020 286d 6170 5f74 6172          (map_tar
+00006030: 6765 742e 6675 6c6c 4d61 7020 3c20 7365  get.fullMap < se
+00006040: 636f 6e64 6172 795f 626f 756e 6461 7279  condary_boundary
+00006050: 290a 2020 2020 2020 2020 290a 0a20 2020  ).        )..   
+00006060: 2020 2020 2069 6620 4669 6c74 6572 203d       if Filter =
+00006070: 3d20 2753 6f62 656c 273a 0a20 2020 2020  = 'Sobel':.     
+00006080: 2020 2020 2020 206d 6170 315f 7375 7266         map1_surf
+00006090: 6163 6520 3d20 6d61 705f 7461 7267 6574  ace = map_target
+000060a0: 2e5f 736f 6265 6c5f 6669 6c74 6572 5f63  ._sobel_filter_c
+000060b0: 6f6e 746f 7572 2870 7269 6d61 7279 5f62  ontour(primary_b
+000060c0: 6f75 6e64 6172 7929 0a20 2020 2020 2020  oundary).       
+000060d0: 2020 2020 2070 6f69 6e74 7320 3d20 6e70       points = np
+000060e0: 2e61 7267 7768 6572 6528 0a20 2020 2020  .argwhere(.     
+000060f0: 2020 2020 2020 2020 2020 206d 6170 315f             map1_
+00006100: 7375 7266 6163 652e 6675 6c6c 4d61 7020  surface.fullMap 
+00006110: 3e20 286d 6170 315f 7375 7266 6163 652e  > (map1_surface.
+00006120: 6d61 7828 2920 2f20 322e 3029 0a20 2020  max() / 2.0).   
+00006130: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00006140: 2020 2065 6c69 6620 4669 6c74 6572 203d     elif Filter =
+00006150: 3d20 274c 6170 6c61 6365 273a 0a20 2020  = 'Laplace':.   
+00006160: 2020 2020 2020 2020 206d 6170 315f 7375           map1_su
+00006170: 7266 6163 6520 3d20 6d61 705f 7461 7267  rface = map_targ
+00006180: 6574 2e5f 6c61 706c 6163 655f 6669 6c74  et._laplace_filt
+00006190: 6572 6564 5f63 6f6e 746f 7572 280a 2020  ered_contour(.  
+000061a0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000061b0: 696d 6172 795f 626f 756e 6461 7279 0a20  imary_boundary. 
+000061c0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000061d0: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+000061e0: 3d20 6e70 2e61 7267 7768 6572 6528 0a20  = np.argwhere(. 
+000061f0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00006200: 6170 315f 7375 7266 6163 652e 6675 6c6c  ap1_surface.full
+00006210: 4d61 7020 3e20 286d 6170 315f 7375 7266  Map > (map1_surf
+00006220: 6163 652e 6d61 7828 2920 2f20 322e 3029  ace.max() / 2.0)
+00006230: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00006240: 2020 2020 2020 2065 6c69 6620 4669 6c74         elif Filt
+00006250: 6572 203d 3d20 274d 696e 696d 756d 273a  er == 'Minimum':
+00006260: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+00006270: 315f 7375 7266 6163 6520 3d20 6d61 705f  1_surface = map_
+00006280: 7461 7267 6574 2e5f 7375 7266 6163 655f  target._surface_
+00006290: 6d69 6e69 6d75 6d5f 6669 6c74 6572 280a  minimum_filter(.
+000062a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000062b0: 666c 6f61 7428 7072 696d 6172 795f 626f  float(primary_bo
+000062c0: 756e 6461 7279 290a 2020 2020 2020 2020  undary).        
+000062d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000062e0: 2020 706f 696e 7473 203d 206e 702e 6172    points = np.ar
+000062f0: 6777 6865 7265 286d 6170 315f 7375 7266  gwhere(map1_surf
+00006300: 6163 6520 3d3d 2031 290a 2020 2020 2020  ace == 1).      
+00006310: 2020 656c 6966 2046 696c 7465 7220 3d3d    elif Filter ==
+00006320: 2027 4d65 616e 273a 0a20 2020 2020 2020   'Mean':.       
+00006330: 2020 2020 206d 6170 315f 6669 6c74 6572       map1_filter
+00006340: 203d 206d 6170 5f74 6172 6765 742e 5f73   = map_target._s
+00006350: 7572 6661 6365 5f66 6561 7475 7265 7328  urface_features(
+00006360: 666c 6f61 7428 7072 696d 6172 795f 626f  float(primary_bo
+00006370: 756e 6461 7279 2929 0a20 2020 2020 2020  undary)).       
+00006380: 2020 2020 2062 696e 5f74 6573 7420 3d20       bin_test = 
+00006390: 5b30 2e30 3030 315d 0a20 2020 2020 2020  [0.0001].       
+000063a0: 2020 2020 2066 6f72 2069 6920 696e 2072       for ii in r
+000063b0: 616e 6765 2831 2c20 3431 293a 0a20 2020  ange(1, 41):.   
+000063c0: 2020 2020 2020 2020 2020 2020 2062 696e               bin
+000063d0: 5f74 6573 742e 6170 7065 6e64 2830 2e30  _test.append(0.0
+000063e0: 3235 202a 2069 6929 0a20 2020 2020 2020  25 * ii).       
+000063f0: 2020 2020 2066 7265 715f 7465 7374 203d       freq_test =
+00006400: 206e 702e 6869 7374 6f67 7261 6d28 6d61   np.histogram(ma
+00006410: 7031 5f66 696c 7465 722e 6675 6c6c 4d61  p1_filter.fullMa
+00006420: 702c 2062 696e 5f74 6573 7429 5b30 5d0a  p, bin_test)[0].
+00006430: 2020 2020 2020 2020 2020 2020 7375 6d5f              sum_
+00006440: 6672 6571 203d 2030 2e30 0a20 2020 2020  freq = 0.0.     
+00006450: 2020 2020 2020 2066 6f72 2066 7220 696e         for fr in
+00006460: 2072 616e 6765 286c 656e 2866 7265 715f   range(len(freq_
+00006470: 7465 7374 2929 3a0a 2020 2020 2020 2020  test)):.        
+00006480: 2020 2020 2020 2020 7375 6d5f 6672 6571          sum_freq
+00006490: 202b 3d20 666c 6f61 7428 6672 6571 5f74   += float(freq_t
+000064a0: 6573 745b 6672 5d29 0a20 2020 2020 2020  est[fr]).       
+000064b0: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+000064c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000064d0: 2020 2020 2020 7375 6d5f 6672 6571 202f        sum_freq /
+000064e0: 206e 702e 7375 6d28 6672 6571 5f74 6573   np.sum(freq_tes
+000064f0: 7429 203e 2030 2e30 3520 616e 640a 2020  t) > 0.05 and.  
+00006500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006510: 2020 2020 2020 6269 6e5f 7465 7374 5b66        bin_test[f
+00006520: 722b 315d 203e 3d20 302e 330a 2020 2020  r+1] >= 0.3.    
+00006530: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+00006540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006550: 2020 2074 3120 3d20 6269 6e5f 7465 7374     t1 = bin_test
+00006560: 5b66 722b 315d 0a20 2020 2020 2020 2020  [fr+1].         
+00006570: 2020 2020 2020 2020 2020 2062 7265 616b             break
+00006580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006590: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
+000065a0: 2020 2020 2020 2020 2020 2020 2020 7375                su
+000065b0: 6d5f 6672 6571 202f 206e 702e 6e75 6d73  m_freq / np.nums
+000065c0: 756d 2866 7265 715f 7465 7374 2920 3e20  um(freq_test) > 
+000065d0: 302e 3130 206f 720a 2020 2020 2020 2020  0.10 or.        
+000065e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000065f0: 7375 6d5f 6672 6571 203e 2031 3030 3030  sum_freq > 10000
+00006600: 300a 2020 2020 2020 2020 2020 2020 2020  0.              
+00006610: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
+00006620: 2020 2020 2020 2020 2074 3120 3d20 6269           t1 = bi
+00006630: 6e5f 7465 7374 5b66 722b 315d 0a20 2020  n_test[fr+1].   
+00006640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006650: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00006660: 2020 2070 6f69 6e74 7320 3d20 6e70 2e61     points = np.a
+00006670: 7267 7768 6572 6528 0a20 2020 2020 2020  rgwhere(.       
+00006680: 2020 2020 2020 2020 2028 6d61 7031 5f66           (map1_f
+00006690: 696c 7465 722e 6675 6c6c 4d61 7020 3e20  ilter.fullMap > 
+000066a0: 302e 3029 2026 2028 6d61 7031 5f66 696c  0.0) & (map1_fil
+000066b0: 7465 722e 6675 6c6c 4d61 7020 3c20 7431  ter.fullMap < t1
+000066c0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+000066d0: 2020 2020 2020 2020 2320 432b 2b20 6361          # C++ ca
+000066e0: 6c63 756c 6174 696f 6e0a 2020 2020 2020  lculation.      
+000066f0: 2020 666c 6167 6320 3d20 310a 2020 2020    flagc = 1.    
+00006700: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00006710: 2020 2020 2076 6563 6e6f 726d 5f74 6172       vecnorm_tar
+00006720: 6765 7420 3d20 6d61 705f 7461 7267 6574  get = map_target
+00006730: 2e5f 6765 745f 6e6f 726d 616c 5f76 6563  ._get_normal_vec
+00006740: 746f 7228 706f 696e 7473 290a 2020 2020  tor(points).    
+00006750: 2020 2020 2020 2020 7665 636e 6f72 6d5f          vecnorm_
+00006760: 7072 6f62 6520 3d20 6d61 705f 7072 6f62  probe = map_prob
+00006770: 652e 5f67 6574 5f6e 6f72 6d61 6c5f 7665  e._get_normal_ve
+00006780: 6374 6f72 2870 6f69 6e74 7329 0a20 2020  ctor(points).   
+00006790: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
+000067a0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+000067b0: 2020 2066 6c61 6763 203d 2030 0a20 2020     flagc = 0.   
+000067c0: 2020 2020 2069 6620 7665 636e 6f72 6d5f       if vecnorm_
+000067d0: 7461 7267 6574 2069 7320 4e6f 6e65 206f  target is None o
+000067e0: 7220 7665 636e 6f72 6d5f 7072 6f62 6520  r vecnorm_probe 
+000067f0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+00006800: 2020 2020 2066 6c61 6763 203d 2030 0a20       flagc = 0. 
+00006810: 2020 2020 2020 2063 7420 3d20 300a 0a20         ct = 0.. 
+00006820: 2020 2020 2020 2069 6620 666c 6167 6320         if flagc 
+00006830: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
+00006840: 2020 666f 7220 6920 696e 2072 616e 6765    for i in range
+00006850: 286c 656e 2876 6563 6e6f 726d 5f74 6172  (len(vecnorm_tar
+00006860: 6765 7429 293a 0a20 2020 2020 2020 2020  get)):.         
+00006870: 2020 2020 2020 2063 7420 2b3d 2031 0a20         ct += 1. 
+00006880: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00006890: 7665 6320 3d20 7665 636e 6f72 6d5f 7461  vec = vecnorm_ta
+000068a0: 7267 6574 5b69 5d0a 2020 2020 2020 2020  rget[i].        
+000068b0: 2020 2020 2020 2020 6f76 6563 203d 2076          ovec = v
+000068c0: 6563 6e6f 726d 5f70 726f 6265 5b69 5d0a  ecnorm_probe[i].
+000068d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000068e0: 2320 6164 6420 6d61 7820 7661 6c75 6520  # add max value 
+000068f0: 666f 7220 7265 6769 6f6e 7320 6f66 206e  for regions of n
+00006900: 756c 6c20 7661 7269 6174 696f 6e0a 2020  ull variation.  
+00006910: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006920: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00006930: 2020 2020 2020 2020 2020 206e 7665 635b             nvec[
+00006940: 305d 203d 3d20 302e 2061 6e64 0a20 2020  0] == 0. and.   
+00006950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006960: 2020 2020 206e 7665 635b 315d 203d 3d20       nvec[1] == 
+00006970: 302e 2061 6e64 0a20 2020 2020 2020 2020  0. and.         
+00006980: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00006990: 7665 635b 325d 203d 3d20 302e 0a20 2020  vec[2] == 0..   
+000069a0: 2020 2020 2020 2020 2020 2020 2029 3a0a               ):.
+000069b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069c0: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+000069d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000069e0: 2020 2020 206f 7665 635b 305d 203d 3d20       ovec[0] == 
+000069f0: 302e 2061 6e64 0a20 2020 2020 2020 2020  0. and.         
+00006a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a10: 2020 206f 7665 635b 315d 203d 3d20 302e     ovec[1] == 0.
+00006a20: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+00006a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a40: 206f 7665 635b 325d 203d 3d20 302e 300a   ovec[2] == 0.0.
+00006a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006a60: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
+00006a70: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006a80: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00006a90: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00006aa0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006ab0: 2020 2020 2020 2020 2020 7363 6f72 6573            scores
+00006ac0: 2e61 7070 656e 6428 332e 3134 290a 2020  .append(3.14).  
+00006ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ae0: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00006af0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00006b00: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00006b10: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00006b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b30: 2020 2020 2020 2020 2020 6f76 6563 5b30            ovec[0
+00006b40: 5d20 3d3d 2030 2e20 616e 640a 2020 2020  ] == 0. and.    
+00006b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b60: 2020 2020 2020 2020 6f76 6563 5b31 5d20          ovec[1] 
+00006b70: 3d3d 2030 2e20 616e 640a 2020 2020 2020  == 0. and.      
+00006b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006b90: 2020 2020 2020 6f76 6563 5b32 5d20 3d3d        ovec[2] ==
+00006ba0: 2030 2e0a 2020 2020 2020 2020 2020 2020   0..            
+00006bb0: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
+00006bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006bd0: 2020 2073 636f 7265 732e 6170 7065 6e64     scores.append
+00006be0: 2833 2e31 3429 0a20 2020 2020 2020 2020  (3.14).         
+00006bf0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+00006c00: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
+00006c10: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00006c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006c30: 2064 6f74 7072 6f64 203d 2028 0a20 2020   dotprod = (.   
 00006c40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c50: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00006c60: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00006c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006c80: 2020 2020 6966 2028 0a20 2020 2020 2020      if (.       
+00006c50: 2020 2020 2020 2020 206f 7665 635b 305d           ovec[0]
+00006c60: 202a 0a20 2020 2020 2020 2020 2020 2020   *.             
+00006c70: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00006c80: 7665 635b 305d 202b 0a20 2020 2020 2020  vec[0] +.       
 00006c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ca0: 2020 2020 206f 7665 635b 305d 203d 3d20       ovec[0] == 
-00006cb0: 302e 2061 6e64 0a20 2020 2020 2020 2020  0. and.         
-00006cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cd0: 2020 206f 7665 635b 315d 203d 3d20 302e     ovec[1] == 0.
-00006ce0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
-00006cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d00: 206f 7665 635b 325d 203d 3d20 302e 0a20   ovec[2] == 0.. 
-00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d20: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
-00006d30: 2020 2020 2020 2020 2020 2020 2020 7363                sc
-00006d40: 6f72 6573 2e61 7070 656e 6428 332e 3134  ores.append(3.14
-00006d50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006d60: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
-00006d70: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00006d80: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-00006d90: 2020 2020 2020 2020 2020 2020 646f 7470              dotp
-00006da0: 726f 6420 3d20 280a 2020 2020 2020 2020  rod = (.        
-00006db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006dc0: 2020 2020 6f76 6563 5b30 5d20 2a0a 2020      ovec[0] *.  
-00006dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006de0: 2020 2020 2020 2020 2020 6e76 6563 5b30            nvec[0
-00006df0: 5d20 2b0a 2020 2020 2020 2020 2020 2020  ] +.            
+00006ca0: 2020 2020 206f 7665 635b 315d 202a 0a20       ovec[1] *. 
+00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cc0: 2020 2020 2020 2020 2020 206e 7665 635b             nvec[
+00006cd0: 315d 202b 0a20 2020 2020 2020 2020 2020  1] +.           
+00006ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006cf0: 206f 7665 635b 325d 202a 0a20 2020 2020   ovec[2] *.     
+00006d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d10: 2020 2020 2020 206e 7665 635b 325d 0a20         nvec[2]. 
+00006d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006d30: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00006d40: 2020 2020 2020 2020 2064 656e 203d 2028           den = (
+00006d50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006d60: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00006d70: 7371 7274 286e 7665 635b 305d 2a2a 3220  sqrt(nvec[0]**2 
+00006d80: 2b20 6e76 6563 5b31 5d2a 2a32 202b 206e  + nvec[1]**2 + n
+00006d90: 7665 635b 325d 2a2a 3229 202a 0a20 2020  vec[2]**2) *.   
+00006da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006db0: 2020 2020 2020 2020 206e 702e 7371 7274           np.sqrt
+00006dc0: 286f 7665 635b 305d 2a2a 3220 2b20 6f76  (ovec[0]**2 + ov
+00006dd0: 6563 5b31 5d2a 2a32 202b 206f 7665 635b  ec[1]**2 + ovec[
+00006de0: 325d 2a2a 3229 0a20 2020 2020 2020 2020  2]**2).         
+00006df0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
 00006e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e10: 6f76 6563 5b31 5d20 2a0a 2020 2020 2020  ovec[1] *.      
-00006e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e30: 2020 2020 2020 6e76 6563 5b31 5d20 2b0a        nvec[1] +.
-00006e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e50: 2020 2020 2020 2020 2020 2020 6f76 6563              ovec
-00006e60: 5b32 5d20 2a0a 2020 2020 2020 2020 2020  [2] *.          
+00006e10: 2069 6620 6162 7328 646f 7470 726f 6420   if abs(dotprod 
+00006e20: 2d20 6465 6e29 203c 2030 2e30 3030 3031  - den) < 0.00001
+00006e30: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00006e40: 2020 2020 2020 2020 2020 616e 6720 3d20            ang = 
+00006e50: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
+00006e60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
 00006e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006e80: 2020 6e76 6563 5b32 5d0a 2020 2020 2020    nvec[2].      
-00006e90: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00006ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006eb0: 2020 2020 6465 6e20 3d20 280a 2020 2020      den = (.    
-00006ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ed0: 2020 2020 2020 2020 6e70 2e73 7172 7428          np.sqrt(
-00006ee0: 6e76 6563 5b30 5d2a 2a32 202b 206e 7665  nvec[0]**2 + nve
-00006ef0: 635b 315d 2a2a 3220 2b20 6e76 6563 5b32  c[1]**2 + nvec[2
-00006f00: 5d2a 2a32 2920 2a0a 2020 2020 2020 2020  ]**2) *.        
-00006f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006f20: 2020 2020 6e70 2e73 7172 7428 6f76 6563      np.sqrt(ovec
-00006f30: 5b30 5d2a 2a32 202b 206f 7665 635b 315d  [0]**2 + ovec[1]
-00006f40: 2a2a 3220 2b20 6f76 6563 5b32 5d2a 2a32  **2 + ovec[2]**2
-00006f50: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00006f60: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006f70: 2020 2020 2020 2020 2020 2020 6966 2061              if a
-00006f80: 6273 2864 6f74 7072 6f64 202d 2064 656e  bs(dotprod - den
-00006f90: 2920 3c20 302e 3030 3030 313a 0a20 2020  ) < 0.00001:.   
-00006fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fb0: 2020 2020 2061 6e67 203d 2030 2e30 0a20       ang = 0.0. 
-00006fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006fd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00006e80: 2020 2020 2020 616e 6720 3d20 6d61 7468        ang = math
+00006e90: 2e61 636f 7328 6d69 6e28 6d61 7828 646f  .acos(min(max(do
+00006ea0: 7470 726f 6420 2f20 6465 6e2c 202d 312e  tprod / den, -1.
+00006eb0: 3029 2c20 312e 3029 290a 2020 2020 2020  0), 1.0)).      
+00006ec0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00006ed0: 2064 656e 203d 3d20 302e 303a 0a20 2020   den == 0.0:.   
+00006ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006ef0: 2020 2020 2070 7269 6e74 2864 6f74 7072       print(dotpr
+00006f00: 6f64 2c20 6465 6e2c 206e 7665 632c 206f  od, den, nvec, o
+00006f10: 7665 6329 0a20 2020 2020 2020 2020 2020  vec).           
+00006f20: 2020 2020 2020 2020 2073 636f 7265 732e           scores.
+00006f30: 6170 7065 6e64 2861 6273 2861 6e67 2929  append(abs(ang))
+00006f40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006f50: 2065 7863 6570 7420 5661 6c75 6545 7272   except ValueErr
+00006f60: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
+00006f70: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
+00006f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00006f90: 2020 2020 2020 2027 4572 726f 723a 2041         'Error: A
+00006fa0: 6e67 6c65 2063 6f75 6c64 206e 6f74 2062  ngle could not b
+00006fb0: 6520 6361 6c63 756c 6174 6564 3a20 272c  e calculated: ',
+00006fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00006fd0: 2020 2020 2020 2020 206e 7665 632c 0a20           nvec,. 
 00006fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006ff0: 2061 6e67 203d 206d 6174 682e 6163 6f73   ang = math.acos
-00007000: 286d 696e 286d 6178 2864 6f74 7072 6f64  (min(max(dotprod
-00007010: 202f 2064 656e 2c20 2d31 2e30 292c 2031   / den, -1.0), 1
-00007020: 2e30 2929 0a20 2020 2020 2020 2020 2020  .0)).           
-00007030: 2020 2020 2020 2020 2069 6620 6465 6e20           if den 
-00007040: 3d3d 2030 2e30 3a0a 2020 2020 2020 2020  == 0.0:.        
+00006ff0: 2020 2020 2020 2027 2027 2c0a 2020 2020         ' ',.    
+00007000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007010: 2020 2020 6f76 6563 0a20 2020 2020 2020      ovec.       
+00007020: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00007030: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00007040: 6e28 7363 6f72 6573 2920 3d3d 2030 3a0a  n(scores) == 0:.
 00007050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007060: 7072 696e 7428 646f 7470 726f 642c 2064  print(dotprod, d
-00007070: 656e 2c20 6e76 6563 2c20 6f76 6563 290a  en, nvec, ovec).
-00007080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007090: 2020 2020 7363 6f72 6573 2e61 7070 656e      scores.appen
-000070a0: 6428 6162 7328 616e 6729 290a 2020 2020  d(abs(ang)).    
-000070b0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-000070c0: 7074 2056 616c 7565 4572 726f 723a 0a20  pt ValueError:. 
-000070d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000070e0: 2020 2070 7269 6e74 280a 2020 2020 2020     print(.      
-000070f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007100: 2020 2745 7272 6f72 3a20 416e 676c 6520    'Error: Angle 
-00007110: 636f 756c 6420 6e6f 7420 6265 2063 616c  could not be cal
-00007120: 6375 6c61 7465 643a 2027 2c0a 2020 2020  culated: ',.    
-00007130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007140: 2020 2020 6e76 6563 2c0a 2020 2020 2020      nvec,.      
-00007150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007160: 2020 2720 272c 0a20 2020 2020 2020 2020    ' ',.         
-00007170: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00007180: 7665 630a 2020 2020 2020 2020 2020 2020  vec.            
-00007190: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000071a0: 2020 2020 2020 6966 206c 656e 2873 636f        if len(sco
-000071b0: 7265 7329 203d 3d20 303a 0a20 2020 2020  res) == 0:.     
-000071c0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-000071d0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000071e0: 2020 2020 2020 2754 6865 7265 2061 7265        'There are
-000071f0: 206e 6f20 706f 696e 7473 2074 6f20 6265   no points to be
-00007200: 2073 636f 7265 6421 2054 6865 2074 6872   scored! The thr
-00007210: 6573 686f 6c64 2076 616c 7565 7320 6f72  eshold values or
-00007220: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-00007230: 2020 2020 2020 2720 7468 6520 6e75 6d62        ' the numb
-00007240: 6572 206f 6620 706f 696e 7473 2074 6f20  er of points to 
-00007250: 6265 2063 6f6e 7369 6465 7265 6420 6e65  be considered ne
-00007260: 6564 7320 746f 2062 6527 0a20 2020 2020  eds to be'.     
-00007270: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-00007280: 2063 6861 6e67 6564 2e27 0a20 2020 2020   changed.'.     
-00007290: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-000072a0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000072b0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-000072c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000072d0: 2020 2020 2020 2020 2020 2069 6620 7375             if su
-000072e0: 6d28 7363 6f72 6573 2920 3d3d 2030 3a0a  m(scores) == 0:.
-000072f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007300: 2020 2020 7265 7475 726e 2030 2e30 0a20      return 0.0. 
-00007310: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00007320: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00007330: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00007340: 3120 2d20 2873 756d 2873 636f 7265 7329  1 - (sum(scores)
-00007350: 202f 2028 6c65 6e28 706f 696e 7473 2920   / (len(points) 
-00007360: 2a20 332e 3134 2929 0a20 2020 2020 2020  * 3.14)).       
-00007370: 2073 636f 7265 7320 3d20 5b5d 0a20 2020   scores = [].   
-00007380: 2020 2020 2063 7431 203d 2030 0a20 2020       ct1 = 0.   
-00007390: 2020 2020 2069 6620 666c 6167 6320 3d3d       if flagc ==
-000073a0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-000073b0: 666f 7220 7620 696e 2070 6f69 6e74 733a  for v in points:
-000073c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000073d0: 206e 5f76 6563 203d 206d 6170 5f74 6172   n_vec = map_tar
-000073e0: 6765 742e 6765 745f 6e6f 726d 616c 5f76  get.get_normal_v
-000073f0: 6563 746f 7228 765b 325d 2c20 765b 315d  ector(v[2], v[1]
-00007400: 2c20 765b 305d 290a 2020 2020 2020 2020  , v[0]).        
-00007410: 2020 2020 2020 2020 6f5f 7665 6320 3d20          o_vec = 
-00007420: 6d61 705f 7072 6f62 652e 6765 745f 6e6f  map_probe.get_no
-00007430: 726d 616c 5f76 6563 746f 7228 765b 325d  rmal_vector(v[2]
-00007440: 2c20 765b 315d 2c20 765b 305d 290a 2020  , v[1], v[0]).  
-00007450: 2020 2020 2020 2020 2020 2020 2020 6374                ct
-00007460: 3120 2b3d 2031 0a20 2020 2020 2020 2020  1 += 1.         
-00007470: 2020 2020 2020 2069 6620 280a 2020 2020         if (.    
-00007480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007490: 6e5f 7665 632e 7820 3d3d 202d 3920 616e  n_vec.x == -9 an
-000074a0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000074b0: 2020 2020 2020 6e5f 7665 632e 7920 3d3d        n_vec.y ==
-000074c0: 202d 3920 616e 640a 2020 2020 2020 2020   -9 and.        
-000074d0: 2020 2020 2020 2020 2020 2020 6e5f 7665              n_ve
-000074e0: 632e 7a20 3d3d 202d 390a 2020 2020 2020  c.z == -9.      
-000074f0: 2020 2020 2020 2020 2020 293a 0a20 2020            ):.   
-00007500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007510: 2069 6620 280a 2020 2020 2020 2020 2020   if (.          
-00007520: 2020 2020 2020 2020 2020 2020 2020 6f5f                o_
-00007530: 7665 632e 7820 3d3d 202d 3920 616e 640a  vec.x == -9 and.
-00007540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007550: 2020 2020 2020 2020 6f5f 7665 632e 7920          o_vec.y 
-00007560: 3d3d 202d 3920 616e 640a 2020 2020 2020  == -9 and.      
+00007060: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+00007070: 2020 2020 2020 2020 2020 2027 5468 6572             'Ther
+00007080: 6520 6172 6520 6e6f 2070 6f69 6e74 7320  e are no points 
+00007090: 746f 2062 6520 7363 6f72 6564 2120 5468  to be scored! Th
+000070a0: 6520 7468 7265 7368 6f6c 6420 7661 6c75  e threshold valu
+000070b0: 6573 206f 7227 0a20 2020 2020 2020 2020  es or'.         
+000070c0: 2020 2020 2020 2020 2020 2027 2074 6865             ' the
+000070d0: 206e 756d 6265 7220 6f66 2070 6f69 6e74   number of point
+000070e0: 7320 746f 2062 6520 636f 6e73 6964 6572  s to be consider
+000070f0: 6564 206e 6565 6473 2074 6f20 6265 270a  ed needs to be'.
+00007100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007110: 2020 2020 2720 6368 616e 6765 642e 270a      ' changed.'.
+00007120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00007140: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+00007150: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00007160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007170: 6966 2073 756d 2873 636f 7265 7329 203d  if sum(scores) =
+00007180: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00007190: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000071a0: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
+000071b0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000071c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000071d0: 7475 726e 2031 202d 2028 7375 6d28 7363  turn 1 - (sum(sc
+000071e0: 6f72 6573 2920 2f20 286c 656e 2870 6f69  ores) / (len(poi
+000071f0: 6e74 7329 202a 2033 2e31 3429 290a 2020  nts) * 3.14)).  
+00007200: 2020 2020 2020 7363 6f72 6573 203d 205b        scores = [
+00007210: 5d0a 2020 2020 2020 2020 6374 3120 3d20  ].        ct1 = 
+00007220: 300a 2020 2020 2020 2020 6966 2066 6c61  0.        if fla
+00007230: 6763 203d 3d20 303a 0a20 2020 2020 2020  gc == 0:.       
+00007240: 2020 2020 2066 6f72 2076 2069 6e20 706f       for v in po
+00007250: 696e 7473 3a0a 2020 2020 2020 2020 2020  ints:.          
+00007260: 2020 2020 2020 6e5f 7665 6320 3d20 6d61        n_vec = ma
+00007270: 705f 7461 7267 6574 2e67 6574 5f6e 6f72  p_target.get_nor
+00007280: 6d61 6c5f 7665 6374 6f72 2876 5b32 5d2c  mal_vector(v[2],
+00007290: 2076 5b31 5d2c 2076 5b30 5d29 0a20 2020   v[1], v[0]).   
+000072a0: 2020 2020 2020 2020 2020 2020 206f 5f76               o_v
+000072b0: 6563 203d 206d 6170 5f70 726f 6265 2e67  ec = map_probe.g
+000072c0: 6574 5f6e 6f72 6d61 6c5f 7665 6374 6f72  et_normal_vector
+000072d0: 2876 5b32 5d2c 2076 5b31 5d2c 2076 5b30  (v[2], v[1], v[0
+000072e0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+000072f0: 2020 2063 7431 202b 3d20 310a 2020 2020     ct1 += 1.    
+00007300: 2020 2020 2020 2020 2020 2020 6966 2028              if (
+00007310: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00007320: 2020 2020 206e 5f76 6563 2e78 203d 3d20       n_vec.x == 
+00007330: 2d39 2061 6e64 0a20 2020 2020 2020 2020  -9 and.         
+00007340: 2020 2020 2020 2020 2020 206e 5f76 6563             n_vec
+00007350: 2e79 203d 3d20 2d39 2061 6e64 0a20 2020  .y == -9 and.   
+00007360: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007370: 206e 5f76 6563 2e7a 203d 3d20 2d39 0a20   n_vec.z == -9. 
+00007380: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00007390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000073a0: 2020 2020 2020 6966 2028 0a20 2020 2020        if (.     
+000073b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000073c0: 2020 206f 5f76 6563 2e78 203d 3d20 2d39     o_vec.x == -9
+000073d0: 2061 6e64 0a20 2020 2020 2020 2020 2020   and.           
+000073e0: 2020 2020 2020 2020 2020 2020 206f 5f76               o_v
+000073f0: 6563 2e79 203d 3d20 2d39 2061 6e64 0a20  ec.y == -9 and. 
+00007400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007410: 2020 2020 2020 206f 5f76 6563 2e7a 203d         o_vec.z =
+00007420: 3d20 2d39 0a20 2020 2020 2020 2020 2020  = -9.           
+00007430: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+00007440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007450: 2020 2020 636f 6e74 696e 7565 0a20 2020      continue.   
+00007460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007470: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00007480: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00007490: 636f 7265 732e 6170 7065 6e64 2833 2e31  cores.append(3.1
+000074a0: 3429 0a20 2020 2020 2020 2020 2020 2020  4).             
+000074b0: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+000074c0: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+000074d0: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+000074e0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+000074f0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00007500: 2020 2020 2020 2020 2020 206f 5f76 6563             o_vec
+00007510: 2e78 203d 3d20 2d39 2061 6e64 0a20 2020  .x == -9 and.   
+00007520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007530: 2020 2020 206f 5f76 6563 2e79 203d 3d20       o_vec.y == 
+00007540: 2d39 2061 6e64 0a20 2020 2020 2020 2020  -9 and.         
+00007550: 2020 2020 2020 2020 2020 2020 2020 206f                 o
+00007560: 5f76 6563 2e7a 203d 3d20 2d39 0a20 2020  _vec.z == -9.   
 00007570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007580: 2020 6f5f 7665 632e 7a20 3d3d 202d 390a    o_vec.z == -9.
-00007590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000075a0: 2020 2020 293a 0a20 2020 2020 2020 2020      ):.         
-000075b0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-000075c0: 6f6e 7469 6e75 650a 2020 2020 2020 2020  ontinue.        
-000075d0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000075e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007580: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+00007590: 2020 2020 2020 2020 2020 2020 7363 6f72              scor
+000075a0: 6573 2e61 7070 656e 6428 332e 3134 290a  es.append(3.14).
+000075b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000075c0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+000075d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000075e0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
 000075f0: 2020 2020 2020 2020 2020 7363 6f72 6573            scores
-00007600: 2e61 7070 656e 6428 332e 3134 290a 2020  .append(3.14).  
-00007610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007620: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
-00007630: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00007640: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00007650: 2020 2020 2020 2020 2069 6620 280a 2020           if (.  
+00007600: 2e61 7070 656e 6428 6162 7328 6e5f 7665  .append(abs(n_ve
+00007610: 632e 6172 6728 6f5f 7665 6329 2929 0a20  c.arg(o_vec))). 
+00007620: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00007630: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
+00007640: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00007650: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
 00007660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007670: 2020 2020 2020 6f5f 7665 632e 7820 3d3d        o_vec.x ==
-00007680: 202d 3920 616e 640a 2020 2020 2020 2020   -9 and.        
+00007670: 2020 2020 2027 4572 726f 723a 2041 6e67       'Error: Ang
+00007680: 6c65 2062 6574 7765 656e 2027 202b 0a20  le between ' +. 
 00007690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000076a0: 6f5f 7665 632e 7920 3d3d 202d 3920 616e  o_vec.y == -9 an
-000076b0: 640a 2020 2020 2020 2020 2020 2020 2020  d.              
-000076c0: 2020 2020 2020 2020 2020 6f5f 7665 632e            o_vec.
-000076d0: 7a20 3d3d 202d 390a 2020 2020 2020 2020  z == -9.        
-000076e0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-000076f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007700: 2020 2020 2020 2073 636f 7265 732e 6170         scores.ap
-00007710: 7065 6e64 2833 2e31 3429 0a20 2020 2020  pend(3.14).     
-00007720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007730: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-00007740: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-00007750: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00007760: 2020 2020 2073 636f 7265 732e 6170 7065       scores.appe
-00007770: 6e64 2861 6273 286e 5f76 6563 2e61 7267  nd(abs(n_vec.arg
-00007780: 286f 5f76 6563 2929 290a 2020 2020 2020  (o_vec))).      
-00007790: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000077a0: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
-000077b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077c0: 2070 7269 6e74 280a 2020 2020 2020 2020   print(.        
-000077d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000077e0: 2745 7272 6f72 3a20 416e 676c 6520 6265  'Error: Angle be
-000077f0: 7477 6565 6e20 2720 2b0a 2020 2020 2020  tween ' +.      
-00007800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007810: 2020 7374 7228 6e5f 7665 6329 202b 0a20    str(n_vec) +. 
-00007820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007830: 2020 2020 2020 2027 2c20 2720 2b0a 2020         ', ' +.  
-00007840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007850: 2020 2020 2020 7374 7228 6f5f 7665 6329        str(o_vec)
-00007860: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
-00007870: 2020 2020 2020 2020 2020 2027 2066 6f72             ' for
-00007880: 2070 6f69 6e74 2025 642c 2025 642c 2025   point %d, %d, %
-00007890: 6420 6361 6e6e 6f74 2062 6520 6361 6c63  d cannot be calc
-000078a0: 756c 6174 6564 2e27 2025 0a20 2020 2020  ulated.' %.     
+000076a0: 2020 2020 2020 2073 7472 286e 5f76 6563         str(n_vec
+000076b0: 2920 2b0a 2020 2020 2020 2020 2020 2020  ) +.            
+000076c0: 2020 2020 2020 2020 2020 2020 272c 2027              ', '
+000076d0: 202b 0a20 2020 2020 2020 2020 2020 2020   +.             
+000076e0: 2020 2020 2020 2020 2020 2073 7472 286f             str(o
+000076f0: 5f76 6563 2920 2b0a 2020 2020 2020 2020  _vec) +.        
+00007700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007710: 2720 666f 7220 706f 696e 7420 2564 2c20  ' for point %d, 
+00007720: 2564 2c20 2564 2063 616e 6e6f 7420 6265  %d, %d cannot be
+00007730: 2063 616c 6375 6c61 7465 642e 2720 250a   calculated.' %.
+00007740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007750: 2020 2020 2020 2020 2876 2e78 2c20 762e          (v.x, v.
+00007760: 792c 2076 2e7a 290a 2020 2020 2020 2020  y, v.z).        
+00007770: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00007780: 2020 2020 2020 6966 206c 656e 2873 636f        if len(sco
+00007790: 7265 7329 203d 3d20 303a 0a20 2020 2020  res) == 0:.     
+000077a0: 2020 2020 2020 2070 7269 6e74 280a 2020         print(.  
+000077b0: 2020 2020 2020 2020 2020 2020 2020 2754                'T
+000077c0: 6865 7265 2061 7265 206e 6f20 706f 696e  here are no poin
+000077d0: 7473 2074 6f20 6265 2073 636f 7265 6421  ts to be scored!
+000077e0: 2054 6865 2074 6872 6573 686f 6c64 2076   The threshold v
+000077f0: 616c 7565 7320 6f72 2027 0a20 2020 2020  alues or '.     
+00007800: 2020 2020 2020 2020 2020 2027 7468 6520             'the 
+00007810: 6e75 6d62 6572 206f 6620 706f 696e 7473  number of points
+00007820: 2074 6f20 6265 2063 6f6e 7369 6465 7265   to be considere
+00007830: 6420 6e65 6564 7320 746f 2062 6520 6368  d needs to be ch
+00007840: 616e 6765 642e 270a 2020 2020 2020 2020  anged.'.        
+00007850: 2020 2020 290a 2020 2020 2020 2020 656c      ).        el
+00007860: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00007870: 6966 2073 756d 2873 636f 7265 7329 203d  if sum(scores) =
+00007880: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00007890: 2020 2020 2072 6574 7572 6e20 300a 2020       return 0.  
+000078a0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
 000078b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000078c0: 2020 2028 762e 782c 2076 2e79 2c20 762e     (v.x, v.y, v.
-000078d0: 7a29 0a20 2020 2020 2020 2020 2020 2020  z).             
-000078e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000078f0: 2069 6620 6c65 6e28 7363 6f72 6573 2920   if len(scores) 
-00007900: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-00007910: 2020 7072 696e 7428 0a20 2020 2020 2020    print(.       
-00007920: 2020 2020 2020 2020 2027 5468 6572 6520           'There 
-00007930: 6172 6520 6e6f 2070 6f69 6e74 7320 746f  are no points to
-00007940: 2062 6520 7363 6f72 6564 2120 5468 6520   be scored! The 
-00007950: 7468 7265 7368 6f6c 6420 7661 6c75 6573  threshold values
-00007960: 206f 7220 270a 2020 2020 2020 2020 2020   or '.          
-00007970: 2020 2020 2020 2774 6865 206e 756d 6265        'the numbe
-00007980: 7220 6f66 2070 6f69 6e74 7320 746f 2062  r of points to b
-00007990: 6520 636f 6e73 6964 6572 6564 206e 6565  e considered nee
-000079a0: 6473 2074 6f20 6265 2063 6861 6e67 6564  ds to be changed
-000079b0: 2e27 0a20 2020 2020 2020 2020 2020 2029  .'.            )
-000079c0: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-000079d0: 2020 2020 2020 2020 2020 2069 6620 7375             if su
-000079e0: 6d28 7363 6f72 6573 2920 3d3d 2030 3a0a  m(scores) == 0:.
-000079f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00007a00: 7265 7475 726e 2030 0a20 2020 2020 2020  return 0.       
-00007a10: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-00007a20: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00007a30: 6e20 3120 2d20 2873 756d 2873 636f 7265  n 1 - (sum(score
-00007a40: 7329 202f 2028 6c65 6e28 706f 696e 7473  s) / (len(points
-00007a50: 2920 2a20 332e 3134 2929 0a0a 2020 2020  ) * 3.14))..    
-00007a60: 6465 6620 6765 745f 7061 7274 6961 6c5f  def get_partial_
-00007a70: 444c 5346 280a 2020 2020 2020 2020 2020  DLSF(.          
-00007a80: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00007a90: 2020 2020 6e75 6d5f 6f66 5f70 6f69 6e74      num_of_point
-00007aa0: 732c 0a20 2020 2020 2020 2020 2020 206d  s,.            m
-00007ab0: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
-00007ac0: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
-00007ad0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00007ae0: 2222 2243 616c 6375 6c61 7465 2074 6865  """Calculate the
-00007af0: 2044 4c53 4620 7363 6f72 6520 6265 7477   DLSF score betw
-00007b00: 6565 6e20 7477 6f20 4d61 7020 696e 7374  een two Map inst
-00007b10: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
-00007b20: 5468 6520 444c 5346 2069 7320 7369 6d69  The DLSF is simi
-00007b30: 6c61 7220 746f 2074 6865 204c 5346 3b0a  lar to the LSF;.
-00007b40: 2020 2020 2020 2020 7768 6572 6561 7320          whereas 
-00007b50: 7468 6520 4c53 4620 636f 6d70 6172 6573  the LSF compares
-00007b60: 2061 6273 6f6c 7574 6520 6465 6e73 6974   absolute densit
-00007b70: 7920 7661 6c75 6573 2c0a 2020 2020 2020  y values,.      
-00007b80: 2020 7468 6520 444c 5346 2063 6f6d 7061    the DLSF compa
-00007b90: 7265 7320 7468 6520 6469 6666 6572 656e  res the differen
-00007ba0: 6365 2062 6574 7765 656e 2070 6169 7273  ce between pairs
-00007bb0: 206f 6620 7661 6c75 6573 2e0a 0a20 2020   of values...   
-00007bc0: 2020 2020 2041 7267 756d 656e 7473 3a0a       Arguments:.
-00007bd0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-00007be0: 7461 7267 6574 2c20 6d61 705f 7072 6f62  target, map_prob
-00007bf0: 653a 204d 6170 2069 6e73 7461 6e63 6573  e: Map instances
-00007c00: 2074 6f20 636f 6d70 6172 652e 0a20 2020   to compare..   
-00007c10: 2020 2020 2020 2020 206e 756d 5f6f 665f           num_of_
-00007c20: 706f 696e 7473 3a20 4e75 6d62 6572 206f  points: Number o
-00007c30: 6620 7369 676e 6966 6963 616e 7420 706f  f significant po
-00007c40: 696e 7473 2e0a 2020 2020 2020 2020 5265  ints..        Re
-00007c50: 7475 726e 3a0a 2020 2020 2020 2020 2020  turn:.          
-00007c60: 2020 444c 5346 2073 636f 7265 2c20 6f72    DLSF score, or
-00007c70: 2073 7472 696e 6720 2263 616e 2774 206d   string "can't m
-00007c80: 6174 6368 2074 6865 206d 6170 2220 6966  atch the map" if
-00007c90: 2049 6e70 7574 206d 6170 7320 646f 206e   Input maps do n
-00007ca0: 6f74 0a20 2020 2020 2020 2020 2020 206d  ot.            m
-00007cb0: 6174 6368 2069 6e20 7368 6170 652c 2070  atch in shape, p
-00007cc0: 6978 656c 2073 697a 6520 6f72 206f 7269  ixel size or ori
-00007cd0: 6769 6e0a 2020 2020 2020 2020 2222 220a  gin.        """.
-00007ce0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00007cf0: 7365 6c66 2e6d 6170 436f 6d70 6172 6973  self.mapComparis
-00007d00: 6f6e 286d 6170 5f74 6172 6765 742c 206d  on(map_target, m
-00007d10: 6170 5f70 726f 6265 293a 0a20 2020 2020  ap_probe):.     
-00007d20: 2020 2020 2020 2072 6574 7572 6e20 2263         return "c
-00007d30: 616e 2774 204d 6174 6368 2074 6865 206d  an't Match the m
-00007d40: 6170 220a 0a20 2020 2020 2020 206d 6170  ap"..        map
-00007d50: 5f74 6172 6765 745f 7369 675f 7061 6972  _target_sig_pair
-00007d60: 7320 3d20 6d61 705f 7461 7267 6574 2e5f  s = map_target._
-00007d70: 6765 745f 7261 6e64 6f6d 5f73 6967 6e69  get_random_signi
-00007d80: 6669 6361 6e74 5f70 6169 7273 280a 2020  ficant_pairs(.  
-00007d90: 2020 2020 2020 2020 2020 696e 7428 6e75            int(nu
-00007da0: 6d5f 6f66 5f70 6f69 6e74 7329 0a20 2020  m_of_points).   
-00007db0: 2020 2020 2029 0a20 2020 2020 2020 206f       ).        o
-00007dc0: 7468 6572 4d61 7020 3d20 6d61 705f 7072  therMap = map_pr
-00007dd0: 6f62 650a 2020 2020 2020 2020 7363 6f72  obe.        scor
-00007de0: 6520 3d20 302e 300a 2020 2020 2020 2020  e = 0.0.        
-00007df0: 666f 7220 7020 696e 206d 6170 5f74 6172  for p in map_tar
-00007e00: 6765 745f 7369 675f 7061 6972 733a 0a20  get_sig_pairs:. 
-00007e10: 2020 2020 2020 2020 2020 207a 3120 3d20             z1 = 
-00007e20: 705b 305d 0a20 2020 2020 2020 2020 2020  p[0].           
-00007e30: 2079 3120 3d20 705b 315d 0a20 2020 2020   y1 = p[1].     
-00007e40: 2020 2020 2020 2078 3120 3d20 705b 325d         x1 = p[2]
-00007e50: 0a20 2020 2020 2020 2020 2020 207a 3220  .            z2 
-00007e60: 3d20 705b 335d 0a20 2020 2020 2020 2020  = p[3].         
-00007e70: 2020 2079 3220 3d20 705b 345d 0a20 2020     y2 = p[4].   
-00007e80: 2020 2020 2020 2020 2078 3220 3d20 705b           x2 = p[
-00007e90: 355d 0a20 2020 2020 2020 2020 2020 2064  5].            d
-00007ea0: 656e 7320 3d20 705b 365d 0a20 2020 2020  ens = p[6].     
-00007eb0: 2020 2020 2020 2070 726f 745f 6465 6e73         prot_dens
-00007ec0: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00007ed0: 2020 2020 206f 7468 6572 4d61 702e 6675       otherMap.fu
-00007ee0: 6c6c 4d61 705b 7a31 5d5b 7931 5d5b 7831  llMap[z1][y1][x1
-00007ef0: 5d20 2d20 6f74 6865 724d 6170 2e66 756c  ] - otherMap.ful
-00007f00: 6c4d 6170 5b7a 325d 5b79 325d 5b78 325d  lMap[z2][y2][x2]
-00007f10: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-00007f20: 2020 2020 2020 2020 2020 2073 636f 7265             score
-00007f30: 202b 3d20 2864 656e 7320 2d20 7072 6f74   += (dens - prot
-00007f40: 5f64 656e 7329 2a2a 320a 2020 2020 2020  _dens)**2.      
-00007f50: 2020 7265 7475 726e 2073 636f 7265 202f    return score /
-00007f60: 206d 6170 5f74 6172 6765 742e 6675 6c6c   map_target.full
-00007f70: 4d61 702e 7369 7a65 0a0a 2020 2020 6465  Map.size..    de
-00007f80: 6620 5f4d 4928 7365 6c66 2c20 6d61 705f  f _MI(self, map_
-00007f90: 7461 7267 6574 2c20 6d61 705f 7072 6f62  target, map_prob
-00007fa0: 652c 206c 6179 6572 733d 3230 293a 0a20  e, layers=20):. 
-00007fb0: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
-00007fc0: 6174 6520 7468 6520 6d75 7475 616c 2069  ate the mutual i
-00007fd0: 6e66 6f72 6d61 7469 6f6e 2073 636f 7265  nformation score
-00007fe0: 2062 6574 7765 656e 2074 776f 204d 6170   between two Map
-00007ff0: 732e 0a0a 2020 2020 2020 2020 4f6c 6420  s...        Old 
-00008000: 7665 7273 696f 6e20 6f66 2074 6865 2073  version of the s
-00008010: 636f 7265 3f0a 0a20 2020 2020 2020 2041  core?..        A
-00008020: 7267 756d 656e 7473 3a0a 2020 2020 2020  rguments:.      
-00008030: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
-00008040: 2c20 6d61 705f 7072 6f62 653a 204d 6170  , map_probe: Map
-00008050: 2069 6e73 7461 6e63 6573 2074 6f20 636f   instances to co
-00008060: 6d70 6172 652e 0a0a 2020 2020 2020 2020  mpare...        
-00008070: 2020 2020 6c61 7965 7273 3a20 4e75 6d62      layers: Numb
-00008080: 6572 206f 6620 6c61 7965 7273 2075 7365  er of layers use
-00008090: 6420 746f 2062 696e 2074 6865 206d 6170  d to bin the map
-000080a0: 2e20 4465 6661 756c 7420 6973 2032 3020  . Default is 20 
-000080b0: 6173 2069 6e0a 2020 2020 2020 2020 2020  as in.          
-000080c0: 2020 2020 2020 5368 6174 736b 7920 6574        Shatsky et
-000080d0: 2061 6c2e 2c20 3230 3038 2e0a 2020 2020   al., 2008..    
-000080e0: 2020 2020 5265 7475 726e 3a20 4d49 2073      Return: MI s
-000080f0: 636f 7265 0a20 2020 2020 2020 2052 6169  core.        Rai
-00008100: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
-00008110: 2073 7973 2e65 7869 743a 2049 6e70 7574   sys.exit: Input
-00008120: 206d 6170 7320 646f 206e 6f74 206d 6174   maps do not mat
-00008130: 6368 2069 6e20 7368 6170 652c 2070 6978  ch in shape, pix
-00008140: 656c 2073 697a 6520 6f72 206f 7269 6769  el size or origi
-00008150: 6e0a 2020 2020 2020 2020 2222 220a 0a20  n.        """.. 
-00008160: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
-00008170: 6170 436f 6d70 6172 6973 6f6e 286d 6170  apComparison(map
-00008180: 5f74 6172 6765 742c 206d 6170 5f70 726f  _target, map_pro
-00008190: 6265 293a 0a20 2020 2020 2020 2020 2020  be):.           
-000081a0: 206d 312c 206d 3220 3d20 6d61 705f 7461   m1, m2 = map_ta
-000081b0: 7267 6574 2c20 6d61 705f 7072 6f62 650a  rget, map_probe.
-000081c0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000081d0: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-000081e0: 6661 696c 6564 5f6d 6174 6368 2829 0a20  failed_match(). 
-000081f0: 2020 2020 2020 2073 636f 7265 203d 2030         score = 0
-00008200: 0a20 2020 2020 2020 206d 315f 6c65 7665  .        m1_leve
-00008210: 6c73 203d 2028 6d31 2e6d 6178 2829 202d  ls = (m1.max() -
-00008220: 206d 312e 6d69 6e28 2929 202f 206c 6179   m1.min()) / lay
-00008230: 6572 730a 2020 2020 2020 2020 6d32 5f6c  ers.        m2_l
-00008240: 6576 656c 7320 3d20 286d 322e 6d61 7828  evels = (m2.max(
-00008250: 2920 2d20 6d32 2e6d 696e 2829 2920 2f20  ) - m2.min()) / 
-00008260: 6c61 7965 7273 0a20 2020 2020 2020 2066  layers.        f
-00008270: 6f72 2078 2069 6e20 7261 6e67 6528 6c61  or x in range(la
-00008280: 7965 7273 293a 0a20 2020 2020 2020 2020  yers):.         
-00008290: 2020 2066 6f72 2079 2069 6e20 7261 6e67     for y in rang
-000082a0: 6528 6c61 7965 7273 293a 0a20 2020 2020  e(layers):.     
-000082b0: 2020 2020 2020 2020 2020 206d 315f 6c65             m1_le
-000082c0: 7665 6c5f 6d61 7020 3d20 280a 2020 2020  vel_map = (.    
-000082d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000082e0: 2020 2020 286d 312e 6765 744d 6170 2829      (m1.getMap()
-000082f0: 203e 3d20 6d31 2e6d 696e 2829 202b 2028   >= m1.min() + (
-00008300: 7820 2a20 6d31 5f6c 6576 656c 7329 2920  x * m1_levels)) 
-00008310: 2a0a 2020 2020 2020 2020 2020 2020 2020  *.              
-00008320: 2020 2020 2020 2020 2020 286d 312e 6765            (m1.ge
-00008330: 744d 6170 2829 203c 3d20 6d31 2e6d 696e  tMap() <= m1.min
-00008340: 2829 202b 2028 2878 202b 2031 2920 2a20  () + ((x + 1) * 
-00008350: 6d31 5f6c 6576 656c 7329 290a 2020 2020  m1_levels)).    
-00008360: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00008370: 2020 2020 2020 2020 2020 2020 2020 6d32                m2
-00008380: 5f6c 6576 656c 5f6d 6170 203d 2028 0a20  _level_map = (. 
-00008390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000083a0: 2020 2020 2020 2028 6d32 2e67 6574 4d61         (m2.getMa
-000083b0: 7028 2920 3e3d 206d 322e 6d69 6e28 2920  p() >= m2.min() 
-000083c0: 2b20 2879 202a 206d 325f 6c65 7665 6c73  + (y * m2_levels
-000083d0: 2929 202a 0a20 2020 2020 2020 2020 2020  )) *.           
-000083e0: 2020 2020 2020 2020 2020 2020 2028 6d32               (m2
-000083f0: 2e67 6574 4d61 7028 2920 3c3d 206d 322e  .getMap() <= m2.
-00008400: 6d69 6e28 2920 2b20 2828 7920 2b20 3129  min() + ((y + 1)
-00008410: 202a 206d 325f 6c65 7665 6c73 2929 0a20   * m2_levels)). 
-00008420: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00008430: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008440: 2063 6f6d 625f 6c65 7665 6c5f 6d61 7020   comb_level_map 
-00008450: 3d20 6d31 5f6c 6576 656c 5f6d 6170 2a6d  = m1_level_map*m
-00008460: 325f 6c65 7665 6c5f 6d61 700a 2020 2020  2_level_map.    
-00008470: 2020 2020 2020 2020 2020 2020 705f 6d31              p_m1
-00008480: 203d 2066 6c6f 6174 286d 315f 6c65 7665   = float(m1_leve
-00008490: 6c5f 6d61 702e 7375 6d28 2929 2f6d 315f  l_map.sum())/m1_
-000084a0: 6c65 7665 6c5f 6d61 702e 7369 7a65 0a20  level_map.size. 
-000084b0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000084c0: 5f6d 3220 3d20 666c 6f61 7428 6d32 5f6c  _m2 = float(m2_l
-000084d0: 6576 656c 5f6d 6170 2e73 756d 2829 292f  evel_map.sum())/
-000084e0: 6d32 5f6c 6576 656c 5f6d 6170 2e73 697a  m2_level_map.siz
-000084f0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00008500: 2020 705f 636f 6d62 203d 2066 6c6f 6174    p_comb = float
-00008510: 2863 6f6d 625f 6c65 7665 6c5f 6d61 702e  (comb_level_map.
-00008520: 7375 6d28 2929 2f63 6f6d 625f 6c65 7665  sum())/comb_leve
-00008530: 6c5f 6d61 702e 7369 7a65 0a20 2020 2020  l_map.size.     
-00008540: 2020 2020 2020 2020 2020 2069 6620 705f             if p_
-00008550: 636f 6d62 203d 3d20 303a 0a20 2020 2020  comb == 0:.     
-00008560: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00008570: 695f 7363 6f72 6520 3d20 302e 300a 2020  i_score = 0.0.  
-00008580: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00008590: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000085a0: 2020 2020 2020 2020 6d69 5f73 636f 7265          mi_score
-000085b0: 203d 2070 5f63 6f6d 6220 2a20 6d61 7468   = p_comb * math
-000085c0: 2e6c 6f67 2870 5f63 6f6d 6220 2f20 2870  .log(p_comb / (p
-000085d0: 5f6d 3120 2a20 705f 6d32 292c 2032 290a  _m1 * p_m2), 2).
-000085e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000085f0: 7363 6f72 6520 2b3d 206d 695f 7363 6f72  score += mi_scor
-00008600: 650a 2020 2020 2020 2020 7265 7475 726e  e.        return
-00008610: 2073 636f 7265 0a0a 2020 2020 6465 6620   score..    def 
-00008620: 5f4d 495f 4328 0a20 2020 2020 2020 2020  _MI_C(.         
-00008630: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00008640: 2020 2020 206d 312c 0a20 2020 2020 2020       m1,.       
-00008650: 2020 2020 206d 322c 0a20 2020 2020 2020       m2,.       
-00008660: 2020 2020 206c 6179 6572 7331 3d32 302c       layers1=20,
-00008670: 0a20 2020 2020 2020 2020 2020 206c 6179  .            lay
-00008680: 6572 7332 3d32 302c 0a20 2020 2020 2020  ers2=20,.       
-00008690: 2020 2020 204e 3d30 2c0a 2020 2020 2020       N=0,.      
-000086a0: 2020 2020 2020 6c63 313d 302e 302c 0a20        lc1=0.0,. 
-000086b0: 2020 2020 2020 2020 2020 206c 6332 3d30             lc2=0
-000086c0: 2e30 2c0a 2020 2020 293a 0a20 2020 2020  .0,.    ):.     
-000086d0: 2020 2061 7272 3120 3d20 286d 3129 2e76     arr1 = (m1).v
-000086e0: 6965 7728 666c 6f61 7429 0a20 2020 2020  iew(float).     
-000086f0: 2020 2061 7272 3220 3d20 286d 3229 2e76     arr2 = (m2).v
-00008700: 6965 7728 666c 6f61 7429 0a20 2020 2020  iew(float).     
-00008710: 2020 2072 6574 7572 6e20 5f4d 495f 435f     return _MI_C_
-00008720: 6865 6c70 6572 5f6e 6577 2861 7272 312c  helper_new(arr1,
-00008730: 2061 7272 322c 206c 6179 6572 7331 2c20   arr2, layers1, 
-00008740: 6c61 7965 7273 322c 204e 2c20 6c63 312c  layers2, N, lc1,
-00008750: 206c 6332 290a 0a20 2020 2064 6566 204d   lc2)..    def M
-00008760: 4928 0a20 2020 2020 2020 2020 2020 2073  I(.            s
-00008770: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00008780: 206d 6170 5f74 6172 6765 742c 0a20 2020   map_target,.   
-00008790: 2020 2020 2020 2020 206d 6170 5f70 726f           map_pro
-000087a0: 6265 2c0a 2020 2020 2020 2020 2020 2020  be,.            
-000087b0: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
-000087c0: 686f 6c64 3d30 2e30 2c0a 2020 2020 2020  hold=0.0,.      
-000087d0: 2020 2020 2020 6d61 705f 7072 6f62 655f        map_probe_
-000087e0: 7468 7265 7368 6f6c 643d 302e 302c 0a20  threshold=0.0,. 
-000087f0: 2020 2020 2020 2020 2020 206d 6f64 653d             mode=
-00008800: 312c 0a20 2020 2020 2020 2020 2020 206c  1,.            l
-00008810: 6179 6572 7331 3d4e 6f6e 652c 0a20 2020  ayers1=None,.   
-00008820: 2020 2020 2020 2020 206c 6179 6572 7332           layers2
-00008830: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
-00008840: 2020 2077 6569 6768 743d 4661 6c73 652c     weight=False,
-00008850: 0a20 2020 2020 2020 2020 2020 2063 6d6f  .            cmo
-00008860: 6465 3d54 7275 652c 0a20 2020 2029 3a0a  de=True,.    ):.
-00008870: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
-00008880: 6c61 7465 2074 6865 206d 7574 7561 6c20  late the mutual 
-00008890: 696e 666f 726d 6174 696f 6e20 7363 6f72  information scor
-000088a0: 6520 6265 7477 6565 6e20 7477 6f20 4d61  e between two Ma
-000088b0: 7020 696e 7374 616e 6365 732e 0a0a 2020  p instances...  
-000088c0: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
-000088d0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-000088e0: 5f74 6172 6765 742c 206d 6170 5f70 726f  _target, map_pro
-000088f0: 6265 3a20 4d61 7020 696e 7374 616e 6365  be: Map instance
-00008900: 2074 6f20 636f 6d70 6172 652e 0a20 2020   to compare..   
-00008910: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
-00008920: 6765 745f 7468 7265 7368 6f6c 642c 206d  get_threshold, m
-00008930: 6170 5f70 726f 6265 5f74 6872 6573 686f  ap_probe_thresho
-00008940: 6c64 3a20 5468 7265 7368 6f6c 6420 7573  ld: Threshold us
-00008950: 6564 2066 6f72 0a20 2020 2020 2020 2020  ed for.         
-00008960: 2020 2020 2020 2063 6f6e 746f 7572 696e         contourin
-00008970: 670a 2020 2020 2020 2020 2020 2020 6d6f  g.            mo
-00008980: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
-00008990: 2020 2020 312e 2075 7365 2063 6f6d 706c      1. use compl
-000089a0: 6574 6520 6d61 7020 666f 7220 6361 6c63  ete map for calc
-000089b0: 756c 6174 696f 6e0a 2020 2020 2020 2020  ulation.        
-000089c0: 2020 2020 2020 2020 332e 2075 7365 206f          3. use o
-000089d0: 7665 726c 6170 2072 6567 696f 6e20 666f  verlap region fo
-000089e0: 7220 6361 6c63 756c 6174 696f 6e0a 2020  r calculation.  
-000089f0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-00008a00: 313a 204e 756d 6265 7220 6f66 206c 6179  1: Number of lay
-00008a10: 6572 7320 7573 6564 2074 6f20 6269 6e20  ers used to bin 
-00008a20: 6d61 705f 7461 7267 6574 2e20 4966 204e  map_target. If N
-00008a30: 6f6e 652c 2076 616c 7565 0a20 2020 2020  one, value.     
-00008a40: 2020 2020 2020 2020 2020 2069 7320 6361             is ca
-00008a50: 6c63 756c 6174 6564 2062 6173 6564 206f  lculated based o
-00008a60: 6e20 5374 7572 6765 732c 2031 3932 3620  n Sturges, 1926 
-00008a70: 6d65 7468 6f64 2e0a 2020 2020 2020 2020  method..        
-00008a80: 2020 2020 6c61 7965 7273 323a 204e 756d      layers2: Num
-00008a90: 6265 7220 6f66 206c 6179 6572 7320 7573  ber of layers us
-00008aa0: 6564 2074 6f20 6269 6e20 6d61 705f 7072  ed to bin map_pr
-00008ab0: 6f62 652e 2049 6620 4e6f 6e65 2c20 7661  obe. If None, va
-00008ac0: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-00008ad0: 2020 2020 6973 2063 616c 6375 6c61 7465      is calculate
-00008ae0: 6420 6261 7365 6420 6f6e 2053 7475 7267  d based on Sturg
-00008af0: 6573 2c20 3139 3236 206d 6574 686f 642e  es, 1926 method.
-00008b00: 0a20 2020 2020 2020 2020 2020 2077 6569  .            wei
-00008b10: 6768 743a 2049 6620 5472 7565 3a20 6e6f  ght: If True: no
-00008b20: 726d 616c 6973 6564 204d 4920 2853 7475  rmalised MI (Stu
-00008b30: 6468 6f6c 6d65 2065 7420 616c 2e29 2069  dholme et al.) i
-00008b40: 7320 7573 6564 2074 6f0a 2020 2020 2020  s used to.      
-00008b50: 2020 2020 2020 2020 2020 6163 636f 756e            accoun
-00008b60: 7420 666f 7220 6f76 6572 6c61 7020 6f66  t for overlap of
-00008b70: 2027 636f 6e74 6f75 7273 270a 2020 2020   'contours'.    
-00008b80: 2020 2020 2020 2020 636d 6f64 653a 0a20          cmode:. 
-00008b90: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00008ba0: 2020 2020 2020 2020 2020 2020 4d49 2073              MI s
-00008bb0: 636f 7265 0a20 2020 2020 2020 2052 6169  core.        Rai
-00008bc0: 7365 733a 0a20 2020 2020 2020 2020 2020  ses:.           
-00008bd0: 2073 7973 2e65 7869 743a 2049 6e70 7574   sys.exit: Input
-00008be0: 206d 6170 7320 646f 206e 6f74 206d 6174   maps do not mat
-00008bf0: 6368 2069 6e20 7368 6170 652c 2070 6978  ch in shape, pix
-00008c00: 656c 2073 697a 6520 6f72 206f 7269 6769  el size or origi
-00008c10: 6e0a 2020 2020 2020 2020 2222 220a 2020  n.        """.  
-00008c20: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-00008c30: 662e 6d61 7043 6f6d 7061 7269 736f 6e28  f.mapComparison(
-00008c40: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
-00008c50: 7072 6f62 6529 3a0a 2020 2020 2020 2020  probe):.        
-00008c60: 2020 2020 7365 6c66 2e5f 6661 696c 6564      self._failed
-00008c70: 5f6d 6174 6368 2829 0a20 2020 2020 2020  _match().       
-00008c80: 2069 6620 6d61 705f 7461 7267 6574 5f74   if map_target_t
-00008c90: 6872 6573 686f 6c64 203d 3d20 302e 303a  hreshold == 0.0:
-00008ca0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00008cb0: 5f74 6172 6765 745f 7468 7265 7368 6f6c  _target_threshol
-00008cc0: 6420 3d20 7365 6c66 2e63 616c 6375 6c61  d = self.calcula
-00008cd0: 7465 5f6d 6170 5f74 6872 6573 686f 6c64  te_map_threshold
-00008ce0: 286d 6170 5f74 6172 6765 7429 0a20 2020  (map_target).   
-00008cf0: 2020 2020 2069 6620 6d61 705f 7072 6f62       if map_prob
-00008d00: 655f 7468 7265 7368 6f6c 6420 3d3d 2030  e_threshold == 0
-00008d10: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
-00008d20: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
-00008d30: 6f6c 6420 3d20 7365 6c66 2e63 616c 6375  old = self.calcu
-00008d40: 6c61 7465 5f6d 6170 5f74 6872 6573 686f  late_map_thresho
-00008d50: 6c64 286d 6170 5f70 726f 6265 290a 2020  ld(map_probe).  
-00008d60: 2020 2020 2020 2320 6361 6c63 756c 6174        # calculat
-00008d70: 696f 6e20 6f6e 2074 6865 2063 6f6d 706c  ion on the compl
-00008d80: 6574 6520 6d61 700a 2020 2020 2020 2020  ete map.        
-00008d90: 6966 206d 6f64 6520 3d3d 2031 3a0a 2020  if mode == 1:.  
-00008da0: 2020 2020 2020 2020 2020 6966 2077 6569            if wei
-00008db0: 6768 743a 0a20 2020 2020 2020 2020 2020  ght:.           
-00008dc0: 2020 2020 2077 7420 3d20 310a 2020 2020       wt = 1.    
-00008dd0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00008de0: 2020 2020 2020 2020 2020 2020 2020 7774                wt
-00008df0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00008e00: 2069 6620 6c61 7965 7273 3120 6973 204e   if layers1 is N
-00008e10: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
-00008e20: 2020 2020 206c 6179 6572 7331 203d 2032       layers1 = 2
-00008e30: 300a 2020 2020 2020 2020 2020 2020 6966  0.            if
-00008e40: 206c 6179 6572 7332 2069 7320 4e6f 6e65   layers2 is None
-00008e50: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00008e60: 2020 6c61 7965 7273 3220 3d20 3230 0a20    layers2 = 20. 
-00008e70: 2020 2020 2020 2020 2020 206d 696e 3120             min1 
-00008e80: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00008e90: 2020 2020 2020 2020 6e70 2e61 6d69 6e28          np.amin(
-00008ea0: 6d61 705f 7461 7267 6574 2e66 756c 6c4d  map_target.fullM
-00008eb0: 6170 2920 2d0a 2020 2020 2020 2020 2020  ap) -.          
-00008ec0: 2020 2020 2020 2020 2020 302e 3030 3030            0.0000
-00008ed0: 3120 2a0a 2020 2020 2020 2020 2020 2020  1 *.            
-00008ee0: 2020 2020 2020 2020 286e 702e 616d 6178          (np.amax
-00008ef0: 286d 6170 5f74 6172 6765 742e 6675 6c6c  (map_target.full
-00008f00: 4d61 7029 202d 206e 702e 616d 696e 286d  Map) - np.amin(m
-00008f10: 6170 5f74 6172 6765 742e 6675 6c6c 4d61  ap_target.fullMa
-00008f20: 7029 290a 2020 2020 2020 2020 2020 2020  p)).            
-00008f30: 290a 2020 2020 2020 2020 2020 2020 6d69  ).            mi
-00008f40: 6e32 203d 2028 0a20 2020 2020 2020 2020  n2 = (.         
-00008f50: 2020 2020 2020 2020 2020 206e 702e 616d             np.am
-00008f60: 696e 286d 6170 5f70 726f 6265 2e66 756c  in(map_probe.ful
-00008f70: 6c4d 6170 2920 2d0a 2020 2020 2020 2020  lMap) -.        
-00008f80: 2020 2020 2020 2020 2020 2020 302e 3030              0.00
-00008f90: 3030 3120 2a0a 2020 2020 2020 2020 2020  001 *.          
-00008fa0: 2020 2020 2020 2020 2020 286e 702e 616d            (np.am
-00008fb0: 6178 286d 6170 5f70 726f 6265 2e66 756c  ax(map_probe.ful
-00008fc0: 6c4d 6170 2920 2d20 6e70 2e61 6d69 6e28  lMap) - np.amin(
-00008fd0: 6d61 705f 7072 6f62 652e 6675 6c6c 4d61  map_probe.fullMa
-00008fe0: 7029 290a 2020 2020 2020 2020 2020 2020  p)).            
-00008ff0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00009000: 2063 6d6f 6465 3a0a 2020 2020 2020 2020   cmode:.        
-00009010: 2020 2020 2020 2020 6d69 6320 3d20 7365          mic = se
-00009020: 6c66 2e5f 4d49 5f43 280a 2020 2020 2020  lf._MI_C(.      
-00009030: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00009040: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
-00009050: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009060: 2020 2020 2020 6d61 705f 7072 6f62 652e        map_probe.
-00009070: 6675 6c6c 4d61 702c 0a20 2020 2020 2020  fullMap,.       
-00009080: 2020 2020 2020 2020 2020 2020 206c 6179               lay
-00009090: 6572 7331 2c0a 2020 2020 2020 2020 2020  ers1,.          
-000090a0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-000090b0: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
-000090c0: 2020 2020 2020 2077 742c 0a20 2020 2020         wt,.     
-000090d0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000090e0: 696e 312c 0a20 2020 2020 2020 2020 2020  in1,.           
-000090f0: 2020 2020 2020 2020 206d 696e 320a 2020           min2.  
-00009100: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-00009110: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00009120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009130: 2020 6d69 6320 3d20 4e6f 6e65 0a20 2020    mic = None.   
-00009140: 2020 2020 2020 2020 2069 6620 6d69 6320           if mic 
-00009150: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
-00009160: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-00009170: 7572 6e20 6d69 630a 2020 2020 2020 2020  urn mic.        
-00009180: 2020 2020 2320 6469 6769 7469 7a65 2077      # digitize w
-00009190: 686f 6c65 206d 6170 2062 6173 6564 206f  hole map based o
-000091a0: 6e20 6c61 7965 7273 0a20 2020 2020 2020  n layers.       
-000091b0: 2020 2020 206d 6170 315f 6269 6e20 3d20       map1_bin = 
-000091c0: 6d61 705f 7461 7267 6574 2e5f 6d61 705f  map_target._map_
-000091d0: 6469 6769 7469 7a65 280a 2020 2020 2020  digitize(.      
-000091e0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-000091f0: 7267 6574 2e6d 696e 2829 2c0a 2020 2020  rget.min(),.    
-00009200: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00009210: 7273 312c 0a20 2020 2020 2020 2020 2020  rs1,.           
-00009220: 2020 2020 2054 7275 652c 0a20 2020 2020       True,.     
-00009230: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00009240: 2020 2020 206d 6170 325f 6269 6e20 3d20       map2_bin = 
-00009250: 6d61 705f 7072 6f62 652e 5f6d 6170 5f64  map_probe._map_d
-00009260: 6967 6974 697a 6528 6d61 705f 7072 6f62  igitize(map_prob
-00009270: 652e 6d69 6e28 292c 206c 6179 6572 7332  e.min(), layers2
-00009280: 2c20 5472 7565 290a 2020 2020 2020 2020  , True).        
-00009290: 2020 2020 6269 6e73 3120 3d20 5b5d 0a20      bins1 = []. 
-000092a0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-000092b0: 2069 6e20 7261 6e67 6528 6c61 7965 7273   in range(layers
-000092c0: 312b 3229 3a0a 2020 2020 2020 2020 2020  1+2):.          
-000092d0: 2020 2020 2020 6269 6e73 312e 6170 7065        bins1.appe
-000092e0: 6e64 2869 290a 2020 2020 2020 2020 2020  nd(i).          
-000092f0: 2020 6269 6e73 3220 3d20 5b5d 0a20 2020    bins2 = [].   
-00009300: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00009310: 6e20 7261 6e67 6528 6c61 7965 7273 322b  n range(layers2+
-00009320: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00009330: 2020 2020 6269 6e73 322e 6170 7065 6e64      bins2.append
-00009340: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
-00009350: 2320 6361 6c63 756c 6174 6520 6672 6571  # calculate freq
-00009360: 7565 6e63 7920 6f66 2062 696e 730a 2020  uency of bins.  
-00009370: 2020 2020 2020 2020 2020 6d61 7031 5f66            map1_f
-00009380: 7265 7120 3d20 6e70 2e68 6973 746f 6772  req = np.histogr
-00009390: 616d 286d 6170 315f 6269 6e2e 6675 6c6c  am(map1_bin.full
-000093a0: 4d61 702c 2062 696e 7331 295b 305d 5b31  Map, bins1)[0][1
-000093b0: 3a5d 0a20 2020 2020 2020 2020 2020 206d  :].            m
-000093c0: 6170 325f 6672 6571 203d 206e 702e 6869  ap2_freq = np.hi
-000093d0: 7374 6f67 7261 6d28 6d61 7032 5f62 696e  stogram(map2_bin
-000093e0: 2e66 756c 6c4d 6170 2c20 6269 6e73 3229  .fullMap, bins2)
-000093f0: 5b30 5d5b 313a 5d0a 2020 2020 2020 2020  [0][1:].        
-00009400: 656c 6966 206d 6f64 6520 3d3d 2033 3a0a  elif mode == 3:.
-00009410: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00009420: 5f61 7272 6179 203d 2073 656c 662e 5f6f  _array = self._o
-00009430: 7665 726c 6170 5f6d 6170 5f61 7272 6179  verlap_map_array
-00009440: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00009450: 2020 6d61 705f 7461 7267 6574 2c0a 2020    map_target,.  
-00009460: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00009470: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
-00009480: 6c64 2c0a 2020 2020 2020 2020 2020 2020  ld,.            
-00009490: 2020 2020 6d61 705f 7072 6f62 652c 0a20      map_probe,. 
-000094a0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-000094b0: 6170 5f70 726f 6265 5f74 6872 6573 686f  ap_probe_thresho
-000094c0: 6c64 0a20 2020 2020 2020 2020 2020 2029  ld.            )
-000094d0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-000094e0: 6e70 2e73 756d 286d 6173 6b5f 6172 7261  np.sum(mask_arra
-000094f0: 7929 203d 3d20 303a 0a20 2020 2020 2020  y) == 0:.       
-00009500: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
-00009510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009520: 2020 2020 274e 6f20 6d61 7020 6f76 6572      'No map over
-00009530: 6c61 7020 284d 7574 7561 6c20 696e 666f  lap (Mutual info
-00009540: 726d 6174 696f 6e20 7363 6f72 6529 2c20  rmation score), 
-00009550: 6578 6974 696e 6720 7363 6f72 6520 270a  exiting score '.
+000078c0: 7265 7475 726e 2031 202d 2028 7375 6d28  return 1 - (sum(
+000078d0: 7363 6f72 6573 2920 2f20 286c 656e 2870  scores) / (len(p
+000078e0: 6f69 6e74 7329 202a 2033 2e31 3429 290a  oints) * 3.14)).
+000078f0: 0a20 2020 2064 6566 2067 6574 5f70 6172  .    def get_par
+00007900: 7469 616c 5f44 4c53 4628 0a20 2020 2020  tial_DLSF(.     
+00007910: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+00007920: 2020 2020 2020 2020 206e 756d 5f6f 665f           num_of_
+00007930: 706f 696e 7473 2c0a 2020 2020 2020 2020  points,.        
+00007940: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
+00007950: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+00007960: 7072 6f62 650a 2020 2020 293a 0a20 2020  probe.    ):.   
+00007970: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00007980: 6520 7468 6520 444c 5346 2073 636f 7265  e the DLSF score
+00007990: 2062 6574 7765 656e 2074 776f 204d 6170   between two Map
+000079a0: 2069 6e73 7461 6e63 6573 2e0a 0a20 2020   instances...   
+000079b0: 2020 2020 2054 6865 2044 4c53 4620 6973       The DLSF is
+000079c0: 2073 696d 696c 6172 2074 6f20 7468 6520   similar to the 
+000079d0: 4c53 463b 0a20 2020 2020 2020 2077 6865  LSF;.        whe
+000079e0: 7265 6173 2074 6865 204c 5346 2063 6f6d  reas the LSF com
+000079f0: 7061 7265 7320 6162 736f 6c75 7465 2064  pares absolute d
+00007a00: 656e 7369 7479 2076 616c 7565 732c 0a20  ensity values,. 
+00007a10: 2020 2020 2020 2074 6865 2044 4c53 4620         the DLSF 
+00007a20: 636f 6d70 6172 6573 2074 6865 2064 6966  compares the dif
+00007a30: 6665 7265 6e63 6520 6265 7477 6565 6e20  ference between 
+00007a40: 7061 6972 7320 6f66 2076 616c 7565 732e  pairs of values.
+00007a50: 0a0a 2020 2020 2020 2020 4172 6775 6d65  ..        Argume
+00007a60: 6e74 733a 0a20 2020 2020 2020 2020 2020  nts:.           
+00007a70: 206d 6170 5f74 6172 6765 742c 206d 6170   map_target, map
+00007a80: 5f70 726f 6265 3a20 4d61 7020 696e 7374  _probe: Map inst
+00007a90: 616e 6365 7320 746f 2063 6f6d 7061 7265  ances to compare
+00007aa0: 2e0a 2020 2020 2020 2020 2020 2020 6e75  ..            nu
+00007ab0: 6d5f 6f66 5f70 6f69 6e74 733a 204e 756d  m_of_points: Num
+00007ac0: 6265 7220 6f66 2073 6967 6e69 6669 6361  ber of significa
+00007ad0: 6e74 2070 6f69 6e74 732e 0a20 2020 2020  nt points..     
+00007ae0: 2020 2052 6574 7572 6e3a 0a20 2020 2020     Return:.     
+00007af0: 2020 2020 2020 2044 4c53 4620 7363 6f72         DLSF scor
+00007b00: 652c 206f 7220 7374 7269 6e67 2022 6361  e, or string "ca
+00007b10: 6e27 7420 6d61 7463 6820 7468 6520 6d61  n't match the ma
+00007b20: 7022 2069 6620 496e 7075 7420 6d61 7073  p" if Input maps
+00007b30: 2064 6f20 6e6f 740a 2020 2020 2020 2020   do not.        
+00007b40: 2020 2020 6d61 7463 6820 696e 2073 6861      match in sha
+00007b50: 7065 2c20 7069 7865 6c20 7369 7a65 206f  pe, pixel size o
+00007b60: 7220 6f72 6967 696e 0a20 2020 2020 2020  r origin.       
+00007b70: 2022 2222 0a0a 2020 2020 2020 2020 6966   """..        if
+00007b80: 206e 6f74 2073 656c 662e 6d61 7043 6f6d   not self.mapCom
+00007b90: 7061 7269 736f 6e28 6d61 705f 7461 7267  parison(map_targ
+00007ba0: 6574 2c20 6d61 705f 7072 6f62 6529 3a0a  et, map_probe):.
+00007bb0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00007bc0: 726e 2022 6361 6e27 7420 4d61 7463 6820  rn "can't Match 
+00007bd0: 7468 6520 6d61 7022 0a0a 2020 2020 2020  the map"..      
+00007be0: 2020 6d61 705f 7461 7267 6574 5f73 6967    map_target_sig
+00007bf0: 5f70 6169 7273 203d 206d 6170 5f74 6172  _pairs = map_tar
+00007c00: 6765 742e 5f67 6574 5f72 616e 646f 6d5f  get._get_random_
+00007c10: 7369 676e 6966 6963 616e 745f 7061 6972  significant_pair
+00007c20: 7328 0a20 2020 2020 2020 2020 2020 2069  s(.            i
+00007c30: 6e74 286e 756d 5f6f 665f 706f 696e 7473  nt(num_of_points
+00007c40: 290a 2020 2020 2020 2020 290a 2020 2020  ).        ).    
+00007c50: 2020 2020 6f74 6865 724d 6170 203d 206d      otherMap = m
+00007c60: 6170 5f70 726f 6265 0a20 2020 2020 2020  ap_probe.       
+00007c70: 2073 636f 7265 203d 2030 2e30 0a20 2020   score = 0.0.   
+00007c80: 2020 2020 2066 6f72 2070 2069 6e20 6d61       for p in ma
+00007c90: 705f 7461 7267 6574 5f73 6967 5f70 6169  p_target_sig_pai
+00007ca0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+00007cb0: 7a31 203d 2070 5b30 5d0a 2020 2020 2020  z1 = p[0].      
+00007cc0: 2020 2020 2020 7931 203d 2070 5b31 5d0a        y1 = p[1].
+00007cd0: 2020 2020 2020 2020 2020 2020 7831 203d              x1 =
+00007ce0: 2070 5b32 5d0a 2020 2020 2020 2020 2020   p[2].          
+00007cf0: 2020 7a32 203d 2070 5b33 5d0a 2020 2020    z2 = p[3].    
+00007d00: 2020 2020 2020 2020 7932 203d 2070 5b34          y2 = p[4
+00007d10: 5d0a 2020 2020 2020 2020 2020 2020 7832  ].            x2
+00007d20: 203d 2070 5b35 5d0a 2020 2020 2020 2020   = p[5].        
+00007d30: 2020 2020 6465 6e73 203d 2070 5b36 5d0a      dens = p[6].
+00007d40: 2020 2020 2020 2020 2020 2020 7072 6f74              prot
+00007d50: 5f64 656e 7320 3d20 280a 2020 2020 2020  _dens = (.      
+00007d60: 2020 2020 2020 2020 2020 6f74 6865 724d            otherM
+00007d70: 6170 2e66 756c 6c4d 6170 5b7a 315d 5b79  ap.fullMap[z1][y
+00007d80: 315d 5b78 315d 202d 206f 7468 6572 4d61  1][x1] - otherMa
+00007d90: 702e 6675 6c6c 4d61 705b 7a32 5d5b 7932  p.fullMap[z2][y2
+00007da0: 5d5b 7832 5d0a 2020 2020 2020 2020 2020  ][x2].          
+00007db0: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
+00007dc0: 7363 6f72 6520 2b3d 2028 6465 6e73 202d  score += (dens -
+00007dd0: 2070 726f 745f 6465 6e73 292a 2a32 0a20   prot_dens)**2. 
+00007de0: 2020 2020 2020 2072 6574 7572 6e20 7363         return sc
+00007df0: 6f72 6520 2f20 6d61 705f 7461 7267 6574  ore / map_target
+00007e00: 2e66 756c 6c4d 6170 2e73 697a 650a 0a20  .fullMap.size.. 
+00007e10: 2020 2064 6566 205f 4d49 2873 656c 662c     def _MI(self,
+00007e20: 206d 6170 5f74 6172 6765 742c 206d 6170   map_target, map
+00007e30: 5f70 726f 6265 2c20 6c61 7965 7273 3d32  _probe, layers=2
+00007e40: 3029 3a0a 2020 2020 2020 2020 2222 2243  0):.        """C
+00007e50: 616c 6375 6c61 7465 2074 6865 206d 7574  alculate the mut
+00007e60: 7561 6c20 696e 666f 726d 6174 696f 6e20  ual information 
+00007e70: 7363 6f72 6520 6265 7477 6565 6e20 7477  score between tw
+00007e80: 6f20 4d61 7073 2e0a 0a20 2020 2020 2020  o Maps...       
+00007e90: 204f 6c64 2076 6572 7369 6f6e 206f 6620   Old version of 
+00007ea0: 7468 6520 7363 6f72 653f 0a0a 2020 2020  the score?..    
+00007eb0: 2020 2020 4172 6775 6d65 6e74 733a 0a20      Arguments:. 
+00007ec0: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
+00007ed0: 6172 6765 742c 206d 6170 5f70 726f 6265  arget, map_probe
+00007ee0: 3a20 4d61 7020 696e 7374 616e 6365 7320  : Map instances 
+00007ef0: 746f 2063 6f6d 7061 7265 2e0a 0a20 2020  to compare...   
+00007f00: 2020 2020 2020 2020 206c 6179 6572 733a           layers:
+00007f10: 204e 756d 6265 7220 6f66 206c 6179 6572   Number of layer
+00007f20: 7320 7573 6564 2074 6f20 6269 6e20 7468  s used to bin th
+00007f30: 6520 6d61 702e 2044 6566 6175 6c74 2069  e map. Default i
+00007f40: 7320 3230 2061 7320 696e 0a20 2020 2020  s 20 as in.     
+00007f50: 2020 2020 2020 2020 2020 2053 6861 7473             Shats
+00007f60: 6b79 2065 7420 616c 2e2c 2032 3030 382e  ky et al., 2008.
+00007f70: 0a20 2020 2020 2020 2052 6574 7572 6e3a  .        Return:
+00007f80: 204d 4920 7363 6f72 650a 2020 2020 2020   MI score.      
+00007f90: 2020 5261 6973 6573 3a0a 2020 2020 2020    Raises:.      
+00007fa0: 2020 2020 2020 7379 732e 6578 6974 3a20        sys.exit: 
+00007fb0: 496e 7075 7420 6d61 7073 2064 6f20 6e6f  Input maps do no
+00007fc0: 7420 6d61 7463 6820 696e 2073 6861 7065  t match in shape
+00007fd0: 2c20 7069 7865 6c20 7369 7a65 206f 7220  , pixel size or 
+00007fe0: 6f72 6967 696e 0a20 2020 2020 2020 2022  origin.        "
+00007ff0: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
+00008000: 656c 662e 6d61 7043 6f6d 7061 7269 736f  elf.mapCompariso
+00008010: 6e28 6d61 705f 7461 7267 6574 2c20 6d61  n(map_target, ma
+00008020: 705f 7072 6f62 6529 3a0a 2020 2020 2020  p_probe):.      
+00008030: 2020 2020 2020 6d31 2c20 6d32 203d 206d        m1, m2 = m
+00008040: 6170 5f74 6172 6765 742c 206d 6170 5f70  ap_target, map_p
+00008050: 726f 6265 0a20 2020 2020 2020 2065 6c73  robe.        els
+00008060: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00008070: 656c 662e 5f66 6169 6c65 645f 6d61 7463  elf._failed_matc
+00008080: 6828 290a 2020 2020 2020 2020 7363 6f72  h().        scor
+00008090: 6520 3d20 300a 2020 2020 2020 2020 6d31  e = 0.        m1
+000080a0: 5f6c 6576 656c 7320 3d20 286d 312e 6d61  _levels = (m1.ma
+000080b0: 7828 2920 2d20 6d31 2e6d 696e 2829 2920  x() - m1.min()) 
+000080c0: 2f20 6c61 7965 7273 0a20 2020 2020 2020  / layers.       
+000080d0: 206d 325f 6c65 7665 6c73 203d 2028 6d32   m2_levels = (m2
+000080e0: 2e6d 6178 2829 202d 206d 322e 6d69 6e28  .max() - m2.min(
+000080f0: 2929 202f 206c 6179 6572 730a 2020 2020  )) / layers.    
+00008100: 2020 2020 666f 7220 7820 696e 2072 616e      for x in ran
+00008110: 6765 286c 6179 6572 7329 3a0a 2020 2020  ge(layers):.    
+00008120: 2020 2020 2020 2020 666f 7220 7920 696e          for y in
+00008130: 2072 616e 6765 286c 6179 6572 7329 3a0a   range(layers):.
+00008140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008150: 6d31 5f6c 6576 656c 5f6d 6170 203d 2028  m1_level_map = (
+00008160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008170: 2020 2020 2020 2020 2028 6d31 2e67 6574           (m1.get
+00008180: 4d61 7028 2920 3e3d 206d 312e 6d69 6e28  Map() >= m1.min(
+00008190: 2920 2b20 2878 202a 206d 315f 6c65 7665  ) + (x * m1_leve
+000081a0: 6c73 2929 202a 0a20 2020 2020 2020 2020  ls)) *.         
+000081b0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+000081c0: 6d31 2e67 6574 4d61 7028 2920 3c3d 206d  m1.getMap() <= m
+000081d0: 312e 6d69 6e28 2920 2b20 2828 7820 2b20  1.min() + ((x + 
+000081e0: 3129 202a 206d 315f 6c65 7665 6c73 2929  1) * m1_levels))
+000081f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008200: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+00008210: 2020 206d 325f 6c65 7665 6c5f 6d61 7020     m2_level_map 
+00008220: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00008230: 2020 2020 2020 2020 2020 2020 286d 322e              (m2.
+00008240: 6765 744d 6170 2829 203e 3d20 6d32 2e6d  getMap() >= m2.m
+00008250: 696e 2829 202b 2028 7920 2a20 6d32 5f6c  in() + (y * m2_l
+00008260: 6576 656c 7329 2920 2a0a 2020 2020 2020  evels)) *.      
+00008270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008280: 2020 286d 322e 6765 744d 6170 2829 203c    (m2.getMap() <
+00008290: 3d20 6d32 2e6d 696e 2829 202b 2028 2879  = m2.min() + ((y
+000082a0: 202b 2031 2920 2a20 6d32 5f6c 6576 656c   + 1) * m2_level
+000082b0: 7329 290a 2020 2020 2020 2020 2020 2020  s)).            
+000082c0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000082d0: 2020 2020 2020 636f 6d62 5f6c 6576 656c        comb_level
+000082e0: 5f6d 6170 203d 206d 315f 6c65 7665 6c5f  _map = m1_level_
+000082f0: 6d61 702a 6d32 5f6c 6576 656c 5f6d 6170  map*m2_level_map
+00008300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00008310: 2070 5f6d 3120 3d20 666c 6f61 7428 6d31   p_m1 = float(m1
+00008320: 5f6c 6576 656c 5f6d 6170 2e73 756d 2829  _level_map.sum()
+00008330: 292f 6d31 5f6c 6576 656c 5f6d 6170 2e73  )/m1_level_map.s
+00008340: 697a 650a 2020 2020 2020 2020 2020 2020  ize.            
+00008350: 2020 2020 705f 6d32 203d 2066 6c6f 6174      p_m2 = float
+00008360: 286d 325f 6c65 7665 6c5f 6d61 702e 7375  (m2_level_map.su
+00008370: 6d28 2929 2f6d 325f 6c65 7665 6c5f 6d61  m())/m2_level_ma
+00008380: 702e 7369 7a65 0a20 2020 2020 2020 2020  p.size.         
+00008390: 2020 2020 2020 2070 5f63 6f6d 6220 3d20         p_comb = 
+000083a0: 666c 6f61 7428 636f 6d62 5f6c 6576 656c  float(comb_level
+000083b0: 5f6d 6170 2e73 756d 2829 292f 636f 6d62  _map.sum())/comb
+000083c0: 5f6c 6576 656c 5f6d 6170 2e73 697a 650a  _level_map.size.
+000083d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000083e0: 6966 2070 5f63 6f6d 6220 3d3d 2030 3a0a  if p_comb == 0:.
+000083f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008400: 2020 2020 6d69 5f73 636f 7265 203d 2030      mi_score = 0
+00008410: 2e30 0a20 2020 2020 2020 2020 2020 2020  .0.             
+00008420: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00008430: 2020 2020 2020 2020 2020 2020 206d 695f               mi_
+00008440: 7363 6f72 6520 3d20 705f 636f 6d62 202a  score = p_comb *
+00008450: 206d 6174 682e 6c6f 6728 705f 636f 6d62   math.log(p_comb
+00008460: 202f 2028 705f 6d31 202a 2070 5f6d 3229   / (p_m1 * p_m2)
+00008470: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
+00008480: 2020 2020 2073 636f 7265 202b 3d20 6d69       score += mi
+00008490: 5f73 636f 7265 0a20 2020 2020 2020 2072  _score.        r
+000084a0: 6574 7572 6e20 7363 6f72 650a 0a20 2020  eturn score..   
+000084b0: 2064 6566 205f 4d49 5f43 280a 2020 2020   def _MI_C(.    
+000084c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000084d0: 2020 2020 2020 2020 2020 6d31 2c0a 2020            m1,.  
+000084e0: 2020 2020 2020 2020 2020 6d32 2c0a 2020            m2,.  
+000084f0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00008500: 313d 3230 2c0a 2020 2020 2020 2020 2020  1=20,.          
+00008510: 2020 6c61 7965 7273 323d 3230 2c0a 2020    layers2=20,.  
+00008520: 2020 2020 2020 2020 2020 4e3d 302c 0a20            N=0,. 
+00008530: 2020 2020 2020 2020 2020 206c 6331 3d30             lc1=0
+00008540: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
+00008550: 6c63 323d 302e 302c 0a20 2020 2029 3a0a  lc2=0.0,.    ):.
+00008560: 2020 2020 2020 2020 6172 7231 203d 2028          arr1 = (
+00008570: 6d31 292e 7669 6577 2866 6c6f 6174 290a  m1).view(float).
+00008580: 2020 2020 2020 2020 6172 7232 203d 2028          arr2 = (
+00008590: 6d32 292e 7669 6577 2866 6c6f 6174 290a  m2).view(float).
+000085a0: 2020 2020 2020 2020 7265 7475 726e 205f          return _
+000085b0: 4d49 5f43 5f68 656c 7065 725f 6e65 7728  MI_C_helper_new(
+000085c0: 6172 7231 2c20 6172 7232 2c20 6c61 7965  arr1, arr2, laye
+000085d0: 7273 312c 206c 6179 6572 7332 2c20 4e2c  rs1, layers2, N,
+000085e0: 206c 6331 2c20 6c63 3229 0a0a 2020 2020   lc1, lc2)..    
+000085f0: 6465 6620 4d49 280a 2020 2020 2020 2020  def MI(.        
+00008600: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00008610: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
+00008620: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+00008630: 705f 7072 6f62 652c 0a20 2020 2020 2020  p_probe,.       
+00008640: 2020 2020 206d 6170 5f74 6172 6765 745f       map_target_
+00008650: 7468 7265 7368 6f6c 643d 302e 302c 0a20  threshold=0.0,. 
+00008660: 2020 2020 2020 2020 2020 206d 6170 5f70             map_p
+00008670: 726f 6265 5f74 6872 6573 686f 6c64 3d30  robe_threshold=0
+00008680: 2e30 2c0a 2020 2020 2020 2020 2020 2020  .0,.            
+00008690: 6d6f 6465 3d31 2c0a 2020 2020 2020 2020  mode=1,.        
+000086a0: 2020 2020 6c61 7965 7273 313d 4e6f 6e65      layers1=None
+000086b0: 2c0a 2020 2020 2020 2020 2020 2020 6c61  ,.            la
+000086c0: 7965 7273 323d 4e6f 6e65 2c0a 2020 2020  yers2=None,.    
+000086d0: 2020 2020 2020 2020 7765 6967 6874 3d46          weight=F
+000086e0: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
+000086f0: 2020 636d 6f64 653d 5472 7565 2c0a 2020    cmode=True,.  
+00008700: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00008710: 4361 6c63 756c 6174 6520 7468 6520 6d75  Calculate the mu
+00008720: 7475 616c 2069 6e66 6f72 6d61 7469 6f6e  tual information
+00008730: 2073 636f 7265 2062 6574 7765 656e 2074   score between t
+00008740: 776f 204d 6170 2069 6e73 7461 6e63 6573  wo Map instances
+00008750: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
+00008760: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+00008770: 2020 6d61 705f 7461 7267 6574 2c20 6d61    map_target, ma
+00008780: 705f 7072 6f62 653a 204d 6170 2069 6e73  p_probe: Map ins
+00008790: 7461 6e63 6520 746f 2063 6f6d 7061 7265  tance to compare
+000087a0: 2e0a 2020 2020 2020 2020 2020 2020 6d61  ..            ma
+000087b0: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
+000087c0: 6c64 2c20 6d61 705f 7072 6f62 655f 7468  ld, map_probe_th
+000087d0: 7265 7368 6f6c 643a 2054 6872 6573 686f  reshold: Thresho
+000087e0: 6c64 2075 7365 6420 666f 720a 2020 2020  ld used for.    
+000087f0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+00008800: 6f75 7269 6e67 0a20 2020 2020 2020 2020  ouring.         
+00008810: 2020 206d 6f64 653a 0a20 2020 2020 2020     mode:.       
+00008820: 2020 2020 2020 2020 2031 2e20 7573 6520           1. use 
+00008830: 636f 6d70 6c65 7465 206d 6170 2066 6f72  complete map for
+00008840: 2063 616c 6375 6c61 7469 6f6e 0a20 2020   calculation.   
+00008850: 2020 2020 2020 2020 2020 2020 2033 2e20               3. 
+00008860: 7573 6520 6f76 6572 6c61 7020 7265 6769  use overlap regi
+00008870: 6f6e 2066 6f72 2063 616c 6375 6c61 7469  on for calculati
+00008880: 6f6e 0a20 2020 2020 2020 2020 2020 206c  on.            l
+00008890: 6179 6572 7331 3a20 4e75 6d62 6572 206f  ayers1: Number o
+000088a0: 6620 6c61 7965 7273 2075 7365 6420 746f  f layers used to
+000088b0: 2062 696e 206d 6170 5f74 6172 6765 742e   bin map_target.
+000088c0: 2049 6620 4e6f 6e65 2c20 7661 6c75 650a   If None, value.
+000088d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000088e0: 6973 2063 616c 6375 6c61 7465 6420 6261  is calculated ba
+000088f0: 7365 6420 6f6e 2053 7475 7267 6573 2c20  sed on Sturges, 
+00008900: 3139 3236 206d 6574 686f 642e 0a20 2020  1926 method..   
+00008910: 2020 2020 2020 2020 206c 6179 6572 7332           layers2
+00008920: 3a20 4e75 6d62 6572 206f 6620 6c61 7965  : Number of laye
+00008930: 7273 2075 7365 6420 746f 2062 696e 206d  rs used to bin m
+00008940: 6170 5f70 726f 6265 2e20 4966 204e 6f6e  ap_probe. If Non
+00008950: 652c 2076 616c 7565 0a20 2020 2020 2020  e, value.       
+00008960: 2020 2020 2020 2020 2069 7320 6361 6c63           is calc
+00008970: 756c 6174 6564 2062 6173 6564 206f 6e20  ulated based on 
+00008980: 5374 7572 6765 732c 2031 3932 3620 6d65  Sturges, 1926 me
+00008990: 7468 6f64 2e0a 2020 2020 2020 2020 2020  thod..          
+000089a0: 2020 7765 6967 6874 3a20 4966 2054 7275    weight: If Tru
+000089b0: 653a 206e 6f72 6d61 6c69 7365 6420 4d49  e: normalised MI
+000089c0: 2028 5374 7564 686f 6c6d 6520 6574 2061   (Studholme et a
+000089d0: 6c2e 2920 6973 2075 7365 6420 746f 0a20  l.) is used to. 
+000089e0: 2020 2020 2020 2020 2020 2020 2020 2061                 a
+000089f0: 6363 6f75 6e74 2066 6f72 206f 7665 726c  ccount for overl
+00008a00: 6170 206f 6620 2763 6f6e 746f 7572 7327  ap of 'contours'
+00008a10: 0a20 2020 2020 2020 2020 2020 2063 6d6f  .            cmo
+00008a20: 6465 3a0a 2020 2020 2020 2020 5265 7475  de:.        Retu
+00008a30: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+00008a40: 204d 4920 7363 6f72 650a 2020 2020 2020   MI score.      
+00008a50: 2020 5261 6973 6573 3a0a 2020 2020 2020    Raises:.      
+00008a60: 2020 2020 2020 7379 732e 6578 6974 3a20        sys.exit: 
+00008a70: 496e 7075 7420 6d61 7073 2064 6f20 6e6f  Input maps do no
+00008a80: 7420 6d61 7463 6820 696e 2073 6861 7065  t match in shape
+00008a90: 2c20 7069 7865 6c20 7369 7a65 206f 7220  , pixel size or 
+00008aa0: 6f72 6967 696e 0a20 2020 2020 2020 2022  origin.        "
+00008ab0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
+00008ac0: 7420 7365 6c66 2e6d 6170 436f 6d70 6172  t self.mapCompar
+00008ad0: 6973 6f6e 286d 6170 5f74 6172 6765 742c  ison(map_target,
+00008ae0: 206d 6170 5f70 726f 6265 293a 0a20 2020   map_probe):.   
+00008af0: 2020 2020 2020 2020 2073 656c 662e 5f66           self._f
+00008b00: 6169 6c65 645f 6d61 7463 6828 290a 2020  ailed_match().  
+00008b10: 2020 2020 2020 6966 206d 6170 5f74 6172        if map_tar
+00008b20: 6765 745f 7468 7265 7368 6f6c 6420 3d3d  get_threshold ==
+00008b30: 2030 2e30 3a0a 2020 2020 2020 2020 2020   0.0:.          
+00008b40: 2020 6d61 705f 7461 7267 6574 5f74 6872    map_target_thr
+00008b50: 6573 686f 6c64 203d 2073 656c 662e 6361  eshold = self.ca
+00008b60: 6c63 756c 6174 655f 6d61 705f 7468 7265  lculate_map_thre
+00008b70: 7368 6f6c 6428 6d61 705f 7461 7267 6574  shold(map_target
+00008b80: 290a 2020 2020 2020 2020 6966 206d 6170  ).        if map
+00008b90: 5f70 726f 6265 5f74 6872 6573 686f 6c64  _probe_threshold
+00008ba0: 203d 3d20 302e 303a 0a20 2020 2020 2020   == 0.0:.       
+00008bb0: 2020 2020 206d 6170 5f70 726f 6265 5f74       map_probe_t
+00008bc0: 6872 6573 686f 6c64 203d 2073 656c 662e  hreshold = self.
+00008bd0: 6361 6c63 756c 6174 655f 6d61 705f 7468  calculate_map_th
+00008be0: 7265 7368 6f6c 6428 6d61 705f 7072 6f62  reshold(map_prob
+00008bf0: 6529 0a20 2020 2020 2020 2023 2063 616c  e).        # cal
+00008c00: 6375 6c61 7469 6f6e 206f 6e20 7468 6520  culation on the 
+00008c10: 636f 6d70 6c65 7465 206d 6170 0a20 2020  complete map.   
+00008c20: 2020 2020 2069 6620 6d6f 6465 203d 3d20       if mode == 
+00008c30: 313a 0a20 2020 2020 2020 2020 2020 2069  1:.            i
+00008c40: 6620 7765 6967 6874 3a0a 2020 2020 2020  f weight:.      
+00008c50: 2020 2020 2020 2020 2020 7774 203d 2031            wt = 1
+00008c60: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00008c70: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00008c80: 2020 2077 7420 3d20 300a 2020 2020 2020     wt = 0.      
+00008c90: 2020 2020 2020 6966 206c 6179 6572 7331        if layers1
+00008ca0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
+00008cb0: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
+00008cc0: 3120 3d20 3230 0a20 2020 2020 2020 2020  1 = 20.         
+00008cd0: 2020 2069 6620 6c61 7965 7273 3220 6973     if layers2 is
+00008ce0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00008cf0: 2020 2020 2020 206c 6179 6572 7332 203d         layers2 =
+00008d00: 2032 300a 2020 2020 2020 2020 2020 2020   20.            
+00008d10: 6d69 6e31 203d 2028 0a20 2020 2020 2020  min1 = (.       
+00008d20: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00008d30: 616d 696e 286d 6170 5f74 6172 6765 742e  amin(map_target.
+00008d40: 6675 6c6c 4d61 7029 202d 0a20 2020 2020  fullMap) -.     
+00008d50: 2020 2020 2020 2020 2020 2020 2020 2030                 0
+00008d60: 2e30 3030 3031 202a 0a20 2020 2020 2020  .00001 *.       
+00008d70: 2020 2020 2020 2020 2020 2020 2028 6e70               (np
+00008d80: 2e61 6d61 7828 6d61 705f 7461 7267 6574  .amax(map_target
+00008d90: 2e66 756c 6c4d 6170 2920 2d20 6e70 2e61  .fullMap) - np.a
+00008da0: 6d69 6e28 6d61 705f 7461 7267 6574 2e66  min(map_target.f
+00008db0: 756c 6c4d 6170 2929 0a20 2020 2020 2020  ullMap)).       
+00008dc0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00008dd0: 2020 206d 696e 3220 3d20 280a 2020 2020     min2 = (.    
+00008de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008df0: 6e70 2e61 6d69 6e28 6d61 705f 7072 6f62  np.amin(map_prob
+00008e00: 652e 6675 6c6c 4d61 7029 202d 0a20 2020  e.fullMap) -.   
+00008e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008e20: 2030 2e30 3030 3031 202a 0a20 2020 2020   0.00001 *.     
+00008e30: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00008e40: 6e70 2e61 6d61 7828 6d61 705f 7072 6f62  np.amax(map_prob
+00008e50: 652e 6675 6c6c 4d61 7029 202d 206e 702e  e.fullMap) - np.
+00008e60: 616d 696e 286d 6170 5f70 726f 6265 2e66  amin(map_probe.f
+00008e70: 756c 6c4d 6170 2929 0a20 2020 2020 2020  ullMap)).       
+00008e80: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00008e90: 2020 2069 6620 636d 6f64 653a 0a20 2020     if cmode:.   
+00008ea0: 2020 2020 2020 2020 2020 2020 206d 6963               mic
+00008eb0: 203d 2073 656c 662e 5f4d 495f 4328 0a20   = self._MI_C(. 
+00008ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ed0: 2020 206d 6170 5f74 6172 6765 742e 6675     map_target.fu
+00008ee0: 6c6c 4d61 702c 0a20 2020 2020 2020 2020  llMap,.         
+00008ef0: 2020 2020 2020 2020 2020 206d 6170 5f70             map_p
+00008f00: 726f 6265 2e66 756c 6c4d 6170 2c0a 2020  robe.fullMap,.  
+00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f20: 2020 6c61 7965 7273 312c 0a20 2020 2020    layers1,.     
+00008f30: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00008f40: 6179 6572 7332 2c0a 2020 2020 2020 2020  ayers2,.        
+00008f50: 2020 2020 2020 2020 2020 2020 7774 2c0a              wt,.
+00008f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008f70: 2020 2020 6d69 6e31 2c0a 2020 2020 2020      min1,.      
+00008f80: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00008f90: 6e32 0a20 2020 2020 2020 2020 2020 2020  n2.             
+00008fa0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00008fb0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00008fc0: 2020 2020 2020 206d 6963 203d 204e 6f6e         mic = Non
+00008fd0: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+00008fe0: 206d 6963 2069 7320 6e6f 7420 4e6f 6e65   mic is not None
+00008ff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009000: 2020 7265 7475 726e 206d 6963 0a20 2020    return mic.   
+00009010: 2020 2020 2020 2020 2023 2064 6967 6974           # digit
+00009020: 697a 6520 7768 6f6c 6520 6d61 7020 6261  ize whole map ba
+00009030: 7365 6420 6f6e 206c 6179 6572 730a 2020  sed on layers.  
+00009040: 2020 2020 2020 2020 2020 6d61 7031 5f62            map1_b
+00009050: 696e 203d 206d 6170 5f74 6172 6765 742e  in = map_target.
+00009060: 5f6d 6170 5f64 6967 6974 697a 6528 0a20  _map_digitize(. 
+00009070: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00009080: 6170 5f74 6172 6765 742e 6d69 6e28 292c  ap_target.min(),
+00009090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000090a0: 206c 6179 6572 7331 2c0a 2020 2020 2020   layers1,.      
+000090b0: 2020 2020 2020 2020 2020 5472 7565 2c0a            True,.
+000090c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000090d0: 2020 2020 2020 2020 2020 6d61 7032 5f62            map2_b
+000090e0: 696e 203d 206d 6170 5f70 726f 6265 2e5f  in = map_probe._
+000090f0: 6d61 705f 6469 6769 7469 7a65 286d 6170  map_digitize(map
+00009100: 5f70 726f 6265 2e6d 696e 2829 2c20 6c61  _probe.min(), la
+00009110: 7965 7273 322c 2054 7275 6529 0a20 2020  yers2, True).   
+00009120: 2020 2020 2020 2020 2062 696e 7331 203d           bins1 =
+00009130: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00009140: 666f 7220 6920 696e 2072 616e 6765 286c  for i in range(l
+00009150: 6179 6572 7331 2b32 293a 0a20 2020 2020  ayers1+2):.     
+00009160: 2020 2020 2020 2020 2020 2062 696e 7331             bins1
+00009170: 2e61 7070 656e 6428 6929 0a20 2020 2020  .append(i).     
+00009180: 2020 2020 2020 2062 696e 7332 203d 205b         bins2 = [
+00009190: 5d0a 2020 2020 2020 2020 2020 2020 666f  ].            fo
+000091a0: 7220 6920 696e 2072 616e 6765 286c 6179  r i in range(lay
+000091b0: 6572 7332 2b32 293a 0a20 2020 2020 2020  ers2+2):.       
+000091c0: 2020 2020 2020 2020 2062 696e 7332 2e61           bins2.a
+000091d0: 7070 656e 6428 6929 0a20 2020 2020 2020  ppend(i).       
+000091e0: 2020 2020 2023 2063 616c 6375 6c61 7465       # calculate
+000091f0: 2066 7265 7175 656e 6379 206f 6620 6269   frequency of bi
+00009200: 6e73 0a20 2020 2020 2020 2020 2020 206d  ns.            m
+00009210: 6170 315f 6672 6571 203d 206e 702e 6869  ap1_freq = np.hi
+00009220: 7374 6f67 7261 6d28 6d61 7031 5f62 696e  stogram(map1_bin
+00009230: 2e66 756c 6c4d 6170 2c20 6269 6e73 3129  .fullMap, bins1)
+00009240: 5b30 5d5b 313a 5d0a 2020 2020 2020 2020  [0][1:].        
+00009250: 2020 2020 6d61 7032 5f66 7265 7120 3d20      map2_freq = 
+00009260: 6e70 2e68 6973 746f 6772 616d 286d 6170  np.histogram(map
+00009270: 325f 6269 6e2e 6675 6c6c 4d61 702c 2062  2_bin.fullMap, b
+00009280: 696e 7332 295b 305d 5b31 3a5d 0a20 2020  ins2)[0][1:].   
+00009290: 2020 2020 2065 6c69 6620 6d6f 6465 203d       elif mode =
+000092a0: 3d20 333a 0a20 2020 2020 2020 2020 2020  = 3:.           
+000092b0: 206d 6173 6b5f 6172 7261 7920 3d20 7365   mask_array = se
+000092c0: 6c66 2e5f 6f76 6572 6c61 705f 6d61 705f  lf._overlap_map_
+000092d0: 6172 7261 7928 0a20 2020 2020 2020 2020  array(.         
+000092e0: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
+000092f0: 742c 0a20 2020 2020 2020 2020 2020 2020  t,.             
+00009300: 2020 206d 6170 5f74 6172 6765 745f 7468     map_target_th
+00009310: 7265 7368 6f6c 642c 0a20 2020 2020 2020  reshold,.       
+00009320: 2020 2020 2020 2020 206d 6170 5f70 726f           map_pro
+00009330: 6265 2c0a 2020 2020 2020 2020 2020 2020  be,.            
+00009340: 2020 2020 6d61 705f 7072 6f62 655f 7468      map_probe_th
+00009350: 7265 7368 6f6c 640a 2020 2020 2020 2020  reshold.        
+00009360: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00009370: 2020 6966 206e 702e 7375 6d28 6d61 736b    if np.sum(mask
+00009380: 5f61 7272 6179 2920 3d3d 2030 3a0a 2020  _array) == 0:.  
+00009390: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+000093a0: 696e 7428 0a20 2020 2020 2020 2020 2020  int(.           
+000093b0: 2020 2020 2020 2020 2027 4e6f 206d 6170           'No map
+000093c0: 206f 7665 726c 6170 2028 4d75 7475 616c   overlap (Mutual
+000093d0: 2069 6e66 6f72 6d61 7469 6f6e 2073 636f   information sco
+000093e0: 7265 292c 2065 7869 7469 6e67 2073 636f  re), exiting sco
+000093f0: 7265 2027 0a20 2020 2020 2020 2020 2020  re '.           
+00009400: 2020 2020 2020 2020 2027 6361 6c63 756c           'calcul
+00009410: 6174 696f 6e2e 2e27 0a20 2020 2020 2020  ation..'.       
+00009420: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00009430: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00009440: 6e20 302e 300a 2020 2020 2020 2020 2020  n 0.0.          
+00009450: 2020 2320 7374 7572 6765 7320 7275 6c65    # sturges rule
+00009460: 2070 726f 7669 6465 7320 6120 7761 7920   provides a way 
+00009470: 6f66 2063 616c 6375 6c61 7469 6e67 206e  of calculating n
+00009480: 756d 6265 7220 6f66 2062 696e 7320 3a0a  umber of bins :.
+00009490: 2020 2020 2020 2020 2020 2020 2320 3120              # 1 
+000094a0: 2b20 6d61 7468 2e6c 6f67 286e 756d 6265  + math.log(numbe
+000094b0: 7220 6f66 2070 6f69 6e74 7329 0a20 2020  r of points).   
+000094c0: 2020 2020 2020 2020 2069 6620 6c61 7965           if laye
+000094d0: 7273 3120 6973 204e 6f6e 653a 0a20 2020  rs1 is None:.   
+000094e0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+000094f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00009500: 2020 2020 2020 6c61 7965 7273 3120 3d20        layers1 = 
+00009510: 696e 7428 3120 2b20 6d61 7468 2e6c 6f67  int(1 + math.log
+00009520: 286e 702e 7375 6d28 6d61 736b 5f61 7272  (np.sum(mask_arr
+00009530: 6179 292c 2032 2929 0a20 2020 2020 2020  ay), 2)).       
+00009540: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00009550: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
 00009560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009570: 2020 2020 2763 616c 6375 6c61 7469 6f6e      'calculation
-00009580: 2e2e 270a 2020 2020 2020 2020 2020 2020  ..'.            
-00009590: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000095a0: 2020 2020 2020 7265 7475 726e 2030 2e30        return 0.0
-000095b0: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
-000095c0: 7475 7267 6573 2072 756c 6520 7072 6f76  turges rule prov
-000095d0: 6964 6573 2061 2077 6179 206f 6620 6361  ides a way of ca
-000095e0: 6c63 756c 6174 696e 6720 6e75 6d62 6572  lculating number
-000095f0: 206f 6620 6269 6e73 203a 0a20 2020 2020   of bins :.     
-00009600: 2020 2020 2020 2023 2031 202b 206d 6174         # 1 + mat
-00009610: 682e 6c6f 6728 6e75 6d62 6572 206f 6620  h.log(number of 
-00009620: 706f 696e 7473 290a 2020 2020 2020 2020  points).        
-00009630: 2020 2020 6966 206c 6179 6572 7331 2069      if layers1 i
+00009570: 7072 696e 7428 0a20 2020 2020 2020 2020  print(.         
+00009580: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00009590: 4e6f 206d 6170 206f 7665 726c 6170 2028  No map overlap (
+000095a0: 4d75 7475 616c 2069 6e66 6f72 6d61 7469  Mutual informati
+000095b0: 6f6e 2073 636f 7265 292c 2027 0a20 2020  on score), '.   
+000095c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000095d0: 2020 2020 2027 6578 6974 696e 6720 7363       'exiting sc
+000095e0: 6f72 6520 6361 6c63 756c 6174 696f 6e2e  ore calculation.
+000095f0: 2e27 0a20 2020 2020 2020 2020 2020 2020  .'.             
+00009600: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00009610: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+00009620: 7572 6e20 302e 300a 2020 2020 2020 2020  urn 0.0.        
+00009630: 2020 2020 6966 206c 6179 6572 7332 2069      if layers2 i
 00009640: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
 00009650: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
 00009660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009670: 206c 6179 6572 7331 203d 2069 6e74 2831   layers1 = int(1
+00009670: 206c 6179 6572 7332 203d 2069 6e74 2831   layers2 = int(1
 00009680: 202b 206d 6174 682e 6c6f 6728 6e70 2e73   + math.log(np.s
 00009690: 756d 286d 6173 6b5f 6172 7261 7929 2c20  um(mask_array), 
 000096a0: 3229 290a 2020 2020 2020 2020 2020 2020  2)).            
 000096b0: 2020 2020 6578 6365 7074 2056 616c 7565      except Value
 000096c0: 4572 726f 723a 0a20 2020 2020 2020 2020  Error:.         
 000096d0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
 000096e0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
 000096f0: 2020 2020 2020 2020 2020 274e 6f20 6d61            'No ma
 00009700: 7020 6f76 6572 6c61 7020 284d 7574 7561  p overlap (Mutua
 00009710: 6c20 696e 666f 726d 6174 696f 6e20 7363  l information sc
-00009720: 6f72 6529 2c20 270a 2020 2020 2020 2020  ore), '.        
+00009720: 6f72 6529 2c20 6578 6974 696e 6720 270a  ore), exiting '.
 00009730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009740: 2765 7869 7469 6e67 2073 636f 7265 2063  'exiting score c
+00009740: 2020 2020 2020 2020 2773 636f 7265 2063          'score c
 00009750: 616c 6375 6c61 7469 6f6e 2e2e 270a 2020  alculation..'.  
 00009760: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00009770: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
 00009780: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
-00009790: 2e30 0a20 2020 2020 2020 2020 2020 2069  .0.            i
-000097a0: 6620 6c61 7965 7273 3220 6973 204e 6f6e  f layers2 is Non
-000097b0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-000097c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000097d0: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-000097e0: 7273 3220 3d20 696e 7428 3120 2b20 6d61  rs2 = int(1 + ma
-000097f0: 7468 2e6c 6f67 286e 702e 7375 6d28 6d61  th.log(np.sum(ma
-00009800: 736b 5f61 7272 6179 292c 2032 2929 0a20  sk_array), 2)). 
-00009810: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00009820: 7863 6570 7420 5661 6c75 6545 7272 6f72  xcept ValueError
-00009830: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009840: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-00009850: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009860: 2020 2020 2027 4e6f 206d 6170 206f 7665       'No map ove
-00009870: 726c 6170 2028 4d75 7475 616c 2069 6e66  rlap (Mutual inf
-00009880: 6f72 6d61 7469 6f6e 2073 636f 7265 292c  ormation score),
-00009890: 2065 7869 7469 6e67 2027 0a20 2020 2020   exiting '.     
-000098a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098b0: 2020 2027 7363 6f72 6520 6361 6c63 756c     'score calcul
-000098c0: 6174 696f 6e2e 2e27 0a20 2020 2020 2020  ation..'.       
-000098d0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
-000098e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000098f0: 2020 2072 6574 7572 6e20 302e 300a 2020     return 0.0.  
-00009900: 2020 2020 2020 2020 2020 6c61 7965 7273            layers
-00009910: 3120 3d20 6d61 7828 6c61 7965 7273 312c  1 = max(layers1,
-00009920: 2031 3529 0a20 2020 2020 2020 2020 2020   15).           
-00009930: 206c 6179 6572 7332 203d 206d 6178 286c   layers2 = max(l
-00009940: 6179 6572 7332 2c20 3135 290a 2020 2020  ayers2, 15).    
-00009950: 2020 2020 2020 2020 6966 2077 6569 6768          if weigh
-00009960: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
-00009970: 2020 2077 7420 3d20 310a 2020 2020 2020     wt = 1.      
-00009980: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00009990: 2020 2020 2020 2020 2020 2020 7774 203d              wt =
-000099a0: 2030 0a20 2020 2020 2020 2020 2020 2069   0.            i
-000099b0: 6620 636d 6f64 653a 0a20 2020 2020 2020  f cmode:.       
-000099c0: 2020 2020 2020 2020 206d 6963 203d 2073           mic = s
-000099d0: 656c 662e 5f4d 495f 4328 0a20 2020 2020  elf._MI_C(.     
-000099e0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-000099f0: 702e 6172 7261 7928 6d61 705f 7461 7267  p.array(map_targ
-00009a00: 6574 2e66 756c 6c4d 6170 202a 206d 6173  et.fullMap * mas
-00009a10: 6b5f 6172 7261 7929 2c0a 2020 2020 2020  k_array),.      
-00009a20: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-00009a30: 2e61 7272 6179 286d 6170 5f70 726f 6265  .array(map_probe
-00009a40: 2e66 756c 6c4d 6170 202a 206d 6173 6b5f  .fullMap * mask_
-00009a50: 6172 7261 7929 2c0a 2020 2020 2020 2020  array),.        
-00009a60: 2020 2020 2020 2020 2020 2020 6c61 7965              laye
-00009a70: 7273 312c 0a20 2020 2020 2020 2020 2020  rs1,.           
-00009a80: 2020 2020 2020 2020 206c 6179 6572 7332           layers2
-00009a90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00009aa0: 2020 2020 2020 7774 2c0a 2020 2020 2020        wt,.      
-00009ab0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00009ac0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-00009ad0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-00009ae0: 6320 3d20 4e6f 6e65 0a20 2020 2020 2020  c = None.       
-00009af0: 2020 2020 2069 6620 6d69 6320 6973 206e       if mic is n
-00009b00: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00009b10: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00009b20: 6d69 630a 2020 2020 2020 2020 2020 2020  mic.            
-00009b30: 2320 6469 6769 7469 7a65 206d 6173 6b65  # digitize maske
-00009b40: 6420 6d61 7020 6261 7365 6420 6f6e 206c  d map based on l
-00009b50: 6179 6572 730a 2020 2020 2020 2020 2020  ayers.          
-00009b60: 2020 6d61 7031 5f62 696e 203d 206d 6170    map1_bin = map
-00009b70: 5f74 6172 6765 742e 636f 7079 2829 0a20  _target.copy(). 
-00009b80: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
-00009b90: 6269 6e20 3d20 6d61 705f 7072 6f62 652e  bin = map_probe.
-00009ba0: 636f 7079 2829 0a20 2020 2020 2020 2020  copy().         
-00009bb0: 2020 206d 6170 315f 6269 6e2e 6675 6c6c     map1_bin.full
-00009bc0: 4d61 7020 3d20 6d61 7031 5f62 696e 2e66  Map = map1_bin.f
-00009bd0: 756c 6c4d 6170 202a 206d 6173 6b5f 6172  ullMap * mask_ar
-00009be0: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
-00009bf0: 6d61 7032 5f62 696e 2e66 756c 6c4d 6170  map2_bin.fullMap
-00009c00: 203d 206d 6170 325f 6269 6e2e 6675 6c6c   = map2_bin.full
-00009c10: 4d61 7020 2a20 6d61 736b 5f61 7272 6179  Map * mask_array
-00009c20: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00009c30: 315f 6269 6e20 3d20 6d61 7031 5f62 696e  1_bin = map1_bin
-00009c40: 2e5f 6d61 705f 6469 6769 7469 7a65 280a  ._map_digitize(.
-00009c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009c60: 6d61 705f 7461 7267 6574 2e66 756c 6c4d  map_target.fullM
-00009c70: 6170 5b6d 6173 6b5f 6172 7261 795d 2e6d  ap[mask_array].m
-00009c80: 696e 2829 2c0a 2020 2020 2020 2020 2020  in(),.          
-00009c90: 2020 2020 2020 6c61 7965 7273 312c 0a20        layers1,. 
-00009ca0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00009cb0: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00009cc0: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00009cd0: 7032 5f62 696e 203d 206d 6170 325f 6269  p2_bin = map2_bi
-00009ce0: 6e2e 5f6d 6170 5f64 6967 6974 697a 6528  n._map_digitize(
-00009cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009d00: 206d 6170 5f70 726f 6265 2e66 756c 6c4d   map_probe.fullM
-00009d10: 6170 5b6d 6173 6b5f 6172 7261 795d 2e6d  ap[mask_array].m
-00009d20: 696e 2829 2c0a 2020 2020 2020 2020 2020  in(),.          
-00009d30: 2020 2020 2020 6c61 7965 7273 322c 0a20        layers2,. 
-00009d40: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00009d50: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00009d60: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-00009d70: 6d61 6b65 2073 7572 6520 7468 6520 6f75  make sure the ou
-00009d80: 7473 6964 6520 7265 6769 6f6e 2069 7320  tside region is 
-00009d90: 6669 6c6c 6564 2077 6974 6820 7a65 726f  filled with zero
-00009da0: 730a 2020 2020 2020 2020 2020 2020 6d61  s.            ma
-00009db0: 7031 5f62 696e 2e66 756c 6c4d 6170 203d  p1_bin.fullMap =
-00009dc0: 206d 6170 315f 6269 6e2e 6675 6c6c 4d61   map1_bin.fullMa
-00009dd0: 7020 2a20 6d61 736b 5f61 7272 6179 0a20  p * mask_array. 
-00009de0: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
-00009df0: 6269 6e2e 6675 6c6c 4d61 7020 3d20 6d61  bin.fullMap = ma
-00009e00: 7032 5f62 696e 2e66 756c 6c4d 6170 202a  p2_bin.fullMap *
-00009e10: 206d 6173 6b5f 6172 7261 790a 2020 2020   mask_array.    
-00009e20: 2020 2020 2020 2020 2320 6261 636b 6772          # backgr
-00009e30: 6f75 6e64 2066 7265 7175 656e 6369 6573  ound frequencies
-00009e40: 2066 726f 6d20 7468 6520 7768 6f6c 6520   from the whole 
-00009e50: 6d61 700a 2020 2020 2020 2020 2020 2020  map.            
-00009e60: 6269 6e73 3120 3d20 5b5d 0a20 2020 2020  bins1 = [].     
-00009e70: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00009e80: 7261 6e67 6528 6c61 7965 7273 3120 2b20  range(layers1 + 
-00009e90: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00009ea0: 2020 2020 6269 6e73 312e 6170 7065 6e64      bins1.append
-00009eb0: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
-00009ec0: 6269 6e73 3220 3d20 5b5d 0a20 2020 2020  bins2 = [].     
-00009ed0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-00009ee0: 7261 6e67 6528 6c61 7965 7273 3220 2b20  range(layers2 + 
-00009ef0: 3229 3a0a 2020 2020 2020 2020 2020 2020  2):.            
-00009f00: 2020 2020 6269 6e73 322e 6170 7065 6e64      bins2.append
-00009f10: 2869 290a 2020 2020 2020 2020 2020 2020  (i).            
-00009f20: 2320 6361 6c63 756c 6174 6520 6672 6571  # calculate freq
-00009f30: 7565 6e63 7920 6f66 2062 696e 730a 2020  uency of bins.  
-00009f40: 2020 2020 2020 2020 2020 6d61 7031 5f66            map1_f
-00009f50: 7265 7120 3d20 6e70 2e68 6973 746f 6772  req = np.histogr
-00009f60: 616d 286d 6170 315f 6269 6e2e 6675 6c6c  am(map1_bin.full
-00009f70: 4d61 702c 2062 696e 7331 295b 305d 5b31  Map, bins1)[0][1
-00009f80: 3a5d 0a20 2020 2020 2020 2020 2020 206d  :].            m
-00009f90: 6170 325f 6672 6571 203d 206e 702e 6869  ap2_freq = np.hi
-00009fa0: 7374 6f67 7261 6d28 6d61 7032 5f62 696e  stogram(map2_bin
-00009fb0: 2e66 756c 6c4d 6170 2c20 6269 6e73 3229  .fullMap, bins2)
-00009fc0: 5b30 5d5b 313a 5d0a 0a20 2020 2020 2020  [0][1:]..       
-00009fd0: 2073 636f 7265 203d 2030 2e30 0a20 2020   score = 0.0.   
-00009fe0: 2020 2020 2074 6f74 616c 203d 2030 0a0a       total = 0..
-00009ff0: 2020 2020 2020 2020 6966 206e 702e 7375          if np.su
-0000a000: 6d28 6d61 7031 5f66 7265 7129 203d 3d20  m(map1_freq) == 
-0000a010: 303a 0a20 2020 2020 2020 2020 2020 2070  0:.            p
-0000a020: 7269 6e74 280a 2020 2020 2020 2020 2020  rint(.          
-0000a030: 2020 2020 2020 274e 6f20 6d61 7020 6f76        'No map ov
-0000a040: 6572 6c61 7020 284d 7574 7561 6c20 696e  erlap (Mutual in
-0000a050: 666f 726d 6174 696f 6e20 7363 6f72 6529  formation score)
-0000a060: 2c20 6578 6974 696e 6720 7363 6f72 6520  , exiting score 
-0000a070: 270a 2020 2020 2020 2020 2020 2020 2020  '.              
-0000a080: 2020 2763 616c 6375 6c61 7469 6f6e 2e2e    'calculation..
-0000a090: 270a 2020 2020 2020 2020 2020 2020 290a  '.            ).
-0000a0a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000a0b0: 726e 2030 2e30 0a20 2020 2020 2020 2069  rn 0.0.        i
-0000a0c0: 6620 6e70 2e73 756d 286d 6170 325f 6672  f np.sum(map2_fr
-0000a0d0: 6571 2920 3d3d 2030 3a0a 2020 2020 2020  eq) == 0:.      
-0000a0e0: 2020 2020 2020 7072 696e 7428 0a20 2020        print(.   
-0000a0f0: 2020 2020 2020 2020 2020 2020 2027 4e6f               'No
-0000a100: 206d 6170 206f 7665 726c 6170 2028 4d75   map overlap (Mu
-0000a110: 7475 616c 2069 6e66 6f72 6d61 7469 6f6e  tual information
-0000a120: 2073 636f 7265 292c 2065 7869 7469 6e67   score), exiting
-0000a130: 2073 636f 7265 2027 0a20 2020 2020 2020   score '.       
-0000a140: 2020 2020 2020 2020 2027 6361 6c63 756c           'calcul
-0000a150: 6174 696f 6e2e 2e27 0a20 2020 2020 2020  ation..'.       
-0000a160: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0000a170: 2020 2072 6574 7572 6e20 302e 300a 2020     return 0.0.  
-0000a180: 2020 2020 2020 6c69 7374 5f6f 7665 726c        list_overl
-0000a190: 6170 7320 3d20 5b5d 0a20 2020 2020 2020  aps = [].       
-0000a1a0: 2066 6f72 2078 2069 6e20 7261 6e67 6528   for x in range(
-0000a1b0: 6c61 7965 7273 3129 3a0a 2020 2020 2020  layers1):.      
-0000a1c0: 2020 2020 2020 6d61 736b 5f61 7272 6179        mask_array
-0000a1d0: 203d 206d 6170 315f 6269 6e2e 6675 6c6c   = map1_bin.full
-0000a1e0: 4d61 7020 3d3d 2066 6c6f 6174 2878 2b31  Map == float(x+1
-0000a1f0: 290a 2020 2020 2020 2020 2020 2020 6f76  ).            ov
-0000a200: 6572 6c61 705f 6672 6571 203d 206e 702e  erlap_freq = np.
-0000a210: 6869 7374 6f67 7261 6d28 0a20 2020 2020  histogram(.     
-0000a220: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
-0000a230: 6269 6e2e 6675 6c6c 4d61 705b 6d61 736b  bin.fullMap[mask
-0000a240: 5f61 7272 6179 5d2c 2062 696e 7332 0a20  _array], bins2. 
-0000a250: 2020 2020 2020 2020 2020 2029 5b30 5d5b             )[0][
-0000a260: 313a 5d0a 2020 2020 2020 2020 2020 2020  1:].            
-0000a270: 746f 7461 6c20 2b3d 2066 6c6f 6174 286e  total += float(n
-0000a280: 702e 7375 6d28 6f76 6572 6c61 705f 6672  p.sum(overlap_fr
-0000a290: 6571 2929 0a20 2020 2020 2020 2020 2020  eq)).           
-0000a2a0: 206c 6973 745f 6f76 6572 6c61 7073 2e61   list_overlaps.a
-0000a2b0: 7070 656e 6428 6f76 6572 6c61 705f 6672  ppend(overlap_fr
-0000a2c0: 6571 290a 0a20 2020 2020 2020 2069 6620  eq)..        if 
-0000a2d0: 746f 7461 6c20 3d3d 2030 3a0a 2020 2020  total == 0:.    
-0000a2e0: 2020 2020 2020 2020 7072 696e 7428 0a20          print(. 
-0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0000a300: 4e6f 206d 6170 206f 7665 726c 6170 2028  No map overlap (
-0000a310: 4d75 7475 616c 2069 6e66 6f72 6d61 7469  Mutual informati
-0000a320: 6f6e 2073 636f 7265 292c 2065 7869 7469  on score), exiti
-0000a330: 6e67 2073 636f 7265 2027 0a20 2020 2020  ng score '.     
-0000a340: 2020 2020 2020 2020 2020 2027 6361 6c63             'calc
-0000a350: 756c 6174 696f 6e2e 2e27 0a20 2020 2020  ulation..'.     
-0000a360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000a370: 2020 2020 2072 6574 7572 6e20 302e 300a       return 0.0.
-0000a380: 2020 2020 2020 2020 656e 7465 7220 3d20          enter = 
-0000a390: 300a 2020 2020 2020 2020 4878 7920 3d20  0.        Hxy = 
-0000a3a0: 302e 300a 2020 2020 2020 2020 4878 203d  0.0.        Hx =
-0000a3b0: 2030 2e30 0a20 2020 2020 2020 2048 7920   0.0.        Hy 
-0000a3c0: 3d20 302e 300a 2020 2020 2020 2020 6d69  = 0.0.        mi
-0000a3d0: 5f73 636f 7265 203d 2030 2e30 0a20 2020  _score = 0.0.   
-0000a3e0: 2020 2020 2070 5f63 6f6d 6220 3d20 302e       p_comb = 0.
-0000a3f0: 300a 2020 2020 2020 2020 666f 7220 7820  0.        for x 
-0000a400: 696e 2072 616e 6765 286c 6179 6572 7331  in range(layers1
-0000a410: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-0000a420: 5f6d 3120 3d20 6d61 7031 5f66 7265 715b  _m1 = map1_freq[
-0000a430: 785d 2f66 6c6f 6174 286e 702e 7375 6d28  x]/float(np.sum(
-0000a440: 6d61 7031 5f66 7265 7129 290a 2020 2020  map1_freq)).    
-0000a450: 2020 2020 2020 2020 666f 7220 7920 696e          for y in
-0000a460: 2072 616e 6765 286c 6179 6572 7332 293a   range(layers2):
-0000a470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a480: 2065 6e74 6572 203d 2031 0a20 2020 2020   enter = 1.     
-0000a490: 2020 2020 2020 2020 2020 2070 5f63 6f6d             p_com
-0000a4a0: 6220 3d20 6c69 7374 5f6f 7665 726c 6170  b = list_overlap
-0000a4b0: 735b 785d 5b79 5d2f 746f 7461 6c0a 2020  s[x][y]/total.  
-0000a4c0: 2020 2020 2020 2020 2020 2020 2020 705f                p_
-0000a4d0: 6d32 203d 206d 6170 325f 6672 6571 5b79  m2 = map2_freq[y
-0000a4e0: 5d20 2f20 666c 6f61 7428 6e70 2e73 756d  ] / float(np.sum
-0000a4f0: 286d 6170 325f 6672 6571 2929 0a20 2020  (map2_freq)).   
-0000a500: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-0000a510: 705f 636f 6d62 203d 3d20 303a 0a20 2020  p_comb == 0:.   
-0000a520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a530: 206d 695f 7363 6f72 6520 3d20 302e 300a   mi_score = 0.0.
-0000a540: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a550: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a560: 2020 2020 2020 2020 2020 2048 7879 202b             Hxy +
-0000a570: 3d20 2d70 5f63 6f6d 6220 2a20 6d61 7468  = -p_comb * math
-0000a580: 2e6c 6f67 2870 5f63 6f6d 622c 2032 290a  .log(p_comb, 2).
-0000a590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a5a0: 7363 6f72 6520 2b3d 206d 695f 7363 6f72  score += mi_scor
-0000a5b0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000a5c0: 2020 6966 2078 203d 3d20 3020 616e 6420    if x == 0 and 
-0000a5d0: 6e6f 7420 705f 6d32 203d 3d20 302e 303a  not p_m2 == 0.0:
-0000a5e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a5f0: 2020 2020 2048 7920 2b3d 2028 2d70 5f6d       Hy += (-p_m
-0000a600: 3220 2a20 6d61 7468 2e6c 6f67 2870 5f6d  2 * math.log(p_m
-0000a610: 322c 2032 2929 0a20 2020 2020 2020 2020  2, 2)).         
-0000a620: 2020 2069 6620 6e6f 7420 705f 6d31 203d     if not p_m1 =
-0000a630: 3d20 302e 303a 0a20 2020 2020 2020 2020  = 0.0:.         
-0000a640: 2020 2020 2020 2048 7820 2b3d 2028 2d70         Hx += (-p
-0000a650: 5f6d 3120 2a20 6d61 7468 2e6c 6f67 2870  _m1 * math.log(p
-0000a660: 5f6d 312c 2032 2929 0a20 2020 2020 2020  _m1, 2)).       
-0000a670: 2069 6620 656e 7465 7220 3d3d 2031 3a0a   if enter == 1:.
-0000a680: 2020 2020 2020 2020 2020 2020 6966 2077              if w
-0000a690: 6569 6768 743a 0a20 2020 2020 2020 2020  eight:.         
-0000a6a0: 2020 2020 2020 2069 6620 4878 7920 3d3d         if Hxy ==
-0000a6b0: 2030 2e30 3a0a 2020 2020 2020 2020 2020   0.0:.          
-0000a6c0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000a6d0: 2030 2e30 0a20 2020 2020 2020 2020 2020   0.0.           
-0000a6e0: 2020 2020 2072 6574 7572 6e20 2848 7820       return (Hx 
-0000a6f0: 2b20 4879 2920 2f20 4878 790a 2020 2020  + Hy) / Hxy.    
-0000a700: 2020 2020 2020 2020 7265 7475 726e 2048          return H
-0000a710: 7820 2b20 4879 202d 2048 7879 0a20 2020  x + Hy - Hxy.   
-0000a720: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-0000a730: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000a740: 6e65 0a0a 2020 2020 6465 6620 5f68 6175  ne..    def _hau
-0000a750: 7364 6f72 6666 5f6c 6973 7428 0a20 2020  sdorff_list(.   
-0000a760: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-0000a770: 2020 2020 2020 2020 2020 2070 7269 6d61             prima
-0000a780: 7279 5f62 6f75 6e64 6172 792c 0a20 2020  ry_boundary,.   
-0000a790: 2020 2020 2020 2020 2073 6563 6f6e 6461           seconda
-0000a7a0: 7279 5f62 6f75 6e64 6172 792c 0a20 2020  ry_boundary,.   
-0000a7b0: 2020 2020 2020 2020 206b 6474 7265 652c           kdtree,
-0000a7c0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-0000a7d0: 5f70 726f 6265 2c0a 2020 2020 293a 0a20  _probe,.    ):. 
-0000a7e0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000a7f0: 2020 2054 6869 7320 6973 2066 6f72 2074     This is for t
-0000a800: 6865 2063 6861 6d64 6566 2064 6973 7461  he chamdef dista
-0000a810: 6e63 6520 6465 6620 6368 616d 6665 725f  nce def chamfer_
-0000a820: 6469 7374 616e 6365 2c20 6d69 6e20 6d61  distance, min ma
-0000a830: 7820 6465 6e73 6974 790a 2020 2020 2020  x density.      
-0000a840: 2020 7661 6c75 6520 7468 6174 2064 6566    value that def
-0000a850: 696e 6520 7468 6520 7375 7266 6163 6520  ine the surface 
-0000a860: 6f66 2074 6865 2070 726f 7465 696e 0a0a  of the protein..
-0000a870: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-0000a880: 733a 0a20 2020 2020 2020 2020 2020 202a  s:.            *
-0000a890: 6b64 7472 6565 2a0a 2020 2020 2020 2020  kdtree*.        
-0000a8a0: 2020 2020 2020 2020 2874 6865 7265 2061          (there a
-0000a8b0: 7265 2032 206f 6620 7468 656d 2069 6e20  re 2 of them in 
-0000a8c0: 6e75 6d70 7920 6f6e 6520 4362 6173 6564  numpy one Cbased
-0000a8d0: 206f 6e20 7079 2d62 6173 6564 2c20 7468   on py-based, th
-0000a8e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000a8f0: 2020 6c61 7474 6572 2069 7320 6265 7474    latter is bett
-0000a900: 6572 2c20 6374 726c 2920 7468 6973 2068  er, ctrl) this h
-0000a910: 6176 6520 746f 2062 6520 6f6e 6520 6f66  ave to be one of
-0000a920: 2074 6865 2069 6e70 7574 2e0a 2020 2020   the input..    
-0000a930: 2020 2020 2020 2020 2020 2020 6b64 7472              kdtr
-0000a940: 6565 2066 726f 6d20 6d61 705f 7461 7267  ee from map_targ
-0000a950: 6574 0a20 2020 2020 2020 2020 2020 202a  et.            *
-0000a960: 7072 696d 6172 795f 626f 756e 6461 7279  primary_boundary
-0000a970: 2c20 7365 636f 6e64 6172 795f 626f 756e  , secondary_boun
-0000a980: 6461 7279 2a0a 2020 2020 2020 2020 2020  dary*.          
-0000a990: 2020 2020 2020 6e65 6564 2074 6f20 7275        need to ru
-0000a9a0: 6e20 6765 745f 7072 696d 6172 795f 626f  n get_primary_bo
-0000a9b0: 756e 6461 7279 2061 6e64 2067 6574 5f73  undary and get_s
-0000a9c0: 6563 6f6e 645f 626f 756e 6461 7279 2066  econd_boundary f
-0000a9d0: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-0000a9e0: 2020 206d 6170 5f70 726f 6265 0a0a 2020     map_probe..  
-0000a9f0: 2020 2020 2020 2020 2020 4e4f 5445 3a20            NOTE: 
-0000aa00: 6966 2079 6f75 206b 6565 7020 7468 6520  if you keep the 
-0000aa10: 6b64 7472 6565 2061 7320 7061 7261 6d65  kdtree as parame
-0000aa20: 7472 6520 6f75 7420 6f73 206c 6573 7320  tre out os less 
-0000aa30: 7469 6d65 0a20 2020 2020 2020 2020 2020  time.           
-0000aa40: 2063 6f6e 7375 6d69 6e67 2061 7320 6275   consuming as bu
-0000aa50: 696c 6469 6e67 2069 7420 7461 6b65 7320  ilding it takes 
-0000aa60: 7469 6d65 2e0a 2020 2020 2020 2020 2222  time..        ""
-0000aa70: 220a 2020 2020 2020 2020 706f 696e 7473  ".        points
-0000aa80: 203d 206d 6170 5f70 726f 6265 2e67 6574   = map_probe.get
-0000aa90: 5f70 6f73 2870 7269 6d61 7279 5f62 6f75  _pos(primary_bou
-0000aaa0: 6e64 6172 792c 2073 6563 6f6e 6461 7279  ndary, secondary
-0000aab0: 5f62 6f75 6e64 6172 7929 0a20 2020 2020  _boundary).     
-0000aac0: 2020 2072 6574 7572 6e20 6b64 7472 6565     return kdtree
-0000aad0: 2e71 7565 7279 2870 6f69 6e74 7329 5b30  .query(points)[0
-0000aae0: 5d0a 0a20 2020 2064 6566 2063 6861 6d66  ]..    def chamf
-0000aaf0: 6572 5f64 6973 7461 6e63 6528 0a20 2020  er_distance(.   
-0000ab00: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
-0000ab10: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-0000ab20: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
-0000ab30: 2020 206d 6170 5f70 726f 6265 2c0a 2020     map_probe,.  
-0000ab40: 2020 2020 2020 2020 2020 7072 696d 6172            primar
-0000ab50: 795f 626f 756e 6461 7279 2c0a 2020 2020  y_boundary,.    
-0000ab60: 2020 2020 2020 2020 7365 636f 6e64 6172          secondar
-0000ab70: 795f 626f 756e 6461 7279 2c0a 2020 2020  y_boundary,.    
-0000ab80: 2020 2020 2020 2020 6b64 7472 6565 3d4e          kdtree=N
-0000ab90: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
-0000aba0: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
-0000abb0: 2074 6865 2063 6861 6d66 6572 2064 6973   the chamfer dis
-0000abc0: 7461 6e63 6520 5363 6f72 6520 6265 7477  tance Score betw
-0000abd0: 6565 6e20 7477 6f20 4d61 7020 696e 7374  een two Map inst
-0000abe0: 616e 6365 732e 0a0a 2020 2020 2020 2020  ances...        
-0000abf0: 4375 7272 656e 746c 7920 756e 7374 6162  Currently unstab
-0000ac00: 6c65 2061 6e64 206e 6f74 2072 6563 6f6d  le and not recom
-0000ac10: 6d65 6e64 6564 2066 6f72 2075 7365 2e0a  mended for use..
-0000ac20: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
-0000ac30: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000ac40: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
-0000ac50: 7072 6f62 653a 204d 6170 2069 6e73 7461  probe: Map insta
-0000ac60: 6e63 6573 2074 6f20 636f 6d70 6172 652e  nces to compare.
-0000ac70: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000ac80: 6d61 7279 5f62 6f75 6e64 6172 793a 2054  mary_boundary: T
-0000ac90: 6872 6573 686f 6c64 2074 6861 7420 6465  hreshold that de
-0000aca0: 6669 6e65 6420 7468 6520 454d 206d 6170  fined the EM map
-0000acb0: 2073 7572 6661 6365 2c20 6261 7365 640a   surface, based.
-0000acc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000acd0: 6f6e 2074 6865 2076 6f6c 756d 6520 6f66  on the volume of
-0000ace0: 2074 6865 2070 726f 7465 696e 206d 6f64   the protein mod
-0000acf0: 656c 2e20 4361 6e20 6265 2063 616c 6375  el. Can be calcu
-0000ad00: 6c61 7465 6420 7573 696e 670a 2020 2020  lated using.    
-0000ad10: 2020 2020 2020 2020 2020 2020 3a6d 6574              :met
-0000ad20: 683a 604d 6170 2e6d 616b 654b 4454 7265  h:`Map.makeKDTre
-0000ad30: 6520 3c54 454d 5079 2e6d 6170 732e 656d  e <TEMPy.maps.em
-0000ad40: 5f6d 6170 2e4d 6170 2e67 6574 5f70 7269  _map.Map.get_pri
-0000ad50: 6d61 7279 5f62 6f75 6e64 6172 793e 600a  mary_boundary>`.
-0000ad60: 2020 2020 2020 2020 2020 2020 7365 636f              seco
-0000ad70: 6e64 6172 795f 626f 756e 6461 7279 3a20  ndary_boundary: 
-0000ad80: 5468 6520 7365 636f 6e64 2062 6f75 6e64  The second bound
-0000ad90: 2064 656e 7369 7479 2070 6f69 6e74 2e0a   density point..
-0000ada0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000adb0: 4361 6e20 6265 2063 616c 6375 6c61 7465  Can be calculate
-0000adc0: 6420 7573 696e 670a 2020 2020 2020 2020  d using.        
-0000add0: 2020 2020 2020 2020 3a6d 6574 683a 604d          :meth:`M
-0000ade0: 6170 2e6d 616b 654b 4454 7265 6520 3c54  ap.makeKDTree <T
-0000adf0: 454d 5079 2e6d 6170 732e 656d 5f6d 6170  EMPy.maps.em_map
-0000ae00: 2e4d 6170 2e67 6574 5f73 6563 6f6e 645f  .Map.get_second_
-0000ae10: 626f 756e 6461 7279 3e60 0a20 2020 2020  boundary>`.     
-0000ae20: 2020 2020 2020 206b 6474 7265 653a 2050         kdtree: P
-0000ae30: 7265 6361 6c63 756c 6174 6564 206b 6474  recalculated kdt
-0000ae40: 7265 652e 2049 6620 4e6f 6e65 2c20 4b44  ree. If None, KD
-0000ae50: 5472 6565 2069 7320 636f 6e73 7472 7563  Tree is construc
-0000ae60: 7465 6420 7573 696e 670a 2020 2020 2020  ted using.      
-0000ae70: 2020 2020 2020 2020 2020 3a6d 6574 683a            :meth:
-0000ae80: 604d 6170 2e6d 616b 654b 4454 7265 6520  `Map.makeKDTree 
-0000ae90: 3c54 454d 5079 2e6d 6170 732e 656d 5f6d  <TEMPy.maps.em_m
-0000aea0: 6170 2e4d 6170 2e6d 616b 654b 4454 7265  ap.Map.makeKDTre
-0000aeb0: 653e 600a 2020 2020 2020 2020 2222 220a  e>`.        """.
-0000aec0: 2020 2020 2020 2020 6966 2073 656c 662e          if self.
-0000aed0: 6d61 7043 6f6d 7061 7269 736f 6e28 6d61  mapComparison(ma
-0000aee0: 705f 7461 7267 6574 2c20 6d61 705f 7072  p_target, map_pr
-0000aef0: 6f62 6529 3a0a 2020 2020 2020 2020 2020  obe):.          
-0000af00: 2020 6d31 2c20 6d32 203d 206d 6170 5f74    m1, m2 = map_t
-0000af10: 6172 6765 742c 206d 6170 5f70 726f 6265  arget, map_probe
-0000af20: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0000af30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000af40: 5f66 6169 6c65 645f 6d61 7463 6828 290a  _failed_match().
-0000af50: 2020 2020 2020 2020 6966 206b 6474 7265          if kdtre
-0000af60: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000af70: 6574 7572 6e20 7365 6c66 2e5f 6861 7573  eturn self._haus
-0000af80: 646f 7266 665f 6c69 7374 280a 2020 2020  dorff_list(.    
-0000af90: 2020 2020 2020 2020 2020 2020 7072 696d              prim
-0000afa0: 6172 795f 626f 756e 6461 7279 2c20 7365  ary_boundary, se
-0000afb0: 636f 6e64 6172 795f 626f 756e 6461 7279  condary_boundary
-0000afc0: 2c20 6b64 7472 6565 2c20 6d32 0a20 2020  , kdtree, m2.   
-0000afd0: 2020 2020 2020 2020 2029 2e6d 6561 6e28           ).mean(
-0000afe0: 290a 2020 2020 2020 2020 656c 7365 3a0a  ).        else:.
-0000aff0: 2020 2020 2020 2020 2020 2020 7072 696e              prin
-0000b000: 7428 6d31 2c20 7072 696d 6172 795f 626f  t(m1, primary_bo
-0000b010: 756e 6461 7279 2c20 7365 636f 6e64 6172  undary, secondar
-0000b020: 795f 626f 756e 6461 7279 290a 2020 2020  y_boundary).    
-0000b030: 2020 2020 2020 2020 6b64 7472 6565 203d          kdtree =
-0000b040: 206d 312e 6d61 6b65 4b44 5472 6565 2870   m1.makeKDTree(p
-0000b050: 7269 6d61 7279 5f62 6f75 6e64 6172 792c  rimary_boundary,
-0000b060: 2073 6563 6f6e 6461 7279 5f62 6f75 6e64   secondary_bound
-0000b070: 6172 7929 0a20 2020 2020 2020 2020 2020  ary).           
-0000b080: 2069 6620 6b64 7472 6565 2069 7320 4e6f   if kdtree is No
-0000b090: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0000b0a0: 2020 2020 7072 696e 7428 2745 7272 6f72      print('Error
-0000b0b0: 2e20 4e6f 2070 6f69 6e74 7320 7365 6c65  . No points sele
-0000b0c0: 6374 6564 2c20 6368 616e 6765 2062 6f75  cted, change bou
-0000b0d0: 6e64 6172 7920 7061 7261 6d65 7465 7273  ndary parameters
-0000b0e0: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-0000b0f0: 2020 2020 7379 732e 6578 6974 2829 0a20      sys.exit(). 
-0000b100: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
-0000b110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b120: 2072 6574 7572 6e20 7365 6c66 2e5f 6861   return self._ha
-0000b130: 7573 646f 7266 665f 6c69 7374 280a 2020  usdorff_list(.  
-0000b140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b150: 2020 7072 696d 6172 795f 626f 756e 6461    primary_bounda
-0000b160: 7279 2c0a 2020 2020 2020 2020 2020 2020  ry,.            
-0000b170: 2020 2020 2020 2020 7365 636f 6e64 6172          secondar
-0000b180: 795f 626f 756e 6461 7279 2c0a 2020 2020  y_boundary,.    
-0000b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b1a0: 6b64 7472 6565 2c0a 2020 2020 2020 2020  kdtree,.        
-0000b1b0: 2020 2020 2020 2020 2020 2020 6d32 0a20              m2. 
-0000b1c0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000b1d0: 2e6d 6561 6e28 290a 0a20 2020 2064 6566  .mean()..    def
-0000b1e0: 205f 7375 7266 6163 655f 6469 7374 616e   _surface_distan
-0000b1f0: 6365 5f73 636f 7265 280a 2020 2020 2020  ce_score(.      
-0000b200: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-0000b210: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-0000b220: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
-0000b230: 6d61 705f 7072 6f62 652c 0a20 2020 2020  map_probe,.     
-0000b240: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-0000b250: 745f 7468 7265 7368 6f6c 6431 3d30 2e30  t_threshold1=0.0
-0000b260: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
-0000b270: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
-0000b280: 643d 302e 302c 0a20 2020 2020 2020 2020  d=0.0,.         
-0000b290: 2020 2046 696c 7465 723d 4e6f 6e65 2c0a     Filter=None,.
-0000b2a0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-0000b2b0: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
-0000b2c0: 323d 302e 302c 0a20 2020 2020 2020 2020  2=0.0,.         
-0000b2d0: 2020 2077 6569 6768 743d 4661 6c73 650a     weight=False.
-0000b2e0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0000b2f0: 2222 0a20 2020 2020 2020 2043 616c 6375  "".        Calcu
-0000b300: 6c61 7465 2074 6865 2063 6861 6d66 6572  late the chamfer
-0000b310: 2064 6973 7461 6e63 6520 5363 6f72 6520   distance Score 
-0000b320: 6265 7477 6565 6e20 7477 6f20 4d61 7020  between two Map 
-0000b330: 696e 7374 616e 6365 732e 0a0a 2020 2020  instances...    
-0000b340: 2020 2020 4172 6775 6d65 6e74 733a 0a20      Arguments:. 
-0000b350: 2020 2020 2020 2020 2020 202a 6d61 705f             *map_
-0000b360: 7461 7267 6574 2c20 6d61 705f 7072 6f62  target, map_prob
-0000b370: 652a 0a20 2020 2020 2020 2020 2020 2020  e*.             
-0000b380: 2020 2045 4d4d 6170 2069 6e73 7461 6e63     EMMap instanc
-0000b390: 6573 2074 6f20 636f 6d70 6172 652e 0a20  es to compare.. 
-0000b3a0: 2020 2020 2020 2020 2020 202a 6d61 705f             *map_
-0000b3b0: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
-0000b3c0: 312a 0a20 2020 2020 2020 2020 2020 2020  1*.             
-0000b3d0: 2020 2063 6f6e 746f 7572 2074 6872 6573     contour thres
-0000b3e0: 686f 6c64 206f 6620 7468 6520 7461 7267  hold of the targ
-0000b3f0: 6574 206d 6170 2e0a 2020 2020 2020 2020  et map..        
-0000b400: 2020 2020 2020 2020 5468 6973 2076 616c          This val
-0000b410: 7565 2069 7320 7573 6564 2074 6865 2070  ue is used the p
-0000b420: 7269 6d61 7279 2062 6f75 6e64 6172 7920  rimary boundary 
-0000b430: 6966 0a20 2020 2020 2020 2020 2020 2020  if.             
-0000b440: 2020 206d 6170 5f74 6172 6765 745f 7468     map_target_th
-0000b450: 7265 7368 6f6c 6432 2069 7320 6769 7665  reshold2 is give
-0000b460: 6e2e 0a20 2020 2020 2020 2020 2020 202a  n..            *
-0000b470: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
-0000b480: 6f6c 642a 0a20 2020 2020 2020 2020 2020  old*.           
-0000b490: 2020 2020 2063 6f6e 746f 7572 2074 6872       contour thr
-0000b4a0: 6573 686f 6c64 2066 6f72 2074 6865 2070  eshold for the p
-0000b4b0: 726f 6265 206d 6170 2e0a 2020 2020 2020  robe map..      
-0000b4c0: 2020 2020 2020 2a46 696c 7465 722a 0a20        *Filter*. 
-0000b4d0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000b4e0: 6566 696e 6974 696f 6e20 6f66 2074 6865  efinition of the
-0000b4f0: 2073 7572 6661 6365 3a0a 2020 2020 2020   surface:.      
-0000b500: 2020 2020 2020 2020 2020 2020 2020 3129                1)
-0000b510: 204e 6f6e 6520 3a20 7375 7266 6163 6520   None : surface 
-0000b520: 6465 6669 6e65 6420 6279 206b 6e6f 776e  defined by known
-0000b530: 2062 6f75 6e64 6172 6965 7320 2d0a 2020   boundaries -.  
+00009790: 2e30 0a20 2020 2020 2020 2020 2020 206c  .0.            l
+000097a0: 6179 6572 7331 203d 206d 6178 286c 6179  ayers1 = max(lay
+000097b0: 6572 7331 2c20 3135 290a 2020 2020 2020  ers1, 15).      
+000097c0: 2020 2020 2020 6c61 7965 7273 3220 3d20        layers2 = 
+000097d0: 6d61 7828 6c61 7965 7273 322c 2031 3529  max(layers2, 15)
+000097e0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+000097f0: 7765 6967 6874 3a0a 2020 2020 2020 2020  weight:.        
+00009800: 2020 2020 2020 2020 7774 203d 2031 0a20          wt = 1. 
+00009810: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+00009820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009830: 2077 7420 3d20 300a 2020 2020 2020 2020   wt = 0.        
+00009840: 2020 2020 6966 2063 6d6f 6465 3a0a 2020      if cmode:.  
+00009850: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
+00009860: 6320 3d20 7365 6c66 2e5f 4d49 5f43 280a  c = self._MI_C(.
+00009870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009880: 2020 2020 6e70 2e61 7272 6179 286d 6170      np.array(map
+00009890: 5f74 6172 6765 742e 6675 6c6c 4d61 7020  _target.fullMap 
+000098a0: 2a20 6d61 736b 5f61 7272 6179 292c 0a20  * mask_array),. 
+000098b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000098c0: 2020 206e 702e 6172 7261 7928 6d61 705f     np.array(map_
+000098d0: 7072 6f62 652e 6675 6c6c 4d61 7020 2a20  probe.fullMap * 
+000098e0: 6d61 736b 5f61 7272 6179 292c 0a20 2020  mask_array),.   
+000098f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009900: 206c 6179 6572 7331 2c0a 2020 2020 2020   layers1,.      
+00009910: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+00009920: 7965 7273 322c 0a20 2020 2020 2020 2020  yers2,.         
+00009930: 2020 2020 2020 2020 2020 2077 742c 0a20             wt,. 
+00009940: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+00009950: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
+00009960: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00009970: 2020 206d 6963 203d 204e 6f6e 650a 2020     mic = None.  
+00009980: 2020 2020 2020 2020 2020 6966 206d 6963            if mic
+00009990: 2069 7320 6e6f 7420 4e6f 6e65 3a0a 2020   is not None:.  
+000099a0: 2020 2020 2020 2020 2020 2020 2020 7265                re
+000099b0: 7475 726e 206d 6963 0a20 2020 2020 2020  turn mic.       
+000099c0: 2020 2020 2023 2064 6967 6974 697a 6520       # digitize 
+000099d0: 6d61 736b 6564 206d 6170 2062 6173 6564  masked map based
+000099e0: 206f 6e20 6c61 7965 7273 0a20 2020 2020   on layers.     
+000099f0: 2020 2020 2020 206d 6170 315f 6269 6e20         map1_bin 
+00009a00: 3d20 6d61 705f 7461 7267 6574 2e63 6f70  = map_target.cop
+00009a10: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
+00009a20: 6d61 7032 5f62 696e 203d 206d 6170 5f70  map2_bin = map_p
+00009a30: 726f 6265 2e63 6f70 7928 290a 2020 2020  robe.copy().    
+00009a40: 2020 2020 2020 2020 6d61 7031 5f62 696e          map1_bin
+00009a50: 2e66 756c 6c4d 6170 203d 206d 6170 315f  .fullMap = map1_
+00009a60: 6269 6e2e 6675 6c6c 4d61 7020 2a20 6d61  bin.fullMap * ma
+00009a70: 736b 5f61 7272 6179 0a20 2020 2020 2020  sk_array.       
+00009a80: 2020 2020 206d 6170 325f 6269 6e2e 6675       map2_bin.fu
+00009a90: 6c6c 4d61 7020 3d20 6d61 7032 5f62 696e  llMap = map2_bin
+00009aa0: 2e66 756c 6c4d 6170 202a 206d 6173 6b5f  .fullMap * mask_
+00009ab0: 6172 7261 790a 2020 2020 2020 2020 2020  array.          
+00009ac0: 2020 6d61 7031 5f62 696e 203d 206d 6170    map1_bin = map
+00009ad0: 315f 6269 6e2e 5f6d 6170 5f64 6967 6974  1_bin._map_digit
+00009ae0: 697a 6528 0a20 2020 2020 2020 2020 2020  ize(.           
+00009af0: 2020 2020 206d 6170 5f74 6172 6765 742e       map_target.
+00009b00: 6675 6c6c 4d61 705b 6d61 736b 5f61 7272  fullMap[mask_arr
+00009b10: 6179 5d2e 6d69 6e28 292c 0a20 2020 2020  ay].min(),.     
+00009b20: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00009b30: 7331 2c0a 2020 2020 2020 2020 2020 2020  s1,.            
+00009b40: 2020 2020 5472 7565 0a20 2020 2020 2020      True.       
+00009b50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00009b60: 2020 206d 6170 325f 6269 6e20 3d20 6d61     map2_bin = ma
+00009b70: 7032 5f62 696e 2e5f 6d61 705f 6469 6769  p2_bin._map_digi
+00009b80: 7469 7a65 280a 2020 2020 2020 2020 2020  tize(.          
+00009b90: 2020 2020 2020 6d61 705f 7072 6f62 652e        map_probe.
+00009ba0: 6675 6c6c 4d61 705b 6d61 736b 5f61 7272  fullMap[mask_arr
+00009bb0: 6179 5d2e 6d69 6e28 292c 0a20 2020 2020  ay].min(),.     
+00009bc0: 2020 2020 2020 2020 2020 206c 6179 6572             layer
+00009bd0: 7332 2c0a 2020 2020 2020 2020 2020 2020  s2,.            
+00009be0: 2020 2020 5472 7565 0a20 2020 2020 2020      True.       
+00009bf0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00009c00: 2020 2023 206d 616b 6520 7375 7265 2074     # make sure t
+00009c10: 6865 206f 7574 7369 6465 2072 6567 696f  he outside regio
+00009c20: 6e20 6973 2066 696c 6c65 6420 7769 7468  n is filled with
+00009c30: 207a 6572 6f73 0a20 2020 2020 2020 2020   zeros.         
+00009c40: 2020 206d 6170 315f 6269 6e2e 6675 6c6c     map1_bin.full
+00009c50: 4d61 7020 3d20 6d61 7031 5f62 696e 2e66  Map = map1_bin.f
+00009c60: 756c 6c4d 6170 202a 206d 6173 6b5f 6172  ullMap * mask_ar
+00009c70: 7261 790a 2020 2020 2020 2020 2020 2020  ray.            
+00009c80: 6d61 7032 5f62 696e 2e66 756c 6c4d 6170  map2_bin.fullMap
+00009c90: 203d 206d 6170 325f 6269 6e2e 6675 6c6c   = map2_bin.full
+00009ca0: 4d61 7020 2a20 6d61 736b 5f61 7272 6179  Map * mask_array
+00009cb0: 0a20 2020 2020 2020 2020 2020 2023 2062  .            # b
+00009cc0: 6163 6b67 726f 756e 6420 6672 6571 7565  ackground freque
+00009cd0: 6e63 6965 7320 6672 6f6d 2074 6865 2077  ncies from the w
+00009ce0: 686f 6c65 206d 6170 0a20 2020 2020 2020  hole map.       
+00009cf0: 2020 2020 2062 696e 7331 203d 205b 5d0a       bins1 = [].
+00009d00: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00009d10: 6920 696e 2072 616e 6765 286c 6179 6572  i in range(layer
+00009d20: 7331 202b 2032 293a 0a20 2020 2020 2020  s1 + 2):.       
+00009d30: 2020 2020 2020 2020 2062 696e 7331 2e61           bins1.a
+00009d40: 7070 656e 6428 6929 0a20 2020 2020 2020  ppend(i).       
+00009d50: 2020 2020 2062 696e 7332 203d 205b 5d0a       bins2 = [].
+00009d60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00009d70: 6920 696e 2072 616e 6765 286c 6179 6572  i in range(layer
+00009d80: 7332 202b 2032 293a 0a20 2020 2020 2020  s2 + 2):.       
+00009d90: 2020 2020 2020 2020 2062 696e 7332 2e61           bins2.a
+00009da0: 7070 656e 6428 6929 0a20 2020 2020 2020  ppend(i).       
+00009db0: 2020 2020 2023 2063 616c 6375 6c61 7465       # calculate
+00009dc0: 2066 7265 7175 656e 6379 206f 6620 6269   frequency of bi
+00009dd0: 6e73 0a20 2020 2020 2020 2020 2020 206d  ns.            m
+00009de0: 6170 315f 6672 6571 203d 206e 702e 6869  ap1_freq = np.hi
+00009df0: 7374 6f67 7261 6d28 6d61 7031 5f62 696e  stogram(map1_bin
+00009e00: 2e66 756c 6c4d 6170 2c20 6269 6e73 3129  .fullMap, bins1)
+00009e10: 5b30 5d5b 313a 5d0a 2020 2020 2020 2020  [0][1:].        
+00009e20: 2020 2020 6d61 7032 5f66 7265 7120 3d20      map2_freq = 
+00009e30: 6e70 2e68 6973 746f 6772 616d 286d 6170  np.histogram(map
+00009e40: 325f 6269 6e2e 6675 6c6c 4d61 702c 2062  2_bin.fullMap, b
+00009e50: 696e 7332 295b 305d 5b31 3a5d 0a0a 2020  ins2)[0][1:]..  
+00009e60: 2020 2020 2020 7363 6f72 6520 3d20 302e        score = 0.
+00009e70: 300a 2020 2020 2020 2020 746f 7461 6c20  0.        total 
+00009e80: 3d20 300a 0a20 2020 2020 2020 2069 6620  = 0..        if 
+00009e90: 6e70 2e73 756d 286d 6170 315f 6672 6571  np.sum(map1_freq
+00009ea0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+00009eb0: 2020 2020 7072 696e 7428 0a20 2020 2020      print(.     
+00009ec0: 2020 2020 2020 2020 2020 2027 4e6f 206d             'No m
+00009ed0: 6170 206f 7665 726c 6170 2028 4d75 7475  ap overlap (Mutu
+00009ee0: 616c 2069 6e66 6f72 6d61 7469 6f6e 2073  al information s
+00009ef0: 636f 7265 292c 2065 7869 7469 6e67 2073  core), exiting s
+00009f00: 636f 7265 2027 0a20 2020 2020 2020 2020  core '.         
+00009f10: 2020 2020 2020 2027 6361 6c63 756c 6174         'calculat
+00009f20: 696f 6e2e 2e27 0a20 2020 2020 2020 2020  ion..'.         
+00009f30: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00009f40: 2072 6574 7572 6e20 302e 300a 2020 2020   return 0.0.    
+00009f50: 2020 2020 6966 206e 702e 7375 6d28 6d61      if np.sum(ma
+00009f60: 7032 5f66 7265 7129 203d 3d20 303a 0a20  p2_freq) == 0:. 
+00009f70: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00009f80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00009f90: 2020 274e 6f20 6d61 7020 6f76 6572 6c61    'No map overla
+00009fa0: 7020 284d 7574 7561 6c20 696e 666f 726d  p (Mutual inform
+00009fb0: 6174 696f 6e20 7363 6f72 6529 2c20 6578  ation score), ex
+00009fc0: 6974 696e 6720 7363 6f72 6520 270a 2020  iting score '.  
+00009fd0: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+00009fe0: 616c 6375 6c61 7469 6f6e 2e2e 270a 2020  alculation..'.  
+00009ff0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+0000a000: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
+0000a010: 2e30 0a20 2020 2020 2020 206c 6973 745f  .0.        list_
+0000a020: 6f76 6572 6c61 7073 203d 205b 5d0a 2020  overlaps = [].  
+0000a030: 2020 2020 2020 666f 7220 7820 696e 2072        for x in r
+0000a040: 616e 6765 286c 6179 6572 7331 293a 0a20  ange(layers1):. 
+0000a050: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+0000a060: 6172 7261 7920 3d20 6d61 7031 5f62 696e  array = map1_bin
+0000a070: 2e66 756c 6c4d 6170 203d 3d20 666c 6f61  .fullMap == floa
+0000a080: 7428 782b 3129 0a20 2020 2020 2020 2020  t(x+1).         
+0000a090: 2020 206f 7665 726c 6170 5f66 7265 7120     overlap_freq 
+0000a0a0: 3d20 6e70 2e68 6973 746f 6772 616d 280a  = np.histogram(.
+0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a0c0: 6d61 7032 5f62 696e 2e66 756c 6c4d 6170  map2_bin.fullMap
+0000a0d0: 5b6d 6173 6b5f 6172 7261 795d 2c20 6269  [mask_array], bi
+0000a0e0: 6e73 320a 2020 2020 2020 2020 2020 2020  ns2.            
+0000a0f0: 295b 305d 5b31 3a5d 0a20 2020 2020 2020  )[0][1:].       
+0000a100: 2020 2020 2074 6f74 616c 202b 3d20 666c       total += fl
+0000a110: 6f61 7428 6e70 2e73 756d 286f 7665 726c  oat(np.sum(overl
+0000a120: 6170 5f66 7265 7129 290a 2020 2020 2020  ap_freq)).      
+0000a130: 2020 2020 2020 6c69 7374 5f6f 7665 726c        list_overl
+0000a140: 6170 732e 6170 7065 6e64 286f 7665 726c  aps.append(overl
+0000a150: 6170 5f66 7265 7129 0a0a 2020 2020 2020  ap_freq)..      
+0000a160: 2020 6966 2074 6f74 616c 203d 3d20 303a    if total == 0:
+0000a170: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0000a180: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
+0000a190: 2020 2020 274e 6f20 6d61 7020 6f76 6572      'No map over
+0000a1a0: 6c61 7020 284d 7574 7561 6c20 696e 666f  lap (Mutual info
+0000a1b0: 726d 6174 696f 6e20 7363 6f72 6529 2c20  rmation score), 
+0000a1c0: 6578 6974 696e 6720 7363 6f72 6520 270a  exiting score '.
+0000a1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1e0: 2763 616c 6375 6c61 7469 6f6e 2e2e 270a  'calculation..'.
+0000a1f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000a200: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000a210: 2030 2e30 0a20 2020 2020 2020 2065 6e74   0.0.        ent
+0000a220: 6572 203d 2030 0a20 2020 2020 2020 2048  er = 0.        H
+0000a230: 7879 203d 2030 2e30 0a20 2020 2020 2020  xy = 0.0.       
+0000a240: 2048 7820 3d20 302e 300a 2020 2020 2020   Hx = 0.0.      
+0000a250: 2020 4879 203d 2030 2e30 0a20 2020 2020    Hy = 0.0.     
+0000a260: 2020 206d 695f 7363 6f72 6520 3d20 302e     mi_score = 0.
+0000a270: 300a 2020 2020 2020 2020 705f 636f 6d62  0.        p_comb
+0000a280: 203d 2030 2e30 0a20 2020 2020 2020 2066   = 0.0.        f
+0000a290: 6f72 2078 2069 6e20 7261 6e67 6528 6c61  or x in range(la
+0000a2a0: 7965 7273 3129 3a0a 2020 2020 2020 2020  yers1):.        
+0000a2b0: 2020 2020 705f 6d31 203d 206d 6170 315f      p_m1 = map1_
+0000a2c0: 6672 6571 5b78 5d2f 666c 6f61 7428 6e70  freq[x]/float(np
+0000a2d0: 2e73 756d 286d 6170 315f 6672 6571 2929  .sum(map1_freq))
+0000a2e0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0000a2f0: 2079 2069 6e20 7261 6e67 6528 6c61 7965   y in range(laye
+0000a300: 7273 3229 3a0a 2020 2020 2020 2020 2020  rs2):.          
+0000a310: 2020 2020 2020 656e 7465 7220 3d20 310a        enter = 1.
+0000a320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a330: 705f 636f 6d62 203d 206c 6973 745f 6f76  p_comb = list_ov
+0000a340: 6572 6c61 7073 5b78 5d5b 795d 2f74 6f74  erlaps[x][y]/tot
+0000a350: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
+0000a360: 2020 2070 5f6d 3220 3d20 6d61 7032 5f66     p_m2 = map2_f
+0000a370: 7265 715b 795d 202f 2066 6c6f 6174 286e  req[y] / float(n
+0000a380: 702e 7375 6d28 6d61 7032 5f66 7265 7129  p.sum(map2_freq)
+0000a390: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000a3a0: 2020 6966 2070 5f63 6f6d 6220 3d3d 2030    if p_comb == 0
+0000a3b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000a3c0: 2020 2020 2020 6d69 5f73 636f 7265 203d        mi_score =
+0000a3d0: 2030 2e30 0a0a 2020 2020 2020 2020 2020   0.0..          
+0000a3e0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000a3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a400: 4878 7920 2b3d 202d 705f 636f 6d62 202a  Hxy += -p_comb *
+0000a410: 206d 6174 682e 6c6f 6728 705f 636f 6d62   math.log(p_comb
+0000a420: 2c20 3229 0a20 2020 2020 2020 2020 2020  , 2).           
+0000a430: 2020 2020 2073 636f 7265 202b 3d20 6d69       score += mi
+0000a440: 5f73 636f 7265 0a20 2020 2020 2020 2020  _score.         
+0000a450: 2020 2020 2020 2069 6620 7820 3d3d 2030         if x == 0
+0000a460: 2061 6e64 206e 6f74 2070 5f6d 3220 3d3d   and not p_m2 ==
+0000a470: 2030 2e30 3a0a 2020 2020 2020 2020 2020   0.0:.          
+0000a480: 2020 2020 2020 2020 2020 4879 202b 3d20            Hy += 
+0000a490: 282d 705f 6d32 202a 206d 6174 682e 6c6f  (-p_m2 * math.lo
+0000a4a0: 6728 705f 6d32 2c20 3229 290a 2020 2020  g(p_m2, 2)).    
+0000a4b0: 2020 2020 2020 2020 6966 206e 6f74 2070          if not p
+0000a4c0: 5f6d 3120 3d3d 2030 2e30 3a0a 2020 2020  _m1 == 0.0:.    
+0000a4d0: 2020 2020 2020 2020 2020 2020 4878 202b              Hx +
+0000a4e0: 3d20 282d 705f 6d31 202a 206d 6174 682e  = (-p_m1 * math.
+0000a4f0: 6c6f 6728 705f 6d31 2c20 3229 290a 2020  log(p_m1, 2)).  
+0000a500: 2020 2020 2020 6966 2065 6e74 6572 203d        if enter =
+0000a510: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0000a520: 2069 6620 7765 6967 6874 3a0a 2020 2020   if weight:.    
+0000a530: 2020 2020 2020 2020 2020 2020 6966 2048              if H
+0000a540: 7879 203d 3d20 302e 303a 0a20 2020 2020  xy == 0.0:.     
+0000a550: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000a560: 6574 7572 6e20 302e 300a 2020 2020 2020  eturn 0.0.      
+0000a570: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000a580: 2028 4878 202b 2048 7929 202f 2048 7879   (Hx + Hy) / Hxy
+0000a590: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000a5a0: 7572 6e20 4878 202b 2048 7920 2d20 4878  urn Hx + Hy - Hx
+0000a5b0: 790a 2020 2020 2020 2020 656c 7365 3a0a  y.        else:.
+0000a5c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000a5d0: 726e 204e 6f6e 650a 0a20 2020 2064 6566  rn None..    def
+0000a5e0: 205f 6861 7573 646f 7266 665f 6c69 7374   _hausdorff_list
+0000a5f0: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000a600: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000a610: 7072 696d 6172 795f 626f 756e 6461 7279  primary_boundary
+0000a620: 2c0a 2020 2020 2020 2020 2020 2020 7365  ,.            se
+0000a630: 636f 6e64 6172 795f 626f 756e 6461 7279  condary_boundary
+0000a640: 2c0a 2020 2020 2020 2020 2020 2020 6b64  ,.            kd
+0000a650: 7472 6565 2c0a 2020 2020 2020 2020 2020  tree,.          
+0000a660: 2020 6d61 705f 7072 6f62 652c 0a20 2020    map_probe,.   
+0000a670: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0000a680: 2020 2020 2020 2020 5468 6973 2069 7320          This is 
+0000a690: 666f 7220 7468 6520 6368 616d 6465 6620  for the chamdef 
+0000a6a0: 6469 7374 616e 6365 2064 6566 2063 6861  distance def cha
+0000a6b0: 6d66 6572 5f64 6973 7461 6e63 652c 206d  mfer_distance, m
+0000a6c0: 696e 206d 6178 2064 656e 7369 7479 0a20  in max density. 
+0000a6d0: 2020 2020 2020 2076 616c 7565 2074 6861         value tha
+0000a6e0: 7420 6465 6669 6e65 2074 6865 2073 7572  t define the sur
+0000a6f0: 6661 6365 206f 6620 7468 6520 7072 6f74  face of the prot
+0000a700: 6569 6e0a 0a20 2020 2020 2020 2041 7267  ein..        Arg
+0000a710: 756d 656e 7473 3a0a 2020 2020 2020 2020  uments:.        
+0000a720: 2020 2020 2a6b 6474 7265 652a 0a20 2020      *kdtree*.   
+0000a730: 2020 2020 2020 2020 2020 2020 2028 7468               (th
+0000a740: 6572 6520 6172 6520 3220 6f66 2074 6865  ere are 2 of the
+0000a750: 6d20 696e 206e 756d 7079 206f 6e65 2043  m in numpy one C
+0000a760: 6261 7365 6420 6f6e 2070 792d 6261 7365  based on py-base
+0000a770: 642c 2074 6865 0a20 2020 2020 2020 2020  d, the.         
+0000a780: 2020 2020 2020 206c 6174 7465 7220 6973         latter is
+0000a790: 2062 6574 7465 722c 2063 7472 6c29 2074   better, ctrl) t
+0000a7a0: 6869 7320 6861 7665 2074 6f20 6265 206f  his have to be o
+0000a7b0: 6e65 206f 6620 7468 6520 696e 7075 742e  ne of the input.
+0000a7c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a7d0: 206b 6474 7265 6520 6672 6f6d 206d 6170   kdtree from map
+0000a7e0: 5f74 6172 6765 740a 2020 2020 2020 2020  _target.        
+0000a7f0: 2020 2020 2a70 7269 6d61 7279 5f62 6f75      *primary_bou
+0000a800: 6e64 6172 792c 2073 6563 6f6e 6461 7279  ndary, secondary
+0000a810: 5f62 6f75 6e64 6172 792a 0a20 2020 2020  _boundary*.     
+0000a820: 2020 2020 2020 2020 2020 206e 6565 6420             need 
+0000a830: 746f 2072 756e 2067 6574 5f70 7269 6d61  to run get_prima
+0000a840: 7279 5f62 6f75 6e64 6172 7920 616e 6420  ry_boundary and 
+0000a850: 6765 745f 7365 636f 6e64 5f62 6f75 6e64  get_second_bound
+0000a860: 6172 7920 666f 720a 2020 2020 2020 2020  ary for.        
+0000a870: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+0000a880: 650a 0a20 2020 2020 2020 2020 2020 204e  e..            N
+0000a890: 4f54 453a 2069 6620 796f 7520 6b65 6570  OTE: if you keep
+0000a8a0: 2074 6865 206b 6474 7265 6520 6173 2070   the kdtree as p
+0000a8b0: 6172 616d 6574 7265 206f 7574 206f 7320  arametre out os 
+0000a8c0: 6c65 7373 2074 696d 650a 2020 2020 2020  less time.      
+0000a8d0: 2020 2020 2020 636f 6e73 756d 696e 6720        consuming 
+0000a8e0: 6173 2062 7569 6c64 696e 6720 6974 2074  as building it t
+0000a8f0: 616b 6573 2074 696d 652e 0a20 2020 2020  akes time..     
+0000a900: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+0000a910: 6f69 6e74 7320 3d20 6d61 705f 7072 6f62  oints = map_prob
+0000a920: 652e 6765 745f 706f 7328 7072 696d 6172  e.get_pos(primar
+0000a930: 795f 626f 756e 6461 7279 2c20 7365 636f  y_boundary, seco
+0000a940: 6e64 6172 795f 626f 756e 6461 7279 290a  ndary_boundary).
+0000a950: 2020 2020 2020 2020 7265 7475 726e 206b          return k
+0000a960: 6474 7265 652e 7175 6572 7928 706f 696e  dtree.query(poin
+0000a970: 7473 295b 305d 0a0a 2020 2020 6465 6620  ts)[0]..    def 
+0000a980: 6368 616d 6665 725f 6469 7374 616e 6365  chamfer_distance
+0000a990: 280a 2020 2020 2020 2020 2020 2020 7365  (.            se
+0000a9a0: 6c66 2c0a 2020 2020 2020 2020 2020 2020  lf,.            
+0000a9b0: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
+0000a9c0: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+0000a9d0: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
+0000a9e0: 7269 6d61 7279 5f62 6f75 6e64 6172 792c  rimary_boundary,
+0000a9f0: 0a20 2020 2020 2020 2020 2020 2073 6563  .            sec
+0000aa00: 6f6e 6461 7279 5f62 6f75 6e64 6172 792c  ondary_boundary,
+0000aa10: 0a20 2020 2020 2020 2020 2020 206b 6474  .            kdt
+0000aa20: 7265 653d 4e6f 6e65 2c0a 2020 2020 293a  ree=None,.    ):
+0000aa30: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
+0000aa40: 756c 6174 6520 7468 6520 6368 616d 6665  ulate the chamfe
+0000aa50: 7220 6469 7374 616e 6365 2053 636f 7265  r distance Score
+0000aa60: 2062 6574 7765 656e 2074 776f 204d 6170   between two Map
+0000aa70: 2069 6e73 7461 6e63 6573 2e0a 0a20 2020   instances...   
+0000aa80: 2020 2020 2043 7572 7265 6e74 6c79 2075       Currently u
+0000aa90: 6e73 7461 626c 6520 616e 6420 6e6f 7420  nstable and not 
+0000aaa0: 7265 636f 6d6d 656e 6465 6420 666f 7220  recommended for 
+0000aab0: 7573 652e 0a0a 2020 2020 2020 2020 4172  use...        Ar
+0000aac0: 6775 6d65 6e74 733a 0a20 2020 2020 2020  guments:.       
+0000aad0: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
+0000aae0: 206d 6170 5f70 726f 6265 3a20 4d61 7020   map_probe: Map 
+0000aaf0: 696e 7374 616e 6365 7320 746f 2063 6f6d  instances to com
+0000ab00: 7061 7265 2e0a 2020 2020 2020 2020 2020  pare..          
+0000ab10: 2020 7072 696d 6172 795f 626f 756e 6461    primary_bounda
+0000ab20: 7279 3a20 5468 7265 7368 6f6c 6420 7468  ry: Threshold th
+0000ab30: 6174 2064 6566 696e 6564 2074 6865 2045  at defined the E
+0000ab40: 4d20 6d61 7020 7375 7266 6163 652c 2062  M map surface, b
+0000ab50: 6173 6564 0a20 2020 2020 2020 2020 2020  ased.           
+0000ab60: 2020 2020 206f 6e20 7468 6520 766f 6c75       on the volu
+0000ab70: 6d65 206f 6620 7468 6520 7072 6f74 6569  me of the protei
+0000ab80: 6e20 6d6f 6465 6c2e 2043 616e 2062 6520  n model. Can be 
+0000ab90: 6361 6c63 756c 6174 6564 2075 7369 6e67  calculated using
+0000aba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000abb0: 203a 6d65 7468 3a60 4d61 702e 6d61 6b65   :meth:`Map.make
+0000abc0: 4b44 5472 6565 203c 5445 4d50 792e 6d61  KDTree <TEMPy.ma
+0000abd0: 7073 2e65 6d5f 6d61 702e 4d61 702e 6765  ps.em_map.Map.ge
+0000abe0: 745f 7072 696d 6172 795f 626f 756e 6461  t_primary_bounda
+0000abf0: 7279 3e60 0a20 2020 2020 2020 2020 2020  ry>`.           
+0000ac00: 2073 6563 6f6e 6461 7279 5f62 6f75 6e64   secondary_bound
+0000ac10: 6172 793a 2054 6865 2073 6563 6f6e 6420  ary: The second 
+0000ac20: 626f 756e 6420 6465 6e73 6974 7920 706f  bound density po
+0000ac30: 696e 742e 0a20 2020 2020 2020 2020 2020  int..           
+0000ac40: 2020 2020 2043 616e 2062 6520 6361 6c63       Can be calc
+0000ac50: 756c 6174 6564 2075 7369 6e67 0a20 2020  ulated using.   
+0000ac60: 2020 2020 2020 2020 2020 2020 203a 6d65               :me
+0000ac70: 7468 3a60 4d61 702e 6d61 6b65 4b44 5472  th:`Map.makeKDTr
+0000ac80: 6565 203c 5445 4d50 792e 6d61 7073 2e65  ee <TEMPy.maps.e
+0000ac90: 6d5f 6d61 702e 4d61 702e 6765 745f 7365  m_map.Map.get_se
+0000aca0: 636f 6e64 5f62 6f75 6e64 6172 793e 600a  cond_boundary>`.
+0000acb0: 2020 2020 2020 2020 2020 2020 6b64 7472              kdtr
+0000acc0: 6565 3a20 5072 6563 616c 6375 6c61 7465  ee: Precalculate
+0000acd0: 6420 6b64 7472 6565 2e20 4966 204e 6f6e  d kdtree. If Non
+0000ace0: 652c 204b 4454 7265 6520 6973 2063 6f6e  e, KDTree is con
+0000acf0: 7374 7275 6374 6564 2075 7369 6e67 0a20  structed using. 
+0000ad00: 2020 2020 2020 2020 2020 2020 2020 203a                 :
+0000ad10: 6d65 7468 3a60 4d61 702e 6d61 6b65 4b44  meth:`Map.makeKD
+0000ad20: 5472 6565 203c 5445 4d50 792e 6d61 7073  Tree <TEMPy.maps
+0000ad30: 2e65 6d5f 6d61 702e 4d61 702e 6d61 6b65  .em_map.Map.make
+0000ad40: 4b44 5472 6565 3e60 0a20 2020 2020 2020  KDTree>`.       
+0000ad50: 2022 2222 0a20 2020 2020 2020 2069 6620   """.        if 
+0000ad60: 7365 6c66 2e6d 6170 436f 6d70 6172 6973  self.mapComparis
+0000ad70: 6f6e 286d 6170 5f74 6172 6765 742c 206d  on(map_target, m
+0000ad80: 6170 5f70 726f 6265 293a 0a20 2020 2020  ap_probe):.     
+0000ad90: 2020 2020 2020 206d 312c 206d 3220 3d20         m1, m2 = 
+0000ada0: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
+0000adb0: 7072 6f62 650a 2020 2020 2020 2020 656c  probe.        el
+0000adc0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000add0: 7365 6c66 2e5f 6661 696c 6564 5f6d 6174  self._failed_mat
+0000ade0: 6368 2829 0a20 2020 2020 2020 2069 6620  ch().        if 
+0000adf0: 6b64 7472 6565 3a0a 2020 2020 2020 2020  kdtree:.        
+0000ae00: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
+0000ae10: 5f68 6175 7364 6f72 6666 5f6c 6973 7428  _hausdorff_list(
+0000ae20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ae30: 2070 7269 6d61 7279 5f62 6f75 6e64 6172   primary_boundar
+0000ae40: 792c 2073 6563 6f6e 6461 7279 5f62 6f75  y, secondary_bou
+0000ae50: 6e64 6172 792c 206b 6474 7265 652c 206d  ndary, kdtree, m
+0000ae60: 320a 2020 2020 2020 2020 2020 2020 292e  2.            ).
+0000ae70: 6d65 616e 2829 0a20 2020 2020 2020 2065  mean().        e
+0000ae80: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ae90: 2070 7269 6e74 286d 312c 2070 7269 6d61   print(m1, prima
+0000aea0: 7279 5f62 6f75 6e64 6172 792c 2073 6563  ry_boundary, sec
+0000aeb0: 6f6e 6461 7279 5f62 6f75 6e64 6172 7929  ondary_boundary)
+0000aec0: 0a20 2020 2020 2020 2020 2020 206b 6474  .            kdt
+0000aed0: 7265 6520 3d20 6d31 2e6d 616b 654b 4454  ree = m1.makeKDT
+0000aee0: 7265 6528 7072 696d 6172 795f 626f 756e  ree(primary_boun
+0000aef0: 6461 7279 2c20 7365 636f 6e64 6172 795f  dary, secondary_
+0000af00: 626f 756e 6461 7279 290a 2020 2020 2020  boundary).      
+0000af10: 2020 2020 2020 6966 206b 6474 7265 6520        if kdtree 
+0000af20: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+0000af30: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0000af40: 4572 726f 722e 204e 6f20 706f 696e 7473  Error. No points
+0000af50: 2073 656c 6563 7465 642c 2063 6861 6e67   selected, chang
+0000af60: 6520 626f 756e 6461 7279 2070 6172 616d  e boundary param
+0000af70: 6574 6572 732e 2729 0a20 2020 2020 2020  eters.').       
+0000af80: 2020 2020 2020 2020 2073 7973 2e65 7869           sys.exi
+0000af90: 7428 290a 2020 2020 2020 2020 2020 2020  t().            
+0000afa0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000afb0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+0000afc0: 662e 5f68 6175 7364 6f72 6666 5f6c 6973  f._hausdorff_lis
+0000afd0: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0000afe0: 2020 2020 2020 2070 7269 6d61 7279 5f62         primary_b
+0000aff0: 6f75 6e64 6172 792c 0a20 2020 2020 2020  oundary,.       
+0000b000: 2020 2020 2020 2020 2020 2020 2073 6563               sec
+0000b010: 6f6e 6461 7279 5f62 6f75 6e64 6172 792c  ondary_boundary,
+0000b020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b030: 2020 2020 206b 6474 7265 652c 0a20 2020       kdtree,.   
+0000b040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b050: 206d 320a 2020 2020 2020 2020 2020 2020   m2.            
+0000b060: 2020 2020 292e 6d65 616e 2829 0a0a 2020      ).mean()..  
+0000b070: 2020 6465 6620 5f73 7572 6661 6365 5f64    def _surface_d
+0000b080: 6973 7461 6e63 655f 7363 6f72 6528 0a20  istance_score(. 
+0000b090: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+0000b0a0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+0000b0b0: 5f74 6172 6765 742c 0a20 2020 2020 2020  _target,.       
+0000b0c0: 2020 2020 206d 6170 5f70 726f 6265 2c0a       map_probe,.
+0000b0d0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000b0e0: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
+0000b0f0: 313d 302e 302c 0a20 2020 2020 2020 2020  1=0.0,.         
+0000b100: 2020 206d 6170 5f70 726f 6265 5f74 6872     map_probe_thr
+0000b110: 6573 686f 6c64 3d30 2e30 2c0a 2020 2020  eshold=0.0,.    
+0000b120: 2020 2020 2020 2020 4669 6c74 6572 3d4e          Filter=N
+0000b130: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0000b140: 206d 6170 5f74 6172 6765 745f 7468 7265   map_target_thre
+0000b150: 7368 6f6c 6432 3d30 2e30 2c0a 2020 2020  shold2=0.0,.    
+0000b160: 2020 2020 2020 2020 7765 6967 6874 3d46          weight=F
+0000b170: 616c 7365 0a20 2020 2029 3a0a 2020 2020  alse.    ):.    
+0000b180: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000b190: 4361 6c63 756c 6174 6520 7468 6520 6368  Calculate the ch
+0000b1a0: 616d 6665 7220 6469 7374 616e 6365 2053  amfer distance S
+0000b1b0: 636f 7265 2062 6574 7765 656e 2074 776f  core between two
+0000b1c0: 204d 6170 2069 6e73 7461 6e63 6573 2e0a   Map instances..
+0000b1d0: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
+0000b1e0: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+0000b1f0: 2a6d 6170 5f74 6172 6765 742c 206d 6170  *map_target, map
+0000b200: 5f70 726f 6265 2a0a 2020 2020 2020 2020  _probe*.        
+0000b210: 2020 2020 2020 2020 454d 4d61 7020 696e          EMMap in
+0000b220: 7374 616e 6365 7320 746f 2063 6f6d 7061  stances to compa
+0000b230: 7265 2e0a 2020 2020 2020 2020 2020 2020  re..            
+0000b240: 2a6d 6170 5f74 6172 6765 745f 7468 7265  *map_target_thre
+0000b250: 7368 6f6c 6431 2a0a 2020 2020 2020 2020  shold1*.        
+0000b260: 2020 2020 2020 2020 636f 6e74 6f75 7220          contour 
+0000b270: 7468 7265 7368 6f6c 6420 6f66 2074 6865  threshold of the
+0000b280: 2074 6172 6765 7420 6d61 702e 0a20 2020   target map..   
+0000b290: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+0000b2a0: 7320 7661 6c75 6520 6973 2075 7365 6420  s value is used 
+0000b2b0: 7468 6520 7072 696d 6172 7920 626f 756e  the primary boun
+0000b2c0: 6461 7279 2069 660a 2020 2020 2020 2020  dary if.        
+0000b2d0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+0000b2e0: 6574 5f74 6872 6573 686f 6c64 3220 6973  et_threshold2 is
+0000b2f0: 2067 6976 656e 2e0a 2020 2020 2020 2020   given..        
+0000b300: 2020 2020 2a6d 6170 5f70 726f 6265 5f74      *map_probe_t
+0000b310: 6872 6573 686f 6c64 2a0a 2020 2020 2020  hreshold*.      
+0000b320: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
+0000b330: 7220 7468 7265 7368 6f6c 6420 666f 7220  r threshold for 
+0000b340: 7468 6520 7072 6f62 6520 6d61 702e 0a20  the probe map.. 
+0000b350: 2020 2020 2020 2020 2020 202a 4669 6c74             *Filt
+0000b360: 6572 2a0a 2020 2020 2020 2020 2020 2020  er*.            
+0000b370: 2020 2020 6465 6669 6e69 7469 6f6e 206f      definition o
+0000b380: 6620 7468 6520 7375 7266 6163 653a 0a20  f the surface:. 
+0000b390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3a0: 2020 2031 2920 4e6f 6e65 203a 2073 7572     1) None : sur
+0000b3b0: 6661 6365 2064 6566 696e 6564 2062 7920  face defined by 
+0000b3c0: 6b6e 6f77 6e20 626f 756e 6461 7269 6573  known boundaries
+0000b3d0: 202d 0a20 2020 2020 2020 2020 2020 2020   -.             
+0000b3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b3f0: 206d 6170 5f74 6172 6765 745f 7468 7265   map_target_thre
+0000b400: 7368 6f6c 6431 2026 206d 6170 5f74 6172  shold1 & map_tar
+0000b410: 6765 745f 7468 7265 7368 6f6c 6432 0a20  get_threshold2. 
+0000b420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b430: 2020 2049 6620 7468 6520 626f 756e 6461     If the bounda
+0000b440: 7269 6573 2061 7265 206e 6f74 206b 6e6f  ries are not kno
+0000b450: 776e 2061 6e64 2074 6172 6765 7426 7072  wn and target&pr
+0000b460: 6f62 6520 6d61 700a 2020 2020 2020 2020  obe map.        
+0000b470: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
+0000b480: 6f75 7220 6c65 7665 6c73 2061 7265 206b  our levels are k
+0000b490: 6e6f 776e 3a0a 2020 2020 2020 2020 2020  nown:.          
+0000b4a0: 2020 2020 2020 2020 2020 2020 2020 3229                2)
+0000b4b0: 2053 7464 203a 2074 6f20 6465 6669 6e65   Std : to define
+0000b4c0: 2074 6865 2062 6f75 6e64 6172 6965 732c   the boundaries,
+0000b4d0: 2063 6f6e 746f 7572 206c 6576 656c 202b   contour level +
+0000b4e0: 2d20 3525 0a20 2020 2020 2020 2020 2020  - 5%.           
+0000b4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b500: 2020 2020 2020 7369 676d 6120 6973 2063        sigma is c
+0000b510: 616c 6375 6c61 7465 642e 2035 2573 6967  alculated. 5%sig
+0000b520: 6d61 2069 7320 7573 6564 2074 6f20 6c69  ma is used to li
+0000b530: 6d69 740a 2020 2020 2020 2020 2020 2020  mit.            
 0000b540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b550: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-0000b560: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
-0000b570: 3120 2620 6d61 705f 7461 7267 6574 5f74  1 & map_target_t
-0000b580: 6872 6573 686f 6c64 320a 2020 2020 2020  hreshold2.      
-0000b590: 2020 2020 2020 2020 2020 2020 2020 4966                If
-0000b5a0: 2074 6865 2062 6f75 6e64 6172 6965 7320   the boundaries 
-0000b5b0: 6172 6520 6e6f 7420 6b6e 6f77 6e20 616e  are not known an
-0000b5c0: 6420 7461 7267 6574 2670 726f 6265 206d  d target&probe m
-0000b5d0: 6170 0a20 2020 2020 2020 2020 2020 2020  ap.             
-0000b5e0: 2020 2020 2020 2063 6f6e 746f 7572 206c         contour l
-0000b5f0: 6576 656c 7320 6172 6520 6b6e 6f77 6e3a  evels are known:
-0000b600: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b610: 2020 2020 2020 2020 2032 2920 5374 6420           2) Std 
-0000b620: 3a20 746f 2064 6566 696e 6520 7468 6520  : to define the 
-0000b630: 626f 756e 6461 7269 6573 2c20 636f 6e74  boundaries, cont
-0000b640: 6f75 7220 6c65 7665 6c20 2b2d 2035 250a  our level +- 5%.
+0000b550: 2020 2020 2074 6865 206e 756d 6265 7220       the number 
+0000b560: 6f66 2070 6f69 6e74 7320 7069 636b 6564  of points picked
+0000b570: 2061 7320 7375 7266 6163 652e 2046 6f72   as surface. For
+0000b580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5a0: 2020 736d 616c 6c20 6d61 7073 2c20 6869    small maps, hi
+0000b5b0: 6768 6572 2076 616c 7565 7320 2865 673a  gher values (eg:
+0000b5c0: 2031 3025 7369 676d 6129 0a20 2020 2020   10%sigma).     
+0000b5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b5e0: 2020 2020 2020 2020 2020 2020 6361 6e20              can 
+0000b5f0: 6265 2075 7365 642e 0a20 2020 2020 2020  be used..       
+0000b600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b610: 2033 2920 4d65 616e 3a20 6120 6d65 616e   3) Mean: a mean
+0000b620: 2066 696c 7465 7220 6973 2061 7070 6c69   filter is appli
+0000b630: 6564 206f 6e20 7468 6520 6269 6e61 7279  ed on the binary
+0000b640: 2063 6f6e 746f 7572 0a20 2020 2020 2020   contour.       
 0000b650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b670: 2073 6967 6d61 2069 7320 6361 6c63 756c   sigma is calcul
-0000b680: 6174 6564 2e20 3525 7369 676d 6120 6973  ated. 5%sigma is
-0000b690: 2075 7365 6420 746f 206c 696d 6974 0a20   used to limit. 
+0000b660: 2020 2020 2020 2020 2020 6d61 736b 206f            mask o
+0000b670: 7665 7220 6120 6c6f 6e67 2077 696e 646f  ver a long windo
+0000b680: 772e 2054 6865 2072 6573 756c 7469 6e67  w. The resulting
+0000b690: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
 0000b6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b6c0: 7468 6520 6e75 6d62 6572 206f 6620 706f  the number of po
-0000b6d0: 696e 7473 2070 6963 6b65 6420 6173 2073  ints picked as s
-0000b6e0: 7572 6661 6365 2e20 466f 720a 2020 2020  urface. For.    
+0000b6b0: 2020 2020 2020 2068 6173 2076 616c 7565         has value
+0000b6c0: 7320 6265 7477 6565 6e20 3020 616e 6420  s between 0 and 
+0000b6d0: 312e 2050 6f69 6e74 7320 7769 7468 2076  1. Points with v
+0000b6e0: 616c 7565 730a 2020 2020 2020 2020 2020  alues.          
 0000b6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b700: 2020 2020 2020 2020 2020 2020 2073 6d61               sma
-0000b710: 6c6c 206d 6170 732c 2068 6967 6865 7220  ll maps, higher 
-0000b720: 7661 6c75 6573 2028 6567 3a20 3130 2573  values (eg: 10%s
-0000b730: 6967 6d61 290a 2020 2020 2020 2020 2020  igma).          
+0000b700: 2020 2020 2020 206c 6573 7320 7468 616e         less than
+0000b710: 2030 2e33 2069 7320 7573 6564 2074 6f20   0.3 is used to 
+0000b720: 7265 7072 6573 656e 7420 7375 7266 6163  represent surfac
+0000b730: 652e 0a20 2020 2020 2020 2020 2020 2020  e..             
 0000b740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b750: 2020 2020 2020 2063 616e 2062 6520 7573         can be us
-0000b760: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000b770: 2020 2020 2020 2020 2020 2020 3329 204d              3) M
-0000b780: 6561 6e3a 2061 206d 6561 6e20 6669 6c74  ean: a mean filt
-0000b790: 6572 2069 7320 6170 706c 6965 6420 6f6e  er is applied on
-0000b7a0: 2074 6865 2062 696e 6172 7920 636f 6e74   the binary cont
-0000b7b0: 6f75 720a 2020 2020 2020 2020 2020 2020  our.            
-0000b7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b7d0: 2020 2020 206d 6173 6b20 6f76 6572 2061       mask over a
-0000b7e0: 206c 6f6e 6720 7769 6e64 6f77 2e20 5468   long window. Th
-0000b7f0: 6520 7265 7375 6c74 696e 6720 6d61 736b  e resulting mask
-0000b800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b820: 2020 6861 7320 7661 6c75 6573 2062 6574    has values bet
-0000b830: 7765 656e 2030 2061 6e64 2031 2e20 506f  ween 0 and 1. Po
-0000b840: 696e 7473 2077 6974 6820 7661 6c75 6573  ints with values
-0000b850: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b750: 2020 2020 4173 2074 6865 2061 7665 7261      As the avera
+0000b760: 6765 2069 7320 6361 6c63 756c 6174 6564  ge is calculated
+0000b770: 206f 6e20 6120 6c6f 6e67 2077 696e 646f   on a long windo
+0000b780: 772c 0a20 2020 2020 2020 2020 2020 2020  w,.             
+0000b790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7a0: 2020 2020 6869 6768 6c79 2065 7870 6f73      highly expos
+0000b7b0: 6564 2073 7572 6661 6365 2070 6f69 6e74  ed surface point
+0000b7c0: 7320 6861 7665 2076 6572 7920 6c6f 770a  s have very low.
+0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7f0: 2076 616c 7565 7320 616e 6420 7061 7274   values and part
+0000b800: 6961 6c6c 7920 6578 706f 7365 6420 7375  ially exposed su
+0000b810: 7266 6163 6573 2f67 726f 6f76 6573 0a20  rfaces/grooves. 
+0000b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b840: 6861 7665 2072 656c 6174 6976 656c 7920  have relatively 
+0000b850: 6869 6768 6572 2076 616c 7565 732e 0a20  higher values.. 
 0000b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b870: 2020 6c65 7373 2074 6861 6e20 302e 3320    less than 0.3 
-0000b880: 6973 2075 7365 6420 746f 2072 6570 7265  is used to repre
-0000b890: 7365 6e74 2073 7572 6661 6365 2e0a 2020  sent surface..  
-0000b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2041                 A
-0000b8c0: 7320 7468 6520 6176 6572 6167 6520 6973  s the average is
-0000b8d0: 2063 616c 6375 6c61 7465 6420 6f6e 2061   calculated on a
-0000b8e0: 206c 6f6e 6720 7769 6e64 6f77 2c0a 2020   long window,.  
-0000b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b900: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-0000b910: 6967 686c 7920 6578 706f 7365 6420 7375  ighly exposed su
-0000b920: 7266 6163 6520 706f 696e 7473 2068 6176  rface points hav
-0000b930: 6520 7665 7279 206c 6f77 0a20 2020 2020  e very low.     
-0000b940: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b950: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
-0000b960: 6573 2061 6e64 2070 6172 7469 616c 6c79  es and partially
-0000b970: 2065 7870 6f73 6564 2073 7572 6661 6365   exposed surface
-0000b980: 732f 6772 6f6f 7665 730a 2020 2020 2020  s/grooves.      
-0000b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9a0: 2020 2020 2020 2020 2020 2068 6176 6520             have 
-0000b9b0: 7265 6c61 7469 7665 6c79 2068 6967 6865  relatively highe
-0000b9c0: 7220 7661 6c75 6573 2e0a 2020 2020 2020  r values..      
-0000b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b9e0: 2020 2020 2020 2020 2020 2054 6869 7320             This 
-0000b9f0: 6465 6669 6e69 7469 6f6e 2069 7320 7573  definition is us
-0000ba00: 6566 756c 2065 7370 6563 6961 6c6c 7920  eful especially 
-0000ba10: 7768 656e 2074 6865 0a20 2020 2020 2020  when the.       
-0000ba20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ba30: 2020 2020 2020 2020 2020 6d61 7020 7375            map su
-0000ba40: 7266 6163 6520 6861 7320 6d61 6e79 2066  rface has many f
-0000ba50: 6561 7475 7265 732f 7072 6f6a 6563 7469  eatures/projecti
-0000ba60: 6f6e 732e 0a20 2020 2020 2020 2020 2020  ons..           
-0000ba70: 2020 2020 2020 2020 2020 2020 2034 2920               4) 
-0000ba80: 4d69 6e69 6d75 6d3a 2061 206d 696e 696d  Minimum: a minim
-0000ba90: 756d 2066 696c 7465 7220 6973 2061 7070  um filter is app
-0000baa0: 6c69 6564 206f 6e20 6120 6269 6e61 7279  lied on a binary
-0000bab0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000bac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bad0: 2020 2020 2063 6f6e 746f 7572 206d 6173       contour mas
-0000bae0: 6b20 746f 206c 6f63 6174 6520 7375 7266  k to locate surf
-0000baf0: 6163 6520 706f 696e 7473 2e0a 2020 2020  ace points..    
-0000bb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb20: 566f 7865 6c73 2073 7572 726f 756e 6465  Voxels surrounde
-0000bb30: 6420 6279 2070 6f69 6e74 7320 6f75 7473  d by points outs
-0000bb40: 6964 6520 7468 650a 2020 2020 2020 2020  ide the.        
-0000bb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bb60: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-0000bb70: 6f75 7220 287a 6572 6f65 7329 2061 7265  our (zeroes) are
-0000bb80: 2064 6574 6563 7465 6420 6173 2073 7572   detected as sur
-0000bb90: 6661 6365 2e0a 2020 2020 2020 2020 2020  face..          
-0000bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bbb0: 2020 2020 2020 2020 2020 566f 7865 6c73            Voxels
-0000bbc0: 2073 7572 726f 756e 6465 6420 6279 2070   surrounded by p
-0000bbd0: 6f69 6e74 7320 6f75 7473 6964 6520 7468  oints outside th
-0000bbe0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000bbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc00: 2020 2020 2020 636f 6e74 6f75 7220 287a        contour (z
-0000bc10: 6572 6f65 7329 2061 7265 2064 6574 6563  eroes) are detec
-0000bc20: 7465 6420 6173 2073 7572 6661 6365 2e0a  ted as surface..
-0000bc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc40: 2020 2020 2020 2020 3529 2053 6f62 656c          5) Sobel
-0000bc50: 3a20 736f 6265 6c20 6669 6c74 6572 2069  : sobel filter i
-0000bc60: 7320 6170 706c 6965 6420 6f6e 2074 6865  s applied on the
-0000bc70: 206d 6170 2074 6f20 6465 7465 6374 0a20   map to detect. 
-0000bc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bca0: 2068 6967 6820 6465 6e73 6974 7920 6772   high density gr
-0000bcb0: 6164 6965 6e74 732e 2042 6566 6f72 6520  adients. Before 
-0000bcc0: 6170 706c 7969 6e67 2074 6865 0a20 2020  applying the.   
-0000bcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bce0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000bcf0: 6f62 656c 2066 696c 7465 722c 2069 7420  obel filter, it 
-0000bd00: 6973 2069 6d70 6f72 7461 6e74 2074 6f20  is important to 
-0000bd10: 7265 6475 6365 2074 6865 0a20 2020 2020  reduce the.     
-0000bd20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd30: 2020 2020 2020 2020 2020 2020 206e 6f69               noi
-0000bd40: 7365 2064 656e 7369 7479 2061 6e64 206c  se density and l
-0000bd50: 6172 6765 2076 6172 6961 7469 6f6e 730a  arge variations.
-0000bd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000bd80: 2020 2867 7261 6469 656e 7473 2920 696e    (gradients) in
-0000bd90: 2074 6865 206e 6f69 7365 2072 6567 696f   the noise regio
-0000bda0: 6e2e 0a20 2020 2020 2020 2020 2020 202a  n..            *
-0000bdb0: 7765 6967 6874 2a0a 2020 2020 2020 2020  weight*.        
-0000bdc0: 2020 2020 2020 2020 4966 2073 6574 2074          If set t
-0000bdd0: 7275 652c 2074 6865 2064 6973 7461 6e63  rue, the distanc
-0000bde0: 6573 2062 6574 7765 656e 2074 6865 2073  es between the s
-0000bdf0: 7572 6661 6365 2070 6f69 6e74 7320 6973  urface points is
-0000be00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000be10: 206e 6f72 6d61 6c69 7a65 6420 696e 2061   normalized in a
-0000be20: 2077 6179 2073 696d 696c 6172 2074 6f20   way similar to 
-0000be30: 4744 5420 285a 656d 6c61 2032 3030 3729  GDT (Zemla 2007)
-0000be40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000be50: 2063 616c 6375 6c61 7469 6f6e 2066 6f72   calculation for
-0000be60: 2061 746f 6d69 6320 636f 2d6f 7264 696e   atomic co-ordin
-0000be70: 6174 6520 616c 6967 6e6d 656e 7473 2e0a  ate alignments..
-0000be80: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000be90: 2020 2020 2320 6368 6563 6b20 6966 2062      # check if b
-0000bea0: 6f74 6820 6d61 7073 2061 7265 206f 6e20  oth maps are on 
-0000beb0: 7468 6520 7361 6d65 2067 7269 640a 2020  the same grid.  
-0000bec0: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
-0000bed0: 662e 6d61 7043 6f6d 7061 7269 736f 6e28  f.mapComparison(
-0000bee0: 6d61 705f 7461 7267 6574 2c20 6d61 705f  map_target, map_
-0000bef0: 7072 6f62 6529 3a0a 2020 2020 2020 2020  probe):.        
-0000bf00: 2020 2020 7072 696e 7428 2740 4040 204d      print('@@@ M
-0000bf10: 6170 7320 636f 756c 6420 6e6f 7420 6265  aps could not be
-0000bf20: 206d 6174 6368 6564 2729 0a20 2020 2020   matched').     
-0000bf30: 2020 2020 2020 2072 6574 7572 6e20 2d39         return -9
-0000bf40: 3939 2e0a 2020 2020 2020 2020 2320 6966  99..        # if
-0000bf50: 2074 6865 2062 6f75 6e64 6172 6965 7320   the boundaries 
-0000bf60: 6172 6520 6b6e 6f77 6e2c 2063 616c 6375  are known, calcu
-0000bf70: 6c61 7465 2074 6865 206b 6474 7265 650a  late the kdtree.
-0000bf80: 2020 2020 2020 2020 6966 2046 696c 7465          if Filte
-0000bf90: 7220 6973 204e 6f6e 653a 0a20 2020 2020  r is None:.     
-0000bfa0: 2020 2020 2020 206b 6474 7265 6520 3d20         kdtree = 
-0000bfb0: 6d61 705f 7461 7267 6574 2e6d 616b 654b  map_target.makeK
-0000bfc0: 4454 7265 6528 0a20 2020 2020 2020 2020  DTree(.         
-0000bfd0: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-0000bfe0: 745f 7468 7265 7368 6f6c 6431 2c0a 2020  t_threshold1,.  
-0000bff0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-0000c000: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
-0000c010: 6c64 320a 2020 2020 2020 2020 2020 2020  ld2.            
-0000c020: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
-0000c030: 6f62 655f 706f 696e 7473 203d 206d 6170  obe_points = map
-0000c040: 5f70 726f 6265 2e67 6574 5f70 6f73 280a  _probe.get_pos(.
-0000c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c060: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
-0000c070: 686f 6c64 312c 0a20 2020 2020 2020 2020  hold1,.         
-0000c080: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-0000c090: 745f 7468 7265 7368 6f6c 6432 0a20 2020  t_threshold2.   
-0000c0a0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000c0b0: 2020 2065 6c69 6620 4669 6c74 6572 203d     elif Filter =
-0000c0c0: 3d20 2753 7464 273a 0a20 2020 2020 2020  = 'Std':.       
-0000c0d0: 2020 2020 2074 6172 6765 745f 706f 696e       target_poin
-0000c0e0: 7473 203d 206e 702e 6172 6777 6865 7265  ts = np.argwhere
-0000c0f0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0000c100: 2020 286d 6170 5f74 6172 6765 742e 6675    (map_target.fu
-0000c110: 6c6c 4d61 7020 3e20 280a 2020 2020 2020  llMap > (.      
-0000c120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c130: 2020 666c 6f61 7428 6d61 705f 7461 7267    float(map_targ
-0000c140: 6574 5f74 6872 6573 686f 6c64 3129 2d28  et_threshold1)-(
-0000c150: 6d61 705f 7461 7267 6574 2e73 7464 2829  map_target.std()
-0000c160: 2a30 2e31 3029 290a 2020 2020 2020 2020  *0.10)).        
-0000c170: 2020 2020 2020 2020 2029 2026 0a20 2020           ) &.   
-0000c180: 2020 2020 2020 2020 2020 2020 2028 6d61               (ma
-0000c190: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
-0000c1a0: 203c 2028 0a20 2020 2020 2020 2020 2020   < (.           
-0000c1b0: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
-0000c1c0: 6174 286d 6170 5f74 6172 6765 745f 7468  at(map_target_th
-0000c1d0: 7265 7368 6f6c 6431 292b 286d 6170 5f74  reshold1)+(map_t
-0000c1e0: 6172 6765 742e 7374 6428 292a 302e 3130  arget.std()*0.10
-0000c1f0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-0000c200: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000c210: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0000c220: 7072 6f62 655f 706f 696e 7473 203d 206e  probe_points = n
-0000c230: 702e 6172 6777 6865 7265 280a 2020 2020  p.argwhere(.    
-0000c240: 2020 2020 2020 2020 2020 2020 286d 6170              (map
-0000c250: 5f70 726f 6265 2e66 756c 6c4d 6170 203e  _probe.fullMap >
-0000c260: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
-0000c270: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-0000c280: 286d 6170 5f70 726f 6265 5f74 6872 6573  (map_probe_thres
-0000c290: 686f 6c64 292d 286d 6170 5f70 726f 6265  hold)-(map_probe
-0000c2a0: 2e73 7464 2829 2a30 2e31 3029 290a 2020  .std()*0.10)).  
-0000c2b0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0000c2c0: 2026 0a20 2020 2020 2020 2020 2020 2020   &.             
-0000c2d0: 2020 2028 6d61 705f 7072 6f62 652e 6675     (map_probe.fu
-0000c2e0: 6c6c 4d61 7020 3c20 280a 2020 2020 2020  llMap < (.      
-0000c2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c300: 2020 666c 6f61 7428 6d61 705f 7072 6f62    float(map_prob
-0000c310: 655f 7468 7265 7368 6f6c 6429 2b28 6d61  e_threshold)+(ma
-0000c320: 705f 7072 6f62 652e 7374 6428 292a 302e  p_probe.std()*0.
-0000c330: 3130 2929 0a20 2020 2020 2020 2020 2020  10)).           
-0000c340: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000c350: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000c360: 2020 6966 206c 656e 2874 6172 6765 745f    if len(target_
-0000c370: 706f 696e 7473 2920 3c20 6c65 6e28 7072  points) < len(pr
-0000c380: 6f62 655f 706f 696e 7473 293a 0a20 2020  obe_points):.   
-0000c390: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000c3a0: 6265 5f70 6f69 6e74 7331 203d 206e 702e  be_points1 = np.
-0000c3b0: 636f 7079 2874 6172 6765 745f 706f 696e  copy(target_poin
-0000c3c0: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0000c3d0: 2020 2020 7461 7267 6574 5f70 6f69 6e74      target_point
-0000c3e0: 7320 3d20 6e70 2e63 6f70 7928 7072 6f62  s = np.copy(prob
-0000c3f0: 655f 706f 696e 7473 290a 2020 2020 2020  e_points).      
-0000c400: 2020 2020 2020 2020 2020 7072 6f62 655f            probe_
-0000c410: 706f 696e 7473 203d 206e 702e 636f 7079  points = np.copy
-0000c420: 2870 726f 6265 5f70 6f69 6e74 7331 290a  (probe_points1).
-0000c430: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000c440: 656e 2874 6172 6765 745f 706f 696e 7473  en(target_points
-0000c450: 2920 3d3d 2030 206f 7220 6c65 6e28 7072  ) == 0 or len(pr
-0000c460: 6f62 655f 706f 696e 7473 2920 3d3d 2030  obe_points) == 0
-0000c470: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000c480: 2020 7072 696e 7428 2753 7572 6661 6365    print('Surface
-0000c490: 2064 6574 6563 7469 6f6e 2066 6169 6c65   detection faile
-0000c4a0: 6420 2853 7464 2066 696c 7465 7229 2c20  d (Std filter), 
-0000c4b0: 6578 6974 696e 672e 2e27 290a 2020 2020  exiting..').    
-0000c4c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000c4d0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0000c4e0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000c4f0: 2020 2020 2020 2020 2066 726f 6d20 7363           from sc
-0000c500: 6970 792e 7370 6174 6961 6c20 696d 706f  ipy.spatial impo
-0000c510: 7274 2063 4b44 5472 6565 0a20 2020 2020  rt cKDTree.     
-0000c520: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000c530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c540: 2020 2020 6b64 7472 6565 203d 2063 4b44      kdtree = cKD
-0000c550: 5472 6565 2874 6172 6765 745f 706f 696e  Tree(target_poin
-0000c560: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0000c570: 2020 2020 6578 6365 7074 2052 756e 7469      except Runti
-0000c580: 6d65 4572 726f 723a 0a20 2020 2020 2020  meError:.       
-0000c590: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000c5a0: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000c5b0: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
-0000c5c0: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
-0000c5d0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-0000c5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000c5f0: 2020 6b64 7472 6565 203d 204b 4454 7265    kdtree = KDTre
-0000c600: 6528 7461 7267 6574 5f70 6f69 6e74 7329  e(target_points)
-0000c610: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c620: 2065 7863 6570 7420 5275 6e74 696d 6545   except RuntimeE
-0000c630: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
-0000c640: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000c650: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
-0000c660: 6966 2046 696c 7465 7220 3d3d 2027 4d65  if Filter == 'Me
-0000c670: 616e 273a 0a20 2020 2020 2020 2020 2020  an':.           
-0000c680: 206d 6170 315f 6669 6c74 6572 203d 206d   map1_filter = m
-0000c690: 6170 5f74 6172 6765 742e 5f73 7572 6661  ap_target._surfa
-0000c6a0: 6365 5f66 6561 7475 7265 7328 0a20 2020  ce_features(.   
-0000c6b0: 2020 2020 2020 2020 2020 2020 2066 6c6f               flo
-0000c6c0: 6174 286d 6170 5f74 6172 6765 745f 7468  at(map_target_th
-0000c6d0: 7265 7368 6f6c 6431 290a 2020 2020 2020  reshold1).      
-0000c6e0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000c6f0: 2020 2020 6d61 7032 5f66 696c 7465 7220      map2_filter 
-0000c700: 3d20 6d61 705f 7072 6f62 652e 5f73 7572  = map_probe._sur
-0000c710: 6661 6365 5f66 6561 7475 7265 7328 0a20  face_features(. 
-0000c720: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000c730: 6c6f 6174 286d 6170 5f70 726f 6265 5f74  loat(map_probe_t
-0000c740: 6872 6573 686f 6c64 290a 2020 2020 2020  hreshold).      
-0000c750: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000c760: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0000c770: 2020 2020 6465 6669 6e65 2073 7572 6661      define surfa
-0000c780: 6365 2062 6173 6564 206f 6e20 7468 6520  ce based on the 
-0000c790: 6669 6c74 6572 6564 206d 6173 6b20 7661  filtered mask va
-0000c7a0: 6c75 6573 2e0a 2020 2020 2020 2020 2020  lues..          
-0000c7b0: 2020 706f 696e 7473 2077 6974 6820 7661    points with va
-0000c7c0: 6c75 6573 206c 6573 7320 7468 616e 2030  lues less than 0
-0000c7d0: 2e33 2061 7265 2075 7375 616c 6c79 2070  .3 are usually p
-0000c7e0: 7265 6665 7272 6564 2e20 4275 7420 696e  referred. But in
-0000c7f0: 0a20 2020 2020 2020 2020 2020 2073 6f6d  .            som
-0000c800: 6520 6361 7365 7320 6c69 6b65 2076 6972  e cases like vir
-0000c810: 7573 6573 2c20 6d6f 7374 2073 7572 6661  uses, most surfa
-0000c820: 6365 2070 6f69 6e74 7320 6172 6520 6869  ce points are hi
-0000c830: 6768 6c79 2065 7870 6f73 6564 0a20 2020  ghly exposed.   
-0000c840: 2020 2020 2020 2020 2061 6e64 2061 206c           and a l
-0000c850: 6172 6765 206e 756d 6265 7220 6f66 2070  arge number of p
-0000c860: 6f69 6e74 7320 6172 6520 7265 7475 726e  oints are return
-0000c870: 6564 2061 6e64 2074 6865 2063 616c 6375  ed and the calcu
-0000c880: 6c61 7469 6f6e 0a20 2020 2020 2020 2020  lation.         
-0000c890: 2020 2062 6563 6f6d 6573 2073 6c6f 772e     becomes slow.
-0000c8a0: 0a20 2020 2020 2020 2020 2020 2048 656e  .            Hen
-0000c8b0: 6365 2061 6e20 6164 6469 7469 6f6e 616c  ce an additional
-0000c8c0: 2066 696c 7465 7220 6973 2061 6464 6564   filter is added
-0000c8d0: 3a20 7468 6520 6d61 7869 6d75 6d20 616c  : the maximum al
-0000c8e0: 6c6f 7765 6420 706f 696e 7473 0a20 2020  lowed points.   
-0000c8f0: 2020 2020 2020 2020 2069 7320 3130 2520           is 10% 
-0000c900: 6f66 2062 6f78 2073 697a 652e 0a20 2020  of box size..   
-0000c910: 2020 2020 2020 2020 2054 6865 206d 696e           The min
-0000c920: 696d 756d 206e 756d 6265 7220 6f66 2070  imum number of p
-0000c930: 6f69 6e74 7320 6973 206b 6570 7420 6173  oints is kept as
-0000c940: 2037 252e 2054 6869 7320 6d6f 6465 2069   7%. This mode i
-0000c950: 7320 6c65 7373 0a20 2020 2020 2020 2020  s less.         
-0000c960: 2020 2073 656e 7369 7469 7665 2074 6f20     sensitive to 
-0000c970: 7468 6520 6e75 6d62 6572 206f 6620 7375  the number of su
-0000c980: 7266 6163 6520 706f 696e 7473 2063 686f  rface points cho
-0000c990: 7365 6e0a 2020 2020 2020 2020 2020 2020  sen.            
-0000c9a0: 6173 2074 6865 2065 7874 656e 7420 6f66  as the extent of
-0000c9b0: 2065 7870 6f73 7572 6520 6973 2075 7365   exposure is use
-0000c9c0: 6420 666f 7220 6465 6669 6e69 6e67 2073  d for defining s
-0000c9d0: 7572 6661 6365 2e20 4865 6e63 650a 2020  urface. Hence.  
-0000c9e0: 2020 2020 2020 2020 2020 7468 6963 6b20            thick 
-0000c9f0: 7375 7266 6163 6520 6973 206e 6f74 2075  surface is not u
-0000ca00: 7375 616c 6c79 2072 6571 7569 7265 642e  sually required.
-0000ca10: 0a20 2020 2020 2020 2020 2020 2063 616c  .            cal
-0000ca20: 6375 6c61 7465 2066 7265 7175 656e 6369  culate frequenci
-0000ca30: 6573 2069 6e20 6269 6e73 2066 6f72 2066  es in bins for f
-0000ca40: 696c 7465 7265 6420 6d61 736b 2e0a 2020  iltered mask..  
-0000ca50: 2020 2020 2020 2020 2020 5468 6520 736d            The sm
-0000ca60: 616c 6c65 7220 7468 6520 6269 6e73 2c20  aller the bins, 
-0000ca70: 6d6f 7265 2070 7265 6369 7365 2077 696c  more precise wil
-0000ca80: 6c20 6265 2074 6865 2063 616c 6375 6c61  l be the calcula
-0000ca90: 7469 6f6e 206f 660a 2020 2020 2020 2020  tion of.        
-0000caa0: 2020 2020 706f 696e 7473 2061 6c6c 6f77      points allow
-0000cab0: 6564 2062 6173 6564 206f 6e20 7065 7263  ed based on perc
-0000cac0: 656e 7420 6f66 2070 6f69 6e74 7320 6368  ent of points ch
-0000cad0: 6f73 656e 2e0a 2020 2020 2020 2020 2020  osen..          
-0000cae0: 2020 4173 2074 6869 7320 6973 206a 7573    As this is jus
-0000caf0: 7420 616e 2061 6464 6974 696f 6e61 6c20  t an additional 
-0000cb00: 6669 6c74 6572 2061 6e64 2064 6f65 736e  filter and doesn
-0000cb10: 2774 2061 6666 6563 7420 7468 650a 2020  't affect the.  
-0000cb20: 2020 2020 2020 2020 2020 6361 6c63 756c            calcul
-0000cb30: 6174 696f 6e73 2064 7261 7374 6963 616c  ations drastical
-0000cb40: 6c79 2c20 3430 2062 696e 7320 6172 6520  ly, 40 bins are 
-0000cb50: 7573 6564 2074 6f20 6361 6c63 756c 6174  used to calculat
-0000cb60: 650a 2020 2020 2020 2020 2020 2020 6672  e.            fr
-0000cb70: 6571 7565 6e63 6965 732e 0a20 2020 2020  equencies..     
-0000cb80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-0000cb90: 2020 2020 2020 2062 696e 5f74 6573 7420         bin_test 
-0000cba0: 3d20 5b30 2e30 3030 315d 0a20 2020 2020  = [0.0001].     
-0000cbb0: 2020 2020 2020 2066 6f72 2069 6920 696e         for ii in
-0000cbc0: 2072 616e 6765 2831 2c20 3431 293a 0a20   range(1, 41):. 
-0000cbd0: 2020 2020 2020 2020 2020 2020 2020 2062                 b
-0000cbe0: 696e 5f74 6573 742e 6170 7065 6e64 2830  in_test.append(0
-0000cbf0: 2e30 3235 202a 2069 6929 0a20 2020 2020  .025 * ii).     
-0000cc00: 2020 2020 2020 2066 7265 715f 7465 7374         freq_test
-0000cc10: 203d 206e 702e 6869 7374 6f67 7261 6d28   = np.histogram(
-0000cc20: 6d61 7031 5f66 696c 7465 722e 6675 6c6c  map1_filter.full
-0000cc30: 4d61 702c 2062 696e 5f74 6573 7429 5b30  Map, bin_test)[0
-0000cc40: 5d0a 2020 2020 2020 2020 2020 2020 6d61  ].            ma
-0000cc50: 7031 5f66 696c 6c65 6420 3d20 6e70 2e73  p1_filled = np.s
-0000cc60: 756d 286d 6170 315f 6669 6c74 6572 2e66  um(map1_filter.f
-0000cc70: 756c 6c4d 6170 203e 2030 290a 0a20 2020  ullMap > 0)..   
-0000cc80: 2020 2020 2020 2020 2073 756d 5f66 7265           sum_fre
-0000cc90: 7120 3d20 302e 300a 2020 2020 2020 2020  q = 0.0.        
-0000cca0: 2020 2020 666f 7220 6672 2069 6e20 7261      for fr in ra
-0000ccb0: 6e67 6528 6c65 6e28 6672 6571 5f74 6573  nge(len(freq_tes
-0000ccc0: 7429 293a 0a20 2020 2020 2020 2020 2020  t)):.           
-0000ccd0: 2020 2020 2073 756d 5f66 7265 7120 2b3d       sum_freq +=
-0000cce0: 2066 6c6f 6174 2866 7265 715f 7465 7374   float(freq_test
-0000ccf0: 5b66 725d 290a 2020 2020 2020 2020 2020  [fr]).          
-0000cd00: 2020 2020 2020 6966 2073 756d 5f66 7265        if sum_fre
-0000cd10: 7120 2f20 6d61 7031 5f66 696c 6c65 6420  q / map1_filled 
-0000cd20: 3e20 302e 3035 2061 6e64 2062 696e 5f74  > 0.05 and bin_t
-0000cd30: 6573 745b 6672 2b31 5d20 3e3d 2030 2e33  est[fr+1] >= 0.3
-0000cd40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000cd50: 2020 2020 2020 7431 203d 2062 696e 5f74        t1 = bin_t
-0000cd60: 6573 745b 6672 2b31 5d0a 2020 2020 2020  est[fr+1].      
-0000cd70: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0000cd80: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0000cd90: 2020 2020 6966 2073 756d 5f66 7265 7120      if sum_freq 
-0000cda0: 2f20 6d61 7031 5f66 696c 6c65 6420 3e20  / map1_filled > 
-0000cdb0: 302e 3130 206f 7220 7375 6d5f 6672 6571  0.10 or sum_freq
-0000cdc0: 203e 2032 3030 3030 303a 0a20 2020 2020   > 200000:.     
-0000cdd0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000cde0: 3120 3d20 6269 6e5f 7465 7374 5b66 722b  1 = bin_test[fr+
-0000cdf0: 315d 0a20 2020 2020 2020 2020 2020 2020  1].             
-0000ce00: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
-0000ce10: 2020 2020 2020 2020 2073 756d 5f66 7265           sum_fre
-0000ce20: 7120 3d20 302e 300a 2020 2020 2020 2020  q = 0.0.        
-0000ce30: 2020 2020 6672 6571 5f74 6573 7420 3d20      freq_test = 
-0000ce40: 6e70 2e68 6973 746f 6772 616d 286d 6170  np.histogram(map
-0000ce50: 325f 6669 6c74 6572 2e66 756c 6c4d 6170  2_filter.fullMap
-0000ce60: 2c20 6269 6e5f 7465 7374 295b 305d 0a20  , bin_test)[0]. 
-0000ce70: 2020 2020 2020 2020 2020 206d 6170 325f             map2_
-0000ce80: 6669 6c6c 6564 203d 206e 702e 7375 6d28  filled = np.sum(
-0000ce90: 6d61 7032 5f66 696c 7465 722e 6675 6c6c  map2_filter.full
-0000cea0: 4d61 7020 3e20 3029 0a20 2020 2020 2020  Map > 0).       
-0000ceb0: 2020 2020 2066 6f72 2066 7220 696e 2072       for fr in r
-0000cec0: 616e 6765 286c 656e 2866 7265 715f 7465  ange(len(freq_te
-0000ced0: 7374 2929 3a0a 2020 2020 2020 2020 2020  st)):.          
-0000cee0: 2020 2020 2020 7375 6d5f 6672 6571 202b        sum_freq +
-0000cef0: 3d20 666c 6f61 7428 6672 6571 5f74 6573  = float(freq_tes
-0000cf00: 745b 6672 5d29 0a20 2020 2020 2020 2020  t[fr]).         
-0000cf10: 2020 2020 2020 2069 6620 7375 6d5f 6672         if sum_fr
-0000cf20: 6571 2f6d 6170 325f 6669 6c6c 6564 203e  eq/map2_filled >
-0000cf30: 2030 2e30 3520 616e 6420 6269 6e5f 7465   0.05 and bin_te
-0000cf40: 7374 5b66 722b 315d 203e 3d20 302e 333a  st[fr+1] >= 0.3:
-0000cf50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cf60: 2020 2020 2074 3220 3d20 6269 6e5f 7465       t2 = bin_te
-0000cf70: 7374 5b66 722b 315d 0a20 2020 2020 2020  st[fr+1].       
-0000cf80: 2020 2020 2020 2020 2020 2020 2062 7265               bre
-0000cf90: 616b 0a20 2020 2020 2020 2020 2020 2020  ak.             
-0000cfa0: 2020 2069 6620 7375 6d5f 6672 6571 2f6d     if sum_freq/m
-0000cfb0: 6170 325f 6669 6c6c 6564 203e 2030 2e31  ap2_filled > 0.1
-0000cfc0: 3020 6f72 2073 756d 5f66 7265 7120 3e20  0 or sum_freq > 
-0000cfd0: 3230 3030 3030 3a0a 2020 2020 2020 2020  200000:.        
-0000cfe0: 2020 2020 2020 2020 2020 2020 7432 203d              t2 =
-0000cff0: 2062 696e 5f74 6573 745b 6672 2b31 5d0a   bin_test[fr+1].
-0000d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d010: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0000d020: 2020 2020 2020 2320 7431 2061 6e64 2074        # t1 and t
-0000d030: 3220 6172 6520 7468 6520 7365 6c65 6374  2 are the select
-0000d040: 6564 206c 6576 656c 7320 6261 7365 6420  ed levels based 
-0000d050: 6f6e 2066 696c 7465 7265 6420 7661 6c75  on filtered valu
-0000d060: 6573 2061 6e64 0a20 2020 2020 2020 2020  es and.         
-0000d070: 2020 2023 2070 6572 6365 6e74 206f 6620     # percent of 
-0000d080: 706f 696e 7473 0a20 2020 2020 2020 2020  points.         
-0000d090: 2020 2074 6172 6765 745f 706f 696e 7473     target_points
-0000d0a0: 203d 206e 702e 6172 6777 6865 7265 280a   = np.argwhere(.
-0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0c0: 286d 6170 315f 6669 6c74 6572 2e66 756c  (map1_filter.ful
-0000d0d0: 6c4d 6170 203e 2030 2e30 2920 2620 286d  lMap > 0.0) & (m
-0000d0e0: 6170 315f 6669 6c74 6572 2e66 756c 6c4d  ap1_filter.fullM
-0000d0f0: 6170 203c 3d20 7431 290a 2020 2020 2020  ap <= t1).      
-0000d100: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d110: 2020 2020 7072 6f62 655f 706f 696e 7473      probe_points
-0000d120: 203d 206e 702e 6172 6777 6865 7265 280a   = np.argwhere(.
-0000d130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d140: 286d 6170 325f 6669 6c74 6572 2e66 756c  (map2_filter.ful
-0000d150: 6c4d 6170 203e 2030 2e30 2920 2620 286d  lMap > 0.0) & (m
-0000d160: 6170 325f 6669 6c74 6572 2e66 756c 6c4d  ap2_filter.fullM
-0000d170: 6170 203c 3d20 7432 290a 2020 2020 2020  ap <= t2).      
-0000d180: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000d190: 2020 2020 6966 206c 656e 2874 6172 6765      if len(targe
-0000d1a0: 745f 706f 696e 7473 2920 3d3d 2030 206f  t_points) == 0 o
-0000d1b0: 7220 6c65 6e28 7072 6f62 655f 706f 696e  r len(probe_poin
-0000d1c0: 7473 2920 3d3d 2030 3a0a 2020 2020 2020  ts) == 0:.      
-0000d1d0: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000d1e0: 2753 7572 6661 6365 2064 6574 6563 7469  'Surface detecti
-0000d1f0: 6f6e 2066 6169 6c65 6420 284d 6561 6e20  on failed (Mean 
-0000d200: 6669 6c74 6572 292c 2065 7869 7469 6e67  filter), exiting
-0000d210: 2e2e 2729 0a20 2020 2020 2020 2020 2020  ..').           
-0000d220: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000d230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d240: 6c65 6e28 7461 7267 6574 5f70 6f69 6e74  len(target_point
-0000d250: 7329 203c 206c 656e 2870 726f 6265 5f70  s) < len(probe_p
-0000d260: 6f69 6e74 7329 3a0a 2020 2020 2020 2020  oints):.        
-0000d270: 2020 2020 2020 2020 7072 6f62 655f 706f          probe_po
-0000d280: 696e 7473 3120 3d20 6e70 2e63 6f70 7928  ints1 = np.copy(
-0000d290: 7461 7267 6574 5f70 6f69 6e74 7329 0a20  target_points). 
-0000d2a0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0000d2b0: 6172 6765 745f 706f 696e 7473 203d 206e  arget_points = n
-0000d2c0: 702e 636f 7079 2870 726f 6265 5f70 6f69  p.copy(probe_poi
-0000d2d0: 6e74 7329 0a20 2020 2020 2020 2020 2020  nts).           
-0000d2e0: 2020 2020 2070 726f 6265 5f70 6f69 6e74       probe_point
-0000d2f0: 7320 3d20 6e70 2e63 6f70 7928 7072 6f62  s = np.copy(prob
-0000d300: 655f 706f 696e 7473 3129 0a20 2020 2020  e_points1).     
-0000d310: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000d320: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0000d330: 2073 6369 7079 2e73 7061 7469 616c 2069   scipy.spatial i
-0000d340: 6d70 6f72 7420 634b 4454 7265 650a 2020  mport cKDTree.  
-0000d350: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-0000d360: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000d370: 2020 2020 2020 206b 6474 7265 6520 3d20         kdtree = 
-0000d380: 634b 4454 7265 6528 7461 7267 6574 5f70  cKDTree(target_p
-0000d390: 6f69 6e74 7329 0a20 2020 2020 2020 2020  oints).         
-0000d3a0: 2020 2020 2020 2065 7863 6570 7420 5275         except Ru
-0000d3b0: 6e74 696d 6545 7272 6f72 3a0a 2020 2020  ntimeError:.    
-0000d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d3d0: 7265 7475 726e 204e 6f6e 650a 2020 2020  return None.    
-0000d3e0: 2020 2020 2020 2020 6578 6365 7074 2049          except I
-0000d3f0: 6d70 6f72 7445 7272 6f72 3a0a 2020 2020  mportError:.    
-0000d400: 2020 2020 2020 2020 2020 2020 7472 793a              try:
-0000d410: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d420: 2020 2020 206b 6474 7265 6520 3d20 4b44       kdtree = KD
-0000d430: 5472 6565 2874 6172 6765 745f 706f 696e  Tree(target_poin
-0000d440: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0000d450: 2020 2020 6578 6365 7074 2052 756e 7469      except Runti
-0000d460: 6d65 4572 726f 723a 0a20 2020 2020 2020  meError:.       
-0000d470: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000d480: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000d490: 2065 6c69 6620 4669 6c74 6572 203d 3d20   elif Filter == 
-0000d4a0: 274d 696e 696d 756d 273a 0a20 2020 2020  'Minimum':.     
-0000d4b0: 2020 2020 2020 206d 6170 315f 7375 7266         map1_surf
-0000d4c0: 6163 6520 3d20 6d61 705f 7461 7267 6574  ace = map_target
-0000d4d0: 2e5f 7375 7266 6163 655f 6d69 6e69 6d75  ._surface_minimu
-0000d4e0: 6d5f 6669 6c74 6572 280a 2020 2020 2020  m_filter(.      
-0000d4f0: 2020 2020 2020 2020 2020 666c 6f61 7428            float(
-0000d500: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
-0000d510: 686f 6c64 3129 0a20 2020 2020 2020 2020  hold1).         
-0000d520: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d530: 206d 6170 325f 7375 7266 6163 6520 3d20   map2_surface = 
-0000d540: 6d61 705f 7072 6f62 652e 5f73 7572 6661  map_probe._surfa
-0000d550: 6365 5f6d 696e 696d 756d 5f66 696c 7465  ce_minimum_filte
-0000d560: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
-0000d570: 2020 2066 6c6f 6174 286d 6170 5f70 726f     float(map_pro
-0000d580: 6265 5f74 6872 6573 686f 6c64 290a 2020  be_threshold).  
-0000d590: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000d5a0: 2020 2020 2020 2020 2320 7365 6c65 6374          # select
-0000d5b0: 2074 6865 2073 7572 6661 6365 2070 6f69   the surface poi
-0000d5c0: 6e74 7320 7265 7072 6573 656e 7465 6420  nts represented 
-0000d5d0: 6279 2074 6865 206d 6173 6b0a 2020 2020  by the mask.    
-0000d5e0: 2020 2020 2020 2020 7461 7267 6574 5f70          target_p
-0000d5f0: 6f69 6e74 7320 3d20 6e70 2e61 7267 7768  oints = np.argwh
-0000d600: 6572 6528 6d61 7031 5f73 7572 6661 6365  ere(map1_surface
-0000d610: 203d 3d20 3129 0a20 2020 2020 2020 2020   == 1).         
-0000d620: 2020 2070 726f 6265 5f70 6f69 6e74 7320     probe_points 
-0000d630: 3d20 6e70 2e61 7267 7768 6572 6528 6d61  = np.argwhere(ma
-0000d640: 7032 5f73 7572 6661 6365 203d 3d20 3129  p2_surface == 1)
-0000d650: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000d660: 6c65 6e28 7461 7267 6574 5f70 6f69 6e74  len(target_point
-0000d670: 7329 203d 3d20 3020 6f72 206c 656e 2870  s) == 0 or len(p
-0000d680: 726f 6265 5f70 6f69 6e74 7329 203d 3d20  robe_points) == 
-0000d690: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000d6a0: 2020 2070 7269 6e74 2827 5375 7266 6163     print('Surfac
-0000d6b0: 6520 6465 7465 6374 696f 6e20 6661 696c  e detection fail
-0000d6c0: 6564 2028 4d69 6e69 6d75 6d20 6669 6c74  ed (Minimum filt
-0000d6d0: 6572 292c 2065 7869 7469 6e67 2e2e 2729  er), exiting..')
-0000d6e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d6f0: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
-0000d700: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-0000d710: 7461 7267 6574 5f70 6f69 6e74 7329 202b  target_points) +
-0000d720: 206c 656e 2870 726f 6265 5f70 6f69 6e74   len(probe_point
-0000d730: 7329 203e 2032 3530 3030 303a 0a20 2020  s) > 250000:.   
-0000d740: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000d750: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
-0000d760: 2020 2020 2069 6620 6c65 6e28 7461 7267       if len(targ
-0000d770: 6574 5f70 6f69 6e74 7329 203c 206c 656e  et_points) < len
-0000d780: 2870 726f 6265 5f70 6f69 6e74 7329 3a0a  (probe_points):.
-0000d790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d7a0: 7072 6f62 655f 706f 696e 7473 3120 3d20  probe_points1 = 
-0000d7b0: 6e70 2e63 6f70 7928 7461 7267 6574 5f70  np.copy(target_p
-0000d7c0: 6f69 6e74 7329 0a20 2020 2020 2020 2020  oints).         
-0000d7d0: 2020 2020 2020 2074 6172 6765 745f 706f         target_po
-0000d7e0: 696e 7473 203d 206e 702e 636f 7079 2870  ints = np.copy(p
-0000d7f0: 726f 6265 5f70 6f69 6e74 7329 0a20 2020  robe_points).   
-0000d800: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000d810: 6265 5f70 6f69 6e74 7320 3d20 6e70 2e63  be_points = np.c
-0000d820: 6f70 7928 7072 6f62 655f 706f 696e 7473  opy(probe_points
-0000d830: 3129 0a20 2020 2020 2020 2020 2020 2074  1).            t
-0000d840: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000d850: 2020 2020 6672 6f6d 2073 6369 7079 2e73      from scipy.s
-0000d860: 7061 7469 616c 2069 6d70 6f72 7420 634b  patial import cK
-0000d870: 4454 7265 650a 2020 2020 2020 2020 2020  DTree.          
-0000d880: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000d890: 2020 2020 2020 2020 2020 2020 2020 206b                 k
-0000d8a0: 6474 7265 6520 3d20 634b 4454 7265 6528  dtree = cKDTree(
-0000d8b0: 7461 7267 6574 5f70 6f69 6e74 7329 0a20  target_points). 
-0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000d8d0: 7863 6570 7420 5275 6e74 696d 6545 7272  xcept RuntimeErr
-0000d8e0: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-0000d8f0: 2020 2020 2020 2020 7265 7475 726e 204e          return N
-0000d900: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
-0000d910: 6578 6365 7074 2049 6d70 6f72 7445 7272  except ImportErr
-0000d920: 6f72 3a0a 2020 2020 2020 2020 2020 2020  or:.            
-0000d930: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000d940: 2020 2020 2020 2020 2020 2020 206b 6474               kdt
-0000d950: 7265 6520 3d20 4b44 5472 6565 2874 6172  ree = KDTree(tar
-0000d960: 6765 745f 706f 696e 7473 290a 2020 2020  get_points).    
-0000d970: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0000d980: 7074 2052 756e 7469 6d65 4572 726f 723a  pt RuntimeError:
-0000d990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9a0: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0000d9b0: 0a20 2020 2020 2020 2065 6c69 6620 4669  .        elif Fi
-0000d9c0: 6c74 6572 203d 3d20 2753 6f62 656c 273a  lter == 'Sobel':
-0000d9d0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-0000d9e0: 315f 7375 7266 6163 6520 3d20 6d61 705f  1_surface = map_
-0000d9f0: 7461 7267 6574 2e5f 736f 6265 6c5f 6669  target._sobel_fi
-0000da00: 6c74 6572 5f63 6f6e 746f 7572 280a 2020  lter_contour(.  
-0000da10: 2020 2020 2020 2020 2020 2020 2020 666c                fl
-0000da20: 6f61 7428 6d61 705f 7461 7267 6574 5f74  oat(map_target_t
-0000da30: 6872 6573 686f 6c64 3129 0a20 2020 2020  hreshold1).     
-0000da40: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000da50: 2020 2020 206d 6170 325f 7375 7266 6163       map2_surfac
-0000da60: 6520 3d20 6d61 705f 7072 6f62 652e 5f73  e = map_probe._s
-0000da70: 6f62 656c 5f66 696c 7465 725f 636f 6e74  obel_filter_cont
-0000da80: 6f75 7228 0a20 2020 2020 2020 2020 2020  our(.           
-0000da90: 2020 2020 2066 6c6f 6174 286d 6170 5f70       float(map_p
-0000daa0: 726f 6265 5f74 6872 6573 686f 6c64 290a  robe_threshold).
-0000dab0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0000dac0: 2020 2020 2020 2020 2020 2074 6172 6765             targe
-0000dad0: 745f 706f 696e 7473 203d 206e 702e 6172  t_points = np.ar
-0000dae0: 6777 6865 7265 280a 2020 2020 2020 2020  gwhere(.        
-0000daf0: 2020 2020 2020 2020 6d61 7031 5f73 7572          map1_sur
-0000db00: 6661 6365 2e66 756c 6c4d 6170 203e 206d  face.fullMap > m
-0000db10: 6170 315f 7375 7266 6163 652e 6d61 7828  ap1_surface.max(
-0000db20: 2920 2f20 666c 6f61 7428 3229 0a20 2020  ) / float(2).   
-0000db30: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000db40: 2020 2020 2020 2070 726f 6265 5f70 6f69         probe_poi
-0000db50: 6e74 7320 3d20 6e70 2e61 7267 7768 6572  nts = np.argwher
-0000db60: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-0000db70: 2020 206d 6170 325f 7375 7266 6163 652e     map2_surface.
-0000db80: 6675 6c6c 4d61 7020 3e20 6d61 7032 5f73  fullMap > map2_s
-0000db90: 7572 6661 6365 2e6d 6178 2829 202f 2066  urface.max() / f
-0000dba0: 6c6f 6174 2832 290a 2020 2020 2020 2020  loat(2).        
-0000dbb0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-0000dbc0: 2020 6966 206c 656e 2874 6172 6765 745f    if len(target_
-0000dbd0: 706f 696e 7473 2920 3d3d 2030 206f 7220  points) == 0 or 
-0000dbe0: 6c65 6e28 7072 6f62 655f 706f 696e 7473  len(probe_points
-0000dbf0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
-0000dc00: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
-0000dc10: 7572 6661 6365 2064 6574 6563 7469 6f6e  urface detection
-0000dc20: 2066 6169 6c65 6420 2853 6f62 656c 2066   failed (Sobel f
-0000dc30: 696c 7465 7229 2c20 6578 6974 696e 672e  ilter), exiting.
-0000dc40: 2e27 290a 2020 2020 2020 2020 2020 2020  .').            
-0000dc50: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
-0000dc60: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-0000dc70: 656e 2874 6172 6765 745f 706f 696e 7473  en(target_points
-0000dc80: 2920 3c20 6c65 6e28 7072 6f62 655f 706f  ) < len(probe_po
-0000dc90: 696e 7473 293a 0a20 2020 2020 2020 2020  ints):.         
-0000dca0: 2020 2020 2020 2070 726f 6265 5f70 6f69         probe_poi
-0000dcb0: 6e74 7331 203d 206e 702e 636f 7079 2874  nts1 = np.copy(t
-0000dcc0: 6172 6765 745f 706f 696e 7473 290a 2020  arget_points).  
-0000dcd0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0000dce0: 7267 6574 5f70 6f69 6e74 7320 3d20 6e70  rget_points = np
-0000dcf0: 2e63 6f70 7928 7072 6f62 655f 706f 696e  .copy(probe_poin
-0000dd00: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
-0000dd10: 2020 2020 7072 6f62 655f 706f 696e 7473      probe_points
-0000dd20: 203d 206e 702e 636f 7079 2870 726f 6265   = np.copy(probe
-0000dd30: 5f70 6f69 6e74 7331 290a 2020 2020 2020  _points1).      
-0000dd40: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000dd50: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-0000dd60: 7363 6970 792e 7370 6174 6961 6c20 696d  scipy.spatial im
-0000dd70: 706f 7274 2063 4b44 5472 6565 0a20 2020  port cKDTree.   
-0000dd80: 2020 2020 2020 2020 2020 2020 2074 7279               try
-0000dd90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dda0: 2020 2020 2020 6b64 7472 6565 203d 2063        kdtree = c
-0000ddb0: 4b44 5472 6565 2874 6172 6765 745f 706f  KDTree(target_po
-0000ddc0: 696e 7473 290a 2020 2020 2020 2020 2020  ints).          
-0000ddd0: 2020 2020 2020 6578 6365 7074 2052 756e        except Run
-0000dde0: 7469 6d65 4572 726f 723a 0a20 2020 2020  timeError:.     
-0000ddf0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000de00: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
-0000de10: 2020 2020 2020 2065 7863 6570 7420 496d         except Im
-0000de20: 706f 7274 4572 726f 723a 0a20 2020 2020  portError:.     
-0000de30: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-0000de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000de50: 2020 2020 6b64 7472 6565 203d 204b 4454      kdtree = KDT
-0000de60: 7265 6528 7461 7267 6574 5f70 6f69 6e74  ree(target_point
-0000de70: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0000de80: 2020 2065 7863 6570 7420 5275 6e74 696d     except Runtim
-0000de90: 6545 7272 6f72 3a0a 2020 2020 2020 2020  eError:.        
-0000dea0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000deb0: 726e 204e 6f6e 650a 2020 2020 2020 2020  rn None.        
-0000dec0: 6469 7374 616e 6365 7320 3d20 6b64 7472  distances = kdtr
-0000ded0: 6565 2e71 7565 7279 2870 726f 6265 5f70  ee.query(probe_p
-0000dee0: 6f69 6e74 7329 5b30 5d0a 2020 2020 2020  oints)[0].      
-0000def0: 2020 6966 206c 656e 2864 6973 7461 6e63    if len(distanc
-0000df00: 6573 2920 3d3d 2030 3a0a 2020 2020 2020  es) == 0:.      
-0000df10: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
-0000df20: 650a 2020 2020 2020 2020 6966 206e 6f74  e.        if not
-0000df30: 2077 6569 6768 743a 0a20 2020 2020 2020   weight:.       
-0000df40: 2020 2020 2069 6620 6e6f 7420 6e70 2e6d       if not np.m
-0000df50: 6561 6e28 6469 7374 616e 6365 7329 203c  ean(distances) <
-0000df60: 3d20 302e 3035 3a0a 2020 2020 2020 2020  = 0.05:.        
-0000df70: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
-0000df80: 202f 206e 702e 6d65 616e 2864 6973 7461   / np.mean(dista
-0000df90: 6e63 6573 290a 2020 2020 2020 2020 2020  nces).          
-0000dfa0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000dfb0: 2020 2020 2020 2020 7265 7475 726e 2031          return 1
-0000dfc0: 2f30 2e30 350a 0a20 2020 2020 2020 2078  /0.05..        x
-0000dfd0: 203d 2069 6e74 2833 302e 3020 2f20 6d61   = int(30.0 / ma
-0000dfe0: 705f 7461 7267 6574 2e61 7069 7829 0a20  p_target.apix). 
-0000dff0: 2020 2020 2020 2069 6620 6e70 2e61 6d69         if np.ami
-0000e000: 6e28 6469 7374 616e 6365 7329 203c 2078  n(distances) < x
-0000e010: 202f 2032 3a0a 2020 2020 2020 2020 2020   / 2:.          
-0000e020: 2020 6469 7374 616e 6365 7320 3d20 6469    distances = di
-0000e030: 7374 616e 6365 7320 2d20 6e70 2e61 6d69  stances - np.ami
-0000e040: 6e28 6469 7374 616e 6365 7329 0a20 2020  n(distances).   
-0000e050: 2020 2020 2062 696e 7320 3d20 5b5d 0a20       bins = []. 
-0000e060: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
-0000e070: 2020 2020 2077 6869 6c65 2069 203c 3d20       while i <= 
-0000e080: 666c 6f61 7428 7829 3a0a 2020 2020 2020  float(x):.      
-0000e090: 2020 2020 2020 6269 6e73 2e61 7070 656e        bins.appen
-0000e0a0: 6428 6920 2a20 312e 3029 0a20 2020 2020  d(i * 1.0).     
-0000e0b0: 2020 2020 2020 2069 202b 3d20 310a 2020         i += 1.  
-0000e0c0: 2020 2020 2020 6e75 6d5f 6469 7374 616e        num_distan
-0000e0d0: 6365 7320 3d20 6c65 6e28 6469 7374 616e  ces = len(distan
-0000e0e0: 6365 7329 0a20 2020 2020 2020 206f 7665  ces).        ove
-0000e0f0: 726c 6170 5f66 7265 7120 3d20 6e70 2e68  rlap_freq = np.h
-0000e100: 6973 746f 6772 616d 2864 6973 7461 6e63  istogram(distanc
-0000e110: 6573 2c20 6269 6e73 295b 305d 0a20 2020  es, bins)[0].   
-0000e120: 2020 2020 2066 6f72 2066 725f 6920 696e       for fr_i in
-0000e130: 2072 616e 6765 286c 656e 286f 7665 726c   range(len(overl
-0000e140: 6170 5f66 7265 7129 293a 0a20 2020 2020  ap_freq)):.     
-0000e150: 2020 2020 2020 2069 6620 6f76 6572 6c61         if overla
-0000e160: 705f 6672 6571 5b66 725f 695d 203e 206e  p_freq[fr_i] > n
-0000e170: 702e 616d 6178 286f 7665 726c 6170 5f66  p.amax(overlap_f
-0000e180: 7265 7129 202f 2033 2e3a 0a20 2020 2020  req) / 3.:.     
-0000e190: 2020 2020 2020 2020 2020 2062 7265 616b             break
-0000e1a0: 0a20 2020 2020 2020 2074 6f74 616c 5f65  .        total_e
-0000e1b0: 7874 203d 2066 725f 690a 2020 2020 2020  xt = fr_i.      
-0000e1c0: 2020 6269 6e73 203d 2062 696e 735b 6672    bins = bins[fr
-0000e1d0: 5f69 3a5d 0a20 2020 2020 2020 2069 6620  _i:].        if 
-0000e1e0: 636c 3a20 2023 206e 6f71 613a 4638 3231  cl:  # noqa:F821
-0000e1f0: 0a20 2020 2020 2020 2020 2020 2070 6f69  .            poi
-0000e200: 6e74 735f 636c 203d 2070 726f 6265 5f70  nts_cl = probe_p
-0000e210: 6f69 6e74 730a 2020 2020 2020 2020 2020  oints.          
-0000e220: 2020 6966 206c 656e 2870 6f69 6e74 735f    if len(points_
-0000e230: 636c 2920 3d3d 2030 3a0a 2020 2020 2020  cl) == 0:.      
-0000e240: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0000e250: 204e 6f6e 652c 204e 6f6e 650a 2020 2020   None, None.    
-0000e260: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-0000e270: 2020 2020 2020 2020 2020 2020 206b 6474               kdt
-0000e280: 7265 6520 3d20 634b 4454 7265 6528 706f  ree = cKDTree(po
-0000e290: 696e 7473 5f63 6c29 0a20 2020 2020 2020  ints_cl).       
-0000e2a0: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-0000e2b0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
-0000e2c0: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000e2d0: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
-0000e2e0: 2020 2020 206e 6569 6768 626f 7273 5f6e       neighbors_n
-0000e2f0: 756d 203d 2032 300a 2020 2020 2020 2020  um = 20.        
-0000e300: 2020 2020 6469 7374 616e 6365 5f6c 696d      distance_lim
-0000e310: 203d 2033 2e30 0a20 2020 2020 2020 2020   = 3.0.         
-0000e320: 2020 206e 6569 6768 203d 206b 6474 7265     neigh = kdtre
-0000e330: 652e 7175 6572 7928 0a20 2020 2020 2020  e.query(.       
-0000e340: 2020 2020 2020 2020 2070 6f69 6e74 735f           points_
-0000e350: 636c 2c0a 2020 2020 2020 2020 2020 2020  cl,.            
-0000e360: 2020 2020 6b3d 6e65 6967 6862 6f72 735f      k=neighbors_
-0000e370: 6e75 6d2c 0a20 2020 2020 2020 2020 2020  num,.           
-0000e380: 2020 2020 2064 6973 7461 6e63 655f 7570       distance_up
-0000e390: 7065 725f 626f 756e 643d 6469 7374 616e  per_bound=distan
-0000e3a0: 6365 5f6c 696d 2c0a 2020 2020 2020 2020  ce_lim,.        
-0000e3b0: 2020 2020 295b 315d 0a0a 2020 2020 2020      )[1]..      
-0000e3c0: 2020 2020 2020 636c 5f77 6569 6768 7420        cl_weight 
-0000e3d0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-0000e3e0: 2020 2020 2020 2020 6e70 2e6e 756d 7375          np.numsu
-0000e3f0: 6d28 6e70 2e73 756d 286e 6569 6768 203c  m(np.sum(neigh <
-0000e400: 206c 656e 286e 6569 6768 292c 2061 7869   len(neigh), axi
-0000e410: 733d 3129 203e 2031 3729 202f 0a20 2020  s=1) > 17) /.   
-0000e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e430: 2066 6c6f 6174 286c 656e 2870 726f 6265   float(len(probe
-0000e440: 5f70 6f69 6e74 7329 290a 2020 2020 2020  _points)).      
-0000e450: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-0000e460: 2020 2020 6469 7374 616e 6365 735f 616c      distances_al
-0000e470: 6967 6e20 3d20 6469 7374 616e 6365 730a  ign = distances.
-0000e480: 2020 2020 2020 2020 2020 2020 6469 7374              dist
-0000e490: 616e 6365 735f 7365 6c20 3d20 6469 7374  ances_sel = dist
-0000e4a0: 616e 6365 735f 616c 6967 6e5b 0a20 2020  ances_align[.   
-0000e4b0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
-0000e4c0: 7375 6d28 6e65 6967 6820 3c20 6c65 6e28  sum(neigh < len(
-0000e4d0: 6e65 6967 6829 2c20 6178 6973 3d31 2920  neigh), axis=1) 
-0000e4e0: 3e20 3137 0a20 2020 2020 2020 2020 2020  > 17.           
-0000e4f0: 205d 0a20 2020 2020 2020 2020 2020 2064   ].            d
-0000e500: 6973 7461 6e63 6573 203d 2064 6973 7461  istances = dista
-0000e510: 6e63 6573 5f73 656c 5b3a 5d0a 0a20 2020  nces_sel[:]..   
-0000e520: 2020 2020 206f 7665 726c 6170 5f66 7265       overlap_fre
-0000e530: 7120 3d20 6e70 2e68 6973 746f 6772 616d  q = np.histogram
-0000e540: 2864 6973 7461 6e63 6573 2c20 6269 6e73  (distances, bins
-0000e550: 295b 305d 0a20 2020 2020 2020 2074 6f74  )[0].        tot
-0000e560: 616c 203d 2074 6f74 616c 5f65 7874 0a20  al = total_ext. 
-0000e570: 2020 2020 2020 2063 756d 756c 5f66 7265         cumul_fre
-0000e580: 7120 3d20 302e 300a 2020 2020 2020 2020  q = 0.0.        
-0000e590: 656e 7465 7220 3d20 300a 2020 2020 2020  enter = 0.      
-0000e5a0: 2020 7375 6d5f 7363 203d 2030 2e30 0a20    sum_sc = 0.0. 
-0000e5b0: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000e5c0: 7261 6e67 6528 6c65 6e28 6f76 6572 6c61  range(len(overla
-0000e5d0: 705f 6672 6571 2929 3a0a 2020 2020 2020  p_freq)):.      
-0000e5e0: 2020 2020 2020 7720 3d20 6c65 6e28 6f76        w = len(ov
-0000e5f0: 6572 6c61 705f 6672 6571 2920 2d20 2869  erlap_freq) - (i
-0000e600: 290a 2020 2020 2020 2020 2020 2020 7472  ).            tr
-0000e610: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-0000e620: 2020 2063 756d 756c 5f66 7265 7120 2b3d     cumul_freq +=
-0000e630: 206f 7665 726c 6170 5f66 7265 715b 695d   overlap_freq[i]
-0000e640: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
-0000e650: 6570 7420 496e 6465 7845 7272 6f72 3a0a  ept IndexError:.
-0000e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e670: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
-0000e680: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000e690: 2020 2020 2020 7065 7263 5f65 7175 6976        perc_equiv
-0000e6a0: 203d 2066 6c6f 6174 2863 756d 756c 5f66   = float(cumul_f
-0000e6b0: 7265 7129 202f 206e 756d 5f64 6973 7461  req) / num_dista
-0000e6c0: 6e63 6573 0a20 2020 2020 2020 2020 2020  nces.           
-0000e6d0: 2065 7863 6570 7420 5a65 726f 4469 7669   except ZeroDivi
-0000e6e0: 7369 6f6e 4572 726f 723a 0a20 2020 2020  sionError:.     
-0000e6f0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0000e700: 2827 4469 7374 616e 6365 2077 6569 6768  ('Distance weigh
-0000e710: 7469 6e67 2066 6169 6c65 6421 212e 2043  ting failed!!. C
-0000e720: 6865 636b 2073 7572 6661 6365 2064 6566  heck surface def
-0000e730: 696e 6564 2729 0a20 2020 2020 2020 2020  ined').         
-0000e740: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000e750: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
-0000e760: 2020 2020 2073 756d 5f73 6320 3d20 7375       sum_sc = su
-0000e770: 6d5f 7363 202b 2028 2877 2920 2a20 7065  m_sc + ((w) * pe
-0000e780: 7263 5f65 7175 6976 290a 2020 2020 2020  rc_equiv).      
-0000e790: 2020 2020 2020 746f 7461 6c20 2b3d 2028        total += (
-0000e7a0: 7729 0a20 2020 2020 2020 2020 2020 2065  w).            e
-0000e7b0: 6e74 6572 203d 2031 0a20 2020 2020 2020  nter = 1.       
-0000e7c0: 2073 636f 7265 203d 2066 6c6f 6174 2873   score = float(s
-0000e7d0: 756d 5f73 6329 202f 2074 6f74 616c 0a20  um_sc) / total. 
-0000e7e0: 2020 2020 2020 2069 6620 636c 3a20 2023         if cl:  #
-0000e7f0: 206e 6f71 613a 4638 3231 0a20 2020 2020   noqa:F821.     
-0000e800: 2020 2020 2020 2069 6620 656e 7465 7220         if enter 
-0000e810: 3d3d 2031 3a0a 2020 2020 2020 2020 2020  == 1:.          
-0000e820: 2020 2020 2020 6966 206c 656e 2864 6973        if len(dis
-0000e830: 7461 6e63 6573 5f73 656c 2920 3d3d 2030  tances_sel) == 0
-0000e840: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
-0000e850: 2020 2020 2020 2020 7265 7475 726e 2030          return 0
-0000e860: 2e30 0a20 2020 2020 2020 2020 2020 2020  .0.             
-0000e870: 2020 2069 6620 6e70 2e6d 6561 6e28 6469     if np.mean(di
-0000e880: 7374 616e 6365 735f 7365 6c29 203d 3d20  stances_sel) == 
-0000e890: 302e 303a 0a20 2020 2020 2020 2020 2020  0.0:.           
-0000e8a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-0000e8b0: 302e 300a 2020 2020 2020 2020 2020 2020  0.0.            
-0000e8c0: 2020 2020 6966 2063 6c5f 7765 6967 6874      if cl_weight
-0000e8d0: 203d 3d20 302e 303a 0a20 2020 2020 2020   == 0.0:.       
-0000e8e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000e8f0: 7572 6e20 302e 300a 2020 2020 2020 2020  urn 0.0.        
-0000e900: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000e910: 636f 7265 0a20 2020 2020 2020 2020 2020  core.           
-0000e920: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000e930: 2020 2020 2020 2072 6574 7572 6e20 4e6f         return No
-0000e940: 6e65 2c20 4e6f 6e65 0a20 2020 2020 2020  ne, None.       
-0000e950: 2069 6620 656e 7465 7220 3d3d 2031 3a0a   if enter == 1:.
-0000e960: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000e970: 702e 6d65 616e 2864 6973 7461 6e63 6573  p.mean(distances
-0000e980: 2920 3c3d 2030 2e30 353a 0a20 2020 2020  ) <= 0.05:.     
-0000e990: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0000e9a0: 6e20 312e 300a 2020 2020 2020 2020 2020  n 1.0.          
-0000e9b0: 2020 6966 206e 702e 6d65 616e 2864 6973    if np.mean(dis
-0000e9c0: 7461 6e63 6573 2920 3d3d 2030 2e30 3a0a  tances) == 0.0:.
-0000e9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000e9e0: 7265 7475 726e 2031 2e30 0a20 2020 2020  return 1.0.     
-0000e9f0: 2020 2020 2020 2072 6574 7572 6e20 7363         return sc
-0000ea00: 6f72 650a 2020 2020 2020 2020 656c 7365  ore.        else
-0000ea10: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ea20: 7475 726e 204e 6f6e 652c 204e 6f6e 650a  turn None, None.
-0000ea30: 0a20 2020 2064 6566 2065 6e76 656c 6f70  .    def envelop
-0000ea40: 655f 7363 6f72 6528 0a20 2020 2020 2020  e_score(.       
-0000ea50: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0000ea60: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-0000ea70: 742c 0a20 2020 2020 2020 2020 2020 2070  t,.            p
-0000ea80: 7269 6d61 7279 5f62 6f75 6e64 6172 792c  rimary_boundary,
-0000ea90: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0000eaa0: 7563 7475 7265 5f69 6e73 7461 6e63 652c  ucture_instance,
-0000eab0: 0a20 2020 2020 2020 2020 2020 206e 6f72  .            nor
-0000eac0: 6d3d 5472 7565 2c0a 2020 2020 2020 2020  m=True,.        
-0000ead0: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0000eae0: 2222 0a20 2020 2020 2020 2043 616c 6375  "".        Calcu
-0000eaf0: 6c61 7465 2074 6865 2065 6e76 656c 6f70  late the envelop
-0000eb00: 6520 7363 6f72 6520 6265 7477 6565 6e20  e score between 
-0000eb10: 6120 7461 7267 6574 204d 6170 2061 6e64  a target Map and
-0000eb20: 2061 2053 7472 7563 7475 7265 0a20 2020   a Structure.   
-0000eb30: 2020 2020 2049 6e73 7461 6e63 6573 2e0a       Instances..
-0000eb40: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
-0000eb50: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0000eb60: 6d61 705f 7461 7267 6574 3a20 5461 7267  map_target: Targ
-0000eb70: 6574 204d 6170 2049 6e73 7461 6e63 652e  et Map Instance.
-0000eb80: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-0000eb90: 6d61 7279 5f62 6f75 6e64 6172 793a 2056  mary_boundary: V
-0000eba0: 616c 7565 2073 7065 6369 6669 6564 2069  alue specified i
-0000ebb0: 7320 6361 6c63 756c 6174 6564 2077 6974  s calculated wit
-0000ebc0: 680a 2020 2020 2020 2020 2020 2020 2020  h.              
-0000ebd0: 2020 7072 696d 6172 795f 626f 756e 6461    primary_bounda
-0000ebe0: 7279 206f 6620 7468 6520 6d61 7020 6f62  ry of the map ob
-0000ebf0: 6a65 6374 2e0a 2020 2020 2020 2020 2020  ject..          
-0000ec00: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
-0000ec10: 616e 6365 3a20 4d6f 6465 6c20 7374 7275  ance: Model stru
-0000ec20: 6374 7572 6520 696e 7374 616e 6365 2e0a  cture instance..
-0000ec30: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
-0000ec40: 3a20 4e6f 726d 616c 6973 6520 7468 6520  : Normalise the 
-0000ec50: 7363 6f72 6520 6265 7477 6565 6e20 3020  score between 0 
-0000ec60: 616e 6420 3120 6966 2054 7275 652e 0a0a  and 1 if True...
-0000ec70: 2020 2020 2020 2020 5265 7475 726e 733a          Returns:
-0000ec80: 0a20 2020 2020 2020 2020 2020 2045 6e76  .            Env
-0000ec90: 656c 6f70 6520 7363 6f72 652c 206e 6f72  elope score, nor
-0000eca0: 6d61 6c69 7365 6420 6265 7477 6565 6e20  malised between 
-0000ecb0: 3020 616e 6420 3120 6966 206e 6f72 6d20  0 and 1 if norm 
-0000ecc0: 6973 2054 7275 650a 0a20 2020 2020 2020  is True..       
-0000ecd0: 2022 2222 0a20 2020 2020 2020 2062 696e   """.        bin
-0000ece0: 4d61 7020 3d20 6d61 705f 7461 7267 6574  Map = map_target
-0000ecf0: 2e6d 616b 655f 6269 6e5f 6d61 7028 7072  .make_bin_map(pr
-0000ed00: 696d 6172 795f 626f 756e 6461 7279 290a  imary_boundary).
-0000ed10: 2020 2020 2020 2020 6d61 785f 7363 6f72          max_scor
-0000ed20: 6520 3d20 666c 6f61 7428 2d32 202a 206e  e = float(-2 * n
-0000ed30: 702e 7375 6d28 6269 6e4d 6170 2e66 756c  p.sum(binMap.ful
-0000ed40: 6c4d 6170 2929 0a20 2020 2020 2020 206d  lMap)).        m
-0000ed50: 696e 5f73 636f 7265 203d 2066 6c6f 6174  in_score = float
-0000ed60: 286e 702e 7375 6d28 6269 6e4d 6170 2e66  (np.sum(binMap.f
-0000ed70: 756c 6c4d 6170 292d 3220 2a20 6e70 2e73  ullMap)-2 * np.s
-0000ed80: 756d 2862 696e 4d61 702e 6675 6c6c 4d61  um(binMap.fullMa
-0000ed90: 702b 3129 290a 0a20 2020 2020 2020 2062  p+1))..        b
-0000eda0: 6c75 7272 6572 203d 2053 7472 7563 7475  lurrer = Structu
-0000edb0: 7265 426c 7572 7265 7228 290a 2020 2020  reBlurrer().    
-0000edc0: 2020 2020 7374 7275 6374 5f62 696e 4d61      struct_binMa
-0000edd0: 7020 3d20 626c 7572 7265 722e 6d61 6b65  p = blurrer.make
-0000ede0: 5f61 746f 6d5f 6f76 6572 6c61 795f 6d61  _atom_overlay_ma
-0000edf0: 7031 280a 2020 2020 2020 2020 2020 2020  p1(.            
-0000ee00: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
-0000ee10: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-0000ee20: 655f 696e 7374 616e 6365 0a20 2020 2020  e_instance.     
-0000ee30: 2020 2029 0a20 2020 2020 2020 2067 7269     ).        gri
-0000ee40: 6420 3d20 7374 7275 6374 5f62 696e 4d61  d = struct_binMa
-0000ee50: 702e 6765 745f 706f 7328 302e 392c 2031  p.get_pos(0.9, 1
-0000ee60: 2e31 290a 2020 2020 2020 2020 666f 7220  .1).        for 
-0000ee70: 782c 2079 2c20 7a20 696e 2067 7269 643a  x, y, z in grid:
-0000ee80: 0a20 2020 2020 2020 2020 2020 2067 203d  .            g =
-0000ee90: 2062 696e 4d61 705b 7a5d 5b79 5d5b 785d   binMap[z][y][x]
-0000eea0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000eeb0: 6720 3d3d 202d 313a 0a20 2020 2020 2020  g == -1:.       
-0000eec0: 2020 2020 2020 2020 2062 696e 4d61 705b           binMap[
-0000eed0: 7a5d 5b79 5d5b 785d 203d 2032 0a20 2020  z][y][x] = 2.   
-0000eee0: 2020 2020 2020 2020 2065 6c69 6620 6720           elif g 
-0000eef0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-0000ef00: 2020 2020 2020 6269 6e4d 6170 5b7a 5d5b        binMap[z][
-0000ef10: 795d 5b78 5d20 3d20 2d32 0a20 2020 2020  y][x] = -2.     
-0000ef20: 2020 2073 636f 7265 203d 2066 6c6f 6174     score = float
-0000ef30: 286e 702e 7375 6d28 6269 6e4d 6170 2e66  (np.sum(binMap.f
-0000ef40: 756c 6c4d 6170 2929 0a20 2020 2020 2020  ullMap)).       
-0000ef50: 2069 6620 6e6f 726d 3a0a 2020 2020 2020   if norm:.      
-0000ef60: 2020 2020 2020 6e6f 726d 5f73 636f 7265        norm_score
-0000ef70: 203d 2066 6c6f 6174 2828 7363 6f72 652d   = float((score-
-0000ef80: 6d69 6e5f 7363 6f72 6529 202f 2028 6d61  min_score) / (ma
-0000ef90: 785f 7363 6f72 652d 6d69 6e5f 7363 6f72  x_score-min_scor
-0000efa0: 6529 290a 2020 2020 2020 2020 2020 2020  e)).            
-0000efb0: 7265 7475 726e 206e 6f72 6d5f 7363 6f72  return norm_scor
-0000efc0: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-0000efd0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0000efe0: 726e 2073 636f 7265 0a0a 2020 2020 6465  rn score..    de
-0000eff0: 6620 656e 7665 6c6f 7065 5f73 636f 7265  f envelope_score
-0000f000: 5f6d 6170 280a 2020 2020 2020 2020 2020  _map(.          
-0000f010: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000f020: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
-0000f030: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-0000f040: 7072 6f62 652c 0a20 2020 2020 2020 2020  probe,.         
-0000f050: 2020 206d 6170 5f74 6172 6765 745f 7468     map_target_th
-0000f060: 7265 7368 6f6c 643d 302c 0a20 2020 2020  reshold=0,.     
-0000f070: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
-0000f080: 5f74 6872 6573 686f 6c64 3d30 2c0a 2020  _threshold=0,.  
-0000f090: 2020 2020 2020 2020 2020 6e6f 726d 3d54            norm=T
-0000f0a0: 7275 652c 0a20 2020 2029 3a0a 2020 2020  rue,.    ):.    
-0000f0b0: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
-0000f0c0: 2074 6865 2065 6e76 656c 6f70 6520 7363   the envelope sc
-0000f0d0: 6f72 6520 6265 7477 6565 6e20 7477 6f20  ore between two 
-0000f0e0: 6d61 7073 0a0a 2020 2020 2020 2020 4172  maps..        Ar
-0000f0f0: 6775 6d65 6e74 733a 0a20 2020 2020 2020  guments:.       
-0000f100: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
-0000f110: 206d 6170 5f70 726f 6265 3a20 4d61 7020   map_probe: Map 
-0000f120: 696e 7374 616e 6365 2074 6f20 636f 6d70  instance to comp
-0000f130: 6172 652e 0a20 2020 2020 2020 2020 2020  are..           
-0000f140: 206d 6170 5f74 6172 6765 745f 7468 7265   map_target_thre
-0000f150: 7368 6f6c 642c 206d 6170 5f70 726f 6265  shold, map_probe
-0000f160: 5f74 6872 6573 686f 6c64 3a0a 2020 2020  _threshold:.    
-0000f170: 2020 2020 2020 2020 2020 2020 4d61 7020              Map 
-0000f180: 7468 7265 7368 6f6c 6420 7468 6174 2064  threshold that d
-0000f190: 6566 696e 6573 2074 6865 2065 6e76 656c  efines the envel
-0000f1a0: 6f70 652c 206f 7220 7375 7266 6163 652c  ope, or surface,
-0000f1b0: 206f 6620 7468 650a 2020 2020 2020 2020   of the.        
-0000f1c0: 2020 2020 2020 2020 6d61 702e 2057 696c          map. Wil
-0000f1d0: 6c20 6265 2061 7574 6f6d 6174 6963 616c  l be automatical
-0000f1e0: 6c79 2063 616c 6375 6c61 7465 6420 7573  ly calculated us
-0000f1f0: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
-0000f200: 2020 2020 3a6d 6574 683a 6073 656c 662e      :meth:`self.
-0000f210: 6361 6c63 756c 6174 655f 6d61 705f 7468  calculate_map_th
-0000f220: 7265 7368 6f6c 6420 3c54 454d 5079 2e70  reshold <TEMPy.p
-0000f230: 726f 7465 696e 2e73 636f 7269 6e67 5f66  rotein.scoring_f
-0000f240: 756e 6374 696f 6e73 2e53 636f 7269 6e67  unctions.Scoring
-0000f250: 4675 6e63 7469 6f6e 732e 6361 6c63 756c  Functions.calcul
-0000f260: 6174 655f 6d61 705f 7468 7265 7368 6f6c  ate_map_threshol
-0000f270: 643e 600a 2020 2020 2020 2020 2020 2020  d>`.            
-0000f280: 2020 2020 6966 206e 6f74 2073 7065 6369      if not speci
-0000f290: 6669 6564 2e0a 2020 2020 2020 2020 2020  fied..          
-0000f2a0: 2020 6e6f 726d 3a20 4e6f 726d 616c 6973    norm: Normalis
-0000f2b0: 6520 7468 6520 7363 6f72 6520 6265 7477  e the score betw
-0000f2c0: 6565 6e20 3020 616e 6420 3120 6966 2054  een 0 and 1 if T
-0000f2d0: 7275 652e 0a0a 2020 2020 2020 2020 5265  rue...        Re
-0000f2e0: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-0000f2f0: 2020 2045 6e76 656c 6f70 6520 7363 6f72     Envelope scor
-0000f300: 652c 206e 6f72 6d61 6c69 7365 6420 6265  e, normalised be
-0000f310: 7477 6565 6e20 3020 616e 6420 3120 6966  tween 0 and 1 if
-0000f320: 206e 6f72 6d20 6973 2054 7275 650a 2020   norm is True.  
-0000f330: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0000f340: 2020 6966 2073 656c 662e 6d61 7043 6f6d    if self.mapCom
-0000f350: 7061 7269 736f 6e28 6d61 705f 7461 7267  parison(map_targ
-0000f360: 6574 2c20 6d61 705f 7072 6f62 6529 3a0a  et, map_probe):.
-0000f370: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0000f380: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
-0000f390: 6f6c 6420 3d3d 2030 3a0a 2020 2020 2020  old == 0:.      
-0000f3a0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-0000f3b0: 7267 6574 5f74 6872 6573 686f 6c64 203d  rget_threshold =
-0000f3c0: 2073 656c 662e 6361 6c63 756c 6174 655f   self.calculate_
-0000f3d0: 6d61 705f 7468 7265 7368 6f6c 6428 6d61  map_threshold(ma
-0000f3e0: 705f 7461 7267 6574 290a 2020 2020 2020  p_target).      
-0000f3f0: 2020 2020 2020 6966 206d 6170 5f70 726f        if map_pro
-0000f400: 6265 5f74 6872 6573 686f 6c64 203d 3d20  be_threshold == 
-0000f410: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-0000f420: 2020 206d 6170 5f70 726f 6265 5f74 6872     map_probe_thr
-0000f430: 6573 686f 6c64 203d 2073 656c 662e 6361  eshold = self.ca
-0000f440: 6c63 756c 6174 655f 6d61 705f 7468 7265  lculate_map_thre
-0000f450: 7368 6f6c 6428 6d61 705f 7072 6f62 6529  shold(map_probe)
-0000f460: 0a0a 2020 2020 2020 2020 6269 6e4d 6170  ..        binMap
-0000f470: 203d 206d 6170 5f74 6172 6765 742e 6d61   = map_target.ma
-0000f480: 6b65 5f62 696e 5f6d 6170 286d 6170 5f74  ke_bin_map(map_t
-0000f490: 6172 6765 745f 7468 7265 7368 6f6c 6429  arget_threshold)
-0000f4a0: 0a20 2020 2020 2020 206d 6178 5f73 636f  .        max_sco
-0000f4b0: 7265 203d 2066 6c6f 6174 282d 3220 2a20  re = float(-2 * 
-0000f4c0: 6e70 2e73 756d 2862 696e 4d61 702e 6675  np.sum(binMap.fu
-0000f4d0: 6c6c 4d61 7029 290a 2020 2020 2020 2020  llMap)).        
-0000f4e0: 6d69 6e5f 7363 6f72 6520 3d20 666c 6f61  min_score = floa
-0000f4f0: 7428 0a20 2020 2020 2020 2020 2020 206e  t(.            n
-0000f500: 702e 7375 6d28 6269 6e4d 6170 2e66 756c  p.sum(binMap.ful
-0000f510: 6c4d 6170 292d 3220 2a20 6e70 2e73 756d  lMap)-2 * np.sum
-0000f520: 2862 696e 4d61 702e 6675 6c6c 4d61 7020  (binMap.fullMap 
-0000f530: 2b20 3129 0a20 2020 2020 2020 2029 0a20  + 1).        ). 
-0000f540: 2020 2020 2020 2073 7472 7563 745f 6269         struct_bi
-0000f550: 6e4d 6170 203d 206d 6170 5f70 726f 6265  nMap = map_probe
-0000f560: 2e6d 616b 655f 6269 6e5f 6d61 7028 6d61  .make_bin_map(ma
-0000f570: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
-0000f580: 6429 0a20 2020 2020 2020 206e 6577 4d61  d).        newMa
-0000f590: 7020 3d20 6269 6e4d 6170 2e66 756c 6c4d  p = binMap.fullM
-0000f5a0: 6170 202b 2032 202a 2073 7472 7563 745f  ap + 2 * struct_
-0000f5b0: 6269 6e4d 6170 2e66 756c 6c4d 6170 0a20  binMap.fullMap. 
-0000f5c0: 2020 2020 2020 2068 6973 745f 6172 7261         hist_arra
-0000f5d0: 7920 3d20 6e70 2e68 6973 746f 6772 616d  y = np.histogram
-0000f5e0: 286e 6577 4d61 702c 2034 290a 2020 2020  (newMap, 4).    
-0000f5f0: 2020 2020 7363 6f72 6520 3d20 280a 2020      score = (.  
-0000f600: 2020 2020 2020 2020 2020 2020 2020 3220                2 
-0000f610: 2a0a 2020 2020 2020 2020 2020 2020 2020  *.              
-0000f620: 2020 6869 7374 5f61 7272 6179 5b30 5d5b    hist_array[0][
-0000f630: 305d 202d 0a20 2020 2020 2020 2020 2020  0] -.           
-0000f640: 2020 2020 2028 3220 2a20 2868 6973 745f       (2 * (hist_
-0000f650: 6172 7261 795b 305d 5b31 5d29 2920 2d0a  array[0][1])) -.
-0000f660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f670: 2868 6973 745f 6172 7261 795b 305d 5b32  (hist_array[0][2
-0000f680: 5d29 0a20 2020 2020 2020 2029 0a20 2020  ]).        ).   
-0000f690: 2020 2020 2069 6620 6e6f 726d 3a0a 2020       if norm:.  
-0000f6a0: 2020 2020 2020 2020 2020 6e6f 726d 5f73            norm_s
-0000f6b0: 636f 7265 203d 2066 6c6f 6174 2828 7363  core = float((sc
-0000f6c0: 6f72 6520 2d20 6d69 6e5f 7363 6f72 6529  ore - min_score)
-0000f6d0: 2920 2f20 286d 6178 5f73 636f 7265 202d  ) / (max_score -
-0000f6e0: 206d 696e 5f73 636f 7265 290a 2020 2020   min_score).    
-0000f6f0: 2020 2020 2020 2020 7265 7475 726e 206e          return n
-0000f700: 6f72 6d5f 7363 6f72 650a 2020 2020 2020  orm_score.      
-0000f710: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000f720: 2020 2020 7265 7475 726e 2073 636f 7265      return score
-0000f730: 0a0a 2020 2020 6465 6620 5f70 6572 6365  ..    def _perce
-0000f740: 6e74 5f6f 7665 726c 6170 280a 2020 2020  nt_overlap(.    
-0000f750: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000f760: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-0000f770: 7267 6574 2c0a 2020 2020 2020 2020 2020  rget,.          
-0000f780: 2020 6d61 705f 7072 6f62 652c 0a20 2020    map_probe,.   
-0000f790: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
-0000f7a0: 6765 745f 7468 7265 7368 6f6c 642c 0a20  get_threshold,. 
-0000f7b0: 2020 2020 2020 2020 2020 206d 6170 5f70             map_p
-0000f7c0: 726f 6265 5f74 6872 6573 686f 6c64 2c0a  robe_threshold,.
-0000f7d0: 2020 2020 2020 2020 2020 2020 666c 6167              flag
-0000f7e0: 7369 7a65 3d30 2c0a 2020 2020 293a 0a20  size=0,.    ):. 
-0000f7f0: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
-0000f800: 6174 6520 7468 6520 6672 6163 7469 6f6e  ate the fraction
-0000f810: 206f 6620 6f76 6572 6c61 7020 6265 7477   of overlap betw
-0000f820: 6565 6e20 7477 6f20 6d61 7020 6772 6964  een two map grid
-0000f830: 732e 0a0a 2020 2020 2020 2020 4172 6775  s...        Argu
-0000f840: 6d65 6e74 733a 0a20 2020 2020 2020 2020  ments:.         
-0000f850: 2020 206d 6170 5f74 6172 6765 742c 206d     map_target, m
-0000f860: 6170 5f70 726f 6265 3a20 4d61 7020 696e  ap_probe: Map in
-0000f870: 7374 616e 6365 2074 6f20 636f 6d70 6172  stance to compar
-0000f880: 652e 0a20 2020 2020 2020 2020 2020 206d  e..            m
-0000f890: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
-0000f8a0: 6f6c 642c 206d 6170 5f70 726f 6265 5f74  old, map_probe_t
-0000f8b0: 6872 6573 686f 6c64 3a0a 2020 2020 2020  hreshold:.      
-0000f8c0: 2020 2020 2020 2020 2020 6d61 7020 636f            map co
-0000f8d0: 6e74 6f75 7220 7468 7265 7368 6f6c 6473  ntour thresholds
-0000f8e0: 2066 6f72 206d 6170 5f74 6172 6765 7420   for map_target 
-0000f8f0: 616e 6420 6d61 705f 7072 6f62 652e 0a20  and map_probe.. 
-0000f900: 2020 2020 2020 2052 6574 7572 6e3a 0a20         Return:. 
-0000f910: 2020 2020 2020 2020 2020 2050 6572 6365             Perce
-0000f920: 6e74 206f 7665 726c 6170 2077 6974 6820  nt overlap with 
-0000f930: 7265 7370 6563 7420 746f 2073 6d61 6c6c  respect to small
-0000f940: 6572 2067 7269 640a 2020 2020 2020 2020  er grid.        
-0000f950: 2222 220a 2020 2020 2020 2020 6966 2073  """.        if s
-0000f960: 656c 662e 6d61 7043 6f6d 7061 7269 736f  elf.mapCompariso
-0000f970: 6e28 6d61 705f 7461 7267 6574 2c20 6d61  n(map_target, ma
-0000f980: 705f 7072 6f62 6529 3a0a 2020 2020 2020  p_probe):.      
-0000f990: 2020 2020 2020 6269 6e6d 6170 3120 3d20        binmap1 = 
-0000f9a0: 6d61 705f 7461 7267 6574 2e66 756c 6c4d  map_target.fullM
-0000f9b0: 6170 203e 2066 6c6f 6174 286d 6170 5f74  ap > float(map_t
-0000f9c0: 6172 6765 745f 7468 7265 7368 6f6c 6429  arget_threshold)
-0000f9d0: 0a20 2020 2020 2020 2020 2020 2062 696e  .            bin
-0000f9e0: 6d61 7032 203d 206d 6170 5f70 726f 6265  map2 = map_probe
-0000f9f0: 2e66 756c 6c4d 6170 203e 2066 6c6f 6174  .fullMap > float
-0000fa00: 286d 6170 5f70 726f 6265 5f74 6872 6573  (map_probe_thres
-0000fa10: 686f 6c64 290a 2020 2020 2020 2020 2020  hold).          
-0000fa20: 2020 6d69 6e69 6d20 3d20 6c65 6e28 6d61    minim = len(ma
-0000fa30: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
-0000fa40: 5b62 696e 6d61 7031 5d29 0a20 2020 2020  [binmap1]).     
-0000fa50: 2020 2020 2020 2069 6620 6c65 6e28 6d61         if len(ma
-0000fa60: 705f 7072 6f62 652e 6675 6c6c 4d61 705b  p_probe.fullMap[
-0000fa70: 6269 6e6d 6170 325d 2920 3c20 6d69 6e69  binmap2]) < mini
-0000fa80: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
-0000fa90: 2020 206d 696e 696d 203d 206c 656e 286d     minim = len(m
-0000faa0: 6170 5f70 726f 6265 2e66 756c 6c4d 6170  ap_probe.fullMap
-0000fab0: 5b62 696e 6d61 7032 5d29 0a20 2020 2020  [binmap2]).     
-0000fac0: 2020 2020 2020 206d 6173 6b6d 6170 203d         maskmap =
-0000fad0: 2028 6269 6e6d 6170 3120 2a20 6269 6e6d   (binmap1 * binm
-0000fae0: 6170 3229 203e 2030 0a20 2020 2020 2020  ap2) > 0.       
-0000faf0: 2020 2020 2069 6620 666c 6167 7369 7a65       if flagsize
-0000fb00: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
-0000fb10: 2020 2020 2020 2072 6574 7572 6e20 6e70         return np
-0000fb20: 2e73 756d 286d 6173 6b6d 6170 292c 206e  .sum(maskmap), n
-0000fb30: 702e 7375 6d28 6269 6e6d 6170 3129 2c20  p.sum(binmap1), 
-0000fb40: 6e70 2e73 756d 2862 696e 6d61 7032 290a  np.sum(binmap2).
-0000fb50: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-0000fb60: 6f74 206d 696e 696d 203d 3d20 302e 303a  ot minim == 0.0:
-0000fb70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000fb80: 2072 6574 7572 6e20 666c 6f61 7428 6c65   return float(le
-0000fb90: 6e28 6d61 705f 7461 7267 6574 2e66 756c  n(map_target.ful
-0000fba0: 6c4d 6170 5b6d 6173 6b6d 6170 5d29 292f  lMap[maskmap]))/
-0000fbb0: 6d69 6e69 6d0a 2020 2020 2020 2020 2020  minim.          
-0000fbc0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0000fbd0: 2020 2020 2020 2020 7072 696e 7428 2743          print('C
-0000fbe0: 6865 636b 206d 6170 2063 6f6e 746f 7572  heck map contour
-0000fbf0: 2121 2729 0a20 2020 2020 2020 2020 2020  !!').           
-0000fc00: 2020 2020 2072 6574 7572 6e20 302e 300a       return 0.0.
-0000fc10: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000fc20: 2020 2020 2020 2020 2020 7072 696e 7428            print(
-0000fc30: 2740 4040 204d 6170 7320 636f 756c 6420  '@@@ Maps could 
-0000fc40: 6e6f 7420 6265 206d 6174 6368 6564 2729  not be matched')
-0000fc50: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-0000fc60: 7572 6e20 2d31 2e30 0a0a 2020 2020 6465  urn -1.0..    de
-0000fc70: 6620 5343 4343 280a 2020 2020 2020 2020  f SCCC(.        
-0000fc80: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-0000fc90: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
-0000fca0: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-0000fcb0: 736f 6c75 7469 6f6e 5f64 656e 734d 6170  solution_densMap
-0000fcc0: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-0000fcd0: 676d 615f 6d61 702c 0a20 2020 2020 2020  gma_map,.       
-0000fce0: 2020 2020 2073 7472 7563 7475 7265 5f69       structure_i
-0000fcf0: 6e73 7461 6e63 652c 0a20 2020 2020 2020  nstance,.       
-0000fd00: 2020 2020 2072 6967 6964 5f62 6f64 795f       rigid_body_
-0000fd10: 7374 7275 6374 7572 652c 0a20 2020 2020  structure,.     
-0000fd20: 2020 2020 2020 2077 7269 7465 3d46 616c         write=Fal
-0000fd30: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0000fd40: 635f 6d6f 6465 3d46 616c 7365 2c0a 2020  c_mode=False,.  
-0000fd50: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0000fd60: 4361 6c63 756c 6174 6520 6c6f 6361 6c20  Calculate local 
-0000fd70: 6372 6f73 732d 636f 7272 656c 6174 696f  cross-correlatio
-0000fd80: 6e20 666f 7220 6120 7365 676d 656e 7420  n for a segment 
-0000fd90: 6f66 2061 2070 726f 7465 696e 206d 6f64  of a protein mod
-0000fda0: 656c 0a0a 2020 2020 2020 2020 5365 676d  el..        Segm
-0000fdb0: 656e 7473 2061 7265 2064 6566 696e 6564  ents are defined
-0000fdc0: 2075 7369 6e67 2061 2072 6967 6964 2d62   using a rigid-b
-0000fdd0: 6f64 7920 7374 7275 6374 7572 6520 696e  ody structure in
-0000fde0: 7374 616e 6365 2c20 7768 6963 6820 6361  stance, which ca
-0000fdf0: 6e0a 2020 2020 2020 2020 6265 2067 656e  n.        be gen
-0000fe00: 6572 6174 6564 2075 7369 6e67 2060 5249  erated using `RI
-0000fe10: 4246 494e 4420 3c68 7474 7073 3a2f 2f72  BFIND <https://r
-0000fe20: 6962 6669 6e64 2e69 736d 622e 6c6f 6e2e  ibfind.ismb.lon.
-0000fe30: 6163 2e75 6b2f 3e60 5f2e 0a20 2020 2020  ac.uk/>`_..     
-0000fe40: 2020 2054 6865 2043 4343 2069 7320 6361     The CCC is ca
-0000fe50: 6c63 756c 6174 6564 2075 7369 6e67 0a20  lculated using. 
-0000fe60: 2020 2020 2020 203a 6d65 7468 3a60 4343         :meth:`CC
-0000fe70: 435f 6d61 7020 3c54 454d 5079 2e70 726f  C_map <TEMPy.pro
-0000fe80: 7465 696e 2e73 636f 7269 6e67 5f66 756e  tein.scoring_fun
-0000fe90: 6374 696f 6e73 2e53 636f 7269 6e67 4675  ctions.ScoringFu
-0000fea0: 6e63 7469 6f6e 732e 4343 435f 6d61 703e  nctions.CCC_map>
-0000feb0: 602e 0a0a 2020 2020 2020 2020 496d 706c  `...        Impl
-0000fec0: 656d 656e 7461 7469 6f6e 2064 6973 6375  ementation discu
-0000fed0: 7373 6564 2069 6e20 6d6f 7265 2064 6574  ssed in more det
-0000fee0: 6169 6c20 6174 2074 6865 2066 6f6c 6c6f  ail at the follo
-0000fef0: 7769 6e67 2072 6566 6572 656e 6365 3a0a  wing reference:.
-0000ff00: 2020 2020 2020 2020 2020 2020 2a20 6050              * `P
-0000ff10: 616e 6475 7261 6e67 616e 2065 7420 616c  andurangan et al
-0000ff20: 2e2c 204a 2053 7472 7563 7420 4269 6f6c  ., J Struct Biol
-0000ff30: 2e20 3230 3133 2044 6563 2031 3220 3c68  . 2013 Dec 12 <h
-0000ff40: 7474 7073 3a2f 2f77 7777 2e6e 6362 692e  ttps://www.ncbi.
-0000ff50: 6e6c 6d2e 6e69 682e 676f 762f 706d 632f  nlm.nih.gov/pmc/
-0000ff60: 6172 7469 636c 6573 2f50 4d43 3339 3838  articles/PMC3988
-0000ff70: 3932 322f 3e60 5f0a 0a20 2020 2020 2020  922/>`_..       
-0000ff80: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
-0000ff90: 2020 206d 6170 5f74 6172 6765 743a 204d     map_target: M
-0000ffa0: 6170 2049 6e73 7461 6e63 652e 0a20 2020  ap Instance..   
-0000ffb0: 2020 2020 2020 2020 2072 6573 6f6c 7574           resolut
-0000ffc0: 696f 6e5f 6465 6e73 4d61 703a 2052 6573  ion_densMap: Res
-0000ffd0: 6f6c 7574 696f 6e20 6f66 2074 6865 2069  olution of the i
-0000ffe0: 6e70 7574 206d 6170 2e0a 2020 2020 2020  nput map..      
-0000fff0: 2020 2020 2020 7369 676d 615f 6d61 703a        sigma_map:
-00010000: 2050 6172 616d 6574 6572 206e 6565 6420   Parameter need 
-00010010: 666f 7220 5374 7275 6374 7572 6520 426c  for Structure Bl
-00010020: 7572 7265 722e 2046 756c 6c20 6578 706c  urrer. Full expl
-00010030: 616e 6174 696f 6e0a 2020 2020 2020 2020  anation.        
-00010040: 2020 2020 2020 2020 3a72 6566 3a60 6865          :ref:`he
-00010050: 7265 3c4e 6f74 6520 6f6e 2072 6561 6c20  re<Note on real 
-00010060: 7370 6163 6520 626c 7572 7269 6e67 3a3e  space blurring:>
-00010070: 600a 2020 2020 2020 2020 2020 2020 7374  `.            st
-00010080: 7275 6374 7572 655f 696e 7374 616e 6365  ructure_instance
-00010090: 3a20 5374 7275 6374 7572 6520 696e 7374  : Structure inst
-000100a0: 616e 6365 2074 6f20 636f 6d70 6172 650a  ance to compare.
-000100b0: 2020 2020 2020 2020 2020 2020 7269 6769              rigi
-000100c0: 645f 626f 6479 5f73 7472 7563 7475 7265  d_body_structure
-000100d0: 3a20 5269 6769 642d 626f 6479 2053 7472  : Rigid-body Str
-000100e0: 7563 7475 7265 2069 6e73 7461 6e63 6520  ucture instance 
-000100f0: 7468 6174 2064 6566 696e 6573 0a20 2020  that defines.   
-00010100: 2020 2020 2020 2020 2020 2020 2074 6865               the
-00010110: 2073 6567 6d65 6e74 2e0a 2020 2020 2020   segment..      
-00010120: 2020 2020 2020 7772 6974 653a 2049 6620        write: If 
-00010130: 5472 7565 2c20 6120 7374 7269 6e67 2069  True, a string i
-00010140: 7320 7265 7475 726e 6564 2077 6974 6820  s returned with 
-00010150: 666f 726d 6174 203a 636f 6465 3a60 6627  format :code:`f'
-00010160: 5343 4343 2066 6f72 2073 6567 6d65 6e74  SCCC for segment
-00010170: 207b 5343 4343 5f73 636f 7265 7d27 600a   {SCCC_score}'`.
-00010180: 2020 2020 2020 2020 2020 2020 635f 6d6f              c_mo
-00010190: 6465 3a20 4e6f 206c 6f6e 6765 7220 696e  de: No longer in
-000101a0: 2075 7365 0a20 2020 2020 2020 2052 6574   use.        Ret
-000101b0: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
-000101c0: 2020 666c 6f61 7420 6966 203a 636f 6465    float if :code
-000101d0: 3a60 7772 6974 653d 4661 6c73 6560 2c20  :`write=False`, 
-000101e0: 656c 7365 2073 7472 696e 673a 0a20 2020  else string:.   
-000101f0: 2020 2020 2020 2020 2020 2020 2053 4343               SCC
-00010200: 4320 5363 6f72 650a 2020 2020 2020 2020  C Score.        
-00010210: 2222 220a 2020 2020 2020 2020 626c 7572  """.        blur
-00010220: 7265 7220 3d20 5374 7275 6374 7572 6542  rer = StructureB
-00010230: 6c75 7272 6572 2829 0a20 2020 2020 2020  lurrer().       
-00010240: 2073 636f 7265 7220 3d20 5363 6f72 696e   scorer = Scorin
-00010250: 6746 756e 6374 696f 6e73 2829 0a20 2020  gFunctions().   
-00010260: 2020 2020 206f 7574 6c69 6e65 203d 2022       outline = "
-00010270: 220a 2020 2020 2020 2020 7265 736f 6c75  ".        resolu
-00010280: 7469 6f6e 5f64 656e 734d 6170 203d 2066  tion_densMap = f
-00010290: 6c6f 6174 2872 6573 6f6c 7574 696f 6e5f  loat(resolution_
-000102a0: 6465 6e73 4d61 7029 0a20 2020 2020 2020  densMap).       
-000102b0: 2077 686f 6c65 5f66 6974 5f6d 6170 203d   whole_fit_map =
-000102c0: 2062 6c75 7272 6572 2e67 6175 7373 6961   blurrer.gaussia
-000102d0: 6e5f 626c 7572 280a 2020 2020 2020 2020  n_blur(.        
-000102e0: 2020 2020 7374 7275 6374 7572 655f 696e      structure_in
-000102f0: 7374 616e 6365 2c0a 2020 2020 2020 2020  stance,.        
-00010300: 2020 2020 7265 736f 6c75 7469 6f6e 5f64      resolution_d
-00010310: 656e 734d 6170 2c0a 2020 2020 2020 2020  ensMap,.        
-00010320: 2020 2020 6465 6e73 4d61 703d 6d61 705f      densMap=map_
-00010330: 7461 7267 6574 2c0a 2020 2020 2020 2020  target,.        
-00010340: 2020 2020 7369 676d 615f 636f 6566 663d      sigma_coeff=
-00010350: 7369 676d 615f 6d61 702c 0a20 2020 2020  sigma_map,.     
-00010360: 2020 2020 2020 206e 6f72 6d61 6c69 7365         normalise
-00010370: 3d54 7275 652c 0a20 2020 2020 2020 2029  =True,.        )
-00010380: 0a20 2020 2020 2020 2073 696d 5f6d 6170  .        sim_map
-00010390: 203d 2062 6c75 7272 6572 2e67 6175 7373   = blurrer.gauss
-000103a0: 6961 6e5f 626c 7572 280a 2020 2020 2020  ian_blur(.      
-000103b0: 2020 2020 2020 7269 6769 645f 626f 6479        rigid_body
-000103c0: 5f73 7472 7563 7475 7265 2c0a 2020 2020  _structure,.    
-000103d0: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
-000103e0: 6f6e 5f64 656e 734d 6170 2c0a 2020 2020  on_densMap,.    
-000103f0: 2020 2020 2020 2020 6465 6e73 4d61 703d          densMap=
-00010400: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
-00010410: 2020 2020 2020 2020 7369 676d 615f 636f          sigma_co
-00010420: 6566 663d 7369 676d 615f 6d61 702c 0a20  eff=sigma_map,. 
-00010430: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
-00010440: 6c69 7365 3d54 7275 652c 0a20 2020 2020  lise=True,.     
-00010450: 2020 2029 0a20 2020 2020 2020 206d 696e     ).        min
-00010460: 4465 6e73 203d 2073 696d 5f6d 6170 2e73  Dens = sim_map.s
-00010470: 7464 2829 0a20 2020 2020 2020 2073 696d  td().        sim
-00010480: 5f6d 6173 6b5f 6172 7261 7920 3d20 7369  _mask_array = si
-00010490: 6d5f 6d61 702e 5f67 6574 5f6d 6173 6b41  m_map._get_maskA
-000104a0: 7272 6179 286d 696e 4465 6e73 290a 2020  rray(minDens).  
-000104b0: 2020 2020 2020 6d61 736b 5f65 6d4d 6170        mask_emMap
-000104c0: 203d 206d 6170 5f74 6172 6765 742e 5f67   = map_target._g
-000104d0: 6574 5f6d 6173 6b4d 6170 2873 696d 5f6d  et_maskMap(sim_m
-000104e0: 6173 6b5f 6172 7261 7929 0a20 2020 2020  ask_array).     
-000104f0: 2020 206d 6173 6b5f 7369 6d4d 6170 203d     mask_simMap =
-00010500: 2077 686f 6c65 5f66 6974 5f6d 6170 2e5f   whole_fit_map._
-00010510: 6765 745f 6d61 736b 4d61 7028 7369 6d5f  get_maskMap(sim_
-00010520: 6d61 736b 5f61 7272 6179 290a 2020 2020  mask_array).    
-00010530: 2020 2020 7373 655f 6c63 6366 2c20 6f76      sse_lccf, ov
-00010540: 203d 2073 636f 7265 722e 4343 435f 6d61   = scorer.CCC_ma
-00010550: 7028 6d61 736b 5f65 6d4d 6170 2c20 6d61  p(mask_emMap, ma
-00010560: 736b 5f73 696d 4d61 702c 2063 6d6f 6465  sk_simMap, cmode
-00010570: 3d63 5f6d 6f64 6529 0a20 2020 2020 2020  =c_mode).       
-00010580: 2069 6620 7772 6974 6520 6973 2054 7275   if write is Tru
-00010590: 653a 0a20 2020 2020 2020 2020 2020 206f  e:.            o
-000105a0: 7574 6c69 6e65 202b 3d20 2753 4343 4320  utline += 'SCCC 
-000105b0: 666f 7220 7365 676d 656e 7420 2566 5c6e  for segment %f\n
-000105c0: 2720 2520 2873 7365 5f6c 6363 6629 0a20  ' % (sse_lccf). 
-000105d0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000105e0: 6e20 6f75 746c 696e 650a 2020 2020 2020  n outline.      
-000105f0: 2020 7265 7475 726e 2073 7365 5f6c 6363    return sse_lcc
-00010600: 660a 0a20 2020 2064 6566 2053 4343 435f  f..    def SCCC_
-00010610: 4c41 5028 0a20 2020 2020 2020 2020 2020  LAP(.           
-00010620: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00010630: 2020 206d 6170 5f74 6172 6765 742c 0a20     map_target,. 
-00010640: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
-00010650: 7574 696f 6e5f 6465 6e73 4d61 702c 0a20  ution_densMap,. 
-00010660: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
-00010670: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
-00010680: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
-00010690: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
-000106a0: 2020 7269 6769 645f 626f 6479 5f73 7472    rigid_body_str
-000106b0: 7563 7475 7265 2c0a 2020 2020 2020 2020  ucture,.        
-000106c0: 2020 2020 7772 6974 653d 4661 6c73 652c      write=False,
-000106d0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-000106e0: 2222 2243 616c 6375 6c61 7465 2074 6865  """Calculate the
-000106f0: 204c 6170 6c61 6369 616e 2066 696c 7465   Laplacian filte
-00010700: 7265 6420 6372 6f73 7320 636f 7272 656c  red cross correl
-00010710: 6174 696f 6e20 666f 7220 6120 7365 676d  ation for a segm
-00010720: 656e 7420 6f66 0a20 2020 2020 2020 2061  ent of.        a
-00010730: 2070 726f 7465 696e 206d 6f64 656c 2e0a   protein model..
-00010740: 0a20 2020 2020 2020 2053 6567 6d65 6e74  .        Segment
-00010750: 7320 6172 6520 6465 6669 6e65 6420 7573  s are defined us
-00010760: 696e 6720 6120 7269 6769 642d 626f 6479  ing a rigid-body
-00010770: 2073 7472 7563 7475 7265 2069 6e73 7461   structure insta
-00010780: 6e63 652c 2077 6869 6368 2063 616e 0a20  nce, which can. 
-00010790: 2020 2020 2020 2062 6520 6765 6e65 7261         be genera
-000107a0: 7465 6420 7573 696e 6720 6052 4942 4649  ted using `RIBFI
-000107b0: 4e44 203c 6874 7470 733a 2f2f 7269 6266  ND <https://ribf
-000107c0: 696e 642e 6973 6d62 2e6c 6f6e 2e61 632e  ind.ismb.lon.ac.
-000107d0: 756b 2f3e 605f 2e0a 2020 2020 2020 2020  uk/>`_..        
-000107e0: 5363 6f72 6520 6361 6c63 756c 6174 6564  Score calculated
-000107f0: 2075 7369 6e67 0a20 2020 2020 2020 203a   using.        :
-00010800: 6d65 7468 3a60 6c61 706c 6163 655f 4343  meth:`laplace_CC
-00010810: 4320 3c54 454d 5079 2e70 726f 7465 696e  C <TEMPy.protein
-00010820: 2e73 636f 7269 6e67 5f66 756e 6374 696f  .scoring_functio
-00010830: 6e73 2e53 636f 7269 6e67 4675 6e63 7469  ns.ScoringFuncti
-00010840: 6f6e 732e 6c61 706c 6163 655f 4343 433e  ons.laplace_CCC>
-00010850: 600a 0a20 2020 2020 2020 2041 7267 756d  `..        Argum
-00010860: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00010870: 2020 6d61 705f 7461 7267 6574 3a20 4d61    map_target: Ma
-00010880: 7020 496e 7374 616e 6365 2e0a 2020 2020  p Instance..    
-00010890: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
-000108a0: 6f6e 5f64 656e 734d 6170 3a20 5265 736f  on_densMap: Reso
-000108b0: 6c75 7469 6f6e 206f 6620 7468 6520 6d61  lution of the ma
-000108c0: 7020 696e 7374 616e 6365 2e0a 2020 2020  p instance..    
-000108d0: 2020 2020 2020 2020 7369 676d 615f 6d61          sigma_ma
-000108e0: 703a 2050 6172 616d 6574 6572 206e 6565  p: Parameter nee
-000108f0: 6420 666f 7220 5374 7275 6374 7572 6520  d for Structure 
-00010900: 426c 7572 7265 722e 2046 756c 6c20 6578  Blurrer. Full ex
-00010910: 706c 616e 6174 696f 6e0a 2020 2020 2020  planation.      
-00010920: 2020 2020 2020 2020 2020 3a72 6566 3a60            :ref:`
-00010930: 6865 7265 3c4e 6f74 6520 6f6e 2072 6561  here<Note on rea
-00010940: 6c20 7370 6163 6520 626c 7572 7269 6e67  l space blurring
-00010950: 3a3e 600a 2020 2020 2020 2020 2020 2020  :>`.            
-00010960: 7374 7275 6374 7572 655f 696e 7374 616e  structure_instan
-00010970: 6365 3a20 5374 7275 6374 7572 6520 696e  ce: Structure in
-00010980: 7374 616e 6365 2074 6f20 636f 6d70 6172  stance to compar
-00010990: 650a 2020 2020 2020 2020 2020 2020 7269  e.            ri
-000109a0: 6769 645f 626f 6479 5f73 7472 7563 7475  gid_body_structu
-000109b0: 7265 3a20 5269 6769 642d 626f 6479 2053  re: Rigid-body S
-000109c0: 7472 7563 7475 7265 2069 6e73 7461 6e63  tructure instanc
-000109d0: 652e 0a20 2020 2020 2020 2020 2020 2077  e..            w
-000109e0: 7269 7465 3a20 4966 2054 7275 652c 2061  rite: If True, a
-000109f0: 2073 7472 696e 6720 6973 2072 6574 7572   string is retur
-00010a00: 6e65 6420 7769 7468 2066 6f72 6d61 740a  ned with format.
-00010a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a20: 3a63 6f64 653a 6066 2753 4343 435f 4c41  :code:`f'SCCC_LA
-00010a30: 5020 666f 7220 7365 676d 656e 7420 7b53  P for segment {S
-00010a40: 4343 435f 4c41 505f 7363 6f72 657d 2760  CCC_LAP_score}'`
-00010a50: 0a20 2020 2020 2020 2052 6574 7572 6e3a  .        Return:
-00010a60: 0a20 2020 2020 2020 2020 2020 2066 6c6f  .            flo
-00010a70: 6174 2069 6620 3a63 6f64 653a 6077 7269  at if :code:`wri
-00010a80: 7465 3d46 616c 7365 602c 2065 6c73 6520  te=False`, else 
-00010a90: 7374 7269 6e67 3a0a 2020 2020 2020 2020  string:.        
-00010aa0: 2020 2020 2020 2020 5343 4343 5f4c 4150          SCCC_LAP
-00010ab0: 2073 636f 7265 0a20 2020 2020 2020 2022   score.        "
-00010ac0: 2222 0a20 2020 2020 2020 2062 6c75 7272  "".        blurr
-00010ad0: 6572 203d 2053 7472 7563 7475 7265 426c  er = StructureBl
-00010ae0: 7572 7265 7228 290a 2020 2020 2020 2020  urrer().        
-00010af0: 7363 6f72 6572 203d 2053 636f 7269 6e67  scorer = Scoring
-00010b00: 4675 6e63 7469 6f6e 7328 290a 2020 2020  Functions().    
-00010b10: 2020 2020 6f75 746c 696e 6520 3d20 2222      outline = ""
-00010b20: 0a20 2020 2020 2020 2072 6573 6f6c 7574  .        resolut
-00010b30: 696f 6e5f 6465 6e73 4d61 7020 3d20 666c  ion_densMap = fl
-00010b40: 6f61 7428 7265 736f 6c75 7469 6f6e 5f64  oat(resolution_d
-00010b50: 656e 734d 6170 290a 2020 2020 2020 2020  ensMap).        
-00010b60: 7768 6f6c 655f 6669 745f 6d61 7020 3d20  whole_fit_map = 
-00010b70: 626c 7572 7265 722e 6761 7573 7369 616e  blurrer.gaussian
-00010b80: 5f62 6c75 7228 0a20 2020 2020 2020 2020  _blur(.         
-00010b90: 2020 2073 7472 7563 7475 7265 5f69 6e73     structure_ins
-00010ba0: 7461 6e63 652c 0a20 2020 2020 2020 2020  tance,.         
-00010bb0: 2020 2072 6573 6f6c 7574 696f 6e5f 6465     resolution_de
-00010bc0: 6e73 4d61 702c 0a20 2020 2020 2020 2020  nsMap,.         
-00010bd0: 2020 2064 656e 734d 6170 3d6d 6170 5f74     densMap=map_t
-00010be0: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
-00010bf0: 2020 2073 6967 6d61 5f63 6f65 6666 3d73     sigma_coeff=s
-00010c00: 6967 6d61 5f6d 6170 2c0a 2020 2020 2020  igma_map,.      
-00010c10: 2020 2020 2020 6e6f 726d 616c 6973 653d        normalise=
-00010c20: 5472 7565 2c0a 2020 2020 2020 2020 290a  True,.        ).
-00010c30: 2020 2020 2020 2020 7369 6d5f 6d61 7020          sim_map 
-00010c40: 3d20 626c 7572 7265 722e 6761 7573 7369  = blurrer.gaussi
-00010c50: 616e 5f62 6c75 7228 0a20 2020 2020 2020  an_blur(.       
-00010c60: 2020 2020 2072 6967 6964 5f62 6f64 795f       rigid_body_
-00010c70: 7374 7275 6374 7572 652c 0a20 2020 2020  structure,.     
-00010c80: 2020 2020 2020 2072 6573 6f6c 7574 696f         resolutio
-00010c90: 6e5f 6465 6e73 4d61 702c 0a20 2020 2020  n_densMap,.     
-00010ca0: 2020 2020 2020 2064 656e 734d 6170 3d6d         densMap=m
-00010cb0: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
-00010cc0: 2020 2020 2020 2073 6967 6d61 5f63 6f65         sigma_coe
-00010cd0: 6666 3d73 6967 6d61 5f6d 6170 2c0a 2020  ff=sigma_map,.  
-00010ce0: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-00010cf0: 6973 653d 5472 7565 2c0a 2020 2020 2020  ise=True,.      
-00010d00: 2020 290a 2020 2020 2020 2020 6d69 6e44    ).        minD
-00010d10: 656e 7320 3d20 7369 6d5f 6d61 702e 7374  ens = sim_map.st
-00010d20: 6428 290a 2020 2020 2020 2020 7369 6d5f  d().        sim_
-00010d30: 6d61 736b 5f61 7272 6179 203d 2073 696d  mask_array = sim
-00010d40: 5f6d 6170 2e5f 6765 745f 6d61 736b 4172  _map._get_maskAr
-00010d50: 7261 7928 6d69 6e44 656e 7329 0a20 2020  ray(minDens).   
-00010d60: 2020 2020 206d 6173 6b5f 656d 4d61 7020       mask_emMap 
-00010d70: 3d20 6d61 705f 7461 7267 6574 2e5f 6765  = map_target._ge
-00010d80: 745f 6d61 736b 4d61 7028 7369 6d5f 6d61  t_maskMap(sim_ma
-00010d90: 736b 5f61 7272 6179 290a 2020 2020 2020  sk_array).      
-00010da0: 2020 6d61 736b 5f73 696d 4d61 7020 3d20    mask_simMap = 
-00010db0: 7768 6f6c 655f 6669 745f 6d61 702e 5f67  whole_fit_map._g
-00010dc0: 6574 5f6d 6173 6b4d 6170 2873 696d 5f6d  et_maskMap(sim_m
-00010dd0: 6173 6b5f 6172 7261 7929 0a20 2020 2020  ask_array).     
-00010de0: 2020 2073 7365 5f6c 6363 6620 3d20 7363     sse_lccf = sc
-00010df0: 6f72 6572 2e6c 6170 6c61 6365 5f43 4343  orer.laplace_CCC
-00010e00: 286d 6173 6b5f 656d 4d61 702c 206d 6173  (mask_emMap, mas
-00010e10: 6b5f 7369 6d4d 6170 290a 2020 2020 2020  k_simMap).      
-00010e20: 2020 6966 2077 7269 7465 2069 7320 5472    if write is Tr
-00010e30: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
-00010e40: 6f75 746c 696e 6520 2b3d 2027 5343 4343  outline += 'SCCC
-00010e50: 2066 6f72 2073 6567 6d65 6e74 2025 665c   for segment %f\
-00010e60: 6e27 2025 2028 7373 655f 6c63 6366 290a  n' % (sse_lccf).
-00010e70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00010e80: 726e 206f 7574 6c69 6e65 0a20 2020 2020  rn outline.     
-00010e90: 2020 2072 6574 7572 6e20 7373 655f 6c63     return sse_lc
-00010ea0: 6366 0a0a 2020 2020 6465 6620 5343 4343  cf..    def SCCC
-00010eb0: 5f4d 4928 0a20 2020 2020 2020 2020 2020  _MI(.           
-00010ec0: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-00010ed0: 2020 206d 6170 5f74 6172 6765 742c 0a20     map_target,. 
-00010ee0: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
-00010ef0: 7574 696f 6e5f 6465 6e73 4d61 702c 0a20  ution_densMap,. 
-00010f00: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
-00010f10: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
-00010f20: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
-00010f30: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
-00010f40: 2020 7269 6769 645f 626f 6479 5f73 7472    rigid_body_str
-00010f50: 7563 7475 7265 2c0a 2020 2020 2020 2020  ucture,.        
-00010f60: 2020 2020 7772 6974 653d 4661 6c73 652c      write=False,
-00010f70: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00010f80: 2222 2243 616c 6375 6c61 7465 2074 6865  """Calculate the
-00010f90: 206d 7574 7561 6c20 696e 666f 726d 6174   mutual informat
-00010fa0: 696f 6e20 7363 6f72 6520 666f 7220 6120  ion score for a 
-00010fb0: 7365 676d 656e 7420 6f66 2061 2070 726f  segment of a pro
-00010fc0: 7465 696e 0a20 2020 2020 2020 206d 6f64  tein.        mod
-00010fd0: 656c 2e0a 0a20 2020 2020 2020 2053 6567  el...        Seg
-00010fe0: 6d65 6e74 7320 6172 6520 6465 6669 6e65  ments are define
-00010ff0: 6420 7573 696e 6720 6120 7269 6769 642d  d using a rigid-
-00011000: 626f 6479 2073 7472 7563 7475 7265 2069  body structure i
-00011010: 6e73 7461 6e63 652c 2077 6869 6368 2063  nstance, which c
-00011020: 616e 0a20 2020 2020 2020 2062 6520 6765  an.        be ge
-00011030: 6e65 7261 7465 6420 7573 696e 6720 6052  nerated using `R
-00011040: 4942 4649 4e44 203c 6874 7470 733a 2f2f  IBFIND <https://
-00011050: 7269 6266 696e 642e 6973 6d62 2e6c 6f6e  ribfind.ismb.lon
-00011060: 2e61 632e 756b 2f3e 605f 2e0a 2020 2020  .ac.uk/>`_..    
-00011070: 2020 2020 5468 6520 7363 6f72 6520 666f      The score fo
-00011080: 7220 7468 6520 7365 676d 656e 7420 6973  r the segment is
-00011090: 2063 616c 6375 6c61 7465 6420 7573 696e   calculated usin
-000110a0: 670a 2020 2020 2020 2020 3a6d 6574 683a  g.        :meth:
-000110b0: 604d 4920 3c54 454d 5079 2e70 726f 7465  `MI <TEMPy.prote
-000110c0: 696e 2e73 636f 7269 6e67 5f66 756e 6374  in.scoring_funct
-000110d0: 696f 6e73 2e53 636f 7269 6e67 4675 6e63  ions.ScoringFunc
-000110e0: 7469 6f6e 732e 4d49 3e60 0a0a 2020 2020  tions.MI>`..    
-000110f0: 2020 2020 4172 6775 6d65 6e74 733a 0a20      Arguments:. 
-00011100: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-00011110: 6172 6765 743a 204d 6170 2049 6e73 7461  arget: Map Insta
-00011120: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-00011130: 2072 6573 6f6c 7574 696f 6e5f 6465 6e73   resolution_dens
-00011140: 4d61 703a 2052 6573 6f6c 7574 696f 6e20  Map: Resolution 
-00011150: 6f66 2074 6865 206d 6170 2069 6e73 7461  of the map insta
-00011160: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
-00011170: 2073 6967 6d61 5f6d 6170 3a20 5061 7261   sigma_map: Para
-00011180: 6d65 7465 7220 6e65 6564 2066 6f72 2053  meter need for S
-00011190: 7472 7563 7475 7265 2042 6c75 7272 6572  tructure Blurrer
-000111a0: 2e20 4675 6c6c 2065 7870 6c61 6e61 7469  . Full explanati
-000111b0: 6f6e 0a20 2020 2020 2020 2020 2020 2020  on.             
-000111c0: 2020 203a 7265 663a 6068 6572 653c 4e6f     :ref:`here<No
-000111d0: 7465 206f 6e20 7265 616c 2073 7061 6365  te on real space
-000111e0: 2062 6c75 7272 696e 673a 3e60 0a20 2020   blurring:>`.   
-000111f0: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-00011200: 7265 5f69 6e73 7461 6e63 653a 2053 7472  re_instance: Str
-00011210: 7563 7475 7265 2069 6e73 7461 6e63 6520  ucture instance 
-00011220: 746f 2063 6f6d 7061 7265 0a20 2020 2020  to compare.     
-00011230: 2020 2020 2020 2072 6967 6964 5f62 6f64         rigid_bod
-00011240: 795f 7374 7275 6374 7572 653a 2052 6967  y_structure: Rig
-00011250: 6964 2d62 6f64 7920 5374 7275 6374 7572  id-body Structur
-00011260: 6520 696e 7374 616e 6365 2e0a 2020 2020  e instance..    
-00011270: 2020 2020 2020 2020 7772 6974 653a 2049          write: I
-00011280: 6620 5472 7565 2c20 6120 7374 7269 6e67  f True, a string
-00011290: 2069 7320 7265 7475 726e 6564 2077 6974   is returned wit
-000112a0: 6820 666f 726d 6174 0a20 2020 2020 2020  h format.       
-000112b0: 2020 2020 2020 2020 203a 636f 6465 3a60           :code:`
-000112c0: 6627 5343 4343 5f4c 4150 2066 6f72 2073  f'SCCC_LAP for s
-000112d0: 6567 6d65 6e74 207b 5343 4343 5f4c 4150  egment {SCCC_LAP
-000112e0: 5f73 636f 7265 7d27 600a 2020 2020 2020  _score}'`.      
-000112f0: 2020 5265 7475 726e 3a0a 2020 2020 2020    Return:.      
-00011300: 2020 2020 2020 666c 6f61 7420 6966 203a        float if :
-00011310: 636f 6465 3a60 7772 6974 653d 4661 6c73  code:`write=Fals
-00011320: 6560 2c20 656c 7365 2073 7472 696e 673a  e`, else string:
-00011330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011340: 2053 4343 435f 4d49 2073 636f 7265 0a20   SCCC_MI score. 
-00011350: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00011360: 2020 2062 6c75 7272 6572 203d 2053 7472     blurrer = Str
-00011370: 7563 7475 7265 426c 7572 7265 7228 290a  uctureBlurrer().
-00011380: 2020 2020 2020 2020 7363 6f72 6572 203d          scorer =
-00011390: 2053 636f 7269 6e67 4675 6e63 7469 6f6e   ScoringFunction
-000113a0: 7328 290a 2020 2020 2020 2020 6f75 746c  s().        outl
-000113b0: 696e 6520 3d20 2222 0a20 2020 2020 2020  ine = "".       
-000113c0: 2072 6573 6f6c 7574 696f 6e5f 6465 6e73   resolution_dens
-000113d0: 4d61 7020 3d20 666c 6f61 7428 7265 736f  Map = float(reso
-000113e0: 6c75 7469 6f6e 5f64 656e 734d 6170 290a  lution_densMap).
-000113f0: 2020 2020 2020 2020 7768 6f6c 655f 6669          whole_fi
-00011400: 745f 6d61 7020 3d20 626c 7572 7265 722e  t_map = blurrer.
-00011410: 6761 7573 7369 616e 5f62 6c75 7228 0a20  gaussian_blur(. 
-00011420: 2020 2020 2020 2020 2020 2073 7472 7563             struc
-00011430: 7475 7265 5f69 6e73 7461 6e63 652c 0a20  ture_instance,. 
-00011440: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
-00011450: 7574 696f 6e5f 6465 6e73 4d61 702c 0a20  ution_densMap,. 
-00011460: 2020 2020 2020 2020 2020 2064 656e 734d             densM
-00011470: 6170 3d6d 6170 5f74 6172 6765 742c 0a20  ap=map_target,. 
-00011480: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
-00011490: 5f63 6f65 6666 3d73 6967 6d61 5f6d 6170  _coeff=sigma_map
-000114a0: 2c0a 2020 2020 2020 2020 2020 2020 6e6f  ,.            no
-000114b0: 726d 616c 6973 653d 5472 7565 0a20 2020  rmalise=True.   
-000114c0: 2020 2020 2029 0a20 2020 2020 2020 2073       ).        s
-000114d0: 696d 5f6d 6170 203d 2062 6c75 7272 6572  im_map = blurrer
-000114e0: 2e67 6175 7373 6961 6e5f 626c 7572 280a  .gaussian_blur(.
-000114f0: 2020 2020 2020 2020 2020 2020 7269 6769              rigi
-00011500: 645f 626f 6479 5f73 7472 7563 7475 7265  d_body_structure
-00011510: 2c0a 2020 2020 2020 2020 2020 2020 7265  ,.            re
-00011520: 736f 6c75 7469 6f6e 5f64 656e 734d 6170  solution_densMap
-00011530: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
-00011540: 6e73 4d61 703d 6d61 705f 7461 7267 6574  nsMap=map_target
-00011550: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00011560: 676d 615f 636f 6566 663d 7369 676d 615f  gma_coeff=sigma_
-00011570: 6d61 702c 0a20 2020 2020 2020 2020 2020  map,.           
-00011580: 206e 6f72 6d61 6c69 7365 3d54 7275 650a   normalise=True.
-00011590: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000115a0: 2020 6d69 6e44 656e 7320 3d20 7369 6d5f    minDens = sim_
-000115b0: 6d61 702e 7374 6428 290a 2020 2020 2020  map.std().      
-000115c0: 2020 7369 6d5f 6d61 736b 5f61 7272 6179    sim_mask_array
-000115d0: 203d 2073 696d 5f6d 6170 2e5f 6765 745f   = sim_map._get_
-000115e0: 6d61 736b 4172 7261 7928 6d69 6e44 656e  maskArray(minDen
-000115f0: 7329 0a20 2020 2020 2020 206d 6173 6b5f  s).        mask_
-00011600: 656d 4d61 7020 3d20 6d61 705f 7461 7267  emMap = map_targ
-00011610: 6574 2e5f 6765 745f 6d61 736b 4d61 7028  et._get_maskMap(
-00011620: 7369 6d5f 6d61 736b 5f61 7272 6179 290a  sim_mask_array).
-00011630: 2020 2020 2020 2020 6d61 736b 5f73 696d          mask_sim
-00011640: 4d61 7020 3d20 7768 6f6c 655f 6669 745f  Map = whole_fit_
-00011650: 6d61 702e 5f67 6574 5f6d 6173 6b4d 6170  map._get_maskMap
-00011660: 2873 696d 5f6d 6173 6b5f 6172 7261 7929  (sim_mask_array)
-00011670: 0a20 2020 2020 2020 2073 7365 5f6c 6363  .        sse_lcc
-00011680: 6620 3d20 7363 6f72 6572 2e4d 4928 6d61  f = scorer.MI(ma
-00011690: 736b 5f65 6d4d 6170 2c20 6d61 736b 5f73  sk_emMap, mask_s
-000116a0: 696d 4d61 7029 0a20 2020 2020 2020 2069  imMap).        i
-000116b0: 6620 7772 6974 6520 6973 2054 7275 653a  f write is True:
-000116c0: 0a20 2020 2020 2020 2020 2020 206f 7574  .            out
-000116d0: 6c69 6e65 202b 3d20 2753 4343 4320 666f  line += 'SCCC fo
-000116e0: 7220 7365 676d 656e 7420 2566 5c6e 2720  r segment %f\n' 
-000116f0: 2520 2873 7365 5f6c 6363 6629 0a20 2020  % (sse_lccf).   
-00011700: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00011710: 6f75 746c 696e 650a 2020 2020 2020 2020  outline.        
-00011720: 7265 7475 726e 2073 7365 5f6c 6363 660a  return sse_lccf.
-00011730: 0a20 2020 2064 6566 2067 6574 5f73 6363  .    def get_scc
-00011740: 6328 0a20 2020 2020 2020 2020 2020 2073  c(.            s
-00011750: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00011760: 206d 6170 5f74 6172 6765 742c 0a20 2020   map_target,.   
-00011770: 2020 2020 2020 2020 2073 7472 7563 7475           structu
-00011780: 7265 5f69 6e73 7461 6e63 652c 0a20 2020  re_instance,.   
-00011790: 2020 2020 2020 2020 2072 6967 6964 5f62           rigid_b
-000117a0: 6f64 795f 6669 6c65 2c0a 2020 2020 2020  ody_file,.      
-000117b0: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
-000117c0: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-000117d0: 676d 615f 6d61 703d 302e 3138 370a 2020  gma_map=0.187.  
-000117e0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-000117f0: 5265 6164 2072 6967 6964 2062 6f64 7920  Read rigid body 
-00011800: 6669 6c65 2061 6e64 2063 616c 6375 6c61  file and calcula
-00011810: 7465 2073 6363 6320 7363 6f72 6573 2066  te sccc scores f
-00011820: 6f72 2065 6163 6820 7269 6769 6420 626f  or each rigid bo
-00011830: 6479 0a0a 2020 2020 2020 2020 4172 6773  dy..        Args
-00011840: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
-00011850: 705f 7461 7267 6574 3a20 4d61 7020 696e  p_target: Map in
-00011860: 7374 616e 6365 0a20 2020 2020 2020 2020  stance.         
-00011870: 2020 2073 7472 7563 7475 7265 5f69 6e73     structure_ins
-00011880: 7461 6e63 653a 204d 6f64 656c 2073 7472  tance: Model str
-00011890: 7563 7475 7265 2069 6e73 7461 6e63 650a  ucture instance.
-000118a0: 2020 2020 2020 2020 2020 2020 7269 6769              rigi
-000118b0: 645f 626f 6479 5f66 696c 653a 2050 6174  d_body_file: Pat
-000118c0: 6820 746f 2072 6967 6964 2062 6f64 7920  h to rigid body 
-000118d0: 6669 6c65 0a20 2020 2020 2020 2020 2020  file.           
-000118e0: 2072 6573 6f6c 7574 696f 6e3a 2052 6573   resolution: Res
-000118f0: 6f6c 7574 696f 6e20 6f66 206d 6170 2069  olution of map i
-00011900: 6e73 7461 6e63 650a 2020 2020 2020 2020  nstance.        
-00011910: 2020 2020 7369 676d 615f 6d61 703a 2050      sigma_map: P
-00011920: 6172 616d 6574 6572 206e 6565 6420 666f  arameter need fo
-00011930: 7220 5374 7275 6374 7572 6520 426c 7572  r Structure Blur
-00011940: 7265 722e 2046 756c 6c20 6578 706c 616e  rer. Full explan
-00011950: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
-00011960: 2020 2020 2020 3a72 6566 3a60 6865 7265        :ref:`here
-00011970: 3c4e 6f74 6520 6f6e 2072 6561 6c20 7370  <Note on real sp
-00011980: 6163 6520 626c 7572 7269 6e67 3a3e 600a  ace blurring:>`.
-00011990: 0a20 2020 2020 2020 2052 6574 7572 6e73  .        Returns
-000119a0: 3a0a 2020 2020 2020 2020 2020 2020 5477  :.            Tw
-000119b0: 6f20 6469 6374 696f 6e61 7269 6573 3b20  o dictionaries; 
-000119c0: 6469 6374 5f63 6861 696e 5f73 636f 7265  dict_chain_score
-000119d0: 732c 2064 6963 745f 7269 6769 645f 7363  s, dict_rigid_sc
-000119e0: 6f72 6573 0a20 2020 2020 2020 2020 2020  ores.           
-000119f0: 2020 2020 202a 2064 6963 745f 6368 6169       * dict_chai
-00011a00: 6e5f 7363 6f72 6573 2069 7320 6120 6469  n_scores is a di
-00011a10: 6374 696f 6e61 7279 2077 6974 6820 6b65  ctionary with ke
-00011a20: 7973 2065 7175 616c 2074 6f20 6368 6169  ys equal to chai
-00011a30: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-00011a40: 2020 2020 6c61 6265 6c73 2028 652e 672e      labels (e.g.
-00011a50: 203a 636f 6465 3a60 5b27 4127 2c20 2742   :code:`['A', 'B
-00011a60: 272c 2027 4327 5d60 292e 2045 6163 6820  ', 'C']`). Each 
-00011a70: 7661 6c75 6520 6973 2061 6e6f 7468 6572  value is another
-00011a80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011a90: 2020 2064 6963 7469 6f6e 6172 792c 2077     dictionary, w
-00011aa0: 6974 6820 6b65 7973 2061 7320 7265 7369  ith keys as resi
-00011ab0: 6475 6520 6e75 6d62 6572 2066 6f72 2065  due number for e
-00011ac0: 6163 6820 7265 7369 6475 6520 696e 2061  ach residue in a
-00011ad0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011ae0: 2020 2072 6967 6964 2062 6f64 792c 2061     rigid body, a
-00011af0: 6e64 2076 616c 7565 7320 7468 6520 4343  nd values the CC
-00011b00: 4320 7363 6f72 6520 666f 7220 7468 6174  C score for that
-00011b10: 2072 6573 6964 7565 2e0a 0a20 2020 2020   residue...     
-00011b20: 2020 2020 2020 2020 2020 202a 2064 6963             * dic
-00011b30: 745f 7269 6769 645f 7363 6f72 6573 2069  t_rigid_scores i
-00011b40: 7320 6120 6469 6374 696f 6e61 7279 2077  s a dictionary w
-00011b50: 6974 6820 6b65 7973 2065 7175 616c 2074  ith keys equal t
-00011b60: 6f20 6561 6368 0a20 2020 2020 2020 2020  o each.         
-00011b70: 2020 2020 2020 2020 2072 6967 6964 2062           rigid b
-00011b80: 6f64 7920 2873 7472 696e 673f 3f20 6e6f  ody (string?? no
-00011b90: 7420 7375 7265 2920 616e 6420 7661 6c75  t sure) and valu
-00011ba0: 6573 2074 6865 2043 4343 2073 636f 7265  es the CCC score
-00011bb0: 2066 6f72 0a20 2020 2020 2020 2020 2020   for.           
-00011bc0: 2020 2020 2020 2074 6861 7420 626f 6479         that body
-00011bd0: 2e0a 0a20 2020 2020 2020 2022 2222 0a20  ...        """. 
-00011be0: 2020 2020 2020 2064 6963 745f 7262 6620         dict_rbf 
-00011bf0: 3d20 5242 5061 7273 6572 2e67 6574 5f72  = RBParser.get_r
-00011c00: 6967 6964 5f62 6f64 795f 7374 725f 696e  igid_body_str_in
-00011c10: 7374 616e 6365 7328 0a20 2020 2020 2020  stances(.       
-00011c20: 2020 2020 2072 6967 6964 5f62 6f64 795f       rigid_body_
-00011c30: 6669 6c65 2c0a 2020 2020 2020 2020 2020  file,.          
-00011c40: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
-00011c50: 616e 6365 2c0a 2020 2020 2020 2020 290a  ance,.        ).
-00011c60: 2020 2020 2020 2020 6469 6374 5f63 6861          dict_cha
-00011c70: 696e 5f64 6574 6169 6c73 203d 2073 7472  in_details = str
-00011c80: 7563 7475 7265 5f69 6e73 7461 6e63 652e  ucture_instance.
-00011c90: 6765 745f 6469 6374 5f73 7472 2829 0a20  get_dict_str(). 
-00011ca0: 2020 2020 2020 2064 6963 745f 6368 6169         dict_chai
-00011cb0: 6e5f 7363 6f72 6573 203d 207b 7d0a 2020  n_scores = {}.  
-00011cc0: 2020 2020 2020 6469 6374 5f72 6967 6964        dict_rigid
-00011cd0: 5f73 636f 7265 7320 3d20 7b7d 0a20 2020  _scores = {}.   
-00011ce0: 2020 2020 206d 696e 7363 6f72 6520 3d20       minscore = 
-00011cf0: 312e 300a 2020 2020 2020 2020 6d61 7873  1.0.        maxs
-00011d00: 636f 7265 203d 202d 312e 300a 2020 2020  core = -1.0.    
-00011d10: 2020 2020 666f 7220 6368 2069 6e20 6469      for ch in di
-00011d20: 6374 5f63 6861 696e 5f64 6574 6169 6c73  ct_chain_details
-00011d30: 3a0a 2020 2020 2020 2020 2020 2020 6469  :.            di
-00011d40: 6374 5f72 6573 5f73 636f 7265 7320 3d20  ct_res_scores = 
-00011d50: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
-00011d60: 6f72 2072 6573 2069 6e20 6469 6374 5f63  or res in dict_c
-00011d70: 6861 696e 5f64 6574 6169 6c73 5b63 685d  hain_details[ch]
-00011d80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00011d90: 2020 6469 6374 5f72 6573 5f73 636f 7265    dict_res_score
-00011da0: 735b 7265 735d 203d 202d 322e 300a 2020  s[res] = -2.0.  
-00011db0: 2020 2020 2020 2020 2020 6966 2063 6820            if ch 
-00011dc0: 6e6f 7420 696e 2064 6963 745f 7262 663a  not in dict_rbf:
-00011dd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011de0: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
-00011df0: 2020 2020 2020 666f 7220 7262 2069 6e20        for rb in 
-00011e00: 6469 6374 5f72 6266 5b63 685d 3a0a 2020  dict_rbf[ch]:.  
-00011e10: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00011e20: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
-00011e30: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00011e40: 7365 6720 696e 2064 6963 745f 7262 665b  seg in dict_rbf[
-00011e50: 6368 5d5b 7262 5d5b 305d 3a0a 2020 2020  ch][rb][0]:.    
-00011e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011e70: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00011e80: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00011e90: 2072 2069 6e20 7261 6e67 6528 696e 7428   r in range(int(
-00011ea0: 7365 675b 305d 292c 2069 6e74 2873 6567  seg[0]), int(seg
-00011eb0: 5b31 5d29 202b 2031 293a 0a20 2020 2020  [1]) + 1):.     
-00011ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ed0: 2020 2020 2020 2072 6573 5f6c 6973 742e         res_list.
-00011ee0: 6170 7065 6e64 2872 290a 2020 2020 2020  append(r).      
-00011ef0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00011f00: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
-00011f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011f20: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-00011f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011f40: 2073 636f 7265 5f53 4343 4320 3d20 7365   score_SCCC = se
-00011f50: 6c66 2e53 4343 4328 0a20 2020 2020 2020  lf.SCCC(.       
-00011f60: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00011f70: 5f74 6172 6765 742c 0a20 2020 2020 2020  _target,.       
-00011f80: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00011f90: 6f6c 7574 696f 6e2c 0a20 2020 2020 2020  olution,.       
-00011fa0: 2020 2020 2020 2020 2020 2020 2073 6967               sig
-00011fb0: 6d61 5f6d 6170 2c0a 2020 2020 2020 2020  ma_map,.        
-00011fc0: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-00011fd0: 6374 7572 655f 696e 7374 616e 6365 2c0a  cture_instance,.
-00011fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ff0: 2020 2020 6469 6374 5f72 6266 5b63 685d      dict_rbf[ch]
-00012000: 5b72 625d 5b31 5d0a 2020 2020 2020 2020  [rb][1].        
-00012010: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00012020: 2020 2020 2020 2020 2020 6966 2072 6220            if rb 
-00012030: 6e6f 7420 696e 2064 6963 745f 7269 6769  not in dict_rigi
-00012040: 645f 7363 6f72 6573 3a0a 2020 2020 2020  d_scores:.      
-00012050: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00012060: 6374 5f72 6967 6964 5f73 636f 7265 735b  ct_rigid_scores[
-00012070: 7262 5d20 3d20 7363 6f72 655f 5343 4343  rb] = score_SCCC
-00012080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012090: 2020 2020 2069 6620 7363 6f72 655f 5343       if score_SC
-000120a0: 4343 203c 206d 696e 7363 6f72 653a 0a20  CC < minscore:. 
-000120b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120c0: 2020 2020 2020 206d 696e 7363 6f72 6520         minscore 
-000120d0: 3d20 7363 6f72 655f 5343 4343 0a20 2020  = score_SCCC.   
-000120e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000120f0: 2069 6620 7363 6f72 655f 5343 4343 203e   if score_SCCC >
-00012100: 206d 6178 7363 6f72 653a 0a20 2020 2020   maxscore:.     
-00012110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012120: 2020 206d 6178 7363 6f72 6520 3d20 7363     maxscore = sc
-00012130: 6f72 655f 5343 4343 0a20 2020 2020 2020  ore_SCCC.       
-00012140: 2020 2020 2020 2020 2066 6f72 2072 6573           for res
-00012150: 2069 6e20 7265 735f 6c69 7374 3a0a 2020   in res_list:.  
-00012160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012170: 2020 6469 6374 5f72 6573 5f73 636f 7265    dict_res_score
-00012180: 735b 7265 735d 203d 2073 636f 7265 5f53  s[res] = score_S
-00012190: 4343 430a 0a20 2020 2020 2020 2020 2020  CCC..           
-000121a0: 2064 6963 745f 6368 6169 6e5f 7363 6f72   dict_chain_scor
-000121b0: 6573 5b63 685d 203d 2064 6963 745f 7265  es[ch] = dict_re
-000121c0: 735f 7363 6f72 6573 0a0a 2020 2020 2020  s_scores..      
-000121d0: 2020 6d69 6e73 636f 7265 203d 206d 6178    minscore = max
-000121e0: 286d 696e 7363 6f72 6520 2d20 286d 6178  (minscore - (max
-000121f0: 7363 6f72 6520 2d20 6d69 6e73 636f 7265  score - minscore
-00012200: 2920 2f20 352e 2c20 2d31 2e30 290a 2020  ) / 5., -1.0).  
-00012210: 2020 2020 2020 666f 7220 6368 2069 6e20        for ch in 
-00012220: 6469 6374 5f63 6861 696e 5f73 636f 7265  dict_chain_score
-00012230: 733a 0a20 2020 2020 2020 2020 2020 2066  s:.            f
-00012240: 6f72 2072 6573 2069 6e20 6469 6374 5f63  or res in dict_c
-00012250: 6861 696e 5f73 636f 7265 735b 6368 5d3a  hain_scores[ch]:
-00012260: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012270: 2069 6620 6469 6374 5f63 6861 696e 5f73   if dict_chain_s
-00012280: 636f 7265 735b 6368 5d5b 7265 735d 203d  cores[ch][res] =
-00012290: 3d20 2d32 2e30 3a0a 2020 2020 2020 2020  = -2.0:.        
-000122a0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-000122b0: 5f63 6861 696e 5f73 636f 7265 735b 6368  _chain_scores[ch
-000122c0: 5d5b 7265 735d 203d 206d 696e 7363 6f72  ][res] = minscor
-000122d0: 650a 0a20 2020 2020 2020 2072 6574 7572  e..        retur
-000122e0: 6e20 6469 6374 5f63 6861 696e 5f73 636f  n dict_chain_sco
-000122f0: 7265 732c 2064 6963 745f 7269 6769 645f  res, dict_rigid_
-00012300: 7363 6f72 6573 0a0a 2020 2020 6465 6620  scores..    def 
-00012310: 6361 6c63 5f6d 6f63 280a 2020 2020 2020  calc_moc(.      
-00012320: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00012330: 2020 2020 2020 2020 696e 6469 6365 732c          indices,
-00012340: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00012350: 5f70 726f 6265 2c0a 2020 2020 2020 2020  _probe,.        
-00012360: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
-00012370: 2020 2020 293a 0a20 2020 2020 2020 206d      ):.        m
-00012380: 6170 5f74 6172 6765 745f 6d61 736b 203d  ap_target_mask =
-00012390: 206d 6170 5f74 6172 6765 742e 6675 6c6c   map_target.full
-000123a0: 4d61 705b 696e 6469 6365 735d 0a20 2020  Map[indices].   
-000123b0: 2020 2020 206d 6170 5f70 726f 6265 5f6d       map_probe_m
-000123c0: 6173 6b20 3d20 6d61 705f 7072 6f62 652e  ask = map_probe.
-000123d0: 6675 6c6c 4d61 705b 696e 6469 6365 735d  fullMap[indices]
-000123e0: 0a20 2020 2020 2020 206e 756d 203d 206e  .        num = n
-000123f0: 702e 7375 6d28 6d61 705f 7461 7267 6574  p.sum(map_target
-00012400: 5f6d 6173 6b20 2a20 6d61 705f 7072 6f62  _mask * map_prob
-00012410: 655f 6d61 736b 290a 2020 2020 2020 2020  e_mask).        
-00012420: 6465 6e20 3d20 6e70 2e73 7172 7428 0a20  den = np.sqrt(. 
-00012430: 2020 2020 2020 2020 2020 206e 702e 7375             np.su
-00012440: 6d28 6e70 2e73 7175 6172 6528 6d61 705f  m(np.square(map_
-00012450: 7461 7267 6574 5f6d 6173 6b29 2920 2a0a  target_mask)) *.
-00012460: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
-00012470: 756d 286e 702e 7371 7561 7265 286d 6170  um(np.square(map
-00012480: 5f70 726f 6265 5f6d 6173 6b29 290a 2020  _probe_mask)).  
-00012490: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000124a0: 6966 2064 656e 203d 3d20 302e 303a 0a20  if den == 0.0:. 
-000124b0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-000124c0: 6e20 2d31 2e30 0a20 2020 2020 2020 2072  n -1.0.        r
-000124d0: 6574 7572 6e20 6e75 6d20 2f20 6465 6e0a  eturn num / den.
-000124e0: 0a20 2020 2064 6566 2063 616c 635f 6363  .    def calc_cc
-000124f0: 6328 0a20 2020 2020 2020 2020 2020 2073  c(.            s
-00012500: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-00012510: 2069 6e64 6963 6573 2c0a 2020 2020 2020   indices,.      
-00012520: 2020 2020 2020 6d61 705f 7072 6f62 652c        map_probe,
-00012530: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00012540: 5f74 6172 6765 740a 2020 2020 293a 0a20  _target.    ):. 
-00012550: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
-00012560: 745f 6d61 736b 203d 206d 6170 5f74 6172  t_mask = map_tar
-00012570: 6765 742e 6675 6c6c 4d61 705b 696e 6469  get.fullMap[indi
-00012580: 6365 735d 0a20 2020 2020 2020 206d 6170  ces].        map
-00012590: 5f74 6172 6765 745f 6d61 736b 203d 206d  _target_mask = m
-000125a0: 6170 5f74 6172 6765 745f 6d61 736b 202d  ap_target_mask -
-000125b0: 2066 6c6f 6174 280a 2020 2020 2020 2020   float(.        
-000125c0: 2020 2020 6d61 705f 7461 7267 6574 5f6d      map_target_m
-000125d0: 6173 6b2e 7375 6d28 292f 6c65 6e28 6d61  ask.sum()/len(ma
-000125e0: 705f 7461 7267 6574 5f6d 6173 6b29 0a20  p_target_mask). 
-000125f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00012600: 206d 6170 5f70 726f 6265 5f6d 6173 6b20   map_probe_mask 
-00012610: 3d20 6d61 705f 7072 6f62 652e 6675 6c6c  = map_probe.full
-00012620: 4d61 705b 696e 6469 6365 735d 0a20 2020  Map[indices].   
-00012630: 2020 2020 206d 6170 5f70 726f 6265 5f6d       map_probe_m
-00012640: 6173 6b20 3d20 6d61 705f 7072 6f62 655f  ask = map_probe_
-00012650: 6d61 736b 202d 2066 6c6f 6174 280a 2020  mask - float(.  
-00012660: 2020 2020 2020 2020 2020 6d61 705f 7072            map_pr
-00012670: 6f62 655f 6d61 736b 2e73 756d 2829 2f6c  obe_mask.sum()/l
-00012680: 656e 286d 6170 5f70 726f 6265 5f6d 6173  en(map_probe_mas
-00012690: 6b29 0a20 2020 2020 2020 2029 0a20 2020  k).        ).   
-000126a0: 2020 2020 206e 756d 203d 206e 702e 7375       num = np.su
-000126b0: 6d28 6d61 705f 7461 7267 6574 5f6d 6173  m(map_target_mas
-000126c0: 6b20 2a20 6d61 705f 7072 6f62 655f 6d61  k * map_probe_ma
-000126d0: 736b 290a 2020 2020 2020 2020 6465 6e20  sk).        den 
-000126e0: 3d20 6e70 2e73 7172 7428 0a20 2020 2020  = np.sqrt(.     
-000126f0: 2020 2020 2020 206e 702e 7375 6d28 6e70         np.sum(np
-00012700: 2e73 7175 6172 6528 6d61 705f 7461 7267  .square(map_targ
-00012710: 6574 5f6d 6173 6b29 2920 2a0a 2020 2020  et_mask)) *.    
-00012720: 2020 2020 2020 2020 6e70 2e73 756d 286e          np.sum(n
-00012730: 702e 7371 7561 7265 286d 6170 5f70 726f  p.square(map_pro
-00012740: 6265 5f6d 6173 6b29 290a 2020 2020 2020  be_mask)).      
-00012750: 2020 290a 2020 2020 2020 2020 6966 2064    ).        if d
-00012760: 656e 203d 3d20 302e 303a 0a20 2020 2020  en == 0.0:.     
-00012770: 2020 2020 2020 2072 6574 7572 6e20 2d31         return -1
-00012780: 2e30 0a20 2020 2020 2020 2072 6574 7572  .0.        retur
-00012790: 6e20 6e75 6d20 2f20 6465 6e0a 0a20 2020  n num / den..   
-000127a0: 2064 6566 2069 6e64 6963 6573 5f73 6d6f   def indices_smo
-000127b0: 6328 0a20 2020 2020 2020 2020 2020 2073  c(.            s
-000127c0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
-000127d0: 2073 636f 7265 5f69 6e64 6963 6573 2c0a   score_indices,.
-000127e0: 2020 2020 2020 2020 2020 2020 6772 6964              grid
-000127f0: 5f69 6e64 6963 6573 0a20 2020 2029 3a0a  _indices.    ):.
-00012800: 2020 2020 2020 2020 746d 706c 6973 7420          tmplist 
-00012810: 3d20 7363 6f72 655f 696e 6469 6365 735b  = score_indices[
-00012820: 3a5d 0a20 2020 2020 2020 2073 6574 6c69  :].        setli
-00012830: 7374 203d 2073 6574 2874 6d70 6c69 7374  st = set(tmplist
-00012840: 290a 2020 2020 2020 2020 696e 6469 6365  ).        indice
-00012850: 7320 3d20 6c69 7374 2873 6574 6c69 7374  s = list(setlist
-00012860: 290a 2020 2020 2020 2020 7363 5f69 6e64  ).        sc_ind
-00012870: 6963 6573 203d 205b 5d0a 2020 2020 2020  ices = [].      
-00012880: 2020 666f 7220 6969 2069 6e20 696e 6469    for ii in indi
-00012890: 6365 733a 0a20 2020 2020 2020 2020 2020  ces:.           
-000128a0: 2073 635f 696e 6469 6365 732e 6170 7065   sc_indices.appe
-000128b0: 6e64 2867 7269 645f 696e 6469 6365 735b  nd(grid_indices[
-000128c0: 6969 5d29 0a20 2020 2020 2020 2061 7272  ii]).        arr
-000128d0: 6179 5f69 6e64 6963 6573 203d 206e 702e  ay_indices = np.
-000128e0: 6172 7261 7928 7363 5f69 6e64 6963 6573  array(sc_indices
-000128f0: 290a 2020 2020 2020 2020 696e 645f 6172  ).        ind_ar
-00012900: 7278 797a 203d 206e 702e 7472 616e 7370  rxyz = np.transp
-00012910: 6f73 6528 6172 7261 795f 696e 6469 6365  ose(array_indice
-00012920: 7329 0a20 2020 2020 2020 2069 6e64 5f61  s).        ind_a
-00012930: 7272 7a79 7820 3d20 2869 6e64 5f61 7272  rrzyx = (ind_arr
-00012940: 7879 7a5b 325d 2c20 696e 645f 6172 7278  xyz[2], ind_arrx
-00012950: 797a 5b31 5d2c 2069 6e64 5f61 7272 7879  yz[1], ind_arrxy
-00012960: 7a5b 305d 290a 2020 2020 2020 2020 7265  z[0]).        re
-00012970: 7475 726e 2069 6e64 5f61 7272 7a79 780a  turn ind_arrzyx.
-00012980: 0a20 2020 2064 6566 2073 6574 5f73 636f  .    def set_sco
-00012990: 7265 5f61 735f 6266 6163 746f 7228 0a20  re_as_bfactor(. 
-000129a0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-000129b0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-000129c0: 7563 7475 7265 5f69 6e73 7461 6e63 652c  ucture_instance,
-000129d0: 0a20 2020 2020 2020 2020 2020 2064 6963  .            dic
-000129e0: 745f 7363 6f72 6573 2c0a 2020 2020 2020  t_scores,.      
-000129f0: 2020 2020 2020 6465 6661 756c 743d 302e        default=0.
-00012a00: 302c 0a20 2020 2020 2020 2020 2020 2063  0,.            c
-00012a10: 6869 643d 4e6f 6e65 2c0a 2020 2020 2020  hid=None,.      
-00012a20: 2020 2020 2020 6f75 7466 696c 653d 2773        outfile='s
-00012a30: 636f 7265 2e70 6462 272c 0a20 2020 2029  core.pdb',.    )
-00012a40: 3a0a 2020 2020 2020 2020 2320 696e 636c  :.        # incl
-00012a50: 7564 6520 7363 6f72 6573 2061 7320 622d  ude scores as b-
-00012a60: 6661 6374 6f72 2072 6563 6f72 6473 0a20  factor records. 
-00012a70: 2020 2020 2020 2066 6f72 2078 2069 6e20         for x in 
-00012a80: 7374 7275 6374 7572 655f 696e 7374 616e  structure_instan
-00012a90: 6365 2e61 746f 6d4c 6973 743a 0a20 2020  ce.atomList:.   
-00012aa0: 2020 2020 2020 2020 2063 7572 5f63 6861           cur_cha
-00012ab0: 696e 203d 2078 2e63 6861 696e 0a20 2020  in = x.chain.   
-00012ac0: 2020 2020 2020 2020 2063 7572 5f72 6573           cur_res
-00012ad0: 203d 2078 2e67 6574 5f72 6573 5f6e 6f28   = x.get_res_no(
-00012ae0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-00012af0: 2063 7572 5f63 6861 696e 2069 6e20 6469   cur_chain in di
-00012b00: 6374 5f73 636f 7265 733a 0a20 2020 2020  ct_scores:.     
-00012b10: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00012b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012b30: 2020 2020 782e 7465 6d70 5f66 6163 203d      x.temp_fac =
-00012b40: 2022 7b30 3a2e 3266 7d22 2e66 6f72 6d61   "{0:.2f}".forma
-00012b50: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
-00012b60: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
-00012b70: 2864 6963 745f 7363 6f72 6573 5b63 7572  (dict_scores[cur
-00012b80: 5f63 6861 696e 5d5b 6375 725f 7265 735d  _chain][cur_res]
-00012b90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012ba0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00012bb0: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-00012bc0: 4b65 7945 7272 6f72 2c20 496e 6465 7845  KeyError, IndexE
-00012bd0: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-00012be0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-00012bf0: 2827 5265 7369 6475 6520 6d69 7373 696e  ('Residue missin
-00012c00: 673a 2027 2c20 6375 725f 7265 732c 2063  g: ', cur_res, c
-00012c10: 6869 6429 0a20 2020 2020 2020 2020 2020  hid).           
-00012c20: 2020 2020 2020 2020 2078 2e74 656d 705f           x.temp_
-00012c30: 6661 6320 3d20 6465 6661 756c 740a 2020  fac = default.  
-00012c40: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-00012c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012c60: 782e 7465 6d70 5f66 6163 203d 2064 6566  x.temp_fac = def
-00012c70: 6175 6c74 0a20 2020 2020 2020 2073 7472  ault.        str
-00012c80: 7563 7475 7265 5f69 6e73 7461 6e63 652e  ucture_instance.
-00012c90: 7772 6974 655f 746f 5f50 4442 286f 7574  write_to_PDB(out
-00012ca0: 6669 6c65 290a 0a20 2020 2064 6566 2073  file)..    def s
-00012cb0: 6d6f 635f 7363 6f72 655f 7269 6769 645f  moc_score_rigid_
-00012cc0: 626f 6469 6573 280a 2020 2020 2020 2020  bodies(.        
-00012cd0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00012ce0: 2020 2020 2020 6469 6374 5f72 6573 5f69        dict_res_i
-00012cf0: 6e64 6963 6573 2c0a 2020 2020 2020 2020  ndices,.        
-00012d00: 2020 2020 7269 6769 645f 626f 6479 5f66      rigid_body_f
-00012d10: 696c 652c 0a20 2020 2020 2020 2020 2020  ile,.           
-00012d20: 2063 682c 0a20 2020 2020 2020 2020 2020   ch,.           
-00012d30: 2069 6e64 692c 0a20 2020 2020 2020 2020   indi,.         
-00012d40: 2020 206d 6170 5f74 6172 6765 742c 0a20     map_target,. 
-00012d50: 2020 2020 2020 2020 2020 2073 696d 5f6d             sim_m
-00012d60: 6170 0a20 2020 2029 3a0a 2020 2020 2020  ap.    ):.      
-00012d70: 2020 6469 6374 5f72 6573 5f73 636f 7265    dict_res_score
-00012d80: 7320 3d20 7b7d 0a20 2020 2020 2020 2064  s = {}.        d
-00012d90: 6963 745f 7262 6620 3d20 5242 5061 7273  ict_rbf = RBPars
-00012da0: 6572 2e72 6561 645f 7269 6769 645f 626f  er.read_rigid_bo
-00012db0: 6479 5f66 696c 6528 7269 6769 645f 626f  dy_file(rigid_bo
-00012dc0: 6479 5f66 696c 6529 0a20 2020 2020 2020  dy_file).       
-00012dd0: 2063 6861 696e 6964 5f73 6574 203d 2063   chainid_set = c
-00012de0: 680a 2020 2020 2020 2020 6966 206c 656e  h.        if len
-00012df0: 2863 6829 203d 3d20 303a 0a20 2020 2020  (ch) == 0:.     
-00012e00: 2020 2020 2020 2063 6861 696e 6964 5f73         chainid_s
-00012e10: 6574 203d 2027 2d27 0a20 2020 2020 2020  et = '-'.       
-00012e20: 2069 6620 6368 6169 6e69 645f 7365 7420   if chainid_set 
-00012e30: 696e 2064 6963 745f 7262 663a 0a20 2020  in dict_rbf:.   
-00012e40: 2020 2020 2020 2020 2066 6f72 2072 6220           for rb 
-00012e50: 696e 2064 6963 745f 7262 665b 6368 6169  in dict_rbf[chai
-00012e60: 6e69 645f 7365 745d 3a0a 2020 2020 2020  nid_set]:.      
-00012e70: 2020 2020 2020 2020 2020 2320 6561 6368            # each
-00012e80: 2072 6967 6964 2062 6f64 790a 2020 2020   rigid body.    
-00012e90: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00012ea0: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
-00012eb0: 2020 2020 2020 2020 2072 6573 5f6c 6973           res_lis
-00012ec0: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
-00012ed0: 2020 2020 2020 2066 6f72 2073 6567 2069         for seg i
-00012ee0: 6e20 6469 6374 5f72 6266 5b63 6861 696e  n dict_rbf[chain
-00012ef0: 6964 5f73 6574 5d5b 7262 5d3a 0a20 2020  id_set][rb]:.   
-00012f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-00012f20: 2020 2020 2020 2020 2020 2020 2020 666f                fo
-00012f30: 7220 7220 696e 2072 616e 6765 2869 6e74  r r in range(int
-00012f40: 2873 6567 5b30 5d29 2c20 696e 7428 7365  (seg[0]), int(se
-00012f50: 675b 315d 2920 2b20 3129 3a0a 2020 2020  g[1]) + 1):.    
-00012f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012f70: 2020 2020 2020 2020 696e 6469 6365 732e          indices.
-00012f80: 6578 7465 6e64 2864 6963 745f 7265 735f  extend(dict_res_
-00012f90: 696e 6469 6365 735b 725d 290a 2020 2020  indices[r]).    
-00012fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012fb0: 2020 2020 2020 2020 7265 735f 6c69 7374          res_list
-00012fc0: 2e61 7070 656e 6428 7229 0a20 2020 2020  .append(r).     
-00012fd0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00012fe0: 7863 6570 7420 5479 7065 4572 726f 723a  xcept TypeError:
-00012ff0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013000: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00013010: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00013020: 2020 2320 6d69 6e69 6d75 6d20 7661 6c75    # minimum valu
-00013030: 6520 7365 7420 6173 2030 2068 6572 6520  e set as 0 here 
-00013040: 2861 7373 756d 696e 6720 6f6e 6c79 2070  (assuming only p
-00013050: 6f73 6974 6976 6520 7661 6c75 6573 2129  ositive values!)
-00013060: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013070: 2069 6620 6c65 6e28 696e 6469 6365 7329   if len(indices)
-00013080: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-00013090: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
-000130a0: 6573 2069 6e20 7265 735f 6c69 7374 3a0a  es in res_list:.
-000130b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000130c0: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
-000130d0: 5f73 636f 7265 735b 7265 735d 203d 2030  _scores[res] = 0
-000130e0: 2e30 2020 2320 2d30 2e39 390a 2020 2020  .0  # -0.99.    
-000130f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013100: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00013110: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00013120: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013130: 2020 696e 645f 6172 727a 7978 203d 2073    ind_arrzyx = s
-00013140: 656c 662e 696e 6469 6365 735f 736d 6f63  elf.indices_smoc
-00013150: 2869 6e64 6963 6573 2c20 696e 6469 290a  (indices, indi).
+0000b870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b880: 5468 6973 2064 6566 696e 6974 696f 6e20  This definition 
+0000b890: 6973 2075 7365 6675 6c20 6573 7065 6369  is useful especi
+0000b8a0: 616c 6c79 2077 6865 6e20 7468 650a 2020  ally when the.  
+0000b8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b8c0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000b8d0: 6170 2073 7572 6661 6365 2068 6173 206d  ap surface has m
+0000b8e0: 616e 7920 6665 6174 7572 6573 2f70 726f  any features/pro
+0000b8f0: 6a65 6374 696f 6e73 2e0a 2020 2020 2020  jections..      
+0000b900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b910: 2020 3429 204d 696e 696d 756d 3a20 6120    4) Minimum: a 
+0000b920: 6d69 6e69 6d75 6d20 6669 6c74 6572 2069  minimum filter i
+0000b930: 7320 6170 706c 6965 6420 6f6e 2061 2062  s applied on a b
+0000b940: 696e 6172 790a 2020 2020 2020 2020 2020  inary.          
+0000b950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b960: 2020 2020 2020 2020 2020 636f 6e74 6f75            contou
+0000b970: 7220 6d61 736b 2074 6f20 6c6f 6361 7465  r mask to locate
+0000b980: 2073 7572 6661 6365 2070 6f69 6e74 732e   surface points.
+0000b990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9b0: 2020 2020 2056 6f78 656c 7320 7375 7272       Voxels surr
+0000b9c0: 6f75 6e64 6564 2062 7920 706f 696e 7473  ounded by points
+0000b9d0: 206f 7574 7369 6465 2074 6865 0a20 2020   outside the.   
+0000b9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba00: 2063 6f6e 746f 7572 2028 7a65 726f 6573   contour (zeroes
+0000ba10: 2920 6172 6520 6465 7465 6374 6564 2061  ) are detected a
+0000ba20: 7320 7375 7266 6163 652e 0a20 2020 2020  s surface..     
+0000ba30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba40: 2020 2020 2020 2020 2020 2020 2020 2056                 V
+0000ba50: 6f78 656c 7320 7375 7272 6f75 6e64 6564  oxels surrounded
+0000ba60: 2062 7920 706f 696e 7473 206f 7574 7369   by points outsi
+0000ba70: 6465 2074 6865 0a20 2020 2020 2020 2020  de the.         
+0000ba80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ba90: 2020 2020 2020 2020 2020 2063 6f6e 746f             conto
+0000baa0: 7572 2028 7a65 726f 6573 2920 6172 6520  ur (zeroes) are 
+0000bab0: 6465 7465 6374 6564 2061 7320 7375 7266  detected as surf
+0000bac0: 6163 652e 0a20 2020 2020 2020 2020 2020  ace..           
+0000bad0: 2020 2020 2020 2020 2020 2020 2035 2920               5) 
+0000bae0: 536f 6265 6c3a 2073 6f62 656c 2066 696c  Sobel: sobel fil
+0000baf0: 7465 7220 6973 2061 7070 6c69 6564 206f  ter is applied o
+0000bb00: 6e20 7468 6520 6d61 7020 746f 2064 6574  n the map to det
+0000bb10: 6563 740a 2020 2020 2020 2020 2020 2020  ect.            
+0000bb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb30: 2020 2020 2020 6869 6768 2064 656e 7369        high densi
+0000bb40: 7479 2067 7261 6469 656e 7473 2e20 4265  ty gradients. Be
+0000bb50: 666f 7265 2061 7070 6c79 696e 6720 7468  fore applying th
+0000bb60: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000bb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bb80: 2020 2020 736f 6265 6c20 6669 6c74 6572      sobel filter
+0000bb90: 2c20 6974 2069 7320 696d 706f 7274 616e  , it is importan
+0000bba0: 7420 746f 2072 6564 7563 6520 7468 650a  t to reduce the.
+0000bbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bbd0: 2020 6e6f 6973 6520 6465 6e73 6974 7920    noise density 
+0000bbe0: 616e 6420 6c61 7267 6520 7661 7269 6174  and large variat
+0000bbf0: 696f 6e73 0a20 2020 2020 2020 2020 2020  ions.           
+0000bc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bc10: 2020 2020 2020 2028 6772 6164 6965 6e74         (gradient
+0000bc20: 7329 2069 6e20 7468 6520 6e6f 6973 6520  s) in the noise 
+0000bc30: 7265 6769 6f6e 2e0a 2020 2020 2020 2020  region..        
+0000bc40: 2020 2020 2a77 6569 6768 742a 0a20 2020      *weight*.   
+0000bc50: 2020 2020 2020 2020 2020 2020 2049 6620               If 
+0000bc60: 7365 7420 7472 7565 2c20 7468 6520 6469  set true, the di
+0000bc70: 7374 616e 6365 7320 6265 7477 6565 6e20  stances between 
+0000bc80: 7468 6520 7375 7266 6163 6520 706f 696e  the surface poin
+0000bc90: 7473 2069 730a 2020 2020 2020 2020 2020  ts is.          
+0000bca0: 2020 2020 2020 6e6f 726d 616c 697a 6564        normalized
+0000bcb0: 2069 6e20 6120 7761 7920 7369 6d69 6c61   in a way simila
+0000bcc0: 7220 746f 2047 4454 2028 5a65 6d6c 6120  r to GDT (Zemla 
+0000bcd0: 3230 3037 290a 2020 2020 2020 2020 2020  2007).          
+0000bce0: 2020 2020 2020 6361 6c63 756c 6174 696f        calculatio
+0000bcf0: 6e20 666f 7220 6174 6f6d 6963 2063 6f2d  n for atomic co-
+0000bd00: 6f72 6469 6e61 7465 2061 6c69 676e 6d65  ordinate alignme
+0000bd10: 6e74 732e 0a20 2020 2020 2020 2022 2222  nts..        """
+0000bd20: 0a20 2020 2020 2020 2023 2063 6865 636b  .        # check
+0000bd30: 2069 6620 626f 7468 206d 6170 7320 6172   if both maps ar
+0000bd40: 6520 6f6e 2074 6865 2073 616d 6520 6772  e on the same gr
+0000bd50: 6964 0a20 2020 2020 2020 2069 6620 6e6f  id.        if no
+0000bd60: 7420 7365 6c66 2e6d 6170 436f 6d70 6172  t self.mapCompar
+0000bd70: 6973 6f6e 286d 6170 5f74 6172 6765 742c  ison(map_target,
+0000bd80: 206d 6170 5f70 726f 6265 293a 0a20 2020   map_probe):.   
+0000bd90: 2020 2020 2020 2020 2070 7269 6e74 2827           print('
+0000bda0: 4040 4020 4d61 7073 2063 6f75 6c64 206e  @@@ Maps could n
+0000bdb0: 6f74 2062 6520 6d61 7463 6865 6427 290a  ot be matched').
+0000bdc0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000bdd0: 726e 202d 3939 392e 0a20 2020 2020 2020  rn -999..       
+0000bde0: 2023 2069 6620 7468 6520 626f 756e 6461   # if the bounda
+0000bdf0: 7269 6573 2061 7265 206b 6e6f 776e 2c20  ries are known, 
+0000be00: 6361 6c63 756c 6174 6520 7468 6520 6b64  calculate the kd
+0000be10: 7472 6565 0a20 2020 2020 2020 2069 6620  tree.        if 
+0000be20: 4669 6c74 6572 2069 7320 4e6f 6e65 3a0a  Filter is None:.
+0000be30: 2020 2020 2020 2020 2020 2020 6b64 7472              kdtr
+0000be40: 6565 203d 206d 6170 5f74 6172 6765 742e  ee = map_target.
+0000be50: 6d61 6b65 4b44 5472 6565 280a 2020 2020  makeKDTree(.    
+0000be60: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000be70: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
+0000be80: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
+0000be90: 2020 206d 6170 5f74 6172 6765 745f 7468     map_target_th
+0000bea0: 7265 7368 6f6c 6432 0a20 2020 2020 2020  reshold2.       
+0000beb0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0000bec0: 2020 2070 726f 6265 5f70 6f69 6e74 7320     probe_points 
+0000bed0: 3d20 6d61 705f 7072 6f62 652e 6765 745f  = map_probe.get_
+0000bee0: 706f 7328 0a20 2020 2020 2020 2020 2020  pos(.           
+0000bef0: 2020 2020 206d 6170 5f74 6172 6765 745f       map_target_
+0000bf00: 7468 7265 7368 6f6c 6431 2c0a 2020 2020  threshold1,.    
+0000bf10: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000bf20: 7461 7267 6574 5f74 6872 6573 686f 6c64  target_threshold
+0000bf30: 320a 2020 2020 2020 2020 2020 2020 290a  2.            ).
+0000bf40: 2020 2020 2020 2020 656c 6966 2046 696c          elif Fil
+0000bf50: 7465 7220 3d3d 2027 5374 6427 3a0a 2020  ter == 'Std':.  
+0000bf60: 2020 2020 2020 2020 2020 7461 7267 6574            target
+0000bf70: 5f70 6f69 6e74 7320 3d20 6e70 2e61 7267  _points = np.arg
+0000bf80: 7768 6572 6528 0a20 2020 2020 2020 2020  where(.         
+0000bf90: 2020 2020 2020 2028 6d61 705f 7461 7267         (map_targ
+0000bfa0: 6574 2e66 756c 6c4d 6170 203e 2028 0a20  et.fullMap > (. 
+0000bfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000bfc0: 2020 2020 2020 2066 6c6f 6174 286d 6170         float(map
+0000bfd0: 5f74 6172 6765 745f 7468 7265 7368 6f6c  _target_threshol
+0000bfe0: 6431 292d 286d 6170 5f74 6172 6765 742e  d1)-(map_target.
+0000bff0: 7374 6428 292a 302e 3130 2929 0a20 2020  std()*0.10)).   
+0000c000: 2020 2020 2020 2020 2020 2020 2020 2920                ) 
+0000c010: 260a 2020 2020 2020 2020 2020 2020 2020  &.              
+0000c020: 2020 286d 6170 5f74 6172 6765 742e 6675    (map_target.fu
+0000c030: 6c6c 4d61 7020 3c20 280a 2020 2020 2020  llMap < (.      
+0000c040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c050: 2020 666c 6f61 7428 6d61 705f 7461 7267    float(map_targ
+0000c060: 6574 5f74 6872 6573 686f 6c64 3129 2b28  et_threshold1)+(
+0000c070: 6d61 705f 7461 7267 6574 2e73 7464 2829  map_target.std()
+0000c080: 2a30 2e31 3029 290a 2020 2020 2020 2020  *0.10)).        
+0000c090: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c0a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000c0b0: 2020 2020 2070 726f 6265 5f70 6f69 6e74       probe_point
+0000c0c0: 7320 3d20 6e70 2e61 7267 7768 6572 6528  s = np.argwhere(
+0000c0d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c0e0: 2028 6d61 705f 7072 6f62 652e 6675 6c6c   (map_probe.full
+0000c0f0: 4d61 7020 3e20 280a 2020 2020 2020 2020  Map > (.        
+0000c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c110: 666c 6f61 7428 6d61 705f 7072 6f62 655f  float(map_probe_
+0000c120: 7468 7265 7368 6f6c 6429 2d28 6d61 705f  threshold)-(map_
+0000c130: 7072 6f62 652e 7374 6428 292a 302e 3130  probe.std()*0.10
+0000c140: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
+0000c150: 2020 2020 2920 260a 2020 2020 2020 2020      ) &.        
+0000c160: 2020 2020 2020 2020 286d 6170 5f70 726f          (map_pro
+0000c170: 6265 2e66 756c 6c4d 6170 203c 2028 0a20  be.fullMap < (. 
+0000c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c190: 2020 2020 2020 2066 6c6f 6174 286d 6170         float(map
+0000c1a0: 5f70 726f 6265 5f74 6872 6573 686f 6c64  _probe_threshold
+0000c1b0: 292b 286d 6170 5f70 726f 6265 2e73 7464  )+(map_probe.std
+0000c1c0: 2829 2a30 2e31 3029 290a 2020 2020 2020  ()*0.10)).      
+0000c1d0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000c1e0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000c1f0: 2020 2020 2020 2069 6620 6c65 6e28 7461         if len(ta
+0000c200: 7267 6574 5f70 6f69 6e74 7329 203c 206c  rget_points) < l
+0000c210: 656e 2870 726f 6265 5f70 6f69 6e74 7329  en(probe_points)
+0000c220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000c230: 2020 7072 6f62 655f 706f 696e 7473 3120    probe_points1 
+0000c240: 3d20 6e70 2e63 6f70 7928 7461 7267 6574  = np.copy(target
+0000c250: 5f70 6f69 6e74 7329 0a20 2020 2020 2020  _points).       
+0000c260: 2020 2020 2020 2020 2074 6172 6765 745f           target_
+0000c270: 706f 696e 7473 203d 206e 702e 636f 7079  points = np.copy
+0000c280: 2870 726f 6265 5f70 6f69 6e74 7329 0a20  (probe_points). 
+0000c290: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000c2a0: 726f 6265 5f70 6f69 6e74 7320 3d20 6e70  robe_points = np
+0000c2b0: 2e63 6f70 7928 7072 6f62 655f 706f 696e  .copy(probe_poin
+0000c2c0: 7473 3129 0a20 2020 2020 2020 2020 2020  ts1).           
+0000c2d0: 2069 6620 6c65 6e28 7461 7267 6574 5f70   if len(target_p
+0000c2e0: 6f69 6e74 7329 203d 3d20 3020 6f72 206c  oints) == 0 or l
+0000c2f0: 656e 2870 726f 6265 5f70 6f69 6e74 7329  en(probe_points)
+0000c300: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+0000c310: 2020 2020 2020 2070 7269 6e74 2827 5375         print('Su
+0000c320: 7266 6163 6520 6465 7465 6374 696f 6e20  rface detection 
+0000c330: 6661 696c 6564 2028 5374 6420 6669 6c74  failed (Std filt
+0000c340: 6572 292c 2065 7869 7469 6e67 2e2e 2729  er), exiting..')
+0000c350: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000c360: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+0000c370: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000c380: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+0000c390: 6f6d 2073 6369 7079 2e73 7061 7469 616c  om scipy.spatial
+0000c3a0: 2069 6d70 6f72 7420 634b 4454 7265 650a   import cKDTree.
+0000c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c3c0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000c3d0: 2020 2020 2020 2020 206b 6474 7265 6520           kdtree 
+0000c3e0: 3d20 634b 4454 7265 6528 7461 7267 6574  = cKDTree(target
+0000c3f0: 5f70 6f69 6e74 7329 0a20 2020 2020 2020  _points).       
+0000c400: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000c410: 5275 6e74 696d 6545 7272 6f72 3a0a 2020  RuntimeError:.  
+0000c420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000c430: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0000c440: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000c450: 2049 6d70 6f72 7445 7272 6f72 3a0a 2020   ImportError:.  
+0000c460: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0000c470: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0000c480: 2020 2020 2020 206b 6474 7265 6520 3d20         kdtree = 
+0000c490: 4b44 5472 6565 2874 6172 6765 745f 706f  KDTree(target_po
+0000c4a0: 696e 7473 290a 2020 2020 2020 2020 2020  ints).          
+0000c4b0: 2020 2020 2020 6578 6365 7074 2052 756e        except Run
+0000c4c0: 7469 6d65 4572 726f 723a 0a20 2020 2020  timeError:.     
+0000c4d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000c4e0: 6574 7572 6e20 4e6f 6e65 0a20 2020 2020  eturn None.     
+0000c4f0: 2020 2065 6c69 6620 4669 6c74 6572 203d     elif Filter =
+0000c500: 3d20 274d 6561 6e27 3a0a 2020 2020 2020  = 'Mean':.      
+0000c510: 2020 2020 2020 6d61 7031 5f66 696c 7465        map1_filte
+0000c520: 7220 3d20 6d61 705f 7461 7267 6574 2e5f  r = map_target._
+0000c530: 7375 7266 6163 655f 6665 6174 7572 6573  surface_features
+0000c540: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000c550: 2020 666c 6f61 7428 6d61 705f 7461 7267    float(map_targ
+0000c560: 6574 5f74 6872 6573 686f 6c64 3129 0a20  et_threshold1). 
+0000c570: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000c580: 2020 2020 2020 2020 206d 6170 325f 6669           map2_fi
+0000c590: 6c74 6572 203d 206d 6170 5f70 726f 6265  lter = map_probe
+0000c5a0: 2e5f 7375 7266 6163 655f 6665 6174 7572  ._surface_featur
+0000c5b0: 6573 280a 2020 2020 2020 2020 2020 2020  es(.            
+0000c5c0: 2020 2020 666c 6f61 7428 6d61 705f 7072      float(map_pr
+0000c5d0: 6f62 655f 7468 7265 7368 6f6c 6429 0a20  obe_threshold). 
+0000c5e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000c5f0: 2020 2020 2020 2020 2022 2222 0a20 2020           """.   
+0000c600: 2020 2020 2020 2020 2064 6566 696e 6520           define 
+0000c610: 7375 7266 6163 6520 6261 7365 6420 6f6e  surface based on
+0000c620: 2074 6865 2066 696c 7465 7265 6420 6d61   the filtered ma
+0000c630: 736b 2076 616c 7565 732e 0a20 2020 2020  sk values..     
+0000c640: 2020 2020 2020 2070 6f69 6e74 7320 7769         points wi
+0000c650: 7468 2076 616c 7565 7320 6c65 7373 2074  th values less t
+0000c660: 6861 6e20 302e 3320 6172 6520 7573 7561  han 0.3 are usua
+0000c670: 6c6c 7920 7072 6566 6572 7265 642e 2042  lly preferred. B
+0000c680: 7574 2069 6e0a 2020 2020 2020 2020 2020  ut in.          
+0000c690: 2020 736f 6d65 2063 6173 6573 206c 696b    some cases lik
+0000c6a0: 6520 7669 7275 7365 732c 206d 6f73 7420  e viruses, most 
+0000c6b0: 7375 7266 6163 6520 706f 696e 7473 2061  surface points a
+0000c6c0: 7265 2068 6967 686c 7920 6578 706f 7365  re highly expose
+0000c6d0: 640a 2020 2020 2020 2020 2020 2020 616e  d.            an
+0000c6e0: 6420 6120 6c61 7267 6520 6e75 6d62 6572  d a large number
+0000c6f0: 206f 6620 706f 696e 7473 2061 7265 2072   of points are r
+0000c700: 6574 7572 6e65 6420 616e 6420 7468 6520  eturned and the 
+0000c710: 6361 6c63 756c 6174 696f 6e0a 2020 2020  calculation.    
+0000c720: 2020 2020 2020 2020 6265 636f 6d65 7320          becomes 
+0000c730: 736c 6f77 2e0a 2020 2020 2020 2020 2020  slow..          
+0000c740: 2020 4865 6e63 6520 616e 2061 6464 6974    Hence an addit
+0000c750: 696f 6e61 6c20 6669 6c74 6572 2069 7320  ional filter is 
+0000c760: 6164 6465 643a 2074 6865 206d 6178 696d  added: the maxim
+0000c770: 756d 2061 6c6c 6f77 6564 2070 6f69 6e74  um allowed point
+0000c780: 730a 2020 2020 2020 2020 2020 2020 6973  s.            is
+0000c790: 2031 3025 206f 6620 626f 7820 7369 7a65   10% of box size
+0000c7a0: 2e0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+0000c7b0: 6520 6d69 6e69 6d75 6d20 6e75 6d62 6572  e minimum number
+0000c7c0: 206f 6620 706f 696e 7473 2069 7320 6b65   of points is ke
+0000c7d0: 7074 2061 7320 3725 2e20 5468 6973 206d  pt as 7%. This m
+0000c7e0: 6f64 6520 6973 206c 6573 730a 2020 2020  ode is less.    
+0000c7f0: 2020 2020 2020 2020 7365 6e73 6974 6976          sensitiv
+0000c800: 6520 746f 2074 6865 206e 756d 6265 7220  e to the number 
+0000c810: 6f66 2073 7572 6661 6365 2070 6f69 6e74  of surface point
+0000c820: 7320 6368 6f73 656e 0a20 2020 2020 2020  s chosen.       
+0000c830: 2020 2020 2061 7320 7468 6520 6578 7465       as the exte
+0000c840: 6e74 206f 6620 6578 706f 7375 7265 2069  nt of exposure i
+0000c850: 7320 7573 6564 2066 6f72 2064 6566 696e  s used for defin
+0000c860: 696e 6720 7375 7266 6163 652e 2048 656e  ing surface. Hen
+0000c870: 6365 0a20 2020 2020 2020 2020 2020 2074  ce.            t
+0000c880: 6869 636b 2073 7572 6661 6365 2069 7320  hick surface is 
+0000c890: 6e6f 7420 7573 7561 6c6c 7920 7265 7175  not usually requ
+0000c8a0: 6972 6564 2e0a 2020 2020 2020 2020 2020  ired..          
+0000c8b0: 2020 6361 6c63 756c 6174 6520 6672 6571    calculate freq
+0000c8c0: 7565 6e63 6965 7320 696e 2062 696e 7320  uencies in bins 
+0000c8d0: 666f 7220 6669 6c74 6572 6564 206d 6173  for filtered mas
+0000c8e0: 6b2e 0a20 2020 2020 2020 2020 2020 2054  k..            T
+0000c8f0: 6865 2073 6d61 6c6c 6572 2074 6865 2062  he smaller the b
+0000c900: 696e 732c 206d 6f72 6520 7072 6563 6973  ins, more precis
+0000c910: 6520 7769 6c6c 2062 6520 7468 6520 6361  e will be the ca
+0000c920: 6c63 756c 6174 696f 6e20 6f66 0a20 2020  lculation of.   
+0000c930: 2020 2020 2020 2020 2070 6f69 6e74 7320           points 
+0000c940: 616c 6c6f 7765 6420 6261 7365 6420 6f6e  allowed based on
+0000c950: 2070 6572 6365 6e74 206f 6620 706f 696e   percent of poin
+0000c960: 7473 2063 686f 7365 6e2e 0a20 2020 2020  ts chosen..     
+0000c970: 2020 2020 2020 2041 7320 7468 6973 2069         As this i
+0000c980: 7320 6a75 7374 2061 6e20 6164 6469 7469  s just an additi
+0000c990: 6f6e 616c 2066 696c 7465 7220 616e 6420  onal filter and 
+0000c9a0: 646f 6573 6e27 7420 6166 6665 6374 2074  doesn't affect t
+0000c9b0: 6865 0a20 2020 2020 2020 2020 2020 2063  he.            c
+0000c9c0: 616c 6375 6c61 7469 6f6e 7320 6472 6173  alculations dras
+0000c9d0: 7469 6361 6c6c 792c 2034 3020 6269 6e73  tically, 40 bins
+0000c9e0: 2061 7265 2075 7365 6420 746f 2063 616c   are used to cal
+0000c9f0: 6375 6c61 7465 0a20 2020 2020 2020 2020  culate.         
+0000ca00: 2020 2066 7265 7175 656e 6369 6573 2e0a     frequencies..
+0000ca10: 2020 2020 2020 2020 2020 2020 2222 220a              """.
+0000ca20: 2020 2020 2020 2020 2020 2020 6269 6e5f              bin_
+0000ca30: 7465 7374 203d 205b 302e 3030 3031 5d0a  test = [0.0001].
+0000ca40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+0000ca50: 6969 2069 6e20 7261 6e67 6528 312c 2034  ii in range(1, 4
+0000ca60: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
+0000ca70: 2020 2020 6269 6e5f 7465 7374 2e61 7070      bin_test.app
+0000ca80: 656e 6428 302e 3032 3520 2a20 6969 290a  end(0.025 * ii).
+0000ca90: 2020 2020 2020 2020 2020 2020 6672 6571              freq
+0000caa0: 5f74 6573 7420 3d20 6e70 2e68 6973 746f  _test = np.histo
+0000cab0: 6772 616d 286d 6170 315f 6669 6c74 6572  gram(map1_filter
+0000cac0: 2e66 756c 6c4d 6170 2c20 6269 6e5f 7465  .fullMap, bin_te
+0000cad0: 7374 295b 305d 0a20 2020 2020 2020 2020  st)[0].         
+0000cae0: 2020 206d 6170 315f 6669 6c6c 6564 203d     map1_filled =
+0000caf0: 206e 702e 7375 6d28 6d61 7031 5f66 696c   np.sum(map1_fil
+0000cb00: 7465 722e 6675 6c6c 4d61 7020 3e20 3029  ter.fullMap > 0)
+0000cb10: 0a0a 2020 2020 2020 2020 2020 2020 7375  ..            su
+0000cb20: 6d5f 6672 6571 203d 2030 2e30 0a20 2020  m_freq = 0.0.   
+0000cb30: 2020 2020 2020 2020 2066 6f72 2066 7220           for fr 
+0000cb40: 696e 2072 616e 6765 286c 656e 2866 7265  in range(len(fre
+0000cb50: 715f 7465 7374 2929 3a0a 2020 2020 2020  q_test)):.      
+0000cb60: 2020 2020 2020 2020 2020 7375 6d5f 6672            sum_fr
+0000cb70: 6571 202b 3d20 666c 6f61 7428 6672 6571  eq += float(freq
+0000cb80: 5f74 6573 745b 6672 5d29 0a20 2020 2020  _test[fr]).     
+0000cb90: 2020 2020 2020 2020 2020 2069 6620 7375             if su
+0000cba0: 6d5f 6672 6571 202f 206d 6170 315f 6669  m_freq / map1_fi
+0000cbb0: 6c6c 6564 203e 2030 2e30 3520 616e 6420  lled > 0.05 and 
+0000cbc0: 6269 6e5f 7465 7374 5b66 722b 315d 203e  bin_test[fr+1] >
+0000cbd0: 3d20 302e 333a 0a20 2020 2020 2020 2020  = 0.3:.         
+0000cbe0: 2020 2020 2020 2020 2020 2074 3120 3d20             t1 = 
+0000cbf0: 6269 6e5f 7465 7374 5b66 722b 315d 0a20  bin_test[fr+1]. 
+0000cc00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc10: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
+0000cc20: 2020 2020 2020 2020 2069 6620 7375 6d5f           if sum_
+0000cc30: 6672 6571 202f 206d 6170 315f 6669 6c6c  freq / map1_fill
+0000cc40: 6564 203e 2030 2e31 3020 6f72 2073 756d  ed > 0.10 or sum
+0000cc50: 5f66 7265 7120 3e20 3230 3030 3030 3a0a  _freq > 200000:.
+0000cc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000cc70: 2020 2020 7431 203d 2062 696e 5f74 6573      t1 = bin_tes
+0000cc80: 745b 6672 2b31 5d0a 2020 2020 2020 2020  t[fr+1].        
+0000cc90: 2020 2020 2020 2020 2020 2020 6272 6561              brea
+0000cca0: 6b0a 2020 2020 2020 2020 2020 2020 7375  k.            su
+0000ccb0: 6d5f 6672 6571 203d 2030 2e30 0a20 2020  m_freq = 0.0.   
+0000ccc0: 2020 2020 2020 2020 2066 7265 715f 7465           freq_te
+0000ccd0: 7374 203d 206e 702e 6869 7374 6f67 7261  st = np.histogra
+0000cce0: 6d28 6d61 7032 5f66 696c 7465 722e 6675  m(map2_filter.fu
+0000ccf0: 6c6c 4d61 702c 2062 696e 5f74 6573 7429  llMap, bin_test)
+0000cd00: 5b30 5d0a 2020 2020 2020 2020 2020 2020  [0].            
+0000cd10: 6d61 7032 5f66 696c 6c65 6420 3d20 6e70  map2_filled = np
+0000cd20: 2e73 756d 286d 6170 325f 6669 6c74 6572  .sum(map2_filter
+0000cd30: 2e66 756c 6c4d 6170 203e 2030 290a 2020  .fullMap > 0).  
+0000cd40: 2020 2020 2020 2020 2020 666f 7220 6672            for fr
+0000cd50: 2069 6e20 7261 6e67 6528 6c65 6e28 6672   in range(len(fr
+0000cd60: 6571 5f74 6573 7429 293a 0a20 2020 2020  eq_test)):.     
+0000cd70: 2020 2020 2020 2020 2020 2073 756d 5f66             sum_f
+0000cd80: 7265 7120 2b3d 2066 6c6f 6174 2866 7265  req += float(fre
+0000cd90: 715f 7465 7374 5b66 725d 290a 2020 2020  q_test[fr]).    
+0000cda0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
+0000cdb0: 756d 5f66 7265 712f 6d61 7032 5f66 696c  um_freq/map2_fil
+0000cdc0: 6c65 6420 3e20 302e 3035 2061 6e64 2062  led > 0.05 and b
+0000cdd0: 696e 5f74 6573 745b 6672 2b31 5d20 3e3d  in_test[fr+1] >=
+0000cde0: 2030 2e33 3a0a 2020 2020 2020 2020 2020   0.3:.          
+0000cdf0: 2020 2020 2020 2020 2020 7432 203d 2062            t2 = b
+0000ce00: 696e 5f74 6573 745b 6672 2b31 5d0a 2020  in_test[fr+1].  
+0000ce10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce20: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0000ce30: 2020 2020 2020 2020 6966 2073 756d 5f66          if sum_f
+0000ce40: 7265 712f 6d61 7032 5f66 696c 6c65 6420  req/map2_filled 
+0000ce50: 3e20 302e 3130 206f 7220 7375 6d5f 6672  > 0.10 or sum_fr
+0000ce60: 6571 203e 2032 3030 3030 303a 0a20 2020  eq > 200000:.   
+0000ce70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ce80: 2074 3220 3d20 6269 6e5f 7465 7374 5b66   t2 = bin_test[f
+0000ce90: 722b 315d 0a20 2020 2020 2020 2020 2020  r+1].           
+0000cea0: 2020 2020 2020 2020 2062 7265 616b 0a20           break. 
+0000ceb0: 2020 2020 2020 2020 2020 2023 2074 3120             # t1 
+0000cec0: 616e 6420 7432 2061 7265 2074 6865 2073  and t2 are the s
+0000ced0: 656c 6563 7465 6420 6c65 7665 6c73 2062  elected levels b
+0000cee0: 6173 6564 206f 6e20 6669 6c74 6572 6564  ased on filtered
+0000cef0: 2076 616c 7565 7320 616e 640a 2020 2020   values and.    
+0000cf00: 2020 2020 2020 2020 2320 7065 7263 656e          # percen
+0000cf10: 7420 6f66 2070 6f69 6e74 730a 2020 2020  t of points.    
+0000cf20: 2020 2020 2020 2020 7461 7267 6574 5f70          target_p
+0000cf30: 6f69 6e74 7320 3d20 6e70 2e61 7267 7768  oints = np.argwh
+0000cf40: 6572 6528 0a20 2020 2020 2020 2020 2020  ere(.           
+0000cf50: 2020 2020 2028 6d61 7031 5f66 696c 7465       (map1_filte
+0000cf60: 722e 6675 6c6c 4d61 7020 3e20 302e 3029  r.fullMap > 0.0)
+0000cf70: 2026 2028 6d61 7031 5f66 696c 7465 722e   & (map1_filter.
+0000cf80: 6675 6c6c 4d61 7020 3c3d 2074 3129 0a20  fullMap <= t1). 
+0000cf90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000cfa0: 2020 2020 2020 2020 2070 726f 6265 5f70           probe_p
+0000cfb0: 6f69 6e74 7320 3d20 6e70 2e61 7267 7768  oints = np.argwh
+0000cfc0: 6572 6528 0a20 2020 2020 2020 2020 2020  ere(.           
+0000cfd0: 2020 2020 2028 6d61 7032 5f66 696c 7465       (map2_filte
+0000cfe0: 722e 6675 6c6c 4d61 7020 3e20 302e 3029  r.fullMap > 0.0)
+0000cff0: 2026 2028 6d61 7032 5f66 696c 7465 722e   & (map2_filter.
+0000d000: 6675 6c6c 4d61 7020 3c3d 2074 3229 0a20  fullMap <= t2). 
+0000d010: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000d020: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
+0000d030: 7461 7267 6574 5f70 6f69 6e74 7329 203d  target_points) =
+0000d040: 3d20 3020 6f72 206c 656e 2870 726f 6265  = 0 or len(probe
+0000d050: 5f70 6f69 6e74 7329 203d 3d20 303a 0a20  _points) == 0:. 
+0000d060: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+0000d070: 7269 6e74 2827 5375 7266 6163 6520 6465  rint('Surface de
+0000d080: 7465 6374 696f 6e20 6661 696c 6564 2028  tection failed (
+0000d090: 4d65 616e 2066 696c 7465 7229 2c20 6578  Mean filter), ex
+0000d0a0: 6974 696e 672e 2e27 290a 2020 2020 2020  iting..').      
+0000d0b0: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d0c0: 204e 6f6e 650a 2020 2020 2020 2020 2020   None.          
+0000d0d0: 2020 6966 206c 656e 2874 6172 6765 745f    if len(target_
+0000d0e0: 706f 696e 7473 2920 3c20 6c65 6e28 7072  points) < len(pr
+0000d0f0: 6f62 655f 706f 696e 7473 293a 0a20 2020  obe_points):.   
+0000d100: 2020 2020 2020 2020 2020 2020 2070 726f               pro
+0000d110: 6265 5f70 6f69 6e74 7331 203d 206e 702e  be_points1 = np.
+0000d120: 636f 7079 2874 6172 6765 745f 706f 696e  copy(target_poin
+0000d130: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
+0000d140: 2020 2020 7461 7267 6574 5f70 6f69 6e74      target_point
+0000d150: 7320 3d20 6e70 2e63 6f70 7928 7072 6f62  s = np.copy(prob
+0000d160: 655f 706f 696e 7473 290a 2020 2020 2020  e_points).      
+0000d170: 2020 2020 2020 2020 2020 7072 6f62 655f            probe_
+0000d180: 706f 696e 7473 203d 206e 702e 636f 7079  points = np.copy
+0000d190: 2870 726f 6265 5f70 6f69 6e74 7331 290a  (probe_points1).
+0000d1a0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+0000d1b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d1c0: 2066 726f 6d20 7363 6970 792e 7370 6174   from scipy.spat
+0000d1d0: 6961 6c20 696d 706f 7274 2063 4b44 5472  ial import cKDTr
+0000d1e0: 6565 0a20 2020 2020 2020 2020 2020 2020  ee.             
+0000d1f0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000d200: 2020 2020 2020 2020 2020 2020 6b64 7472              kdtr
+0000d210: 6565 203d 2063 4b44 5472 6565 2874 6172  ee = cKDTree(tar
+0000d220: 6765 745f 706f 696e 7473 290a 2020 2020  get_points).    
+0000d230: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000d240: 7074 2052 756e 7469 6d65 4572 726f 723a  pt RuntimeError:
+0000d250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d260: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
+0000d270: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+0000d280: 6570 7420 496d 706f 7274 4572 726f 723a  ept ImportError:
+0000d290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d2a0: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000d2b0: 2020 2020 2020 2020 2020 6b64 7472 6565            kdtree
+0000d2c0: 203d 204b 4454 7265 6528 7461 7267 6574   = KDTree(target
+0000d2d0: 5f70 6f69 6e74 7329 0a20 2020 2020 2020  _points).       
+0000d2e0: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+0000d2f0: 5275 6e74 696d 6545 7272 6f72 3a0a 2020  RuntimeError:.  
+0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d310: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0000d320: 2020 2020 2020 656c 6966 2046 696c 7465        elif Filte
+0000d330: 7220 3d3d 2027 4d69 6e69 6d75 6d27 3a0a  r == 'Minimum':.
+0000d340: 2020 2020 2020 2020 2020 2020 6d61 7031              map1
+0000d350: 5f73 7572 6661 6365 203d 206d 6170 5f74  _surface = map_t
+0000d360: 6172 6765 742e 5f73 7572 6661 6365 5f6d  arget._surface_m
+0000d370: 696e 696d 756d 5f66 696c 7465 7228 0a20  inimum_filter(. 
+0000d380: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0000d390: 6c6f 6174 286d 6170 5f74 6172 6765 745f  loat(map_target_
+0000d3a0: 7468 7265 7368 6f6c 6431 290a 2020 2020  threshold1).    
+0000d3b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000d3c0: 2020 2020 2020 6d61 7032 5f73 7572 6661        map2_surfa
+0000d3d0: 6365 203d 206d 6170 5f70 726f 6265 2e5f  ce = map_probe._
+0000d3e0: 7375 7266 6163 655f 6d69 6e69 6d75 6d5f  surface_minimum_
+0000d3f0: 6669 6c74 6572 280a 2020 2020 2020 2020  filter(.        
+0000d400: 2020 2020 2020 2020 666c 6f61 7428 6d61          float(ma
+0000d410: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
+0000d420: 6429 0a20 2020 2020 2020 2020 2020 2029  d).            )
+0000d430: 0a20 2020 2020 2020 2020 2020 2023 2073  .            # s
+0000d440: 656c 6563 7420 7468 6520 7375 7266 6163  elect the surfac
+0000d450: 6520 706f 696e 7473 2072 6570 7265 7365  e points represe
+0000d460: 6e74 6564 2062 7920 7468 6520 6d61 736b  nted by the mask
+0000d470: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+0000d480: 6765 745f 706f 696e 7473 203d 206e 702e  get_points = np.
+0000d490: 6172 6777 6865 7265 286d 6170 315f 7375  argwhere(map1_su
+0000d4a0: 7266 6163 6520 3d3d 2031 290a 2020 2020  rface == 1).    
+0000d4b0: 2020 2020 2020 2020 7072 6f62 655f 706f          probe_po
+0000d4c0: 696e 7473 203d 206e 702e 6172 6777 6865  ints = np.argwhe
+0000d4d0: 7265 286d 6170 325f 7375 7266 6163 6520  re(map2_surface 
+0000d4e0: 3d3d 2031 290a 2020 2020 2020 2020 2020  == 1).          
+0000d4f0: 2020 6966 206c 656e 2874 6172 6765 745f    if len(target_
+0000d500: 706f 696e 7473 2920 3d3d 2030 206f 7220  points) == 0 or 
+0000d510: 6c65 6e28 7072 6f62 655f 706f 696e 7473  len(probe_points
+0000d520: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+0000d530: 2020 2020 2020 2020 7072 696e 7428 2753          print('S
+0000d540: 7572 6661 6365 2064 6574 6563 7469 6f6e  urface detection
+0000d550: 2066 6169 6c65 6420 284d 696e 696d 756d   failed (Minimum
+0000d560: 2066 696c 7465 7229 2c20 6578 6974 696e   filter), exitin
+0000d570: 672e 2e27 290a 2020 2020 2020 2020 2020  g..').          
+0000d580: 2020 2020 2020 7265 7475 726e 204e 6f6e        return Non
+0000d590: 650a 2020 2020 2020 2020 2020 2020 6966  e.            if
+0000d5a0: 206c 656e 2874 6172 6765 745f 706f 696e   len(target_poin
+0000d5b0: 7473 2920 2b20 6c65 6e28 7072 6f62 655f  ts) + len(probe_
+0000d5c0: 706f 696e 7473 2920 3e20 3235 3030 3030  points) > 250000
+0000d5d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d5e0: 2020 7265 7475 726e 204e 6f6e 650a 2020    return None.  
+0000d5f0: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000d600: 2874 6172 6765 745f 706f 696e 7473 2920  (target_points) 
+0000d610: 3c20 6c65 6e28 7072 6f62 655f 706f 696e  < len(probe_poin
+0000d620: 7473 293a 0a20 2020 2020 2020 2020 2020  ts):.           
+0000d630: 2020 2020 2070 726f 6265 5f70 6f69 6e74       probe_point
+0000d640: 7331 203d 206e 702e 636f 7079 2874 6172  s1 = np.copy(tar
+0000d650: 6765 745f 706f 696e 7473 290a 2020 2020  get_points).    
+0000d660: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0000d670: 6574 5f70 6f69 6e74 7320 3d20 6e70 2e63  et_points = np.c
+0000d680: 6f70 7928 7072 6f62 655f 706f 696e 7473  opy(probe_points
+0000d690: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d6a0: 2020 7072 6f62 655f 706f 696e 7473 203d    probe_points =
+0000d6b0: 206e 702e 636f 7079 2870 726f 6265 5f70   np.copy(probe_p
+0000d6c0: 6f69 6e74 7331 290a 2020 2020 2020 2020  oints1).        
+0000d6d0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d6e0: 2020 2020 2020 2020 2066 726f 6d20 7363           from sc
+0000d6f0: 6970 792e 7370 6174 6961 6c20 696d 706f  ipy.spatial impo
+0000d700: 7274 2063 4b44 5472 6565 0a20 2020 2020  rt cKDTree.     
+0000d710: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d730: 2020 2020 6b64 7472 6565 203d 2063 4b44      kdtree = cKD
+0000d740: 5472 6565 2874 6172 6765 745f 706f 696e  Tree(target_poin
+0000d750: 7473 290a 2020 2020 2020 2020 2020 2020  ts).            
+0000d760: 2020 2020 6578 6365 7074 2052 756e 7469      except Runti
+0000d770: 6d65 4572 726f 723a 0a20 2020 2020 2020  meError:.       
+0000d780: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000d790: 7572 6e20 4e6f 6e65 0a20 2020 2020 2020  urn None.       
+0000d7a0: 2020 2020 2065 7863 6570 7420 496d 706f       except Impo
+0000d7b0: 7274 4572 726f 723a 0a20 2020 2020 2020  rtError:.       
+0000d7c0: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
+0000d7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d7e0: 2020 6b64 7472 6565 203d 204b 4454 7265    kdtree = KDTre
+0000d7f0: 6528 7461 7267 6574 5f70 6f69 6e74 7329  e(target_points)
+0000d800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d810: 2065 7863 6570 7420 5275 6e74 696d 6545   except RuntimeE
+0000d820: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+0000d830: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000d840: 204e 6f6e 650a 2020 2020 2020 2020 656c   None.        el
+0000d850: 6966 2046 696c 7465 7220 3d3d 2027 536f  if Filter == 'So
+0000d860: 6265 6c27 3a0a 2020 2020 2020 2020 2020  bel':.          
+0000d870: 2020 6d61 7031 5f73 7572 6661 6365 203d    map1_surface =
+0000d880: 206d 6170 5f74 6172 6765 742e 5f73 6f62   map_target._sob
+0000d890: 656c 5f66 696c 7465 725f 636f 6e74 6f75  el_filter_contou
+0000d8a0: 7228 0a20 2020 2020 2020 2020 2020 2020  r(.             
+0000d8b0: 2020 2066 6c6f 6174 286d 6170 5f74 6172     float(map_tar
+0000d8c0: 6765 745f 7468 7265 7368 6f6c 6431 290a  get_threshold1).
+0000d8d0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0000d8e0: 2020 2020 2020 2020 2020 6d61 7032 5f73            map2_s
+0000d8f0: 7572 6661 6365 203d 206d 6170 5f70 726f  urface = map_pro
+0000d900: 6265 2e5f 736f 6265 6c5f 6669 6c74 6572  be._sobel_filter
+0000d910: 5f63 6f6e 746f 7572 280a 2020 2020 2020  _contour(.      
+0000d920: 2020 2020 2020 2020 2020 666c 6f61 7428            float(
+0000d930: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
+0000d940: 6f6c 6429 0a20 2020 2020 2020 2020 2020  old).           
+0000d950: 2029 0a0a 2020 2020 2020 2020 2020 2020   )..            
+0000d960: 7461 7267 6574 5f70 6f69 6e74 7320 3d20  target_points = 
+0000d970: 6e70 2e61 7267 7768 6572 6528 0a20 2020  np.argwhere(.   
+0000d980: 2020 2020 2020 2020 2020 2020 206d 6170               map
+0000d990: 315f 7375 7266 6163 652e 6675 6c6c 4d61  1_surface.fullMa
+0000d9a0: 7020 3e20 6d61 7031 5f73 7572 6661 6365  p > map1_surface
+0000d9b0: 2e6d 6178 2829 202f 2066 6c6f 6174 2832  .max() / float(2
+0000d9c0: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
+0000d9d0: 2020 2020 2020 2020 2020 2020 7072 6f62              prob
+0000d9e0: 655f 706f 696e 7473 203d 206e 702e 6172  e_points = np.ar
+0000d9f0: 6777 6865 7265 280a 2020 2020 2020 2020  gwhere(.        
+0000da00: 2020 2020 2020 2020 6d61 7032 5f73 7572          map2_sur
+0000da10: 6661 6365 2e66 756c 6c4d 6170 203e 206d  face.fullMap > m
+0000da20: 6170 325f 7375 7266 6163 652e 6d61 7828  ap2_surface.max(
+0000da30: 2920 2f20 666c 6f61 7428 3229 0a20 2020  ) / float(2).   
+0000da40: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0000da50: 2020 2020 2020 2069 6620 6c65 6e28 7461         if len(ta
+0000da60: 7267 6574 5f70 6f69 6e74 7329 203d 3d20  rget_points) == 
+0000da70: 3020 6f72 206c 656e 2870 726f 6265 5f70  0 or len(probe_p
+0000da80: 6f69 6e74 7329 203d 3d20 303a 0a20 2020  oints) == 0:.   
+0000da90: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000daa0: 6e74 2827 5375 7266 6163 6520 6465 7465  nt('Surface dete
+0000dab0: 6374 696f 6e20 6661 696c 6564 2028 536f  ction failed (So
+0000dac0: 6265 6c20 6669 6c74 6572 292c 2065 7869  bel filter), exi
+0000dad0: 7469 6e67 2e2e 2729 0a20 2020 2020 2020  ting..').       
+0000dae0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000daf0: 4e6f 6e65 0a20 2020 2020 2020 2020 2020  None.           
+0000db00: 2069 6620 6c65 6e28 7461 7267 6574 5f70   if len(target_p
+0000db10: 6f69 6e74 7329 203c 206c 656e 2870 726f  oints) < len(pro
+0000db20: 6265 5f70 6f69 6e74 7329 3a0a 2020 2020  be_points):.    
+0000db30: 2020 2020 2020 2020 2020 2020 7072 6f62              prob
+0000db40: 655f 706f 696e 7473 3120 3d20 6e70 2e63  e_points1 = np.c
+0000db50: 6f70 7928 7461 7267 6574 5f70 6f69 6e74  opy(target_point
+0000db60: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+0000db70: 2020 2074 6172 6765 745f 706f 696e 7473     target_points
+0000db80: 203d 206e 702e 636f 7079 2870 726f 6265   = np.copy(probe
+0000db90: 5f70 6f69 6e74 7329 0a20 2020 2020 2020  _points).       
+0000dba0: 2020 2020 2020 2020 2070 726f 6265 5f70           probe_p
+0000dbb0: 6f69 6e74 7320 3d20 6e70 2e63 6f70 7928  oints = np.copy(
+0000dbc0: 7072 6f62 655f 706f 696e 7473 3129 0a20  probe_points1). 
+0000dbd0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+0000dbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dbf0: 6672 6f6d 2073 6369 7079 2e73 7061 7469  from scipy.spati
+0000dc00: 616c 2069 6d70 6f72 7420 634b 4454 7265  al import cKDTre
+0000dc10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+0000dc20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0000dc30: 2020 2020 2020 2020 2020 206b 6474 7265             kdtre
+0000dc40: 6520 3d20 634b 4454 7265 6528 7461 7267  e = cKDTree(targ
+0000dc50: 6574 5f70 6f69 6e74 7329 0a20 2020 2020  et_points).     
+0000dc60: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+0000dc70: 7420 5275 6e74 696d 6545 7272 6f72 3a0a  t RuntimeError:.
+0000dc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dc90: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+0000dca0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+0000dcb0: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
+0000dcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dcd0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000dce0: 2020 2020 2020 2020 206b 6474 7265 6520           kdtree 
+0000dcf0: 3d20 4b44 5472 6565 2874 6172 6765 745f  = KDTree(target_
+0000dd00: 706f 696e 7473 290a 2020 2020 2020 2020  points).        
+0000dd10: 2020 2020 2020 2020 6578 6365 7074 2052          except R
+0000dd20: 756e 7469 6d65 4572 726f 723a 0a20 2020  untimeError:.   
+0000dd30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000dd40: 2072 6574 7572 6e20 4e6f 6e65 0a20 2020   return None.   
+0000dd50: 2020 2020 2064 6973 7461 6e63 6573 203d       distances =
+0000dd60: 206b 6474 7265 652e 7175 6572 7928 7072   kdtree.query(pr
+0000dd70: 6f62 655f 706f 696e 7473 295b 305d 0a20  obe_points)[0]. 
+0000dd80: 2020 2020 2020 2069 6620 6c65 6e28 6469         if len(di
+0000dd90: 7374 616e 6365 7329 203d 3d20 303a 0a20  stances) == 0:. 
+0000dda0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0000ddb0: 6e20 4e6f 6e65 0a20 2020 2020 2020 2069  n None.        i
+0000ddc0: 6620 6e6f 7420 7765 6967 6874 3a0a 2020  f not weight:.  
+0000ddd0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+0000dde0: 206e 702e 6d65 616e 2864 6973 7461 6e63   np.mean(distanc
+0000ddf0: 6573 2920 3c3d 2030 2e30 353a 0a20 2020  es) <= 0.05:.   
+0000de00: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000de10: 7572 6e20 3120 2f20 6e70 2e6d 6561 6e28  urn 1 / np.mean(
+0000de20: 6469 7374 616e 6365 7329 0a20 2020 2020  distances).     
+0000de30: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000de40: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000de50: 7572 6e20 312f 302e 3035 0a0a 2020 2020  urn 1/0.05..    
+0000de60: 2020 2020 7820 3d20 696e 7428 3330 2e30      x = int(30.0
+0000de70: 202f 206d 6170 5f74 6172 6765 742e 6170   / map_target.ap
+0000de80: 6978 290a 2020 2020 2020 2020 6966 206e  ix).        if n
+0000de90: 702e 616d 696e 2864 6973 7461 6e63 6573  p.amin(distances
+0000dea0: 2920 3c20 7820 2f20 323a 0a20 2020 2020  ) < x / 2:.     
+0000deb0: 2020 2020 2020 2064 6973 7461 6e63 6573         distances
+0000dec0: 203d 2064 6973 7461 6e63 6573 202d 206e   = distances - n
+0000ded0: 702e 616d 696e 2864 6973 7461 6e63 6573  p.amin(distances
+0000dee0: 290a 2020 2020 2020 2020 6269 6e73 203d  ).        bins =
+0000def0: 205b 5d0a 2020 2020 2020 2020 6920 3d20   [].        i = 
+0000df00: 300a 2020 2020 2020 2020 7768 696c 6520  0.        while 
+0000df10: 6920 3c3d 2066 6c6f 6174 2878 293a 0a20  i <= float(x):. 
+0000df20: 2020 2020 2020 2020 2020 2062 696e 732e             bins.
+0000df30: 6170 7065 6e64 2869 202a 2031 2e30 290a  append(i * 1.0).
+0000df40: 2020 2020 2020 2020 2020 2020 6920 2b3d              i +=
+0000df50: 2031 0a20 2020 2020 2020 206e 756d 5f64   1.        num_d
+0000df60: 6973 7461 6e63 6573 203d 206c 656e 2864  istances = len(d
+0000df70: 6973 7461 6e63 6573 290a 2020 2020 2020  istances).      
+0000df80: 2020 6f76 6572 6c61 705f 6672 6571 203d    overlap_freq =
+0000df90: 206e 702e 6869 7374 6f67 7261 6d28 6469   np.histogram(di
+0000dfa0: 7374 616e 6365 732c 2062 696e 7329 5b30  stances, bins)[0
+0000dfb0: 5d0a 2020 2020 2020 2020 666f 7220 6672  ].        for fr
+0000dfc0: 5f69 2069 6e20 7261 6e67 6528 6c65 6e28  _i in range(len(
+0000dfd0: 6f76 6572 6c61 705f 6672 6571 2929 3a0a  overlap_freq)):.
+0000dfe0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+0000dff0: 7665 726c 6170 5f66 7265 715b 6672 5f69  verlap_freq[fr_i
+0000e000: 5d20 3e20 6e70 2e61 6d61 7828 6f76 6572  ] > np.amax(over
+0000e010: 6c61 705f 6672 6571 2920 2f20 332e 3a0a  lap_freq) / 3.:.
+0000e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e030: 6272 6561 6b0a 2020 2020 2020 2020 746f  break.        to
+0000e040: 7461 6c5f 6578 7420 3d20 6672 5f69 0a20  tal_ext = fr_i. 
+0000e050: 2020 2020 2020 2062 696e 7320 3d20 6269         bins = bi
+0000e060: 6e73 5b66 725f 693a 5d0a 2020 2020 2020  ns[fr_i:].      
+0000e070: 2020 6966 2063 6c3a 2020 2320 6e6f 7161    if cl:  # noqa
+0000e080: 3a46 3832 310a 2020 2020 2020 2020 2020  :F821.          
+0000e090: 2020 706f 696e 7473 5f63 6c20 3d20 7072    points_cl = pr
+0000e0a0: 6f62 655f 706f 696e 7473 0a20 2020 2020  obe_points.     
+0000e0b0: 2020 2020 2020 2069 6620 6c65 6e28 706f         if len(po
+0000e0c0: 696e 7473 5f63 6c29 203d 3d20 303a 0a20  ints_cl) == 0:. 
+0000e0d0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000e0e0: 6574 7572 6e20 4e6f 6e65 2c20 4e6f 6e65  eturn None, None
+0000e0f0: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
+0000e100: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000e110: 2020 6b64 7472 6565 203d 2063 4b44 5472    kdtree = cKDTr
+0000e120: 6565 2870 6f69 6e74 735f 636c 290a 2020  ee(points_cl).  
+0000e130: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0000e140: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+0000e150: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e160: 726e 204e 6f6e 652c 204e 6f6e 650a 2020  rn None, None.  
+0000e170: 2020 2020 2020 2020 2020 6e65 6967 6862            neighb
+0000e180: 6f72 735f 6e75 6d20 3d20 3230 0a20 2020  ors_num = 20.   
+0000e190: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+0000e1a0: 655f 6c69 6d20 3d20 332e 300a 2020 2020  e_lim = 3.0.    
+0000e1b0: 2020 2020 2020 2020 6e65 6967 6820 3d20          neigh = 
+0000e1c0: 6b64 7472 6565 2e71 7565 7279 280a 2020  kdtree.query(.  
+0000e1d0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+0000e1e0: 696e 7473 5f63 6c2c 0a20 2020 2020 2020  ints_cl,.       
+0000e1f0: 2020 2020 2020 2020 206b 3d6e 6569 6768           k=neigh
+0000e200: 626f 7273 5f6e 756d 2c0a 2020 2020 2020  bors_num,.      
+0000e210: 2020 2020 2020 2020 2020 6469 7374 616e            distan
+0000e220: 6365 5f75 7070 6572 5f62 6f75 6e64 3d64  ce_upper_bound=d
+0000e230: 6973 7461 6e63 655f 6c69 6d2c 0a20 2020  istance_lim,.   
+0000e240: 2020 2020 2020 2020 2029 5b31 5d0a 0a20           )[1].. 
+0000e250: 2020 2020 2020 2020 2020 2063 6c5f 7765             cl_we
+0000e260: 6967 6874 203d 2028 0a20 2020 2020 2020  ight = (.       
+0000e270: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+0000e280: 6e75 6d73 756d 286e 702e 7375 6d28 6e65  numsum(np.sum(ne
+0000e290: 6967 6820 3c20 6c65 6e28 6e65 6967 6829  igh < len(neigh)
+0000e2a0: 2c20 6178 6973 3d31 2920 3e20 3137 2920  , axis=1) > 17) 
+0000e2b0: 2f0a 2020 2020 2020 2020 2020 2020 2020  /.              
+0000e2c0: 2020 2020 2020 666c 6f61 7428 6c65 6e28        float(len(
+0000e2d0: 7072 6f62 655f 706f 696e 7473 2929 0a20  probe_points)). 
+0000e2e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0000e2f0: 2020 2020 2020 2020 2064 6973 7461 6e63           distanc
+0000e300: 6573 5f61 6c69 676e 203d 2064 6973 7461  es_align = dista
+0000e310: 6e63 6573 0a20 2020 2020 2020 2020 2020  nces.           
+0000e320: 2064 6973 7461 6e63 6573 5f73 656c 203d   distances_sel =
+0000e330: 2064 6973 7461 6e63 6573 5f61 6c69 676e   distances_align
+0000e340: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+0000e350: 2020 6e70 2e73 756d 286e 6569 6768 203c    np.sum(neigh <
+0000e360: 206c 656e 286e 6569 6768 292c 2061 7869   len(neigh), axi
+0000e370: 733d 3129 203e 2031 370a 2020 2020 2020  s=1) > 17.      
+0000e380: 2020 2020 2020 5d0a 2020 2020 2020 2020        ].        
+0000e390: 2020 2020 6469 7374 616e 6365 7320 3d20      distances = 
+0000e3a0: 6469 7374 616e 6365 735f 7365 6c5b 3a5d  distances_sel[:]
+0000e3b0: 0a0a 2020 2020 2020 2020 6f76 6572 6c61  ..        overla
+0000e3c0: 705f 6672 6571 203d 206e 702e 6869 7374  p_freq = np.hist
+0000e3d0: 6f67 7261 6d28 6469 7374 616e 6365 732c  ogram(distances,
+0000e3e0: 2062 696e 7329 5b30 5d0a 2020 2020 2020   bins)[0].      
+0000e3f0: 2020 746f 7461 6c20 3d20 746f 7461 6c5f    total = total_
+0000e400: 6578 740a 2020 2020 2020 2020 6375 6d75  ext.        cumu
+0000e410: 6c5f 6672 6571 203d 2030 2e30 0a20 2020  l_freq = 0.0.   
+0000e420: 2020 2020 2065 6e74 6572 203d 2030 0a20       enter = 0. 
+0000e430: 2020 2020 2020 2073 756d 5f73 6320 3d20         sum_sc = 
+0000e440: 302e 300a 2020 2020 2020 2020 666f 7220  0.0.        for 
+0000e450: 6920 696e 2072 616e 6765 286c 656e 286f  i in range(len(o
+0000e460: 7665 726c 6170 5f66 7265 7129 293a 0a20  verlap_freq)):. 
+0000e470: 2020 2020 2020 2020 2020 2077 203d 206c             w = l
+0000e480: 656e 286f 7665 726c 6170 5f66 7265 7129  en(overlap_freq)
+0000e490: 202d 2028 6929 0a20 2020 2020 2020 2020   - (i).         
+0000e4a0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000e4b0: 2020 2020 2020 2020 6375 6d75 6c5f 6672          cumul_fr
+0000e4c0: 6571 202b 3d20 6f76 6572 6c61 705f 6672  eq += overlap_fr
+0000e4d0: 6571 5b69 5d0a 2020 2020 2020 2020 2020  eq[i].          
+0000e4e0: 2020 6578 6365 7074 2049 6e64 6578 4572    except IndexEr
+0000e4f0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+0000e500: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+0000e510: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000e520: 2020 2020 2020 2020 2020 2070 6572 635f             perc_
+0000e530: 6571 7569 7620 3d20 666c 6f61 7428 6375  equiv = float(cu
+0000e540: 6d75 6c5f 6672 6571 2920 2f20 6e75 6d5f  mul_freq) / num_
+0000e550: 6469 7374 616e 6365 730a 2020 2020 2020  distances.      
+0000e560: 2020 2020 2020 6578 6365 7074 205a 6572        except Zer
+0000e570: 6f44 6976 6973 696f 6e45 7272 6f72 3a0a  oDivisionError:.
+0000e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e590: 7072 696e 7428 2744 6973 7461 6e63 6520  print('Distance 
+0000e5a0: 7765 6967 6874 696e 6720 6661 696c 6564  weighting failed
+0000e5b0: 2121 2e20 4368 6563 6b20 7375 7266 6163  !!. Check surfac
+0000e5c0: 6520 6465 6669 6e65 6427 290a 2020 2020  e defined').    
+0000e5d0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e5e0: 726e 204e 6f6e 652c 204e 6f6e 650a 2020  rn None, None.  
+0000e5f0: 2020 2020 2020 2020 2020 7375 6d5f 7363            sum_sc
+0000e600: 203d 2073 756d 5f73 6320 2b20 2828 7729   = sum_sc + ((w)
+0000e610: 202a 2070 6572 635f 6571 7569 7629 0a20   * perc_equiv). 
+0000e620: 2020 2020 2020 2020 2020 2074 6f74 616c             total
+0000e630: 202b 3d20 2877 290a 2020 2020 2020 2020   += (w).        
+0000e640: 2020 2020 656e 7465 7220 3d20 310a 2020      enter = 1.  
+0000e650: 2020 2020 2020 7363 6f72 6520 3d20 666c        score = fl
+0000e660: 6f61 7428 7375 6d5f 7363 2920 2f20 746f  oat(sum_sc) / to
+0000e670: 7461 6c0a 2020 2020 2020 2020 6966 2063  tal.        if c
+0000e680: 6c3a 2020 2320 6e6f 7161 3a46 3832 310a  l:  # noqa:F821.
+0000e690: 2020 2020 2020 2020 2020 2020 6966 2065              if e
+0000e6a0: 6e74 6572 203d 3d20 313a 0a20 2020 2020  nter == 1:.     
+0000e6b0: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+0000e6c0: 6e28 6469 7374 616e 6365 735f 7365 6c29  n(distances_sel)
+0000e6d0: 203d 3d20 302e 303a 0a20 2020 2020 2020   == 0.0:.       
+0000e6e0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e6f0: 7572 6e20 302e 300a 2020 2020 2020 2020  urn 0.0.        
+0000e700: 2020 2020 2020 2020 6966 206e 702e 6d65          if np.me
+0000e710: 616e 2864 6973 7461 6e63 6573 5f73 656c  an(distances_sel
+0000e720: 2920 3d3d 2030 2e30 3a0a 2020 2020 2020  ) == 0.0:.      
+0000e730: 2020 2020 2020 2020 2020 2020 2020 7265                re
+0000e740: 7475 726e 2030 2e30 0a20 2020 2020 2020  turn 0.0.       
+0000e750: 2020 2020 2020 2020 2069 6620 636c 5f77           if cl_w
+0000e760: 6569 6768 7420 3d3d 2030 2e30 3a0a 2020  eight == 0.0:.  
+0000e770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e780: 2020 7265 7475 726e 2030 2e30 0a20 2020    return 0.0.   
+0000e790: 2020 2020 2020 2020 2020 2020 2072 6574               ret
+0000e7a0: 7572 6e20 7363 6f72 650a 2020 2020 2020  urn score.      
+0000e7b0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
+0000e7c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e7d0: 726e 204e 6f6e 652c 204e 6f6e 650a 2020  rn None, None.  
+0000e7e0: 2020 2020 2020 6966 2065 6e74 6572 203d        if enter =
+0000e7f0: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+0000e800: 2069 6620 6e70 2e6d 6561 6e28 6469 7374   if np.mean(dist
+0000e810: 616e 6365 7329 203c 3d20 302e 3035 3a0a  ances) <= 0.05:.
+0000e820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e830: 7265 7475 726e 2031 2e30 0a20 2020 2020  return 1.0.     
+0000e840: 2020 2020 2020 2069 6620 6e70 2e6d 6561         if np.mea
+0000e850: 6e28 6469 7374 616e 6365 7329 203d 3d20  n(distances) == 
+0000e860: 302e 303a 0a20 2020 2020 2020 2020 2020  0.0:.           
+0000e870: 2020 2020 2072 6574 7572 6e20 312e 300a       return 1.0.
+0000e880: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000e890: 726e 2073 636f 7265 0a20 2020 2020 2020  rn score.       
+0000e8a0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000e8b0: 2020 2072 6574 7572 6e20 4e6f 6e65 2c20     return None, 
+0000e8c0: 4e6f 6e65 0a0a 2020 2020 6465 6620 656e  None..    def en
+0000e8d0: 7665 6c6f 7065 5f73 636f 7265 280a 2020  velope_score(.  
+0000e8e0: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
+0000e8f0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000e900: 7461 7267 6574 2c0a 2020 2020 2020 2020  target,.        
+0000e910: 2020 2020 7072 696d 6172 795f 626f 756e      primary_boun
+0000e920: 6461 7279 2c0a 2020 2020 2020 2020 2020  dary,.          
+0000e930: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
+0000e940: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+0000e950: 2020 6e6f 726d 3d54 7275 652c 0a20 2020    norm=True,.   
+0000e960: 2020 2020 2020 2020 2029 3a0a 2020 2020           ):.    
+0000e970: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0000e980: 4361 6c63 756c 6174 6520 7468 6520 656e  Calculate the en
+0000e990: 7665 6c6f 7065 2073 636f 7265 2062 6574  velope score bet
+0000e9a0: 7765 656e 2061 2074 6172 6765 7420 4d61  ween a target Ma
+0000e9b0: 7020 616e 6420 6120 5374 7275 6374 7572  p and a Structur
+0000e9c0: 650a 2020 2020 2020 2020 496e 7374 616e  e.        Instan
+0000e9d0: 6365 732e 0a0a 2020 2020 2020 2020 4172  ces...        Ar
+0000e9e0: 6775 6d65 6e74 733a 0a20 2020 2020 2020  guments:.       
+0000e9f0: 2020 2020 206d 6170 5f74 6172 6765 743a       map_target:
+0000ea00: 2054 6172 6765 7420 4d61 7020 496e 7374   Target Map Inst
+0000ea10: 616e 6365 2e0a 2020 2020 2020 2020 2020  ance..          
+0000ea20: 2020 7072 696d 6172 795f 626f 756e 6461    primary_bounda
+0000ea30: 7279 3a20 5661 6c75 6520 7370 6563 6966  ry: Value specif
+0000ea40: 6965 6420 6973 2063 616c 6375 6c61 7465  ied is calculate
+0000ea50: 6420 7769 7468 0a20 2020 2020 2020 2020  d with.         
+0000ea60: 2020 2020 2020 2070 7269 6d61 7279 5f62         primary_b
+0000ea70: 6f75 6e64 6172 7920 6f66 2074 6865 206d  oundary of the m
+0000ea80: 6170 206f 626a 6563 742e 0a20 2020 2020  ap object..     
+0000ea90: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+0000eaa0: 5f69 6e73 7461 6e63 653a 204d 6f64 656c  _instance: Model
+0000eab0: 2073 7472 7563 7475 7265 2069 6e73 7461   structure insta
+0000eac0: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+0000ead0: 206e 6f72 6d3a 204e 6f72 6d61 6c69 7365   norm: Normalise
+0000eae0: 2074 6865 2073 636f 7265 2062 6574 7765   the score betwe
+0000eaf0: 656e 2030 2061 6e64 2031 2069 6620 5472  en 0 and 1 if Tr
+0000eb00: 7565 2e0a 0a20 2020 2020 2020 2052 6574  ue...        Ret
+0000eb10: 7572 6e73 3a0a 2020 2020 2020 2020 2020  urns:.          
+0000eb20: 2020 456e 7665 6c6f 7065 2073 636f 7265    Envelope score
+0000eb30: 2c20 6e6f 726d 616c 6973 6564 2062 6574  , normalised bet
+0000eb40: 7765 656e 2030 2061 6e64 2031 2069 6620  ween 0 and 1 if 
+0000eb50: 6e6f 726d 2069 7320 5472 7565 0a0a 2020  norm is True..  
+0000eb60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+0000eb70: 2020 6269 6e4d 6170 203d 206d 6170 5f74    binMap = map_t
+0000eb80: 6172 6765 742e 6d61 6b65 5f62 696e 5f6d  arget.make_bin_m
+0000eb90: 6170 2870 7269 6d61 7279 5f62 6f75 6e64  ap(primary_bound
+0000eba0: 6172 7929 0a20 2020 2020 2020 206d 6178  ary).        max
+0000ebb0: 5f73 636f 7265 203d 2066 6c6f 6174 282d  _score = float(-
+0000ebc0: 3220 2a20 6e70 2e73 756d 2862 696e 4d61  2 * np.sum(binMa
+0000ebd0: 702e 6675 6c6c 4d61 7029 290a 2020 2020  p.fullMap)).    
+0000ebe0: 2020 2020 6d69 6e5f 7363 6f72 6520 3d20      min_score = 
+0000ebf0: 666c 6f61 7428 6e70 2e73 756d 2862 696e  float(np.sum(bin
+0000ec00: 4d61 702e 6675 6c6c 4d61 7029 2d32 202a  Map.fullMap)-2 *
+0000ec10: 206e 702e 7375 6d28 6269 6e4d 6170 2e66   np.sum(binMap.f
+0000ec20: 756c 6c4d 6170 2b31 2929 0a0a 2020 2020  ullMap+1))..    
+0000ec30: 2020 2020 626c 7572 7265 7220 3d20 5374      blurrer = St
+0000ec40: 7275 6374 7572 6542 6c75 7272 6572 2829  ructureBlurrer()
+0000ec50: 0a20 2020 2020 2020 2073 7472 7563 745f  .        struct_
+0000ec60: 6269 6e4d 6170 203d 2062 6c75 7272 6572  binMap = blurrer
+0000ec70: 2e6d 616b 655f 6174 6f6d 5f6f 7665 726c  .make_atom_overl
+0000ec80: 6179 5f6d 6170 3128 0a20 2020 2020 2020  ay_map1(.       
+0000ec90: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
+0000eca0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0000ecb0: 7563 7475 7265 5f69 6e73 7461 6e63 650a  ucture_instance.
+0000ecc0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000ecd0: 2020 6772 6964 203d 2073 7472 7563 745f    grid = struct_
+0000ece0: 6269 6e4d 6170 2e67 6574 5f70 6f73 2830  binMap.get_pos(0
+0000ecf0: 2e39 2c20 312e 3129 0a20 2020 2020 2020  .9, 1.1).       
+0000ed00: 2066 6f72 2078 2c20 792c 207a 2069 6e20   for x, y, z in 
+0000ed10: 6772 6964 3a0a 2020 2020 2020 2020 2020  grid:.          
+0000ed20: 2020 6720 3d20 6269 6e4d 6170 5b7a 5d5b    g = binMap[z][
+0000ed30: 795d 5b78 5d0a 2020 2020 2020 2020 2020  y][x].          
+0000ed40: 2020 6966 2067 203d 3d20 2d31 3a0a 2020    if g == -1:.  
+0000ed50: 2020 2020 2020 2020 2020 2020 2020 6269                bi
+0000ed60: 6e4d 6170 5b7a 5d5b 795d 5b78 5d20 3d20  nMap[z][y][x] = 
+0000ed70: 320a 2020 2020 2020 2020 2020 2020 656c  2.            el
+0000ed80: 6966 2067 203d 3d20 303a 0a20 2020 2020  if g == 0:.     
+0000ed90: 2020 2020 2020 2020 2020 2062 696e 4d61             binMa
+0000eda0: 705b 7a5d 5b79 5d5b 785d 203d 202d 320a  p[z][y][x] = -2.
+0000edb0: 2020 2020 2020 2020 7363 6f72 6520 3d20          score = 
+0000edc0: 666c 6f61 7428 6e70 2e73 756d 2862 696e  float(np.sum(bin
+0000edd0: 4d61 702e 6675 6c6c 4d61 7029 290a 2020  Map.fullMap)).  
+0000ede0: 2020 2020 2020 6966 206e 6f72 6d3a 0a20        if norm:. 
+0000edf0: 2020 2020 2020 2020 2020 206e 6f72 6d5f             norm_
+0000ee00: 7363 6f72 6520 3d20 666c 6f61 7428 2873  score = float((s
+0000ee10: 636f 7265 2d6d 696e 5f73 636f 7265 2920  core-min_score) 
+0000ee20: 2f20 286d 6178 5f73 636f 7265 2d6d 696e  / (max_score-min
+0000ee30: 5f73 636f 7265 2929 0a20 2020 2020 2020  _score)).       
+0000ee40: 2020 2020 2072 6574 7572 6e20 6e6f 726d       return norm
+0000ee50: 5f73 636f 7265 0a20 2020 2020 2020 2065  _score.        e
+0000ee60: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0000ee70: 2072 6574 7572 6e20 7363 6f72 650a 0a20   return score.. 
+0000ee80: 2020 2064 6566 2065 6e76 656c 6f70 655f     def envelope_
+0000ee90: 7363 6f72 655f 6d61 7028 0a20 2020 2020  score_map(.     
+0000eea0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000eeb0: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
+0000eec0: 6765 742c 0a20 2020 2020 2020 2020 2020  get,.           
+0000eed0: 206d 6170 5f70 726f 6265 2c0a 2020 2020   map_probe,.    
+0000eee0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+0000eef0: 6574 5f74 6872 6573 686f 6c64 3d30 2c0a  et_threshold=0,.
+0000ef00: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0000ef10: 7072 6f62 655f 7468 7265 7368 6f6c 643d  probe_threshold=
+0000ef20: 302c 0a20 2020 2020 2020 2020 2020 206e  0,.            n
+0000ef30: 6f72 6d3d 5472 7565 2c0a 2020 2020 293a  orm=True,.    ):
+0000ef40: 0a20 2020 2020 2020 2022 2222 4361 6c63  .        """Calc
+0000ef50: 756c 6174 6520 7468 6520 656e 7665 6c6f  ulate the envelo
+0000ef60: 7065 2073 636f 7265 2062 6574 7765 656e  pe score between
+0000ef70: 2074 776f 206d 6170 730a 0a20 2020 2020   two maps..     
+0000ef80: 2020 2041 7267 756d 656e 7473 3a0a 2020     Arguments:.  
+0000ef90: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
+0000efa0: 7267 6574 2c20 6d61 705f 7072 6f62 653a  rget, map_probe:
+0000efb0: 204d 6170 2069 6e73 7461 6e63 6520 746f   Map instance to
+0000efc0: 2063 6f6d 7061 7265 2e0a 2020 2020 2020   compare..      
+0000efd0: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
+0000efe0: 5f74 6872 6573 686f 6c64 2c20 6d61 705f  _threshold, map_
+0000eff0: 7072 6f62 655f 7468 7265 7368 6f6c 643a  probe_threshold:
+0000f000: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f010: 204d 6170 2074 6872 6573 686f 6c64 2074   Map threshold t
+0000f020: 6861 7420 6465 6669 6e65 7320 7468 6520  hat defines the 
+0000f030: 656e 7665 6c6f 7065 2c20 6f72 2073 7572  envelope, or sur
+0000f040: 6661 6365 2c20 6f66 2074 6865 0a20 2020  face, of the.   
+0000f050: 2020 2020 2020 2020 2020 2020 206d 6170               map
+0000f060: 2e20 5769 6c6c 2062 6520 6175 746f 6d61  . Will be automa
+0000f070: 7469 6361 6c6c 7920 6361 6c63 756c 6174  tically calculat
+0000f080: 6564 2075 7369 6e67 0a20 2020 2020 2020  ed using.       
+0000f090: 2020 2020 2020 2020 203a 6d65 7468 3a60           :meth:`
+0000f0a0: 7365 6c66 2e63 616c 6375 6c61 7465 5f6d  self.calculate_m
+0000f0b0: 6170 5f74 6872 6573 686f 6c64 203c 5445  ap_threshold <TE
+0000f0c0: 4d50 792e 7072 6f74 6569 6e2e 7363 6f72  MPy.protein.scor
+0000f0d0: 696e 675f 6675 6e63 7469 6f6e 732e 5363  ing_functions.Sc
+0000f0e0: 6f72 696e 6746 756e 6374 696f 6e73 2e63  oringFunctions.c
+0000f0f0: 616c 6375 6c61 7465 5f6d 6170 5f74 6872  alculate_map_thr
+0000f100: 6573 686f 6c64 3e60 0a20 2020 2020 2020  eshold>`.       
+0000f110: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+0000f120: 7370 6563 6966 6965 642e 0a20 2020 2020  specified..     
+0000f130: 2020 2020 2020 206e 6f72 6d3a 204e 6f72         norm: Nor
+0000f140: 6d61 6c69 7365 2074 6865 2073 636f 7265  malise the score
+0000f150: 2062 6574 7765 656e 2030 2061 6e64 2031   between 0 and 1
+0000f160: 2069 6620 5472 7565 2e0a 0a20 2020 2020   if True...     
+0000f170: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+0000f180: 2020 2020 2020 2020 456e 7665 6c6f 7065          Envelope
+0000f190: 2073 636f 7265 2c20 6e6f 726d 616c 6973   score, normalis
+0000f1a0: 6564 2062 6574 7765 656e 2030 2061 6e64  ed between 0 and
+0000f1b0: 2031 2069 6620 6e6f 726d 2069 7320 5472   1 if norm is Tr
+0000f1c0: 7565 0a20 2020 2020 2020 2022 2222 0a20  ue.        """. 
+0000f1d0: 2020 2020 2020 2069 6620 7365 6c66 2e6d         if self.m
+0000f1e0: 6170 436f 6d70 6172 6973 6f6e 286d 6170  apComparison(map
+0000f1f0: 5f74 6172 6765 742c 206d 6170 5f70 726f  _target, map_pro
+0000f200: 6265 293a 0a20 2020 2020 2020 2020 2020  be):.           
+0000f210: 2069 6620 6d61 705f 7461 7267 6574 5f74   if map_target_t
+0000f220: 6872 6573 686f 6c64 203d 3d20 303a 0a20  hreshold == 0:. 
+0000f230: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000f240: 6170 5f74 6172 6765 745f 7468 7265 7368  ap_target_thresh
+0000f250: 6f6c 6420 3d20 7365 6c66 2e63 616c 6375  old = self.calcu
+0000f260: 6c61 7465 5f6d 6170 5f74 6872 6573 686f  late_map_thresho
+0000f270: 6c64 286d 6170 5f74 6172 6765 7429 0a20  ld(map_target). 
+0000f280: 2020 2020 2020 2020 2020 2069 6620 6d61             if ma
+0000f290: 705f 7072 6f62 655f 7468 7265 7368 6f6c  p_probe_threshol
+0000f2a0: 6420 3d3d 2030 3a0a 2020 2020 2020 2020  d == 0:.        
+0000f2b0: 2020 2020 2020 2020 6d61 705f 7072 6f62          map_prob
+0000f2c0: 655f 7468 7265 7368 6f6c 6420 3d20 7365  e_threshold = se
+0000f2d0: 6c66 2e63 616c 6375 6c61 7465 5f6d 6170  lf.calculate_map
+0000f2e0: 5f74 6872 6573 686f 6c64 286d 6170 5f70  _threshold(map_p
+0000f2f0: 726f 6265 290a 0a20 2020 2020 2020 2062  robe)..        b
+0000f300: 696e 4d61 7020 3d20 6d61 705f 7461 7267  inMap = map_targ
+0000f310: 6574 2e6d 616b 655f 6269 6e5f 6d61 7028  et.make_bin_map(
+0000f320: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
+0000f330: 686f 6c64 290a 2020 2020 2020 2020 6d61  hold).        ma
+0000f340: 785f 7363 6f72 6520 3d20 666c 6f61 7428  x_score = float(
+0000f350: 2d32 202a 206e 702e 7375 6d28 6269 6e4d  -2 * np.sum(binM
+0000f360: 6170 2e66 756c 6c4d 6170 2929 0a20 2020  ap.fullMap)).   
+0000f370: 2020 2020 206d 696e 5f73 636f 7265 203d       min_score =
+0000f380: 2066 6c6f 6174 280a 2020 2020 2020 2020   float(.        
+0000f390: 2020 2020 6e70 2e73 756d 2862 696e 4d61      np.sum(binMa
+0000f3a0: 702e 6675 6c6c 4d61 7029 2d32 202a 206e  p.fullMap)-2 * n
+0000f3b0: 702e 7375 6d28 6269 6e4d 6170 2e66 756c  p.sum(binMap.ful
+0000f3c0: 6c4d 6170 202b 2031 290a 2020 2020 2020  lMap + 1).      
+0000f3d0: 2020 290a 2020 2020 2020 2020 7374 7275    ).        stru
+0000f3e0: 6374 5f62 696e 4d61 7020 3d20 6d61 705f  ct_binMap = map_
+0000f3f0: 7072 6f62 652e 6d61 6b65 5f62 696e 5f6d  probe.make_bin_m
+0000f400: 6170 286d 6170 5f70 726f 6265 5f74 6872  ap(map_probe_thr
+0000f410: 6573 686f 6c64 290a 2020 2020 2020 2020  eshold).        
+0000f420: 6e65 774d 6170 203d 2062 696e 4d61 702e  newMap = binMap.
+0000f430: 6675 6c6c 4d61 7020 2b20 3220 2a20 7374  fullMap + 2 * st
+0000f440: 7275 6374 5f62 696e 4d61 702e 6675 6c6c  ruct_binMap.full
+0000f450: 4d61 700a 2020 2020 2020 2020 6869 7374  Map.        hist
+0000f460: 5f61 7272 6179 203d 206e 702e 6869 7374  _array = np.hist
+0000f470: 6f67 7261 6d28 6e65 774d 6170 2c20 3429  ogram(newMap, 4)
+0000f480: 0a20 2020 2020 2020 2073 636f 7265 203d  .        score =
+0000f490: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0000f4a0: 2020 2032 202a 0a20 2020 2020 2020 2020     2 *.         
+0000f4b0: 2020 2020 2020 2068 6973 745f 6172 7261         hist_arra
+0000f4c0: 795b 305d 5b30 5d20 2d0a 2020 2020 2020  y[0][0] -.      
+0000f4d0: 2020 2020 2020 2020 2020 2832 202a 2028            (2 * (
+0000f4e0: 6869 7374 5f61 7272 6179 5b30 5d5b 315d  hist_array[0][1]
+0000f4f0: 2929 202d 0a20 2020 2020 2020 2020 2020  )) -.           
+0000f500: 2020 2020 2028 6869 7374 5f61 7272 6179       (hist_array
+0000f510: 5b30 5d5b 325d 290a 2020 2020 2020 2020  [0][2]).        
+0000f520: 290a 2020 2020 2020 2020 6966 206e 6f72  ).        if nor
+0000f530: 6d3a 0a20 2020 2020 2020 2020 2020 206e  m:.            n
+0000f540: 6f72 6d5f 7363 6f72 6520 3d20 666c 6f61  orm_score = floa
+0000f550: 7428 2873 636f 7265 202d 206d 696e 5f73  t((score - min_s
+0000f560: 636f 7265 2929 202f 2028 6d61 785f 7363  core)) / (max_sc
+0000f570: 6f72 6520 2d20 6d69 6e5f 7363 6f72 6529  ore - min_score)
+0000f580: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000f590: 7572 6e20 6e6f 726d 5f73 636f 7265 0a20  urn norm_score. 
+0000f5a0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000f5b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000f5c0: 7363 6f72 650a 0a20 2020 2064 6566 205f  score..    def _
+0000f5d0: 7065 7263 656e 745f 6f76 6572 6c61 7028  percent_overlap(
+0000f5e0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000f5f0: 662c 0a20 2020 2020 2020 2020 2020 206d  f,.            m
+0000f600: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
+0000f610: 2020 2020 2020 206d 6170 5f70 726f 6265         map_probe
+0000f620: 2c0a 2020 2020 2020 2020 2020 2020 6d61  ,.            ma
+0000f630: 705f 7461 7267 6574 5f74 6872 6573 686f  p_target_thresho
+0000f640: 6c64 2c0a 2020 2020 2020 2020 2020 2020  ld,.            
+0000f650: 6d61 705f 7072 6f62 655f 7468 7265 7368  map_probe_thresh
+0000f660: 6f6c 642c 0a20 2020 2020 2020 2020 2020  old,.           
+0000f670: 2066 6c61 6773 697a 653d 302c 0a20 2020   flagsize=0,.   
+0000f680: 2029 3a0a 2020 2020 2020 2020 2222 2243   ):.        """C
+0000f690: 616c 6375 6c61 7465 2074 6865 2066 7261  alculate the fra
+0000f6a0: 6374 696f 6e20 6f66 206f 7665 726c 6170  ction of overlap
+0000f6b0: 2062 6574 7765 656e 2074 776f 206d 6170   between two map
+0000f6c0: 2067 7269 6473 2e0a 0a20 2020 2020 2020   grids...       
+0000f6d0: 2041 7267 756d 656e 7473 3a0a 2020 2020   Arguments:.    
+0000f6e0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+0000f6f0: 6574 2c20 6d61 705f 7072 6f62 653a 204d  et, map_probe: M
+0000f700: 6170 2069 6e73 7461 6e63 6520 746f 2063  ap instance to c
+0000f710: 6f6d 7061 7265 2e0a 2020 2020 2020 2020  ompare..        
+0000f720: 2020 2020 6d61 705f 7461 7267 6574 5f74      map_target_t
+0000f730: 6872 6573 686f 6c64 2c20 6d61 705f 7072  hreshold, map_pr
+0000f740: 6f62 655f 7468 7265 7368 6f6c 643a 0a20  obe_threshold:. 
+0000f750: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000f760: 6170 2063 6f6e 746f 7572 2074 6872 6573  ap contour thres
+0000f770: 686f 6c64 7320 666f 7220 6d61 705f 7461  holds for map_ta
+0000f780: 7267 6574 2061 6e64 206d 6170 5f70 726f  rget and map_pro
+0000f790: 6265 2e0a 2020 2020 2020 2020 5265 7475  be..        Retu
+0000f7a0: 726e 3a0a 2020 2020 2020 2020 2020 2020  rn:.            
+0000f7b0: 5065 7263 656e 7420 6f76 6572 6c61 7020  Percent overlap 
+0000f7c0: 7769 7468 2072 6573 7065 6374 2074 6f20  with respect to 
+0000f7d0: 736d 616c 6c65 7220 6772 6964 0a20 2020  smaller grid.   
+0000f7e0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000f7f0: 2069 6620 7365 6c66 2e6d 6170 436f 6d70   if self.mapComp
+0000f800: 6172 6973 6f6e 286d 6170 5f74 6172 6765  arison(map_targe
+0000f810: 742c 206d 6170 5f70 726f 6265 293a 0a20  t, map_probe):. 
+0000f820: 2020 2020 2020 2020 2020 2062 696e 6d61             binma
+0000f830: 7031 203d 206d 6170 5f74 6172 6765 742e  p1 = map_target.
+0000f840: 6675 6c6c 4d61 7020 3e20 666c 6f61 7428  fullMap > float(
+0000f850: 6d61 705f 7461 7267 6574 5f74 6872 6573  map_target_thres
+0000f860: 686f 6c64 290a 2020 2020 2020 2020 2020  hold).          
+0000f870: 2020 6269 6e6d 6170 3220 3d20 6d61 705f    binmap2 = map_
+0000f880: 7072 6f62 652e 6675 6c6c 4d61 7020 3e20  probe.fullMap > 
+0000f890: 666c 6f61 7428 6d61 705f 7072 6f62 655f  float(map_probe_
+0000f8a0: 7468 7265 7368 6f6c 6429 0a20 2020 2020  threshold).     
+0000f8b0: 2020 2020 2020 206d 696e 696d 203d 206c         minim = l
+0000f8c0: 656e 286d 6170 5f74 6172 6765 742e 6675  en(map_target.fu
+0000f8d0: 6c6c 4d61 705b 6269 6e6d 6170 315d 290a  llMap[binmap1]).
+0000f8e0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
+0000f8f0: 656e 286d 6170 5f70 726f 6265 2e66 756c  en(map_probe.ful
+0000f900: 6c4d 6170 5b62 696e 6d61 7032 5d29 203c  lMap[binmap2]) <
+0000f910: 206d 696e 696d 3a0a 2020 2020 2020 2020   minim:.        
+0000f920: 2020 2020 2020 2020 6d69 6e69 6d20 3d20          minim = 
+0000f930: 6c65 6e28 6d61 705f 7072 6f62 652e 6675  len(map_probe.fu
+0000f940: 6c6c 4d61 705b 6269 6e6d 6170 325d 290a  llMap[binmap2]).
+0000f950: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0000f960: 6d61 7020 3d20 2862 696e 6d61 7031 202a  map = (binmap1 *
+0000f970: 2062 696e 6d61 7032 2920 3e20 300a 2020   binmap2) > 0.  
+0000f980: 2020 2020 2020 2020 2020 6966 2066 6c61            if fla
+0000f990: 6773 697a 6520 3d3d 2031 3a0a 2020 2020  gsize == 1:.    
+0000f9a0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0000f9b0: 726e 206e 702e 7375 6d28 6d61 736b 6d61  rn np.sum(maskma
+0000f9c0: 7029 2c20 6e70 2e73 756d 2862 696e 6d61  p), np.sum(binma
+0000f9d0: 7031 292c 206e 702e 7375 6d28 6269 6e6d  p1), np.sum(binm
+0000f9e0: 6170 3229 0a20 2020 2020 2020 2020 2020  ap2).           
+0000f9f0: 2069 6620 6e6f 7420 6d69 6e69 6d20 3d3d   if not minim ==
+0000fa00: 2030 2e30 3a0a 2020 2020 2020 2020 2020   0.0:.          
+0000fa10: 2020 2020 2020 7265 7475 726e 2066 6c6f        return flo
+0000fa20: 6174 286c 656e 286d 6170 5f74 6172 6765  at(len(map_targe
+0000fa30: 742e 6675 6c6c 4d61 705b 6d61 736b 6d61  t.fullMap[maskma
+0000fa40: 705d 2929 2f6d 696e 696d 0a20 2020 2020  p]))/minim.     
+0000fa50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000fa60: 2020 2020 2020 2020 2020 2020 2070 7269               pri
+0000fa70: 6e74 2827 4368 6563 6b20 6d61 7020 636f  nt('Check map co
+0000fa80: 6e74 6f75 7221 2127 290a 2020 2020 2020  ntour!!').      
+0000fa90: 2020 2020 2020 2020 2020 7265 7475 726e            return
+0000faa0: 2030 2e30 0a20 2020 2020 2020 2065 6c73   0.0.        els
+0000fab0: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0000fac0: 7269 6e74 2827 4040 4020 4d61 7073 2063  rint('@@@ Maps c
+0000fad0: 6f75 6c64 206e 6f74 2062 6520 6d61 7463  ould not be matc
+0000fae0: 6865 6427 290a 2020 2020 2020 2020 2020  hed').          
+0000faf0: 2020 7265 7475 726e 202d 312e 300a 0a20    return -1.0.. 
+0000fb00: 2020 2064 6566 2053 4343 4328 0a20 2020     def SCCC(.   
+0000fb10: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+0000fb20: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
+0000fb30: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
+0000fb40: 2020 2072 6573 6f6c 7574 696f 6e5f 6465     resolution_de
+0000fb50: 6e73 4d61 702c 0a20 2020 2020 2020 2020  nsMap,.         
+0000fb60: 2020 2073 6967 6d61 5f6d 6170 2c0a 2020     sigma_map,.  
+0000fb70: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+0000fb80: 7572 655f 696e 7374 616e 6365 2c0a 2020  ure_instance,.  
+0000fb90: 2020 2020 2020 2020 2020 7269 6769 645f            rigid_
+0000fba0: 626f 6479 5f73 7472 7563 7475 7265 2c0a  body_structure,.
+0000fbb0: 2020 2020 2020 2020 2020 2020 7772 6974              writ
+0000fbc0: 653d 4661 6c73 652c 0a20 2020 2020 2020  e=False,.       
+0000fbd0: 2020 2020 2063 5f6d 6f64 653d 4661 6c73       c_mode=Fals
+0000fbe0: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+0000fbf0: 2020 2222 2243 616c 6375 6c61 7465 206c    """Calculate l
+0000fc00: 6f63 616c 2063 726f 7373 2d63 6f72 7265  ocal cross-corre
+0000fc10: 6c61 7469 6f6e 2066 6f72 2061 2073 6567  lation for a seg
+0000fc20: 6d65 6e74 206f 6620 6120 7072 6f74 6569  ment of a protei
+0000fc30: 6e20 6d6f 6465 6c0a 0a20 2020 2020 2020  n model..       
+0000fc40: 2053 6567 6d65 6e74 7320 6172 6520 6465   Segments are de
+0000fc50: 6669 6e65 6420 7573 696e 6720 6120 7269  fined using a ri
+0000fc60: 6769 642d 626f 6479 2073 7472 7563 7475  gid-body structu
+0000fc70: 7265 2069 6e73 7461 6e63 652c 2077 6869  re instance, whi
+0000fc80: 6368 2063 616e 0a20 2020 2020 2020 2062  ch can.        b
+0000fc90: 6520 6765 6e65 7261 7465 6420 7573 696e  e generated usin
+0000fca0: 6720 6052 4942 4649 4e44 203c 6874 7470  g `RIBFIND <http
+0000fcb0: 733a 2f2f 7269 6266 696e 642e 6973 6d62  s://ribfind.ismb
+0000fcc0: 2e6c 6f6e 2e61 632e 756b 2f3e 605f 2e0a  .lon.ac.uk/>`_..
+0000fcd0: 2020 2020 2020 2020 5468 6520 4343 4320          The CCC 
+0000fce0: 6973 2063 616c 6375 6c61 7465 6420 7573  is calculated us
+0000fcf0: 696e 670a 2020 2020 2020 2020 3a6d 6574  ing.        :met
+0000fd00: 683a 6043 4343 5f6d 6170 203c 5445 4d50  h:`CCC_map <TEMP
+0000fd10: 792e 7072 6f74 6569 6e2e 7363 6f72 696e  y.protein.scorin
+0000fd20: 675f 6675 6e63 7469 6f6e 732e 5363 6f72  g_functions.Scor
+0000fd30: 696e 6746 756e 6374 696f 6e73 2e43 4343  ingFunctions.CCC
+0000fd40: 5f6d 6170 3e60 2e0a 0a20 2020 2020 2020  _map>`...       
+0000fd50: 2049 6d70 6c65 6d65 6e74 6174 696f 6e20   Implementation 
+0000fd60: 6469 7363 7573 7365 6420 696e 206d 6f72  discussed in mor
+0000fd70: 6520 6465 7461 696c 2061 7420 7468 6520  e detail at the 
+0000fd80: 666f 6c6c 6f77 696e 6720 7265 6665 7265  following refere
+0000fd90: 6e63 653a 0a20 2020 2020 2020 2020 2020  nce:.           
+0000fda0: 202a 2060 5061 6e64 7572 616e 6761 6e20   * `Pandurangan 
+0000fdb0: 6574 2061 6c2e 2c20 4a20 5374 7275 6374  et al., J Struct
+0000fdc0: 2042 696f 6c2e 2032 3031 3320 4465 6320   Biol. 2013 Dec 
+0000fdd0: 3132 203c 6874 7470 733a 2f2f 7777 772e  12 <https://www.
+0000fde0: 6e63 6269 2e6e 6c6d 2e6e 6968 2e67 6f76  ncbi.nlm.nih.gov
+0000fdf0: 2f70 6d63 2f61 7274 6963 6c65 732f 504d  /pmc/articles/PM
+0000fe00: 4333 3938 3839 3232 2f3e 605f 0a0a 2020  C3988922/>`_..  
+0000fe10: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
+0000fe20: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+0000fe30: 6574 3a20 4d61 7020 496e 7374 616e 6365  et: Map Instance
+0000fe40: 2e0a 2020 2020 2020 2020 2020 2020 7265  ..            re
+0000fe50: 736f 6c75 7469 6f6e 5f64 656e 734d 6170  solution_densMap
+0000fe60: 3a20 5265 736f 6c75 7469 6f6e 206f 6620  : Resolution of 
+0000fe70: 7468 6520 696e 7075 7420 6d61 702e 0a20  the input map.. 
+0000fe80: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
+0000fe90: 5f6d 6170 3a20 5061 7261 6d65 7465 7220  _map: Parameter 
+0000fea0: 6e65 6564 2066 6f72 2053 7472 7563 7475  need for Structu
+0000feb0: 7265 2042 6c75 7272 6572 2e20 4675 6c6c  re Blurrer. Full
+0000fec0: 2065 7870 6c61 6e61 7469 6f6e 0a20 2020   explanation.   
+0000fed0: 2020 2020 2020 2020 2020 2020 203a 7265               :re
+0000fee0: 663a 6068 6572 653c 4e6f 7465 206f 6e20  f:`here<Note on 
+0000fef0: 7265 616c 2073 7061 6365 2062 6c75 7272  real space blurr
+0000ff00: 696e 673a 3e60 0a20 2020 2020 2020 2020  ing:>`.         
+0000ff10: 2020 2073 7472 7563 7475 7265 5f69 6e73     structure_ins
+0000ff20: 7461 6e63 653a 2053 7472 7563 7475 7265  tance: Structure
+0000ff30: 2069 6e73 7461 6e63 6520 746f 2063 6f6d   instance to com
+0000ff40: 7061 7265 0a20 2020 2020 2020 2020 2020  pare.           
+0000ff50: 2072 6967 6964 5f62 6f64 795f 7374 7275   rigid_body_stru
+0000ff60: 6374 7572 653a 2052 6967 6964 2d62 6f64  cture: Rigid-bod
+0000ff70: 7920 5374 7275 6374 7572 6520 696e 7374  y Structure inst
+0000ff80: 616e 6365 2074 6861 7420 6465 6669 6e65  ance that define
+0000ff90: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+0000ffa0: 2020 7468 6520 7365 676d 656e 742e 0a20    the segment.. 
+0000ffb0: 2020 2020 2020 2020 2020 2077 7269 7465             write
+0000ffc0: 3a20 4966 2054 7275 652c 2061 2073 7472  : If True, a str
+0000ffd0: 696e 6720 6973 2072 6574 7572 6e65 6420  ing is returned 
+0000ffe0: 7769 7468 2066 6f72 6d61 7420 3a63 6f64  with format :cod
+0000fff0: 653a 6066 2753 4343 4320 666f 7220 7365  e:`f'SCCC for se
+00010000: 676d 656e 7420 7b53 4343 435f 7363 6f72  gment {SCCC_scor
+00010010: 657d 2760 0a20 2020 2020 2020 2020 2020  e}'`.           
+00010020: 2063 5f6d 6f64 653a 204e 6f20 6c6f 6e67   c_mode: No long
+00010030: 6572 2069 6e20 7573 650a 2020 2020 2020  er in use.      
+00010040: 2020 5265 7475 726e 733a 0a20 2020 2020    Returns:.     
+00010050: 2020 2020 2020 2066 6c6f 6174 2069 6620         float if 
+00010060: 3a63 6f64 653a 6077 7269 7465 3d46 616c  :code:`write=Fal
+00010070: 7365 602c 2065 6c73 6520 7374 7269 6e67  se`, else string
+00010080: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010090: 2020 5343 4343 2053 636f 7265 0a20 2020    SCCC Score.   
+000100a0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+000100b0: 2062 6c75 7272 6572 203d 2053 7472 7563   blurrer = Struc
+000100c0: 7475 7265 426c 7572 7265 7228 290a 2020  tureBlurrer().  
+000100d0: 2020 2020 2020 7363 6f72 6572 203d 2053        scorer = S
+000100e0: 636f 7269 6e67 4675 6e63 7469 6f6e 7328  coringFunctions(
+000100f0: 290a 2020 2020 2020 2020 6f75 746c 696e  ).        outlin
+00010100: 6520 3d20 2222 0a20 2020 2020 2020 2072  e = "".        r
+00010110: 6573 6f6c 7574 696f 6e5f 6465 6e73 4d61  esolution_densMa
+00010120: 7020 3d20 666c 6f61 7428 7265 736f 6c75  p = float(resolu
+00010130: 7469 6f6e 5f64 656e 734d 6170 290a 2020  tion_densMap).  
+00010140: 2020 2020 2020 7768 6f6c 655f 6669 745f        whole_fit_
+00010150: 6d61 7020 3d20 626c 7572 7265 722e 6761  map = blurrer.ga
+00010160: 7573 7369 616e 5f62 6c75 7228 0a20 2020  ussian_blur(.   
+00010170: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+00010180: 7265 5f69 6e73 7461 6e63 652c 0a20 2020  re_instance,.   
+00010190: 2020 2020 2020 2020 2072 6573 6f6c 7574           resolut
+000101a0: 696f 6e5f 6465 6e73 4d61 702c 0a20 2020  ion_densMap,.   
+000101b0: 2020 2020 2020 2020 2064 656e 734d 6170           densMap
+000101c0: 3d6d 6170 5f74 6172 6765 742c 0a20 2020  =map_target,.   
+000101d0: 2020 2020 2020 2020 2073 6967 6d61 5f63           sigma_c
+000101e0: 6f65 6666 3d73 6967 6d61 5f6d 6170 2c0a  oeff=sigma_map,.
+000101f0: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+00010200: 616c 6973 653d 5472 7565 2c0a 2020 2020  alise=True,.    
+00010210: 2020 2020 290a 2020 2020 2020 2020 7369      ).        si
+00010220: 6d5f 6d61 7020 3d20 626c 7572 7265 722e  m_map = blurrer.
+00010230: 6761 7573 7369 616e 5f62 6c75 7228 0a20  gaussian_blur(. 
+00010240: 2020 2020 2020 2020 2020 2072 6967 6964             rigid
+00010250: 5f62 6f64 795f 7374 7275 6374 7572 652c  _body_structure,
+00010260: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00010270: 6f6c 7574 696f 6e5f 6465 6e73 4d61 702c  olution_densMap,
+00010280: 0a20 2020 2020 2020 2020 2020 2064 656e  .            den
+00010290: 734d 6170 3d6d 6170 5f74 6172 6765 742c  sMap=map_target,
+000102a0: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
+000102b0: 6d61 5f63 6f65 6666 3d73 6967 6d61 5f6d  ma_coeff=sigma_m
+000102c0: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+000102d0: 6e6f 726d 616c 6973 653d 5472 7565 2c0a  normalise=True,.
+000102e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000102f0: 2020 6d69 6e44 656e 7320 3d20 7369 6d5f    minDens = sim_
+00010300: 6d61 702e 7374 6428 290a 2020 2020 2020  map.std().      
+00010310: 2020 7369 6d5f 6d61 736b 5f61 7272 6179    sim_mask_array
+00010320: 203d 2073 696d 5f6d 6170 2e5f 6765 745f   = sim_map._get_
+00010330: 6d61 736b 4172 7261 7928 6d69 6e44 656e  maskArray(minDen
+00010340: 7329 0a20 2020 2020 2020 206d 6173 6b5f  s).        mask_
+00010350: 656d 4d61 7020 3d20 6d61 705f 7461 7267  emMap = map_targ
+00010360: 6574 2e5f 6765 745f 6d61 736b 4d61 7028  et._get_maskMap(
+00010370: 7369 6d5f 6d61 736b 5f61 7272 6179 290a  sim_mask_array).
+00010380: 2020 2020 2020 2020 6d61 736b 5f73 696d          mask_sim
+00010390: 4d61 7020 3d20 7768 6f6c 655f 6669 745f  Map = whole_fit_
+000103a0: 6d61 702e 5f67 6574 5f6d 6173 6b4d 6170  map._get_maskMap
+000103b0: 2873 696d 5f6d 6173 6b5f 6172 7261 7929  (sim_mask_array)
+000103c0: 0a20 2020 2020 2020 2073 7365 5f6c 6363  .        sse_lcc
+000103d0: 662c 206f 7620 3d20 7363 6f72 6572 2e43  f, ov = scorer.C
+000103e0: 4343 5f6d 6170 286d 6173 6b5f 656d 4d61  CC_map(mask_emMa
+000103f0: 702c 206d 6173 6b5f 7369 6d4d 6170 2c20  p, mask_simMap, 
+00010400: 636d 6f64 653d 635f 6d6f 6465 290a 2020  cmode=c_mode).  
+00010410: 2020 2020 2020 6966 2077 7269 7465 2069        if write i
+00010420: 7320 5472 7565 3a0a 2020 2020 2020 2020  s True:.        
+00010430: 2020 2020 6f75 746c 696e 6520 2b3d 2027      outline += '
+00010440: 5343 4343 2066 6f72 2073 6567 6d65 6e74  SCCC for segment
+00010450: 2025 665c 6e27 2025 2028 7373 655f 6c63   %f\n' % (sse_lc
+00010460: 6366 290a 2020 2020 2020 2020 2020 2020  cf).            
+00010470: 7265 7475 726e 206f 7574 6c69 6e65 0a20  return outline. 
+00010480: 2020 2020 2020 2072 6574 7572 6e20 7373         return ss
+00010490: 655f 6c63 6366 0a0a 2020 2020 6465 6620  e_lccf..    def 
+000104a0: 5343 4343 5f4c 4150 280a 2020 2020 2020  SCCC_LAP(.      
+000104b0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+000104c0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+000104d0: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+000104e0: 7265 736f 6c75 7469 6f6e 5f64 656e 734d  resolution_densM
+000104f0: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00010500: 7369 676d 615f 6d61 702c 0a20 2020 2020  sigma_map,.     
+00010510: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+00010520: 5f69 6e73 7461 6e63 652c 0a20 2020 2020  _instance,.     
+00010530: 2020 2020 2020 2072 6967 6964 5f62 6f64         rigid_bod
+00010540: 795f 7374 7275 6374 7572 652c 0a20 2020  y_structure,.   
+00010550: 2020 2020 2020 2020 2077 7269 7465 3d46           write=F
+00010560: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+00010570: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00010580: 6520 7468 6520 4c61 706c 6163 6961 6e20  e the Laplacian 
+00010590: 6669 6c74 6572 6564 2063 726f 7373 2063  filtered cross c
+000105a0: 6f72 7265 6c61 7469 6f6e 2066 6f72 2061  orrelation for a
+000105b0: 2073 6567 6d65 6e74 206f 660a 2020 2020   segment of.    
+000105c0: 2020 2020 6120 7072 6f74 6569 6e20 6d6f      a protein mo
+000105d0: 6465 6c2e 0a0a 2020 2020 2020 2020 5365  del...        Se
+000105e0: 676d 656e 7473 2061 7265 2064 6566 696e  gments are defin
+000105f0: 6564 2075 7369 6e67 2061 2072 6967 6964  ed using a rigid
+00010600: 2d62 6f64 7920 7374 7275 6374 7572 6520  -body structure 
+00010610: 696e 7374 616e 6365 2c20 7768 6963 6820  instance, which 
+00010620: 6361 6e0a 2020 2020 2020 2020 6265 2067  can.        be g
+00010630: 656e 6572 6174 6564 2075 7369 6e67 2060  enerated using `
+00010640: 5249 4246 494e 4420 3c68 7474 7073 3a2f  RIBFIND <https:/
+00010650: 2f72 6962 6669 6e64 2e69 736d 622e 6c6f  /ribfind.ismb.lo
+00010660: 6e2e 6163 2e75 6b2f 3e60 5f2e 0a20 2020  n.ac.uk/>`_..   
+00010670: 2020 2020 2053 636f 7265 2063 616c 6375       Score calcu
+00010680: 6c61 7465 6420 7573 696e 670a 2020 2020  lated using.    
+00010690: 2020 2020 3a6d 6574 683a 606c 6170 6c61      :meth:`lapla
+000106a0: 6365 5f43 4343 203c 5445 4d50 792e 7072  ce_CCC <TEMPy.pr
+000106b0: 6f74 6569 6e2e 7363 6f72 696e 675f 6675  otein.scoring_fu
+000106c0: 6e63 7469 6f6e 732e 5363 6f72 696e 6746  nctions.ScoringF
+000106d0: 756e 6374 696f 6e73 2e6c 6170 6c61 6365  unctions.laplace
+000106e0: 5f43 4343 3e60 0a0a 2020 2020 2020 2020  _CCC>`..        
+000106f0: 4172 6775 6d65 6e74 733a 0a20 2020 2020  Arguments:.     
+00010700: 2020 2020 2020 206d 6170 5f74 6172 6765         map_targe
+00010710: 743a 204d 6170 2049 6e73 7461 6e63 652e  t: Map Instance.
+00010720: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00010730: 6f6c 7574 696f 6e5f 6465 6e73 4d61 703a  olution_densMap:
+00010740: 2052 6573 6f6c 7574 696f 6e20 6f66 2074   Resolution of t
+00010750: 6865 206d 6170 2069 6e73 7461 6e63 652e  he map instance.
+00010760: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
+00010770: 6d61 5f6d 6170 3a20 5061 7261 6d65 7465  ma_map: Paramete
+00010780: 7220 6e65 6564 2066 6f72 2053 7472 7563  r need for Struc
+00010790: 7475 7265 2042 6c75 7272 6572 2e20 4675  ture Blurrer. Fu
+000107a0: 6c6c 2065 7870 6c61 6e61 7469 6f6e 0a20  ll explanation. 
+000107b0: 2020 2020 2020 2020 2020 2020 2020 203a                 :
+000107c0: 7265 663a 6068 6572 653c 4e6f 7465 206f  ref:`here<Note o
+000107d0: 6e20 7265 616c 2073 7061 6365 2062 6c75  n real space blu
+000107e0: 7272 696e 673a 3e60 0a20 2020 2020 2020  rring:>`.       
+000107f0: 2020 2020 2073 7472 7563 7475 7265 5f69       structure_i
+00010800: 6e73 7461 6e63 653a 2053 7472 7563 7475  nstance: Structu
+00010810: 7265 2069 6e73 7461 6e63 6520 746f 2063  re instance to c
+00010820: 6f6d 7061 7265 0a20 2020 2020 2020 2020  ompare.         
+00010830: 2020 2072 6967 6964 5f62 6f64 795f 7374     rigid_body_st
+00010840: 7275 6374 7572 653a 2052 6967 6964 2d62  ructure: Rigid-b
+00010850: 6f64 7920 5374 7275 6374 7572 6520 696e  ody Structure in
+00010860: 7374 616e 6365 2e0a 2020 2020 2020 2020  stance..        
+00010870: 2020 2020 7772 6974 653a 2049 6620 5472      write: If Tr
+00010880: 7565 2c20 6120 7374 7269 6e67 2069 7320  ue, a string is 
+00010890: 7265 7475 726e 6564 2077 6974 6820 666f  returned with fo
+000108a0: 726d 6174 0a20 2020 2020 2020 2020 2020  rmat.           
+000108b0: 2020 2020 203a 636f 6465 3a60 6627 5343       :code:`f'SC
+000108c0: 4343 5f4c 4150 2066 6f72 2073 6567 6d65  CC_LAP for segme
+000108d0: 6e74 207b 5343 4343 5f4c 4150 5f73 636f  nt {SCCC_LAP_sco
+000108e0: 7265 7d27 600a 2020 2020 2020 2020 5265  re}'`.        Re
+000108f0: 7475 726e 3a0a 2020 2020 2020 2020 2020  turn:.          
+00010900: 2020 666c 6f61 7420 6966 203a 636f 6465    float if :code
+00010910: 3a60 7772 6974 653d 4661 6c73 6560 2c20  :`write=False`, 
+00010920: 656c 7365 2073 7472 696e 673a 0a20 2020  else string:.   
+00010930: 2020 2020 2020 2020 2020 2020 2053 4343               SCC
+00010940: 435f 4c41 5020 7363 6f72 650a 2020 2020  C_LAP score.    
+00010950: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00010960: 626c 7572 7265 7220 3d20 5374 7275 6374  blurrer = Struct
+00010970: 7572 6542 6c75 7272 6572 2829 0a20 2020  ureBlurrer().   
+00010980: 2020 2020 2073 636f 7265 7220 3d20 5363       scorer = Sc
+00010990: 6f72 696e 6746 756e 6374 696f 6e73 2829  oringFunctions()
+000109a0: 0a20 2020 2020 2020 206f 7574 6c69 6e65  .        outline
+000109b0: 203d 2022 220a 2020 2020 2020 2020 7265   = "".        re
+000109c0: 736f 6c75 7469 6f6e 5f64 656e 734d 6170  solution_densMap
+000109d0: 203d 2066 6c6f 6174 2872 6573 6f6c 7574   = float(resolut
+000109e0: 696f 6e5f 6465 6e73 4d61 7029 0a20 2020  ion_densMap).   
+000109f0: 2020 2020 2077 686f 6c65 5f66 6974 5f6d       whole_fit_m
+00010a00: 6170 203d 2062 6c75 7272 6572 2e67 6175  ap = blurrer.gau
+00010a10: 7373 6961 6e5f 626c 7572 280a 2020 2020  ssian_blur(.    
+00010a20: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00010a30: 655f 696e 7374 616e 6365 2c0a 2020 2020  e_instance,.    
+00010a40: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
+00010a50: 6f6e 5f64 656e 734d 6170 2c0a 2020 2020  on_densMap,.    
+00010a60: 2020 2020 2020 2020 6465 6e73 4d61 703d          densMap=
+00010a70: 6d61 705f 7461 7267 6574 2c0a 2020 2020  map_target,.    
+00010a80: 2020 2020 2020 2020 7369 676d 615f 636f          sigma_co
+00010a90: 6566 663d 7369 676d 615f 6d61 702c 0a20  eff=sigma_map,. 
+00010aa0: 2020 2020 2020 2020 2020 206e 6f72 6d61             norma
+00010ab0: 6c69 7365 3d54 7275 652c 0a20 2020 2020  lise=True,.     
+00010ac0: 2020 2029 0a20 2020 2020 2020 2073 696d     ).        sim
+00010ad0: 5f6d 6170 203d 2062 6c75 7272 6572 2e67  _map = blurrer.g
+00010ae0: 6175 7373 6961 6e5f 626c 7572 280a 2020  aussian_blur(.  
+00010af0: 2020 2020 2020 2020 2020 7269 6769 645f            rigid_
+00010b00: 626f 6479 5f73 7472 7563 7475 7265 2c0a  body_structure,.
+00010b10: 2020 2020 2020 2020 2020 2020 7265 736f              reso
+00010b20: 6c75 7469 6f6e 5f64 656e 734d 6170 2c0a  lution_densMap,.
+00010b30: 2020 2020 2020 2020 2020 2020 6465 6e73              dens
+00010b40: 4d61 703d 6d61 705f 7461 7267 6574 2c0a  Map=map_target,.
+00010b50: 2020 2020 2020 2020 2020 2020 7369 676d              sigm
+00010b60: 615f 636f 6566 663d 7369 676d 615f 6d61  a_coeff=sigma_ma
+00010b70: 702c 0a20 2020 2020 2020 2020 2020 206e  p,.            n
+00010b80: 6f72 6d61 6c69 7365 3d54 7275 652c 0a20  ormalise=True,. 
+00010b90: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00010ba0: 206d 696e 4465 6e73 203d 2073 696d 5f6d   minDens = sim_m
+00010bb0: 6170 2e73 7464 2829 0a20 2020 2020 2020  ap.std().       
+00010bc0: 2073 696d 5f6d 6173 6b5f 6172 7261 7920   sim_mask_array 
+00010bd0: 3d20 7369 6d5f 6d61 702e 5f67 6574 5f6d  = sim_map._get_m
+00010be0: 6173 6b41 7272 6179 286d 696e 4465 6e73  askArray(minDens
+00010bf0: 290a 2020 2020 2020 2020 6d61 736b 5f65  ).        mask_e
+00010c00: 6d4d 6170 203d 206d 6170 5f74 6172 6765  mMap = map_targe
+00010c10: 742e 5f67 6574 5f6d 6173 6b4d 6170 2873  t._get_maskMap(s
+00010c20: 696d 5f6d 6173 6b5f 6172 7261 7929 0a20  im_mask_array). 
+00010c30: 2020 2020 2020 206d 6173 6b5f 7369 6d4d         mask_simM
+00010c40: 6170 203d 2077 686f 6c65 5f66 6974 5f6d  ap = whole_fit_m
+00010c50: 6170 2e5f 6765 745f 6d61 736b 4d61 7028  ap._get_maskMap(
+00010c60: 7369 6d5f 6d61 736b 5f61 7272 6179 290a  sim_mask_array).
+00010c70: 2020 2020 2020 2020 7373 655f 6c63 6366          sse_lccf
+00010c80: 203d 2073 636f 7265 722e 6c61 706c 6163   = scorer.laplac
+00010c90: 655f 4343 4328 6d61 736b 5f65 6d4d 6170  e_CCC(mask_emMap
+00010ca0: 2c20 6d61 736b 5f73 696d 4d61 7029 0a20  , mask_simMap). 
+00010cb0: 2020 2020 2020 2069 6620 7772 6974 6520         if write 
+00010cc0: 6973 2054 7275 653a 0a20 2020 2020 2020  is True:.       
+00010cd0: 2020 2020 206f 7574 6c69 6e65 202b 3d20       outline += 
+00010ce0: 2753 4343 4320 666f 7220 7365 676d 656e  'SCCC for segmen
+00010cf0: 7420 2566 5c6e 2720 2520 2873 7365 5f6c  t %f\n' % (sse_l
+00010d00: 6363 6629 0a20 2020 2020 2020 2020 2020  ccf).           
+00010d10: 2072 6574 7572 6e20 6f75 746c 696e 650a   return outline.
+00010d20: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+00010d30: 7365 5f6c 6363 660a 0a20 2020 2064 6566  se_lccf..    def
+00010d40: 2053 4343 435f 4d49 280a 2020 2020 2020   SCCC_MI(.      
+00010d50: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+00010d60: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+00010d70: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+00010d80: 7265 736f 6c75 7469 6f6e 5f64 656e 734d  resolution_densM
+00010d90: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00010da0: 7369 676d 615f 6d61 702c 0a20 2020 2020  sigma_map,.     
+00010db0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+00010dc0: 5f69 6e73 7461 6e63 652c 0a20 2020 2020  _instance,.     
+00010dd0: 2020 2020 2020 2072 6967 6964 5f62 6f64         rigid_bod
+00010de0: 795f 7374 7275 6374 7572 652c 0a20 2020  y_structure,.   
+00010df0: 2020 2020 2020 2020 2077 7269 7465 3d46           write=F
+00010e00: 616c 7365 2c0a 2020 2020 293a 0a20 2020  alse,.    ):.   
+00010e10: 2020 2020 2022 2222 4361 6c63 756c 6174       """Calculat
+00010e20: 6520 7468 6520 6d75 7475 616c 2069 6e66  e the mutual inf
+00010e30: 6f72 6d61 7469 6f6e 2073 636f 7265 2066  ormation score f
+00010e40: 6f72 2061 2073 6567 6d65 6e74 206f 6620  or a segment of 
+00010e50: 6120 7072 6f74 6569 6e0a 2020 2020 2020  a protein.      
+00010e60: 2020 6d6f 6465 6c2e 0a0a 2020 2020 2020    model...      
+00010e70: 2020 5365 676d 656e 7473 2061 7265 2064    Segments are d
+00010e80: 6566 696e 6564 2075 7369 6e67 2061 2072  efined using a r
+00010e90: 6967 6964 2d62 6f64 7920 7374 7275 6374  igid-body struct
+00010ea0: 7572 6520 696e 7374 616e 6365 2c20 7768  ure instance, wh
+00010eb0: 6963 6820 6361 6e0a 2020 2020 2020 2020  ich can.        
+00010ec0: 6265 2067 656e 6572 6174 6564 2075 7369  be generated usi
+00010ed0: 6e67 2060 5249 4246 494e 4420 3c68 7474  ng `RIBFIND <htt
+00010ee0: 7073 3a2f 2f72 6962 6669 6e64 2e69 736d  ps://ribfind.ism
+00010ef0: 622e 6c6f 6e2e 6163 2e75 6b2f 3e60 5f2e  b.lon.ac.uk/>`_.
+00010f00: 0a20 2020 2020 2020 2054 6865 2073 636f  .        The sco
+00010f10: 7265 2066 6f72 2074 6865 2073 6567 6d65  re for the segme
+00010f20: 6e74 2069 7320 6361 6c63 756c 6174 6564  nt is calculated
+00010f30: 2075 7369 6e67 0a20 2020 2020 2020 203a   using.        :
+00010f40: 6d65 7468 3a60 4d49 203c 5445 4d50 792e  meth:`MI <TEMPy.
+00010f50: 7072 6f74 6569 6e2e 7363 6f72 696e 675f  protein.scoring_
+00010f60: 6675 6e63 7469 6f6e 732e 5363 6f72 696e  functions.Scorin
+00010f70: 6746 756e 6374 696f 6e73 2e4d 493e 600a  gFunctions.MI>`.
+00010f80: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
+00010f90: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00010fa0: 6d61 705f 7461 7267 6574 3a20 4d61 7020  map_target: Map 
+00010fb0: 496e 7374 616e 6365 2e0a 2020 2020 2020  Instance..      
+00010fc0: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+00010fd0: 5f64 656e 734d 6170 3a20 5265 736f 6c75  _densMap: Resolu
+00010fe0: 7469 6f6e 206f 6620 7468 6520 6d61 7020  tion of the map 
+00010ff0: 696e 7374 616e 6365 2e0a 2020 2020 2020  instance..      
+00011000: 2020 2020 2020 7369 676d 615f 6d61 703a        sigma_map:
+00011010: 2050 6172 616d 6574 6572 206e 6565 6420   Parameter need 
+00011020: 666f 7220 5374 7275 6374 7572 6520 426c  for Structure Bl
+00011030: 7572 7265 722e 2046 756c 6c20 6578 706c  urrer. Full expl
+00011040: 616e 6174 696f 6e0a 2020 2020 2020 2020  anation.        
+00011050: 2020 2020 2020 2020 3a72 6566 3a60 6865          :ref:`he
+00011060: 7265 3c4e 6f74 6520 6f6e 2072 6561 6c20  re<Note on real 
+00011070: 7370 6163 6520 626c 7572 7269 6e67 3a3e  space blurring:>
+00011080: 600a 2020 2020 2020 2020 2020 2020 7374  `.            st
+00011090: 7275 6374 7572 655f 696e 7374 616e 6365  ructure_instance
+000110a0: 3a20 5374 7275 6374 7572 6520 696e 7374  : Structure inst
+000110b0: 616e 6365 2074 6f20 636f 6d70 6172 650a  ance to compare.
+000110c0: 2020 2020 2020 2020 2020 2020 7269 6769              rigi
+000110d0: 645f 626f 6479 5f73 7472 7563 7475 7265  d_body_structure
+000110e0: 3a20 5269 6769 642d 626f 6479 2053 7472  : Rigid-body Str
+000110f0: 7563 7475 7265 2069 6e73 7461 6e63 652e  ucture instance.
+00011100: 0a20 2020 2020 2020 2020 2020 2077 7269  .            wri
+00011110: 7465 3a20 4966 2054 7275 652c 2061 2073  te: If True, a s
+00011120: 7472 696e 6720 6973 2072 6574 7572 6e65  tring is returne
+00011130: 6420 7769 7468 2066 6f72 6d61 740a 2020  d with format.  
+00011140: 2020 2020 2020 2020 2020 2020 2020 3a63                :c
+00011150: 6f64 653a 6066 2753 4343 435f 4c41 5020  ode:`f'SCCC_LAP 
+00011160: 666f 7220 7365 676d 656e 7420 7b53 4343  for segment {SCC
+00011170: 435f 4c41 505f 7363 6f72 657d 2760 0a20  C_LAP_score}'`. 
+00011180: 2020 2020 2020 2052 6574 7572 6e3a 0a20         Return:. 
+00011190: 2020 2020 2020 2020 2020 2066 6c6f 6174             float
+000111a0: 2069 6620 3a63 6f64 653a 6077 7269 7465   if :code:`write
+000111b0: 3d46 616c 7365 602c 2065 6c73 6520 7374  =False`, else st
+000111c0: 7269 6e67 3a0a 2020 2020 2020 2020 2020  ring:.          
+000111d0: 2020 2020 2020 5343 4343 5f4d 4920 7363        SCCC_MI sc
+000111e0: 6f72 650a 2020 2020 2020 2020 2222 220a  ore.        """.
+000111f0: 2020 2020 2020 2020 626c 7572 7265 7220          blurrer 
+00011200: 3d20 5374 7275 6374 7572 6542 6c75 7272  = StructureBlurr
+00011210: 6572 2829 0a20 2020 2020 2020 2073 636f  er().        sco
+00011220: 7265 7220 3d20 5363 6f72 696e 6746 756e  rer = ScoringFun
+00011230: 6374 696f 6e73 2829 0a20 2020 2020 2020  ctions().       
+00011240: 206f 7574 6c69 6e65 203d 2022 220a 2020   outline = "".  
+00011250: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+00011260: 5f64 656e 734d 6170 203d 2066 6c6f 6174  _densMap = float
+00011270: 2872 6573 6f6c 7574 696f 6e5f 6465 6e73  (resolution_dens
+00011280: 4d61 7029 0a20 2020 2020 2020 2077 686f  Map).        who
+00011290: 6c65 5f66 6974 5f6d 6170 203d 2062 6c75  le_fit_map = blu
+000112a0: 7272 6572 2e67 6175 7373 6961 6e5f 626c  rrer.gaussian_bl
+000112b0: 7572 280a 2020 2020 2020 2020 2020 2020  ur(.            
+000112c0: 7374 7275 6374 7572 655f 696e 7374 616e  structure_instan
+000112d0: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
+000112e0: 7265 736f 6c75 7469 6f6e 5f64 656e 734d  resolution_densM
+000112f0: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00011300: 6465 6e73 4d61 703d 6d61 705f 7461 7267  densMap=map_targ
+00011310: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+00011320: 7369 676d 615f 636f 6566 663d 7369 676d  sigma_coeff=sigm
+00011330: 615f 6d61 702c 0a20 2020 2020 2020 2020  a_map,.         
+00011340: 2020 206e 6f72 6d61 6c69 7365 3d54 7275     normalise=Tru
+00011350: 650a 2020 2020 2020 2020 290a 2020 2020  e.        ).    
+00011360: 2020 2020 7369 6d5f 6d61 7020 3d20 626c      sim_map = bl
+00011370: 7572 7265 722e 6761 7573 7369 616e 5f62  urrer.gaussian_b
+00011380: 6c75 7228 0a20 2020 2020 2020 2020 2020  lur(.           
+00011390: 2072 6967 6964 5f62 6f64 795f 7374 7275   rigid_body_stru
+000113a0: 6374 7572 652c 0a20 2020 2020 2020 2020  cture,.         
+000113b0: 2020 2072 6573 6f6c 7574 696f 6e5f 6465     resolution_de
+000113c0: 6e73 4d61 702c 0a20 2020 2020 2020 2020  nsMap,.         
+000113d0: 2020 2064 656e 734d 6170 3d6d 6170 5f74     densMap=map_t
+000113e0: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
+000113f0: 2020 2073 6967 6d61 5f63 6f65 6666 3d73     sigma_coeff=s
+00011400: 6967 6d61 5f6d 6170 2c0a 2020 2020 2020  igma_map,.      
+00011410: 2020 2020 2020 6e6f 726d 616c 6973 653d        normalise=
+00011420: 5472 7565 0a20 2020 2020 2020 2029 0a20  True.        ). 
+00011430: 2020 2020 2020 206d 696e 4465 6e73 203d         minDens =
+00011440: 2073 696d 5f6d 6170 2e73 7464 2829 0a20   sim_map.std(). 
+00011450: 2020 2020 2020 2073 696d 5f6d 6173 6b5f         sim_mask_
+00011460: 6172 7261 7920 3d20 7369 6d5f 6d61 702e  array = sim_map.
+00011470: 5f67 6574 5f6d 6173 6b41 7272 6179 286d  _get_maskArray(m
+00011480: 696e 4465 6e73 290a 2020 2020 2020 2020  inDens).        
+00011490: 6d61 736b 5f65 6d4d 6170 203d 206d 6170  mask_emMap = map
+000114a0: 5f74 6172 6765 742e 5f67 6574 5f6d 6173  _target._get_mas
+000114b0: 6b4d 6170 2873 696d 5f6d 6173 6b5f 6172  kMap(sim_mask_ar
+000114c0: 7261 7929 0a20 2020 2020 2020 206d 6173  ray).        mas
+000114d0: 6b5f 7369 6d4d 6170 203d 2077 686f 6c65  k_simMap = whole
+000114e0: 5f66 6974 5f6d 6170 2e5f 6765 745f 6d61  _fit_map._get_ma
+000114f0: 736b 4d61 7028 7369 6d5f 6d61 736b 5f61  skMap(sim_mask_a
+00011500: 7272 6179 290a 2020 2020 2020 2020 7373  rray).        ss
+00011510: 655f 6c63 6366 203d 2073 636f 7265 722e  e_lccf = scorer.
+00011520: 4d49 286d 6173 6b5f 656d 4d61 702c 206d  MI(mask_emMap, m
+00011530: 6173 6b5f 7369 6d4d 6170 290a 2020 2020  ask_simMap).    
+00011540: 2020 2020 6966 2077 7269 7465 2069 7320      if write is 
+00011550: 5472 7565 3a0a 2020 2020 2020 2020 2020  True:.          
+00011560: 2020 6f75 746c 696e 6520 2b3d 2027 5343    outline += 'SC
+00011570: 4343 2066 6f72 2073 6567 6d65 6e74 2025  CC for segment %
+00011580: 665c 6e27 2025 2028 7373 655f 6c63 6366  f\n' % (sse_lccf
+00011590: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+000115a0: 7475 726e 206f 7574 6c69 6e65 0a20 2020  turn outline.   
+000115b0: 2020 2020 2072 6574 7572 6e20 7373 655f       return sse_
+000115c0: 6c63 6366 0a0a 2020 2020 6465 6620 6765  lccf..    def ge
+000115d0: 745f 7363 6363 280a 2020 2020 2020 2020  t_sccc(.        
+000115e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000115f0: 2020 2020 2020 6d61 705f 7461 7267 6574        map_target
+00011600: 2c0a 2020 2020 2020 2020 2020 2020 7374  ,.            st
+00011610: 7275 6374 7572 655f 696e 7374 616e 6365  ructure_instance
+00011620: 2c0a 2020 2020 2020 2020 2020 2020 7269  ,.            ri
+00011630: 6769 645f 626f 6479 5f66 696c 652c 0a20  gid_body_file,. 
+00011640: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
+00011650: 7574 696f 6e2c 0a20 2020 2020 2020 2020  ution,.         
+00011660: 2020 2073 6967 6d61 5f6d 6170 3d30 2e31     sigma_map=0.1
+00011670: 3837 0a20 2020 2029 3a0a 2020 2020 2020  87.    ):.      
+00011680: 2020 2222 2252 6561 6420 7269 6769 6420    """Read rigid 
+00011690: 626f 6479 2066 696c 6520 616e 6420 6361  body file and ca
+000116a0: 6c63 756c 6174 6520 7363 6363 2073 636f  lculate sccc sco
+000116b0: 7265 7320 666f 7220 6561 6368 2072 6967  res for each rig
+000116c0: 6964 2062 6f64 790a 0a20 2020 2020 2020  id body..       
+000116d0: 2041 7267 733a 0a20 2020 2020 2020 2020   Args:.         
+000116e0: 2020 206d 6170 5f74 6172 6765 743a 204d     map_target: M
+000116f0: 6170 2069 6e73 7461 6e63 650a 2020 2020  ap instance.    
+00011700: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+00011710: 655f 696e 7374 616e 6365 3a20 4d6f 6465  e_instance: Mode
+00011720: 6c20 7374 7275 6374 7572 6520 696e 7374  l structure inst
+00011730: 616e 6365 0a20 2020 2020 2020 2020 2020  ance.           
+00011740: 2072 6967 6964 5f62 6f64 795f 6669 6c65   rigid_body_file
+00011750: 3a20 5061 7468 2074 6f20 7269 6769 6420  : Path to rigid 
+00011760: 626f 6479 2066 696c 650a 2020 2020 2020  body file.      
+00011770: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+00011780: 3a20 5265 736f 6c75 7469 6f6e 206f 6620  : Resolution of 
+00011790: 6d61 7020 696e 7374 616e 6365 0a20 2020  map instance.   
+000117a0: 2020 2020 2020 2020 2073 6967 6d61 5f6d           sigma_m
+000117b0: 6170 3a20 5061 7261 6d65 7465 7220 6e65  ap: Parameter ne
+000117c0: 6564 2066 6f72 2053 7472 7563 7475 7265  ed for Structure
+000117d0: 2042 6c75 7272 6572 2e20 4675 6c6c 2065   Blurrer. Full e
+000117e0: 7870 6c61 6e61 7469 6f6e 0a20 2020 2020  xplanation.     
+000117f0: 2020 2020 2020 2020 2020 203a 7265 663a             :ref:
+00011800: 6068 6572 653c 4e6f 7465 206f 6e20 7265  `here<Note on re
+00011810: 616c 2073 7061 6365 2062 6c75 7272 696e  al space blurrin
+00011820: 673a 3e60 0a0a 2020 2020 2020 2020 5265  g:>`..        Re
+00011830: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
+00011840: 2020 2054 776f 2064 6963 7469 6f6e 6172     Two dictionar
+00011850: 6965 733b 2064 6963 745f 6368 6169 6e5f  ies; dict_chain_
+00011860: 7363 6f72 6573 2c20 6469 6374 5f72 6967  scores, dict_rig
+00011870: 6964 5f73 636f 7265 730a 2020 2020 2020  id_scores.      
+00011880: 2020 2020 2020 2020 2020 2a20 6469 6374            * dict
+00011890: 5f63 6861 696e 5f73 636f 7265 7320 6973  _chain_scores is
+000118a0: 2061 2064 6963 7469 6f6e 6172 7920 7769   a dictionary wi
+000118b0: 7468 206b 6579 7320 6571 7561 6c20 746f  th keys equal to
+000118c0: 2063 6861 696e 0a20 2020 2020 2020 2020   chain.         
+000118d0: 2020 2020 2020 2020 206c 6162 656c 7320           labels 
+000118e0: 2865 2e67 2e20 3a63 6f64 653a 605b 2741  (e.g. :code:`['A
+000118f0: 272c 2027 4227 2c20 2743 275d 6029 2e20  ', 'B', 'C']`). 
+00011900: 4561 6368 2076 616c 7565 2069 7320 616e  Each value is an
+00011910: 6f74 6865 720a 2020 2020 2020 2020 2020  other.          
+00011920: 2020 2020 2020 2020 6469 6374 696f 6e61          dictiona
+00011930: 7279 2c20 7769 7468 206b 6579 7320 6173  ry, with keys as
+00011940: 2072 6573 6964 7565 206e 756d 6265 7220   residue number 
+00011950: 666f 7220 6561 6368 2072 6573 6964 7565  for each residue
+00011960: 2069 6e20 610a 2020 2020 2020 2020 2020   in a.          
+00011970: 2020 2020 2020 2020 7269 6769 6420 626f          rigid bo
+00011980: 6479 2c20 616e 6420 7661 6c75 6573 2074  dy, and values t
+00011990: 6865 2043 4343 2073 636f 7265 2066 6f72  he CCC score for
+000119a0: 2074 6861 7420 7265 7369 6475 652e 0a0a   that residue...
+000119b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000119c0: 2a20 6469 6374 5f72 6967 6964 5f73 636f  * dict_rigid_sco
+000119d0: 7265 7320 6973 2061 2064 6963 7469 6f6e  res is a diction
+000119e0: 6172 7920 7769 7468 206b 6579 7320 6571  ary with keys eq
+000119f0: 7561 6c20 746f 2065 6163 680a 2020 2020  ual to each.    
+00011a00: 2020 2020 2020 2020 2020 2020 2020 7269                ri
+00011a10: 6769 6420 626f 6479 2028 7374 7269 6e67  gid body (string
+00011a20: 3f3f 206e 6f74 2073 7572 6529 2061 6e64  ?? not sure) and
+00011a30: 2076 616c 7565 7320 7468 6520 4343 4320   values the CCC 
+00011a40: 7363 6f72 6520 666f 720a 2020 2020 2020  score for.      
+00011a50: 2020 2020 2020 2020 2020 2020 7468 6174              that
+00011a60: 2062 6f64 792e 0a0a 2020 2020 2020 2020   body...        
+00011a70: 2222 220a 2020 2020 2020 2020 6469 6374  """.        dict
+00011a80: 5f72 6266 203d 2052 4250 6172 7365 722e  _rbf = RBParser.
+00011a90: 6765 745f 7269 6769 645f 626f 6479 5f73  get_rigid_body_s
+00011aa0: 7472 5f69 6e73 7461 6e63 6573 280a 2020  tr_instances(.  
+00011ab0: 2020 2020 2020 2020 2020 7269 6769 645f            rigid_
+00011ac0: 626f 6479 5f66 696c 652c 0a20 2020 2020  body_file,.     
+00011ad0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+00011ae0: 5f69 6e73 7461 6e63 652c 0a20 2020 2020  _instance,.     
+00011af0: 2020 2029 0a20 2020 2020 2020 2064 6963     ).        dic
+00011b00: 745f 6368 6169 6e5f 6465 7461 696c 7320  t_chain_details 
+00011b10: 3d20 7374 7275 6374 7572 655f 696e 7374  = structure_inst
+00011b20: 616e 6365 2e67 6574 5f64 6963 745f 7374  ance.get_dict_st
+00011b30: 7228 290a 2020 2020 2020 2020 6469 6374  r().        dict
+00011b40: 5f63 6861 696e 5f73 636f 7265 7320 3d20  _chain_scores = 
+00011b50: 7b7d 0a20 2020 2020 2020 2064 6963 745f  {}.        dict_
+00011b60: 7269 6769 645f 7363 6f72 6573 203d 207b  rigid_scores = {
+00011b70: 7d0a 2020 2020 2020 2020 6d69 6e73 636f  }.        minsco
+00011b80: 7265 203d 2031 2e30 0a20 2020 2020 2020  re = 1.0.       
+00011b90: 206d 6178 7363 6f72 6520 3d20 2d31 2e30   maxscore = -1.0
+00011ba0: 0a20 2020 2020 2020 2066 6f72 2063 6820  .        for ch 
+00011bb0: 696e 2064 6963 745f 6368 6169 6e5f 6465  in dict_chain_de
+00011bc0: 7461 696c 733a 0a20 2020 2020 2020 2020  tails:.         
+00011bd0: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
+00011be0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+00011bf0: 2020 2020 666f 7220 7265 7320 696e 2064      for res in d
+00011c00: 6963 745f 6368 6169 6e5f 6465 7461 696c  ict_chain_detail
+00011c10: 735b 6368 5d3a 0a20 2020 2020 2020 2020  s[ch]:.         
+00011c20: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
+00011c30: 7363 6f72 6573 5b72 6573 5d20 3d20 2d32  scores[res] = -2
+00011c40: 2e30 0a20 2020 2020 2020 2020 2020 2069  .0.            i
+00011c50: 6620 6368 206e 6f74 2069 6e20 6469 6374  f ch not in dict
+00011c60: 5f72 6266 3a0a 2020 2020 2020 2020 2020  _rbf:.          
+00011c70: 2020 2020 2020 636f 6e74 696e 7565 0a20        continue. 
+00011c80: 2020 2020 2020 2020 2020 2066 6f72 2072             for r
+00011c90: 6220 696e 2064 6963 745f 7262 665b 6368  b in dict_rbf[ch
+00011ca0: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00011cb0: 2020 2072 6573 5f6c 6973 7420 3d20 5b5d     res_list = []
+00011cc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011cd0: 2066 6f72 2073 6567 2069 6e20 6469 6374   for seg in dict
+00011ce0: 5f72 6266 5b63 685d 5b72 625d 5b30 5d3a  _rbf[ch][rb][0]:
+00011cf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011d00: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d20: 2020 666f 7220 7220 696e 2072 616e 6765    for r in range
+00011d30: 2869 6e74 2873 6567 5b30 5d29 2c20 696e  (int(seg[0]), in
+00011d40: 7428 7365 675b 315d 2920 2b20 3129 3a0a  t(seg[1]) + 1):.
+00011d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d60: 2020 2020 2020 2020 2020 2020 7265 735f              res_
+00011d70: 6c69 7374 2e61 7070 656e 6428 7229 0a20  list.append(r). 
+00011d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d90: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+00011da0: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00011db0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
+00011dc0: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
+00011dd0: 2020 2020 2020 7363 6f72 655f 5343 4343        score_SCCC
+00011de0: 203d 2073 656c 662e 5343 4343 280a 2020   = self.SCCC(.  
+00011df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e00: 2020 6d61 705f 7461 7267 6574 2c0a 2020    map_target,.  
+00011e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e20: 2020 7265 736f 6c75 7469 6f6e 2c0a 2020    resolution,.  
+00011e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e40: 2020 7369 676d 615f 6d61 702c 0a20 2020    sigma_map,.   
+00011e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011e60: 2073 7472 7563 7475 7265 5f69 6e73 7461   structure_insta
+00011e70: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
+00011e80: 2020 2020 2020 2020 2064 6963 745f 7262           dict_rb
+00011e90: 665b 6368 5d5b 7262 5d5b 315d 0a20 2020  f[ch][rb][1].   
+00011ea0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+00011eb0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00011ec0: 6620 7262 206e 6f74 2069 6e20 6469 6374  f rb not in dict
+00011ed0: 5f72 6967 6964 5f73 636f 7265 733a 0a20  _rigid_scores:. 
+00011ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ef0: 2020 2064 6963 745f 7269 6769 645f 7363     dict_rigid_sc
+00011f00: 6f72 6573 5b72 625d 203d 2073 636f 7265  ores[rb] = score
+00011f10: 5f53 4343 430a 2020 2020 2020 2020 2020  _SCCC.          
+00011f20: 2020 2020 2020 2020 2020 6966 2073 636f            if sco
+00011f30: 7265 5f53 4343 4320 3c20 6d69 6e73 636f  re_SCCC < minsco
+00011f40: 7265 3a0a 2020 2020 2020 2020 2020 2020  re:.            
+00011f50: 2020 2020 2020 2020 2020 2020 6d69 6e73              mins
+00011f60: 636f 7265 203d 2073 636f 7265 5f53 4343  core = score_SCC
+00011f70: 430a 2020 2020 2020 2020 2020 2020 2020  C.              
+00011f80: 2020 2020 2020 6966 2073 636f 7265 5f53        if score_S
+00011f90: 4343 4320 3e20 6d61 7873 636f 7265 3a0a  CCC > maxscore:.
+00011fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011fb0: 2020 2020 2020 2020 6d61 7873 636f 7265          maxscore
+00011fc0: 203d 2073 636f 7265 5f53 4343 430a 2020   = score_SCCC.  
+00011fd0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00011fe0: 7220 7265 7320 696e 2072 6573 5f6c 6973  r res in res_lis
+00011ff0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00012000: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
+00012010: 7363 6f72 6573 5b72 6573 5d20 3d20 7363  scores[res] = sc
+00012020: 6f72 655f 5343 4343 0a0a 2020 2020 2020  ore_SCCC..      
+00012030: 2020 2020 2020 6469 6374 5f63 6861 696e        dict_chain
+00012040: 5f73 636f 7265 735b 6368 5d20 3d20 6469  _scores[ch] = di
+00012050: 6374 5f72 6573 5f73 636f 7265 730a 0a20  ct_res_scores.. 
+00012060: 2020 2020 2020 206d 696e 7363 6f72 6520         minscore 
+00012070: 3d20 6d61 7828 6d69 6e73 636f 7265 202d  = max(minscore -
+00012080: 2028 6d61 7873 636f 7265 202d 206d 696e   (maxscore - min
+00012090: 7363 6f72 6529 202f 2035 2e2c 202d 312e  score) / 5., -1.
+000120a0: 3029 0a20 2020 2020 2020 2066 6f72 2063  0).        for c
+000120b0: 6820 696e 2064 6963 745f 6368 6169 6e5f  h in dict_chain_
+000120c0: 7363 6f72 6573 3a0a 2020 2020 2020 2020  scores:.        
+000120d0: 2020 2020 666f 7220 7265 7320 696e 2064      for res in d
+000120e0: 6963 745f 6368 6169 6e5f 7363 6f72 6573  ict_chain_scores
+000120f0: 5b63 685d 3a0a 2020 2020 2020 2020 2020  [ch]:.          
+00012100: 2020 2020 2020 6966 2064 6963 745f 6368        if dict_ch
+00012110: 6169 6e5f 7363 6f72 6573 5b63 685d 5b72  ain_scores[ch][r
+00012120: 6573 5d20 3d3d 202d 322e 303a 0a20 2020  es] == -2.0:.   
+00012130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012140: 2064 6963 745f 6368 6169 6e5f 7363 6f72   dict_chain_scor
+00012150: 6573 5b63 685d 5b72 6573 5d20 3d20 6d69  es[ch][res] = mi
+00012160: 6e73 636f 7265 0a0a 2020 2020 2020 2020  nscore..        
+00012170: 7265 7475 726e 2064 6963 745f 6368 6169  return dict_chai
+00012180: 6e5f 7363 6f72 6573 2c20 6469 6374 5f72  n_scores, dict_r
+00012190: 6967 6964 5f73 636f 7265 730a 0a20 2020  igid_scores..   
+000121a0: 2064 6566 2063 616c 635f 6d6f 6328 0a20   def calc_moc(. 
+000121b0: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+000121c0: 0a20 2020 2020 2020 2020 2020 2069 6e64  .            ind
+000121d0: 6963 6573 2c0a 2020 2020 2020 2020 2020  ices,.          
+000121e0: 2020 6d61 705f 7072 6f62 652c 0a20 2020    map_probe,.   
+000121f0: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
+00012200: 6765 742c 0a20 2020 2029 3a0a 2020 2020  get,.    ):.    
+00012210: 2020 2020 6d61 705f 7461 7267 6574 5f6d      map_target_m
+00012220: 6173 6b20 3d20 6d61 705f 7461 7267 6574  ask = map_target
+00012230: 2e66 756c 6c4d 6170 5b69 6e64 6963 6573  .fullMap[indices
+00012240: 5d0a 2020 2020 2020 2020 6d61 705f 7072  ].        map_pr
+00012250: 6f62 655f 6d61 736b 203d 206d 6170 5f70  obe_mask = map_p
+00012260: 726f 6265 2e66 756c 6c4d 6170 5b69 6e64  robe.fullMap[ind
+00012270: 6963 6573 5d0a 2020 2020 2020 2020 6e75  ices].        nu
+00012280: 6d20 3d20 6e70 2e73 756d 286d 6170 5f74  m = np.sum(map_t
+00012290: 6172 6765 745f 6d61 736b 202a 206d 6170  arget_mask * map
+000122a0: 5f70 726f 6265 5f6d 6173 6b29 0a20 2020  _probe_mask).   
+000122b0: 2020 2020 2064 656e 203d 206e 702e 7371       den = np.sq
+000122c0: 7274 280a 2020 2020 2020 2020 2020 2020  rt(.            
+000122d0: 6e70 2e73 756d 286e 702e 7371 7561 7265  np.sum(np.square
+000122e0: 286d 6170 5f74 6172 6765 745f 6d61 736b  (map_target_mask
+000122f0: 2929 202a 0a20 2020 2020 2020 2020 2020  )) *.           
+00012300: 206e 702e 7375 6d28 6e70 2e73 7175 6172   np.sum(np.squar
+00012310: 6528 6d61 705f 7072 6f62 655f 6d61 736b  e(map_probe_mask
+00012320: 2929 0a20 2020 2020 2020 2029 0a20 2020  )).        ).   
+00012330: 2020 2020 2069 6620 6465 6e20 3d3d 2030       if den == 0
+00012340: 2e30 3a0a 2020 2020 2020 2020 2020 2020  .0:.            
+00012350: 7265 7475 726e 202d 312e 300a 2020 2020  return -1.0.    
+00012360: 2020 2020 7265 7475 726e 206e 756d 202f      return num /
+00012370: 2064 656e 0a0a 2020 2020 6465 6620 6361   den..    def ca
+00012380: 6c63 5f63 6363 280a 2020 2020 2020 2020  lc_ccc(.        
+00012390: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+000123a0: 2020 2020 2020 696e 6469 6365 732c 0a20        indices,. 
+000123b0: 2020 2020 2020 2020 2020 206d 6170 5f70             map_p
+000123c0: 726f 6265 2c0a 2020 2020 2020 2020 2020  robe,.          
+000123d0: 2020 6d61 705f 7461 7267 6574 0a20 2020    map_target.   
+000123e0: 2029 3a0a 2020 2020 2020 2020 6d61 705f   ):.        map_
+000123f0: 7461 7267 6574 5f6d 6173 6b20 3d20 6d61  target_mask = ma
+00012400: 705f 7461 7267 6574 2e66 756c 6c4d 6170  p_target.fullMap
+00012410: 5b69 6e64 6963 6573 5d0a 2020 2020 2020  [indices].      
+00012420: 2020 6d61 705f 7461 7267 6574 5f6d 6173    map_target_mas
+00012430: 6b20 3d20 6d61 705f 7461 7267 6574 5f6d  k = map_target_m
+00012440: 6173 6b20 2d20 666c 6f61 7428 0a20 2020  ask - float(.   
+00012450: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
+00012460: 6765 745f 6d61 736b 2e73 756d 2829 2f6c  get_mask.sum()/l
+00012470: 656e 286d 6170 5f74 6172 6765 745f 6d61  en(map_target_ma
+00012480: 736b 290a 2020 2020 2020 2020 290a 2020  sk).        ).  
+00012490: 2020 2020 2020 6d61 705f 7072 6f62 655f        map_probe_
+000124a0: 6d61 736b 203d 206d 6170 5f70 726f 6265  mask = map_probe
+000124b0: 2e66 756c 6c4d 6170 5b69 6e64 6963 6573  .fullMap[indices
+000124c0: 5d0a 2020 2020 2020 2020 6d61 705f 7072  ].        map_pr
+000124d0: 6f62 655f 6d61 736b 203d 206d 6170 5f70  obe_mask = map_p
+000124e0: 726f 6265 5f6d 6173 6b20 2d20 666c 6f61  robe_mask - floa
+000124f0: 7428 0a20 2020 2020 2020 2020 2020 206d  t(.            m
+00012500: 6170 5f70 726f 6265 5f6d 6173 6b2e 7375  ap_probe_mask.su
+00012510: 6d28 292f 6c65 6e28 6d61 705f 7072 6f62  m()/len(map_prob
+00012520: 655f 6d61 736b 290a 2020 2020 2020 2020  e_mask).        
+00012530: 290a 2020 2020 2020 2020 6e75 6d20 3d20  ).        num = 
+00012540: 6e70 2e73 756d 286d 6170 5f74 6172 6765  np.sum(map_targe
+00012550: 745f 6d61 736b 202a 206d 6170 5f70 726f  t_mask * map_pro
+00012560: 6265 5f6d 6173 6b29 0a20 2020 2020 2020  be_mask).       
+00012570: 2064 656e 203d 206e 702e 7371 7274 280a   den = np.sqrt(.
+00012580: 2020 2020 2020 2020 2020 2020 6e70 2e73              np.s
+00012590: 756d 286e 702e 7371 7561 7265 286d 6170  um(np.square(map
+000125a0: 5f74 6172 6765 745f 6d61 736b 2929 202a  _target_mask)) *
+000125b0: 0a20 2020 2020 2020 2020 2020 206e 702e  .            np.
+000125c0: 7375 6d28 6e70 2e73 7175 6172 6528 6d61  sum(np.square(ma
+000125d0: 705f 7072 6f62 655f 6d61 736b 2929 0a20  p_probe_mask)). 
+000125e0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000125f0: 2069 6620 6465 6e20 3d3d 2030 2e30 3a0a   if den == 0.0:.
+00012600: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00012610: 726e 202d 312e 300a 2020 2020 2020 2020  rn -1.0.        
+00012620: 7265 7475 726e 206e 756d 202f 2064 656e  return num / den
+00012630: 0a0a 2020 2020 6465 6620 696e 6469 6365  ..    def indice
+00012640: 735f 736d 6f63 280a 2020 2020 2020 2020  s_smoc(.        
+00012650: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00012660: 2020 2020 2020 7363 6f72 655f 696e 6469        score_indi
+00012670: 6365 732c 0a20 2020 2020 2020 2020 2020  ces,.           
+00012680: 2067 7269 645f 696e 6469 6365 730a 2020   grid_indices.  
+00012690: 2020 293a 0a20 2020 2020 2020 2074 6d70    ):.        tmp
+000126a0: 6c69 7374 203d 2073 636f 7265 5f69 6e64  list = score_ind
+000126b0: 6963 6573 5b3a 5d0a 2020 2020 2020 2020  ices[:].        
+000126c0: 7365 746c 6973 7420 3d20 7365 7428 746d  setlist = set(tm
+000126d0: 706c 6973 7429 0a20 2020 2020 2020 2069  plist).        i
+000126e0: 6e64 6963 6573 203d 206c 6973 7428 7365  ndices = list(se
+000126f0: 746c 6973 7429 0a20 2020 2020 2020 2073  tlist).        s
+00012700: 635f 696e 6469 6365 7320 3d20 5b5d 0a20  c_indices = []. 
+00012710: 2020 2020 2020 2066 6f72 2069 6920 696e         for ii in
+00012720: 2069 6e64 6963 6573 3a0a 2020 2020 2020   indices:.      
+00012730: 2020 2020 2020 7363 5f69 6e64 6963 6573        sc_indices
+00012740: 2e61 7070 656e 6428 6772 6964 5f69 6e64  .append(grid_ind
+00012750: 6963 6573 5b69 695d 290a 2020 2020 2020  ices[ii]).      
+00012760: 2020 6172 7261 795f 696e 6469 6365 7320    array_indices 
+00012770: 3d20 6e70 2e61 7272 6179 2873 635f 696e  = np.array(sc_in
+00012780: 6469 6365 7329 0a20 2020 2020 2020 2069  dices).        i
+00012790: 6e64 5f61 7272 7879 7a20 3d20 6e70 2e74  nd_arrxyz = np.t
+000127a0: 7261 6e73 706f 7365 2861 7272 6179 5f69  ranspose(array_i
+000127b0: 6e64 6963 6573 290a 2020 2020 2020 2020  ndices).        
+000127c0: 696e 645f 6172 727a 7978 203d 2028 696e  ind_arrzyx = (in
+000127d0: 645f 6172 7278 797a 5b32 5d2c 2069 6e64  d_arrxyz[2], ind
+000127e0: 5f61 7272 7879 7a5b 315d 2c20 696e 645f  _arrxyz[1], ind_
+000127f0: 6172 7278 797a 5b30 5d29 0a20 2020 2020  arrxyz[0]).     
+00012800: 2020 2072 6574 7572 6e20 696e 645f 6172     return ind_ar
+00012810: 727a 7978 0a0a 2020 2020 6465 6620 7365  rzyx..    def se
+00012820: 745f 7363 6f72 655f 6173 5f62 6661 6374  t_score_as_bfact
+00012830: 6f72 280a 2020 2020 2020 2020 2020 2020  or(.            
+00012840: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00012850: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
+00012860: 616e 6365 2c0a 2020 2020 2020 2020 2020  ance,.          
+00012870: 2020 6469 6374 5f73 636f 7265 732c 0a20    dict_scores,. 
+00012880: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00012890: 6c74 3d30 2e30 2c0a 2020 2020 2020 2020  lt=0.0,.        
+000128a0: 2020 2020 6368 6964 3d4e 6f6e 652c 0a20      chid=None,. 
+000128b0: 2020 2020 2020 2020 2020 206f 7574 6669             outfi
+000128c0: 6c65 3d27 7363 6f72 652e 7064 6227 2c0a  le='score.pdb',.
+000128d0: 2020 2020 293a 0a20 2020 2020 2020 2023      ):.        #
+000128e0: 2069 6e63 6c75 6465 2073 636f 7265 7320   include scores 
+000128f0: 6173 2062 2d66 6163 746f 7220 7265 636f  as b-factor reco
+00012900: 7264 730a 2020 2020 2020 2020 666f 7220  rds.        for 
+00012910: 7820 696e 2073 7472 7563 7475 7265 5f69  x in structure_i
+00012920: 6e73 7461 6e63 652e 6174 6f6d 4c69 7374  nstance.atomList
+00012930: 3a0a 2020 2020 2020 2020 2020 2020 6375  :.            cu
+00012940: 725f 6368 6169 6e20 3d20 782e 6368 6169  r_chain = x.chai
+00012950: 6e0a 2020 2020 2020 2020 2020 2020 6375  n.            cu
+00012960: 725f 7265 7320 3d20 782e 6765 745f 7265  r_res = x.get_re
+00012970: 735f 6e6f 2829 0a20 2020 2020 2020 2020  s_no().         
+00012980: 2020 2069 6620 6375 725f 6368 6169 6e20     if cur_chain 
+00012990: 696e 2064 6963 745f 7363 6f72 6573 3a0a  in dict_scores:.
+000129a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000129b0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000129c0: 2020 2020 2020 2020 2078 2e74 656d 705f           x.temp_
+000129d0: 6661 6320 3d20 227b 303a 2e32 667d 222e  fac = "{0:.2f}".
+000129e0: 666f 726d 6174 280a 2020 2020 2020 2020  format(.        
+000129f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a00: 666c 6f61 7428 6469 6374 5f73 636f 7265  float(dict_score
+00012a10: 735b 6375 725f 6368 6169 6e5d 5b63 7572  s[cur_chain][cur
+00012a20: 5f72 6573 5d29 0a20 2020 2020 2020 2020  _res]).         
+00012a30: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00012a40: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00012a50: 6570 7420 284b 6579 4572 726f 722c 2049  ept (KeyError, I
+00012a60: 6e64 6578 4572 726f 7229 3a0a 2020 2020  ndexError):.    
+00012a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a80: 7072 696e 7428 2752 6573 6964 7565 206d  print('Residue m
+00012a90: 6973 7369 6e67 3a20 272c 2063 7572 5f72  issing: ', cur_r
+00012aa0: 6573 2c20 6368 6964 290a 2020 2020 2020  es, chid).      
+00012ab0: 2020 2020 2020 2020 2020 2020 2020 782e                x.
+00012ac0: 7465 6d70 5f66 6163 203d 2064 6566 6175  temp_fac = defau
+00012ad0: 6c74 0a20 2020 2020 2020 2020 2020 2065  lt.            e
+00012ae0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00012af0: 2020 2020 2078 2e74 656d 705f 6661 6320       x.temp_fac 
+00012b00: 3d20 6465 6661 756c 740a 2020 2020 2020  = default.      
+00012b10: 2020 7374 7275 6374 7572 655f 696e 7374    structure_inst
+00012b20: 616e 6365 2e77 7269 7465 5f74 6f5f 5044  ance.write_to_PD
+00012b30: 4228 6f75 7466 696c 6529 0a0a 2020 2020  B(outfile)..    
+00012b40: 6465 6620 736d 6f63 5f73 636f 7265 5f72  def smoc_score_r
+00012b50: 6967 6964 5f62 6f64 6965 7328 0a20 2020  igid_bodies(.   
+00012b60: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00012b70: 2020 2020 2020 2020 2020 2064 6963 745f             dict_
+00012b80: 7265 735f 696e 6469 6365 732c 0a20 2020  res_indices,.   
+00012b90: 2020 2020 2020 2020 2072 6967 6964 5f62           rigid_b
+00012ba0: 6f64 795f 6669 6c65 2c0a 2020 2020 2020  ody_file,.      
+00012bb0: 2020 2020 2020 6368 2c0a 2020 2020 2020        ch,.      
+00012bc0: 2020 2020 2020 696e 6469 2c0a 2020 2020        indi,.    
+00012bd0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
+00012be0: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
+00012bf0: 7369 6d5f 6d61 700a 2020 2020 293a 0a20  sim_map.    ):. 
+00012c00: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
+00012c10: 7363 6f72 6573 203d 207b 7d0a 2020 2020  scores = {}.    
+00012c20: 2020 2020 6469 6374 5f72 6266 203d 2052      dict_rbf = R
+00012c30: 4250 6172 7365 722e 7265 6164 5f72 6967  BParser.read_rig
+00012c40: 6964 5f62 6f64 795f 6669 6c65 2872 6967  id_body_file(rig
+00012c50: 6964 5f62 6f64 795f 6669 6c65 290a 2020  id_body_file).  
+00012c60: 2020 2020 2020 6368 6169 6e69 645f 7365        chainid_se
+00012c70: 7420 3d20 6368 0a20 2020 2020 2020 2069  t = ch.        i
+00012c80: 6620 6c65 6e28 6368 2920 3d3d 2030 3a0a  f len(ch) == 0:.
+00012c90: 2020 2020 2020 2020 2020 2020 6368 6169              chai
+00012ca0: 6e69 645f 7365 7420 3d20 272d 270a 2020  nid_set = '-'.  
+00012cb0: 2020 2020 2020 6966 2063 6861 696e 6964        if chainid
+00012cc0: 5f73 6574 2069 6e20 6469 6374 5f72 6266  _set in dict_rbf
+00012cd0: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+00012ce0: 7220 7262 2069 6e20 6469 6374 5f72 6266  r rb in dict_rbf
+00012cf0: 5b63 6861 696e 6964 5f73 6574 5d3a 0a20  [chainid_set]:. 
+00012d00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00012d10: 2065 6163 6820 7269 6769 6420 626f 6479   each rigid body
+00012d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012d30: 2069 6e64 6963 6573 203d 205b 5d0a 2020   indices = [].  
+00012d40: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00012d50: 735f 6c69 7374 203d 205b 5d0a 2020 2020  s_list = [].    
+00012d60: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+00012d70: 7365 6720 696e 2064 6963 745f 7262 665b  seg in dict_rbf[
+00012d80: 6368 6169 6e69 645f 7365 745d 5b72 625d  chainid_set][rb]
+00012d90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00012da0: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+00012db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012dc0: 2020 2066 6f72 2072 2069 6e20 7261 6e67     for r in rang
+00012dd0: 6528 696e 7428 7365 675b 305d 292c 2069  e(int(seg[0]), i
+00012de0: 6e74 2873 6567 5b31 5d29 202b 2031 293a  nt(seg[1]) + 1):
+00012df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e00: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00012e10: 6963 6573 2e65 7874 656e 6428 6469 6374  ices.extend(dict
+00012e20: 5f72 6573 5f69 6e64 6963 6573 5b72 5d29  _res_indices[r])
+00012e30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012e40: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00012e50: 5f6c 6973 742e 6170 7065 6e64 2872 290a  _list.append(r).
+00012e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012e70: 2020 2020 6578 6365 7074 2054 7970 6545      except TypeE
+00012e80: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00012e90: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00012ea0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00012eb0: 2020 2020 2020 2023 206d 696e 696d 756d         # minimum
+00012ec0: 2076 616c 7565 2073 6574 2061 7320 3020   value set as 0 
+00012ed0: 6865 7265 2028 6173 7375 6d69 6e67 206f  here (assuming o
+00012ee0: 6e6c 7920 706f 7369 7469 7665 2076 616c  nly positive val
+00012ef0: 7565 7321 290a 2020 2020 2020 2020 2020  ues!).          
+00012f00: 2020 2020 2020 6966 206c 656e 2869 6e64        if len(ind
+00012f10: 6963 6573 2920 3d3d 2030 3a0a 2020 2020  ices) == 0:.    
+00012f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012f30: 666f 7220 7265 7320 696e 2072 6573 5f6c  for res in res_l
+00012f40: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00012f50: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+00012f60: 745f 7265 735f 7363 6f72 6573 5b72 6573  t_res_scores[res
+00012f70: 5d20 3d20 302e 3020 2023 202d 302e 3939  ] = 0.0  # -0.99
+00012f80: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012f90: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00012fa0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00012fb0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00012fc0: 2020 2020 2020 2069 6e64 5f61 7272 7a79         ind_arrzy
+00012fd0: 7820 3d20 7365 6c66 2e69 6e64 6963 6573  x = self.indices
+00012fe0: 5f73 6d6f 6328 696e 6469 6365 732c 2069  _smoc(indices, i
+00012ff0: 6e64 6929 0a20 2020 2020 2020 2020 2020  ndi).           
+00013000: 2020 2020 2020 2020 2073 6d6f 6320 3d20           smoc = 
+00013010: 7365 6c66 2e63 616c 635f 6d6f 6328 696e  self.calc_moc(in
+00013020: 645f 6172 727a 7978 2c20 7369 6d5f 6d61  d_arrzyx, sim_ma
+00013030: 702c 206d 6170 5f74 6172 6765 7429 0a20  p, map_target). 
+00013040: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00013050: 7863 6570 7420 496e 6465 7845 7272 6f72  xcept IndexError
+00013060: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00013070: 2020 2020 2020 736d 6f63 203d 2030 2e30        smoc = 0.0
+00013080: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013090: 2023 2073 6176 6520 7363 6f72 6573 0a20   # save scores. 
+000130a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000130b0: 6f72 2072 6573 2069 6e20 7265 735f 6c69  or res in res_li
+000130c0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+000130d0: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
+000130e0: 5f73 636f 7265 735b 7265 735d 203d 2073  _scores[res] = s
+000130f0: 6d6f 630a 2020 2020 2020 2020 7265 7475  moc.        retu
+00013100: 726e 2064 6963 745f 7265 735f 7363 6f72  rn dict_res_scor
+00013110: 6573 0a0a 2020 2020 6465 6620 736d 6f63  es..    def smoc
+00013120: 5f67 6574 5f69 6e64 6963 6573 5f66 7261  _get_indices_fra
+00013130: 676d 656e 745f 7769 6e64 6f77 2873 656c  gment_window(sel
+00013140: 662c 2064 6963 745f 7265 735f 696e 6469  f, dict_res_indi
+00013150: 6365 732c 0a20 2020 2020 2020 2020 2020  ces,.           
 00013160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013170: 2020 2020 736d 6f63 203d 2073 656c 662e      smoc = self.
-00013180: 6361 6c63 5f6d 6f63 2869 6e64 5f61 7272  calc_moc(ind_arr
-00013190: 7a79 782c 2073 696d 5f6d 6170 2c20 6d61  zyx, sim_map, ma
-000131a0: 705f 7461 7267 6574 290a 2020 2020 2020  p_target).      
-000131b0: 2020 2020 2020 2020 2020 6578 6365 7074            except
-000131c0: 2049 6e64 6578 4572 726f 723a 0a20 2020   IndexError:.   
-000131d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000131e0: 2073 6d6f 6320 3d20 302e 300a 2020 2020   smoc = 0.0.    
-000131f0: 2020 2020 2020 2020 2020 2020 2320 7361              # sa
-00013200: 7665 2073 636f 7265 730a 2020 2020 2020  ve scores.      
-00013210: 2020 2020 2020 2020 2020 666f 7220 7265            for re
-00013220: 7320 696e 2072 6573 5f6c 6973 743a 0a20  s in res_list:. 
-00013230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013240: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
-00013250: 6573 5b72 6573 5d20 3d20 736d 6f63 0a20  es[res] = smoc. 
-00013260: 2020 2020 2020 2072 6574 7572 6e20 6469         return di
-00013270: 6374 5f72 6573 5f73 636f 7265 730a 0a20  ct_res_scores.. 
-00013280: 2020 2064 6566 2073 6d6f 635f 6765 745f     def smoc_get_
-00013290: 696e 6469 6365 735f 6672 6167 6d65 6e74  indices_fragment
-000132a0: 5f77 696e 646f 7728 7365 6c66 2c20 6469  _window(self, di
-000132b0: 6374 5f72 6573 5f69 6e64 6963 6573 2c0a  ct_res_indices,.
-000132c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000132e0: 2020 2020 2020 2020 2064 6963 745f 6368           dict_ch
-000132f0: 6169 6e5f 7265 732c 2063 682c 2072 6573  ain_res, ch, res
-00013300: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00013310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013320: 2020 2020 2020 2020 2020 2077 696e 293a             win):
-00013330: 0a20 2020 2020 2020 2069 6e64 6963 6573  .        indices
-00013340: 203d 2064 6963 745f 7265 735f 696e 6469   = dict_res_indi
-00013350: 6365 735b 7265 735d 5b3a 5d0a 2020 2020  ces[res][:].    
-00013360: 2020 2020 2320 636f 6e73 6964 6572 2072      # consider r
-00013370: 6573 6964 7565 7320 6f6e 2062 6f74 6820  esidues on both 
-00013380: 7369 6465 732e 204e 4f54 453a 2077 6f6e  sides. NOTE: won
-00013390: 7420 776f 726b 2066 6f72 2069 6e73 6572  t work for inser
-000133a0: 7469 6f6e 2063 6f64 6573 210a 2020 2020  tion codes!.    
-000133b0: 2020 2020 2320 6e65 6564 2074 6f20 7265      # need to re
-000133c0: 7769 7465 2072 6573 206e 756d 6265 7273  wite res numbers
-000133d0: 2074 6f20 6176 6f69 6420 696e 7365 7274   to avoid insert
-000133e0: 696f 6e20 636f 6465 730a 2020 2020 2020  ion codes.      
-000133f0: 2020 666f 7220 6969 2069 6e20 7261 6e67    for ii in rang
-00013400: 6528 312c 2069 6e74 2872 6f75 6e64 2828  e(1, int(round((
-00013410: 7769 6e20 2b20 3129 202f 2032 2929 293a  win + 1) / 2))):
-00013420: 0a20 2020 2020 2020 2020 2020 2074 7279  .            try
-00013430: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00013440: 2020 7265 735f 6964 7820 3d20 6469 6374    res_idx = dict
-00013450: 5f63 6861 696e 5f72 6573 5b63 685d 2e69  _chain_res[ch].i
-00013460: 6e64 6578 2872 6573 2920 2d20 6969 0a20  ndex(res) - ii. 
-00013470: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00013480: 6620 7265 735f 6964 7820 3c20 303a 0a20  f res_idx < 0:. 
-00013490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000134a0: 2020 2063 6f6e 7469 6e75 650a 2020 2020     continue.    
-000134b0: 2020 2020 2020 2020 2020 2020 2320 6765              # ge
-000134c0: 7420 7072 6576 2072 6573 6964 7565 2069  t prev residue i
-000134d0: 6e64 6963 6573 0a20 2020 2020 2020 2020  ndices.         
-000134e0: 2020 2020 2020 2069 6e64 6963 6573 2e65         indices.e
-000134f0: 7874 656e 6428 0a20 2020 2020 2020 2020  xtend(.         
-00013500: 2020 2020 2020 2020 2020 2064 6963 745f             dict_
-00013510: 7265 735f 696e 6469 6365 735b 0a20 2020  res_indices[.   
-00013520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013530: 2020 2020 2064 6963 745f 6368 6169 6e5f       dict_chain_
-00013540: 7265 735b 6368 5d0a 2020 2020 2020 2020  res[ch].        
-00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013560: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
-00013570: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00013580: 735f 6964 780a 2020 2020 2020 2020 2020  s_idx.          
-00013590: 2020 2020 2020 2020 2020 2020 2020 5d0a                ].
-000135a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000135b0: 2020 2020 5d0a 2020 2020 2020 2020 2020      ].          
-000135c0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-000135d0: 2020 2020 6578 6365 7074 2028 4b65 7945      except (KeyE
-000135e0: 7272 6f72 2c20 496e 6465 7845 7272 6f72  rror, IndexError
-000135f0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00013600: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
-00013610: 666f 7220 6969 2069 6e20 7261 6e67 6528  for ii in range(
-00013620: 312c 2069 6e74 2872 6f75 6e64 2828 7769  1, int(round((wi
-00013630: 6e20 2b20 3129 202f 2032 2929 293a 0a20  n + 1) / 2))):. 
-00013640: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00013650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013660: 696e 6469 6365 732e 6578 7465 6e64 280a  indices.extend(.
-00013670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013680: 2020 2020 6469 6374 5f72 6573 5f69 6e64      dict_res_ind
-00013690: 6963 6573 5b0a 2020 2020 2020 2020 2020  ices[.          
-000136a0: 2020 2020 2020 2020 2020 2020 2020 6469                di
-000136b0: 6374 5f63 6861 696e 5f72 6573 5b63 685d  ct_chain_res[ch]
-000136c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000136d0: 2020 2020 2020 2020 205b 0a20 2020 2020           [.     
-000136e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000136f0: 2020 2020 2020 2064 6963 745f 6368 6169         dict_chai
-00013700: 6e5f 7265 735b 6368 5d2e 696e 6465 7828  n_res[ch].index(
-00013710: 7265 7329 202b 2069 690a 2020 2020 2020  res) + ii.      
-00013720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013730: 2020 5d0a 2020 2020 2020 2020 2020 2020    ].            
-00013740: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
-00013750: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00013760: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-00013770: 496e 6465 7845 7272 6f72 2c20 4b65 7945  IndexError, KeyE
-00013780: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
-00013790: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-000137a0: 2020 2020 7265 7475 726e 2069 6e64 6963      return indic
-000137b0: 6573 0a0a 2020 2020 6465 6620 736d 6f63  es..    def smoc
-000137c0: 5f67 6574 5f69 6e64 6963 6573 5f73 7068  _get_indices_sph
-000137d0: 6572 6528 7365 6c66 2c20 6772 6964 7472  ere(self, gridtr
-000137e0: 6565 2c20 636f 6f72 642c 2064 6973 743d  ee, coord, dist=
-000137f0: 352e 3029 3a0a 2020 2020 2020 2020 6c69  5.0):.        li
-00013800: 7374 5f70 6f69 6e74 7320 3d20 6772 6964  st_points = grid
-00013810: 7472 6565 2e71 7565 7279 5f62 616c 6c5f  tree.query_ball_
-00013820: 706f 696e 7428 0a20 2020 2020 2020 2020  point(.         
-00013830: 2020 205b 636f 6f72 645b 305d 2c20 636f     [coord[0], co
-00013840: 6f72 645b 315d 2c20 636f 6f72 645b 325d  ord[1], coord[2]
-00013850: 5d2c 0a20 2020 2020 2020 2020 2020 2064  ],.            d
-00013860: 6973 740a 2020 2020 2020 2020 290a 2020  ist.        ).  
-00013870: 2020 2020 2020 7265 7475 726e 206c 6973        return lis
-00013880: 745f 706f 696e 7473 0a0a 2020 2020 6465  t_points..    de
-00013890: 6620 534d 4f43 2873 656c 662c 0a20 2020  f SMOC(self,.   
-000138a0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-000138b0: 7267 6574 2c0a 2020 2020 2020 2020 2020  rget,.          
-000138c0: 2020 2072 6573 6f6c 7574 696f 6e5f 6465     resolution_de
-000138d0: 6e73 4d61 702c 0a20 2020 2020 2020 2020  nsMap,.         
-000138e0: 2020 2020 7374 7275 6374 7572 655f 696e      structure_in
-000138f0: 7374 616e 6365 3d4e 6f6e 652c 0a20 2020  stance=None,.   
-00013900: 2020 2020 2020 2020 2020 7769 6e3d 3131            win=11
-00013910: 2c0a 2020 2020 2020 2020 2020 2020 2072  ,.             r
-00013920: 6967 6964 5f62 6f64 795f 6669 6c65 3d4e  igid_body_file=N
-00013930: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
-00013940: 2020 7369 6d5f 6d61 703d 4e6f 6e65 2c0a    sim_map=None,.
-00013950: 2020 2020 2020 2020 2020 2020 2073 6967               sig
-00013960: 6d61 5f6d 6170 3d30 2e32 3235 2c0a 2020  ma_map=0.225,.  
-00013970: 2020 2020 2020 2020 2020 2077 7269 7465             write
-00013980: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
-00013990: 2020 2020 2063 5f6d 6f64 653d 5472 7565       c_mode=True
-000139a0: 2c0a 2020 2020 2020 2020 2020 2020 2073  ,.             s
-000139b0: 6967 6d61 5f74 6872 3d32 2e35 2c0a 2020  igma_thr=2.5,.  
-000139c0: 2020 2020 2020 2020 2020 2066 7261 676d             fragm
-000139d0: 656e 745f 7363 6f72 653d 5472 7565 2c0a  ent_score=True,.
-000139e0: 2020 2020 2020 2020 2020 2020 2064 6973               dis
-000139f0: 743d 352e 302c 0a20 2020 2020 2020 2020  t=5.0,.         
-00013a00: 2020 2020 6174 6f6d 5f63 656e 7472 653d      atom_centre=
-00013a10: 2743 4127 2c0a 2020 2020 2020 2020 2020  'CA',.          
-00013a20: 2020 2063 616c 635f 6d65 7472 6963 3d27     calc_metric='
-00013a30: 736d 6f63 272c 0a20 2020 2020 2020 2020  smoc',.         
-00013a40: 2020 2020 6765 745f 636f 6f72 643d 5472      get_coord=Tr
-00013a50: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
-00013a60: 293a 0a20 2020 2020 2020 2022 2222 4361  ):.        """Ca
-00013a70: 6c63 756c 6174 6520 7468 6520 6c6f 6361  lculate the loca
-00013a80: 6c20 4d61 6e64 6572 2773 204f 7665 726c  l Mander's Overl
-00013a90: 6170 2066 6f72 2065 6163 6820 7265 7369  ap for each resi
-00013aa0: 6475 6520 696e 2061 2070 726f 7465 696e  due in a protein
-00013ab0: 0a20 2020 2020 2020 206d 6f64 656c 0a0a  .        model..
-00013ac0: 2020 2020 2020 2020 534d 4f43 2063 616e          SMOC can
-00013ad0: 2062 6520 6361 6c63 756c 6174 6564 2069   be calculated i
-00013ae0: 6e20 7477 6f20 7761 7973 3a0a 0a20 2020  n two ways:..   
-00013af0: 2020 2020 2020 2020 202a 202a 2a53 4d4f           * **SMO
-00013b00: 4366 2a2a 3a20 5468 6520 534d 4f43 2073  Cf**: The SMOC s
-00013b10: 636f 7265 2069 7320 6361 6c63 756c 6174  core is calculat
-00013b20: 6564 2066 6f72 2072 6573 6964 7565 7320  ed for residues 
-00013b30: 6164 6a61 6365 6e74 2069 6e0a 2020 2020  adjacent in.    
-00013b40: 2020 2020 2020 2020 2020 7365 7175 656e            sequen
-00013b50: 6365 2c20 7573 696e 6720 6120 736c 6964  ce, using a slid
-00013b60: 696e 6720 616e 6420 6f76 6572 6c61 7070  ing and overlapp
-00013b70: 696e 6720 7769 6e64 6f77 2e0a 2020 2020  ing window..    
-00013b80: 2020 2020 2020 2020 2a20 2a2a 534d 4f43          * **SMOC
-00013b90: 642a 2a3a 2050 6978 656c 7320 6172 6520  d**: Pixels are 
-00013ba0: 7363 6f72 6564 2069 6e20 6120 7370 6865  scored in a sphe
-00013bb0: 7269 6361 6c20 7261 6469 7573 2061 726f  rical radius aro
-00013bc0: 756e 6420 6561 6368 0a20 2020 2020 2020  und each.       
-00013bd0: 2020 2020 2020 2072 6573 6964 7565 0a0a         residue..
-00013be0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-00013bf0: 733a 0a20 2020 2020 2020 2020 2020 206d  s:.            m
-00013c00: 6170 5f74 6172 6765 743a 2054 6172 6765  ap_target: Targe
-00013c10: 7420 4d61 7020 496e 7374 616e 6365 2e0a  t Map Instance..
-00013c20: 2020 2020 2020 2020 2020 2020 7265 736f              reso
-00013c30: 6c75 7469 6f6e 5f64 656e 734d 6170 3a20  lution_densMap: 
-00013c40: 5265 736f 6c75 7469 6f6e 206f 6620 7468  Resolution of th
-00013c50: 6520 7461 7267 6574 206d 6170 2e0a 2020  e target map..  
-00013c60: 2020 2020 2020 2020 2020 7374 7275 6374            struct
-00013c70: 7572 655f 696e 7374 616e 6365 3a20 4d6f  ure_instance: Mo
-00013c80: 6465 6c20 7374 7275 6374 7572 6520 696e  del structure in
-00013c90: 7374 616e 6365 2e0a 2020 2020 2020 2020  stance..        
-00013ca0: 2020 2020 7769 6e3a 204f 7665 726c 6170      win: Overlap
-00013cb0: 7069 6e67 2057 696e 646f 7720 6c65 6e67  ping Window leng
-00013cc0: 7468 2074 6f20 6361 6c63 756c 6174 6520  th to calculate 
-00013cd0: 7468 6520 7363 6f72 650a 2020 2020 2020  the score.      
-00013ce0: 2020 2020 2020 7269 6769 645f 626f 6479        rigid_body
-00013cf0: 5f66 696c 653a 2050 6174 6820 746f 2072  _file: Path to r
-00013d00: 6967 6964 2d62 6f64 7920 6669 6c65 2e0a  igid-body file..
-00013d10: 2020 2020 2020 2020 2020 2020 7369 6d5f              sim_
-00013d20: 6d61 703a 2050 7265 636f 6d70 7574 6564  map: Precomputed
-00013d30: 2073 696d 756c 6174 6564 206d 6170 2e20   simulated map. 
-00013d40: 4966 203a 636f 6465 3a60 4e6f 6e65 602c  If :code:`None`,
-00013d50: 2073 696d 5f6d 6170 2069 730a 2020 2020   sim_map is.    
-00013d60: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
-00013d70: 756c 6174 6564 2061 7574 6f6d 6174 6963  ulated automatic
-00013d80: 616c 6c79 2e0a 2020 2020 2020 2020 2020  ally..          
-00013d90: 2020 7369 676d 615f 6d61 703a 2050 6172    sigma_map: Par
-00013da0: 616d 6574 6572 206e 6565 6420 666f 7220  ameter need for 
-00013db0: 5374 7275 6374 7572 6520 426c 7572 7265  Structure Blurre
-00013dc0: 722e 2046 756c 6c20 6578 706c 616e 6174  r. Full explanat
-00013dd0: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00013de0: 2020 2020 3a72 6566 3a60 6865 7265 3c4e      :ref:`here<N
-00013df0: 6f74 6520 6f6e 2072 6561 6c20 7370 6163  ote on real spac
-00013e00: 6520 626c 7572 7269 6e67 3a3e 600a 2020  e blurring:>`.  
-00013e10: 2020 2020 2020 2020 2020 7772 6974 653a            write:
-00013e20: 2044 6570 7265 6361 7465 642c 206e 6f74   Deprecated, not
-00013e30: 2075 7365 642e 0a20 2020 2020 2020 2020   used..         
-00013e40: 2020 2063 5f6d 6f64 653a 2044 6570 7265     c_mode: Depre
-00013e50: 6361 7465 642c 206e 6f74 2075 7365 642e  cated, not used.
-00013e60: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
-00013e70: 6d61 5f74 6872 3a20 5061 7261 6d65 7465  ma_thr: Paramete
-00013e80: 7220 7573 6564 2074 6f20 6c61 6265 6c20  r used to label 
-00013e90: 7069 7865 6c73 206e 6561 7220 6561 6368  pixels near each
-00013ea0: 2061 746f 6d20 696e 2074 6865 0a20 2020   atom in the.   
-00013eb0: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
-00013ec0: 656c 2e20 4578 706c 6169 6e65 6420 696e  el. Explained in
-00013ed0: 2066 7572 7468 6572 2064 6574 6169 6c0a   further detail.
-00013ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ef0: 3a6d 6574 683a 6068 6572 6520 3c54 454d  :meth:`here <TEM
-00013f00: 5079 2e70 726f 7465 696e 2e73 7472 7563  Py.protein.struc
-00013f10: 7475 7265 5f62 6c75 7272 6572 2e53 7472  ture_blurrer.Str
-00013f20: 7563 7475 7265 426c 7572 7265 722e 6765  uctureBlurrer.ge
-00013f30: 745f 696e 6469 6365 733e 600a 2020 2020  t_indices>`.    
-00013f40: 2020 2020 2020 2020 6672 6167 6d65 6e74          fragment
-00013f50: 5f73 636f 7265 3a20 4966 2054 7275 652c  _score: If True,
-00013f60: 2075 7365 2053 4d4f 4366 206d 6574 686f   use SMOCf metho
-00013f70: 642e 2049 6620 4661 6c73 652c 2075 7365  d. If False, use
-00013f80: 2053 4d4f 4364 0a20 2020 2020 2020 2020   SMOCd.         
-00013f90: 2020 2020 2020 206d 6574 686f 642e 0a20         method.. 
-00013fa0: 2020 2020 2020 2020 2020 2064 6973 743a             dist:
-00013fb0: 2044 6570 7265 6361 7465 642c 206e 6f74   Deprecated, not
-00013fc0: 2075 7365 642e 0a20 2020 2020 2020 2020   used..         
-00013fd0: 2020 2061 746f 6d5f 6365 6e74 7265 3a20     atom_centre: 
-00013fe0: 5768 6963 6820 6174 6f6d 2074 7970 6520  Which atom type 
-00013ff0: 7368 6f75 6c64 2062 6520 636f 6e73 6964  should be consid
-00014000: 6572 6564 2074 6865 2063 656e 7472 6520  ered the centre 
-00014010: 6f66 0a20 2020 2020 2020 2020 2020 2020  of.             
-00014020: 2020 2072 6573 6964 7565 732e 0a20 2020     residues..   
-00014030: 2020 2020 2020 2020 2063 616c 635f 6d65           calc_me
-00014040: 7472 6963 3a20 5768 6963 6820 6d65 7468  tric: Which meth
-00014050: 6f64 2074 6f20 7573 6520 666f 7220 6361  od to use for ca
-00014060: 6c63 756c 6174 696e 6720 7468 6520 6c6f  lculating the lo
-00014070: 6361 6c20 7363 6f72 6520 6174 0a20 2020  cal score at.   
-00014080: 2020 2020 2020 2020 2020 2020 2065 6163               eac
-00014090: 6820 7265 7369 6475 652e 2043 616e 2062  h residue. Can b
-000140a0: 6520 3a63 6f64 653a 6022 736d 6f63 2260  e :code:`"smoc"`
-000140b0: 206f 7220 3a63 6f64 653a 6022 7363 6363   or :code:`"sccc
-000140c0: 2260 0a20 2020 2020 2020 2020 2020 2067  "`.            g
-000140d0: 6574 5f63 6f6f 7264 3a20 5265 7475 726e  et_coord: Return
-000140e0: 2061 6464 6974 696f 6e61 6c20 6469 6374   additional dict
-000140f0: 5f63 6861 696e 5f43 4120 6469 6374 696f  _chain_CA dictio
-00014100: 6e61 7279 2e0a 0a20 2020 2020 2020 2052  nary...        R
-00014110: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00014120: 2020 2020 4469 6374 696f 6e61 7279 3a0a      Dictionary:.
-00014130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014140: 5468 6520 6469 6374 696f 6e61 7269 6573  The dictionaries
-00014150: 2064 6963 745f 6368 6169 6e5f 7363 6f72   dict_chain_scor
-00014160: 6573 2c20 6469 6374 5f63 6861 696e 5f72  es, dict_chain_r
-00014170: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
-00014180: 2020 2020 2020 2020 6469 6374 5f63 6861          dict_cha
-00014190: 696e 5f43 4120 6973 2072 6574 7572 6e65  in_CA is returne
-000141a0: 6420 6164 6469 7469 6f6e 616c 6c79 2069  d additionally i
-000141b0: 6620 6765 745f 636f 6f72 6420 3d20 5472  f get_coord = Tr
-000141c0: 7565 0a0a 2020 2020 2020 2020 2020 2020  ue..            
-000141d0: 2020 2020 2a20 6469 6374 5f63 6861 696e      * dict_chain
-000141e0: 5f73 636f 7265 733a 2032 4420 6469 6374  _scores: 2D dict
-000141f0: 696f 6e61 7279 2063 6f6e 7461 696e 696e  ionary containin
-00014200: 6720 7468 6520 534d 4f43 2073 636f 7265  g the SMOC score
-00014210: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00014220: 2020 2020 666f 7220 6561 6368 2072 6573      for each res
-00014230: 6964 7565 2e20 4b65 7973 2061 7265 2063  idue. Keys are c
-00014240: 6861 696e 5f6c 6162 656c 2066 6f72 2066  hain_label for f
-00014250: 6972 7374 2064 6963 7469 6f6e 6172 790a  irst dictionary.
-00014260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014270: 2020 616e 6420 7265 7369 6475 655f 6e75    and residue_nu
-00014280: 6d62 6572 2066 6f72 2073 6563 6f6e 6420  mber for second 
-00014290: 6469 6374 696f 6e61 7279 2c20 652e 672e  dictionary, e.g.
-000142a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000142b0: 2020 2020 3a63 6f64 653a 6064 6963 745f      :code:`dict_
-000142c0: 6368 6169 6e5f 7363 6f72 6573 5b63 6861  chain_scores[cha
-000142d0: 696e 5f6c 6162 656c 5d5b 7265 7369 6475  in_label][residu
-000142e0: 655f 6e75 6d62 6572 5d20 3d20 534d 4f43  e_number] = SMOC
-000142f0: 5f73 636f 7265 600a 0a20 2020 2020 2020  _score`..       
-00014300: 2020 2020 2020 2020 202a 2064 6963 745f           * dict_
-00014310: 6368 6169 6e5f 7265 733a 2044 6963 7469  chain_res: Dicti
-00014320: 6f6e 6172 7920 7769 7468 2063 6861 696e  onary with chain
-00014330: 206c 6162 656c 7320 2865 2e67 2e0a 2020   labels (e.g..  
-00014340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014350: 3a63 6f64 653a 6022 4122 6029 2061 7320  :code:`"A"`) as 
-00014360: 6b65 7973 2061 6e64 2061 206c 6973 7420  keys and a list 
-00014370: 6f66 2061 6c6c 2072 6573 6964 7565 206e  of all residue n
-00014380: 756d 6265 7273 2066 6f72 0a20 2020 2020  umbers for.     
-00014390: 2020 2020 2020 2020 2020 2020 2061 2067               a g
-000143a0: 6976 656e 2063 6861 696e 2061 7320 7661  iven chain as va
-000143b0: 6c75 6573 2e0a 0a20 2020 2020 2020 2020  lues...         
-000143c0: 2020 2020 2020 202a 2064 6963 745f 6368         * dict_ch
-000143d0: 6169 6e5f 4341 3a20 3244 2064 6963 7469  ain_CA: 2D dicti
-000143e0: 6f6e 6172 7920 636f 6e74 6169 6e69 6e67  onary containing
-000143f0: 2061 206c 6973 7420 666f 7220 6561 6368   a list for each
-00014400: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014410: 2020 2072 6573 6964 7565 2c20 636f 6e74     residue, cont
-00014420: 6169 6e69 6e67 2074 6865 2061 6d69 6e6f  aining the amino
-00014430: 2061 6369 6420 7479 7065 206f 6620 6561   acid type of ea
-00014440: 6368 2072 6573 6964 7565 2061 6e64 0a20  ch residue and. 
-00014450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014460: 2069 7473 2033 4420 636f 6f72 6469 6e61   its 3D coordina
-00014470: 7465 732e 204b 6579 7320 6172 6520 6368  tes. Keys are ch
-00014480: 6169 6e5f 6c61 6265 6c20 666f 7220 6669  ain_label for fi
-00014490: 7273 7420 6469 6374 696f 6e61 7279 0a20  rst dictionary. 
+00013170: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00013180: 6374 5f63 6861 696e 5f72 6573 2c20 6368  ct_chain_res, ch
+00013190: 2c20 7265 732c 0a20 2020 2020 2020 2020  , res,.         
+000131a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000131c0: 7769 6e29 3a0a 2020 2020 2020 2020 696e  win):.        in
+000131d0: 6469 6365 7320 3d20 6469 6374 5f72 6573  dices = dict_res
+000131e0: 5f69 6e64 6963 6573 5b72 6573 5d5b 3a5d  _indices[res][:]
+000131f0: 0a20 2020 2020 2020 2023 2063 6f6e 7369  .        # consi
+00013200: 6465 7220 7265 7369 6475 6573 206f 6e20  der residues on 
+00013210: 626f 7468 2073 6964 6573 2e20 4e4f 5445  both sides. NOTE
+00013220: 3a20 776f 6e74 2077 6f72 6b20 666f 7220  : wont work for 
+00013230: 696e 7365 7274 696f 6e20 636f 6465 7321  insertion codes!
+00013240: 0a20 2020 2020 2020 2023 206e 6565 6420  .        # need 
+00013250: 746f 2072 6577 6974 6520 7265 7320 6e75  to rewite res nu
+00013260: 6d62 6572 7320 746f 2061 766f 6964 2069  mbers to avoid i
+00013270: 6e73 6572 7469 6f6e 2063 6f64 6573 0a20  nsertion codes. 
+00013280: 2020 2020 2020 2066 6f72 2069 6920 696e         for ii in
+00013290: 2072 616e 6765 2831 2c20 696e 7428 726f   range(1, int(ro
+000132a0: 756e 6428 2877 696e 202b 2031 2920 2f20  und((win + 1) / 
+000132b0: 3229 2929 3a0a 2020 2020 2020 2020 2020  2))):.          
+000132c0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000132d0: 2020 2020 2020 2072 6573 5f69 6478 203d         res_idx =
+000132e0: 2064 6963 745f 6368 6169 6e5f 7265 735b   dict_chain_res[
+000132f0: 6368 5d2e 696e 6465 7828 7265 7329 202d  ch].index(res) -
+00013300: 2069 690a 2020 2020 2020 2020 2020 2020   ii.            
+00013310: 2020 2020 6966 2072 6573 5f69 6478 203c      if res_idx <
+00013320: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00013330: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
+00013340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013350: 2023 2067 6574 2070 7265 7620 7265 7369   # get prev resi
+00013360: 6475 6520 696e 6469 6365 730a 2020 2020  due indices.    
+00013370: 2020 2020 2020 2020 2020 2020 696e 6469              indi
+00013380: 6365 732e 6578 7465 6e64 280a 2020 2020  ces.extend(.    
+00013390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133a0: 6469 6374 5f72 6573 5f69 6e64 6963 6573  dict_res_indices
+000133b0: 5b0a 2020 2020 2020 2020 2020 2020 2020  [.              
+000133c0: 2020 2020 2020 2020 2020 6469 6374 5f63            dict_c
+000133d0: 6861 696e 5f72 6573 5b63 685d 0a20 2020  hain_res[ch].   
+000133e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000133f0: 2020 2020 205b 0a20 2020 2020 2020 2020       [.         
+00013400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013410: 2020 2072 6573 5f69 6478 0a20 2020 2020     res_idx.     
+00013420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013430: 2020 205d 0a20 2020 2020 2020 2020 2020     ].           
+00013440: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
+00013450: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00013460: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00013470: 284b 6579 4572 726f 722c 2049 6e64 6578  (KeyError, Index
+00013480: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00013490: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
+000134a0: 2020 2020 2066 6f72 2069 6920 696e 2072       for ii in r
+000134b0: 616e 6765 2831 2c20 696e 7428 726f 756e  ange(1, int(roun
+000134c0: 6428 2877 696e 202b 2031 2920 2f20 3229  d((win + 1) / 2)
+000134d0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
+000134e0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+000134f0: 2020 2020 2069 6e64 6963 6573 2e65 7874       indices.ext
+00013500: 656e 6428 0a20 2020 2020 2020 2020 2020  end(.           
+00013510: 2020 2020 2020 2020 2064 6963 745f 7265           dict_re
+00013520: 735f 696e 6469 6365 735b 0a20 2020 2020  s_indices[.     
+00013530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013540: 2020 2064 6963 745f 6368 6169 6e5f 7265     dict_chain_re
+00013550: 735b 6368 5d0a 2020 2020 2020 2020 2020  s[ch].          
+00013560: 2020 2020 2020 2020 2020 2020 2020 5b0a                [.
+00013570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013580: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+00013590: 5f63 6861 696e 5f72 6573 5b63 685d 2e69  _chain_res[ch].i
+000135a0: 6e64 6578 2872 6573 2920 2b20 6969 0a20  ndex(res) + ii. 
+000135b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135c0: 2020 2020 2020 205d 0a20 2020 2020 2020         ].       
+000135d0: 2020 2020 2020 2020 2020 2020 205d 0a20               ]. 
+000135e0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+000135f0: 0a20 2020 2020 2020 2020 2020 2065 7863  .            exc
+00013600: 6570 7420 2849 6e64 6578 4572 726f 722c  ept (IndexError,
+00013610: 204b 6579 4572 726f 7229 3a0a 2020 2020   KeyError):.    
+00013620: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00013630: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00013640: 696e 6469 6365 730a 0a20 2020 2064 6566  indices..    def
+00013650: 2073 6d6f 635f 6765 745f 696e 6469 6365   smoc_get_indice
+00013660: 735f 7370 6865 7265 2873 656c 662c 2067  s_sphere(self, g
+00013670: 7269 6474 7265 652c 2063 6f6f 7264 2c20  ridtree, coord, 
+00013680: 6469 7374 3d35 2e30 293a 0a20 2020 2020  dist=5.0):.     
+00013690: 2020 206c 6973 745f 706f 696e 7473 203d     list_points =
+000136a0: 2067 7269 6474 7265 652e 7175 6572 795f   gridtree.query_
+000136b0: 6261 6c6c 5f70 6f69 6e74 280a 2020 2020  ball_point(.    
+000136c0: 2020 2020 2020 2020 5b63 6f6f 7264 5b30          [coord[0
+000136d0: 5d2c 2063 6f6f 7264 5b31 5d2c 2063 6f6f  ], coord[1], coo
+000136e0: 7264 5b32 5d5d 2c0a 2020 2020 2020 2020  rd[2]],.        
+000136f0: 2020 2020 6469 7374 0a20 2020 2020 2020      dist.       
+00013700: 2029 0a20 2020 2020 2020 2072 6574 7572   ).        retur
+00013710: 6e20 6c69 7374 5f70 6f69 6e74 730a 0a20  n list_points.. 
+00013720: 2020 2064 6566 2053 4d4f 4328 7365 6c66     def SMOC(self
+00013730: 2c0a 2020 2020 2020 2020 2020 2020 206d  ,.             m
+00013740: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
+00013750: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
+00013760: 6f6e 5f64 656e 734d 6170 2c0a 2020 2020  on_densMap,.    
+00013770: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+00013780: 7265 5f69 6e73 7461 6e63 653d 4e6f 6e65  re_instance=None
+00013790: 2c0a 2020 2020 2020 2020 2020 2020 2077  ,.             w
+000137a0: 696e 3d31 312c 0a20 2020 2020 2020 2020  in=11,.         
+000137b0: 2020 2020 7269 6769 645f 626f 6479 5f66      rigid_body_f
+000137c0: 696c 653d 4e6f 6e65 2c0a 2020 2020 2020  ile=None,.      
+000137d0: 2020 2020 2020 2073 696d 5f6d 6170 3d4e         sim_map=N
+000137e0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+000137f0: 2020 7369 676d 615f 6d61 703d 302e 3232    sigma_map=0.22
+00013800: 352c 0a20 2020 2020 2020 2020 2020 2020  5,.             
+00013810: 7772 6974 653d 4661 6c73 652c 0a20 2020  write=False,.   
+00013820: 2020 2020 2020 2020 2020 635f 6d6f 6465            c_mode
+00013830: 3d54 7275 652c 0a20 2020 2020 2020 2020  =True,.         
+00013840: 2020 2020 7369 676d 615f 7468 723d 322e      sigma_thr=2.
+00013850: 352c 0a20 2020 2020 2020 2020 2020 2020  5,.             
+00013860: 6672 6167 6d65 6e74 5f73 636f 7265 3d54  fragment_score=T
+00013870: 7275 652c 0a20 2020 2020 2020 2020 2020  rue,.           
+00013880: 2020 6469 7374 3d35 2e30 2c0a 2020 2020    dist=5.0,.    
+00013890: 2020 2020 2020 2020 2061 746f 6d5f 6365           atom_ce
+000138a0: 6e74 7265 3d27 4341 272c 0a20 2020 2020  ntre='CA',.     
+000138b0: 2020 2020 2020 2020 6361 6c63 5f6d 6574          calc_met
+000138c0: 7269 633d 2773 6d6f 6327 2c0a 2020 2020  ric='smoc',.    
+000138d0: 2020 2020 2020 2020 2067 6574 5f63 6f6f           get_coo
+000138e0: 7264 3d54 7275 650a 2020 2020 2020 2020  rd=True.        
+000138f0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00013900: 2222 2243 616c 6375 6c61 7465 2074 6865  """Calculate the
+00013910: 206c 6f63 616c 204d 616e 6465 7227 7320   local Mander's 
+00013920: 4f76 6572 6c61 7020 666f 7220 6561 6368  Overlap for each
+00013930: 2072 6573 6964 7565 2069 6e20 6120 7072   residue in a pr
+00013940: 6f74 6569 6e0a 2020 2020 2020 2020 6d6f  otein.        mo
+00013950: 6465 6c0a 0a20 2020 2020 2020 2053 4d4f  del..        SMO
+00013960: 4320 6361 6e20 6265 2063 616c 6375 6c61  C can be calcula
+00013970: 7465 6420 696e 2074 776f 2077 6179 733a  ted in two ways:
+00013980: 0a0a 2020 2020 2020 2020 2020 2020 2a20  ..            * 
+00013990: 2a2a 534d 4f43 662a 2a3a 2054 6865 2053  **SMOCf**: The S
+000139a0: 4d4f 4320 7363 6f72 6520 6973 2063 616c  MOC score is cal
+000139b0: 6375 6c61 7465 6420 666f 7220 7265 7369  culated for resi
+000139c0: 6475 6573 2061 646a 6163 656e 7420 696e  dues adjacent in
+000139d0: 0a20 2020 2020 2020 2020 2020 2020 2073  .              s
+000139e0: 6571 7565 6e63 652c 2075 7369 6e67 2061  equence, using a
+000139f0: 2073 6c69 6469 6e67 2061 6e64 206f 7665   sliding and ove
+00013a00: 726c 6170 7069 6e67 2077 696e 646f 772e  rlapping window.
+00013a10: 0a20 2020 2020 2020 2020 2020 202a 202a  .            * *
+00013a20: 2a53 4d4f 4364 2a2a 3a20 5069 7865 6c73  *SMOCd**: Pixels
+00013a30: 2061 7265 2073 636f 7265 6420 696e 2061   are scored in a
+00013a40: 2073 7068 6572 6963 616c 2072 6164 6975   spherical radiu
+00013a50: 7320 6172 6f75 6e64 2065 6163 680a 2020  s around each.  
+00013a60: 2020 2020 2020 2020 2020 2020 7265 7369              resi
+00013a70: 6475 650a 0a20 2020 2020 2020 2041 7267  due..        Arg
+00013a80: 756d 656e 7473 3a0a 2020 2020 2020 2020  uments:.        
+00013a90: 2020 2020 6d61 705f 7461 7267 6574 3a20      map_target: 
+00013aa0: 5461 7267 6574 204d 6170 2049 6e73 7461  Target Map Insta
+00013ab0: 6e63 652e 0a20 2020 2020 2020 2020 2020  nce..           
+00013ac0: 2072 6573 6f6c 7574 696f 6e5f 6465 6e73   resolution_dens
+00013ad0: 4d61 703a 2052 6573 6f6c 7574 696f 6e20  Map: Resolution 
+00013ae0: 6f66 2074 6865 2074 6172 6765 7420 6d61  of the target ma
+00013af0: 702e 0a20 2020 2020 2020 2020 2020 2073  p..            s
+00013b00: 7472 7563 7475 7265 5f69 6e73 7461 6e63  tructure_instanc
+00013b10: 653a 204d 6f64 656c 2073 7472 7563 7475  e: Model structu
+00013b20: 7265 2069 6e73 7461 6e63 652e 0a20 2020  re instance..   
+00013b30: 2020 2020 2020 2020 2077 696e 3a20 4f76           win: Ov
+00013b40: 6572 6c61 7070 696e 6720 5769 6e64 6f77  erlapping Window
+00013b50: 206c 656e 6774 6820 746f 2063 616c 6375   length to calcu
+00013b60: 6c61 7465 2074 6865 2073 636f 7265 0a20  late the score. 
+00013b70: 2020 2020 2020 2020 2020 2072 6967 6964             rigid
+00013b80: 5f62 6f64 795f 6669 6c65 3a20 5061 7468  _body_file: Path
+00013b90: 2074 6f20 7269 6769 642d 626f 6479 2066   to rigid-body f
+00013ba0: 696c 652e 0a20 2020 2020 2020 2020 2020  ile..           
+00013bb0: 2073 696d 5f6d 6170 3a20 5072 6563 6f6d   sim_map: Precom
+00013bc0: 7075 7465 6420 7369 6d75 6c61 7465 6420  puted simulated 
+00013bd0: 6d61 702e 2049 6620 3a63 6f64 653a 604e  map. If :code:`N
+00013be0: 6f6e 6560 2c20 7369 6d5f 6d61 7020 6973  one`, sim_map is
+00013bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013c00: 2063 616c 6375 6c61 7465 6420 6175 746f   calculated auto
+00013c10: 6d61 7469 6361 6c6c 792e 0a20 2020 2020  matically..     
+00013c20: 2020 2020 2020 2073 6967 6d61 5f6d 6170         sigma_map
+00013c30: 3a20 5061 7261 6d65 7465 7220 6e65 6564  : Parameter need
+00013c40: 2066 6f72 2053 7472 7563 7475 7265 2042   for Structure B
+00013c50: 6c75 7272 6572 2e20 4675 6c6c 2065 7870  lurrer. Full exp
+00013c60: 6c61 6e61 7469 6f6e 0a20 2020 2020 2020  lanation.       
+00013c70: 2020 2020 2020 2020 203a 7265 663a 6068           :ref:`h
+00013c80: 6572 653c 4e6f 7465 206f 6e20 7265 616c  ere<Note on real
+00013c90: 2073 7061 6365 2062 6c75 7272 696e 673a   space blurring:
+00013ca0: 3e60 0a20 2020 2020 2020 2020 2020 2077  >`.            w
+00013cb0: 7269 7465 3a20 4465 7072 6563 6174 6564  rite: Deprecated
+00013cc0: 2c20 6e6f 7420 7573 6564 2e0a 2020 2020  , not used..    
+00013cd0: 2020 2020 2020 2020 635f 6d6f 6465 3a20          c_mode: 
+00013ce0: 4465 7072 6563 6174 6564 2c20 6e6f 7420  Deprecated, not 
+00013cf0: 7573 6564 2e0a 2020 2020 2020 2020 2020  used..          
+00013d00: 2020 7369 676d 615f 7468 723a 2050 6172    sigma_thr: Par
+00013d10: 616d 6574 6572 2075 7365 6420 746f 206c  ameter used to l
+00013d20: 6162 656c 2070 6978 656c 7320 6e65 6172  abel pixels near
+00013d30: 2065 6163 6820 6174 6f6d 2069 6e20 7468   each atom in th
+00013d40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
+00013d50: 2020 6d6f 6465 6c2e 2045 7870 6c61 696e    model. Explain
+00013d60: 6564 2069 6e20 6675 7274 6865 7220 6465  ed in further de
+00013d70: 7461 696c 0a20 2020 2020 2020 2020 2020  tail.           
+00013d80: 2020 2020 203a 6d65 7468 3a60 6865 7265       :meth:`here
+00013d90: 203c 5445 4d50 792e 7072 6f74 6569 6e2e   <TEMPy.protein.
+00013da0: 7374 7275 6374 7572 655f 626c 7572 7265  structure_blurre
+00013db0: 722e 5374 7275 6374 7572 6542 6c75 7272  r.StructureBlurr
+00013dc0: 6572 2e67 6574 5f69 6e64 6963 6573 3e60  er.get_indices>`
+00013dd0: 0a20 2020 2020 2020 2020 2020 2066 7261  .            fra
+00013de0: 676d 656e 745f 7363 6f72 653a 2049 6620  gment_score: If 
+00013df0: 5472 7565 2c20 7573 6520 534d 4f43 6620  True, use SMOCf 
+00013e00: 6d65 7468 6f64 2e20 4966 2046 616c 7365  method. If False
+00013e10: 2c20 7573 6520 534d 4f43 640a 2020 2020  , use SMOCd.    
+00013e20: 2020 2020 2020 2020 2020 2020 6d65 7468              meth
+00013e30: 6f64 2e0a 2020 2020 2020 2020 2020 2020  od..            
+00013e40: 6469 7374 3a20 4465 7072 6563 6174 6564  dist: Deprecated
+00013e50: 2c20 6e6f 7420 7573 6564 2e0a 2020 2020  , not used..    
+00013e60: 2020 2020 2020 2020 6174 6f6d 5f63 656e          atom_cen
+00013e70: 7472 653a 2057 6869 6368 2061 746f 6d20  tre: Which atom 
+00013e80: 7479 7065 2073 686f 756c 6420 6265 2063  type should be c
+00013e90: 6f6e 7369 6465 7265 6420 7468 6520 6365  onsidered the ce
+00013ea0: 6e74 7265 206f 660a 2020 2020 2020 2020  ntre of.        
+00013eb0: 2020 2020 2020 2020 7265 7369 6475 6573          residues
+00013ec0: 2e0a 2020 2020 2020 2020 2020 2020 6361  ..            ca
+00013ed0: 6c63 5f6d 6574 7269 633a 2057 6869 6368  lc_metric: Which
+00013ee0: 206d 6574 686f 6420 746f 2075 7365 2066   method to use f
+00013ef0: 6f72 2063 616c 6375 6c61 7469 6e67 2074  or calculating t
+00013f00: 6865 206c 6f63 616c 2073 636f 7265 2061  he local score a
+00013f10: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
+00013f20: 2020 6561 6368 2072 6573 6964 7565 2e20    each residue. 
+00013f30: 4361 6e20 6265 203a 636f 6465 3a60 2273  Can be :code:`"s
+00013f40: 6d6f 6322 6020 6f72 203a 636f 6465 3a60  moc"` or :code:`
+00013f50: 2273 6363 6322 600a 2020 2020 2020 2020  "sccc"`.        
+00013f60: 2020 2020 6765 745f 636f 6f72 643a 2052      get_coord: R
+00013f70: 6574 7572 6e20 6164 6469 7469 6f6e 616c  eturn additional
+00013f80: 2064 6963 745f 6368 6169 6e5f 4341 2064   dict_chain_CA d
+00013f90: 6963 7469 6f6e 6172 792e 0a0a 2020 2020  ictionary...    
+00013fa0: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00013fb0: 2020 2020 2020 2020 2044 6963 7469 6f6e           Diction
+00013fc0: 6172 793a 0a20 2020 2020 2020 2020 2020  ary:.           
+00013fd0: 2020 2020 2054 6865 2064 6963 7469 6f6e       The diction
+00013fe0: 6172 6965 7320 6469 6374 5f63 6861 696e  aries dict_chain
+00013ff0: 5f73 636f 7265 732c 2064 6963 745f 6368  _scores, dict_ch
+00014000: 6169 6e5f 7265 732e 0a20 2020 2020 2020  ain_res..       
+00014010: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+00014020: 745f 6368 6169 6e5f 4341 2069 7320 7265  t_chain_CA is re
+00014030: 7475 726e 6564 2061 6464 6974 696f 6e61  turned additiona
+00014040: 6c6c 7920 6966 2067 6574 5f63 6f6f 7264  lly if get_coord
+00014050: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00014060: 2020 2020 2020 2020 202a 2064 6963 745f           * dict_
+00014070: 6368 6169 6e5f 7363 6f72 6573 3a20 3244  chain_scores: 2D
+00014080: 2064 6963 7469 6f6e 6172 7920 636f 6e74   dictionary cont
+00014090: 6169 6e69 6e67 2074 6865 2053 4d4f 4320  aining the SMOC 
+000140a0: 7363 6f72 6573 0a20 2020 2020 2020 2020  scores.         
+000140b0: 2020 2020 2020 2020 2066 6f72 2065 6163           for eac
+000140c0: 6820 7265 7369 6475 652e 204b 6579 7320  h residue. Keys 
+000140d0: 6172 6520 6368 6169 6e5f 6c61 6265 6c20  are chain_label 
+000140e0: 666f 7220 6669 7273 7420 6469 6374 696f  for first dictio
+000140f0: 6e61 7279 0a20 2020 2020 2020 2020 2020  nary.           
+00014100: 2020 2020 2020 2061 6e64 2072 6573 6964         and resid
+00014110: 7565 5f6e 756d 6265 7220 666f 7220 7365  ue_number for se
+00014120: 636f 6e64 2064 6963 7469 6f6e 6172 792c  cond dictionary,
+00014130: 2065 2e67 2e3a 0a20 2020 2020 2020 2020   e.g.:.         
+00014140: 2020 2020 2020 2020 203a 636f 6465 3a60           :code:`
+00014150: 6469 6374 5f63 6861 696e 5f73 636f 7265  dict_chain_score
+00014160: 735b 6368 6169 6e5f 6c61 6265 6c5d 5b72  s[chain_label][r
+00014170: 6573 6964 7565 5f6e 756d 6265 725d 203d  esidue_number] =
+00014180: 2053 4d4f 435f 7363 6f72 6560 0a0a 2020   SMOC_score`..  
+00014190: 2020 2020 2020 2020 2020 2020 2020 2a20                * 
+000141a0: 6469 6374 5f63 6861 696e 5f72 6573 3a20  dict_chain_res: 
+000141b0: 4469 6374 696f 6e61 7279 2077 6974 6820  Dictionary with 
+000141c0: 6368 6169 6e20 6c61 6265 6c73 2028 652e  chain labels (e.
+000141d0: 672e 0a20 2020 2020 2020 2020 2020 2020  g..             
+000141e0: 2020 2020 203a 636f 6465 3a60 2241 2260       :code:`"A"`
+000141f0: 2920 6173 206b 6579 7320 616e 6420 6120  ) as keys and a 
+00014200: 6c69 7374 206f 6620 616c 6c20 7265 7369  list of all resi
+00014210: 6475 6520 6e75 6d62 6572 7320 666f 720a  due numbers for.
+00014220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014230: 2020 6120 6769 7665 6e20 6368 6169 6e20    a given chain 
+00014240: 6173 2076 616c 7565 732e 0a0a 2020 2020  as values...    
+00014250: 2020 2020 2020 2020 2020 2020 2a20 6469              * di
+00014260: 6374 5f63 6861 696e 5f43 413a 2032 4420  ct_chain_CA: 2D 
+00014270: 6469 6374 696f 6e61 7279 2063 6f6e 7461  dictionary conta
+00014280: 696e 696e 6720 6120 6c69 7374 2066 6f72  ining a list for
+00014290: 2065 6163 680a 2020 2020 2020 2020 2020   each.          
+000142a0: 2020 2020 2020 2020 7265 7369 6475 652c          residue,
+000142b0: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
+000142c0: 616d 696e 6f20 6163 6964 2074 7970 6520  amino acid type 
+000142d0: 6f66 2065 6163 6820 7265 7369 6475 6520  of each residue 
+000142e0: 616e 640a 2020 2020 2020 2020 2020 2020  and.            
+000142f0: 2020 2020 2020 6974 7320 3344 2063 6f6f        its 3D coo
+00014300: 7264 696e 6174 6573 2e20 4b65 7973 2061  rdinates. Keys a
+00014310: 7265 2063 6861 696e 5f6c 6162 656c 2066  re chain_label f
+00014320: 6f72 2066 6972 7374 2064 6963 7469 6f6e  or first diction
+00014330: 6172 790a 2020 2020 2020 2020 2020 2020  ary.            
+00014340: 2020 2020 2020 616e 6420 7265 7369 6475        and residu
+00014350: 655f 6e75 6d62 6572 2066 6f72 2073 6563  e_number for sec
+00014360: 6f6e 6420 6469 6374 696f 6e61 7279 2c20  ond dictionary, 
+00014370: 652e 672e 3a0a 2020 2020 2020 2020 2020  e.g.:.          
+00014380: 2020 2020 2020 2020 3a63 6f64 653a 6064          :code:`d
+00014390: 6963 745f 6368 6169 6e5f 4341 5b63 6861  ict_chain_CA[cha
+000143a0: 696e 5f6c 6162 656c 5d5b 7265 7369 6475  in_label][residu
+000143b0: 655f 6e75 6d62 6572 5d20 3d20 7265 7369  e_number] = resi
+000143c0: 6475 655f 696e 666f 600a 2020 2020 2020  due_info`.      
+000143d0: 2020 2020 2020 2020 2020 2020 7768 6572              wher
+000143e0: 652c 203a 636f 6465 3a60 7265 7369 6475  e, :code:`residu
+000143f0: 655f 696e 666f 203d 205b 7265 7369 6475  e_info = [residu
+00014400: 655f 7479 7065 2c20 782c 2079 2c20 7a5d  e_type, x, y, z]
+00014410: 600a 2020 2020 2020 2020 2222 220a 2020  `.        """.  
+00014420: 2020 2020 2020 626c 7572 7265 7220 3d20        blurrer = 
+00014430: 5374 7275 6374 7572 6542 6c75 7272 6572  StructureBlurrer
+00014440: 2829 0a20 2020 2020 2020 2069 6620 7369  ().        if si
+00014450: 6d5f 6d61 7020 6973 204e 6f6e 653a 0a20  m_map is None:. 
+00014460: 2020 2020 2020 2020 2020 2073 696d 5f6d             sim_m
+00014470: 6170 203d 2062 6c75 7272 6572 2e67 6175  ap = blurrer.gau
+00014480: 7373 6961 6e5f 626c 7572 5f72 6561 6c5f  ssian_blur_real_
+00014490: 7370 6163 6528 0a20 2020 2020 2020 2020  space(.         
 000144a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000144b0: 2061 6e64 2072 6573 6964 7565 5f6e 756d   and residue_num
-000144c0: 6265 7220 666f 7220 7365 636f 6e64 2064  ber for second d
-000144d0: 6963 7469 6f6e 6172 792c 2065 2e67 2e3a  ictionary, e.g.:
-000144e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000144f0: 2020 203a 636f 6465 3a60 6469 6374 5f63     :code:`dict_c
-00014500: 6861 696e 5f43 415b 6368 6169 6e5f 6c61  hain_CA[chain_la
-00014510: 6265 6c5d 5b72 6573 6964 7565 5f6e 756d  bel][residue_num
-00014520: 6265 725d 203d 2072 6573 6964 7565 5f69  ber] = residue_i
-00014530: 6e66 6f60 0a20 2020 2020 2020 2020 2020  nfo`.           
-00014540: 2020 2020 2020 2077 6865 7265 2c20 3a63         where, :c
-00014550: 6f64 653a 6072 6573 6964 7565 5f69 6e66  ode:`residue_inf
-00014560: 6f20 3d20 5b72 6573 6964 7565 5f74 7970  o = [residue_typ
-00014570: 652c 2078 2c20 792c 207a 5d60 0a20 2020  e, x, y, z]`.   
-00014580: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00014590: 2062 6c75 7272 6572 203d 2053 7472 7563   blurrer = Struc
-000145a0: 7475 7265 426c 7572 7265 7228 290a 2020  tureBlurrer().  
-000145b0: 2020 2020 2020 6966 2073 696d 5f6d 6170        if sim_map
-000145c0: 2069 7320 4e6f 6e65 3a0a 2020 2020 2020   is None:.      
-000145d0: 2020 2020 2020 7369 6d5f 6d61 7020 3d20        sim_map = 
-000145e0: 626c 7572 7265 722e 6761 7573 7369 616e  blurrer.gaussian
-000145f0: 5f62 6c75 725f 7265 616c 5f73 7061 6365  _blur_real_space
-00014600: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014630: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
-00014640: 696e 7374 616e 6365 2c0a 2020 2020 2020  instance,.      
-00014650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014670: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00014680: 736f 6c75 7469 6f6e 5f64 656e 734d 6170  solution_densMap
-00014690: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000144b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144c0: 2020 2020 2020 2020 2020 2073 7472 7563             struc
+000144d0: 7475 7265 5f69 6e73 7461 6e63 652c 0a20  ture_instance,. 
+000144e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000144f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014510: 2020 2072 6573 6f6c 7574 696f 6e5f 6465     resolution_de
+00014520: 6e73 4d61 702c 0a20 2020 2020 2020 2020  nsMap,.         
+00014530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014540: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014550: 2020 2020 2020 2020 2020 2064 656e 734d             densM
+00014560: 6170 3d6d 6170 5f74 6172 6765 742c 0a20  ap=map_target,. 
+00014570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014590: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145a0: 2020 2073 6967 6d61 5f63 6f65 6666 3d73     sigma_coeff=s
+000145b0: 6967 6d61 5f6d 6170 2c0a 2020 2020 2020  igma_map,.      
+000145c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000145e0: 2020 2020 2020 2020 2020 2020 2020 6e6f                no
+000145f0: 726d 616c 6973 653d 5472 7565 290a 2020  rmalise=True).  
+00014600: 2020 2020 2020 2320 6d61 736b 206f 7574        # mask out
+00014610: 2062 6163 6b67 726f 756e 640a 2020 2020   background.    
+00014620: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00014630: 2020 2020 2070 6561 6b2c 2061 7665 2c20       peak, ave, 
+00014640: 7369 676d 6120 3d20 7369 6d5f 6d61 702e  sigma = sim_map.
+00014650: 7065 616b 5f64 656e 7369 7479 2829 0a20  peak_density(). 
+00014660: 2020 2020 2020 2020 2020 2069 6620 7065             if pe
+00014670: 616b 203e 3d20 6176 6520 2d20 7369 676d  ak >= ave - sigm
+00014680: 6120 616e 6420 7065 616b 203c 2028 6176  a and peak < (av
+00014690: 6520 2b20 3520 2a20 7369 676d 6129 3a0a  e + 5 * sigma):.
 000146a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146c0: 2020 2020 2020 6465 6e73 4d61 703d 6d61        densMap=ma
-000146d0: 705f 7461 7267 6574 2c0a 2020 2020 2020  p_target,.      
-000146e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000146f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014700: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00014710: 676d 615f 636f 6566 663d 7369 676d 615f  gma_coeff=sigma_
-00014720: 6d61 702c 0a20 2020 2020 2020 2020 2020  map,.           
-00014730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014750: 2020 2020 2020 2020 206e 6f72 6d61 6c69           normali
-00014760: 7365 3d54 7275 6529 0a20 2020 2020 2020  se=True).       
-00014770: 2023 206d 6173 6b20 6f75 7420 6261 636b   # mask out back
-00014780: 6772 6f75 6e64 0a20 2020 2020 2020 2074  ground.        t
-00014790: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-000147a0: 7065 616b 2c20 6176 652c 2073 6967 6d61  peak, ave, sigma
-000147b0: 203d 2073 696d 5f6d 6170 2e70 6561 6b5f   = sim_map.peak_
-000147c0: 6465 6e73 6974 7928 290a 2020 2020 2020  density().      
-000147d0: 2020 2020 2020 6966 2070 6561 6b20 3e3d        if peak >=
-000147e0: 2061 7665 202d 2073 6967 6d61 2061 6e64   ave - sigma and
-000147f0: 2070 6561 6b20 3c20 2861 7665 202b 2035   peak < (ave + 5
-00014800: 202a 2073 6967 6d61 293a 0a20 2020 2020   * sigma):.     
-00014810: 2020 2020 2020 2020 2020 2073 696d 5f6d             sim_m
-00014820: 6170 2e66 756c 6c4d 6170 203d 2073 696d  ap.fullMap = sim
-00014830: 5f6d 6170 2e66 756c 6c4d 6170 202a 2028  _map.fullMap * (
-00014840: 7369 6d5f 6d61 702e 6675 6c6c 4d61 7020  sim_map.fullMap 
-00014850: 3e20 7065 616b 290a 2020 2020 2020 2020  > peak).        
-00014860: 6578 6365 7074 3a20 2023 206e 6f71 613a  except:  # noqa:
-00014870: 2045 3732 320a 2020 2020 2020 2020 2020   E722.          
-00014880: 2020 7061 7373 0a0a 2020 2020 2020 2020    pass..        
-00014890: 6469 6374 5f63 6861 696e 5f69 6e64 6963  dict_chain_indic
-000148a0: 6573 2c20 6469 6374 5f63 6861 696e 5f72  es, dict_chain_r
-000148b0: 6573 2c20 6469 6374 5f63 6861 696e 5f43  es, dict_chain_C
-000148c0: 412c 2067 7269 6474 7265 6520 3d20 5c0a  A, gridtree = \.
-000148d0: 2020 2020 2020 2020 2020 2020 626c 7572              blur
-000148e0: 7265 722e 6765 745f 696e 6469 6365 7328  rer.get_indices(
-000148f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014910: 2073 7472 7563 7475 7265 5f69 6e73 7461   structure_insta
-00014920: 6e63 652c 0a20 2020 2020 2020 2020 2020  nce,.           
-00014930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014940: 2020 2020 206d 6170 5f74 6172 6765 742c       map_target,
-00014950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014960: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014970: 2072 6573 6f6c 7574 696f 6e5f 6465 6e73   resolution_dens
-00014980: 4d61 702c 0a20 2020 2020 2020 2020 2020  Map,.           
-00014990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149a0: 2020 2020 2073 696d 5f73 6967 6d61 5f63       sim_sigma_c
-000149b0: 6f65 6666 3d73 6967 6d61 5f6d 6170 2c0a  oeff=sigma_map,.
-000149c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000149e0: 7369 676d 615f 7468 723d 7369 676d 615f  sigma_thr=sigma_
-000149f0: 7468 722c 0a20 2020 2020 2020 2020 2020  thr,.           
-00014a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a10: 2020 2020 2061 746f 6d5f 6365 6e74 7265       atom_centre
-00014a20: 3d61 746f 6d5f 6365 6e74 7265 290a 2020  =atom_centre).  
-00014a30: 2020 2020 2020 6465 6c20 7374 7275 6374        del struct
-00014a40: 7572 655f 696e 7374 616e 6365 0a20 2020  ure_instance.   
-00014a50: 2020 2020 2067 632e 636f 6c6c 6563 7428       gc.collect(
-00014a60: 290a 2020 2020 2020 2020 2320 6765 7420  ).        # get 
-00014a70: 6465 7461 696c 7320 6f66 206d 6170 0a20  details of map. 
-00014a80: 2020 2020 2020 206e 7a2c 206e 792c 206e         nz, ny, n
-00014a90: 7820 3d20 6d61 705f 7461 7267 6574 2e66  x = map_target.f
-00014aa0: 756c 6c4d 6170 2e73 6861 7065 0a20 2020  ullMap.shape.   
-00014ab0: 2020 2020 207a 672c 2079 672c 2078 6720       zg, yg, xg 
-00014ac0: 3d20 6e70 2e6d 6772 6964 5b30 3a6e 7a2c  = np.mgrid[0:nz,
-00014ad0: 2030 3a6e 792c 2030 3a6e 785d 0a20 2020   0:ny, 0:nx].   
-00014ae0: 2020 2020 2023 2078 2079 2c7a 2063 6f6f       # x y,z coo
-00014af0: 7264 696e 6174 6573 206f 6620 7468 6520  rdinates of the 
-00014b00: 6772 6964 0a20 2020 2020 2020 2069 6e64  grid.        ind
-00014b10: 6920 3d20 6c69 7374 287a 6970 2878 672e  i = list(zip(xg.
-00014b20: 7261 7665 6c28 292c 2079 672e 7261 7665  ravel(), yg.rave
-00014b30: 6c28 292c 207a 672e 7261 7665 6c28 2929  l(), zg.ravel())
-00014b40: 290a 0a20 2020 2020 2020 206c 6973 745f  )..        list_
-00014b50: 7363 6363 203d 205b 5d0a 2020 2020 2020  sccc = [].      
-00014b60: 2020 2320 7361 7665 2073 636f 7265 7320    # save scores 
-00014b70: 666f 7220 6561 6368 2063 6861 696e 2061  for each chain a
-00014b80: 6e64 2072 6573 0a20 2020 2020 2020 2064  nd res.        d
-00014b90: 6963 745f 6368 6169 6e5f 7363 6f72 6573  ict_chain_scores
-00014ba0: 203d 204f 7264 6572 6564 4469 6374 2829   = OrderedDict()
-00014bb0: 0a20 2020 2020 2020 2066 6f72 2063 6820  .        for ch 
-00014bc0: 696e 2064 6963 745f 6368 6169 6e5f 696e  in dict_chain_in
-00014bd0: 6469 6365 733a 0a20 2020 2020 2020 2020  dices:.         
-00014be0: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
-00014bf0: 6573 203d 204f 7264 6572 6564 4469 6374  es = OrderedDict
-00014c00: 2829 0a20 2020 2020 2020 2020 2020 2064  ().            d
-00014c10: 6963 745f 7265 735f 696e 6469 6365 7320  ict_res_indices 
-00014c20: 3d20 6469 6374 5f63 6861 696e 5f69 6e64  = dict_chain_ind
-00014c30: 6963 6573 5b63 685d 0a20 2020 2020 2020  ices[ch].       
-00014c40: 2020 2020 2023 206d 756c 7469 2d63 6861       # multi-cha
-00014c50: 696e 2072 6967 6964 2062 6f64 7920 7061  in rigid body pa
-00014c60: 7273 6572 0a20 2020 2020 2020 2020 2020  rser.           
-00014c70: 2069 6620 7269 6769 645f 626f 6479 5f66   if rigid_body_f
-00014c80: 696c 6520 6973 206e 6f74 204e 6f6e 653a  ile is not None:
-00014c90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ca0: 2064 6963 745f 7265 735f 7363 6f72 6573   dict_res_scores
-00014cb0: 203d 2073 656c 662e 736d 6f63 5f73 636f   = self.smoc_sco
-00014cc0: 7265 5f72 6967 6964 5f62 6f64 6965 7328  re_rigid_bodies(
-00014cd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d00: 2064 6963 745f 7265 735f 696e 6469 6365   dict_res_indice
-00014d10: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000146b0: 7369 6d5f 6d61 702e 6675 6c6c 4d61 7020  sim_map.fullMap 
+000146c0: 3d20 7369 6d5f 6d61 702e 6675 6c6c 4d61  = sim_map.fullMa
+000146d0: 7020 2a20 2873 696d 5f6d 6170 2e66 756c  p * (sim_map.ful
+000146e0: 6c4d 6170 203e 2070 6561 6b29 0a20 2020  lMap > peak).   
+000146f0: 2020 2020 2065 7863 6570 743a 2020 2320       except:  # 
+00014700: 6e6f 7161 3a20 4537 3232 0a20 2020 2020  noqa: E722.     
+00014710: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
+00014720: 2020 2020 2064 6963 745f 6368 6169 6e5f       dict_chain_
+00014730: 696e 6469 6365 732c 2064 6963 745f 6368  indices, dict_ch
+00014740: 6169 6e5f 7265 732c 2064 6963 745f 6368  ain_res, dict_ch
+00014750: 6169 6e5f 4341 2c20 6772 6964 7472 6565  ain_CA, gridtree
+00014760: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+00014770: 2062 6c75 7272 6572 2e67 6574 5f69 6e64   blurrer.get_ind
+00014780: 6963 6573 280a 2020 2020 2020 2020 2020  ices(.          
+00014790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147a0: 2020 2020 2020 7374 7275 6374 7572 655f        structure_
+000147b0: 696e 7374 616e 6365 2c0a 2020 2020 2020  instance,.      
+000147c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000147d0: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
+000147e0: 7267 6574 2c0a 2020 2020 2020 2020 2020  rget,.          
+000147f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014800: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+00014810: 5f64 656e 734d 6170 2c0a 2020 2020 2020  _densMap,.      
+00014820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014830: 2020 2020 2020 2020 2020 7369 6d5f 7369            sim_si
+00014840: 676d 615f 636f 6566 663d 7369 676d 615f  gma_coeff=sigma_
+00014850: 6d61 702c 0a20 2020 2020 2020 2020 2020  map,.           
+00014860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014870: 2020 2020 2073 6967 6d61 5f74 6872 3d73       sigma_thr=s
+00014880: 6967 6d61 5f74 6872 2c0a 2020 2020 2020  igma_thr,.      
+00014890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000148a0: 2020 2020 2020 2020 2020 6174 6f6d 5f63            atom_c
+000148b0: 656e 7472 653d 6174 6f6d 5f63 656e 7472  entre=atom_centr
+000148c0: 6529 0a20 2020 2020 2020 2064 656c 2073  e).        del s
+000148d0: 7472 7563 7475 7265 5f69 6e73 7461 6e63  tructure_instanc
+000148e0: 650a 2020 2020 2020 2020 6763 2e63 6f6c  e.        gc.col
+000148f0: 6c65 6374 2829 0a20 2020 2020 2020 2023  lect().        #
+00014900: 2067 6574 2064 6574 6169 6c73 206f 6620   get details of 
+00014910: 6d61 700a 2020 2020 2020 2020 6e7a 2c20  map.        nz, 
+00014920: 6e79 2c20 6e78 203d 206d 6170 5f74 6172  ny, nx = map_tar
+00014930: 6765 742e 6675 6c6c 4d61 702e 7368 6170  get.fullMap.shap
+00014940: 650a 2020 2020 2020 2020 7a67 2c20 7967  e.        zg, yg
+00014950: 2c20 7867 203d 206e 702e 6d67 7269 645b  , xg = np.mgrid[
+00014960: 303a 6e7a 2c20 303a 6e79 2c20 303a 6e78  0:nz, 0:ny, 0:nx
+00014970: 5d0a 2020 2020 2020 2020 2320 7820 792c  ].        # x y,
+00014980: 7a20 636f 6f72 6469 6e61 7465 7320 6f66  z coordinates of
+00014990: 2074 6865 2067 7269 640a 2020 2020 2020   the grid.      
+000149a0: 2020 696e 6469 203d 206c 6973 7428 7a69    indi = list(zi
+000149b0: 7028 7867 2e72 6176 656c 2829 2c20 7967  p(xg.ravel(), yg
+000149c0: 2e72 6176 656c 2829 2c20 7a67 2e72 6176  .ravel(), zg.rav
+000149d0: 656c 2829 2929 0a0a 2020 2020 2020 2020  el()))..        
+000149e0: 6c69 7374 5f73 6363 6320 3d20 5b5d 0a20  list_sccc = []. 
+000149f0: 2020 2020 2020 2023 2073 6176 6520 7363         # save sc
+00014a00: 6f72 6573 2066 6f72 2065 6163 6820 6368  ores for each ch
+00014a10: 6169 6e20 616e 6420 7265 730a 2020 2020  ain and res.    
+00014a20: 2020 2020 6469 6374 5f63 6861 696e 5f73      dict_chain_s
+00014a30: 636f 7265 7320 3d20 4f72 6465 7265 6444  cores = OrderedD
+00014a40: 6963 7428 290a 2020 2020 2020 2020 666f  ict().        fo
+00014a50: 7220 6368 2069 6e20 6469 6374 5f63 6861  r ch in dict_cha
+00014a60: 696e 5f69 6e64 6963 6573 3a0a 2020 2020  in_indices:.    
+00014a70: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
+00014a80: 5f73 636f 7265 7320 3d20 4f72 6465 7265  _scores = Ordere
+00014a90: 6444 6963 7428 290a 2020 2020 2020 2020  dDict().        
+00014aa0: 2020 2020 6469 6374 5f72 6573 5f69 6e64      dict_res_ind
+00014ab0: 6963 6573 203d 2064 6963 745f 6368 6169  ices = dict_chai
+00014ac0: 6e5f 696e 6469 6365 735b 6368 5d0a 2020  n_indices[ch].  
+00014ad0: 2020 2020 2020 2020 2020 2320 6d75 6c74            # mult
+00014ae0: 692d 6368 6169 6e20 7269 6769 6420 626f  i-chain rigid bo
+00014af0: 6479 2070 6172 7365 720a 2020 2020 2020  dy parser.      
+00014b00: 2020 2020 2020 6966 2072 6967 6964 5f62        if rigid_b
+00014b10: 6f64 795f 6669 6c65 2069 7320 6e6f 7420  ody_file is not 
+00014b20: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00014b30: 2020 2020 2020 6469 6374 5f72 6573 5f73        dict_res_s
+00014b40: 636f 7265 7320 3d20 7365 6c66 2e73 6d6f  cores = self.smo
+00014b50: 635f 7363 6f72 655f 7269 6769 645f 626f  c_score_rigid_bo
+00014b60: 6469 6573 280a 2020 2020 2020 2020 2020  dies(.          
+00014b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b90: 2020 2020 2020 6469 6374 5f72 6573 5f69        dict_res_i
+00014ba0: 6e64 6963 6573 2c0a 2020 2020 2020 2020  ndices,.        
+00014bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014bd0: 2020 2020 2020 2020 7269 6769 645f 626f          rigid_bo
+00014be0: 6479 5f66 696c 652c 0a20 2020 2020 2020  dy_file,.       
+00014bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c10: 2020 2020 2020 2020 2063 682c 0a20 2020           ch,.   
+00014c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c40: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00014c50: 692c 0a20 2020 2020 2020 2020 2020 2020  i,.             
+00014c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014c80: 2020 206d 6170 5f74 6172 6765 742c 0a20     map_target,. 
+00014c90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014cb0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00014cc0: 696d 5f6d 6170 290a 2020 2020 2020 2020  im_map).        
+00014cd0: 2020 2020 2320 666f 7220 7265 7369 6475      # for residu
+00014ce0: 6573 206e 6f74 2069 6e20 7269 6769 6420  es not in rigid 
+00014cf0: 626f 6469 6573 0a20 2020 2020 2020 2020  bodies.         
+00014d00: 2020 2066 6f72 2072 6573 2069 6e20 6469     for res in di
+00014d10: 6374 5f72 6573 5f69 6e64 6963 6573 3a0a  ct_res_indices:.
 00014d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d40: 2020 2072 6967 6964 5f62 6f64 795f 6669     rigid_body_fi
-00014d50: 6c65 2c0a 2020 2020 2020 2020 2020 2020  le,.            
-00014d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014d80: 2020 2020 6368 2c0a 2020 2020 2020 2020      ch,.        
-00014d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014db0: 2020 2020 2020 2020 696e 6469 2c0a 2020          indi,.  
-00014dc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014d30: 2320 6966 206e 6f74 2064 6963 745f 7265  # if not dict_re
+00014d40: 735f 7363 6f72 6573 2e68 6173 5f6b 6579  s_scores.has_key
+00014d50: 2872 6573 293a 0a20 2020 2020 2020 2020  (res):.         
+00014d60: 2020 2020 2020 2069 6620 7265 7320 6e6f         if res no
+00014d70: 7420 696e 2064 6963 745f 7265 735f 7363  t in dict_res_sc
+00014d80: 6f72 6573 3a0a 2020 2020 2020 2020 2020  ores:.          
+00014d90: 2020 2020 2020 2020 2020 6966 2066 7261            if fra
+00014da0: 676d 656e 745f 7363 6f72 653a 0a20 2020  gment_score:.   
+00014db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014dc0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
 00014dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014de0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00014df0: 705f 7461 7267 6574 2c0a 2020 2020 2020  p_target,.      
-00014e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014e20: 2020 2020 2020 2020 2020 7369 6d5f 6d61            sim_ma
-00014e30: 7029 0a20 2020 2020 2020 2020 2020 2023  p).            #
-00014e40: 2066 6f72 2072 6573 6964 7565 7320 6e6f   for residues no
-00014e50: 7420 696e 2072 6967 6964 2062 6f64 6965  t in rigid bodie
-00014e60: 730a 2020 2020 2020 2020 2020 2020 666f  s.            fo
-00014e70: 7220 7265 7320 696e 2064 6963 745f 7265  r res in dict_re
-00014e80: 735f 696e 6469 6365 733a 0a20 2020 2020  s_indices:.     
-00014e90: 2020 2020 2020 2020 2020 2023 2069 6620             # if 
-00014ea0: 6e6f 7420 6469 6374 5f72 6573 5f73 636f  not dict_res_sco
-00014eb0: 7265 732e 6861 735f 6b65 7928 7265 7329  res.has_key(res)
-00014ec0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00014ed0: 2020 6966 2072 6573 206e 6f74 2069 6e20    if res not in 
-00014ee0: 6469 6374 5f72 6573 5f73 636f 7265 733a  dict_res_scores:
-00014ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00014f00: 2020 2020 2069 6620 6672 6167 6d65 6e74       if fragment
-00014f10: 5f73 636f 7265 3a0a 2020 2020 2020 2020  _score:.        
+00014de0: 2020 2020 2020 696e 6469 6365 7320 3d20        indices = 
+00014df0: 7365 6c66 2e73 6d6f 635f 6765 745f 696e  self.smoc_get_in
+00014e00: 6469 6365 735f 6672 6167 6d65 6e74 5f77  dices_fragment_w
+00014e10: 696e 646f 7728 0a20 2020 2020 2020 2020  indow(.         
+00014e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e40: 2020 2020 2020 2020 2020 2064 6963 745f             dict_
+00014e50: 7265 735f 696e 6469 6365 732c 0a20 2020  res_indices,.   
+00014e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014e90: 2064 6963 745f 6368 6169 6e5f 7265 732c   dict_chain_res,
+00014ea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ed0: 2020 2020 2063 682c 0a20 2020 2020 2020       ch,.       
+00014ee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f00: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00014f10: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f30: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-00014f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f50: 2069 6e64 6963 6573 203d 2073 656c 662e   indices = self.
-00014f60: 736d 6f63 5f67 6574 5f69 6e64 6963 6573  smoc_get_indices
-00014f70: 5f66 7261 676d 656e 745f 7769 6e64 6f77  _fragment_window
-00014f80: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f40: 2020 2020 2020 7769 6e29 0a20 2020 2020        win).     
+00014f50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f60: 2020 2065 7863 6570 7420 5479 7065 4572     except TypeEr
+00014f70: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00014f80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014f90: 2069 6e64 6963 6573 203d 205b 5d0a 2020   indices = [].  
 00014fa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014fb0: 2020 2020 2020 6469 6374 5f72 6573 5f69        dict_res_i
-00014fc0: 6e64 6963 6573 2c0a 2020 2020 2020 2020  ndices,.        
-00014fd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014fe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014ff0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-00015000: 5f63 6861 696e 5f72 6573 2c0a 2020 2020  _chain_res,.    
+00014fb0: 2020 2020 2020 2320 756e 7573 7561 6c20        # unusual 
+00014fc0: 6361 7365 730a 2020 2020 2020 2020 2020  cases.          
+00014fd0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00014fe0: 206c 656e 2869 6e64 6963 6573 2920 3e20   len(indices) > 
+00014ff0: 3020 616e 6420 6c65 6e28 696e 6469 6365  0 and len(indice
+00015000: 7329 203c 2031 303a 0a20 2020 2020 2020  s) < 10:.       
 00015010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015020: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
 00015030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015040: 6368 2c0a 2020 2020 2020 2020 2020 2020  ch,.            
-00015050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015070: 2020 2020 2020 2020 7265 732c 0a20 2020          res,.   
-00015080: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150b0: 2077 696e 290a 2020 2020 2020 2020 2020   win).          
-000150c0: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-000150d0: 6365 7074 2054 7970 6545 7272 6f72 3a0a  cept TypeError:.
+00015040: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
+00015050: 6573 5f73 636f 7265 735b 7265 735d 203d  es_scores[res] =
+00015060: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
+00015070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015080: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
+00015090: 7363 6f72 6573 5b64 6963 745f 6368 6169  scores[dict_chai
+000150a0: 6e5f 7265 735b 6368 5d5b 6469 6374 5f63  n_res[ch][dict_c
+000150b0: 6861 696e 5f72 6573 5b63 685d 2e69 6e64  hain_res[ch].ind
+000150c0: 6578 2872 6573 292d 315d 5d20 2023 206e  ex(res)-1]]  # n
+000150d0: 6f71 613a 2045 3530 310a 2020 2020 2020  oqa: E501.      
 000150e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000150f0: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00015100: 6365 7320 3d20 5b5d 0a20 2020 2020 2020  ces = [].       
+000150f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
+00015100: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015120: 2023 2075 6e75 7375 616c 2063 6173 6573   # unusual cases
-00015130: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015140: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00015150: 696e 6469 6365 7329 203e 2030 2061 6e64  indices) > 0 and
-00015160: 206c 656e 2869 6e64 6963 6573 2920 3c20   len(indices) < 
-00015170: 3130 3a0a 2020 2020 2020 2020 2020 2020  10:.            
+00015120: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
+00015130: 6573 5b72 6573 5d20 3d20 5c0a 2020 2020  es[res] = \.    
+00015140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015160: 2020 2020 2864 6963 745f 7265 735f 7363      (dict_res_sc
+00015170: 6f72 6573 5b72 6573 5d20 2b0a 2020 2020  ores[res] +.    
 00015180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015190: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-000151a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151b0: 2020 2020 2064 6963 745f 7265 735f 7363       dict_res_sc
-000151c0: 6f72 6573 5b72 6573 5d20 3d20 5c0a 2020  ores[res] = \.  
-000151d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151f0: 2020 6469 6374 5f72 6573 5f73 636f 7265    dict_res_score
-00015200: 735b 6469 6374 5f63 6861 696e 5f72 6573  s[dict_chain_res
-00015210: 5b63 685d 5b64 6963 745f 6368 6169 6e5f  [ch][dict_chain_
-00015220: 7265 735b 6368 5d2e 696e 6465 7828 7265  res[ch].index(re
-00015230: 7329 2d31 5d5d 2020 2320 6e6f 7161 3a20  s)-1]]  # noqa: 
-00015240: 4535 3031 0a20 2020 2020 2020 2020 2020  E501.           
+00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000151a0: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
+000151b0: 5f73 636f 7265 735b 6469 6374 5f63 6861  _scores[dict_cha
+000151c0: 696e 5f72 6573 5b63 685d 5b64 6963 745f  in_res[ch][dict_
+000151d0: 6368 6169 6e5f 7265 735b 6368 5d2e 696e  chain_res[ch].in
+000151e0: 6465 7828 7265 7329 2b31 5d5d 292f 322e  dex(res)+1]])/2.
+000151f0: 3020 2023 206e 6f71 613a 2045 3530 310a  0  # noqa: E501.
+00015200: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015220: 6578 6365 7074 2028 496e 6465 7845 7272  except (IndexErr
+00015230: 6f72 2c20 4b65 7945 7272 6f72 293a 0a20  or, KeyError):. 
+00015240: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015260: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00015260: 2020 2070 6173 730a 2020 2020 2020 2020     pass.        
 00015270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015280: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00015290: 6374 5f72 6573 5f73 636f 7265 735b 7265  ct_res_scores[re
-000152a0: 735d 203d 205c 0a20 2020 2020 2020 2020  s] = \.         
+00015280: 2020 2020 6578 6365 7074 2028 496e 6465      except (Inde
+00015290: 7845 7272 6f72 2c20 4b65 7945 7272 6f72  xError, KeyError
+000152a0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
 000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2028                 (
-000152d0: 6469 6374 5f72 6573 5f73 636f 7265 735b  dict_res_scores[
-000152e0: 7265 735d 202b 0a20 2020 2020 2020 2020  res] +.         
-000152f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015310: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
-00015320: 6573 5b64 6963 745f 6368 6169 6e5f 7265  es[dict_chain_re
-00015330: 735b 6368 5d5b 6469 6374 5f63 6861 696e  s[ch][dict_chain
-00015340: 5f72 6573 5b63 685d 2e69 6e64 6578 2872  _res[ch].index(r
-00015350: 6573 292b 315d 5d29 2f32 2e30 2020 2320  es)+1]])/2.0  # 
-00015360: 6e6f 7161 3a20 4535 3031 0a20 2020 2020  noqa: E501.     
-00015370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015380: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00015390: 7420 2849 6e64 6578 4572 726f 722c 204b  t (IndexError, K
-000153a0: 6579 4572 726f 7229 3a0a 2020 2020 2020  eyError):.      
-000153b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000153c0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-000153d0: 7373 0a20 2020 2020 2020 2020 2020 2020  ss.             
-000153e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-000153f0: 7863 6570 7420 2849 6e64 6578 4572 726f  xcept (IndexErro
-00015400: 722c 204b 6579 4572 726f 7229 3a0a 2020  r, KeyError):.  
-00015410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015420: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00015430: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000152c0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152e0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+000152f0: 5f72 6573 5f73 636f 7265 735b 7265 735d  _res_scores[res]
+00015300: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+00015310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015320: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+00015330: 745f 7265 735f 7363 6f72 6573 5b64 6963  t_res_scores[dic
+00015340: 745f 6368 6169 6e5f 7265 735b 6368 5d5b  t_chain_res[ch][
+00015350: 6469 6374 5f63 6861 696e 5f72 6573 5b63  dict_chain_res[c
+00015360: 685d 2e69 6e64 6578 2872 6573 292b 315d  h].index(res)+1]
+00015370: 5d20 2023 206e 6f71 613a 2045 3530 310a  ]  # noqa: E501.
+00015380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153a0: 6578 6365 7074 2028 496e 6465 7845 7272  except (IndexErr
+000153b0: 6f72 2c20 4b65 7945 7272 6f72 293a 0a20  or, KeyError):. 
+000153c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000153e0: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
+000153f0: 6573 5b72 6573 5d20 3d20 302e 300a 2020  es[res] = 0.0.  
+00015400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015410: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00015420: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00015430: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
 00015440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015450: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
-00015460: 7363 6f72 6573 5b72 6573 5d20 3d20 5c0a  scores[res] = \.
-00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015450: 2020 2020 2069 6e64 6963 6573 203d 2064       indices = d
+00015460: 6963 745f 7265 735f 696e 6469 6365 735b  ict_res_indices[
+00015470: 7265 735d 5b3a 5d0a 2020 2020 2020 2020  res][:].        
 00015480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015490: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
-000154a0: 5f73 636f 7265 735b 6469 6374 5f63 6861  _scores[dict_cha
-000154b0: 696e 5f72 6573 5b63 685d 5b64 6963 745f  in_res[ch][dict_
-000154c0: 6368 6169 6e5f 7265 735b 6368 5d2e 696e  chain_res[ch].in
-000154d0: 6465 7828 7265 7329 2b31 5d5d 2020 2320  dex(res)+1]]  # 
-000154e0: 6e6f 7161 3a20 4535 3031 0a20 2020 2020  noqa: E501.     
-000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015500: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00015510: 7420 2849 6e64 6578 4572 726f 722c 204b  t (IndexError, K
-00015520: 6579 4572 726f 7229 3a0a 2020 2020 2020  eyError):.      
-00015530: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015540: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00015550: 6374 5f72 6573 5f73 636f 7265 735b 7265  ct_res_scores[re
-00015560: 735d 203d 2030 2e30 0a20 2020 2020 2020  s] = 0.0.       
-00015570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015580: 2020 2020 2063 6f6e 7469 6e75 650a 2020       continue.  
+00015490: 2320 666f 7220 6c6f 7765 7220 7265 736f  # for lower reso
+000154a0: 6c75 7469 6f6e 7320 6361 6c63 756c 6174  lutions calculat
+000154b0: 6520 7363 6f72 6520 696e 2061 2073 7068  e score in a sph
+000154c0: 6572 650a 2020 2020 2020 2020 2020 2020  ere.            
+000154d0: 2020 2020 2020 2020 2020 2020 6966 2072              if r
+000154e0: 6573 6f6c 7574 696f 6e5f 6465 6e73 4d61  esolution_densMa
+000154f0: 7020 3e20 332e 353a 0a20 2020 2020 2020  p > 3.5:.       
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 2020 2020 2064 6973 7420 3d20 312e 302a       dist = 1.0*
+00015520: 7265 736f 6c75 7469 6f6e 5f64 656e 734d  resolution_densM
+00015530: 6170 0a20 2020 2020 2020 2020 2020 2020  ap.             
+00015540: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+00015550: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+00015560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015570: 2020 2020 696e 6469 6365 735f 6c6f 6361      indices_loca
+00015580: 6c20 3d20 5c0a 2020 2020 2020 2020 2020  l = \.          
 00015590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-000155b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000155c0: 696e 6469 6365 7320 3d20 6469 6374 5f72  indices = dict_r
-000155d0: 6573 5f69 6e64 6963 6573 5b72 6573 5d5b  es_indices[res][
-000155e0: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
-000155f0: 2020 2020 2020 2020 2020 2023 2066 6f72             # for
-00015600: 206c 6f77 6572 2072 6573 6f6c 7574 696f   lower resolutio
-00015610: 6e73 2063 616c 6375 6c61 7465 2073 636f  ns calculate sco
-00015620: 7265 2069 6e20 6120 7370 6865 7265 0a20  re in a sphere. 
-00015630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015640: 2020 2020 2020 2069 6620 7265 736f 6c75         if resolu
-00015650: 7469 6f6e 5f64 656e 734d 6170 203e 2033  tion_densMap > 3
-00015660: 2e35 3a0a 2020 2020 2020 2020 2020 2020  .5:.            
+000155a0: 2020 2020 2020 2020 2020 7365 6c66 2e73            self.s
+000155b0: 6d6f 635f 6765 745f 696e 6469 6365 735f  moc_get_indices_
+000155c0: 7370 6865 7265 280a 2020 2020 2020 2020  sphere(.        
+000155d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000155f0: 2020 2020 2020 2020 2020 2020 6772 6964              grid
+00015600: 7472 6565 2c0a 2020 2020 2020 2020 2020  tree,.          
+00015610: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015620: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015630: 2020 2020 2020 2020 2020 6469 6374 5f63            dict_c
+00015640: 6861 696e 5f43 415b 6368 5d5b 7265 735d  hain_CA[ch][res]
+00015650: 5b31 3a5d 2c0a 2020 2020 2020 2020 2020  [1:],.          
+00015660: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015680: 6469 7374 203d 2031 2e30 2a72 6573 6f6c  dist = 1.0*resol
-00015690: 7574 696f 6e5f 6465 6e73 4d61 700a 2020  ution_densMap.  
+00015680: 2020 2020 2020 2020 2020 6469 7374 3d64            dist=d
+00015690: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
 000156a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156b0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-000156c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000156d0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000156e0: 6e64 6963 6573 5f6c 6f63 616c 203d 205c  ndices_local = \
-000156f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015710: 2020 2020 2073 656c 662e 736d 6f63 5f67       self.smoc_g
-00015720: 6574 5f69 6e64 6963 6573 5f73 7068 6572  et_indices_spher
-00015730: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
-00015740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015760: 2020 2020 2020 2067 7269 6474 7265 652c         gridtree,
-00015770: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015780: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157a0: 2020 2020 2064 6963 745f 6368 6169 6e5f       dict_chain_
-000157b0: 4341 5b63 685d 5b72 6573 5d5b 313a 5d2c  CA[ch][res][1:],
-000157c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000157d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000157f0: 2020 2020 2064 6973 743d 6469 7374 290a       dist=dist).
-00015800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015820: 696e 6469 6365 732e 6578 7465 6e64 2869  indices.extend(i
-00015830: 6e64 6963 6573 5f6c 6f63 616c 290a 2020  ndices_local).  
-00015840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015850: 2020 2020 2020 2020 2020 6578 6365 7074            except
-00015860: 2028 5479 7065 4572 726f 722c 204b 6579   (TypeError, Key
-00015870: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
-00015880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015890: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
-000158a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158b0: 2020 6966 206c 656e 2869 6e64 6963 6573    if len(indices
-000158c0: 2920 3d3d 2030 3a0a 2020 2020 2020 2020  ) == 0:.        
+000156b0: 2020 2020 2069 6e64 6963 6573 2e65 7874       indices.ext
+000156c0: 656e 6428 696e 6469 6365 735f 6c6f 6361  end(indices_loca
+000156d0: 6c29 0a20 2020 2020 2020 2020 2020 2020  l).             
+000156e0: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+000156f0: 7863 6570 7420 2854 7970 6545 7272 6f72  xcept (TypeError
+00015700: 2c20 4b65 7945 7272 6f72 293a 0a20 2020  , KeyError):.   
+00015710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015720: 2020 2020 2020 2020 2020 2020 2070 6173               pas
+00015730: 730a 0a20 2020 2020 2020 2020 2020 2020  s..             
+00015740: 2020 2020 2020 2069 6620 6c65 6e28 696e         if len(in
+00015750: 6469 6365 7329 203d 3d20 303a 0a20 2020  dices) == 0:.   
+00015760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015770: 2020 2020 2070 7269 6e74 2827 5363 6f72       print('Scor
+00015780: 6520 6361 6c63 756c 6174 696f 6e20 6661  e calculation fa
+00015790: 696c 6564 2066 6f72 3a20 272c 2063 682c  iled for: ', ch,
+000157a0: 2072 6573 290a 2020 2020 2020 2020 2020   res).          
+000157b0: 2020 2020 2020 2020 2020 2020 2020 736d                sm
+000157c0: 6f63 203d 202d 312e 300a 2020 2020 2020  oc = -1.0.      
+000157d0: 2020 2020 2020 2020 2020 2020 2020 656c                el
+000157e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000157f0: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00015800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015810: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
+00015820: 5f61 7272 7a79 7820 3d20 7365 6c66 2e69  _arrzyx = self.i
+00015830: 6e64 6963 6573 5f73 6d6f 6328 696e 6469  ndices_smoc(indi
+00015840: 6365 732c 2069 6e64 6929 0a20 2020 2020  ces, indi).     
+00015850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015860: 2020 2020 2020 2069 6620 6361 6c63 5f6d         if calc_m
+00015870: 6574 7269 6320 3d3d 2027 736d 6f63 273a  etric == 'smoc':
+00015880: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000158a0: 2073 6d6f 6320 3d20 7365 6c66 2e63 616c   smoc = self.cal
+000158b0: 635f 6d6f 6328 0a20 2020 2020 2020 2020  c_moc(.         
+000158c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 000158d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000158e0: 7072 696e 7428 2753 636f 7265 2063 616c  print('Score cal
-000158f0: 6375 6c61 7469 6f6e 2066 6169 6c65 6420  culation failed 
-00015900: 666f 723a 2027 2c20 6368 2c20 7265 7329  for: ', ch, res)
-00015910: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015920: 2020 2020 2020 2020 2073 6d6f 6320 3d20           smoc = 
-00015930: 2d31 2e30 0a20 2020 2020 2020 2020 2020  -1.0.           
-00015940: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+000158e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000158f0: 6e64 5f61 7272 7a79 782c 0a20 2020 2020  nd_arrzyx,.     
+00015900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015930: 2020 2073 696d 5f6d 6170 2c0a 2020 2020     sim_map,.    
+00015940: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015960: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-00015970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015980: 2020 2020 2020 2020 696e 645f 6172 727a          ind_arrz
-00015990: 7978 203d 2073 656c 662e 696e 6469 6365  yx = self.indice
-000159a0: 735f 736d 6f63 2869 6e64 6963 6573 2c20  s_smoc(indices, 
-000159b0: 696e 6469 290a 2020 2020 2020 2020 2020  indi).          
+00015960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015970: 2020 2020 6d61 705f 7461 7267 6574 290a      map_target).
+00015980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015990: 2020 2020 2020 2020 2020 2020 656c 6966              elif
+000159a0: 2063 616c 635f 6d65 7472 6963 203d 3d20   calc_metric == 
+000159b0: 2773 6363 6327 3a0a 2020 2020 2020 2020  'sccc':.        
 000159c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000159d0: 2020 6966 2063 616c 635f 6d65 7472 6963    if calc_metric
-000159e0: 203d 3d20 2773 6d6f 6327 3a0a 2020 2020   == 'smoc':.    
+000159d0: 2020 2020 2020 2020 736d 6f63 203d 2073          smoc = s
+000159e0: 656c 662e 6361 6c63 5f63 6363 280a 2020  elf.calc_ccc(.  
 000159f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a00: 2020 2020 2020 2020 2020 2020 736d 6f63              smoc
-00015a10: 203d 2073 656c 662e 6361 6c63 5f6d 6f63   = self.calc_moc
-00015a20: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00015a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a20: 2020 696e 645f 6172 727a 7978 2c0a 2020    ind_arrzyx,.  
 00015a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015a40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a50: 2020 2020 2020 2020 2020 696e 645f 6172            ind_ar
-00015a60: 727a 7978 2c0a 2020 2020 2020 2020 2020  rzyx,.          
+00015a50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015a60: 2020 7369 6d5f 6d61 702c 0a20 2020 2020    sim_map,.     
 00015a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00015a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015a90: 2020 2020 2020 2020 2020 2020 2020 7369                si
-00015aa0: 6d5f 6d61 702c 0a20 2020 2020 2020 2020  m_map,.         
+00015a90: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00015aa0: 6170 5f74 6172 6765 7429 0a20 2020 2020  ap_target).     
 00015ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ad0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00015ae0: 6170 5f74 6172 6765 7429 0a20 2020 2020  ap_target).     
-00015af0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b00: 2020 2020 2020 2065 6c69 6620 6361 6c63         elif calc
-00015b10: 5f6d 6574 7269 6320 3d3d 2027 7363 6363  _metric == 'sccc
-00015b20: 273a 0a20 2020 2020 2020 2020 2020 2020  ':.             
+00015ac0: 2020 2065 7863 6570 7420 496e 6465 7845     except IndexE
+00015ad0: 7272 6f72 3a0a 2020 2020 2020 2020 2020  rror:.          
+00015ae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015af0: 2020 736d 6f63 203d 2030 2e30 0a20 2020    smoc = 0.0.   
+00015b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b10: 2064 6963 745f 7265 735f 7363 6f72 6573   dict_res_scores
+00015b20: 5b72 6573 5d20 3d20 736d 6f63 0a20 2020  [res] = smoc.   
 00015b30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b40: 2020 2073 6d6f 6320 3d20 7365 6c66 2e63     smoc = self.c
-00015b50: 616c 635f 6363 6328 0a20 2020 2020 2020  alc_ccc(.       
+00015b40: 2023 2065 7272 6f72 2069 6e20 7363 6f72   # error in scor
+00015b50: 6520 6361 6c63 756c 6174 696f 6e0a 2020  e calculation.  
 00015b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015b80: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00015b90: 5f61 7272 7a79 782c 0a20 2020 2020 2020  _arrzyx,.       
-00015ba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bc0: 2020 2020 2020 2020 2020 2020 2073 696d               sim
-00015bd0: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
-00015be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c00: 2020 2020 2020 2020 2020 6d61 705f 7461            map_ta
-00015c10: 7267 6574 290a 2020 2020 2020 2020 2020  rget).          
-00015c20: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00015c30: 6365 7074 2049 6e64 6578 4572 726f 723a  cept IndexError:
-00015c40: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015c50: 2020 2020 2020 2020 2020 2020 2073 6d6f               smo
-00015c60: 6320 3d20 302e 300a 2020 2020 2020 2020  c = 0.0.        
-00015c70: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-00015c80: 5f72 6573 5f73 636f 7265 735b 7265 735d  _res_scores[res]
-00015c90: 203d 2073 6d6f 630a 2020 2020 2020 2020   = smoc.        
-00015ca0: 2020 2020 2020 2020 2020 2020 2320 6572              # er
-00015cb0: 726f 7220 696e 2073 636f 7265 2063 616c  ror in score cal
-00015cc0: 6375 6c61 7469 6f6e 0a20 2020 2020 2020  culation.       
-00015cd0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00015ce0: 736d 6f63 203d 3d20 2d31 2e30 3a0a 2020  smoc == -1.0:.  
-00015cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d00: 2020 2020 2020 6469 6374 5f72 6573 5f73        dict_res_s
-00015d10: 636f 7265 735b 7265 735d 203d 2030 2e30  cores[res] = 0.0
-00015d20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00015d30: 2020 2020 2020 2020 2074 7279 3a0a 2020           try:.  
-00015d40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d50: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
-00015d60: 6573 5f73 636f 7265 735b 7265 735d 203d  es_scores[res] =
-00015d70: 205c 0a20 2020 2020 2020 2020 2020 2020   \.             
-00015d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d90: 2020 2064 6963 745f 7265 735f 7363 6f72     dict_res_scor
-00015da0: 6573 5b64 6963 745f 6368 6169 6e5f 7265  es[dict_chain_re
-00015db0: 735b 6368 5d5b 6469 6374 5f63 6861 696e  s[ch][dict_chain
-00015dc0: 5f72 6573 5b63 685d 2e69 6e64 6578 2872  _res[ch].index(r
-00015dd0: 6573 292d 315d 5d20 2023 206e 6f71 613a  es)-1]]  # noqa:
-00015de0: 2045 3530 310a 2020 2020 2020 2020 2020   E501.          
-00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e20: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
-00015e30: 7363 6f72 6573 5b72 6573 5d20 3d20 5c0a  scores[res] = \.
-00015e40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015b70: 2020 6966 2073 6d6f 6320 3d3d 202d 312e    if smoc == -1.
+00015b80: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00015b90: 2020 2020 2020 2020 2020 2064 6963 745f             dict_
+00015ba0: 7265 735f 7363 6f72 6573 5b72 6573 5d20  res_scores[res] 
+00015bb0: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
+00015bc0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+00015bd0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+00015be0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00015bf0: 6963 745f 7265 735f 7363 6f72 6573 5b72  ict_res_scores[r
+00015c00: 6573 5d20 3d20 5c0a 2020 2020 2020 2020  es] = \.        
+00015c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c20: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
+00015c30: 5f73 636f 7265 735b 6469 6374 5f63 6861  _scores[dict_cha
+00015c40: 696e 5f72 6573 5b63 685d 5b64 6963 745f  in_res[ch][dict_
+00015c50: 6368 6169 6e5f 7265 735b 6368 5d2e 696e  chain_res[ch].in
+00015c60: 6465 7828 7265 7329 2d31 5d5d 2020 2320  dex(res)-1]]  # 
+00015c70: 6e6f 7161 3a20 4535 3031 0a20 2020 2020  noqa: E501.     
+00015c80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015c90: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+00015ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cb0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+00015cc0: 5f72 6573 5f73 636f 7265 735b 7265 735d  _res_scores[res]
+00015cd0: 203d 205c 0a20 2020 2020 2020 2020 2020   = \.           
+00015ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015cf0: 2020 2020 2020 2020 2028 6469 6374 5f72           (dict_r
+00015d00: 6573 5f73 636f 7265 735b 7265 735d 202b  es_scores[res] +
+00015d10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015d20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015d30: 2020 2020 2020 2020 2064 6963 745f 7265           dict_re
+00015d40: 735f 7363 6f72 6573 5b64 6963 745f 6368  s_scores[dict_ch
+00015d50: 6169 6e5f 7265 735b 6368 5d5b 6469 6374  ain_res[ch][dict
+00015d60: 5f63 6861 696e 5f72 6573 5b63 685d 2e69  _chain_res[ch].i
+00015d70: 6e64 6578 2872 6573 292b 315d 5d29 2f32  ndex(res)+1]])/2
+00015d80: 2e30 2020 2320 6e6f 7161 3a20 4535 3031  .0  # noqa: E501
+00015d90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015da0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+00015db0: 6570 7420 2849 6e64 6578 4572 726f 722c  ept (IndexError,
+00015dc0: 204b 6579 4572 726f 7229 3a0a 2020 2020   KeyError):.    
+00015dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015de0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
+00015df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015e00: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00015e10: 2849 6e64 6578 4572 726f 722c 204b 6579  (IndexError, Key
+00015e20: 4572 726f 7229 3a0a 2020 2020 2020 2020  Error):.        
+00015e30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e40: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
 00015e50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e60: 2020 2020 2864 6963 745f 7265 735f 7363      (dict_res_sc
-00015e70: 6f72 6573 5b72 6573 5d20 2b0a 2020 2020  ores[res] +.    
-00015e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015e60: 2020 2020 2020 2020 2064 6963 745f 7265           dict_re
+00015e70: 735f 7363 6f72 6573 5b72 6573 5d20 3d20  s_scores[res] = 
+00015e80: 5c0a 2020 2020 2020 2020 2020 2020 2020  \.              
 00015e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015ea0: 2020 2020 6469 6374 5f72 6573 5f73 636f      dict_res_sco
-00015eb0: 7265 735b 6469 6374 5f63 6861 696e 5f72  res[dict_chain_r
-00015ec0: 6573 5b63 685d 5b64 6963 745f 6368 6169  es[ch][dict_chai
-00015ed0: 6e5f 7265 735b 6368 5d2e 696e 6465 7828  n_res[ch].index(
-00015ee0: 7265 7329 2b31 5d5d 292f 322e 3020 2023  res)+1]])/2.0  #
-00015ef0: 206e 6f71 613a 2045 3530 310a 2020 2020   noqa: E501.    
+00015ea0: 2020 2020 2020 6469 6374 5f72 6573 5f73        dict_res_s
+00015eb0: 636f 7265 735b 6469 6374 5f63 6861 696e  cores[dict_chain
+00015ec0: 5f72 6573 5b63 685d 5b64 6963 745f 6368  _res[ch][dict_ch
+00015ed0: 6169 6e5f 7265 735b 6368 5d2e 696e 6465  ain_res[ch].inde
+00015ee0: 7828 7265 7329 2b31 5d5d 2020 2320 6e6f  x(res)+1]]  # no
+00015ef0: 7161 3a20 4535 3031 0a20 2020 2020 2020  qa: E501.       
 00015f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f10: 2020 2020 2020 2020 6578 6365 7074 2028          except (
-00015f20: 496e 6465 7845 7272 6f72 2c20 4b65 7945  IndexError, KeyE
-00015f30: 7272 6f72 293a 0a20 2020 2020 2020 2020  rror):.         
+00015f10: 2020 2020 2065 7863 6570 7420 2849 6e64       except (Ind
+00015f20: 6578 4572 726f 722c 204b 6579 4572 726f  exError, KeyErro
+00015f30: 7229 3a0a 2020 2020 2020 2020 2020 2020  r):.            
 00015f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f50: 2020 2020 2020 2070 6173 730a 2020 2020         pass.    
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015f70: 2020 2020 6578 6365 7074 2028 496e 6465      except (Inde
-00015f80: 7845 7272 6f72 2c20 4b65 7945 7272 6f72  xError, KeyError
-00015f90: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-00015fa0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00015fb0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00015fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015fd0: 2020 2020 6469 6374 5f72 6573 5f73 636f      dict_res_sco
-00015fe0: 7265 735b 7265 735d 203d 205c 0a20 2020  res[res] = \.   
-00015ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016010: 2064 6963 745f 7265 735f 7363 6f72 6573   dict_res_scores
-00016020: 5b64 6963 745f 6368 6169 6e5f 7265 735b  [dict_chain_res[
-00016030: 6368 5d5b 6469 6374 5f63 6861 696e 5f72  ch][dict_chain_r
-00016040: 6573 5b63 685d 2e69 6e64 6578 2872 6573  es[ch].index(res
-00016050: 292b 315d 5d20 2023 206e 6f71 613a 2045  )+1]]  # noqa: E
-00016060: 3530 310a 2020 2020 2020 2020 2020 2020  501.            
-00016070: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016080: 6578 6365 7074 2028 496e 6465 7845 7272  except (IndexErr
-00016090: 6f72 2c20 4b65 7945 7272 6f72 293a 0a20  or, KeyError):. 
-000160a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160b0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000160c0: 6963 745f 7265 735f 7363 6f72 6573 5b72  ict_res_scores[r
-000160d0: 6573 5d20 3d20 302e 300a 2020 2020 2020  es] = 0.0.      
-000160e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000160f0: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
-00016100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016110: 6c69 7374 5f73 6363 632e 6170 7065 6e64  list_sccc.append
-00016120: 2873 6d6f 6329 0a20 2020 2020 2020 2020  (smoc).         
-00016130: 2020 2064 6963 745f 6368 6169 6e5f 7363     dict_chain_sc
-00016140: 6f72 6573 5b63 685d 203d 204f 7264 6572  ores[ch] = Order
-00016150: 6564 4469 6374 2829 0a20 2020 2020 2020  edDict().       
-00016160: 2020 2020 2064 6963 745f 6368 6169 6e5f       dict_chain_
-00016170: 7363 6f72 6573 5b63 685d 203d 2064 6963  scores[ch] = dic
-00016180: 745f 7265 735f 7363 6f72 6573 0a20 2020  t_res_scores.   
-00016190: 2020 2020 2064 656c 2067 7269 6474 7265       del gridtre
-000161a0: 650a 2020 2020 2020 2020 6465 6c20 6469  e.        del di
-000161b0: 6374 5f63 6861 696e 5f69 6e64 6963 6573  ct_chain_indices
-000161c0: 0a0a 2020 2020 2020 2020 6763 2e63 6f6c  ..        gc.col
-000161d0: 6c65 6374 2829 0a20 2020 2020 2020 2069  lect().        i
-000161e0: 6620 6765 745f 636f 6f72 643a 0a20 2020  f get_coord:.   
-000161f0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016200: 6469 6374 5f63 6861 696e 5f73 636f 7265  dict_chain_score
-00016210: 732c 2064 6963 745f 6368 6169 6e5f 7265  s, dict_chain_re
-00016220: 732c 2064 6963 745f 6368 6169 6e5f 4341  s, dict_chain_CA
-00016230: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-00016240: 2020 2020 2020 2020 2020 2064 656c 2064             del d
-00016250: 6963 745f 6368 6169 6e5f 4341 0a20 2020  ict_chain_CA.   
-00016260: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00016270: 6469 6374 5f63 6861 696e 5f73 636f 7265  dict_chain_score
-00016280: 732c 2064 6963 745f 6368 6169 6e5f 7265  s, dict_chain_re
-00016290: 730a 0a20 2020 2064 6566 205f 534d 4f43  s..    def _SMOC
-000162a0: 3128 2020 2320 6361 6e20 7765 2064 656c  1(  # can we del
-000162b0: 6574 6520 7468 6973 3f0a 2020 2020 2020  ete this?.      
-000162c0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-000162d0: 2020 2020 2020 2020 6d61 705f 7461 7267          map_targ
-000162e0: 6574 2c0a 2020 2020 2020 2020 2020 2020  et,.            
-000162f0: 7265 736f 6c75 7469 6f6e 5f64 656e 734d  resolution_densM
-00016300: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
-00016310: 7374 7275 6374 7572 655f 696e 7374 616e  structure_instan
-00016320: 6365 2c0a 2020 2020 2020 2020 2020 2020  ce,.            
-00016330: 7769 6e3d 3131 2c0a 2020 2020 2020 2020  win=11,.        
-00016340: 2020 2020 7269 6769 645f 626f 6479 5f66      rigid_body_f
-00016350: 696c 653d 4e6f 6e65 2c0a 2020 2020 2020  ile=None,.      
-00016360: 2020 2020 2020 7369 676d 615f 6d61 703d        sigma_map=
-00016370: 302e 3232 352c 0a20 2020 2020 2020 2020  0.225,.         
-00016380: 2020 2077 7269 7465 3d46 616c 7365 2c0a     write=False,.
-00016390: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-000163a0: 2222 0a20 2020 2020 2020 2043 616c 6375  "".        Calcu
-000163b0: 6c61 7465 204c 6f63 616c 2063 726f 7373  late Local cross
-000163c0: 2063 6f72 7265 6c61 7469 6f6e 2028 4d61   correlation (Ma
-000163d0: 6e64 6572 2773 204f 7665 726c 6170 290a  nder's Overlap).
-000163e0: 2020 2020 2020 2020 4974 2069 7320 6120          It is a 
-000163f0: 6c6f 6361 6c20 4f76 6572 6c61 7020 436f  local Overlap Co
-00016400: 6566 6669 6369 656e 7420 6361 6c63 756c  efficient calcul
-00016410: 6174 6564 206f 6e20 6174 6f6d 7320 696e  ated on atoms in
-00016420: 2073 6c69 6469 6e67 0a20 2020 2020 2020   sliding.       
-00016430: 2072 6573 6964 7565 2077 696e 646f 7773   residue windows
-00016440: 2061 6c6f 6e67 2074 6865 2063 6861 696e   along the chain
-00016450: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
-00016460: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
-00016470: 2020 2a6d 6170 5f74 6172 6765 742a 0a20    *map_target*. 
-00016480: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-00016490: 6172 6765 7420 4d61 7020 496e 7374 616e  arget Map Instan
-000164a0: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-000164b0: 2a72 6573 6f6c 7574 696f 6e5f 6465 6e73  *resolution_dens
-000164c0: 4d61 702a 0a20 2020 2020 2020 2020 2020  Map*.           
-000164d0: 2020 2020 2050 6172 616d 6574 6572 206e       Parameter n
-000164e0: 6565 6420 666f 7220 5374 7275 6374 7572  eed for Structur
-000164f0: 6520 426c 7572 7265 722e 0a20 2020 2020  e Blurrer..     
-00016500: 2020 2020 2020 2020 2020 2052 6573 6f6c             Resol
-00016510: 7574 696f 6e20 6f66 2074 6865 2074 6172  ution of the tar
-00016520: 6765 7420 6d61 702e 0a20 2020 2020 2020  get map..       
-00016530: 2020 2020 202a 7374 7275 6374 7572 655f       *structure_
-00016540: 696e 7374 616e 6365 2a0a 2020 2020 2020  instance*.      
-00016550: 2020 2020 2020 2020 2020 4d6f 6465 6c20            Model 
-00016560: 7374 7275 6374 7572 6520 696e 7374 616e  structure instan
-00016570: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-00016580: 2a77 696e 2a0a 2020 2020 2020 2020 2020  *win*.          
-00016590: 2020 2020 2020 4f76 6572 6c61 7070 696e        Overlappin
-000165a0: 6720 5769 6e64 6f77 206c 656e 6774 6820  g Window length 
-000165b0: 746f 2063 616c 6375 6c61 7465 2074 6865  to calculate the
-000165c0: 2073 636f 7265 0a20 2020 2020 2020 2020   score.         
-000165d0: 2020 202a 7269 6769 645f 626f 6479 5f66     *rigid_body_f
-000165e0: 696c 652a 0a20 2020 2020 2020 2020 2020  ile*.           
-000165f0: 2020 2020 2052 6967 6964 2d62 6f64 7920       Rigid-body 
-00016600: 6669 6c65 2e0a 2020 2020 2020 2020 2020  file..          
-00016610: 2020 7369 676d 615f 6d61 703a 2050 6172    sigma_map: Par
-00016620: 616d 6574 6572 206e 6565 6420 666f 7220  ameter need for 
-00016630: 5374 7275 6374 7572 6520 426c 7572 7265  Structure Blurre
-00016640: 722e 2046 756c 6c20 6578 706c 616e 6174  r. Full explanat
-00016650: 696f 6e0a 2020 2020 2020 2020 2020 2020  ion.            
-00016660: 2020 2020 3a72 6566 3a60 6865 7265 3c4e      :ref:`here<N
-00016670: 6f74 6520 6f6e 2072 6561 6c20 7370 6163  ote on real spac
-00016680: 6520 626c 7572 7269 6e67 3a3e 600a 2020  e blurring:>`.  
-00016690: 2020 2020 2020 5265 7475 726e 3a0a 2020        Return:.  
-000166a0: 2020 2020 2020 2020 2020 4469 6374 696f            Dictio
-000166b0: 6e61 7279 206f 6620 736d 6f63 2073 636f  nary of smoc sco
-000166c0: 7265 7320 666f 7220 7265 7369 6475 6573  res for residues
-000166d0: 2069 6e20 7468 6520 6368 6169 6e0a 2020   in the chain.  
-000166e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-000166f0: 2020 626c 7572 7265 7220 3d20 5374 7275    blurrer = Stru
-00016700: 6374 7572 6542 6c75 7272 6572 2829 0a20  ctureBlurrer(). 
-00016710: 2020 2020 2020 2073 696d 5f6d 6170 203d         sim_map =
-00016720: 2062 6c75 7272 6572 2e67 6175 7373 6961   blurrer.gaussia
-00016730: 6e5f 626c 7572 5f72 6561 6c5f 7370 6163  n_blur_real_spac
-00016740: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-00016750: 7472 7563 7475 7265 5f69 6e73 7461 6e63  tructure_instanc
-00016760: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
-00016770: 6573 6f6c 7574 696f 6e5f 6465 6e73 4d61  esolution_densMa
-00016780: 702c 0a20 2020 2020 2020 2020 2020 2064  p,.            d
-00016790: 656e 734d 6170 3d6d 6170 5f74 6172 6765  ensMap=map_targe
-000167a0: 742c 0a20 2020 2020 2020 2020 2020 2073  t,.            s
-000167b0: 6967 6d61 5f63 6f65 6666 3d73 6967 6d61  igma_coeff=sigma
-000167c0: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
-000167d0: 2020 6e6f 726d 616c 6973 653d 5472 7565    normalise=True
-000167e0: 2c0a 2020 2020 2020 2020 290a 2020 2020  ,.        ).    
-000167f0: 2020 2020 7065 616b 2c20 6176 652c 2073      peak, ave, s
-00016800: 6967 6d61 203d 2073 696d 5f6d 6170 2e5f  igma = sim_map._
-00016810: 7065 616b 5f64 656e 7369 7479 2829 0a20  peak_density(). 
-00016820: 2020 2020 2020 2023 204e 4f54 453a 2066         # NOTE: f
-00016830: 696c 7465 7220 6261 636b 6772 6f75 6e64  ilter background
-00016840: 0a20 2020 2020 2020 205f 2c20 6469 6374  .        _, dict
-00016850: 5f72 6573 5f69 6e64 6963 6573 2c20 6469  _res_indices, di
-00016860: 6374 5f72 6573 5f64 6973 7420 3d20 626c  ct_res_dist = bl
-00016870: 7572 7265 722e 6765 745f 696e 6469 6365  urrer.get_indice
-00016880: 7328 0a20 2020 2020 2020 2020 2020 2073  s(.            s
-00016890: 7472 7563 7475 7265 5f69 6e73 7461 6e63  tructure_instanc
-000168a0: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-000168b0: 6170 5f74 6172 6765 742c 0a20 2020 2020  ap_target,.     
-000168c0: 2020 2020 2020 2072 6573 6f6c 7574 696f         resolutio
-000168d0: 6e5f 6465 6e73 4d61 700a 2020 2020 2020  n_densMap.      
-000168e0: 2020 290a 2020 2020 2020 2020 2320 6765    ).        # ge
-000168f0: 7420 6465 7461 696c 7320 6f66 206d 6170  t details of map
-00016900: 0a20 2020 2020 2020 2023 206f 7269 6769  .        # origi
-00016910: 6e20 3d20 6d61 705f 7461 7267 6574 2e6f  n = map_target.o
-00016920: 7269 6769 6e0a 2020 2020 2020 2020 2320  rigin.        # 
-00016930: 6170 6978 203d 206d 6170 5f74 6172 6765  apix = map_targe
-00016940: 742e 6170 6978 0a20 2020 2020 2020 2023  t.apix.        #
-00016950: 2062 6f78 5f73 697a 6520 3d20 6d61 705f   box_size = map_
-00016960: 7461 7267 6574 2e62 6f78 5f73 697a 6528  target.box_size(
-00016970: 290a 2020 2020 2020 2020 6e7a 2c20 6e79  ).        nz, ny
-00016980: 2c20 6e78 203d 206d 6170 5f74 6172 6765  , nx = map_targe
-00016990: 742e 6675 6c6c 4d61 702e 7368 6170 650a  t.fullMap.shape.
-000169a0: 2020 2020 2020 2020 7a67 2c20 7967 2c20          zg, yg, 
-000169b0: 7867 203d 206e 702e 6d67 7269 645b 303a  xg = np.mgrid[0:
-000169c0: 6e7a 2c20 303a 6e79 2c20 303a 6e78 5d0a  nz, 0:ny, 0:nx].
-000169d0: 2020 2020 2020 2020 696e 6469 203d 207a          indi = z
-000169e0: 6970 2878 672e 7261 7665 6c28 292c 2079  ip(xg.ravel(), y
-000169f0: 672e 7261 7665 6c28 292c 207a 672e 7261  g.ravel(), zg.ra
-00016a00: 7665 6c28 2929 0a0a 2020 2020 2020 2020  vel())..        
-00016a10: 2320 7361 7665 2072 6967 6964 2062 6f64  # save rigid bod
-00016a20: 7920 6465 7461 696c 730a 2020 2020 2020  y details.      
-00016a30: 2020 6469 6374 5f72 665f 7265 7320 3d20    dict_rf_res = 
-00016a40: 7b7d 0a20 2020 2020 2020 2064 6963 745f  {}.        dict_
-00016a50: 7266 5f73 6320 3d20 7b7d 0a20 2020 2020  rf_sc = {}.     
-00016a60: 2020 2072 6573 5f6c 6973 7420 3d20 5b5d     res_list = []
-00016a70: 0a20 2020 2020 2020 2072 625f 6c69 7374  .        rb_list
-00016a80: 203d 205b 5d0a 2020 2020 2020 2020 6c69   = [].        li
-00016a90: 7374 5f73 6363 6320 3d20 5b5d 0a20 2020  st_sccc = [].   
-00016aa0: 2020 2020 2023 2073 6176 6520 7363 6f72       # save scor
-00016ab0: 6573 2066 6f72 2065 6163 6820 7265 730a  es for each res.
-00016ac0: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
-00016ad0: 5f73 636f 7265 7320 3d20 7b7d 0a20 2020  _scores = {}.   
-00016ae0: 2020 2020 2072 5f63 7420 3d20 300a 2020       r_ct = 0.  
-00016af0: 2020 2020 2020 6966 2072 6967 6964 5f62        if rigid_b
-00016b00: 6f64 795f 6669 6c65 2069 7320 6e6f 7420  ody_file is not 
-00016b10: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-00016b20: 2020 696e 7020 3d20 6f70 656e 2872 6967    inp = open(rig
-00016b30: 6964 5f62 6f64 795f 6669 6c65 2c20 2772  id_body_file, 'r
-00016b40: 2729 0a20 2020 2020 2020 2020 2020 2066  ').            f
-00016b50: 6f72 206c 6e20 696e 2069 6e70 3a0a 2020  or ln in inp:.  
-00016b60: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00016b70: 206c 6e5b 305d 2021 3d20 2723 273a 0a20   ln[0] != '#':. 
-00016b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016b90: 2020 2073 636f 7265 5f69 6e64 6963 6573     score_indices
-00016ba0: 203d 205b 5d0a 2020 2020 2020 2020 2020   = [].          
-00016bb0: 2020 2020 2020 2020 2020 6c72 6220 3d20            lrb = 
-00016bc0: 6c6e 2e73 706c 6974 2829 0a20 2020 2020  ln.split().     
-00016bd0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016be0: 6620 6c65 6e28 6c72 6229 203d 3d20 303a  f len(lrb) == 0:
-00016bf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016c00: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00016c10: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00016c20: 2020 2020 2020 725f 6374 202b 3d20 310a        r_ct += 1.
-00016c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016c40: 2020 2020 7265 735f 6c69 7374 203d 205b      res_list = [
-00016c50: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-00016c60: 2020 2020 2020 7262 5f70 6169 7273 203d        rb_pairs =
-00016c70: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00016c80: 2020 2020 2020 2020 2320 6765 7420 7363          # get sc
-00016c90: 6f72 6573 2066 6f72 2065 6163 6820 7265  ores for each re
-00016ca0: 7320 616e 6420 6561 6368 2072 6967 6964  s and each rigid
-00016cb0: 2062 6f64 790a 2020 2020 2020 2020 2020   body.          
-00016cc0: 2020 2020 2020 2020 2020 666f 7220 6920            for i 
-00016cd0: 696e 2072 616e 6765 286d 6178 2828 6c65  in range(max((le
-00016ce0: 6e28 6c72 6229 202f 2032 2920 2d20 312c  n(lrb) / 2) - 1,
-00016cf0: 2031 2929 3a0a 2020 2020 2020 2020 2020   1)):.          
-00016d00: 2020 2020 2020 2020 2020 2020 2020 7262                rb
-00016d10: 5f70 6169 7273 2e61 7070 656e 6428 5b69  _pairs.append([i
-00016d20: 6e74 286c 7262 5b32 202a 2069 5d29 2c20  nt(lrb[2 * i]), 
-00016d30: 696e 7428 6c72 625b 3220 2a20 6920 2b20  int(lrb[2 * i + 
-00016d40: 315d 295d 290a 2020 2020 2020 2020 2020  1])]).          
-00016d50: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-00016d60: 4e4f 5445 3a20 776f 6e74 2077 6f72 6b20  NOTE: wont work 
-00016d70: 666f 7220 696e 7365 7274 696f 6e20 636f  for insertion co
-00016d80: 6465 730a 2020 2020 2020 2020 2020 2020  des.            
-00016d90: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00016da0: 7220 696e 2072 616e 6765 2869 6e74 286c  r in range(int(l
-00016db0: 7262 5b32 202a 2069 5d29 2c20 696e 7428  rb[2 * i]), int(
-00016dc0: 6c72 625b 322a 6920 2b20 315d 2920 2b20  lrb[2*i + 1]) + 
-00016dd0: 3129 3a0a 2020 2020 2020 2020 2020 2020  1):.            
-00016de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016df0: 7363 6f72 655f 696e 6469 6365 732e 6578  score_indices.ex
-00016e00: 7465 6e64 2864 6963 745f 7265 735f 696e  tend(dict_res_in
-00016e10: 6469 6365 735b 725d 290a 2020 2020 2020  dices[r]).      
+00015f50: 2020 2020 6469 6374 5f72 6573 5f73 636f      dict_res_sco
+00015f60: 7265 735b 7265 735d 203d 2030 2e30 0a20  res[res] = 0.0. 
+00015f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f80: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00015f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00015fa0: 2020 2020 206c 6973 745f 7363 6363 2e61       list_sccc.a
+00015fb0: 7070 656e 6428 736d 6f63 290a 2020 2020  ppend(smoc).    
+00015fc0: 2020 2020 2020 2020 6469 6374 5f63 6861          dict_cha
+00015fd0: 696e 5f73 636f 7265 735b 6368 5d20 3d20  in_scores[ch] = 
+00015fe0: 4f72 6465 7265 6444 6963 7428 290a 2020  OrderedDict().  
+00015ff0: 2020 2020 2020 2020 2020 6469 6374 5f63            dict_c
+00016000: 6861 696e 5f73 636f 7265 735b 6368 5d20  hain_scores[ch] 
+00016010: 3d20 6469 6374 5f72 6573 5f73 636f 7265  = dict_res_score
+00016020: 730a 2020 2020 2020 2020 6465 6c20 6772  s.        del gr
+00016030: 6964 7472 6565 0a20 2020 2020 2020 2064  idtree.        d
+00016040: 656c 2064 6963 745f 6368 6169 6e5f 696e  el dict_chain_in
+00016050: 6469 6365 730a 0a20 2020 2020 2020 2067  dices..        g
+00016060: 632e 636f 6c6c 6563 7428 290a 2020 2020  c.collect().    
+00016070: 2020 2020 6966 2067 6574 5f63 6f6f 7264      if get_coord
+00016080: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00016090: 7475 726e 2064 6963 745f 6368 6169 6e5f  turn dict_chain_
+000160a0: 7363 6f72 6573 2c20 6469 6374 5f63 6861  scores, dict_cha
+000160b0: 696e 5f72 6573 2c20 6469 6374 5f63 6861  in_res, dict_cha
+000160c0: 696e 5f43 410a 2020 2020 2020 2020 656c  in_CA.        el
+000160d0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000160e0: 6465 6c20 6469 6374 5f63 6861 696e 5f43  del dict_chain_C
+000160f0: 410a 2020 2020 2020 2020 2020 2020 7265  A.            re
+00016100: 7475 726e 2064 6963 745f 6368 6169 6e5f  turn dict_chain_
+00016110: 7363 6f72 6573 2c20 6469 6374 5f63 6861  scores, dict_cha
+00016120: 696e 5f72 6573 0a0a 2020 2020 6465 6620  in_res..    def 
+00016130: 5f53 4d4f 4331 2820 2023 2063 616e 2077  _SMOC1(  # can w
+00016140: 6520 6465 6c65 7465 2074 6869 733f 0a20  e delete this?. 
+00016150: 2020 2020 2020 2020 2020 2073 656c 662c             self,
+00016160: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+00016170: 5f74 6172 6765 742c 0a20 2020 2020 2020  _target,.       
+00016180: 2020 2020 2072 6573 6f6c 7574 696f 6e5f       resolution_
+00016190: 6465 6e73 4d61 702c 0a20 2020 2020 2020  densMap,.       
+000161a0: 2020 2020 2073 7472 7563 7475 7265 5f69       structure_i
+000161b0: 6e73 7461 6e63 652c 0a20 2020 2020 2020  nstance,.       
+000161c0: 2020 2020 2077 696e 3d31 312c 0a20 2020       win=11,.   
+000161d0: 2020 2020 2020 2020 2072 6967 6964 5f62           rigid_b
+000161e0: 6f64 795f 6669 6c65 3d4e 6f6e 652c 0a20  ody_file=None,. 
+000161f0: 2020 2020 2020 2020 2020 2073 6967 6d61             sigma
+00016200: 5f6d 6170 3d30 2e32 3235 2c0a 2020 2020  _map=0.225,.    
+00016210: 2020 2020 2020 2020 7772 6974 653d 4661          write=Fa
+00016220: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
+00016230: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00016240: 4361 6c63 756c 6174 6520 4c6f 6361 6c20  Calculate Local 
+00016250: 6372 6f73 7320 636f 7272 656c 6174 696f  cross correlatio
+00016260: 6e20 284d 616e 6465 7227 7320 4f76 6572  n (Mander's Over
+00016270: 6c61 7029 0a20 2020 2020 2020 2049 7420  lap).        It 
+00016280: 6973 2061 206c 6f63 616c 204f 7665 726c  is a local Overl
+00016290: 6170 2043 6f65 6666 6963 6965 6e74 2063  ap Coefficient c
+000162a0: 616c 6375 6c61 7465 6420 6f6e 2061 746f  alculated on ato
+000162b0: 6d73 2069 6e20 736c 6964 696e 670a 2020  ms in sliding.  
+000162c0: 2020 2020 2020 7265 7369 6475 6520 7769        residue wi
+000162d0: 6e64 6f77 7320 616c 6f6e 6720 7468 6520  ndows along the 
+000162e0: 6368 6169 6e2e 0a0a 2020 2020 2020 2020  chain...        
+000162f0: 4172 6775 6d65 6e74 733a 0a20 2020 2020  Arguments:.     
+00016300: 2020 2020 2020 202a 6d61 705f 7461 7267         *map_targ
+00016310: 6574 2a0a 2020 2020 2020 2020 2020 2020  et*.            
+00016320: 2020 2020 5461 7267 6574 204d 6170 2049      Target Map I
+00016330: 6e73 7461 6e63 652e 0a20 2020 2020 2020  nstance..       
+00016340: 2020 2020 202a 7265 736f 6c75 7469 6f6e       *resolution
+00016350: 5f64 656e 734d 6170 2a0a 2020 2020 2020  _densMap*.      
+00016360: 2020 2020 2020 2020 2020 5061 7261 6d65            Parame
+00016370: 7465 7220 6e65 6564 2066 6f72 2053 7472  ter need for Str
+00016380: 7563 7475 7265 2042 6c75 7272 6572 2e0a  ucture Blurrer..
+00016390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000163a0: 5265 736f 6c75 7469 6f6e 206f 6620 7468  Resolution of th
+000163b0: 6520 7461 7267 6574 206d 6170 2e0a 2020  e target map..  
+000163c0: 2020 2020 2020 2020 2020 2a73 7472 7563            *struc
+000163d0: 7475 7265 5f69 6e73 7461 6e63 652a 0a20  ture_instance*. 
+000163e0: 2020 2020 2020 2020 2020 2020 2020 204d                 M
+000163f0: 6f64 656c 2073 7472 7563 7475 7265 2069  odel structure i
+00016400: 6e73 7461 6e63 652e 0a20 2020 2020 2020  nstance..       
+00016410: 2020 2020 202a 7769 6e2a 0a20 2020 2020       *win*.     
+00016420: 2020 2020 2020 2020 2020 204f 7665 726c             Overl
+00016430: 6170 7069 6e67 2057 696e 646f 7720 6c65  apping Window le
+00016440: 6e67 7468 2074 6f20 6361 6c63 756c 6174  ngth to calculat
+00016450: 6520 7468 6520 7363 6f72 650a 2020 2020  e the score.    
+00016460: 2020 2020 2020 2020 2a72 6967 6964 5f62          *rigid_b
+00016470: 6f64 795f 6669 6c65 2a0a 2020 2020 2020  ody_file*.      
+00016480: 2020 2020 2020 2020 2020 5269 6769 642d            Rigid-
+00016490: 626f 6479 2066 696c 652e 0a20 2020 2020  body file..     
+000164a0: 2020 2020 2020 2073 6967 6d61 5f6d 6170         sigma_map
+000164b0: 3a20 5061 7261 6d65 7465 7220 6e65 6564  : Parameter need
+000164c0: 2066 6f72 2053 7472 7563 7475 7265 2042   for Structure B
+000164d0: 6c75 7272 6572 2e20 4675 6c6c 2065 7870  lurrer. Full exp
+000164e0: 6c61 6e61 7469 6f6e 0a20 2020 2020 2020  lanation.       
+000164f0: 2020 2020 2020 2020 203a 7265 663a 6068           :ref:`h
+00016500: 6572 653c 4e6f 7465 206f 6e20 7265 616c  ere<Note on real
+00016510: 2073 7061 6365 2062 6c75 7272 696e 673a   space blurring:
+00016520: 3e60 0a20 2020 2020 2020 2052 6574 7572  >`.        Retur
+00016530: 6e3a 0a20 2020 2020 2020 2020 2020 2044  n:.            D
+00016540: 6963 7469 6f6e 6172 7920 6f66 2073 6d6f  ictionary of smo
+00016550: 6320 7363 6f72 6573 2066 6f72 2072 6573  c scores for res
+00016560: 6964 7565 7320 696e 2074 6865 2063 6861  idues in the cha
+00016570: 696e 0a20 2020 2020 2020 2022 2222 0a20  in.        """. 
+00016580: 2020 2020 2020 2062 6c75 7272 6572 203d         blurrer =
+00016590: 2053 7472 7563 7475 7265 426c 7572 7265   StructureBlurre
+000165a0: 7228 290a 2020 2020 2020 2020 7369 6d5f  r().        sim_
+000165b0: 6d61 7020 3d20 626c 7572 7265 722e 6761  map = blurrer.ga
+000165c0: 7573 7369 616e 5f62 6c75 725f 7265 616c  ussian_blur_real
+000165d0: 5f73 7061 6365 280a 2020 2020 2020 2020  _space(.        
+000165e0: 2020 2020 7374 7275 6374 7572 655f 696e      structure_in
+000165f0: 7374 616e 6365 2c0a 2020 2020 2020 2020  stance,.        
+00016600: 2020 2020 7265 736f 6c75 7469 6f6e 5f64      resolution_d
+00016610: 656e 734d 6170 2c0a 2020 2020 2020 2020  ensMap,.        
+00016620: 2020 2020 6465 6e73 4d61 703d 6d61 705f      densMap=map_
+00016630: 7461 7267 6574 2c0a 2020 2020 2020 2020  target,.        
+00016640: 2020 2020 7369 676d 615f 636f 6566 663d      sigma_coeff=
+00016650: 7369 676d 615f 6d61 702c 0a20 2020 2020  sigma_map,.     
+00016660: 2020 2020 2020 206e 6f72 6d61 6c69 7365         normalise
+00016670: 3d54 7275 652c 0a20 2020 2020 2020 2029  =True,.        )
+00016680: 0a20 2020 2020 2020 2070 6561 6b2c 2061  .        peak, a
+00016690: 7665 2c20 7369 676d 6120 3d20 7369 6d5f  ve, sigma = sim_
+000166a0: 6d61 702e 5f70 6561 6b5f 6465 6e73 6974  map._peak_densit
+000166b0: 7928 290a 2020 2020 2020 2020 2320 4e4f  y().        # NO
+000166c0: 5445 3a20 6669 6c74 6572 2062 6163 6b67  TE: filter backg
+000166d0: 726f 756e 640a 2020 2020 2020 2020 5f2c  round.        _,
+000166e0: 2064 6963 745f 7265 735f 696e 6469 6365   dict_res_indice
+000166f0: 732c 2064 6963 745f 7265 735f 6469 7374  s, dict_res_dist
+00016700: 203d 2062 6c75 7272 6572 2e67 6574 5f69   = blurrer.get_i
+00016710: 6e64 6963 6573 280a 2020 2020 2020 2020  ndices(.        
+00016720: 2020 2020 7374 7275 6374 7572 655f 696e      structure_in
+00016730: 7374 616e 6365 2c0a 2020 2020 2020 2020  stance,.        
+00016740: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
+00016750: 2020 2020 2020 2020 2020 2020 7265 736f              reso
+00016760: 6c75 7469 6f6e 5f64 656e 734d 6170 0a20  lution_densMap. 
+00016770: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00016780: 2023 2067 6574 2064 6574 6169 6c73 206f   # get details o
+00016790: 6620 6d61 700a 2020 2020 2020 2020 2320  f map.        # 
+000167a0: 6f72 6967 696e 203d 206d 6170 5f74 6172  origin = map_tar
+000167b0: 6765 742e 6f72 6967 696e 0a20 2020 2020  get.origin.     
+000167c0: 2020 2023 2061 7069 7820 3d20 6d61 705f     # apix = map_
+000167d0: 7461 7267 6574 2e61 7069 780a 2020 2020  target.apix.    
+000167e0: 2020 2020 2320 626f 785f 7369 7a65 203d      # box_size =
+000167f0: 206d 6170 5f74 6172 6765 742e 626f 785f   map_target.box_
+00016800: 7369 7a65 2829 0a20 2020 2020 2020 206e  size().        n
+00016810: 7a2c 206e 792c 206e 7820 3d20 6d61 705f  z, ny, nx = map_
+00016820: 7461 7267 6574 2e66 756c 6c4d 6170 2e73  target.fullMap.s
+00016830: 6861 7065 0a20 2020 2020 2020 207a 672c  hape.        zg,
+00016840: 2079 672c 2078 6720 3d20 6e70 2e6d 6772   yg, xg = np.mgr
+00016850: 6964 5b30 3a6e 7a2c 2030 3a6e 792c 2030  id[0:nz, 0:ny, 0
+00016860: 3a6e 785d 0a20 2020 2020 2020 2069 6e64  :nx].        ind
+00016870: 6920 3d20 7a69 7028 7867 2e72 6176 656c  i = zip(xg.ravel
+00016880: 2829 2c20 7967 2e72 6176 656c 2829 2c20  (), yg.ravel(), 
+00016890: 7a67 2e72 6176 656c 2829 290a 0a20 2020  zg.ravel())..   
+000168a0: 2020 2020 2023 2073 6176 6520 7269 6769       # save rigi
+000168b0: 6420 626f 6479 2064 6574 6169 6c73 0a20  d body details. 
+000168c0: 2020 2020 2020 2064 6963 745f 7266 5f72         dict_rf_r
+000168d0: 6573 203d 207b 7d0a 2020 2020 2020 2020  es = {}.        
+000168e0: 6469 6374 5f72 665f 7363 203d 207b 7d0a  dict_rf_sc = {}.
+000168f0: 2020 2020 2020 2020 7265 735f 6c69 7374          res_list
+00016900: 203d 205b 5d0a 2020 2020 2020 2020 7262   = [].        rb
+00016910: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2020  _list = [].     
+00016920: 2020 206c 6973 745f 7363 6363 203d 205b     list_sccc = [
+00016930: 5d0a 2020 2020 2020 2020 2320 7361 7665  ].        # save
+00016940: 2073 636f 7265 7320 666f 7220 6561 6368   scores for each
+00016950: 2072 6573 0a20 2020 2020 2020 2064 6963   res.        dic
+00016960: 745f 7265 735f 7363 6f72 6573 203d 207b  t_res_scores = {
+00016970: 7d0a 2020 2020 2020 2020 725f 6374 203d  }.        r_ct =
+00016980: 2030 0a20 2020 2020 2020 2069 6620 7269   0.        if ri
+00016990: 6769 645f 626f 6479 5f66 696c 6520 6973  gid_body_file is
+000169a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
+000169b0: 2020 2020 2020 2069 6e70 203d 206f 7065         inp = ope
+000169c0: 6e28 7269 6769 645f 626f 6479 5f66 696c  n(rigid_body_fil
+000169d0: 652c 2027 7227 290a 2020 2020 2020 2020  e, 'r').        
+000169e0: 2020 2020 666f 7220 6c6e 2069 6e20 696e      for ln in in
+000169f0: 703a 0a20 2020 2020 2020 2020 2020 2020  p:.             
+00016a00: 2020 2069 6620 6c6e 5b30 5d20 213d 2027     if ln[0] != '
+00016a10: 2327 3a0a 2020 2020 2020 2020 2020 2020  #':.            
+00016a20: 2020 2020 2020 2020 7363 6f72 655f 696e          score_in
+00016a30: 6469 6365 7320 3d20 5b5d 0a20 2020 2020  dices = [].     
+00016a40: 2020 2020 2020 2020 2020 2020 2020 206c                 l
+00016a50: 7262 203d 206c 6e2e 7370 6c69 7428 290a  rb = ln.split().
+00016a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016a70: 2020 2020 6966 206c 656e 286c 7262 2920      if len(lrb) 
+00016a80: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
+00016a90: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00016aa0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00016ab0: 2020 2020 2020 2020 2020 2072 5f63 7420             r_ct 
+00016ac0: 2b3d 2031 0a20 2020 2020 2020 2020 2020  += 1.           
+00016ad0: 2020 2020 2020 2020 2072 6573 5f6c 6973           res_lis
+00016ae0: 7420 3d20 5b5d 0a20 2020 2020 2020 2020  t = [].         
+00016af0: 2020 2020 2020 2020 2020 2072 625f 7061             rb_pa
+00016b00: 6972 7320 3d20 5b5d 0a20 2020 2020 2020  irs = [].       
+00016b10: 2020 2020 2020 2020 2020 2020 2023 2067               # g
+00016b20: 6574 2073 636f 7265 7320 666f 7220 6561  et scores for ea
+00016b30: 6368 2072 6573 2061 6e64 2065 6163 6820  ch res and each 
+00016b40: 7269 6769 6420 626f 6479 0a20 2020 2020  rigid body.     
+00016b50: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00016b60: 6f72 2069 2069 6e20 7261 6e67 6528 6d61  or i in range(ma
+00016b70: 7828 286c 656e 286c 7262 2920 2f20 3229  x((len(lrb) / 2)
+00016b80: 202d 2031 2c20 3129 293a 0a20 2020 2020   - 1, 1)):.     
+00016b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ba0: 2020 2072 625f 7061 6972 732e 6170 7065     rb_pairs.appe
+00016bb0: 6e64 285b 696e 7428 6c72 625b 3220 2a20  nd([int(lrb[2 * 
+00016bc0: 695d 292c 2069 6e74 286c 7262 5b32 202a  i]), int(lrb[2 *
+00016bd0: 2069 202b 2031 5d29 5d29 0a20 2020 2020   i + 1])]).     
+00016be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016bf0: 2020 2023 204e 4f54 453a 2077 6f6e 7420     # NOTE: wont 
+00016c00: 776f 726b 2066 6f72 2069 6e73 6572 7469  work for inserti
+00016c10: 6f6e 2063 6f64 6573 0a20 2020 2020 2020  on codes.       
+00016c20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c30: 2066 6f72 2072 2069 6e20 7261 6e67 6528   for r in range(
+00016c40: 696e 7428 6c72 625b 3220 2a20 695d 292c  int(lrb[2 * i]),
+00016c50: 2069 6e74 286c 7262 5b32 2a69 202b 2031   int(lrb[2*i + 1
+00016c60: 5d29 202b 2031 293a 0a20 2020 2020 2020  ]) + 1):.       
+00016c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016c80: 2020 2020 2073 636f 7265 5f69 6e64 6963       score_indic
+00016c90: 6573 2e65 7874 656e 6428 6469 6374 5f72  es.extend(dict_r
+00016ca0: 6573 5f69 6e64 6963 6573 5b72 5d29 0a20  es_indices[r]). 
+00016cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cc0: 2020 2020 2020 2020 2020 2072 6573 5f6c             res_l
+00016cd0: 6973 742e 6170 7065 6e64 2872 290a 2020  ist.append(r).  
+00016ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016cf0: 2020 7262 5f6c 6973 742e 6170 7065 6e64    rb_list.append
+00016d00: 286c 7262 290a 2020 2020 2020 2020 2020  (lrb).          
+00016d10: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
+00016d20: 665f 7265 735b 725f 6374 5d20 3d20 7262  f_res[r_ct] = rb
+00016d30: 5f70 6169 7273 0a20 2020 2020 2020 2020  _pairs.         
+00016d40: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00016d50: 6e28 7363 6f72 655f 696e 6469 6365 7329  n(score_indices)
+00016d60: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+00016d70: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00016d80: 6963 745f 7266 5f73 635b 725f 6374 5d20  ict_rf_sc[r_ct] 
+00016d90: 3d20 302e 300a 2020 2020 2020 2020 2020  = 0.0.          
+00016da0: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00016db0: 7220 7265 7320 696e 2072 6573 5f6c 6973  r res in res_lis
+00016dc0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00016dd0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00016de0: 6963 745f 7265 735f 7363 6f72 6573 5b72  ict_res_scores[r
+00016df0: 6573 5d20 3d20 302e 300a 2020 2020 2020  es] = 0.0.      
+00016e00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016e10: 2020 636f 6e74 696e 7565 0a0a 2020 2020    continue..    
 00016e20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016e30: 2020 2020 2020 7265 735f 6c69 7374 2e61        res_list.a
-00016e40: 7070 656e 6428 7229 0a20 2020 2020 2020  ppend(r).       
-00016e50: 2020 2020 2020 2020 2020 2020 2072 625f               rb_
-00016e60: 6c69 7374 2e61 7070 656e 6428 6c72 6229  list.append(lrb)
-00016e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016e80: 2020 2020 2064 6963 745f 7266 5f72 6573       dict_rf_res
-00016e90: 5b72 5f63 745d 203d 2072 625f 7061 6972  [r_ct] = rb_pair
-00016ea0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00016eb0: 2020 2020 2020 6966 206c 656e 2873 636f        if len(sco
-00016ec0: 7265 5f69 6e64 6963 6573 2920 3d3d 2030  re_indices) == 0
-00016ed0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016ee0: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
-00016ef0: 665f 7363 5b72 5f63 745d 203d 2030 2e30  f_sc[r_ct] = 0.0
-00016f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f10: 2020 2020 2020 2020 2066 6f72 2072 6573           for res
-00016f20: 2069 6e20 7265 735f 6c69 7374 3a0a 2020   in res_list:.  
+00016e30: 746d 706c 6973 7420 3d20 7363 6f72 655f  tmplist = score_
+00016e40: 696e 6469 6365 735b 3a5d 0a20 2020 2020  indices[:].     
+00016e50: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00016e60: 6574 6c69 7374 203d 2073 6574 2874 6d70  etlist = set(tmp
+00016e70: 6c69 7374 290a 2020 2020 2020 2020 2020  list).          
+00016e80: 2020 2020 2020 2020 2020 7363 6f72 655f            score_
+00016e90: 696e 6469 6365 7320 3d20 6c69 7374 2873  indices = list(s
+00016ea0: 6574 6c69 7374 290a 2020 2020 2020 2020  etlist).        
+00016eb0: 2020 2020 2020 2020 2020 2020 7363 5f69              sc_i
+00016ec0: 6e64 6963 6573 203d 205b 5d0a 2020 2020  ndices = [].    
+00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016ee0: 666f 7220 6969 2069 6e20 7363 6f72 655f  for ii in score_
+00016ef0: 696e 6469 6365 733a 0a20 2020 2020 2020  indices:.       
+00016f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00016f10: 2073 635f 696e 6469 6365 732e 6170 7065   sc_indices.appe
+00016f20: 6e64 2869 6e64 695b 6969 5d29 0a20 2020  nd(indi[ii]).   
 00016f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016f40: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
-00016f50: 6573 5f73 636f 7265 735b 7265 735d 203d  es_scores[res] =
-00016f60: 2030 2e30 0a20 2020 2020 2020 2020 2020   0.0.           
-00016f70: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00016f80: 7469 6e75 650a 0a20 2020 2020 2020 2020  tinue..         
-00016f90: 2020 2020 2020 2020 2020 2074 6d70 6c69             tmpli
-00016fa0: 7374 203d 2073 636f 7265 5f69 6e64 6963  st = score_indic
-00016fb0: 6573 5b3a 5d0a 2020 2020 2020 2020 2020  es[:].          
-00016fc0: 2020 2020 2020 2020 2020 7365 746c 6973            setlis
-00016fd0: 7420 3d20 7365 7428 746d 706c 6973 7429  t = set(tmplist)
-00016fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016ff0: 2020 2020 2073 636f 7265 5f69 6e64 6963       score_indic
-00017000: 6573 203d 206c 6973 7428 7365 746c 6973  es = list(setlis
-00017010: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-00017020: 2020 2020 2020 2073 635f 696e 6469 6365         sc_indice
-00017030: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
-00017040: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00017050: 6920 696e 2073 636f 7265 5f69 6e64 6963  i in score_indic
-00017060: 6573 3a0a 2020 2020 2020 2020 2020 2020  es:.            
-00017070: 2020 2020 2020 2020 2020 2020 7363 5f69              sc_i
-00017080: 6e64 6963 6573 2e61 7070 656e 6428 696e  ndices.append(in
-00017090: 6469 5b69 695d 290a 2020 2020 2020 2020  di[ii]).        
-000170a0: 2020 2020 2020 2020 2020 2020 6172 7261              arra
-000170b0: 795f 696e 6469 6365 7320 3d20 6e70 2e61  y_indices = np.a
-000170c0: 7272 6179 2873 635f 696e 6469 6365 7329  rray(sc_indices)
-000170d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000170e0: 2020 2020 2069 6e64 5f61 7272 7879 7a20       ind_arrxyz 
-000170f0: 3d20 6e70 2e74 7261 6e73 706f 7365 2861  = np.transpose(a
-00017100: 7272 6179 5f69 6e64 6963 6573 290a 0a20  rray_indices).. 
-00017110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017120: 2020 2069 6e64 5f61 7272 7a79 7820 3d20     ind_arrzyx = 
-00017130: 2869 6e64 5f61 7272 7879 7a5b 325d 2c20  (ind_arrxyz[2], 
-00017140: 696e 645f 6172 7278 797a 5b31 5d2c 2069  ind_arrxyz[1], i
-00017150: 6e64 5f61 7272 7879 7a5b 305d 290a 2020  nd_arrxyz[0]).  
-00017160: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017170: 2020 7363 6363 203d 2073 656c 662e 6361    sccc = self.ca
-00017180: 6c63 5f6d 6f63 2869 6e64 5f61 7272 7a79  lc_moc(ind_arrzy
-00017190: 782c 2073 696d 5f6d 6170 2c20 6d61 705f  x, sim_map, map_
-000171a0: 7461 7267 6574 290a 2020 2020 2020 2020  target).        
-000171b0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
-000171c0: 5f72 665f 7363 5b72 5f63 745d 203d 2073  _rf_sc[r_ct] = s
-000171d0: 6363 630a 2020 2020 2020 2020 2020 2020  ccc.            
-000171e0: 2020 2020 2020 2020 2320 7361 7665 2073          # save s
-000171f0: 636f 7265 730a 2020 2020 2020 2020 2020  cores.          
-00017200: 2020 2020 2020 2020 2020 666f 7220 7265            for re
-00017210: 7320 696e 2072 6573 5f6c 6973 743a 0a20  s in res_list:. 
-00017220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017230: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
-00017240: 7363 6f72 6573 5b72 6573 5d20 3d20 7363  scores[res] = sc
-00017250: 6363 0a20 2020 2020 2020 2020 2020 2020  cc.             
-00017260: 2020 2020 2020 2020 2020 206c 6973 745f             list_
-00017270: 7363 6363 2e61 7070 656e 6428 7363 6363  sccc.append(sccc
-00017280: 290a 2020 2020 2020 2020 2020 2020 696e  ).            in
-00017290: 702e 636c 6f73 6528 290a 2020 2020 2020  p.close().      
-000172a0: 2020 2320 666f 7220 7265 7369 6475 6573    # for residues
-000172b0: 206e 6f74 2069 6e20 7269 6769 6420 626f   not in rigid bo
-000172c0: 6469 6573 3a20 636f 6e73 6964 6572 2070  dies: consider p
-000172d0: 656e 7461 7065 7074 6964 6573 0a20 2020  entapeptides.   
-000172e0: 2020 2020 2066 6f72 2072 6573 2069 6e20       for res in 
-000172f0: 6469 6374 5f72 6573 5f69 6e64 6963 6573  dict_res_indices
-00017300: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-00017310: 2072 6573 2069 6e20 6469 6374 5f72 6573   res in dict_res
-00017320: 5f73 636f 7265 733a 0a20 2020 2020 2020  _scores:.       
-00017330: 2020 2020 2020 2020 2069 6e64 6963 6573           indices
-00017340: 203d 2064 6963 745f 7265 735f 696e 6469   = dict_res_indi
-00017350: 6365 735b 7265 735d 5b3a 5d0a 2020 2020  ces[res][:].    
-00017360: 2020 2020 2020 2020 2020 2020 2320 636f              # co
-00017370: 6e73 6964 6572 2072 6573 6964 7565 7320  nsider residues 
-00017380: 6f6e 2062 6f74 6820 7369 6465 732e 204e  on both sides. N
-00017390: 4f54 453a 2077 6f6e 7420 776f 726b 2066  OTE: wont work f
-000173a0: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
-000173b0: 2020 2023 2069 6e73 6572 7469 6f6e 2063     # insertion c
-000173c0: 6f64 6573 210a 2020 2020 2020 2020 2020  odes!.          
-000173d0: 2020 2020 2020 2320 6e65 6564 2074 6f20        # need to 
-000173e0: 7265 7769 7465 2072 6573 206e 756d 6265  rewite res numbe
-000173f0: 7273 2074 6f20 6176 6f69 6420 696e 7365  rs to avoid inse
-00017400: 7274 696f 6e20 636f 6465 730a 2020 2020  rtion codes.    
-00017410: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00017420: 6969 2069 6e20 7261 6e67 6528 312c 2069  ii in range(1, i
-00017430: 6e74 2872 6f75 6e64 2828 7769 6e20 2b20  nt(round((win + 
-00017440: 3129 202f 2032 2929 293a 0a20 2020 2020  1) / 2))):.     
-00017450: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-00017460: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-00017470: 2020 2020 2020 2020 2020 2020 696e 6469              indi
-00017480: 6365 732e 6578 7465 6e64 2864 6963 745f  ces.extend(dict_
-00017490: 7265 735f 696e 6469 6365 735b 7265 7320  res_indices[res 
-000174a0: 2d20 6969 5d29 0a20 2020 2020 2020 2020  - ii]).         
-000174b0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-000174c0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
-000174d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000174e0: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
-000174f0: 2020 2020 2020 2020 2020 666f 7220 6969            for ii
-00017500: 2069 6e20 7261 6e67 6528 312c 2069 6e74   in range(1, int
-00017510: 2872 6f75 6e64 2828 7769 6e20 2b20 3129  (round((win + 1)
-00017520: 202f 2032 2929 293a 0a20 2020 2020 2020   / 2))):.       
-00017530: 2020 2020 2020 2020 2020 2020 2074 7279               try
-00017540: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00017550: 2020 2020 2020 2020 2020 696e 6469 6365            indice
-00017560: 732e 6578 7465 6e64 2864 6963 745f 7265  s.extend(dict_re
-00017570: 735f 696e 6469 6365 735b 7265 7320 2b20  s_indices[res + 
-00017580: 6969 5d29 0a20 2020 2020 2020 2020 2020  ii]).           
-00017590: 2020 2020 2020 2020 2065 7863 6570 7420           except 
-000175a0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-000175b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000175c0: 2020 2070 6173 730a 0a20 2020 2020 2020     pass..       
-000175d0: 2020 2020 2020 2020 2074 6d70 6c69 7374           tmplist
-000175e0: 203d 2069 6e64 6963 6573 5b3a 5d0a 2020   = indices[:].  
-000175f0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00017600: 746c 6973 7420 3d20 7365 7428 746d 706c  tlist = set(tmpl
-00017610: 6973 7429 0a20 2020 2020 2020 2020 2020  ist).           
-00017620: 2020 2020 2069 6e64 6963 6573 203d 206c       indices = l
-00017630: 6973 7428 7365 746c 6973 7429 0a20 2020  ist(setlist).   
-00017640: 2020 2020 2020 2020 2020 2020 2073 635f               sc_
-00017650: 696e 6469 6365 7320 3d20 5b5d 0a20 2020  indices = [].   
-00017660: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-00017670: 2069 6920 696e 2069 6e64 6963 6573 3a0a   ii in indices:.
-00017680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017690: 2020 2020 7363 5f69 6e64 6963 6573 2e61      sc_indices.a
-000176a0: 7070 656e 6428 696e 6469 5b69 695d 290a  ppend(indi[ii]).
-000176b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176c0: 6966 206c 656e 2869 6e64 6963 6573 2920  if len(indices) 
-000176d0: 3d3d 2030 3a0a 2020 2020 2020 2020 2020  == 0:.          
-000176e0: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
-000176f0: 6573 5f73 636f 7265 735b 7265 735d 203d  es_scores[res] =
-00017700: 2030 2e30 0a20 2020 2020 2020 2020 2020   0.0.           
-00017710: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00017720: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-00017730: 2020 6172 7261 795f 696e 6469 6365 7320    array_indices 
-00017740: 3d20 6e70 2e61 7272 6179 2873 635f 696e  = np.array(sc_in
-00017750: 6469 6365 7329 0a20 2020 2020 2020 2020  dices).         
-00017760: 2020 2020 2020 2069 6e64 5f61 7272 7879         ind_arrxy
-00017770: 7a20 3d20 6e70 2e74 7261 6e73 706f 7365  z = np.transpose
-00017780: 2861 7272 6179 5f69 6e64 6963 6573 290a  (array_indices).
-00017790: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000177a0: 696e 645f 6172 727a 7978 203d 2028 696e  ind_arrzyx = (in
-000177b0: 645f 6172 7278 797a 5b32 5d2c 2069 6e64  d_arrxyz[2], ind
-000177c0: 5f61 7272 7879 7a5b 315d 2c20 696e 645f  _arrxyz[1], ind_
-000177d0: 6172 7278 797a 5b30 5d29 0a20 2020 2020  arrxyz[0]).     
-000177e0: 2020 2020 2020 2020 2020 2073 6363 6320             sccc 
-000177f0: 3d20 7365 6c66 2e63 616c 635f 6d6f 6328  = self.calc_moc(
-00017800: 696e 645f 6172 727a 7978 2c20 7369 6d5f  ind_arrzyx, sim_
-00017810: 6d61 702c 206d 6170 5f74 6172 6765 7429  map, map_target)
-00017820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017830: 2064 6963 745f 7265 735f 7363 6f72 6573   dict_res_scores
-00017840: 5b72 6573 5d20 3d20 7363 6363 0a20 2020  [res] = sccc.   
-00017850: 2020 2020 2020 2020 2020 2020 206c 6973               lis
-00017860: 745f 7363 6363 2e61 7070 656e 6428 7363  t_sccc.append(sc
-00017870: 6363 290a 2020 2020 2020 2020 7265 7475  cc).        retu
-00017880: 726e 2064 6963 745f 7265 735f 7363 6f72  rn dict_res_scor
-00017890: 6573 0a0a 2020 2020 6465 6620 5f67 6574  es..    def _get
-000178a0: 5f73 6865 6c6c 2873 656c 662c 2064 6973  _shell(self, dis
-000178b0: 7431 2c20 6d61 786c 6576 656c 2c20 7374  t1, maxlevel, st
-000178c0: 6570 2c20 7829 3a0a 2020 2020 2020 2020  ep, x):.        
-000178d0: 2320 696e 6469 6365 7320 6265 7477 6565  # indices betwee
-000178e0: 6e20 7570 7065 7220 616e 6420 6c6f 7765  n upper and lowe
-000178f0: 7220 7368 656c 6c20 626f 756e 640a 2020  r shell bound.  
-00017900: 2020 2020 2020 7265 7475 726e 206e 702e        return np.
-00017910: 6172 6777 6865 7265 2828 6469 7374 3120  argwhere((dist1 
-00017920: 3c20 6d69 6e28 6d61 786c 6576 656c 2c20  < min(maxlevel, 
-00017930: 7820 2b20 7374 6570 2929 2026 2028 6469  x + step)) & (di
-00017940: 7374 3120 3e3d 2078 2929 0a0a 2020 2020  st1 >= x))..    
-00017950: 2020 2020 2320 6d61 7463 6820 706f 7765      # match powe
-00017960: 7220 7370 6563 7472 6120 666f 7220 7477  r spectra for tw
-00017970: 6f20 6d61 7073 0a20 2020 2064 6566 205f  o maps.    def _
-00017980: 616d 706c 6974 7564 655f 6d61 7463 6828  amplitude_match(
-00017990: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000179a0: 662c 0a20 2020 2020 2020 2020 2020 206d  f,.            m
-000179b0: 6170 5f31 2c0a 2020 2020 2020 2020 2020  ap_1,.          
-000179c0: 2020 6d61 705f 322c 0a20 2020 2020 2020    map_2,.       
-000179d0: 2020 2020 2073 6865 6c6c 6d69 6e2c 0a20       shellmin,. 
-000179e0: 2020 2020 2020 2020 2020 2073 6865 6c6c             shell
-000179f0: 6d61 782c 0a20 2020 2020 2020 2020 2020  max,.           
-00017a00: 2073 7465 703d 302e 3030 352c 0a20 2020   step=0.005,.   
-00017a10: 2020 2020 2020 2020 2063 313d 302c 0a20           c1=0,. 
-00017a20: 2020 2020 2020 2020 2020 2063 323d 302c             c2=0,
-00017a30: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00017a40: 6f3d 4e6f 6e65 2c0a 2020 2020 2020 2020  o=None,.        
-00017a50: 2020 2020 6c70 6669 6c74 623d 4661 6c73      lpfiltb=Fals
-00017a60: 652c 0a20 2020 2020 2020 2020 2020 206c  e,.            l
-00017a70: 7066 696c 7461 3d46 616c 7365 2c0a 2020  pfilta=False,.  
-00017a80: 2020 2020 2020 2020 2020 7265 663d 4661            ref=Fa
-00017a90: 6c73 652c 0a20 2020 2029 3a0a 2020 2020  lse,.    ):.    
-00017aa0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-00017ab0: 5363 616c 6520 616d 706c 6974 7564 6573  Scale amplitudes
-00017ac0: 2074 6f20 7468 6520 6176 6572 6167 6520   to the average 
-00017ad0: 696e 2065 6163 6820 7265 736f 6c75 7469  in each resoluti
-00017ae0: 6f6e 7320 7368 656c 6c0a 0a20 2020 2020  ons shell..     
-00017af0: 2020 2041 7267 756d 656e 7473 3a0a 2020     Arguments:.  
-00017b00: 2020 2020 2020 2020 2020 2a73 7465 7020            *step 
-00017b10: 3a20 7368 656c 6c20 7769 6474 6820 2831  : shell width (1
-00017b20: 2f41 290a 2020 2020 2020 2020 2222 220a  /A).        """.
-00017b30: 2020 2020 2020 2020 2320 666f 7572 6965          # fourie
-00017b40: 7220 7472 616e 7366 6f72 6d3a 2075 7365  r transform: use
-00017b50: 2070 7966 6674 7720 6966 2061 7661 696c   pyfftw if avail
-00017b60: 6162 6c65 0a20 2020 2020 2020 2070 7966  able.        pyf
-00017b70: 6674 775f 666c 6167 203d 2031 0a20 2020  ftw_flag = 1.   
-00017b80: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00017b90: 2020 2020 2020 696d 706f 7274 2070 7966        import pyf
-00017ba0: 6674 770a 2020 2020 2020 2020 6578 6365  ftw.        exce
-00017bb0: 7074 2049 6d70 6f72 7445 7272 6f72 3a0a  pt ImportError:.
-00017bc0: 2020 2020 2020 2020 2020 2020 7079 6666              pyff
-00017bd0: 7477 5f66 6c61 6720 3d20 300a 2020 2020  tw_flag = 0.    
-00017be0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-00017bf0: 2020 2020 2069 6620 7079 6666 7477 5f66       if pyfftw_f
-00017c00: 6c61 6720 3d3d 2030 3a0a 2020 2020 2020  lag == 0:.      
-00017c10: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-00017c20: 496d 706f 7274 4572 726f 720a 2020 2020  ImportError.    
-00017c30: 2020 2020 2020 2020 696e 7075 7461 3120          inputa1 
-00017c40: 3d20 7079 6666 7477 2e6e 5f62 7974 655f  = pyfftw.n_byte_
-00017c50: 616c 6967 6e5f 656d 7074 7928 0a20 2020  align_empty(.   
-00017c60: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00017c70: 5f31 2e66 756c 6c4d 6170 2e73 6861 7065  _1.fullMap.shape
-00017c80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00017c90: 2020 3136 2c0a 2020 2020 2020 2020 2020    16,.          
-00017ca0: 2020 2020 2020 2763 6f6d 706c 6578 3132        'complex12
-00017cb0: 3827 2c0a 2020 2020 2020 2020 2020 2020  8',.            
-00017cc0: 290a 2020 2020 2020 2020 2020 2020 6f75  ).            ou
-00017cd0: 7470 7574 6131 203d 2070 7966 6674 772e  tputa1 = pyfftw.
-00017ce0: 6e5f 6279 7465 5f61 6c69 676e 5f65 6d70  n_byte_align_emp
-00017cf0: 7479 280a 2020 2020 2020 2020 2020 2020  ty(.            
-00017d00: 2020 2020 6d61 705f 312e 6675 6c6c 4d61      map_1.fullMa
-00017d10: 702e 7368 6170 652c 0a20 2020 2020 2020  p.shape,.       
-00017d20: 2020 2020 2020 2020 2031 362c 0a20 2020           16,.   
-00017d30: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-00017d40: 6d70 6c65 7831 3238 272c 0a20 2020 2020  mplex128',.     
-00017d50: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00017d60: 2020 2020 2023 2066 6674 2070 6c61 6e6e       # fft plann
-00017d70: 696e 672c 2073 6574 2070 6c61 6e6e 696e  ing, set plannin
-00017d80: 675f 7469 6d65 6c69 6d69 7420 6f72 2066  g_timelimit or f
-00017d90: 6c61 6773 2074 6f20 6d61 6b65 2069 7420  lags to make it 
-00017da0: 6661 7374 6572 0a20 2020 2020 2020 2020  faster.         
-00017db0: 2020 2066 6674 203d 2070 7966 6674 772e     fft = pyfftw.
-00017dc0: 4646 5457 280a 2020 2020 2020 2020 2020  FFTW(.          
-00017dd0: 2020 2020 2020 696e 7075 7461 312c 0a20        inputa1,. 
-00017de0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00017df0: 7574 7075 7461 312c 0a20 2020 2020 2020  utputa1,.       
-00017e00: 2020 2020 2020 2020 2064 6972 6563 7469           directi
-00017e10: 6f6e 3d27 4646 5457 5f46 4f52 5741 5244  on='FFTW_FORWARD
-00017e20: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
-00017e30: 2020 2061 7865 733d 2830 2c20 312c 2032     axes=(0, 1, 2
-00017e40: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-00017e50: 2020 2066 6c61 6773 3d5b 2746 4654 575f     flags=['FFTW_
-00017e60: 4553 5449 4d41 5445 275d 2c0a 2020 2020  ESTIMATE'],.    
-00017e70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00017e80: 2020 2020 2020 696e 7075 7461 315b 3a2c        inputa1[:,
-00017e90: 203a 2c20 3a5d 203d 206d 6170 5f31 2e66   :, :] = map_1.f
-00017ea0: 756c 6c4d 6170 5b3a 2c20 3a2c 203a 5d0a  ullMap[:, :, :].
-00017eb0: 2020 2020 2020 2020 2020 2020 6666 7428              fft(
-00017ec0: 290a 2020 2020 2020 2020 2020 2020 6674  ).            ft
-00017ed0: 3120 3d20 4d61 7028 0a20 2020 2020 2020  1 = Map(.       
-00017ee0: 2020 2020 2020 2020 2066 6674 7368 6966           fftshif
-00017ef0: 7428 6f75 7470 7574 6131 292c 0a20 2020  t(outputa1),.   
-00017f00: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00017f10: 5f31 2e6f 7269 6769 6e2c 0a20 2020 2020  _1.origin,.     
-00017f20: 2020 2020 2020 2020 2020 206d 6170 5f31             map_1
-00017f30: 2e61 7069 782c 0a20 2020 2020 2020 2020  .apix,.         
-00017f40: 2020 2020 2020 206d 6170 5f31 2e66 696c         map_1.fil
-00017f50: 656e 616d 652c 0a20 2020 2020 2020 2020  ename,.         
-00017f60: 2020 2020 2020 206d 6170 5f31 2e68 6561         map_1.hea
-00017f70: 6465 725b 3a5d 2c0a 2020 2020 2020 2020  der[:],.        
-00017f80: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
-00017f90: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00017fa0: 2020 2020 2020 2020 2020 2020 2320 7573              # us
-00017fb0: 6520 6e75 6d70 7920 6666 7420 696e 7374  e numpy fft inst
-00017fc0: 6561 640a 2020 2020 2020 2020 2020 2020  ead.            
-00017fd0: 6674 3120 3d20 6d61 705f 312e 666f 7572  ft1 = map_1.four
-00017fe0: 6965 725f 7472 616e 7366 6f72 6d28 290a  ier_transform().
-00017ff0: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
-00018000: 2020 2020 2020 2020 2069 6620 7079 6666           if pyff
-00018010: 7477 5f66 6c61 6720 3d3d 2030 3a0a 2020  tw_flag == 0:.  
-00018020: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-00018030: 6973 6520 496d 706f 7274 4572 726f 720a  ise ImportError.
-00018040: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00018050: 7461 3220 3d20 7079 6666 7477 2e6e 5f62  ta2 = pyfftw.n_b
-00018060: 7974 655f 616c 6967 6e5f 656d 7074 7928  yte_align_empty(
-00018070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018080: 206d 6170 5f32 2e66 756c 6c4d 6170 2e73   map_2.fullMap.s
-00018090: 6861 7065 2c0a 2020 2020 2020 2020 2020  hape,.          
-000180a0: 2020 2020 2020 3136 2c0a 2020 2020 2020        16,.      
-000180b0: 2020 2020 2020 2020 2020 2763 6f6d 706c            'compl
-000180c0: 6578 3132 3827 2c0a 2020 2020 2020 2020  ex128',.        
-000180d0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-000180e0: 2020 6f75 7470 7574 6132 203d 2070 7966    outputa2 = pyf
-000180f0: 6674 772e 6e5f 6279 7465 5f61 6c69 676e  ftw.n_byte_align
-00018100: 5f65 6d70 7479 280a 2020 2020 2020 2020  _empty(.        
-00018110: 2020 2020 2020 2020 6d61 705f 322e 6675          map_2.fu
-00018120: 6c6c 4d61 702e 7368 6170 652c 0a20 2020  llMap.shape,.   
-00018130: 2020 2020 2020 2020 2020 2020 2031 362c               16,
-00018140: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018150: 2027 636f 6d70 6c65 7831 3238 272c 0a20   'complex128',. 
-00018160: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00018170: 2020 2020 2020 2020 2066 6674 203d 2070           fft = p
-00018180: 7966 6674 772e 4646 5457 280a 2020 2020  yfftw.FFTW(.    
-00018190: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-000181a0: 7461 322c 0a20 2020 2020 2020 2020 2020  ta2,.           
-000181b0: 2020 2020 206f 7574 7075 7461 322c 0a20       outputa2,. 
-000181c0: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-000181d0: 6972 6563 7469 6f6e 3d27 4646 5457 5f46  irection='FFTW_F
-000181e0: 4f52 5741 5244 272c 0a20 2020 2020 2020  ORWARD',.       
-000181f0: 2020 2020 2020 2020 2061 7865 733d 2830           axes=(0
-00018200: 2c20 312c 2032 292c 0a20 2020 2020 2020  , 1, 2),.       
-00018210: 2020 2020 2020 2020 2066 6c61 6773 3d5b           flags=[
-00018220: 2746 4654 575f 4553 5449 4d41 5445 275d  'FFTW_ESTIMATE']
-00018230: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00018240: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00018250: 7461 325b 3a2c 203a 2c20 3a5d 203d 206d  ta2[:, :, :] = m
-00018260: 6170 5f32 2e66 756c 6c4d 6170 5b3a 2c20  ap_2.fullMap[:, 
-00018270: 3a2c 203a 5d0a 2020 2020 2020 2020 2020  :, :].          
-00018280: 2020 6666 7428 290a 2020 2020 2020 2020    fft().        
-00018290: 2020 2020 6674 3220 3d20 4d61 7028 0a20      ft2 = Map(. 
-000182a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000182b0: 6674 7368 6966 7428 6f75 7470 7574 6132  ftshift(outputa2
-000182c0: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-000182d0: 2020 206d 6170 5f32 2e6f 7269 6769 6e2c     map_2.origin,
-000182e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000182f0: 206d 6170 5f32 2e61 7069 782c 0a20 2020   map_2.apix,.   
-00018300: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00018310: 5f32 2e66 696c 656e 616d 652c 0a20 2020  _2.filename,.   
-00018320: 2020 2020 2020 2020 2020 2020 206d 6170               map
-00018330: 5f32 2e68 6561 6465 725b 3a5d 2c0a 2020  _2.header[:],.  
-00018340: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00018350: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
-00018360: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
-00018370: 2020 6674 3220 3d20 6d61 705f 322e 666f    ft2 = map_2.fo
-00018380: 7572 6965 725f 7472 616e 7366 6f72 6d28  urier_transform(
-00018390: 290a 2020 2020 2020 2020 2320 6c6f 7720  ).        # low 
-000183a0: 7061 7373 2066 696c 7465 7220 6265 666f  pass filter befo
-000183b0: 7265 2073 6361 6c69 6e67 0a20 2020 2020  re scaling.     
-000183c0: 2020 2069 6620 7265 736f 2069 7320 6e6f     if reso is no
-000183d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000183e0: 2020 2020 6375 746f 6666 3120 3d20 6d61      cutoff1 = ma
-000183f0: 705f 312e 6170 6978 202f 2066 6c6f 6174  p_1.apix / float
-00018400: 2872 6573 6f29 0a20 2020 2020 2020 2020  (reso).         
-00018410: 2020 2063 7574 6f66 6632 203d 206d 6170     cutoff2 = map
-00018420: 5f32 2e61 7069 7820 2f20 666c 6f61 7428  _2.apix / float(
-00018430: 7265 736f 290a 2020 2020 2020 2020 2020  reso).          
-00018440: 2020 6966 206c 7066 696c 7462 2061 6e64    if lpfiltb and
-00018450: 206e 6f74 206c 7066 696c 7461 3a0a 2020   not lpfilta:.  
-00018460: 2020 2020 2020 2020 2020 2020 2020 6674                ft
-00018470: 312e 5f74 616e 685f 6c6f 7770 6173 7328  1._tanh_lowpass(
-00018480: 6375 746f 6666 312c 2066 616c 6c3d 302e  cutoff1, fall=0.
-00018490: 322c 2066 746d 6170 3d54 7275 6529 0a20  2, ftmap=True). 
-000184a0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-000184b0: 7432 2e5f 7461 6e68 5f6c 6f77 7061 7373  t2._tanh_lowpass
-000184c0: 2863 7574 6f66 6632 2c20 6661 6c6c 3d30  (cutoff2, fall=0
-000184d0: 2e32 2c20 6674 6d61 703d 5472 7565 290a  .2, ftmap=True).
-000184e0: 2020 2020 2020 2020 2320 7369 7a65 3120          # size1 
-000184f0: 3d20 6d61 7828 6d61 705f 312e 785f 7369  = max(map_1.x_si
-00018500: 7a65 2829 2c6d 6170 5f31 2e79 5f73 697a  ze(),map_1.y_siz
-00018510: 6528 292c 6d61 705f 312e 7a5f 7369 7a65  e(),map_1.z_size
-00018520: 2829 290a 2020 2020 2020 2020 6469 7374  ()).        dist
-00018530: 3120 3d20 6d61 705f 312e 5f6d 616b 655f  1 = map_1._make_
-00018540: 666f 7572 6965 725f 7368 656c 6c28 3129  fourier_shell(1)
-00018550: 2f6d 6170 5f31 2e61 7069 785b 305d 0a20  /map_1.apix[0]. 
-00018560: 2020 2020 2020 2023 2073 697a 6532 203d         # size2 =
-00018570: 206d 6178 286d 6170 5f32 2e78 5f73 697a   max(map_2.x_siz
-00018580: 6528 292c 206d 6170 5f32 2e79 5f73 697a  e(), map_2.y_siz
-00018590: 6528 292c 206d 6170 5f32 2e7a 5f73 697a  e(), map_2.z_siz
-000185a0: 6528 2929 0a20 2020 2020 2020 2064 6973  e()).        dis
-000185b0: 7432 203d 206d 6170 5f32 2e5f 6d61 6b65  t2 = map_2._make
-000185c0: 5f66 6f75 7269 6572 5f73 6865 6c6c 2831  _fourier_shell(1
-000185d0: 2920 2f20 6d61 705f 322e 6170 6978 5b30  ) / map_2.apix[0
-000185e0: 5d0a 2020 2020 2020 2020 6674 315f 6176  ].        ft1_av
-000185f0: 6720 3d20 5b5d 0a20 2020 2020 2020 2066  g = [].        f
-00018600: 7432 5f61 7667 203d 205b 5d0a 2020 2020  t2_avg = [].    
-00018610: 2020 2020 6674 315f 6176 675f 6e65 7720      ft1_avg_new 
-00018620: 3d20 5b5d 0a20 2020 2020 2020 206c 6672  = [].        lfr
-00018630: 6571 203d 205b 5d0a 2020 2020 2020 2020  eq = [].        
-00018640: 2320 7365 6c65 6374 206d 6178 2073 7061  # select max spa
-00018650: 7469 616c 2066 7265 7175 656e 6379 2074  tial frequency t
-00018660: 6f20 6974 6572 6174 6520 746f 2e20 6c6f  o iterate to. lo
-00018670: 7720 7265 736f 6c75 7469 6f6e 206d 6170  w resolution map
-00018680: 0a20 2020 2020 2020 206d 6178 6c65 7665  .        maxleve
-00018690: 6c20 3d20 302e 3520 2f20 6e70 2e6d 6178  l = 0.5 / np.max
-000186a0: 2828 6d61 705f 312e 6170 6978 5b30 5d2c  ((map_1.apix[0],
-000186b0: 206d 6170 5f32 2e61 7069 785b 305d 292c   map_2.apix[0]),
-000186c0: 2061 7869 733d 3029 0a20 2020 2020 2020   axis=0).       
-000186d0: 2023 206c 6f6f 7020 6f76 6572 2066 7265   # loop over fre
-000186e0: 7120 7368 656c 6c73 2c20 7368 656c 6c77  q shells, shellw
-000186f0: 6964 7468 3d30 2e30 3035 0a20 2020 2020  idth=0.005.     
-00018700: 2020 2023 2066 6f72 2078 2069 6e20 6172     # for x in ar
-00018710: 616e 6765 2830 2c6d 6178 6c65 7665 6c2b  ange(0,maxlevel+
-00018720: 7374 6570 2c73 7465 7029 3a0a 2020 2020  step,step):.    
-00018730: 2020 2020 6e63 203d 2030 0a20 2020 2020      nc = 0.     
-00018740: 2020 2078 203d 2030 2e30 0a20 2020 2020     x = 0.0.     
-00018750: 2020 2068 6967 686c 6576 656c 203d 2078     highlevel = x
-00018760: 202b 2073 7465 700a 2020 2020 2020 2020   + step.        
-00018770: 7768 696c 6520 2878 203c 206d 6178 6c65  while (x < maxle
-00018780: 7665 6c29 3a0a 2020 2020 2020 2020 2020  vel):.          
-00018790: 2020 2320 7072 696e 7420 782c 6869 6768    # print x,high
-000187a0: 6c65 7665 6c2c 206d 6178 6c65 7665 6c0a  level, maxlevel.
-000187b0: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-000187c0: 6469 6365 7320 6265 7477 6565 6e20 7570  dices between up
-000187d0: 7065 7220 616e 6420 6c6f 7765 7220 7368  per and lower sh
-000187e0: 656c 6c20 626f 756e 640a 2020 2020 2020  ell bound.      
-000187f0: 2020 2020 2020 6673 6865 6c6c 7331 203d        fshells1 =
-00018800: 2028 2864 6973 7431 203c 206d 696e 286d   ((dist1 < min(m
-00018810: 6178 6c65 7665 6c2c 2068 6967 686c 6576  axlevel, highlev
-00018820: 656c 2929 2026 2028 6469 7374 3120 3e3d  el)) & (dist1 >=
-00018830: 2078 2929 0a20 2020 2020 2020 2020 2020   x)).           
-00018840: 2023 2072 6164 6961 6c20 6176 6572 6167   # radial averag
-00018850: 650a 2020 2020 2020 2020 2020 2020 7368  e.            sh
-00018860: 656c 6c76 6563 3120 3d20 6674 312e 6675  ellvec1 = ft1.fu
-00018870: 6c6c 4d61 705b 6673 6865 6c6c 7331 5d0a  llMap[fshells1].
-00018880: 2020 2020 2020 2020 2020 2020 2320 696e              # in
-00018890: 6469 6365 7320 6265 7477 6565 6e20 7570  dices between up
-000188a0: 7065 7220 616e 6420 6c6f 7765 7220 7368  per and lower sh
-000188b0: 656c 6c20 626f 756e 640a 2020 2020 2020  ell bound.      
-000188c0: 2020 2020 2020 6673 6865 6c6c 7332 203d        fshells2 =
-000188d0: 2028 2864 6973 7432 203c 206d 696e 286d   ((dist2 < min(m
-000188e0: 6178 6c65 7665 6c2c 2068 6967 686c 6576  axlevel, highlev
-000188f0: 656c 2929 2026 2028 6469 7374 3220 3e3d  el)) & (dist2 >=
-00018900: 2078 2929 0a20 2020 2020 2020 2020 2020   x)).           
-00018910: 2023 2072 6164 6961 6c20 6176 6572 6167   # radial averag
-00018920: 650a 2020 2020 2020 2020 2020 2020 7368  e.            sh
-00018930: 656c 6c76 6563 3220 3d20 6674 322e 6675  ellvec2 = ft2.fu
-00018940: 6c6c 4d61 705b 6673 6865 6c6c 7332 5d0a  llMap[fshells2].
-00018950: 2020 2020 2020 2020 2020 2020 6162 7331              abs1
-00018960: 203d 2061 6273 2873 6865 6c6c 7665 6331   = abs(shellvec1
-00018970: 290a 2020 2020 2020 2020 2020 2020 6162  ).            ab
-00018980: 7332 203d 2061 6273 2873 6865 6c6c 7665  s2 = abs(shellve
-00018990: 6332 290a 2020 2020 2020 2020 2020 2020  c2).            
-000189a0: 6e73 3120 3d20 6c65 6e28 6e70 2e6e 6f6e  ns1 = len(np.non
-000189b0: 7a65 726f 2861 6273 3129 5b30 5d29 0a20  zero(abs1)[0]). 
-000189c0: 2020 2020 2020 2020 2020 206e 7332 203d             ns2 =
-000189d0: 206c 656e 286e 702e 6e6f 6e7a 6572 6f28   len(np.nonzero(
-000189e0: 6162 7332 295b 305d 290a 2020 2020 2020  abs2)[0]).      
-000189f0: 2020 2020 2020 6966 206e 7331 203c 2031        if ns1 < 1
-00018a00: 3020 6f72 206e 7332 203c 2031 303a 0a20  0 or ns2 < 10:. 
-00018a10: 2020 2020 2020 2020 2020 2020 2020 206e                 n
-00018a20: 6320 2b3d 2031 0a20 2020 2020 2020 2020  c += 1.         
-00018a30: 2020 2020 2020 2068 6967 686c 6576 656c         highlevel
-00018a40: 203d 206d 696e 286d 6178 6c65 7665 6c2c   = min(maxlevel,
-00018a50: 2078 202b 2028 6e63 202b 2031 2920 2a20   x + (nc + 1) * 
-00018a60: 7374 6570 290a 2020 2020 2020 2020 2020  step).          
-00018a70: 2020 2020 2020 7820 3d20 6d61 7828 302e        x = max(0.
-00018a80: 302c 2078 202d 206e 6320 2a20 7374 6570  0, x - nc * step
-00018a90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00018aa0: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018ab0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-00018ac0: 2020 2020 2020 2020 2020 2020 206e 6320               nc 
-00018ad0: 3d20 300a 2020 2020 2020 2020 2020 2020  = 0.            
-00018ae0: 6d66 7431 203d 206e 702e 6d65 616e 2861  mft1 = np.mean(a
-00018af0: 6273 3129 0a20 2020 2020 2020 2020 2020  bs1).           
-00018b00: 206d 6674 3220 3d20 6e70 2e6d 6561 6e28   mft2 = np.mean(
-00018b10: 6162 7332 290a 2020 2020 2020 2020 2020  abs2).          
-00018b20: 2020 6966 206d 6674 3120 3d3d 2030 2e30    if mft1 == 0.0
-00018b30: 2061 6e64 206d 6674 3220 3d3d 2030 2e30   and mft2 == 0.0
-00018b40: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00018b50: 2020 636f 6e74 696e 7565 0a20 2020 2020    continue.     
-00018b60: 2020 2020 2020 2023 2073 7120 6f66 2072         # sq of r
-00018b70: 6164 6961 6c20 6176 6720 616d 706c 6974  adial avg amplit
-00018b80: 7564 650a 2020 2020 2020 2020 2020 2020  ude.            
-00018b90: 6674 315f 6176 672e 6170 7065 6e64 286e  ft1_avg.append(n
-00018ba0: 702e 6c6f 6731 3028 6e70 2e6d 6561 6e28  p.log10(np.mean(
-00018bb0: 6e70 2e73 7175 6172 6528 6162 7331 2929  np.square(abs1))
-00018bc0: 2929 0a20 2020 2020 2020 2020 2020 2066  )).            f
-00018bd0: 7432 5f61 7667 2e61 7070 656e 6428 6e70  t2_avg.append(np
-00018be0: 2e6c 6f67 3130 286e 702e 6d65 616e 286e  .log10(np.mean(n
-00018bf0: 702e 7371 7561 7265 2861 6273 3229 2929  p.square(abs2)))
-00018c00: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
-00018c10: 2073 6361 6c65 2074 6f20 616d 706c 6974   scale to amplit
-00018c20: 7564 6573 206f 6620 7468 6520 7265 6620  udes of the ref 
-00018c30: 6d61 700a 2020 2020 2020 2020 2020 2020  map.            
-00018c40: 6966 2072 6566 3a0a 2020 2020 2020 2020  if ref:.        
-00018c50: 2020 2020 2020 2020 6966 206d 6674 3120          if mft1 
-00018c60: 3d3d 2030 2e30 3a0a 2020 2020 2020 2020  == 0.0:.        
-00018c70: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00018c80: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00018c90: 2020 2020 2066 7431 2e66 756c 6c4d 6170       ft1.fullMap
-00018ca0: 5b66 7368 656c 6c73 315d 203d 2073 6865  [fshells1] = she
-00018cb0: 6c6c 7665 6331 202a 2028 6d66 7432 202f  llvec1 * (mft2 /
-00018cc0: 206d 6674 3129 0a20 2020 2020 2020 2020   mft1).         
-00018cd0: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-00018ce0: 2020 2020 2020 2020 2023 2072 6570 6c61           # repla
-00018cf0: 6365 2077 6974 6820 6176 6720 616d 706c  ce with avg ampl
-00018d00: 6974 7564 6573 2066 6f72 2074 6865 2074  itudes for the t
-00018d10: 776f 206d 6170 730a 2020 2020 2020 2020  wo maps.        
-00018d20: 2020 2020 2020 2020 6674 312e 6675 6c6c          ft1.full
-00018d30: 4d61 705b 6673 6865 6c6c 7331 5d20 3d20  Map[fshells1] = 
-00018d40: 7368 656c 6c76 6563 3120 2a20 286d 6674  shellvec1 * (mft
-00018d50: 3220 2b20 6d66 7431 2920 2f20 2832 202a  2 + mft1) / (2 *
-00018d60: 206d 6674 3129 0a20 2020 2020 2020 2020   mft1).         
-00018d70: 2020 2020 2020 2066 7432 2e66 756c 6c4d         ft2.fullM
-00018d80: 6170 5b66 7368 656c 6c73 325d 203d 2073  ap[fshells2] = s
-00018d90: 6865 6c6c 7665 6332 202a 2028 6d66 7432  hellvec2 * (mft2
-00018da0: 202b 206d 6674 3129 202f 2028 3220 2a20   + mft1) / (2 * 
-00018db0: 6d66 7432 290a 0a20 2020 2020 2020 2020  mft2)..         
-00018dc0: 2020 2023 206e 6577 2072 6164 6961 6c20     # new radial 
-00018dd0: 6176 6572 6167 6520 2874 6f20 6368 6563  average (to chec
-00018de0: 6b29 0a20 2020 2020 2020 2020 2020 206d  k).            m
-00018df0: 6674 3120 3d20 6e70 2e6d 6561 6e28 6162  ft1 = np.mean(ab
-00018e00: 7328 6674 312e 6675 6c6c 4d61 705b 6673  s(ft1.fullMap[fs
-00018e10: 6865 6c6c 7331 5d29 290a 2020 2020 2020  hells1])).      
-00018e20: 2020 2020 2020 6674 315f 6176 675f 6e65        ft1_avg_ne
-00018e30: 772e 6170 7065 6e64 280a 2020 2020 2020  w.append(.      
-00018e40: 2020 2020 2020 2020 2020 6e70 2e6c 6f67            np.log
-00018e50: 3130 280a 2020 2020 2020 2020 2020 2020  10(.            
-00018e60: 2020 2020 2020 2020 6e70 2e6d 6561 6e28          np.mean(
-00018e70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018e80: 2020 2020 2020 2020 206e 702e 7371 7561           np.squa
-00018e90: 7265 2861 6273 2866 7431 2e66 756c 6c4d  re(abs(ft1.fullM
-00018ea0: 6170 5b66 7368 656c 6c73 315d 2929 0a20  ap[fshells1])). 
-00018eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ec0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00018ed0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00018ee0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00018ef0: 206c 6672 6571 2e61 7070 656e 6428 6869   lfreq.append(hi
-00018f00: 6768 6c65 7665 6c29 0a0a 2020 2020 2020  ghlevel)..      
-00018f10: 2020 2020 2020 7361 6d70 6c69 6e67 5f66        sampling_f
-00018f20: 7271 203d 2068 6967 686c 6576 656c 0a0a  rq = highlevel..
-00018f30: 2020 2020 2020 2020 2020 2020 6375 746f              cuto
-00018f40: 6666 5f66 7265 7120 3d20 6d69 6e28 2831  ff_freq = min((1
-00018f50: 2e30 202f 2072 6573 6f29 202b 2030 2e32  .0 / reso) + 0.2
-00018f60: 352c 206d 6178 6c65 7665 6c29 0a0a 2020  5, maxlevel)..  
-00018f70: 2020 2020 2020 2020 2020 2320 7363 616c            # scal
-00018f80: 6520 7468 6520 7265 7374 2061 6e64 2062  e the rest and b
-00018f90: 7265 616b 2061 6674 6572 2072 656c 6576  reak after relev
-00018fa0: 616e 7420 6672 6571 7565 6e63 6965 730a  ant frequencies.
-00018fb0: 2020 2020 2020 2020 2020 2020 6966 2073              if s
-00018fc0: 616d 706c 696e 675f 6672 7120 3e20 6375  ampling_frq > cu
-00018fd0: 746f 6666 5f66 7265 713a 0a20 2020 2020  toff_freq:.     
-00018fe0: 2020 2020 2020 2020 2020 2066 7368 656c             fshel
-00018ff0: 6c73 3120 3d20 2864 6973 7431 203e 3d20  ls1 = (dist1 >= 
-00019000: 6869 6768 6c65 7665 6c29 0a20 2020 2020  highlevel).     
-00019010: 2020 2020 2020 2020 2020 2073 6865 6c6c             shell
-00019020: 7665 6331 203d 2066 7431 2e66 756c 6c4d  vec1 = ft1.fullM
-00019030: 6170 5b66 7368 656c 6c73 315d 0a20 2020  ap[fshells1].   
-00019040: 2020 2020 2020 2020 2020 2020 206d 6674               mft
-00019050: 3120 3d20 6e70 2e6d 6561 6e28 6162 7328  1 = np.mean(abs(
-00019060: 7368 656c 6c76 6563 3129 290a 2020 2020  shellvec1)).    
-00019070: 2020 2020 2020 2020 2020 2020 6673 6865              fshe
-00019080: 6c6c 7332 203d 2028 6469 7374 3220 3e3d  lls2 = (dist2 >=
-00019090: 2068 6967 686c 6576 656c 290a 2020 2020   highlevel).    
-000190a0: 2020 2020 2020 2020 2020 2020 7368 656c              shel
-000190b0: 6c76 6563 3220 3d20 6674 322e 6675 6c6c  lvec2 = ft2.full
-000190c0: 4d61 705b 6673 6865 6c6c 7332 5d0a 2020  Map[fshells2].  
-000190d0: 2020 2020 2020 2020 2020 2020 2020 6d66                mf
-000190e0: 7432 203d 206e 702e 6d65 616e 2861 6273  t2 = np.mean(abs
-000190f0: 2873 6865 6c6c 7665 6332 2929 0a20 2020  (shellvec2)).   
-00019100: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00019110: 6d66 7431 203d 3d20 302e 3020 616e 6420  mft1 == 0.0 and 
-00019120: 6d66 7432 203d 3d20 302e 303a 0a20 2020  mft2 == 0.0:.   
-00019130: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019140: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
-00019150: 2020 2020 2020 2066 7431 5f61 7667 2e61         ft1_avg.a
-00019160: 7070 656e 6428 6e70 2e6c 6f67 3130 286e  ppend(np.log10(n
-00019170: 702e 6d65 616e 286e 702e 7371 7561 7265  p.mean(np.square
-00019180: 2861 6273 2873 6865 6c6c 7665 6331 2929  (abs(shellvec1))
-00019190: 2929 290a 2020 2020 2020 2020 2020 2020  ))).            
-000191a0: 2020 2020 6674 325f 6176 672e 6170 7065      ft2_avg.appe
-000191b0: 6e64 286e 702e 6c6f 6731 3028 6e70 2e6d  nd(np.log10(np.m
-000191c0: 6561 6e28 6e70 2e73 7175 6172 6528 6162  ean(np.square(ab
-000191d0: 7328 7368 656c 6c76 6563 3229 2929 2929  s(shellvec2)))))
-000191e0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-000191f0: 2020 6966 2072 6566 3a0a 2020 2020 2020    if ref:.      
-00019200: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00019210: 206d 6674 3120 3d3d 2030 2e30 3a0a 2020   mft1 == 0.0:.  
+00016f40: 2061 7272 6179 5f69 6e64 6963 6573 203d   array_indices =
+00016f50: 206e 702e 6172 7261 7928 7363 5f69 6e64   np.array(sc_ind
+00016f60: 6963 6573 290a 2020 2020 2020 2020 2020  ices).          
+00016f70: 2020 2020 2020 2020 2020 696e 645f 6172            ind_ar
+00016f80: 7278 797a 203d 206e 702e 7472 616e 7370  rxyz = np.transp
+00016f90: 6f73 6528 6172 7261 795f 696e 6469 6365  ose(array_indice
+00016fa0: 7329 0a0a 2020 2020 2020 2020 2020 2020  s)..            
+00016fb0: 2020 2020 2020 2020 696e 645f 6172 727a          ind_arrz
+00016fc0: 7978 203d 2028 696e 645f 6172 7278 797a  yx = (ind_arrxyz
+00016fd0: 5b32 5d2c 2069 6e64 5f61 7272 7879 7a5b  [2], ind_arrxyz[
+00016fe0: 315d 2c20 696e 645f 6172 7278 797a 5b30  1], ind_arrxyz[0
+00016ff0: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
+00017000: 2020 2020 2020 2073 6363 6320 3d20 7365         sccc = se
+00017010: 6c66 2e63 616c 635f 6d6f 6328 696e 645f  lf.calc_moc(ind_
+00017020: 6172 727a 7978 2c20 7369 6d5f 6d61 702c  arrzyx, sim_map,
+00017030: 206d 6170 5f74 6172 6765 7429 0a20 2020   map_target).   
+00017040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017050: 2064 6963 745f 7266 5f73 635b 725f 6374   dict_rf_sc[r_ct
+00017060: 5d20 3d20 7363 6363 0a20 2020 2020 2020  ] = sccc.       
+00017070: 2020 2020 2020 2020 2020 2020 2023 2073               # s
+00017080: 6176 6520 7363 6f72 6573 0a20 2020 2020  ave scores.     
+00017090: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000170a0: 6f72 2072 6573 2069 6e20 7265 735f 6c69  or res in res_li
+000170b0: 7374 3a0a 2020 2020 2020 2020 2020 2020  st:.            
+000170c0: 2020 2020 2020 2020 2020 2020 6469 6374              dict
+000170d0: 5f72 6573 5f73 636f 7265 735b 7265 735d  _res_scores[res]
+000170e0: 203d 2073 6363 630a 2020 2020 2020 2020   = sccc.        
+000170f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017100: 6c69 7374 5f73 6363 632e 6170 7065 6e64  list_sccc.append
+00017110: 2873 6363 6329 0a20 2020 2020 2020 2020  (sccc).         
+00017120: 2020 2069 6e70 2e63 6c6f 7365 2829 0a20     inp.close(). 
+00017130: 2020 2020 2020 2023 2066 6f72 2072 6573         # for res
+00017140: 6964 7565 7320 6e6f 7420 696e 2072 6967  idues not in rig
+00017150: 6964 2062 6f64 6965 733a 2063 6f6e 7369  id bodies: consi
+00017160: 6465 7220 7065 6e74 6170 6570 7469 6465  der pentapeptide
+00017170: 730a 2020 2020 2020 2020 666f 7220 7265  s.        for re
+00017180: 7320 696e 2064 6963 745f 7265 735f 696e  s in dict_res_in
+00017190: 6469 6365 733a 0a20 2020 2020 2020 2020  dices:.         
+000171a0: 2020 2069 6620 7265 7320 696e 2064 6963     if res in dic
+000171b0: 745f 7265 735f 7363 6f72 6573 3a0a 2020  t_res_scores:.  
+000171c0: 2020 2020 2020 2020 2020 2020 2020 696e                in
+000171d0: 6469 6365 7320 3d20 6469 6374 5f72 6573  dices = dict_res
+000171e0: 5f69 6e64 6963 6573 5b72 6573 5d5b 3a5d  _indices[res][:]
+000171f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017200: 2023 2063 6f6e 7369 6465 7220 7265 7369   # consider resi
+00017210: 6475 6573 206f 6e20 626f 7468 2073 6964  dues on both sid
+00017220: 6573 2e20 4e4f 5445 3a20 776f 6e74 2077  es. NOTE: wont w
+00017230: 6f72 6b20 666f 720a 2020 2020 2020 2020  ork for.        
+00017240: 2020 2020 2020 2020 2320 696e 7365 7274          # insert
+00017250: 696f 6e20 636f 6465 7321 0a20 2020 2020  ion codes!.     
+00017260: 2020 2020 2020 2020 2020 2023 206e 6565             # nee
+00017270: 6420 746f 2072 6577 6974 6520 7265 7320  d to rewite res 
+00017280: 6e75 6d62 6572 7320 746f 2061 766f 6964  numbers to avoid
+00017290: 2069 6e73 6572 7469 6f6e 2063 6f64 6573   insertion codes
+000172a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000172b0: 2066 6f72 2069 6920 696e 2072 616e 6765   for ii in range
+000172c0: 2831 2c20 696e 7428 726f 756e 6428 2877  (1, int(round((w
+000172d0: 696e 202b 2031 2920 2f20 3229 2929 3a0a  in + 1) / 2))):.
+000172e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000172f0: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+00017300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017310: 2069 6e64 6963 6573 2e65 7874 656e 6428   indices.extend(
+00017320: 6469 6374 5f72 6573 5f69 6e64 6963 6573  dict_res_indices
+00017330: 5b72 6573 202d 2069 695d 290a 2020 2020  [res - ii]).    
+00017340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017350: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
+00017360: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00017370: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
+00017380: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00017390: 6f72 2069 6920 696e 2072 616e 6765 2831  or ii in range(1
+000173a0: 2c20 696e 7428 726f 756e 6428 2877 696e  , int(round((win
+000173b0: 202b 2031 2920 2f20 3229 2929 3a0a 2020   + 1) / 2))):.  
+000173c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000173d0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+000173e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000173f0: 6e64 6963 6573 2e65 7874 656e 6428 6469  ndices.extend(di
+00017400: 6374 5f72 6573 5f69 6e64 6963 6573 5b72  ct_res_indices[r
+00017410: 6573 202b 2069 695d 290a 2020 2020 2020  es + ii]).      
+00017420: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00017430: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
+00017440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017450: 2020 2020 2020 2020 7061 7373 0a0a 2020          pass..  
+00017460: 2020 2020 2020 2020 2020 2020 2020 746d                tm
+00017470: 706c 6973 7420 3d20 696e 6469 6365 735b  plist = indices[
+00017480: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+00017490: 2020 2073 6574 6c69 7374 203d 2073 6574     setlist = set
+000174a0: 2874 6d70 6c69 7374 290a 2020 2020 2020  (tmplist).      
+000174b0: 2020 2020 2020 2020 2020 696e 6469 6365            indice
+000174c0: 7320 3d20 6c69 7374 2873 6574 6c69 7374  s = list(setlist
+000174d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000174e0: 2020 7363 5f69 6e64 6963 6573 203d 205b    sc_indices = [
+000174f0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00017500: 2020 666f 7220 6969 2069 6e20 696e 6469    for ii in indi
+00017510: 6365 733a 0a20 2020 2020 2020 2020 2020  ces:.           
+00017520: 2020 2020 2020 2020 2073 635f 696e 6469           sc_indi
+00017530: 6365 732e 6170 7065 6e64 2869 6e64 695b  ces.append(indi[
+00017540: 6969 5d29 0a20 2020 2020 2020 2020 2020  ii]).           
+00017550: 2020 2020 2069 6620 6c65 6e28 696e 6469       if len(indi
+00017560: 6365 7329 203d 3d20 303a 0a20 2020 2020  ces) == 0:.     
+00017570: 2020 2020 2020 2020 2020 2020 2020 2064                 d
+00017580: 6963 745f 7265 735f 7363 6f72 6573 5b72  ict_res_scores[r
+00017590: 6573 5d20 3d20 302e 300a 2020 2020 2020  es] = 0.0.      
+000175a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000175b0: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+000175c0: 2020 2020 2020 2061 7272 6179 5f69 6e64         array_ind
+000175d0: 6963 6573 203d 206e 702e 6172 7261 7928  ices = np.array(
+000175e0: 7363 5f69 6e64 6963 6573 290a 2020 2020  sc_indices).    
+000175f0: 2020 2020 2020 2020 2020 2020 696e 645f              ind_
+00017600: 6172 7278 797a 203d 206e 702e 7472 616e  arrxyz = np.tran
+00017610: 7370 6f73 6528 6172 7261 795f 696e 6469  spose(array_indi
+00017620: 6365 7329 0a20 2020 2020 2020 2020 2020  ces).           
+00017630: 2020 2020 2069 6e64 5f61 7272 7a79 7820       ind_arrzyx 
+00017640: 3d20 2869 6e64 5f61 7272 7879 7a5b 325d  = (ind_arrxyz[2]
+00017650: 2c20 696e 645f 6172 7278 797a 5b31 5d2c  , ind_arrxyz[1],
+00017660: 2069 6e64 5f61 7272 7879 7a5b 305d 290a   ind_arrxyz[0]).
+00017670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017680: 7363 6363 203d 2073 656c 662e 6361 6c63  sccc = self.calc
+00017690: 5f6d 6f63 2869 6e64 5f61 7272 7a79 782c  _moc(ind_arrzyx,
+000176a0: 2073 696d 5f6d 6170 2c20 6d61 705f 7461   sim_map, map_ta
+000176b0: 7267 6574 290a 2020 2020 2020 2020 2020  rget).          
+000176c0: 2020 2020 2020 6469 6374 5f72 6573 5f73        dict_res_s
+000176d0: 636f 7265 735b 7265 735d 203d 2073 6363  cores[res] = scc
+000176e0: 630a 2020 2020 2020 2020 2020 2020 2020  c.              
+000176f0: 2020 6c69 7374 5f73 6363 632e 6170 7065    list_sccc.appe
+00017700: 6e64 2873 6363 6329 0a20 2020 2020 2020  nd(sccc).       
+00017710: 2072 6574 7572 6e20 6469 6374 5f72 6573   return dict_res
+00017720: 5f73 636f 7265 730a 0a20 2020 2064 6566  _scores..    def
+00017730: 205f 6765 745f 7368 656c 6c28 7365 6c66   _get_shell(self
+00017740: 2c20 6469 7374 312c 206d 6178 6c65 7665  , dist1, maxleve
+00017750: 6c2c 2073 7465 702c 2078 293a 0a20 2020  l, step, x):.   
+00017760: 2020 2020 2023 2069 6e64 6963 6573 2062       # indices b
+00017770: 6574 7765 656e 2075 7070 6572 2061 6e64  etween upper and
+00017780: 206c 6f77 6572 2073 6865 6c6c 2062 6f75   lower shell bou
+00017790: 6e64 0a20 2020 2020 2020 2072 6574 7572  nd.        retur
+000177a0: 6e20 6e70 2e61 7267 7768 6572 6528 2864  n np.argwhere((d
+000177b0: 6973 7431 203c 206d 696e 286d 6178 6c65  ist1 < min(maxle
+000177c0: 7665 6c2c 2078 202b 2073 7465 7029 2920  vel, x + step)) 
+000177d0: 2620 2864 6973 7431 203e 3d20 7829 290a  & (dist1 >= x)).
+000177e0: 0a20 2020 2020 2020 2023 206d 6174 6368  .        # match
+000177f0: 2070 6f77 6572 2073 7065 6374 7261 2066   power spectra f
+00017800: 6f72 2074 776f 206d 6170 730a 2020 2020  or two maps.    
+00017810: 6465 6620 5f61 6d70 6c69 7475 6465 5f6d  def _amplitude_m
+00017820: 6174 6368 280a 2020 2020 2020 2020 2020  atch(.          
+00017830: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00017840: 2020 2020 6d61 705f 312c 0a20 2020 2020      map_1,.     
+00017850: 2020 2020 2020 206d 6170 5f32 2c0a 2020         map_2,.  
+00017860: 2020 2020 2020 2020 2020 7368 656c 6c6d            shellm
+00017870: 696e 2c0a 2020 2020 2020 2020 2020 2020  in,.            
+00017880: 7368 656c 6c6d 6178 2c0a 2020 2020 2020  shellmax,.      
+00017890: 2020 2020 2020 7374 6570 3d30 2e30 3035        step=0.005
+000178a0: 2c0a 2020 2020 2020 2020 2020 2020 6331  ,.            c1
+000178b0: 3d30 2c0a 2020 2020 2020 2020 2020 2020  =0,.            
+000178c0: 6332 3d30 2c0a 2020 2020 2020 2020 2020  c2=0,.          
+000178d0: 2020 7265 736f 3d4e 6f6e 652c 0a20 2020    reso=None,.   
+000178e0: 2020 2020 2020 2020 206c 7066 696c 7462           lpfiltb
+000178f0: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
+00017900: 2020 2020 6c70 6669 6c74 613d 4661 6c73      lpfilta=Fals
+00017910: 652c 0a20 2020 2020 2020 2020 2020 2072  e,.            r
+00017920: 6566 3d46 616c 7365 2c0a 2020 2020 293a  ef=False,.    ):
+00017930: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00017940: 2020 2020 2053 6361 6c65 2061 6d70 6c69       Scale ampli
+00017950: 7475 6465 7320 746f 2074 6865 2061 7665  tudes to the ave
+00017960: 7261 6765 2069 6e20 6561 6368 2072 6573  rage in each res
+00017970: 6f6c 7574 696f 6e73 2073 6865 6c6c 0a0a  olutions shell..
+00017980: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
+00017990: 733a 0a20 2020 2020 2020 2020 2020 202a  s:.            *
+000179a0: 7374 6570 203a 2073 6865 6c6c 2077 6964  step : shell wid
+000179b0: 7468 2028 312f 4129 0a20 2020 2020 2020  th (1/A).       
+000179c0: 2022 2222 0a20 2020 2020 2020 2023 2066   """.        # f
+000179d0: 6f75 7269 6572 2074 7261 6e73 666f 726d  ourier transform
+000179e0: 3a20 7573 6520 7079 6666 7477 2069 6620  : use pyfftw if 
+000179f0: 6176 6169 6c61 626c 650a 2020 2020 2020  available.      
+00017a00: 2020 7079 6666 7477 5f66 6c61 6720 3d20    pyfftw_flag = 
+00017a10: 310a 2020 2020 2020 2020 7472 793a 0a20  1.        try:. 
+00017a20: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00017a30: 7420 7079 6666 7477 0a20 2020 2020 2020  t pyfftw.       
+00017a40: 2065 7863 6570 7420 496d 706f 7274 4572   except ImportEr
+00017a50: 726f 723a 0a20 2020 2020 2020 2020 2020  ror:.           
+00017a60: 2070 7966 6674 775f 666c 6167 203d 2030   pyfftw_flag = 0
+00017a70: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
+00017a80: 2020 2020 2020 2020 2020 6966 2070 7966            if pyf
+00017a90: 6674 775f 666c 6167 203d 3d20 303a 0a20  ftw_flag == 0:. 
+00017aa0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00017ab0: 6169 7365 2049 6d70 6f72 7445 7272 6f72  aise ImportError
+00017ac0: 0a20 2020 2020 2020 2020 2020 2069 6e70  .            inp
+00017ad0: 7574 6131 203d 2070 7966 6674 772e 6e5f  uta1 = pyfftw.n_
+00017ae0: 6279 7465 5f61 6c69 676e 5f65 6d70 7479  byte_align_empty
+00017af0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+00017b00: 2020 6d61 705f 312e 6675 6c6c 4d61 702e    map_1.fullMap.
+00017b10: 7368 6170 652c 0a20 2020 2020 2020 2020  shape,.         
+00017b20: 2020 2020 2020 2031 362c 0a20 2020 2020         16,.     
+00017b30: 2020 2020 2020 2020 2020 2027 636f 6d70             'comp
+00017b40: 6c65 7831 3238 272c 0a20 2020 2020 2020  lex128',.       
+00017b50: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00017b60: 2020 206f 7574 7075 7461 3120 3d20 7079     outputa1 = py
+00017b70: 6666 7477 2e6e 5f62 7974 655f 616c 6967  fftw.n_byte_alig
+00017b80: 6e5f 656d 7074 7928 0a20 2020 2020 2020  n_empty(.       
+00017b90: 2020 2020 2020 2020 206d 6170 5f31 2e66           map_1.f
+00017ba0: 756c 6c4d 6170 2e73 6861 7065 2c0a 2020  ullMap.shape,.  
+00017bb0: 2020 2020 2020 2020 2020 2020 2020 3136                16
+00017bc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017bd0: 2020 2763 6f6d 706c 6578 3132 3827 2c0a    'complex128',.
+00017be0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00017bf0: 2020 2020 2020 2020 2020 2320 6666 7420            # fft 
+00017c00: 706c 616e 6e69 6e67 2c20 7365 7420 706c  planning, set pl
+00017c10: 616e 6e69 6e67 5f74 696d 656c 696d 6974  anning_timelimit
+00017c20: 206f 7220 666c 6167 7320 746f 206d 616b   or flags to mak
+00017c30: 6520 6974 2066 6173 7465 720a 2020 2020  e it faster.    
+00017c40: 2020 2020 2020 2020 6666 7420 3d20 7079          fft = py
+00017c50: 6666 7477 2e46 4654 5728 0a20 2020 2020  fftw.FFTW(.     
+00017c60: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00017c70: 6131 2c0a 2020 2020 2020 2020 2020 2020  a1,.            
+00017c80: 2020 2020 6f75 7470 7574 6131 2c0a 2020      outputa1,.  
+00017c90: 2020 2020 2020 2020 2020 2020 2020 6469                di
+00017ca0: 7265 6374 696f 6e3d 2746 4654 575f 464f  rection='FFTW_FO
+00017cb0: 5257 4152 4427 2c0a 2020 2020 2020 2020  RWARD',.        
+00017cc0: 2020 2020 2020 2020 6178 6573 3d28 302c          axes=(0,
+00017cd0: 2031 2c20 3229 2c0a 2020 2020 2020 2020   1, 2),.        
+00017ce0: 2020 2020 2020 2020 666c 6167 733d 5b27          flags=['
+00017cf0: 4646 5457 5f45 5354 494d 4154 4527 5d2c  FFTW_ESTIMATE'],
+00017d00: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00017d10: 2020 2020 2020 2020 2020 2069 6e70 7574             input
+00017d20: 6131 5b3a 2c20 3a2c 203a 5d20 3d20 6d61  a1[:, :, :] = ma
+00017d30: 705f 312e 6675 6c6c 4d61 705b 3a2c 203a  p_1.fullMap[:, :
+00017d40: 2c20 3a5d 0a20 2020 2020 2020 2020 2020  , :].           
+00017d50: 2066 6674 2829 0a20 2020 2020 2020 2020   fft().         
+00017d60: 2020 2066 7431 203d 204d 6170 280a 2020     ft1 = Map(.  
+00017d70: 2020 2020 2020 2020 2020 2020 2020 6666                ff
+00017d80: 7473 6869 6674 286f 7574 7075 7461 3129  tshift(outputa1)
+00017d90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017da0: 2020 6d61 705f 312e 6f72 6967 696e 2c0a    map_1.origin,.
+00017db0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017dc0: 6d61 705f 312e 6170 6978 2c0a 2020 2020  map_1.apix,.    
+00017dd0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+00017de0: 312e 6669 6c65 6e61 6d65 2c0a 2020 2020  1.filename,.    
+00017df0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+00017e00: 312e 6865 6164 6572 5b3a 5d2c 0a20 2020  1.header[:],.   
+00017e10: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00017e20: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00017e30: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00017e40: 2023 2075 7365 206e 756d 7079 2066 6674   # use numpy fft
+00017e50: 2069 6e73 7465 6164 0a20 2020 2020 2020   instead.       
+00017e60: 2020 2020 2066 7431 203d 206d 6170 5f31       ft1 = map_1
+00017e70: 2e66 6f75 7269 6572 5f74 7261 6e73 666f  .fourier_transfo
+00017e80: 726d 2829 0a20 2020 2020 2020 2074 7279  rm().        try
+00017e90: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
+00017ea0: 2070 7966 6674 775f 666c 6167 203d 3d20   pyfftw_flag == 
+00017eb0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00017ec0: 2020 2072 6169 7365 2049 6d70 6f72 7445     raise ImportE
+00017ed0: 7272 6f72 0a20 2020 2020 2020 2020 2020  rror.           
+00017ee0: 2069 6e70 7574 6132 203d 2070 7966 6674   inputa2 = pyfft
+00017ef0: 772e 6e5f 6279 7465 5f61 6c69 676e 5f65  w.n_byte_align_e
+00017f00: 6d70 7479 280a 2020 2020 2020 2020 2020  mpty(.          
+00017f10: 2020 2020 2020 6d61 705f 322e 6675 6c6c        map_2.full
+00017f20: 4d61 702e 7368 6170 652c 0a20 2020 2020  Map.shape,.     
+00017f30: 2020 2020 2020 2020 2020 2031 362c 0a20             16,. 
+00017f40: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+00017f50: 636f 6d70 6c65 7831 3238 272c 0a20 2020  complex128',.   
+00017f60: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00017f70: 2020 2020 2020 206f 7574 7075 7461 3220         outputa2 
+00017f80: 3d20 7079 6666 7477 2e6e 5f62 7974 655f  = pyfftw.n_byte_
+00017f90: 616c 6967 6e5f 656d 7074 7928 0a20 2020  align_empty(.   
+00017fa0: 2020 2020 2020 2020 2020 2020 206d 6170               map
+00017fb0: 5f32 2e66 756c 6c4d 6170 2e73 6861 7065  _2.fullMap.shape
+00017fc0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00017fd0: 2020 3136 2c0a 2020 2020 2020 2020 2020    16,.          
+00017fe0: 2020 2020 2020 2763 6f6d 706c 6578 3132        'complex12
+00017ff0: 3827 2c0a 2020 2020 2020 2020 2020 2020  8',.            
+00018000: 290a 2020 2020 2020 2020 2020 2020 6666  ).            ff
+00018010: 7420 3d20 7079 6666 7477 2e46 4654 5728  t = pyfftw.FFTW(
+00018020: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018030: 2069 6e70 7574 6132 2c0a 2020 2020 2020   inputa2,.      
+00018040: 2020 2020 2020 2020 2020 6f75 7470 7574            output
+00018050: 6132 2c0a 2020 2020 2020 2020 2020 2020  a2,.            
+00018060: 2020 2020 6469 7265 6374 696f 6e3d 2746      direction='F
+00018070: 4654 575f 464f 5257 4152 4427 2c0a 2020  FTW_FORWARD',.  
+00018080: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00018090: 6573 3d28 302c 2031 2c20 3229 2c0a 2020  es=(0, 1, 2),.  
+000180a0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+000180b0: 6167 733d 5b27 4646 5457 5f45 5354 494d  ags=['FFTW_ESTIM
+000180c0: 4154 4527 5d2c 0a20 2020 2020 2020 2020  ATE'],.         
+000180d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000180e0: 2069 6e70 7574 6132 5b3a 2c20 3a2c 203a   inputa2[:, :, :
+000180f0: 5d20 3d20 6d61 705f 322e 6675 6c6c 4d61  ] = map_2.fullMa
+00018100: 705b 3a2c 203a 2c20 3a5d 0a20 2020 2020  p[:, :, :].     
+00018110: 2020 2020 2020 2066 6674 2829 0a20 2020         fft().   
+00018120: 2020 2020 2020 2020 2066 7432 203d 204d           ft2 = M
+00018130: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
+00018140: 2020 2020 6666 7473 6869 6674 286f 7574      fftshift(out
+00018150: 7075 7461 3229 2c0a 2020 2020 2020 2020  puta2),.        
+00018160: 2020 2020 2020 2020 6d61 705f 322e 6f72          map_2.or
+00018170: 6967 696e 2c0a 2020 2020 2020 2020 2020  igin,.          
+00018180: 2020 2020 2020 6d61 705f 322e 6170 6978        map_2.apix
+00018190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000181a0: 2020 6d61 705f 322e 6669 6c65 6e61 6d65    map_2.filename
+000181b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+000181c0: 2020 6d61 705f 322e 6865 6164 6572 5b3a    map_2.header[:
+000181d0: 5d2c 0a20 2020 2020 2020 2020 2020 2029  ],.            )
+000181e0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+000181f0: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
+00018200: 2020 2020 2020 2066 7432 203d 206d 6170         ft2 = map
+00018210: 5f32 2e66 6f75 7269 6572 5f74 7261 6e73  _2.fourier_trans
+00018220: 666f 726d 2829 0a20 2020 2020 2020 2023  form().        #
+00018230: 206c 6f77 2070 6173 7320 6669 6c74 6572   low pass filter
+00018240: 2062 6566 6f72 6520 7363 616c 696e 670a   before scaling.
+00018250: 2020 2020 2020 2020 6966 2072 6573 6f20          if reso 
+00018260: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00018270: 2020 2020 2020 2020 2063 7574 6f66 6631           cutoff1
+00018280: 203d 206d 6170 5f31 2e61 7069 7820 2f20   = map_1.apix / 
+00018290: 666c 6f61 7428 7265 736f 290a 2020 2020  float(reso).    
+000182a0: 2020 2020 2020 2020 6375 746f 6666 3220          cutoff2 
+000182b0: 3d20 6d61 705f 322e 6170 6978 202f 2066  = map_2.apix / f
+000182c0: 6c6f 6174 2872 6573 6f29 0a20 2020 2020  loat(reso).     
+000182d0: 2020 2020 2020 2069 6620 6c70 6669 6c74         if lpfilt
+000182e0: 6220 616e 6420 6e6f 7420 6c70 6669 6c74  b and not lpfilt
+000182f0: 613a 0a20 2020 2020 2020 2020 2020 2020  a:.             
+00018300: 2020 2066 7431 2e5f 7461 6e68 5f6c 6f77     ft1._tanh_low
+00018310: 7061 7373 2863 7574 6f66 6631 2c20 6661  pass(cutoff1, fa
+00018320: 6c6c 3d30 2e32 2c20 6674 6d61 703d 5472  ll=0.2, ftmap=Tr
+00018330: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+00018340: 2020 2020 6674 322e 5f74 616e 685f 6c6f      ft2._tanh_lo
+00018350: 7770 6173 7328 6375 746f 6666 322c 2066  wpass(cutoff2, f
+00018360: 616c 6c3d 302e 322c 2066 746d 6170 3d54  all=0.2, ftmap=T
+00018370: 7275 6529 0a20 2020 2020 2020 2023 2073  rue).        # s
+00018380: 697a 6531 203d 206d 6178 286d 6170 5f31  ize1 = max(map_1
+00018390: 2e78 5f73 697a 6528 292c 6d61 705f 312e  .x_size(),map_1.
+000183a0: 795f 7369 7a65 2829 2c6d 6170 5f31 2e7a  y_size(),map_1.z
+000183b0: 5f73 697a 6528 2929 0a20 2020 2020 2020  _size()).       
+000183c0: 2064 6973 7431 203d 206d 6170 5f31 2e5f   dist1 = map_1._
+000183d0: 6d61 6b65 5f66 6f75 7269 6572 5f73 6865  make_fourier_she
+000183e0: 6c6c 2831 292f 6d61 705f 312e 6170 6978  ll(1)/map_1.apix
+000183f0: 5b30 5d0a 2020 2020 2020 2020 2320 7369  [0].        # si
+00018400: 7a65 3220 3d20 6d61 7828 6d61 705f 322e  ze2 = max(map_2.
+00018410: 785f 7369 7a65 2829 2c20 6d61 705f 322e  x_size(), map_2.
+00018420: 795f 7369 7a65 2829 2c20 6d61 705f 322e  y_size(), map_2.
+00018430: 7a5f 7369 7a65 2829 290a 2020 2020 2020  z_size()).      
+00018440: 2020 6469 7374 3220 3d20 6d61 705f 322e    dist2 = map_2.
+00018450: 5f6d 616b 655f 666f 7572 6965 725f 7368  _make_fourier_sh
+00018460: 656c 6c28 3129 202f 206d 6170 5f32 2e61  ell(1) / map_2.a
+00018470: 7069 785b 305d 0a20 2020 2020 2020 2066  pix[0].        f
+00018480: 7431 5f61 7667 203d 205b 5d0a 2020 2020  t1_avg = [].    
+00018490: 2020 2020 6674 325f 6176 6720 3d20 5b5d      ft2_avg = []
+000184a0: 0a20 2020 2020 2020 2066 7431 5f61 7667  .        ft1_avg
+000184b0: 5f6e 6577 203d 205b 5d0a 2020 2020 2020  _new = [].      
+000184c0: 2020 6c66 7265 7120 3d20 5b5d 0a20 2020    lfreq = [].   
+000184d0: 2020 2020 2023 2073 656c 6563 7420 6d61       # select ma
+000184e0: 7820 7370 6174 6961 6c20 6672 6571 7565  x spatial freque
+000184f0: 6e63 7920 746f 2069 7465 7261 7465 2074  ncy to iterate t
+00018500: 6f2e 206c 6f77 2072 6573 6f6c 7574 696f  o. low resolutio
+00018510: 6e20 6d61 700a 2020 2020 2020 2020 6d61  n map.        ma
+00018520: 786c 6576 656c 203d 2030 2e35 202f 206e  xlevel = 0.5 / n
+00018530: 702e 6d61 7828 286d 6170 5f31 2e61 7069  p.max((map_1.api
+00018540: 785b 305d 2c20 6d61 705f 322e 6170 6978  x[0], map_2.apix
+00018550: 5b30 5d29 2c20 6178 6973 3d30 290a 2020  [0]), axis=0).  
+00018560: 2020 2020 2020 2320 6c6f 6f70 206f 7665        # loop ove
+00018570: 7220 6672 6571 2073 6865 6c6c 732c 2073  r freq shells, s
+00018580: 6865 6c6c 7769 6474 683d 302e 3030 350a  hellwidth=0.005.
+00018590: 2020 2020 2020 2020 2320 666f 7220 7820          # for x 
+000185a0: 696e 2061 7261 6e67 6528 302c 6d61 786c  in arange(0,maxl
+000185b0: 6576 656c 2b73 7465 702c 7374 6570 293a  evel+step,step):
+000185c0: 0a20 2020 2020 2020 206e 6320 3d20 300a  .        nc = 0.
+000185d0: 2020 2020 2020 2020 7820 3d20 302e 300a          x = 0.0.
+000185e0: 2020 2020 2020 2020 6869 6768 6c65 7665          highleve
+000185f0: 6c20 3d20 7820 2b20 7374 6570 0a20 2020  l = x + step.   
+00018600: 2020 2020 2077 6869 6c65 2028 7820 3c20       while (x < 
+00018610: 6d61 786c 6576 656c 293a 0a20 2020 2020  maxlevel):.     
+00018620: 2020 2020 2020 2023 2070 7269 6e74 2078         # print x
+00018630: 2c68 6967 686c 6576 656c 2c20 6d61 786c  ,highlevel, maxl
+00018640: 6576 656c 0a20 2020 2020 2020 2020 2020  evel.           
+00018650: 2023 2069 6e64 6963 6573 2062 6574 7765   # indices betwe
+00018660: 656e 2075 7070 6572 2061 6e64 206c 6f77  en upper and low
+00018670: 6572 2073 6865 6c6c 2062 6f75 6e64 0a20  er shell bound. 
+00018680: 2020 2020 2020 2020 2020 2066 7368 656c             fshel
+00018690: 6c73 3120 3d20 2828 6469 7374 3120 3c20  ls1 = ((dist1 < 
+000186a0: 6d69 6e28 6d61 786c 6576 656c 2c20 6869  min(maxlevel, hi
+000186b0: 6768 6c65 7665 6c29 2920 2620 2864 6973  ghlevel)) & (dis
+000186c0: 7431 203e 3d20 7829 290a 2020 2020 2020  t1 >= x)).      
+000186d0: 2020 2020 2020 2320 7261 6469 616c 2061        # radial a
+000186e0: 7665 7261 6765 0a20 2020 2020 2020 2020  verage.         
+000186f0: 2020 2073 6865 6c6c 7665 6331 203d 2066     shellvec1 = f
+00018700: 7431 2e66 756c 6c4d 6170 5b66 7368 656c  t1.fullMap[fshel
+00018710: 6c73 315d 0a20 2020 2020 2020 2020 2020  ls1].           
+00018720: 2023 2069 6e64 6963 6573 2062 6574 7765   # indices betwe
+00018730: 656e 2075 7070 6572 2061 6e64 206c 6f77  en upper and low
+00018740: 6572 2073 6865 6c6c 2062 6f75 6e64 0a20  er shell bound. 
+00018750: 2020 2020 2020 2020 2020 2066 7368 656c             fshel
+00018760: 6c73 3220 3d20 2828 6469 7374 3220 3c20  ls2 = ((dist2 < 
+00018770: 6d69 6e28 6d61 786c 6576 656c 2c20 6869  min(maxlevel, hi
+00018780: 6768 6c65 7665 6c29 2920 2620 2864 6973  ghlevel)) & (dis
+00018790: 7432 203e 3d20 7829 290a 2020 2020 2020  t2 >= x)).      
+000187a0: 2020 2020 2020 2320 7261 6469 616c 2061        # radial a
+000187b0: 7665 7261 6765 0a20 2020 2020 2020 2020  verage.         
+000187c0: 2020 2073 6865 6c6c 7665 6332 203d 2066     shellvec2 = f
+000187d0: 7432 2e66 756c 6c4d 6170 5b66 7368 656c  t2.fullMap[fshel
+000187e0: 6c73 325d 0a20 2020 2020 2020 2020 2020  ls2].           
+000187f0: 2061 6273 3120 3d20 6162 7328 7368 656c   abs1 = abs(shel
+00018800: 6c76 6563 3129 0a20 2020 2020 2020 2020  lvec1).         
+00018810: 2020 2061 6273 3220 3d20 6162 7328 7368     abs2 = abs(sh
+00018820: 656c 6c76 6563 3229 0a20 2020 2020 2020  ellvec2).       
+00018830: 2020 2020 206e 7331 203d 206c 656e 286e       ns1 = len(n
+00018840: 702e 6e6f 6e7a 6572 6f28 6162 7331 295b  p.nonzero(abs1)[
+00018850: 305d 290a 2020 2020 2020 2020 2020 2020  0]).            
+00018860: 6e73 3220 3d20 6c65 6e28 6e70 2e6e 6f6e  ns2 = len(np.non
+00018870: 7a65 726f 2861 6273 3229 5b30 5d29 0a20  zero(abs2)[0]). 
+00018880: 2020 2020 2020 2020 2020 2069 6620 6e73             if ns
+00018890: 3120 3c20 3130 206f 7220 6e73 3220 3c20  1 < 10 or ns2 < 
+000188a0: 3130 3a0a 2020 2020 2020 2020 2020 2020  10:.            
+000188b0: 2020 2020 6e63 202b 3d20 310a 2020 2020      nc += 1.    
+000188c0: 2020 2020 2020 2020 2020 2020 6869 6768              high
+000188d0: 6c65 7665 6c20 3d20 6d69 6e28 6d61 786c  level = min(maxl
+000188e0: 6576 656c 2c20 7820 2b20 286e 6320 2b20  evel, x + (nc + 
+000188f0: 3129 202a 2073 7465 7029 0a20 2020 2020  1) * step).     
+00018900: 2020 2020 2020 2020 2020 2078 203d 206d             x = m
+00018910: 6178 2830 2e30 2c20 7820 2d20 6e63 202a  ax(0.0, x - nc *
+00018920: 2073 7465 7029 0a20 2020 2020 2020 2020   step).         
+00018930: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00018940: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00018950: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018960: 2020 6e63 203d 2030 0a20 2020 2020 2020    nc = 0.       
+00018970: 2020 2020 206d 6674 3120 3d20 6e70 2e6d       mft1 = np.m
+00018980: 6561 6e28 6162 7331 290a 2020 2020 2020  ean(abs1).      
+00018990: 2020 2020 2020 6d66 7432 203d 206e 702e        mft2 = np.
+000189a0: 6d65 616e 2861 6273 3229 0a20 2020 2020  mean(abs2).     
+000189b0: 2020 2020 2020 2069 6620 6d66 7431 203d         if mft1 =
+000189c0: 3d20 302e 3020 616e 6420 6d66 7432 203d  = 0.0 and mft2 =
+000189d0: 3d20 302e 303a 0a20 2020 2020 2020 2020  = 0.0:.         
+000189e0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+000189f0: 2020 2020 2020 2020 2020 2020 2320 7371              # sq
+00018a00: 206f 6620 7261 6469 616c 2061 7667 2061   of radial avg a
+00018a10: 6d70 6c69 7475 6465 0a20 2020 2020 2020  mplitude.       
+00018a20: 2020 2020 2066 7431 5f61 7667 2e61 7070       ft1_avg.app
+00018a30: 656e 6428 6e70 2e6c 6f67 3130 286e 702e  end(np.log10(np.
+00018a40: 6d65 616e 286e 702e 7371 7561 7265 2861  mean(np.square(a
+00018a50: 6273 3129 2929 290a 2020 2020 2020 2020  bs1)))).        
+00018a60: 2020 2020 6674 325f 6176 672e 6170 7065      ft2_avg.appe
+00018a70: 6e64 286e 702e 6c6f 6731 3028 6e70 2e6d  nd(np.log10(np.m
+00018a80: 6561 6e28 6e70 2e73 7175 6172 6528 6162  ean(np.square(ab
+00018a90: 7332 2929 2929 0a0a 2020 2020 2020 2020  s2))))..        
+00018aa0: 2020 2020 2320 7363 616c 6520 746f 2061      # scale to a
+00018ab0: 6d70 6c69 7475 6465 7320 6f66 2074 6865  mplitudes of the
+00018ac0: 2072 6566 206d 6170 0a20 2020 2020 2020   ref map.       
+00018ad0: 2020 2020 2069 6620 7265 663a 0a20 2020       if ref:.   
+00018ae0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00018af0: 6d66 7431 203d 3d20 302e 303a 0a20 2020  mft1 == 0.0:.   
+00018b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018b10: 2063 6f6e 7469 6e75 650a 2020 2020 2020   continue.      
+00018b20: 2020 2020 2020 2020 2020 6674 312e 6675            ft1.fu
+00018b30: 6c6c 4d61 705b 6673 6865 6c6c 7331 5d20  llMap[fshells1] 
+00018b40: 3d20 7368 656c 6c76 6563 3120 2a20 286d  = shellvec1 * (m
+00018b50: 6674 3220 2f20 6d66 7431 290a 2020 2020  ft2 / mft1).    
+00018b60: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00018b70: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00018b80: 7265 706c 6163 6520 7769 7468 2061 7667  replace with avg
+00018b90: 2061 6d70 6c69 7475 6465 7320 666f 7220   amplitudes for 
+00018ba0: 7468 6520 7477 6f20 6d61 7073 0a20 2020  the two maps.   
+00018bb0: 2020 2020 2020 2020 2020 2020 2066 7431               ft1
+00018bc0: 2e66 756c 6c4d 6170 5b66 7368 656c 6c73  .fullMap[fshells
+00018bd0: 315d 203d 2073 6865 6c6c 7665 6331 202a  1] = shellvec1 *
+00018be0: 2028 6d66 7432 202b 206d 6674 3129 202f   (mft2 + mft1) /
+00018bf0: 2028 3220 2a20 6d66 7431 290a 2020 2020   (2 * mft1).    
+00018c00: 2020 2020 2020 2020 2020 2020 6674 322e              ft2.
+00018c10: 6675 6c6c 4d61 705b 6673 6865 6c6c 7332  fullMap[fshells2
+00018c20: 5d20 3d20 7368 656c 6c76 6563 3220 2a20  ] = shellvec2 * 
+00018c30: 286d 6674 3220 2b20 6d66 7431 2920 2f20  (mft2 + mft1) / 
+00018c40: 2832 202a 206d 6674 3229 0a0a 2020 2020  (2 * mft2)..    
+00018c50: 2020 2020 2020 2020 2320 6e65 7720 7261          # new ra
+00018c60: 6469 616c 2061 7665 7261 6765 2028 746f  dial average (to
+00018c70: 2063 6865 636b 290a 2020 2020 2020 2020   check).        
+00018c80: 2020 2020 6d66 7431 203d 206e 702e 6d65      mft1 = np.me
+00018c90: 616e 2861 6273 2866 7431 2e66 756c 6c4d  an(abs(ft1.fullM
+00018ca0: 6170 5b66 7368 656c 6c73 315d 2929 0a20  ap[fshells1])). 
+00018cb0: 2020 2020 2020 2020 2020 2066 7431 5f61             ft1_a
+00018cc0: 7667 5f6e 6577 2e61 7070 656e 6428 0a20  vg_new.append(. 
+00018cd0: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00018ce0: 702e 6c6f 6731 3028 0a20 2020 2020 2020  p.log10(.       
+00018cf0: 2020 2020 2020 2020 2020 2020 206e 702e               np.
+00018d00: 6d65 616e 280a 2020 2020 2020 2020 2020  mean(.          
+00018d10: 2020 2020 2020 2020 2020 2020 2020 6e70                np
+00018d20: 2e73 7175 6172 6528 6162 7328 6674 312e  .square(abs(ft1.
+00018d30: 6675 6c6c 4d61 705b 6673 6865 6c6c 7331  fullMap[fshells1
+00018d40: 5d29 290a 2020 2020 2020 2020 2020 2020  ])).            
+00018d50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018d60: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00018d70: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00018d80: 2020 2020 2020 6c66 7265 712e 6170 7065        lfreq.appe
+00018d90: 6e64 2868 6967 686c 6576 656c 290a 0a20  nd(highlevel).. 
+00018da0: 2020 2020 2020 2020 2020 2073 616d 706c             sampl
+00018db0: 696e 675f 6672 7120 3d20 6869 6768 6c65  ing_frq = highle
+00018dc0: 7665 6c0a 0a20 2020 2020 2020 2020 2020  vel..           
+00018dd0: 2063 7574 6f66 665f 6672 6571 203d 206d   cutoff_freq = m
+00018de0: 696e 2828 312e 3020 2f20 7265 736f 2920  in((1.0 / reso) 
+00018df0: 2b20 302e 3235 2c20 6d61 786c 6576 656c  + 0.25, maxlevel
+00018e00: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00018e10: 2073 6361 6c65 2074 6865 2072 6573 7420   scale the rest 
+00018e20: 616e 6420 6272 6561 6b20 6166 7465 7220  and break after 
+00018e30: 7265 6c65 7661 6e74 2066 7265 7175 656e  relevant frequen
+00018e40: 6369 6573 0a20 2020 2020 2020 2020 2020  cies.           
+00018e50: 2069 6620 7361 6d70 6c69 6e67 5f66 7271   if sampling_frq
+00018e60: 203e 2063 7574 6f66 665f 6672 6571 3a0a   > cutoff_freq:.
+00018e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018e80: 6673 6865 6c6c 7331 203d 2028 6469 7374  fshells1 = (dist
+00018e90: 3120 3e3d 2068 6967 686c 6576 656c 290a  1 >= highlevel).
+00018ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018eb0: 7368 656c 6c76 6563 3120 3d20 6674 312e  shellvec1 = ft1.
+00018ec0: 6675 6c6c 4d61 705b 6673 6865 6c6c 7331  fullMap[fshells1
+00018ed0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00018ee0: 2020 6d66 7431 203d 206e 702e 6d65 616e    mft1 = np.mean
+00018ef0: 2861 6273 2873 6865 6c6c 7665 6331 2929  (abs(shellvec1))
+00018f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018f10: 2066 7368 656c 6c73 3220 3d20 2864 6973   fshells2 = (dis
+00018f20: 7432 203e 3d20 6869 6768 6c65 7665 6c29  t2 >= highlevel)
+00018f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018f40: 2073 6865 6c6c 7665 6332 203d 2066 7432   shellvec2 = ft2
+00018f50: 2e66 756c 6c4d 6170 5b66 7368 656c 6c73  .fullMap[fshells
+00018f60: 325d 0a20 2020 2020 2020 2020 2020 2020  2].             
+00018f70: 2020 206d 6674 3220 3d20 6e70 2e6d 6561     mft2 = np.mea
+00018f80: 6e28 6162 7328 7368 656c 6c76 6563 3229  n(abs(shellvec2)
+00018f90: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00018fa0: 2020 6966 206d 6674 3120 3d3d 2030 2e30    if mft1 == 0.0
+00018fb0: 2061 6e64 206d 6674 3220 3d3d 2030 2e30   and mft2 == 0.0
+00018fc0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00018fd0: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00018fe0: 2020 2020 2020 2020 2020 2020 6674 315f              ft1_
+00018ff0: 6176 672e 6170 7065 6e64 286e 702e 6c6f  avg.append(np.lo
+00019000: 6731 3028 6e70 2e6d 6561 6e28 6e70 2e73  g10(np.mean(np.s
+00019010: 7175 6172 6528 6162 7328 7368 656c 6c76  quare(abs(shellv
+00019020: 6563 3129 2929 2929 0a20 2020 2020 2020  ec1))))).       
+00019030: 2020 2020 2020 2020 2066 7432 5f61 7667           ft2_avg
+00019040: 2e61 7070 656e 6428 6e70 2e6c 6f67 3130  .append(np.log10
+00019050: 286e 702e 6d65 616e 286e 702e 7371 7561  (np.mean(np.squa
+00019060: 7265 2861 6273 2873 6865 6c6c 7665 6332  re(abs(shellvec2
+00019070: 2929 2929 290a 0a20 2020 2020 2020 2020  )))))..         
+00019080: 2020 2020 2020 2069 6620 7265 663a 0a20         if ref:. 
+00019090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000190a0: 2020 2069 6620 6d66 7431 203d 3d20 302e     if mft1 == 0.
+000190b0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+000190c0: 2020 2020 2020 2020 2020 2062 7265 616b             break
+000190d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000190e0: 2020 2020 2066 7431 2e66 756c 6c4d 6170       ft1.fullMap
+000190f0: 5b66 7368 656c 6c73 315d 203d 2073 6865  [fshells1] = she
+00019100: 6c6c 7665 6331 2a28 6d66 7432 2f6d 6674  llvec1*(mft2/mft
+00019110: 3129 0a20 2020 2020 2020 2020 2020 2020  1).             
+00019120: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019130: 2020 2020 2020 2020 2020 2020 2066 7431               ft1
+00019140: 2e66 756c 6c4d 6170 5b66 7368 656c 6c73  .fullMap[fshells
+00019150: 315d 203d 2073 6865 6c6c 7665 6331 2a28  1] = shellvec1*(
+00019160: 6d66 7432 2b6d 6674 3129 2f28 322a 6d66  mft2+mft1)/(2*mf
+00019170: 7431 290a 2020 2020 2020 2020 2020 2020  t1).            
+00019180: 2020 2020 2020 2020 6674 322e 6675 6c6c          ft2.full
+00019190: 4d61 705b 6673 6865 6c6c 7332 5d20 3d20  Map[fshells2] = 
+000191a0: 7368 656c 6c76 6563 322a 286d 6674 322b  shellvec2*(mft2+
+000191b0: 6d66 7431 292f 2832 2a6d 6674 3229 0a0a  mft1)/(2*mft2)..
+000191c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000191d0: 6d66 7431 203d 206e 702e 6d65 616e 2861  mft1 = np.mean(a
+000191e0: 6273 2866 7431 2e66 756c 6c4d 6170 5b66  bs(ft1.fullMap[f
+000191f0: 7368 656c 6c73 315d 2929 0a20 2020 2020  shells1])).     
+00019200: 2020 2020 2020 2020 2020 2066 7431 5f61             ft1_a
+00019210: 7667 5f6e 6577 2e61 7070 656e 6428 0a20  vg_new.append(. 
 00019220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019230: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00019230: 2020 206e 702e 6c6f 6731 3028 0a20 2020     np.log10(.   
 00019240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019250: 6674 312e 6675 6c6c 4d61 705b 6673 6865  ft1.fullMap[fshe
-00019260: 6c6c 7331 5d20 3d20 7368 656c 6c76 6563  lls1] = shellvec
-00019270: 312a 286d 6674 322f 6d66 7431 290a 2020  1*(mft2/mft1).  
-00019280: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00019290: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-000192a0: 2020 2020 2020 2020 6674 312e 6675 6c6c          ft1.full
-000192b0: 4d61 705b 6673 6865 6c6c 7331 5d20 3d20  Map[fshells1] = 
-000192c0: 7368 656c 6c76 6563 312a 286d 6674 322b  shellvec1*(mft2+
-000192d0: 6d66 7431 292f 2832 2a6d 6674 3129 0a20  mft1)/(2*mft1). 
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192f0: 2020 2066 7432 2e66 756c 6c4d 6170 5b66     ft2.fullMap[f
-00019300: 7368 656c 6c73 325d 203d 2073 6865 6c6c  shells2] = shell
-00019310: 7665 6332 2a28 6d66 7432 2b6d 6674 3129  vec2*(mft2+mft1)
-00019320: 2f28 322a 6d66 7432 290a 0a20 2020 2020  /(2*mft2)..     
-00019330: 2020 2020 2020 2020 2020 206d 6674 3120             mft1 
-00019340: 3d20 6e70 2e6d 6561 6e28 6162 7328 6674  = np.mean(abs(ft
-00019350: 312e 6675 6c6c 4d61 705b 6673 6865 6c6c  1.fullMap[fshell
-00019360: 7331 5d29 290a 2020 2020 2020 2020 2020  s1])).          
-00019370: 2020 2020 2020 6674 315f 6176 675f 6e65        ft1_avg_ne
-00019380: 772e 6170 7065 6e64 280a 2020 2020 2020  w.append(.      
-00019390: 2020 2020 2020 2020 2020 2020 2020 6e70                np
-000193a0: 2e6c 6f67 3130 280a 2020 2020 2020 2020  .log10(.        
-000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193c0: 6e70 2e6d 6561 6e28 0a20 2020 2020 2020  np.mean(.       
-000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193e0: 2020 2020 206e 702e 7371 7561 7265 2861       np.square(a
-000193f0: 6273 2866 7431 2e66 756c 6c4d 6170 5b66  bs(ft1.fullMap[f
-00019400: 7368 656c 6c73 315d 2929 0a20 2020 2020  shells1])).     
-00019410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019420: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00019430: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00019440: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00019450: 2020 2020 2020 2020 2020 2020 206c 6672               lfr
-00019460: 6571 2e61 7070 656e 6428 2868 6967 686c  eq.append((highl
-00019470: 6576 656c 202b 2073 7465 7020 2f20 3229  evel + step / 2)
-00019480: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00019490: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
-000194a0: 2020 2020 7820 3d20 6869 6768 6c65 7665      x = highleve
-000194b0: 6c0a 2020 2020 2020 2020 2020 2020 6869  l.            hi
-000194c0: 6768 6c65 7665 6c20 3d20 7820 2b20 7374  ghlevel = x + st
-000194d0: 6570 0a20 2020 2020 2020 2023 206c 6f77  ep.        # low
-000194e0: 2070 6173 7320 6669 6c74 6572 2061 6674   pass filter aft
-000194f0: 6572 3f0a 2020 2020 2020 2020 2320 6c6f  er?.        # lo
-00019500: 7720 7061 7373 2066 696c 7465 7220 6265  w pass filter be
-00019510: 666f 7265 2073 6361 6c69 6e67 0a20 2020  fore scaling.   
-00019520: 2020 2020 2069 6620 7265 736f 2069 7320       if reso is 
-00019530: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-00019540: 2020 2020 2020 6966 206c 7066 696c 7461        if lpfilta
-00019550: 2061 6e64 206e 6f74 206c 7066 696c 7462   and not lpfiltb
-00019560: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019570: 2020 6674 312e 5f74 616e 685f 6c6f 7770    ft1._tanh_lowp
-00019580: 6173 7328 6375 746f 6666 312c 2066 616c  ass(cutoff1, fal
-00019590: 6c3d 302e 322c 2066 746d 6170 3d54 7275  l=0.2, ftmap=Tru
-000195a0: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-000195b0: 2020 2066 7432 2e5f 7461 6e68 5f6c 6f77     ft2._tanh_low
-000195c0: 7061 7373 2863 7574 6f66 6632 2c20 6661  pass(cutoff2, fa
-000195d0: 6c6c 3d30 2e32 2c20 6674 6d61 703d 5472  ll=0.2, ftmap=Tr
-000195e0: 7565 290a 2020 2020 2020 2020 7472 793a  ue).        try:
-000195f0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00019600: 7079 6666 7477 5f66 6c61 6720 3d3d 2030  pyfftw_flag == 0
-00019610: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019620: 2020 7261 6973 6520 496d 706f 7274 4572    raise ImportEr
-00019630: 726f 720a 2020 2020 2020 2020 2020 2020  ror.            
-00019640: 6966 6674 203d 2070 7966 6674 772e 4646  ifft = pyfftw.FF
-00019650: 5457 280a 2020 2020 2020 2020 2020 2020  TW(.            
-00019660: 2020 2020 696e 7075 7461 312c 0a20 2020      inputa1,.   
-00019670: 2020 2020 2020 2020 2020 2020 206f 7574               out
-00019680: 7075 7461 312c 0a20 2020 2020 2020 2020  puta1,.         
-00019690: 2020 2020 2020 2064 6972 6563 7469 6f6e         direction
-000196a0: 3d27 4646 5457 5f42 4143 4b57 4152 4427  ='FFTW_BACKWARD'
-000196b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000196c0: 2020 6178 6573 3d28 302c 2031 2c20 3229    axes=(0, 1, 2)
-000196d0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000196e0: 2020 666c 6167 733d 5b27 4646 5457 5f45    flags=['FFTW_E
-000196f0: 5354 494d 4154 4527 5d2c 0a20 2020 2020  STIMATE'],.     
-00019700: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00019710: 2020 2020 2069 6e70 7574 6131 5b3a 2c20       inputa1[:, 
-00019720: 3a2c 203a 5d20 3d20 6966 6674 7368 6966  :, :] = ifftshif
-00019730: 7428 6674 312e 6675 6c6c 4d61 7029 5b3a  t(ft1.fullMap)[:
-00019740: 2c20 3a2c 203a 5d0a 2020 2020 2020 2020  , :, :].        
-00019750: 2020 2020 6966 6674 2829 0a20 2020 2020      ifft().     
-00019760: 2020 2020 2020 206d 6170 315f 6669 6c74         map1_filt
-00019770: 203d 204d 6170 280a 2020 2020 2020 2020   = Map(.        
-00019780: 2020 2020 2020 2020 6f75 7470 7574 6131          outputa1
-00019790: 2e72 6561 6c2e 6173 7479 7065 2827 666c  .real.astype('fl
-000197a0: 6f61 7427 292c 0a20 2020 2020 2020 2020  oat'),.         
-000197b0: 2020 2020 2020 206d 6170 5f31 2e6f 7269         map_1.ori
-000197c0: 6769 6e2c 0a20 2020 2020 2020 2020 2020  gin,.           
-000197d0: 2020 2020 206d 6170 5f31 2e61 7069 782c       map_1.apix,
-000197e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000197f0: 206d 6170 5f31 2e66 696c 656e 616d 652c   map_1.filename,
-00019800: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019810: 206d 6170 5f31 2e68 6561 6465 725b 3a5d   map_1.header[:]
-00019820: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00019830: 2020 2020 2020 2020 6578 6365 7074 2045          except E
-00019840: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
-00019850: 2020 2020 2020 2320 7573 6520 6e75 6d70        # use nump
-00019860: 7920 6966 6674 2069 6e73 7465 6164 0a20  y ifft instead. 
-00019870: 2020 2020 2020 2020 2020 206d 6170 315f             map1_
-00019880: 6669 6c74 203d 206d 6170 5f31 2e63 6f70  filt = map_1.cop
-00019890: 7928 290a 2020 2020 2020 2020 2020 2020  y().            
-000198a0: 6d61 7031 5f66 696c 742e 6675 6c6c 4d61  map1_filt.fullMa
-000198b0: 7020 3d20 6e70 2e72 6561 6c28 6966 6674  p = np.real(ifft
-000198c0: 6e28 6966 6674 7368 6966 7428 6674 312e  n(ifftshift(ft1.
-000198d0: 6675 6c6c 4d61 7029 2929 0a20 2020 2020  fullMap))).     
-000198e0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-000198f0: 2020 2020 6966 2070 7966 6674 775f 666c      if pyfftw_fl
-00019900: 6167 203d 3d20 303a 0a20 2020 2020 2020  ag == 0:.       
-00019910: 2020 2020 2020 2020 2072 6169 7365 2049           raise I
-00019920: 6d70 6f72 7445 7272 6f72 0a20 2020 2020  mportError.     
-00019930: 2020 2020 2020 2069 6666 7420 3d20 7079         ifft = py
-00019940: 6666 7477 2e46 4654 5728 0a20 2020 2020  fftw.FFTW(.     
-00019950: 2020 2020 2020 2020 2020 2069 6e70 7574             input
-00019960: 6132 2c0a 2020 2020 2020 2020 2020 2020  a2,.            
-00019970: 2020 2020 6f75 7470 7574 6132 2c0a 2020      outputa2,.  
-00019980: 2020 2020 2020 2020 2020 2020 2020 6469                di
-00019990: 7265 6374 696f 6e3d 2746 4654 575f 4241  rection='FFTW_BA
-000199a0: 434b 5741 5244 272c 0a20 2020 2020 2020  CKWARD',.       
-000199b0: 2020 2020 2020 2020 2061 7865 733d 2830           axes=(0
-000199c0: 2c20 312c 2032 292c 0a20 2020 2020 2020  , 1, 2),.       
-000199d0: 2020 2020 2020 2020 2066 6c61 6773 3d5b           flags=[
-000199e0: 2746 4654 575f 4553 5449 4d41 5445 275d  'FFTW_ESTIMATE']
-000199f0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-00019a00: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
-00019a10: 7461 325b 3a2c 203a 2c20 3a5d 203d 2069  ta2[:, :, :] = i
-00019a20: 6666 7473 6869 6674 2866 7432 2e66 756c  fftshift(ft2.ful
-00019a30: 6c4d 6170 295b 3a2c 203a 2c20 3a5d 0a20  lMap)[:, :, :]. 
-00019a40: 2020 2020 2020 2020 2020 2069 6666 7428             ifft(
-00019a50: 290a 2020 2020 2020 2020 2020 2020 6d61  ).            ma
-00019a60: 7032 5f66 696c 7420 3d20 4d61 7028 0a20  p2_filt = Map(. 
-00019a70: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00019a80: 7574 7075 7461 322e 7265 616c 2e61 7374  utputa2.real.ast
-00019a90: 7970 6528 2766 6c6f 6174 2729 2c0a 2020  ype('float'),.  
-00019aa0: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
-00019ab0: 705f 322e 6f72 6967 696e 2c0a 2020 2020  p_2.origin,.    
-00019ac0: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
-00019ad0: 322e 6170 6978 2c0a 2020 2020 2020 2020  2.apix,.        
-00019ae0: 2020 2020 2020 2020 6d61 705f 322e 6669          map_2.fi
-00019af0: 6c65 6e61 6d65 2c0a 2020 2020 2020 2020  lename,.        
-00019b00: 2020 2020 2020 2020 6d61 705f 322e 6865          map_2.he
-00019b10: 6164 6572 5b3a 5d2c 0a20 2020 2020 2020  ader[:],.       
-00019b20: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
-00019b30: 7863 6570 7420 4578 6365 7074 696f 6e3a  xcept Exception:
-00019b40: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
-00019b50: 325f 6669 6c74 203d 206d 6170 5f32 2e63  2_filt = map_2.c
-00019b60: 6f70 7928 290a 2020 2020 2020 2020 2020  opy().          
-00019b70: 2020 6d61 7032 5f66 696c 742e 6675 6c6c    map2_filt.full
-00019b80: 4d61 7020 3d20 6e70 2e72 6561 6c28 6966  Map = np.real(if
-00019b90: 6674 6e28 6966 6674 7368 6966 7428 6674  ftn(ifftshift(ft
-00019ba0: 322e 6675 6c6c 4d61 7029 2929 0a20 2020  2.fullMap))).   
-00019bb0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
-00019bc0: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
-00019bd0: 706c 6f74 6c69 620a 2020 2020 2020 2020  plotlib.        
-00019be0: 2020 2020 6d61 7470 6c6f 746c 6962 2e75      matplotlib.u
-00019bf0: 7365 2827 4167 6727 290a 2020 2020 2020  se('Agg').      
-00019c00: 2020 2020 2020 696d 706f 7274 206d 6174        import mat
-00019c10: 706c 6f74 6c69 622e 7079 706c 6f74 2061  plotlib.pyplot a
-00019c20: 7320 706c 740a 2020 2020 2020 2020 2020  s plt.          
-00019c30: 2020 6672 6f6d 206d 6174 706c 6f74 6c69    from matplotli
-00019c40: 6220 696d 706f 7274 2070 796c 6162 0a20  b import pylab. 
-00019c50: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
-00019c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019c70: 706c 742e 7374 796c 652e 7573 6528 2767  plt.style.use('g
-00019c80: 6770 6c6f 7427 290a 2020 2020 2020 2020  gplot').        
-00019c90: 2020 2020 6578 6365 7074 2041 7474 7269      except Attri
-00019ca0: 6275 7465 4572 726f 723a 0a20 2020 2020  buteError:.     
-00019cb0: 2020 2020 2020 2020 2020 2070 6173 730a             pass.
-00019cc0: 2020 2020 2020 2020 2020 2020 706c 742e              plt.
-00019cd0: 7263 5061 7261 6d73 2e75 7064 6174 6528  rcParams.update(
-00019ce0: 7b27 666f 6e74 2e73 697a 6527 3a20 3138  {'font.size': 18
-00019cf0: 7d29 0a20 2020 2020 2020 2020 2020 2070  }).            p
-00019d00: 6c74 2e72 6350 6172 616d 732e 7570 6461  lt.rcParams.upda
-00019d10: 7465 287b 276c 6567 656e 642e 666f 6e74  te({'legend.font
-00019d20: 7369 7a65 273a 2031 387d 290a 2020 2020  size': 18}).    
-00019d30: 2020 2020 2020 2020 706c 742e 706c 6f74          plt.plot
-00019d40: 286c 6672 6571 2c20 6674 315f 6176 672c  (lfreq, ft1_avg,
-00019d50: 2027 722d 2d27 2c20 6c61 6265 6c3d 276d   'r--', label='m
-00019d60: 6170 3127 290a 2020 2020 2020 2020 2020  ap1').          
-00019d70: 2020 706c 742e 706c 6f74 286c 6672 6571    plt.plot(lfreq
-00019d80: 2c20 6674 325f 6176 672c 2027 6273 272c  , ft2_avg, 'bs',
-00019d90: 206c 6162 656c 3d27 6d61 7032 2729 0a20   label='map2'). 
-00019da0: 2020 2020 2020 2020 2020 2070 6c74 2e70             plt.p
-00019db0: 6c6f 7428 6c66 7265 712c 2066 7431 5f61  lot(lfreq, ft1_a
-00019dc0: 7667 5f6e 6577 2c20 2767 5e27 2c20 6c61  vg_new, 'g^', la
-00019dd0: 6265 6c3d 2773 6361 6c65 6427 290a 2020  bel='scaled').  
-00019de0: 2020 2020 2020 2020 2020 6c65 6720 3d20            leg = 
-00019df0: 706c 742e 6c65 6765 6e64 286c 6f63 3d27  plt.legend(loc='
-00019e00: 7570 7065 7220 7269 6768 7427 290a 2020  upper right').  
-00019e10: 2020 2020 2020 2020 2020 666f 7220 6c65            for le
-00019e20: 676f 626a 2069 6e20 6c65 672e 6c65 6765  gobj in leg.lege
-00019e30: 6e64 4861 6e64 6c65 733a 0a20 2020 2020  ndHandles:.     
-00019e40: 2020 2020 2020 2020 2020 206c 6567 6f62             legob
-00019e50: 6a2e 7365 745f 6c69 6e65 7769 6474 6828  j.set_linewidth(
-00019e60: 322e 3029 0a20 2020 2020 2020 2020 2020  2.0).           
-00019e70: 2070 796c 6162 2e73 6176 6566 6967 2822   pylab.savefig("
-00019e80: 7370 6563 7472 612e 706e 6722 290a 2020  spectra.png").  
-00019e90: 2020 2020 2020 2020 2020 706c 742e 636c            plt.cl
-00019ea0: 6f73 6528 290a 2020 2020 2020 2020 6578  ose().        ex
-00019eb0: 6365 7074 2045 7863 6570 7469 6f6e 3a0a  cept Exception:.
-00019ec0: 2020 2020 2020 2020 2020 2020 7061 7373              pass
-00019ed0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00019ee0: 6d61 7031 5f66 696c 742e 6675 6c6c 4d61  map1_filt.fullMa
-00019ef0: 702c 206d 6170 325f 6669 6c74 2e66 756c  p, map2_filt.ful
-00019f00: 6c4d 6170 0a0a 2020 2020 6465 6620 6765  lMap..    def ge
-00019f10: 745f 636c 6173 685f 6d61 7028 7365 6c66  t_clash_map(self
-00019f20: 2c20 656d 6d61 702c 2061 7069 7829 3a0a  , emmap, apix):.
-00019f30: 2020 2020 2020 2020 7465 6d70 6c61 7465          template
-00019f40: 5f67 7269 6420 3d20 656d 6d61 702e 5f6d  _grid = emmap._m
-00019f50: 616b 655f 636c 6173 685f 6d61 7028 6170  ake_clash_map(ap
-00019f60: 6978 290a 2020 2020 2020 2020 7265 7475  ix).        retu
-00019f70: 726e 2074 656d 706c 6174 655f 6772 6964  rn template_grid
-00019f80: 0a0a 2020 2020 6465 6620 6765 745f 736d  ..    def get_sm
-00019f90: 5f73 636f 7265 280a 2020 2020 2020 2020  _score(.        
-00019fa0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00019fb0: 2020 2020 2020 7374 7275 6374 2c0a 2020        struct,.  
-00019fc0: 2020 2020 2020 2020 2020 6e63 6f6d 702c            ncomp,
-00019fd0: 0a20 2020 2020 2020 2020 2020 2074 656d  .            tem
-00019fe0: 706c 6174 655f 6772 6964 2c0a 2020 2020  plate_grid,.    
-00019ff0: 2020 2020 2020 2020 6376 6f6c 2c0a 2020          cvol,.  
-0001a000: 2020 2020 2020 2020 2020 6170 6978 2c0a            apix,.
-0001a010: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0001a020: 2222 4361 6c63 756c 6174 6520 7468 6520  ""Calculate the 
-0001a030: 636c 6173 6820 7363 6f72 6520 6265 7477  clash score betw
-0001a040: 6565 6e20 6368 6169 6e73 2077 6974 6869  een chains withi
-0001a050: 6e20 6120 7072 6f74 6569 6e20 6d6f 6465  n a protein mode
-0001a060: 6c0a 0a20 2020 2020 2020 2054 6865 2063  l..        The c
-0001a070: 6c61 7368 2073 636f 7265 2063 616c 6375  lash score calcu
-0001a080: 6c61 7465 7320 7468 6520 616d 6f75 6e74  lates the amount
-0001a090: 2074 6861 7420 6368 6169 6e73 2069 6e20   that chains in 
-0001a0a0: 6120 7072 6f74 6569 6e20 6f76 6572 6c61  a protein overla
-0001a0b0: 700a 2020 2020 2020 2020 6f6e 6520 616e  p.        one an
-0001a0c0: 6f74 6865 722e 2054 6865 2073 7472 7563  other. The struc
-0001a0d0: 7475 7265 2069 7320 6d61 7070 6564 2069  ture is mapped i
-0001a0e0: 6e74 6f20 6469 7363 7265 7465 2062 696e  nto discrete bin
-0001a0f0: 7320 696e 2033 4420 7370 6163 652c 0a20  s in 3D space,. 
-0001a100: 2020 2020 2020 2064 6566 696e 6564 2062         defined b
-0001a110: 7920 7468 6520 7465 6d70 6c61 7465 5f67  y the template_g
-0001a120: 7269 6420 696e 7075 742e 2054 6865 2073  rid input. The s
-0001a130: 636f 7265 2069 7320 7072 6f70 6f72 7469  core is proporti
-0001a140: 6f6e 616c 2074 6f20 7468 650a 2020 2020  onal to the.    
-0001a150: 2020 2020 6e75 6d62 6572 206f 6620 7468      number of th
-0001a160: 6573 6520 6269 6e73 206f 6363 7570 6965  ese bins occupie
-0001a170: 6420 6279 206d 6f72 6520 7468 616e 206f  d by more than o
-0001a180: 6e65 206f 6620 7468 6520 7072 6f74 6569  ne of the protei
-0001a190: 6e20 6368 6169 6e73 2e0a 0a20 2020 2020  n chains...     
-0001a1a0: 2020 2052 6563 6f6d 6d65 6e64 6564 2070     Recommended p
-0001a1b0: 6978 656c 2073 7061 6369 6e67 206f 6620  ixel spacing of 
-0001a1c0: 7468 6520 7465 6d70 6c61 7465 5f67 7269  the template_gri
-0001a1d0: 6420 6973 2033 2e35 20c3 852e 0a0a 2020  d is 3.5 .....  
-0001a1e0: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-0001a1f0: 2020 2020 2020 2020 7374 7275 6374 3a20          struct: 
-0001a200: 5374 7275 6374 7572 6520 696e 7374 616e  Structure instan
-0001a210: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-0001a220: 6e63 6f6d 703a 204e 756d 6265 7220 6f66  ncomp: Number of
-0001a230: 2063 6861 696e 7320 696e 2074 6865 2073   chains in the s
-0001a240: 7472 7563 7475 7265 2e0a 2020 2020 2020  tructure..      
-0001a250: 2020 2020 2020 7465 6d70 6c61 7465 5f67        template_g
-0001a260: 7269 643a 204d 6170 206f 626a 6563 7420  rid: Map object 
-0001a270: 7769 7468 2065 6d70 7479 2033 442d 6772  with empty 3D-gr
-0001a280: 6964 2028 6669 6c6c 6564 2077 6974 6820  id (filled with 
-0001a290: 7a65 726f 7329 2e0a 2020 2020 2020 2020  zeros)..        
-0001a2a0: 2020 2020 2020 2020 5468 6973 2063 616e          This can
-0001a2b0: 2062 6520 6361 6c63 756c 6174 6564 2075   be calculated u
-0001a2c0: 7369 6e67 0a20 2020 2020 2020 2020 2020  sing.           
-0001a2d0: 2020 2020 203a 6d65 7468 3a60 5374 7275       :meth:`Stru
-0001a2e0: 6374 7572 6542 6c75 7272 6572 2e70 726f  ctureBlurrer.pro
-0001a2f0: 744d 6170 203c 5445 4d50 792e 7072 6f74  tMap <TEMPy.prot
-0001a300: 6569 6e2e 7374 7275 6374 7572 655f 626c  ein.structure_bl
-0001a310: 7572 7265 722e 5374 7275 6374 7572 6542  urrer.StructureB
-0001a320: 6c75 7272 6572 2e70 726f 744d 6170 3e60  lurrer.protMap>`
-0001a330: 0a20 2020 2020 2020 2020 2020 2063 766f  .            cvo
-0001a340: 6c3a 204c 6973 7420 636f 6e74 6169 6e69  l: List containi
-0001a350: 6e67 2074 6865 2076 6f6c 756d 6520 6f66  ng the volume of
-0001a360: 2065 6163 6820 6368 6169 6e2e 2054 6869   each chain. Thi
-0001a370: 7320 6361 6e20 6265 0a20 2020 2020 2020  s can be.       
-0001a380: 2020 2020 2020 2020 2063 616c 6375 6c61           calcula
-0001a390: 7465 6420 7573 696e 670a 2020 2020 2020  ted using.      
-0001a3a0: 2020 2020 2020 2020 2020 3a6d 6574 683a            :meth:
-0001a3b0: 604d 6170 2e5f 6765 745f 636f 6d70 6f6e  `Map._get_compon
-0001a3c0: 656e 745f 766f 6c75 6d65 7320 3c54 454d  ent_volumes <TEM
-0001a3d0: 5079 2e6d 6170 732e 656d 5f6d 6170 2e4d  Py.maps.em_map.M
-0001a3e0: 6170 2e5f 6765 745f 636f 6d70 6f6e 656e  ap._get_componen
-0001a3f0: 745f 766f 6c75 6d65 733e 600a 2020 2020  t_volumes>`.    
-0001a400: 2020 2020 2020 2020 6170 6978 3a20 5069          apix: Pi
-0001a410: 7865 6c20 7369 7a65 206f 6620 7465 6d70  xel size of temp
-0001a420: 6c61 7465 5f67 7269 642c 2075 7365 6420  late_grid, used 
-0001a430: 666f 7220 7363 616c 696e 6720 7468 6520  for scaling the 
-0001a440: 766f 6c75 6d65 0a20 2020 2020 2020 2020  volume.         
-0001a450: 2020 2020 2020 2063 616c 6375 6c61 7469         calculati
-0001a460: 6f6e 732e 0a0a 2020 2020 2020 2020 5265  ons...        Re
-0001a470: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-0001a480: 2020 2054 6865 2063 6c61 7368 2073 636f     The clash sco
-0001a490: 7265 2066 6f72 2074 6865 2073 7472 7563  re for the struc
-0001a4a0: 7475 7265 2028 636c 6f73 6520 746f 2030  ture (close to 0
-0001a4b0: 2069 7320 676f 6f64 2c20 6c61 7267 650a   is good, large.
-0001a4c0: 2020 2020 2020 2020 2020 2020 6e65 6761              nega
-0001a4d0: 7469 7665 2073 636f 7265 2069 7320 6261  tive score is ba
-0001a4e0: 6429 0a20 2020 2020 2020 2022 2222 0a20  d).        """. 
-0001a4f0: 2020 2020 2020 206f 7665 726c 6179 5f6d         overlay_m
-0001a500: 6170 6c69 7374 203d 205b 5d0a 2020 2020  aplist = [].    
-0001a510: 2020 2020 6f76 6572 6c61 795f 6d61 706c      overlay_mapl
-0001a520: 6973 7420 3d20 7365 6c66 2e67 6574 5f6f  ist = self.get_o
-0001a530: 7665 726c 6179 5f63 6f6d 705f 6d61 706c  verlay_comp_mapl
-0001a540: 6973 7428 7374 7275 6374 2c20 7465 6d70  ist(struct, temp
-0001a550: 6c61 7465 5f67 7269 6429 0a20 2020 2020  late_grid).     
-0001a560: 2020 206e 6320 3d20 7261 6e67 6528 6e63     nc = range(nc
-0001a570: 6f6d 7029 0a20 2020 2020 2020 2063 7061  omp).        cpa
-0001a580: 6972 203d 206c 6973 7428 6974 6572 746f  ir = list(iterto
-0001a590: 6f6c 732e 636f 6d62 696e 6174 696f 6e73  ols.combinations
-0001a5a0: 286e 632c 2032 2929 0a20 2020 2020 2020  (nc, 2)).       
-0001a5b0: 2073 636f 7265 203d 2030 2e30 0a20 2020   score = 0.0.   
-0001a5c0: 2020 2020 206e 5f6f 7665 726c 6170 5f76       n_overlap_v
-0001a5d0: 6f78 656c 203d 2030 0a20 2020 2020 2020  oxel = 0.       
-0001a5e0: 206f 7665 726c 6170 5f76 6f6c 756d 6520   overlap_volume 
-0001a5f0: 3d20 302e 300a 2020 2020 2020 2020 666f  = 0.0.        fo
-0001a600: 7220 6920 696e 2063 7061 6972 3a0a 2020  r i in cpair:.  
-0001a610: 2020 2020 2020 2020 2020 6e5f 6f76 6572            n_over
-0001a620: 6c61 705f 766f 7865 6c20 3d20 280a 2020  lap_voxel = (.  
-0001a630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a640: 2020 6f76 6572 6c61 795f 6d61 706c 6973    overlay_maplis
-0001a650: 745b 695b 305d 5d2e 6675 6c6c 4d61 7020  t[i[0]].fullMap 
-0001a660: 2a0a 2020 2020 2020 2020 2020 2020 2020  *.              
-0001a670: 2020 2020 2020 6f76 6572 6c61 795f 6d61        overlay_ma
-0001a680: 706c 6973 745b 695b 315d 5d2e 6675 6c6c  plist[i[1]].full
-0001a690: 4d61 700a 2020 2020 2020 2020 2020 2020  Map.            
-0001a6a0: 292e 7375 6d28 290a 2020 2020 2020 2020  ).sum().        
-0001a6b0: 2020 2020 6f76 6572 6c61 705f 766f 6c75      overlap_volu
-0001a6c0: 6d65 203d 2028 2861 7069 782e 7072 6f64  me = ((apix.prod
-0001a6d0: 2829 2920 2a20 6e5f 6f76 6572 6c61 705f  ()) * n_overlap_
-0001a6e0: 766f 7865 6c29 202a 2032 0a20 2020 2020  voxel) * 2.     
-0001a6f0: 2020 2020 2020 2063 6c61 7368 5f70 6572         clash_per
-0001a700: 6365 6e74 203d 2028 0a20 2020 2020 2020  cent = (.       
-0001a710: 2020 2020 2020 2020 2066 6c6f 6174 286f           float(o
-0001a720: 7665 726c 6170 5f76 6f6c 756d 6520 2f20  verlap_volume / 
-0001a730: 2863 766f 6c5b 695b 305d 5d20 2b20 6376  (cvol[i[0]] + cv
-0001a740: 6f6c 5b69 5b31 5d5d 2929 0a20 2020 2020  ol[i[1]])).     
-0001a750: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001a760: 2020 2020 2073 636f 7265 203d 2073 636f       score = sco
-0001a770: 7265 202b 2063 6c61 7368 5f70 6572 6365  re + clash_perce
-0001a780: 6e74 0a20 2020 2020 2020 2072 6574 7572  nt.        retur
-0001a790: 6e20 2d28 7363 6f72 6529 0a0a 2020 2020  n -(score)..    
-0001a7a0: 6465 6620 6765 745f 6f76 6572 6c61 795f  def get_overlay_
-0001a7b0: 636f 6d70 5f6d 6170 6c69 7374 2873 656c  comp_maplist(sel
-0001a7c0: 662c 2073 7472 7563 742c 2074 656d 706c  f, struct, templ
-0001a7d0: 6174 655f 6772 6964 293a 0a20 2020 2020  ate_grid):.     
-0001a7e0: 2020 2062 6c75 7272 6572 203d 2053 7472     blurrer = Str
-0001a7f0: 7563 7475 7265 426c 7572 7265 7228 290a  uctureBlurrer().
-0001a800: 2020 2020 2020 2020 6f76 6572 6c61 795f          overlay_
-0001a810: 6d61 706c 6973 7420 3d20 5b5d 0a20 2020  maplist = [].   
-0001a820: 2020 2020 2073 7370 6c69 7420 3d20 7374       ssplit = st
-0001a830: 7275 6374 2e73 706c 6974 5f69 6e74 6f5f  ruct.split_into_
-0001a840: 6368 6169 6e73 2829 0a20 2020 2020 2020  chains().       
-0001a850: 2066 6f72 2078 2069 6e20 7373 706c 6974   for x in ssplit
-0001a860: 3a0a 2020 2020 2020 2020 2020 2020 6f76  :.            ov
-0001a870: 6572 6c61 795f 6d61 706c 6973 742e 6170  erlay_maplist.ap
-0001a880: 7065 6e64 280a 2020 2020 2020 2020 2020  pend(.          
-0001a890: 2020 2020 2020 626c 7572 7265 722e 6d61        blurrer.ma
-0001a8a0: 6b65 5f61 746f 6d5f 6f76 6572 6c61 795f  ke_atom_overlay_
-0001a8b0: 6d61 7031 280a 2020 2020 2020 2020 2020  map1(.          
-0001a8c0: 2020 2020 2020 2020 2020 7465 6d70 6c61            templa
-0001a8d0: 7465 5f67 7269 642c 0a20 2020 2020 2020  te_grid,.       
-0001a8e0: 2020 2020 2020 2020 2020 2020 2078 2c0a               x,.
-0001a8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001a900: 290a 2020 2020 2020 2020 2020 2020 290a  ).            ).
-0001a910: 2020 2020 2020 2020 7265 7475 726e 206f          return o
-0001a920: 7665 726c 6179 5f6d 6170 6c69 7374 0a0a  verlay_maplist..
-0001a930: 2020 2020 6465 6620 6361 6c63 756c 6174      def calculat
-0001a940: 655f 616c 6370 7328 7365 6c66 2c20 7265  e_alcps(self, re
-0001a950: 665f 6368 6169 6e2c 2070 726f 6265 5f63  f_chain, probe_c
-0001a960: 6861 696e 293a 0a20 2020 2020 2020 2022  hain):.        "
-0001a970: 2222 0a20 2020 2020 2020 2043 616c 6375  "".        Calcu
-0001a980: 6c61 7465 2074 6865 2041 7263 204c 656e  late the Arc Len
-0001a990: 6774 6820 436f 6d70 6f6e 656e 7420 506c  gth Component Pl
-0001a9a0: 6163 656d 656e 7420 5363 6f72 6520 6265  acement Score be
-0001a9b0: 7477 6565 6e20 7477 6f20 6d6f 6465 6c73  tween two models
-0001a9c0: 2e0a 2020 2020 2020 2020 4765 6e65 7261  ..        Genera
-0001a9d0: 6c6c 792c 2074 6869 7320 7363 6f72 6520  lly, this score 
-0001a9e0: 6973 2063 616c 6375 6c61 7465 6420 6265  is calculated be
-0001a9f0: 7477 6565 6e20 696e 6469 7669 6475 616c  tween individual
-0001aa00: 2063 6861 696e 7320 696e 2061 0a20 2020   chains in a.   
-0001aa10: 2020 2020 2073 7472 7563 7475 7265 2e0a       structure..
-0001aa20: 0a20 2020 2020 2020 2049 6e70 7574 733a  .        Inputs:
-0001aa30: 0a20 2020 2020 2020 2020 2020 2072 6566  .            ref
-0001aa40: 5f63 6861 696e 3a0a 2020 2020 2020 2020  _chain:.        
-0001aa50: 2020 2020 2020 2020 4f6e 6520 6f66 2074          One of t
-0001aa60: 6865 2069 6e70 7574 2073 7472 7563 7475  he input structu
-0001aa70: 7265 2069 6e73 7461 6e63 6573 2062 6569  re instances bei
-0001aa80: 6e67 2063 6f6d 7061 7265 640a 2020 2020  ng compared.    
-0001aa90: 2020 2020 2020 2020 7072 6f62 655f 6368          probe_ch
-0001aaa0: 6169 6e3a 0a20 2020 2020 2020 2020 2020  ain:.           
-0001aab0: 2020 2020 2054 6865 206f 7468 6572 2069       The other i
-0001aac0: 6e70 7574 2073 7472 7563 7475 7265 2069  nput structure i
-0001aad0: 6e73 7461 6e63 6520 6265 696e 6720 636f  nstance being co
-0001aae0: 6d70 6172 6564 0a20 2020 2020 2020 204f  mpared.        O
-0001aaf0: 7574 7075 743a 0a20 2020 2020 2020 2020  utput:.         
-0001ab00: 2020 2061 6c63 7073 3a0a 2020 2020 2020     alcps:.      
-0001ab10: 2020 2020 2020 2020 2020 4172 6320 4c65            Arc Le
-0001ab20: 6e67 7468 2043 6f6d 706f 6e65 6e74 2050  ngth Component P
-0001ab30: 6c61 6365 6d65 6e74 2053 636f 7265 0a20  lacement Score. 
-0001ab40: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0001ab50: 2020 2020 6469 6666 5f76 6563 203d 2072      diff_vec = r
-0001ab60: 6566 5f63 6861 696e 2e43 6f4d 202d 2070  ef_chain.CoM - p
-0001ab70: 726f 6265 5f63 6861 696e 2e43 6f4d 0a20  robe_chain.CoM. 
-0001ab80: 2020 2020 2020 2072 203d 2064 6966 665f         r = diff_
-0001ab90: 7665 632e 6d6f 6428 290a 0a20 2020 2020  vec.mod()..     
-0001aba0: 2020 2072 6566 5f6d 6174 7269 7820 3d20     ref_matrix = 
-0001abb0: 7665 6374 6f72 2e67 6574 5f63 6f6f 7264  vector.get_coord
-0001abc0: 696e 6174 655f 6d61 7373 5f61 7272 6179  inate_mass_array
-0001abd0: 2872 6566 5f63 6861 696e 290a 2020 2020  (ref_chain).    
-0001abe0: 2020 2020 7072 6f62 655f 6d61 7472 6978      probe_matrix
-0001abf0: 203d 2076 6563 746f 722e 6765 745f 636f   = vector.get_co
-0001ac00: 6f72 6469 6e61 7465 5f6d 6173 735f 6172  ordinate_mass_ar
-0001ac10: 7261 7928 7072 6f62 655f 6368 6169 6e29  ray(probe_chain)
-0001ac20: 0a0a 2020 2020 2020 2020 726f 7461 7469  ..        rotati
-0001ac30: 6f6e 5f6d 6174 7269 782c 205f 7420 3d20  on_matrix, _t = 
-0001ac40: 7665 6374 6f72 2e67 6574 5f74 7261 6e73  vector.get_trans
-0001ac50: 666f 726d 2872 6566 5f6d 6174 7269 782c  form(ref_matrix,
-0001ac60: 2070 726f 6265 5f6d 6174 7269 7829 0a0a   probe_matrix)..
-0001ac70: 2020 2020 2020 2020 7468 6574 612c 206e          theta, n
-0001ac80: 312c 206e 322c 206e 3320 3d20 7665 6374  1, n2, n3 = vect
-0001ac90: 6f72 2e5f 726f 746d 6174 5f74 6f5f 6178  or._rotmat_to_ax
-0001aca0: 6973 616e 676c 6528 726f 7461 7469 6f6e  isangle(rotation
-0001acb0: 5f6d 6174 7269 7829 0a20 2020 2020 2020  _matrix).       
-0001acc0: 2074 6865 7461 203d 206d 6174 682e 6465   theta = math.de
-0001acd0: 6772 6565 7328 7468 6574 6129 0a0a 2020  grees(theta)..  
-0001ace0: 2020 2020 2020 616c 6370 7320 3d20 3220        alcps = 2 
-0001acf0: 2a20 6d61 7468 2e70 6920 2a20 7220 2a20  * math.pi * r * 
-0001ad00: 7468 6574 6120 2f20 3336 300a 0a20 2020  theta / 360..   
-0001ad10: 2020 2020 2072 6574 7572 6e20 616c 6370       return alcp
-0001ad20: 730a 0a20 2020 2064 6566 2067 6574 5f6c  s..    def get_l
-0001ad30: 6f67 3130 5f61 6c63 7073 2873 656c 662c  og10_alcps(self,
-0001ad40: 2072 6566 5f63 6861 696e 2c20 7072 6f62   ref_chain, prob
-0001ad50: 655f 6368 6169 6e2c 206c 6f77 6573 745f  e_chain, lowest_
-0001ad60: 7661 6c75 653d 2d32 293a 0a20 2020 2020  value=-2):.     
-0001ad70: 2020 2022 2222 0a20 2020 2020 2020 2043     """.        C
-0001ad80: 616c 6375 6c61 7465 2074 6865 206c 6f67  alculate the log
-0001ad90: 3130 206f 6620 7468 6520 414c 4350 5320  10 of the ALCPS 
-0001ada0: 7363 6f72 652e 0a0a 2020 2020 2020 2020  score...        
-0001adb0: 496e 7075 7473 3a0a 2020 2020 2020 2020  Inputs:.        
-0001adc0: 2020 2020 7265 665f 6368 6169 6e3a 0a20      ref_chain:. 
-0001add0: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-0001ade0: 6566 6572 656e 6365 2073 7472 7563 7475  eference structu
-0001adf0: 7265 2069 6e73 7461 6e63 650a 2020 2020  re instance.    
-0001ae00: 2020 2020 2020 2020 7072 6f62 655f 6368          probe_ch
-0001ae10: 6169 6e3a 0a20 2020 2020 2020 2020 2020  ain:.           
-0001ae20: 2020 2020 2050 726f 6265 2073 7472 7563       Probe struc
-0001ae30: 7475 7265 2069 6e73 7461 6e63 650a 2020  ture instance.  
-0001ae40: 2020 2020 2020 2020 2020 6c6f 7765 7374            lowest
-0001ae50: 5f76 616c 7565 3a0a 2020 2020 2020 2020  _value:.        
-0001ae60: 2020 2020 2020 2020 5661 6c75 6520 746f          Value to
-0001ae70: 2075 7365 2069 6620 7477 6f20 7374 7275   use if two stru
-0001ae80: 6374 7572 6573 2061 7265 2070 6572 6665  ctures are perfe
-0001ae90: 6374 6c79 2061 6c69 676e 6564 2028 692e  ctly aligned (i.
-0001aea0: 652e 2069 660a 2020 2020 2020 2020 2020  e. if.          
-0001aeb0: 2020 2020 2020 616c 6370 7320 3d20 3029        alcps = 0)
-0001aec0: 202d 2064 6566 6175 6c74 2076 616c 7565   - default value
-0001aed0: 2069 7320 2d32 0a20 2020 2020 2020 204f   is -2.        O
-0001aee0: 7574 7075 7473 3a0a 2020 2020 2020 2020  utputs:.        
-0001aef0: 2020 2020 6c6f 6731 3028 616c 6370 7329      log10(alcps)
-0001af00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001af10: 2020 6c6f 6731 3020 6f66 2074 6865 2041    log10 of the A
-0001af20: 4c43 5053 0a20 2020 2020 2020 2020 2020  LCPS.           
-0001af30: 206c 6f77 6573 745f 7661 6c75 653a 0a20   lowest_value:. 
-0001af40: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0001af50: 6574 7572 6e65 6420 6966 2041 4c43 5053  eturned if ALCPS
-0001af60: 203d 2030 2c20 6465 6661 756c 7420 7661   = 0, default va
-0001af70: 6c75 6520 6973 202d 320a 2020 2020 2020  lue is -2.      
-0001af80: 2020 2222 220a 0a20 2020 2020 2020 2061    """..        a
-0001af90: 6c63 7073 203d 2073 656c 662e 6361 6c63  lcps = self.calc
-0001afa0: 756c 6174 655f 616c 6370 7328 7265 665f  ulate_alcps(ref_
-0001afb0: 6368 6169 6e2c 2070 726f 6265 5f63 6861  chain, probe_cha
-0001afc0: 696e 290a 0a20 2020 2020 2020 2069 6620  in)..        if 
-0001afd0: 616c 6370 7320 3d3d 2030 2e30 3a0a 2020  alcps == 0.0:.  
-0001afe0: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001aff0: 206c 6f77 6573 745f 7661 6c75 650a 2020   lowest_value.  
-0001b000: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0001b010: 2020 2020 2020 2020 7265 7475 726e 206d          return m
-0001b020: 6174 682e 6c6f 6731 3028 616c 6370 7329  ath.log10(alcps)
-0001b030: 0a0a 2020 2020 6465 6620 5f67 6574 5f6d  ..    def _get_m
-0001b040: 6178 5f64 6973 7461 6e63 655f 6265 7477  ax_distance_betw
-0001b050: 6565 6e5f 7265 7369 6475 6573 2861 746f  een_residues(ato
-0001b060: 6d73 293a 0a0a 2020 2020 2020 2020 6d61  ms):..        ma
-0001b070: 785f 6469 7374 203d 2030 0a20 2020 2020  x_dist = 0.     
-0001b080: 2020 2061 746f 6d5f 6c69 7374 203d 2061     atom_list = a
-0001b090: 746f 6d73 5b3a 5d0a 2020 2020 2020 2020  toms[:].        
-0001b0a0: 666f 7220 6174 6f6d 2069 6e20 6174 6f6d  for atom in atom
-0001b0b0: 733a 0a20 2020 2020 2020 2020 2020 2061  s:.            a
-0001b0c0: 746f 6d5f 6c69 7374 2e70 6f70 2861 746f  tom_list.pop(ato
-0001b0d0: 6d5f 6c69 7374 2e69 6e64 6578 2861 746f  m_list.index(ato
-0001b0e0: 6d29 290a 2020 2020 2020 2020 2020 2020  m)).            
-0001b0f0: 666f 7220 6174 6f6d 3220 696e 2061 746f  for atom2 in ato
-0001b100: 6d5f 6c69 7374 3a0a 2020 2020 2020 2020  m_list:.        
-0001b110: 2020 2020 2020 2020 7665 6320 3d20 6e70          vec = np
-0001b120: 2e6c 696e 616c 672e 6e6f 726d 285b 6174  .linalg.norm([at
-0001b130: 6f6d 2e78 2c20 6174 6f6d 2e79 2c20 6174  om.x, atom.y, at
-0001b140: 6f6d 2e7a 5d2c 0a20 2020 2020 2020 2020  om.z],.         
+00019250: 2020 2020 206e 702e 6d65 616e 280a 2020       np.mean(.  
+00019260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019270: 2020 2020 2020 2020 2020 6e70 2e73 7175            np.squ
+00019280: 6172 6528 6162 7328 6674 312e 6675 6c6c  are(abs(ft1.full
+00019290: 4d61 705b 6673 6865 6c6c 7331 5d29 290a  Map[fshells1])).
+000192a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+000192c0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+000192d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000192e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000192f0: 2020 6c66 7265 712e 6170 7065 6e64 2828    lfreq.append((
+00019300: 6869 6768 6c65 7665 6c20 2b20 7374 6570  highlevel + step
+00019310: 202f 2032 2929 0a20 2020 2020 2020 2020   / 2)).         
+00019320: 2020 2020 2020 2062 7265 616b 0a20 2020         break.   
+00019330: 2020 2020 2020 2020 2078 203d 2068 6967           x = hig
+00019340: 686c 6576 656c 0a20 2020 2020 2020 2020  hlevel.         
+00019350: 2020 2068 6967 686c 6576 656c 203d 2078     highlevel = x
+00019360: 202b 2073 7465 700a 2020 2020 2020 2020   + step.        
+00019370: 2320 6c6f 7720 7061 7373 2066 696c 7465  # low pass filte
+00019380: 7220 6166 7465 723f 0a20 2020 2020 2020  r after?.       
+00019390: 2023 206c 6f77 2070 6173 7320 6669 6c74   # low pass filt
+000193a0: 6572 2062 6566 6f72 6520 7363 616c 696e  er before scalin
+000193b0: 670a 2020 2020 2020 2020 6966 2072 6573  g.        if res
+000193c0: 6f20 6973 206e 6f74 204e 6f6e 653a 0a20  o is not None:. 
+000193d0: 2020 2020 2020 2020 2020 2069 6620 6c70             if lp
+000193e0: 6669 6c74 6120 616e 6420 6e6f 7420 6c70  filta and not lp
+000193f0: 6669 6c74 623a 0a20 2020 2020 2020 2020  filtb:.         
+00019400: 2020 2020 2020 2066 7431 2e5f 7461 6e68         ft1._tanh
+00019410: 5f6c 6f77 7061 7373 2863 7574 6f66 6631  _lowpass(cutoff1
+00019420: 2c20 6661 6c6c 3d30 2e32 2c20 6674 6d61  , fall=0.2, ftma
+00019430: 703d 5472 7565 290a 2020 2020 2020 2020  p=True).        
+00019440: 2020 2020 2020 2020 6674 322e 5f74 616e          ft2._tan
+00019450: 685f 6c6f 7770 6173 7328 6375 746f 6666  h_lowpass(cutoff
+00019460: 322c 2066 616c 6c3d 302e 322c 2066 746d  2, fall=0.2, ftm
+00019470: 6170 3d54 7275 6529 0a20 2020 2020 2020  ap=True).       
+00019480: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+00019490: 2020 6966 2070 7966 6674 775f 666c 6167    if pyfftw_flag
+000194a0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000194b0: 2020 2020 2020 2072 6169 7365 2049 6d70         raise Imp
+000194c0: 6f72 7445 7272 6f72 0a20 2020 2020 2020  ortError.       
+000194d0: 2020 2020 2069 6666 7420 3d20 7079 6666       ifft = pyff
+000194e0: 7477 2e46 4654 5728 0a20 2020 2020 2020  tw.FFTW(.       
+000194f0: 2020 2020 2020 2020 2069 6e70 7574 6131           inputa1
+00019500: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00019510: 2020 6f75 7470 7574 6131 2c0a 2020 2020    outputa1,.    
+00019520: 2020 2020 2020 2020 2020 2020 6469 7265              dire
+00019530: 6374 696f 6e3d 2746 4654 575f 4241 434b  ction='FFTW_BACK
+00019540: 5741 5244 272c 0a20 2020 2020 2020 2020  WARD',.         
+00019550: 2020 2020 2020 2061 7865 733d 2830 2c20         axes=(0, 
+00019560: 312c 2032 292c 0a20 2020 2020 2020 2020  1, 2),.         
+00019570: 2020 2020 2020 2066 6c61 6773 3d5b 2746         flags=['F
+00019580: 4654 575f 4553 5449 4d41 5445 275d 2c0a  FTW_ESTIMATE'],.
+00019590: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000195a0: 2020 2020 2020 2020 2020 696e 7075 7461            inputa
+000195b0: 315b 3a2c 203a 2c20 3a5d 203d 2069 6666  1[:, :, :] = iff
+000195c0: 7473 6869 6674 2866 7431 2e66 756c 6c4d  tshift(ft1.fullM
+000195d0: 6170 295b 3a2c 203a 2c20 3a5d 0a20 2020  ap)[:, :, :].   
+000195e0: 2020 2020 2020 2020 2069 6666 7428 290a           ifft().
+000195f0: 2020 2020 2020 2020 2020 2020 6d61 7031              map1
+00019600: 5f66 696c 7420 3d20 4d61 7028 0a20 2020  _filt = Map(.   
+00019610: 2020 2020 2020 2020 2020 2020 206f 7574               out
+00019620: 7075 7461 312e 7265 616c 2e61 7374 7970  puta1.real.astyp
+00019630: 6528 2766 6c6f 6174 2729 2c0a 2020 2020  e('float'),.    
+00019640: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+00019650: 312e 6f72 6967 696e 2c0a 2020 2020 2020  1.origin,.      
+00019660: 2020 2020 2020 2020 2020 6d61 705f 312e            map_1.
+00019670: 6170 6978 2c0a 2020 2020 2020 2020 2020  apix,.          
+00019680: 2020 2020 2020 6d61 705f 312e 6669 6c65        map_1.file
+00019690: 6e61 6d65 2c0a 2020 2020 2020 2020 2020  name,.          
+000196a0: 2020 2020 2020 6d61 705f 312e 6865 6164        map_1.head
+000196b0: 6572 5b3a 5d2c 0a20 2020 2020 2020 2020  er[:],.         
+000196c0: 2020 2029 0a20 2020 2020 2020 2065 7863     ).        exc
+000196d0: 6570 7420 4578 6365 7074 696f 6e3a 0a20  ept Exception:. 
+000196e0: 2020 2020 2020 2020 2020 2023 2075 7365             # use
+000196f0: 206e 756d 7079 2069 6666 7420 696e 7374   numpy ifft inst
+00019700: 6561 640a 2020 2020 2020 2020 2020 2020  ead.            
+00019710: 6d61 7031 5f66 696c 7420 3d20 6d61 705f  map1_filt = map_
+00019720: 312e 636f 7079 2829 0a20 2020 2020 2020  1.copy().       
+00019730: 2020 2020 206d 6170 315f 6669 6c74 2e66       map1_filt.f
+00019740: 756c 6c4d 6170 203d 206e 702e 7265 616c  ullMap = np.real
+00019750: 2869 6666 746e 2869 6666 7473 6869 6674  (ifftn(ifftshift
+00019760: 2866 7431 2e66 756c 6c4d 6170 2929 290a  (ft1.fullMap))).
+00019770: 2020 2020 2020 2020 7472 793a 0a20 2020          try:.   
+00019780: 2020 2020 2020 2020 2069 6620 7079 6666           if pyff
+00019790: 7477 5f66 6c61 6720 3d3d 2030 3a0a 2020  tw_flag == 0:.  
+000197a0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000197b0: 6973 6520 496d 706f 7274 4572 726f 720a  ise ImportError.
+000197c0: 2020 2020 2020 2020 2020 2020 6966 6674              ifft
+000197d0: 203d 2070 7966 6674 772e 4646 5457 280a   = pyfftw.FFTW(.
+000197e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000197f0: 696e 7075 7461 322c 0a20 2020 2020 2020  inputa2,.       
+00019800: 2020 2020 2020 2020 206f 7574 7075 7461           outputa
+00019810: 322c 0a20 2020 2020 2020 2020 2020 2020  2,.             
+00019820: 2020 2064 6972 6563 7469 6f6e 3d27 4646     direction='FF
+00019830: 5457 5f42 4143 4b57 4152 4427 2c0a 2020  TW_BACKWARD',.  
+00019840: 2020 2020 2020 2020 2020 2020 2020 6178                ax
+00019850: 6573 3d28 302c 2031 2c20 3229 2c0a 2020  es=(0, 1, 2),.  
+00019860: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+00019870: 6167 733d 5b27 4646 5457 5f45 5354 494d  ags=['FFTW_ESTIM
+00019880: 4154 4527 5d2c 0a20 2020 2020 2020 2020  ATE'],.         
+00019890: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000198a0: 2069 6e70 7574 6132 5b3a 2c20 3a2c 203a   inputa2[:, :, :
+000198b0: 5d20 3d20 6966 6674 7368 6966 7428 6674  ] = ifftshift(ft
+000198c0: 322e 6675 6c6c 4d61 7029 5b3a 2c20 3a2c  2.fullMap)[:, :,
+000198d0: 203a 5d0a 2020 2020 2020 2020 2020 2020   :].            
+000198e0: 6966 6674 2829 0a20 2020 2020 2020 2020  ifft().         
+000198f0: 2020 206d 6170 325f 6669 6c74 203d 204d     map2_filt = M
+00019900: 6170 280a 2020 2020 2020 2020 2020 2020  ap(.            
+00019910: 2020 2020 6f75 7470 7574 6132 2e72 6561      outputa2.rea
+00019920: 6c2e 6173 7479 7065 2827 666c 6f61 7427  l.astype('float'
+00019930: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
+00019940: 2020 206d 6170 5f32 2e6f 7269 6769 6e2c     map_2.origin,
+00019950: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019960: 206d 6170 5f32 2e61 7069 782c 0a20 2020   map_2.apix,.   
+00019970: 2020 2020 2020 2020 2020 2020 206d 6170               map
+00019980: 5f32 2e66 696c 656e 616d 652c 0a20 2020  _2.filename,.   
+00019990: 2020 2020 2020 2020 2020 2020 206d 6170               map
+000199a0: 5f32 2e68 6561 6465 725b 3a5d 2c0a 2020  _2.header[:],.  
+000199b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000199c0: 2020 2020 6578 6365 7074 2045 7863 6570      except Excep
+000199d0: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+000199e0: 2020 6d61 7032 5f66 696c 7420 3d20 6d61    map2_filt = ma
+000199f0: 705f 322e 636f 7079 2829 0a20 2020 2020  p_2.copy().     
+00019a00: 2020 2020 2020 206d 6170 325f 6669 6c74         map2_filt
+00019a10: 2e66 756c 6c4d 6170 203d 206e 702e 7265  .fullMap = np.re
+00019a20: 616c 2869 6666 746e 2869 6666 7473 6869  al(ifftn(ifftshi
+00019a30: 6674 2866 7432 2e66 756c 6c4d 6170 2929  ft(ft2.fullMap))
+00019a40: 290a 2020 2020 2020 2020 7472 793a 0a20  ).        try:. 
+00019a50: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00019a60: 7420 6d61 7470 6c6f 746c 6962 0a20 2020  t matplotlib.   
+00019a70: 2020 2020 2020 2020 206d 6174 706c 6f74           matplot
+00019a80: 6c69 622e 7573 6528 2741 6767 2729 0a20  lib.use('Agg'). 
+00019a90: 2020 2020 2020 2020 2020 2069 6d70 6f72             impor
+00019aa0: 7420 6d61 7470 6c6f 746c 6962 2e70 7970  t matplotlib.pyp
+00019ab0: 6c6f 7420 6173 2070 6c74 0a20 2020 2020  lot as plt.     
+00019ac0: 2020 2020 2020 2066 726f 6d20 6d61 7470         from matp
+00019ad0: 6c6f 746c 6962 2069 6d70 6f72 7420 7079  lotlib import py
+00019ae0: 6c61 620a 2020 2020 2020 2020 2020 2020  lab.            
+00019af0: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00019b00: 2020 2020 2070 6c74 2e73 7479 6c65 2e75       plt.style.u
+00019b10: 7365 2827 6767 706c 6f74 2729 0a20 2020  se('ggplot').   
+00019b20: 2020 2020 2020 2020 2065 7863 6570 7420           except 
+00019b30: 4174 7472 6962 7574 6545 7272 6f72 3a0a  AttributeError:.
+00019b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019b50: 7061 7373 0a20 2020 2020 2020 2020 2020  pass.           
+00019b60: 2070 6c74 2e72 6350 6172 616d 732e 7570   plt.rcParams.up
+00019b70: 6461 7465 287b 2766 6f6e 742e 7369 7a65  date({'font.size
+00019b80: 273a 2031 387d 290a 2020 2020 2020 2020  ': 18}).        
+00019b90: 2020 2020 706c 742e 7263 5061 7261 6d73      plt.rcParams
+00019ba0: 2e75 7064 6174 6528 7b27 6c65 6765 6e64  .update({'legend
+00019bb0: 2e66 6f6e 7473 697a 6527 3a20 3138 7d29  .fontsize': 18})
+00019bc0: 0a20 2020 2020 2020 2020 2020 2070 6c74  .            plt
+00019bd0: 2e70 6c6f 7428 6c66 7265 712c 2066 7431  .plot(lfreq, ft1
+00019be0: 5f61 7667 2c20 2772 2d2d 272c 206c 6162  _avg, 'r--', lab
+00019bf0: 656c 3d27 6d61 7031 2729 0a20 2020 2020  el='map1').     
+00019c00: 2020 2020 2020 2070 6c74 2e70 6c6f 7428         plt.plot(
+00019c10: 6c66 7265 712c 2066 7432 5f61 7667 2c20  lfreq, ft2_avg, 
+00019c20: 2762 7327 2c20 6c61 6265 6c3d 276d 6170  'bs', label='map
+00019c30: 3227 290a 2020 2020 2020 2020 2020 2020  2').            
+00019c40: 706c 742e 706c 6f74 286c 6672 6571 2c20  plt.plot(lfreq, 
+00019c50: 6674 315f 6176 675f 6e65 772c 2027 675e  ft1_avg_new, 'g^
+00019c60: 272c 206c 6162 656c 3d27 7363 616c 6564  ', label='scaled
+00019c70: 2729 0a20 2020 2020 2020 2020 2020 206c  ').            l
+00019c80: 6567 203d 2070 6c74 2e6c 6567 656e 6428  eg = plt.legend(
+00019c90: 6c6f 633d 2775 7070 6572 2072 6967 6874  loc='upper right
+00019ca0: 2729 0a20 2020 2020 2020 2020 2020 2066  ').            f
+00019cb0: 6f72 206c 6567 6f62 6a20 696e 206c 6567  or legobj in leg
+00019cc0: 2e6c 6567 656e 6448 616e 646c 6573 3a0a  .legendHandles:.
+00019cd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019ce0: 6c65 676f 626a 2e73 6574 5f6c 696e 6577  legobj.set_linew
+00019cf0: 6964 7468 2832 2e30 290a 2020 2020 2020  idth(2.0).      
+00019d00: 2020 2020 2020 7079 6c61 622e 7361 7665        pylab.save
+00019d10: 6669 6728 2273 7065 6374 7261 2e70 6e67  fig("spectra.png
+00019d20: 2229 0a20 2020 2020 2020 2020 2020 2070  ").            p
+00019d30: 6c74 2e63 6c6f 7365 2829 0a20 2020 2020  lt.close().     
+00019d40: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00019d50: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
+00019d60: 2070 6173 730a 2020 2020 2020 2020 7265   pass.        re
+00019d70: 7475 726e 206d 6170 315f 6669 6c74 2e66  turn map1_filt.f
+00019d80: 756c 6c4d 6170 2c20 6d61 7032 5f66 696c  ullMap, map2_fil
+00019d90: 742e 6675 6c6c 4d61 700a 0a20 2020 2064  t.fullMap..    d
+00019da0: 6566 2067 6574 5f63 6c61 7368 5f6d 6170  ef get_clash_map
+00019db0: 2873 656c 662c 2065 6d6d 6170 2c20 6170  (self, emmap, ap
+00019dc0: 6978 293a 0a20 2020 2020 2020 2074 656d  ix):.        tem
+00019dd0: 706c 6174 655f 6772 6964 203d 2065 6d6d  plate_grid = emm
+00019de0: 6170 2e5f 6d61 6b65 5f63 6c61 7368 5f6d  ap._make_clash_m
+00019df0: 6170 2861 7069 7829 0a20 2020 2020 2020  ap(apix).       
+00019e00: 2072 6574 7572 6e20 7465 6d70 6c61 7465   return template
+00019e10: 5f67 7269 640a 0a20 2020 2064 6566 2067  _grid..    def g
+00019e20: 6574 5f73 6d5f 7363 6f72 6528 0a20 2020  et_sm_score(.   
+00019e30: 2020 2020 2020 2020 2073 656c 662c 0a20           self,. 
+00019e40: 2020 2020 2020 2020 2020 2073 7472 7563             struc
+00019e50: 742c 0a20 2020 2020 2020 2020 2020 206e  t,.            n
+00019e60: 636f 6d70 2c0a 2020 2020 2020 2020 2020  comp,.          
+00019e70: 2020 7465 6d70 6c61 7465 5f67 7269 642c    template_grid,
+00019e80: 0a20 2020 2020 2020 2020 2020 2063 766f  .            cvo
+00019e90: 6c2c 0a20 2020 2020 2020 2020 2020 2061  l,.            a
+00019ea0: 7069 782c 0a20 2020 2029 3a0a 2020 2020  pix,.    ):.    
+00019eb0: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
+00019ec0: 2074 6865 2063 6c61 7368 2073 636f 7265   the clash score
+00019ed0: 2062 6574 7765 656e 2063 6861 696e 7320   between chains 
+00019ee0: 7769 7468 696e 2061 2070 726f 7465 696e  within a protein
+00019ef0: 206d 6f64 656c 0a0a 2020 2020 2020 2020   model..        
+00019f00: 5468 6520 636c 6173 6820 7363 6f72 6520  The clash score 
+00019f10: 6361 6c63 756c 6174 6573 2074 6865 2061  calculates the a
+00019f20: 6d6f 756e 7420 7468 6174 2063 6861 696e  mount that chain
+00019f30: 7320 696e 2061 2070 726f 7465 696e 206f  s in a protein o
+00019f40: 7665 726c 6170 0a20 2020 2020 2020 206f  verlap.        o
+00019f50: 6e65 2061 6e6f 7468 6572 2e20 5468 6520  ne another. The 
+00019f60: 7374 7275 6374 7572 6520 6973 206d 6170  structure is map
+00019f70: 7065 6420 696e 746f 2064 6973 6372 6574  ped into discret
+00019f80: 6520 6269 6e73 2069 6e20 3344 2073 7061  e bins in 3D spa
+00019f90: 6365 2c0a 2020 2020 2020 2020 6465 6669  ce,.        defi
+00019fa0: 6e65 6420 6279 2074 6865 2074 656d 706c  ned by the templ
+00019fb0: 6174 655f 6772 6964 2069 6e70 7574 2e20  ate_grid input. 
+00019fc0: 5468 6520 7363 6f72 6520 6973 2070 726f  The score is pro
+00019fd0: 706f 7274 696f 6e61 6c20 746f 2074 6865  portional to the
+00019fe0: 0a20 2020 2020 2020 206e 756d 6265 7220  .        number 
+00019ff0: 6f66 2074 6865 7365 2062 696e 7320 6f63  of these bins oc
+0001a000: 6375 7069 6564 2062 7920 6d6f 7265 2074  cupied by more t
+0001a010: 6861 6e20 6f6e 6520 6f66 2074 6865 2070  han one of the p
+0001a020: 726f 7465 696e 2063 6861 696e 732e 0a0a  rotein chains...
+0001a030: 2020 2020 2020 2020 5265 636f 6d6d 656e          Recommen
+0001a040: 6465 6420 7069 7865 6c20 7370 6163 696e  ded pixel spacin
+0001a050: 6720 6f66 2074 6865 2074 656d 706c 6174  g of the templat
+0001a060: 655f 6772 6964 2069 7320 332e 3520 c385  e_grid is 3.5 ..
+0001a070: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+0001a080: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0001a090: 7563 743a 2053 7472 7563 7475 7265 2069  uct: Structure i
+0001a0a0: 6e73 7461 6e63 652e 0a20 2020 2020 2020  nstance..       
+0001a0b0: 2020 2020 206e 636f 6d70 3a20 4e75 6d62       ncomp: Numb
+0001a0c0: 6572 206f 6620 6368 6169 6e73 2069 6e20  er of chains in 
+0001a0d0: 7468 6520 7374 7275 6374 7572 652e 0a20  the structure.. 
+0001a0e0: 2020 2020 2020 2020 2020 2074 656d 706c             templ
+0001a0f0: 6174 655f 6772 6964 3a20 4d61 7020 6f62  ate_grid: Map ob
+0001a100: 6a65 6374 2077 6974 6820 656d 7074 7920  ject with empty 
+0001a110: 3344 2d67 7269 6420 2866 696c 6c65 6420  3D-grid (filled 
+0001a120: 7769 7468 207a 6572 6f73 292e 0a20 2020  with zeros)..   
+0001a130: 2020 2020 2020 2020 2020 2020 2054 6869               Thi
+0001a140: 7320 6361 6e20 6265 2063 616c 6375 6c61  s can be calcula
+0001a150: 7465 6420 7573 696e 670a 2020 2020 2020  ted using.      
+0001a160: 2020 2020 2020 2020 2020 3a6d 6574 683a            :meth:
+0001a170: 6053 7472 7563 7475 7265 426c 7572 7265  `StructureBlurre
+0001a180: 722e 7072 6f74 4d61 7020 3c54 454d 5079  r.protMap <TEMPy
+0001a190: 2e70 726f 7465 696e 2e73 7472 7563 7475  .protein.structu
+0001a1a0: 7265 5f62 6c75 7272 6572 2e53 7472 7563  re_blurrer.Struc
+0001a1b0: 7475 7265 426c 7572 7265 722e 7072 6f74  tureBlurrer.prot
+0001a1c0: 4d61 703e 600a 2020 2020 2020 2020 2020  Map>`.          
+0001a1d0: 2020 6376 6f6c 3a20 4c69 7374 2063 6f6e    cvol: List con
+0001a1e0: 7461 696e 696e 6720 7468 6520 766f 6c75  taining the volu
+0001a1f0: 6d65 206f 6620 6561 6368 2063 6861 696e  me of each chain
+0001a200: 2e20 5468 6973 2063 616e 2062 650a 2020  . This can be.  
+0001a210: 2020 2020 2020 2020 2020 2020 2020 6361                ca
+0001a220: 6c63 756c 6174 6564 2075 7369 6e67 0a20  lculated using. 
+0001a230: 2020 2020 2020 2020 2020 2020 2020 203a                 :
+0001a240: 6d65 7468 3a60 4d61 702e 5f67 6574 5f63  meth:`Map._get_c
+0001a250: 6f6d 706f 6e65 6e74 5f76 6f6c 756d 6573  omponent_volumes
+0001a260: 203c 5445 4d50 792e 6d61 7073 2e65 6d5f   <TEMPy.maps.em_
+0001a270: 6d61 702e 4d61 702e 5f67 6574 5f63 6f6d  map.Map._get_com
+0001a280: 706f 6e65 6e74 5f76 6f6c 756d 6573 3e60  ponent_volumes>`
+0001a290: 0a20 2020 2020 2020 2020 2020 2061 7069  .            api
+0001a2a0: 783a 2050 6978 656c 2073 697a 6520 6f66  x: Pixel size of
+0001a2b0: 2074 656d 706c 6174 655f 6772 6964 2c20   template_grid, 
+0001a2c0: 7573 6564 2066 6f72 2073 6361 6c69 6e67  used for scaling
+0001a2d0: 2074 6865 2076 6f6c 756d 650a 2020 2020   the volume.    
+0001a2e0: 2020 2020 2020 2020 2020 2020 6361 6c63              calc
+0001a2f0: 756c 6174 696f 6e73 2e0a 0a20 2020 2020  ulations...     
+0001a300: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+0001a310: 2020 2020 2020 2020 5468 6520 636c 6173          The clas
+0001a320: 6820 7363 6f72 6520 666f 7220 7468 6520  h score for the 
+0001a330: 7374 7275 6374 7572 6520 2863 6c6f 7365  structure (close
+0001a340: 2074 6f20 3020 6973 2067 6f6f 642c 206c   to 0 is good, l
+0001a350: 6172 6765 0a20 2020 2020 2020 2020 2020  arge.           
+0001a360: 206e 6567 6174 6976 6520 7363 6f72 6520   negative score 
+0001a370: 6973 2062 6164 290a 2020 2020 2020 2020  is bad).        
+0001a380: 2222 220a 2020 2020 2020 2020 6f76 6572  """.        over
+0001a390: 6c61 795f 6d61 706c 6973 7420 3d20 5b5d  lay_maplist = []
+0001a3a0: 0a20 2020 2020 2020 206f 7665 726c 6179  .        overlay
+0001a3b0: 5f6d 6170 6c69 7374 203d 2073 656c 662e  _maplist = self.
+0001a3c0: 6765 745f 6f76 6572 6c61 795f 636f 6d70  get_overlay_comp
+0001a3d0: 5f6d 6170 6c69 7374 2873 7472 7563 742c  _maplist(struct,
+0001a3e0: 2074 656d 706c 6174 655f 6772 6964 290a   template_grid).
+0001a3f0: 2020 2020 2020 2020 6e63 203d 2072 616e          nc = ran
+0001a400: 6765 286e 636f 6d70 290a 2020 2020 2020  ge(ncomp).      
+0001a410: 2020 6370 6169 7220 3d20 6c69 7374 2869    cpair = list(i
+0001a420: 7465 7274 6f6f 6c73 2e63 6f6d 6269 6e61  tertools.combina
+0001a430: 7469 6f6e 7328 6e63 2c20 3229 290a 2020  tions(nc, 2)).  
+0001a440: 2020 2020 2020 7363 6f72 6520 3d20 302e        score = 0.
+0001a450: 300a 2020 2020 2020 2020 6e5f 6f76 6572  0.        n_over
+0001a460: 6c61 705f 766f 7865 6c20 3d20 300a 2020  lap_voxel = 0.  
+0001a470: 2020 2020 2020 6f76 6572 6c61 705f 766f        overlap_vo
+0001a480: 6c75 6d65 203d 2030 2e30 0a20 2020 2020  lume = 0.0.     
+0001a490: 2020 2066 6f72 2069 2069 6e20 6370 6169     for i in cpai
+0001a4a0: 723a 0a20 2020 2020 2020 2020 2020 206e  r:.            n
+0001a4b0: 5f6f 7665 726c 6170 5f76 6f78 656c 203d  _overlap_voxel =
+0001a4c0: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+0001a4d0: 2020 2020 2020 206f 7665 726c 6179 5f6d         overlay_m
+0001a4e0: 6170 6c69 7374 5b69 5b30 5d5d 2e66 756c  aplist[i[0]].ful
+0001a4f0: 6c4d 6170 202a 0a20 2020 2020 2020 2020  lMap *.         
+0001a500: 2020 2020 2020 2020 2020 206f 7665 726c             overl
+0001a510: 6179 5f6d 6170 6c69 7374 5b69 5b31 5d5d  ay_maplist[i[1]]
+0001a520: 2e66 756c 6c4d 6170 0a20 2020 2020 2020  .fullMap.       
+0001a530: 2020 2020 2029 2e73 756d 2829 0a20 2020       ).sum().   
+0001a540: 2020 2020 2020 2020 206f 7665 726c 6170           overlap
+0001a550: 5f76 6f6c 756d 6520 3d20 2828 6170 6978  _volume = ((apix
+0001a560: 2e70 726f 6428 2929 202a 206e 5f6f 7665  .prod()) * n_ove
+0001a570: 726c 6170 5f76 6f78 656c 2920 2a20 320a  rlap_voxel) * 2.
+0001a580: 2020 2020 2020 2020 2020 2020 636c 6173              clas
+0001a590: 685f 7065 7263 656e 7420 3d20 280a 2020  h_percent = (.  
+0001a5a0: 2020 2020 2020 2020 2020 2020 2020 666c                fl
+0001a5b0: 6f61 7428 6f76 6572 6c61 705f 766f 6c75  oat(overlap_volu
+0001a5c0: 6d65 202f 2028 6376 6f6c 5b69 5b30 5d5d  me / (cvol[i[0]]
+0001a5d0: 202b 2063 766f 6c5b 695b 315d 5d29 290a   + cvol[i[1]])).
+0001a5e0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001a5f0: 2020 2020 2020 2020 2020 7363 6f72 6520            score 
+0001a600: 3d20 7363 6f72 6520 2b20 636c 6173 685f  = score + clash_
+0001a610: 7065 7263 656e 740a 2020 2020 2020 2020  percent.        
+0001a620: 7265 7475 726e 202d 2873 636f 7265 290a  return -(score).
+0001a630: 0a20 2020 2064 6566 2067 6574 5f6f 7665  .    def get_ove
+0001a640: 726c 6179 5f63 6f6d 705f 6d61 706c 6973  rlay_comp_maplis
+0001a650: 7428 7365 6c66 2c20 7374 7275 6374 2c20  t(self, struct, 
+0001a660: 7465 6d70 6c61 7465 5f67 7269 6429 3a0a  template_grid):.
+0001a670: 2020 2020 2020 2020 626c 7572 7265 7220          blurrer 
+0001a680: 3d20 5374 7275 6374 7572 6542 6c75 7272  = StructureBlurr
+0001a690: 6572 2829 0a20 2020 2020 2020 206f 7665  er().        ove
+0001a6a0: 726c 6179 5f6d 6170 6c69 7374 203d 205b  rlay_maplist = [
+0001a6b0: 5d0a 2020 2020 2020 2020 7373 706c 6974  ].        ssplit
+0001a6c0: 203d 2073 7472 7563 742e 7370 6c69 745f   = struct.split_
+0001a6d0: 696e 746f 5f63 6861 696e 7328 290a 2020  into_chains().  
+0001a6e0: 2020 2020 2020 666f 7220 7820 696e 2073        for x in s
+0001a6f0: 7370 6c69 743a 0a20 2020 2020 2020 2020  split:.         
+0001a700: 2020 206f 7665 726c 6179 5f6d 6170 6c69     overlay_mapli
+0001a710: 7374 2e61 7070 656e 6428 0a20 2020 2020  st.append(.     
+0001a720: 2020 2020 2020 2020 2020 2062 6c75 7272             blurr
+0001a730: 6572 2e6d 616b 655f 6174 6f6d 5f6f 7665  er.make_atom_ove
+0001a740: 726c 6179 5f6d 6170 3128 0a20 2020 2020  rlay_map1(.     
+0001a750: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001a760: 656d 706c 6174 655f 6772 6964 2c0a 2020  emplate_grid,.  
+0001a770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a780: 2020 782c 0a20 2020 2020 2020 2020 2020    x,.           
+0001a790: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+0001a7a0: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+0001a7b0: 7572 6e20 6f76 6572 6c61 795f 6d61 706c  urn overlay_mapl
+0001a7c0: 6973 740a 0a20 2020 2064 6566 2063 616c  ist..    def cal
+0001a7d0: 6375 6c61 7465 5f61 6c63 7073 2873 656c  culate_alcps(sel
+0001a7e0: 662c 2072 6566 5f63 6861 696e 2c20 7072  f, ref_chain, pr
+0001a7f0: 6f62 655f 6368 6169 6e29 3a0a 2020 2020  obe_chain):.    
+0001a800: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+0001a810: 4361 6c63 756c 6174 6520 7468 6520 4172  Calculate the Ar
+0001a820: 6320 4c65 6e67 7468 2043 6f6d 706f 6e65  c Length Compone
+0001a830: 6e74 2050 6c61 6365 6d65 6e74 2053 636f  nt Placement Sco
+0001a840: 7265 2062 6574 7765 656e 2074 776f 206d  re between two m
+0001a850: 6f64 656c 732e 0a20 2020 2020 2020 2047  odels..        G
+0001a860: 656e 6572 616c 6c79 2c20 7468 6973 2073  enerally, this s
+0001a870: 636f 7265 2069 7320 6361 6c63 756c 6174  core is calculat
+0001a880: 6564 2062 6574 7765 656e 2069 6e64 6976  ed between indiv
+0001a890: 6964 7561 6c20 6368 6169 6e73 2069 6e20  idual chains in 
+0001a8a0: 610a 2020 2020 2020 2020 7374 7275 6374  a.        struct
+0001a8b0: 7572 652e 0a0a 2020 2020 2020 2020 496e  ure...        In
+0001a8c0: 7075 7473 3a0a 2020 2020 2020 2020 2020  puts:.          
+0001a8d0: 2020 7265 665f 6368 6169 6e3a 0a20 2020    ref_chain:.   
+0001a8e0: 2020 2020 2020 2020 2020 2020 204f 6e65               One
+0001a8f0: 206f 6620 7468 6520 696e 7075 7420 7374   of the input st
+0001a900: 7275 6374 7572 6520 696e 7374 616e 6365  ructure instance
+0001a910: 7320 6265 696e 6720 636f 6d70 6172 6564  s being compared
+0001a920: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0001a930: 6265 5f63 6861 696e 3a0a 2020 2020 2020  be_chain:.      
+0001a940: 2020 2020 2020 2020 2020 5468 6520 6f74            The ot
+0001a950: 6865 7220 696e 7075 7420 7374 7275 6374  her input struct
+0001a960: 7572 6520 696e 7374 616e 6365 2062 6569  ure instance bei
+0001a970: 6e67 2063 6f6d 7061 7265 640a 2020 2020  ng compared.    
+0001a980: 2020 2020 4f75 7470 7574 3a0a 2020 2020      Output:.    
+0001a990: 2020 2020 2020 2020 616c 6370 733a 0a20          alcps:. 
+0001a9a0: 2020 2020 2020 2020 2020 2020 2020 2041                 A
+0001a9b0: 7263 204c 656e 6774 6820 436f 6d70 6f6e  rc Length Compon
+0001a9c0: 656e 7420 506c 6163 656d 656e 7420 5363  ent Placement Sc
+0001a9d0: 6f72 650a 2020 2020 2020 2020 2222 220a  ore.        """.
+0001a9e0: 0a20 2020 2020 2020 2064 6966 665f 7665  .        diff_ve
+0001a9f0: 6320 3d20 7265 665f 6368 6169 6e2e 436f  c = ref_chain.Co
+0001aa00: 4d20 2d20 7072 6f62 655f 6368 6169 6e2e  M - probe_chain.
+0001aa10: 436f 4d0a 2020 2020 2020 2020 7220 3d20  CoM.        r = 
+0001aa20: 6469 6666 5f76 6563 2e6d 6f64 2829 0a0a  diff_vec.mod()..
+0001aa30: 2020 2020 2020 2020 7265 665f 6d61 7472          ref_matr
+0001aa40: 6978 203d 2076 6563 746f 722e 6765 745f  ix = vector.get_
+0001aa50: 636f 6f72 6469 6e61 7465 5f6d 6173 735f  coordinate_mass_
+0001aa60: 6172 7261 7928 7265 665f 6368 6169 6e29  array(ref_chain)
+0001aa70: 0a20 2020 2020 2020 2070 726f 6265 5f6d  .        probe_m
+0001aa80: 6174 7269 7820 3d20 7665 6374 6f72 2e67  atrix = vector.g
+0001aa90: 6574 5f63 6f6f 7264 696e 6174 655f 6d61  et_coordinate_ma
+0001aaa0: 7373 5f61 7272 6179 2870 726f 6265 5f63  ss_array(probe_c
+0001aab0: 6861 696e 290a 0a20 2020 2020 2020 2072  hain)..        r
+0001aac0: 6f74 6174 696f 6e5f 6d61 7472 6978 2c20  otation_matrix, 
+0001aad0: 5f74 203d 2076 6563 746f 722e 6765 745f  _t = vector.get_
+0001aae0: 7472 616e 7366 6f72 6d28 7265 665f 6d61  transform(ref_ma
+0001aaf0: 7472 6978 2c20 7072 6f62 655f 6d61 7472  trix, probe_matr
+0001ab00: 6978 290a 0a20 2020 2020 2020 2074 6865  ix)..        the
+0001ab10: 7461 2c20 6e31 2c20 6e32 2c20 6e33 203d  ta, n1, n2, n3 =
+0001ab20: 2076 6563 746f 722e 5f72 6f74 6d61 745f   vector._rotmat_
+0001ab30: 746f 5f61 7869 7361 6e67 6c65 2872 6f74  to_axisangle(rot
+0001ab40: 6174 696f 6e5f 6d61 7472 6978 290a 2020  ation_matrix).  
+0001ab50: 2020 2020 2020 7468 6574 6120 3d20 6d61        theta = ma
+0001ab60: 7468 2e64 6567 7265 6573 2874 6865 7461  th.degrees(theta
+0001ab70: 290a 0a20 2020 2020 2020 2061 6c63 7073  )..        alcps
+0001ab80: 203d 2032 202a 206d 6174 682e 7069 202a   = 2 * math.pi *
+0001ab90: 2072 202a 2074 6865 7461 202f 2033 3630   r * theta / 360
+0001aba0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001abb0: 2061 6c63 7073 0a0a 2020 2020 6465 6620   alcps..    def 
+0001abc0: 6765 745f 6c6f 6731 305f 616c 6370 7328  get_log10_alcps(
+0001abd0: 7365 6c66 2c20 7265 665f 6368 6169 6e2c  self, ref_chain,
+0001abe0: 2070 726f 6265 5f63 6861 696e 2c20 6c6f   probe_chain, lo
+0001abf0: 7765 7374 5f76 616c 7565 3d2d 3229 3a0a  west_value=-2):.
+0001ac00: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001ac10: 2020 2020 4361 6c63 756c 6174 6520 7468      Calculate th
+0001ac20: 6520 6c6f 6731 3020 6f66 2074 6865 2041  e log10 of the A
+0001ac30: 4c43 5053 2073 636f 7265 2e0a 0a20 2020  LCPS score...   
+0001ac40: 2020 2020 2049 6e70 7574 733a 0a20 2020       Inputs:.   
+0001ac50: 2020 2020 2020 2020 2072 6566 5f63 6861           ref_cha
+0001ac60: 696e 3a0a 2020 2020 2020 2020 2020 2020  in:.            
+0001ac70: 2020 2020 5265 6665 7265 6e63 6520 7374      Reference st
+0001ac80: 7275 6374 7572 6520 696e 7374 616e 6365  ructure instance
+0001ac90: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
+0001aca0: 6265 5f63 6861 696e 3a0a 2020 2020 2020  be_chain:.      
+0001acb0: 2020 2020 2020 2020 2020 5072 6f62 6520            Probe 
+0001acc0: 7374 7275 6374 7572 6520 696e 7374 616e  structure instan
+0001acd0: 6365 0a20 2020 2020 2020 2020 2020 206c  ce.            l
+0001ace0: 6f77 6573 745f 7661 6c75 653a 0a20 2020  owest_value:.   
+0001acf0: 2020 2020 2020 2020 2020 2020 2056 616c               Val
+0001ad00: 7565 2074 6f20 7573 6520 6966 2074 776f  ue to use if two
+0001ad10: 2073 7472 7563 7475 7265 7320 6172 6520   structures are 
+0001ad20: 7065 7266 6563 746c 7920 616c 6967 6e65  perfectly aligne
+0001ad30: 6420 2869 2e65 2e20 6966 0a20 2020 2020  d (i.e. if.     
+0001ad40: 2020 2020 2020 2020 2020 2061 6c63 7073             alcps
+0001ad50: 203d 2030 2920 2d20 6465 6661 756c 7420   = 0) - default 
+0001ad60: 7661 6c75 6520 6973 202d 320a 2020 2020  value is -2.    
+0001ad70: 2020 2020 4f75 7470 7574 733a 0a20 2020      Outputs:.   
+0001ad80: 2020 2020 2020 2020 206c 6f67 3130 2861           log10(a
+0001ad90: 6c63 7073 293a 0a20 2020 2020 2020 2020  lcps):.         
+0001ada0: 2020 2020 2020 206c 6f67 3130 206f 6620         log10 of 
+0001adb0: 7468 6520 414c 4350 530a 2020 2020 2020  the ALCPS.      
+0001adc0: 2020 2020 2020 6c6f 7765 7374 5f76 616c        lowest_val
+0001add0: 7565 3a0a 2020 2020 2020 2020 2020 2020  ue:.            
+0001ade0: 2020 2020 7265 7475 726e 6564 2069 6620      returned if 
+0001adf0: 414c 4350 5320 3d20 302c 2064 6566 6175  ALCPS = 0, defau
+0001ae00: 6c74 2076 616c 7565 2069 7320 2d32 0a20  lt value is -2. 
+0001ae10: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0001ae20: 2020 2020 616c 6370 7320 3d20 7365 6c66      alcps = self
+0001ae30: 2e63 616c 6375 6c61 7465 5f61 6c63 7073  .calculate_alcps
+0001ae40: 2872 6566 5f63 6861 696e 2c20 7072 6f62  (ref_chain, prob
+0001ae50: 655f 6368 6169 6e29 0a0a 2020 2020 2020  e_chain)..      
+0001ae60: 2020 6966 2061 6c63 7073 203d 3d20 302e    if alcps == 0.
+0001ae70: 303a 0a20 2020 2020 2020 2020 2020 2072  0:.            r
+0001ae80: 6574 7572 6e20 6c6f 7765 7374 5f76 616c  eturn lowest_val
+0001ae90: 7565 0a20 2020 2020 2020 2065 6c73 653a  ue.        else:
+0001aea0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001aeb0: 7572 6e20 6d61 7468 2e6c 6f67 3130 2861  urn math.log10(a
+0001aec0: 6c63 7073 290a 0a20 2020 2064 6566 205f  lcps)..    def _
+0001aed0: 6765 745f 6d61 785f 6469 7374 616e 6365  get_max_distance
+0001aee0: 5f62 6574 7765 656e 5f72 6573 6964 7565  _between_residue
+0001aef0: 7328 6174 6f6d 7329 3a0a 0a20 2020 2020  s(atoms):..     
+0001af00: 2020 206d 6178 5f64 6973 7420 3d20 300a     max_dist = 0.
+0001af10: 2020 2020 2020 2020 6174 6f6d 5f6c 6973          atom_lis
+0001af20: 7420 3d20 6174 6f6d 735b 3a5d 0a20 2020  t = atoms[:].   
+0001af30: 2020 2020 2066 6f72 2061 746f 6d20 696e       for atom in
+0001af40: 2061 746f 6d73 3a0a 2020 2020 2020 2020   atoms:.        
+0001af50: 2020 2020 6174 6f6d 5f6c 6973 742e 706f      atom_list.po
+0001af60: 7028 6174 6f6d 5f6c 6973 742e 696e 6465  p(atom_list.inde
+0001af70: 7828 6174 6f6d 2929 0a20 2020 2020 2020  x(atom)).       
+0001af80: 2020 2020 2066 6f72 2061 746f 6d32 2069       for atom2 i
+0001af90: 6e20 6174 6f6d 5f6c 6973 743a 0a20 2020  n atom_list:.   
+0001afa0: 2020 2020 2020 2020 2020 2020 2076 6563               vec
+0001afb0: 203d 206e 702e 6c69 6e61 6c67 2e6e 6f72   = np.linalg.nor
+0001afc0: 6d28 5b61 746f 6d2e 782c 2061 746f 6d2e  m([atom.x, atom.
+0001afd0: 792c 2061 746f 6d2e 7a5d 2c0a 2020 2020  y, atom.z],.    
+0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b000: 205b 6174 6f6d 322e 782c 2061 746f 6d32   [atom2.x, atom2
+0001b010: 2e79 2c20 6174 6f6d 322e 7a5d 290a 2020  .y, atom2.z]).  
+0001b020: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0001b030: 2076 6563 203e 206d 6178 5f64 6973 743a   vec > max_dist:
+0001b040: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b050: 2020 2020 206d 6178 5f64 6973 7420 3d20       max_dist = 
+0001b060: 7665 630a 2020 2020 2020 2020 7265 7475  vec.        retu
+0001b070: 726e 206d 6178 5f64 6973 740a 0a20 2020  rn max_dist..   
+0001b080: 2064 6566 206d 6170 5f6d 6f64 656c 5f66   def map_model_f
+0001b090: 7363 5f72 6573 6f6c 7574 696f 6e28 0a20  sc_resolution(. 
+0001b0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0001b0c0: 656c 662c 0a20 2020 2020 2020 2020 2020  elf,.           
+0001b0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b0e0: 2020 2020 2073 7472 7563 7475 7265 2c0a       structure,.
+0001b0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b110: 7461 7267 6574 5f6d 6170 2c0a 2020 2020  target_map,.    
+0001b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b130: 2020 2020 2020 2020 2020 2020 6d61 705f              map_
+0001b140: 7265 736f 6c75 7469 6f6e 2c0a 2020 2020  resolution,.    
 0001b150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b160: 2020 2020 2020 2020 2020 2020 5b61 746f              [ato
-0001b170: 6d32 2e78 2c20 6174 6f6d 322e 792c 2061  m2.x, atom2.y, a
-0001b180: 746f 6d32 2e7a 5d29 0a20 2020 2020 2020  tom2.z]).       
-0001b190: 2020 2020 2020 2020 2069 6620 7665 6320           if vec 
-0001b1a0: 3e20 6d61 785f 6469 7374 3a0a 2020 2020  > max_dist:.    
+0001b160: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0001b170: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+0001b180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b190: 2020 2020 2020 2073 696d 5f6d 6170 3d4e         sim_map=N
+0001b1a0: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
 0001b1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1c0: 6d61 785f 6469 7374 203d 2076 6563 0a20  max_dist = vec. 
-0001b1d0: 2020 2020 2020 2072 6574 7572 6e20 6d61         return ma
-0001b1e0: 785f 6469 7374 0a0a 2020 2020 6465 6620  x_dist..    def 
-0001b1f0: 6d61 705f 6d6f 6465 6c5f 6673 635f 7265  map_model_fsc_re
-0001b200: 736f 6c75 7469 6f6e 280a 2020 2020 2020  solution(.      
-0001b210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b220: 2020 2020 2020 2020 2020 7365 6c66 2c0a            self,.
-0001b230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b250: 7374 7275 6374 7572 652c 0a20 2020 2020  structure,.     
-0001b260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b270: 2020 2020 2020 2020 2020 2074 6172 6765             targe
-0001b280: 745f 6d61 702c 0a20 2020 2020 2020 2020  t_map,.         
-0001b290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2a0: 2020 2020 2020 206d 6170 5f72 6573 6f6c         map_resol
-0001b2b0: 7574 696f 6e2c 0a20 2020 2020 2020 2020  ution,.         
-0001b2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b2d0: 2020 2020 2020 206d 6173 6b3d 4e6f 6e65         mask=None
-0001b2e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001b2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b300: 2020 7369 6d5f 6d61 703d 4e6f 6e65 2c0a    sim_map=None,.
-0001b310: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b330: 6375 746f 6666 5f63 6f72 7265 6c61 7469  cutoff_correlati
-0001b340: 6f6e 3d30 2e35 2c0a 2020 2020 2020 2020  on=0.5,.        
-0001b350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b360: 2020 2020 2020 2020 7573 655f 6869 6768          use_high
-0001b370: 6573 745f 7265 736f 6c75 7469 6f6e 3d54  est_resolution=T
-0001b380: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-0001b390: 2243 616c 6375 6c61 7465 2074 6865 204d  "Calculate the M
-0001b3a0: 6170 2d6d 6f64 656c 2022 7265 736f 6c75  ap-model "resolu
-0001b3b0: 7469 6f6e 2220 7573 696e 6720 466f 7572  tion" using Four
-0001b3c0: 6965 7220 5368 656c 6c20 436f 7272 656c  ier Shell Correl
-0001b3d0: 6174 696f 6e20 2846 5343 292e 0a0a 2020  ation (FSC)...  
-0001b3e0: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
-0001b3f0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0001b400: 7563 7475 7265 3a20 4120 6d6f 6465 6c20  ucture: A model 
-0001b410: 7374 7275 6374 7572 6520 696e 7374 616e  structure instan
-0001b420: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
-0001b430: 7461 7267 6574 5f6d 6170 3a20 4120 4d61  target_map: A Ma
-0001b440: 7020 696e 7374 616e 6365 2e0a 2020 2020  p instance..    
-0001b450: 2020 2020 2020 2020 6d61 705f 7265 736f          map_reso
-0001b460: 6c75 7469 6f6e 3a20 5468 6520 7265 736f  lution: The reso
-0001b470: 6c75 7469 6f6e 206f 6620 7461 7267 6574  lution of target
-0001b480: 5f6d 6170 0a20 2020 2020 2020 2020 2020  _map.           
-0001b490: 206d 6173 6b3a 2041 204d 6170 2069 6e73   mask: A Map ins
-0001b4a0: 7461 6e63 6520 6f66 2061 2073 6f66 742d  tance of a soft-
-0001b4b0: 6564 6765 6420 6d61 736b 2e0a 2020 2020  edged mask..    
-0001b4c0: 2020 2020 2020 2020 7369 6d5f 6d61 703a          sim_map:
-0001b4d0: 2041 204d 6170 2069 6e73 7461 6e63 6520   A Map instance 
-0001b4e0: 6f66 2061 2070 7265 2d63 616c 6375 6c61  of a pre-calcula
-0001b4f0: 7465 6420 7369 6d75 6c61 7465 6420 6d61  ted simulated ma
-0001b500: 702c 2069 660a 2020 2020 2020 2020 2020  p, if.          
-0001b510: 2020 2020 2020 6e6f 7420 6578 706c 6963        not explic
-0001b520: 6974 6c79 2073 7570 706c 6965 6420 6974  itly supplied it
-0001b530: 2077 696c 6c20 6265 2063 616c 6375 6c61   will be calcula
-0001b540: 7465 6420 6175 746f 6d61 7469 6361 6c6c  ted automaticall
-0001b550: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
-0001b560: 2020 6672 6f6d 2074 6865 2073 7472 7563    from the struc
-0001b570: 7475 7265 2069 6e73 7461 6e63 652e 0a20  ture instance.. 
-0001b580: 2020 2020 2020 2020 2020 2063 7574 6f66             cutof
-0001b590: 665f 636f 7272 656c 6174 696f 6e3a 2054  f_correlation: T
-0001b5a0: 6872 6573 686f 6c64 2063 6f72 7265 6c61  hreshold correla
-0001b5b0: 7469 6f6e 2075 7365 6420 746f 2064 6566  tion used to def
-0001b5c0: 696e 6520 7468 650a 2020 2020 2020 2020  ine the.        
-0001b5d0: 2020 2020 2020 2020 6d6f 6465 6c2d 6d61          model-ma
-0001b5e0: 7020 2272 6573 6f6c 7574 696f 6e22 2e0a  p "resolution"..
-0001b5f0: 2020 2020 2020 2020 2020 2020 7573 655f              use_
-0001b600: 6869 6768 6573 745f 7265 736f 6c75 7469  highest_resoluti
-0001b610: 6f6e 3a20 4966 2054 7275 652c 2074 6865  on: If True, the
-0001b620: 2068 6967 6865 7374 2072 6573 6f6c 7574   highest resolut
-0001b630: 696f 6e20 7368 656c 6c0a 2020 2020 2020  ion shell.      
-0001b640: 2020 2020 2020 2020 2020 7468 6174 2063            that c
-0001b650: 726f 7373 6573 2074 6865 2063 7574 6f66  rosses the cutof
-0001b660: 665f 636f 7272 656c 6174 696f 6e20 7468  f_correlation th
-0001b670: 7265 7368 6f6c 6420 6973 2074 616b 656e  reshold is taken
-0001b680: 2e0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001b690: 2020 4f74 6865 7277 6973 652c 2074 6865    Otherwise, the
-0001b6a0: 2066 7265 7175 656e 6379 2074 6861 7420   frequency that 
-0001b6b0: 6669 7273 7420 6372 6f73 7365 7320 7468  first crosses th
-0001b6c0: 6520 7468 7265 7368 6f6c 640a 2020 2020  e threshold.    
-0001b6d0: 2020 2020 2020 2020 2020 2020 6973 2074              is t
-0001b6e0: 616b 656e 2e0a 0a20 2020 2020 2020 2052  aken...        R
-0001b6f0: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-0001b700: 2020 2020 4d61 702d 6d6f 6465 6c20 4653      Map-model FS
-0001b710: 4320 2272 6573 6f6c 7574 696f 6e22 3a20  C "resolution": 
-0001b720: 5468 6520 666f 7572 6965 7220 7368 656c  The fourier shel
-0001b730: 6c20 6672 6571 7565 6e63 790a 2020 2020  l frequency.    
-0001b740: 2020 2020 2020 2020 2869 6e20 616e 6773          (in angs
-0001b750: 7472 6f6d 7329 2077 6865 7265 2074 6865  troms) where the
-0001b760: 2063 6f72 7265 6c61 7469 6f6e 2063 726f   correlation cro
-0001b770: 7373 6573 2074 6865 2073 7461 7465 640a  sses the stated.
-0001b780: 2020 2020 2020 2020 2020 2020 7468 7265              thre
-0001b790: 7368 6f6c 642e 0a20 2020 2020 2020 2022  shold..        "
-0001b7a0: 2222 0a0a 2020 2020 2020 2020 6966 2073  ""..        if s
-0001b7b0: 696d 5f6d 6170 2069 7320 4e6f 6e65 3a0a  im_map is None:.
-0001b7c0: 2020 2020 2020 2020 2020 2020 626c 7572              blur
-0001b7d0: 7265 7220 3d20 5374 7275 6374 7572 6542  rer = StructureB
-0001b7e0: 6c75 7272 6572 2877 6974 685f 7663 3d54  lurrer(with_vc=T
-0001b7f0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-0001b800: 2073 696d 5f6d 6170 203d 2062 6c75 7272   sim_map = blurr
-0001b810: 6572 2e67 6175 7373 6961 6e5f 626c 7572  er.gaussian_blur
-0001b820: 5f72 6561 6c5f 7370 6163 6528 0a20 2020  _real_space(.   
-0001b830: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0001b840: 7563 7475 7265 2c0a 2020 2020 2020 2020  ucture,.        
-0001b850: 2020 2020 2020 2020 6d61 705f 7265 736f          map_reso
-0001b860: 6c75 7469 6f6e 2c0a 2020 2020 2020 2020  lution,.        
-0001b870: 2020 2020 2020 2020 6465 6e73 4d61 703d          densMap=
-0001b880: 7461 7267 6574 5f6d 6170 2c0a 2020 2020  target_map,.    
-0001b890: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
-0001b8a0: 2020 2020 2020 2066 7363 203d 2073 656c         fsc = sel
-0001b8b0: 662e 6d61 705f 6d6f 6465 6c5f 6673 6328  f.map_model_fsc(
-0001b8c0: 7374 7275 6374 7572 652c 2074 6172 6765  structure, targe
-0001b8d0: 745f 6d61 702c 206d 6170 5f72 6573 6f6c  t_map, map_resol
-0001b8e0: 7574 696f 6e2c 0a20 2020 2020 2020 2020  ution,.         
+0001b1c0: 2020 2020 2063 7574 6f66 665f 636f 7272       cutoff_corr
+0001b1d0: 656c 6174 696f 6e3d 302e 352c 0a20 2020  elation=0.5,.   
+0001b1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b1f0: 2020 2020 2020 2020 2020 2020 2075 7365               use
+0001b200: 5f68 6967 6865 7374 5f72 6573 6f6c 7574  _highest_resolut
+0001b210: 696f 6e3d 5472 7565 293a 0a20 2020 2020  ion=True):.     
+0001b220: 2020 2022 2222 4361 6c63 756c 6174 6520     """Calculate 
+0001b230: 7468 6520 4d61 702d 6d6f 6465 6c20 2272  the Map-model "r
+0001b240: 6573 6f6c 7574 696f 6e22 2075 7369 6e67  esolution" using
+0001b250: 2046 6f75 7269 6572 2053 6865 6c6c 2043   Fourier Shell C
+0001b260: 6f72 7265 6c61 7469 6f6e 2028 4653 4329  orrelation (FSC)
+0001b270: 2e0a 0a20 2020 2020 2020 2041 7267 756d  ...        Argum
+0001b280: 656e 7473 3a0a 2020 2020 2020 2020 2020  ents:.          
+0001b290: 2020 7374 7275 6374 7572 653a 2041 206d    structure: A m
+0001b2a0: 6f64 656c 2073 7472 7563 7475 7265 2069  odel structure i
+0001b2b0: 6e73 7461 6e63 652e 0a20 2020 2020 2020  nstance..       
+0001b2c0: 2020 2020 2074 6172 6765 745f 6d61 703a       target_map:
+0001b2d0: 2041 204d 6170 2069 6e73 7461 6e63 652e   A Map instance.
+0001b2e0: 0a20 2020 2020 2020 2020 2020 206d 6170  .            map
+0001b2f0: 5f72 6573 6f6c 7574 696f 6e3a 2054 6865  _resolution: The
+0001b300: 2072 6573 6f6c 7574 696f 6e20 6f66 2074   resolution of t
+0001b310: 6172 6765 745f 6d61 700a 2020 2020 2020  arget_map.      
+0001b320: 2020 2020 2020 6d61 736b 3a20 4120 4d61        mask: A Ma
+0001b330: 7020 696e 7374 616e 6365 206f 6620 6120  p instance of a 
+0001b340: 736f 6674 2d65 6467 6564 206d 6173 6b2e  soft-edged mask.
+0001b350: 0a20 2020 2020 2020 2020 2020 2073 696d  .            sim
+0001b360: 5f6d 6170 3a20 4120 4d61 7020 696e 7374  _map: A Map inst
+0001b370: 616e 6365 206f 6620 6120 7072 652d 6361  ance of a pre-ca
+0001b380: 6c63 756c 6174 6564 2073 696d 756c 6174  lculated simulat
+0001b390: 6564 206d 6170 2c20 6966 0a20 2020 2020  ed map, if.     
+0001b3a0: 2020 2020 2020 2020 2020 206e 6f74 2065             not e
+0001b3b0: 7870 6c69 6369 746c 7920 7375 7070 6c69  xplicitly suppli
+0001b3c0: 6564 2069 7420 7769 6c6c 2062 6520 6361  ed it will be ca
+0001b3d0: 6c63 756c 6174 6564 2061 7574 6f6d 6174  lculated automat
+0001b3e0: 6963 616c 6c79 0a20 2020 2020 2020 2020  ically.         
+0001b3f0: 2020 2020 2020 2066 726f 6d20 7468 6520         from the 
+0001b400: 7374 7275 6374 7572 6520 696e 7374 616e  structure instan
+0001b410: 6365 2e0a 2020 2020 2020 2020 2020 2020  ce..            
+0001b420: 6375 746f 6666 5f63 6f72 7265 6c61 7469  cutoff_correlati
+0001b430: 6f6e 3a20 5468 7265 7368 6f6c 6420 636f  on: Threshold co
+0001b440: 7272 656c 6174 696f 6e20 7573 6564 2074  rrelation used t
+0001b450: 6f20 6465 6669 6e65 2074 6865 0a20 2020  o define the.   
+0001b460: 2020 2020 2020 2020 2020 2020 206d 6f64               mod
+0001b470: 656c 2d6d 6170 2022 7265 736f 6c75 7469  el-map "resoluti
+0001b480: 6f6e 222e 0a20 2020 2020 2020 2020 2020  on"..           
+0001b490: 2075 7365 5f68 6967 6865 7374 5f72 6573   use_highest_res
+0001b4a0: 6f6c 7574 696f 6e3a 2049 6620 5472 7565  olution: If True
+0001b4b0: 2c20 7468 6520 6869 6768 6573 7420 7265  , the highest re
+0001b4c0: 736f 6c75 7469 6f6e 2073 6865 6c6c 0a20  solution shell. 
+0001b4d0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001b4e0: 6861 7420 6372 6f73 7365 7320 7468 6520  hat crosses the 
+0001b4f0: 6375 746f 6666 5f63 6f72 7265 6c61 7469  cutoff_correlati
+0001b500: 6f6e 2074 6872 6573 686f 6c64 2069 7320  on threshold is 
+0001b510: 7461 6b65 6e2e 0a20 2020 2020 2020 2020  taken..         
+0001b520: 2020 2020 2020 204f 7468 6572 7769 7365         Otherwise
+0001b530: 2c20 7468 6520 6672 6571 7565 6e63 7920  , the frequency 
+0001b540: 7468 6174 2066 6972 7374 2063 726f 7373  that first cross
+0001b550: 6573 2074 6865 2074 6872 6573 686f 6c64  es the threshold
+0001b560: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b570: 2069 7320 7461 6b65 6e2e 0a0a 2020 2020   is taken...    
+0001b580: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+0001b590: 2020 2020 2020 2020 204d 6170 2d6d 6f64           Map-mod
+0001b5a0: 656c 2046 5343 2022 7265 736f 6c75 7469  el FSC "resoluti
+0001b5b0: 6f6e 223a 2054 6865 2066 6f75 7269 6572  on": The fourier
+0001b5c0: 2073 6865 6c6c 2066 7265 7175 656e 6379   shell frequency
+0001b5d0: 0a20 2020 2020 2020 2020 2020 2028 696e  .            (in
+0001b5e0: 2061 6e67 7374 726f 6d73 2920 7768 6572   angstroms) wher
+0001b5f0: 6520 7468 6520 636f 7272 656c 6174 696f  e the correlatio
+0001b600: 6e20 6372 6f73 7365 7320 7468 6520 7374  n crosses the st
+0001b610: 6174 6564 0a20 2020 2020 2020 2020 2020  ated.           
+0001b620: 2074 6872 6573 686f 6c64 2e0a 2020 2020   threshold..    
+0001b630: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0001b640: 2069 6620 7369 6d5f 6d61 7020 6973 204e   if sim_map is N
+0001b650: 6f6e 653a 0a20 2020 2020 2020 2020 2020  one:.           
+0001b660: 2062 6c75 7272 6572 203d 2053 7472 7563   blurrer = Struc
+0001b670: 7475 7265 426c 7572 7265 7228 7769 7468  tureBlurrer(with
+0001b680: 5f76 633d 5472 7565 290a 2020 2020 2020  _vc=True).      
+0001b690: 2020 2020 2020 7369 6d5f 6d61 7020 3d20        sim_map = 
+0001b6a0: 626c 7572 7265 722e 6761 7573 7369 616e  blurrer.gaussian
+0001b6b0: 5f62 6c75 725f 7265 616c 5f73 7061 6365  _blur_real_space
+0001b6c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001b6d0: 2020 7374 7275 6374 7572 652c 0a20 2020    structure,.   
+0001b6e0: 2020 2020 2020 2020 2020 2020 206d 6170               map
+0001b6f0: 5f72 6573 6f6c 7574 696f 6e2c 0a20 2020  _resolution,.   
+0001b700: 2020 2020 2020 2020 2020 2020 2064 656e               den
+0001b710: 734d 6170 3d74 6172 6765 745f 6d61 702c  sMap=target_map,
+0001b720: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b730: 2029 0a0a 2020 2020 2020 2020 6673 6320   )..        fsc 
+0001b740: 3d20 7365 6c66 2e6d 6170 5f6d 6f64 656c  = self.map_model
+0001b750: 5f66 7363 2873 7472 7563 7475 7265 2c20  _fsc(structure, 
+0001b760: 7461 7267 6574 5f6d 6170 2c20 6d61 705f  target_map, map_
+0001b770: 7265 736f 6c75 7469 6f6e 2c0a 2020 2020  resolution,.    
+0001b780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b790: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+0001b7a0: 6b3d 6d61 736b 2c20 7369 6d5f 6d61 703d  k=mask, sim_map=
+0001b7b0: 7369 6d5f 6d61 7029 0a0a 2020 2020 2020  sim_map)..      
+0001b7c0: 2020 6d61 785f 6672 6571 7565 6e63 795f    max_frequency_
+0001b7d0: 6174 5f63 7574 6f66 6620 3d20 666f 7572  at_cutoff = four
+0001b7e0: 6965 722e 6765 745f 6673 635f 7265 736f  ier.get_fsc_reso
+0001b7f0: 6c75 7469 6f6e 280a 2020 2020 2020 2020  lution(.        
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b810: 2020 2020 2020 2020 6673 632c 0a20 2020          fsc,.   
+0001b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b830: 2020 2020 2020 2020 2020 2020 2066 7363               fsc
+0001b840: 5f74 6872 6573 686f 6c64 3d63 7574 6f66  _threshold=cutof
+0001b850: 665f 636f 7272 656c 6174 696f 6e2c 0a20  f_correlation,. 
+0001b860: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b870: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0001b880: 6e74 6572 706f 6c61 7465 5f63 7574 6f66  nterpolate_cutof
+0001b890: 663d 4661 6c73 652c 0a20 2020 2020 2020  f=False,.       
+0001b8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b8b0: 2020 2020 2020 2020 2075 7365 5f68 6967           use_hig
+0001b8c0: 6865 7374 5f72 6573 6f6c 7574 696f 6e3d  hest_resolution=
+0001b8d0: 7573 655f 6869 6768 6573 745f 7265 736f  use_highest_reso
+0001b8e0: 6c75 7469 6f6e 0a20 2020 2020 2020 2020  lution.         
 0001b8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b900: 2020 2020 2020 2020 6d61 736b 3d6d 6173          mask=mas
-0001b910: 6b2c 2073 696d 5f6d 6170 3d73 696d 5f6d  k, sim_map=sim_m
-0001b920: 6170 290a 0a20 2020 2020 2020 206d 6178  ap)..        max
-0001b930: 5f66 7265 7175 656e 6379 5f61 745f 6375  _frequency_at_cu
-0001b940: 746f 6666 203d 2066 6f75 7269 6572 2e67  toff = fourier.g
-0001b950: 6574 5f66 7363 5f72 6573 6f6c 7574 696f  et_fsc_resolutio
-0001b960: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0001b970: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b980: 2020 2066 7363 2c0a 2020 2020 2020 2020     fsc,.        
-0001b990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9a0: 2020 2020 2020 2020 6673 635f 7468 7265          fsc_thre
-0001b9b0: 7368 6f6c 643d 6375 746f 6666 5f63 6f72  shold=cutoff_cor
-0001b9c0: 7265 6c61 7469 6f6e 2c0a 2020 2020 2020  relation,.      
-0001b9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b9e0: 2020 2020 2020 2020 2020 696e 7465 7270            interp
-0001b9f0: 6f6c 6174 655f 6375 746f 6666 3d46 616c  olate_cutoff=Fal
-0001ba00: 7365 2c0a 2020 2020 2020 2020 2020 2020  se,.            
-0001ba10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba20: 2020 2020 7573 655f 6869 6768 6573 745f      use_highest_
-0001ba30: 7265 736f 6c75 7469 6f6e 3d75 7365 5f68  resolution=use_h
-0001ba40: 6967 6865 7374 5f72 6573 6f6c 7574 696f  ighest_resolutio
-0001ba50: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
-0001ba60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ba70: 2020 290a 0a20 2020 2020 2020 2072 6574    )..        ret
-0001ba80: 7572 6e20 6d61 785f 6672 6571 7565 6e63  urn max_frequenc
-0001ba90: 795f 6174 5f63 7574 6f66 660a 0a20 2020  y_at_cutoff..   
-0001baa0: 2064 6566 206d 6170 5f6d 6f64 656c 5f66   def map_model_f
-0001bab0: 7363 2873 656c 662c 2073 7472 7563 7475  sc(self, structu
-0001bac0: 7265 2c20 7461 7267 6574 5f6d 6170 2c20  re, target_map, 
-0001bad0: 6d61 705f 7265 736f 6c75 7469 6f6e 2c20  map_resolution, 
-0001bae0: 6d61 736b 3d4e 6f6e 652c 0a20 2020 2020  mask=None,.     
-0001baf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bb00: 2073 696d 5f6d 6170 3d4e 6f6e 6529 3a0a   sim_map=None):.
-0001bb10: 2020 2020 2020 2020 2222 2243 616c 6375          """Calcu
-0001bb20: 6c61 7465 2074 6865 206d 6170 2d6d 6f64  late the map-mod
-0001bb30: 656c 2046 6f75 7269 6572 2053 6865 6c6c  el Fourier Shell
-0001bb40: 2043 6f72 7265 6c61 7469 6f6e 2028 4653   Correlation (FS
-0001bb50: 4329 2e0a 0a20 2020 2020 2020 2041 7267  C)...        Arg
-0001bb60: 756d 656e 7473 3a0a 2020 2020 2020 2020  uments:.        
-0001bb70: 2020 2020 7374 7275 6374 7572 653a 2041      structure: A
-0001bb80: 206d 6f64 656c 2073 7472 7563 7475 7265   model structure
-0001bb90: 2069 6e73 7461 6e63 652e 0a20 2020 2020   instance..     
-0001bba0: 2020 2020 2020 2074 6172 6765 745f 6d61         target_ma
-0001bbb0: 703a 2041 204d 6170 2069 6e73 7461 6e63  p: A Map instanc
-0001bbc0: 652e 0a20 2020 2020 2020 2020 2020 206d  e..            m
-0001bbd0: 6170 5f72 6573 6f6c 7574 696f 6e3a 2054  ap_resolution: T
-0001bbe0: 6865 2072 6573 6f6c 7574 696f 6e20 6f66  he resolution of
-0001bbf0: 2074 6172 6765 745f 6d61 700a 2020 2020   target_map.    
-0001bc00: 2020 2020 2020 2020 6d61 736b 3a20 4120          mask: A 
-0001bc10: 4d61 7020 696e 7374 616e 6365 206f 6620  Map instance of 
-0001bc20: 6120 736f 6674 2d65 6467 6564 206d 6173  a soft-edged mas
-0001bc30: 6b2e 0a20 2020 2020 2020 2020 2020 2073  k..            s
-0001bc40: 696d 5f6d 6170 3a20 4120 4d61 7020 696e  im_map: A Map in
-0001bc50: 7374 616e 6365 206f 6620 6120 7072 652d  stance of a pre-
-0001bc60: 6361 6c63 756c 6174 6564 2073 696d 756c  calculated simul
-0001bc70: 6174 6564 206d 6170 2c20 6966 0a20 2020  ated map, if.   
-0001bc80: 2020 2020 2020 2020 2020 2020 206e 6f74               not
-0001bc90: 2065 7870 6c69 6369 746c 7920 7375 7070   explicitly supp
-0001bca0: 6c69 6564 2069 7420 7769 6c6c 2062 6520  lied it will be 
-0001bcb0: 6361 6c63 756c 6174 6564 2061 7574 6f6d  calculated autom
-0001bcc0: 6174 6963 616c 6c79 0a20 2020 2020 2020  atically.       
-0001bcd0: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
-0001bce0: 6520 7374 7275 6374 7572 6520 696e 7374  e structure inst
-0001bcf0: 616e 6365 0a0a 2020 2020 2020 2020 5265  ance..        Re
-0001bd00: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-0001bd10: 2020 2054 6865 206d 6170 2d6d 6f64 656c     The map-model
-0001bd20: 2046 5343 2061 7320 616e 206e 702e 6172   FSC as an np.ar
-0001bd30: 7261 7920 7769 7468 2073 6861 7065 2028  ray with shape (
-0001bd40: 322c 2028 4e20 2f20 3229 202b 2031 2920  2, (N / 2) + 1) 
-0001bd50: 666f 720a 2020 2020 2020 2020 2020 2020  for.            
-0001bd60: 616e 2069 6e70 7574 206d 6170 2077 6974  an input map wit
-0001bd70: 6820 7368 6170 6520 284e 2c20 4e2c 204e  h shape (N, N, N
-0001bd80: 292e 204f 7574 7075 7420 6861 7320 666f  ). Output has fo
-0001bd90: 726d 6174 3a0a 2020 2020 2020 2020 2020  rmat:.          
-0001bda0: 2020 2020 2020 2020 2020 5b5b 7368 656c            [[shel
-0001bdb0: 6c20 6672 6571 7565 6e63 7920 2861 6e67  l frequency (ang
-0001bdc0: 7374 726f 6d73 292c 2063 6f72 7265 6c61  stroms), correla
-0001bdd0: 7469 6f6e 5d0a 2020 2020 2020 2020 2020  tion].          
-0001bde0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bdf0: 2020 2020 2020 2e2e 2e2e 2e2e 2e2e 0a20        ......... 
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 2020 205b 7368 656c 6c20 6672 6571 7565     [shell freque
-0001be20: 6e63 7920 2861 6e67 7374 726f 6d73 292c  ncy (angstroms),
-0001be30: 2063 6f72 7265 6c61 7469 6f6e 5d5d 0a0a   correlation]]..
-0001be40: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001be50: 2020 2020 6966 2073 696d 5f6d 6170 2069      if sim_map i
-0001be60: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-0001be70: 2020 2020 626c 7572 7265 7220 3d20 5374      blurrer = St
-0001be80: 7275 6374 7572 6542 6c75 7272 6572 2877  ructureBlurrer(w
-0001be90: 6974 685f 7663 3d54 7275 6529 0a20 2020  ith_vc=True).   
-0001bea0: 2020 2020 2020 2020 2073 696d 5f6d 6170           sim_map
-0001beb0: 203d 2062 6c75 7272 6572 2e67 6175 7373   = blurrer.gauss
-0001bec0: 6961 6e5f 626c 7572 5f72 6561 6c5f 7370  ian_blur_real_sp
-0001bed0: 6163 6528 0a20 2020 2020 2020 2020 2020  ace(.           
-0001bee0: 2020 2020 2073 7472 7563 7475 7265 2c0a       structure,.
+0001b900: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001b910: 2020 7265 7475 726e 206d 6178 5f66 7265    return max_fre
+0001b920: 7175 656e 6379 5f61 745f 6375 746f 6666  quency_at_cutoff
+0001b930: 0a0a 2020 2020 6465 6620 6d61 705f 6d6f  ..    def map_mo
+0001b940: 6465 6c5f 6673 6328 7365 6c66 2c20 7374  del_fsc(self, st
+0001b950: 7275 6374 7572 652c 2074 6172 6765 745f  ructure, target_
+0001b960: 6d61 702c 206d 6170 5f72 6573 6f6c 7574  map, map_resolut
+0001b970: 696f 6e2c 206d 6173 6b3d 4e6f 6e65 2c0a  ion, mask=None,.
+0001b980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b990: 2020 2020 2020 7369 6d5f 6d61 703d 4e6f        sim_map=No
+0001b9a0: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
+0001b9b0: 4361 6c63 756c 6174 6520 7468 6520 6d61  Calculate the ma
+0001b9c0: 702d 6d6f 6465 6c20 466f 7572 6965 7220  p-model Fourier 
+0001b9d0: 5368 656c 6c20 436f 7272 656c 6174 696f  Shell Correlatio
+0001b9e0: 6e20 2846 5343 292e 0a0a 2020 2020 2020  n (FSC)...      
+0001b9f0: 2020 4172 6775 6d65 6e74 733a 0a20 2020    Arguments:.   
+0001ba00: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+0001ba10: 7265 3a20 4120 6d6f 6465 6c20 7374 7275  re: A model stru
+0001ba20: 6374 7572 6520 696e 7374 616e 6365 2e0a  cture instance..
+0001ba30: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0001ba40: 6574 5f6d 6170 3a20 4120 4d61 7020 696e  et_map: A Map in
+0001ba50: 7374 616e 6365 2e0a 2020 2020 2020 2020  stance..        
+0001ba60: 2020 2020 6d61 705f 7265 736f 6c75 7469      map_resoluti
+0001ba70: 6f6e 3a20 5468 6520 7265 736f 6c75 7469  on: The resoluti
+0001ba80: 6f6e 206f 6620 7461 7267 6574 5f6d 6170  on of target_map
+0001ba90: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+0001baa0: 6b3a 2041 204d 6170 2069 6e73 7461 6e63  k: A Map instanc
+0001bab0: 6520 6f66 2061 2073 6f66 742d 6564 6765  e of a soft-edge
+0001bac0: 6420 6d61 736b 2e0a 2020 2020 2020 2020  d mask..        
+0001bad0: 2020 2020 7369 6d5f 6d61 703a 2041 204d      sim_map: A M
+0001bae0: 6170 2069 6e73 7461 6e63 6520 6f66 2061  ap instance of a
+0001baf0: 2070 7265 2d63 616c 6375 6c61 7465 6420   pre-calculated 
+0001bb00: 7369 6d75 6c61 7465 6420 6d61 702c 2069  simulated map, i
+0001bb10: 660a 2020 2020 2020 2020 2020 2020 2020  f.              
+0001bb20: 2020 6e6f 7420 6578 706c 6963 6974 6c79    not explicitly
+0001bb30: 2073 7570 706c 6965 6420 6974 2077 696c   supplied it wil
+0001bb40: 6c20 6265 2063 616c 6375 6c61 7465 6420  l be calculated 
+0001bb50: 6175 746f 6d61 7469 6361 6c6c 790a 2020  automatically.  
+0001bb60: 2020 2020 2020 2020 2020 2020 2020 6672                fr
+0001bb70: 6f6d 2074 6865 2073 7472 7563 7475 7265  om the structure
+0001bb80: 2069 6e73 7461 6e63 650a 0a20 2020 2020   instance..     
+0001bb90: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+0001bba0: 2020 2020 2020 2020 5468 6520 6d61 702d          The map-
+0001bbb0: 6d6f 6465 6c20 4653 4320 6173 2061 6e20  model FSC as an 
+0001bbc0: 6e70 2e61 7272 6179 2077 6974 6820 7368  np.array with sh
+0001bbd0: 6170 6520 2832 2c20 284e 202f 2032 2920  ape (2, (N / 2) 
+0001bbe0: 2b20 3129 2066 6f72 0a20 2020 2020 2020  + 1) for.       
+0001bbf0: 2020 2020 2061 6e20 696e 7075 7420 6d61       an input ma
+0001bc00: 7020 7769 7468 2073 6861 7065 2028 4e2c  p with shape (N,
+0001bc10: 204e 2c20 4e29 2e20 4f75 7470 7574 2068   N, N). Output h
+0001bc20: 6173 2066 6f72 6d61 743a 0a20 2020 2020  as format:.     
+0001bc30: 2020 2020 2020 2020 2020 2020 2020 205b                 [
+0001bc40: 5b73 6865 6c6c 2066 7265 7175 656e 6379  [shell frequency
+0001bc50: 2028 616e 6773 7472 6f6d 7329 2c20 636f   (angstroms), co
+0001bc60: 7272 656c 6174 696f 6e5d 0a20 2020 2020  rrelation].     
+0001bc70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bc80: 2020 2020 2020 2020 2020 202e 2e2e 2e2e             .....
+0001bc90: 2e2e 2e0a 2020 2020 2020 2020 2020 2020  ....            
+0001bca0: 2020 2020 2020 2020 5b73 6865 6c6c 2066          [shell f
+0001bcb0: 7265 7175 656e 6379 2028 616e 6773 7472  requency (angstr
+0001bcc0: 6f6d 7329 2c20 636f 7272 656c 6174 696f  oms), correlatio
+0001bcd0: 6e5d 5d0a 0a20 2020 2020 2020 2022 2222  n]]..        """
+0001bce0: 0a20 2020 2020 2020 2069 6620 7369 6d5f  .        if sim_
+0001bcf0: 6d61 7020 6973 204e 6f6e 653a 0a20 2020  map is None:.   
+0001bd00: 2020 2020 2020 2020 2062 6c75 7272 6572           blurrer
+0001bd10: 203d 2053 7472 7563 7475 7265 426c 7572   = StructureBlur
+0001bd20: 7265 7228 7769 7468 5f76 633d 5472 7565  rer(with_vc=True
+0001bd30: 290a 2020 2020 2020 2020 2020 2020 7369  ).            si
+0001bd40: 6d5f 6d61 7020 3d20 626c 7572 7265 722e  m_map = blurrer.
+0001bd50: 6761 7573 7369 616e 5f62 6c75 725f 7265  gaussian_blur_re
+0001bd60: 616c 5f73 7061 6365 280a 2020 2020 2020  al_space(.      
+0001bd70: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+0001bd80: 7572 652c 0a20 2020 2020 2020 2020 2020  ure,.           
+0001bd90: 2020 2020 206d 6170 5f72 6573 6f6c 7574       map_resolut
+0001bda0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
+0001bdb0: 2020 2020 2064 656e 734d 6170 3d74 6172       densMap=tar
+0001bdc0: 6765 745f 6d61 702c 0a20 2020 2020 2020  get_map,.       
+0001bdd0: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001bde0: 6966 206d 6173 6b3a 0a20 2020 2020 2020  if mask:.       
+0001bdf0: 2020 2020 2066 7363 203d 2066 6f75 7269       fsc = fouri
+0001be00: 6572 2e63 616c 6375 6c61 7465 5f66 7363  er.calculate_fsc
+0001be10: 5f77 6974 685f 6d61 736b 280a 2020 2020  _with_mask(.    
+0001be20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be40: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0001be50: 6574 5f6d 6170 2e66 756c 6c4d 6170 2c0a  et_map.fullMap,.
+0001be60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001be90: 7369 6d5f 6d61 702e 6675 6c6c 4d61 702c  sim_map.fullMap,
+0001bea0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bed0: 206d 6173 6b2c 0a20 2020 2020 2020 2020   mask,.         
+0001bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001bef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf00: 6d61 705f 7265 736f 6c75 7469 6f6e 2c0a  map_resolution,.
-0001bf10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf20: 6465 6e73 4d61 703d 7461 7267 6574 5f6d  densMap=target_m
-0001bf30: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
-0001bf40: 290a 0a20 2020 2020 2020 2069 6620 6d61  )..        if ma
-0001bf50: 736b 3a0a 2020 2020 2020 2020 2020 2020  sk:.            
-0001bf60: 6673 6320 3d20 666f 7572 6965 722e 6361  fsc = fourier.ca
-0001bf70: 6c63 756c 6174 655f 6673 635f 7769 7468  lculate_fsc_with
-0001bf80: 5f6d 6173 6b28 0a20 2020 2020 2020 2020  _mask(.         
+0001bf00: 2020 2020 2020 2070 6978 656c 5f73 697a         pixel_siz
+0001bf10: 653d 7461 7267 6574 5f6d 6170 2e61 7069  e=target_map.api
+0001bf20: 785b 305d 2c0a 2020 2020 2020 2020 2020  x[0],.          
+0001bf30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bf50: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0001bf60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001bf70: 2020 6673 6320 3d20 666f 7572 6965 722e    fsc = fourier.
+0001bf80: 6361 6c63 756c 6174 655f 6673 6328 0a20  calculate_fsc(. 
 0001bf90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001bfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001bfb0: 2020 2020 2020 2074 6172 6765 745f 6d61         target_ma
 0001bfc0: 702e 6675 6c6c 4d61 702c 0a20 2020 2020  p.fullMap,.     
 0001bfd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001bfe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bff0: 2020 2020 2020 2020 2020 2073 696d 5f6d             sim_m
-0001c000: 6170 2e66 756c 6c4d 6170 2c0a 2020 2020  ap.fullMap,.    
+0001bff0: 2020 2073 696d 5f6d 6170 2e66 756c 6c4d     sim_map.fullM
+0001c000: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
 0001c010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c030: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-0001c040: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c020: 2020 2020 2020 2020 2020 2020 7069 7865              pixe
+0001c030: 6c5f 7369 7a65 3d74 6172 6765 745f 6d61  l_size=target_ma
+0001c040: 702e 6170 6978 5b30 5d2c 0a20 2020 2020  p.apix[0],.     
 0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001c060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c070: 2020 7069 7865 6c5f 7369 7a65 3d74 6172    pixel_size=tar
-0001c080: 6765 745f 6d61 702e 6170 6978 5b30 5d2c  get_map.apix[0],
-0001c090: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 2029 0a20 2020 2020 2020 2065 6c73 653a   ).        else:
-0001c0d0: 0a20 2020 2020 2020 2020 2020 2066 7363  .            fsc
-0001c0e0: 203d 2066 6f75 7269 6572 2e63 616c 6375   = fourier.calcu
-0001c0f0: 6c61 7465 5f66 7363 280a 2020 2020 2020  late_fsc(.      
-0001c100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c120: 2020 7461 7267 6574 5f6d 6170 2e66 756c    target_map.ful
-0001c130: 6c4d 6170 2c0a 2020 2020 2020 2020 2020  lMap,.          
-0001c140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c150: 2020 2020 2020 2020 2020 2020 2020 7369                si
-0001c160: 6d5f 6d61 702e 6675 6c6c 4d61 702c 0a20  m_map.fullMap,. 
-0001c170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c190: 2020 2020 2020 2070 6978 656c 5f73 697a         pixel_siz
-0001c1a0: 653d 7461 7267 6574 5f6d 6170 2e61 7069  e=target_map.api
-0001c1b0: 785b 305d 2c0a 2020 2020 2020 2020 2020  x[0],.          
-0001c1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c1d0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
-0001c1e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c1f0: 6673 630a 0a20 2020 2064 6566 204c 6f51  fsc..    def LoQ
-0001c200: 4669 7428 0a20 2020 2020 2020 2020 2020  Fit(.           
-0001c210: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-0001c220: 2020 2073 7472 7563 7475 7265 2c0a 2020     structure,.  
-0001c230: 2020 2020 2020 2020 2020 7461 7267 6574            target
-0001c240: 5f6d 6170 2c0a 2020 2020 2020 2020 2020  _map,.          
-0001c250: 2020 7265 736f 6c75 7469 6f6e 5f6d 6170    resolution_map
-0001c260: 5f74 6172 6765 742c 0a20 2020 2020 2020  _target,.       
-0001c270: 2020 2020 2073 696d 5f6d 6170 3d4e 6f6e       sim_map=Non
-0001c280: 652c 0a20 2020 2020 2020 2020 2020 206d  e,.            m
-0001c290: 6178 5f72 6573 3d31 382e 2c0a 2020 2020  ax_res=18.,.    
-0001c2a0: 2020 2020 2020 2020 7665 7262 6f73 653d          verbose=
-0001c2b0: 5472 7565 2c0a 2020 2020 2020 2020 2020  True,.          
-0001c2c0: 2020 6861 6c66 5f6d 6170 5f31 3d4e 6f6e    half_map_1=Non
-0001c2d0: 652c 0a20 2020 2020 2020 2020 2020 2068  e,.            h
-0001c2e0: 616c 665f 6d61 705f 323d 4e6f 6e65 2c0a  alf_map_2=None,.
-0001c2f0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
-0001c300: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
-0001c310: 6174 6520 7468 6520 4c6f 5146 6974 2073  ate the LoQFit s
-0001c320: 636f 7265 2066 6f72 2065 6163 6820 7265  core for each re
-0001c330: 7369 6475 6520 696e 2061 206d 6f64 656c  sidue in a model
-0001c340: 2e0a 0a20 2020 2020 2020 2054 6865 204c  ...        The L
-0001c350: 6f51 4669 7420 7363 6f72 6520 6973 2065  oQFit score is e
-0001c360: 7373 656e 7469 616c 6c79 2061 206c 6f63  ssentially a loc
-0001c370: 616c 2069 6d70 6c65 6d65 6e74 6174 696f  al implementatio
-0001c380: 6e20 6f66 2074 6865 0a20 2020 2020 2020  n of the.       
-0001c390: 206d 6170 2d6d 6f64 656c 2046 5343 2e20   map-model FSC. 
-0001c3a0: 4d6f 7265 2069 6e66 6f72 6d61 7469 6f6e  More information
-0001c3b0: 2063 616e 2062 6520 666f 756e 6420 6865   can be found he
-0001c3c0: 7265 3a0a 2020 2020 2020 2020 6874 7470  re:.        http
-0001c3d0: 733a 2f2f 7777 772e 6269 6f72 7869 762e  s://www.biorxiv.
-0001c3e0: 6f72 672f 636f 6e74 656e 742f 3130 2e31  org/content/10.1
-0001c3f0: 3130 312f 3230 3232 2e30 362e 3038 2e34  101/2022.06.08.4
-0001c400: 3935 3235 3976 310a 0a20 2020 2020 2020  95259v1..       
-0001c410: 2041 7267 756d 656e 7473 3a0a 2020 2020   Arguments:.    
-0001c420: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-0001c430: 653a 204d 6f64 656c 2073 7472 7563 7475  e: Model structu
-0001c440: 7265 2069 6e73 7461 6e63 650a 2020 2020  re instance.    
-0001c450: 2020 2020 2020 2020 7461 7267 6574 5f6d          target_m
-0001c460: 6170 3a20 4578 7065 7269 6d65 6e74 616c  ap: Experimental
-0001c470: 204d 6170 2069 6e73 7461 6e63 650a 2020   Map instance.  
-0001c480: 2020 2020 2020 2020 2020 7265 736f 6c75            resolu
-0001c490: 7469 6f6e 5f6d 6170 5f74 6172 6765 743a  tion_map_target:
-0001c4a0: 2054 6865 2072 6573 6f6c 7574 696f 6e20   The resolution 
-0001c4b0: 6f66 2074 6865 2074 6172 6765 7420 6d61  of the target ma
-0001c4c0: 700a 2020 2020 2020 2020 2020 2020 7369  p.            si
-0001c4d0: 6d5f 6d61 703a 2050 7265 2d63 616c 6375  m_map: Pre-calcu
-0001c4e0: 6c61 7465 6420 7369 6d75 6c61 7465 6420  lated simulated 
-0001c4f0: 6d61 7020 2d20 7769 6c6c 2062 6520 6361  map - will be ca
-0001c500: 6c63 756c 6174 6564 0a20 2020 2020 2020  lculated.       
-0001c510: 2020 2020 2020 2020 2061 7574 6f6d 6174           automat
-0001c520: 6963 616c 6c79 2069 6620 6e6f 7420 7375  ically if not su
-0001c530: 7070 6c69 6564 0a20 2020 2020 2020 2020  pplied.         
-0001c540: 2020 206d 6178 5f72 6573 3a20 5468 6520     max_res: The 
-0001c550: 6d61 7869 6d75 6d20 616c 6c6f 7765 6420  maximum allowed 
-0001c560: 4c6f 5146 6974 2073 636f 7265 2066 6f72  LoQFit score for
-0001c570: 2061 6e79 2072 6573 6964 7565 2c20 7468   any residue, th
-0001c580: 6973 0a20 2020 2020 2020 2020 2020 2020  is.             
-0001c590: 2020 2070 6172 616d 6574 6572 2070 7265     parameter pre
-0001c5a0: 7665 6e74 730a 2020 2020 2020 2020 2020  vents.          
-0001c5b0: 2020 7665 7262 6f73 653a 2049 6620 5472    verbose: If Tr
-0001c5c0: 7565 2c20 7072 696e 7473 2061 2070 726f  ue, prints a pro
-0001c5d0: 6772 6573 7320 6261 7220 616e 6420 7761  gress bar and wa
-0001c5e0: 726e 696e 6773 0a20 2020 2020 2020 2020  rnings.         
-0001c5f0: 2020 2068 616c 665f 6d61 705f 313a 2041     half_map_1: A
-0001c600: 206d 6170 2069 6e73 7461 6e63 6520 6f66   map instance of
-0001c610: 2061 2068 616c 662d 6d61 7020 6672 6f6d   a half-map from
-0001c620: 2072 6563 6f6e 7374 7275 6374 696f 6e20   reconstruction 
-0001c630: 6f66 2074 6865 0a20 2020 2020 2020 2020  of the.         
-0001c640: 2020 2020 2020 2074 6172 6765 7420 6d61         target ma
-0001c650: 702e 2049 6620 7375 7070 6c69 6564 2028  p. If supplied (
-0001c660: 7769 7468 2073 6563 6f6e 6420 6861 6c66  with second half
-0001c670: 206d 6170 292c 2074 6869 7320 7769 6c6c   map), this will
-0001c680: 2062 650a 2020 2020 2020 2020 2020 2020   be.            
-0001c690: 2020 2020 7573 6564 2074 6f20 6e6f 726d      used to norm
-0001c6a0: 616c 6973 6520 7468 6520 4c6f 5146 6974  alise the LoQFit
-0001c6b0: 2073 636f 7265 0a20 2020 2020 2020 2020   score.         
-0001c6c0: 2020 2068 616c 665f 6d61 705f 323a 2041     half_map_2: A
-0001c6d0: 206d 6170 2069 6e73 7461 6e63 6520 6f66   map instance of
-0001c6e0: 2074 6865 2073 6563 6f6e 6420 6861 6c66   the second half
-0001c6f0: 206d 6170 2066 726f 6d0a 2020 2020 2020   map from.      
-0001c700: 2020 2020 2020 2020 2020 7461 7267 6574            target
-0001c710: 5f6d 6170 2072 6563 6f6e 7374 7275 6374  _map reconstruct
-0001c720: 696f 6e2e 0a0a 2020 2020 2020 2020 5265  ion...        Re
-0001c730: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-0001c740: 2020 2054 6865 204c 6f51 4669 7420 7363     The LoQFit sc
-0001c750: 6f72 6520 666f 7220 6561 6368 2072 6573  ore for each res
-0001c760: 6964 7565 2069 6e20 7374 7275 6374 7572  idue in structur
-0001c770: 6520 696e 7374 616e 6365 2e0a 2020 2020  e instance..    
-0001c780: 2020 2020 2020 2020 5468 6520 6f75 7470          The outp
-0001c790: 7574 2069 7320 6120 6469 6374 696f 6e61  ut is a dictiona
-0001c7a0: 7279 2077 6974 6820 6b65 7973 3a0a 2020  ry with keys:.  
-0001c7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7c0: 2863 6861 696e 5f69 642c 2072 6573 6964  (chain_id, resid
-0001c7d0: 7565 5f6e 756d 6265 7229 0a20 2020 2020  ue_number).     
-0001c7e0: 2020 2020 2020 2077 6865 7265 2065 6163         where eac
-0001c7f0: 6820 7661 6c75 6520 6973 2074 6865 204c  h value is the L
-0001c800: 6f51 4669 7420 7363 6f72 6520 666f 7220  oQFit score for 
-0001c810: 6120 6769 7665 6e20 7265 7369 6475 652e  a given residue.
-0001c820: 2049 660a 2020 2020 2020 2020 2020 2020   If.            
-0001c830: 6861 6c66 5f6d 6170 5f31 2061 6e64 2068  half_map_1 and h
-0001c840: 616c 665f 6d61 705f 3220 6172 6775 6d65  alf_map_2 argume
-0001c850: 6e74 7320 6172 6520 7375 7070 6c69 6564  nts are supplied
-0001c860: 2074 6865 204c 6f51 4669 740a 2020 2020   the LoQFit.    
-0001c870: 2020 2020 2020 2020 7363 6f72 6520 7769          score wi
-0001c880: 6c6c 2062 6520 6e6f 726d 616c 6973 6564  ll be normalised
-0001c890: 2062 6173 6564 206f 6e20 7468 6520 6c6f   based on the lo
-0001c8a0: 6361 6c20 7265 736f 6c75 7469 6f6e 2e0a  cal resolution..
-0001c8b0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0001c8c0: 2020 2020 7072 696e 7428 6622 4361 6c63      print(f"Calc
-0001c8d0: 756c 6174 696e 6720 4c6f 5146 6974 2073  ulating LoQFit s
-0001c8e0: 636f 7265 2066 6f72 206d 6f64 656c 207b  core for model {
-0001c8f0: 7374 7275 6374 7572 652e 6669 6c65 6e61  structure.filena
-0001c900: 6d65 7d20 696e 746f 2022 0a20 2020 2020  me} into ".     
-0001c910: 2020 2020 2020 2020 2066 226d 6170 207b           f"map {
-0001c920: 7461 7267 6574 5f6d 6170 2e66 696c 656e  target_map.filen
-0001c930: 616d 657d 2229 0a0a 2020 2020 2020 2020  ame}")..        
-0001c940: 2320 7365 7420 7570 2073 6f6d 6520 7374  # set up some st
-0001c950: 7566 660a 2020 2020 2020 2020 7461 7267  uff.        targ
-0001c960: 6574 5f6d 6170 2e61 7069 7820 3d20 6e70  et_map.apix = np
-0001c970: 2e61 7272 6179 2874 6172 6765 745f 6d61  .array(target_ma
-0001c980: 702e 6170 6978 290a 2020 2020 2020 2020  p.apix).        
-0001c990: 626c 7572 7265 7220 3d20 5374 7275 6374  blurrer = Struct
-0001c9a0: 7572 6542 6c75 7272 6572 2877 6974 685f  ureBlurrer(with_
-0001c9b0: 7663 3d54 7275 6529 0a0a 2020 2020 2020  vc=True)..      
-0001c9c0: 2020 6966 2073 696d 5f6d 6170 2069 7320    if sim_map is 
-0001c9d0: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
-0001c9e0: 2020 7369 6d5f 6d61 7020 3d20 626c 7572    sim_map = blur
-0001c9f0: 7265 722e 6761 7573 7369 616e 5f62 6c75  rer.gaussian_blu
-0001ca00: 725f 7265 616c 5f73 7061 6365 280a 2020  r_real_space(.  
-0001ca10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2020 7374 7275 6374 7572 652c 0a20 2020    structure,.   
-0001ca50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca80: 2072 6573 6f6c 7574 696f 6e5f 6d61 705f   resolution_map_
-0001ca90: 7461 7267 6574 2c0a 2020 2020 2020 2020  target,.        
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c070: 2020 2029 0a0a 2020 2020 2020 2020 7265     )..        re
+0001c080: 7475 726e 2066 7363 0a0a 2020 2020 6465  turn fsc..    de
+0001c090: 6620 4c6f 5146 6974 280a 2020 2020 2020  f LoQFit(.      
+0001c0a0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001c0b0: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0001c0c0: 652c 0a20 2020 2020 2020 2020 2020 2074  e,.            t
+0001c0d0: 6172 6765 745f 6d61 702c 0a20 2020 2020  arget_map,.     
+0001c0e0: 2020 2020 2020 2072 6573 6f6c 7574 696f         resolutio
+0001c0f0: 6e5f 6d61 705f 7461 7267 6574 2c0a 2020  n_map_target,.  
+0001c100: 2020 2020 2020 2020 2020 7369 6d5f 6d61            sim_ma
+0001c110: 703d 4e6f 6e65 2c0a 2020 2020 2020 2020  p=None,.        
+0001c120: 2020 2020 6d61 785f 7265 733d 3138 2e2c      max_res=18.,
+0001c130: 0a20 2020 2020 2020 2020 2020 2076 6572  .            ver
+0001c140: 626f 7365 3d54 7275 652c 0a20 2020 2020  bose=True,.     
+0001c150: 2020 2020 2020 2068 616c 665f 6d61 705f         half_map_
+0001c160: 313d 4e6f 6e65 2c0a 2020 2020 2020 2020  1=None,.        
+0001c170: 2020 2020 6861 6c66 5f6d 6170 5f32 3d4e      half_map_2=N
+0001c180: 6f6e 652c 0a20 2020 2020 2020 2020 2020  one,.           
+0001c190: 2029 3a0a 2020 2020 2020 2020 2222 2243   ):.        """C
+0001c1a0: 616c 6375 6c61 7465 2074 6865 204c 6f51  alculate the LoQ
+0001c1b0: 4669 7420 7363 6f72 6520 666f 7220 6561  Fit score for ea
+0001c1c0: 6368 2072 6573 6964 7565 2069 6e20 6120  ch residue in a 
+0001c1d0: 6d6f 6465 6c2e 0a0a 2020 2020 2020 2020  model...        
+0001c1e0: 5468 6520 4c6f 5146 6974 2073 636f 7265  The LoQFit score
+0001c1f0: 2069 7320 6573 7365 6e74 6961 6c6c 7920   is essentially 
+0001c200: 6120 6c6f 6361 6c20 696d 706c 656d 656e  a local implemen
+0001c210: 7461 7469 6f6e 206f 6620 7468 650a 2020  tation of the.  
+0001c220: 2020 2020 2020 6d61 702d 6d6f 6465 6c20        map-model 
+0001c230: 4653 432e 204d 6f72 6520 696e 666f 726d  FSC. More inform
+0001c240: 6174 696f 6e20 6361 6e20 6265 2066 6f75  ation can be fou
+0001c250: 6e64 2068 6572 653a 0a20 2020 2020 2020  nd here:.       
+0001c260: 2068 7474 7073 3a2f 2f77 7777 2e62 696f   https://www.bio
+0001c270: 7278 6976 2e6f 7267 2f63 6f6e 7465 6e74  rxiv.org/content
+0001c280: 2f31 302e 3131 3031 2f32 3032 322e 3036  /10.1101/2022.06
+0001c290: 2e30 382e 3439 3532 3539 7631 0a0a 2020  .08.495259v1..  
+0001c2a0: 2020 2020 2020 4172 6775 6d65 6e74 733a        Arguments:
+0001c2b0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+0001c2c0: 7563 7475 7265 3a20 4d6f 6465 6c20 7374  ucture: Model st
+0001c2d0: 7275 6374 7572 6520 696e 7374 616e 6365  ructure instance
+0001c2e0: 0a20 2020 2020 2020 2020 2020 2074 6172  .            tar
+0001c2f0: 6765 745f 6d61 703a 2045 7870 6572 696d  get_map: Experim
+0001c300: 656e 7461 6c20 4d61 7020 696e 7374 616e  ental Map instan
+0001c310: 6365 0a20 2020 2020 2020 2020 2020 2072  ce.            r
+0001c320: 6573 6f6c 7574 696f 6e5f 6d61 705f 7461  esolution_map_ta
+0001c330: 7267 6574 3a20 5468 6520 7265 736f 6c75  rget: The resolu
+0001c340: 7469 6f6e 206f 6620 7468 6520 7461 7267  tion of the targ
+0001c350: 6574 206d 6170 0a20 2020 2020 2020 2020  et map.         
+0001c360: 2020 2073 696d 5f6d 6170 3a20 5072 652d     sim_map: Pre-
+0001c370: 6361 6c63 756c 6174 6564 2073 696d 756c  calculated simul
+0001c380: 6174 6564 206d 6170 202d 2077 696c 6c20  ated map - will 
+0001c390: 6265 2063 616c 6375 6c61 7465 640a 2020  be calculated.  
+0001c3a0: 2020 2020 2020 2020 2020 2020 2020 6175                au
+0001c3b0: 746f 6d61 7469 6361 6c6c 7920 6966 206e  tomatically if n
+0001c3c0: 6f74 2073 7570 706c 6965 640a 2020 2020  ot supplied.    
+0001c3d0: 2020 2020 2020 2020 6d61 785f 7265 733a          max_res:
+0001c3e0: 2054 6865 206d 6178 696d 756d 2061 6c6c   The maximum all
+0001c3f0: 6f77 6564 204c 6f51 4669 7420 7363 6f72  owed LoQFit scor
+0001c400: 6520 666f 7220 616e 7920 7265 7369 6475  e for any residu
+0001c410: 652c 2074 6869 730a 2020 2020 2020 2020  e, this.        
+0001c420: 2020 2020 2020 2020 7061 7261 6d65 7465          paramete
+0001c430: 7220 7072 6576 656e 7473 0a20 2020 2020  r prevents.     
+0001c440: 2020 2020 2020 2076 6572 626f 7365 3a20         verbose: 
+0001c450: 4966 2054 7275 652c 2070 7269 6e74 7320  If True, prints 
+0001c460: 6120 7072 6f67 7265 7373 2062 6172 2061  a progress bar a
+0001c470: 6e64 2077 6172 6e69 6e67 730a 2020 2020  nd warnings.    
+0001c480: 2020 2020 2020 2020 6861 6c66 5f6d 6170          half_map
+0001c490: 5f31 3a20 4120 6d61 7020 696e 7374 616e  _1: A map instan
+0001c4a0: 6365 206f 6620 6120 6861 6c66 2d6d 6170  ce of a half-map
+0001c4b0: 2066 726f 6d20 7265 636f 6e73 7472 7563   from reconstruc
+0001c4c0: 7469 6f6e 206f 6620 7468 650a 2020 2020  tion of the.    
+0001c4d0: 2020 2020 2020 2020 2020 2020 7461 7267              targ
+0001c4e0: 6574 206d 6170 2e20 4966 2073 7570 706c  et map. If suppl
+0001c4f0: 6965 6420 2877 6974 6820 7365 636f 6e64  ied (with second
+0001c500: 2068 616c 6620 6d61 7029 2c20 7468 6973   half map), this
+0001c510: 2077 696c 6c20 6265 0a20 2020 2020 2020   will be.       
+0001c520: 2020 2020 2020 2020 2075 7365 6420 746f           used to
+0001c530: 206e 6f72 6d61 6c69 7365 2074 6865 204c   normalise the L
+0001c540: 6f51 4669 7420 7363 6f72 650a 2020 2020  oQFit score.    
+0001c550: 2020 2020 2020 2020 6861 6c66 5f6d 6170          half_map
+0001c560: 5f32 3a20 4120 6d61 7020 696e 7374 616e  _2: A map instan
+0001c570: 6365 206f 6620 7468 6520 7365 636f 6e64  ce of the second
+0001c580: 2068 616c 6620 6d61 7020 6672 6f6d 0a20   half map from. 
+0001c590: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001c5a0: 6172 6765 745f 6d61 7020 7265 636f 6e73  arget_map recons
+0001c5b0: 7472 7563 7469 6f6e 2e0a 0a20 2020 2020  truction...     
+0001c5c0: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+0001c5d0: 2020 2020 2020 2020 5468 6520 4c6f 5146          The LoQF
+0001c5e0: 6974 2073 636f 7265 2066 6f72 2065 6163  it score for eac
+0001c5f0: 6820 7265 7369 6475 6520 696e 2073 7472  h residue in str
+0001c600: 7563 7475 7265 2069 6e73 7461 6e63 652e  ucture instance.
+0001c610: 0a20 2020 2020 2020 2020 2020 2054 6865  .            The
+0001c620: 206f 7574 7075 7420 6973 2061 2064 6963   output is a dic
+0001c630: 7469 6f6e 6172 7920 7769 7468 206b 6579  tionary with key
+0001c640: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0001c650: 2020 2020 2028 6368 6169 6e5f 6964 2c20       (chain_id, 
+0001c660: 7265 7369 6475 655f 6e75 6d62 6572 290a  residue_number).
+0001c670: 2020 2020 2020 2020 2020 2020 7768 6572              wher
+0001c680: 6520 6561 6368 2076 616c 7565 2069 7320  e each value is 
+0001c690: 7468 6520 4c6f 5146 6974 2073 636f 7265  the LoQFit score
+0001c6a0: 2066 6f72 2061 2067 6976 656e 2072 6573   for a given res
+0001c6b0: 6964 7565 2e20 4966 0a20 2020 2020 2020  idue. If.       
+0001c6c0: 2020 2020 2068 616c 665f 6d61 705f 3120       half_map_1 
+0001c6d0: 616e 6420 6861 6c66 5f6d 6170 5f32 2061  and half_map_2 a
+0001c6e0: 7267 756d 656e 7473 2061 7265 2073 7570  rguments are sup
+0001c6f0: 706c 6965 6420 7468 6520 4c6f 5146 6974  plied the LoQFit
+0001c700: 0a20 2020 2020 2020 2020 2020 2073 636f  .            sco
+0001c710: 7265 2077 696c 6c20 6265 206e 6f72 6d61  re will be norma
+0001c720: 6c69 7365 6420 6261 7365 6420 6f6e 2074  lised based on t
+0001c730: 6865 206c 6f63 616c 2072 6573 6f6c 7574  he local resolut
+0001c740: 696f 6e2e 0a20 2020 2020 2020 2022 2222  ion..        """
+0001c750: 0a20 2020 2020 2020 2070 7269 6e74 2866  .        print(f
+0001c760: 2243 616c 6375 6c61 7469 6e67 204c 6f51  "Calculating LoQ
+0001c770: 4669 7420 7363 6f72 6520 666f 7220 6d6f  Fit score for mo
+0001c780: 6465 6c20 7b73 7472 7563 7475 7265 2e66  del {structure.f
+0001c790: 696c 656e 616d 657d 2069 6e74 6f20 220a  ilename} into ".
+0001c7a0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001c7b0: 6d61 7020 7b74 6172 6765 745f 6d61 702e  map {target_map.
+0001c7c0: 6669 6c65 6e61 6d65 7d22 290a 0a20 2020  filename}")..   
+0001c7d0: 2020 2020 2023 2073 6574 2075 7020 736f       # set up so
+0001c7e0: 6d65 2073 7475 6666 0a20 2020 2020 2020  me stuff.       
+0001c7f0: 2074 6172 6765 745f 6d61 702e 6170 6978   target_map.apix
+0001c800: 203d 206e 702e 6172 7261 7928 7461 7267   = np.array(targ
+0001c810: 6574 5f6d 6170 2e61 7069 7829 0a20 2020  et_map.apix).   
+0001c820: 2020 2020 2062 6c75 7272 6572 203d 2053       blurrer = S
+0001c830: 7472 7563 7475 7265 426c 7572 7265 7228  tructureBlurrer(
+0001c840: 7769 7468 5f76 633d 5472 7565 290a 0a20  with_vc=True).. 
+0001c850: 2020 2020 2020 2069 6620 7369 6d5f 6d61         if sim_ma
+0001c860: 7020 6973 204e 6f6e 653a 0a20 2020 2020  p is None:.     
+0001c870: 2020 2020 2020 2073 696d 5f6d 6170 203d         sim_map =
+0001c880: 2062 6c75 7272 6572 2e67 6175 7373 6961   blurrer.gaussia
+0001c890: 6e5f 626c 7572 5f72 6561 6c5f 7370 6163  n_blur_real_spac
+0001c8a0: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+0001c8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c8d0: 2020 2020 2020 2073 7472 7563 7475 7265         structure
+0001c8e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c910: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+0001c920: 5f6d 6170 5f74 6172 6765 742c 0a20 2020  _map_target,.   
+0001c930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c960: 2064 656e 734d 6170 3d74 6172 6765 745f   densMap=target_
+0001c970: 6d61 7029 0a20 2020 2020 2020 2066 7363  map).        fsc
+0001c980: 5f74 6872 6573 686f 6c64 203d 2030 2e35  _threshold = 0.5
+0001c990: 0a20 2020 2020 2020 2073 696d 5f6d 6170  .        sim_map
+0001c9a0: 2e6e 6f72 6d61 6c69 7365 5f74 6f5f 315f  .normalise_to_1_
+0001c9b0: 6d69 6e75 7331 2869 6e5f 706c 6163 653d  minus1(in_place=
+0001c9c0: 5472 7565 290a 2020 2020 2020 2020 7461  True).        ta
+0001c9d0: 7267 6574 5f6d 6170 2e6e 6f72 6d61 6c69  rget_map.normali
+0001c9e0: 7365 5f74 6f5f 315f 6d69 6e75 7331 2869  se_to_1_minus1(i
+0001c9f0: 6e5f 706c 6163 653d 5472 7565 290a 0a20  n_place=True).. 
+0001ca00: 2020 2020 2020 2023 2061 7070 726f 7869         # approxi
+0001ca10: 6d61 7465 206d 6173 6b20 7370 6865 7265  mate mask sphere
+0001ca20: 2064 6961 6d65 7465 720a 2020 2020 2020   diameter.      
+0001ca30: 2020 7370 6865 7265 5f64 6961 6d65 7465    sphere_diamete
+0001ca40: 725f 616e 6773 7472 6f6d 7320 3d20 7265  r_angstroms = re
+0001ca50: 736f 6c75 7469 6f6e 5f6d 6170 5f74 6172  solution_map_tar
+0001ca60: 6765 7420 2a20 350a 2020 2020 2020 2020  get * 5.        
+0001ca70: 7370 6865 7265 5f64 6961 6d65 7465 725f  sphere_diameter_
+0001ca80: 7069 7865 6c73 203d 2069 6e74 2873 7068  pixels = int(sph
+0001ca90: 6572 655f 6469 616d 6574 6572 5f61 6e67  ere_diameter_ang
+0001caa0: 7374 726f 6d73 202f 0a20 2020 2020 2020  stroms /.       
 0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 2020 2020 2020 2020 2020 2020 6465 6e73              dens
-0001cad0: 4d61 703d 7461 7267 6574 5f6d 6170 290a  Map=target_map).
-0001cae0: 2020 2020 2020 2020 6673 635f 7468 7265          fsc_thre
-0001caf0: 7368 6f6c 6420 3d20 302e 350a 2020 2020  shold = 0.5.    
-0001cb00: 2020 2020 7369 6d5f 6d61 702e 6e6f 726d      sim_map.norm
-0001cb10: 616c 6973 655f 746f 5f31 5f6d 696e 7573  alise_to_1_minus
-0001cb20: 3128 696e 5f70 6c61 6365 3d54 7275 6529  1(in_place=True)
-0001cb30: 0a20 2020 2020 2020 2074 6172 6765 745f  .        target_
-0001cb40: 6d61 702e 6e6f 726d 616c 6973 655f 746f  map.normalise_to
-0001cb50: 5f31 5f6d 696e 7573 3128 696e 5f70 6c61  _1_minus1(in_pla
-0001cb60: 6365 3d54 7275 6529 0a0a 2020 2020 2020  ce=True)..      
-0001cb70: 2020 2320 6170 7072 6f78 696d 6174 6520    # approximate 
-0001cb80: 6d61 736b 2073 7068 6572 6520 6469 616d  mask sphere diam
-0001cb90: 6574 6572 0a20 2020 2020 2020 2073 7068  eter.        sph
-0001cba0: 6572 655f 6469 616d 6574 6572 5f61 6e67  ere_diameter_ang
-0001cbb0: 7374 726f 6d73 203d 2072 6573 6f6c 7574  stroms = resolut
-0001cbc0: 696f 6e5f 6d61 705f 7461 7267 6574 202a  ion_map_target *
-0001cbd0: 2035 0a20 2020 2020 2020 2073 7068 6572   5.        spher
-0001cbe0: 655f 6469 616d 6574 6572 5f70 6978 656c  e_diameter_pixel
-0001cbf0: 7320 3d20 696e 7428 7370 6865 7265 5f64  s = int(sphere_d
-0001cc00: 6961 6d65 7465 725f 616e 6773 7472 6f6d  iameter_angstrom
-0001cc10: 7320 2f0a 2020 2020 2020 2020 2020 2020  s /.            
-0001cc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc30: 2020 2020 2020 2020 2074 6172 6765 745f           target_
-0001cc40: 6d61 702e 6170 6978 5b30 5d29 0a0a 2020  map.apix[0])..  
-0001cc50: 2020 2020 2020 2320 656e 7375 7265 2074        # ensure t
-0001cc60: 6861 7420 7061 7261 6d65 7465 7273 2061  hat parameters a
-0001cc70: 7265 2073 656e 7369 626c 6520 692e 652e  re sensible i.e.
-0001cc80: 206e 6f74 2061 2031 2070 6978 656c 2077   not a 1 pixel w
-0001cc90: 6964 6520 6d61 736b 0a20 2020 2020 2020  ide mask.       
-0001cca0: 2069 6620 7370 6865 7265 5f64 6961 6d65   if sphere_diame
-0001ccb0: 7465 725f 7069 7865 6c73 203c 2036 3a0a  ter_pixels < 6:.
-0001ccc0: 2020 2020 2020 2020 2020 2020 7370 6865              sphe
-0001ccd0: 7265 5f64 6961 6d65 7465 725f 7069 7865  re_diameter_pixe
-0001cce0: 6c73 203d 2036 0a20 2020 2020 2020 2063  ls = 6.        c
-0001ccf0: 6f73 5f65 6467 6520 3d20 696e 7428 726f  os_edge = int(ro
-0001cd00: 756e 6428 7370 6865 7265 5f64 6961 6d65  und(sphere_diame
-0001cd10: 7465 725f 7069 7865 6c73 202f 2033 2929  ter_pixels / 3))
-0001cd20: 0a20 2020 2020 2020 2069 6620 636f 735f  .        if cos_
-0001cd30: 6564 6765 203c 2031 303a 0a20 2020 2020  edge < 10:.     
-0001cd40: 2020 2020 2020 2063 6f73 5f65 6467 6520         cos_edge 
-0001cd50: 3d20 3130 0a0a 2020 2020 2020 2020 6966  = 10..        if
-0001cd60: 2068 616c 665f 6d61 705f 3120 6973 206e   half_map_1 is n
-0001cd70: 6f74 204e 6f6e 6520 616e 6420 6861 6c66  ot None and half
-0001cd80: 5f6d 6170 5f32 2069 7320 6e6f 7420 4e6f  _map_2 is not No
-0001cd90: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
-0001cda0: 696e 7465 7270 6f6c 6174 655f 6375 746f  interpolate_cuto
-0001cdb0: 6666 203d 2046 616c 7365 0a20 2020 2020  ff = False.     
-0001cdc0: 2020 2020 2020 206e 6f72 6d61 6c69 7365         normalise
-0001cdd0: 5f77 6974 685f 6861 6c66 5f6d 6170 203d  _with_half_map =
-0001cde0: 2054 7275 650a 2020 2020 2020 2020 2020   True.          
-0001cdf0: 2020 6861 6c66 5f6d 6170 5f31 2e6f 7269    half_map_1.ori
-0001ce00: 6769 6e20 3d20 7461 7267 6574 5f6d 6170  gin = target_map
-0001ce10: 2e6f 7269 6769 6e0a 2020 2020 2020 2020  .origin.        
-0001ce20: 2020 2020 6861 6c66 5f6d 6170 5f32 2e6f      half_map_2.o
-0001ce30: 7269 6769 6e20 3d20 7461 7267 6574 5f6d  rigin = target_m
-0001ce40: 6170 2e6f 7269 6769 6e0a 2020 2020 2020  ap.origin.      
-0001ce50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001ce60: 2020 2020 696e 7465 7270 6f6c 6174 655f      interpolate_
-0001ce70: 6375 746f 6666 203d 2054 7275 650a 2020  cutoff = True.  
-0001ce80: 2020 2020 2020 2020 2020 6e6f 726d 616c            normal
-0001ce90: 6973 655f 7769 7468 5f68 616c 665f 6d61  ise_with_half_ma
-0001cea0: 7020 3d20 4661 6c73 650a 0a20 2020 2020  p = False..     
-0001ceb0: 2020 2023 2067 6574 2061 6e20 6170 7072     # get an appr
-0001cec0: 6f70 7269 6174 6520 626f 7820 7369 7a65  opriate box size
-0001ced0: 2074 6f20 6372 6f70 2066 726f 6d20 6d61   to crop from ma
-0001cee0: 696e 206d 6170 0a20 2020 2020 2020 2023  in map.        #
-0001cef0: 2077 696c 6c20 6265 2032 5e6e 2c20 335e   will be 2^n, 3^
-0001cf00: 6e20 6f72 2035 5e6e 2073 697a 6520 7768  n or 5^n size wh
-0001cf10: 6572 6520 6e20 6973 2074 6865 206e 756d  ere n is the num
-0001cf20: 6265 7220 7265 7175 6972 6564 2066 6f72  ber required for
-0001cf30: 0a20 2020 2020 2020 2023 2074 6865 206d  .        # the m
-0001cf40: 696e 696d 756d 2062 6f78 2073 697a 6520  inimum box size 
-0001cf50: 6e65 6564 6564 2074 6f20 656e 636f 6d70  needed to encomp
-0001cf60: 6173 7320 656e 7469 7265 206d 6173 6b20  ass entire mask 
-0001cf70: 696e 2062 6f78 0a20 2020 2020 2020 206d  in box.        m
-0001cf80: 6173 6b5f 6469 6d73 203d 2066 6f75 7269  ask_dims = fouri
-0001cf90: 6572 2e67 6574 5f66 6674 5f6f 7074 696d  er.get_fft_optim
-0001cfa0: 6973 6564 5f62 6f78 5f73 697a 6528 0a20  ised_box_size(. 
-0001cfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cfd0: 2020 2073 7068 6572 655f 6469 616d 6574     sphere_diamet
-0001cfe0: 6572 5f70 6978 656c 7320 2b20 2832 2a63  er_pixels + (2*c
-0001cff0: 6f73 5f65 6467 6529 2c0a 2020 2020 2020  os_edge),.      
+0001cac0: 2020 2020 2020 2020 2020 2020 2020 7461                ta
+0001cad0: 7267 6574 5f6d 6170 2e61 7069 785b 305d  rget_map.apix[0]
+0001cae0: 290a 0a20 2020 2020 2020 2023 2065 6e73  )..        # ens
+0001caf0: 7572 6520 7468 6174 2070 6172 616d 6574  ure that paramet
+0001cb00: 6572 7320 6172 6520 7365 6e73 6962 6c65  ers are sensible
+0001cb10: 2069 2e65 2e20 6e6f 7420 6120 3120 7069   i.e. not a 1 pi
+0001cb20: 7865 6c20 7769 6465 206d 6173 6b0a 2020  xel wide mask.  
+0001cb30: 2020 2020 2020 6966 2073 7068 6572 655f        if sphere_
+0001cb40: 6469 616d 6574 6572 5f70 6978 656c 7320  diameter_pixels 
+0001cb50: 3c20 363a 0a20 2020 2020 2020 2020 2020  < 6:.           
+0001cb60: 2073 7068 6572 655f 6469 616d 6574 6572   sphere_diameter
+0001cb70: 5f70 6978 656c 7320 3d20 360a 2020 2020  _pixels = 6.    
+0001cb80: 2020 2020 636f 735f 6564 6765 203d 2069      cos_edge = i
+0001cb90: 6e74 2872 6f75 6e64 2873 7068 6572 655f  nt(round(sphere_
+0001cba0: 6469 616d 6574 6572 5f70 6978 656c 7320  diameter_pixels 
+0001cbb0: 2f20 3329 290a 2020 2020 2020 2020 6966  / 3)).        if
+0001cbc0: 2063 6f73 5f65 6467 6520 3c20 3130 3a0a   cos_edge < 10:.
+0001cbd0: 2020 2020 2020 2020 2020 2020 636f 735f              cos_
+0001cbe0: 6564 6765 203d 2031 300a 0a20 2020 2020  edge = 10..     
+0001cbf0: 2020 2069 6620 6861 6c66 5f6d 6170 5f31     if half_map_1
+0001cc00: 2069 7320 6e6f 7420 4e6f 6e65 2061 6e64   is not None and
+0001cc10: 2068 616c 665f 6d61 705f 3220 6973 206e   half_map_2 is n
+0001cc20: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
+0001cc30: 2020 2020 2069 6e74 6572 706f 6c61 7465       interpolate
+0001cc40: 5f63 7574 6f66 6620 3d20 4661 6c73 650a  _cutoff = False.
+0001cc50: 2020 2020 2020 2020 2020 2020 6e6f 726d              norm
+0001cc60: 616c 6973 655f 7769 7468 5f68 616c 665f  alise_with_half_
+0001cc70: 6d61 7020 3d20 5472 7565 0a20 2020 2020  map = True.     
+0001cc80: 2020 2020 2020 2068 616c 665f 6d61 705f         half_map_
+0001cc90: 312e 6f72 6967 696e 203d 2074 6172 6765  1.origin = targe
+0001cca0: 745f 6d61 702e 6f72 6967 696e 0a20 2020  t_map.origin.   
+0001ccb0: 2020 2020 2020 2020 2068 616c 665f 6d61           half_ma
+0001ccc0: 705f 322e 6f72 6967 696e 203d 2074 6172  p_2.origin = tar
+0001ccd0: 6765 745f 6d61 702e 6f72 6967 696e 0a20  get_map.origin. 
+0001cce0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001ccf0: 2020 2020 2020 2020 2069 6e74 6572 706f           interpo
+0001cd00: 6c61 7465 5f63 7574 6f66 6620 3d20 5472  late_cutoff = Tr
+0001cd10: 7565 0a20 2020 2020 2020 2020 2020 206e  ue.            n
+0001cd20: 6f72 6d61 6c69 7365 5f77 6974 685f 6861  ormalise_with_ha
+0001cd30: 6c66 5f6d 6170 203d 2046 616c 7365 0a0a  lf_map = False..
+0001cd40: 2020 2020 2020 2020 2320 6765 7420 616e          # get an
+0001cd50: 2061 7070 726f 7072 6961 7465 2062 6f78   appropriate box
+0001cd60: 2073 697a 6520 746f 2063 726f 7020 6672   size to crop fr
+0001cd70: 6f6d 206d 6169 6e20 6d61 700a 2020 2020  om main map.    
+0001cd80: 2020 2020 2320 7769 6c6c 2062 6520 325e      # will be 2^
+0001cd90: 6e2c 2033 5e6e 206f 7220 355e 6e20 7369  n, 3^n or 5^n si
+0001cda0: 7a65 2077 6865 7265 206e 2069 7320 7468  ze where n is th
+0001cdb0: 6520 6e75 6d62 6572 2072 6571 7569 7265  e number require
+0001cdc0: 6420 666f 720a 2020 2020 2020 2020 2320  d for.        # 
+0001cdd0: 7468 6520 6d69 6e69 6d75 6d20 626f 7820  the minimum box 
+0001cde0: 7369 7a65 206e 6565 6465 6420 746f 2065  size needed to e
+0001cdf0: 6e63 6f6d 7061 7373 2065 6e74 6972 6520  ncompass entire 
+0001ce00: 6d61 736b 2069 6e20 626f 780a 2020 2020  mask in box.    
+0001ce10: 2020 2020 6d61 736b 5f64 696d 7320 3d20      mask_dims = 
+0001ce20: 666f 7572 6965 722e 6765 745f 6666 745f  fourier.get_fft_
+0001ce30: 6f70 7469 6d69 7365 645f 626f 785f 7369  optimised_box_si
+0001ce40: 7a65 280a 2020 2020 2020 2020 2020 2020  ze(.            
+0001ce50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce60: 2020 2020 2020 2020 7370 6865 7265 5f64          sphere_d
+0001ce70: 6961 6d65 7465 725f 7069 7865 6c73 202b  iameter_pixels +
+0001ce80: 2028 322a 636f 735f 6564 6765 292c 0a20   (2*cos_edge),. 
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ceb0: 2020 2074 6172 6765 745f 6d61 702e 6675     target_map.fu
+0001cec0: 6c6c 4d61 702e 7368 6170 6529 0a0a 2020  llMap.shape)..  
+0001ced0: 2020 2020 2020 6966 206d 6173 6b5f 6469        if mask_di
+0001cee0: 6d73 203d 3d20 5b30 2c20 302c 2030 5d3a  ms == [0, 0, 0]:
+0001cef0: 0a20 2020 2020 2020 2020 2020 206d 6173  .            mas
+0001cf00: 6b20 3d20 4d61 7028 6e70 2e6f 6e65 7328  k = Map(np.ones(
+0001cf10: 7461 7267 6574 5f6d 6170 2e66 756c 6c4d  target_map.fullM
+0001cf20: 6170 2e73 6861 7065 292c 2074 6172 6765  ap.shape), targe
+0001cf30: 745f 6d61 702e 6f72 6967 696e 2c0a 2020  t_map.origin,.  
+0001cf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf50: 2020 2020 2074 6172 6765 745f 6d61 702e       target_map.
+0001cf60: 6170 6978 2c20 7461 7267 6574 5f6d 6170  apix, target_map
+0001cf70: 2e66 696c 656e 616d 6529 0a20 2020 2020  .filename).     
+0001cf80: 2020 2020 2020 206d 6173 6b5f 6469 6d73         mask_dims
+0001cf90: 203d 206d 6173 6b2e 6675 6c6c 4d61 702e   = mask.fullMap.
+0001cfa0: 7368 6170 650a 2020 2020 2020 2020 656c  shape.        el
+0001cfb0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0001cfc0: 6365 6e74 7265 5f6f 665f 6d61 736b 5f6d  centre_of_mask_m
+0001cfd0: 6170 203d 205b 6d61 736b 5f64 696d 735b  ap = [mask_dims[
+0001cfe0: 305d 2f32 2c20 6d61 736b 5f64 696d 735b  0]/2, mask_dims[
+0001cff0: 315d 2f32 2c0a 2020 2020 2020 2020 2020  1]/2,.          
 0001d000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d010: 2020 2020 2020 2020 2020 2020 2020 7461                ta
-0001d020: 7267 6574 5f6d 6170 2e66 756c 6c4d 6170  rget_map.fullMap
-0001d030: 2e73 6861 7065 290a 0a20 2020 2020 2020  .shape)..       
-0001d040: 2069 6620 6d61 736b 5f64 696d 7320 3d3d   if mask_dims ==
-0001d050: 205b 302c 2030 2c20 305d 3a0a 2020 2020   [0, 0, 0]:.    
-0001d060: 2020 2020 2020 2020 6d61 736b 203d 204d          mask = M
-0001d070: 6170 286e 702e 6f6e 6573 2874 6172 6765  ap(np.ones(targe
-0001d080: 745f 6d61 702e 6675 6c6c 4d61 702e 7368  t_map.fullMap.sh
-0001d090: 6170 6529 2c20 7461 7267 6574 5f6d 6170  ape), target_map
-0001d0a0: 2e6f 7269 6769 6e2c 0a20 2020 2020 2020  .origin,.       
-0001d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d0c0: 7461 7267 6574 5f6d 6170 2e61 7069 782c  target_map.apix,
-0001d0d0: 2074 6172 6765 745f 6d61 702e 6669 6c65   target_map.file
-0001d0e0: 6e61 6d65 290a 2020 2020 2020 2020 2020  name).          
-0001d0f0: 2020 6d61 736b 5f64 696d 7320 3d20 6d61    mask_dims = ma
-0001d100: 736b 2e66 756c 6c4d 6170 2e73 6861 7065  sk.fullMap.shape
-0001d110: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001d120: 2020 2020 2020 2020 2020 2063 656e 7472             centr
-0001d130: 655f 6f66 5f6d 6173 6b5f 6d61 7020 3d20  e_of_mask_map = 
-0001d140: 5b6d 6173 6b5f 6469 6d73 5b30 5d2f 322c  [mask_dims[0]/2,
-0001d150: 206d 6173 6b5f 6469 6d73 5b31 5d2f 322c   mask_dims[1]/2,
-0001d160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d180: 2020 206d 6173 6b5f 6469 6d73 5b32 5d2f     mask_dims[2]/
-0001d190: 325d 0a20 2020 2020 2020 2020 2020 206d  2].            m
-0001d1a0: 6173 6b20 3d20 626c 7572 7265 722e 6d61  ask = blurrer.ma
-0001d1b0: 6b65 5f73 7068 6572 6963 616c 5f6d 6173  ke_spherical_mas
-0001d1c0: 6b28 7370 6865 7265 5f64 6961 6d65 7465  k(sphere_diamete
-0001d1d0: 725f 7069 7865 6c73 2c0a 2020 2020 2020  r_pixels,.      
-0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d200: 2020 2020 2020 2020 206d 6173 6b5f 6469           mask_di
-0001d210: 6d73 2c20 6365 6e74 7265 5f6f 665f 6d61  ms, centre_of_ma
-0001d220: 736b 5f6d 6170 2c0a 2020 2020 2020 2020  sk_map,.        
-0001d230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 2063 6f73 5f65 6467 6529         cos_edge)
-0001d260: 0a0a 2020 2020 2020 2020 2320 7361 7665  ..        # save
-0001d270: 2073 636f 7265 7320 666f 7220 6561 6368   scores for each
-0001d280: 2063 6861 696e 2061 6e64 2072 6573 0a20   chain and res. 
-0001d290: 2020 2020 2020 2064 6963 745f 7265 735f         dict_res_
-0001d2a0: 7363 6f72 6573 203d 204f 7264 6572 6564  scores = Ordered
-0001d2b0: 4469 6374 2829 0a20 2020 2020 2020 2063  Dict().        c
-0001d2c0: 6861 696e 7320 3d20 7374 7275 6374 7572  hains = structur
-0001d2d0: 652e 7370 6c69 745f 696e 746f 5f63 6861  e.split_into_cha
-0001d2e0: 696e 7328 290a 2020 2020 2020 2020 6e75  ins().        nu
-0001d2f0: 6d62 6572 5f6f 665f 7265 7369 6475 6573  mber_of_residues
-0001d300: 203d 2073 7472 7563 7475 7265 2e6e 756d   = structure.num
-0001d310: 6265 725f 6f66 5f72 6573 6964 7565 7328  ber_of_residues(
-0001d320: 290a 0a20 2020 2020 2020 2023 2073 6574  )..        # set
-0001d330: 2075 7020 7079 6666 7477 2066 6f72 2076   up pyfftw for v
-0001d340: 6572 7920 6661 7374 2066 6674 730a 2020  ery fast ffts.  
-0001d350: 2020 2020 2020 696e 7075 7431 203d 2070        input1 = p
-0001d360: 7966 6674 772e 656d 7074 795f 616c 6967  yfftw.empty_alig
-0001d370: 6e65 6428 6d61 736b 5f64 696d 732c 2064  ned(mask_dims, d
-0001d380: 7479 7065 3d27 666c 6f61 7436 3427 290a  type='float64').
-0001d390: 2020 2020 2020 2020 6666 7477 5f6f 626a          fftw_obj
-0001d3a0: 6563 7431 203d 2066 6f75 7269 6572 2e67  ect1 = fourier.g
-0001d3b0: 6574 5f70 7966 6674 775f 6f62 6a65 6374  et_pyfftw_object
-0001d3c0: 286d 6173 6b5f 6469 6d73 290a 2020 2020  (mask_dims).    
-0001d3d0: 2020 2020 6666 7477 5f6f 626a 6563 7432      fftw_object2
-0001d3e0: 203d 2066 6f75 7269 6572 2e67 6574 5f70   = fourier.get_p
-0001d3f0: 7966 6674 775f 6f62 6a65 6374 286d 6173  yfftw_object(mas
-0001d400: 6b5f 6469 6d73 290a 0a20 2020 2020 2020  k_dims)..       
-0001d410: 2023 2070 7265 636f 6d70 7574 6520 7468   # precompute th
-0001d420: 6573 6520 746f 2073 7065 6564 2075 7020  ese to speed up 
-0001d430: 6361 6c63 756c 6174 696f 6e73 0a20 2020  calculations.   
-0001d440: 2020 2020 2071 6269 6e73 2c20 6c61 6265       qbins, labe
-0001d450: 6c6c 6564 5f73 6865 6c6c 7320 3d20 666f  lled_shells = fo
-0001d460: 7572 6965 722e 6765 745f 6c61 6265 6c6c  urier.get_labell
-0001d470: 6564 5f73 6865 6c6c 7328 0a20 2020 2020  ed_shells(.     
-0001d480: 2020 2020 2020 2069 6e70 7574 312e 7368         input1.sh
-0001d490: 6170 6529 0a0a 2020 2020 2020 2020 7761  ape)..        wa
-0001d4a0: 726e 696e 6773 203d 205b 5d0a 2020 2020  rnings = [].    
-0001d4b0: 2020 2020 7265 735f 6e6f 203d 2030 0a0a      res_no = 0..
-0001d4c0: 2020 2020 2020 2020 666f 7220 6368 6169          for chai
-0001d4d0: 6e20 696e 2063 6861 696e 733a 0a20 2020  n in chains:.   
-0001d4e0: 2020 2020 2020 2020 2066 6f72 2061 746f           for ato
-0001d4f0: 6d20 696e 2063 6861 696e 2e61 746f 6d4c  m in chain.atomL
-0001d500: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-0001d510: 2020 2020 2069 6620 6174 6f6d 2e61 746f       if atom.ato
-0001d520: 6d5f 6e61 6d65 203d 3d20 2743 4127 206f  m_name == 'CA' o
-0001d530: 7220 6174 6f6d 2e61 746f 6d5f 6e61 6d65  r atom.atom_name
-0001d540: 203d 3d20 2243 3127 223a 0a20 2020 2020   == "C1'":.     
-0001d550: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001d560: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
-0001d570: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0001d580: 2020 2020 2020 2020 2020 2020 2020 636f                co
-0001d590: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
-0001d5a0: 2020 2020 2020 2020 6372 6f70 7065 645f          cropped_
-0001d5b0: 6d61 705f 3120 3d20 7461 7267 6574 5f6d  map_1 = target_m
-0001d5c0: 6170 2e67 6574 5f63 726f 7070 6564 5f62  ap.get_cropped_b
-0001d5d0: 6f78 5f61 726f 756e 645f 6174 6f6d 280a  ox_around_atom(.
+0001d010: 2020 2020 2020 2020 6d61 736b 5f64 696d          mask_dim
+0001d020: 735b 325d 2f32 5d0a 2020 2020 2020 2020  s[2]/2].        
+0001d030: 2020 2020 6d61 736b 203d 2062 6c75 7272      mask = blurr
+0001d040: 6572 2e6d 616b 655f 7370 6865 7269 6361  er.make_spherica
+0001d050: 6c5f 6d61 736b 2873 7068 6572 655f 6469  l_mask(sphere_di
+0001d060: 616d 6574 6572 5f70 6978 656c 732c 0a20  ameter_pixels,. 
+0001d070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d080: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d090: 2020 2020 2020 2020 2020 2020 2020 6d61                ma
+0001d0a0: 736b 5f64 696d 732c 2063 656e 7472 655f  sk_dims, centre_
+0001d0b0: 6f66 5f6d 6173 6b5f 6d61 702c 0a20 2020  of_mask_map,.   
+0001d0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0e0: 2020 2020 2020 2020 2020 2020 636f 735f              cos_
+0001d0f0: 6564 6765 290a 0a20 2020 2020 2020 2023  edge)..        #
+0001d100: 2073 6176 6520 7363 6f72 6573 2066 6f72   save scores for
+0001d110: 2065 6163 6820 6368 6169 6e20 616e 6420   each chain and 
+0001d120: 7265 730a 2020 2020 2020 2020 6469 6374  res.        dict
+0001d130: 5f72 6573 5f73 636f 7265 7320 3d20 4f72  _res_scores = Or
+0001d140: 6465 7265 6444 6963 7428 290a 2020 2020  deredDict().    
+0001d150: 2020 2020 6368 6169 6e73 203d 2073 7472      chains = str
+0001d160: 7563 7475 7265 2e73 706c 6974 5f69 6e74  ucture.split_int
+0001d170: 6f5f 6368 6169 6e73 2829 0a20 2020 2020  o_chains().     
+0001d180: 2020 206e 756d 6265 725f 6f66 5f72 6573     number_of_res
+0001d190: 6964 7565 7320 3d20 7374 7275 6374 7572  idues = structur
+0001d1a0: 652e 6e75 6d62 6572 5f6f 665f 7265 7369  e.number_of_resi
+0001d1b0: 6475 6573 2829 0a0a 2020 2020 2020 2020  dues()..        
+0001d1c0: 2320 7365 7420 7570 2070 7966 6674 7720  # set up pyfftw 
+0001d1d0: 666f 7220 7665 7279 2066 6173 7420 6666  for very fast ff
+0001d1e0: 7473 0a20 2020 2020 2020 2069 6e70 7574  ts.        input
+0001d1f0: 3120 3d20 7079 6666 7477 2e65 6d70 7479  1 = pyfftw.empty
+0001d200: 5f61 6c69 676e 6564 286d 6173 6b5f 6469  _aligned(mask_di
+0001d210: 6d73 2c20 6474 7970 653d 2766 6c6f 6174  ms, dtype='float
+0001d220: 3634 2729 0a20 2020 2020 2020 2066 6674  64').        fft
+0001d230: 775f 6f62 6a65 6374 3120 3d20 666f 7572  w_object1 = four
+0001d240: 6965 722e 6765 745f 7079 6666 7477 5f6f  ier.get_pyfftw_o
+0001d250: 626a 6563 7428 6d61 736b 5f64 696d 7329  bject(mask_dims)
+0001d260: 0a20 2020 2020 2020 2066 6674 775f 6f62  .        fftw_ob
+0001d270: 6a65 6374 3220 3d20 666f 7572 6965 722e  ject2 = fourier.
+0001d280: 6765 745f 7079 6666 7477 5f6f 626a 6563  get_pyfftw_objec
+0001d290: 7428 6d61 736b 5f64 696d 7329 0a0a 2020  t(mask_dims)..  
+0001d2a0: 2020 2020 2020 2320 7072 6563 6f6d 7075        # precompu
+0001d2b0: 7465 2074 6865 7365 2074 6f20 7370 6565  te these to spee
+0001d2c0: 6420 7570 2063 616c 6375 6c61 7469 6f6e  d up calculation
+0001d2d0: 730a 2020 2020 2020 2020 7162 696e 732c  s.        qbins,
+0001d2e0: 206c 6162 656c 6c65 645f 7368 656c 6c73   labelled_shells
+0001d2f0: 203d 2066 6f75 7269 6572 2e67 6574 5f6c   = fourier.get_l
+0001d300: 6162 656c 6c65 645f 7368 656c 6c73 280a  abelled_shells(.
+0001d310: 2020 2020 2020 2020 2020 2020 696e 7075              inpu
+0001d320: 7431 2e73 6861 7065 290a 0a20 2020 2020  t1.shape)..     
+0001d330: 2020 2077 6172 6e69 6e67 7320 3d20 5b5d     warnings = []
+0001d340: 0a20 2020 2020 2020 2072 6573 5f6e 6f20  .        res_no 
+0001d350: 3d20 300a 0a20 2020 2020 2020 2066 6f72  = 0..        for
+0001d360: 2063 6861 696e 2069 6e20 6368 6169 6e73   chain in chains
+0001d370: 3a0a 2020 2020 2020 2020 2020 2020 666f  :.            fo
+0001d380: 7220 6174 6f6d 2069 6e20 6368 6169 6e2e  r atom in chain.
+0001d390: 6174 6f6d 4c69 7374 3a0a 2020 2020 2020  atomList:.      
+0001d3a0: 2020 2020 2020 2020 2020 6966 2061 746f            if ato
+0001d3b0: 6d2e 6174 6f6d 5f6e 616d 6520 3d3d 2027  m.atom_name == '
+0001d3c0: 4341 2720 6f72 2061 746f 6d2e 6174 6f6d  CA' or atom.atom
+0001d3d0: 5f6e 616d 6520 3d3d 2022 4331 2722 3a0a  _name == "C1'":.
+0001d3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d3f0: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0001d400: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+0001d410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d420: 2020 2063 6f6e 7469 6e75 650a 0a20 2020     continue..   
+0001d430: 2020 2020 2020 2020 2020 2020 2063 726f               cro
+0001d440: 7070 6564 5f6d 6170 5f31 203d 2074 6172  pped_map_1 = tar
+0001d450: 6765 745f 6d61 702e 6765 745f 6372 6f70  get_map.get_crop
+0001d460: 7065 645f 626f 785f 6172 6f75 6e64 5f61  ped_box_around_a
+0001d470: 746f 6d28 0a20 2020 2020 2020 2020 2020  tom(.           
+0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4b0: 2020 2020 2061 746f 6d2c 0a20 2020 2020       atom,.     
+0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d4f0: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+0001d500: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
+0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d540: 2020 2020 2020 292e 6675 6c6c 4d61 700a        ).fullMap.
+0001d550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d560: 6372 6f70 7065 645f 6d61 705f 3220 3d20  cropped_map_2 = 
+0001d570: 7369 6d5f 6d61 702e 6765 745f 6372 6f70  sim_map.get_crop
+0001d580: 7065 645f 626f 785f 6172 6f75 6e64 5f61  ped_box_around_a
+0001d590: 746f 6d28 0a20 2020 2020 2020 2020 2020  tom(.           
+0001d5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d5d0: 2020 2020 2061 746f 6d2c 0a20 2020 2020       atom,.     
 0001d5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d600: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d610: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d620: 6174 6f6d 2c0a 2020 2020 2020 2020 2020  atom,.          
+0001d610: 2020 2020 2020 2020 2020 206d 6173 6b5f             mask_
+0001d620: 6469 6d73 2c0a 2020 2020 2020 2020 2020  dims,.          
 0001d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d660: 2020 2020 2020 6d61 736b 5f64 696d 732c        mask_dims,
-0001d670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6b0: 2029 2e66 756c 6c4d 6170 0a20 2020 2020   ).fullMap.     
-0001d6c0: 2020 2020 2020 2020 2020 2063 726f 7070             cropp
-0001d6d0: 6564 5f6d 6170 5f32 203d 2073 696d 5f6d  ed_map_2 = sim_m
-0001d6e0: 6170 2e67 6574 5f63 726f 7070 6564 5f62  ap.get_cropped_b
-0001d6f0: 6f78 5f61 726f 756e 645f 6174 6f6d 280a  ox_around_atom(.
-0001d700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d660: 2020 2020 2020 292e 6675 6c6c 4d61 700a        ).fullMap.
+0001d670: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d680: 6673 6320 3d20 666f 7572 6965 722e 6361  fsc = fourier.ca
+0001d690: 6c63 756c 6174 655f 6673 635f 7769 7468  lculate_fsc_with
+0001d6a0: 5f6d 6173 6b28 0a20 2020 2020 2020 2020  _mask(.         
+0001d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6c0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
+0001d6d0: 726f 7070 6564 5f6d 6170 5f31 2c0a 2020  ropped_map_1,.  
+0001d6e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d700: 2020 2020 2020 6372 6f70 7065 645f 6d61        cropped_ma
+0001d710: 705f 322c 0a20 2020 2020 2020 2020 2020  p_2,.           
 0001d720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d740: 6174 6f6d 2c0a 2020 2020 2020 2020 2020  atom,.          
+0001d730: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+0001d740: 6b2e 6675 6c6c 4d61 702c 0a20 2020 2020  k.fullMap,.     
 0001d750: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d780: 2020 2020 2020 6d61 736b 5f64 696d 732c        mask_dims,
-0001d790: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d770: 2020 2070 6978 656c 5f73 697a 653d 7461     pixel_size=ta
+0001d780: 7267 6574 5f6d 6170 2e61 7069 785b 305d  rget_map.apix[0]
+0001d790: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0001d7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d7d0: 2029 2e66 756c 6c4d 6170 0a20 2020 2020   ).fullMap.     
-0001d7e0: 2020 2020 2020 2020 2020 2066 7363 203d             fsc =
-0001d7f0: 2066 6f75 7269 6572 2e63 616c 6375 6c61   fourier.calcula
-0001d800: 7465 5f66 7363 5f77 6974 685f 6d61 736b  te_fsc_with_mask
-0001d810: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001d7b0: 2020 2020 2020 2020 2020 6c61 6265 6c6c            labell
+0001d7c0: 6564 5f73 6865 6c6c 733d 6c61 6265 6c6c  ed_shells=labell
+0001d7d0: 6564 5f73 6865 6c6c 732c 0a20 2020 2020  ed_shells,.     
+0001d7e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2071 6269 6e73 3d71 6269 6e73 2c0a     qbins=qbins,.
+0001d810: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d830: 2020 2020 2020 2020 2020 6372 6f70 7065            croppe
-0001d840: 645f 6d61 705f 312c 0a20 2020 2020 2020  d_map_1,.       
-0001d850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d830: 2020 2020 2020 2020 6666 7477 5f6f 626a          fftw_obj
+0001d840: 6563 7431 3d66 6674 775f 6f62 6a65 6374  ect1=fftw_object
+0001d850: 312c 0a20 2020 2020 2020 2020 2020 2020  1,.             
 0001d860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d870: 2063 726f 7070 6564 5f6d 6170 5f32 2c0a   cropped_map_2,.
-0001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8a0: 2020 2020 2020 2020 6d61 736b 2e66 756c          mask.ful
-0001d8b0: 6c4d 6170 2c0a 2020 2020 2020 2020 2020  lMap,.          
-0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d8d0: 2020 2020 2020 2020 2020 2020 2020 7069                pi
-0001d8e0: 7865 6c5f 7369 7a65 3d74 6172 6765 745f  xel_size=target_
-0001d8f0: 6d61 702e 6170 6978 5b30 5d2c 0a20 2020  map.apix[0],.   
-0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d920: 2020 2020 206c 6162 656c 6c65 645f 7368       labelled_sh
-0001d930: 656c 6c73 3d6c 6162 656c 6c65 645f 7368  ells=labelled_sh
-0001d940: 656c 6c73 2c0a 2020 2020 2020 2020 2020  ells,.          
+0001d870: 2020 2020 2020 2020 2020 2066 6674 775f             fftw_
+0001d880: 6f62 6a65 6374 323d 6666 7477 5f6f 626a  object2=fftw_obj
+0001d890: 6563 7432 2c0a 2020 2020 2020 2020 2020  ect2,.          
+0001d8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8b0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001d8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d8d0: 2023 2066 696e 6420 6869 6768 6573 7420   # find highest 
+0001d8e0: 6672 6571 7565 6e63 7920 7368 656c 6c20  frequency shell 
+0001d8f0: 7769 7468 2030 2e35 2063 6f72 7265 6c61  with 0.5 correla
+0001d900: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
+0001d910: 2020 2020 2066 7265 715f 6174 5f63 6f72       freq_at_cor
+0001d920: 725f 6375 746f 6666 203d 2066 6f75 7269  r_cutoff = fouri
+0001d930: 6572 2e67 6574 5f66 7363 5f72 6573 6f6c  er.get_fsc_resol
+0001d940: 7574 696f 6e28 0a20 2020 2020 2020 2020  ution(.         
 0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d960: 2020 2020 2020 2020 2020 2020 2020 7162                qb
-0001d970: 696e 733d 7162 696e 732c 0a20 2020 2020  ins=qbins,.     
+0001d960: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001d970: 7363 2c0a 2020 2020 2020 2020 2020 2020  sc,.            
 0001d980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9a0: 2020 2066 6674 775f 6f62 6a65 6374 313d     fftw_object1=
-0001d9b0: 6666 7477 5f6f 626a 6563 7431 2c0a 2020  fftw_object1,.  
+0001d990: 2020 2020 2020 2020 2020 2020 6673 635f              fsc_
+0001d9a0: 7468 7265 7368 6f6c 643d 6673 635f 7468  threshold=fsc_th
+0001d9b0: 7265 7368 6f6c 642c 0a20 2020 2020 2020  reshold,.       
 0001d9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d9e0: 2020 2020 2020 6666 7477 5f6f 626a 6563        fftw_objec
-0001d9f0: 7432 3d66 6674 775f 6f62 6a65 6374 322c  t2=fftw_object2,
-0001da00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d9e0: 2069 6e74 6572 706f 6c61 7465 5f63 7574   interpolate_cut
+0001d9f0: 6f66 663d 696e 7465 7270 6f6c 6174 655f  off=interpolate_
+0001da00: 6375 746f 6666 2c0a 2020 2020 2020 2020  cutoff,.        
 0001da10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da20: 2020 2020 2020 2020 2029 0a0a 2020 2020           )..    
-0001da30: 2020 2020 2020 2020 2020 2020 2320 6669              # fi
-0001da40: 6e64 2068 6967 6865 7374 2066 7265 7175  nd highest frequ
-0001da50: 656e 6379 2073 6865 6c6c 2077 6974 6820  ency shell with 
-0001da60: 302e 3520 636f 7272 656c 6174 696f 6e0a  0.5 correlation.
-0001da70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001da80: 6672 6571 5f61 745f 636f 7272 5f63 7574  freq_at_corr_cut
-0001da90: 6f66 6620 3d20 666f 7572 6965 722e 6765  off = fourier.ge
-0001daa0: 745f 6673 635f 7265 736f 6c75 7469 6f6e  t_fsc_resolution
-0001dab0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001dac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dad0: 2020 2020 2020 2020 2020 6673 632c 0a20            fsc,. 
-0001dae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001daf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db00: 2020 2020 2020 2066 7363 5f74 6872 6573         fsc_thres
-0001db10: 686f 6c64 3d66 7363 5f74 6872 6573 686f  hold=fsc_thresho
-0001db20: 6c64 2c0a 2020 2020 2020 2020 2020 2020  ld,.            
-0001db30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db40: 2020 2020 2020 2020 2020 2020 696e 7465              inte
-0001db50: 7270 6f6c 6174 655f 6375 746f 6666 3d69  rpolate_cutoff=i
-0001db60: 6e74 6572 706f 6c61 7465 5f63 7574 6f66  nterpolate_cutof
-0001db70: 662c 0a20 2020 2020 2020 2020 2020 2020  f,.             
-0001db80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001db90: 2020 2020 2020 2020 2020 2075 7365 5f68             use_h
-0001dba0: 6967 6865 7374 5f72 6573 6f6c 7574 696f  ighest_resolutio
-0001dbb0: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
-0001dbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dbe0: 290a 0a20 2020 2020 2020 2020 2020 2020  )..             
-0001dbf0: 2020 2023 2066 7265 715f 6174 5f63 7574     # freq_at_cut
-0001dc00: 6f66 6620 6361 6e20 3d20 3020 6966 2063  off can = 0 if c
-0001dc10: 6f72 7265 6c61 7469 6f6e 206e 6576 6572  orrelation never
-0001dc20: 2064 726f 7073 2062 656c 6f77 2030 2e35   drops below 0.5
-0001dc30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001dc40: 2069 6620 6672 6571 5f61 745f 636f 7272   if freq_at_corr
-0001dc50: 5f63 7574 6f66 6620 3c20 6d69 6e28 7461  _cutoff < min(ta
-0001dc60: 7267 6574 5f6d 6170 2e61 7069 7829 202a  rget_map.apix) *
-0001dc70: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
-0001dc80: 2020 2020 2020 2020 6672 6571 5f61 745f          freq_at_
-0001dc90: 636f 7272 5f63 7574 6f66 6620 3d20 6d69  corr_cutoff = mi
-0001dca0: 6e28 7461 7267 6574 5f6d 6170 2e61 7069  n(target_map.api
-0001dcb0: 7829 202a 2032 0a20 2020 2020 2020 2020  x) * 2.         
-0001dcc0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0001dcd0: 6e67 732e 6170 7065 6e64 2866 2257 6172  ngs.append(f"War
-0001dce0: 6e69 6e67 3a20 4653 4320 6174 2072 6573  ning: FSC at res
-0001dcf0: 6964 7565 207b 6174 6f6d 2e72 6573 5f6e  idue {atom.res_n
-0001dd00: 6f7d 2069 6e22 0a20 2020 2020 2020 2020  o} in".         
-0001dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd20: 2020 2020 2020 2020 2020 2066 2220 6368             f" ch
-0001dd30: 6169 6e20 7b61 746f 6d2e 6368 6169 6e7d  ain {atom.chain}
-0001dd40: 206e 6576 6572 2066 616c 6c73 2062 656c   never falls bel
-0001dd50: 6f77 2022 0a20 2020 2020 2020 2020 2020  ow ".           
-0001dd60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd70: 2020 2020 2020 2020 2066 2230 2e35 2e20           f"0.5. 
-0001dd80: 4c6f 5146 6974 2073 636f 7265 2066 6f72  LoQFit score for
-0001dd90: 2074 6869 7320 7265 7369 6475 6520 7365   this residue se
-0001dda0: 7420 220a 2020 2020 2020 2020 2020 2020  t ".            
-0001ddb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ddc0: 2020 2020 2020 2020 6622 746f 207b 6672          f"to {fr
-0001ddd0: 6571 5f61 745f 636f 7272 5f63 7574 6f66  eq_at_corr_cutof
-0001dde0: 667d 2e20 5468 6973 2069 7320 4e4f 5420  f}. This is NOT 
-0001ddf0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001de00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de10: 2020 2020 2020 6622 6578 7065 6374 6564        f"expected
-0001de20: 2061 6e64 204e 4f54 2061 6e20 696e 6469   and NOT an indi
-0001de30: 6361 7469 6f6e 206f 6620 6120 220a 2020  cation of a ".  
-0001de40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001de60: 2020 6622 676f 6f64 2066 6974 2062 6574    f"good fit bet
-0001de70: 7765 656e 206d 6170 2061 6e64 206d 6f64  ween map and mod
-0001de80: 656c 2e22 290a 0a20 2020 2020 2020 2020  el.")..         
-0001de90: 2020 2020 2020 2023 2049 6620 7468 6572         # If ther
-0001dea0: 6520 6973 2070 6f6f 7220 636f 7272 656c  e is poor correl
-0001deb0: 6174 696f 6e20 696e 206c 6f77 2072 6573  ation in low res
-0001dec0: 6f6c 7574 696f 6e20 7368 656c 6c73 2074  olution shells t
-0001ded0: 6865 0a20 2020 2020 2020 2020 2020 2020  he.             
-0001dee0: 2020 2023 2066 7265 715f 6174 5f63 7574     # freq_at_cut
-0001def0: 6f66 6620 6361 6e20 6265 2072 6964 6963  off can be ridic
-0001df00: 756c 6f75 736c 7920 6869 6768 2028 692e  ulously high (i.
-0001df10: 652e 203e 3130 3020 616e 6773 7472 6f6d  e. >100 angstrom
-0001df20: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
-0001df30: 2020 2023 2077 6869 6368 2072 7569 6e73     # which ruins
-0001df40: 2074 6865 2073 6361 6c69 6e67 2077 6865   the scaling whe
-0001df50: 6e20 7468 6520 7363 6f72 6520 6973 2070  n the score is p
-0001df60: 6c6f 7474 6564 0a20 2020 2020 2020 2020  lotted.         
-0001df70: 2020 2020 2020 2069 6620 6672 6571 5f61         if freq_a
-0001df80: 745f 636f 7272 5f63 7574 6f66 6620 3e20  t_corr_cutoff > 
-0001df90: 6d61 785f 7265 733a 0a20 2020 2020 2020  max_res:.       
-0001dfa0: 2020 2020 2020 2020 2020 2020 2077 6172               war
-0001dfb0: 6e69 6e67 732e 6170 7065 6e64 2866 2257  nings.append(f"W
-0001dfc0: 6172 6e69 6e67 3a20 5265 7369 6475 6520  arning: Residue 
-0001dfd0: 7b61 746f 6d2e 7265 735f 6e6f 7d20 696e  {atom.res_no} in
-0001dfe0: 2063 6861 696e 2022 0a20 2020 2020 2020   chain ".       
-0001dff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e000: 2020 2020 2020 2020 2020 2020 2066 227b               f"{
-0001e010: 6174 6f6d 2e63 6861 696e 7d20 6861 7320  atom.chain} has 
-0001e020: 6c6f 6361 6c20 7265 736f 6c75 7469 6f6e  local resolution
-0001e030: 206f 6620 220a 2020 2020 2020 2020 2020   of ".          
+0001da20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da30: 7573 655f 6869 6768 6573 745f 7265 736f  use_highest_reso
+0001da40: 6c75 7469 6f6e 3d54 7275 652c 0a20 2020  lution=True,.   
+0001da50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da70: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
+0001da80: 2020 2020 2020 2020 2320 6672 6571 5f61          # freq_a
+0001da90: 745f 6375 746f 6666 2063 616e 203d 2030  t_cutoff can = 0
+0001daa0: 2069 6620 636f 7272 656c 6174 696f 6e20   if correlation 
+0001dab0: 6e65 7665 7220 6472 6f70 7320 6265 6c6f  never drops belo
+0001dac0: 7720 302e 350a 2020 2020 2020 2020 2020  w 0.5.          
+0001dad0: 2020 2020 2020 6966 2066 7265 715f 6174        if freq_at
+0001dae0: 5f63 6f72 725f 6375 746f 6666 203c 206d  _corr_cutoff < m
+0001daf0: 696e 2874 6172 6765 745f 6d61 702e 6170  in(target_map.ap
+0001db00: 6978 2920 2a20 323a 0a20 2020 2020 2020  ix) * 2:.       
+0001db10: 2020 2020 2020 2020 2020 2020 2066 7265               fre
+0001db20: 715f 6174 5f63 6f72 725f 6375 746f 6666  q_at_corr_cutoff
+0001db30: 203d 206d 696e 2874 6172 6765 745f 6d61   = min(target_ma
+0001db40: 702e 6170 6978 2920 2a20 320a 2020 2020  p.apix) * 2.    
+0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db60: 7761 726e 696e 6773 2e61 7070 656e 6428  warnings.append(
+0001db70: 6622 5761 726e 696e 673a 2046 5343 2061  f"Warning: FSC a
+0001db80: 7420 7265 7369 6475 6520 7b61 746f 6d2e  t residue {atom.
+0001db90: 7265 735f 6e6f 7d20 696e 220a 2020 2020  res_no} in".    
+0001dba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dbc0: 6622 2063 6861 696e 207b 6174 6f6d 2e63  f" chain {atom.c
+0001dbd0: 6861 696e 7d20 6e65 7665 7220 6661 6c6c  hain} never fall
+0001dbe0: 7320 6265 6c6f 7720 220a 2020 2020 2020  s below ".      
+0001dbf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc00: 2020 2020 2020 2020 2020 2020 2020 6622                f"
+0001dc10: 302e 352e 204c 6f51 4669 7420 7363 6f72  0.5. LoQFit scor
+0001dc20: 6520 666f 7220 7468 6973 2072 6573 6964  e for this resid
+0001dc30: 7565 2073 6574 2022 0a20 2020 2020 2020  ue set ".       
+0001dc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dc50: 2020 2020 2020 2020 2020 2020 2066 2274               f"t
+0001dc60: 6f20 7b66 7265 715f 6174 5f63 6f72 725f  o {freq_at_corr_
+0001dc70: 6375 746f 6666 7d2e 2054 6869 7320 6973  cutoff}. This is
+0001dc80: 204e 4f54 2022 0a20 2020 2020 2020 2020   NOT ".         
+0001dc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dca0: 2020 2020 2020 2020 2020 2066 2265 7870             f"exp
+0001dcb0: 6563 7465 6420 616e 6420 4e4f 5420 616e  ected and NOT an
+0001dcc0: 2069 6e64 6963 6174 696f 6e20 6f66 2061   indication of a
+0001dcd0: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001dce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dcf0: 2020 2020 2020 2066 2267 6f6f 6420 6669         f"good fi
+0001dd00: 7420 6265 7477 6565 6e20 6d61 7020 616e  t between map an
+0001dd10: 6420 6d6f 6465 6c2e 2229 0a0a 2020 2020  d model.")..    
+0001dd20: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+0001dd30: 2074 6865 7265 2069 7320 706f 6f72 2063   there is poor c
+0001dd40: 6f72 7265 6c61 7469 6f6e 2069 6e20 6c6f  orrelation in lo
+0001dd50: 7720 7265 736f 6c75 7469 6f6e 2073 6865  w resolution she
+0001dd60: 6c6c 7320 7468 650a 2020 2020 2020 2020  lls the.        
+0001dd70: 2020 2020 2020 2020 2320 6672 6571 5f61          # freq_a
+0001dd80: 745f 6375 746f 6666 2063 616e 2062 6520  t_cutoff can be 
+0001dd90: 7269 6469 6375 6c6f 7573 6c79 2068 6967  ridiculously hig
+0001dda0: 6820 2869 2e65 2e20 3e31 3030 2061 6e67  h (i.e. >100 ang
+0001ddb0: 7374 726f 6d73 290a 2020 2020 2020 2020  stroms).        
+0001ddc0: 2020 2020 2020 2020 2320 7768 6963 6820          # which 
+0001ddd0: 7275 696e 7320 7468 6520 7363 616c 696e  ruins the scalin
+0001dde0: 6720 7768 656e 2074 6865 2073 636f 7265  g when the score
+0001ddf0: 2069 7320 706c 6f74 7465 640a 2020 2020   is plotted.    
+0001de00: 2020 2020 2020 2020 2020 2020 6966 2066              if f
+0001de10: 7265 715f 6174 5f63 6f72 725f 6375 746f  req_at_corr_cuto
+0001de20: 6666 203e 206d 6178 5f72 6573 3a0a 2020  ff > max_res:.  
+0001de30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de40: 2020 7761 726e 696e 6773 2e61 7070 656e    warnings.appen
+0001de50: 6428 6622 5761 726e 696e 673a 2052 6573  d(f"Warning: Res
+0001de60: 6964 7565 207b 6174 6f6d 2e72 6573 5f6e  idue {atom.res_n
+0001de70: 6f7d 2069 6e20 6368 6169 6e20 220a 2020  o} in chain ".  
+0001de80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001de90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dea0: 2020 6622 7b61 746f 6d2e 6368 6169 6e7d    f"{atom.chain}
+0001deb0: 2068 6173 206c 6f63 616c 2072 6573 6f6c   has local resol
+0001dec0: 7574 696f 6e20 6f66 2022 0a20 2020 2020  ution of ".     
+0001ded0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dee0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001def0: 2220 7b66 7265 715f 6174 5f63 6f72 725f  " {freq_at_corr_
+0001df00: 6375 746f 6666 7d2c 2077 6869 6368 2069  cutoff}, which i
+0001df10: 7320 7365 7420 220a 2020 2020 2020 2020  s set ".        
+0001df20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df30: 2020 2020 2020 2020 2020 2020 6622 746f              f"to
+0001df40: 207b 6d61 785f 7265 737d 2229 0a20 2020   {max_res}").   
+0001df50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df60: 2066 7265 715f 6174 5f63 6f72 725f 6375   freq_at_corr_cu
+0001df70: 746f 6666 203d 206d 6178 5f72 6573 0a0a  toff = max_res..
+0001df80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001df90: 6966 206e 6f72 6d61 6c69 7365 5f77 6974  if normalise_wit
+0001dfa0: 685f 6861 6c66 5f6d 6170 3a0a 2020 2020  h_half_map:.    
+0001dfb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dfc0: 6372 6f70 5f68 6d61 705f 3120 3d20 6861  crop_hmap_1 = ha
+0001dfd0: 6c66 5f6d 6170 5f31 2e67 6574 5f63 726f  lf_map_1.get_cro
+0001dfe0: 7070 6564 5f62 6f78 5f61 726f 756e 645f  pped_box_around_
+0001dff0: 6174 6f6d 280a 2020 2020 2020 2020 2020  atom(.          
+0001e000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e030: 2020 2020 2020 2020 2020 6174 6f6d 2c0a            atom,.
 0001e040: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e050: 2020 2020 2020 2020 2020 6622 207b 6672            f" {fr
-0001e060: 6571 5f61 745f 636f 7272 5f63 7574 6f66  eq_at_corr_cutof
-0001e070: 667d 2c20 7768 6963 6820 6973 2073 6574  f}, which is set
-0001e080: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+0001e050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e080: 2020 2020 6d61 736b 5f64 696d 732c 0a20      mask_dims,. 
 0001e090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e0a0: 2020 2020 2020 2066 2274 6f20 7b6d 6178         f"to {max
-0001e0b0: 5f72 6573 7d22 290a 2020 2020 2020 2020  _res}").        
-0001e0c0: 2020 2020 2020 2020 2020 2020 6672 6571              freq
-0001e0d0: 5f61 745f 636f 7272 5f63 7574 6f66 6620  _at_corr_cutoff 
-0001e0e0: 3d20 6d61 785f 7265 730a 0a20 2020 2020  = max_res..     
-0001e0f0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0001e100: 726d 616c 6973 655f 7769 7468 5f68 616c  rmalise_with_hal
-0001e110: 665f 6d61 703a 0a20 2020 2020 2020 2020  f_map:.         
-0001e120: 2020 2020 2020 2020 2020 2063 726f 705f             crop_
-0001e130: 686d 6170 5f31 203d 2068 616c 665f 6d61  hmap_1 = half_ma
-0001e140: 705f 312e 6765 745f 6372 6f70 7065 645f  p_1.get_cropped_
-0001e150: 626f 785f 6172 6f75 6e64 5f61 746f 6d28  box_around_atom(
-0001e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e0d0: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+0001e0e0: 2020 2020 2020 2020 2063 726f 705f 686d           crop_hm
+0001e0f0: 6170 5f32 203d 2068 616c 665f 6d61 705f  ap_2 = half_map_
+0001e100: 322e 6765 745f 6372 6f70 7065 645f 626f  2.get_cropped_bo
+0001e110: 785f 6172 6f75 6e64 5f61 746f 6d28 0a20  x_around_atom(. 
+0001e120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e150: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e160: 2020 2061 746f 6d2c 0a20 2020 2020 2020     atom,.       
 0001e170: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e180: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1a0: 2020 2020 2061 746f 6d2c 0a20 2020 2020       atom,.     
-0001e1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1a0: 2020 2020 2020 2020 2020 2020 206d 6173               mas
+0001e1b0: 6b5f 6469 6d73 2c0a 2020 2020 2020 2020  k_dims,.        
 0001e1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e1d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e1e0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001e1f0: 6173 6b5f 6469 6d73 2c0a 2020 2020 2020  ask_dims,.      
+0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1f0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
 0001e200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e220: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e230: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0001e210: 2020 6673 6320 3d20 666f 7572 6965 722e    fsc = fourier.
+0001e220: 6361 6c63 756c 6174 655f 6673 635f 7769  calculate_fsc_wi
+0001e230: 7468 5f6d 6173 6b28 0a20 2020 2020 2020  th_mask(.       
 0001e240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e250: 2020 2020 6372 6f70 5f68 6d61 705f 3220      crop_hmap_2 
-0001e260: 3d20 6861 6c66 5f6d 6170 5f32 2e67 6574  = half_map_2.get
-0001e270: 5f63 726f 7070 6564 5f62 6f78 5f61 726f  _cropped_box_aro
-0001e280: 756e 645f 6174 6f6d 280a 2020 2020 2020  und_atom(.      
+0001e250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e260: 2020 2020 2063 726f 705f 686d 6170 5f31       crop_hmap_1
+0001e270: 2e66 756c 6c4d 6170 2c0a 2020 2020 2020  .fullMap,.      
+0001e280: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2c0: 2020 2020 2020 2020 2020 2020 2020 6174                at
-0001e2d0: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
-0001e2e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2a0: 2020 2020 2020 6372 6f70 5f68 6d61 705f        crop_hmap_
+0001e2b0: 322e 6675 6c6c 4d61 702c 0a20 2020 2020  2.fullMap,.     
+0001e2c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e2e0: 2020 2020 2020 206d 6173 6b2e 6675 6c6c         mask.full
+0001e2f0: 4d61 702c 0a20 2020 2020 2020 2020 2020  Map,.           
 0001e300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e310: 2020 2020 2020 2020 6d61 736b 5f64 696d          mask_dim
-0001e320: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
-0001e330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e320: 2070 6978 656c 5f73 697a 653d 7461 7267   pixel_size=targ
+0001e330: 6574 5f6d 6170 2e61 7069 785b 305d 2c0a  et_map.apix[0],.
 0001e340: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0001e370: 2020 2020 2020 2020 2020 2020 2066 7363               fsc
-0001e380: 203d 2066 6f75 7269 6572 2e63 616c 6375   = fourier.calcu
-0001e390: 6c61 7465 5f66 7363 5f77 6974 685f 6d61  late_fsc_with_ma
-0001e3a0: 736b 280a 2020 2020 2020 2020 2020 2020  sk(.            
-0001e3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e3d0: 6372 6f70 5f68 6d61 705f 312e 6675 6c6c  crop_hmap_1.full
-0001e3e0: 4d61 702c 0a20 2020 2020 2020 2020 2020  Map,.           
-0001e3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e410: 2063 726f 705f 686d 6170 5f32 2e66 756c   crop_hmap_2.ful
-0001e420: 6c4d 6170 2c0a 2020 2020 2020 2020 2020  lMap,.          
-0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e450: 2020 6d61 736b 2e66 756c 6c4d 6170 2c0a    mask.fullMap,.
+0001e360: 2020 2020 2020 2020 2020 2020 6c61 6265              labe
+0001e370: 6c6c 6564 5f73 6865 6c6c 733d 6c61 6265  lled_shells=labe
+0001e380: 6c6c 6564 5f73 6865 6c6c 732c 0a20 2020  lled_shells,.   
+0001e390: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3b0: 2020 2020 2020 2020 2071 6269 6e73 3d71           qbins=q
+0001e3c0: 6269 6e73 2c0a 2020 2020 2020 2020 2020  bins,.          
+0001e3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e3f0: 2020 6666 7477 5f6f 626a 6563 7431 3d66    fftw_object1=f
+0001e400: 6674 775f 6f62 6a65 6374 312c 0a20 2020  ftw_object1,.   
+0001e410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e430: 2020 2020 2020 2020 2066 6674 775f 6f62           fftw_ob
+0001e440: 6a65 6374 323d 6666 7477 5f6f 626a 6563  ject2=fftw_objec
+0001e450: 7432 2c0a 2020 2020 2020 2020 2020 2020  t2,.            
 0001e460: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e480: 2020 2020 2020 2020 2020 2020 7069 7865              pixe
-0001e490: 6c5f 7369 7a65 3d74 6172 6765 745f 6d61  l_size=target_ma
-0001e4a0: 702e 6170 6978 5b30 5d2c 0a20 2020 2020  p.apix[0],.     
-0001e4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e480: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001e490: 2020 2020 2020 6c6f 6361 6c5f 7265 7320        local_res 
+0001e4a0: 3d20 666f 7572 6965 722e 6765 745f 6673  = fourier.get_fs
+0001e4b0: 635f 7265 736f 6c75 7469 6f6e 280a 2020  c_resolution(.  
 0001e4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e4d0: 2020 2020 2020 206c 6162 656c 6c65 645f         labelled_
-0001e4e0: 7368 656c 6c73 3d6c 6162 656c 6c65 645f  shells=labelled_
-0001e4f0: 7368 656c 6c73 2c0a 2020 2020 2020 2020  shells,.        
+0001e4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e4e0: 2020 2020 2020 2020 2020 2020 2020 6673                fs
+0001e4f0: 632c 0a20 2020 2020 2020 2020 2020 2020  c,.             
 0001e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e520: 2020 2020 7162 696e 733d 7162 696e 732c      qbins=qbins,
-0001e530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e520: 2020 2066 7363 5f74 6872 6573 686f 6c64     fsc_threshold
+0001e530: 3d30 2e35 2c0a 2020 2020 2020 2020 2020  =0.5,.          
 0001e540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e550: 2020 2020 2020 2020 2020 2020 2066 6674               fft
-0001e560: 775f 6f62 6a65 6374 313d 6666 7477 5f6f  w_object1=fftw_o
-0001e570: 626a 6563 7431 2c0a 2020 2020 2020 2020  bject1,.        
+0001e550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e560: 2020 2020 2020 696e 7465 7270 6f6c 6174        interpolat
+0001e570: 655f 6375 746f 6666 3d46 616c 7365 2c0a  e_cutoff=False,.
 0001e580: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001e590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5a0: 2020 2020 6666 7477 5f6f 626a 6563 7432      fftw_object2
-0001e5b0: 3d66 6674 775f 6f62 6a65 6374 322c 0a20  =fftw_object2,. 
-0001e5c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5b0: 7573 655f 6869 6768 6573 745f 7265 736f  use_highest_reso
+0001e5c0: 6c75 7469 6f6e 3d54 7275 652c 0a20 2020  lution=True,.   
 0001e5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e5e0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001e5f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e600: 206c 6f63 616c 5f72 6573 203d 2066 6f75   local_res = fou
-0001e610: 7269 6572 2e67 6574 5f66 7363 5f72 6573  rier.get_fsc_res
-0001e620: 6f6c 7574 696f 6e28 0a20 2020 2020 2020  olution(.       
-0001e630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e640: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e650: 2020 2020 2020 2020 2066 7363 2c0a 2020           fsc,.  
-0001e660: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e670: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e680: 2020 2020 2020 2020 2020 2020 2020 6673                fs
-0001e690: 635f 7468 7265 7368 6f6c 643d 302e 352c  c_threshold=0.5,
-0001e6a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001e6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e6d0: 2069 6e74 6572 706f 6c61 7465 5f63 7574   interpolate_cut
-0001e6e0: 6f66 663d 4661 6c73 652c 0a20 2020 2020  off=False,.     
+0001e5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e5f0: 2020 2020 2020 2020 2020 2020 2029 0a20               ). 
+0001e600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e610: 2020 2066 7265 715f 6174 5f63 6f72 725f     freq_at_corr_
+0001e620: 6375 746f 6666 203d 2066 7265 715f 6174  cutoff = freq_at
+0001e630: 5f63 6f72 725f 6375 746f 6666 202f 206c  _corr_cutoff / l
+0001e640: 6f63 616c 5f72 6573 0a0a 2020 2020 2020  ocal_res..      
+0001e650: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
+0001e660: 6573 5f73 636f 7265 735b 2861 746f 6d2e  es_scores[(atom.
+0001e670: 6368 6169 6e2c 2069 6e74 2861 746f 6d2e  chain, int(atom.
+0001e680: 7265 735f 6e6f 2929 5d20 3d20 5c0a 2020  res_no))] = \.  
+0001e690: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e6a0: 2020 6672 6571 5f61 745f 636f 7272 5f63    freq_at_corr_c
+0001e6b0: 7574 6f66 660a 0a20 2020 2020 2020 2020  utoff..         
+0001e6c0: 2020 2020 2020 2072 6573 5f6e 6f20 2b3d         res_no +=
+0001e6d0: 2031 0a20 2020 2020 2020 2020 2020 2020   1.             
+0001e6e0: 2020 2069 6620 7665 7262 6f73 653a 0a20     if verbose:. 
 0001e6f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e700: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e710: 2020 2020 2020 2020 2020 2075 7365 5f68             use_h
-0001e720: 6967 6865 7374 5f72 6573 6f6c 7574 696f  ighest_resolutio
-0001e730: 6e3d 5472 7565 2c0a 2020 2020 2020 2020  n=True,.        
-0001e740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e760: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001e770: 2020 2020 2020 2020 2020 2020 2020 6672                fr
-0001e780: 6571 5f61 745f 636f 7272 5f63 7574 6f66  eq_at_corr_cutof
-0001e790: 6620 3d20 6672 6571 5f61 745f 636f 7272  f = freq_at_corr
-0001e7a0: 5f63 7574 6f66 6620 2f20 6c6f 6361 6c5f  _cutoff / local_
-0001e7b0: 7265 730a 0a20 2020 2020 2020 2020 2020  res..           
-0001e7c0: 2020 2020 2064 6963 745f 7265 735f 7363       dict_res_sc
-0001e7d0: 6f72 6573 5b28 6174 6f6d 2e63 6861 696e  ores[(atom.chain
-0001e7e0: 2c20 696e 7428 6174 6f6d 2e72 6573 5f6e  , int(atom.res_n
-0001e7f0: 6f29 295d 203d 205c 0a20 2020 2020 2020  o))] = \.       
-0001e800: 2020 2020 2020 2020 2020 2020 2066 7265               fre
-0001e810: 715f 6174 5f63 6f72 725f 6375 746f 6666  q_at_corr_cutoff
-0001e820: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001e830: 2020 7265 735f 6e6f 202b 3d20 310a 2020    res_no += 1.  
-0001e840: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0001e850: 2076 6572 626f 7365 3a0a 2020 2020 2020   verbose:.      
-0001e860: 2020 2020 2020 2020 2020 2020 2020 7a66                zf
-0001e870: 696c 6c5f 6c65 6e20 3d20 6c65 6e28 7374  ill_len = len(st
-0001e880: 7228 6e75 6d62 6572 5f6f 665f 7265 7369  r(number_of_resi
-0001e890: 6475 6573 2929 0a20 2020 2020 2020 2020  dues)).         
-0001e8a0: 2020 2020 2020 2020 2020 2070 7269 6e74             print
-0001e8b0: 2866 225c 7250 726f 6365 7373 6564 2072  (f"\rProcessed r
-0001e8c0: 6573 6964 7565 207b 7374 7228 7265 735f  esidue {str(res_
-0001e8d0: 6e6f 292e 7a66 696c 6c28 7a66 696c 6c5f  no).zfill(zfill_
-0001e8e0: 6c65 6e29 7d22 0a20 2020 2020 2020 2020  len)}".         
+0001e700: 2020 207a 6669 6c6c 5f6c 656e 203d 206c     zfill_len = l
+0001e710: 656e 2873 7472 286e 756d 6265 725f 6f66  en(str(number_of
+0001e720: 5f72 6573 6964 7565 7329 290a 2020 2020  _residues)).    
+0001e730: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e740: 7072 696e 7428 6622 5c72 5072 6f63 6573  print(f"\rProces
+0001e750: 7365 6420 7265 7369 6475 6520 7b73 7472  sed residue {str
+0001e760: 2872 6573 5f6e 6f29 2e7a 6669 6c6c 287a  (res_no).zfill(z
+0001e770: 6669 6c6c 5f6c 656e 297d 220a 2020 2020  fill_len)}".    
+0001e780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e790: 2020 2020 2020 6622 2f7b 6e75 6d62 6572        f"/{number
+0001e7a0: 5f6f 665f 7265 7369 6475 6573 7d22 2c20  _of_residues}", 
+0001e7b0: 7365 703d 2727 2c20 656e 643d 2727 2c20  sep='', end='', 
+0001e7c0: 666c 7573 683d 5472 7565 290a 0a20 2020  flush=True)..   
+0001e7d0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+0001e7e0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+0001e7f0: 6e74 2822 2229 0a20 2020 2020 2020 2020  nt("").         
+0001e800: 2020 2066 6f72 2077 6172 6e69 6e67 2069     for warning i
+0001e810: 6e20 7761 726e 696e 6773 3a0a 2020 2020  n warnings:.    
+0001e820: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+0001e830: 7428 7761 726e 696e 6729 0a0a 2020 2020  t(warning)..    
+0001e840: 2020 2020 7265 7475 726e 2064 6963 745f      return dict_
+0001e850: 7265 735f 7363 6f72 6573 0a0a 2020 2020  res_scores..    
+0001e860: 6465 6620 6d61 705f 6c6f 6361 6c5f 7265  def map_local_re
+0001e870: 736f 6c75 7469 6f6e 280a 2020 2020 2020  solution(.      
+0001e880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e890: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001e8a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8b0: 2020 2020 2020 2020 6861 6c66 5f6d 6170          half_map
+0001e8c0: 5f31 2c0a 2020 2020 2020 2020 2020 2020  _1,.            
+0001e8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e8e0: 6861 6c66 5f6d 6170 5f32 2c0a 2020 2020  half_map_2,.    
 0001e8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e900: 2066 222f 7b6e 756d 6265 725f 6f66 5f72   f"/{number_of_r
-0001e910: 6573 6964 7565 737d 222c 2073 6570 3d27  esidues}", sep='
-0001e920: 272c 2065 6e64 3d27 272c 2066 6c75 7368  ', end='', flush
-0001e930: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-0001e940: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-0001e950: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-0001e960: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-0001e970: 7220 7761 726e 696e 6720 696e 2077 6172  r warning in war
-0001e980: 6e69 6e67 733a 0a20 2020 2020 2020 2020  nings:.         
-0001e990: 2020 2020 2020 2070 7269 6e74 2877 6172         print(war
-0001e9a0: 6e69 6e67 290a 0a20 2020 2020 2020 2072  ning)..        r
-0001e9b0: 6574 7572 6e20 6469 6374 5f72 6573 5f73  eturn dict_res_s
-0001e9c0: 636f 7265 730a 0a20 2020 2064 6566 206d  cores..    def m
-0001e9d0: 6170 5f6c 6f63 616c 5f72 6573 6f6c 7574  ap_local_resolut
-0001e9e0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
-0001e9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea00: 2073 656c 662c 0a20 2020 2020 2020 2020   self,.         
-0001ea10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea20: 2020 2068 616c 665f 6d61 705f 312c 0a20     half_map_1,. 
-0001ea30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea40: 2020 2020 2020 2020 2020 2068 616c 665f             half_
-0001ea50: 6d61 705f 322c 0a20 2020 2020 2020 2020  map_2,.         
-0001ea60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ea70: 2020 2073 7472 7563 7475 7265 3d4e 6f6e     structure=Non
-0001ea80: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001ea90: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001eaa0: 726f 7465 696e 5f6d 6173 6b3d 4e6f 6e65  rotein_mask=None
-0001eab0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001eac0: 2020 2020 2020 2020 2020 2020 2020 7665                ve
-0001ead0: 7262 6f73 653d 5472 7565 2c0a 2020 2020  rbose=True,.    
-0001eae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eaf0: 2020 2020 2020 2020 6673 635f 7468 7265          fsc_thre
-0001eb00: 7368 6f6c 643d 302e 352c 0a20 2020 2020  shold=0.5,.     
-0001eb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001eb20: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-0001eb30: 2020 2222 2243 616c 6375 6c61 7465 2074    """Calculate t
-0001eb40: 6865 206c 6f63 616c 2072 6573 6f6c 7574  he local resolut
-0001eb50: 696f 6e20 7573 696e 6720 7468 6520 6c6f  ion using the lo
-0001eb60: 6361 6c20 4653 4320 6d65 7468 6f64 2e0a  cal FSC method..
-0001eb70: 0a20 2020 2020 2020 2041 7267 756d 656e  .        Argumen
-0001eb80: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
-0001eb90: 6861 6c66 5f6d 6170 5f31 3a20 4120 6d61  half_map_1: A ma
-0001eba0: 7020 696e 7374 616e 6365 206f 6620 7468  p instance of th
-0001ebb0: 6520 6669 7273 7420 6861 6c66 2d6d 6170  e first half-map
-0001ebc0: 2e0a 2020 2020 2020 2020 2020 2020 6861  ..            ha
-0001ebd0: 6c66 5f6d 6170 5f32 3a20 4120 6d61 7020  lf_map_2: A map 
-0001ebe0: 696e 7374 616e 6365 206f 6620 7468 6520  instance of the 
-0001ebf0: 7365 636f 6e64 2068 616c 6620 6d61 702e  second half map.
-0001ec00: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-0001ec10: 7563 7475 7265 3a20 4d6f 6465 6c20 7374  ucture: Model st
-0001ec20: 7275 6374 7572 6520 696e 7374 616e 6365  ructure instance
-0001ec30: 2e20 4966 2064 6566 696e 6564 2c20 7468  . If defined, th
-0001ec40: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001ec50: 2020 6c6f 6361 6c20 7265 736f 6c75 7469    local resoluti
-0001ec60: 6f6e 2069 7320 6361 6c63 756c 6174 6564  on is calculated
-0001ec70: 2061 7420 7468 6520 4341 2061 746f 6d0a   at the CA atom.
-0001ec80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ec90: 666f 7220 6561 6368 2072 6573 6964 7565  for each residue
-0001eca0: 2069 6e20 7468 6520 7374 7275 6374 7572   in the structur
-0001ecb0: 6520 6f6e 6c79 2e0a 2020 2020 2020 2020  e only..        
-0001ecc0: 2020 2020 7072 6f74 6569 6e5f 6d61 736b      protein_mask
-0001ecd0: 3a20 4120 4d61 7020 696e 7374 616e 6365  : A Map instance
-0001ece0: 206f 6620 6120 6d61 736b 2e20 4966 2064   of a mask. If d
-0001ecf0: 6566 696e 6564 2c20 7468 650a 2020 2020  efined, the.    
-0001ed00: 2020 2020 2020 2020 2020 2020 6c6f 6361              loca
-0001ed10: 6c20 7265 736f 6c75 7469 6f6e 2069 7320  l resolution is 
-0001ed20: 6361 6c63 756c 6174 6564 2061 7420 6561  calculated at ea
-0001ed30: 6368 2070 6f69 6e74 2077 6974 6869 6e0a  ch point within.
-0001ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ed50: 7468 6520 6d61 736b 206f 6e6c 792e 0a20  the mask only.. 
-0001ed60: 2020 2020 2020 2020 2020 2076 6572 626f             verbo
-0001ed70: 7365 3a20 4966 2054 7275 652c 2070 7269  se: If True, pri
-0001ed80: 6e74 7320 6120 7072 6f67 7265 7373 2062  nts a progress b
-0001ed90: 6172 2061 6e64 2077 6172 6e69 6e67 730a  ar and warnings.
-0001eda0: 2020 2020 2020 2020 2020 2020 6673 635f              fsc_
-0001edb0: 7468 7265 7368 6f6c 643a 2043 6f72 7265  threshold: Corre
-0001edc0: 6c61 7469 6f6e 2074 6872 6573 686f 6c64  lation threshold
-0001edd0: 2076 616c 7565 2074 6861 7420 6465 6669   value that defi
-0001ede0: 6e65 730a 2020 2020 2020 2020 2020 2020  nes.            
-0001edf0: 2020 2020 686f 7720 7468 6520 6d61 7020      how the map 
-0001ee00: 7265 736f 6c75 7469 6f6e 2069 7320 666f  resolution is fo
-0001ee10: 756e 642e 0a0a 2020 2020 2020 2020 5265  und...        Re
-0001ee20: 7475 726e 733a 0a20 2020 2020 2020 2020  turns:.         
-0001ee30: 2020 2054 6865 206c 6f63 616c 2072 6573     The local res
-0001ee40: 6f6c 7574 696f 6e20 6174 2065 6163 6820  olution at each 
-0001ee50: 706f 7369 7469 6f6e 2069 6e20 7468 6520  position in the 
-0001ee60: 6d61 702c 206f 7220 6173 0a20 2020 2020  map, or as.     
-0001ee70: 2020 2020 2020 2064 6566 696e 6564 2062         defined b
-0001ee80: 7920 7468 6520 7374 7275 6374 7572 6520  y the structure 
-0001ee90: 696e 7374 616e 6365 206f 7220 6d61 736b  instance or mask
-0001eea0: 2e20 5468 6520 6f75 7470 7574 0a20 2020  . The output.   
-0001eeb0: 2020 2020 2020 2020 2069 7320 6120 6469           is a di
-0001eec0: 6374 696f 6e61 7279 2077 6865 7265 2065  ctionary where e
-0001eed0: 6163 6820 6b65 7920 6861 7320 7468 6520  ach key has the 
-0001eee0: 666f 726d 6174 3a0a 2020 2020 2020 2020  format:.        
-0001eef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ef00: 2020 2020 287a 2c20 792c 2078 290a 2020      (z, y, x).  
-0001ef10: 2020 2020 2020 2020 2020 7768 6572 6520            where 
-0001ef20: 7a2c 2079 2c20 7820 6973 2061 2033 442d  z, y, x is a 3D-
-0001ef30: 696e 6465 7820 6672 6f6d 2074 6865 2068  index from the h
-0001ef40: 616c 6620 6d61 7073 2c20 616e 6420 7468  alf maps, and th
-0001ef50: 650a 2020 2020 2020 2020 2020 2020 7661  e.            va
-0001ef60: 6c75 6520 6973 2074 6865 206c 6f63 616c  lue is the local
-0001ef70: 2072 6573 6f6c 7574 696f 6e20 2869 6e20   resolution (in 
-0001ef80: 616e 6773 7472 6f6d 7329 2e0a 2020 2020  angstroms)..    
-0001ef90: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001efa0: 7072 696e 7428 6622 4361 6c63 756c 6174  print(f"Calculat
-0001efb0: 696e 6720 4c6f 6361 6c20 5265 736f 6c75  ing Local Resolu
-0001efc0: 7469 6f6e 2066 6f72 2068 616c 6620 6d61  tion for half ma
-0001efd0: 703a 220a 2020 2020 2020 2020 2020 2020  p:".            
-0001efe0: 2020 6622 7b68 616c 665f 6d61 705f 312e    f"{half_map_1.
-0001eff0: 6669 6c65 6e61 6d65 7d20 616e 6420 6d61  filename} and ma
-0001f000: 7020 7b68 616c 665f 6d61 705f 322e 6669  p {half_map_2.fi
-0001f010: 6c65 6e61 6d65 7d22 290a 0a20 2020 2020  lename}")..     
-0001f020: 2020 2023 2073 6574 2075 7020 736f 6d65     # set up some
-0001f030: 2073 7475 6666 0a20 2020 2020 2020 2061   stuff.        a
-0001f040: 7069 7820 3d20 6e70 2e61 7272 6179 2868  pix = np.array(h
-0001f050: 616c 665f 6d61 705f 312e 6170 6978 295b  alf_map_1.apix)[
-0001f060: 305d 0a20 2020 2020 2020 206d 6170 5f72  0].        map_r
-0001f070: 6573 203d 2073 656c 662e 6d61 705f 7265  es = self.map_re
-0001f080: 736f 6c75 7469 6f6e 5f46 5343 2868 616c  solution_FSC(hal
-0001f090: 665f 6d61 705f 312c 2068 616c 665f 6d61  f_map_1, half_ma
-0001f0a0: 705f 3229 0a20 2020 2020 2020 2062 6c75  p_2).        blu
-0001f0b0: 7272 6572 203d 2053 7472 7563 7475 7265  rrer = Structure
-0001f0c0: 426c 7572 7265 7228 290a 0a20 2020 2020  Blurrer()..     
-0001f0d0: 2020 2023 2061 7070 726f 7869 6d61 7465     # approximate
-0001f0e0: 206d 6173 6b20 7370 6865 7265 2064 6961   mask sphere dia
-0001f0f0: 6d65 7465 720a 2020 2020 2020 2020 7370  meter.        sp
-0001f100: 6865 7265 5f64 6961 6d65 7465 725f 616e  here_diameter_an
-0001f110: 6773 7472 6f6d 7320 3d20 6d61 705f 7265  gstroms = map_re
-0001f120: 7320 2a20 370a 2020 2020 2020 2020 7370  s * 7.        sp
-0001f130: 6865 7265 5f64 6961 6d65 7465 725f 7069  here_diameter_pi
-0001f140: 7865 6c73 203d 2069 6e74 2873 7068 6572  xels = int(spher
-0001f150: 655f 6469 616d 6574 6572 5f61 6e67 7374  e_diameter_angst
-0001f160: 726f 6d73 2f61 7069 7829 0a0a 2020 2020  roms/apix)..    
-0001f170: 2020 2020 2320 656e 7375 7265 2074 6861      # ensure tha
-0001f180: 7420 7061 7261 6d65 7465 7273 2061 7265  t parameters are
-0001f190: 2073 656e 7369 626c 6520 692e 652e 206e   sensible i.e. n
-0001f1a0: 6f74 2061 2031 2070 6978 656c 2077 6964  ot a 1 pixel wid
-0001f1b0: 6520 6d61 736b 0a20 2020 2020 2020 2069  e mask.        i
-0001f1c0: 6620 7370 6865 7265 5f64 6961 6d65 7465  f sphere_diamete
-0001f1d0: 725f 7069 7865 6c73 203c 2036 3a0a 2020  r_pixels < 6:.  
-0001f1e0: 2020 2020 2020 2020 2020 7370 6865 7265            sphere
-0001f1f0: 5f64 6961 6d65 7465 725f 7069 7865 6c73  _diameter_pixels
-0001f200: 203d 2036 0a20 2020 2020 2020 2063 6f73   = 6.        cos
-0001f210: 5f65 6467 6520 3d20 696e 7428 726f 756e  _edge = int(roun
-0001f220: 6428 7370 6865 7265 5f64 6961 6d65 7465  d(sphere_diamete
-0001f230: 725f 7069 7865 6c73 202f 2033 2929 0a20  r_pixels / 3)). 
-0001f240: 2020 2020 2020 2069 6620 636f 735f 6564         if cos_ed
-0001f250: 6765 203c 2031 303a 0a20 2020 2020 2020  ge < 10:.       
-0001f260: 2020 2020 2063 6f73 5f65 6467 6520 3d20       cos_edge = 
-0001f270: 3130 0a0a 2020 2020 2020 2020 2320 6765  10..        # ge
-0001f280: 7420 616e 2061 7070 726f 7072 6961 7465  t an appropriate
-0001f290: 2062 6f78 2073 697a 6520 746f 2063 726f   box size to cro
-0001f2a0: 7020 6672 6f6d 206d 6169 6e20 6d61 700a  p from main map.
-0001f2b0: 2020 2020 2020 2020 2320 7769 6c6c 2062          # will b
-0001f2c0: 6520 325e 6e2c 2033 5e6e 206f 7220 355e  e 2^n, 3^n or 5^
-0001f2d0: 6e20 7369 7a65 2077 6865 7265 206e 2069  n size where n i
-0001f2e0: 7320 7468 6520 6e75 6d62 6572 2072 6571  s the number req
-0001f2f0: 7569 7265 6420 666f 720a 2020 2020 2020  uired for.      
-0001f300: 2020 2320 7468 6520 6d69 6e69 6d75 6d20    # the minimum 
-0001f310: 626f 7820 7369 7a65 206e 6565 6465 6420  box size needed 
-0001f320: 746f 2065 6e63 6f6d 7061 7373 2065 6e74  to encompass ent
-0001f330: 6972 6520 6d61 736b 2069 6e20 626f 780a  ire mask in box.
-0001f340: 2020 2020 2020 2020 6d61 736b 5f64 696d          mask_dim
-0001f350: 7320 3d20 666f 7572 6965 722e 6765 745f  s = fourier.get_
-0001f360: 6666 745f 6f70 7469 6d69 7365 645f 626f  fft_optimised_bo
-0001f370: 785f 7369 7a65 280a 2020 2020 2020 2020  x_size(.        
-0001f380: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f390: 2020 2020 2020 2020 2020 2020 7370 6865              sphe
-0001f3a0: 7265 5f64 6961 6d65 7465 725f 7069 7865  re_diameter_pixe
-0001f3b0: 6c73 202b 2028 636f 735f 6564 6765 202a  ls + (cos_edge *
-0001f3c0: 2032 292c 0a20 2020 2020 2020 2020 2020   2),.           
-0001f3d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f3e0: 2020 2020 2020 2020 2068 616c 665f 6d61           half_ma
-0001f3f0: 705f 312e 6675 6c6c 4d61 702e 7368 6170  p_1.fullMap.shap
-0001f400: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001f410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f420: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
-0001f430: 2020 6966 206d 6173 6b5f 6469 6d73 203d    if mask_dims =
-0001f440: 3d20 5b30 2c20 302c 2030 5d3a 0a20 2020  = [0, 0, 0]:.   
-0001f450: 2020 2020 2020 2020 206d 6173 6b20 3d20           mask = 
-0001f460: 4d61 7028 6e70 2e6f 6e65 7328 6861 6c66  Map(np.ones(half
-0001f470: 5f6d 6170 5f31 2e66 756c 6c4d 6170 2e73  _map_1.fullMap.s
-0001f480: 6861 7065 292c 2068 616c 665f 6d61 705f  hape), half_map_
-0001f490: 312e 6f72 6967 696e 2c0a 2020 2020 2020  1.origin,.      
-0001f4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f4b0: 2068 616c 665f 6d61 705f 312e 6170 6978   half_map_1.apix
-0001f4c0: 2c20 6861 6c66 5f6d 6170 5f31 2e66 696c  , half_map_1.fil
-0001f4d0: 656e 616d 6529 0a20 2020 2020 2020 2020  ename).         
-0001f4e0: 2020 206d 6173 6b5f 6469 6d73 203d 206d     mask_dims = m
-0001f4f0: 6173 6b2e 6675 6c6c 4d61 702e 7368 6170  ask.fullMap.shap
-0001f500: 650a 2020 2020 2020 2020 656c 7365 3a0a  e.        else:.
-0001f510: 2020 2020 2020 2020 2020 2020 6365 6e74              cent
-0001f520: 7265 5f6f 665f 6d61 736b 5f6d 6170 203d  re_of_mask_map =
-0001f530: 205b 6d61 736b 5f64 696d 735b 305d 2f32   [mask_dims[0]/2
-0001f540: 2c20 6d61 736b 5f64 696d 735b 315d 2f32  , mask_dims[1]/2
-0001f550: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001f560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f570: 2020 2020 6d61 736b 5f64 696d 735b 325d      mask_dims[2]
-0001f580: 2f32 5d0a 2020 2020 2020 2020 2020 2020  /2].            
-0001f590: 6d61 736b 203d 2062 6c75 7272 6572 2e6d  mask = blurrer.m
-0001f5a0: 616b 655f 7370 6865 7269 6361 6c5f 6d61  ake_spherical_ma
-0001f5b0: 736b 2873 7068 6572 655f 6469 616d 6574  sk(sphere_diamet
-0001f5c0: 6572 5f70 6978 656c 732c 0a20 2020 2020  er_pixels,.     
-0001f5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f5f0: 2020 2020 2020 2020 2020 6d61 736b 5f64            mask_d
-0001f600: 696d 732c 2063 656e 7472 655f 6f66 5f6d  ims, centre_of_m
-0001f610: 6173 6b5f 6d61 702c 0a20 2020 2020 2020  ask_map,.       
-0001f620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001f640: 2020 2020 2020 2020 636f 735f 6564 6765          cos_edge
-0001f650: 290a 0a20 2020 2020 2020 2023 2073 6176  )..        # sav
-0001f660: 6520 7363 6f72 6573 2066 6f72 2065 6163  e scores for eac
-0001f670: 6820 6368 6169 6e20 616e 6420 7265 730a  h chain and res.
-0001f680: 2020 2020 2020 2020 6469 6374 5f72 6573          dict_res
-0001f690: 5f73 636f 7265 7320 3d20 4f72 6465 7265  _scores = Ordere
-0001f6a0: 6444 6963 7428 290a 0a20 2020 2020 2020  dDict()..       
-0001f6b0: 2023 2073 6574 2075 7020 7079 6666 7477   # set up pyfftw
-0001f6c0: 2066 6f72 2076 6572 7920 6661 7374 2066   for very fast f
-0001f6d0: 6674 730a 2020 2020 2020 2020 696e 7075  fts.        inpu
-0001f6e0: 7431 203d 2070 7966 6674 772e 656d 7074  t1 = pyfftw.empt
-0001f6f0: 795f 616c 6967 6e65 6428 6d61 736b 5f64  y_aligned(mask_d
-0001f700: 696d 732c 2064 7479 7065 3d27 666c 6f61  ims, dtype='floa
-0001f710: 7436 3427 290a 0a20 2020 2020 2020 2066  t64')..        f
-0001f720: 6674 775f 6f62 6a65 6374 3120 3d20 666f  ftw_object1 = fo
-0001f730: 7572 6965 722e 6765 745f 7079 6666 7477  urier.get_pyfftw
-0001f740: 5f6f 626a 6563 7428 6d61 736b 5f64 696d  _object(mask_dim
-0001f750: 7329 0a20 2020 2020 2020 2066 6674 775f  s).        fftw_
-0001f760: 6f62 6a65 6374 3220 3d20 666f 7572 6965  object2 = fourie
-0001f770: 722e 6765 745f 7079 6666 7477 5f6f 626a  r.get_pyfftw_obj
-0001f780: 6563 7428 6d61 736b 5f64 696d 7329 0a0a  ect(mask_dims)..
-0001f790: 2020 2020 2020 2020 7162 696e 732c 206c          qbins, l
-0001f7a0: 6162 656c 6c65 645f 7368 656c 6c73 203d  abelled_shells =
-0001f7b0: 2066 6f75 7269 6572 2e67 6574 5f6c 6162   fourier.get_lab
-0001f7c0: 656c 6c65 645f 7368 656c 6c73 280a 2020  elled_shells(.  
-0001f7d0: 2020 2020 2020 2020 2020 696e 7075 7431            input1
-0001f7e0: 2e73 6861 7065 290a 0a20 2020 2020 2020  .shape)..       
-0001f7f0: 2023 2067 6574 2063 6f6f 7264 696e 6174   # get coordinat
-0001f800: 6573 2077 6865 7265 206c 6f63 616c 2046  es where local F
-0001f810: 5343 2073 686f 756c 6420 6265 2063 616c  SC should be cal
-0001f820: 6375 6c61 7465 640a 2020 2020 2020 2020  culated.        
-0001f830: 6966 2073 7472 7563 7475 7265 2069 7320  if structure is 
-0001f840: 6e6f 7420 4e6f 6e65 3a0a 2020 2020 2020  not None:.      
-0001f850: 2020 2020 2020 636f 6f72 6469 6e61 7465        coordinate
-0001f860: 7320 3d20 7374 7275 6374 7572 652e 6765  s = structure.ge
-0001f870: 745f 4341 6f6e 6c79 2829 2e67 6574 5f61  t_CAonly().get_a
-0001f880: 746f 6d5f 7a79 785f 6d61 705f 696e 6465  tom_zyx_map_inde
-0001f890: 7865 7328 0a20 2020 2020 2020 2020 2020  xes(.           
-0001f8a0: 2020 2020 2068 616c 665f 6d61 705f 3129       half_map_1)
-0001f8b0: 0a20 2020 2020 2020 2065 6c69 6620 7072  .        elif pr
-0001f8c0: 6f74 6569 6e5f 6d61 736b 2069 7320 6e6f  otein_mask is no
-0001f8d0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-0001f8e0: 2020 2020 287a 2c20 792c 2078 2920 3d20      (z, y, x) = 
-0001f8f0: 6e70 2e77 6865 7265 2870 726f 7465 696e  np.where(protein
-0001f900: 5f6d 6173 6b2e 6675 6c6c 4d61 7020 3e20  _mask.fullMap > 
-0001f910: 3029 0a20 2020 2020 2020 2020 2020 2063  0).            c
-0001f920: 6f6f 7264 696e 6174 6573 203d 206e 702e  oordinates = np.
-0001f930: 7374 6163 6b28 287a 2c20 792c 2078 292c  stack((z, y, x),
-0001f940: 2061 7869 733d 2d31 290a 2020 2020 2020   axis=-1).      
-0001f950: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001f960: 2020 2020 287a 2c20 792c 2078 2920 3d20      (z, y, x) = 
-0001f970: 6e70 2e77 6865 7265 2868 616c 665f 6d61  np.where(half_ma
-0001f980: 705f 312e 6675 6c6c 4d61 7020 3c20 6e70  p_1.fullMap < np
-0001f990: 2e69 6e66 290a 2020 2020 2020 2020 2020  .inf).          
-0001f9a0: 2020 636f 6f72 6469 6e61 7465 7320 3d20    coordinates = 
-0001f9b0: 6e70 2e73 7461 636b 2828 7a2c 2079 2c20  np.stack((z, y, 
-0001f9c0: 7829 2c20 6178 6973 3d2d 3129 0a0a 2020  x), axis=-1)..  
-0001f9d0: 2020 2020 2020 7761 726e 696e 6773 203d        warnings =
-0001f9e0: 205b 5d0a 2020 2020 2020 2020 6e20 3d20   [].        n = 
-0001f9f0: 300a 0a20 2020 2020 2020 2066 6f72 2063  0..        for c
-0001fa00: 6f6f 7264 696e 6174 6520 696e 2063 6f6f  oordinate in coo
-0001fa10: 7264 696e 6174 6573 3a0a 0a20 2020 2020  rdinates:..     
-0001fa20: 2020 2020 2020 2063 726f 7070 6564 5f6d         cropped_m
-0001fa30: 6170 5f31 203d 2068 616c 665f 6d61 705f  ap_1 = half_map_
-0001fa40: 312e 6765 745f 6372 6f70 7065 645f 626f  1.get_cropped_bo
-0001fa50: 7828 0a20 2020 2020 2020 2020 2020 2020  x(.             
+0001e900: 2020 2020 2020 2020 7374 7275 6374 7572          structur
+0001e910: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+0001e920: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e930: 2020 2020 7072 6f74 6569 6e5f 6d61 736b      protein_mask
+0001e940: 3d4e 6f6e 652c 0a20 2020 2020 2020 2020  =None,.         
+0001e950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e960: 2020 2076 6572 626f 7365 3d54 7275 652c     verbose=True,
+0001e970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e980: 2020 2020 2020 2020 2020 2020 2066 7363               fsc
+0001e990: 5f74 6872 6573 686f 6c64 3d30 2e35 2c0a  _threshold=0.5,.
+0001e9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e9b0: 2020 2020 2020 2020 2020 2020 293a 0a20              ):. 
+0001e9c0: 2020 2020 2020 2022 2222 4361 6c63 756c         """Calcul
+0001e9d0: 6174 6520 7468 6520 6c6f 6361 6c20 7265  ate the local re
+0001e9e0: 736f 6c75 7469 6f6e 2075 7369 6e67 2074  solution using t
+0001e9f0: 6865 206c 6f63 616c 2046 5343 206d 6574  he local FSC met
+0001ea00: 686f 642e 0a0a 2020 2020 2020 2020 4172  hod...        Ar
+0001ea10: 6775 6d65 6e74 733a 0a20 2020 2020 2020  guments:.       
+0001ea20: 2020 2020 2068 616c 665f 6d61 705f 313a       half_map_1:
+0001ea30: 2041 206d 6170 2069 6e73 7461 6e63 6520   A map instance 
+0001ea40: 6f66 2074 6865 2066 6972 7374 2068 616c  of the first hal
+0001ea50: 662d 6d61 702e 0a20 2020 2020 2020 2020  f-map..         
+0001ea60: 2020 2068 616c 665f 6d61 705f 323a 2041     half_map_2: A
+0001ea70: 206d 6170 2069 6e73 7461 6e63 6520 6f66   map instance of
+0001ea80: 2074 6865 2073 6563 6f6e 6420 6861 6c66   the second half
+0001ea90: 206d 6170 2e0a 2020 2020 2020 2020 2020   map..          
+0001eaa0: 2020 7374 7275 6374 7572 653a 204d 6f64    structure: Mod
+0001eab0: 656c 2073 7472 7563 7475 7265 2069 6e73  el structure ins
+0001eac0: 7461 6e63 652e 2049 6620 6465 6669 6e65  tance. If define
+0001ead0: 642c 2074 6865 0a20 2020 2020 2020 2020  d, the.         
+0001eae0: 2020 2020 2020 206c 6f63 616c 2072 6573         local res
+0001eaf0: 6f6c 7574 696f 6e20 6973 2063 616c 6375  olution is calcu
+0001eb00: 6c61 7465 6420 6174 2074 6865 2043 4120  lated at the CA 
+0001eb10: 6174 6f6d 0a20 2020 2020 2020 2020 2020  atom.           
+0001eb20: 2020 2020 2066 6f72 2065 6163 6820 7265       for each re
+0001eb30: 7369 6475 6520 696e 2074 6865 2073 7472  sidue in the str
+0001eb40: 7563 7475 7265 206f 6e6c 792e 0a20 2020  ucture only..   
+0001eb50: 2020 2020 2020 2020 2070 726f 7465 696e           protein
+0001eb60: 5f6d 6173 6b3a 2041 204d 6170 2069 6e73  _mask: A Map ins
+0001eb70: 7461 6e63 6520 6f66 2061 206d 6173 6b2e  tance of a mask.
+0001eb80: 2049 6620 6465 6669 6e65 642c 2074 6865   If defined, the
+0001eb90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001eba0: 206c 6f63 616c 2072 6573 6f6c 7574 696f   local resolutio
+0001ebb0: 6e20 6973 2063 616c 6375 6c61 7465 6420  n is calculated 
+0001ebc0: 6174 2065 6163 6820 706f 696e 7420 7769  at each point wi
+0001ebd0: 7468 696e 0a20 2020 2020 2020 2020 2020  thin.           
+0001ebe0: 2020 2020 2074 6865 206d 6173 6b20 6f6e       the mask on
+0001ebf0: 6c79 2e0a 2020 2020 2020 2020 2020 2020  ly..            
+0001ec00: 7665 7262 6f73 653a 2049 6620 5472 7565  verbose: If True
+0001ec10: 2c20 7072 696e 7473 2061 2070 726f 6772  , prints a progr
+0001ec20: 6573 7320 6261 7220 616e 6420 7761 726e  ess bar and warn
+0001ec30: 696e 6773 0a20 2020 2020 2020 2020 2020  ings.           
+0001ec40: 2066 7363 5f74 6872 6573 686f 6c64 3a20   fsc_threshold: 
+0001ec50: 436f 7272 656c 6174 696f 6e20 7468 7265  Correlation thre
+0001ec60: 7368 6f6c 6420 7661 6c75 6520 7468 6174  shold value that
+0001ec70: 2064 6566 696e 6573 0a20 2020 2020 2020   defines.       
+0001ec80: 2020 2020 2020 2020 2068 6f77 2074 6865           how the
+0001ec90: 206d 6170 2072 6573 6f6c 7574 696f 6e20   map resolution 
+0001eca0: 6973 2066 6f75 6e64 2e0a 0a20 2020 2020  is found...     
+0001ecb0: 2020 2052 6574 7572 6e73 3a0a 2020 2020     Returns:.    
+0001ecc0: 2020 2020 2020 2020 5468 6520 6c6f 6361          The loca
+0001ecd0: 6c20 7265 736f 6c75 7469 6f6e 2061 7420  l resolution at 
+0001ece0: 6561 6368 2070 6f73 6974 696f 6e20 696e  each position in
+0001ecf0: 2074 6865 206d 6170 2c20 6f72 2061 730a   the map, or as.
+0001ed00: 2020 2020 2020 2020 2020 2020 6465 6669              defi
+0001ed10: 6e65 6420 6279 2074 6865 2073 7472 7563  ned by the struc
+0001ed20: 7475 7265 2069 6e73 7461 6e63 6520 6f72  ture instance or
+0001ed30: 206d 6173 6b2e 2054 6865 206f 7574 7075   mask. The outpu
+0001ed40: 740a 2020 2020 2020 2020 2020 2020 6973  t.            is
+0001ed50: 2061 2064 6963 7469 6f6e 6172 7920 7768   a dictionary wh
+0001ed60: 6572 6520 6561 6368 206b 6579 2068 6173  ere each key has
+0001ed70: 2074 6865 2066 6f72 6d61 743a 0a20 2020   the format:.   
+0001ed80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ed90: 2020 2020 2020 2020 2028 7a2c 2079 2c20           (z, y, 
+0001eda0: 7829 0a20 2020 2020 2020 2020 2020 2077  x).            w
+0001edb0: 6865 7265 207a 2c20 792c 2078 2069 7320  here z, y, x is 
+0001edc0: 6120 3344 2d69 6e64 6578 2066 726f 6d20  a 3D-index from 
+0001edd0: 7468 6520 6861 6c66 206d 6170 732c 2061  the half maps, a
+0001ede0: 6e64 2074 6865 0a20 2020 2020 2020 2020  nd the.         
+0001edf0: 2020 2076 616c 7565 2069 7320 7468 6520     value is the 
+0001ee00: 6c6f 6361 6c20 7265 736f 6c75 7469 6f6e  local resolution
+0001ee10: 2028 696e 2061 6e67 7374 726f 6d73 292e   (in angstroms).
+0001ee20: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0001ee30: 2020 2020 2070 7269 6e74 2866 2243 616c       print(f"Cal
+0001ee40: 6375 6c61 7469 6e67 204c 6f63 616c 2052  culating Local R
+0001ee50: 6573 6f6c 7574 696f 6e20 666f 7220 6861  esolution for ha
+0001ee60: 6c66 206d 6170 3a22 0a20 2020 2020 2020  lf map:".       
+0001ee70: 2020 2020 2020 2066 227b 6861 6c66 5f6d         f"{half_m
+0001ee80: 6170 5f31 2e66 696c 656e 616d 657d 2061  ap_1.filename} a
+0001ee90: 6e64 206d 6170 207b 6861 6c66 5f6d 6170  nd map {half_map
+0001eea0: 5f32 2e66 696c 656e 616d 657d 2229 0a0a  _2.filename}")..
+0001eeb0: 2020 2020 2020 2020 2320 7365 7420 7570          # set up
+0001eec0: 2073 6f6d 6520 7374 7566 660a 2020 2020   some stuff.    
+0001eed0: 2020 2020 6170 6978 203d 206e 702e 6172      apix = np.ar
+0001eee0: 7261 7928 6861 6c66 5f6d 6170 5f31 2e61  ray(half_map_1.a
+0001eef0: 7069 7829 5b30 5d0a 2020 2020 2020 2020  pix)[0].        
+0001ef00: 6d61 705f 7265 7320 3d20 7365 6c66 2e6d  map_res = self.m
+0001ef10: 6170 5f72 6573 6f6c 7574 696f 6e5f 4653  ap_resolution_FS
+0001ef20: 4328 6861 6c66 5f6d 6170 5f31 2c20 6861  C(half_map_1, ha
+0001ef30: 6c66 5f6d 6170 5f32 290a 2020 2020 2020  lf_map_2).      
+0001ef40: 2020 626c 7572 7265 7220 3d20 5374 7275    blurrer = Stru
+0001ef50: 6374 7572 6542 6c75 7272 6572 2829 0a0a  ctureBlurrer()..
+0001ef60: 2020 2020 2020 2020 2320 6170 7072 6f78          # approx
+0001ef70: 696d 6174 6520 6d61 736b 2073 7068 6572  imate mask spher
+0001ef80: 6520 6469 616d 6574 6572 0a20 2020 2020  e diameter.     
+0001ef90: 2020 2073 7068 6572 655f 6469 616d 6574     sphere_diamet
+0001efa0: 6572 5f61 6e67 7374 726f 6d73 203d 206d  er_angstroms = m
+0001efb0: 6170 5f72 6573 202a 2037 0a20 2020 2020  ap_res * 7.     
+0001efc0: 2020 2073 7068 6572 655f 6469 616d 6574     sphere_diamet
+0001efd0: 6572 5f70 6978 656c 7320 3d20 696e 7428  er_pixels = int(
+0001efe0: 7370 6865 7265 5f64 6961 6d65 7465 725f  sphere_diameter_
+0001eff0: 616e 6773 7472 6f6d 732f 6170 6978 290a  angstroms/apix).
+0001f000: 0a20 2020 2020 2020 2023 2065 6e73 7572  .        # ensur
+0001f010: 6520 7468 6174 2070 6172 616d 6574 6572  e that parameter
+0001f020: 7320 6172 6520 7365 6e73 6962 6c65 2069  s are sensible i
+0001f030: 2e65 2e20 6e6f 7420 6120 3120 7069 7865  .e. not a 1 pixe
+0001f040: 6c20 7769 6465 206d 6173 6b0a 2020 2020  l wide mask.    
+0001f050: 2020 2020 6966 2073 7068 6572 655f 6469      if sphere_di
+0001f060: 616d 6574 6572 5f70 6978 656c 7320 3c20  ameter_pixels < 
+0001f070: 363a 0a20 2020 2020 2020 2020 2020 2073  6:.            s
+0001f080: 7068 6572 655f 6469 616d 6574 6572 5f70  phere_diameter_p
+0001f090: 6978 656c 7320 3d20 360a 2020 2020 2020  ixels = 6.      
+0001f0a0: 2020 636f 735f 6564 6765 203d 2069 6e74    cos_edge = int
+0001f0b0: 2872 6f75 6e64 2873 7068 6572 655f 6469  (round(sphere_di
+0001f0c0: 616d 6574 6572 5f70 6978 656c 7320 2f20  ameter_pixels / 
+0001f0d0: 3329 290a 2020 2020 2020 2020 6966 2063  3)).        if c
+0001f0e0: 6f73 5f65 6467 6520 3c20 3130 3a0a 2020  os_edge < 10:.  
+0001f0f0: 2020 2020 2020 2020 2020 636f 735f 6564            cos_ed
+0001f100: 6765 203d 2031 300a 0a20 2020 2020 2020  ge = 10..       
+0001f110: 2023 2067 6574 2061 6e20 6170 7072 6f70   # get an approp
+0001f120: 7269 6174 6520 626f 7820 7369 7a65 2074  riate box size t
+0001f130: 6f20 6372 6f70 2066 726f 6d20 6d61 696e  o crop from main
+0001f140: 206d 6170 0a20 2020 2020 2020 2023 2077   map.        # w
+0001f150: 696c 6c20 6265 2032 5e6e 2c20 335e 6e20  ill be 2^n, 3^n 
+0001f160: 6f72 2035 5e6e 2073 697a 6520 7768 6572  or 5^n size wher
+0001f170: 6520 6e20 6973 2074 6865 206e 756d 6265  e n is the numbe
+0001f180: 7220 7265 7175 6972 6564 2066 6f72 0a20  r required for. 
+0001f190: 2020 2020 2020 2023 2074 6865 206d 696e         # the min
+0001f1a0: 696d 756d 2062 6f78 2073 697a 6520 6e65  imum box size ne
+0001f1b0: 6564 6564 2074 6f20 656e 636f 6d70 6173  eded to encompas
+0001f1c0: 7320 656e 7469 7265 206d 6173 6b20 696e  s entire mask in
+0001f1d0: 2062 6f78 0a20 2020 2020 2020 206d 6173   box.        mas
+0001f1e0: 6b5f 6469 6d73 203d 2066 6f75 7269 6572  k_dims = fourier
+0001f1f0: 2e67 6574 5f66 6674 5f6f 7074 696d 6973  .get_fft_optimis
+0001f200: 6564 5f62 6f78 5f73 697a 6528 0a20 2020  ed_box_size(.   
+0001f210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f230: 2073 7068 6572 655f 6469 616d 6574 6572   sphere_diameter
+0001f240: 5f70 6978 656c 7320 2b20 2863 6f73 5f65  _pixels + (cos_e
+0001f250: 6467 6520 2a20 3229 2c0a 2020 2020 2020  dge * 2),.      
+0001f260: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f270: 2020 2020 2020 2020 2020 2020 2020 6861                ha
+0001f280: 6c66 5f6d 6170 5f31 2e66 756c 6c4d 6170  lf_map_1.fullMap
+0001f290: 2e73 6861 7065 2c0a 2020 2020 2020 2020  .shape,.        
+0001f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f2b0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+0001f2c0: 2020 2020 2020 2069 6620 6d61 736b 5f64         if mask_d
+0001f2d0: 696d 7320 3d3d 205b 302c 2030 2c20 305d  ims == [0, 0, 0]
+0001f2e0: 3a0a 2020 2020 2020 2020 2020 2020 6d61  :.            ma
+0001f2f0: 736b 203d 204d 6170 286e 702e 6f6e 6573  sk = Map(np.ones
+0001f300: 2868 616c 665f 6d61 705f 312e 6675 6c6c  (half_map_1.full
+0001f310: 4d61 702e 7368 6170 6529 2c20 6861 6c66  Map.shape), half
+0001f320: 5f6d 6170 5f31 2e6f 7269 6769 6e2c 0a20  _map_1.origin,. 
+0001f330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f340: 2020 2020 2020 6861 6c66 5f6d 6170 5f31        half_map_1
+0001f350: 2e61 7069 782c 2068 616c 665f 6d61 705f  .apix, half_map_
+0001f360: 312e 6669 6c65 6e61 6d65 290a 2020 2020  1.filename).    
+0001f370: 2020 2020 2020 2020 6d61 736b 5f64 696d          mask_dim
+0001f380: 7320 3d20 6d61 736b 2e66 756c 6c4d 6170  s = mask.fullMap
+0001f390: 2e73 6861 7065 0a20 2020 2020 2020 2065  .shape.        e
+0001f3a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+0001f3b0: 2063 656e 7472 655f 6f66 5f6d 6173 6b5f   centre_of_mask_
+0001f3c0: 6d61 7020 3d20 5b6d 6173 6b5f 6469 6d73  map = [mask_dims
+0001f3d0: 5b30 5d2f 322c 206d 6173 6b5f 6469 6d73  [0]/2, mask_dims
+0001f3e0: 5b31 5d2f 322c 0a20 2020 2020 2020 2020  [1]/2,.         
+0001f3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f400: 2020 2020 2020 2020 206d 6173 6b5f 6469           mask_di
+0001f410: 6d73 5b32 5d2f 325d 0a20 2020 2020 2020  ms[2]/2].       
+0001f420: 2020 2020 206d 6173 6b20 3d20 626c 7572       mask = blur
+0001f430: 7265 722e 6d61 6b65 5f73 7068 6572 6963  rer.make_spheric
+0001f440: 616c 5f6d 6173 6b28 7370 6865 7265 5f64  al_mask(sphere_d
+0001f450: 6961 6d65 7465 725f 7069 7865 6c73 2c0a  iameter_pixels,.
+0001f460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f480: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0001f490: 6173 6b5f 6469 6d73 2c20 6365 6e74 7265  ask_dims, centre
+0001f4a0: 5f6f 665f 6d61 736b 5f6d 6170 2c0a 2020  _of_mask_map,.  
+0001f4b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f4d0: 2020 2020 2020 2020 2020 2020 2063 6f73               cos
+0001f4e0: 5f65 6467 6529 0a0a 2020 2020 2020 2020  _edge)..        
+0001f4f0: 2320 7361 7665 2073 636f 7265 7320 666f  # save scores fo
+0001f500: 7220 6561 6368 2063 6861 696e 2061 6e64  r each chain and
+0001f510: 2072 6573 0a20 2020 2020 2020 2064 6963   res.        dic
+0001f520: 745f 7265 735f 7363 6f72 6573 203d 204f  t_res_scores = O
+0001f530: 7264 6572 6564 4469 6374 2829 0a0a 2020  rderedDict()..  
+0001f540: 2020 2020 2020 2320 7365 7420 7570 2070        # set up p
+0001f550: 7966 6674 7720 666f 7220 7665 7279 2066  yfftw for very f
+0001f560: 6173 7420 6666 7473 0a20 2020 2020 2020  ast ffts.       
+0001f570: 2069 6e70 7574 3120 3d20 7079 6666 7477   input1 = pyfftw
+0001f580: 2e65 6d70 7479 5f61 6c69 676e 6564 286d  .empty_aligned(m
+0001f590: 6173 6b5f 6469 6d73 2c20 6474 7970 653d  ask_dims, dtype=
+0001f5a0: 2766 6c6f 6174 3634 2729 0a0a 2020 2020  'float64')..    
+0001f5b0: 2020 2020 6666 7477 5f6f 626a 6563 7431      fftw_object1
+0001f5c0: 203d 2066 6f75 7269 6572 2e67 6574 5f70   = fourier.get_p
+0001f5d0: 7966 6674 775f 6f62 6a65 6374 286d 6173  yfftw_object(mas
+0001f5e0: 6b5f 6469 6d73 290a 2020 2020 2020 2020  k_dims).        
+0001f5f0: 6666 7477 5f6f 626a 6563 7432 203d 2066  fftw_object2 = f
+0001f600: 6f75 7269 6572 2e67 6574 5f70 7966 6674  ourier.get_pyfft
+0001f610: 775f 6f62 6a65 6374 286d 6173 6b5f 6469  w_object(mask_di
+0001f620: 6d73 290a 0a20 2020 2020 2020 2071 6269  ms)..        qbi
+0001f630: 6e73 2c20 6c61 6265 6c6c 6564 5f73 6865  ns, labelled_she
+0001f640: 6c6c 7320 3d20 666f 7572 6965 722e 6765  lls = fourier.ge
+0001f650: 745f 6c61 6265 6c6c 6564 5f73 6865 6c6c  t_labelled_shell
+0001f660: 7328 0a20 2020 2020 2020 2020 2020 2069  s(.            i
+0001f670: 6e70 7574 312e 7368 6170 6529 0a0a 2020  nput1.shape)..  
+0001f680: 2020 2020 2020 2320 6765 7420 636f 6f72        # get coor
+0001f690: 6469 6e61 7465 7320 7768 6572 6520 6c6f  dinates where lo
+0001f6a0: 6361 6c20 4653 4320 7368 6f75 6c64 2062  cal FSC should b
+0001f6b0: 6520 6361 6c63 756c 6174 6564 0a20 2020  e calculated.   
+0001f6c0: 2020 2020 2069 6620 7374 7275 6374 7572       if structur
+0001f6d0: 6520 6973 206e 6f74 204e 6f6e 653a 0a20  e is not None:. 
+0001f6e0: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
+0001f6f0: 696e 6174 6573 203d 2073 7472 7563 7475  inates = structu
+0001f700: 7265 2e67 6574 5f43 416f 6e6c 7928 292e  re.get_CAonly().
+0001f710: 6765 745f 6174 6f6d 5f7a 7978 5f6d 6170  get_atom_zyx_map
+0001f720: 5f69 6e64 6578 6573 280a 2020 2020 2020  _indexes(.      
+0001f730: 2020 2020 2020 2020 2020 6861 6c66 5f6d            half_m
+0001f740: 6170 5f31 290a 2020 2020 2020 2020 656c  ap_1).        el
+0001f750: 6966 2070 726f 7465 696e 5f6d 6173 6b20  if protein_mask 
+0001f760: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+0001f770: 2020 2020 2020 2020 2028 7a2c 2079 2c20           (z, y, 
+0001f780: 7829 203d 206e 702e 7768 6572 6528 7072  x) = np.where(pr
+0001f790: 6f74 6569 6e5f 6d61 736b 2e66 756c 6c4d  otein_mask.fullM
+0001f7a0: 6170 203e 2030 290a 2020 2020 2020 2020  ap > 0).        
+0001f7b0: 2020 2020 636f 6f72 6469 6e61 7465 7320      coordinates 
+0001f7c0: 3d20 6e70 2e73 7461 636b 2828 7a2c 2079  = np.stack((z, y
+0001f7d0: 2c20 7829 2c20 6178 6973 3d2d 3129 0a20  , x), axis=-1). 
+0001f7e0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001f7f0: 2020 2020 2020 2020 2028 7a2c 2079 2c20           (z, y, 
+0001f800: 7829 203d 206e 702e 7768 6572 6528 6861  x) = np.where(ha
+0001f810: 6c66 5f6d 6170 5f31 2e66 756c 6c4d 6170  lf_map_1.fullMap
+0001f820: 203c 206e 702e 696e 6629 0a20 2020 2020   < np.inf).     
+0001f830: 2020 2020 2020 2063 6f6f 7264 696e 6174         coordinat
+0001f840: 6573 203d 206e 702e 7374 6163 6b28 287a  es = np.stack((z
+0001f850: 2c20 792c 2078 292c 2061 7869 733d 2d31  , y, x), axis=-1
+0001f860: 290a 0a20 2020 2020 2020 2077 6172 6e69  )..        warni
+0001f870: 6e67 7320 3d20 5b5d 0a20 2020 2020 2020  ngs = [].       
+0001f880: 206e 203d 2030 0a0a 2020 2020 2020 2020   n = 0..        
+0001f890: 666f 7220 636f 6f72 6469 6e61 7465 2069  for coordinate i
+0001f8a0: 6e20 636f 6f72 6469 6e61 7465 733a 0a0a  n coordinates:..
+0001f8b0: 2020 2020 2020 2020 2020 2020 6372 6f70              crop
+0001f8c0: 7065 645f 6d61 705f 3120 3d20 6861 6c66  ped_map_1 = half
+0001f8d0: 5f6d 6170 5f31 2e67 6574 5f63 726f 7070  _map_1.get_cropp
+0001f8e0: 6564 5f62 6f78 280a 2020 2020 2020 2020  ed_box(.        
+0001f8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f920: 636f 6f72 6469 6e61 7465 2c0a 2020 2020  coordinate,.    
+0001f930: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f940: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f960: 2020 2020 6d61 736b 5f64 696d 732c 0a20      mask_dims,. 
+0001f970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001f9a0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001f9b0: 2020 2020 2063 726f 7070 6564 5f6d 6170       cropped_map
+0001f9c0: 5f32 203d 2068 616c 665f 6d61 705f 322e  _2 = half_map_2.
+0001f9d0: 6765 745f 6372 6f70 7065 645f 626f 7828  get_cropped_box(
+0001f9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001f9f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa10: 2020 2020 2063 6f6f 7264 696e 6174 652c       coordinate,
+0001fa20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa50: 2020 2020 206d 6173 6b5f 6469 6d73 2c0a       mask_dims,.
 0001fa60: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fa70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fa80: 2020 2020 2020 2020 2020 2063 6f6f 7264             coord
-0001fa90: 696e 6174 652c 0a20 2020 2020 2020 2020  inate,.         
-0001faa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fac0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001fad0: 6173 6b5f 6469 6d73 2c0a 2020 2020 2020  ask_dims,.      
+0001fa80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fa90: 2020 2020 290a 0a20 2020 2020 2020 2020      )..         
+0001faa0: 2020 2066 7363 203d 2066 6f75 7269 6572     fsc = fourier
+0001fab0: 2e63 616c 6375 6c61 7465 5f66 7363 5f77  .calculate_fsc_w
+0001fac0: 6974 685f 6d61 736b 280a 2020 2020 2020  ith_mask(.      
+0001fad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fae0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001faf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb10: 2020 290a 2020 2020 2020 2020 2020 2020    ).            
-0001fb20: 6372 6f70 7065 645f 6d61 705f 3220 3d20  cropped_map_2 = 
-0001fb30: 6861 6c66 5f6d 6170 5f32 2e67 6574 5f63  half_map_2.get_c
-0001fb40: 726f 7070 6564 5f62 6f78 280a 2020 2020  ropped_box(.    
+0001faf0: 2020 2020 2020 6372 6f70 7065 645f 6d61        cropped_ma
+0001fb00: 705f 312e 6675 6c6c 4d61 702c 0a20 2020  p_1.fullMap,.   
+0001fb10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fb30: 2020 2020 2020 2020 2063 726f 7070 6564           cropped
+0001fb40: 5f6d 6170 5f32 2e66 756c 6c4d 6170 2c0a  _map_2.fullMap,.
 0001fb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fb80: 636f 6f72 6469 6e61 7465 2c0a 2020 2020  coordinate,.    
+0001fb70: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
+0001fb80: 2e66 756c 6c4d 6170 2c0a 2020 2020 2020  .fullMap,.      
 0001fb90: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbc0: 6d61 736b 5f64 696d 732c 0a20 2020 2020  mask_dims,.     
+0001fbb0: 2020 2020 2020 7069 7865 6c5f 7369 7a65        pixel_size
+0001fbc0: 3d61 7069 782c 0a20 2020 2020 2020 2020  =apix,.         
 0001fbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fbe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fbf0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-0001fc00: 0a0a 2020 2020 2020 2020 2020 2020 6673  ..            fs
-0001fc10: 6320 3d20 666f 7572 6965 722e 6361 6c63  c = fourier.calc
-0001fc20: 756c 6174 655f 6673 635f 7769 7468 5f6d  ulate_fsc_with_m
-0001fc30: 6173 6b28 0a20 2020 2020 2020 2020 2020  ask(.           
-0001fc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fbf0: 2020 206c 6162 656c 6c65 645f 7368 656c     labelled_shel
+0001fc00: 6c73 3d6c 6162 656c 6c65 645f 7368 656c  ls=labelled_shel
+0001fc10: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
+0001fc20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc40: 7162 696e 733d 7162 696e 732c 0a20 2020  qbins=qbins,.   
 0001fc50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc60: 2063 726f 7070 6564 5f6d 6170 5f31 2e66   cropped_map_1.f
-0001fc70: 756c 6c4d 6170 2c0a 2020 2020 2020 2020  ullMap,.        
-0001fc80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fc90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fca0: 2020 2020 6372 6f70 7065 645f 6d61 705f      cropped_map_
-0001fcb0: 322e 6675 6c6c 4d61 702c 0a20 2020 2020  2.fullMap,.     
-0001fcc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fcd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fce0: 2020 2020 2020 206d 6173 6b2e 6675 6c6c         mask.full
-0001fcf0: 4d61 702c 0a20 2020 2020 2020 2020 2020  Map,.           
-0001fd00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd20: 2070 6978 656c 5f73 697a 653d 6170 6978   pixel_size=apix
-0001fd30: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001fd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fd50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-0001fd60: 6265 6c6c 6564 5f73 6865 6c6c 733d 6c61  belled_shells=la
-0001fd70: 6265 6c6c 6564 5f73 6865 6c6c 732c 0a20  belled_shells,. 
-0001fd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fc70: 2020 2020 2020 2020 2066 6674 775f 6f62           fftw_ob
+0001fc80: 6a65 6374 313d 6666 7477 5f6f 626a 6563  ject1=fftw_objec
+0001fc90: 7431 2c0a 2020 2020 2020 2020 2020 2020  t1,.            
+0001fca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcc0: 6666 7477 5f6f 626a 6563 7432 3d66 6674  fftw_object2=fft
+0001fcd0: 775f 6f62 6a65 6374 322c 0a20 2020 2020  w_object2,.     
+0001fce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fcf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fd00: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0001fd10: 2020 2020 2020 2320 6669 6e64 2068 6967        # find hig
+0001fd20: 6865 7374 2066 7265 7175 656e 6379 2073  hest frequency s
+0001fd30: 6865 6c6c 2077 6974 6820 302e 3520 636f  hell with 0.5 co
+0001fd40: 7272 656c 6174 696f 6e0a 2020 2020 2020  rrelation.      
+0001fd50: 2020 2020 2020 6672 6571 5f61 745f 636f        freq_at_co
+0001fd60: 7272 5f63 7574 6f66 6620 3d20 666f 7572  rr_cutoff = four
+0001fd70: 6965 722e 6765 745f 6673 635f 7265 736f  ier.get_fsc_reso
+0001fd80: 6c75 7469 6f6e 280a 2020 2020 2020 2020  lution(.        
 0001fd90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fda0: 2020 2020 2020 2020 2020 2071 6269 6e73             qbins
-0001fdb0: 3d71 6269 6e73 2c0a 2020 2020 2020 2020  =qbins,.        
+0001fda0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fdb0: 2020 2020 6673 632c 0a20 2020 2020 2020      fsc,.       
 0001fdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fde0: 2020 2020 6666 7477 5f6f 626a 6563 7431      fftw_object1
-0001fdf0: 3d66 6674 775f 6f62 6a65 6374 312c 0a20  =fftw_object1,. 
-0001fe00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001fde0: 2020 2020 2066 7363 5f74 6872 6573 686f       fsc_thresho
+0001fdf0: 6c64 3d66 7363 5f74 6872 6573 686f 6c64  ld=fsc_threshold
+0001fe00: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
 0001fe10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe20: 2020 2020 2020 2020 2020 2066 6674 775f             fftw_
-0001fe30: 6f62 6a65 6374 323d 6666 7477 5f6f 626a  object2=fftw_obj
-0001fe40: 6563 7432 2c0a 2020 2020 2020 2020 2020  ect2,.          
+0001fe20: 2020 2020 2020 2020 2020 2020 2020 696e                in
+0001fe30: 7465 7270 6f6c 6174 655f 6375 746f 6666  terpolate_cutoff
+0001fe40: 3d46 616c 7365 2c0a 2020 2020 2020 2020  =False,.        
 0001fe50: 2020 2020 2020 2020 2020 2020 2020 2020                  
 0001fe60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001fe70: 2020 290a 0a20 2020 2020 2020 2020 2020    )..           
-0001fe80: 2023 2066 696e 6420 6869 6768 6573 7420   # find highest 
-0001fe90: 6672 6571 7565 6e63 7920 7368 656c 6c20  frequency shell 
-0001fea0: 7769 7468 2030 2e35 2063 6f72 7265 6c61  with 0.5 correla
-0001feb0: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-0001fec0: 2066 7265 715f 6174 5f63 6f72 725f 6375   freq_at_corr_cu
-0001fed0: 746f 6666 203d 2066 6f75 7269 6572 2e67  toff = fourier.g
-0001fee0: 6574 5f66 7363 5f72 6573 6f6c 7574 696f  et_fsc_resolutio
-0001fef0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
-0001ff00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff10: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0001ff20: 7363 2c0a 2020 2020 2020 2020 2020 2020  sc,.            
-0001ff30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff50: 6673 635f 7468 7265 7368 6f6c 643d 6673  fsc_threshold=fs
-0001ff60: 635f 7468 7265 7368 6f6c 642c 0a20 2020  c_threshold,.   
-0001ff70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ff90: 2020 2020 2020 2020 2069 6e74 6572 706f           interpo
-0001ffa0: 6c61 7465 5f63 7574 6f66 663d 4661 6c73  late_cutoff=Fals
-0001ffb0: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
-0001ffc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ffd0: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-0001ffe0: 7365 5f68 6967 6865 7374 5f72 6573 6f6c  se_highest_resol
-0001fff0: 7574 696f 6e3d 5472 7565 2c0a 2020 2020  ution=True,.    
-00020000: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020020: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
-00020030: 2020 2020 2020 2023 2046 5343 2063 616e         # FSC can
-00020040: 2067 6f20 6265 6c6f 7720 6e79 7175 6973   go below nyquis
-00020050: 7420 6672 6571 7565 6e63 7920 7768 656e  t frequency when
-00020060: 2073 6865 6c6c 7320 6e65 7665 7220 6472   shells never dr
-00020070: 6f70 0a20 2020 2020 2020 2020 2020 2023  op.            #
-00020080: 2062 656c 6f77 2030 2e35 2063 6f72 7265   below 0.5 corre
-00020090: 6c61 7469 6f6e 2061 6e64 2066 7265 715f  lation and freq_
-000200a0: 6174 5f63 6f72 725f 6375 746f 6666 2073  at_corr_cutoff s
-000200b0: 7469 6c6c 2065 7175 616c 7320 300a 2020  till equals 0.  
-000200c0: 2020 2020 2020 2020 2020 6966 2066 7265            if fre
-000200d0: 715f 6174 5f63 6f72 725f 6375 746f 6666  q_at_corr_cutoff
-000200e0: 203c 206d 696e 2868 616c 665f 6d61 705f   < min(half_map_
-000200f0: 312e 6170 6978 2920 2a20 323a 0a20 2020  1.apix) * 2:.   
-00020100: 2020 2020 2020 2020 2020 2020 2066 7265               fre
-00020110: 715f 6174 5f63 6f72 725f 6375 746f 6666  q_at_corr_cutoff
-00020120: 203d 206d 696e 2868 616c 665f 6d61 705f   = min(half_map_
-00020130: 312e 6170 6978 2920 2a20 320a 2020 2020  1.apix) * 2.    
-00020140: 2020 2020 2020 2020 2020 2020 7761 726e              warn
-00020150: 696e 6773 2e61 7070 656e 6428 6622 5761  ings.append(f"Wa
-00020160: 726e 696e 673a 2046 5343 2061 7420 636f  rning: FSC at co
-00020170: 6f72 6469 6e61 7465 207b 636f 6f72 6469  ordinate {coordi
-00020180: 6e61 7465 7d22 0a20 2020 2020 2020 2020  nate}".         
-00020190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201a0: 2020 2020 2020 2066 2220 6e65 7665 7220         f" never 
-000201b0: 6661 6c6c 7320 6265 6c6f 7720 302e 352e  falls below 0.5.
-000201c0: 2053 4c52 5320 220a 2020 2020 2020 2020   SLRS ".        
-000201d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000201e0: 2020 2020 2020 2020 6622 7363 6f72 6520          f"score 
-000201f0: 666f 7220 7468 6973 2072 6573 6964 7565  for this residue
-00020200: 2073 6574 2074 6f20 220a 2020 2020 2020   set to ".      
-00020210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020220: 2020 2020 2020 2020 2020 6622 7b66 7265            f"{fre
-00020230: 715f 6174 5f63 6f72 725f 6375 746f 6666  q_at_corr_cutoff
-00020240: 7d2e 2054 6869 7320 6973 204e 4f54 2022  }. This is NOT "
-00020250: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020270: 2066 2265 7870 6563 7465 6420 616e 6420   f"expected and 
-00020280: 4e4f 5420 616e 2069 6e64 6963 6174 696f  NOT an indicatio
-00020290: 6e20 6f66 2061 2067 6f6f 6420 220a 2020  n of a good ".  
-000202a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000202b0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-000202c0: 6669 7420 6265 7477 6565 6e20 6d61 7020  fit between map 
-000202d0: 616e 6420 6d6f 6465 6c2e 2229 0a0a 2020  and model.")..  
-000202e0: 2020 2020 2020 2020 2020 6469 6374 5f72            dict_r
-000202f0: 6573 5f73 636f 7265 735b 7475 706c 6528  es_scores[tuple(
-00020300: 636f 6f72 6469 6e61 7465 295d 203d 2066  coordinate)] = f
-00020310: 7265 715f 6174 5f63 6f72 725f 6375 746f  req_at_corr_cuto
-00020320: 6666 0a0a 2020 2020 2020 2020 2020 2020  ff..            
-00020330: 6e20 2b3d 2031 0a20 2020 2020 2020 2020  n += 1.         
-00020340: 2020 2069 6620 7665 7262 6f73 653a 0a20     if verbose:. 
-00020350: 2020 2020 2020 2020 2020 2020 2020 207a                 z
-00020360: 6669 6c6c 5f6c 656e 203d 206c 656e 2873  fill_len = len(s
-00020370: 7472 286c 656e 2863 6f6f 7264 696e 6174  tr(len(coordinat
-00020380: 6573 2929 290a 2020 2020 2020 2020 2020  es))).          
-00020390: 2020 2020 2020 7072 696e 7428 6622 5c72        print(f"\r
-000203a0: 5072 6f63 6573 7365 6420 7265 7369 6475  Processed residu
-000203b0: 6520 7b73 7472 286e 292e 7a66 696c 6c28  e {str(n).zfill(
-000203c0: 7a66 696c 6c5f 6c65 6e29 7d22 0a20 2020  zfill_len)}".   
-000203d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000203e0: 2020 2066 222f 7b6c 656e 2863 6f6f 7264     f"/{len(coord
-000203f0: 696e 6174 6573 297d 222c 2073 6570 3d27  inates)}", sep='
-00020400: 272c 2065 6e64 3d27 272c 2066 6c75 7368  ', end='', flush
-00020410: 3d54 7275 6529 0a0a 2020 2020 2020 2020  =True)..        
-00020420: 6966 2076 6572 626f 7365 3a0a 2020 2020  if verbose:.    
-00020430: 2020 2020 2020 2020 7072 696e 7428 2222          print(""
-00020440: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00020450: 7220 7761 726e 696e 6720 696e 2077 6172  r warning in war
-00020460: 6e69 6e67 733a 0a20 2020 2020 2020 2020  nings:.         
-00020470: 2020 2020 2020 2070 7269 6e74 2877 6172         print(war
-00020480: 6e69 6e67 290a 0a20 2020 2020 2020 2072  ning)..        r
-00020490: 6574 7572 6e20 6469 6374 5f72 6573 5f73  eturn dict_res_s
-000204a0: 636f 7265 730a 0a20 2020 2064 6566 206d  cores..    def m
-000204b0: 6170 5f72 6573 6f6c 7574 696f 6e5f 4653  ap_resolution_FS
-000204c0: 4328 7365 6c66 2c20 6861 6c66 5f6d 6170  C(self, half_map
-000204d0: 312c 2068 616c 665f 6d61 7032 2c20 6d61  1, half_map2, ma
-000204e0: 736b 3d4e 6f6e 652c 0a20 2020 2020 2020  sk=None,.       
-000204f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020500: 2020 2020 6673 635f 7468 7265 7368 6f6c      fsc_threshol
-00020510: 643d 302e 3134 332c 2075 7365 5f68 6967  d=0.143, use_hig
-00020520: 6865 7374 5f72 6573 6f6c 7574 696f 6e3d  hest_resolution=
-00020530: 5472 7565 293a 0a20 2020 2020 2020 2022  True):.        "
-00020540: 2222 4361 6c63 756c 6174 6520 7468 6520  ""Calculate the 
-00020550: 6d61 7020 7265 736f 6c75 7469 6f6e 2066  map resolution f
-00020560: 726f 6d20 7477 6f20 6861 6c66 2d6d 6170  rom two half-map
-00020570: 7320 7573 696e 6720 7468 650a 2020 2020  s using the.    
-00020580: 2020 2020 466f 7572 6965 7220 5368 656c      Fourier Shel
-00020590: 6c20 436f 7272 656c 6174 696f 6e2e 0a0a  l Correlation...
-000205a0: 2020 2020 2020 2020 4172 6775 6d65 6e74          Argument
-000205b0: 733a 0a20 2020 2020 2020 2020 2020 2068  s:.            h
-000205c0: 616c 665f 6d61 7031 3a20 4d61 7020 696e  alf_map1: Map in
-000205d0: 7374 616e 6365 206f 6620 6669 7273 7420  stance of first 
-000205e0: 6861 6c66 206d 6170 0a20 2020 2020 2020  half map.       
-000205f0: 2020 2020 2068 616c 665f 6d61 7032 3a20       half_map2: 
-00020600: 4d61 7020 696e 7374 616e 6365 206f 6620  Map instance of 
-00020610: 7365 636f 6e64 2068 616c 6620 6d61 700a  second half map.
-00020620: 2020 2020 2020 2020 2020 2020 6d61 736b              mask
-00020630: 3a20 4120 4d61 7020 696e 7374 616e 6365  : A Map instance
-00020640: 206f 6620 6120 736f 6674 2065 6467 6564   of a soft edged
-00020650: 206d 6173 6b0a 2020 2020 2020 2020 2020   mask.          
-00020660: 2020 6673 635f 7468 7265 7368 6f6c 643a    fsc_threshold:
-00020670: 2043 6f72 7265 6c61 7469 6f6e 2074 6872   Correlation thr
-00020680: 6573 686f 6c64 2076 616c 7565 2074 6861  eshold value tha
-00020690: 7420 6465 6669 6e65 730a 2020 2020 2020  t defines.      
-000206a0: 2020 2020 2020 2020 2020 686f 7720 7468            how th
-000206b0: 6520 6d61 7020 7265 736f 6c75 7469 6f6e  e map resolution
-000206c0: 2069 7320 666f 756e 642e 0a20 2020 2020   is found..     
-000206d0: 2020 2020 2020 2075 7365 5f68 6967 6865         use_highe
-000206e0: 7374 5f72 6573 6f6c 7574 696f 6e3a 2049  st_resolution: I
-000206f0: 6620 5472 7565 2c20 7461 6b65 7320 7468  f True, takes th
-00020700: 6520 6869 6768 6573 740a 2020 2020 2020  e highest.      
-00020710: 2020 2020 2020 2020 2020 7265 736f 6c75            resolu
-00020720: 7469 6f6e 2073 6865 6c6c 2074 6861 7420  tion shell that 
-00020730: 6372 6f73 7365 7320 7468 6520 6673 635f  crosses the fsc_
-00020740: 7468 7265 7368 6f6c 642c 2069 660a 2020  threshold, if.  
-00020750: 2020 2020 2020 2020 2020 2020 2020 7468                th
-00020760: 6572 6520 6172 6520 6d75 6c74 6970 6c65  ere are multiple
-00020770: 2063 726f 7373 6f76 6572 732e 0a0a 2020   crossovers...  
-00020780: 2020 2020 2020 5265 7475 726e 733a 0a20        Returns:. 
-00020790: 2020 2020 2020 2020 2020 2054 6865 2046             The F
-000207a0: 5343 2072 6573 6f6c 7574 696f 6e20 2869  SC resolution (i
-000207b0: 6e20 616e 6773 7472 6f6d 7329 2e0a 0a20  n angstroms)... 
-000207c0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000207d0: 2020 2069 6620 6d61 736b 2069 7320 6e6f     if mask is no
-000207e0: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-000207f0: 2020 2020 6673 6320 3d20 666f 7572 6965      fsc = fourie
-00020800: 722e 6361 6c63 756c 6174 655f 6673 635f  r.calculate_fsc_
-00020810: 7769 7468 5f6d 6173 6b28 0a20 2020 2020  with_mask(.     
+0001fe70: 2020 2020 7573 655f 6869 6768 6573 745f      use_highest_
+0001fe80: 7265 736f 6c75 7469 6f6e 3d54 7275 652c  resolution=True,
+0001fe90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001fea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001feb0: 2020 2020 2020 2020 2020 2020 2029 0a0a               )..
+0001fec0: 2020 2020 2020 2020 2020 2020 2320 4653              # FS
+0001fed0: 4320 6361 6e20 676f 2062 656c 6f77 206e  C can go below n
+0001fee0: 7971 7569 7374 2066 7265 7175 656e 6379  yquist frequency
+0001fef0: 2077 6865 6e20 7368 656c 6c73 206e 6576   when shells nev
+0001ff00: 6572 2064 726f 700a 2020 2020 2020 2020  er drop.        
+0001ff10: 2020 2020 2320 6265 6c6f 7720 302e 3520      # below 0.5 
+0001ff20: 636f 7272 656c 6174 696f 6e20 616e 6420  correlation and 
+0001ff30: 6672 6571 5f61 745f 636f 7272 5f63 7574  freq_at_corr_cut
+0001ff40: 6f66 6620 7374 696c 6c20 6571 7561 6c73  off still equals
+0001ff50: 2030 0a20 2020 2020 2020 2020 2020 2069   0.            i
+0001ff60: 6620 6672 6571 5f61 745f 636f 7272 5f63  f freq_at_corr_c
+0001ff70: 7574 6f66 6620 3c20 6d69 6e28 6861 6c66  utoff < min(half
+0001ff80: 5f6d 6170 5f31 2e61 7069 7829 202a 2032  _map_1.apix) * 2
+0001ff90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001ffa0: 2020 6672 6571 5f61 745f 636f 7272 5f63    freq_at_corr_c
+0001ffb0: 7574 6f66 6620 3d20 6d69 6e28 6861 6c66  utoff = min(half
+0001ffc0: 5f6d 6170 5f31 2e61 7069 7829 202a 2032  _map_1.apix) * 2
+0001ffd0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001ffe0: 2077 6172 6e69 6e67 732e 6170 7065 6e64   warnings.append
+0001fff0: 2866 2257 6172 6e69 6e67 3a20 4653 4320  (f"Warning: FSC 
+00020000: 6174 2063 6f6f 7264 696e 6174 6520 7b63  at coordinate {c
+00020010: 6f6f 7264 696e 6174 657d 220a 2020 2020  oordinate}".    
+00020020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020030: 2020 2020 2020 2020 2020 2020 6622 206e              f" n
+00020040: 6576 6572 2066 616c 6c73 2062 656c 6f77  ever falls below
+00020050: 2030 2e35 2e20 534c 5253 2022 0a20 2020   0.5. SLRS ".   
+00020060: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020070: 2020 2020 2020 2020 2020 2020 2066 2273               f"s
+00020080: 636f 7265 2066 6f72 2074 6869 7320 7265  core for this re
+00020090: 7369 6475 6520 7365 7420 746f 2022 0a20  sidue set to ". 
+000200a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000200b0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+000200c0: 227b 6672 6571 5f61 745f 636f 7272 5f63  "{freq_at_corr_c
+000200d0: 7574 6f66 667d 2e20 5468 6973 2069 7320  utoff}. This is 
+000200e0: 4e4f 5420 220a 2020 2020 2020 2020 2020  NOT ".          
+000200f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020100: 2020 2020 2020 6622 6578 7065 6374 6564        f"expected
+00020110: 2061 6e64 204e 4f54 2061 6e20 696e 6469   and NOT an indi
+00020120: 6361 7469 6f6e 206f 6620 6120 676f 6f64  cation of a good
+00020130: 2022 0a20 2020 2020 2020 2020 2020 2020   ".             
+00020140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020150: 2020 2066 2266 6974 2062 6574 7765 656e     f"fit between
+00020160: 206d 6170 2061 6e64 206d 6f64 656c 2e22   map and model."
+00020170: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
+00020180: 6963 745f 7265 735f 7363 6f72 6573 5b74  ict_res_scores[t
+00020190: 7570 6c65 2863 6f6f 7264 696e 6174 6529  uple(coordinate)
+000201a0: 5d20 3d20 6672 6571 5f61 745f 636f 7272  ] = freq_at_corr
+000201b0: 5f63 7574 6f66 660a 0a20 2020 2020 2020  _cutoff..       
+000201c0: 2020 2020 206e 202b 3d20 310a 2020 2020       n += 1.    
+000201d0: 2020 2020 2020 2020 6966 2076 6572 626f          if verbo
+000201e0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+000201f0: 2020 2020 7a66 696c 6c5f 6c65 6e20 3d20      zfill_len = 
+00020200: 6c65 6e28 7374 7228 6c65 6e28 636f 6f72  len(str(len(coor
+00020210: 6469 6e61 7465 7329 2929 0a20 2020 2020  dinates))).     
+00020220: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+00020230: 2866 225c 7250 726f 6365 7373 6564 2072  (f"\rProcessed r
+00020240: 6573 6964 7565 207b 7374 7228 6e29 2e7a  esidue {str(n).z
+00020250: 6669 6c6c 287a 6669 6c6c 5f6c 656e 297d  fill(zfill_len)}
+00020260: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
+00020270: 2020 2020 2020 2020 6622 2f7b 6c65 6e28          f"/{len(
+00020280: 636f 6f72 6469 6e61 7465 7329 7d22 2c20  coordinates)}", 
+00020290: 7365 703d 2727 2c20 656e 643d 2727 2c20  sep='', end='', 
+000202a0: 666c 7573 683d 5472 7565 290a 0a20 2020  flush=True)..   
+000202b0: 2020 2020 2069 6620 7665 7262 6f73 653a       if verbose:
+000202c0: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
+000202d0: 6e74 2822 2229 0a20 2020 2020 2020 2020  nt("").         
+000202e0: 2020 2066 6f72 2077 6172 6e69 6e67 2069     for warning i
+000202f0: 6e20 7761 726e 696e 6773 3a0a 2020 2020  n warnings:.    
+00020300: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00020310: 7428 7761 726e 696e 6729 0a0a 2020 2020  t(warning)..    
+00020320: 2020 2020 7265 7475 726e 2064 6963 745f      return dict_
+00020330: 7265 735f 7363 6f72 6573 0a0a 2020 2020  res_scores..    
+00020340: 6465 6620 6d61 705f 7265 736f 6c75 7469  def map_resoluti
+00020350: 6f6e 5f46 5343 2873 656c 662c 2068 616c  on_FSC(self, hal
+00020360: 665f 6d61 7031 2c20 6861 6c66 5f6d 6170  f_map1, half_map
+00020370: 322c 206d 6173 6b3d 4e6f 6e65 2c0a 2020  2, mask=None,.  
+00020380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020390: 2020 2020 2020 2020 2066 7363 5f74 6872           fsc_thr
+000203a0: 6573 686f 6c64 3d30 2e31 3433 2c20 7573  eshold=0.143, us
+000203b0: 655f 6869 6768 6573 745f 7265 736f 6c75  e_highest_resolu
+000203c0: 7469 6f6e 3d54 7275 6529 3a0a 2020 2020  tion=True):.    
+000203d0: 2020 2020 2222 2243 616c 6375 6c61 7465      """Calculate
+000203e0: 2074 6865 206d 6170 2072 6573 6f6c 7574   the map resolut
+000203f0: 696f 6e20 6672 6f6d 2074 776f 2068 616c  ion from two hal
+00020400: 662d 6d61 7073 2075 7369 6e67 2074 6865  f-maps using the
+00020410: 0a20 2020 2020 2020 2046 6f75 7269 6572  .        Fourier
+00020420: 2053 6865 6c6c 2043 6f72 7265 6c61 7469   Shell Correlati
+00020430: 6f6e 2e0a 0a20 2020 2020 2020 2041 7267  on...        Arg
+00020440: 756d 656e 7473 3a0a 2020 2020 2020 2020  uments:.        
+00020450: 2020 2020 6861 6c66 5f6d 6170 313a 204d      half_map1: M
+00020460: 6170 2069 6e73 7461 6e63 6520 6f66 2066  ap instance of f
+00020470: 6972 7374 2068 616c 6620 6d61 700a 2020  irst half map.  
+00020480: 2020 2020 2020 2020 2020 6861 6c66 5f6d            half_m
+00020490: 6170 323a 204d 6170 2069 6e73 7461 6e63  ap2: Map instanc
+000204a0: 6520 6f66 2073 6563 6f6e 6420 6861 6c66  e of second half
+000204b0: 206d 6170 0a20 2020 2020 2020 2020 2020   map.           
+000204c0: 206d 6173 6b3a 2041 204d 6170 2069 6e73   mask: A Map ins
+000204d0: 7461 6e63 6520 6f66 2061 2073 6f66 7420  tance of a soft 
+000204e0: 6564 6765 6420 6d61 736b 0a20 2020 2020  edged mask.     
+000204f0: 2020 2020 2020 2066 7363 5f74 6872 6573         fsc_thres
+00020500: 686f 6c64 3a20 436f 7272 656c 6174 696f  hold: Correlatio
+00020510: 6e20 7468 7265 7368 6f6c 6420 7661 6c75  n threshold valu
+00020520: 6520 7468 6174 2064 6566 696e 6573 0a20  e that defines. 
+00020530: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00020540: 6f77 2074 6865 206d 6170 2072 6573 6f6c  ow the map resol
+00020550: 7574 696f 6e20 6973 2066 6f75 6e64 2e0a  ution is found..
+00020560: 2020 2020 2020 2020 2020 2020 7573 655f              use_
+00020570: 6869 6768 6573 745f 7265 736f 6c75 7469  highest_resoluti
+00020580: 6f6e 3a20 4966 2054 7275 652c 2074 616b  on: If True, tak
+00020590: 6573 2074 6865 2068 6967 6865 7374 0a20  es the highest. 
+000205a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000205b0: 6573 6f6c 7574 696f 6e20 7368 656c 6c20  esolution shell 
+000205c0: 7468 6174 2063 726f 7373 6573 2074 6865  that crosses the
+000205d0: 2066 7363 5f74 6872 6573 686f 6c64 2c20   fsc_threshold, 
+000205e0: 6966 0a20 2020 2020 2020 2020 2020 2020  if.             
+000205f0: 2020 2074 6865 7265 2061 7265 206d 756c     there are mul
+00020600: 7469 706c 6520 6372 6f73 736f 7665 7273  tiple crossovers
+00020610: 2e0a 0a20 2020 2020 2020 2052 6574 7572  ...        Retur
+00020620: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
+00020630: 5468 6520 4653 4320 7265 736f 6c75 7469  The FSC resoluti
+00020640: 6f6e 2028 696e 2061 6e67 7374 726f 6d73  on (in angstroms
+00020650: 292e 0a0a 2020 2020 2020 2020 2222 220a  )...        """.
+00020660: 2020 2020 2020 2020 6966 206d 6173 6b20          if mask 
+00020670: 6973 206e 6f74 204e 6f6e 653a 0a20 2020  is not None:.   
+00020680: 2020 2020 2020 2020 2066 7363 203d 2066           fsc = f
+00020690: 6f75 7269 6572 2e63 616c 6375 6c61 7465  ourier.calculate
+000206a0: 5f66 7363 5f77 6974 685f 6d61 736b 280a  _fsc_with_mask(.
+000206b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000206e0: 6861 6c66 5f6d 6170 312e 6675 6c6c 4d61  half_map1.fullMa
+000206f0: 702c 0a20 2020 2020 2020 2020 2020 2020  p,.             
+00020700: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020720: 2020 2068 616c 665f 6d61 7032 2e66 756c     half_map2.ful
+00020730: 6c4d 6170 2c0a 2020 2020 2020 2020 2020  lMap,.          
+00020740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020750: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020760: 2020 2020 2020 6d61 736b 2e66 756c 6c4d        mask.fullM
+00020770: 6170 2c0a 2020 2020 2020 2020 2020 2020  ap,.            
+00020780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000207a0: 2020 2020 7069 7865 6c5f 7369 7a65 3d68      pixel_size=h
+000207b0: 616c 665f 6d61 7031 2e61 7069 785b 305d  alf_map1.apix[0]
+000207c0: 2c29 0a20 2020 2020 2020 2065 6c73 653a  ,).        else:
+000207d0: 0a20 2020 2020 2020 2020 2020 2066 7363  .            fsc
+000207e0: 203d 2066 6f75 7269 6572 2e63 616c 6375   = fourier.calcu
+000207f0: 6c61 7465 5f66 7363 2868 616c 665f 6d61  late_fsc(half_ma
+00020800: 7031 2e66 756c 6c4d 6170 2c0a 2020 2020  p1.fullMap,.    
+00020810: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00020820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020830: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020840: 2020 2020 2020 2020 2020 2068 616c 665f             half_
-00020850: 6d61 7031 2e66 756c 6c4d 6170 2c0a 2020  map1.fullMap,.  
-00020860: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020880: 2020 2020 2020 2020 2020 2020 2020 6861                ha
-00020890: 6c66 5f6d 6170 322e 6675 6c6c 4d61 702c  lf_map2.fullMap,
-000208a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000208b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208d0: 206d 6173 6b2e 6675 6c6c 4d61 702c 0a20   mask.fullMap,. 
-000208e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000208f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020900: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00020910: 6978 656c 5f73 697a 653d 6861 6c66 5f6d  ixel_size=half_m
-00020920: 6170 312e 6170 6978 5b30 5d2c 290a 2020  ap1.apix[0],).  
-00020930: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00020940: 2020 2020 2020 2020 6673 6320 3d20 666f          fsc = fo
-00020950: 7572 6965 722e 6361 6c63 756c 6174 655f  urier.calculate_
-00020960: 6673 6328 6861 6c66 5f6d 6170 312e 6675  fsc(half_map1.fu
-00020970: 6c6c 4d61 702c 0a20 2020 2020 2020 2020  llMap,.         
-00020980: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020990: 2020 2020 2020 2020 2020 2020 2020 2068                 h
-000209a0: 616c 665f 6d61 7032 2e66 756c 6c4d 6170  alf_map2.fullMap
-000209b0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-000209c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000209d0: 2020 2020 2020 2020 2020 7069 7865 6c5f            pixel_
-000209e0: 7369 7a65 3d68 616c 665f 6d61 7031 2e61  size=half_map1.a
-000209f0: 7069 785b 305d 2c29 0a0a 2020 2020 2020  pix[0],)..      
-00020a00: 2020 7265 736f 6c75 7469 6f6e 203d 2066    resolution = f
-00020a10: 6f75 7269 6572 2e67 6574 5f66 7363 5f72  ourier.get_fsc_r
-00020a20: 6573 6f6c 7574 696f 6e28 0a20 2020 2020  esolution(.     
-00020a30: 2020 2020 2020 2066 7363 2c20 6673 635f         fsc, fsc_
-00020a40: 7468 7265 7368 6f6c 643d 6673 635f 7468  threshold=fsc_th
-00020a50: 7265 7368 6f6c 642c 0a20 2020 2020 2020  reshold,.       
-00020a60: 2020 2020 2075 7365 5f68 6967 6865 7374       use_highest
-00020a70: 5f72 6573 6f6c 7574 696f 6e3d 7573 655f  _resolution=use_
-00020a80: 6869 6768 6573 745f 7265 736f 6c75 7469  highest_resoluti
-00020a90: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-00020aa0: 696e 7465 7270 6f6c 6174 655f 6375 746f  interpolate_cuto
-00020ab0: 6666 3d46 616c 7365 290a 0a20 2020 2020  ff=False)..     
-00020ac0: 2020 2072 6574 7572 6e20 7265 736f 6c75     return resolu
-00020ad0: 7469 6f6e 0a0a 0a63 6c61 7373 2053 6c69  tion...class Sli
-00020ae0: 6469 6e67 5265 7369 6475 6557 696e 646f  dingResidueWindo
-00020af0: 773a 0a20 2020 2064 6566 205f 5f69 6e69  w:.    def __ini
-00020b00: 745f 5f28 7365 6c66 2c20 6163 6375 6d75  t__(self, accumu
-00020b10: 6c61 746f 7229 3a0a 2020 2020 2020 2020  lator):.        
-00020b20: 7365 6c66 2e61 6363 756d 756c 6174 6f72  self.accumulator
-00020b30: 203d 2061 6363 756d 756c 6174 6f72 0a0a   = accumulator..
-00020b40: 2020 2020 6465 6620 7363 6f72 6573 2873      def scores(s
-00020b50: 656c 662c 2072 6573 6964 7565 5f61 746f  elf, residue_ato
-00020b60: 6d73 5f6c 6973 742c 2073 697a 6529 3a0a  ms_list, size):.
-00020b70: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
-00020b80: 756d 756c 6174 6f72 2e7a 6572 6f28 290a  umulator.zero().
-00020b90: 0a20 2020 2020 2020 2068 616c 665f 7769  .        half_wi
-00020ba0: 6e64 6f77 203d 2069 6e74 2828 7369 7a65  ndow = int((size
-00020bb0: 202d 2031 2920 2f20 3229 0a0a 2020 2020   - 1) / 2)..    
-00020bc0: 2020 2020 7363 6f72 6573 203d 205b 5d0a      scores = [].
-00020bd0: 2020 2020 2020 2020 666f 7220 6865 6164          for head
-00020be0: 2069 6e20 7261 6e67 6528 302c 206c 656e   in range(0, len
-00020bf0: 2872 6573 6964 7565 5f61 746f 6d73 5f6c  (residue_atoms_l
-00020c00: 6973 7429 202b 2068 616c 665f 7769 6e64  ist) + half_wind
-00020c10: 6f77 293a 0a20 2020 2020 2020 2020 2020  ow):.           
-00020c20: 2074 6169 6c20 3d20 6865 6164 202d 2073   tail = head - s
-00020c30: 697a 650a 0a20 2020 2020 2020 2020 2020  ize..           
-00020c40: 2023 2057 6869 6c65 2074 6865 2068 6561   # While the hea
-00020c50: 6420 6973 2077 6974 6820 696e 2074 6865  d is with in the
-00020c60: 2061 6c6c 6f77 6564 2072 616e 6765 2c20   allowed range, 
-00020c70: 7573 6520 616c 6c20 7468 6520 766f 7865  use all the voxe
-00020c80: 6c73 0a20 2020 2020 2020 2020 2020 2023  ls.            #
-00020c90: 2061 7373 6f63 6961 7465 6420 7769 7468   associated with
-00020ca0: 2074 6865 2072 6573 6964 7565 7320 6174   the residues at
-00020cb0: 6f6d 732e 0a20 2020 2020 2020 2020 2020  oms..           
-00020cc0: 2069 6620 6865 6164 203c 206c 656e 2872   if head < len(r
-00020cd0: 6573 6964 7565 5f61 746f 6d73 5f6c 6973  esidue_atoms_lis
-00020ce0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00020cf0: 2020 2020 666f 7220 6174 6f6d 2069 6e20      for atom in 
-00020d00: 7265 7369 6475 655f 6174 6f6d 735f 6c69  residue_atoms_li
-00020d10: 7374 5b68 6561 645d 3a0a 2020 2020 2020  st[head]:.      
-00020d20: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00020d30: 6c66 2e61 6363 756d 756c 6174 6f72 2e61  lf.accumulator.a
-00020d40: 6464 5f61 746f 6d28 6174 6f6d 290a 0a20  dd_atom(atom).. 
-00020d50: 2020 2020 2020 2020 2020 2023 2044 726f             # Dro
-00020d60: 7020 7468 6520 7461 696c 2069 6620 6974  p the tail if it
-00020d70: 2077 6974 6869 6e20 7468 6520 7261 6e67   within the rang
-00020d80: 6520 6f66 2072 6573 6964 7565 732e 0a20  e of residues.. 
-00020d90: 2020 2020 2020 2020 2020 2069 6620 7461             if ta
-00020da0: 696c 203e 3d20 303a 0a20 2020 2020 2020  il >= 0:.       
-00020db0: 2020 2020 2020 2020 2066 6f72 2061 746f           for ato
-00020dc0: 6d20 696e 2072 6573 6964 7565 5f61 746f  m in residue_ato
-00020dd0: 6d73 5f6c 6973 745b 7461 696c 5d3a 0a20  ms_list[tail]:. 
-00020de0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00020df0: 2020 2073 656c 662e 6163 6375 6d75 6c61     self.accumula
-00020e00: 746f 722e 6465 6c5f 6174 6f6d 2861 746f  tor.del_atom(ato
-00020e10: 6d29 0a0a 2020 2020 2020 2020 2020 2020  m)..            
-00020e20: 2320 4578 7472 6163 7420 7468 6520 534d  # Extract the SM
-00020e30: 4f43 2073 636f 7265 0a20 2020 2020 2020  OC score.       
-00020e40: 2020 2020 2069 6620 6865 6164 202d 2068       if head - h
-00020e50: 616c 665f 7769 6e64 6f77 203e 3d20 303a  alf_window >= 0:
-00020e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00020e70: 2073 636f 7265 732e 6170 7065 6e64 2873   scores.append(s
-00020e80: 656c 662e 6163 6375 6d75 6c61 746f 722e  elf.accumulator.
-00020e90: 6765 745f 7661 6c28 2929 0a0a 2020 2020  get_val())..    
-00020ea0: 2020 2020 7265 7475 726e 2073 636f 7265      return score
-00020eb0: 730a 0a0a 636c 6173 7320 5f41 6273 7472  s...class _Abstr
-00020ec0: 6163 7453 6c69 6469 6e67 5363 6f72 653a  actSlidingScore:
-00020ed0: 0a20 2020 2064 6566 205f 5f69 6e69 745f  .    def __init_
-00020ee0: 5f28 7365 6c66 2c20 7374 7275 6374 2c20  _(self, struct, 
-00020ef0: 6163 6375 6d75 6c61 746f 7229 3a0a 2020  accumulator):.  
-00020f00: 2020 2020 2020 6d61 7070 696e 6720 3d20        mapping = 
-00020f10: 7b7d 0a20 2020 2020 2020 2066 6f72 2061  {}.        for a
-00020f20: 2069 6e20 7374 7275 6374 2e61 746f 6d4c   in struct.atomL
-00020f30: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
-00020f40: 2069 6620 6d61 7070 696e 672e 6765 7428   if mapping.get(
-00020f50: 612e 6368 6169 6e29 2069 7320 4e6f 6e65  a.chain) is None
-00020f60: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00020f70: 2020 6d61 7070 696e 675b 612e 6368 6169    mapping[a.chai
-00020f80: 6e5d 203d 207b 7d0a 2020 2020 2020 2020  n] = {}.        
-00020f90: 2020 2020 6966 206d 6170 7069 6e67 5b61      if mapping[a
-00020fa0: 2e63 6861 696e 5d2e 6765 7428 612e 7265  .chain].get(a.re
-00020fb0: 735f 6e6f 2920 6973 204e 6f6e 653a 0a20  s_no) is None:. 
-00020fc0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00020fd0: 6170 7069 6e67 5b61 2e63 6861 696e 5d5b  apping[a.chain][
-00020fe0: 612e 7265 735f 6e6f 5d20 3d20 5b5d 0a20  a.res_no] = []. 
-00020ff0: 2020 2020 2020 2020 2020 206d 6170 7069             mappi
-00021000: 6e67 5b61 2e63 6861 696e 5d5b 612e 7265  ng[a.chain][a.re
-00021010: 735f 6e6f 5d2e 6170 7065 6e64 2861 290a  s_no].append(a).
-00021020: 2020 2020 2020 2020 7365 6c66 2e6d 6170          self.map
-00021030: 7069 6e67 203d 206d 6170 7069 6e67 0a20  ping = mapping. 
-00021040: 2020 2020 2020 2073 656c 662e 736c 6964         self.slid
-00021050: 6572 203d 2053 6c69 6469 6e67 5265 7369  er = SlidingResi
-00021060: 6475 6557 696e 646f 7728 6163 6375 6d75  dueWindow(accumu
-00021070: 6c61 746f 7229 0a0a 2020 2020 6465 6620  lator)..    def 
-00021080: 5f67 6574 5f63 6f6e 7469 6773 2873 656c  _get_contigs(sel
-00021090: 662c 2063 6861 696e 293a 0a20 2020 2020  f, chain):.     
-000210a0: 2020 2063 6f6e 7469 6773 203d 205b 5b5d     contigs = [[]
-000210b0: 5d0a 2020 2020 2020 2020 666f 7220 7265  ].        for re
-000210c0: 735f 6e75 6d20 696e 2073 656c 662e 6d61  s_num in self.ma
-000210d0: 7070 696e 675b 6368 6169 6e5d 3a0a 2020  pping[chain]:.  
-000210e0: 2020 2020 2020 2020 2020 6c61 7374 203d            last =
-000210f0: 2063 6f6e 7469 6773 5b2d 315d 0a20 2020   contigs[-1].   
-00021100: 2020 2020 2020 2020 2069 6620 6c65 6e28           if len(
-00021110: 6c61 7374 2920 3d3d 2030 3a0a 2020 2020  last) == 0:.    
-00021120: 2020 2020 2020 2020 2020 2020 6c61 7374              last
-00021130: 2e61 7070 656e 6428 7265 735f 6e75 6d29  .append(res_num)
-00021140: 0a20 2020 2020 2020 2020 2020 2065 6c73  .            els
-00021150: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-00021160: 2020 2069 6620 6c61 7374 5b2d 315d 202b     if last[-1] +
-00021170: 2031 203d 3d20 7265 735f 6e75 6d3a 0a20   1 == res_num:. 
-00021180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00021190: 2020 206c 6173 742e 6170 7065 6e64 2872     last.append(r
-000211a0: 6573 5f6e 756d 290a 2020 2020 2020 2020  es_num).        
-000211b0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-000211c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000211d0: 2020 636f 6e74 6967 732e 6170 7065 6e64    contigs.append
-000211e0: 285b 7265 735f 6e75 6d5d 290a 2020 2020  ([res_num]).    
-000211f0: 2020 2020 7265 7475 726e 2063 6f6e 7469      return conti
-00021200: 6773 0a0a 2020 2020 6465 6620 7363 6f72  gs..    def scor
-00021210: 655f 6368 6169 6e5f 636f 6e74 6967 2873  e_chain_contig(s
-00021220: 656c 662c 2063 6861 696e 2c20 7369 7a65  elf, chain, size
-00021230: 293a 0a20 2020 2020 2020 2022 2222 4765  ):.        """Ge
-00021240: 6e65 7261 7465 2073 6c69 6469 6e67 2077  nerate sliding w
-00021250: 696e 646f 7720 7363 6f72 6573 2077 6865  indow scores whe
-00021260: 7265 2077 696e 646f 7773 2064 6f20 6e6f  re windows do no
-00021270: 7420 7370 616e 2063 6861 696e 2062 7265  t span chain bre
-00021280: 616b 732e 220a 0a20 2020 2020 2020 2054  aks."..        T
-00021290: 6869 7320 6d65 7468 6f64 2063 6f6d 7075  his method compu
-000212a0: 7465 7320 736c 6964 696e 6720 7769 6e64  tes sliding wind
-000212b0: 6f77 7320 6f76 6572 2065 6163 6820 636f  ows over each co
-000212c0: 6e74 6967 756f 7573 2072 6567 696f 6e20  ntiguous region 
-000212d0: 6f66 2074 6865 2063 6861 696e 2e0a 0a20  of the chain... 
-000212e0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
-000212f0: 2020 2020 2020 2020 6368 6169 6e20 2873          chain (s
-00021300: 7472 293a 2054 6865 2063 6861 696e 206e  tr): The chain n
-00021310: 616d 6520 746f 2067 656e 6572 6174 6520  ame to generate 
-00021320: 7769 6e64 6f77 2073 636f 7265 732e 0a20  window scores.. 
-00021330: 2020 2020 2020 2020 2020 7369 7a65 2028            size (
-00021340: 696e 7429 3a20 5468 6520 7369 7a65 206f  int): The size o
-00021350: 6620 7468 6520 7769 6e64 6f77 2e20 5368  f the window. Sh
-00021360: 6f75 6c64 2062 6520 616e 206f 6464 206e  ould be an odd n
-00021370: 756d 6265 722e 0a20 2020 2020 2020 2052  umber..        R
-00021380: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
-00021390: 2020 2041 2064 6963 7469 6f6e 6172 7920     A dictionary 
-000213a0: 6d61 7070 696e 6720 6561 6368 2072 6573  mapping each res
-000213b0: 6964 7565 2074 6f20 6974 7320 7363 6f72  idue to its scor
-000213c0: 652e 0a20 2020 2020 2020 2022 2222 0a0a  e..        """..
-000213d0: 2020 2020 2020 2020 7363 6f72 6573 203d          scores =
-000213e0: 207b 7d0a 0a20 2020 2020 2020 2072 6573   {}..        res
-000213f0: 5f6d 6170 7069 6e67 203d 2073 656c 662e  _mapping = self.
-00021400: 6d61 7070 696e 675b 6368 6169 6e5d 0a20  mapping[chain]. 
-00021410: 2020 2020 2020 2063 6f6e 7469 6773 203d         contigs =
-00021420: 2073 656c 662e 5f67 6574 5f63 6f6e 7469   self._get_conti
-00021430: 6773 2863 6861 696e 290a 0a20 2020 2020  gs(chain)..     
-00021440: 2020 2066 6f72 2063 6f6e 7469 6720 696e     for contig in
-00021450: 2063 6f6e 7469 6773 3a0a 2020 2020 2020   contigs:.      
-00021460: 2020 2020 2020 7265 7369 6475 655f 6174        residue_at
-00021470: 6f6d 735f 6c69 7374 203d 205b 7265 735f  oms_list = [res_
-00021480: 6d61 7070 696e 675b 725d 2066 6f72 2072  mapping[r] for r
-00021490: 2069 6e20 636f 6e74 6967 5d0a 2020 2020   in contig].    
-000214a0: 2020 2020 2020 2020 636f 6e74 6967 5f73          contig_s
-000214b0: 636f 7265 7320 3d20 7365 6c66 2e73 6c69  cores = self.sli
-000214c0: 6465 722e 7363 6f72 6573 2872 6573 6964  der.scores(resid
-000214d0: 7565 5f61 746f 6d73 5f6c 6973 742c 2073  ue_atoms_list, s
-000214e0: 697a 6529 0a20 2020 2020 2020 2020 2020  ize).           
-000214f0: 2066 6f72 206b 2c20 7620 696e 207a 6970   for k, v in zip
-00021500: 2863 6f6e 7469 672c 2063 6f6e 7469 675f  (contig, contig_
-00021510: 7363 6f72 6573 293a 0a20 2020 2020 2020  scores):.       
-00021520: 2020 2020 2020 2020 2073 636f 7265 735b           scores[
-00021530: 6b5d 203d 2076 0a0a 2020 2020 2020 2020  k] = v..        
-00021540: 7265 7475 726e 2073 636f 7265 730a 0a20  return scores.. 
-00021550: 2020 2064 6566 2073 636f 7265 5f63 6861     def score_cha
-00021560: 696e 5f73 7061 6e28 7365 6c66 2c20 6368  in_span(self, ch
-00021570: 6169 6e2c 2073 697a 6529 3a0a 2020 2020  ain, size):.    
-00021580: 2020 2020 2222 2247 656e 6572 6174 6520      """Generate 
-00021590: 736c 6964 696e 6720 7769 6e64 6f77 2073  sliding window s
-000215a0: 636f 7265 7320 7768 6572 6520 7769 6e64  cores where wind
-000215b0: 6f77 7320 646f 2073 7061 6e20 6368 6169  ows do span chai
-000215c0: 6e20 6272 6561 6b73 2e0a 0a20 2020 2020  n breaks...     
-000215d0: 2020 2054 6869 7320 6d65 7468 6f64 2069     This method i
-000215e0: 676e 6f72 6573 2061 6e79 2062 7265 616b  gnores any break
-000215f0: 7320 696e 2074 6865 2063 6861 696e 2c20  s in the chain, 
-00021600: 736f 2077 696e 646f 7773 206d 6179 2069  so windows may i
-00021610: 6e63 6c75 6465 2064 6973 7461 6e74 2072  nclude distant r
-00021620: 6573 6964 7565 732e 0a0a 2020 2020 2020  esidues...      
-00021630: 2020 4172 6773 3a0a 2020 2020 2020 2020    Args:.        
-00021640: 2020 2063 6861 696e 2028 7374 7229 3a20     chain (str): 
-00021650: 5468 6520 6368 6169 6e20 6e61 6d65 2074  The chain name t
-00021660: 6f20 6765 6e65 7261 7465 2077 696e 646f  o generate windo
-00021670: 7720 7363 6f72 6573 2e0a 2020 2020 2020  w scores..      
-00021680: 2020 2020 2073 697a 6520 2869 6e74 293a       size (int):
-00021690: 2054 6865 2073 697a 6520 6f66 2074 6865   The size of the
-000216a0: 2077 696e 646f 772e 2053 686f 756c 6420   window. Should 
-000216b0: 6265 2061 6e20 6f64 6420 6e75 6d62 6572  be an odd number
-000216c0: 2e0a 2020 2020 2020 2020 5265 7475 726e  ..        Return
-000216d0: 733a 0a20 2020 2020 2020 2020 2020 4120  s:.           A 
-000216e0: 6469 6374 696f 6e61 7279 206d 6170 7069  dictionary mappi
-000216f0: 6e67 2065 6163 6820 7265 7369 6475 6520  ng each residue 
-00021700: 746f 2069 7473 2073 636f 7265 2e0a 2020  to its score..  
-00021710: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-00021720: 2020 7265 7369 6475 655f 6d61 7070 696e    residue_mappin
-00021730: 6720 3d20 7365 6c66 2e6d 6170 7069 6e67  g = self.mapping
-00021740: 5b63 6861 696e 5d0a 2020 2020 2020 2020  [chain].        
-00021750: 7265 7369 6475 655f 6174 6f6d 735f 6c69  residue_atoms_li
-00021760: 7374 203d 206c 6973 7428 7265 7369 6475  st = list(residu
-00021770: 655f 6d61 7070 696e 672e 7661 6c75 6573  e_mapping.values
-00021780: 2829 290a 2020 2020 2020 2020 6e75 6d62  ()).        numb
-00021790: 6572 7320 3d20 7265 7369 6475 655f 6d61  ers = residue_ma
-000217a0: 7070 696e 672e 6b65 7973 2829 0a20 2020  pping.keys().   
-000217b0: 2020 2020 2073 636f 7265 7320 3d20 7365       scores = se
-000217c0: 6c66 2e73 6c69 6465 722e 7363 6f72 6573  lf.slider.scores
-000217d0: 2872 6573 6964 7565 5f61 746f 6d73 5f6c  (residue_atoms_l
-000217e0: 6973 742c 2073 697a 6529 0a0a 2020 2020  ist, size)..    
-000217f0: 2020 2020 7265 7475 726e 207b 6b3a 2076      return {k: v
-00021800: 2066 6f72 206b 2c20 7620 696e 207a 6970   for k, v in zip
-00021810: 286e 756d 6265 7273 2c20 7363 6f72 6573  (numbers, scores
-00021820: 297d 0a0a 0a63 6c61 7373 205f 4163 6375  )}...class _Accu
-00021830: 6d75 6c61 746f 723a 0a20 2020 2022 2222  mulator:.    """
-00021840: 416e 2061 6363 756d 756c 6174 6f72 2063  An accumulator c
-00021850: 6f6d 7075 7465 7320 6120 7363 6f72 6520  omputes a score 
-00021860: 6f76 6572 2061 2073 6c69 6469 6e67 2077  over a sliding w
-00021870: 696e 646f 7720 6f66 2061 746f 6d73 2222  indow of atoms""
-00021880: 220a 0a20 2020 2064 6566 2061 6464 5f61  "..    def add_a
-00021890: 746f 6d28 7365 6c66 2c20 6174 6f6d 293a  tom(self, atom):
-000218a0: 0a20 2020 2020 2020 2070 6173 730a 0a20  .        pass.. 
-000218b0: 2020 2064 6566 2064 656c 5f61 746f 6d28     def del_atom(
-000218c0: 7365 6c66 2c20 6174 6f6d 293a 0a20 2020  self, atom):.   
-000218d0: 2020 2020 2070 6173 730a 0a20 2020 2064       pass..    d
-000218e0: 6566 2067 6574 5f76 616c 2873 656c 6629  ef get_val(self)
-000218f0: 3a0a 2020 2020 2020 2020 7061 7373 0a0a  :.        pass..
-00021900: 2020 2020 6465 6620 7a65 726f 2873 656c      def zero(sel
-00021910: 6629 3a0a 2020 2020 2020 2020 7061 7373  f):.        pass
-00021920: 0a0a 0a63 6c61 7373 205f 4d4f 4341 6363  ...class _MOCAcc
-00021930: 756d 756c 6174 6f72 285f 4163 6375 6d75  umulator(_Accumu
-00021940: 6c61 746f 7229 3a0a 2020 2020 2222 2250  lator):.    """P
-00021950: 6c61 6365 686f 6c64 6572 2064 6f63 7374  laceholder docst
-00021960: 7269 6e67 0a20 2020 2022 2222 0a0a 2020  ring.    """..  
-00021970: 2020 6465 6620 5f5f 696e 6974 5f5f 2873    def __init__(s
-00021980: 656c 662c 2065 7870 5f6d 6170 2c20 7369  elf, exp_map, si
-00021990: 6d5f 6d61 702c 2072 6164 6975 7329 3a0a  m_map, radius):.
-000219a0: 2020 2020 2020 2020 6672 6f6d 206d 6174          from mat
-000219b0: 6820 696d 706f 7274 2063 6569 6c2c 206c  h import ceil, l
-000219c0: 6f67 2c20 706f 770a 2020 2020 2020 2020  og, pow.        
-000219d0: 696d 706f 7274 2076 6f78 636f 7620 6173  import voxcov as
-000219e0: 2076 630a 0a20 2020 2020 2020 206d 6178   vc..        max
-000219f0: 5f64 696d 203d 206d 6178 2865 7870 5f6d  _dim = max(exp_m
-00021a00: 6170 2e62 6f78 5f73 697a 6528 2929 0a20  ap.box_size()). 
-00021a10: 2020 2020 2020 206e 6578 745f 706f 7732         next_pow2
-00021a20: 203d 2069 6e74 2870 6f77 2832 2c20 6365   = int(pow(2, ce
-00021a30: 696c 286c 6f67 286d 6178 5f64 696d 2920  il(log(max_dim) 
-00021a40: 2f20 6c6f 6728 3229 2929 290a 2020 2020  / log(2)))).    
-00021a50: 2020 2020 7365 6c66 2e72 6164 6975 7320      self.radius 
-00021a60: 3d20 7261 6469 7573 0a0a 2020 2020 2020  = radius..      
-00021a70: 2020 7365 6c66 2e6d 6f63 203d 2076 632e    self.moc = vc.
-00021a80: 534d 4f43 280a 2020 2020 2020 2020 2020  SMOC(.          
-00021a90: 2020 6578 705f 6d61 702e 6170 6978 2c0a    exp_map.apix,.
-00021aa0: 2020 2020 2020 2020 2020 2020 6578 705f              exp_
-00021ab0: 6d61 702e 6f72 6967 696e 2c0a 2020 2020  map.origin,.    
-00021ac0: 2020 2020 2020 2020 6e65 7874 5f70 6f77          next_pow
-00021ad0: 322c 0a20 2020 2020 2020 2020 2020 205b  2,.            [
-00021ae0: 6578 705f 6d61 702e 785f 7369 7a65 2829  exp_map.x_size()
-00021af0: 2c20 6578 705f 6d61 702e 795f 7369 7a65  , exp_map.y_size
-00021b00: 2829 2c20 6578 705f 6d61 702e 7a5f 7369  (), exp_map.z_si
-00021b10: 7a65 2829 5d2c 0a20 2020 2020 2020 2020  ze()],.         
-00021b20: 2020 206e 702e 6173 636f 6e74 6967 756f     np.ascontiguo
-00021b30: 7573 6172 7261 7928 6578 705f 6d61 702e  usarray(exp_map.
-00021b40: 6675 6c6c 4d61 702c 2064 7479 7065 3d22  fullMap, dtype="
-00021b50: 666c 6f61 7436 3422 292c 0a20 2020 2020  float64"),.     
-00021b60: 2020 2020 2020 206e 702e 6173 636f 6e74         np.ascont
-00021b70: 6967 756f 7573 6172 7261 7928 7369 6d5f  iguousarray(sim_
-00021b80: 6d61 702e 6675 6c6c 4d61 702c 2064 7479  map.fullMap, dty
-00021b90: 7065 3d22 666c 6f61 7436 3422 292c 0a20  pe="float64"),. 
-00021ba0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-00021bb0: 6620 6164 645f 6174 6f6d 2873 656c 662c  f add_atom(self,
-00021bc0: 2061 746f 6d29 3a0a 2020 2020 2020 2020   atom):.        
-00021bd0: 7365 6c66 2e6d 6f63 2e61 6464 5f73 7068  self.moc.add_sph
-00021be0: 6572 6528 5b61 746f 6d2e 782c 2061 746f  ere([atom.x, ato
-00021bf0: 6d2e 792c 2061 746f 6d2e 7a5d 2c20 7365  m.y, atom.z], se
-00021c00: 6c66 2e72 6164 6975 7329 0a0a 2020 2020  lf.radius)..    
-00021c10: 6465 6620 6465 6c5f 6174 6f6d 2873 656c  def del_atom(sel
-00021c20: 662c 2061 746f 6d29 3a0a 2020 2020 2020  f, atom):.      
-00021c30: 2020 7365 6c66 2e6d 6f63 2e64 656c 5f73    self.moc.del_s
-00021c40: 7068 6572 6528 5b61 746f 6d2e 782c 2061  phere([atom.x, a
-00021c50: 746f 6d2e 792c 2061 746f 6d2e 7a5d 2c20  tom.y, atom.z], 
-00021c60: 7365 6c66 2e72 6164 6975 7329 0a0a 2020  self.radius)..  
-00021c70: 2020 6465 6620 6765 745f 7661 6c28 7365    def get_val(se
-00021c80: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-00021c90: 7572 6e20 7365 6c66 2e6d 6f63 2e67 6574  urn self.moc.get
-00021ca0: 5f76 616c 2829 0a0a 2020 2020 6465 6620  _val()..    def 
-00021cb0: 7a65 726f 2873 656c 6629 3a0a 2020 2020  zero(self):.    
-00021cc0: 2020 2020 7365 6c66 2e6d 6f63 2e7a 6572      self.moc.zer
-00021cd0: 6f28 290a 0a0a 636c 6173 7320 4661 7374  o()...class Fast
-00021ce0: 534d 4f43 285f 4162 7374 7261 6374 536c  SMOC(_AbstractSl
-00021cf0: 6964 696e 6753 636f 7265 293a 0a20 2020  idingScore):.   
-00021d00: 2022 2222 4120 6661 7374 6572 2076 6572   """A faster ver
-00021d10: 7369 6f6e 206f 6620 7468 6520 736c 6964  sion of the slid
-00021d20: 696e 6720 7769 6e64 6f77 2053 4d4f 4320  ing window SMOC 
-00021d30: 7363 6f72 652e 0a0a 2020 2020 556e 6c69  score...    Unli
-00021d40: 6b65 2074 6865 206f 7269 6769 6e61 6c20  ke the original 
-00021d50: 616c 676f 7269 7468 6d2c 2074 6869 7320  algorithm, this 
-00021d60: 6f6e 6573 2069 7320 6f70 7469 6d69 7a65  ones is optimize
-00021d70: 6420 696e 2074 6865 0a20 2020 2066 6f6c  d in the.    fol
-00021d80: 6c6f 7769 6e67 2077 6179 733a 0a0a 2020  lowing ways:..  
-00021d90: 2020 2a20 6c61 7a69 6c79 2064 6574 6572    * lazily deter
-00021da0: 6d69 6e65 7320 7265 7175 6972 6564 2076  mines required v
-00021db0: 6f78 656c 7320 7361 7669 6e67 2073 7061  oxels saving spa
-00021dc0: 6365 2061 6e64 2074 696d 652e 0a20 2020  ce and time..   
-00021dd0: 202a 2054 6865 2073 6c69 6469 6e67 2d77   * The sliding-w
-00021de0: 696e 646f 7720 6361 6c63 756c 6174 696f  indow calculatio
-00021df0: 6e20 6973 2070 6572 666f 726d 6564 2069  n is performed i
-00021e00: 6e20 7469 6d65 2070 726f 706f 7274 696f  n time proportio
-00021e10: 6e61 6c0a 2020 2020 2020 6f6e 6c79 2074  nal.      only t
-00021e20: 6f20 6368 6169 6e20 7369 7a65 2061 6e64  o chain size and
-00021e30: 206e 6f74 2077 696e 646f 7720 7369 7a65   not window size
-00021e40: 2e0a 0a20 2020 2054 6869 7320 6d65 7468  ...    This meth
-00021e50: 6f64 2064 6f65 7320 6e6f 7420 6f66 6665  od does not offe
-00021e60: 7220 616c 6c20 7468 6520 6265 6c6c 7320  r all the bells 
-00021e70: 616e 6420 7768 6973 746c 6573 206f 6620  and whistles of 
-00021e80: 6f6c 6420 534d 4f43 0a20 2020 2066 756e  old SMOC.    fun
-00021e90: 6374 696f 6e20 7375 6368 2061 7320 7269  ction such as ri
-00021ea0: 6769 6420 626f 6479 2070 6172 616d 6574  gid body paramet
-00021eb0: 6572 732e 2020 486f 7765 7665 722c 2074  ers.  However, t
-00021ec0: 776f 2061 6c74 6572 6e61 7469 7665 0a20  wo alternative. 
-00021ed0: 2020 206d 6574 686f 6473 2061 7265 2070     methods are p
-00021ee0: 726f 7669 6465 6420 666f 7220 6465 616c  rovided for deal
-00021ef0: 696e 6720 7769 7468 2053 4d4f 4320 7363  ing with SMOC sc
-00021f00: 6f72 6573 2066 6f72 2075 6e6d 6f64 656c  ores for unmodel
-00021f10: 6c65 640a 2020 2020 7265 6769 6f6e 732e  led.    regions.
-00021f20: 0a0a 2020 2020 5468 6520 6675 6e63 7469  ..    The functi
-00021f30: 6f6e 2060 7363 6f72 655f 6368 6169 6e5f  on `score_chain_
-00021f40: 636f 6e74 6967 602c 2077 696c 6c20 7363  contig`, will sc
-00021f50: 6f72 6520 616c 6c20 636f 6e74 6967 7320  ore all contigs 
-00021f60: 696e 2061 0a20 2020 2063 6861 696e 2077  in a.    chain w
-00021f70: 6865 7265 2065 6163 6820 7769 6e64 6f77  here each window
-00021f80: 206f 6e6c 7920 636f 6e74 6169 6e73 2072   only contains r
-00021f90: 6573 6964 7565 7320 6265 6c6f 6e67 696e  esidues belongin
-00021fa0: 6720 746f 2074 6865 0a20 2020 2063 6f6e  g to the.    con
-00021fb0: 7469 672e 0a0a 2020 2020 5468 6520 6675  tig...    The fu
-00021fc0: 6e63 7469 6f6e 2060 7363 6f72 655f 6368  nction `score_ch
-00021fd0: 6169 6e5f 7370 616e 6020 6d69 6d69 636b  ain_span` mimick
-00021fe0: 7320 7468 6520 6f6c 6420 534d 4f43 2062  s the old SMOC b
-00021ff0: 6568 6176 696f 7572 2e0a 2020 2020 5769  ehaviour..    Wi
-00022000: 6e64 6f77 7320 6967 6e6f 7265 2063 6f6e  ndows ignore con
-00022010: 7469 6773 2062 6f75 6e64 6172 6965 7320  tigs boundaries 
-00022020: 2874 6865 7920 2773 7061 6e27 2074 6865  (they 'span' the
-00022030: 6d29 2c20 7468 7573 2072 6573 6964 7565  m), thus residue
-00022040: 730a 2020 2020 696e 2077 696e 646f 7773  s.    in windows
-00022050: 206d 6179 2062 6520 7068 7973 6963 616c   may be physical
-00022060: 6c79 2064 6973 7461 6e74 2e0a 0a20 2020  ly distant...   
-00022070: 2049 6e20 6765 6e65 7261 6c2c 2074 6865   In general, the
-00022080: 2063 6f6e 7369 6465 7220 7573 696e 6720   consider using 
-00022090: 7468 6520 6073 636f 7265 5f63 6861 696e  the `score_chain
-000220a0: 5f63 6f6e 7469 6760 206d 6574 686f 642e  _contig` method.
-000220b0: 0a0a 0a20 2020 2041 7267 733a 0a20 2020  ...    Args:.   
-000220c0: 2020 2020 2073 7472 7563 7420 283a 636c       struct (:cl
-000220d0: 6173 733a 6042 696f 5079 5f53 7472 7563  ass:`BioPy_Struc
-000220e0: 7475 7265 203c 5445 4d50 792e 7072 6f74  ture <TEMPy.prot
-000220f0: 6569 6e2e 7072 6f74 5f72 6570 5f62 696f  ein.prot_rep_bio
-00022100: 7079 2e42 696f 5079 5f53 7472 7563 7475  py.BioPy_Structu
-00022110: 7265 3e60 293a 204d 6f64 656c 2074 6f20  re>`): Model to 
-00022120: 7363 6f72 650a 2020 2020 2020 2020 6578  score.        ex
-00022130: 705f 6d61 7020 283a 636c 6173 733a 6045  p_map (:class:`E
-00022140: 4d4d 6170 203c 5445 4d50 792e 6d61 7073  MMap <TEMPy.maps
-00022150: 2e65 6d5f 6d61 702e 4d61 703e 6029 3a20  .em_map.Map>`): 
-00022160: 4578 7065 7269 6d65 6e74 616c 2064 656e  Experimental den
-00022170: 7369 7479 206d 6170 0a20 2020 2020 2020  sity map.       
-00022180: 2072 6573 6f6c 7574 696f 6e20 2866 6c6f   resolution (flo
-00022190: 6174 293a 2054 6865 2072 6573 6f6c 7574  at): The resolut
-000221a0: 696f 6e20 6f66 2074 6865 2065 7870 6572  ion of the exper
-000221b0: 696d 656e 7461 6c20 6d61 700a 2020 2020  imental map.    
-000221c0: 2020 2020 7369 676d 615f 636f 6566 6620      sigma_coeff 
-000221d0: 2866 6c6f 6174 2c20 6f70 7469 6f6e 616c  (float, optional
-000221e0: 293a 2054 6865 2073 6967 6d61 2063 6f65  ): The sigma coe
-000221f0: 6666 6963 6965 6e74 2066 6f72 2073 696d  fficient for sim
-00022200: 756c 6174 696e 6720 7468 6520 6d61 702e  ulating the map.
-00022210: 2044 6566 6175 6c74 7320 746f 2030 2e32   Defaults to 0.2
-00022220: 3235 2e0a 2020 2020 2020 2020 7369 676d  25..        sigm
-00022230: 615f 7468 7265 7368 6f6c 6420 2866 6c6f  a_threshold (flo
-00022240: 6174 2c20 6f70 7469 6f6e 616c 293a 2054  at, optional): T
-00022250: 6865 2073 6967 6d61 2074 6872 6573 686f  he sigma thresho
-00022260: 6c64 2064 6574 6572 6d69 6e65 7320 7468  ld determines th
-00022270: 6520 7261 6469 7573 2061 726f 756e 6420  e radius around 
-00022280: 7468 6520 6174 6f6d 7320 746f 2063 6f6e  the atoms to con
-00022290: 7369 6465 722e 2044 6566 6175 6c74 7320  sider. Defaults 
-000222a0: 746f 2032 2e35 2e0a 2020 2020 2020 2020  to 2.5..        
-000222b0: 7369 6d5f 6d61 7020 2845 4d4d 6170 2c20  sim_map (EMMap, 
-000222c0: 6f70 7469 6f6e 616c 293a 2041 2073 696d  optional): A sim
-000222d0: 756c 6174 6564 206d 6170 2074 6f20 7573  ulated map to us
-000222e0: 6520 696e 7374 6561 6420 6f66 2067 656e  e instead of gen
-000222f0: 6572 6174 696e 6720 6f6e 652e 0a20 2020  erating one..   
-00022300: 2052 6574 7572 6e73 3a0a 2020 2020 2020   Returns:.      
-00022310: 2020 4661 7374 534d 4f43 206f 626a 6563    FastSMOC objec
-00022320: 740a 2020 2020 2222 220a 0a20 2020 2064  t.    """..    d
-00022330: 6566 205f 5f69 6e69 745f 5f28 0a20 2020  ef __init__(.   
-00022340: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-00022350: 2020 2073 7472 7563 742c 0a20 2020 2020     struct,.     
-00022360: 2020 2065 7870 5f6d 6170 2c0a 2020 2020     exp_map,.    
-00022370: 2020 2020 7265 736f 6c75 7469 6f6e 2c0a      resolution,.
-00022380: 2020 2020 2020 2020 7369 676d 615f 636f          sigma_co
-00022390: 6566 663d 302e 3232 352c 0a20 2020 2020  eff=0.225,.     
-000223a0: 2020 2073 6967 6d61 5f74 6872 6573 686f     sigma_thresho
-000223b0: 6c64 3d32 2e35 2c0a 2020 2020 2020 2020  ld=2.5,.        
-000223c0: 7369 6d5f 6d61 703d 4e6f 6e65 2c0a 2020  sim_map=None,.  
-000223d0: 2020 293a 0a20 2020 2020 2020 2072 6164    ):.        rad
-000223e0: 6975 7320 3d20 7369 676d 615f 7468 7265  ius = sigma_thre
-000223f0: 7368 6f6c 6420 2a20 6d61 7828 7369 676d  shold * max(sigm
-00022400: 615f 636f 6566 6620 2a20 7265 736f 6c75  a_coeff * resolu
-00022410: 7469 6f6e 2c20 312e 3029 0a20 2020 2020  tion, 1.0).     
-00022420: 2020 2069 6620 7369 6d5f 6d61 7020 6973     if sim_map is
-00022430: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
-00022440: 2020 2073 696d 5f6d 6170 203d 2053 7472     sim_map = Str
-00022450: 7563 7475 7265 426c 7572 7265 7228 292e  uctureBlurrer().
-00022460: 6761 7573 7369 616e 5f62 6c75 725f 7265  gaussian_blur_re
-00022470: 616c 5f73 7061 6365 280a 2020 2020 2020  al_space(.      
-00022480: 2020 2020 2020 2020 2020 2020 2020 7374                st
-00022490: 7275 6374 2c0a 2020 2020 2020 2020 2020  ruct,.          
-000224a0: 2020 2020 2020 2020 2020 7265 736f 6c75            resolu
-000224b0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-000224c0: 2020 2020 2020 2020 2020 6578 705f 6d61            exp_ma
-000224d0: 702c 0a20 2020 2020 2020 2020 2020 2020  p,.             
-000224e0: 2020 2020 2020 2073 6967 6d61 5f63 6f65         sigma_coe
-000224f0: 6666 3d73 6967 6d61 5f63 6f65 6666 0a20  ff=sigma_coeff. 
-00022500: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00022510: 2020 2020 206d 6f63 203d 205f 4d4f 4341       moc = _MOCA
-00022520: 6363 756d 756c 6174 6f72 2865 7870 5f6d  ccumulator(exp_m
-00022530: 6170 2c20 7369 6d5f 6d61 702c 2072 6164  ap, sim_map, rad
-00022540: 6975 7329 0a20 2020 2020 2020 2073 7570  ius).        sup
-00022550: 6572 2829 2e5f 5f69 6e69 745f 5f28 7374  er().__init__(st
-00022560: 7275 6374 2c20 6d6f 6329 0a0a 0a63 6c61  ruct, moc)...cla
-00022570: 7373 2046 6173 7453 4343 433a 0a20 2020  ss FastSCCC:.   
-00022580: 2064 6566 205f 5f69 6e69 745f 5f28 0a20   def __init__(. 
-00022590: 2020 2020 2020 2020 2020 2073 656c 662c             self,
-000225a0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-000225b0: 7563 7475 7265 2c0a 2020 2020 2020 2020  ucture,.        
-000225c0: 2020 2020 6d61 705f 7461 7267 6574 2c0a      map_target,.
-000225d0: 2020 2020 2020 2020 2020 2020 7265 736f              reso
-000225e0: 6c75 7469 6f6e 2c0a 2020 2020 2020 2020  lution,.        
-000225f0: 2020 2020 7369 676d 615f 636f 6566 663d      sigma_coeff=
-00022600: 302e 3232 352c 0a20 2020 2029 3a0a 2020  0.225,.    ):.  
-00022610: 2020 2020 2020 2222 2243 616c 6375 6c61        """Calcula
-00022620: 7465 206c 6f63 616c 2063 726f 7373 2d63  te local cross-c
-00022630: 6f72 7265 6c61 7469 6f6e 2066 6f72 2061  orrelation for a
-00022640: 2073 6567 6d65 6e74 206f 6620 6120 7072   segment of a pr
-00022650: 6f74 6569 6e20 6d6f 6465 6c2e 0a0a 2020  otein model...  
-00022660: 2020 2020 2020 4172 6773 3a0a 2020 2020        Args:.    
-00022670: 2020 2020 2020 2020 7374 7275 6374 7572          structur
-00022680: 653a 2054 6865 2065 6e74 6972 6520 6174  e: The entire at
-00022690: 6f6d 6963 2073 7472 7563 7475 7265 0a20  omic structure. 
-000226a0: 2020 2020 2020 2020 2020 206d 6170 5f74             map_t
-000226b0: 6172 6765 743a 2041 6e20 6578 7065 7269  arget: An experi
-000226c0: 6d65 6e74 616c 206d 6170 2e0a 2020 2020  mental map..    
-000226d0: 2020 2020 2020 2020 7265 736f 6c75 7469          resoluti
-000226e0: 6f6e 3a20 5468 6520 7365 736f 6c75 7469  on: The sesoluti
-000226f0: 6f6e 206f 6620 7468 6520 6578 7065 7269  on of the experi
-00022700: 6d65 6e74 616c 206d 6170 2e0a 2020 2020  mental map..    
-00022710: 2020 2020 2020 2020 7369 676d 615f 636f          sigma_co
-00022720: 6566 663a 2054 6865 2073 6967 6d61 2063  eff: The sigma c
-00022730: 6f65 6666 6963 6965 6e74 2066 6f72 2062  oefficient for b
-00022740: 6c75 7272 696e 672e 0a20 2020 2020 2020  lurring..       
-00022750: 2020 2020 2020 2020 203a 7265 663a 6068           :ref:`h
-00022760: 6572 653c 4e6f 7465 206f 6e20 7265 616c  ere<Note on real
-00022770: 2073 7061 6365 2062 6c75 7272 696e 673a   space blurring:
-00022780: 3e60 0a20 2020 2020 2020 2052 6574 7572  >`.        Retur
-00022790: 6e73 3a0a 2020 2020 2020 2020 2020 2020  ns:.            
-000227a0: 4120 5343 4343 206f 626a 6563 742e 0a20  A SCCC object.. 
-000227b0: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000227c0: 2020 2073 656c 662e 626c 7572 7265 7220     self.blurrer 
-000227d0: 3d20 5374 7275 6374 7572 6542 6c75 7272  = StructureBlurr
-000227e0: 6572 2829 0a20 2020 2020 2020 2073 656c  er().        sel
-000227f0: 662e 7363 6f72 6572 203d 2053 636f 7269  f.scorer = Scori
-00022800: 6e67 4675 6e63 7469 6f6e 7328 290a 2020  ngFunctions().  
-00022810: 2020 2020 2020 7365 6c66 2e6d 6170 5f74        self.map_t
-00022820: 6172 6765 7420 3d20 6d61 705f 7461 7267  arget = map_targ
-00022830: 6574 0a20 2020 2020 2020 2073 656c 662e  et.        self.
-00022840: 7265 736f 6c75 7469 6f6e 203d 2072 6573  resolution = res
-00022850: 6f6c 7574 696f 6e0a 2020 2020 2020 2020  olution.        
-00022860: 7365 6c66 2e73 6967 6d61 5f63 6f65 6666  self.sigma_coeff
-00022870: 203d 2073 6967 6d61 5f63 6f65 6666 0a20   = sigma_coeff. 
-00022880: 2020 2020 2020 2073 656c 662e 7768 6f6c         self.whol
-00022890: 655f 7369 6d5f 6d61 7020 3d20 7365 6c66  e_sim_map = self
-000228a0: 2e62 6c75 7272 6572 2e67 6175 7373 6961  .blurrer.gaussia
-000228b0: 6e5f 626c 7572 5f72 6561 6c5f 7370 6163  n_blur_real_spac
-000228c0: 6528 0a20 2020 2020 2020 2020 2020 2073  e(.            s
-000228d0: 7472 7563 7475 7265 2c0a 2020 2020 2020  tructure,.      
-000228e0: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
-000228f0: 2c0a 2020 2020 2020 2020 2020 2020 6465  ,.            de
-00022900: 6e73 4d61 703d 6d61 705f 7461 7267 6574  nsMap=map_target
-00022910: 2c0a 2020 2020 2020 2020 2020 2020 7369  ,.            si
-00022920: 676d 615f 636f 6566 663d 7369 676d 615f  gma_coeff=sigma_
-00022930: 636f 6566 662c 0a20 2020 2020 2020 2020  coeff,.         
-00022940: 2020 206e 6f72 6d61 6c69 7365 3d54 7275     normalise=Tru
-00022950: 652c 0a20 2020 2020 2020 2029 0a0a 2020  e,.        )..  
-00022960: 2020 6465 6620 7363 6f72 655f 7365 676d    def score_segm
-00022970: 656e 7428 7365 6c66 2c20 7365 676d 656e  ent(self, segmen
-00022980: 745f 7374 7275 6374 7572 6529 3a0a 2020  t_structure):.  
-00022990: 2020 2020 2020 2222 2253 636f 7265 2061        """Score a
-000229a0: 2073 6567 6d65 6e74 206f 6620 7468 6520   segment of the 
-000229b0: 7374 7275 6374 7572 652e 0a0a 2020 2020  structure...    
-000229c0: 2020 2020 4172 6773 3a0a 2020 2020 2020      Args:.      
-000229d0: 2020 2020 2020 7365 676d 656e 743a 2041        segment: A
-000229e0: 6e20 6174 6f6d 6963 2073 7472 7563 7475  n atomic structu
-000229f0: 7265 2077 6869 6368 2073 686f 756c 6420  re which should 
-00022a00: 6265 2061 2063 6f6d 706f 6e65 6e74 0a20  be a component. 
-00022a10: 2020 2020 2020 2052 6574 7572 6e73 3a0a         Returns:.
-00022a20: 2020 2020 2020 2020 2020 2020 4343 4320              CCC 
-00022a30: 7363 6f72 653a 2028 666c 6f61 7429 0a20  score: (float). 
-00022a40: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00022a50: 2020 2073 6567 6d65 6e74 5f73 696d 5f6d     segment_sim_m
-00022a60: 6170 203d 2073 656c 662e 626c 7572 7265  ap = self.blurre
-00022a70: 722e 6761 7573 7369 616e 5f62 6c75 725f  r.gaussian_blur_
-00022a80: 7265 616c 5f73 7061 6365 280a 2020 2020  real_space(.    
-00022a90: 2020 2020 2020 2020 7365 676d 656e 745f          segment_
-00022aa0: 7374 7275 6374 7572 652c 0a20 2020 2020  structure,.     
-00022ab0: 2020 2020 2020 2073 656c 662e 7265 736f         self.reso
-00022ac0: 6c75 7469 6f6e 2c0a 2020 2020 2020 2020  lution,.        
-00022ad0: 2020 2020 7365 6c66 2e6d 6170 5f74 6172      self.map_tar
-00022ae0: 6765 742c 0a20 2020 2020 2020 2020 2020  get,.           
-00022af0: 2073 656c 662e 7369 676d 615f 636f 6566   self.sigma_coef
-00022b00: 662c 0a20 2020 2020 2020 2020 2020 206e  f,.            n
-00022b10: 6f72 6d61 6c69 7365 3d54 7275 652c 0a20  ormalise=True,. 
-00022b20: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00022b30: 206d 696e 4465 6e73 203d 2073 6567 6d65   minDens = segme
-00022b40: 6e74 5f73 696d 5f6d 6170 2e73 7464 2829  nt_sim_map.std()
-00022b50: 0a20 2020 2020 2020 2073 6567 6d65 6e74  .        segment
-00022b60: 5f6d 6173 6b20 3d20 7365 676d 656e 745f  _mask = segment_
-00022b70: 7369 6d5f 6d61 702e 5f67 6574 5f6d 6173  sim_map._get_mas
-00022b80: 6b41 7272 6179 286d 696e 4465 6e73 290a  kArray(minDens).
-00022b90: 2020 2020 2020 2020 7461 7267 6574 5f6d          target_m
-00022ba0: 6173 6b65 6420 3d20 7365 6c66 2e6d 6170  asked = self.map
-00022bb0: 5f74 6172 6765 742e 5f67 6574 5f6d 6173  _target._get_mas
-00022bc0: 6b4d 6170 2873 6567 6d65 6e74 5f6d 6173  kMap(segment_mas
-00022bd0: 6b29 0a20 2020 2020 2020 2073 696d 5f6d  k).        sim_m
-00022be0: 6173 6b65 6420 3d20 7365 6c66 2e77 686f  asked = self.who
-00022bf0: 6c65 5f73 696d 5f6d 6170 2e5f 6765 745f  le_sim_map._get_
-00022c00: 6d61 736b 4d61 7028 7365 676d 656e 745f  maskMap(segment_
-00022c10: 6d61 736b 290a 2020 2020 2020 2020 7373  mask).        ss
-00022c20: 652c 205f 203d 2073 656c 662e 7363 6f72  e, _ = self.scor
-00022c30: 6572 2e43 4343 5f6d 6170 2874 6172 6765  er.CCC_map(targe
-00022c40: 745f 6d61 736b 6564 2c20 7369 6d5f 6d61  t_masked, sim_ma
-00022c50: 736b 6564 2c20 636d 6f64 653d 4661 6c73  sked, cmode=Fals
-00022c60: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
-00022c70: 6e20 7373 650a 0a0a                      n sse...
+00020830: 2020 2020 6861 6c66 5f6d 6170 322e 6675      half_map2.fu
+00020840: 6c6c 4d61 702c 0a20 2020 2020 2020 2020  llMap,.         
+00020850: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020860: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00020870: 6978 656c 5f73 697a 653d 6861 6c66 5f6d  ixel_size=half_m
+00020880: 6170 312e 6170 6978 5b30 5d2c 290a 0a20  ap1.apix[0],).. 
+00020890: 2020 2020 2020 2072 6573 6f6c 7574 696f         resolutio
+000208a0: 6e20 3d20 666f 7572 6965 722e 6765 745f  n = fourier.get_
+000208b0: 6673 635f 7265 736f 6c75 7469 6f6e 280a  fsc_resolution(.
+000208c0: 2020 2020 2020 2020 2020 2020 6673 632c              fsc,
+000208d0: 2066 7363 5f74 6872 6573 686f 6c64 3d66   fsc_threshold=f
+000208e0: 7363 5f74 6872 6573 686f 6c64 2c0a 2020  sc_threshold,.  
+000208f0: 2020 2020 2020 2020 2020 7573 655f 6869            use_hi
+00020900: 6768 6573 745f 7265 736f 6c75 7469 6f6e  ghest_resolution
+00020910: 3d75 7365 5f68 6967 6865 7374 5f72 6573  =use_highest_res
+00020920: 6f6c 7574 696f 6e2c 0a20 2020 2020 2020  olution,.       
+00020930: 2020 2020 2069 6e74 6572 706f 6c61 7465       interpolate
+00020940: 5f63 7574 6f66 663d 4661 6c73 6529 0a0a  _cutoff=False)..
+00020950: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00020960: 6573 6f6c 7574 696f 6e0a 0a0a 636c 6173  esolution...clas
+00020970: 7320 536c 6964 696e 6752 6573 6964 7565  s SlidingResidue
+00020980: 5769 6e64 6f77 3a0a 2020 2020 6465 6620  Window:.    def 
+00020990: 5f5f 696e 6974 5f5f 2873 656c 662c 2061  __init__(self, a
+000209a0: 6363 756d 756c 6174 6f72 293a 0a20 2020  ccumulator):.   
+000209b0: 2020 2020 2073 656c 662e 6163 6375 6d75       self.accumu
+000209c0: 6c61 746f 7220 3d20 6163 6375 6d75 6c61  lator = accumula
+000209d0: 746f 720a 0a20 2020 2064 6566 2073 636f  tor..    def sco
+000209e0: 7265 7328 7365 6c66 2c20 7265 7369 6475  res(self, residu
+000209f0: 655f 6174 6f6d 735f 6c69 7374 2c20 7369  e_atoms_list, si
+00020a00: 7a65 293a 0a20 2020 2020 2020 2073 656c  ze):.        sel
+00020a10: 662e 6163 6375 6d75 6c61 746f 722e 7a65  f.accumulator.ze
+00020a20: 726f 2829 0a0a 2020 2020 2020 2020 6861  ro()..        ha
+00020a30: 6c66 5f77 696e 646f 7720 3d20 696e 7428  lf_window = int(
+00020a40: 2873 697a 6520 2d20 3129 202f 2032 290a  (size - 1) / 2).
+00020a50: 0a20 2020 2020 2020 2073 636f 7265 7320  .        scores 
+00020a60: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+00020a70: 2068 6561 6420 696e 2072 616e 6765 2830   head in range(0
+00020a80: 2c20 6c65 6e28 7265 7369 6475 655f 6174  , len(residue_at
+00020a90: 6f6d 735f 6c69 7374 2920 2b20 6861 6c66  oms_list) + half
+00020aa0: 5f77 696e 646f 7729 3a0a 2020 2020 2020  _window):.      
+00020ab0: 2020 2020 2020 7461 696c 203d 2068 6561        tail = hea
+00020ac0: 6420 2d20 7369 7a65 0a0a 2020 2020 2020  d - size..      
+00020ad0: 2020 2020 2020 2320 5768 696c 6520 7468        # While th
+00020ae0: 6520 6865 6164 2069 7320 7769 7468 2069  e head is with i
+00020af0: 6e20 7468 6520 616c 6c6f 7765 6420 7261  n the allowed ra
+00020b00: 6e67 652c 2075 7365 2061 6c6c 2074 6865  nge, use all the
+00020b10: 2076 6f78 656c 730a 2020 2020 2020 2020   voxels.        
+00020b20: 2020 2020 2320 6173 736f 6369 6174 6564      # associated
+00020b30: 2077 6974 6820 7468 6520 7265 7369 6475   with the residu
+00020b40: 6573 2061 746f 6d73 2e0a 2020 2020 2020  es atoms..      
+00020b50: 2020 2020 2020 6966 2068 6561 6420 3c20        if head < 
+00020b60: 6c65 6e28 7265 7369 6475 655f 6174 6f6d  len(residue_atom
+00020b70: 735f 6c69 7374 293a 0a20 2020 2020 2020  s_list):.       
+00020b80: 2020 2020 2020 2020 2066 6f72 2061 746f           for ato
+00020b90: 6d20 696e 2072 6573 6964 7565 5f61 746f  m in residue_ato
+00020ba0: 6d73 5f6c 6973 745b 6865 6164 5d3a 0a20  ms_list[head]:. 
+00020bb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020bc0: 2020 2073 656c 662e 6163 6375 6d75 6c61     self.accumula
+00020bd0: 746f 722e 6164 645f 6174 6f6d 2861 746f  tor.add_atom(ato
+00020be0: 6d29 0a0a 2020 2020 2020 2020 2020 2020  m)..            
+00020bf0: 2320 4472 6f70 2074 6865 2074 6169 6c20  # Drop the tail 
+00020c00: 6966 2069 7420 7769 7468 696e 2074 6865  if it within the
+00020c10: 2072 616e 6765 206f 6620 7265 7369 6475   range of residu
+00020c20: 6573 2e0a 2020 2020 2020 2020 2020 2020  es..            
+00020c30: 6966 2074 6169 6c20 3e3d 2030 3a0a 2020  if tail >= 0:.  
+00020c40: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+00020c50: 7220 6174 6f6d 2069 6e20 7265 7369 6475  r atom in residu
+00020c60: 655f 6174 6f6d 735f 6c69 7374 5b74 6169  e_atoms_list[tai
+00020c70: 6c5d 3a0a 2020 2020 2020 2020 2020 2020  l]:.            
+00020c80: 2020 2020 2020 2020 7365 6c66 2e61 6363          self.acc
+00020c90: 756d 756c 6174 6f72 2e64 656c 5f61 746f  umulator.del_ato
+00020ca0: 6d28 6174 6f6d 290a 0a20 2020 2020 2020  m(atom)..       
+00020cb0: 2020 2020 2023 2045 7874 7261 6374 2074       # Extract t
+00020cc0: 6865 2053 4d4f 4320 7363 6f72 650a 2020  he SMOC score.  
+00020cd0: 2020 2020 2020 2020 2020 6966 2068 6561            if hea
+00020ce0: 6420 2d20 6861 6c66 5f77 696e 646f 7720  d - half_window 
+00020cf0: 3e3d 2030 3a0a 2020 2020 2020 2020 2020  >= 0:.          
+00020d00: 2020 2020 2020 7363 6f72 6573 2e61 7070        scores.app
+00020d10: 656e 6428 7365 6c66 2e61 6363 756d 756c  end(self.accumul
+00020d20: 6174 6f72 2e67 6574 5f76 616c 2829 290a  ator.get_val()).
+00020d30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00020d40: 7363 6f72 6573 0a0a 0a63 6c61 7373 205f  scores...class _
+00020d50: 4162 7374 7261 6374 536c 6964 696e 6753  AbstractSlidingS
+00020d60: 636f 7265 3a0a 2020 2020 6465 6620 5f5f  core:.    def __
+00020d70: 696e 6974 5f5f 2873 656c 662c 2073 7472  init__(self, str
+00020d80: 7563 742c 2061 6363 756d 756c 6174 6f72  uct, accumulator
+00020d90: 293a 0a20 2020 2020 2020 206d 6170 7069  ):.        mappi
+00020da0: 6e67 203d 207b 7d0a 2020 2020 2020 2020  ng = {}.        
+00020db0: 666f 7220 6120 696e 2073 7472 7563 742e  for a in struct.
+00020dc0: 6174 6f6d 4c69 7374 3a0a 2020 2020 2020  atomList:.      
+00020dd0: 2020 2020 2020 6966 206d 6170 7069 6e67        if mapping
+00020de0: 2e67 6574 2861 2e63 6861 696e 2920 6973  .get(a.chain) is
+00020df0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00020e00: 2020 2020 2020 206d 6170 7069 6e67 5b61         mapping[a
+00020e10: 2e63 6861 696e 5d20 3d20 7b7d 0a20 2020  .chain] = {}.   
+00020e20: 2020 2020 2020 2020 2069 6620 6d61 7070           if mapp
+00020e30: 696e 675b 612e 6368 6169 6e5d 2e67 6574  ing[a.chain].get
+00020e40: 2861 2e72 6573 5f6e 6f29 2069 7320 4e6f  (a.res_no) is No
+00020e50: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+00020e60: 2020 2020 6d61 7070 696e 675b 612e 6368      mapping[a.ch
+00020e70: 6169 6e5d 5b61 2e72 6573 5f6e 6f5d 203d  ain][a.res_no] =
+00020e80: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
+00020e90: 6d61 7070 696e 675b 612e 6368 6169 6e5d  mapping[a.chain]
+00020ea0: 5b61 2e72 6573 5f6e 6f5d 2e61 7070 656e  [a.res_no].appen
+00020eb0: 6428 6129 0a20 2020 2020 2020 2073 656c  d(a).        sel
+00020ec0: 662e 6d61 7070 696e 6720 3d20 6d61 7070  f.mapping = mapp
+00020ed0: 696e 670a 2020 2020 2020 2020 7365 6c66  ing.        self
+00020ee0: 2e73 6c69 6465 7220 3d20 536c 6964 696e  .slider = Slidin
+00020ef0: 6752 6573 6964 7565 5769 6e64 6f77 2861  gResidueWindow(a
+00020f00: 6363 756d 756c 6174 6f72 290a 0a20 2020  ccumulator)..   
+00020f10: 2064 6566 205f 6765 745f 636f 6e74 6967   def _get_contig
+00020f20: 7328 7365 6c66 2c20 6368 6169 6e29 3a0a  s(self, chain):.
+00020f30: 2020 2020 2020 2020 636f 6e74 6967 7320          contigs 
+00020f40: 3d20 5b5b 5d5d 0a20 2020 2020 2020 2066  = [[]].        f
+00020f50: 6f72 2072 6573 5f6e 756d 2069 6e20 7365  or res_num in se
+00020f60: 6c66 2e6d 6170 7069 6e67 5b63 6861 696e  lf.mapping[chain
+00020f70: 5d3a 0a20 2020 2020 2020 2020 2020 206c  ]:.            l
+00020f80: 6173 7420 3d20 636f 6e74 6967 735b 2d31  ast = contigs[-1
+00020f90: 5d0a 2020 2020 2020 2020 2020 2020 6966  ].            if
+00020fa0: 206c 656e 286c 6173 7429 203d 3d20 303a   len(last) == 0:
+00020fb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00020fc0: 206c 6173 742e 6170 7065 6e64 2872 6573   last.append(res
+00020fd0: 5f6e 756d 290a 2020 2020 2020 2020 2020  _num).          
+00020fe0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
+00020ff0: 2020 2020 2020 2020 6966 206c 6173 745b          if last[
+00021000: 2d31 5d20 2b20 3120 3d3d 2072 6573 5f6e  -1] + 1 == res_n
+00021010: 756d 3a0a 2020 2020 2020 2020 2020 2020  um:.            
+00021020: 2020 2020 2020 2020 6c61 7374 2e61 7070          last.app
+00021030: 656e 6428 7265 735f 6e75 6d29 0a20 2020  end(res_num).   
+00021040: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00021050: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00021060: 2020 2020 2020 2063 6f6e 7469 6773 2e61         contigs.a
+00021070: 7070 656e 6428 5b72 6573 5f6e 756d 5d29  ppend([res_num])
+00021080: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00021090: 636f 6e74 6967 730a 0a20 2020 2064 6566  contigs..    def
+000210a0: 2073 636f 7265 5f63 6861 696e 5f63 6f6e   score_chain_con
+000210b0: 7469 6728 7365 6c66 2c20 6368 6169 6e2c  tig(self, chain,
+000210c0: 2073 697a 6529 3a0a 2020 2020 2020 2020   size):.        
+000210d0: 2222 2247 656e 6572 6174 6520 736c 6964  """Generate slid
+000210e0: 696e 6720 7769 6e64 6f77 2073 636f 7265  ing window score
+000210f0: 7320 7768 6572 6520 7769 6e64 6f77 7320  s where windows 
+00021100: 646f 206e 6f74 2073 7061 6e20 6368 6169  do not span chai
+00021110: 6e20 6272 6561 6b73 2e22 0a0a 2020 2020  n breaks."..    
+00021120: 2020 2020 5468 6973 206d 6574 686f 6420      This method 
+00021130: 636f 6d70 7574 6573 2073 6c69 6469 6e67  computes sliding
+00021140: 2077 696e 646f 7773 206f 7665 7220 6561   windows over ea
+00021150: 6368 2063 6f6e 7469 6775 6f75 7320 7265  ch contiguous re
+00021160: 6769 6f6e 206f 6620 7468 6520 6368 6169  gion of the chai
+00021170: 6e2e 0a0a 2020 2020 2020 2020 4172 6773  n...        Args
+00021180: 3a0a 2020 2020 2020 2020 2020 2063 6861  :.           cha
+00021190: 696e 2028 7374 7229 3a20 5468 6520 6368  in (str): The ch
+000211a0: 6169 6e20 6e61 6d65 2074 6f20 6765 6e65  ain name to gene
+000211b0: 7261 7465 2077 696e 646f 7720 7363 6f72  rate window scor
+000211c0: 6573 2e0a 2020 2020 2020 2020 2020 2073  es..           s
+000211d0: 697a 6520 2869 6e74 293a 2054 6865 2073  ize (int): The s
+000211e0: 697a 6520 6f66 2074 6865 2077 696e 646f  ize of the windo
+000211f0: 772e 2053 686f 756c 6420 6265 2061 6e20  w. Should be an 
+00021200: 6f64 6420 6e75 6d62 6572 2e0a 2020 2020  odd number..    
+00021210: 2020 2020 5265 7475 726e 733a 0a20 2020      Returns:.   
+00021220: 2020 2020 2020 2020 4120 6469 6374 696f          A dictio
+00021230: 6e61 7279 206d 6170 7069 6e67 2065 6163  nary mapping eac
+00021240: 6820 7265 7369 6475 6520 746f 2069 7473  h residue to its
+00021250: 2073 636f 7265 2e0a 2020 2020 2020 2020   score..        
+00021260: 2222 220a 0a20 2020 2020 2020 2073 636f  """..        sco
+00021270: 7265 7320 3d20 7b7d 0a0a 2020 2020 2020  res = {}..      
+00021280: 2020 7265 735f 6d61 7070 696e 6720 3d20    res_mapping = 
+00021290: 7365 6c66 2e6d 6170 7069 6e67 5b63 6861  self.mapping[cha
+000212a0: 696e 5d0a 2020 2020 2020 2020 636f 6e74  in].        cont
+000212b0: 6967 7320 3d20 7365 6c66 2e5f 6765 745f  igs = self._get_
+000212c0: 636f 6e74 6967 7328 6368 6169 6e29 0a0a  contigs(chain)..
+000212d0: 2020 2020 2020 2020 666f 7220 636f 6e74          for cont
+000212e0: 6967 2069 6e20 636f 6e74 6967 733a 0a20  ig in contigs:. 
+000212f0: 2020 2020 2020 2020 2020 2072 6573 6964             resid
+00021300: 7565 5f61 746f 6d73 5f6c 6973 7420 3d20  ue_atoms_list = 
+00021310: 5b72 6573 5f6d 6170 7069 6e67 5b72 5d20  [res_mapping[r] 
+00021320: 666f 7220 7220 696e 2063 6f6e 7469 675d  for r in contig]
+00021330: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00021340: 7469 675f 7363 6f72 6573 203d 2073 656c  tig_scores = sel
+00021350: 662e 736c 6964 6572 2e73 636f 7265 7328  f.slider.scores(
+00021360: 7265 7369 6475 655f 6174 6f6d 735f 6c69  residue_atoms_li
+00021370: 7374 2c20 7369 7a65 290a 2020 2020 2020  st, size).      
+00021380: 2020 2020 2020 666f 7220 6b2c 2076 2069        for k, v i
+00021390: 6e20 7a69 7028 636f 6e74 6967 2c20 636f  n zip(contig, co
+000213a0: 6e74 6967 5f73 636f 7265 7329 3a0a 2020  ntig_scores):.  
+000213b0: 2020 2020 2020 2020 2020 2020 2020 7363                sc
+000213c0: 6f72 6573 5b6b 5d20 3d20 760a 0a20 2020  ores[k] = v..   
+000213d0: 2020 2020 2072 6574 7572 6e20 7363 6f72       return scor
+000213e0: 6573 0a0a 2020 2020 6465 6620 7363 6f72  es..    def scor
+000213f0: 655f 6368 6169 6e5f 7370 616e 2873 656c  e_chain_span(sel
+00021400: 662c 2063 6861 696e 2c20 7369 7a65 293a  f, chain, size):
+00021410: 0a20 2020 2020 2020 2022 2222 4765 6e65  .        """Gene
+00021420: 7261 7465 2073 6c69 6469 6e67 2077 696e  rate sliding win
+00021430: 646f 7720 7363 6f72 6573 2077 6865 7265  dow scores where
+00021440: 2077 696e 646f 7773 2064 6f20 7370 616e   windows do span
+00021450: 2063 6861 696e 2062 7265 616b 732e 0a0a   chain breaks...
+00021460: 2020 2020 2020 2020 5468 6973 206d 6574          This met
+00021470: 686f 6420 6967 6e6f 7265 7320 616e 7920  hod ignores any 
+00021480: 6272 6561 6b73 2069 6e20 7468 6520 6368  breaks in the ch
+00021490: 6169 6e2c 2073 6f20 7769 6e64 6f77 7320  ain, so windows 
+000214a0: 6d61 7920 696e 636c 7564 6520 6469 7374  may include dist
+000214b0: 616e 7420 7265 7369 6475 6573 2e0a 0a20  ant residues... 
+000214c0: 2020 2020 2020 2041 7267 733a 0a20 2020         Args:.   
+000214d0: 2020 2020 2020 2020 6368 6169 6e20 2873          chain (s
+000214e0: 7472 293a 2054 6865 2063 6861 696e 206e  tr): The chain n
+000214f0: 616d 6520 746f 2067 656e 6572 6174 6520  ame to generate 
+00021500: 7769 6e64 6f77 2073 636f 7265 732e 0a20  window scores.. 
+00021510: 2020 2020 2020 2020 2020 7369 7a65 2028            size (
+00021520: 696e 7429 3a20 5468 6520 7369 7a65 206f  int): The size o
+00021530: 6620 7468 6520 7769 6e64 6f77 2e20 5368  f the window. Sh
+00021540: 6f75 6c64 2062 6520 616e 206f 6464 206e  ould be an odd n
+00021550: 756d 6265 722e 0a20 2020 2020 2020 2052  umber..        R
+00021560: 6574 7572 6e73 3a0a 2020 2020 2020 2020  eturns:.        
+00021570: 2020 2041 2064 6963 7469 6f6e 6172 7920     A dictionary 
+00021580: 6d61 7070 696e 6720 6561 6368 2072 6573  mapping each res
+00021590: 6964 7565 2074 6f20 6974 7320 7363 6f72  idue to its scor
+000215a0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
+000215b0: 2020 2020 2020 2072 6573 6964 7565 5f6d         residue_m
+000215c0: 6170 7069 6e67 203d 2073 656c 662e 6d61  apping = self.ma
+000215d0: 7070 696e 675b 6368 6169 6e5d 0a20 2020  pping[chain].   
+000215e0: 2020 2020 2072 6573 6964 7565 5f61 746f       residue_ato
+000215f0: 6d73 5f6c 6973 7420 3d20 6c69 7374 2872  ms_list = list(r
+00021600: 6573 6964 7565 5f6d 6170 7069 6e67 2e76  esidue_mapping.v
+00021610: 616c 7565 7328 2929 0a20 2020 2020 2020  alues()).       
+00021620: 206e 756d 6265 7273 203d 2072 6573 6964   numbers = resid
+00021630: 7565 5f6d 6170 7069 6e67 2e6b 6579 7328  ue_mapping.keys(
+00021640: 290a 2020 2020 2020 2020 7363 6f72 6573  ).        scores
+00021650: 203d 2073 656c 662e 736c 6964 6572 2e73   = self.slider.s
+00021660: 636f 7265 7328 7265 7369 6475 655f 6174  cores(residue_at
+00021670: 6f6d 735f 6c69 7374 2c20 7369 7a65 290a  oms_list, size).
+00021680: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00021690: 7b6b 3a20 7620 666f 7220 6b2c 2076 2069  {k: v for k, v i
+000216a0: 6e20 7a69 7028 6e75 6d62 6572 732c 2073  n zip(numbers, s
+000216b0: 636f 7265 7329 7d0a 0a0a 636c 6173 7320  cores)}...class 
+000216c0: 5f41 6363 756d 756c 6174 6f72 3a0a 2020  _Accumulator:.  
+000216d0: 2020 2222 2241 6e20 6163 6375 6d75 6c61    """An accumula
+000216e0: 746f 7220 636f 6d70 7574 6573 2061 2073  tor computes a s
+000216f0: 636f 7265 206f 7665 7220 6120 736c 6964  core over a slid
+00021700: 696e 6720 7769 6e64 6f77 206f 6620 6174  ing window of at
+00021710: 6f6d 7322 2222 0a0a 2020 2020 6465 6620  oms"""..    def 
+00021720: 6164 645f 6174 6f6d 2873 656c 662c 2061  add_atom(self, a
+00021730: 746f 6d29 3a0a 2020 2020 2020 2020 7061  tom):.        pa
+00021740: 7373 0a0a 2020 2020 6465 6620 6465 6c5f  ss..    def del_
+00021750: 6174 6f6d 2873 656c 662c 2061 746f 6d29  atom(self, atom)
+00021760: 3a0a 2020 2020 2020 2020 7061 7373 0a0a  :.        pass..
+00021770: 2020 2020 6465 6620 6765 745f 7661 6c28      def get_val(
+00021780: 7365 6c66 293a 0a20 2020 2020 2020 2070  self):.        p
+00021790: 6173 730a 0a20 2020 2064 6566 207a 6572  ass..    def zer
+000217a0: 6f28 7365 6c66 293a 0a20 2020 2020 2020  o(self):.       
+000217b0: 2070 6173 730a 0a0a 636c 6173 7320 5f4d   pass...class _M
+000217c0: 4f43 4163 6375 6d75 6c61 746f 7228 5f41  OCAccumulator(_A
+000217d0: 6363 756d 756c 6174 6f72 293a 0a20 2020  ccumulator):.   
+000217e0: 2022 2222 506c 6163 6568 6f6c 6465 7220   """Placeholder 
+000217f0: 646f 6373 7472 696e 670a 2020 2020 2222  docstring.    ""
+00021800: 220a 0a20 2020 2064 6566 205f 5f69 6e69  "..    def __ini
+00021810: 745f 5f28 7365 6c66 2c20 6578 705f 6d61  t__(self, exp_ma
+00021820: 702c 2073 696d 5f6d 6170 2c20 7261 6469  p, sim_map, radi
+00021830: 7573 293a 0a20 2020 2020 2020 2066 726f  us):.        fro
+00021840: 6d20 6d61 7468 2069 6d70 6f72 7420 6365  m math import ce
+00021850: 696c 2c20 6c6f 672c 2070 6f77 0a20 2020  il, log, pow.   
+00021860: 2020 2020 2069 6d70 6f72 7420 766f 7863       import voxc
+00021870: 6f76 2061 7320 7663 0a0a 2020 2020 2020  ov as vc..      
+00021880: 2020 6d61 785f 6469 6d20 3d20 6d61 7828    max_dim = max(
+00021890: 6578 705f 6d61 702e 626f 785f 7369 7a65  exp_map.box_size
+000218a0: 2829 290a 2020 2020 2020 2020 6e65 7874  ()).        next
+000218b0: 5f70 6f77 3220 3d20 696e 7428 706f 7728  _pow2 = int(pow(
+000218c0: 322c 2063 6569 6c28 6c6f 6728 6d61 785f  2, ceil(log(max_
+000218d0: 6469 6d29 202f 206c 6f67 2832 2929 2929  dim) / log(2))))
+000218e0: 0a20 2020 2020 2020 2073 656c 662e 7261  .        self.ra
+000218f0: 6469 7573 203d 2072 6164 6975 730a 0a20  dius = radius.. 
+00021900: 2020 2020 2020 2073 656c 662e 6d6f 6320         self.moc 
+00021910: 3d20 7663 2e53 4d4f 4328 0a20 2020 2020  = vc.SMOC(.     
+00021920: 2020 2020 2020 2065 7870 5f6d 6170 2e61         exp_map.a
+00021930: 7069 782c 0a20 2020 2020 2020 2020 2020  pix,.           
+00021940: 2065 7870 5f6d 6170 2e6f 7269 6769 6e2c   exp_map.origin,
+00021950: 0a20 2020 2020 2020 2020 2020 206e 6578  .            nex
+00021960: 745f 706f 7732 2c0a 2020 2020 2020 2020  t_pow2,.        
+00021970: 2020 2020 5b65 7870 5f6d 6170 2e78 5f73      [exp_map.x_s
+00021980: 697a 6528 292c 2065 7870 5f6d 6170 2e79  ize(), exp_map.y
+00021990: 5f73 697a 6528 292c 2065 7870 5f6d 6170  _size(), exp_map
+000219a0: 2e7a 5f73 697a 6528 295d 2c0a 2020 2020  .z_size()],.    
+000219b0: 2020 2020 2020 2020 6e70 2e61 7363 6f6e          np.ascon
+000219c0: 7469 6775 6f75 7361 7272 6179 2865 7870  tiguousarray(exp
+000219d0: 5f6d 6170 2e66 756c 6c4d 6170 2c20 6474  _map.fullMap, dt
+000219e0: 7970 653d 2266 6c6f 6174 3634 2229 2c0a  ype="float64"),.
+000219f0: 2020 2020 2020 2020 2020 2020 6e70 2e61              np.a
+00021a00: 7363 6f6e 7469 6775 6f75 7361 7272 6179  scontiguousarray
+00021a10: 2873 696d 5f6d 6170 2e66 756c 6c4d 6170  (sim_map.fullMap
+00021a20: 2c20 6474 7970 653d 2266 6c6f 6174 3634  , dtype="float64
+00021a30: 2229 2c0a 2020 2020 2020 2020 290a 0a20  "),.        ).. 
+00021a40: 2020 2064 6566 2061 6464 5f61 746f 6d28     def add_atom(
+00021a50: 7365 6c66 2c20 6174 6f6d 293a 0a20 2020  self, atom):.   
+00021a60: 2020 2020 2073 656c 662e 6d6f 632e 6164       self.moc.ad
+00021a70: 645f 7370 6865 7265 285b 6174 6f6d 2e78  d_sphere([atom.x
+00021a80: 2c20 6174 6f6d 2e79 2c20 6174 6f6d 2e7a  , atom.y, atom.z
+00021a90: 5d2c 2073 656c 662e 7261 6469 7573 290a  ], self.radius).
+00021aa0: 0a20 2020 2064 6566 2064 656c 5f61 746f  .    def del_ato
+00021ab0: 6d28 7365 6c66 2c20 6174 6f6d 293a 0a20  m(self, atom):. 
+00021ac0: 2020 2020 2020 2073 656c 662e 6d6f 632e         self.moc.
+00021ad0: 6465 6c5f 7370 6865 7265 285b 6174 6f6d  del_sphere([atom
+00021ae0: 2e78 2c20 6174 6f6d 2e79 2c20 6174 6f6d  .x, atom.y, atom
+00021af0: 2e7a 5d2c 2073 656c 662e 7261 6469 7573  .z], self.radius
+00021b00: 290a 0a20 2020 2064 6566 2067 6574 5f76  )..    def get_v
+00021b10: 616c 2873 656c 6629 3a0a 2020 2020 2020  al(self):.      
+00021b20: 2020 7265 7475 726e 2073 656c 662e 6d6f    return self.mo
+00021b30: 632e 6765 745f 7661 6c28 290a 0a20 2020  c.get_val()..   
+00021b40: 2064 6566 207a 6572 6f28 7365 6c66 293a   def zero(self):
+00021b50: 0a20 2020 2020 2020 2073 656c 662e 6d6f  .        self.mo
+00021b60: 632e 7a65 726f 2829 0a0a 0a63 6c61 7373  c.zero()...class
+00021b70: 2046 6173 7453 4d4f 4328 5f41 6273 7472   FastSMOC(_Abstr
+00021b80: 6163 7453 6c69 6469 6e67 5363 6f72 6529  actSlidingScore)
+00021b90: 3a0a 2020 2020 2222 2241 2066 6173 7465  :.    """A faste
+00021ba0: 7220 7665 7273 696f 6e20 6f66 2074 6865  r version of the
+00021bb0: 2073 6c69 6469 6e67 2077 696e 646f 7720   sliding window 
+00021bc0: 534d 4f43 2073 636f 7265 2e0a 0a20 2020  SMOC score...   
+00021bd0: 2055 6e6c 696b 6520 7468 6520 6f72 6967   Unlike the orig
+00021be0: 696e 616c 2061 6c67 6f72 6974 686d 2c20  inal algorithm, 
+00021bf0: 7468 6973 206f 6e65 7320 6973 206f 7074  this ones is opt
+00021c00: 696d 697a 6564 2069 6e20 7468 650a 2020  imized in the.  
+00021c10: 2020 666f 6c6c 6f77 696e 6720 7761 7973    following ways
+00021c20: 3a0a 0a20 2020 202a 206c 617a 696c 7920  :..    * lazily 
+00021c30: 6465 7465 726d 696e 6573 2072 6571 7569  determines requi
+00021c40: 7265 6420 766f 7865 6c73 2073 6176 696e  red voxels savin
+00021c50: 6720 7370 6163 6520 616e 6420 7469 6d65  g space and time
+00021c60: 2e0a 2020 2020 2a20 5468 6520 736c 6964  ..    * The slid
+00021c70: 696e 672d 7769 6e64 6f77 2063 616c 6375  ing-window calcu
+00021c80: 6c61 7469 6f6e 2069 7320 7065 7266 6f72  lation is perfor
+00021c90: 6d65 6420 696e 2074 696d 6520 7072 6f70  med in time prop
+00021ca0: 6f72 7469 6f6e 616c 0a20 2020 2020 206f  ortional.      o
+00021cb0: 6e6c 7920 746f 2063 6861 696e 2073 697a  nly to chain siz
+00021cc0: 6520 616e 6420 6e6f 7420 7769 6e64 6f77  e and not window
+00021cd0: 2073 697a 652e 0a0a 2020 2020 5468 6973   size...    This
+00021ce0: 206d 6574 686f 6420 646f 6573 206e 6f74   method does not
+00021cf0: 206f 6666 6572 2061 6c6c 2074 6865 2062   offer all the b
+00021d00: 656c 6c73 2061 6e64 2077 6869 7374 6c65  ells and whistle
+00021d10: 7320 6f66 206f 6c64 2053 4d4f 430a 2020  s of old SMOC.  
+00021d20: 2020 6675 6e63 7469 6f6e 2073 7563 6820    function such 
+00021d30: 6173 2072 6967 6964 2062 6f64 7920 7061  as rigid body pa
+00021d40: 7261 6d65 7465 7273 2e20 2048 6f77 6576  rameters.  Howev
+00021d50: 6572 2c20 7477 6f20 616c 7465 726e 6174  er, two alternat
+00021d60: 6976 650a 2020 2020 6d65 7468 6f64 7320  ive.    methods 
+00021d70: 6172 6520 7072 6f76 6964 6564 2066 6f72  are provided for
+00021d80: 2064 6561 6c69 6e67 2077 6974 6820 534d   dealing with SM
+00021d90: 4f43 2073 636f 7265 7320 666f 7220 756e  OC scores for un
+00021da0: 6d6f 6465 6c6c 6564 0a20 2020 2072 6567  modelled.    reg
+00021db0: 696f 6e73 2e0a 0a20 2020 2054 6865 2066  ions...    The f
+00021dc0: 756e 6374 696f 6e20 6073 636f 7265 5f63  unction `score_c
+00021dd0: 6861 696e 5f63 6f6e 7469 6760 2c20 7769  hain_contig`, wi
+00021de0: 6c6c 2073 636f 7265 2061 6c6c 2063 6f6e  ll score all con
+00021df0: 7469 6773 2069 6e20 610a 2020 2020 6368  tigs in a.    ch
+00021e00: 6169 6e20 7768 6572 6520 6561 6368 2077  ain where each w
+00021e10: 696e 646f 7720 6f6e 6c79 2063 6f6e 7461  indow only conta
+00021e20: 696e 7320 7265 7369 6475 6573 2062 656c  ins residues bel
+00021e30: 6f6e 6769 6e67 2074 6f20 7468 650a 2020  onging to the.  
+00021e40: 2020 636f 6e74 6967 2e0a 0a20 2020 2054    contig...    T
+00021e50: 6865 2066 756e 6374 696f 6e20 6073 636f  he function `sco
+00021e60: 7265 5f63 6861 696e 5f73 7061 6e60 206d  re_chain_span` m
+00021e70: 696d 6963 6b73 2074 6865 206f 6c64 2053  imicks the old S
+00021e80: 4d4f 4320 6265 6861 7669 6f75 722e 0a20  MOC behaviour.. 
+00021e90: 2020 2057 696e 646f 7773 2069 676e 6f72     Windows ignor
+00021ea0: 6520 636f 6e74 6967 7320 626f 756e 6461  e contigs bounda
+00021eb0: 7269 6573 2028 7468 6579 2027 7370 616e  ries (they 'span
+00021ec0: 2720 7468 656d 292c 2074 6875 7320 7265  ' them), thus re
+00021ed0: 7369 6475 6573 0a20 2020 2069 6e20 7769  sidues.    in wi
+00021ee0: 6e64 6f77 7320 6d61 7920 6265 2070 6879  ndows may be phy
+00021ef0: 7369 6361 6c6c 7920 6469 7374 616e 742e  sically distant.
+00021f00: 0a0a 2020 2020 496e 2067 656e 6572 616c  ..    In general
+00021f10: 2c20 7468 6520 636f 6e73 6964 6572 2075  , the consider u
+00021f20: 7369 6e67 2074 6865 2060 7363 6f72 655f  sing the `score_
+00021f30: 6368 6169 6e5f 636f 6e74 6967 6020 6d65  chain_contig` me
+00021f40: 7468 6f64 2e0a 0a0a 2020 2020 4172 6773  thod....    Args
+00021f50: 3a0a 2020 2020 2020 2020 7374 7275 6374  :.        struct
+00021f60: 2028 3a63 6c61 7373 3a60 4269 6f50 795f   (:class:`BioPy_
+00021f70: 5374 7275 6374 7572 6520 3c54 454d 5079  Structure <TEMPy
+00021f80: 2e70 726f 7465 696e 2e70 726f 745f 7265  .protein.prot_re
+00021f90: 705f 6269 6f70 792e 4269 6f50 795f 5374  p_biopy.BioPy_St
+00021fa0: 7275 6374 7572 653e 6029 3a20 4d6f 6465  ructure>`): Mode
+00021fb0: 6c20 746f 2073 636f 7265 0a20 2020 2020  l to score.     
+00021fc0: 2020 2065 7870 5f6d 6170 2028 3a63 6c61     exp_map (:cla
+00021fd0: 7373 3a60 454d 4d61 7020 3c54 454d 5079  ss:`EMMap <TEMPy
+00021fe0: 2e6d 6170 732e 656d 5f6d 6170 2e4d 6170  .maps.em_map.Map
+00021ff0: 3e60 293a 2045 7870 6572 696d 656e 7461  >`): Experimenta
+00022000: 6c20 6465 6e73 6974 7920 6d61 700a 2020  l density map.  
+00022010: 2020 2020 2020 7265 736f 6c75 7469 6f6e        resolution
+00022020: 2028 666c 6f61 7429 3a20 5468 6520 7265   (float): The re
+00022030: 736f 6c75 7469 6f6e 206f 6620 7468 6520  solution of the 
+00022040: 6578 7065 7269 6d65 6e74 616c 206d 6170  experimental map
+00022050: 0a20 2020 2020 2020 2073 6967 6d61 5f63  .        sigma_c
+00022060: 6f65 6666 2028 666c 6f61 742c 206f 7074  oeff (float, opt
+00022070: 696f 6e61 6c29 3a20 5468 6520 7369 676d  ional): The sigm
+00022080: 6120 636f 6566 6669 6369 656e 7420 666f  a coefficient fo
+00022090: 7220 7369 6d75 6c61 7469 6e67 2074 6865  r simulating the
+000220a0: 206d 6170 2e20 4465 6661 756c 7473 2074   map. Defaults t
+000220b0: 6f20 302e 3232 352e 0a20 2020 2020 2020  o 0.225..       
+000220c0: 2073 6967 6d61 5f74 6872 6573 686f 6c64   sigma_threshold
+000220d0: 2028 666c 6f61 742c 206f 7074 696f 6e61   (float, optiona
+000220e0: 6c29 3a20 5468 6520 7369 676d 6120 7468  l): The sigma th
+000220f0: 7265 7368 6f6c 6420 6465 7465 726d 696e  reshold determin
+00022100: 6573 2074 6865 2072 6164 6975 7320 6172  es the radius ar
+00022110: 6f75 6e64 2074 6865 2061 746f 6d73 2074  ound the atoms t
+00022120: 6f20 636f 6e73 6964 6572 2e20 4465 6661  o consider. Defa
+00022130: 756c 7473 2074 6f20 322e 352e 0a20 2020  ults to 2.5..   
+00022140: 2020 2020 2073 696d 5f6d 6170 2028 454d       sim_map (EM
+00022150: 4d61 702c 206f 7074 696f 6e61 6c29 3a20  Map, optional): 
+00022160: 4120 7369 6d75 6c61 7465 6420 6d61 7020  A simulated map 
+00022170: 746f 2075 7365 2069 6e73 7465 6164 206f  to use instead o
+00022180: 6620 6765 6e65 7261 7469 6e67 206f 6e65  f generating one
+00022190: 2e0a 2020 2020 5265 7475 726e 733a 0a20  ..    Returns:. 
+000221a0: 2020 2020 2020 2046 6173 7453 4d4f 4320         FastSMOC 
+000221b0: 6f62 6a65 6374 0a20 2020 2022 2222 0a0a  object.    """..
+000221c0: 2020 2020 6465 6620 5f5f 696e 6974 5f5f      def __init__
+000221d0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+000221e0: 2020 2020 2020 2020 7374 7275 6374 2c0a          struct,.
+000221f0: 2020 2020 2020 2020 6578 705f 6d61 702c          exp_map,
+00022200: 0a20 2020 2020 2020 2072 6573 6f6c 7574  .        resolut
+00022210: 696f 6e2c 0a20 2020 2020 2020 2073 6967  ion,.        sig
+00022220: 6d61 5f63 6f65 6666 3d30 2e32 3235 2c0a  ma_coeff=0.225,.
+00022230: 2020 2020 2020 2020 7369 676d 615f 7468          sigma_th
+00022240: 7265 7368 6f6c 643d 322e 352c 0a20 2020  reshold=2.5,.   
+00022250: 2020 2020 2073 696d 5f6d 6170 3d4e 6f6e       sim_map=Non
+00022260: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
+00022270: 2020 7261 6469 7573 203d 2073 6967 6d61    radius = sigma
+00022280: 5f74 6872 6573 686f 6c64 202a 206d 6178  _threshold * max
+00022290: 2873 6967 6d61 5f63 6f65 6666 202a 2072  (sigma_coeff * r
+000222a0: 6573 6f6c 7574 696f 6e2c 2031 2e30 290a  esolution, 1.0).
+000222b0: 2020 2020 2020 2020 6966 2073 696d 5f6d          if sim_m
+000222c0: 6170 2069 7320 4e6f 6e65 3a0a 2020 2020  ap is None:.    
+000222d0: 2020 2020 2020 2020 7369 6d5f 6d61 7020          sim_map 
+000222e0: 3d20 5374 7275 6374 7572 6542 6c75 7272  = StructureBlurr
+000222f0: 6572 2829 2e67 6175 7373 6961 6e5f 626c  er().gaussian_bl
+00022300: 7572 5f72 6561 6c5f 7370 6163 6528 0a20  ur_real_space(. 
+00022310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00022320: 2020 2073 7472 7563 742c 0a20 2020 2020     struct,.     
+00022330: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00022340: 6573 6f6c 7574 696f 6e2c 0a20 2020 2020  esolution,.     
+00022350: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00022360: 7870 5f6d 6170 2c0a 2020 2020 2020 2020  xp_map,.        
+00022370: 2020 2020 2020 2020 2020 2020 7369 676d              sigm
+00022380: 615f 636f 6566 663d 7369 676d 615f 636f  a_coeff=sigma_co
+00022390: 6566 660a 2020 2020 2020 2020 2020 2020  eff.            
+000223a0: 290a 2020 2020 2020 2020 6d6f 6320 3d20  ).        moc = 
+000223b0: 5f4d 4f43 4163 6375 6d75 6c61 746f 7228  _MOCAccumulator(
+000223c0: 6578 705f 6d61 702c 2073 696d 5f6d 6170  exp_map, sim_map
+000223d0: 2c20 7261 6469 7573 290a 2020 2020 2020  , radius).      
+000223e0: 2020 7375 7065 7228 292e 5f5f 696e 6974    super().__init
+000223f0: 5f5f 2873 7472 7563 742c 206d 6f63 290a  __(struct, moc).
+00022400: 0a0a 636c 6173 7320 4661 7374 5343 4343  ..class FastSCCC
+00022410: 3a0a 2020 2020 6465 6620 5f5f 696e 6974  :.    def __init
+00022420: 5f5f 280a 2020 2020 2020 2020 2020 2020  __(.            
+00022430: 7365 6c66 2c0a 2020 2020 2020 2020 2020  self,.          
+00022440: 2020 7374 7275 6374 7572 652c 0a20 2020    structure,.   
+00022450: 2020 2020 2020 2020 206d 6170 5f74 6172           map_tar
+00022460: 6765 742c 0a20 2020 2020 2020 2020 2020  get,.           
+00022470: 2072 6573 6f6c 7574 696f 6e2c 0a20 2020   resolution,.   
+00022480: 2020 2020 2020 2020 2073 6967 6d61 5f63           sigma_c
+00022490: 6f65 6666 3d30 2e32 3235 2c0a 2020 2020  oeff=0.225,.    
+000224a0: 293a 0a20 2020 2020 2020 2022 2222 4361  ):.        """Ca
+000224b0: 6c63 756c 6174 6520 6c6f 6361 6c20 6372  lculate local cr
+000224c0: 6f73 732d 636f 7272 656c 6174 696f 6e20  oss-correlation 
+000224d0: 666f 7220 6120 7365 676d 656e 7420 6f66  for a segment of
+000224e0: 2061 2070 726f 7465 696e 206d 6f64 656c   a protein model
+000224f0: 2e0a 0a20 2020 2020 2020 2041 7267 733a  ...        Args:
+00022500: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
+00022510: 7563 7475 7265 3a20 5468 6520 656e 7469  ucture: The enti
+00022520: 7265 2061 746f 6d69 6320 7374 7275 6374  re atomic struct
+00022530: 7572 650a 2020 2020 2020 2020 2020 2020  ure.            
+00022540: 6d61 705f 7461 7267 6574 3a20 416e 2065  map_target: An e
+00022550: 7870 6572 696d 656e 7461 6c20 6d61 702e  xperimental map.
+00022560: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00022570: 6f6c 7574 696f 6e3a 2054 6865 2073 6573  olution: The ses
+00022580: 6f6c 7574 696f 6e20 6f66 2074 6865 2065  olution of the e
+00022590: 7870 6572 696d 656e 7461 6c20 6d61 702e  xperimental map.
+000225a0: 0a20 2020 2020 2020 2020 2020 2073 6967  .            sig
+000225b0: 6d61 5f63 6f65 6666 3a20 5468 6520 7369  ma_coeff: The si
+000225c0: 676d 6120 636f 6566 6669 6369 656e 7420  gma coefficient 
+000225d0: 666f 7220 626c 7572 7269 6e67 2e0a 2020  for blurring..  
+000225e0: 2020 2020 2020 2020 2020 2020 2020 3a72                :r
+000225f0: 6566 3a60 6865 7265 3c4e 6f74 6520 6f6e  ef:`here<Note on
+00022600: 2072 6561 6c20 7370 6163 6520 626c 7572   real space blur
+00022610: 7269 6e67 3a3e 600a 2020 2020 2020 2020  ring:>`.        
+00022620: 5265 7475 726e 733a 0a20 2020 2020 2020  Returns:.       
+00022630: 2020 2020 2041 2053 4343 4320 6f62 6a65       A SCCC obje
+00022640: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
+00022650: 2020 2020 2020 2020 7365 6c66 2e62 6c75          self.blu
+00022660: 7272 6572 203d 2053 7472 7563 7475 7265  rrer = Structure
+00022670: 426c 7572 7265 7228 290a 2020 2020 2020  Blurrer().      
+00022680: 2020 7365 6c66 2e73 636f 7265 7220 3d20    self.scorer = 
+00022690: 5363 6f72 696e 6746 756e 6374 696f 6e73  ScoringFunctions
+000226a0: 2829 0a20 2020 2020 2020 2073 656c 662e  ().        self.
+000226b0: 6d61 705f 7461 7267 6574 203d 206d 6170  map_target = map
+000226c0: 5f74 6172 6765 740a 2020 2020 2020 2020  _target.        
+000226d0: 7365 6c66 2e72 6573 6f6c 7574 696f 6e20  self.resolution 
+000226e0: 3d20 7265 736f 6c75 7469 6f6e 0a20 2020  = resolution.   
+000226f0: 2020 2020 2073 656c 662e 7369 676d 615f       self.sigma_
+00022700: 636f 6566 6620 3d20 7369 676d 615f 636f  coeff = sigma_co
+00022710: 6566 660a 2020 2020 2020 2020 7365 6c66  eff.        self
+00022720: 2e77 686f 6c65 5f73 696d 5f6d 6170 203d  .whole_sim_map =
+00022730: 2073 656c 662e 626c 7572 7265 722e 6761   self.blurrer.ga
+00022740: 7573 7369 616e 5f62 6c75 725f 7265 616c  ussian_blur_real
+00022750: 5f73 7061 6365 280a 2020 2020 2020 2020  _space(.        
+00022760: 2020 2020 7374 7275 6374 7572 652c 0a20      structure,. 
+00022770: 2020 2020 2020 2020 2020 2072 6573 6f6c             resol
+00022780: 7574 696f 6e2c 0a20 2020 2020 2020 2020  ution,.         
+00022790: 2020 2064 656e 734d 6170 3d6d 6170 5f74     densMap=map_t
+000227a0: 6172 6765 742c 0a20 2020 2020 2020 2020  arget,.         
+000227b0: 2020 2073 6967 6d61 5f63 6f65 6666 3d73     sigma_coeff=s
+000227c0: 6967 6d61 5f63 6f65 6666 2c0a 2020 2020  igma_coeff,.    
+000227d0: 2020 2020 2020 2020 6e6f 726d 616c 6973          normalis
+000227e0: 653d 5472 7565 2c0a 2020 2020 2020 2020  e=True,.        
+000227f0: 290a 0a20 2020 2064 6566 2073 636f 7265  )..    def score
+00022800: 5f73 6567 6d65 6e74 2873 656c 662c 2073  _segment(self, s
+00022810: 6567 6d65 6e74 5f73 7472 7563 7475 7265  egment_structure
+00022820: 293a 0a20 2020 2020 2020 2022 2222 5363  ):.        """Sc
+00022830: 6f72 6520 6120 7365 676d 656e 7420 6f66  ore a segment of
+00022840: 2074 6865 2073 7472 7563 7475 7265 2e0a   the structure..
+00022850: 0a20 2020 2020 2020 2041 7267 733a 0a20  .        Args:. 
+00022860: 2020 2020 2020 2020 2020 2073 6567 6d65             segme
+00022870: 6e74 3a20 416e 2061 746f 6d69 6320 7374  nt: An atomic st
+00022880: 7275 6374 7572 6520 7768 6963 6820 7368  ructure which sh
+00022890: 6f75 6c64 2062 6520 6120 636f 6d70 6f6e  ould be a compon
+000228a0: 656e 740a 2020 2020 2020 2020 5265 7475  ent.        Retu
+000228b0: 726e 733a 0a20 2020 2020 2020 2020 2020  rns:.           
+000228c0: 2043 4343 2073 636f 7265 3a20 2866 6c6f   CCC score: (flo
+000228d0: 6174 290a 2020 2020 2020 2020 2222 220a  at).        """.
+000228e0: 2020 2020 2020 2020 7365 676d 656e 745f          segment_
+000228f0: 7369 6d5f 6d61 7020 3d20 7365 6c66 2e62  sim_map = self.b
+00022900: 6c75 7272 6572 2e67 6175 7373 6961 6e5f  lurrer.gaussian_
+00022910: 626c 7572 5f72 6561 6c5f 7370 6163 6528  blur_real_space(
+00022920: 0a20 2020 2020 2020 2020 2020 2073 6567  .            seg
+00022930: 6d65 6e74 5f73 7472 7563 7475 7265 2c0a  ment_structure,.
+00022940: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00022950: 2e72 6573 6f6c 7574 696f 6e2c 0a20 2020  .resolution,.   
+00022960: 2020 2020 2020 2020 2073 656c 662e 6d61           self.ma
+00022970: 705f 7461 7267 6574 2c0a 2020 2020 2020  p_target,.      
+00022980: 2020 2020 2020 7365 6c66 2e73 6967 6d61        self.sigma
+00022990: 5f63 6f65 6666 2c0a 2020 2020 2020 2020  _coeff,.        
+000229a0: 2020 2020 6e6f 726d 616c 6973 653d 5472      normalise=Tr
+000229b0: 7565 2c0a 2020 2020 2020 2020 290a 2020  ue,.        ).  
+000229c0: 2020 2020 2020 6d69 6e44 656e 7320 3d20        minDens = 
+000229d0: 7365 676d 656e 745f 7369 6d5f 6d61 702e  segment_sim_map.
+000229e0: 7374 6428 290a 2020 2020 2020 2020 7365  std().        se
+000229f0: 676d 656e 745f 6d61 736b 203d 2073 6567  gment_mask = seg
+00022a00: 6d65 6e74 5f73 696d 5f6d 6170 2e5f 6765  ment_sim_map._ge
+00022a10: 745f 6d61 736b 4172 7261 7928 6d69 6e44  t_maskArray(minD
+00022a20: 656e 7329 0a20 2020 2020 2020 2074 6172  ens).        tar
+00022a30: 6765 745f 6d61 736b 6564 203d 2073 656c  get_masked = sel
+00022a40: 662e 6d61 705f 7461 7267 6574 2e5f 6765  f.map_target._ge
+00022a50: 745f 6d61 736b 4d61 7028 7365 676d 656e  t_maskMap(segmen
+00022a60: 745f 6d61 736b 290a 2020 2020 2020 2020  t_mask).        
+00022a70: 7369 6d5f 6d61 736b 6564 203d 2073 656c  sim_masked = sel
+00022a80: 662e 7768 6f6c 655f 7369 6d5f 6d61 702e  f.whole_sim_map.
+00022a90: 5f67 6574 5f6d 6173 6b4d 6170 2873 6567  _get_maskMap(seg
+00022aa0: 6d65 6e74 5f6d 6173 6b29 0a20 2020 2020  ment_mask).     
+00022ab0: 2020 2073 7365 2c20 5f20 3d20 7365 6c66     sse, _ = self
+00022ac0: 2e73 636f 7265 722e 4343 435f 6d61 7028  .scorer.CCC_map(
+00022ad0: 7461 7267 6574 5f6d 6173 6b65 642c 2073  target_masked, s
+00022ae0: 696d 5f6d 6173 6b65 642c 2063 6d6f 6465  im_masked, cmode
+00022af0: 3d46 616c 7365 290a 2020 2020 2020 2020  =False).        
+00022b00: 7265 7475 726e 2073 7365 0a0a 0a         return sse...
```

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/structure_blurrer.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/structure_blurrer.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/protein/structure_parser.py` & `BioTEMPy-2.1.0a0/TEMPy/protein/structure_parser.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/gamma.py` & `BioTEMPy-2.1.0a0/TEMPy/script/gamma.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/loqfit.py` & `BioTEMPy-2.1.0a0/TEMPy/script/loqfit.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/mi.py` & `BioTEMPy-2.1.0a0/TEMPy/script/mi.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/output.py` & `BioTEMPy-2.1.0a0/TEMPy/script/output.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/sccc.py` & `BioTEMPy-2.1.0a0/TEMPy/script/sccc.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/script/smoc.py` & `BioTEMPy-2.1.0a0/TEMPy/script/smoc.py`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/TEMPy/tempy_data/quaternion_vectors_5000.pk` & `BioTEMPy-2.1.0a0/TEMPy/tempy_data/quaternion_vectors_5000.pk`

 * *Files identical despite different names*

### Comparing `BioTEMPy-2.1.0/setup.py` & `BioTEMPy-2.1.0a0/setup.py`

 * *Files 12% similar despite different names*

```diff
@@ -7,15 +7,15 @@
 
 if os.path.exists('build') is True:
     print('build exists')
     shutil.rmtree('./build')
 
 setup(
     name='BioTEMPy',
-    version='2.1.0',
+    version='2.1.0-alpha',
     author='Maya Topf, Daven Vasishtan, Arun Prasad Pandurangan, Irene Farabella, Agnel-Praveen Joseph, Harpal Sahota',
     author_email='tempy-help@cryst.bbk.ac.uk',
     packages=setuptools.find_packages(),
     url='http://tempy.ismb.lon.ac.uk/',
     description='TEMPy: a Python Library for Assessment of 3D Electron Microscopy Density Fits',
     package_dir={'TEMPy': 'TEMPy'},
     python_requires='>=3.7',
@@ -34,11 +34,10 @@
         "Operating System :: OS Independent",
     ],
     package_data={'TEMPy': ['tempy_data/*.pk']},
     entry_points = {
         'console_scripts': ['TEMPy.smoc=TEMPy.script.smoc:main',
                             'TEMPy.gamma=TEMPy.script.gamma:main',
                             'TEMPy.loqfit=TEMPy.script.loqfit:main',
-                            'TEMPy.sccc=TEMPy.script.sccc:main',
-                            'TEMPy.scores=TEMPy.script.scores:main']
+                            'TEMPy.sccc=TEMPy.script.sccc:main']
     }
 )
```

