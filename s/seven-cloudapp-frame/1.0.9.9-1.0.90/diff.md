# Comparing `tmp/seven_cloudapp_frame-1.0.9.9.tar.gz` & `tmp/seven_cloudapp_frame-1.0.90.tar.gz`

## filetype from file(1)

```diff
@@ -1 +1 @@
-gzip compressed data, was "dist\seven_cloudapp_frame-1.0.9.9.tar", last modified: Fri Oct 29 05:34:54 2021, max compression
+gzip compressed data, was "dist/seven_cloudapp_frame-1.0.90.tar", last modified: Fri Jul 21 02:15:22 2023, max compression
```

## Comparing `seven_cloudapp_frame-1.0.9.9.tar` & `seven_cloudapp_frame-1.0.90.tar`

### file list

```diff
@@ -1,191 +1,244 @@
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.940537 seven_cloudapp_frame-1.0.9.9/
--rw-rw-rw-   0        0        0     2369 2021-10-29 05:34:54.939537 seven_cloudapp_frame-1.0.9.9/PKG-INFO
--rw-rw-rw-   0        0        0     1158 2021-10-28 03:30:33.000000 seven_cloudapp_frame-1.0.9.9/README.md
--rw-rw-rw-   0        0        0       42 2021-10-29 05:34:54.940537 seven_cloudapp_frame-1.0.9.9/setup.cfg
--rw-rw-rw-   0        0        0     1483 2021-10-29 05:34:44.000000 seven_cloudapp_frame-1.0.9.9/setup.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:53.813537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/
--rw-rw-rw-   0        0        0      164 2021-08-26 01:25:55.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/__init__.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:53.907537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/
--rw-rw-rw-   0        0        0      182 2021-07-15 04:00:34.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/__init__.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.118537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/
--rw-rw-rw-   0        0        0      261 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/__init__.py
--rw-rw-rw-   0        0        0     2962 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/act.py
--rw-rw-rw-   0        0        0   411248 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/address.py
--rw-rw-rw-   0        0        0      960 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/app.py
--rw-rw-rw-   0        0        0     3514 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/goods.py
--rw-rw-rw-   0        0        0     1010 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/ip.py
--rw-rw-rw-   0        0        0    12747 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/order.py
--rw-rw-rw-   0        0        0    22121 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/pay.py
--rw-rw-rw-   0        0        0     7265 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/stat.py
--rw-rw-rw-   0        0        0    47143 2021-10-28 03:30:33.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/task.py
--rw-rw-rw-   0        0        0     4634 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/theme.py
--rw-rw-rw-   0        0        0    14490 2021-10-28 03:29:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/user.py
--rw-rw-rw-   0        0        0      725 2021-10-27 10:08:05.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/core.py
--rw-rw-rw-   0        0        0    37989 2021-10-28 03:29:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/frame_base.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.211537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/
--rw-rw-rw-   0        0        0      323 2021-08-10 03:26:28.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/__init__.py
--rw-rw-rw-   0        0        0    14186 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/act_s.py
--rw-rw-rw-   0        0        0     6111 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/app_s.py
--rw-rw-rw-   0        0        0     5333 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/base_s.py
--rw-rw-rw-   0        0        0     8588 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/goods_s.py
--rw-rw-rw-   0        0        0     5122 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/ip_s.py
--rw-rw-rw-   0        0        0     7260 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/launch_s.py
--rw-rw-rw-   0        0        0    15391 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/module_s.py
--rw-rw-rw-   0        0        0    20346 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/order_s.py
--rw-rw-rw-   0        0        0     6928 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/price_s.py
--rw-rw-rw-   0        0        0    11213 2021-10-20 06:57:48.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/prize_s.py
--rw-rw-rw-   0        0        0     3456 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/report_s.py
--rw-rw-rw-   0        0        0     5337 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/task_s.py
--rw-rw-rw-   0        0        0     2392 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/theme_s.py
--rw-rw-rw-   0        0        0    18088 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/user_s.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.216537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/
--rw-rw-rw-   0        0        0      139 2021-07-15 07:37:39.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/__init__.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.265537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/
--rw-rw-rw-   0        0        0      162 2021-08-23 06:06:41.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/__init__.py
--rw-rw-rw-   0        0        0     3158 2021-10-28 07:08:55.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py
--rw-rw-rw-   0        0        0     3582 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/cryptography_helper.py
--rw-rw-rw-   0        0        0     3660 2021-10-09 03:10:22.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/oss2_helper.py
--rw-rw-rw-   0        0        0    32355 2021-10-29 03:41:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/queue_up_helper.py
--rw-rw-rw-   0        0        0    16516 2021-10-29 02:15:26.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/seven_helper.py
--rw-rw-rw-   0        0        0     1702 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/string_helper.py
--rw-rw-rw-   0        0        0    31795 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/tiktok_helper.py
--rw-rw-rw-   0        0        0    28524 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/wechat_helper.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.400537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/
--rw-rw-rw-   0        0        0      139 2021-08-26 01:24:55.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/__init__.py
--rw-rw-rw-   0        0        0    16178 2021-09-17 03:42:32.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/act_base_model.py
--rw-rw-rw-   0        0        0    10999 2021-10-09 03:08:56.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/app_base_model.py
--rw-rw-rw-   0        0        0    23943 2021-10-14 02:35:21.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/asset_base_model.py
--rw-rw-rw-   0        0        0    21358 2021-10-09 10:24:35.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/cache_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.432538 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/console_models/
--rw-rw-rw-   0        0        0        0 2021-04-09 01:22:35.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/console_models/__init__.py
--rw-rw-rw-   0        0        0    14167 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/console_models/asset_console_model.py
--rw-rw-rw-   0        0        0     8194 2021-10-29 05:34:19.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/console_models/stat_console_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.437538 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/
--rw-rw-rw-   0        0        0        0 2021-04-09 01:22:35.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/__init__.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.465537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/
--rw-rw-rw-   0        0        0       81 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/__init__.py
--rw-rw-rw-   0        0        0     3426 2021-07-29 03:47:48.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_info_model.py
--rw-rw-rw-   0        0        0     2904 2021-08-04 02:56:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_module_model.py
--rw-rw-rw-   0        0        0     3718 2021-08-25 02:05:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_prize_model.py
--rw-rw-rw-   0        0        0     2477 2021-07-29 10:28:12.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_type_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.474537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/app/
--rw-rw-rw-   0        0        0       27 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/app/__init__.py
--rw-rw-rw-   0        0        0     2988 2021-07-29 10:28:42.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/app/app_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.522537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/
--rw-rw-rw-   0        0        0       97 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/__init__.py
--rw-rw-rw-   0        0        0     2208 2021-09-02 10:30:45.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py
--rw-rw-rw-   0        0        0     3004 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py
--rw-rw-rw-   0        0        0     1568 2021-09-02 12:41:57.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py
--rw-rw-rw-   0        0        0     1914 2021-08-19 14:42:15.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.532536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/base/
--rw-rw-rw-   0        0        0       28 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/base/__init__.py
--rw-rw-rw-   0        0        0     3034 2021-07-29 10:30:05.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/base/base_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.541537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/browse/
--rw-rw-rw-   0        0        0       29 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/browse/__init__.py
--rw-rw-rw-   0        0        0     1588 2021-08-16 01:48:00.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.552537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/collect/
--rw-rw-rw-   0        0        0       30 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/collect/__init__.py
--rw-rw-rw-   0        0        0     1581 2021-08-16 01:49:16.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.569536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/
--rw-rw-rw-   0        0        0       50 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/__init__.py
--rw-rw-rw-   0        0        0     1470 2021-07-29 10:30:21.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/course_info_model.py
--rw-rw-rw-   0        0        0     1308 2021-07-29 10:30:38.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/course_type_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.579537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/friend/
--rw-rw-rw-   0        0        0       30 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/friend/__init__.py
--rw-rw-rw-   0        0        0     1855 2021-07-29 10:31:01.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.589537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/invite/
--rw-rw-rw-   0        0        0       29 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/invite/__init__.py
--rw-rw-rw-   0        0        0     1834 2021-08-12 09:43:52.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.600537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/ip/
--rw-rw-rw-   0        0        0       26 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/ip/__init__.py
--rw-rw-rw-   0        0        0     1640 2021-08-02 01:53:38.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.611537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/launch/
--rw-rw-rw-   0        0        0       31 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/launch/__init__.py
--rw-rw-rw-   0        0        0     1755 2021-08-10 10:06:24.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.625537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/marketing/
--rw-rw-rw-   0        0        0       36 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/marketing/__init__.py
--rw-rw-rw-   0        0        0     1687 2021-08-03 07:45:59.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.661537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/material/
--rw-rw-rw-   0        0        0       32 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/material/__init__.py
--rw-rw-rw-   0        0        0     1657 2021-07-29 10:31:57.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/material/material_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.671538 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/middler/
--rw-rw-rw-   0        0        0       34 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/middler/__init__.py
--rw-rw-rw-   0        0        0     1847 2021-07-29 10:33:15.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.684536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/operation/
--rw-rw-rw-   0        0        0       32 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/operation/__init__.py
--rw-rw-rw-   0        0        0     2217 2021-08-02 06:39:11.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.696537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/pay/
--rw-rw-rw-   0        0        0       28 2021-09-16 11:14:40.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/pay/__init__.py
--rw-rw-rw-   0        0        0     2148 2021-10-09 03:10:19.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.713537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/price/
--rw-rw-rw-   0        0        0       29 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/price/__init__.py
--rw-rw-rw-   0        0        0     1783 2021-08-10 10:06:17.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/price/price_gear_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.750538 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/prize/
--rw-rw-rw-   0        0        0       51 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/prize/__init__.py
--rw-rw-rw-   0        0        0     3554 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py
--rw-rw-rw-   0        0        0     3908 2021-09-09 03:31:46.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.760538 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/product/
--rw-rw-rw-   0        0        0       32 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/product/__init__.py
--rw-rw-rw-   0        0        0     1949 2021-07-29 10:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/product/product_price_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.770537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/refund/
--rw-rw-rw-   0        0        0       31 2021-09-16 11:14:40.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/refund/__init__.py
--rw-rw-rw-   0        0        0     2107 2021-10-09 03:10:21.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.781537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/saas/
--rw-rw-rw-   0        0        0       30 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/saas/__init__.py
--rw-rw-rw-   0        0        0     1891 2021-07-29 10:35:09.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.791537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/skin/
--rw-rw-rw-   0        0        0       28 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/skin/__init__.py
--rw-rw-rw-   0        0        0     1678 2021-07-29 10:35:26.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.801536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/special/
--rw-rw-rw-   0        0        0       32 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/special/__init__.py
--rw-rw-rw-   0        0        0     1458 2021-08-10 10:07:00.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/special/special_goods_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.830537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/
--rw-rw-rw-   0        0        0       83 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/__init__.py
--rw-rw-rw-   0        0        0     1659 2021-07-29 10:36:09.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py
--rw-rw-rw-   0        0        0     2004 2021-09-16 11:14:40.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py
--rw-rw-rw-   0        0        0     1609 2021-07-29 10:36:42.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py
--rw-rw-rw-   0        0        0     1635 2021-07-29 10:36:54.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.856537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/
--rw-rw-rw-   0        0        0       73 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/__init__.py
--rw-rw-rw-   0        0        0     1928 2021-07-29 10:37:16.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py
--rw-rw-rw-   0        0        0     1610 2021-07-29 10:37:32.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py
--rw-rw-rw-   0        0        0     3002 2021-09-02 07:32:12.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.871537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/
--rw-rw-rw-   0        0        0       47 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/__init__.py
--rw-rw-rw-   0        0        0     2052 2021-09-02 09:41:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/task_count_model.py
--rw-rw-rw-   0        0        0     2089 2021-08-12 02:11:25.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/task_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.887536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/
--rw-rw-rw-   0        0        0       47 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/__init__.py
--rw-rw-rw-   0        0        0     1639 2021-07-29 10:38:03.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py
--rw-rw-rw-   0        0        0     1490 2021-07-29 10:38:24.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.914540 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/
--rw-rw-rw-   0        0        0      251 2021-09-13 10:08:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/__init__.py
--rw-rw-rw-   0        0        0     1655 2021-08-12 05:47:30.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_account_model.py
--rw-rw-rw-   0        0        0     2024 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_asset_model.py
--rw-rw-rw-   0        0        0     1982 2021-07-29 10:39:09.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_black_model.py
--rw-rw-rw-   0        0        0     2915 2021-09-02 09:20:19.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_info_model.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:54.928537 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/version/
--rw-rw-rw-   0        0        0       31 2021-09-13 08:26:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/version/__init__.py
--rw-rw-rw-   0        0        0     1849 2021-07-29 10:40:28.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/version/version_info_model.py
--rw-rw-rw-   0        0        0     3932 2021-10-09 03:10:20.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/enum.py
--rw-rw-rw-   0        0        0    12542 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/frame_base_model.py
--rw-rw-rw-   0        0        0     8217 2021-08-26 02:29:21.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/goods_base_model.py
--rw-rw-rw-   0        0        0     6379 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/ip_base_model.py
--rw-rw-rw-   0        0        0    17262 2021-08-26 03:38:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/launch_base_model.py
--rw-rw-rw-   0        0        0    11652 2021-10-09 03:08:28.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/module_base_model.py
--rw-rw-rw-   0        0        0    44680 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/order_base_model.py
--rw-rw-rw-   0        0        0    10229 2021-08-26 02:29:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/price_base_model.py
--rw-rw-rw-   0        0        0    13915 2021-10-09 03:37:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/prize_base_model.py
--rw-rw-rw-   0        0        0     3156 2021-09-18 11:08:10.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/seven_model.py
--rw-rw-rw-   0        0        0    18220 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/stat_base_model.py
--rw-rw-rw-   0        0        0   120272 2021-10-14 02:34:43.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/task_base_model.py
--rw-rw-rw-   0        0        0    12707 2021-09-07 01:35:20.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/theme_base_model.py
--rw-rw-rw-   0        0        0    58193 2021-10-28 03:29:18.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/top_base_model.py
--rw-rw-rw-   0        0        0    33597 2021-10-27 10:13:04.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/user_base_model.py
--rw-rw-rw-   0        0        0    12438 2021-10-26 01:12:47.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/route.py
-drwxrwxrwx   0        0        0        0 2021-10-29 05:34:53.891536 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/
--rw-rw-rw-   0        0        0     2369 2021-10-29 05:34:53.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/PKG-INFO
--rw-rw-rw-   0        0        0     8033 2021-10-29 05:34:53.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/SOURCES.txt
--rw-rw-rw-   0        0        0        1 2021-10-29 05:34:53.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/dependency_links.txt
--rw-rw-rw-   0        0        0      117 2021-10-29 05:34:53.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/requires.txt
--rw-rw-rw-   0        0        0       21 2021-10-29 05:34:53.000000 seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame.egg-info/top_level.txt
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.108718 seven_cloudapp_frame-1.0.90/
+-rw-r--r--   0 root         (0) root         (0)    10094 2023-07-21 02:15:22.107719 seven_cloudapp_frame-1.0.90/PKG-INFO
+-rw-rw-rw-   0 root         (0) root         (0)     7561 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/README.md
+-rw-r--r--   0 root         (0) root         (0)       38 2023-07-21 02:15:22.108718 seven_cloudapp_frame-1.0.90/setup.cfg
+-rw-rw-rw-   0 root         (0) root         (0)     1469 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/setup.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.062737 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/
+-rw-rw-rw-   0 root         (0) root         (0)      156 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.063737 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/
+-rw-rw-rw-   0 root         (0) root         (0)      174 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.067735 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/
+-rw-rw-rw-   0 root         (0) root         (0)      254 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    13740 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/act.py
+-rw-rw-rw-   0 root         (0) root         (0)   398891 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/address.py
+-rw-rw-rw-   0 root         (0) root         (0)     7051 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/app.py
+-rw-rw-rw-   0 root         (0) root         (0)     3768 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/goods.py
+-rw-rw-rw-   0 root         (0) root         (0)     1782 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/ip_c.py
+-rw-rw-rw-   0 root         (0) root         (0)    16954 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/order.py
+-rw-rw-rw-   0 root         (0) root         (0)    34434 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/pay.py
+-rw-rw-rw-   0 root         (0) root         (0)     4920 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/stat.py
+-rw-rw-rw-   0 root         (0) root         (0)    60139 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/task.py
+-rw-rw-rw-   0 root         (0) root         (0)     4936 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/theme.py
+-rw-rw-rw-   0 root         (0) root         (0)    19920 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/user.py
+-rw-rw-rw-   0 root         (0) root         (0)      951 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/core.py
+-rw-rw-rw-   0 root         (0) root         (0)     2928 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/filter_base.py
+-rw-rw-rw-   0 root         (0) root         (0)    40438 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/frame_base.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.071734 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/
+-rw-rw-rw-   0 root         (0) root         (0)      322 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    21965 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/act_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    19693 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/app_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     7054 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/base_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    10939 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/cms_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     9390 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/goods_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    14522 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/ip_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    14071 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/launch_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    15858 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/module_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    34252 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/order_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     8329 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/price_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    19115 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/prize_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     5473 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/report_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     6985 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/task_s.py
+-rw-rw-rw-   0 root         (0) root         (0)     2547 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/theme_s.py
+-rw-rw-rw-   0 root         (0) root         (0)    23361 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/user_s.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.071734 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/
+-rw-rw-rw-   0 root         (0) root         (0)      132 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.072733 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/common/
+-rw-rw-rw-   0 root         (0) root         (0)      182 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/common/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)      424 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/common/frame_console.py
+-rw-rw-rw-   0 root         (0) root         (0)      429 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/common/frame_tornado.py
+-rw-rw-rw-   0 root         (0) root         (0)     1793 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/common/share_config.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.078731 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/
+-rw-rw-rw-   0 root         (0) root         (0)      155 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     5644 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/action_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)    10647 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/alipay_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     8617 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/baidubce_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     3124 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     7390 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/counter_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     6276 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/cryptography_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     2372 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/email_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     8819 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/logistics_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     4011 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/oss2_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)    35821 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/queue_up_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     4517 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/redis_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     9499 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/riskmanage_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)    22234 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/seven_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)    31547 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/tiktok_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)     3517 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/time_helper.py
+-rw-rw-rw-   0 root         (0) root         (0)    89319 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/wechat_helper.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.084728 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/
+-rw-rw-rw-   0 root         (0) root         (0)      132 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    21961 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/act_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    18619 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/app_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    47632 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/asset_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    30891 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/cache_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    12522 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/cms_base_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.086727 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)    15563 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/asset_console_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    19517 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/erp_console_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    10614 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/launch_console_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    23822 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/stat_console_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2482 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/task_console_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     5257 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/timing_work_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.086727 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/
+-rw-rw-rw-   0 root         (0) root         (0)        0 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/__init__.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.087727 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/
+-rw-rw-rw-   0 root         (0) root         (0)       81 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     3683 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2976 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_module_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     3750 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_prize_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2552 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_type_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.088727 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/app/
+-rw-rw-rw-   0 root         (0) root         (0)       27 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/app/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     3132 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/app/app_info_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.089726 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/
+-rw-rw-rw-   0 root         (0) root         (0)       97 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2152 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     3022 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1521 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1951 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.089726 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/base/
+-rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/base/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2964 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/base/base_info_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.089726 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/browse/
+-rw-rw-rw-   0 root         (0) root         (0)       29 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/browse/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1539 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.090726 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/cms/
+-rw-rw-rw-   0 root         (0) root         (0)       45 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/cms/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2674 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/cms/cms_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1702 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/cms/cms_place_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.090726 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/collect/
+-rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/collect/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1534 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.091725 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/counter/
+-rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/counter/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1630 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/counter/counter_config_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.091725 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/dict/
+-rw-rw-rw-   0 root         (0) root         (0)      183 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/dict/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1758 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.092725 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/erp/
+-rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/erp/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1572 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.092725 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/friend/
+-rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/friend/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1804 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.093725 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/
+-rw-rw-rw-   0 root         (0) root         (0)      131 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1680 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1929 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_module_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1537 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_product_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2691 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_shop_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1666 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_skin_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.094724 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/invite/
+-rw-rw-rw-   0 root         (0) root         (0)       48 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/invite/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2299 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/invite/invite_help_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1886 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.095724 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/ip/
+-rw-rw-rw-   0 root         (0) root         (0)       42 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/ip/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1960 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1553 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.095724 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/launch/
+-rw-rw-rw-   0 root         (0) root         (0)       51 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/launch/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1706 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1686 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.096723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/marketing/
+-rw-rw-rw-   0 root         (0) root         (0)       36 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/marketing/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1639 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.096723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/middler/
+-rw-rw-rw-   0 root         (0) root         (0)       34 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/middler/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1797 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.097723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/operation/
+-rw-rw-rw-   0 root         (0) root         (0)       60 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/operation/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1312 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/operation/operation_config_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2525 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.097723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/pay/
+-rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/pay/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2568 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.098723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/price/
+-rw-rw-rw-   0 root         (0) root         (0)       29 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/price/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1789 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/price/price_gear_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.098723 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/prize/
+-rw-rw-rw-   0 root         (0) root         (0)       51 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/prize/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     3834 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     3906 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.099722 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/product/
+-rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/product/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1963 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/product/product_price_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.099722 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/refund/
+-rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/refund/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2136 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.099722 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/saas/
+-rw-rw-rw-   0 root         (0) root         (0)       30 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/saas/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1841 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.100722 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/skin/
+-rw-rw-rw-   0 root         (0) root         (0)       28 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/skin/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1687 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.100722 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/special/
+-rw-rw-rw-   0 root         (0) root         (0)       32 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/special/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1413 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/special/special_goods_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.102721 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/
+-rw-rw-rw-   0 root         (0) root         (0)      130 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1666 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2061 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1685 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1643 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1699 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2604 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.102721 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/store/
+-rw-rw-rw-   0 root         (0) root         (0)       54 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/store/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2823 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/store/store_asset_log_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1872 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/store/store_asset_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.103721 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/
+-rw-rw-rw-   0 root         (0) root         (0)       73 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2098 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1563 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     3008 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.104720 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/
+-rw-rw-rw-   0 root         (0) root         (0)       93 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1999 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/task_count_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1861 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/task_gear_count_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2110 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/task_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2238 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/task_log_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.105720 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/theme/
+-rw-rw-rw-   0 root         (0) root         (0)       47 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/theme/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1725 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1444 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.105720 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/third/
+-rw-rw-rw-   0 root         (0) root         (0)       34 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/third/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2720 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/third/third_pay_order_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.106719 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/
+-rw-rw-rw-   0 root         (0) root         (0)      108 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     2292 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_account_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1779 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_address_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1983 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_asset_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     1929 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_black_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     2917 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_info_model.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.107719 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/version/
+-rw-rw-rw-   0 root         (0) root         (0)       31 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/version/__init__.py
+-rw-rw-rw-   0 root         (0) root         (0)     1807 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/version/version_info_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     9504 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/enum.py
+-rw-rw-rw-   0 root         (0) root         (0)    25479 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/frame_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    11486 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/goods_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    14055 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/ip_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    28425 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/launch_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    11914 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/module_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    20481 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/mp_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    14439 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/operate_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    63952 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/order_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    10462 2023-07-21 02:14:06.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/price_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    15242 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/prize_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)     4500 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/push_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    13979 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/seven_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    12725 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/shakeshop_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    22903 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/stat_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)   257787 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/task_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    13156 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/theme_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    90824 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/top_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    45754 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/user_base_model.py
+-rw-rw-rw-   0 root         (0) root         (0)    14672 2023-07-21 02:14:07.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/route.py
+drwxr-xr-x   0 root         (0) root         (0)        0 2023-07-21 02:15:22.063737 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/
+-rw-r--r--   0 root         (0) root         (0)    10094 2023-07-21 02:15:21.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/PKG-INFO
+-rw-r--r--   0 root         (0) root         (0)    10792 2023-07-21 02:15:21.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/SOURCES.txt
+-rw-r--r--   0 root         (0) root         (0)        1 2023-07-21 02:15:21.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/dependency_links.txt
+-rw-r--r--   0 root         (0) root         (0)      139 2023-07-21 02:15:21.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/requires.txt
+-rw-r--r--   0 root         (0) root         (0)       21 2023-07-21 02:15:21.000000 seven_cloudapp_frame-1.0.90/seven_cloudapp_frame.egg-info/top_level.txt
```

### Comparing `seven_cloudapp_frame-1.0.9.9/setup.py` & `seven_cloudapp_frame-1.0.90/setup.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,47 +1,48 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2020-08-21 14:59:50
-@LastEditTime: 2021-10-27 19:11:51
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from __future__ import print_function
-from setuptools import setup, find_packages
-
-with open("README.md", "r", encoding='utf-8') as fh:
-    long_description = fh.read()
-
-setup(
-    name="seven_cloudapp_frame",
-    version="1.0.9.9",
-    author="seven",
-    author_email="tech@gao7.com",
-    description="seven cloudapp frame",
-    long_description=long_description,
-    long_description_content_type="text/markdown",
-    license="MIT",
-    url="http://gitlab.tdtech.gao7.com/TaoBaoCloud/seven_cloudapp_frame.git",
-    packages=find_packages(),
-    install_requires=[
-        "seven-framework >=1.0.108",
-        "seven-top >=1.0.18",
-        "asq==1.3",
-        "emoji==1.6.1",
-        "xmltodict==0.12.0",
-        "requests-pkcs12==1.13",
-        "mmh3==3.0.0"
-    ],
-    classifiers=[
-        "Topic :: Software Development :: Libraries :: Python Modules",
-        "Programming Language :: Python",
-        "Programming Language :: Python :: 3.4",
-        "Programming Language :: Python :: 3.5",
-        "Programming Language :: Python :: 3.5",
-        "Programming Language :: Python :: 3.6",
-        "Programming Language :: Python :: 3.7",
-        "Programming Language :: Python :: 3.8",
-        "Programming Language :: Python :: 3.9",
-    ],
-    python_requires='~=3.4',
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2020-08-21 14:59:50
+@LastEditTime: 2022-09-30 10:45:22
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from __future__ import print_function
+from setuptools import setup, find_packages
+
+with open("README.md", "r", encoding='utf-8') as fh:
+    long_description = fh.read()
+
+setup(
+    name="seven_cloudapp_frame",
+    version="1.0.90",
+    author="seven",
+    author_email="tech@gao7.com",
+    description="seven cloudapp frame",
+    long_description=long_description,
+    long_description_content_type="text/markdown",
+    license="MIT",
+    url="http://gitlab.tdtech.gao7.com/TaoBaoCloud/seven_cloudapp_frame.git",
+    packages=find_packages(),
+    install_requires=[
+        "seven-framework ==1.1.28",
+        "seven-top >=1.0.28",
+        "asq==1.3",
+        "emoji==1.6.1",
+        "xmltodict==0.12.0",
+        "requests-pkcs12==1.13",
+        "mmh3==3.0.0",
+        "bce-python-sdk==0.8.61"
+    ],
+    classifiers=[
+        "Topic :: Software Development :: Libraries :: Python Modules",
+        "Programming Language :: Python",
+        "Programming Language :: Python :: 3.4",
+        "Programming Language :: Python :: 3.5",
+        "Programming Language :: Python :: 3.5",
+        "Programming Language :: Python :: 3.6",
+        "Programming Language :: Python :: 3.7",
+        "Programming Language :: Python :: 3.8",
+        "Programming Language :: Python :: 3.9",
+    ],
+    python_requires='~=3.4',
 )
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/goods.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/goods.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,77 +1,81 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 09:24:50
-@LastEditTime: 2021-10-11 18:07:00
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-
-
-class SkuInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取SKU信息
-    """
-    @filter_check_params("num_iid")
-    def get_async(self):
-        """
-        :description: 获取SKU信息
-        :param num_iid：num_iid
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        num_iid = self.get_param("num_iid")
-        is_log = bool(self.get_param("is_log", False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list_by_goodsids(num_iid, app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if "items_seller_list_get_response" in invoke_result_data.data.keys():
-            if "items" in invoke_result_data.data["items_seller_list_get_response"].keys():
-                return self.response_json_success(invoke_result_data.data["items_seller_list_get_response"])
-        else:
-            act_prize = ActPrizeModel(context=self).get_dict("goods_id=%s and sku_json<>'' and is_sku=1 ", field="sku_json", params=[num_iid])
-            if not act_prize:
-                return self.response_json_error("error", "对不起，找不到该商品的sku")
-            sku_detail = self.json_loads(act_prize['sku_json'])
-            return self.response_json_success(sku_detail["items_seller_list_get_response"])
-
-
-class GoodsListHandler(ClientBaseHandler):
-    """
-    :description: 获取商品列表
-    """
-    def get_async(self):
-        """
-        :description: 获取商品列表
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = self.get_param("page_size", 10)
-        is_log = bool(self.get_param("is_log", False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, "", "", "", app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 09:24:50
+@LastEditTime: 2022-07-19 10:50:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+
+
+class SkuInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取SKU信息
+    """
+    def get_async(self):
+        """
+        :description: 获取SKU信息
+        :param num_iid：num_iid
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        num_iid = self.get_param("num_iid")
+        if not num_iid:
+            num_iid = self.get_param("num_iids")
+        if not num_iid:
+            return self.response_json_error("param_error", "参数错误,缺少必传参数")
+        top_base_model = TopBaseModel(context=self)
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list_by_goodsids(num_iid, app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if "items_seller_list_get_response" in invoke_result_data.data.keys():
+            if "items" in invoke_result_data.data["items_seller_list_get_response"].keys():
+                return self.response_json_success(invoke_result_data.data["items_seller_list_get_response"])
+        else:
+            act_prize = ActPrizeModel(context=self).get_dict("goods_id=%s and sku_json<>'' and is_sku=1 ", limit="1", field="sku_json", params=[num_iid])
+            if not act_prize:
+                return self.response_json_error("error", "对不起，找不到该商品的sku")
+            sku_detail = self.json_loads(act_prize['sku_json'])
+            return self.response_json_success(self.business_process_executed(sku_detail["items_seller_list_get_response"], ref_params={}))
+
+
+class GoodsListHandler(ClientBaseHandler):
+    """
+    :description: 获取商品列表
+    """
+    def get_async(self):
+        """
+        :description: 获取商品列表
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = int(self.get_param("page_index", 0))
+        page_size = self.get_param("page_size", 10)
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, "", "", "", app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/order.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/order.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,268 +1,337 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-09 15:00:05
-@LastEditTime: 2021-10-10 15:38:30
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.order_base_model import *
-from seven_cloudapp_frame.models.stat_base_model import *
-
-
-class HorseracelampListHandler(ClientBaseHandler):
-    """
-    :description: 获取跑马灯奖品列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 获取跑马灯奖品列表
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param page_size: 条数
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", -1))
-        page_size = int(self.get_param("page_size", 10))
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        order_base_model = OrderBaseModel(context=self)
-        return self.response_json_success(order_base_model.get_horseracelamp_list(act_id, module_id, page_size))
-
-
-class SyncPayOrderHandler(ClientBaseHandler):
-    """
-    :description: 同步淘宝支付订单给用户加资产
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 同步淘宝支付订单给用户加资产
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        is_log = bool(self.get_param("is_log", False))
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        app_key, app_secret = self.get_app_key_secret()
-        order_base_model = OrderBaseModel(context=self)
-        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3
-        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""
-        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""
-        ascription_type = invoke_result_data.data["ascription_type"] if invoke_result_data.data.__contains__("ascription_type") else 1
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        invoke_result_data = order_base_model.sync_tao_pay_order(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, asset_type, goods_id, sku_id, ascription_type, app_key, app_secret, is_log, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(app_id, act_id, module_id, user_id, open_id, invoke_result_data)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"asset_type": 3, "goods_id": "", "sku_id": "", "ascription_type": 1, "check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, app_id, act_id, module_id, user_id, open_id, invoke_result_data):
-        """
-        :description: 执行后事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param open_id:open_id
-        :param invoke_result_data:框架处理结果
-        :return:
-        :last_editors: HuangJianYi
-        """
-        stat_base_model = StatBaseModel(context=self)
-        key_list_dict = {}
-        key_list_dict["PayUserCount"] = 1
-        key_list_dict["PayCount"] = invoke_result_data.data["pay_num"]
-        key_list_dict["PayMoneyCount"] = invoke_result_data.data["pay_price"]
-        stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, key_list_dict)
-        return invoke_result_data
-
-
-class PrizeOrderListHandler(ClientBaseHandler):
-    """
-    :description: 用户奖品订单列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 用户奖品订单列表
-        :param act_id：活动标识
-        :param order_no：订单号
-        :param tb_user_id：用户标识
-        :param user_open_id：open_id
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param is_search_roster：是否查询订单关联中奖记录
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        order_status = self.get_param("order_status")
-        create_date_start = self.get_param("create_date_start")
-        create_date_end = self.get_param("create_date_end")
-        order_by = self.get_param("order_by","id desc")
-        is_search_roster = self.get_param("is_search_roster", False)
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 10))
-
-        order_base_model = OrderBaseModel(context=self)
-        return self.response_json_success(order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, "", "", "", "", "", order_status, create_date_start, create_date_end, page_size, page_index, order_by, is_search_roster=is_search_roster, is_cache=True))
-
-
-class PrizeRosterListHandler(ClientBaseHandler):
-    """
-    :description: 用户中奖记录列表
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 用户中奖记录列表
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param page_size：页大小
-        :param page_index：页索引
-        :return PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        order_no = self.get_param("order_no")
-        goods_type = int(self.get_param("goods_type", -1))
-        prize_type = int(self.get_param("prize_type", -1))
-        logistics_status = int(self.get_param("logistics_status", -1))
-        prize_status = int(self.get_param("prize_status", -1))
-        pay_status = int(self.get_param("pay_status", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-
-        order_base_model = OrderBaseModel(context=self)
-        return self.response_json_success(order_base_model.get_prize_roster_list(app_id, act_id, user_id, open_id, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index))
-
-
-class SubmitSkuHandler(ClientBaseHandler):
-    """
-    :description: 中奖记录选择SKU提交
-    """
-    @filter_check_params("user_prize_id,sku_id")
-    def get_async(self):
-        """
-        :description: 提交SKU
-        :param user_prize_id：用户中奖信息标识
-        :param sku_name：sku属性名称
-        :param sku_id：sku_id
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        user_prize_id = int(self.get_param("user_prize_id"))
-        sku_name = self.get_param("sku_name")
-        sku_id = self.get_param("sku_id")
-
-        prize_roster_model = PrizeRosterModel(context=self)
-        prize_roster = prize_roster_model.get_entity_by_id(user_prize_id)
-        if not prize_roster or prize_roster.open_id != open_id or prize_roster.app_id != app_id:
-            return self.response_json_error("no_user_prize", "对不起，找不到该奖品")
-        if prize_roster.is_sku > 0:
-            prize_roster.sku_id = sku_id
-            prize_roster.sku_name = sku_name
-            goods_code_list = self.json_loads(prize_roster.goods_code_list)
-            goods_codes = [i for i in goods_code_list if str(i["sku_id"]) == sku_id]
-            if goods_codes and len(goods_codes) > 0 and ("goods_code" in goods_codes[0].keys()):
-                prize_roster.goods_code = goods_codes[0]["goods_code"]
-        prize_roster_model.update_entity(prize_roster, "sku_id,sku_name,goods_code")
-
-        return self.response_json_success()
-
-
-class SelectPrizeOrderHandler(ClientBaseHandler):
-    """
-    :description: 中奖记录下单
-    """
-    @filter_check_params("act_id,tb_user_id,login_token,real_name,telephone")
-    def get_async(self):
-        """
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :param login_token:用户访问令牌
-        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
-        :param real_name:用户名
-        :param telephone:电话
-        :param province:省
-        :param city:市
-        :param county:区县
-        :param street:街道
-        :param address:地址
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        login_token = self.get_param("login_token")
-        prize_ids = self.get_param("prize_ids")
-        real_name = self.get_param("real_name")
-        telephone = self.get_param("telephone")
-        province = self.get_param("province")
-        city = self.get_param("city")
-        county = self.get_param("county")
-        street = self.get_param("street")
-        address = self.get_param("address")
-        order_base_model = OrderBaseModel(context=self)
-        invoke_result_data = order_base_model.select_prize_order(app_id, act_id, user_id, login_token, prize_ids, real_name, telephone, province, city, county, street,address)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
-            return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 15:00:05
+@LastEditTime: 2023-02-10 10:52:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.enum import PageCountMode
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.order_base_model import *
+from seven_cloudapp_frame.models.stat_base_model import *
+
+
+class HorseracelampListHandler(ClientBaseHandler):
+    """
+    :description: 获取跑马灯奖品列表
+    """
+    def get_async(self):
+        """
+        :description: 获取跑马灯奖品列表
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param page_size: 条数
+        :param is_search_module: 是否查询活动模块
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", -1))
+        page_size = int(self.get_param("page_size", 30))
+        is_search_module = int(self.get_param("is_search_module", 0))
+        if is_search_module == 0:
+            is_search_module = False
+        else:
+            is_search_module = True
+
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else f"create_date>'{TimeHelper.add_hours_by_format_time(hour=-1)}'"
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_base_model = OrderBaseModel(context=self)
+        horseracelamp_list = self.business_process_executed(order_base_model.get_horseracelamp_list(app_id, act_id, module_id, is_search_module, condition, params, page_size), ref_params={})
+        return self.response_json_success(horseracelamp_list)
+
+
+class SyncPayOrderHandler(ClientBaseHandler):
+    """
+    :description: 同步淘宝支付订单给用户加资产
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 同步淘宝支付订单给用户加资产
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = int(self.get_param("module_id", 0))
+        login_token = self.get_param("login_token")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        app_key, app_secret = self.get_app_key_secret()
+        order_base_model = OrderBaseModel(context=self)
+        asset_type = invoke_result_data.data["asset_type"] if invoke_result_data.data.__contains__("asset_type") else 3
+        goods_id = invoke_result_data.data["goods_id"] if invoke_result_data.data.__contains__("goods_id") else ""
+        sku_id = invoke_result_data.data["sku_id"] if invoke_result_data.data.__contains__("sku_id") else ""
+        ascription_type = invoke_result_data.data["ascription_type"] if invoke_result_data.data.__contains__("ascription_type") else 1
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
+        invoke_result_data = order_base_model.sync_tao_pay_order(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, asset_type, goods_id, sku_id, ascription_type, app_key, app_secret, is_log, check_user_nick, continue_request_expire)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        ref_params["app_id"] = app_id
+        ref_params["act_id"] = act_id
+        ref_params["module_id"] = module_id
+        ref_params["user_id"] = user_id
+        ref_params["open_id"] = open_id
+
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        stat_base_model = StatBaseModel(context=self)
+        key_list_dict = {}
+        key_list_dict["PayUserCount"] = 1
+        key_list_dict["PayCount"] = result_data.data["pay_num"]
+        key_list_dict["PayMoneyCount"] = result_data.data["pay_price"]
+        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], ref_params["user_id"], ref_params["open_id"], key_list_dict)
+        return result_data
+
+
+class PrizeOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户奖品订单列表
+    """
+    filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 用户奖品订单列表
+        :param act_id：活动标识
+        :param order_no：订单号
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        order_status = self.get_param_int("order_status", -10)
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        order_by = self.get_param("order_by","id desc")
+        is_search_roster = self.get_param_int("is_search_roster", 0)
+        is_search_roster = False if is_search_roster == 0 else True
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 10)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, "", "", "", "", "", order_status, create_date_start, create_date_end, page_size, page_index, order_by, field, is_search_roster=is_search_roster, is_cache=True, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode=page_count_mode)
+        ref_params = {}
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params=ref_params)
+        return self.response_json_success(return_info)
+
+
+class PrizeRosterListHandler(ClientBaseHandler):
+    """
+    :description: 用户中奖记录列表
+    """
+    filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 用户中奖记录列表
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        user_id = self.get_user_id()
+        order_no = self.get_param("order_no")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode,page_count_mode)
+        ref_params = {}
+        order_base_model = OrderBaseModel(context=self)
+        page_list = order_base_model.get_prize_roster_list(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, open_id=open_id, order_no=order_no, goods_type=goods_type, prize_type=prize_type, logistics_status=logistics_status, prize_status=prize_status, pay_status=pay_status, page_size=page_size, page_index=page_index, page_count_mode=page_count_mode)
+        if page_count_mode == "total":
+            if len(page_list) > 0:
+                total = page_list[1]
+                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            else:
+                total = 0
+                page_list = []
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            if len(page_list) > 0:
+                is_next = page_list[1]
+                page_list = self.business_process_executed(page_list[0], ref_params=ref_params)
+            else:
+                is_next = False
+                page_list = []
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params=ref_params)
+        return self.response_json_success(return_info)
+
+
+class SubmitSkuHandler(ClientBaseHandler):
+    """
+    :description: 中奖记录选择SKU提交
+    """
+    @filter_check_params("user_prize_id,sku_id")
+    def get_async(self):
+        """
+        :description: 提交SKU
+        :param user_prize_id：用户中奖信息标识
+        :param sku_name：sku属性名称
+        :param sku_id：sku_id
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_prize_id = int(self.get_param("user_prize_id"))
+        sku_name = self.get_param("sku_name")
+        sku_id = self.get_param("sku_id")
+
+        prize_roster_model = PrizeRosterModel(sub_table=FrameBaseModel(context=self).get_business_sub_table("prize_roster_tb", {"app_id": app_id}), context=self)
+        prize_roster = prize_roster_model.get_entity_by_id(user_prize_id)
+        if not prize_roster or prize_roster.open_id != open_id or prize_roster.app_id != app_id:
+            return self.response_json_error("no_user_prize", "对不起，找不到该奖品")
+        if prize_roster.is_sku > 0:
+            prize_roster.sku_id = sku_id
+            prize_roster.sku_name = sku_name
+            goods_code_list = self.json_loads(prize_roster.goods_code_list)
+            goods_codes = [i for i in goods_code_list if str(i["sku_id"]) == sku_id]
+            if goods_codes and len(goods_codes) > 0 and ("goods_code" in goods_codes[0].keys()):
+                prize_roster.goods_code = goods_codes[0]["goods_code"]
+        prize_roster_model.update_entity(prize_roster, "sku_id,sku_name,goods_code")
+
+        return self.response_json_success()
+
+
+class SelectPrizeOrderHandler(ClientBaseHandler):
+    """
+    :description: 中奖记录下单
+    """
+    @filter_check_params("login_token,real_name,telephone", check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param login_token:用户访问令牌
+        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
+        :param real_name:用户名
+        :param telephone:电话
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        login_token = self.get_param("login_token")
+        prize_ids = self.get_param("prize_ids")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        province = self.get_param("province")
+        city = self.get_param("city")
+        county = self.get_param("county")
+        street = self.get_param("street")
+        address = self.get_param("address")
+
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_ids = invoke_result_data.data["prize_ids"] if invoke_result_data.data.__contains__("prize_ids") else prize_ids
+        invoke_result_data = order_base_model.select_prize_order(app_id, act_id, user_id, login_token, prize_ids, real_name, telephone, province, city, county, street,address)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
+            return self.response_json_success(self.business_process_executed(invoke_result_data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/task.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/task.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,921 +1,974 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-17 11:19:05
-@LastEditTime: 2021-10-28 11:26:12
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.task_base_model import *
-
-
-class TaskInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取任务列表
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 获取任务列表
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param tb_user_id：用户标识
-        :param task_types:任务类型 多个逗号,分隔
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        task_types = self.get_param("task_types")
-        is_log = self.get_param("is_log", False)
-        task_base_model = TaskBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = self.business_process_executing(self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
-        task_list = task_base_model.get_client_task_list(app_id, act_id, module_id, user_id, task_types, app_key, app_secret, is_log, daily_repeat_browse)
-        return self.response_json_success(self.business_process_executed(task_list, self.request_params))
-
-    def business_process_executing(self, request_params):
-        """
-        :description: 执行前事件
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"daily_repeat_browse": False}
-        return invoke_result_data
-
-    def business_process_executed(self, task_list, request_params):
-        """
-        :description: 执行后事件
-        :param task_list:任务列表
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return task_list
-
-
-class ReceiveRewardHandler(ClientBaseHandler):
-    """
-    :description: 处理领取任务奖励
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理领取任务奖励
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :param task_id:任务标识
-        :param task_sub_type:子任务类型
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_id = int(self.get_param("task_id", 0))
-        task_sub_type = self.get_param("task_sub_type")
-        task_base_model = TaskBaseModel(context=self)
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, task_id, task_sub_type, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_receive_reward(app_id, act_id, module_id, user_id, login_token, task_id, task_sub_type, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, task_id, task_sub_type, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, task_id, task_sub_type, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param task_id:任务标识
-        :param task_sub_type:子任务类型
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, task_id, task_sub_type, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param task_id:任务标识
-        :param task_sub_type:子任务类型
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class FreeGiftHandler(ClientBaseHandler):
-    """
-    :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_free_gift(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_new_user":True,"check_user_nick":True,"continue_request_expire":5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data,app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class OneSignHandler(ClientBaseHandler):
-    """
-    :description: 处理单次签到任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理单次签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_one_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_new_user": True, "check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class WeeklySignHandler(ClientBaseHandler):
-    """
-    :description: 处理每周签到任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理每周签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_weekly_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_new_user": False, "check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class CumulativeSignHandler(ClientBaseHandler):
-    """
-    :description: 处理累计签到任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理累计签到任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token,request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_new_user": False, "check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class InviteNewUserHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请新用户任务
-    """
-    @filter_check_params("act_id,tb_user_id,invite_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理邀请新用户任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param invite_user_id:邀请用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        invite_user_id = int(self.get_param("invite_user_id", 0))
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, invite_user_id, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        invoke_result_data = task_base_model.process_invite_new_user(app_id, act_id, module_id, user_id, login_token, invite_user_id, self.__class__.__name__, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, invite_user_id, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, invite_user_id, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param invite_user_id:邀请用户标识
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, invite_user_id, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param invite_user_id:邀请用户标识
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class InviteJoinMemberHandler(ClientBaseHandler):
-    """
-    :description: 处理邀请加入会员任务
-    """
-    @filter_check_params("act_id,tb_user_id,invite_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理邀请加入会员任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param invite_user_id:邀请用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        invite_user_id = int(self.get_param("invite_user_id", 0))
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token,invite_user_id,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = task_base_model.process_invite_join_member(app_id, act_id, module_id, user_id, login_token, invite_user_id, self.__class__.__name__, self.get_param("access_token"), app_key, app_secret, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, invite_user_id, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, invite_user_id, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param invite_user_id:邀请用户标识
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, invite_user_id, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param invite_user_id:邀请用户标识
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class CollectGoodsHandler(ClientBaseHandler):
-    """
-    :description: 处理收藏商品任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token,goods_id")
-    def get_async(self):
-        """
-        :description: 处理收藏商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param goods_id:商品ID
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        goods_id = self.get_param("goods_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        invoke_result_data = task_base_model.process_collect_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class BrowseGoodsHandler(ClientBaseHandler):
-    """
-    :description: 处理浏览商品任务
-    """
-    @filter_check_params("act_id,tb_user_id,login_token,goods_id")
-    def get_async(self):
-        """
-        :description: 处理浏览商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param goods_id:商品ID
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        goods_id = self.get_param("goods_id")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
-        invoke_result_data = task_base_model.process_browse_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, daily_repeat_browse, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"daily_repeat_browse":False,"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class FavorStoreHandler(ClientBaseHandler):
-    """
-    :description: 处理关注店铺
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理关注店铺
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_favor_store(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data,app_id, act_id, user_id, module_id, login_token,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class JoinMemberHandler(ClientBaseHandler):
-    """
-    :description: 处理加入店铺会员
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理加入店铺会员
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
-        invoke_result_data = task_base_model.process_join_member(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, continue_request_expire, is_stat)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class BrowseSiteHandler(ClientBaseHandler):
-    """
-    :description: 处理浏览网址相关任务 如：浏览店铺、浏览直播间、浏览会场/专题
-    """
-    @filter_check_params("act_id,tb_user_id,login_token")
-    def get_async(self):
-        """
-        :description: 处理浏览商品任务
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param tb_user_id:用户标识
-        :param task_type:任务类型
-        :param task_sub_type:子任务类型
-        :param login_token:访问令牌
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        module_id = int(self.get_param("module_id", 0))
-        task_type = int(self.get_param("task_type", 0))
-        task_sub_type = self.get_param("task_sub_type")
-        login_token = self.get_param("login_token")
-        task_base_model = TaskBaseModel(context=self)
-
-        invoke_result_data = InvokeResultData()
-        if task_type not in [TaskType.browse_store.value,TaskType.browse_live_room.value,TaskType.browse_special_topic.value]:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executing(app_id, act_id, user_id, module_id, login_token,self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
-        continue_request_expire = invoke_result_data.data["continue_request_expire"] if invoke_result_data.data.__contains__("continue_request_expire") else 5
-        invoke_result_data = task_base_model.process_browse_site(app_id, act_id, module_id, user_id, login_token, task_type, task_sub_type, self.__class__.__name__, check_user_nick, continue_request_expire)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, user_id, module_id, login_token, self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, app_id, act_id, user_id, module_id, login_token,request_params):
-        """
-        :description: 执行前事件
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {"check_user_nick": True, "continue_request_expire": 5}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, user_id, module_id, login_token, request_params):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-17 11:19:05
+@LastEditTime: 2023-07-07 10:25:27
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.task_base_model import *
+
+
+class TaskInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取任务列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取任务列表
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param task_types:任务类型 多个逗号,分隔
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        mix_nick = self.get_param("mix_nick")
+        module_id = self.get_param_int("module_id")
+        task_types = self.get_param("task_types")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+        task_base_model = TaskBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
+        ver_no = invoke_result_data.data["ver_no"] if invoke_result_data.data.__contains__("ver_no") else '1'
+        if ver_no == "1":
+            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list(app_id, act_id, module_id, user_id, task_types, app_key, app_secret, is_log, daily_repeat_browse, mix_nick)
+        else:
+            result_list,task_info_list,task_count_list = task_base_model.get_client_task_list_v2(app_id, act_id, module_id, user_id, task_types, daily_repeat_browse)
+        ref_params = {}
+        ref_params["task_info_list"] = task_info_list
+        ref_params["task_count_list"] = task_count_list
+        return self.response_json_success(self.business_process_executed(result_list, ref_params))
+
+
+class ReceiveRewardHandler(ClientBaseHandler):
+    """
+    :description: 处理领取任务奖励
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理领取任务奖励
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :param task_id:任务标识
+        :param task_sub_type:子任务类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_id = self.get_param_int("task_id")
+        task_type = self.get_param_int("task_type")
+        task_sub_type = str(self.get_param("task_sub_type"))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_receive_reward(app_id, act_id, module_id, user_id, login_token, task_id, task_sub_type, self.__class__.__name__, self.request_code, task_type, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class FreeGiftHandler(ClientBaseHandler):
+    """
+    :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理掌柜有礼、新人有礼、免费领取等相似任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_free_gift(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class OneSignHandler(ClientBaseHandler):
+    """
+    :description: 处理单次签到任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理单次签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else {}
+        invoke_result_data = task_base_model.process_one_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class WeeklySignHandler(ClientBaseHandler):
+    """
+    :description: 处理每周签到任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理每周签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_weekly_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CumulativeSignHandler(ClientBaseHandler):
+    """
+    :description: 处理累计签到任务
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理累计签到任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        task_type = invoke_result_data.data["task_type"] if invoke_result_data.data.__contains__("task_type") else 0
+        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class SuccessiveSignHandler(ClientBaseHandler):
+    """
+    :description: 处理连续签到任务（天数是连续递增）
+    """
+    @filter_check_params("login_token",check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理连续签到任务（天数是连续递增）
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        task_type = TaskType.successive_sign.value
+        invoke_result_data = task_base_model.process_cumulative_sign(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_new_user, check_user_nick, 5, is_stat, info_json, task_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteNewUserHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请用户任务(被邀请人进入调用)
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请用户任务(被邀请人进入调用)
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_new_user.value
+        login_token = self.get_param("login_token")
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else True
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        check_act_info_release = invoke_result_data.data["check_act_info_release"] if invoke_result_data.data.__contains__("check_act_info_release") else True
+        check_act_module_release = invoke_result_data.data["check_act_module_release"] if invoke_result_data.data.__contains__("check_act_module_release") else True
+        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False #是否关闭邀请限制
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        stat_base_model = StatBaseModel(context=self)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedUserCount": 1, "BeInvitedCount": 1})
+
+        invoke_result_data = task_base_model.process_invite_user(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, check_new_user, 5, close_invite_limit, check_act_info_release=check_act_info_release, check_act_module_release=check_act_module_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedUserCount": 1})
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if response_data_type == 1:
+            return self.response_json_success(invoke_result_data.data)
+        else:
+            return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteJoinMemberHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请加入会员任务
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请加入会员任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_join_member.value
+        login_token = self.get_param("login_token")
+        from_user_id = self.get_param_int("invite_user_id", 0)
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        close_invite_limit = invoke_result_data.data["close_invite_limit"] if invoke_result_data.data.__contains__("close_invite_limit") else False
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        response_data_type = invoke_result_data.data["response_data_type"] if invoke_result_data.data.__contains__("response_data_type") else 2  #输出值类型（1-对象 2-奖励值）
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        invoke_result_data = task_base_model.process_invite_join_member(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_user_nick, 5, close_invite_limit)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if response_data_type == 1:
+            return self.response_json_success(invoke_result_data.data)
+        else:
+            return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CollectGoodsHandler(ClientBaseHandler):
+    """
+    :description: 处理收藏商品任务
+    """
+    @filter_check_params("login_token,goods_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理收藏商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param goods_id:商品ID
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.collect_goods.value
+        goods_id = self.get_param("goods_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_collect_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseGoodsHandler(ClientBaseHandler):
+    """
+    :description: 处理浏览商品任务
+    """
+    @filter_check_params("login_token,goods_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理浏览商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param goods_id:商品ID
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.browse_goods.value
+        goods_id = self.get_param("goods_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        daily_repeat_browse = invoke_result_data.data["daily_repeat_browse"] if invoke_result_data.data.__contains__("daily_repeat_browse") else False
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_browse_goods(app_id, act_id, module_id, user_id, login_token, goods_id, self.__class__.__name__, daily_repeat_browse, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class FavorStoreHandler(ClientBaseHandler):
+    """
+    :description: 处理关注店铺
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理关注店铺
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_favor_store(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class JoinMemberHandler(ClientBaseHandler):
+    """
+    :description: 处理加入店铺会员
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理加入店铺会员
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 直接发放奖励，返回奖励值
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_join_member(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseSiteHandler(ClientBaseHandler):
+    """
+    :description: 处理浏览网址相关任务 如：浏览会场/专题
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理浏览商品任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param task_type:活动模块标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param task_sub_type:子任务类型
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = self.get_param_int("task_type", TaskType.browse_special_topic.value)
+        task_sub_type = self.get_param("task_sub_type")
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = InvokeResultData()
+        if task_type not in [TaskType.browse_special_topic.value, TaskType.browse_store.value, TaskType.browse_live_room.value]:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "非法操作"
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_browse_site(app_id, act_id, module_id, user_id, login_token, task_type, task_sub_type, self.__class__.__name__, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class ShareHandler(ClientBaseHandler):
+    """
+    :description: 分享任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 分享任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.share.value
+        login_token = self.get_param("login_token")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_share(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, False, check_user_nick, 5)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseStoreHandler(ClientBaseHandler):
+    """
+    :description: 浏览店铺任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 浏览店铺任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_type = TaskType.browse_store.value
+        task_sub_type = self.get_param("task_sub_type")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class BrowseLiveRoomHandler(ClientBaseHandler):
+    """
+    :description: 浏览直播间任务
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 浏览直播间任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        task_type = TaskType.browse_live_room.value
+        task_sub_type = self.get_param("task_sub_type")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False  #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False  #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_routine_task(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, task_type, task_sub_type, False, check_user_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=user_id, login_token='', task_id=0, task_sub_type=task_sub_type, handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class InviteUserHelpHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请用户助力任务(被邀请人进入调用)
+    """
+    @filter_check_params("invite_user_id,login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请用户助力任务(被邀请人进入调用)
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        task_type = TaskType.invite_user_help.value
+        login_token = self.get_param("login_token")
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else False #是否统计
+        is_receive_reward = invoke_result_data.data["is_receive_reward"] if invoke_result_data.data.__contains__("is_receive_reward") else False #是否直接领取奖励
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+
+        stat_base_model = StatBaseModel(context=self)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"BeInvitedHelpUserCount": 1, "BeInvitedHelpCount": 1})
+
+        invoke_result_data = task_base_model.process_invite_user_help(app_id, act_id, module_id, user_id, login_token, from_user_id, self.__class__.__name__, check_new_user, check_user_nick, 5, True, True)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if is_stat == True:
+            stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, "", {"AddBeInvitedHelpUserCount": 1})
+
+        invoke_result_data.data = invoke_result_data.data if invoke_result_data.data else {}
+        invoke_result_data.data["reward_value"] = 0
+        if is_receive_reward == True:
+            reward_invoke_result_data = task_base_model.process_receive_reward(app_id=app_id, act_id=act_id, module_id=module_id, user_id=from_user_id, login_token='', task_id=0, task_sub_type='', handler_name=self.__class__.__name__, request_code=self.request_code, task_type=task_type, check_new_user=False, check_user_nick=False, continue_request_expire=0, is_stat=is_stat, info_json=info_json, check_act_info_release=False, check_act_module_release=False)
+            if reward_invoke_result_data.success == True:
+                invoke_result_data.data["reward_value"] = reward_invoke_result_data.data["reward_value"]
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class SecretCodeHandler(ClientBaseHandler):
+    """
+    :description: 神秘暗号任务
+    """
+    @filter_check_params("login_token,secret_code", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 神秘暗号任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :param secret_code:暗号
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        secret_code = self.get_param("secret_code")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        invoke_result_data = task_base_model.process_secret_code(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, secret_code, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
+
+
+class CrmPointExchangeAssetHandler(ClientBaseHandler):
+    """
+    :description: 店铺积分兑换资产
+    """
+    @filter_check_params("login_token", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 神秘暗号任务
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id")
+        login_token = self.get_param("login_token")
+        mix_nick = self.get_param("mix_nick", "")
+        task_base_model = TaskBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        check_new_user = invoke_result_data.data["check_new_user"] if invoke_result_data.data.__contains__("check_new_user") else False
+        check_user_nick = invoke_result_data.data["check_user_nick"] if invoke_result_data.data.__contains__("check_user_nick") else True
+        is_stat = invoke_result_data.data["is_stat"] if invoke_result_data.data.__contains__("is_stat") else True
+        info_json = invoke_result_data.data["info_json"] if invoke_result_data.data.__contains__("info_json") else None
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "对不起，找不到该应用")
+        access_token = app_info_dict["access_token"]
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = task_base_model.process_crm_point_exchange_asset(app_id, act_id, module_id, user_id, login_token, self.__class__.__name__, self.request_code, mix_nick, access_token, app_key, app_secret, check_new_user, check_user_nick, 5, is_stat, info_json)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["reward_value"])
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/theme.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/theme.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,130 +1,134 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 09:15:49
-@LastEditTime: 2021-10-10 15:42:27
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.theme_base_model import *
-from seven_cloudapp_frame.models.act_base_model import *
-
-
-class ThemeInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取主题（皮肤）信息
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 获取主题（皮肤）信息
-        :param act_id：活动标识
-        :param ver_no：客户端版本号
-        :return 主题信息
-        :last_editors: HuangJianYi
-        """
-        act_id = int(self.get_param("act_id", 0))
-        ver_no = self.get_param("ver_no")
-
-        act_base_model = ActBaseModel(context=self)
-        act_info_dict = act_base_model.get_act_info_dict(act_id)
-        if not act_info_dict:
-            return self.response_json_error("no_act", "对不起，找不到该活动")
-        theme_id = act_info_dict["theme_id"]
-        theme_base_model = ThemeBaseModel(context=self)
-        theme_info = theme_base_model.get_theme_info(theme_id, ver_no)
-        return self.response_json_success(theme_info)
-
-
-class SaveThemeHandler(ClientBaseHandler):
-    """
-    :description: 保存主题
-    """
-    @filter_check_params("out_id")
-    def post_async(self):
-        """
-        :description: 保存主题
-        :param app_id：应用标识
-        :param theme_name：主题名称
-        :param client_json：客户端内容json
-        :param server_json：服务端内容json
-        :param out_id：外部id
-        :param ver_no：客户端版本号
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        theme_name = self.get_param("theme_name")
-        client_json = self.get_param("client_json")
-        server_json = self.get_param("server_json")
-        out_id = self.get_param("out_id")
-        ver_no = self.get_param("ver_no")
-
-        theme_base_model = ThemeBaseModel(context=self)
-        theme_base_model.save_theme(app_id, theme_name, client_json, server_json, out_id, ver_no)
-        return self.response_json_success()
-
-
-class SaveSkinHandler(ClientBaseHandler):
-    """
-    :description: 保存皮肤
-    """
-    @filter_check_params("theme_out_id,skin_out_id")
-    def post_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :param skin_name：皮肤名称
-        :param client_json：客户端内容json
-        :param server_json：服务端内容json
-        :param theme_out_id：样式外部id
-        :param skin_out_id：皮肤外部id
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        skin_name = self.get_param("skin_name")
-        client_json = self.get_param("client_json")
-        server_json = self.get_param("server_json")
-        theme_out_id = self.get_param("theme_out_id")
-        skin_out_id = self.get_param("skin_out_id")
-
-        theme_base_model = ThemeBaseModel(context=self)
-        invoke_result_data = theme_base_model.save_skin(app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class ThemeInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取主题信息列表
-    """
-    def get_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_theme_list(app_id))
-
-
-class SkinInfoListHandler(ClientBaseHandler):
-    """
-    :description: 获取皮肤信息列表
-    """
-    @filter_check_params("theme_out_id")
-    def get_async(self):
-        """
-        :description: 保存皮肤
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        theme_out_id = self.get_param("theme_out_id")
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_skin_list(theme_out_id))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-28 09:15:49
+@LastEditTime: 2023-03-13 11:37:23
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.theme_base_model import *
+from seven_cloudapp_frame.models.act_base_model import *
+
+
+class ThemeInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取主题（皮肤）信息
+    """
+    def get_async(self):
+        """
+        :description: 获取主题（皮肤）信息
+        :param act_id：活动标识
+        :param ver_no：客户端版本号
+        :return 主题信息
+        :last_editors: HuangJianYi
+        """
+        act_id = self.get_act_id()
+        ver_no = self.get_param("ver_no")
+
+        act_base_model = ActBaseModel(context=self)
+        act_info_dict = act_base_model.get_act_info_dict(act_id)
+        if not act_info_dict:
+            return self.response_json_error("no_act", "对不起，找不到该活动")
+        theme_id = act_info_dict["theme_id"]
+        theme_base_model = ThemeBaseModel(context=self)
+        theme_info = theme_base_model.get_theme_info(theme_id, ver_no)
+        return self.response_json_success(self.business_process_executed(theme_info,ref_params={}))
+
+
+class SaveThemeHandler(ClientBaseHandler):
+    """
+    :description: 保存主题
+    """
+    @filter_check_params("out_id")
+    def post_async(self):
+        """
+        :description: 保存主题
+        :param app_id：应用标识
+        :param theme_name：主题名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param out_id：外部id
+        :param ver_no：客户端版本号
+        :param style_type：样式类型
+        :param ascription_type：归属类型(1公共)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        theme_name = self.get_param("theme_name")
+        client_json = self.get_param("client_json")
+        server_json = self.get_param("server_json")
+        out_id = self.get_param("out_id")
+        ver_no = self.get_param("ver_no")
+        style_type = int(self.get_param("style_type",0))
+        ascription_type = self.get_param_int("ascription_type",1)
+
+        theme_base_model = ThemeBaseModel(context=self)
+        theme_base_model.save_theme(app_id, theme_name, client_json, server_json, out_id, ver_no, style_type, ascription_type)
+        return self.response_json_success()
+
+
+class SaveSkinHandler(ClientBaseHandler):
+    """
+    :description: 保存皮肤
+    """
+    @filter_check_params("theme_out_id,skin_out_id")
+    def post_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :param skin_name：皮肤名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param theme_out_id：样式外部id
+        :param skin_out_id：皮肤外部id
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        skin_name = self.get_param("skin_name")
+        client_json = self.get_param("client_json")
+        server_json = self.get_param("server_json")
+        theme_out_id = self.get_param("theme_out_id")
+        skin_out_id = self.get_param("skin_out_id")
+        style_type = self.get_param_int("style_type")
+
+        theme_base_model = ThemeBaseModel(context=self)
+        invoke_result_data = theme_base_model.save_skin(app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id, style_type)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class ThemeInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取主题信息列表
+    """
+    def get_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(theme_base_model.get_theme_list(app_id), ref_params={}))
+
+
+class SkinInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取皮肤信息列表
+    """
+    @filter_check_params("theme_out_id")
+    def get_async(self):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        theme_out_id = self.get_param("theme_out_id")
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(theme_base_model.get_skin_list(theme_out_id), ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/client/user.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/launch_s.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,316 +1,313 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 18:31:06
-@LastEditTime: 2021-10-27 19:12:52
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.order_base_model import *
-from seven_cloudapp_frame.models.stat_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
-
-
-class LoginHandler(ClientBaseHandler):
-    """
-    :description: 登录处理
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 登录处理
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param avatar：头像
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        user_nick = self.get_param("user_nick")
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", 0))
-        avatar = self.get_param("avatar")
-
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error","小程序不存在")
-
-        if self.check_request_user(app_id, app_info_dict["current_limit_count"]):
-            return self.response_json_error("current_limit", "登录失败")
-
-        invoke_result_data = self.business_process_executing(self.request_params)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.save_user_by_openid(app_id, act_id, open_id, self.emoji_to_emoji_base64(user_nick), avatar)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        invoke_result_data.data["user_nick"] = self.emoji_base64_to_emoji(invoke_result_data.data["user_nick"])
-        invoke_result_data = self.business_process_executed(invoke_result_data, app_id, act_id, module_id, open_id, user_nick, avatar)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-    def business_process_executing(self, request_params):
-        """
-        :description: 执行前事件
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data, app_id, act_id, module_id, open_id, user_nick, avatar):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :return:
-        :last_editors: HuangJianYi
-        """
-        user_info_dict = invoke_result_data.data
-        stat_base_model = StatBaseModel(context=self)
-        key_list_dict = {}
-        key_list_dict["VisitCountEveryDay"] = 1
-        key_list_dict["VisitManCountEveryDay"] = 1
-        key_list_dict["VisitManCountEveryDayIncrease"] = 1
-        stat_base_model.add_stat_list(app_id, act_id, module_id, user_info_dict["user_id"], open_id, key_list_dict)
-        return invoke_result_data
-
-
-class UpdateUserInfoHandler(ClientBaseHandler):
-    """
-    :description: 更新用户信息
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 更新用户信息
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :param avatar：头像
-        :param is_member_before：初始会员状态
-        :param is_favor_before：初始关注状态
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        user_nick = self.get_param("user_nick")
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        avatar = self.get_param("avatar")
-        is_member_before = int(self.get_param("is_member_before", -1))
-        is_favor_before = int(self.get_param("is_favor_before", -1))
-
-        invoke_result_data = InvokeResultData()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_info(app_id, act_id, user_id, open_id, self.emoji_to_emoji_base64(user_nick), avatar, is_member_before, is_favor_before)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
-            return self.response_json_success("更新成功")
-
-
-class CheckIsMemberHandler(ClientBaseHandler):
-    """
-    :description: 校验是否是店铺会员
-    """
-    def get_async(self):
-        """
-        :description: 校验是否是店铺会员
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        is_log = bool(self.get_param("is_log", False))
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        access_token = app_info_dict["access_token"]
-        if access_token == "":
-            return self.response_json_error("error", "未授权请联系客服授权")
-        top_base_model = TopBaseModel(context=self)
-        app_key,app_secret = self.get_app_key_secret()
-        return self.response_json_success(top_base_model.check_is_member(access_token, app_key, app_secret, is_log))
-
-
-class ApplyBlackUnbindHandler(ClientBaseHandler):
-    """
-    :description: 提交黑名单解封申请
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 提交黑名单解封申请
-        :param act_id:活动标识
-        :param tb_user_id:用户标识
-        :param reason:解封理由
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        reason = self.get_param("reason", "误封号,申请解封")
-
-        invoke_result_data = InvokeResultData()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.apply_black_unbind(app_id, act_id, user_id, open_id, reason)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        else:
-            return self.response_json_success()
-
-
-class GetCouponPrizeHandler(ClientBaseHandler):
-    """
-    :description: 领取淘宝优惠券
-    """
-    @filter_check_params("user_prize_id")
-    def get_async(self):
-        """
-        :description: 领取淘宝优惠券（发奖接口）
-        :param user_prize_id:用户奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        user_prize_id = int(self.get_param("user_prize_id", 0))
-        is_log = bool(self.get_param("is_log", False))
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        access_token = app_info_dict["access_token"]
-        if access_token == "":
-            return self.response_json_error("error", "未授权请联系客服授权")
-        prize_roster_model = PrizeRosterModel(context=self)
-        prize_roster_dict = prize_roster_model.get_cache_dict_by_id(user_prize_id)
-        if not prize_roster_dict or prize_roster_dict['open_id'] != open_id:
-            return self.response_json_error("error", "奖品不存在")
-        tao_coupon_model = TaoCouponModel(context=self)
-        tao_coupon_dict = tao_coupon_model.get_dict(where="prize_id=%s", params=[prize_roster_dict["prize_id"]])
-        if not tao_coupon_dict or tao_coupon_dict['right_ename'] == "":
-            return self.response_json_error("error", "奖品不是优惠券,无需领取")
-        top_base_model = TopBaseModel(context=self)
-        app_key,app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.alibaba_benefit_send(tao_coupon_dict['right_ename'], open_id, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error("error", "领取失败")
-        resp = invoke_result_data.data
-        if resp["alibaba_benefit_send_response"]:
-            if resp["alibaba_benefit_send_response"]["result_success"] == True:
-                prize_roster_model.update_table("prize_status=1", "id=%s", params=[user_prize_id])
-                result = {}
-                result["prize_name"] = resp["alibaba_benefit_send_response"]["prize_name"]
-                return self.response_json_success(result)
-            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_INVALID_OR_DELETED":
-                prize_roster_model.update_table("prize_status=10", "id=%s", params=[user_prize_id])
-                return self.response_json_error("error", "领取失败：优惠券无效或已删除")
-            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_SINGLE_COUPON_COUNT_EXCEED_LIMIT":
-                return self.response_json_error("error", "领取失败：优惠券超过限额")
-            if resp["alibaba_benefit_send_response"]["result_code"] == "USER_PERMISSION_EXCEED_MAX_RIGHT_COUNT_IN_DAY":
-                return self.response_json_error("error", "领取失败：同一张优惠券每天限领取一次")
-            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_ONE_SELLER_COUNT_EXCEED_LIMIT":
-                return self.response_json_error("error", "领取失败：用户优惠券超出10张限制")
-        else:
-            result = resp["sub_msg"] if resp["sub_msg"] else ""
-            if result == "" and resp["result_msg"]:
-                result = resp["result_msg"]
-            return self.response_json_error("error", f"领取失败:{result}")
-
-
-class UserAssetListHandler(ClientBaseHandler):
-    """
-    :description: 获取用户资产列表
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 获取用户资产列表
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        asset_type = int(self.get_param("asset_type", 0))
-
-        asset_base_model = AssetBaseModel(context=self)
-        return self.response_json_success(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type))
-
-
-class AssetLogListHandler(ClientBaseHandler):
-    """
-    :description: 资产流水记录
-    """
-    @filter_check_params("act_id,tb_user_id,asset_type")
-    def get_async(self):
-        """
-        :description: 资产流水记录
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param asset_object_id：资产对象标识
-        :param page_size：条数
-        :param page_index：页数
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        open_id = self.get_param("open_id")
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_object_id = self.get_param("asset_object_id")
-
-        asset_base_model = AssetBaseModel(context=self)
-        return self.response_json_success(asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id))
-
-
-class GetJoinMemberUrlHandler(ClientBaseHandler):
-    """
-    :description: 获取加入会员地址
-    """
-    def get_async(self):
-        """
-        :description: 获取加入会员地址
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_source_app_id()
-        is_log = bool(self.get_param("is_log",False))
-        app_base_model = AppBaseModel(context=self)
-        app_info_dict = app_base_model.get_app_info_dict(app_id)
-        if not app_info_dict:
-            return self.response_json_error("error", "小程序不存在")
-        app_key, app_secret = self.get_app_key_secret()
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.get_join_member_url(app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-30 15:46:34
+@LastEditTime: 2022-07-14 10:08:14
+@LastEditors: HuangJianYi
+@Description: 投放模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.launch_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+from seven_cloudapp_frame.models.db_models.launch.launch_plan_model import *
+
+
+class InitLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 初始化商品投放
+    """
+    def get_async(self):
+        """
+        :description: 初始化商品投放
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param source_types：商品来源，指定哪些位置的商品要进行投放（1活动奖品商品2价格档位商品） 多个逗号,分隔
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        source_types = self.get_param("source_types","1,2")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        app_base_model = AppBaseModel(context=self)
+        launch_base_model = LaunchBaseModel(context=self)
+        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
+        invoke_result_data = launch_base_model.init_launch_goods(app_id, act_id, source_types, online_url)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class ResetLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+    """
+    def get_async(self):
+        """
+        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+
+        close_goods_id = self.get_param("close_goods_id")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.reset_launch_goods(app_id, act_id, close_goods_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class InitLaunchGoodsCallBackHandler(ClientBaseHandler):
+    """
+    :description: 初始化投放商品回调接口
+    """
+    def get_async(self):
+        """
+        :description: 初始化投放商品回调接口
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
+        :param call_back_info：回调信息
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        close_goods_id = self.get_param("close_goods_id")
+        call_back_info = self.get_param("call_back_info")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.init_launch_goods_callback(app_id, act_id, close_goods_id, call_back_info)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class UpdateLaunchGoodsStatusHandler(ClientBaseHandler):
+    """
+    :description: 更改投放商品的状态
+    """
+    def get_async(self):
+        """
+        :description: 保存更改投放商品的状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param update_goods_id：更新商品ID（例：1）
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        goods_id = self.get_param("update_goods_id")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if goods_id != "":
+            LaunchGoodsModel(context=self).update_table("is_launch=abs(is_launch-1),is_sync=0,launch_date=%s", "app_id=%s and act_id=%s and goods_id=%s", [self.get_now_datetime(), app_id, act_id, goods_id])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class LaunchGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 投放商品列表
+    """
+    def get_async(self):
+        """
+        :description: 投放商品列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :return 列表
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+        goods_id = self.get_param("goods_id")
+        launch_status = self.get_param_int("launch_status", -1)
+        access_token = self.get_access_token()
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        launch_base_model = LaunchBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = launch_base_model.get_launch_goods_list(app_id, act_id, page_size, page_index, access_token, app_key, app_secret,goods_id,launch_status)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class AsyncLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 同步投放商品（小程序投放-商品绑定/解绑）
+    """
+    def get_async(self):
+        """
+        :description: 同步投放商品（小程序投放-商品绑定/解绑）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        access_token = self.get_access_token()
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        app_base_model = AppBaseModel(context=self)
+        online_url = app_base_model.get_online_url(act_id, app_id, module_id)
+        launch_base_model = LaunchBaseModel(context=self)
+
+        app_key, app_secret = self.get_app_key_secret()
+        launch_plan_model = LaunchPlanModel(context=self)
+        launch_plan = launch_plan_model.get_entity("act_id=%s", order_by="id desc", params=[act_id])
+        if launch_plan:
+            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, launch_plan.launch_url, access_token, app_key, app_secret)
+        else:
+            invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, online_url, access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class GetLaunchPlanStatusHandler(ClientBaseHandler):
+    """
+    :description: 获取投放计划状态
+    :param act_id：活动标识
+    :return 
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_param_int("act_id")
+        access_token = self.get_access_token()
+        app_key, app_secret = self.get_app_key_secret()
+        launch_base_model = LaunchBaseModel(context=self)
+        launch_status = launch_base_model.get_launch_plan_status(act_id, access_token, app_key, app_secret)
+        return self.response_json_success(launch_status)
+
+
+class AsyncLaunchGoodsStatusHandler(ClientBaseHandler):
+    """
+    :description: 同步投放商品（小程序投放-商品绑定）
+    :return
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_act_id()
+        redis_init = SevenHelper.redis_init()
+        redis_init.rpush("queue_async_lauch", act_id)
+        return self.response_json_success()
+
+
+class AddLaunchGoodsHandler(ClientBaseHandler):
+    """
+    :description: 添加投放商品
+    :param goods_ids：商品id串 逗号分隔
+    :return
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        goods_ids = self.get_param("goods_ids")
+        launch_base_model = LaunchBaseModel(context=self)
+        launch_base_model.add_launch_goods_v2(app_id, act_id, goods_ids)
+        return self.response_json_success()
+
+
+class CanLaunchGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 获取可投放商品列表（获取当前会话用户出售中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = self.get_param("page_size", 20)
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+
+        access_token = self.get_access_token()
+        app_key, app_secret = self.get_app_key_secret()
+        launch_base_model = LaunchBaseModel(context=self)
+        invoke_result_data = launch_base_model.can_launch_goods_list(page_index,page_size,goods_name,order_tag,order_by,access_token,app_key,app_secret,is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GetLaunchProgressHandler(ClientBaseHandler):
+    """
+    :description: 获取投放进度
+    :return 投放进度 0未完成  1：已完成
+    :last_editors: HuangJianYi
+    """
+    def get_async(self):
+        act_id = self.get_act_id()
+        launch_base_model = LaunchBaseModel(context=self)
+        return self.response_json_success(launch_base_model.get_launch_progress(act_id))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/core.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/core.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,27 +1,36 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2021-07-15 14:09:43
-@LastEditTime: 2021-08-10 16:42:18
-@LastEditors: HuangJianYi
-:description: 通用Handler
-"""
-from seven_framework.config import *
-from seven_framework.redis import *
-from seven_framework.web_tornado.base_handler.base_api_handler import *
-
-from seven_cloudapp_frame.handlers.frame_base import *
-
-
-class IndexHandler(FrameBaseHandler):
-    """
-    :description: 默认页
-    """
-    def get_async(self):
-        """
-        :description: 默认页
-        :param 
-        :return 字符串
-        :last_editors: HuangJianYi
-        """
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2021-07-15 14:09:43
+@LastEditTime: 2022-05-31 09:32:38
+@LastEditors: HuangJianYi
+:description: 通用Handler
+"""
+from seven_framework.config import *
+from seven_framework.redis import *
+from seven_framework.web_tornado.base_handler.base_api_handler import *
+
+from seven_cloudapp_frame.handlers.frame_base import *
+
+
+class IndexHandler(FrameBaseHandler):
+    """
+    :description: 默认页
+    """
+    def get_async(self):
+        """
+        :description: 默认页
+        :param 
+        :return 字符串
+        :last_editors: HuangJianYi
+        """
+        self.write(UUIDHelper.get_uuid() + "_" + config.get_value("run_port") + "_api")
+    
+    def head_async(self):
+        """
+        :description: 默认页
+        :param 
+        :return 字符串
+        :last_editors: HuangJianYi
+        """
         self.write(UUIDHelper.get_uuid() + "_" + config.get_value("run_port") + "_api")
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/frame_base.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/frame_base.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,808 +1,847 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-05-12 20:11:48
-@LastEditTime: 2021-10-28 09:15:32
-@LastEditors: HuangJianYi
-:description: 
-"""
-import ast
-import random
-import decimal
-import hashlib
-from copy import deepcopy
-from asq.initiators import query
-from urllib.parse import parse_qs, urlparse
-
-from seven_framework.redis import *
-from seven_framework.web_tornado.base_handler.base_api_handler import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.libs.customize.cryptography_helper import *
-from seven_cloudapp_frame.libs.customize.string_helper import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.operation.operation_log_model import *
-
-
-class FrameBaseHandler(BaseApiHandler):
-    """
-    :description: 公共handler基类
-    """
-
-    def prepare(self):
-        """
-        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
-        :last_editors: HuangJianYi
-        """
-        if self.__class__.__name__ == "IndexHandler":
-            return
-        self.is_encrypt = False
-        #获取请求参数
-        self._convert_request_params()
-        # 标记日志请求关联
-        dict_param = {}
-        dict_param["open_id"] = self.get_open_id()
-        if not dict_param["open_id"]:
-            dict_param["open_id"] = self.get_user_id()
-        dict_param["nick_name"] = self.get_user_nick()
-        dict_param["app_id"] = self.get_app_id()
-        if not dict_param["app_id"]:
-            dict_param["app_id"] = self.get_source_app_id()
-        self._build_http_log(dict_param)
-
-    def options_async(self):
-        self.response_json_success()
-
-    def check_xsrf_cookie(self):
-        return
-
-    def json_dumps(self, rep_dic):
-        """
-        :description: 将字典转化为字符串
-        :param rep_dic：字典对象
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.json_dumps(rep_dic)
-
-    def json_loads(self, rep_str):
-        """
-        :description: 将字符串转化为字典
-        :param rep_str：str
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.json_loads(rep_str)
-
-    def get_param(self, param_name, default="", strip=True, filter_sql=False, filter_special_key=False):
-        """
-        :description: 二次封装获取参数
-        :param param_name: 参数名
-        :param default: 如果无此参数，则返回默认值
-        :param filter_sql: 是否过滤sql关键字
-        :param filter_special_key: 是否过滤sql特殊字符
-        :return: 参数值
-        :last_editors: HuangJianYi
-        """
-        param_ret = ""
-
-        if self.request_params:
-            param_ret = self.request_params[param_name] if self.request_params.__contains__(param_name) else ""
-        else:
-            param_ret = self.get_argument(param_name, default, strip=strip)
-        if param_ret == "" or param_ret == "undefined":
-            param_ret = default
-        if filter_sql == True:
-            param_ret = StringHelper.filter_sql(param_ret)
-        if filter_special_key == True:
-            param_ret = StringHelper.filter_sql_special_key(param_ret)
-        return param_ret
-
-    def _convert_request_params(self):
-        """
-        :Description: 转换请求参数
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        self.request_params = {}
-        client_encrypt_type = config.get_value("client_encrypt_type", 0)  #客户端加密类型 0-无，1-aes加密，2-md5加密
-        server_encrypt_type = config.get_value("server_encrypt_type", 0)  #千牛端或后台加密类型 0-无，1-aes加密，2-md5加密
-        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
-        if is_encrypt == True and ("/server/" in self.request.uri and server_encrypt_type == 1) or ("/client/" in self.request.uri and client_encrypt_type == 1):
-            encrypt_key = config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-            app_id = self.get_argument("source_app_id", "", strip=True)
-            if not app_id:
-                app_id = config.get_value("app_id")
-            password = str(encrypt_key).replace("1", "l")
-            if self.request.method == "POST" and "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                try:
-                    json_params = json.loads(self.request.body)
-                    if json_params:
-                        for field in json_params:
-                            self.request_params[field] = json_params[field]
-                        par = json_params["par"] if json_params.__contains__("par") else ""
-                        dv = json_params["dv"] if json_params.__contains__("dv") else ""
-                        iv = app_id[0:10] + str(json_params["dv"])[0:6] if len(str(json_params["dv"])) >= 6 else ""
-                        body_params = json.loads(CryptographyHelper.aes_decrypt(str(json_params["par"]), password, iv))
-                        for field in body_params:
-                            self.request_params[field] = body_params[field]
-                except:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "参数解析错误"
-                    return invoke_result_data
-            else:
-                for field in self.request.arguments:
-                    self.request_params[field] = self.get_argument(field, "", strip=True)
-                if "par" in self.request.arguments and "dv" in self.request.arguments:
-                    par = self.get_argument("par", "", strip=True)
-                    dv = self.get_argument("dv", "", strip=True)
-                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
-                    try:
-                        body_params = json.loads(CryptographyHelper.aes_decrypt(par, password, iv))
-                        for field in body_params:
-                            self.request_params[field] = body_params[field]
-                    except:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "参数解析错误"
-                        return invoke_result_data
-        else:
-            if self.request.method == "POST" and "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                try:
-                    json_params = json.loads(self.request.body)
-                except:
-                    pass
-                if json_params:
-                    for field in json_params:
-                        self.request_params[field] = json_params[field]
-            else:
-                for field in self.request.arguments:
-                    self.request_params[field] = self.get_argument(field, "", strip=True)
-
-        return invoke_result_data
-
-    def response_custom(self, rep_dic):
-        """
-        :description: 输出公共json模型
-        :param rep_dic: 字典类型数据
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.http_response(self.json_dumps(rep_dic))
-
-    def response_common(self, success=True, data=None, error_code="", error_message=""):
-        """
-        :description: 输出公共json模型
-        :param success: 布尔值，表示本次调用是否成功
-        :param data: 类型不限，调用成功（success为true）时，服务端返回的数据
-        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
-        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        if hasattr(data, '__dict__'):
-            data = data.__dict__
-        template_value = {}
-        template_value['success'] = success
-        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
-        if is_encrypt == False:
-            template_value['data'] = data
-        else:
-            client_encrypt_type = config.get_value("client_encrypt_type", 0)
-            server_encrypt_type = config.get_value("server_encrypt_type", 0)
-            if ("/server/" in self.request.uri and server_encrypt_type == 1) or ("/client/" in self.request.uri and client_encrypt_type == 1):
-                dv = SevenHelper.get_random(16)
-                encrypt_key = config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-                app_id = self.get_argument("source_app_id", "", strip=True)
-                if not app_id:
-                    app_id = config.get_value("app_id")
-                password = str(encrypt_key).replace("1", "l")
-                iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
-                template_value['data'] = CryptographyHelper.aes_encrypt(self.json_dumps(data), password, iv)
-                template_value['dv'] = dv
-            else:
-                template_value['data'] = data
-        template_value['error_code'] = error_code
-        template_value['error_message'] = error_message
-
-        rep_dic = {}
-        rep_dic['success'] = True
-        rep_dic['data'] = template_value
-
-        log_extra_dict = {}
-        log_extra_dict["is_success"] = 1
-        if success == False:
-            log_extra_dict["is_success"] = 0
-
-        self.http_reponse(self.json_dumps(rep_dic), log_extra_dict)
-
-    def response_json_success(self, data=None):
-        """
-        :description: 通用成功返回json结构
-        :param data: 返回结果对象，即为数组，字典
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.response_common(data=data)
-
-    def response_json_error(self, error_code="", error_message="", data=None, log_type=0):
-        """
-        :description: 通用错误返回json结构
-        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
-        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
-        :param data: 返回结果对象，即为数组，字典
-        :param log_type: 日志记录类型（0-不记录，1-info，2-error）
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        if log_type == 1:
-            self.logging_link_info(f"{error_code}\n{error_message}\n{data}\n{self.request}")
-        elif log_type == 2:
-            self.logging_link_error(f"{error_code}\n{error_message}\n{data}\n{self.request}")
-        self.response_common(False, data, error_code, error_message)
-
-    def response_json_error_params(self):
-        """
-        :description: 通用参数错误返回json结构
-        :param desc: 返错误描述
-        :return: 将dumps后的数据字符串返回给客户端
-        :last_editors: HuangJianYi
-        """
-        self.response_common(False, None, "params error", "参数错误")
-
-    def return_dict_error(self, error_code="", error_message=""):
-        """
-        :description: 返回error信息字典模型
-        :param errorCode: 字符串，服务端返回的错误码
-        :param errorMessage: 字符串，服务端返回的错误信息
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        rep_dic = {}
-        rep_dic['error_code'] = error_code
-        rep_dic['error_message'] = error_message
-
-        self.logging_link_error(f"{error_code}\n{error_message}\n{self.request}")
-
-        return rep_dic
-
-    def get_now_datetime(self):
-        """
-        :description: 获取当前时间
-        :return: str
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.get_now_datetime()
-
-    def create_order_id(self, ran=5):
-        """
-        :description: 生成订单号
-        :param ran：随机数位数，默认5位随机数（0-5）
-        :return: 25位的订单号
-        :last_editors: HuangJianYi
-        """
-        return SevenHelper.create_order_id(ran)
-
-    def check_continue_request(self, handler_name, app_id, object_id, expire=100):
-        """
-        :description: 一个用户同一handler频繁请求校验，只对同用户同接口同请求参数进行限制
-        :param handler_name: handler名称
-        :param app_id: 应用标识
-        :param object_id: object_id(user_id或open_id)
-        :param expire: 间隔时间，单位毫秒
-        :return:满足频繁请求条件直接输出拦截
-        :last_editors: HuangJianYi
-        """
-        result = False, ""
-        if object_id and handler_name and app_id:
-            request_param_dict = {}
-            try:
-                if self.request.method == "POST" and "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                    request_param_dict = json.loads(self.request.body)
-                else:
-                    request_param_dict = dict([(k, v[0]) for k, v in parse_qs(self.request.query, True).items()])
-            except:
-                pass
-            sign = self.get_signature_md5(request_param_dict)
-            if SevenHelper.is_continue_request(f"continue_request:{handler_name}_{app_id}_{object_id}_{sign}", expire) == True:
-                result = True, f"操作太频繁,请{expire}毫秒后再试"
-        return result
-
-    def get_signature_md5(self, request_param_dict, encrypt_key=""):
-        """
-        :description: 参数按照加密规则进行MD5加密
-        :description: 签名规则 signature_md5= ((参数1=参数1值&参数2=参数2值&signature_stamp={signature_stamp}))+密钥)进行Md5加密转小写，参数顺序按照字母表的顺序排列
-        :param request_param_dict: 请求参数字典
-        :param encrypt_key: 接口密钥
-        :return: 加密后的md5值，由于跟客户端传来的加密参数进行校验
-        """
-        request_sign_params = {}
-        for k, v in request_param_dict.items():
-            if k == "param_signature_md5":
-                continue
-            if k == "signature_md5":
-                continue
-            request_sign_params[k] = str(v).replace(" ", "_seven_").replace("(", "_seven1_").replace(")", "_seven2_")
-        request_params_sorted = sorted(request_sign_params.items(), key=lambda e: e[0], reverse=False)
-        request_message = "&".join(k + "=" + CodingHelper.url_encode(v) for k, v in request_params_sorted)
-        request_message = request_message.replace("_seven_", "%20").replace("_seven1_", "(").replace("_seven2_", ")").replace("%27", "'")
-        # MD5摘要
-        request_encrypt = hashlib.md5()
-        request_encrypt.update((request_message + str(encrypt_key)).encode("utf-8"))
-        check_request_signature_md5 = request_encrypt.hexdigest().lower()
-        return check_request_signature_md5
-
-    def add_request_user(self, app_id, object_id):
-        """
-        :description: 每分钟流量UV计数,用于登录接口限制登录
-        :param app_id: 应用标识
-        :param object_id: 用户唯一标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init()
-        cache_key = f"request_user_list_{app_id}:{str(SevenHelper.get_now_int(fmt='%Y%m%d%H%M'))}"
-        redis_init.sadd(cache_key, object_id)
-        redis_init.expire(cache_key, 3600)
-
-    def check_request_user(self, app_id, current_limit_count, current_limit_minute=1):
-        """
-        :description: 每分钟流量UV校验
-        :param app_id: 应用标识
-        :param current_limit_count: 流量限制数
-        :param current_limit_minute: 流量限制时间，默认1分钟
-        :return: True代表满足限制条件进行拦截
-        :last_editors: HuangJianYi
-        """
-        if current_limit_count == 0:
-            return False
-        redis_init = SevenHelper.redis_init()
-        if current_limit_minute == 1:
-            cache_key = f"request_user_list_{app_id}:{str(SevenHelper.get_now_int(fmt='%Y%m%d%H%M'))}"
-        else:
-            key_list = []
-            for i in range(current_limit_minute):
-                now_minute_int = int((datetime.datetime.now() + datetime.timedelta(minutes=-i)).strftime('%Y%m%d%H%M'))
-                key = f"request_user_list_{app_id}:{str(now_minute_int)}"
-                key_list.append(key)
-            cache_key = f"request_user_list_{app_id}"
-            redis_init.sinterstore(cache_key, key_list)
-            redis_init.expire(cache_key, 3600)
-
-        if int(redis_init.scard(cache_key)) >= current_limit_count:
-            return True
-        else:
-            return False
-
-    def get_app_key_secret(self):
-        """
-        :description: 获取app_key和app_secret
-        :param 
-        :return app_key, app_secret
-        :last_editors: HuangJianYi
-        """
-        app_key = config.get_value("app_key")
-        app_secret = config.get_value("app_secret")
-        return app_key, app_secret
-
-    def set_default_headers(self):
-        """
-        :description: 设置默认头部，用于跨域请求
-        :return
-        :last_editors: HuangJianYi
-        """
-        allow_origin_list = config.get_value("allow_origin_list")
-        if not allow_origin_list:
-            return
-        origin = self.request.headers.get("Origin")
-        if origin in allow_origin_list:
-            self.set_header("Access-Control-Allow-Origin", origin)
-
-        self.set_header("Access-Control-Allow-Headers", "Origin,X-Requested-With,Content-Type,Accept,User-Token,Manage-ProductID,Manage-PageID,PYCKET_ID")
-        self.set_header("Access-Control-Allow-Methods", "POST,GET,OPTIONS")
-        self.set_header("Access-Control-Allow-Credentials", "true")
-
-    def get_user_nick(self):
-        """
-        :description: 获取用户昵称
-        淘宝小程序 如果要在test和online环境指定账号打开后台测试，需由前端写死传入
-        :return str
-        :last_editors: HuangJianYi
-        """
-        user_nick = self.get_param("user_nick")
-        #淘宝小程序 source_app_id在本地环境返回空；在test和online环境返回后端模板id，无论在IDE还是千牛端
-        if self.get_param("source_app_id") == "":
-            user_nick = config.get_value("test_user_nick")
-        return user_nick
-
-    def get_open_id(self):
-        """
-        :description: 获取open_id
-        :return str
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_param("open_id")
-        if self.get_param("source_app_id") == "":
-            open_id = config.get_value("test_open_id")
-        return open_id
-
-    def get_user_id(self):
-        """
-        :description: 获取user_id
-        :param self
-        :return str
-        :last_editors: HuangJianYi
-        """
-        user_id = int(self.get_param("tb_user_id", 0))
-        if user_id == 0:
-            user_id = int(self.get_param("user_id", 0))
-        return user_id
-
-    def get_source_app_id(self):
-        """
-        :description: 获取source_app_id(客户端使用)
-        :return str
-        :last_editors: HuangJianYi
-        """
-        source_app_id = self.get_param("source_app_id")
-        #淘宝小程序 在IDE上返回前端模板id，无论哪个环境；在千牛端上返回正确的小程序id
-        if source_app_id == config.get_value("client_template_id"):
-            source_app_id = config.get_value("test_source_app_id")
-        return source_app_id
-
-    def get_app_id(self):
-        """
-        :description: 获取app_id(后台使用)
-        :param self
-        :return str
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_param("app_id")
-        if app_id == "":
-            plat_type = config.get_value("plat_type", 1)  # 平台类型 1淘宝2微信3抖音
-            user_nick = self.get_user_nick()
-            if user_nick and plat_type == 1:
-                store_user_nick = user_nick.split(':')[0]
-                if store_user_nick:
-                    app_info_dict = AppInfoModel(context=self).get_cache_dict(where="store_user_nick=%s", field="app_id", params=store_user_nick)
-                    if app_info_dict:
-                        app_id = app_info_dict["app_id"]
-        return app_id
-
-    def create_operation_log(self, operation_type=1, model_name="", handler_name="", old_detail=None, update_detail=None, operate_user_id="", operate_user_name=""):
-        """
-        :description: 创建操作日志
-        :param operation_type：操作类型：1-add，2-update，3-delete
-        :param model_name：模块或表名称
-        :param handler_name：handler名称
-        :param old_detail：当前信息
-        :param update_detail：更新之后的信息
-        :param operate_user_id：操作人标识
-        :param operate_user_name：操作人名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        operation_log = OperationLog()
-        operation_log_model = OperationLogModel(context=self)
-
-        operation_log.app_id = ""
-        operation_log.act_id = int(self.get_param("act_id", 0))
-        operation_log.open_id = self.get_open_id()
-        operation_log.user_nick = self.get_user_nick()
-        operation_log.request_params = self.request_params
-        operation_log.method = self.request.method
-        operation_log.protocol = self.request.protocol
-        operation_log.request_host = self.request.host
-        operation_log.request_uri = self.request.uri
-        operation_log.remote_ip = self.get_remote_ip()
-        operation_log.create_date = TimeHelper.get_now_format_time()
-        operation_log.operation_type = operation_type
-        operation_log.model_name = model_name
-        operation_log.handler_name = handler_name
-        operation_log.detail = old_detail if old_detail else {}
-        operation_log.update_detail = update_detail if update_detail else {}
-        operation_log.operate_user_id = operate_user_id
-        operation_log.operate_user_name = operate_user_name
-
-        if isinstance(operation_log.request_params, dict):
-            operation_log.request_params = self.json_dumps(operation_log.request_params)
-        if isinstance(old_detail, dict):
-            operation_log.detail = self.json_dumps(old_detail)
-        if isinstance(update_detail, dict):
-            operation_log.update_detail = self.json_dumps(update_detail)
-
-        operation_log_model.add_entity(operation_log)
-
-
-
-class ClientBaseHandler(FrameBaseHandler):
-    """
-    :description: 客户端handler基类
-    """
-
-    def prepare(self):
-        """
-        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
-        :last_editors: HuangJianYi
-        """
-        if self.__class__.__name__ == "IndexHandler":
-            return
-        #获取请求参数
-        invoke_result_data = self._convert_request_params()
-        if invoke_result_data.success == False:
-            self.request_code = UUIDHelper.get_uuid()
-            self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-            self.finish()
-            return
-
-        dict_param = {}
-        dict_param["open_id"] = self.get_open_id()
-        if not dict_param["open_id"]:
-            dict_param["open_id"] = self.get_user_id()
-        dict_param["nick_name"] = self.get_user_nick()
-        dict_param["app_id"] = self.get_app_id()
-        if not dict_param["app_id"]:
-            dict_param["app_id"] = self.get_source_app_id()
-
-        # 标记日志请求关联
-        self._build_http_log(dict_param)
-
-        try:
-            # 将设备信息字符串转为字典类型
-            self.device_info_dict = {}
-            clientheaderinfo_string = self.request.headers._dict.get("Clientheaderinfo")
-            if clientheaderinfo_string:
-                self.device_info_dict = self.get_device_info_dict(clientheaderinfo_string)
-
-            # 验证超时 10分钟过期
-            client_encrypt_type = config.get_value("client_encrypt_type", 0)
-            server_encrypt_type = config.get_value("server_encrypt_type", 0)
-            is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
-            if is_encrypt == True and ("/server/" in self.request.uri and server_encrypt_type == 1) or ("/client/" in self.request.uri and client_encrypt_type == 1):
-                now_time = TimeHelper.get_now_timestamp(True)
-                if self.request_params.__contains__("timestamp") and (now_time - int(self.request_params["timestamp"]) > int(1000 * 60 * 10)):
-                    self.response_json_error("timestamp", "超时操作")
-                    self.finish()
-                    return
-
-            # 频繁请求校验
-            if dict_param["open_id"] and "/client/" in self.request.uri:
-                is_continue_request, error_message = self.check_continue_request(self.__class__.__name__, dict_param["app_id"], dict_param["open_id"])
-                if is_continue_request:
-                    self.response_json_error("error", error_message)
-                    self.finish()
-                    return
-
-                #每分钟流量UV计数,用于登录接口限制登录
-                self.add_request_user(str(dict_param["app_id"]), str(dict_param["open_id"]))
-
-        except Exception as ex:
-            self.logging_link_error("【客户端handler基类】" + traceback.format_exc())
-
-    def get_online_url(self, act_id, app_id, module_id=0):
-        """
-        :description: 获取online_url
-        :param act_id:活动标识
-        :param app_id:应用标识
-        :param module_id:模块标识
-        :param page:跳转的首页地址pages/index/index
-        :return str
-        :last_editors: HuangJianYi
-        """
-        page_index = ""
-        page = config.get_value("page_index")
-        if page:
-            page_index = "&page=" + CodingHelper.url_encode(page)
-        query = CodingHelper.url_encode(f"actid={act_id}")
-        if module_id > 0:
-            query = CodingHelper.url_encode(f"actid={act_id}&module_id={module_id}")
-        online_url = f"https://m.duanqu.com/?_ariver_appid={app_id}{page_index}&query={query}"
-        return online_url
-
-    def get_live_url(self, app_id):
-        """
-        :description: 获取live_url
-        :param app_id:应用标识
-        :return str
-        :last_editors: HuangJianYi
-        """
-        live_url = f"https://market.m.taobao.com/app/taefed/shopping-delivery-wapp/index.html#/putin?mainKey=form&appId={app_id}"
-        return live_url
-
-    def get_device_info_dict(self, device_str):
-        """
-        :description: 获取头部参数字典
-        :param device_string:头部信息串
-        :last_editors: HuangJianYi
-        """
-        device_info_dict = {}
-        info_model = parse_qs(device_str)
-        device_info_dict["pid"] = int(info_model["pid"][0])  # 产品标识
-        device_info_dict["chid"] = 0 if "chid" not in info_model.keys() else int(info_model["chid"][0])  # 渠道标识
-        device_info_dict["height"] = 0 if "height" not in info_model.keys() else int(info_model["height"][0])  # 高度
-        device_info_dict["width"] = 0 if "width" not in info_model.keys() else int(info_model["width"][0])  # 宽度
-        device_info_dict["version"] = "" if "version" not in info_model.keys() else info_model["version"][0]  # 客户端版本号
-        device_info_dict["app_version"] = "" if "app_version" not in info_model.keys() else info_model["app_version"][0]  # 小程序版本号
-        device_info_dict["net"] = "" if "net" not in info_model.keys() else info_model["net"][0]  # 网络
-        device_info_dict["model_p"] = "" if "model" not in info_model.keys() else info_model["model"][0]  # 机型
-        device_info_dict["lang"] = "" if "lang" not in info_model.keys() else info_model["lang"][0]  #语言
-        device_info_dict["ver_no"] = "" if "ver_no" not in info_model.keys() else info_model["ver_no"][0]  #接口版本号
-        device_info_dict["timestamp"] = 0 if "timestamp" not in info_model.keys() else int(info_model["timestamp"][0])  # 时间搓毫秒
-        device_info_dict["signature_md5"] = "" if "signature_md5" not in info_model.keys() else info_model["signature_md5"][0]  # 签名md5
-        return device_info_dict
-
-    def emoji_base64_to_emoji(self, text_str):
-        """
-        :description: 把加密后的表情还原
-        :param text_str: 加密后的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
-        results = re.findall('\[em_(.*?)\]', text_str)
-        if results:
-            for item in results:
-                text_str = str(text_str).replace("[em_{0}]".format(item), CryptographyHelper.base64_decrypt(item))
-        return text_str
-
-    def emoji_to_emoji_base64(self, text_str):
-        """
-        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
-        :description: 性能遇到问题时重新设计转换程序
-        :param text_str: 未加密的字符串
-        :return: 解密后的表情字符串
-        :last_editors: HuangJianYi 
-        """
-        list_e = []
-        for i in text_str:
-            list_e.append(i)
-        for location, item_emoji in enumerate(text_str):
-            if item_emoji in unicode_codes.UNICODE_EMOJI["en"]:
-                emoji_base64 = CryptographyHelper.base64_encrypt(item_emoji, "utf-8")
-                list_e[location] = "[em_" + emoji_base64 + "]"
-        return "".join(list_e)
-
-
-
-def filter_check_params(must_params=None):
-    """
-    :description: 参数过滤装饰器 仅限handler使用,
-                  提供参数的检查及获取参数功能
-                  装饰器使用方法:
-                  @client_filter_check_params("param_a,param_b,param_c")  或
-                  @client_filter_check_params(["param_a","param_b,param_c"])
-                  参数获取方法:
-                  self.request_params[param_key]
-    :param must_params: 必须传递的参数集合
-    :last_editors: HuangJianYi
-    """
-    def check_params(handler):
-        def wrapper(self, **args):
-            finally_must_params = must_params
-            if hasattr(self, "must_params"):
-                finally_must_params = self.must_params
-            if type(finally_must_params) == str:
-                must_array = finally_must_params.split(",")
-            if type(finally_must_params) == list:
-                must_array = finally_must_params
-
-            if finally_must_params:
-                for must_param in must_array:
-                    if not must_param in self.request_params or self.request_params[must_param] == "":
-                        self.response_json_error("param_error", "参数错误,缺少必传参数")
-                        return
-
-            return handler(self, **args)
-
-        return wrapper
-
-    return check_params
-
-
-
-def filter_check_head_sign(is_check=True, no_check_params=None):
-    """
-    :description: 头部过滤装饰器 仅限handler使用
-    :param is_check: 是否开启校验
-    :param no_check_params: 不加入参数校验的参数集合
-    :last_editors: HuangJianYi
-    """
-    def check_head(handler):
-        def wrapper(self, **args):
-            encrypt_key = config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-            is_check_head = config.get_value("is_check_head", False)
-            if is_check_head == False:
-                is_check = False
-            else:
-                is_check = True
-            if is_check == True:
-                try:
-                    if type(no_check_params) == str:
-                        no_check_array = no_check_params.split(",")
-                    elif type(no_check_params) == list:
-                        no_check_array = no_check_params
-                    else:
-                        no_check_array = []
-                    # 验证是否有设备信息
-                    clientheaderinfo_string = self.request.headers._dict.get("Clientheaderinfo")
-                    if clientheaderinfo_string:
-                        # 将设备信息字符串转为字典类型
-                        device_info_dict = self.device_info_dict(clientheaderinfo_string)
-                        # 验证签名超时 10分钟过期
-                        now_time = TimeHelper.get_now_timestamp(True)
-                        if now_time - device_info_dict["timestamp"] > int(1000 * 60 * 10):
-                            return self.response_json_error("timestamp", "超时操作")
-                        # 验证是否有头部信息签名
-                        if not device_info_dict.__contains__("signature_md5"):
-                            return self.response_json_error("signature_md5", "缺少参数signature_md5")
-                        # 验证头部签名是否成功
-                        client_head_dict = dict([(k, v[0]) for k, v in parse_qs(clientheaderinfo_string, True).items() if not k in no_check_array])
-                        head_signature_md5 = self.get_signature_md5(client_head_dict, encrypt_key)
-                        signature_md5 = device_info_dict["signature_md5"].lower()
-                        if signature_md5 != head_signature_md5:
-                            return self.response_json_error("signature_fail", "头部签名验证失败")
-                    else:
-                        return self.response_json_error("no_device_info", "没有提交设备信息")
-                except Exception as ex:
-                    self.logging_link_error("【头部校验异常】" + traceback.format_exc())
-                    return self.response_json_error("error", "头部验证失败")
-
-            return handler(self, **args)
-
-        return wrapper
-
-    return check_head
-
-
-
-def filter_check_params_sign(is_check=True, no_check_params=None):
-    """
-    :description: 请求参数过滤装饰器 仅限handler使用
-    :param is_check: 是否开启校验
-    :param no_check_params: 不加入参数校验的参数集合
-    :last_editors: HuangJianYi
-    """
-    def check_params(handler):
-        def wrapper(self, **args):
-            encrypt_key = config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
-            client_encrypt_type = config.get_value("client_encrypt_type", 0)
-            server_encrypt_type = config.get_value("server_encrypt_type", 0)
-            if ("/server/" in self.request.uri and server_encrypt_type != 2) or ("/client/" in self.request.uri and client_encrypt_type != 2):
-                is_check = False
-            else:
-                is_check = True
-            if is_check == True:
-                try:
-                    if type(no_check_params) == str:
-                        no_check_array = no_check_params.split(",")
-                    elif type(no_check_params) == list:
-                        no_check_array = no_check_params
-                    else:
-                        no_check_array = []
-                    # 验证参数
-                    request_param_dict = {}
-                    try:
-                        if self.request.method == "POST" and "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
-                            request_param_dict = json.loads(self.request.body)
-                        else:
-                            request_param_dict = dict([(k, v[0]) for k, v in parse_qs(self.request.query, True).items() if not k in no_check_array])
-                    except:
-                        pass
-                    if not request_param_dict.__contains__("param_signature_md5"):
-                        return self.response_json_error("signature_fail", "缺少参数param_signature_md5")
-                    check_request_signature_md5 = self.get_signature_md5(request_param_dict, encrypt_key)
-                    param_signature_md5 = request_param_dict["param_signature_md5"].lower()
-                    if check_request_signature_md5 != param_signature_md5:
-                        return self.response_json_error("signature_fail", "参数签名验证失败")
-
-                except Exception as ex:
-                    self.logging_link_error("【请求参数校验异常】" + traceback.format_exc())
-                    return self.response_json_error("error", "请求参数验证失败")
-
-            return handler(self, **args)
-
-        return wrapper
-
-    return check_params
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-04-24 15:15:19
+@LastEditTime: 2023-06-06 09:49:55
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+import ast
+import random
+import decimal
+import hashlib
+from copy import deepcopy
+from unittest import result
+from asq.initiators import query
+from urllib.parse import parse_qs, urlparse
+
+from seven_framework.redis import *
+from seven_framework.web_tornado.base_handler.base_api_handler import *
+
+from seven_cloudapp_frame.handlers.filter_base import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.customize.cryptography_helper import *
+from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
+from seven_cloudapp_frame.models.enum import PlatType
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.operate_base_model import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.db_models.app.app_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.operation.operation_log_model import *
+
+
+class FrameBaseHandler(BaseApiHandler):
+    """
+    :description: 公共handler基类
+    """
+
+    def get_http_log_extra_dict(self):
+        """
+        :Description: 获取http日志参数字典
+        :last_editors: HuangJianYi
+        """
+        dict_param = {}
+        if share_config.get_value("plat_type", PlatType.tb.value) != PlatType.web.value:  #平台类型：如果是web站点，从cookie取
+            dict_param["open_id"] = self.get_open_id()
+            if not dict_param["open_id"]:
+                dict_param["open_id"] = self.get_user_id()
+        else:
+            dict_param["open_id"] = self.get_cooke_user_id()
+        dict_param["nick_name"] = self.get_user_nick()
+        dict_param["app_id"] = self.get_app_id()
+        dict_param["source_type"] = self._request_source_type()
+        return dict_param
+
+    def prepare(self):
+        """
+        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
+        :last_editors: HuangJianYi
+        """
+        try:
+            if self.__class__.__name__ == "IndexHandler":
+                return
+            self.is_encrypt = False
+            #获取请求参数
+            self._convert_request_params()
+            # 标记日志请求关联
+            dict_param = self.get_http_log_extra_dict()
+            self._build_http_log(dict_param)
+            # 记录请求参数明文
+            if share_config.get_value("log_plain", True) == True and self.is_api_encrypt() == True:
+                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
+
+        except Exception as ex:
+            if not hasattr(self, "request_code"):
+                self.request_code = UUIDHelper.get_uuid()
+            self.logging_link_error("【公共handler基类】" + traceback.format_exc())
+
+    def options_async(self):
+        self.response_json_success()
+
+    def check_xsrf_cookie(self):
+        return
+
+    def set_default_headers(self):
+        allow_origin_list = share_config.get_value("allow_origin_list")
+        if allow_origin_list:
+            origin = self.request.headers.get("Origin")
+            if origin in allow_origin_list:
+                self.set_header("Access-Control-Allow-Origin", origin)
+
+        self.set_header("Access-Control-Allow-Headers", "Origin,X-Requested-With,Content-Type,Accept,User-Token,Manage-ProductID,Manage-PageID,PYCKET_ID")
+        self.set_header("Access-Control-Allow-Methods", "POST,GET,OPTIONS,PUT,DELETE")
+        self.set_header("Access-Control-Allow-Credentials", "true")
+
+    def json_dumps(self, rep_dic):
+        """
+        :description: 将字典转化为字符串
+        :param rep_dic：字典对象
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.json_dumps(rep_dic)
+
+    def json_loads(self, rep_str):
+        """
+        :description: 将字符串转化为字典
+        :param rep_str：str
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.json_loads(rep_str)
+
+    def get_param(self, param_name, default="", strip=True, filter_sql=False, filter_special_key=False):
+        """
+        :description: 二次封装获取参数
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :return: 参数值
+        :last_editors: HuangJianYi
+        """
+        param_ret = ""
+
+        if self.request_params:
+            param_ret = self.request_params[param_name] if self.request_params.__contains__(param_name) else ""
+        else:
+            param_ret = self.get_argument(param_name, default, strip=strip)
+        if param_ret in ["undefined",None,""]:
+            param_ret = default
+        param_ret = RiskManageHelper.filter_routine_key(param_ret)
+        if filter_sql == True:
+            param_ret = RiskManageHelper.filter_sql(param_ret)
+        if filter_special_key == True:
+            param_ret = RiskManageHelper.filter_special_key(param_ret)
+        return param_ret
+
+    def get_param_int(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, contain_list=[], range_list=[]):
+        """
+        :description: 二次封装获取参数转整形
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :param contain_list: 包含列表，举例：[1,2,3,4]
+        :param range_list: 区间列表，只能有两个元素，举例：[1,10]
+        :param filter_special_key: 是否过滤sql特殊字符
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_int(param, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "int", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        else:
+            if len(contain_list) > 0 and not param in contain_list:
+                log_info = {"param": param_name, "type": "int", "info": "参数不在包含范围内"}
+                if throw_response_error == True:
+                    self.response_json_error("param_error", log_info["info"], log_info)
+                    raise Finish()
+                else:
+                    self.param_error_list.append(log_info)
+
+            if len(range_list) == 2 and (param < range_list[0] or param > range_list[1]):
+                log_info = {"param": param_name, "type": "int", "info": "参数不在区间范围内"}
+                if throw_response_error == True:
+                    self.response_json_error("param_error", log_info["info"], log_info)
+                    raise Finish()
+                else:
+                    self.param_error_list.append(log_info)
+        return param
+
+    def get_param_decimal(self, param_name, default=0, strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True):
+        """
+        :description: 二次封装获取参数转浮点
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_decimal(param, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "decimal", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        return param
+
+    def get_param_datetime(self, param_name, default='1900-01-01 00:00:00', strip=True, filter_sql=False, filter_special_key=False, throw_response_error=True, fmt='%Y-%m-%d %H:%M:%S'):
+        """
+        :description: 二次封装获取参数转时间
+        :param param_name: 参数名
+        :param default: 如果无此参数，则返回默认值
+        :param filter_sql: 是否过滤sql关键字
+        :param filter_special_key: 是否过滤sql特殊字符
+        :param throw_response_error: 是否直接输出错误响应
+        :param fmt:时间格式化
+        :return: 转换后的参数值
+        :last_editors: HuangJianYi
+        """
+        from tornado.web import Finish
+        if not hasattr(self, "param_error_list"):
+            self.param_error_list = []
+        param = self.get_param(param_name, default, strip, filter_sql, filter_special_key)
+        param, status = SevenHelper.to_date_time(param, fmt, default, True)
+        if status == False:
+            log_info = {"param": param_name, "type": "datetime", "info": "参数格式错误"}
+            if throw_response_error == True:
+                self.response_json_error("param_error", log_info["info"], log_info)
+                raise Finish()
+            else:
+                self.param_error_list.append(log_info)
+        return param
+
+    def is_api_encrypt(self):
+        """
+        :Description: 校验是否加密
+        :last_editors: HuangJianYi
+        """
+        client_encrypt_type = share_config.get_value("client_encrypt_type", 0)  #客户端加密类型 0-无，1-aes加密
+        server_encrypt_type = share_config.get_value("server_encrypt_type", 0)  #千牛端或后台加密类型 0-无，1-aes加密
+        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
+        request_source_type = self._request_source_type()
+        if is_encrypt == True and (request_source_type == 2 and server_encrypt_type == 1) or (request_source_type == 1 and client_encrypt_type == 1):
+            return True
+        else:
+            return False
+
+    def _request_source_type(self):
+        """
+        :Description: 请求来源类型 0-未知 1-client(客户端) 2-server(服务端)
+        :last_editors: HuangJianYi
+        """
+        uri = self.request.uri
+        if "/client/" in uri:
+            return 1
+        elif "/server/" in uri:
+            return 2
+        else:
+            return share_config.get_value("source_type", 0)
+
+    def _get_encrypt_appkey(self, json_params):
+        """
+        :Description: 获取加解密appkey,取值顺序：app_id ——> source_app_id ——> app_key ——> app_id
+        :param json_params: json参数字典
+        :last_editors: HuangJianYi
+        """
+        app_key = None
+        if json_params:
+            app_key = json_params.get("app_id", "")
+            app_key = app_key if app_key else json_params.get("source_app_id", "")
+        if not app_key:
+            app_key = self.get_argument("app_id", "", strip=True)
+            app_key = app_key if app_key else self.get_argument("source_app_id", "", strip=True)
+            app_key = app_key if app_key else share_config.get_value("app_key")
+            app_key = app_key if app_key else share_config.get_value("app_id")
+        return app_key
+
+    def _convert_request_params(self):
+        """
+        :Description: 转换请求参数 post请求：Content-type必须为application/json，前端必须对对象进行序列化转成json字符串，不能直接传对象,否则无法接收参数,存在特殊字符的参数必须进行url编码，否则+会被变成空值
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        self.request_params = {}
+        self.content_type = ""
+        if self.is_api_encrypt() == True:
+            encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
+            if hasattr(self, "encrypt_key"):
+                encrypt_key = self.encrypt_key
+            json_params = None
+            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
+                self.content_type = "application/json"
+                json_params = json.loads(self.request.body)
+            app_id = self._get_encrypt_appkey(json_params)
+            if not app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "param_error"
+                invoke_result_data.error_message = "缺少必传参数"
+                return invoke_result_data
+            password = str(encrypt_key).replace("1", "l")
+            if self.content_type == "application/json":
+                try:
+                    if json_params:
+                        for field in json_params:
+                            self.request_params[field] = json_params[field]
+                        par = json_params["par"] if json_params.__contains__("par") else ""
+                        if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
+                            par = CodingHelper.url_decode(par)
+                        dv = json_params["dv"] if json_params.__contains__("dv") else ""
+                        if not par or not dv:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "参数解析错误"
+                            return invoke_result_data
+                        iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                        body_params = json.loads(CryptographyHelper.aes_decrypt(str(par), password, iv))
+                        for field in body_params:
+                            self.request_params[field] = body_params[field]
+                except:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "参数解析错误"
+                    return invoke_result_data
+            else:
+                for field in self.request.arguments:
+                    self.request_params[field] = self.get_argument(field, "", strip=True)
+                if "par" in self.request.arguments and "dv" in self.request.arguments:
+                    par = self.get_argument("par", "", strip=True)
+                    if self.request.headers and self.request.headers.get("Referer","").lower().find("/devtools/") >= 0:
+                        par = CodingHelper.url_decode(par)
+                    dv = self.get_argument("dv", "", strip=True)
+                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                    try:
+                        body_params = json.loads(CryptographyHelper.aes_decrypt(par, password, iv))
+                        for field in body_params:
+                            self.request_params[field] = body_params[field]
+                    except:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "参数解析错误"
+                        return invoke_result_data
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "参数解析错误"
+                    return invoke_result_data
+
+        else:
+            if "Content-Type" in self.request.headers and self.request.headers["Content-type"].lower().find("application/json") >= 0 and self.request.body:
+                try:
+                    self.content_type = "application/json"
+                    json_params = json.loads(self.request.body)
+                    if json_params:
+                        for field in json_params:
+                            self.request_params[field] = json_params[field]
+                except:
+                    pass
+            else:
+                for field in self.request.arguments:
+                    self.request_params[field] = self.get_argument(field, "", strip=True)
+
+        return invoke_result_data
+
+    def response_custom(self, rep_dic):
+        """
+        :description: 输出公共json模型
+        :param rep_dic: 字典类型数据
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.http_response(self.json_dumps(rep_dic))
+
+    def response_common(self, success=True, data=None, error_code="", error_message="", is_close_encrypt=False):
+        """
+        :description: 输出公共json模型
+        :param success: 布尔值，表示本次调用是否成功
+        :param data: 类型不限，调用成功（success为true）时，服务端返回的数据
+        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
+        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
+        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
+        :return: 将dumps后的数据字符串返回给客户端   
+        :last_editors: HuangJianYi
+        """
+        if hasattr(data, '__dict__'):
+            data = data.__dict__
+        template_value = {}
+        template_value['success'] = success
+        is_encrypt = False if hasattr(self, "is_encrypt") and self.is_encrypt == False else True
+        if is_encrypt == False:
+            template_value['data'] = data
+        else:
+            if self.is_api_encrypt() == True:
+                json_params = None
+                if hasattr(self, "content_type") and self.content_type == "application/json":
+                    json_params = json.loads(self.request.body)
+                app_id = self._get_encrypt_appkey(json_params)
+                if app_id and is_close_encrypt == False:
+                    dv = SevenHelper.get_random(16)
+                    encrypt_key = share_config.get_value("encrypt_key", "r8C1JpyAXxrFV26V")
+                    if hasattr(self, "encrypt_key"):
+                        encrypt_key = self.encrypt_key
+                    password = str(encrypt_key).replace("1", "l")
+                    iv = app_id[0:10] + str(dv)[0:6] if len(str(dv)) >= 6 else ""
+                    template_value['data'] = CryptographyHelper.aes_encrypt(self.json_dumps(data), password, iv)
+                    template_value['dv'] = dv
+                    if share_config.get_value("log_plain", True) == True:
+                        self.logging_link_info(f"plain_response_data:{self.json_dumps(data)}")
+                else:
+                    template_value['data'] = data
+            else:
+                template_value['data'] = data
+        template_value['error_code'] = "error" if not error_code and success == False else error_code
+        template_value['error_message'] = "系统异常" if not error_message and success == False else error_message
+
+        rep_dic = {}
+        rep_dic['success'] = True
+        rep_dic['data'] = template_value
+
+        log_extra_dict = {}
+        log_extra_dict["is_success"] = 1
+        if success == False:
+            log_extra_dict["is_success"] = 0
+
+        self.http_reponse(self.json_dumps(rep_dic), log_extra_dict)
+
+    def response_json_success(self, data=None, is_close_encrypt=False):
+        """
+        :description: 通用成功返回json结构
+        :param data: 返回结果对象，即为数组，字典
+        :param is_close_encrypt: 是否关闭输出加密（True-是 False-否）
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.response_common(data=data, is_close_encrypt=is_close_encrypt)
+
+    def response_json_error(self, error_code="", error_message="", data=None, log_type=0):
+        """
+        :description: 通用错误返回json结构
+        :param errorCode: 字符串，调用失败（success为false）时，服务端返回的错误码
+        :param errorMessage: 字符串，调用失败（success为false）时，服务端返回的错误信息
+        :param data: 返回结果对象，即为数组，字典
+        :param log_type: 日志记录类型（0-不记录，1-info，2-error）
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        if log_type == 1:
+            self.logging_link_info(f"{error_code}\n{error_message}\n{data}\n{self.request}")
+        elif log_type == 2:
+            self.logging_link_error(f"{error_code}\n{error_message}\n{data}\n{self.request}")
+        self.response_common(False, data, error_code, error_message)
+
+    def response_json_error_params(self):
+        """
+        :description: 通用参数错误返回json结构
+        :param desc: 返错误描述
+        :return: 将dumps后的数据字符串返回给客户端
+        :last_editors: HuangJianYi
+        """
+        self.response_common(False, None, "params error", "参数错误")
+
+    def return_dict_error(self, error_code="", error_message=""):
+        """
+        :description: 返回error信息字典模型
+        :param errorCode: 字符串，服务端返回的错误码
+        :param errorMessage: 字符串，服务端返回的错误信息
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        rep_dic = {}
+        rep_dic['error_code'] = error_code
+        rep_dic['error_message'] = error_message
+
+        self.logging_link_error(f"{error_code}\n{error_message}\n{self.request}")
+
+        return rep_dic
+
+    def get_now_datetime(self):
+        """
+        :description: 获取当前时间
+        :return: str
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.get_now_datetime()
+
+    def create_order_id(self, ran=5):
+        """
+        :description: 生成订单号
+        :param ran：随机数位数，默认5位随机数（0-5）
+        :return: 25位的订单号
+        :last_editors: HuangJianYi
+        """
+        return SevenHelper.create_order_id(ran)
+
+    def get_app_key_secret(self):
+        """
+        :description: 获取app_key和app_secret
+        :param 
+        :return app_key, app_secret
+        :last_editors: HuangJianYi
+        """
+        app_key = share_config.get_value("app_key")
+        app_secret = share_config.get_value("app_secret")
+        return app_key, app_secret
+
+    def get_user_nick(self):
+        """
+        :description: 获取用户昵称
+        淘宝小程序 如果要在test和online环境指定账号打开后台测试，需由前端写死传入
+        :return str
+        :last_editors: HuangJianYi
+        """
+        user_nick = self.get_param("nick_name")
+        if not user_nick:
+            user_nick = self.get_param("user_nick")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            #淘宝小程序 source_app_id在本地环境返回空；在test和online环境返回后端模板id，无论在IDE还是千牛端
+            if self.get_param("source_app_id") == "":
+                test_config = share_config.get_value("test_config", {})
+                user_nick = test_config.get("user_nick", "")
+        return user_nick
+
+    def get_open_id(self):
+        """
+        :description: 获取open_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        open_id = self.get_param("open_id")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            if self.get_param("source_app_id") == "":
+                test_config = share_config.get_value("test_config", {})
+                open_id = test_config.get("open_id", "")
+        return open_id
+
+    def get_user_id(self):
+        """
+        :description: 获取user_id,后续新项目统一使用user_code,tb_user_id和user_id只做兼容旧项目使用保留
+        :param self
+        :return str
+        :last_editors: HuangJianYi
+        """
+        user_id = self.get_param_int("user_code")
+        if user_id == 0:
+            user_id = self.get_param_int("tb_user_id")
+            if user_id == 0:
+                user_id = self.get_param_int("user_id")
+        return user_id
+
+    def get_cooke_user_id(self):
+        """
+        :description: 获取cookie中的用户信息,适用场景H5
+        :return:
+        :last_editors: HuangJianYi
+        """
+        test_config = share_config.get_value("test_config", {})
+        user_id = test_config.get("user_id", 0)
+        if user_id <= 0:
+            cookie_user_id = int(self.get_cookie("user_id", 0))
+            cookie_user_id_md5 = self.get_cookie("user_id_md5", "")
+            check_user_id_md5 = CryptoHelper.md5_encrypt(str(cookie_user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
+            if cookie_user_id <= 0 or cookie_user_id_md5 != check_user_id_md5:
+                user_id = 0
+            else:
+                user_id = cookie_user_id
+        return user_id
+
+    def set_cooke_user_id(self, user_id, expires_days=30):
+        """
+        :description: 设置user_id cookie
+        :param user_id: 用户标识
+        :param expires_days: 过期时间，单位天
+        :return:
+        :last_editors: HuangJianYi
+        """
+        user_id_md5 = CryptoHelper.md5_encrypt(str(user_id), share_config.get_value("cookie_encrypt_key", "r8C1JpyAXxrFV26V"))
+        self.set_cookie("user_id", str(user_id), expires_days=expires_days)
+        self.set_cookie("user_id_md5", user_id_md5, expires_days=expires_days)
+        self.set_cookie("user_token", UUIDHelper.get_uuid(), expires_days=expires_days)
+
+    def get_source_app_id(self):
+        """
+        :description: 废弃使用,获取source_app_id(客户端client使用)，旧项目有用到要换成get_app_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        #当有参数app_id时，优先取app_id，然后在是source_app_id
+        source_app_id = self.get_param("app_id")
+        if source_app_id:
+            return source_app_id
+        source_app_id = self.get_param("source_app_id")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            #淘宝小程序 在IDE上返回前端模板id，无论哪个环境；在千牛端上返回正确的小程序id
+            if source_app_id == share_config.get_value("client_template_id") or source_app_id == "":
+                test_config = share_config.get_value("test_config", {})
+                source_app_id = test_config.get("source_app_id", "")
+        if not source_app_id:
+            source_app_id = share_config.get_value("app_id")
+        return source_app_id
+
+    def get_app_id(self):
+        """
+        :description: 获取app_id
+        :return str
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_param("app_id")
+        if app_id:
+            return app_id
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            if self._request_source_type() == 2:
+                user_nick = self.get_user_nick()
+                if user_nick:
+                    store_user_nick = user_nick.split(':')[0]
+                    if store_user_nick:
+                        app_info_model = AppInfoModel(context=self)
+                        app_info_dict = app_info_model.get_cache_dict(where="store_user_nick=%s", limit="0,1", field="app_id", params=store_user_nick)
+                        if app_info_dict:
+                            app_id = app_info_dict["app_id"]
+            elif self._request_source_type() == 1:
+                app_id = self.get_param("source_app_id")
+                #淘宝小程序 在IDE上返回前端模板id，无论哪个环境
+                if app_id == share_config.get_value("client_template_id") or app_id == "":
+                    test_config = share_config.get_value("test_config", {})
+                    app_id = test_config.get("source_app_id", "")
+        if not app_id:
+            app_id = share_config.get_value("app_id")
+        return app_id
+
+    def get_access_token(self):
+        """
+        :description: 获取access_token
+        :return str
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_param("access_token")
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)  # 平台类型
+        if plat_type == PlatType.tb.value:
+            env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
+            test_config = share_config.get_value("test_config", {})
+            if self.get_param("source_app_id") == "":  #使用场景：通过IDE工具进行测试
+                access_token = test_config.get("access_token", "")
+            elif env and env != 'online':  #使用场景：通过千牛端在测试环境进行测试
+                user_nick = self.get_param("user_nick", '')
+                store_user_nick = user_nick.split(':')[0]
+                if store_user_nick and store_user_nick == test_config.get("user_nick", ""):
+                    access_token = test_config.get("access_token", "")
+
+        return access_token
+
+    def get_act_id(self):
+        """
+        :description: 获取act_id 如果是测试环境，则默认取最新的活动，用于前端测试使用;如果都没有取配置文件的值，配置文件没配置设置默认值1;
+        :return int
+        :last_editors: HuangJianYi
+        """
+        act_id = self.get_param_int("act_id", -1)
+        if act_id >= 0:
+            return act_id
+        app_id = self.get_app_id()
+        env = self.get_param("env") if self.get_param("env") else config.get_value("env", "")
+        if env and env != 'online' and app_id:
+            act_info_model = ActInfoModel(context=self)
+            condition_where = ConditionWhere()
+            condition_where.add_condition("app_id=%s and is_release=1")
+            params = [app_id]
+            act_type = self.get_param_int("act_type", 0)
+            if act_type > 0:
+                condition_where.add_condition("act_type=%s")
+                params.append(act_type)
+            act_info_dict = act_info_model.get_cache_dict(where=condition_where.to_string(), order_by="id desc", field="id", params=params)
+            if act_info_dict:
+                act_id = act_info_dict["id"]
+                return act_id
+        act_id = share_config.get_value("act_id", 1)
+        return act_id
+
+    def create_operation_log(self, operation_type=1, model_name="", handler_name="", old_detail=None, update_detail=None, operate_user_id="", operate_user_name="", operate_role_id="", title="", operation_desc=""):
+        """
+        :description: 创建操作日志
+        :param operation_type：操作类型（查看枚举类OperationType）
+        :param model_name：模块或表名称（跟配置表对应）
+        :param handler_name：handler名称
+        :param old_detail：变更前对象
+        :param update_detail：变更后对象
+        :param operate_user_id：操作人标识
+        :param operate_user_name：操作人名称
+        :param operate_role_id：操作人角色标识
+        :param title：标题(对象)
+        :param operation_desc：描述
+        :param operation_ways：操作方式(1单一操作2批量操作)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        plat_type = share_config.get_value("plat_type", PlatType.tb.value)
+        if plat_type == PlatType.tb.value:
+            if not operate_user_id:
+                operate_user_id = self.get_open_id()
+            if not operate_user_name:
+                operate_user_name = self.get_user_nick()
+        if not handler_name:
+            handler_name = self.__class__.__name__
+        operate_base_model = OperateBaseModel(context=self)
+        operate_base_model.add_operation_log(operation_type, title, operation_desc, model_name, handler_name, old_detail, update_detail, self.get_app_id(), self.get_act_id(), operate_user_id, operate_user_name, operate_role_id, {"request_params": self.request_params, "request": self.request}, self.get_remote_ip(), self.request_code)
+
+    def check_continue_request(self, handler_name, app_id, object_id, expire=100):
+        """
+        :description: 一个用户同一handler频繁请求校验，只对同用户同接口同请求参数进行限制
+        :param handler_name: handler名称
+        :param app_id: 应用标识
+        :param object_id: object_id(user_id或open_id)
+        :param expire: 间隔时间，单位毫秒
+        :return:满足频繁请求条件直接输出拦截
+        :last_editors: HuangJianYi
+        """
+        result = False, ""
+        if object_id and handler_name and app_id:
+            sign = CryptographyHelper.signature_md5(self.request_params)
+            if SevenHelper.is_continue_request(f"continue_request:{handler_name}_{app_id}_{object_id}_{sign}", expire) == True:
+                result = True, f"操作太频繁,请{expire}毫秒后再试"
+        return result
+
+    def business_process_executing(self):
+        """
+        :description: 执行前事件
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = {}
+        return invoke_result_data
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data: result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return result_data
+
+
+class ClientBaseHandler(FrameBaseHandler):
+    """
+    :description: 客户端handler基类
+    """
+
+    def prepare(self):
+        """
+        :Description: 置于任何请求方法前被调用(请勿重写此函数,可重写prepare_ext)
+        :last_editors: HuangJianYi
+        """
+        if self.__class__.__name__ == "IndexHandler":
+            return
+        try:
+            #获取并转换请求参数
+            invoke_result_data = self._convert_request_params()
+            if invoke_result_data.success == False:
+                self.request_code = UUIDHelper.get_uuid()
+                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+                self.finish()
+                return
+            # 标记日志请求关联
+            dict_param = self.get_http_log_extra_dict()
+            self._build_http_log(dict_param)
+            # 是否加密模式
+            is_api_encrypt = self.is_api_encrypt()
+            # 记录请求参数明文
+            if share_config.get_value("log_plain", True) == True and is_api_encrypt == True:
+                self.logging_link_info(f"plain_request_params:{self.json_dumps(self.request_params)}")
+            # 验证超时 10秒过期
+            if is_api_encrypt == True:
+                now_time = TimeHelper.get_now_timestamp(True)
+                if self.request_params.__contains__("timestamp") and (now_time - int(self.request_params["timestamp"]) > int(1000 * 10)):
+                    self.response_json_error("timestamp", "超时操作")
+                    self.finish()
+                    return
+            # 防攻击校验
+            invoke_result_data = RiskManageHelper.check_attack_request(context=self)
+            if invoke_result_data.success == False:
+                self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+                self.finish()
+                return
+            # 频繁请求校验
+            if dict_param["open_id"] and self._request_source_type() == 1:
+                is_continue_request, error_message = self.check_continue_request(self.__class__.__name__, dict_param["app_id"], dict_param["open_id"])
+                if is_continue_request:
+                    self.response_json_error("error", error_message)
+                    self.finish()
+                    return
+                #每分钟流量UV计数,用于登录接口限制登录
+                RiskManageHelper.add_current_limit_count(str(dict_param["app_id"]), str(dict_param["open_id"]))
+            # 获取设备信息
+            self.device_info_dict = self.get_device_info_dict()
+
+        except Exception as ex:
+            if not hasattr(self, "request_code"):
+                self.request_code = UUIDHelper.get_uuid()
+            self.logging_link_error("【客户端handler基类】" + traceback.format_exc())
+
+    def get_device_info_dict(self):
+        """
+        :description: 获取头部参数字典
+        :last_editors: HuangJianYi
+        """
+        device_info_dict = {}
+        clientheaderinfo_string = self.request.headers._dict.get("Clientheaderinfo")
+        if clientheaderinfo_string:
+            info_model = parse_qs(clientheaderinfo_string)
+            device_info_dict["pid"] = (info_model["pid"][0])  # 产品标识
+            device_info_dict["chid"] = 0 if "chid" not in info_model.keys() else int(info_model["chid"][0])  # 渠道标识
+            device_info_dict["height"] = 0 if "height" not in info_model.keys() else int(float(info_model["height"][0]))  # 高度
+            device_info_dict["width"] = 0 if "width" not in info_model.keys() else int(float(info_model["width"][0]))  # 宽度
+            device_info_dict["version"] = "" if "version" not in info_model.keys() else info_model["version"][0]  # 客户端版本号
+            device_info_dict["app_version"] = "" if "app_version" not in info_model.keys() else info_model["app_version"][0]  # 小程序版本号
+            device_info_dict["net"] = "" if "net" not in info_model.keys() else info_model["net"][0]  # 网络
+            device_info_dict["model_p"] = "" if "model" not in info_model.keys() else info_model["model"][0]  # 机型
+            device_info_dict["lang"] = "" if "lang" not in info_model.keys() else info_model["lang"][0]  #语言
+            device_info_dict["ver_no"] = "" if "ver_no" not in info_model.keys() else info_model["ver_no"][0]  #接口版本号
+            device_info_dict["timestamp"] = 0 if "timestamp" not in info_model.keys() else int(info_model["timestamp"][0])  # 时间搓毫秒
+            device_info_dict["signature_md5"] = "" if "signature_md5" not in info_model.keys() else info_model["signature_md5"][0]  # 签名md5
+        return device_info_dict
+
+    def emoji_base64_to_emoji(self, text_str):
+        """
+        :description: 把加密后的表情还原
+        :param text_str: 加密后的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
+        return CryptographyHelper.emoji_base64_to_emoji(text_str)
+
+    def emoji_to_emoji_base64(self, text_str):
+        """
+        :description: emoji表情转为[em_xxx]形式存于数据库,打包每一个emoji
+        :description: 性能遇到问题时重新设计转换程序
+        :param text_str: 未加密的字符串
+        :return: 解密后的表情字符串
+        :last_editors: HuangJianYi 
+        """
+        return CryptographyHelper.emoji_to_emoji_base64(text_str)
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/app_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/stat.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,151 +1,118 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 10:43:58
-@LastEditTime: 2021-09-17 17:23:16
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-
-
-class InstantiateAppHandler(ClientBaseHandler):
-    """
-    :description: 实例化小程序
-    """
-    def get_async(self):
-        """
-        :description: 实例化小程序
-        :param app_id:应用标识
-        :param user_nick:用户昵称
-        :param access_token:access_token
-        :param is_log：是否记录返回信息
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        user_nick = self.get_user_nick()
-        access_token = self.get_param("access_token")
-        is_log = bool(self.get_param("is_log",False))
-
-        cache_key = f"instantiate:{user_nick}"
-        if SevenHelper.is_continue_request(cache_key, 10000) == True:
-            return self.response_json_error("error","操作太频繁,请10秒后再试")
-        app_key, app_secret = self.get_app_key_secret()
-        top_base_model = TopBaseModel(context=self)
-        invoke_result_data = top_base_model.instantiate(app_id, user_nick, access_token, app_key, app_secret, is_log)
-        SevenHelper.redis_init().delete(cache_key)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message,invoke_result_data.data)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class UpdateTelephoneHandler(ClientBaseHandler):
-    """
-    :description: 更新手机号
-    """
-    @filter_check_params("telephone")
-    def get_async(self):
-        """
-        :description: 更新手机号
-        :param app_id:应用标识
-        :param telephone：手机号
-        :param check_code：验证码
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_open_id()
-        app_id = self.get_app_id()
-        telephone = self.get_param("telephone")
-        check_code = self.get_param("check_code")
-        modify_date = self.get_now_datetime()
-
-        check_code_re = SevenHelper.redis_init().get("user_" + open_id + "_bind_phone_code")
-        if check_code_re == None:
-            return self.response_json_error("error", "验证码已过期")
-        check_code_re = str(check_code_re, 'utf-8')
-        if check_code != check_code_re:
-            return self.response_json_error("error", "验证码错误")
-        AppInfoModel(context=self).update_table("app_telephone=%s,modify_date=%s", "app_id=%s", [telephone, modify_date, app_id])
-        return self.response_json_success()
-
-
-class VersionUpgradeHandler(ClientBaseHandler):
-    """
-    :description: 前端版本更新
-    """
-    def get_async(self):
-        """
-        :description: 前端版本更新
-        :param app_id:应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        access_token = self.get_param("access_token")
-        user_nick = self.get_user_nick()
-        is_log = bool(self.get_param("is_log", False))
-
-        base_info = BaseInfoModel(context=self).get_entity()
-        client_ver = base_info.client_ver
-
-        #中台指定账号升级
-        version_info = VersionInfoModel(context=self).get_entity(where="type_id=1",order_by="id desc")
-        if version_info:
-            if version_info.update_scope == 2 and version_info.white_lists:
-                white_lists = list(set(str(version_info.white_lists).split(',')))
-                if user_nick in white_lists:
-                    client_ver = version_info.version_number
-
-        app_info = AppInfoModel(context=self).get_entity("app_id=%s", params=app_id)
-        if not app_info:
-            return self.response_json_error("no_app", "小程序不存在")
-
-        test_client_ver = config.get_value("test_client_ver")
-        client_template_id = config.get_value("client_template_id")
-        #配置文件指定账号升级
-        if test_client_ver and user_nick == config.get_value("test_user_nick"):
-            client_ver = test_client_ver
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.version_upgrade(app_id, client_template_id, client_ver, access_token,app_key, app_secret, app_info, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class AppInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取小程序信息
-    """
-    @filter_check_params()
-    def get_async(self):
-        """
-        :description: 获取小程序信息
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        app_base_model = AppBaseModel(context=self)
-        invoke_result_data = app_base_model.get_app_info_result(self.get_user_nick(), self.get_open_id(), self.get_param("access_token"))
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GetAppIDHandler(ClientBaseHandler):
-    """
-    :description: 获取应用标识
-    """
-    @filter_check_params("store_name")
-    def get_async(self):
-        """
-        :description: 获取应用标识
-        :param store_name:店铺名称
-        :return app_id
-        :last_editors: HuangJianYi
-        """
-        store_name = self.get_param("store_name")
-        app_base_model = AppBaseModel(context=self)
-        return self.response_json_success(app_base_model.get_app_id(store_name))
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-10 11:29:31
+@LastEditTime: 2023-04-11 15:19:25
+@LastEditors: HuangJianYi
+@Description: 处理数据统计上报
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.stat_base_model import *
+
+
+
+class StatReportHandler(ClientBaseHandler):
+    """
+    :description: 统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def post_async(self):
+        """
+        :description: 统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param object_id:对象标识
+        :param user_code:用户标识
+        :param open_id:open_id
+        :param data:统计数据json 格式：[{"key":"key1","value":1},{"key":"key2","value":1},{"key":"key3","value":1}] 或 {"key1":1,"key2":1,"key3":1}
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        module_id = self.get_param_int("module_id", 0)
+        object_id = self.get_param("object_id")
+        stat_data = self.get_param("data",[])
+        if stat_data:
+            stat_data = self.json_loads(stat_data)
+        stat_base_model = StatBaseModel(context=self)
+        stat_base_model.add_stat_list(app_id, act_id, module_id, user_id, open_id, stat_data, object_id=object_id)
+        return self.response_json_success()
+
+
+class ShareReportHandler(ClientBaseHandler):
+    """
+    :description: 处理分享统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理分享统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param login_token:访问令牌
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        module_id = self.get_param_int("module_id", 0)
+        stat_base_model = StatBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        invoke_result_data = stat_base_model.process_share_report(app_id, act_id, module_id, user_id, open_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class InviteReportHandler(ClientBaseHandler):
+    """
+    :description: 处理邀请进入统计上报
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 处理邀请进入统计上报
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_code:用户标识
+        :param invite_user_id:邀请人用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        from_user_id = int(self.get_param("invite_user_id", 0))
+        open_id = self.get_param("open_id")
+        module_id = int(self.get_param("module_id", 0))
+        stat_base_model = StatBaseModel(context=self)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        invoke_result_data = stat_base_model.process_invite_report(app_id, act_id, module_id, user_id, open_id, from_user_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/goods_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/goods_s.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,199 +1,218 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2021-08-03 10:11:39
-@LastEditTime: 2021-09-17 15:11:53
-@LastEditors: HuangJianYi
-:description: 商品相关
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.goods_base_model import *
-
-
-class GoodsListHandler(ClientBaseHandler):
-    """
-    :description: 商品列表（获取当前会话用户出售中的商品列表）
-    """
-    def get_async(self):
-        """
-        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        goods_name = self.get_param("goods_name")
-        order_tag = self.get_param("order_tag", "list_time")
-        order_by = self.get_param("order_by", "desc")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = self.get_param("page_size", 20)
-        is_log = bool(self.get_param("is_log",False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GoodsListByGoodsIDHandler(ClientBaseHandler):
-    """
-    :description: 根据商品ID串获取商品列表
-    """
-    @filter_check_params("goods_ids")
-    def get_async(self):
-        """
-        :description: 根据商品ID获取商品列表
-        :param goods_ids：商品ID串，多个逗号,分隔
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        goods_ids = self.get_param("goods_ids")
-        is_log = bool(self.get_param("is_log",False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key,app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class GoodsInfoHandler(ClientBaseHandler):
-    """
-    :description: 获取商品信息
-    """
-    @filter_check_params("goods_id")
-    def get_async(self):
-        """
-        :description: 获取商品信息
-        :param goods_id：商品ID
-        :return: 商品信息
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        goods_id = self.get_param("goods_id")
-        is_log = bool(self.get_param("is_log",False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.get_goods_info(goods_id, access_token, app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class BenefitDetailHandler(ClientBaseHandler):
-    """
-    :description: 获取优惠券详情信息
-    """
-    def get_async(self):
-        """
-        :description: 获取优惠券详情信息
-        :param right_ename:奖池ID
-        :return: dict
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        right_ename = self.get_param("right_ename")
-        is_log = bool(self.get_param("is_log",False))
-
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = top_base_model.alibaba_benefit_query(right_ename, access_token,app_key, app_secret, is_log=is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class InventoryGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
-    """
-    def get_async(self):
-        """
-        :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
-        :param goods_name：商品名称
-        :param order_tag：order_tag
-        :param order_by：排序类型
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        access_token = self.get_param("access_token")
-        goods_name = self.get_param("goods_name")
-        order_tag = self.get_param("order_tag", "list_time")
-        order_by = self.get_param("order_by", "desc")
-        page_index = int(self.get_param("page_index", 0))
-        page_size = self.get_param("page_size", 20)
-        top_base_model = TopBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = self.response_json_success(top_base_model.get_goods_inventory_list(page_index, page_size, goods_name, order_tag, order_by, access_token,app_key, app_secret))
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class SpecialGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 专属下单商品列表
-    """
-    @filter_check_params("app_id")
-    def get_async(self):
-        """
-        :description: 专属下单商品列表
-        :param app_id：应用标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param goods_name：商品名称
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        goods_name = self.get_param("goods_name")
-        is_log = self.get_param("is_log",False)
-        access_token = self.get_param("access_token")
-
-        goods_base_model = GoodsBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = goods_base_model.get_special_goods_list(app_id, goods_name, access_token, app_key, app_secret, is_log, page_index, page_size)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class BindSpecialGoodsHandler(ClientBaseHandler):
-    """
-    :description: 专属下单商品绑定(单个商品)
-    """
-    @filter_check_params("goods_id")
-    def get_async(self):
-        """
-        :description: 专属下单商品绑定(单个商品)
-        :param goods_id：商品ID
-        :param goods_name: 商品名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        access_token = self.get_param("access_token")
-        goods_id = self.get_param("goods_id")
-        goods_name = self.get_param("goods_name")
-        is_log = self.get_param("is_log",False)
-
-        goods_base_model = GoodsBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = goods_base_model.bind_special_goods(app_id, goods_id, goods_name, access_token, app_key, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2021-08-03 10:11:39
+@LastEditTime: 2023-05-12 10:40:23
+@LastEditors: HuangJianYi
+:description: 商品模块
+"""
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.goods_base_model import *
+
+
+class GoodsListHandler(ClientBaseHandler):
+    """
+    :description: 商品列表（获取当前会话用户出售中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前会话用户出售中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GoodsListByGoodsIDHandler(ClientBaseHandler):
+    """
+    :description: 根据商品ID串获取商品列表
+    """
+    @filter_check_params("goods_ids")
+    def get_async(self):
+        """
+        :description: 根据商品ID获取商品列表
+        :param goods_ids：商品ID串，多个逗号,分隔
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_ids = self.get_param("goods_ids")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key,app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class GoodsInfoHandler(ClientBaseHandler):
+    """
+    :description: 获取商品信息
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 获取商品信息
+        :param goods_id：商品ID
+        :return: 商品信息
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_id = self.get_param("goods_id")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_info(goods_id, access_token, app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class BenefitDetailHandler(ClientBaseHandler):
+    """
+    :description: 获取优惠券详情信息
+    """
+    def get_async(self):
+        """
+        :description: 获取优惠券详情信息
+        :param right_ename:奖池ID
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        right_ename = self.get_param("right_ename")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.alibaba_benefit_query(right_ename, access_token,app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class InventoryGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
+    """
+    def get_async(self):
+        """
+        :description: 导入商品列表（获取当前用户作为卖家的仓库中的商品列表）
+        :param goods_name：商品名称
+        :param order_tag：order_tag
+        :param order_by：排序类型
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        access_token = self.get_access_token()
+        goods_name = self.get_param("goods_name")
+        order_tag = self.get_param("order_tag", "list_time")
+        order_by = self.get_param("order_by", "desc")
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_goods_inventory_list(page_index, page_size, goods_name, order_tag, order_by, access_token, app_key, app_secret)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class SpecialGoodsListHandler(ClientBaseHandler):
+    """
+    :description: 专属下单商品列表
+    """
+    @filter_check_params("app_id")
+    def get_async(self):
+        """
+        :description: 专属下单商品列表
+        :param app_id：应用标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param goods_name：商品名称
+        :param goods_id：商品ID
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        goods_name = self.get_param("goods_name")
+        goods_id = self.get_param("goods_id")
+        access_token = self.get_access_token()
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        is_top_data = invoke_result_data.data["is_top_data"] if invoke_result_data.data.__contains__("is_top_data") else False #是否直接取淘宝top数据
+        goods_base_model = GoodsBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        if is_top_data == False:
+            invoke_result_data = goods_base_model.get_special_goods_list(app_id, goods_name, access_token, app_key, app_secret, is_log, page_index, page_size)
+        else:
+            invoke_result_data = goods_base_model.get_special_goods_list_for_tb(app_id, goods_id, access_token, app_key, app_secret, is_log, page_index, page_size)
+
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params))
+
+
+class BindSpecialGoodsHandler(ClientBaseHandler):
+    """
+    :description: 专属下单商品绑定(单个商品)
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 专属下单商品绑定(单个商品)
+        :param goods_id：商品ID
+        :param goods_name: 商品名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        access_token = self.get_access_token()
+        goods_id = self.get_param("goods_id")
+        goods_name = self.get_param("goods_name")
+        is_log = self.get_param_int("is_log", 0)
+        is_log = True if is_log == 1 else False
+
+        goods_base_model = GoodsBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = goods_base_model.bind_special_goods(app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/launch_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/app.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,169 +1,157 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-30 15:46:34
-@LastEditTime: 2021-10-13 09:36:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.launch_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.launch.launch_goods_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class InitLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 初始化商品投放
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 初始化商品投放
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param source_types：商品来源，指定哪些位置的商品要进行投放（1活动奖品商品2价格档位商品） 多个逗号,分隔
-        :return
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", 0))
-        source_types = self.get_param("source_types","1,2")
-
-        online_url = self.get_online_url(act_id, app_id, module_id)
-        launch_base_model = LaunchBaseModel(context=self)
-        invoke_result_data = launch_base_model.init_launch_goods(app_id, act_id, source_types, online_url)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class ResetLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-
-        ActInfoModel(context=self).update_table("is_launch=0", "app_id=%s and id=%s", params=[app_id, act_id])
-        ActBaseModel(context=self)._delete_act_info_dependency_key(app_id, act_id)
-        LaunchGoodsModel(context=self).del_entity("app_id=%s and id=%s", params=[app_id, act_id])
-        return self.response_json_success()
-
-
-class InitLaunchGoodsCallBackHandler(ClientBaseHandler):
-    """
-    :description: 初始化投放商品回调接口
-    """
-    def get_async(self):
-        """
-        :description: 初始化投放商品回调接口
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param close_goods_id：投放失败时关闭投放的商品ID  多个逗号,分隔
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        close_goods_id = self.get_param("close_goods_id")
-
-        ActInfoModel(context=self).update_table("is_launch=1", "id=%s", params=act_id)
-        ActBaseModel(context=self)._delete_act_info_dependency_key(app_id,act_id)
-        if close_goods_id != "":
-            close_goods_id_list = list(set(close_goods_id.split(",")))
-            LaunchGoodsModel(context=self).update_table("is_launch=0,launch_date=%s", "act_id=%s and "+ SevenHelper.get_condition_by_str_list("goods_id",close_goods_id_list), params=[SevenHelper.get_now_datetime(),act_id])
-
-        return self.response_json_success()
-
-
-class UpdateLaunchGoodsStatusHandler(ClientBaseHandler):
-    """
-    :description: 更改投放商品的状态
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 保存更改投放商品的状态
-        :param app_id：应用标识
-        :param 活动标识
-        :param update_goods_id：更新商品ID（例：1）
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        goods_id = self.get_param("update_goods_id")
-        if goods_id != "":
-            LaunchGoodsModel(context=self).update_table("is_launch=abs(is_launch-1),is_sync=0,launch_date=%s", "app_id=%s and act_id=%s and goods_id=%s", [self.get_now_datetime(), app_id, act_id, goods_id])
-
-        return self.response_json_success()
-
-
-class LaunchGoodsListHandler(ClientBaseHandler):
-    """
-    :description: 投放商品列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 投放商品列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :return 列表
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        launch_base_model = LaunchBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = launch_base_model.get_launch_goods_list(app_id, act_id, page_size, page_index, self.get_param("access_token"), app_key, app_secret)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success(invoke_result_data.data)
-
-
-class AsyncLaunchGoodsHandler(ClientBaseHandler):
-    """
-    :description: 同步投放商品（小程序投放-商品绑定/解绑）
-    """
-    @filter_check_params("app_id,act_id")
-    def get_async(self):
-        """
-        :description: 同步投放商品（小程序投放-商品绑定/解绑）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :return 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", 0))
-
-        online_url = self.get_online_url(act_id, app_id, module_id)
-        launch_base_model = LaunchBaseModel(context=self)
-        app_key, app_secret = self.get_app_key_secret()
-        invoke_result_data = launch_base_model.async_launch_goods(app_id, act_id, online_url, self.get_param("access_token"), app_key, app_secret)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 13:51:10
+@LastEditTime: 2023-06-14 19:11:23
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from asq.initiators import query
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.mp_base_model import *
+from seven_cloudapp_frame.models.push_base_model import *
+from seven_cloudapp_frame.libs.customize.baidubce_helper import *
+
+
+class AppExpireHandler(ClientBaseHandler):
+    """
+    :description: 获取小程序是否过期未续费
+    """
+    def get_async(self):
+        """
+        :description: 获取小程序是否过期未续费
+        :return info
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+
+        app_base_model = AppBaseModel(context=self)
+        invoke_result_data = app_base_model.get_app_expire(app_id)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+
+        return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class CreateWeChatQrCodeHandler(ClientBaseHandler):
+    """
+    :description: 创建微信小程序码
+    """
+    def get_async(self):
+        """
+        :description: 创建微信小程序码
+        :param page：跳转地址
+        :param scene：参数，不限制小程序码才支持
+        :param env_version：要打开的小程序版本。正式版为 "release"，体验版为 "trial"，开发版为 "develop"。默认是正式版。不限制小程序码才支持
+        :param width：宽度
+        :param no_limit_code：是否不限制小程序码（1-是0否）
+        :return: 二进制流
+        :last_editors: HuangJianYi
+        """
+        page = self.get_param("page", "pages/index/index")
+        scene = self.get_param("scene", "a=1")
+        width = self.get_param_int("width", 430)
+        env_version = self.get_param("env_version", "release")
+        no_limit_code = self.get_param_int("no_limit_code", 1)
+        if no_limit_code == 1:
+            invoke_result_data = WeChatHelper.create_qr_code_unlimit(page=page, scene=scene, width=width, env_version=env_version)
+        else:
+            invoke_result_data = WeChatHelper.create_qr_code(path=page, width=width)
+        self.set_header("Content-type", "image/png")
+        if invoke_result_data.success == True:
+            self.write(invoke_result_data.data)
+        else:
+            self.write("")
+
+
+class UploadFileHandler(ClientBaseHandler):
+    """
+    :description: 上传文件
+    """
+    def get_async(self):
+        """
+        :description: 上传文件
+        :last_editors: HuangJianYi
+        """
+        is_auto_name = self.get_param_int("is_auto_name")
+        is_auto_name = True if is_auto_name == 1 else False
+        # 上传图片到资源服务器
+        if not self.request.files:
+            return self.response_json_error("error", "未获取到文件")
+        # 上传图片到资源服务器
+        files_data = self.request.files
+        if not files_data or not files_data["image"] or not files_data["image"][0] or not files_data["image"][0]['body']:
+            return self.response_json_error("error", "未获取到文件")
+        file_name = files_data["image"][0]['filename']
+        file_path = BaidubceHelper.upload(file_name=file_name, is_auto_name=is_auto_name, data=files_data["image"][0]['body'])
+        if not file_path:
+            return self.response_json_error("error", "上传文件出错")
+        return self.response_json_success(file_path)
+
+
+class AddWechatSubscribeHandler(ClientBaseHandler):
+    """
+    :description: 添加微信订阅次数
+    """
+    def get_async(self):
+        """
+        :description: 添加微信订阅次数
+        :param template_id：template_id
+        :param open_id：open_id
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        template_id = self.get_param("template_id")
+        open_id = self.get_param("open_id")
+        push_base_model = PushBaseModel(context=self)
+        invoke_result_data = push_base_model.add_wechat_subscribe(share_config.get_value("app_id"), template_id, open_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class GetHighPowerListHandler(ClientBaseHandler):
+    """
+    :description: 获取中台配置的高级权限列表
+    """
+    def get_async(self):
+        """
+        :description: 获取中台配置的高级权限列表
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            return self.response_json_error("Error", "小程序不存在")
+        store_user_nick = app_info_dict["store_user_nick"]
+        access_token = app_info_dict["access_token"]
+        config_data = {}
+        config_data["is_customized"] = 0
+        top_base_model = TopBaseModel(context=self)
+        mp_base_model = MPBaseModel(context=self)
+        invoke_result_data = mp_base_model.get_custom_function_list(store_user_nick)
+        if invoke_result_data.success == True:
+            custom_function_list = invoke_result_data.data if invoke_result_data.data else []
+        else:
+            custom_function_list = mp_base_model.get_api_custom_function_list(store_user_nick)
+        if len(custom_function_list) == 0:
+            app_key, app_secret = self.get_app_key_secret()
+            #获取项目编码
+            project_code = top_base_model.get_project_code(store_user_nick, access_token, app_key, app_secret)
+            invoke_result_data = mp_base_model.get_public_function_list(project_code)
+            if invoke_result_data.success == True:
+                public_function_list = invoke_result_data.data if invoke_result_data.data else []
+            else:
+                public_function_list = mp_base_model.get_api_public_function_list(project_code)
+            if len(public_function_list) > 0:
+                config_data["function_config_list"] = query(public_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+        else:
+            config_data["is_customized"] = 1
+            config_data["function_config_list"] = []
+            custom_function_list = list(filter(lambda custom_function: custom_function["app_id"] == app_id, custom_function_list))
+            if len(custom_function_list) > 0:
+                config_data["function_config_list"] = query(custom_function_list[0]["function_info_second_list"]).select(lambda x: {"name": x["name"], "key_name": x["key_name"]}).to_list()
+        self.response_json_success(self.business_process_executed(config_data, ref_params={}))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/module_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/ip_base_model.py`

 * *Files 25% similar despite different names*

```diff
@@ -1,355 +1,312 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:42:53
-@LastEditTime: 2021-10-13 09:42:03
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.module_base_model import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-
-
-class SaveActModuleHandler(ClientBaseHandler):
-    """
-    :description: 保存活动模块信息
-    """
-    @filter_check_params("act_id")
-    def post_async(self):
-        """
-        :description: 添加活动信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param module_name: 模块名称
-        :param module_sub_name: 模块短名称
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param module_pic: 模块图片
-        :param module_desc: 描述信息
-        :param price: 价格
-        :param price_gear_id: 档位标识
-        :param ip_id: IP标识
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id",0))
-        module_id = int(self.get_param("module_id",0))
-        module_name = self.get_param("module_name")
-        module_sub_name = self.get_param("module_sub_name")
-        start_date = self.get_param("start_date", "1900-01-01 00:00:00")
-        end_date = self.get_param("end_date", "1900-01-01 00:00:00")
-        module_pic = self.get_param("module_pic")
-        module_desc = self.get_param("module_desc")
-        price = self.get_param("price")
-        price_gear_id = int(self.get_param("price_gear_id",0))
-        ip_id = int(self.get_param("ip_id", 0))
-        join_ways = int(self.get_param("join_ways",0))
-        is_fictitious = int(self.get_param("is_fictitious",0))
-        sort_index = int(self.get_param("sort_index",0))
-        is_release = int(self.get_param("is_release",0))
-        i1 = int(self.get_param("i1",0))
-        i2 = int(self.get_param("i2",0))
-        i3 = int(self.get_param("i3",0))
-        i4 = int(self.get_param("i4",0))
-        i5 = int(self.get_param("i5",0))
-        s1 = self.get_param("s1")
-        s2 = self.get_param("s2")
-        s3 = self.get_param("s3")
-        s4 = self.get_param("s4")
-        s5 = self.get_param("s5")
-        d1 = self.get_param("d1", "1900-01-01 00:00:00")
-        d2 = self.get_param("d2", "1900-01-01 00:00:00")
-        invoke_result_data = self.business_process_executing(app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.save_act_module(app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(OperationType.add.value, invoke_result_data.data["new"].__str__(), "SaveActModuleHandler", None, self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-        else:
-            self.create_operation_log(OperationType.update.value, invoke_result_data.data["new"].__str__(), "SaveActModuleHandler", self.json_dumps(invoke_result_data.data["old"]), self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-        self.response_json_success(invoke_result_data.data["new"].id)
-
-    def business_process_executing(self, app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2):
-        """
-        :description: 执行前事件
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param module_name: 模块名称
-        :param module_sub_name: 模块短名称
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param module_pic: 模块图片
-        :param module_desc: 描述信息
-        :param price: 价格
-        :param price_gear_id: 档位标识
-        :param ip_id: IP标识
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        return invoke_result_data
-
-
-class ActModuleHandler(ClientBaseHandler):
-    """
-    :description: 单条活动模块信息
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 活动模块列表
-        :param app_id：应用标识
-        :param module_id：活动模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        module_base_model = ModuleBaseModel(context=self)
-        act_module_dict = module_base_model.get_act_module_dict(module_id, False)
-        if act_module_dict:
-            if act_module_dict["app_id"] != app_id:
-                act_module_dict = {}
-                return self.response_json_success(act_module_dict)
-        return self.response_json_success(act_module_dict)
-
-
-class ActModuleListHandler(ClientBaseHandler):
-    """
-    :description: 活动模块列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 活动模块列表
-        :param app_id：应用标识
-        :param act_name：模块名称
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 10))
-        is_del = int(self.get_param("is_del", -1))
-        module_name = self.get_param("module_name")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-
-        condition = ""
-        params = []
-        order_by = "create_date desc"
-        invoke_result_data = self.business_process_executing(self.request_params)
-        if invoke_result_data.success == True:
-            condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-            params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-            order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        module_base_model = ModuleBaseModel(context=self)
-        page_list, total = module_base_model.get_act_module_list(app_id, act_id, module_name, start_date, end_date, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params,is_cache=False)
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list))
-        return self.response_json_success(page_info)
-
-    def business_process_executing(self, request_params):
-        """
-        :description: 执行前事件
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, page_list):
-        """
-        :description: 执行后事件
-        :param page_list:page_list
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return page_list
-
-
-class DeleteActModuleHandler(ClientBaseHandler):
-    """
-    :description: 删除活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 删除活动模块
-        :param app_id：应用标识
-        :param module_id：模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        invoke_result_data = self.business_process_executing(app_id, module_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 1)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.delete.value, "act_module_tb", "DeleteActModuleHandler", None, module_id)
-        return self.response_json_success()
-
-    def business_process_executing(self, app_id, module_id):
-        """
-        :description: 执行前事件
-        :param app_id: 应用标识
-        :param module_id: 活动模块标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        return invoke_result_data
-
-
-class ReviewActModuleHandler(ClientBaseHandler):
-    """
-    :description: 还原活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 还原活动模块
-        :param app_id：应用标识
-        :param module_id：模块标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        invoke_result_data = self.business_process_executing(app_id, module_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 0)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.review.value, "act_module_tb", "ReviewActModuleHandler", None, module_id)
-        return self.response_json_success()
-
-    def business_process_executing(self, app_id, module_id):
-        """
-        :description: 执行前事件
-        :param app_id: 应用标识
-        :param module_id: 活动模块标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        return invoke_result_data
-
-
-class ReleaseActModuleHandler(ClientBaseHandler):
-    """
-    :description: 上下架活动模块
-    """
-    @filter_check_params("module_id")
-    def get_async(self):
-        """
-        :description: 上下架活动模块
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        module_id = int(self.get_param("module_id", 0))
-        is_release = int(self.get_param("is_release", 0))
-        invoke_result_data = self.business_process_executing(app_id, module_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.release_act_module(app_id, module_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-    def business_process_executing(self, app_id, module_id, is_release):
-        """
-        :description: 执行前事件
-        :param app_id: 应用标识
-        :param module_id: 活动模块标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        return invoke_result_data
-
-
-class UpdateActModulePriceHandler(ClientBaseHandler):
-    """
-    :description: 更新活动模块价格
-    """
-    @filter_check_params("act_id,prize_gear_id")
-    def get_async(self):
-        """
-        :description:更新活动模块价格
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_gear_id：档位标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        prize_gear_id = int(self.get_param("prize_gear_id", 0))
-
-        module_base_model = ModuleBaseModel(context=self)
-        invoke_result_data = module_base_model.update_act_module_price(app_id, act_id, prize_gear_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 09:44:36
+@LastEditTime: 2023-05-09 09:08:21
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.ip.ip_info_model import *
+from seven_cloudapp_frame.models.db_models.ip.ip_type_model import *
+
+class IpBaseModel():
+    """
+    :description: IP信息业务模型
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_ip_info_dependency_key(self, act_id, ip_id=0, delay_delete_time=0.01):
+        """
+        :description: 删除ip信息依赖建
+        :param act_id: 活动标识
+        :param ip_id: ip标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = [DependencyKey.ip_info_list(act_id)]
+        if ip_id:
+            dependency_key_list.append(DependencyKey.ip_info(ip_id))
+        IpInfoModel().delete_dependency_key(dependency_key_list, delay_delete_time)
+        
+    def _delete_ip_type_dependency_key(self, act_id, type_id=0, delay_delete_time=0.01):
+        """
+        :description: 删除ip类型依赖建
+        :param act_id: 活动标识
+        :param type_id: ip类型标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = [DependencyKey.ip_type(type_id)]
+        if type_id:
+            dependency_key_list.append(DependencyKey.ip_type_list(act_id))
+        IpTypeModel().delete_dependency_key(dependency_key_list, delay_delete_time)
+
+    def save_ip_info(self, app_id,act_id,ip_id,ip_name,ip_pic,show_pic,sort_index,is_release,ip_type,ip_summary,mode_type=0,ip_config_json=None):
+        """
+        :description: 保存ip信息
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param ip_id: ip标识
+        :param ip_name：ip名称
+        :param ip_pic：ip图片
+        :param show_pic：展示图片
+        :param sort_index：排序
+        :param is_release：是否发布
+        :param ip_type：ip类型
+        :param ip_summary：ip描述
+        :param mode_type：模式类型
+        :param ip_config_json：ip配置
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id or not ip_name:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        ip_info = None
+        old_ip_info = None
+        is_add = False
+        ip_info_model = IpInfoModel(context=self.context)
+        if ip_id > 0:
+            ip_info = ip_info_model.get_entity_by_id(ip_id)
+            if not ip_info or ip_info.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "ip信息不存在"
+                return invoke_result_data
+            old_ip_info = deepcopy(ip_info)
+        if not ip_info:
+            is_add = True
+            ip_info = IpInfo()
+        ip_info.app_id = app_id
+        ip_info.act_id = act_id
+        ip_info.ip_name = ip_name
+        ip_info.ip_type = ip_type
+        ip_info.ip_pic = ip_pic
+        ip_info.show_pic = show_pic
+        ip_info.ip_summary = ip_summary
+        ip_info.sort_index = sort_index
+        ip_info.is_release = is_release
+        ip_info.mode_type = mode_type
+        if ip_config_json != None:
+            ip_info.ip_config_json = ip_config_json
+        ip_info.modify_date = SevenHelper.get_now_datetime()
+        if is_add:
+            ip_info.create_date = ip_info.modify_date
+            ip_info.id = ip_info_model.add_entity(ip_info)
+        else:
+            ip_info_model.update_entity(ip_info,exclude_field_list="app_id,act_id")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = ip_info
+        result["old"] = old_ip_info
+        invoke_result_data.data = result
+        self._delete_ip_info_dependency_key(act_id,ip_info.id)
+        return invoke_result_data
+
+    def get_ip_info_list(self, app_id, act_id, page_size, page_index, is_del=0,is_release=-1, field="*", condition="", params=[], order_by="sort_index desc", is_cache=True, page_count_mode="total", dependency_key=""):
+        """
+        :description: 获取IP列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_size：页大小
+        :param page_index：页索引
+        :param is_del: 是否回收站1是0否
+        :param is_release: 是否发布1是0否
+        :param field：字段
+        :param condition：条件
+        :param params：参数数组
+        :param order_by：排序
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param dependency_key：依赖建
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        params_list = [app_id, act_id]
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s and act_id=%s")
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+        if is_del != -1:
+            condition_where.add_condition("is_del=%s")
+            params_list.append(is_del)
+        if is_release != -1:
+            condition_where.add_condition("is_release=%s")
+            params_list.append(is_release)
+        if is_cache == True:
+            if not dependency_key:
+                dependency_key = DependencyKey.ip_info_list(act_id)
+            page_list = IpInfoModel(context=self.context).get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, dependency_key=dependency_key, cache_expire=600, page_count_mode=page_count_mode)
+        else:
+            page_list = IpInfoModel(context=self.context).get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, page_count_mode=page_count_mode)
+        return page_list
+
+    def update_ip_info_status(self,app_id,ip_id,is_del):
+        """
+        :description: 删除ip
+        :param app_id：应用标识
+        :param ip_id：ip标识
+        :param is_del：0-还原，1-删除
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        ip_info_model = IpInfoModel(context=self.context)
+        ip_info_dict = ip_info_model.get_dict_by_id(ip_id)
+        if not ip_info_dict or ip_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "ip信息不存在"
+            return invoke_result_data
+        is_release = 0
+        del_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = ip_info_model.update_table("is_del=%s,is_release=%s,modify_date=%s,del_date=%s", "id=%s", [is_del, is_release, del_date, del_date, ip_id])
+        self._delete_ip_info_dependency_key(ip_info_dict["act_id"],ip_id)
+        invoke_result_data.data = ip_info_dict
+        return invoke_result_data
+
+    def release_ip_info(self,app_id,ip_id,is_release):
+        """
+        :description: ip上下架
+        :param app_id：应用标识
+        :param ip_id：ip标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        ip_info_model = IpInfoModel(context=self.context)
+        ip_info_dict = ip_info_model.get_dict_by_id(ip_id)
+        if not ip_info_dict or ip_info_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "ip信息不存在"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = ip_info_model.update_table("is_release=%s,modify_date=%s", "id=%s", [is_release, modify_date, ip_id])
+        self._delete_ip_info_dependency_key(ip_info_dict["act_id"],ip_id)
+        invoke_result_data.data = ip_info_dict
+        return invoke_result_data
+
+    def save_ip_type(self,app_id,act_id,ip_type_id,type_name,sort_index,is_release,type_pic=""):
+        """
+        :description: 保存ip类型
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param ip_type_id：ip类型标识
+        :param type_name：类型名称
+        :param sort_index：排序
+        :param is_release：是否发布
+        :param type_pic：类型图片
+        :return
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id or not type_name:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        ip_type = None
+        old_ip_type = None
+        is_add = False
+        ip_type_model = IpTypeModel(context=self.context)
+        if ip_type_id > 0:
+            ip_type = ip_type_model.get_entity_by_id(ip_type_id)
+            if not ip_type or ip_type.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "ip类型信息不存在"
+                return invoke_result_data
+            old_ip_type = deepcopy(ip_type)
+        if not ip_type:
+            is_add = True
+            ip_type = IpType()
+        ip_type.app_id = app_id
+        ip_type.act_id = act_id
+        ip_type.type_name = type_name
+        ip_type.type_pic = type_pic
+        ip_type.sort_index = sort_index
+        ip_type.is_release = is_release
+        ip_type.modify_date = SevenHelper.get_now_datetime()
+        if is_add:
+            ip_type.create_date = ip_type.modify_date
+            ip_type.id = ip_type_model.add_entity(ip_type)
+        else:
+            ip_type_model.update_entity(ip_type,exclude_field_list="app_id,act_id")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = ip_type
+        result["old"] = old_ip_type
+        invoke_result_data.data = result
+        self._delete_ip_type_dependency_key(act_id,ip_type.id)
+        return invoke_result_data
+
+    def get_ip_type_list(self, app_id, act_id, page_size, page_index,is_release=-1, field="*", condition="", params=[], order_by="sort_index desc", is_cache=True, page_count_mode="total"):
+        """
+        :description: 获取IP类型列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_size：页大小
+        :param page_index：页索引
+        :param is_release: 是否发布1是0否
+        :param field：字段
+        :param condition：条件
+        :param params：参数数组
+        :param order_by：排序
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :return:
+        :last_editors: HuangJianYi
+        """
+        params_list = [app_id, act_id]
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s and act_id=%s")
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+        if is_release != -1:
+            condition_where.add_condition("is_release=%s")
+            params_list.append(is_release)
+        if is_cache == True:
+            page_list = IpTypeModel(context=self.context).get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, dependency_key=DependencyKey.ip_type_list(act_id), cache_expire=600, page_count_mode=page_count_mode)
+        else:
+            page_list = IpTypeModel(context=self.context).get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=condition_where.to_string(), group_by="", order_by=order_by, params=params_list, page_count_mode=page_count_mode)
+        return page_list
+
+    def release_ip_type(self,app_id, ip_type_id, is_release):
+        """
+        :description: ip上下架
+        :param app_id：应用标识
+        :param ip_type_id：ip类型标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        ip_type_model = IpTypeModel(context=self.context)
+        ip_type_dict = ip_type_model.get_dict_by_id(ip_type_id)
+        if not ip_type_dict or ip_type_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "ip信息不存在"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = ip_type_model.update_table("is_release=%s,modify_date=%s", "id=%s", [is_release, modify_date, ip_type_id])
+        self._delete_ip_type_dependency_key(ip_type_dict["act_id"],ip_type_id)
+        invoke_result_data.data = ip_type_dict
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/price_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/price_s.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,163 +1,180 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 14:25:02
-@LastEditTime: 2021-10-13 09:42:48
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.price_base_model import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class SavePriceGearHandler(ClientBaseHandler):
-    """
-    :description: 保存价格档位信息
-    """
-    @filter_check_params("act_id,price")
-    def get_async(self):
-        """
-        :description: 保存价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param relation_type：关联类型：1商品skuid关联2商品id关联
-        :param price_gear_name：档位名称
-        :param price_gear_pic：档位图片
-        :param price：价格
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :param remark：备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-        relation_type = int(self.get_param("relation_type", 1))
-        price = self.get_param("price")
-        price_gear_name = self.get_param("price_gear_name")
-        price_gear_pic = self.get_param("price_gear_pic")
-        goods_id = self.get_param("goods_id")
-        sku_id = self.get_param("sku_id")
-        remark = self.get_param("remark")
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.save_price_gear(app_id, act_id, price_gear_id, relation_type, price_gear_name, price_gear_pic, price, goods_id, sku_id,remark)
-        if invoke_result_data.success ==False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(OperationType.add.value, invoke_result_data.data["new"].__str__(), "SavePriceGearHandler", None, self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-        else:
-            self.create_operation_log(OperationType.update.value, invoke_result_data.data["new"].__str__(), "SavePriceGearHandler", self.json_dumps(invoke_result_data.data["old"]), self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class PriceGearListHandler(ClientBaseHandler):
-    """
-    :description: 获取价格档位列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 获取价格档位列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param is_del：是否回收站1是0否
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        is_del = int(self.get_param("is_del", 0))
-
-        return self.response_json_success(PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index,is_del=is_del,is_cache=False))
-
-
-class DeletePriceGearHandler(ClientBaseHandler):
-    """
-    :description: 删除档位
-    """
-    @filter_check_params("price_gear_id")
-    def get_async(self):
-        """
-        :description: 删除档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 1)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.delete.value, "price_gear_tb", "DeletePriceGearHandler", None, price_gear_id)
-        return self.response_json_success()
-
-
-class ReviewPriceGearHandler(ClientBaseHandler):
-    """
-    :description: 恢复价格档位
-    """
-    @filter_check_params("price_gear_id")
-    def get_async(self):
-        """
-        :description: 恢复价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 0)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.review.value, "price_gear_tb", "ReviewPriceGearHandler", None, price_gear_id)
-        return self.response_json_success()
-
-
-class CheckPriceGearHandler(ClientBaseHandler):
-    """
-    :description: 验证价格档位
-    """
-    @filter_check_params("act_id,goods_id")
-    def get_async(self):
-        """
-        :description: 验证价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        price_gear_id = int(self.get_param("price_gear_id", 0))
-        goods_id = self.get_param("goods_id")
-        sku_id = self.get_param("sku_id")
-
-        price_base_model = PriceBaseModel(context=self)
-        invoke_result_data = price_base_model.check_price_gear(app_id, act_id, price_gear_id, goods_id, sku_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 14:25:02
+@LastEditTime: 2023-01-12 09:48:32
+@LastEditors: HuangJianYi
+@Description: 价格档位模块
+"""
+from seven_cloudapp_frame.models.price_base_model import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+
+class SavePriceGearHandler(ClientBaseHandler):
+    """
+    :description: 保存价格档位信息
+    """
+    @filter_check_params("price")
+    def get_async(self):
+        """
+        :description: 保存价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param relation_type：关联类型：1商品skuid关联2商品id关联
+        :param price_gear_name：档位名称
+        :param price_gear_pic：档位图片
+        :param price：价格
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :param remark：备注
+        :param sort_index：排序
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+        relation_type = int(self.get_param("relation_type", 1))
+        price = self.get_param("price")
+        price_gear_name = self.get_param("price_gear_name")
+        price_gear_pic = self.get_param("price_gear_pic")
+        goods_id = self.get_param("goods_id")
+        sku_id = self.get_param("sku_id")
+        remark = self.get_param("remark")
+        sort_index = int(self.get_param("sort_index", 0))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.save_price_gear(app_id, act_id, price_gear_id, relation_type, price_gear_name, price_gear_pic, price, goods_id, sku_id, remark, sort_index)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + price_gear_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class PriceGearListHandler(ClientBaseHandler):
+    """
+    :description: 获取价格档位列表
+    """
+    def get_async(self):
+        """
+        :description: 获取价格档位列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param is_del：是否回收站1是0否
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        is_del = self.get_param_int("is_del", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc"
+        page_list, total = PriceBaseModel(context=self).get_price_gear_list(app_id, act_id, page_size, page_index, order_by, is_del=is_del, is_cache=False)
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
+        return self.response_json_success(page_info)
+
+
+class DeletePriceGearHandler(ClientBaseHandler):
+    """
+    :description: 删除档位
+    """
+    @filter_check_params("price_gear_id")
+    def get_async(self):
+        """
+        :description: 删除档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 1)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
+        return self.response_json_success()
+
+
+class ReviewPriceGearHandler(ClientBaseHandler):
+    """
+    :description: 恢复价格档位
+    """
+    @filter_check_params("price_gear_id")
+    def get_async(self):
+        """
+        :description: 恢复价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.update_price_gear_status(app_id, act_id, price_gear_id, 0)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "价格档位"
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="price_gear_tb", title= title_prefix + ";" + invoke_result_data.data["price_gear_name"])
+        return self.response_json_success()
+
+
+class CheckPriceGearHandler(ClientBaseHandler):
+    """
+    :description: 验证价格档位
+    """
+    @filter_check_params("goods_id")
+    def get_async(self):
+        """
+        :description: 验证价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :return: response_json_success
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        price_gear_id = int(self.get_param("price_gear_id", 0))
+        goods_id = self.get_param("goods_id")
+        sku_id = self.get_param("sku_id")
+
+        price_base_model = PriceBaseModel(context=self)
+        invoke_result_data = price_base_model.check_price_gear(app_id, act_id, price_gear_id, goods_id, sku_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/prize_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/cms_s.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,250 +1,221 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:42:53
-@LastEditTime: 2021-10-13 09:43:17
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.prize_base_model import *
-from seven_cloudapp_frame.models.seven_model import PageInfo
-
-
-class SaveActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 保存活动奖品
-    """
-    @filter_check_params("act_id")
-    def post_async(self):
-        """
-        :description: 保存活动奖品
-        :param app_id：应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_id: 奖品标识
-        :param prize_name: 奖品名称
-        :param prize_title: 奖品子标题
-        :param prize_pic: 奖品图
-        :param prize_detail_json: 奖品详情图（json）
-        :param goods_id: 商品ID
-        :param goods_code: 商品编码
-        :param goods_code_list: 多个sku商品编码
-        :param goods_type: 物品类型（1虚拟2实物）
-        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
-        :param prize_price: 奖品价值
-        :param probability: 奖品权重
-        :param chance: 概率
-        :param prize_limit: 中奖限制数
-        :param is_prize_notice: 是否显示跑马灯(1是0否)
-        :param prize_total: 奖品总数
-        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
-        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
-        :param tag_name: 标签名称(奖项名称)
-        :param tag_id: 标签ID(奖项标识)
-        :param is_sku: 是否有SKU
-        :param sku_json: sku详情json 注意：所有的参数只能是整形或字符串，如果是对象的参数必须先序列化
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", 0))
-        prize_id = int(self.get_param("prize_id", 0))
-        prize_name = self.get_param("prize_name")
-        prize_title = self.get_param("prize_title")
-        prize_pic = self.get_param("prize_pic")
-        prize_detail_json = self.get_param("prize_detail_json")
-        goods_id = self.get_param("goods_id")
-        goods_code = self.get_param("goods_code")
-        goods_code_list = self.get_param("goods_code_list")
-        goods_type = int(self.get_param("goods_type", 0))
-        prize_type = int(self.get_param("prize_type", 0))
-        prize_price = self.get_param("prize_price")
-        probability = self.get_param("probability")
-        chance = self.get_param("chance")
-        prize_limit = int(self.get_param("prize_limit", 0))
-        is_prize_notice = int(self.get_param("is_prize_notice", 0))
-        prize_total = int(self.get_param("prize_total", 0))
-        is_surplus = int(self.get_param("is_surplus", 0))
-        lottery_type = int(self.get_param("lottery_type", 0))
-        tag_name = self.get_param("tag_name")
-        tag_id = int(self.get_param("tag_id", 0))
-        is_sku = int(self.get_param("is_sku", 0))
-        sku_json = self.get_param("sku_json")
-        ascription_type = int(self.get_param("ascription_type", 0))
-        sort_index = int(self.get_param("sort_index", 0))
-        is_release = int(self.get_param("is_release", 0))
-        i1 = int(self.get_param("i1", 0))
-        i2 = int(self.get_param("i2", 0))
-        i3 = int(self.get_param("i3", 0))
-        i4 = int(self.get_param("i4", 0))
-        i5 = int(self.get_param("i5", 0))
-        s1 = self.get_param("s1")
-        s2 = self.get_param("s2")
-        s3 = self.get_param("s3")
-        s4 = self.get_param("s4")
-        s5 = self.get_param("s5")
-        d1 = self.get_param("d1", "1900-01-01 00:00:00")
-        d2 = self.get_param("d2", "1900-01-01 00:00:00")
-
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.save_act_prize(app_id, act_id, module_id, prize_id, prize_name, prize_title, prize_pic, prize_detail_json, goods_id, goods_code, goods_code_list, goods_type, prize_type, prize_price, probability, chance, prize_limit, is_prize_notice, prize_total, is_surplus, lottery_type, tag_name, tag_id, is_sku, sku_json, sort_index, is_release, ascription_type, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        if invoke_result_data.data["is_add"] == True:
-            # 记录日志
-            self.create_operation_log(OperationType.add.value, invoke_result_data.data["new"].__str__(), "SaveActPrizeHandler", None, self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-        else:
-            self.create_operation_log(OperationType.update.value, invoke_result_data.data["new"].__str__(), "SaveActPrizeHandler", self.json_dumps(invoke_result_data.data["old"]), self.json_dumps(invoke_result_data.data["new"]), self.get_open_id(), self.get_user_nick())
-
-        return self.response_json_success(invoke_result_data.data["new"].id)
-
-
-class ActPrizeListHandler(ClientBaseHandler):
-    """
-    :description: 活动奖品列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 活动奖品列表
-        :param app_id：应用标识
-        :param prize_name：奖品名称
-        :param is_del：是否回收站1是0否
-        :param page_index：页索引
-        :param page_size：页大小
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        module_id = int(self.get_param("module_id", 0))
-        prize_name = self.get_param("prize_name")
-        is_del = int(self.get_param("is_del", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-
-        condition = ""
-        params = []
-        order_by = "create_date desc"
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == True:
-            condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
-            params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
-            order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
-
-        if not app_id or not act_id:
-            return self.response_json_success({"data": []})
-        prize_base_model = PrizeBaseModel(context=self)
-        page_list, total = prize_base_model.get_act_prize_list(app_id, act_id, module_id, prize_name, 0, is_del, page_size, page_index, order_by=order_by, condition=condition, params=params, is_cache=False)
-        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list))
-        return self.response_json_success(page_info)
-
-    def business_process_executing(self):
-        """
-        :description: 执行前事件
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, page_list):
-        """
-        :description: 执行后事件
-        :param page_list:page_list
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return page_list
-
-
-class DeleteActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 删除活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 删除活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 1)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.delete.value, "act_prize_tb", "DeleteActPrizeHandler", None, prize_id)
-        return self.response_json_success()
-
-
-class ReviewActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 还原活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 还原活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.update_act_prize_status(app_id, prize_id, 0)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        self.create_operation_log(OperationType.review.value, "act_prize_tb", "ReviewActPrizeHandler", None, prize_id)
-        return self.response_json_success()
-
-
-class ReleaseActPrizeHandler(ClientBaseHandler):
-    """
-    :description: 上下架活动奖品
-    """
-    @filter_check_params("prize_id")
-    def get_async(self):
-        """
-        :description: 上下架活动奖品
-        :param app_id：应用标识
-        :param prize_id 奖品标识
-        :param is_release: 是否发布 1-是 0-否
-        :return:
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        prize_id = int(self.get_param("prize_id", 0))
-        is_release = int(self.get_param("is_release", 0))
-
-        prize_base_model = PrizeBaseModel(context=self)
-        invoke_result_data = prize_base_model.release_act_prize(app_id, prize_id, is_release)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 17:00:55
+@LastEditTime: 2023-02-16 17:52:26
+@LastEditors: HuangJianYi
+@Description: 资讯模块
+"""
+
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.models.cms_base_model import *
+from seven_cloudapp_frame.models.db_models.cms.cms_info_model import *
+
+
+class SaveCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 保存资讯信息
+    """
+    @filter_check_params("info_title")
+    def get_async(self):
+        """
+        :description: 保存资讯信息
+        :params info_title:标题
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        cms_id = self.get_param_int("cms_id", 0)
+        info_title = self.get_param("info_title")
+        simple_title = self.get_param("simple_title")
+        simple_title_url = self.get_param("simple_title_url")
+        info_type = self.get_param_int("info_type", 0)
+        info_summary = self.get_param("info_summary")
+        info_tag = self.get_param("info_tag")
+        info_mark = self.get_param("info_mark")
+        target_url = self.get_param("target_url")
+        min_pic = self.get_param("min_pic")
+        mid_pic = self.get_param("mid_pic")
+        max_pic = self.get_param("max_pic")
+        info_data = self.get_param("info_data")
+        pic_collect_json = self.get_param("pic_collect_json")
+        sort_index = self.get_param_int("sort_index", 0)
+        is_release = self.get_param_int("is_release", 0)
+        i1 = self.get_param_int("i1", 0)
+        i2 = self.get_param_int("i2", 0)
+        i3 = self.get_param_int("i3", 0)
+        i4 = self.get_param_int("i4", 0)
+        s1 = self.get_param("s1")
+        s2 = self.get_param("s2")
+        s3 = self.get_param("s3")
+        s4 = self.get_param("s4")
+
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title=info_title)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
+
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class UpdateCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 更新资讯信息
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 更新资讯信息
+        :params cms_id:资讯标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        cms_id = self.get_param_int("cms_id", 0)
+        info_title = self.get_param("info_title",None)
+        simple_title = self.get_param("simple_title", None)
+        simple_title_url = self.get_param("simple_title_url", None)
+        info_type = self.get_param_int("info_type", -1)
+        info_summary = self.get_param("info_summary", None)
+        info_tag = self.get_param("info_tag", None)
+        info_mark = self.get_param("info_mark", None)
+        target_url = self.get_param("target_url", None)
+        min_pic = self.get_param("min_pic", None)
+        mid_pic = self.get_param("mid_pic", None)
+        max_pic = self.get_param("max_pic", None)
+        info_data = self.get_param("info_data", None)
+        pic_collect_json = self.get_param("pic_collect_json", None)
+        sort_index = self.get_param_int("sort_index", -1)
+        is_release = self.get_param_int("is_release", -1)
+        i1 = self.get_param_int("i1", -1)
+        i2 = self.get_param_int("i2", -1)
+        i3 = self.get_param_int("i3", -1)
+        i4 = self.get_param_int("i4", -1)
+        s1 = self.get_param("s1", None)
+        s2 = self.get_param("s2", None)
+        s3 = self.get_param("s3", None)
+        s4 = self.get_param("s4", None)
+
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.save_cms_info(place_id, cms_id, app_id, act_id, info_title, simple_title, simple_title_url, info_type, info_summary, info_tag, info_mark, target_url, min_pic, mid_pic, max_pic, info_data, pic_collect_json, sort_index, is_release, i1, i2, i3, i4, s1, s2, s3, s4)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title=info_title)
+        return self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class CmsInfoListHandler(ClientBaseHandler):
+    """
+    :description: 获取资讯列表
+    """
+    def get_async(self):
+        """
+        :description: 获取位置信息列表
+        :params place_id:位置标识
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        place_id = self.get_param_int("place_id", 0)
+        page_size = self.get_param_int("page_size", 20)
+        page_index = self.get_param_int("page_index", 0)
+
+        condition = None
+        params = None
+        order_by = "id desc"
+        field = "*"
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        else:
+            condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else None
+            params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else None
+            order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "id desc"
+            field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        cms_base_model = CmsBaseModel(context=self)
+        if condition and params:
+            page_list, total = cms_base_model.get_cms_info_list_v2(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, condition=condition, params=params, is_cache=False)
+        else:
+            page_list, total = cms_base_model.get_cms_info_list(place_id=place_id, page_size=page_size, page_index=page_index, order_by=order_by, field=field, app_id=app_id, act_id=act_id, is_cache=False)
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params={}))
+        return self.response_json_success(page_info)
+
+
+class DeleteCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 删除资讯
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 删除资讯
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        cms_id = self.get_param_int("cms_id", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.delete_cms_info(app_id, cms_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseCmsInfoHandler(ClientBaseHandler):
+    """
+    :description: 上下架资讯
+    """
+
+    @filter_check_params("cms_id")
+    def get_async(self):
+        """
+        :description: 上下架资讯
+        :param app_id：应用标识
+        :param cms_id：资讯标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        cms_id = self.get_param_int("cms_id", 0)
+        is_release = self.get_param_int("is_release", 0)
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else "资讯"
+        cms_base_model = CmsBaseModel(context=self)
+        invoke_result_data = cms_base_model.release_cms_info(app_id, cms_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        self.create_operation_log(operation_type=operation_type, model_name="cms_info_tb", title=title_prefix + ";" + invoke_result_data.data["info_title"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/theme_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/theme_s.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,71 +1,76 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 09:03:41
-@LastEditTime: 2021-10-13 09:43:45
-@LastEditors: HuangJianYi
-@Description: 主题皮肤
-"""
-
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.theme_base_model import *
-
-
-class ThemeInfoListHandler(ClientBaseHandler):
-    """
-    :description: 主题列表
-    """
-    def get_async(self):
-        """
-        :description: 主题列表
-        :param app_id：应用标识
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_theme_list(app_id,is_cache=False))
-
-
-class SkinInfoListHandler(ClientBaseHandler):
-    """
-    :description: 皮肤列表
-    """
-    @filter_check_params("theme_id")
-    def get_async(self):
-        """
-        :description: 皮肤列表
-        :param theme_id：主题标识
-        :return: 列表
-        :last_editors: HuangJianYi
-        """
-        theme_id = int(self.get_param("theme_id", 0))
-        theme_base_model = ThemeBaseModel(context=self)
-        return self.response_json_success(theme_base_model.get_skin_list(theme_id,is_cache=False))
-
-
-class UpdateThemeHandler(ClientBaseHandler):
-    """
-    :description: 更新活动主题和皮肤
-    """
-    @filter_check_params("act_id,theme_id")
-    def get_async(self):
-        """
-        :description: 更新活动主题和皮肤
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param theme_id：主题标识
-        :param is_module：是否更新活动模块皮肤 True是False否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        theme_id = int(self.get_param("theme_id", 0))
-        is_module = self.get_param("is_module", True)
-
-        theme_base_model = ThemeBaseModel(context=self)
-        invoke_result_data = theme_base_model.update_act_theme_and_skin(app_id, act_id, theme_id, is_module)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 09:03:41
+@LastEditTime: 2022-06-13 14:39:47
+@LastEditors: HuangJianYi
+@Description: 主题皮肤模块
+"""
+
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.theme_base_model import *
+
+
+class ThemeInfoListHandler(ClientBaseHandler):
+    """
+    :description: 主题列表
+    """
+    def get_async(self):
+        """
+        :description: 主题列表
+        :param app_id：应用标识
+        :param ascription_type：归属类型
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        ascription_type = self.get_param_int("ascription_type", 1)
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(theme_base_model.get_theme_list(app_id, is_cache=False, ascription_type=ascription_type))
+
+
+class SkinInfoListHandler(ClientBaseHandler):
+    """
+    :description: 皮肤列表
+    """
+    @filter_check_params("theme_id")
+    def get_async(self):
+        """
+        :description: 皮肤列表
+        :param theme_id：主题标识
+        :return: 列表
+        :last_editors: HuangJianYi
+        """
+        theme_id = int(self.get_param("theme_id", 0))
+        theme_base_model = ThemeBaseModel(context=self)
+        return self.response_json_success(theme_base_model.get_skin_list(theme_id,is_cache=False))
+
+
+class UpdateThemeHandler(ClientBaseHandler):
+    """
+    :description: 更新活动主题和皮肤
+    """
+    @filter_check_params("theme_id")
+    def get_async(self):
+        """
+        :description: 更新活动主题和皮肤
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param is_module：是否更新活动模块皮肤 1是0否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        theme_id = int(self.get_param("theme_id", 0))
+        is_module = int(self.get_param("is_module", 0))
+        if is_module == 1:
+            is_module = True
+        else:
+            is_module = False
+        theme_base_model = ThemeBaseModel(context=self)
+        invoke_result_data = theme_base_model.update_act_theme_and_skin(app_id, act_id, theme_id, is_module)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
         return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/handlers/server/user_s.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/client/user.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,447 +1,451 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:52:51
-@LastEditTime: 2021-10-13 09:44:09
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.handlers.frame_base import *
-from seven_cloudapp_frame.models.user_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.libs.customize.oss2_helper import *
-from seven_cloudapp_frame.models.enum import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
-
-
-class LoginHandler(ClientBaseHandler):
-    """
-    :description: 登录处理
-    """
-    @filter_check_params("open_id")
-    def get_async(self):
-        """
-        :description: 登录日志入库
-        :param open_id：用户唯一标识
-        :param user_nick：用户昵称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        open_id = self.get_open_id()
-        user_nick = self.get_user_nick()
-
-        request_params = str(self.request_params)
-
-        if user_nick == "":
-            return self.response_json_success()
-
-        tao_login_log_model = TaoLoginLogModel(context=self)
-        tao_login_log = tao_login_log_model.get_entity("open_id=%s", params=open_id)
-
-        is_add = False
-        if not tao_login_log:
-            is_add = True
-            tao_login_log = TaoLoginLog()
-
-        tao_login_log.open_id = open_id
-        tao_login_log.user_nick = user_nick
-        if user_nick.__contains__(":"):
-            tao_login_log.store_user_nick = user_nick.split(":")[0]
-            tao_login_log.is_master = 0
-        else:
-            tao_login_log.store_user_nick = user_nick
-            tao_login_log.is_master = 1
-        tao_login_log.request_params = request_params
-        tao_login_log.modify_date = self.get_now_datetime()
-
-        try:
-            if is_add:
-                tao_login_log.create_date = tao_login_log.modify_date
-                tao_login_log.id = tao_login_log_model.add_entity(tao_login_log)
-            else:
-                tao_login_log_model.update_entity(tao_login_log)
-
-            #更新登录时间到app_info
-            app_id = self.get_app_id()
-            if app_id:
-                AppInfoModel(context=self).update_table("modify_date=%s", "app_id=%s", [tao_login_log.modify_date, app_id])
-        except:
-            pass
-
-        return self.response_json_success()
-
-
-class UpdateUserStatusHandler(ClientBaseHandler):
-    """
-    :description: 更新用户状态
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 更新用户状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_state：用户状态（0正常1黑名单）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id"))
-        user_id = self.get_user_id()
-        user_state = int(self.get_param("user_state"))
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_state(app_id, act_id, user_id, user_state)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class UpdateUserStatusByBlackHandler(ClientBaseHandler):
-    """
-    :description: 用户拉入黑名单(黑名单管理模式)
-    """
-    @filter_check_params("act_id,tb_user_id")
-    def get_async(self):
-        """
-        :description: 用户拉入黑名单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param tb_user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id"))
-        user_id = self.get_user_id()
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_user_state_by_black(app_id, act_id, user_id)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-        self.business_process_executed(invoke_result_data)
-        return self.response_json_success()
-
-    def business_process_executing(self):
-        """
-        :description: 执行前事件
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class AuditUserBlackHandler(ClientBaseHandler):
-    """
-    :description 审核黑名单状态
-    """
-    @filter_check_params("black_id,audit_status")
-    def get_async(self):
-        """
-        :description: 审核黑名单状态
-        :param black_id：用户黑名单管理标识
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param audit_remark：审核备注
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        black_id = int(self.get_param("black_id", 0))
-        audit_status = int(self.get_param("audit_status", 0))
-        audit_remark = self.get_param("audit_remark")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.audit_user_black(app_id, black_id, audit_status, audit_remark)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-        self.business_process_executed(invoke_result_data)
-        return self.response_json_success()
-
-    def business_process_executing(self):
-        """
-        :description: 执行前事件
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class UpdateAuditRemarkHandler(ClientBaseHandler):
-    """
-    :description 修改审核备注
-    """
-    @filter_check_params("black_id,audit_status")
-    def get_async(self):
-        """
-        :description: 修改审核备注
-        :param black_id：用户黑名单管理标识
-        :param audit_remark：审核备注
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        black_id = int(self.get_param("black_id", 0))
-        audit_remark = self.get_param("audit_remark")
-        user_base_model = UserBaseModel(context=self)
-        invoke_result_data = user_base_model.update_audit_remark(app_id, black_id, audit_remark)
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
-        return self.response_json_success()
-
-
-class UserBlackListHandler(ClientBaseHandler):
-    """
-    :description: 获取黑名单管理列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 获取黑名单管理列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param user_id：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param nick_name：用户昵称
-        :param user_open_id：open_id
-        :param page_size：条数
-        :param page_index：页数
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        audit_status = int(self.get_param("audit_status", -1))
-        user_id = self.get_user_id()
-        user_nick = self.get_param("nick_name")
-        open_id = self.get_param("user_open_id")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        page_size = int(self.get_param("page_size", 20))
-        page_index = int(self.get_param("page_index", 0))
-
-        user_base_model = UserBaseModel(context=self)
-        return self.response_json_success(user_base_model.get_black_list(app_id, act_id, page_size, page_index, audit_status, user_id, start_date, end_date, user_nick, open_id))
-
-
-class UpdateUserAssetHandler(ClientBaseHandler):
-    """
-    :description: 变更资产
-    """
-    @filter_check_params("act_id,tb_user_id,asset_type,asset_value")
-    def post_async(self):
-        """
-        :description: 变更资产
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param asset_type：资产类型
-        :param asset_value：变更的资产值
-        :param asset_object_id：资产对象标识
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_value = int(self.get_param("asset_value", 0))
-        asset_object_id = self.get_param("asset_object_id")
-
-        invoke_result_data = self.business_process_executing()
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-
-        user_base_model = UserBaseModel(context=self)
-        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return self.response_json_error("error","用户信息不存在")
-
-        asset_base_model = AssetBaseModel(context=self)
-        invoke_result_data = asset_base_model.update_user_asset(app_id, act_id, 0, user_id, user_info_dict["open_id"], user_info_dict["user_nick"], asset_type, asset_value, asset_object_id, 3, "", "手动配置", "手动配置")
-        if invoke_result_data.success == False:
-            return self.response_json_error(invoke_result_data.error_code,invoke_result_data.error_message)
-        self.business_process_executed(invoke_result_data)
-        return self.response_json_success()
-
-    def business_process_executing(self):
-        """
-        :description: 执行前事件
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = {}
-        return invoke_result_data
-
-    def business_process_executed(self, invoke_result_data):
-        """
-        :description: 执行后事件
-        :param invoke_result_data:框架处理结果
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return invoke_result_data
-
-
-class BatchUpdateUserAssetHandler(ClientBaseHandler):
-    """
-    :description: 批量变更资产
-    """
-    @filter_check_params("act_id,tb_user_id,asset_object_json")
-    def post_async(self):
-        """
-        :description: 批量变更资产
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param asset_object_json：变更的资产值列表
-        :return: response_json_success
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        #{"asset_type":0,"asset_object_id":"","asset_value":0}
-        asset_object_json = self.get_param("asset_object_json")
-
-        user_base_model = UserBaseModel(context=self)
-        user_info_dict = user_base_model.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return self.response_json_error("error", "用户信息不存在")
-
-        asset_base_model = AssetBaseModel(context=self)
-        asset_object_json = SevenHelper.json_loads(asset_object_json)
-        asset_object_ids = ""
-        for asset_object in asset_object_json:
-            invoke_result_data = asset_base_model.update_user_asset(app_id, act_id, 0, user_id, user_info_dict["open_id"], user_info_dict["user_nick"], int(asset_object["asset_type"]), int(asset_object["asset_value"]), asset_object["asset_object_id"], 3, "", "手动配置", "手动配置")
-            if invoke_result_data.success == False:
-                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, asset_object_ids)
-            else:
-                if asset_object_ids:
-                    asset_object_ids += ","
-                asset_object_ids += asset_object["asset_object_id"]
-
-        return self.response_json_success()
-
-
-class AssetLogListHandler(ClientBaseHandler):
-    """
-    :description: 资产流水记录
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 资产流水记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param asset_type：资产类型(1-次数2-积分3-价格档位)
-        :param page_size：条数
-        :param page_index：页数
-        :param user_id：用户标识
-        :param asset_object_id：资产对象标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param source_type：来源类型（1-购买2-任务3-手动配置4-抽奖5-回购）
-        :param source_object_id：来源对象标识(比如来源类型是任务则对应任务类型)
-        :return list
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        user_id = self.get_user_id()
-        user_open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        source_type = int(self.get_param("source_type", 0))
-        source_object_id = self.get_param("source_object_id")
-        asset_type = int(self.get_param("asset_type", 0))
-        asset_object_id = self.get_param("asset_object_id")
-
-        asset_base_model = AssetBaseModel(context=self)
-        return self.response_json_success(asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, start_date, end_date, user_nick, user_open_id, source_type, source_object_id,"*",is_cache=False))
-
-
-class UserInfoListHandler(ClientBaseHandler):
-    """
-    :description: 用户信息列表
-    """
-    @filter_check_params("act_id")
-    def get_async(self):
-        """
-        :description: 用户信息列表
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_open_id：_open_id
-        :param nick_name：用户昵称
-        :param user_state：_用户状态0正常1黑名单
-        :param page_index：页索引
-        :param page_size：页大小
-        :param start_date：创建时间开始
-        :param end_date：创建时间结束
-        :return PageInfo
-        :last_editors: HuangJianYi
-        """
-        app_id = self.get_app_id()
-        act_id = int(self.get_param("act_id", 0))
-        user_id = self.get_user_id()
-        open_id = self.get_param("user_open_id")
-        user_nick = self.get_param("nick_name")
-        user_state = int(self.get_param("user_state", -1))
-        page_index = int(self.get_param("page_index", 0))
-        page_size = int(self.get_param("page_size", 20))
-        start_date = self.get_param("start_date")
-        end_date = self.get_param("end_date")
-        user_base_model = UserBaseModel(context=self)
-        page_info = user_base_model.get_user_list(app_id, act_id, page_size, page_index, user_state, user_id, start_date, end_date, user_nick, open_id)
-        return self.reponse_json_success(self.business_process_executed(page_info, self.request_params))
-
-    def business_process_executed(self, page_info, request_params):
-        """
-        :description: 执行后事件
-        :param page_info:用户信息分页实体模型
-        :param request_params: 请求参数字典
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return page_info
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 18:31:06
+@LastEditTime: 2023-03-03 14:54:15
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.user_base_model import *
+from seven_cloudapp_frame.models.order_base_model import *
+from seven_cloudapp_frame.models.stat_base_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.libs.customize.wechat_helper import *
+from seven_cloudapp_frame.libs.customize.tiktok_helper import *
+from seven_cloudapp_frame.libs.customize.riskmanage_helper import *
+
+class LoginHandler(ClientBaseHandler):
+    """
+    :description: 登录处理
+    """
+    @filter_check_current_limit()
+    def get_async(self):
+        """
+        :description: 登录处理
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param avatar：头像
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_nick = self.get_user_nick()
+        mix_nick = self.get_param("mix_nick")
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        avatar = self.get_param("avatar")
+        code = self.get_param("code", "")
+        anonymous_code = self.get_param("anonymous_code", "")
+        pt = self.get_param("pt", "tb")  #tb淘宝 tt抖音 wx微信 jd京东 qq h5
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        is_update_user_nick = invoke_result_data.data["is_update_user_nick"] if invoke_result_data.data.__contains__("is_update_user_nick") else True
+        login_ip = self.get_remote_ip()
+        union_id = ""
+        if pt == "wx" and code:
+            invoke_result_data = WeChatHelper.code2_session(code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            open_id =  invoke_result_data.data["openid"]
+            union_id =  invoke_result_data.data.get("unionid","")
+        elif pt == "tt" and code:
+            invoke_result_data = TikTokHelper.code2_session(code, anonymous_code, app_id=share_config.get_value("app_id"), app_secret=share_config.get_value("app_secret"))
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            open_id = invoke_result_data.data["openid"]
+        else:
+            login_ip = self.get_param("source_ip")
+
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.save_user_by_openid(app_id, act_id, open_id, user_nick, avatar, union_id, login_ip, is_update_user_nick, mix_nick)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        invoke_result_data.data["user_nick"] = CryptographyHelper.emoji_base64_to_emoji(invoke_result_data.data["user_nick"])
+        if invoke_result_data.data["user_nick_encrypt"]:
+            invoke_result_data.data["user_nick"] = CryptographyHelper.base64_decrypt(invoke_result_data.data["user_nick_encrypt"])
+        ref_params = {}
+        ref_params["app_id"] = app_id
+        ref_params["act_id"] = act_id
+        ref_params["module_id"] = module_id
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        user_info_dict = result_data.data
+        stat_base_model = StatBaseModel(context=self)
+        key_list_dict = {}
+        key_list_dict["VisitCountEveryDay"] = 1
+        key_list_dict["VisitManCountEveryDay"] = 1
+        key_list_dict["VisitManCountEveryDayIncrease"] = 1
+        stat_base_model.add_stat_list(ref_params["app_id"], ref_params["act_id"], ref_params["module_id"], user_info_dict["user_id"], user_info_dict["open_id"], key_list_dict)
+        return result_data
+
+
+class UpdateUserInfoHandler(ClientBaseHandler):
+    """
+    :description: 更新用户信息
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 更新用户信息
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param avatar：头像
+        :param is_member_before：初始会员状态
+        :param is_favor_before：初始关注状态
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        user_nick = self.get_user_nick()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        avatar = self.get_param("avatar")
+        is_member_before = int(self.get_param("is_member_before", -1))
+        is_favor_before = int(self.get_param("is_favor_before", -1))
+        invoke_result_data = InvokeResultData()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.update_user_info(app_id, act_id, user_id, open_id, user_nick, avatar, is_member_before, is_favor_before)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
+            ref_params = {}
+            invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+            if invoke_result_data.success == False:
+                return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+            return self.response_json_success("更新成功")
+
+
+class CheckIsMemberHandler(ClientBaseHandler):
+    """
+    :description: 校验是否是店铺会员
+    """
+    def get_async(self):
+        """
+        :description: 校验是否是店铺会员
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        mix_nick = self.get_param("mix_nick")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            return self.response_json_error("error", "未授权请联系客服授权")
+        top_base_model = TopBaseModel(context=self)
+        app_key,app_secret = self.get_app_key_secret()
+        return self.response_json_success(top_base_model.check_is_member(mix_nick,"", access_token, app_key, app_secret, is_log))
+
+
+class GetCrmIntegralHandler(ClientBaseHandler):
+    """
+    :description: 获取店铺会员积分
+    """
+    @filter_check_params()
+    def get_async(self):
+        """
+        :description: 获取店铺会员积分
+        :return: 店铺会员积分
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_open_id()
+        mix_nick = self.get_param("mix_nick")
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            return self.response_json_error("error", "未授权请联系客服授权")
+        top_base_model = TopBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = top_base_model.get_crm_point_available(mix_nick, access_token, app_key, app_secret, is_log, open_id)
+        if invoke_result_data.success == False:
+            return self.reponse_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        shop_member_integral = invoke_result_data.data
+        return self.reponse_json_success(shop_member_integral)
+
+
+class ApplyBlackUnbindHandler(ClientBaseHandler):
+    """
+    :description: 提交黑名单解封申请
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 提交黑名单解封申请
+        :param act_id:活动标识
+        :param user_code:用户标识
+        :param reason:解封理由
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        open_id = self.get_param("open_id")
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        reason = self.get_param("reason", "误封号,申请解封")
+        invoke_result_data = InvokeResultData()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.apply_black_unbind(app_id, act_id, user_id, open_id, reason)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        else:
+            return self.response_json_success()
+
+
+class GetUnbindApplyHandler(ClientBaseHandler):
+    """
+    :description: 获取黑名单解封申请记录
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取黑名单解封申请记录
+        :param act_id:活动标识
+        :param user_code:用户标识
+        :param reason:解封理由
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.get_black_info_dict(app_id, act_id, user_id))
+
+
+class GetCouponPrizeHandler(ClientBaseHandler):
+    """
+    :description: 领取淘宝优惠券
+    """
+    @filter_check_params("user_prize_id", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 领取淘宝优惠券（发奖接口）
+        :param user_prize_id:用户奖品标识
+        :param user_code:用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_prize_id = int(self.get_param("user_prize_id", 0))
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        order_base_model = OrderBaseModel(context=self)
+        app_key, app_secret = self.get_app_key_secret()
+        invoke_result_data = order_base_model.get_coupon_prize(app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message, invoke_result_data.data)
+        else:
+            return self.response_json_success(self.business_process_executed(invoke_result_data.data, ref_params={}))
+
+
+class GetUserAssetHandler(ClientBaseHandler):
+    """
+    :description: 获取单条用户资产
+    """
+    @filter_check_params("asset_type", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取单条用户资产
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :param asset_object_id：资产对象标识
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_object_id = self.get_param("asset_object_id", "")
+        asset_base_model = AssetBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset(app_id, act_id, user_id, asset_type, asset_object_id), ref_params={}))
+
+
+class UserAssetListHandler(ClientBaseHandler):
+    """
+    :description: 获取用户资产列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :description: 获取用户资产列表
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        asset_type = int(self.get_param("asset_type", 0))
+        asset_base_model = AssetBaseModel(context=self)
+        return self.response_json_success(self.business_process_executed(asset_base_model.get_user_asset_list(app_id, act_id, user_id, asset_type), ref_params={}))
+
+
+class AssetLogListHandler(ClientBaseHandler):
+    """
+    :description: 资产流水记录
+    """
+    @filter_check_params("asset_type", check_user_code=True)
+    def get_async(self):
+        """
+        :description: 资产流水记录
+        :param act_id：活动标识
+        :param module_id：模块标识
+        :param user_code：用户标识
+        :param asset_type：资产类型(1-次数2-积分3-价格档位))
+        :param asset_object_id：资产对象标识
+        :param operate_type：操作类型(0累计 1消耗
+        :param page_size：条数
+        :param page_index：页数
+        :param page_count_mode：分页模式(0-none 1-total 2-next)
+        :return list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        module_id = self.get_param_int("module_id", 0)
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 20)
+        asset_type = self.get_param_int("asset_type", 0)
+        asset_object_id = self.get_param("asset_object_id")
+        operate_type = self.get_param_int("operate_type", -1)
+        page_count_mode = self.get_param_int("page_count_mode", 1)
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        asset_base_model = AssetBaseModel(context=self)
+        page_count_mode = SevenHelper.get_enum_key(PageCountMode, page_count_mode)
+        page_list = asset_base_model.get_asset_log_list(app_id, act_id, asset_type, page_size, page_index, user_id, asset_object_id, field=field, is_cache=True, operate_type=operate_type, page_count_mode=page_count_mode, module_id=module_id)
+        if page_count_mode == "total":
+            total = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = PageInfo(page_index, page_size, total, page_list)
+        elif page_count_mode == "next":
+            is_next = page_list[1]
+            page_list = self.business_process_executed(page_list[0], ref_params={})
+            return_info = WaterPageInfo(page_list, is_next)
+        else:
+            return_info = self.business_process_executed(page_list, ref_params={})
+        return self.response_json_success(return_info)
+
+
+class GetJoinMemberUrlHandler(ClientBaseHandler):
+    """
+    :description: 获取加入会员地址
+    """
+    def get_async(self):
+        """
+        :description: 获取加入会员地址
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        is_log = int(self.get_param("is_log", 0))
+        is_log = True if is_log == 1 else False
+        app_base_model = AppBaseModel(context=self)
+        app_info_dict = app_base_model.get_app_info_dict(app_id=app_id,is_cache=True,field="access_token")
+        if not app_info_dict:
+            return self.response_json_error("error", "小程序不存在")
+        app_key, app_secret = self.get_app_key_secret()
+        user_base_model = UserBaseModel(context=self)
+        invoke_result_data = user_base_model.get_join_member_url(app_info_dict["access_token"], app_key, app_secret, is_log=is_log)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class UserAddressListHandler(ClientBaseHandler):
+    """
+    :description: 收货地址列表
+    """
+    @filter_check_params(check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :return: list
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.get_user_address_list(app_id, act_id, user_id))
+
+
+class SaveUserAddressHandler(ClientBaseHandler):
+    """
+    :description: 保存收货地址
+    """
+    @filter_check_params("real_name,telephone", check_user_code=True)
+    def get_async(self):
+        """
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param is_default：是否默认地址（1是0否）
+        :param real_name：真实姓名
+        :param telephone：手机号码
+        :param province：省
+        :param city：市
+        :param county：区
+        :param street：街道
+        :param adress：地址
+        :return: dict
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        open_id = self.get_param("open_id")
+        user_address_id = int(self.get_param("user_address_id", 0))
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        province = self.get_param("province")
+        city = self.get_param("city")
+        county = self.get_param("county")
+        street = self.get_param("street")
+        address = self.get_param("address")
+        is_default = int(self.get_param("is_default", 0))
+        user_base_model = UserBaseModel(context=self)
+        return self.response_json_success(user_base_model.save_user_address(app_id, act_id, user_id, open_id, user_address_id, real_name, telephone, province, city, county, street, address, is_default))
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/bloomfilter_helper.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,72 +1,72 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-10-25 18:00:46
-@LastEditTime: 2021-10-28 15:06:22
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import math
-import redis
-import mmh3
-
-
-class BloomFilterHelper():
-    """
-    :description: 布隆过滤器（Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。
-    :return: 
-    :last_editors: HuangJianYi
-    """
-    #内置100个随机种子
-    SEEDS = [543, 460, 171, 876, 796, 607, 650, 81, 837, 545, 591, 946, 846, 521, 913, 636, 878, 735, 414, 372, 344, 324, 223, 180, 327, 891, 798, 933, 493, 293, 836, 10, 6, 544, 924, 849, 438, 41, 862, 648, 338, 465, 562, 693, 979, 52, 763, 103, 387, 374, 349, 94, 384, 680, 574, 480, 307, 580, 71, 535, 300, 53, 481, 519, 644, 219, 686, 236, 424, 326, 244, 212, 909, 202, 951, 56, 812, 901, 926, 250, 507, 739, 371, 63, 584, 154, 7, 284, 617, 332, 472, 140, 605, 262, 355, 526, 647, 923, 199, 518]
-
-    def __init__(self, capacity=1000000000, error_rate=0.00000001, conn=None, key='bloom_filter',expire=0):
-        """
-        :description: 初始化
-        :param capacity: 预先估计要去重的数量
-        :param error_rate: 错误率
-        :param conn: redis的连接客户端
-        :param key: 键的名字前缀
-        :param expire: 过期时间（单位秒）
-        :return:
-        :last_editors: HuangJianYi
-        """
-        self.m = math.ceil(capacity * math.log2(math.e) * math.log2(1 / error_rate))  #需要的总bit位数
-        self.k = math.ceil(math.log1p(2) * self.m / capacity)  #需要最少的hash次数
-        self.mem = math.ceil(self.m / 8 / 1024 / 1024)  #需要的多少M内存
-        self.blocknum = math.ceil(self.mem / 512)  #需要多少个512M的内存块,value的第一个字符必须是ascii码，所有最多有256个内存块
-        self.seeds = self.SEEDS[0:self.k]
-        self.key = key
-        self.N = 2**31 - 1
-        self.redis = conn
-        self.expire = expire
-
-    def add(self, value):
-        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
-        hashs = self.get_hashs(value)
-        for hash in hashs:
-            self.redis.setbit(name, hash, 1)
-        if self.expire > 0:
-            self.redis.expire(name, self.expire)
-
-
-    def is_exist(self, value):
-        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
-        hashs = self.get_hashs(value)
-        exist = 1
-        for hash in hashs:
-            exist = exist & self.redis.getbit(name, hash)
-        if exist == 1:
-            return True
-        else:
-            return False
-
-    def get_hashs(self, value):
-        hashs = list()
-        for seed in self.seeds:
-            hash = mmh3.hash(value, seed)
-            if hash >= 0:
-                hashs.append(hash)
-            else:
-                hashs.append(self.N - hash)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-10-25 18:00:46
+@LastEditTime: 2022-04-24 14:31:41
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import math
+import redis
+import mmh3
+
+
+class BloomFilterHelper():
+    """
+    :description: 布隆过滤器（Bloom Filter）是 1970 年由布隆提出的。它实际上是一个很长的二进制向量和一系列随机映射函数。布隆过滤器可以用于检索一个元素是否在一个集合中。它的优点是空间效率和查询时间都比一般的算法要好的多，缺点是有一定的误识别率和删除困难。
+    :return: 
+    :last_editors: HuangJianYi
+    """
+    #内置100个随机种子
+    SEEDS = [543, 460, 171, 876, 796, 607, 650, 81, 837, 545, 591, 946, 846, 521, 913, 636, 878, 735, 414, 372, 344, 324, 223, 180, 327, 891, 798, 933, 493, 293, 836, 10, 6, 544, 924, 849, 438, 41, 862, 648, 338, 465, 562, 693, 979, 52, 763, 103, 387, 374, 349, 94, 384, 680, 574, 480, 307, 580, 71, 535, 300, 53, 481, 519, 644, 219, 686, 236, 424, 326, 244, 212, 909, 202, 951, 56, 812, 901, 926, 250, 507, 739, 371, 63, 584, 154, 7, 284, 617, 332, 472, 140, 605, 262, 355, 526, 647, 923, 199, 518]
+
+    def __init__(self, capacity=1000000000, error_rate=0.00000001, redis_connection=None, key='bloom_filter', expire=0):
+        """
+        :description: 初始化
+        :param capacity: 预先估计要去重的数量
+        :param error_rate: 错误率
+        :param redis_connection: redis的连接客户端
+        :param key: 键的名字前缀
+        :param expire: 过期时间（单位秒）
+        :return:
+        :last_editors: HuangJianYi
+        """
+        self.m = math.ceil(capacity * math.log2(math.e) * math.log2(1 / error_rate))  #需要的总bit位数
+        self.k = math.ceil(math.log1p(2) * self.m / capacity)  #需要最少的hash次数
+        self.mem = math.ceil(self.m / 8 / 1024 / 1024)  #需要的多少M内存
+        self.blocknum = math.ceil(self.mem / 512)  #需要多少个512M的内存块,value的第一个字符必须是ascii码，所有最多有256个内存块
+        self.seeds = self.SEEDS[0:self.k]
+        self.key = key
+        self.N = 2**31 - 1
+        self.redis = redis_connection
+        self.expire = expire
+
+    def add(self, value):
+        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
+        hashs = self.get_hashs(value)
+        for hash in hashs:
+            self.redis.setbit(name, hash, 1)
+        if self.expire > 0:
+            self.redis.expire(name, self.expire)
+
+
+    def is_exist(self, value):
+        name = self.key + "_" + str(ord(value[0]) % self.blocknum)
+        hashs = self.get_hashs(value)
+        exist = 1
+        for hash in hashs:
+            exist = exist & self.redis.getbit(name, hash)
+        if exist == 1:
+            return True
+        else:
+            return False
+
+    def get_hashs(self, value):
+        hashs = list()
+        for seed in self.seeds:
+            hash = mmh3.hash(value, seed)
+            if hash >= 0:
+                hashs.append(hash)
+            else:
+                hashs.append(self.N - hash)
         return hashs
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/queue_up_helper.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/queue_up_helper.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,654 +1,702 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-30 09:22:51
-@LastEditTime: 2021-10-29 11:40:20
-@LastEditors: HuangJianYi
-@Description: 排队系统帮助类
-"""
-from seven_framework import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-
-
-class QueueUpHelper:
-    """
-    :description: 排队系统帮助类 提供获取小程序总排队人数、获取用户当前排队数、获取用户正在办理中的队列信息、加入排队、退出排队、查询单个排队情况、批量查询某用户排队情况(只包含已排队的信息)、批量查询某用户排队情况(包含已排队和未排队的信息)、更新可操作时间、签到等功能；
-    踢人规则1：第一个在办理中，第二个用户的过期时间=第一个结束时间+8*1，第三个=第一个结束时间+8*2，以此类推；第一个没在办理中，第一个过期时间是8*1，第二个是8*2，第三个是8*3，以此类推；
-    踢人规则2：如果都没有正在办理中，那么取上次办理人退出的时间作为排在第一位人员的开始时间，进行倒计时，没有上次办理人退出时间的话，则取当前第一位人员的入队时间进行倒计时；
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def _get_zset_name(self, app_id, queue_name):
-        """
-        :description: 获取排行集合名称，集合用于排行榜，排第一的优先操作
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = "queueup_zset"
-        if app_id:
-            zset_name += "_" + str(app_id)
-        if queue_name:
-            zset_name += ":" + str(queue_name)
-        return zset_name
-
-    @classmethod
-    def _get_count_name(self, app_id, queue_name):
-        """
-        :description: 获取排队号计数名称
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        count_name = "queueup_count"
-        if app_id:
-            count_name += "_" + str(app_id)
-        if queue_name:
-            count_name += ":" + str(SevenHelper.get_now_day_int()) + "_" + str(queue_name)
-        return count_name
-
-    @classmethod
-    def _get_user_hash_name(self, app_id):
-        """
-        :description: 获取用户关联队列名称
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = "queueup_user_list"
-        if app_id:
-            hash_name += "_" + str(app_id)
-        return hash_name
-
-    @classmethod
-    def _get_user_zset_name(self, app_id):
-        """
-        :description: 用户在小程序内的排队次数信息
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = "queueup_zset_user"
-        if app_id:
-            zset_name += "_" + str(app_id)
-        return zset_name
-
-    @classmethod
-    def _get_popdate_hash_name(self, app_id):
-        """
-        :description: 办理中的用户退出队列的时间列表名称
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = "queueup_popdate_list"
-        if app_id:
-            hash_name += "_" + str(app_id)
-        return hash_name
-
-    @classmethod
-    def _get_queue_no(self, app_id, queue_name):
-        """
-        :description: 获取排队号
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        count_name = self._get_count_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        queue_no = redis_init.incr(count_name, 1)
-        redis_init.expire(count_name, 24 * 3600)
-        return queue_no
-
-    @classmethod
-    def _get_queue_num(self, app_id, queue_name):
-        """
-        :description: 获取当前排队人数
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        zset_name = self._get_zset_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zcard(zset_name)
-
-    @classmethod
-    def _get_app_user_num(self, app_id):
-        """
-        :description: 获取小程序总排队人数
-        :param app_id：应用标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        user_zset_name = self._get_user_zset_name(app_id)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zcount(user_zset_name, 1, 5000)
-
-    @classmethod
-    def get_user_queue_num(self, app_id, user_id):
-        """
-        :description: 获取用户当前排队数
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        user_zset_name = self._get_user_zset_name(app_id)
-        redis_init = SevenHelper.redis_init()
-        return redis_init.zscore(user_zset_name, str(user_id))
-
-    @classmethod
-    def get_process_user_queue(self, app_id, user_id):
-        """
-        :description: 获取用户正在办理中的队列信息
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 队列信息，没有返回None
-        :last_editors: HuangJianYi
-        """
-        process_queue = None
-        invoke_result_data = self.muti_user_query(app_id, user_id)
-        if invoke_result_data.success == False:
-            return process_queue
-        else:
-            for item in invoke_result_data.data:
-                if item["progress_status"] == 2:
-                    process_queue = item
-                    break
-            return process_queue
-
-    @classmethod
-    def queue(self, app_id, queue_name, user_id, user_nick="", avatar="", queue_length=10, app_limit_user_num=500, info_dict={}):
-        """
-        :description: 加入排队
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id 用户标识
-        :param user_nick 用户昵称
-        :param avatar 头像
-        :param queue_length：队列的长度
-        :param app_limit_user_num：小程序内总排队人数上限
-        :param info_dict：信息字典,用于存储业务端需要的数据
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            acquire_lock_name = f"queueup_queue"
-            if app_id:
-                acquire_lock_name += "_" + str(app_id)
-            acquire_lock_name += ":" + str(queue_name)
-
-            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-            if acquire_lock_status == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "acquire_lock"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-            redis_init = SevenHelper.redis_init()
-            if app_limit_user_num > 0 and self._get_app_user_num(app_id) >= app_limit_user_num:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "total_limit"
-                invoke_result_data.error_message = "排队失败,排队总人数已达上限"
-                return invoke_result_data
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            expire_time = 7 * 24 * 3600
-            if not redis_init.zscore(zset_name, data):
-                if self._get_queue_num(app_id, queue_name) >= queue_length:
-                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "queue_limit"
-                    invoke_result_data.error_message = "排队失败,当前排队人数已达上限"
-                    return invoke_result_data
-                queue_no = self._get_queue_no(app_id, queue_name)
-                redis_init.zadd(zset_name, {data: queue_no})
-                redis_init.expire(zset_name, expire_time)
-
-                user_zset_name = self._get_user_zset_name(app_id)
-                redis_init.zincrby(user_zset_name, 1, data)
-                redis_init.expire(user_zset_name, expire_time)
-
-                start_timestamp = TimeHelper.get_now_timestamp()
-
-                hash_value = {}
-                hash_value["queue_name"] = queue_name  #排队名称
-                hash_value["queue_no"] = queue_no  #排队号
-                hash_value["user_id"] = data  #用户标识
-                hash_value["user_nick"] = user_nick  #用户昵称
-                hash_value["avatar"] = avatar  #头像
-                hash_value["progress_status"] = 1  #进度0未排队1已排队2办理中
-                hash_value["queue_timestamp"] = start_timestamp  #入队时间搓
-                hash_value["queue_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)  #入队时间
-                hash_value["info_json"] = info_dict
-
-                queue_index = int(redis_init.zrank(zset_name, data)) + 1
-                if queue_index == 1:
-                    redis_init.hdel(self._get_popdate_hash_name(app_id), zset_name)
-                #添加排队信息
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                redis_init.hsetnx(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-                redis_init.expire(hash_name, expire_time)
-
-                result_data = {}
-                result_data["queue_no"] = hash_value["queue_no"]  #排队号
-                result_data["queue_num"] = self._get_queue_num(app_id, queue_name)  #当前排队人数
-                result_data["queue_index"] = queue_index  #当前位置
-                result_data["before_num"] = queue_index - 1  #排在前面的人数
-                invoke_result_data.data = result_data
-
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-            else:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "该用户已在队列中,请勿重复排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【加入排队】" + traceback.format_exc())
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "排队失败,请稍后再来"
-            return invoke_result_data
-
-    @classmethod
-    def _set_last_pop_date(self,app_id, redis_init, hash_key):
-        """
-        :description: 设置办理中的用户退出队列的时间
-        :param app_id：应用标识
-        :param redis_init：redis_init
-        :param hash_key：hash_key
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        hash_name = self._get_popdate_hash_name(app_id)
-        redis_init.hset(hash_name, hash_key, str(TimeHelper.get_now_timestamp()))
-        redis_init.expire(hash_name, 7 * 24 * 3600)
-
-    @classmethod
-    def pop(self, app_id, queue_name, user_id):
-        """
-        :description: 退出排队
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id 用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            cache_key = f"queueup_pop"
-            if app_id:
-                cache_key += "_" + str(app_id)
-            cache_key += ":" + str(queue_name) + "_" + str(user_id)
-            if SevenHelper.is_continue_request(cache_key, expire=1 * 1000) == True:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,请1秒后再试"
-                return invoke_result_data
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            redis_init = SevenHelper.redis_init()
-            if redis_init.zscore(zset_name, data):
-                if int(redis_init.zrank(zset_name, data)) + 1 == 1:
-                    self._set_last_pop_date(app_id,redis_init, zset_name)
-                redis_init.zrem(zset_name, data)
-                redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
-                redis_init.hdel(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
-                return invoke_result_data
-            else:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "未查到该用户的排队情况,请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【退出排队】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退出排队失败"
-            return invoke_result_data
-
-    @classmethod
-    def pop_by_queue_name(self, app_id, queue_name):
-        """
-        :description: 将过期用户从队列中退出
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if SevenHelper.is_continue_request(f"pop_by_queue_name:{app_id}_{queue_name}", 200) == False:
-            try:
-                redis_init = SevenHelper.redis_init()
-                zset_name = self._get_zset_name(app_id, queue_name)
-                hash_name = self._get_user_hash_name(app_id)
-                value_list = redis_init.zrange(zset_name, 0, 1000)
-                if len(value_list) > 0:
-                    now_timestamp = TimeHelper.get_now_timestamp()
-                    first_is_process = False
-                    first_end_timestamp = 0
-                    first_hash_key = f"userid_{value_list[0]}_queuename_{queue_name}"
-                    first_hash_value = redis_init.hget(hash_name, first_hash_key)
-                    if first_hash_value:
-                        first_hash_value = SevenHelper.json_loads(first_hash_value)
-                        if first_hash_value["progress_status"] == 2:
-                            first_is_process = True
-                            first_end_timestamp = first_hash_value["end_timestamp"]
-                    hash_key_list = []
-                    for data in value_list:
-                        hash_key = f"userid_{data}_queuename_{queue_name}"
-                        hash_key_list.append(hash_key)
-                    string_list = redis_init.hmget(hash_name, hash_key_list)
-                    hash_value_list = []
-                    if len(string_list) > 0:
-                        for item in string_list:
-                            hash_value_list.append(SevenHelper.json_loads(item))
-                    for i in range(len(value_list)):
-                        data = value_list[i]
-                        hash_value = [hash_value for hash_value in hash_value_list if hash_value["user_id"] == data]
-                        if len(hash_value) > 0:
-                            hash_value = hash_value[0]
-                        is_delete = False
-                        if hash_value:
-                            if first_is_process == True and i == 0:
-                                if now_timestamp > hash_value["end_timestamp"]:
-                                    is_delete = True
-                            elif first_is_process == True and i > 0:
-                                if now_timestamp > first_end_timestamp + (i * int(config.get_value("queue_confirm_time", 8))):
-                                    is_delete = True
-                            else:
-                                pop_timestamp = redis_init.hget(self._get_popdate_hash_name(app_id), zset_name)
-                                if pop_timestamp:
-                                    pop_timestamp = int(pop_timestamp)
-                                else:
-                                    pop_timestamp = hash_value["queue_timestamp"]
-                                if now_timestamp > pop_timestamp + ((i + 1) * int(config.get_value("queue_confirm_time", 8))):
-                                    is_delete = True
-
-                        if is_delete == True:
-                            self._set_last_pop_date(app_id, redis_init, zset_name)
-                            redis_init.hdel(hash_name, f"userid_{data}_queuename_{queue_name}")
-                            redis_init.zrem(zset_name, data)
-                            redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
-            except Exception as ex:
-                self.logger_error.error("【删除未操作的排队信息】" + traceback.format_exc())
-
-    @classmethod
-    def pop_by_user_id(self, app_id, user_id, progress_status=1):
-        """
-        :description: 指定用户退出参与的队列
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :param progress_status：0-全部 1-已排队 2-办理中
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if SevenHelper.is_continue_request(f"pop_by_user_id:{app_id}_{user_id}", 200) == False:
-            redis_init = SevenHelper.redis_init()
-            data = str(user_id)
-            hash_name = self._get_user_hash_name(app_id)
-            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-            for item in match_result:
-                hash_value = SevenHelper.json_loads(item[1])
-                if progress_status > 0 and hash_value["progress_status"] != progress_status:
-                    continue
-                self.pop(app_id, hash_value["queue_name"], data)
-
-    @classmethod
-    def query(self, app_id, queue_name, user_id):
-        """
-        :description: 查询某用户排队情况
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            #踢掉过期用户
-            self.pop_by_queue_name(app_id, queue_name)
-            #删除用户排队次数小于等于0的数据
-            redis_init.zremrangebyscore(self._get_user_zset_name(app_id), -10, 0)
-
-            #判断是否存在排队信息
-            score = redis_init.zscore(zset_name, data)
-            index = redis_init.zrank(zset_name, data)
-            if score and index is not None:
-                query_user = {}
-                query_user["queue_name"] = queue_name  #队列名称
-                query_user["queue_no"] = int(score)  #排队号
-                query_user["total_num"] = self._get_queue_num(app_id, queue_name)  #总排队人数
-                query_user["queue_index"] = int(index) + 1  #当前位置
-                query_user["before_num"] = query_user["queue_index"] - 1  #排在前面的人数
-                hash_value = redis_init.hget(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
-                hash_value = SevenHelper.json_loads(hash_value) if hash_value else {}
-                query_user["user_id"] = hash_value["user_id"] if hash_value.__contains__("user_id") else ''
-                query_user["user_nick"] = hash_value["user_nick"] if hash_value.__contains__("user_nick") else ''
-                query_user["avatar"] = hash_value["avatar"] if hash_value.__contains__("avatar") else ''
-                query_user["start_date"] = hash_value["start_date"] if hash_value.__contains__("start_date") else ''
-                query_user["end_date"] = hash_value["end_date"] if hash_value.__contains__("end_date") else ''
-                query_user["queue_date"] = hash_value["queue_date"] if hash_value.__contains__("queue_date") else ''
-                query_user["queue_timestamp"] = hash_value["queue_timestamp"] if hash_value.__contains__("queue_timestamp") else 0
-                query_user["progress_status"] = hash_value["progress_status"] if hash_value.__contains__("progress_status") else 0  #进度0未排队1已排队2办理中
-                query_user["info_json"] = hash_value["info_json"] if hash_value.__contains__("info_json") else {}
-                invoke_result_data.data = query_user
-                return invoke_result_data
-            else:
-                query_user = {}
-                query_user["queue_name"] = queue_name  #队列名称
-                query_user["progress_status"] = 0  #进度0未排队1已排队2办理中
-                query_user["before_num"] = self._get_queue_num(app_id, queue_name)  #排在前面的人数
-                invoke_result_data.data = query_user
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "未查到排队情况,请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【查询某用户排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "未查到排队情况,请先排队"
-            return invoke_result_data
-
-    @classmethod
-    def query_all(self, app_id, queue_name):
-        """
-        :description: 查询指定队列的所有用户信息
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        zset_name = self._get_zset_name(app_id, queue_name)
-        redis_init = SevenHelper.redis_init()
-        user_id_list = redis_init.zrange(zset_name,0,-1)
-        if len(user_id_list) <= 0:
-            return invoke_result_data
-        for user_id in user_id_list:
-            query_invoke_result_data = self.query(app_id, queue_name, user_id)
-            if query_invoke_result_data.success == True:
-                invoke_result_data.data.append(query_invoke_result_data.data)
-        return invoke_result_data
-
-    @classmethod
-    def muti_user_query(self, app_id, user_id):
-        """
-        :description: 批量查询某用户排队情况(只包含已排队的信息)
-        :param app_id：应用标识
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        try:
-            redis_init = SevenHelper.redis_init()
-            hash_name = self._get_user_hash_name(app_id)
-            data = str(user_id)
-            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-            for item in match_result:
-                hash_value = SevenHelper.json_loads(item[1])
-                query_invoke_result_data = self.query(app_id, hash_value["queue_name"], user_id)
-                if query_invoke_result_data.success == True:
-                    invoke_result_data.data.append(query_invoke_result_data.data)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【批量查询某用户排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "未查到排队情况,请先排队"
-            return invoke_result_data
-
-    @classmethod
-    def muti_queue_query(self, app_id, queue_name_list, user_id):
-        """
-        :description: 批量查询某用户排队情况(包含已排队和未排队的信息)
-        :param app_id：应用标识
-        :param queue_name_list：查询队列集合
-        :param user_id：用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data.data = []
-        try:
-            for queue_name in queue_name_list:
-                query_invoke_result_data = self.query(app_id, queue_name, user_id)
-                invoke_result_data.data.append(query_invoke_result_data.data)
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【批量查询排队情况】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "未查到排队情况"
-            return invoke_result_data
-
-    @classmethod
-    def update_time(self, app_id, queue_name, user_id, operate_time=0):
-        """
-        :description: 更新可操作时间，用于操作倒计时，时间到则踢出队列
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :param operate_time：增加的操作时间，单位秒
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            score = redis_init.zscore(zset_name, data)
-            if score and operate_time > 0:
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                hash_value = redis_init.hget(hash_name, hash_key)
-                if not hash_value:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "更新可操作时间失败"
-                    return invoke_result_data
-                hash_value = SevenHelper.json_loads(hash_value)
-                if hash_value["progress_status"] != 2:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "未签到,不能更新可操作时间"
-                    return invoke_result_data
-                end_timestamp = TimeHelper.get_now_timestamp() + int(operate_time)
-                hash_value["end_timestamp"] = end_timestamp
-                hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
-                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【更新可操作时间】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "更新可操作时间失败"
-            return invoke_result_data
-
-    @classmethod
-    def sign(self, app_id, queue_name, user_id, pop_other_queue=True):
-        """
-        :description: 签到操作（证明排队的人做出应答，开始办理业务，更新开始操作时间）
-        :param app_id：应用标识
-        :param queue_name：队列名称
-        :param user_id：用户标识
-        :param pop_other_queue：是否退出其他正在排队的队列，True是False否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            redis_init = SevenHelper.redis_init()
-            zset_name = self._get_zset_name(app_id, queue_name)
-            data = str(user_id)
-            #判断是否存在排队信息
-            score = redis_init.zscore(zset_name, data)
-            if score:
-                queue_index = int(redis_init.zrank(zset_name, data)) + 1  #当前位置
-                if queue_index != 1:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "前面还有人在排队,请耐心等待"
-                    return invoke_result_data
-                start_timestamp = TimeHelper.get_now_timestamp()
-                end_timestamp = start_timestamp + int(config.get_value("queue_operate_time", 300))  #操作时间，单位秒
-                hash_name = self._get_user_hash_name(app_id)
-                hash_key = f"userid_{data}_queuename_{queue_name}"
-                hash_value = redis_init.hget(hash_name, hash_key)
-                if not hash_value:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "未查到排队情况,请先排队"
-                    return invoke_result_data
-                hash_value = SevenHelper.json_loads(hash_value)
-                if hash_value["progress_status"] == 2:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "已签到,不能重复签到"
-                    return invoke_result_data
-
-                hash_value["start_timestamp"] = start_timestamp
-                hash_value["end_timestamp"] = end_timestamp
-                hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
-                hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
-                hash_value["progress_status"] = 2
-                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
-                if pop_other_queue == True:
-                    #踢掉在其他队列中的排队
-                    match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
-                    for item in match_result:
-                        hash_value = SevenHelper.json_loads(item[1])
-                        if hash_value["queue_name"] == queue_name:
-                            continue
-                        self.pop(app_id, hash_value["queue_name"], data)
-                invoke_result_data.data = hash_value
-                return invoke_result_data
-            else:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "未查到排队情况,请先排队"
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【签到操作】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "未查到排队情况,请先排队"
-            return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-30 09:22:51
+@LastEditTime: 2023-07-19 18:55:04
+@LastEditors: HuangJianYi
+@Description: 排队系统帮助类
+"""
+from seven_framework import *
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.libs.common import *
+
+
+class QueueUpHelper:
+    """
+    :description: 排队系统帮助类 提供获取小程序总排队人数、获取用户当前排队数、获取用户正在办理中的队列信息、加入排队、退出排队、查询单个排队情况、批量查询某用户排队情况(只包含已排队的信息)、批量查询某用户排队情况(包含已排队和未排队的信息)、更新可操作时间、签到等功能；
+    踢人规则1：第一个在办理中，第二个用户的过期时间=第一个结束时间+8*1，第三个=第一个结束时间+8*2，以此类推；第一个没在办理中，第一个过期时间是8*1，第二个是8*2，第三个是8*3，以此类推；
+    踢人规则2：如果都没有正在办理中，那么取上次办理人退出的时间作为排在第一位人员的开始时间，进行倒计时，没有上次办理人退出时间的话，则取当前第一位人员的入队时间进行倒计时；
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+    logger_info = Logger.get_logger_by_name("log_info")
+
+    @classmethod
+    def _get_zset_name(self, app_id, queue_name):
+        """
+        :description: 获取排行集合名称，集合用于排行榜，排第一的优先操作
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = "queueup_zset"
+        if app_id:
+            zset_name += "_" + str(app_id)
+        if queue_name:
+            zset_name += ":" + str(queue_name)
+        return zset_name
+
+    @classmethod
+    def _get_count_name(self, app_id, queue_name):
+        """
+        :description: 获取排队号计数名称
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        count_name = "queueup_count"
+        if app_id:
+            count_name += "_" + str(app_id)
+        if queue_name:
+            count_name += ":" + str(SevenHelper.get_now_day_int()) + "_" + str(queue_name)
+        return count_name
+
+    @classmethod
+    def _get_user_hash_name(self, app_id):
+        """
+        :description: 获取用户关联队列名称
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = "queueup_user_list"
+        if app_id:
+            hash_name += "_" + str(app_id)
+        return hash_name
+
+    @classmethod
+    def _get_user_zset_name(self, app_id):
+        """
+        :description: 用户在小程序内的排队次数信息
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = "queueup_zset_user"
+        if app_id:
+            zset_name += "_" + str(app_id)
+        return zset_name
+
+    @classmethod
+    def _get_popdate_hash_name(self, app_id):
+        """
+        :description: 办理中的用户退出队列的时间列表名称
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = "queueup_popdate_list"
+        if app_id:
+            hash_name += "_" + str(app_id)
+        return hash_name
+
+    @classmethod
+    def _get_queue_no(self, app_id, queue_name):
+        """
+        :description: 获取排队号
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        count_name = self._get_count_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        queue_no = redis_init.incr(count_name, 1)
+        redis_init.expire(count_name, 24 * 3600)
+        return queue_no
+
+    @classmethod
+    def _get_queue_num(self, app_id, queue_name):
+        """
+        :description: 获取当前排队人数
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        zset_name = self._get_zset_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zcard(zset_name)
+
+    @classmethod
+    def _get_app_user_num(self, app_id):
+        """
+        :description: 获取小程序总排队人数
+        :param app_id：应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        user_zset_name = self._get_user_zset_name(app_id)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zcount(user_zset_name, 1, 1000000000000)
+
+    @classmethod
+    def get_user_queue_num(self, app_id, user_id):
+        """
+        :description: 获取用户当前排队数
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        user_zset_name = self._get_user_zset_name(app_id)
+        redis_init = SevenHelper.redis_init()
+        return redis_init.zscore(user_zset_name, str(user_id))
+
+    @classmethod
+    def get_process_user_queue(self, app_id, user_id):
+        """
+        :description: 获取用户正在办理中的队列信息
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 队列信息，没有返回None
+        :last_editors: HuangJianYi
+        """
+        process_queue = None
+        invoke_result_data = self.muti_user_query(app_id, user_id)
+        if invoke_result_data.success == False:
+            return process_queue
+        else:
+            for item in invoke_result_data.data:
+                if item["progress_status"] == 2:
+                    process_queue = item
+                    break
+            return process_queue
+
+    @classmethod
+    def queue(self, app_id, queue_name, user_id, user_nick="", avatar="", queue_length=10, app_limit_user_num=500, info_dict={}, limit_user_queue_num=0):
+        """
+        :description: 加入排队
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id 用户标识
+        :param user_nick 用户昵称
+        :param avatar 头像
+        :param queue_length：队列的长度
+        :param app_limit_user_num：小程序内总排队人数上限
+        :param info_dict：信息字典,用于存储业务端需要的数据
+        :param limit_user_queue_num：限制用户可以加入的队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            acquire_lock_name = f"queueup_queue"
+            if app_id:
+                acquire_lock_name += "_" + str(app_id)
+            acquire_lock_name += ":" + str(queue_name)
+
+            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+            if acquire_lock_status == False:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "acquire_lock"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+            redis_init = SevenHelper.redis_init()
+            if app_limit_user_num > 0 and self._get_app_user_num(app_id) >= app_limit_user_num:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "total_limit"
+                invoke_result_data.error_message = "抱歉~当前活动排队人数过多，请稍后再试"
+                return invoke_result_data
+            if limit_user_queue_num > 0 and QueueUpHelper.get_user_queue_num(app_id, user_id) >= limit_user_queue_num:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "user_limit"
+                invoke_result_data.error_message = "抱歉~当前可排队列已达上限，请稍后再试"
+                return invoke_result_data
+
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            expire_time = 7 * 24 * 3600
+            if not redis_init.zscore(zset_name, data):
+                if self._get_queue_num(app_id, queue_name) >= queue_length:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "queue_limit"
+                    invoke_result_data.error_message = "排队失败,当前排队人数已达上限"
+                    return invoke_result_data
+                queue_no = int(str(SevenHelper.get_now_day_int()) + str(self._get_queue_no(app_id, queue_name)).zfill(4))
+                redis_init.zadd(zset_name, {data: queue_no})
+                redis_init.expire(zset_name, expire_time)
+
+                user_zset_name = self._get_user_zset_name(app_id)
+                redis_init.zincrby(user_zset_name, 1, data)
+                redis_init.expire(user_zset_name, expire_time)
+
+                start_timestamp = TimeHelper.get_now_timestamp()
+
+                hash_value = {}
+                hash_value["queue_name"] = queue_name  #排队名称
+                hash_value["queue_no"] = queue_no  #排队号
+                hash_value["user_id"] = data  #用户标识
+                hash_value["user_nick"] = user_nick  #用户昵称
+                hash_value["avatar"] = avatar  #头像
+                hash_value["progress_status"] = 1  #进度0未排队1已排队2办理中
+                hash_value["queue_timestamp"] = start_timestamp  #入队时间搓
+                hash_value["queue_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)  #入队时间
+                hash_value["info_json"] = info_dict
+
+                queue_index = int(redis_init.zrank(zset_name, data)) + 1
+                if queue_index == 1:
+                    redis_init.hdel(self._get_popdate_hash_name(app_id), zset_name)
+                #添加排队信息
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                redis_init.hsetnx(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+                redis_init.expire(hash_name, expire_time)
+
+                result_data = {}
+                result_data["queue_no"] = hash_value["queue_no"]  #排队号
+                result_data["queue_num"] = self._get_queue_num(app_id, queue_name)  #当前排队人数
+                result_data["queue_index"] = queue_index  #当前位置
+                result_data["before_num"] = queue_index - 1  #排在前面的人数
+                invoke_result_data.data = result_data
+
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+            else:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您已在队列中，请勿重复排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【加入排队】" + traceback.format_exc())
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，加入队列失败，请稍后再试"
+            return invoke_result_data
+
+    @classmethod
+    def _set_last_pop_date(self,app_id, redis_init, hash_key):
+        """
+        :description: 设置办理中的用户退出队列的时间
+        :param app_id：应用标识
+        :param redis_init：redis_init
+        :param hash_key：hash_key
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        hash_name = self._get_popdate_hash_name(app_id)
+        redis_init.hset(hash_name, hash_key, str(TimeHelper.get_now_timestamp()))
+        redis_init.expire(hash_name, 7 * 24 * 3600)
+
+    @classmethod
+    def pop(self, app_id, queue_name, user_id):
+        """
+        :description: 退出排队
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id 用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            cache_key = f"queueup_pop"
+            if app_id:
+                cache_key += "_" + str(app_id)
+            cache_key += ":" + str(queue_name) + "_" + str(user_id)
+            if SevenHelper.is_continue_request(cache_key, expire=1 * 1000) == True:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,请1秒后再试"
+                return invoke_result_data
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            redis_init = SevenHelper.redis_init()
+            if redis_init.zscore(zset_name, data):
+                if int(redis_init.zrank(zset_name, data)) + 1 == 1:
+                    self._set_last_pop_date(app_id,redis_init, zset_name)
+                redis_init.zrem(zset_name, data)
+                redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
+                redis_init.hdel(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
+                return invoke_result_data
+            else:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "未查到该用户的排队情况,请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【退出排队】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退出排队失败"
+            return invoke_result_data
+
+    @classmethod
+    def pop_by_queue_name(self, app_id, queue_name):
+        """
+        :description: 将过期用户从队列中退出
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if SevenHelper.is_continue_request(f"pop_by_queue_name:{app_id}_{queue_name}", 200) == False:
+            try:
+                redis_init = SevenHelper.redis_init()
+                zset_name = self._get_zset_name(app_id, queue_name)
+                hash_name = self._get_user_hash_name(app_id)
+                value_list = redis_init.zrange(zset_name, 0, 1000)
+                if len(value_list) > 0:
+                    now_timestamp = TimeHelper.get_now_timestamp()
+                    first_is_process = False
+                    first_end_timestamp = 0
+                    first_hash_key = f"userid_{value_list[0]}_queuename_{queue_name}"
+                    first_hash_value = redis_init.hget(hash_name, first_hash_key)
+                    if first_hash_value:
+                        first_hash_value = SevenHelper.json_loads(first_hash_value)
+                        if first_hash_value["progress_status"] == 2:
+                            first_is_process = True
+                            first_end_timestamp = first_hash_value["end_timestamp"]
+                    hash_key_list = []
+                    for data in value_list:
+                        hash_key = f"userid_{data}_queuename_{queue_name}"
+                        hash_key_list.append(hash_key)
+                    string_list = redis_init.hmget(hash_name, hash_key_list)
+                    hash_value_list = []
+                    if len(string_list) > 0:
+                        for item in string_list:
+                            value = SevenHelper.json_loads(item)
+                            if value:
+                                hash_value_list.append(value)
+                    for i in range(len(value_list)):
+                        data = value_list[i]
+                        hash_value = [hash_value for hash_value in hash_value_list if hash_value["user_id"] == data]
+                        if len(hash_value) > 0:
+                            hash_value = hash_value[0]
+                        is_delete = False
+                        if hash_value:
+                            if first_is_process == True and i == 0:
+                                if now_timestamp > hash_value["end_timestamp"]:
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户1】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": hash_value["end_timestamp"]}))
+                            elif first_is_process == True and i > 0:
+                                if now_timestamp > first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8))):
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户2】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": first_end_timestamp + (i * int(share_config.get_value("queue_confirm_time", 8)))}))
+                            else:
+                                pop_timestamp = redis_init.hget(self._get_popdate_hash_name(app_id), zset_name)
+                                if pop_timestamp:
+                                    pop_timestamp = int(pop_timestamp)
+                                else:
+                                    pop_timestamp = hash_value["queue_timestamp"]
+                                if now_timestamp > pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8))):
+                                    is_delete = True
+                                    self.logger_info.info("【踢掉办理用户3】" + SevenHelper.json_dumps({"zset_name": zset_name, "first_hash_value": first_hash_value, "user_id": data, "now_timestamp": now_timestamp, "pop_timestamp": pop_timestamp + ((i + 1) * int(share_config.get_value("queue_confirm_time", 8)))}))
+
+                        if is_delete == True:
+                            self._set_last_pop_date(app_id, redis_init, zset_name)
+                            redis_init.hdel(hash_name, f"userid_{data}_queuename_{queue_name}")
+                            redis_init.zrem(zset_name, data)
+                            redis_init.zincrby(self._get_user_zset_name(app_id), -1, data)
+            except Exception as ex:
+                self.logger_error.error("【删除未操作的排队信息】" + traceback.format_exc())
+
+    @classmethod
+    def pop_by_user_id(self, app_id, user_id, progress_status=1):
+        """
+        :description: 指定用户退出参与的队列
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :param progress_status：0-全部 1-已排队 2-办理中
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if SevenHelper.is_continue_request(f"pop_by_user_id:{app_id}_{user_id}", 200) == False:
+            redis_init = SevenHelper.redis_init()
+            data = str(user_id)
+            hash_name = self._get_user_hash_name(app_id)
+            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+            for item in match_result:
+                hash_value = SevenHelper.json_loads(item[1])
+                if progress_status > 0 and hash_value["progress_status"] != progress_status:
+                    continue
+                self.pop(app_id, hash_value["queue_name"], data)
+
+    @classmethod
+    def query(self, app_id, queue_name, user_id):
+        """
+        :description: 查询某用户排队情况
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            #踢掉过期用户
+            self.pop_by_queue_name(app_id, queue_name)
+            #删除用户排队次数小于等于0的数据
+            redis_init.zremrangebyscore(self._get_user_zset_name(app_id), -10, 0)
+
+            #判断是否存在排队信息
+            score = redis_init.zscore(zset_name, data)
+            index = redis_init.zrank(zset_name, data)
+            if score and index is not None:
+                query_user = {}
+                query_user["queue_name"] = queue_name  #队列名称
+                query_user["queue_no"] = int(score)  #排队号
+                query_user["total_num"] = self._get_queue_num(app_id, queue_name)  #总排队人数
+                query_user["queue_index"] = int(index) + 1  #当前位置
+                query_user["before_num"] = query_user["queue_index"] - 1  #排在前面的人数
+                hash_value = redis_init.hget(self._get_user_hash_name(app_id), f"userid_{data}_queuename_{queue_name}")
+                hash_value = SevenHelper.json_loads(hash_value) if hash_value else {}
+                query_user["user_id"] = hash_value["user_id"] if hash_value.__contains__("user_id") else ''
+                query_user["user_nick"] = hash_value["user_nick"] if hash_value.__contains__("user_nick") else ''
+                query_user["avatar"] = hash_value["avatar"] if hash_value.__contains__("avatar") else ''
+                query_user["start_date"] = hash_value["start_date"] if hash_value.__contains__("start_date") else ''
+                query_user["end_date"] = hash_value["end_date"] if hash_value.__contains__("end_date") else ''
+                query_user["queue_date"] = hash_value["queue_date"] if hash_value.__contains__("queue_date") else ''
+                query_user["queue_timestamp"] = hash_value["queue_timestamp"] if hash_value.__contains__("queue_timestamp") else 0
+                query_user["progress_status"] = hash_value["progress_status"] if hash_value.__contains__("progress_status") else 0  #进度0未排队1已排队2办理中
+                query_user["info_json"] = hash_value["info_json"] if hash_value.__contains__("info_json") else {}
+                invoke_result_data.data = query_user
+                return invoke_result_data
+            else:
+                query_user = {}
+                query_user["queue_name"] = queue_name  #队列名称
+                query_user["progress_status"] = 0  #进度0未排队1已排队2办理中
+                query_user["before_num"] = self._get_queue_num(app_id, queue_name)  #排在前面的人数
+                invoke_result_data.data = query_user
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【查询某用户排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
+
+    @classmethod
+    def query_all(self, app_id, queue_name):
+        """
+        :description: 查询指定队列的所有用户信息
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        zset_name = self._get_zset_name(app_id, queue_name)
+        redis_init = SevenHelper.redis_init()
+        user_id_list = redis_init.zrange(zset_name,0,-1)
+        if len(user_id_list) <= 0:
+            return invoke_result_data
+        for user_id in user_id_list:
+            query_invoke_result_data = self.query(app_id, queue_name, user_id)
+            if query_invoke_result_data.success == True:
+                invoke_result_data.data.append(query_invoke_result_data.data)
+        return invoke_result_data
+
+    @classmethod
+    def muti_user_query(self, app_id, user_id):
+        """
+        :description: 批量查询某用户排队情况(只包含已排队的信息)
+        :param app_id：应用标识
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        try:
+            redis_init = SevenHelper.redis_init()
+            hash_name = self._get_user_hash_name(app_id)
+            data = str(user_id)
+            match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+            for item in match_result:
+                hash_value = SevenHelper.json_loads(item[1])
+                query_invoke_result_data = self.query(app_id, hash_value["queue_name"], user_id)
+                if query_invoke_result_data.success == True:
+                    invoke_result_data.data.append(query_invoke_result_data.data)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【批量查询某用户排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
+
+    @classmethod
+    def muti_queue_query(self, app_id, queue_name_list, user_id):
+        """
+        :description: 批量查询某用户排队情况(包含已排队和未排队的信息)
+        :param app_id：应用标识
+        :param queue_name_list：查询队列集合
+        :param user_id：用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data.data = []
+        try:
+            for queue_name in queue_name_list:
+                query_invoke_result_data = self.query(app_id, queue_name, user_id)
+                invoke_result_data.data.append(query_invoke_result_data.data)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【批量查询排队情况】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "未查到排队情况"
+            return invoke_result_data
+
+    @classmethod
+    def update_time(self, app_id, queue_name, user_id, operate_time=0,is_reset=False):
+        """
+        :description: 更新可操作时间，用于操作倒计时，时间到则踢出队列
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :param operate_time：增加的操作时间，单位秒
+        :param is_reset：是否重置开始时间和结束时间
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            score = redis_init.zscore(zset_name, data)
+            if score and operate_time > 0:
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                hash_value = redis_init.hget(hash_name, hash_key)
+                if not hash_value:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "更新可操作时间失败"
+                    return invoke_result_data
+                hash_value = SevenHelper.json_loads(hash_value)
+                if hash_value["progress_status"] != 2:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "未签到,不能更新可操作时间"
+                    return invoke_result_data
+                if is_reset == True:
+                    start_timestamp = TimeHelper.get_now_timestamp()
+                    hash_value["start_timestamp"] = start_timestamp
+                    hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
+                    end_timestamp = start_timestamp + int(operate_time)
+                    hash_value["end_timestamp"] = end_timestamp
+                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                else:
+                    queue_operate_total_time = int(share_config.get_value("queue_operate_total_time", 0))
+                    now_date = TimeHelper.get_now_datetime()
+                    expire_date = TimeHelper.timestamp_to_datetime(hash_value["end_timestamp"])
+                    if expire_date > now_date and queue_operate_total_time > 0:
+                        remain_time = TimeHelper.difference_seconds(expire_date, now_date)
+                        operate_time = queue_operate_total_time - remain_time if remain_time + operate_time > queue_operate_total_time else operate_time
+                    end_timestamp = hash_value["end_timestamp"] + int(operate_time)
+                    hash_value["end_timestamp"] = end_timestamp
+                    hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【更新可操作时间】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "更新可操作时间失败"
+            return invoke_result_data
+
+    @classmethod
+    def sign(self, app_id, queue_name, user_id, pop_other_queue=True):
+        """
+        :description: 签到操作（证明排队的人做出应答，开始办理业务，更新开始操作时间）
+        :param app_id：应用标识
+        :param queue_name：队列名称
+        :param user_id：用户标识
+        :param pop_other_queue：是否退出其他正在排队的队列，True是False否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            acquire_lock_name = f"queueup_sign"
+            if app_id:
+                acquire_lock_name += "_" + str(app_id)
+            acquire_lock_name += ":" + str(queue_name)
+            acquire_lock_name += ":" + str(user_id)
+            acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+            if acquire_lock_status == False:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "acquire_lock"
+                invoke_result_data.error_message = "系统繁忙,请稍后再试"
+                return invoke_result_data
+
+            redis_init = SevenHelper.redis_init()
+            zset_name = self._get_zset_name(app_id, queue_name)
+            data = str(user_id)
+            #判断是否存在排队信息
+            score = redis_init.zscore(zset_name, data)
+            if score:
+                queue_index = int(redis_init.zrank(zset_name, data)) + 1  #当前位置
+                if queue_index != 1:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "前面还有人在队列中，请耐心等待"
+                    return invoke_result_data
+                start_timestamp = TimeHelper.get_now_timestamp()
+                end_timestamp = start_timestamp + int(share_config.get_value("queue_operate_time", 300))  #操作时间，单位秒
+                hash_name = self._get_user_hash_name(app_id)
+                hash_key = f"userid_{data}_queuename_{queue_name}"
+                hash_value = redis_init.hget(hash_name, hash_key)
+                if not hash_value:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                    return invoke_result_data
+                hash_value = SevenHelper.json_loads(hash_value)
+                if hash_value["progress_status"] == 2:
+                    SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "您已在队列中，请勿重复排队"
+                    return invoke_result_data
+
+                hash_value["start_timestamp"] = start_timestamp
+                hash_value["end_timestamp"] = end_timestamp
+                hash_value["start_date"] = TimeHelper.timestamp_to_format_time(start_timestamp)
+                hash_value["end_date"] = TimeHelper.timestamp_to_format_time(end_timestamp)
+                hash_value["progress_status"] = 2
+                redis_init.hset(hash_name, hash_key, SevenHelper.json_dumps(hash_value))
+                if pop_other_queue == True:
+                    #踢掉在其他队列中的排队
+                    match_result = redis_init.hscan_iter(hash_name, match=f'userid_{data}_*')
+                    for item in match_result:
+                        hash_value = SevenHelper.json_loads(item[1])
+                        if hash_value["queue_name"] == queue_name:
+                            continue
+                        self.pop(app_id, hash_value["queue_name"], data)
+                invoke_result_data.data = hash_value
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+            else:
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "您当前不在队列中，请先排队"
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【签到操作】" + traceback.format_exc())
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "您当前不在队列中，请先排队"
+            return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/libs/customize/tiktok_helper.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/libs/customize/tiktok_helper.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,656 +1,667 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-01-14 10:44:07
-@LastEditTime: 2021-10-12 17:52:14
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import requests
-import json
-import hashlib
-from Crypto.Cipher import AES
-import base64
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.seven_model import InvokeResultData
-
-
-class TikTokHelper:
-    """
-    :description: 抖音帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    @classmethod
-    def code2_session(self, code="", anonymous_code="", app_id="", app_secret=""):
-        """
-        :description:获取open_id、session_key等信息
-        :param code: 登录票据,非匿名需要 code
-        :param anonymous_code: 非匿名下的 anonymous_code 用于数据同步，匿名需要 anonymous_code
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else config.get_value("app_id")
-        app_secret = app_secret if app_secret else config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        redis_key = f"{app_id}_tiktok_login_code:{code}"
-        redis_init = SevenHelper.redis_init()
-        code2_session_dict = redis_init.get(redis_key)
-        if code2_session_dict:
-            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
-            invoke_result_data.data = code2_session_dict
-            return invoke_result_data
-        param = {
-            'code': code,  # 用户点击按钮跳转到抖音授权页, 抖音处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
-            'appid': app_id,
-            'secret': app_secret,
-            'anonymous_code': anonymous_code,
-        }
-        response = None
-        try:
-            requset_url = 'https://developer.toutiao.com/api/apps/jscode2session'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=SevenHelper.json_dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            open_id = response_data["data"]['openid']
-            session_key = response_data["data"]['session_key']
-            redis_init.set(redis_key, SevenHelper.json_dumps(response_data["data"]), ex=60 * 60)
-            redis_init.set(f"{app_id}_tiktok_sessionkey:{str(open_id)}", session_key, ex=60 * 60)
-            invoke_result_data.data = response_data
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【code2_session】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def get_access_token(self, grant_type="client_credential", app_id="", app_secret=""):
-        """
-        :description:access_token 是小程序的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。
-        :param grant_type: 获取access_token 时值为 client_credential
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else config.get_value("app_id")
-        app_secret = app_secret if app_secret else config.get_value("app_secret")
-
-        invoke_result_data = InvokeResultData()
-        param = {
-            'appid': app_id,
-            'secret': app_secret,
-            'grant_type': grant_type,
-        }
-        response = None
-        try:
-            requset_url = 'https://developer.toutiao.com/api/apps/token'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=SevenHelper.json_dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            invoke_result_data.data = response_data["data"]
-            return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【get_access_token】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-    @classmethod
-    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
-        """
-        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
-        :param open_id：open_id
-        :param code：登录票据
-        :param encrypted_Data：加密数据,抖音返回加密参数
-        :param iv：抖音返回参数
-        :param app_id: app_id
-        :param app_secret: app_secret
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else config.get_value("app_id")
-        app_secret = app_secret if app_secret else config.get_value("app_secret")
-
-        data = {}
-        if code:
-            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
-            if code2_session_dict:
-                open_id = code2_session_dict["openid"]
-        try:
-            session_key = SevenHelper.redis_init().get(f"{app_id}_tiktok_sessionkey:{str(open_id)}")
-            data_crypt = TikTokBizDataCrypt(app_id, session_key)
-            data = data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
-        except Exception as ex:
-            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
-        """
-        :description:解析加密数据
-        :param session_key: session_key调用登录接口获得
-        :param encrypted_Data：加密数据,抖音返回加密参数
-        :param iv：抖音返回参数
-        :param app_id: 抖音小程序标识
-        :return: 解密后的数据，用户信息或者手机号信息
-        :last_editors: HuangJianYi
-        """
-        app_id = app_id if app_id else config.get_value("app_id")
-
-        data = {}
-        try:
-            data_crypt = TikTokBizDataCrypt(app_id, session_key)
-            #data中是解密的信息
-            data = data_crypt.decrypt(encrypted_Data, iv)
-        except Exception as ex:
-            self.logger_error.error("【decrypt_data】" + traceback.format_exc())
-        return data
-
-    @classmethod
-    def create_qr_code(self, access_token, appname="douyin", path="", width=430, line_color={ "r": 0, "g": 0, "b": 0 }, background={ "r": 255, "g": 255, "b": 255 }):
-        """
-        :description:获取小程序/小游戏的二维码。该二维码可通过任意 app 扫码打开，能跳转到开发者指定的对应字节系 app 内拉起小程序/小游戏， 并传入开发者指定的参数。通过该接口生成的二维码，永久有效，暂无数量限制。
-        :param access_token: 服务端 API 调用标识
-        :param appname: 打开二维码的字节系 app 名称
-        :param path: 小程序/小游戏启动参数，小程序则格式为 encode({path}?{query})，小游戏则格式为 JSON 字符串，默认为空
-        :param width: 二维码宽度，单位 px，最小 280px，最大 1280px，默认为 430px
-        :param line_color: 二维码线条颜色，默认为黑色
-        :param background: 二维码背景颜色，默认为白色
-        :return: 图片二进制 数据类型Array<byte>
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        param = {
-                "appname": appname,
-                "access_token": access_token,
-                "path": path,
-                "width": width,
-                "line_color": line_color,
-                "background": background
-                }
-        response = ""
-        try:
-            requset_url = 'https://developer.toutiao.com/api/apps/token'
-            headers = {"Content-type": "application/json"}
-            response = requests.post(requset_url, headers=headers, data=SevenHelper.json_dumps(param))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data["errcode"] != 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = response_data["err_no"]
-                invoke_result_data.error_message = response_data["err_tips"]
-                return invoke_result_data
-            return response_data
-        except Exception as ex:
-            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = traceback.format_exc()
-            return invoke_result_data
-
-
-class TikTokPayRequest(object):
-    """
-    :description: 抖音支付请求类,配置文件内容 "tiktok_pay": {"api_key": "","cp_extra": "","token": "","salt": "","pay_notify_url": ""}
-    """
-    # =======【基本信息设置】=====================================
-    # 抖音公众号身份的唯一标识。审核通过后，在抖音发送的邮件中查看
-    app_id = ""
-    # API密钥，需要在商户后台设置
-    api_key = ""
-    #开发者自定义字段，回调原样回传
-    cp_extra = ""
-    #担保交易Token（令牌）
-    token = ""
-    #担保交易密钥
-    salt = ""
-    # 日志
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, app_id="", api_key="", cp_extra="", token="", salt=""):
-        """
-        :description: 初始化
-        :last_editors: HuangJianYi
-        """
-        pay_config = config.get_value("tiktok_pay")
-        self.app_id = app_id if app_id else config.get_value("app_id")
-        self.api_key = api_key if api_key else pay_config["api_key"]
-        self.cp_extra = cp_extra if cp_extra else pay_config["cp_extra"]
-        self.token = token if token else pay_config["token"]
-        self.salt = salt if salt else pay_config["salt"]
-
-    def create_order(self, pay_order_no, notify_url, total_amount=1, subject="", body="", valid_time=900, thirdparty_id="", disable_msg=None, msg_page="", store_uid=""):
-        """
-        :description: 服务端创建预下单
-        :param pay_order_no：商户订单号(支付单号)开发者服务端的唯一订单号
-        :param notify_url：支付结果异步通知地址
-        :param total_amount:支付价格; 接口中参数支付金额单位为[分]|默认 1
-        :param subject: 商品描述; 长度限制 128 字节，不超过 42 个汉字 |默认 自己约定一个比如 “福小宠商品”*|
-        :param body:商品详情|默认 自己约定一个比如 “福小宠商品”
-        :param valid_time:订单过期时间(秒); 最小 15 分钟，最大两天|默认 900
-        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
-        :param msg_page:担保支付消息跳转页|默认传空字符串
-        :param store_uid:多门店模式下必传,多门店模式下，门店 uid|默认传空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            data = {}
-            data['out_order_no'] = pay_order_no
-            data['cp_extra'] = self.cp_extra
-            data['notify_url'] = notify_url
-            data['total_amount'] = str(int(decimal.Decimal(str(total_amount)) * 100))
-            data['subject'] = subject
-            data['body'] = body
-            data['valid_time'] = valid_time
-            if disable_msg:
-                data['disable_msg'] = int(disable_msg)
-            if msg_page:
-                data['msg_page'] = msg_page
-            if store_uid:
-                data['store_uid'] = store_uid
-
-            sign = self._get_tt_sign(data)
-            # 如果有第三方平台服务商id:thirdparty_id字段请把他放入data的字典里面
-            data['sign'] = sign
-            data['app_id'] = self.app_id
-
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            redis_key = f"{self.app_id}_tiktok_order_id:{str(pay_order_no)}"
-            orderInfo = SevenHelper.redis_init().get(redis_key)
-            if orderInfo:
-                invoke_result_data.data = SevenHelper.json_loads(orderInfo)
-                return invoke_result_data
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_order"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            # err_no	number	    状态码 0-业务处理成功
-            # err_tips	string	    错误提示信息，常见错误处理可参考附录常见问题章节
-            # data	    orderInfo	拉起收银台的 orderInfo
-            # {"err_no": 2000, "err_tips": "单号记录不存在", "data": null}
-            if response_data['err_no'] == 0:
-                SevenHelper.redis_init().set(redis_key, SevenHelper.json_dumps(response_data['data']), ex=3600 * 1)
-                invoke_result_data.data = response_data['data']
-                return invoke_result_data
-            else:
-                self.logger_error.error(f"【{pay_order_no},创建预下单】" + response_data['err_tips'])
-                invoke_result_data.success = False
-                invoke_result_data.error_code="error"
-                invoke_result_data.error_message = response_data['err_tips']
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【创建预下单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code="error"
-            invoke_result_data.error_message = "创建预下单出现异常，请重试"
-            return invoke_result_data
-
-    def query_order(self, pay_order_no, thirdparty_id=""):
-        """
-        :description: 查询订单
-        :param pay_order_no：开发者侧的订单号, 不可重复
-        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_order_no'] = pay_order_no
-            sign = self._get_tt_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_order"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            # {"err_no": 2000, "err_tips": "单号记录不存在", "out_order_no": "", "order_id": "", "payment_info": null}
-            # payment_info 返回值结构如下：
-            # {
-            #     "total_fee": 1200,
-            #     "order_status": "PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时",
-            #     "pay_time": "支付时间",
-            #     "way": 1,
-            #     "channel_no": "渠道单号",
-            #     "channel_gateway_no": "渠道网关号"
-            # }
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-            else:
-                self.logger_error.error(f"【{pay_order_no},查询订单】" + response_data['err_tips'])
-                invoke_result_data.success = False
-                invoke_result_data.error_code="error"
-                invoke_result_data.error_message = response_data['err_tips']
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【查询订单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code="error"
-            invoke_result_data.error_message = "查询订单出现异常，请重试"
-            return invoke_result_data
-
-    def get_pay_status(self, pay_order_no, thirdparty_id=""):
-        """
-        :description: 查询订单状态
-        :param pay_order_no：开发者侧的订单号, 不可重复
-        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
-        :return: PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        invoke_result_data = self.query_order(pay_order_no, thirdparty_id)
-        if invoke_result_data.success == False:
-            return ""
-        else:
-            response_data = invoke_result_data.data
-            if response_data['payment_info']:
-                return response_data['payment_info']['order_status']
-            else:
-                return ""
-
-    def create_refund(self, refund_no, pay_order_no, notify_url, refund_amount=1, reason="", thirdparty_id="", disable_msg=None, msg_page="", all_settle=None):
-        """
-        :description: 服务端退款请求
-        :param refund_no:开发者侧的退款单号, 不可重复
-        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
-        :param notify_url:退款通知地址
-        :param refund_amount: 退款金额，单位[分]|默认 1
-        :param reason:退款理由，长度上限 100|默认 由开发者定 例如：“7天无理由退款”
-        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
-        :param msg_page:担保支付消息跳转页|默认传空字符串
-        :param all_settle:是否为分账后退款，1-分账后退款；0-分账前退款。分账后退款会扣减可提现金额，请保证余额充足*|默认传None
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_refund_no'] = refund_no
-            #cp_extra 开发者自定义字段，回调原样回传
-            data['cp_extra'] =  self.cp_extra
-            data['notify_url'] = notify_url
-            data['out_order_no'] = pay_order_no
-            data['refund_amount'] = str(int(decimal.Decimal(str(refund_amount)) * 100))
-            data['reason'] = reason
-            if disable_msg:
-                data['disable_msg'] = int(disable_msg)
-            if msg_page:
-                data['msg_page'] = msg_page
-            if all_settle:
-                data['all_settle'] = int(all_settle)
-
-            sign = self._get_tt_sign(data)
-            # 如果有第三方平台服务商 id :thirdparty_id字段请把他放入data.update的字典里面
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_refund"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-        except Exception as ex:
-            self.logger_error.error("【退款】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退款出现异常，请重试"
-            return invoke_result_data
-
-    def query_refund(self, refund_no="", thirdparty_id=""):
-        """
-        :desciption:退款查询
-        :param refund_no:开发者侧的退款单号, 不可重复
-        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_refund_no'] = refund_no
-            sign = self._get_tt_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_refund"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【退款查询】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "退款查询出现异常，请重试"
-            return invoke_result_data
-
-    def create_settle(self, pay_order_no="", settle_desc="", settle_params="", thirdparty_id=""):
-        """
-        :description:服务端结算请求
-        :param order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
-        :param settle_desc:结算描述 默认 自己约定一个比如 “福小宠商品结算”
-        :param settle_params:其他分账方信息，分账分配参数 SettleParameter 数组序列化后生成的 json 格式字符串
-        :param thirdparty_id：服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            #out_order_no 开发者服务端的唯一订单号
-            out_settle_no = SevenHelper.create_order_id()
-            #回调地址
-            notify_url = self.notify_url
-            cp_extra = self.cp_extra
-            # 在这里将分账信息存入数据库
-            data = {}
-            data['out_settle_no'] = out_settle_no
-            #cp_extra 开发者自定义字段，回调原样回传
-            data['cp_extra'] = cp_extra
-            data['notify_url'] = notify_url
-            data['out_order_no'] = pay_order_no
-            data['settle_desc'] = settle_desc
-            if settle_params:
-                data['settle_params'] = settle_params
-            sign = self._get_tt_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/settle"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【结算请求】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "结算请求出现异常，请重试"
-            return invoke_result_data
-
-    def query_settle(self, out_settle_no="", thirdparty_id=""):
-        """
-        :desciption:结算查询
-        :param out_settle_no:开发者侧的分账号, 不可重复
-        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        try:
-            app_id = self.app_id
-            data = {}
-            data['out_settle_no'] = out_settle_no
-            sign = self._get_tt_sign(data)
-            data['sign'] = sign
-            data['app_id'] = app_id
-            if thirdparty_id:
-                data['thirdparty_id'] = thirdparty_id
-
-            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_settle"
-            headers = {"Content-type": "application/json"}
-            response = requests.post(url, headers=headers, data=SevenHelper.json_dumps(data))
-            response_data = SevenHelper.json_loads(response.text)
-            if response_data['err_no'] == 0:
-                invoke_result_data.data = response_data
-                return invoke_result_data
-
-        except Exception as ex:
-            self.logger_error.error("【结算查询】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "结算查询出现异常，请重试"
-            return invoke_result_data
-
-    def _get_tt_sign(self, params):
-        """
-        :description: 获取头条请求sign
-        :param params: 参数字典
-        :return: sign
-        :last_editors: HuangJianYi
-        """
-        params_copy = copy.deepcopy(params)
-        for key, value in params_copy.items():
-            if isinstance(value, int):
-                params_copy[key] = str(value)
-        params_copy['salt'] = self.salt
-        # params_copy['salt'] = 'your_payment_salt'
-        params_list = sorted(list(params_copy.items()), key=lambda x: x[1])
-        params_str = ''.join(f"{v}&" for k, v in params_list)[:-1]
-        sign = hashlib.md5(params_str.encode('utf-8')).hexdigest()
-        return sign
-
-
-class TikTokReponse(object):
-    """
-    :description: 抖音支付响应类 根据支付/退款/分账等回调json内容，检测type字段判断是支付回调还是退款回调，type:payment 支付成功回调,refund退款成功回调,settle分账成功回调
-    """
-    logger_error = Logger.get_logger_by_name("log_error")
-
-    def __init__(self, data, token=""):
-        self.data = data  #data由json.loads(self.request.body)获得
-        pay_config = config.get_value("tiktok_pay")
-        self.token = token if token else pay_config["token"]
-
-    def get_data(self):
-        """
-        :description: 获取通知的数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return self.data
-
-    def check_sign(self):
-        """
-        :description: 校验签名
-        :return:
-        :last_editors: HuangJianYi
-        """
-        #计算服务端sign
-        service_signature = self._get_tt_callback_sign(self.data)
-        #验证成功,进行业务处理
-        log_msg = f'客户端签名:{self.data["msg_signature"]},服务端签名:{service_signature}'
-        # self.logger_error.error(log_msg)
-        if service_signature == self.data["msg_signature"]:
-            return True
-        else:
-            return False
-
-    def _get_tt_callback_sign(self, params):
-        """
-        :description: 获取头条回调sign
-        :param params: 参数字典
-        :return: sign
-        :last_editors: HuangJianYi
-        """
-        keys = ['type', 'msg_signature']
-        params_copy = {key: params[key] for key in params if key not in keys}
-        for key, value in params_copy.items():
-            if isinstance(value, int):
-                params_copy[key] = str(value)
-        params_copy['token'] = self.token
-        # params_copy['salt'] = 'your_payment_salt'
-        params_list = sorted(list(params_copy.items()), key=lambda x: x[1])
-        params_str = ''.join(f"{v}" for k, v in params_list)
-        sign = CryptoHelper().sha1_encrypt(params_str)
-        return sign
-
-    def convert_response_json(self, err_no=0, err_tips="success"):
-        """
-        :description: 获取通知的数据
-        :return:
-        :last_editors: HuangJianYi
-        """
-        return {}
-
-
-class TikTokBizDataCrypt:
-    def __init__(self, app_id, session_key):
-        self.app_id = app_id
-        self.session_key = session_key
-
-    def decrypt(self, encryptedData, iv):
-        """
-        :description: 解密
-        :param encryptedData: encryptedData
-        :param iv: iv
-        :return str
-        :last_editors: HuangJianYi
-        """
-        # base64 decode
-        session_key = base64.b64decode(self.session_key)
-        encryptedData = base64.b64decode(encryptedData)
-        iv = base64.b64decode(iv)
-        decrypted = {}
-        cipher = AES.new(session_key, AES.MODE_CBC, iv)
-        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
-        if result_data:
-            decrypted = SevenHelper.json_loads(result_data)
-        if decrypted:
-            if decrypted['watermark']['appid'] != self.app_id:
-                raise Exception('Invalid Buffer')
-
-        return decrypted
-
-    def _unpad(self, s):
-        return s[:-ord(s[len(s) - 1:])]
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-01-14 10:44:07
+@LastEditTime: 2023-02-10 09:59:17
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import requests
+import json
+import hashlib
+from Crypto.Cipher import AES
+import base64
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.seven_model import InvokeResultData
+
+
+class TikTokHelper:
+    """
+    :description: 抖音帮助类 1.临时登录凭证校验获取open_id、session_key  2.解析加密数据
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    @classmethod
+    def code2_session(self, code="", anonymous_code="", app_id="", app_secret=""):
+        """
+        :description:获取open_id、session_key等信息
+        :param code: 登录票据,非匿名需要 code
+        :param anonymous_code: 非匿名下的 anonymous_code 用于数据同步，匿名需要 anonymous_code
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        redis_key = f"{app_id}_tiktok_login_code:{code}"
+        redis_init = SevenHelper.redis_init()
+        code2_session_dict = redis_init.get(redis_key)
+        if code2_session_dict:
+            code2_session_dict = SevenHelper.json_loads(code2_session_dict)
+            invoke_result_data.data = code2_session_dict
+            return invoke_result_data
+        param = {
+            'code': code,  # 用户点击按钮跳转到抖音授权页, 抖音处理完后重定向到redirect_uri, 并给我们加上code=xxx的参数, 这个code就是我们需要的
+            'appid': app_id,
+            'secret': app_secret,
+            'anonymous_code': anonymous_code,
+        }
+        response = None
+        try:
+            requset_url = 'https://developer.toutiao.com/api/apps/v2/jscode2session'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            open_id = response_data["data"]['openid']
+            session_key = response_data["data"]['session_key']
+            redis_init.set(redis_key, SevenHelper.json_dumps(response_data["data"]), ex=60 * 60)
+            redis_init.set(f"{app_id}_tiktok_sessionkey:{str(open_id)}", session_key, ex=60 * 60)
+            invoke_result_data.data = response_data["data"]
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【code2_session】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def get_access_token(self, grant_type="client_credential", app_id="", app_secret=""):
+        """
+        :description:access_token 是小程序的全局唯一调用凭据，开发者调用小程序支付时需要使用 access_token。access_token 的有效期为 2 个小时，需要定时刷新 access_token，重复获取会导致之前一次获取的 access_token 的有效期缩短为 5 分钟。
+        :param grant_type: 获取access_token 时值为 client_credential
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        invoke_result_data = InvokeResultData()
+        param = {
+            'appid': app_id,
+            'secret': app_secret,
+            'grant_type': grant_type,
+        }
+        response = None
+        redis_init = SevenHelper.redis_init(config_dict=share_config.get_value("platform_redis"))
+        redis_key = f"tiktok_access_token:{str(app_id)}"
+        try:
+            access_token = redis_init.get(redis_key)
+            if access_token:
+                invoke_result_data.data = access_token
+                return invoke_result_data
+            requset_url = 'https://developer.toutiao.com/api/apps/token'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data.__contains__("err_no") and response_data["err_no"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            invoke_result_data.data = str(response_data["access_token"])
+            redis_init.set(redis_key, invoke_result_data.data, ex=3600)
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【get_access_token】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+    @classmethod
+    def decrypt_data_by_code(self, open_id, code, encrypted_Data, iv, app_id="", app_secret=""):
+        """
+        :description:解析加密数据，客户端判断是否登录状态，如果登录只传open_id不传code，如果是登录过期,要传code重新获取session_key
+        :param open_id：open_id
+        :param code：登录票据
+        :param encrypted_Data：加密数据,抖音返回加密参数
+        :param iv：抖音返回参数
+        :param app_id: app_id
+        :param app_secret: app_secret
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+        app_secret = app_secret if app_secret else share_config.get_value("app_secret")
+
+        data = {}
+        if code:
+            code2_session_dict = self.code2_session(code=code, app_id=app_id, app_secret=app_secret)
+            if code2_session_dict:
+                open_id = code2_session_dict["openid"]
+        try:
+            session_key = SevenHelper.redis_init().get(f"{app_id}_tiktok_sessionkey:{str(open_id)}")
+            data_crypt = TikTokBizDataCrypt(app_id, session_key)
+            data = data_crypt.decrypt(encrypted_Data, iv)  #data中是解密的信息
+        except Exception as ex:
+            self.logger_error.error("【decrypt_data_by_code】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def decrypt_data(self, session_key, encrypted_Data, iv, app_id=""):
+        """
+        :description:解析加密数据
+        :param session_key: session_key调用登录接口获得
+        :param encrypted_Data：加密数据,抖音返回加密参数
+        :param iv：抖音返回参数
+        :param app_id: 抖音小程序标识
+        :return: 解密后的数据，用户信息或者手机号信息
+        :last_editors: HuangJianYi
+        """
+        app_id = app_id if app_id else share_config.get_value("app_id")
+
+        data = {}
+        try:
+            data_crypt = TikTokBizDataCrypt(app_id, session_key)
+            #data中是解密的信息
+            data = data_crypt.decrypt(encrypted_Data, iv)
+        except Exception as ex:
+            self.logger_error.error("【decrypt_data】" + traceback.format_exc())
+        return data
+
+    @classmethod
+    def create_qr_code(self, access_token, appname="douyin", path="", width=430, line_color={ "r": 0, "g": 0, "b": 0 }, background={ "r": 255, "g": 255, "b": 255 }):
+        """
+        :description:获取小程序/小游戏的二维码。该二维码可通过任意 app 扫码打开，能跳转到开发者指定的对应字节系 app 内拉起小程序/小游戏， 并传入开发者指定的参数。通过该接口生成的二维码，永久有效，暂无数量限制。
+        :param access_token: 服务端 API 调用标识
+        :param appname: 打开二维码的字节系 app 名称
+        :param path: 小程序/小游戏启动参数，小程序则格式为 encode({path}?{query})，小游戏则格式为 JSON 字符串，默认为空
+        :param width: 二维码宽度，单位 px，最小 280px，最大 1280px，默认为 430px
+        :param line_color: 二维码线条颜色，默认为黑色
+        :param background: 二维码背景颜色，默认为白色
+        :return: 图片二进制 数据类型Array<byte>
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        param = {
+                "appname": appname,
+                "access_token": access_token,
+                "path": path,
+                "width": width,
+                "line_color": line_color,
+                "background": background
+                }
+        response = ""
+        try:
+            requset_url = 'https://developer.toutiao.com/api/apps/token'
+            headers = {"Content-type": "application/json"}
+            response = requests.post(requset_url, headers=headers, data=json.dumps(param))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data["errcode"] != 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = response_data["err_no"]
+                invoke_result_data.error_message = response_data["err_tips"]
+                return invoke_result_data
+            else:
+                invoke_result_data.data = response_data.content
+            return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【create_qr_code】" + traceback.format_exc() + ":" + str(response.text))
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = traceback.format_exc()
+            return invoke_result_data
+
+
+class TikTokPayRequest(object):
+    """
+    :description: 抖音支付请求类,配置文件内容 "tiktok_pay": {"cp_extra": "","token": "","salt": ""}
+    """
+    # =======【基本信息设置】=====================================
+    # 抖音公众号身份的唯一标识。审核通过后，在抖音发送的邮件中查看
+    app_id = ""
+    #开发者自定义字段，回调原样回传
+    cp_extra = ""
+    #担保交易Token（令牌）
+    token = ""
+    #担保交易密钥
+    salt = ""
+    # 日志
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, app_id="", cp_extra="", token="", salt=""):
+        """
+        :description: 初始化
+        :last_editors: HuangJianYi
+        """
+        pay_config = share_config.get_value("tiktok_pay")
+        self.app_id = app_id if app_id else share_config.get_value("app_id")
+        self.cp_extra = cp_extra if cp_extra else pay_config["cp_extra"]
+        self.token = token if token else pay_config["token"]
+        self.salt = salt if salt else pay_config["salt"]
+
+    def create_order(self, pay_order_no, notify_url, total_amount=1, subject="", body="", valid_time=900, thirdparty_id="", disable_msg=None, msg_page=""):
+        """
+        :description: 服务端创建预下单
+        :param pay_order_no：商户订单号(支付单号)开发者服务端的唯一订单号
+        :param notify_url：支付结果异步通知地址
+        :param total_amount:支付价格;单位元
+        :param subject: 商品描述; 长度限制 128 字节，不超过 42 个汉字 |默认 自己约定一个比如 “福小宠商品”*|
+        :param body:商品详情|默认 自己约定一个比如 “福小宠商品”
+        :param valid_time:订单过期时间(秒); 最小 15 分钟，最大两天|默认 900
+        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
+        :param msg_page:担保支付消息跳转页|默认传空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            data = {}
+            data['app_id'] = self.app_id
+            data['out_order_no'] = pay_order_no
+            data['total_amount'] = int(decimal.Decimal(str(total_amount)) * 100)
+            data['subject'] = subject
+            data['body'] = body
+            data['valid_time'] = valid_time
+            if notify_url:
+                data['notify_url'] = notify_url
+            if self.cp_extra:
+                data['cp_extra'] = self.cp_extra
+            if disable_msg:
+                data['disable_msg'] = int(disable_msg)
+            if msg_page:
+                data['msg_page'] = msg_page
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            sign = self.get_sign(data)
+            # 如果有第三方平台服务商id:thirdparty_id字段请把他放入data的字典里面
+            data['sign'] = sign
+
+            redis_key = f"{self.app_id}_tiktok_order_id:{str(pay_order_no)}"
+            orderInfo = SevenHelper.redis_init().get(redis_key)
+            if orderInfo:
+                invoke_result_data.data = SevenHelper.json_loads(orderInfo)
+                return invoke_result_data
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_order"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            # err_no	number	    状态码 0-业务处理成功
+            # err_tips	string	    错误提示信息，常见错误处理可参考附录常见问题章节
+            # data	    orderInfo	拉起收银台的 orderInfo
+            # {"err_no": 2000, "err_tips": "单号记录不存在", "data": null}
+            if response_data['err_no'] == 0:
+                SevenHelper.redis_init().set(redis_key, SevenHelper.json_dumps(response_data['data']), ex=3600 * 1)
+                invoke_result_data.data = response_data['data']
+                return invoke_result_data
+            else:
+                self.logger_error.error(f"【{pay_order_no},创建预下单】" + response_data['err_tips'])
+                invoke_result_data.success = False
+                invoke_result_data.error_code="error"
+                invoke_result_data.error_message = response_data['err_tips']
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【创建预下单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code="error"
+            invoke_result_data.error_message = "创建预下单出现异常，请重试"
+            return invoke_result_data
+
+    def query_order(self, pay_order_no, thirdparty_id=""):
+        """
+        :description: 查询订单
+        :param pay_order_no：开发者侧的订单号, 不可重复
+        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_order_no'] = pay_order_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_order"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            # {"err_no": 2000, "err_tips": "单号记录不存在", "out_order_no": "", "order_id": "", "payment_info": null}
+            # payment_info 返回值结构如下：
+            # {
+            #     "total_fee": 1200,
+            #     "order_status": "PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时",
+            #     "pay_time": "支付时间",
+            #     "way": 1,
+            #     "channel_no": "渠道单号",
+            #     "channel_gateway_no": "渠道网关号"
+            # }
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+            else:
+                self.logger_error.error(f"【{pay_order_no},查询订单】" + response_data['err_tips'])
+                invoke_result_data.success = False
+                invoke_result_data.error_code="error"
+                invoke_result_data.error_message = response_data['err_tips']
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【查询订单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code="error"
+            invoke_result_data.error_message = "查询订单出现异常，请重试"
+            return invoke_result_data
+
+    def get_pay_status(self, pay_order_no, thirdparty_id=""):
+        """
+        :description: 查询订单状态
+        :param pay_order_no：开发者侧的订单号, 不可重复
+        :param thirdparty_id: 服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串|默认值 空字符串
+        :return: PROCESSING-处理中|SUCCESS-成功|FAIL-失败|TIMEOUT-超时
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        invoke_result_data = self.query_order(pay_order_no, thirdparty_id)
+        if invoke_result_data.success == False:
+            return ""
+        else:
+            response_data = invoke_result_data.data
+            if response_data['payment_info']:
+                return response_data['payment_info']['order_status']
+            else:
+                return ""
+
+    def create_refund(self, refund_no, pay_order_no, notify_url, refund_amount=1, reason="", thirdparty_id="", disable_msg=None, msg_page="", all_settle=None):
+        """
+        :description: 服务端退款请求
+        :param refund_no:开发者侧的退款单号, 不可重复
+        :param pay_order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
+        :param notify_url:退款通知地址
+        :param refund_amount: 退款金额；单位元
+        :param reason:退款理由，长度上限 100|默认 由开发者定 例如：“7天无理由退款”
+        :param thirdparty_id:服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :param disable_msg:是否屏蔽担保支付的推送消息，1-屏蔽 0-非屏蔽，接入 POI 必传|默认传None
+        :param msg_page:担保支付消息跳转页|默认传空字符串
+        :param all_settle:是否为分账后退款，1-分账后退款；0-分账前退款。分账后退款会扣减可提现金额，请保证余额充足*|默认传None
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            data = {}
+            data['app_id'] = self.app_id
+            data['out_refund_no'] = refund_no
+            data['out_order_no'] = pay_order_no
+            data['refund_amount'] = int(decimal.Decimal(str(refund_amount)) * 100)
+            data['reason'] = reason
+            #cp_extra 开发者自定义字段，回调原样回传
+            if self.cp_extra:
+                data['cp_extra'] = self.cp_extra
+            if notify_url:
+                data['notify_url'] = notify_url
+            if disable_msg:
+                data['disable_msg'] = int(disable_msg)
+            if msg_page:
+                data['msg_page'] = msg_page
+            if all_settle:
+                data['all_settle'] = int(all_settle)
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            sign = self.get_sign(data)
+            # 如果有第三方平台服务商 id :thirdparty_id字段请把他放入data.update的字典里面
+            data['sign'] = sign
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/create_refund"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+        except Exception as ex:
+            self.logger_error.error("【创建退款单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退款出现异常，请重试"
+            return invoke_result_data
+
+    def query_refund(self, refund_no="", thirdparty_id=""):
+        """
+        :desciption:退款查询
+        :param refund_no:开发者侧的退款单号, 不可重复
+        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_refund_no'] = refund_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_refund"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【退款查询】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "退款查询出现异常，请重试"
+            return invoke_result_data
+
+    def create_settle(self, pay_order_no="", settle_desc="", settle_params="", thirdparty_id=""):
+        """
+        :description:服务端结算请求
+        :param order_no:商户分配订单号，标识进行退款的订单，开发者服务端的唯一订单号
+        :param settle_desc:结算描述 默认 自己约定一个比如 “福小宠商品结算”
+        :param settle_params:其他分账方信息，分账分配参数 SettleParameter 数组序列化后生成的 json 格式字符串
+        :param thirdparty_id：服务商模式接入必传,第三方平台服务商 id，非服务商模式留空|默认传空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            #out_order_no 开发者服务端的唯一订单号
+            out_settle_no = SevenHelper.create_order_id()
+            #回调地址
+            notify_url = self.notify_url
+            cp_extra = self.cp_extra
+            # 在这里将分账信息存入数据库
+            data = {}
+            data['out_settle_no'] = out_settle_no
+            #cp_extra 开发者自定义字段，回调原样回传
+            data['cp_extra'] = cp_extra
+            data['notify_url'] = notify_url
+            data['out_order_no'] = pay_order_no
+            data['settle_desc'] = settle_desc
+            if settle_params:
+                data['settle_params'] = settle_params
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/settle"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【结算请求】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "结算请求出现异常，请重试"
+            return invoke_result_data
+
+    def query_settle(self, out_settle_no="", thirdparty_id=""):
+        """
+        :desciption:结算查询
+        :param out_settle_no:开发者侧的分账号, 不可重复
+        :param thirdparty_id:服务商模式接入必传  第三方平台服务商 id，非服务商模式留空字符串
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        try:
+            app_id = self.app_id
+            data = {}
+            data['out_settle_no'] = out_settle_no
+            sign = self.get_sign(data)
+            data['sign'] = sign
+            data['app_id'] = app_id
+            if thirdparty_id:
+                data['thirdparty_id'] = thirdparty_id
+
+            url = "https://developer.toutiao.com/api/apps/ecpay/v1/query_settle"
+            headers = {"Content-type": "application/json"}
+            response = requests.post(url, headers=headers, data=json.dumps(data))
+            response_data = SevenHelper.json_loads(response.text)
+            if response_data['err_no'] == 0:
+                invoke_result_data.data = response_data
+                return invoke_result_data
+
+        except Exception as ex:
+            self.logger_error.error("【结算查询】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "结算查询出现异常，请重试"
+            return invoke_result_data
+
+    def get_sign(self, params_map):
+        params_list = []
+        for k, v in params_map.items():
+            if k == "other_settle_params":
+                continue
+            value = str(v).strip()
+            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
+                value = value[1: len(value) - 1]
+            value = value.strip()
+            if value == "" or value == "null":
+                continue
+            if k not in ("app_id", "thirdparty_id", "sign"):
+                params_list.append(value)
+        params_list.append(self.salt)
+        params_list.sort()
+        original_str = str("&").join(params_list)
+        return hashlib.md5(original_str.encode("utf-8")).hexdigest()
+
+
+class TikTokReponse(object):
+    """
+    :description: 抖音支付响应类 根据支付/退款/分账等回调json内容，检测type字段判断是支付回调还是退款回调，type:payment 支付成功回调,refund退款成功回调,settle分账成功回调
+    """
+    logger_error = Logger.get_logger_by_name("log_error")
+
+    def __init__(self, data, token=""):
+        self.data = json.loads(data)  #data由json.loads(self.request.body)获得
+        pay_config = share_config.get_value("tiktok_pay")
+        self.token = token if token else pay_config["token"]
+
+    def get_data(self):
+        """
+        :description: 获取通知的数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return self.data
+
+    def check_sign(self):
+        """
+        :description: 校验签名
+        :return:
+        :last_editors: HuangJianYi
+        """
+        #计算服务端sign
+        service_signature = self.get_callback_sign(self.data)
+        #验证成功,进行业务处理
+        log_msg = f'客户端签名:{self.data["msg_signature"]},服务端签名:{service_signature}'
+        # self.logger_error.error(log_msg)
+        if service_signature == self.data["msg_signature"]:
+            return True
+        else:
+            return False
+
+    def get_callback_sign(self, params):
+        """
+        :description: 获取头条回调sign
+        :param params: 参数字典
+        :return: sign
+        :last_editors: HuangJianYi
+        """
+        keys = ['type', 'msg_signature']
+        params_copy = {key: params[key] for key in params if key not in keys}
+        for key, v in params_copy.items():
+            value = str(v).strip()
+            if value.startswith("\"") and value.endswith("\"") and len(value) > 1:
+                value = value[1:len(value) - 1]
+            value = value.strip()
+            if value == "" or value == "null":
+                continue
+            if isinstance(value, int):
+                params_copy[key] = str(value)
+        params_copy['token'] = self.token
+        params_list = sorted(list(params_copy.items()), key=lambda x: x[1])
+        params_str = ''.join(f"{v}" for k, v in params_list)
+        sign = CryptoHelper().sha1_encrypt(params_str)
+        return sign
+
+    def convert_response_json(self, err_no=0, err_tips="success"):
+        """
+        :description: 获取通知的数据
+        :return:
+        :last_editors: HuangJianYi
+        """
+        return {"err_no": err_no, "err_tips": err_tips}
+
+
+class TikTokBizDataCrypt:
+    def __init__(self, app_id, session_key):
+        self.app_id = app_id
+        self.session_key = session_key
+
+    def decrypt(self, encryptedData, iv):
+        """
+        :description: 解密
+        :param encryptedData: encryptedData
+        :param iv: iv
+        :return str
+        :last_editors: HuangJianYi
+        """
+        # base64 decode
+        session_key = base64.b64decode(self.session_key)
+        encryptedData = base64.b64decode(encryptedData)
+        iv = base64.b64decode(iv)
+        decrypted = {}
+        cipher = AES.new(session_key, AES.MODE_CBC, iv)
+        result_data = str(self._unpad(cipher.decrypt(encryptedData)), "utf-8")
+        if result_data:
+            decrypted = SevenHelper.json_loads(result_data)
+        if decrypted:
+            if decrypted['watermark']['appid'] != self.app_id:
+                raise Exception('Invalid Buffer')
+
+        return decrypted
+
+    def _unpad(self, s):
+        return s[:-ord(s[len(s) - 1:])]
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/act_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/module_s.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,361 +1,326 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 09:54:51
-@LastEditTime: 2021-09-06 17:33:46
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import *
-
-from seven_cloudapp_frame.models.db_models.base.base_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_type_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_info_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-
-
-class ActBaseModel():
-    """
-    :description: 活动信息业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-
-    def _delete_act_info_dependency_key(self,app_id,act_id):
-        """
-        :description: 删除活动信息依赖建
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        try:
-            redis_init = SevenHelper.redis_init()
-            if act_id:
-                redis_init.delete(f"act_info:actid_{act_id}")
-            if app_id:
-                redis_init.delete(f"act_info_list:appid_{app_id}")
-        except Exception as ex:
-            pass
-        
-    def get_act_info_dict(self,act_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取活动信息
-        :param act_id: 活动标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布或删除的数据
-        :return: 返回活动信息
-        :last_editors: HuangJianYi
-        """
-        act_info_model = ActInfoModel(context=self.context)
-        if is_cache:
-            dependency_key = f"act_info:actid_{act_id}"
-            act_info_dict = act_info_model.get_cache_dict_by_id(act_id,dependency_key=dependency_key)
-        else:
-            act_info_dict = act_info_model.get_dict_by_id(act_id)
-        if is_filter == True:
-            if not act_info_dict or act_info_dict["is_release"] == 0 or act_info_dict["is_del"] == 1:
-                return None
-        return act_info_dict
-
-    def get_act_info_list(self,app_id,act_name,is_del,page_size,page_index,is_cache=True):
-        """
-        :description: 获取活动信息列表
-        :param app_id: 应用标识
-        :param act_name: 活动名称
-        :param is_del: 是否回收站1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :param is_cache: 是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        order_by = "id asc"
-        condition = "app_id=%s"
-        params = [app_id]
-        if is_del !=-1:
-            condition += " and is_del=%s"
-            params.append(is_del)
-        if act_name:
-            condition += " and act_name=%s"
-            params.append(act_name)
-        if is_cache:
-            page_list, total = ActInfoModel(context=self.context).get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by, params=params,dependency_key=f"act_info_list:appid_{app_id}")
-        else:
-            page_list, total = ActInfoModel(context=self.context).get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by, params=params)    
-        for page in page_list:
-            page["share_desc_json"] = SevenHelper.json_loads(page["share_desc_json"]) if page["share_desc_json"] else {}
-            page["rule_desc_json"] = SevenHelper.json_loads(page["rule_desc_json"]) if page["rule_desc_json"] else []
-            page["finish_menu_config_json"] = SevenHelper.json_loads(page["finish_menu_config_json"]) if page["finish_menu_config_json"] else []
-            page["finish_status"] = page["is_finish"]
-        return page_list, total
-
-    def add_act_info(self,app_id,act_name,act_type,theme_id,share_desc_json,rule_desc_json,close_word="抱歉，程序维护中"):
-        """
-        :description: 添加活动信息
-        :param app_id: 应用标识
-        :param act_name: 活动名称
-        :param act_type: 活动类型
-        :param theme_id: 主题标识
-        :param share_desc_json: 分享配置
-        :param rule_desc_json: 规则配置
-        :param close_word: 关闭文案
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        if not act_name:
-            base_info_model = BaseInfoModel(context=self.context)
-            base_info_dict = base_info_model.get_cache_dict()
-            if not base_info_dict:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "基础信息不存在"
-                return invoke_result_data
-        act_type_model = ActTypeModel(context=self.context)
-        act_type_info = act_type_model.get_entity("id=%s", params=act_type)
-        if not act_type_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动类型信息不存在"
-            return invoke_result_data
-
-        now_datetime = SevenHelper.get_now_datetime()
-        act_info_model = ActInfoModel(context=self.context)
-        act_count = act_info_model.get_total("app_id=%s", params=[app_id])
-
-        act_info = ActInfo()
-        act_info.app_id = app_id
-        act_info.act_name = base_info_dict["product_name"] + "_" + str(act_count + 1) if not act_name else act_name
-        act_info.act_type = act_type
-        act_info.theme_id = theme_id
-        act_info.close_word = close_word
-        act_info.share_desc_json = share_desc_json if share_desc_json else {}
-        act_info.rule_desc_json = rule_desc_json if rule_desc_json else []
-        act_info.start_date = now_datetime
-        act_info.end_date = "2900-01-01 00:00:00"
-        act_info.task_asset_type_json = act_type_info.task_asset_type_json
-        act_info.is_release = 1
-        act_info.release_date = now_datetime
-        act_info.create_date = now_datetime
-        act_info.modify_date = now_datetime
-        act_info.id = act_info_model.add_entity(act_info)
-        invoke_result_data.data = act_info
-        self._delete_act_info_dependency_key(app_id,act_info.id)
-        return invoke_result_data
-
-    def update_act_info(self,app_id,act_id,act_name,theme_id,is_share,share_desc_json,is_rule,rule_desc_json,is_release,start_date,end_date,is_black,refund_count,join_ways,is_fictitious,close_word="抱歉，程序维护中",store_url=None,i1=-1,i2=-1,i3=-1,i4=-1,i5=-1,s1=None,s2=None,s3=None,s4=None,s5=None,d1=None,d2=None):
-        """
-        :description: 修改活动信息
-        :param app_id: 应用标识
-        :param act_id：活动标识
-        :param act_name：活动名称
-        :param is_release：是否发布
-        :param theme_id: 主题标识
-        :param is_share: 是否开启分享
-        :param share_desc_json: 分享配置
-        :param is_rule: 是否开启规则
-        :param rule_desc_json: 规则配置
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param close_word: 关闭文案
-        :param is_black：是否开启退款惩罚
-        :param refund_count：退款成功次数
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_info_model = ActInfoModel(context=self.context)
-        act_info = act_info_model.get_entity_by_id(act_id)
-        if not act_info or act_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        old_act_info = deepcopy(act_info)
-        now_datetime = SevenHelper.get_now_datetime()
-        if act_name !=None:
-            act_info.act_name = act_name
-        if is_release !=-1:
-            act_info.is_release = is_release
-        if theme_id !=-1:
-            act_info.theme_id = theme_id
-        if is_share !=-1:
-            act_info.is_share = is_share
-        if share_desc_json !=None:
-            act_info.share_desc_json = share_desc_json
-        if is_rule !=-1:
-            act_info.is_rule = is_rule
-        if rule_desc_json !=None:
-            act_info.rule_desc_json = rule_desc_json
-        if is_release !=-1:
-            act_info.is_release = is_release
-            act_info.release_date = now_datetime
-        if start_date !=None:
-            act_info.start_date = start_date
-        if end_date !=None:
-            act_info.end_date = end_date
-        if is_black !=-1:
-            act_info.is_black = is_black
-        if refund_count !=-1:
-            act_info.refund_count = refund_count
-        if join_ways !=-1:
-            act_info.join_ways = join_ways
-        if is_fictitious !=-1:
-            act_info.is_fictitious = is_fictitious
-        if close_word !=None:
-            act_info.close_word = close_word
-        if store_url !=None:
-            act_info.store_url = store_url
-        if i1 !=-1:
-            act_info.i1 = i1
-        if i2 !=-1:
-            act_info.i2 = i2
-        if i3 !=-1:
-            act_info.i3 = i3
-        if i4 !=-1:
-            act_info.i4 = i4
-        if i5 !=-1:
-            act_info.i5 = i5
-        if s1 !=None:
-            act_info.s1 = s1
-        if s2 !=None:
-            act_info.s2 = s2
-        if s3 !=None:
-            act_info.s3 = s3
-        if s4 !=None:
-             act_info.s4 = s4
-        if s5 !=None:
-             act_info.s5 = s5
-        if d1 !=None:
-             act_info.d1 = d1
-        if d2 !=None:
-             act_info.d2 = d2
-        act_info.modify_date = now_datetime
-        act_info_model.update_entity(act_info,exclude_field_list="finish_menu_config_json,is_finish,task_asset_type_json,is_launch")
-        result = {}
-        result["old"] = old_act_info
-        result["new"] = act_info
-        invoke_result_data.data = result
-        self._delete_act_info_dependency_key(app_id,act_info.id)
-        return invoke_result_data
-    
-    def update_act_info_status(self,app_id,act_id,is_del):
-        """
-        :description: 删除或者还原活动
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_info_model = ActInfoModel(context=self.context)
-        act_info_dict = act_info_model.get_dict_by_id(act_id)
-        if not act_info_dict or act_info_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        is_release = 0 if is_del == 1 else 1
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_info_model.update_table("is_del=%s,is_release=%s,release_date=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, modify_date, act_id])
-        self._delete_act_info_dependency_key(app_id,act_id)
-        return invoke_result_data
-
-    def release_act_info(self,app_id,act_id,is_release):
-        """
-        :description: ip上下架
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_info_model = ActInfoModel(context=self.context)
-        act_info_dict = act_info_model.get_dict_by_id(act_id)
-        if not act_info_dict or act_info_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = act_info_model.update_table("release_date=%s,is_release=%s", "id=%s", [SevenHelper.get_now_datetime(), is_release, act_id])
-        self._delete_act_info_dependency_key(app_id,act_id)
-        return invoke_result_data
-
-    def next_progress(self,app_id,act_id,finish_key):
-        """
-        :description: 下一步配置
-        :param app_id：应用标识
-        :param finish_key：完成key，由前端控制是否完成配置，完成时需传参数值finish_config 代表最后一步
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        base_info_model = BaseInfoModel(context=self.context)
-        base_info = base_info_model.get_entity()
-        if not base_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "基础信息不存在"
-            return invoke_result_data
-        act_info_model = ActInfoModel(context=self.context)
-        act_info = act_info_model.get_dict_by_id(act_id)
-        if not act_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_act"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        menu_config_json = SevenHelper.json_loads(base_info.menu_config_json)
-        menu = [menu for menu in menu_config_json if menu["key"] == finish_key]
-        if len(menu) == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，无此菜单"
-            return invoke_result_data
-        if act_info["finish_menu_config_json"] != "" and finish_key in act_info["finish_menu_config_json"]:
-            return invoke_result_data
-        if act_info["finish_menu_config_json"] == "":
-            act_info["finish_menu_config_json"] = "[]"
-        finish_menu_config_json = SevenHelper.json_loads(act_info["finish_menu_config_json"])
-        finish_menu_config_json.append(finish_key)
-
-        result_finish_menu_config_json = []
-        for item in finish_menu_config_json:
-            is_exist = [item2 for item2 in menu_config_json if item2["key"] == item]
-            if len(is_exist) > 0:
-                result_finish_menu_config_json.append(item)
-        is_finish = 0
-        if finish_key == "finish_config" and act_info["is_finish"] == 0:
-            is_finish = 1
-        result_finish_menu_config_json = SevenHelper.json_dumps(result_finish_menu_config_json)
-        act_info_model.update_table("finish_menu_config_json=%s,is_finish=%s", "id=%s", [result_finish_menu_config_json, is_finish, act_id])
-        app_id = self.get_app_id()
-        if is_finish == 1 and app_id:
-            app_info_model = AppInfoModel(context=self.context)
-            app_info_model.update_table("is_setting=1", "app_id=%s", [app_id])
-        return invoke_result_data
-  
-    
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:42:53
+@LastEditTime: 2023-03-13 11:48:10
+@LastEditors: HuangJianYi
+@Description: 小活动模块（机台）
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.module_base_model import *
+from seven_cloudapp_frame.models.seven_model import PageInfo
+
+
+class SaveActModuleHandler(ClientBaseHandler):
+    """
+    :description: 保存活动模块信息
+    """
+    def post_async(self):
+        """
+        :description: 添加活动信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_id: 活动模块标识
+        :param module_name: 模块名称
+        :param module_sub_name: 模块短名称
+        :param module_type: 模块类型
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param module_pic: 模块图片
+        :param module_desc: 描述信息
+        :param price: 价格
+        :param price_gear_id: 档位标识
+        :param ip_id: IP标识
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        business_type = int(self.get_param("business_type",0))
+        module_id = int(self.get_param("module_id",0))
+        module_name = self.get_param("module_name")
+        module_sub_name = self.get_param("module_sub_name")
+        module_type = self.get_param_int("module_type",0)
+        start_date = self.get_param("start_date", "1900-01-01 00:00:00")
+        end_date = self.get_param("end_date", "1900-01-01 00:00:00")
+        module_pic = self.get_param("module_pic")
+        module_desc = self.get_param("module_desc")
+        price = self.get_param("price")
+        price_gear_id = int(self.get_param("price_gear_id",0))
+        ip_id = int(self.get_param("ip_id", 0))
+        join_ways = int(self.get_param("join_ways",0))
+        is_fictitious = int(self.get_param("is_fictitious",0))
+        sort_index = int(self.get_param("sort_index",0))
+        is_release = int(self.get_param("is_release",0))
+        i1 = int(self.get_param("i1",0))
+        i2 = int(self.get_param("i2",0))
+        i3 = int(self.get_param("i3",0))
+        i4 = int(self.get_param("i4",0))
+        i5 = int(self.get_param("i5",0))
+        s1 = self.get_param("s1")
+        s2 = self.get_param("s2")
+        s3 = self.get_param("s3")
+        s4 = self.get_param("s4")
+        s5 = self.get_param("s5")
+        d1 = self.get_param("d1", "1900-01-01 00:00:00")
+        d2 = self.get_param("d2", "1900-01-01 00:00:00")
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if business_type == 1:
+            default_prefix = "机台"
+        elif business_type == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.save_act_module(app_id, act_id, module_id, module_name, module_sub_name, start_date, end_date, module_pic, module_desc, price, price_gear_id, ip_id, join_ways, is_fictitious, sort_index, is_release, i1, i2, i3, i4, i5, s1, s2, s3, s4, s5, d1, d2, business_type, module_type)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if invoke_result_data.data["is_add"] == True:
+            # 记录日志
+            self.create_operation_log(operation_type=OperationType.add.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=None, update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
+        else:
+            self.create_operation_log(operation_type=OperationType.update.value, model_name=invoke_result_data.data["new"].__str__(), old_detail=invoke_result_data.data["old"], update_detail=invoke_result_data.data["new"], title= title_prefix + ";" + module_name)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.response_json_success(invoke_result_data.data["new"].id)
+
+
+class ActModuleHandler(ClientBaseHandler):
+    """
+    :description: 单条活动模块信息
+    """
+    def get_async(self):
+        """
+        :description: 活动模块列表
+        :param app_id：应用标识
+        :param module_id：活动模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        act_module_dict = module_base_model.get_act_module_dict(module_id, False)
+        if act_module_dict:
+            if act_module_dict["app_id"] != app_id:
+                act_module_dict = {}
+                return self.response_json_success(act_module_dict)
+        ref_params = {}
+        return self.response_json_success(self.business_process_executed(act_module_dict, ref_params))
+
+
+class ActModuleListHandler(ClientBaseHandler):
+    """
+    :description: 活动模块列表
+    """
+    def get_async(self):
+        """
+        :description: 活动模块列表
+        :param app_id：应用标识
+        :param business_type：业务类型(0无1机台2活动)
+        :param act_name：模块名称
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param page_index：页索引
+        :param page_size：页大小
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        page_index = self.get_param_int("page_index", 0)
+        page_size = self.get_param_int("page_size", 10)
+        is_del = self.get_param_int("is_del", 0)
+        business_type = self.get_param_int("business_type", -1)
+        module_name = self.get_param("module_name")
+        start_date = self.get_param("start_date")
+        end_date = self.get_param("end_date")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "sort_index desc,id asc"
+        condition_where = ConditionWhere()
+        if condition:
+            condition_where.add_condition(condition)
+        if business_type != -1:
+            condition_where.add_condition("business_type=%s")
+            params.append(business_type)
+
+        if not app_id or not act_id:
+            return self.response_json_success({"data": []})
+        module_base_model = ModuleBaseModel(context=self)
+        page_list, total = module_base_model.get_act_module_list(app_id, act_id, module_name, start_date, end_date, is_del, page_size, page_index, order_by=order_by, condition=condition_where.to_string(), params=params, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class DeleteActModuleHandler(ClientBaseHandler):
+    """
+    :description: 删除活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 删除活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 1)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=OperationType.delete.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReviewActModuleHandler(ClientBaseHandler):
+    """
+    :description: 还原活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 还原活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_status(app_id, module_id, 0)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=OperationType.review.value, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class ReleaseActModuleHandler(ClientBaseHandler):
+    """
+    :description: 上下架活动模块
+    """
+    @filter_check_params("module_id")
+    def get_async(self):
+        """
+        :description: 上下架活动模块
+        :param app_id：应用标识
+        :param module_id：模块标识
+        :param is_release: 是否发布 1-是 0-否
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        module_id = int(self.get_param("module_id", 0))
+        is_release = int(self.get_param("is_release", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.release_act_module(app_id, module_id, is_release)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        operation_type = OperationType.release.value if is_release == 1 else OperationType.un_release.value
+        default_prefix = ""
+        if invoke_result_data.data["business_type"] == 1:
+            default_prefix = "机台"
+        elif invoke_result_data.data["business_type"] == 2:
+            default_prefix = "活动"
+        title_prefix = invoke_result_data.data["title_prefix"] if invoke_result_data.data.__contains__("title_prefix") else default_prefix
+        self.create_operation_log(operation_type=operation_type, model_name="act_module_tb", title= title_prefix + ";" + invoke_result_data.data["module_name"])
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
+
+
+class UpdateActModulePriceHandler(ClientBaseHandler):
+    """
+    :description: 更新活动模块价格
+    """
+    @filter_check_params("prize_gear_id")
+    def get_async(self):
+        """
+        :description:更新活动模块价格
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_gear_id：档位标识
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_gear_id = int(self.get_param("prize_gear_id", 0))
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        module_base_model = ModuleBaseModel(context=self)
+        invoke_result_data = module_base_model.update_act_module_price(app_id, act_id, prize_gear_id)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success()
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/app_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/theme_base_model.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,229 +1,285 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 09:54:51
-@LastEditTime: 2021-09-26 12:20:12
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from decimal import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.db_models.app.app_info_model import *
-from seven_cloudapp_frame.models.db_models.base.base_info_model import *
-from seven_cloudapp_frame.models.db_models.friend.friend_link_model import *
-from seven_cloudapp_frame.models.db_models.product.product_price_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_login_log_model import *
-from seven_cloudapp_frame.models.db_models.version.version_info_model import *
-
-
-class AppBaseModel():
-    """
-    :description: 应用信息业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-
-    def get_app_id(self,store_name):
-        """
-        :description: 获取应用标识
-        :param store_name:店铺名称
-        :return app_id
-        :last_editors: HuangJianYi
-        """
-        app_id = ""
-        app_info_dict = AppInfoModel(context=self.context).get_cache_dict("store_name=%s", field="app_id", params=[store_name])
-        if app_info_dict:
-            app_id = app_info_dict["app_id"]
-        return app_id
-
-    def get_app_info_dict(self,app_id,is_cache=True):
-        """
-        :description: 获取应用信息
-        :param app_id: 应用标识
-        :param is_cache: 是否缓存
-        :return: 返回应用信息
-        :last_editors: HuangJianYi
-        """
-        app_info_model = AppInfoModel(context=self.context)
-        if is_cache:
-            dependency_key = f"app_info:appid_{app_id}"
-            return app_info_model.get_cache_dict(dependency_key=dependency_key,where="app_id=%s", params=[app_id])
-        else:
-            return app_info_model.get_dict(where="app_id=%s", params=[app_id])
-
-    def get_app_expire(self,app_id):
-        """
-        :description: 获取小程序是否过期未续费
-        :param app_id: 应用标识
-        :return 1过期0未过期
-        :last_editors: HuangJianYi
-        """
-        now_date = SevenHelper.get_now_datetime()
-        invoke_result_data = InvokeResultData()
-        app_info_dict = self.get_app_info_dict(app_id)
-        if not app_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "小程序不存在"
-            return invoke_result_data
-        result = {}
-        if app_info_dict["expiration_date"] == "1900-01-01 00:00:00":
-            result["is_expire"] = 0
-        elif TimeHelper.format_time_to_datetime(now_date) > TimeHelper.format_time_to_datetime(app_info_dict["expiration_date"]):
-            result["is_expire"] = 1
-        else:
-            result["is_expire"] = 0
-        invoke_result_data.data = result
-        return invoke_result_data
-
-    def get_left_navigation(self,user_nick,access_token):
-        """
-        :description: 获取左侧导航
-        :param user_nick: 用户昵称
-        :param access_token: access_token
-        :return
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        store_user_nick = user_nick.split(':')[0]
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-        base_info_dict = BaseInfoModel(context=self.context).get_dict()
-        if not base_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "基础信息不存在"
-            return invoke_result_data
-        
-        app_info = None
-        app_id = self.get_param("app_id")
-        if app_id:
-            app_info = AppInfoModel(context=self).get_entity("app_id=%s", params=app_id)
-
-        # 左上角信息
-        info = {}
-        info["company"] = "天志互联"
-        info["miniappName"] = base_info_dict["product_name"]
-        info["logo"] = base_info_dict["product_icon"]
-        info["client_now_ver"] = app_info.template_ver if app_info else ""
-
-        # 左边底部菜单
-        helper_info = {}
-        helper_info["customer_service"] = base_info_dict["customer_service"]
-        helper_info["video_url"] = base_info_dict["video_url"]
-        helper_info["study_url"] = base_info_dict["study_url"]
-        helper_info["is_remind_phone"] = base_info_dict["is_remind_phone"]
-        helper_info["phone"] = ""
-
-         # 过期时间
-        renew_info = {}
-        renew_info["surplus_day"] = 0
-        dead_date = ""
-        if app_info:
-            helper_info["phone"] = app_info.app_telephone
-            dead_date = app_info.expiration_date
-        else:
-            top_base_model = TopBaseModel(context=self.context)
-            invoke_result_data = top_base_model.get_dead_date(store_user_nick,access_token)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            dead_date = invoke_result_data.data
-        renew_info["dead_date"] = dead_date
-        if dead_date != "expire":
-            renew_info["surplus_day"] = TimeHelper.difference_days(dead_date, SevenHelper.get_now_datetime())
-        data = {}
-        data["app_info"] = info
-        data["helper_info"] = helper_info
-        data["renew_info"] = renew_info
-
-        product_price_model = ProductPriceModel(context=self.context)
-        product_price = product_price_model.get_cache_entity(where="%s>=begin_time and %s<=end_time and is_release=1",order_by="create_time desc",params=[SevenHelper.get_now_datetime()])
-        base_info = {}
-        # 把string转成数组对象
-        base_info["update_function"] = SevenHelper.json_loads(base_info_dict["update_function"]) if base_info_dict["update_function"] else []
-        base_info["update_function_b"] = SevenHelper.json_loads(base_info_dict["update_function_b"]) if base_info_dict["update_function_b"] else []
-        base_info["decoration_poster_list"] = SevenHelper.json_loads(base_info_dict["decoration_poster_json"]) if base_info_dict["decoration_poster_json"] else []
-        base_info["menu_config_list"] = SevenHelper.json_loads(base_info_dict["menu_config_json"]) if base_info_dict["menu_config_json"] else []
-        base_info["product_price_list"] = SevenHelper.json_loads(product_price.content) if product_price else []
-        base_info["server_ver"] = base_info_dict["server_ver"]
-        base_info["is_force_update"] = base_info_dict["is_force_update"]
-        #中台指定账号升级
-        version_info = VersionInfoModel(context=self.context).get_entity(where="type_id=1",order_by="id desc")
-        if version_info:
-            if version_info.update_scope == 2 and version_info.white_lists:
-                white_lists = list(set(str(version_info.white_lists).split(',')))
-                if user_nick in white_lists:
-                    base_info["client_ver"] = version_info.version_number
-        #配置文件指定账号升级
-        if user_nick:
-            if user_nick == config.get_value("test_user_nick"):
-                base_info["client_ver"] = config.get_value("test_client_ver")
-        data["base_info"] = base_info
-        invoke_result_data.data =data
-        return invoke_result_data
-   
-    def get_app_info_result(self,user_nick,open_id,access_token):
-        """
-        :description: 获取小程序信息
-        :param user_nick:用户昵称
-        :param open_id:open_id
-        :param access_token:access_token
-        :return app_info
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        store_user_nick = user_nick.split(':')[0]
-        if not store_user_nick:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-        if not open_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起，请先授权登录"
-            return invoke_result_data
-            
-        app_info_model = AppInfoModel(context=self.context)
-        app_info = app_info_model.get_entity("store_user_nick=%s", params=store_user_nick)
-        top_base_model = TopBaseModel(context=self.context)
-        invoke_result_data = top_base_model.get_dead_date(store_user_nick,access_token)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        dead_date = invoke_result_data.data
-        now_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(TimeHelper.get_now_format_time('%Y-%m-%d 00:00:00'), '%Y-%m-%d %H:%M:%S'))
-        login_log = TaoLoginLogModel(context=self.context).get_entity("open_id=%s", order_by="id desc", params=open_id)
-        if app_info:
-            app_info.access_token = access_token
-            if dead_date != "expire":
-                app_info.expiration_date = dead_date
-            app_info_model.update_entity(app_info,"expiration_date,access_token")
-
-            app_info.user_nick = user_nick
-            app_info.dead_date = dead_date
-            if app_info.dead_date != "expire":
-                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
-                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
-            app_info.last_login_date = login_log.modify_date if login_log else ""
-            invoke_result_data.data = app_info
-            return invoke_result_data
-        else:
-            app_info = AppInfo()
-            app_info.access_token = access_token
-            base_info = BaseInfoModel(context=self.context).get_dict()
-            
-            app_info.template_ver = base_info["client_ver"]
-            app_info.user_nick = user_nick
-            app_info.dead_date = dead_date
-            if app_info.dead_date != "expire":
-                dead_date_timestamp = TimeHelper.datetime_to_timestamp(datetime.datetime.strptime(app_info.dead_date, '%Y-%m-%d %H:%M:%S'))
-                app_info.surplus_day = int(int(abs(dead_date_timestamp - now_timestamp)) / 24 / 3600)
-            app_info.last_login_date = login_log.create_date if login_log else ""
-            invoke_result_data.data = app_info
-            return invoke_result_data
-            
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 15:44:04
+@LastEditTime: 2023-03-29 12:00:55
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.common import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.db_models.theme.theme_info_model import *
+from seven_cloudapp_frame.models.db_models.theme.theme_ver_model import *
+from seven_cloudapp_frame.models.db_models.skin.skin_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_info_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+
+class ThemeBaseModel():
+    """
+    :description: 主题皮肤业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_theme_info(self,theme_id, ver_no,is_cache=True):
+        """
+        :description: 获取主题信息
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param ver_no：客户端版本号
+        :param is_cache：是否缓存
+        :return: 返回主题信息
+        :last_editors: HuangJianYi
+        """
+        theme_info_model = ThemeInfoModel(context=self.context)
+        cache_key = f"theme_info:themeid_{theme_id}_verno_{ver_no}"
+        redis_init = SevenHelper.redis_init()
+        if is_cache:
+            theme_info_dict = redis_init.get(cache_key)
+            if theme_info_dict:
+                theme_info_dict = SevenHelper.json_loads(theme_info_dict)
+                return theme_info_dict
+
+        theme_info_dict = theme_info_model.get_dict_by_id(theme_id)
+        if not theme_info_dict:
+            return theme_info_dict
+        out_id = theme_info_dict["out_id"]
+        if ver_no:
+            theme_ver = ThemeVerModel(context=self.context).get_dict("out_id=%s and ver_no=%s", limit="1", params=[out_id, ver_no])
+            if theme_ver and theme_ver["client_json"] != "":
+                theme_info_dict["client_json"] = theme_ver["client_json"]
+        skin_info_list = SkinInfoModel(context=self.context).get_dict_list("theme_id=%s", params=theme_id)
+        theme_info_dict["skin_list"] = skin_info_list
+        if is_cache:
+            redis_init.set(cache_key, SevenHelper.json_dumps(theme_info_dict), ex=share_config.get_value("cache_expire", 600))
+        return theme_info_dict
+
+    def get_theme_list(self,app_id, is_public=True, is_cache=True, ascription_type=-1):
+        """
+        :description: 获取主题列表
+        :param app_id：应用标识
+        :param is_public：是否读取公共的（True是False否）
+        :param is_cache：是否缓存
+        :param ascription_type：归属类型
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("is_release=1")
+        params = []
+        if ascription_type != -1:
+            condition_where.add_condition("ascription_type=%s")
+            params.append(ascription_type)
+        if is_public == True:
+            condition_where.add_condition("(app_id=%s or app_id='')")
+        else:
+            condition_where.add_condition("app_id=%s")
+        params.append(app_id)
+        theme_info_model = ThemeInfoModel(context=self.context)
+        if is_cache:
+            dict_list = theme_info_model.get_cache_dict_list(where=condition_where.to_string(), params=params)
+        else:
+            dict_list = theme_info_model.get_dict_list(where=condition_where.to_string(), params=params)
+
+        for dict_info in dict_list:
+            dict_info["server_json"] = SevenHelper.json_loads(dict_info["server_json"]) if dict_info["server_json"] else {}
+        return dict_list
+
+    def get_skin_list(self, theme_id=0, theme_out_id="",is_cache=True):
+        """
+        :description: 获取皮肤列表
+        :param theme_id：主题标识
+        :param theme_out_id：外部主题标识
+        :param is_cache：是否缓存
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        where = ""
+        params = []
+        if not theme_id:
+            return []
+        if theme_id:
+            where = "theme_id=%s"
+            params.append(theme_id)
+        if theme_out_id:
+            if where:
+                where+=" and "
+            where += " theme_out_id=%s"
+            params.append(theme_out_id)
+        if is_cache:
+            dict_list = SkinInfoModel(context=self.context).get_cache_dict_list(where=where, params=params)
+        else:
+            dict_list = SkinInfoModel(context=self.context).get_dict_list(where=where, params=params)
+        for dict_info in dict_list:
+            dict_info["client_json"] = SevenHelper.json_loads(dict_info["client_json"]) if dict_info["client_json"] else {}
+            dict_info["server_json"] = SevenHelper.json_loads(dict_info["server_json"]) if dict_info["server_json"] else {}
+        return dict_list
+
+    def update_act_theme_and_skin(self,app_id,act_id,theme_id,is_module):
+        """
+        :description: 更新活动主题和皮肤
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param theme_id：主题标识
+        :param is_module：是否更新活动模块皮肤 True是False否
+        :return: 获取主题列表
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_info_model = ActInfoModel(context=self.context)
+        act_base_model = ActBaseModel(context=self.context)
+        act_info_dict = act_base_model.get_act_info_dict(act_id,is_cache=False)
+        if act_info_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动不存在"
+            return invoke_result_data
+        if act_info_dict["theme_id"] == theme_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "主题未改变无需更改"
+            return invoke_result_data
+
+        skin_info = SkinInfoModel(context=self.context).get_entity("theme_id=%s", params=theme_id)
+        if not skin_info:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起，主题没有皮肤"
+            return invoke_result_data
+        act_info_model.update_table("theme_id=%s", "id=%s", [theme_id, act_id])
+        if is_module == True:
+            ActModuleModel(context=self.context).update_table("skin_id=%s", "act_id=%s", [skin_info.id, act_id])
+        return invoke_result_data
+
+    def save_theme(self, app_id, theme_name, client_json, server_json, out_id, ver_no, style_type, ascription_type=1):
+        """
+        :description: 添加或修改主题
+        :param app_id：app_id
+        :param theme_name：主题名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param out_id：外部id
+        :param ver_no：客户端版本号
+        :param style_type：样式类型
+        :param ascription_type：归属类型(1公共)
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not out_id or not ver_no:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        theme_info_model = ThemeInfoModel(context=self.context)
+        theme_ver_model = ThemeVerModel(context=self.context)
+        theme_info = theme_info_model.get_entity("out_id=%s", params=[out_id])
+        if theme_info:
+            if client_json:
+                theme_ver = theme_ver_model.get_entity('out_id=%s and ver_no=%s', params=[out_id, ver_no])
+                if theme_ver:
+                    theme_ver_model.update_table('client_json=%s', 'out_id=%s and ver_no=%s', params=[client_json, out_id, ver_no])
+                else:
+                    theme_ver = ThemeVer()
+                    theme_ver.app_id = theme_info.app_id
+                    theme_ver.out_id = out_id
+                    theme_ver.theme_id = theme_info.id
+                    theme_ver.client_json = client_json
+                    theme_ver.ver_no = ver_no
+                    theme_ver.create_date = theme_info.create_date
+                    theme_ver_model.add_entity(theme_ver)
+            if server_json:
+                theme_info_model.update_table('server_json=%s', 'out_id=%s', params=[server_json, out_id])
+        else:
+            theme_total = theme_info_model.get_total()
+            if not theme_name:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "主题名称不能为空"
+                return invoke_result_data
+            theme_info = ThemeInfo()
+            theme_info.theme_name = theme_name
+            theme_info.server_json = server_json
+            theme_info.out_id = out_id
+            theme_info.style_type = style_type
+            theme_info.ascription_type = ascription_type
+            if app_id != "":
+                theme_info.app_id = app_id
+                theme_info.is_private = 1
+            theme_info.sort_index = int(theme_total) + 1
+            theme_info.is_release = 1
+            theme_info.create_date = SevenHelper.get_now_datetime()
+            theme_id = theme_info_model.add_entity(theme_info)
+            if theme_id:
+                theme_ver = ThemeVer()
+                theme_ver.app_id = theme_info.app_id
+                theme_ver.out_id = out_id
+                theme_ver.theme_id = theme_id
+                theme_ver.client_json = client_json
+                theme_ver.ver_no = ver_no
+                theme_ver.create_date = theme_info.create_date
+                theme_ver_model.add_entity(theme_ver)
+
+        return invoke_result_data
+
+    def save_skin(self, app_id, skin_name, client_json, server_json, theme_out_id, skin_out_id, style_type=0):
+        """
+        :description: 保存皮肤
+        :param app_id：应用标识
+        :param skin_name：皮肤名称
+        :param client_json：客户端内容json
+        :param server_json：服务端内容json
+        :param theme_out_id：样式外部id
+        :param skin_out_id：皮肤外部id
+        :param style_type：样式类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not skin_out_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+        skin_info_model = SkinInfoModel(context=self.context)
+        skin_info = skin_info_model.get_entity("out_id=%s", params=[skin_out_id])
+        if skin_info:
+            if client_json:
+                skin_info_model.update_table('client_json=%s', 'out_id=%s', params=[client_json, skin_out_id])
+            if server_json:
+                skin_info_model.update_table('server_json=%s', 'out_id=%s', params=[server_json, skin_out_id])
+        else:
+            skin_info_total = skin_info_model.get_total('theme_out_id=%s', params=theme_out_id)
+            if not skin_name:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "皮肤名称不能为空"
+                return invoke_result_data
+            theme_info_model = ThemeInfoModel(context=self.context)
+            theme_info = theme_info_model.get_entity("out_id=%s", params=theme_out_id)
+            if not theme_info:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "没有找到对应主题"
+                return invoke_result_data
+            skin_info = SkinInfo()
+            skin_info.skin_name = skin_name
+            skin_info.client_json = client_json
+            skin_info.server_json = server_json
+            skin_info.style_type = style_type
+            if app_id != "":
+                skin_info.app_id = app_id
+            skin_info.sort_index = skin_info_total + 1
+            skin_info.theme_id = theme_info.id
+            skin_info.create_date = SevenHelper.get_now_datetime()
+            skin_info.modify_date = SevenHelper.get_now_datetime()
+            skin_info.out_id = skin_out_id
+            skin_info.theme_out_id = theme_out_id
+            skin_id = skin_info_model.add_entity(skin_info)
+        invoke_result_data.data = skin_id
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/cache_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/cache_model.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,464 +1,624 @@
-# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-03-06 23:17:54
-@LastEditTime: 2021-10-09 18:21:02
-@LastEditors: HuangJianYi
-:Description: 数据库基础操作类
-"""
-import json
-from copy import deepcopy
-from seven_framework.base_model import *
-from seven_framework import *
-from seven_framework.redis import *
-
-
-class CacheModel(BaseModel):
-
-    def __init__(self, model_class, sub_table):
-        """
-        :Description: 数据缓存业务模型
-        :param model_class: 实体对象类
-        :param sub_table: 分表标识
-        :last_editors: HuangJianYi
-        """
-        super(CacheModel,self).__init__(model_class, sub_table)
-
-    def __get_dependency_key(self, dependency_key=''):
-        """
-        :Description: 获取依赖建
-        :param dependencyKey: 依赖键
-        :return: 依赖建
-        :last_editors: HuangJianYi
-        """
-        if not dependency_key:
-            dependency_key = "dependency_" + self.table_name.lower()
-        return dependency_key
-
-    def __get_cache_key(self, field, where='', group_by='', order_by='', limit='', params=None):
-        """
-        :Description: 获取缓存key
-        :param field: 查询字段
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param params: 参数化查询参数
-        :return: 缓存key
-        :last_editors: HuangJianYi
-        """
-        params_str = ""
-        if params:
-            if isinstance(params,list):
-                for param in params:
-                    params_str += "_" + str(param)
-            else:
-                params_str += "_" + str(params)
-        cache_key = str(field + "_" + where + "_" + group_by + "_" + order_by + "_" + limit + params_str).replace(" ", "").lower()
-        return CryptoHelper.md5_encrypt(cache_key)
-        
-    def __get_dependency_cache_key(self, dependency_key, cache_key):
-        """
-        :Description: 获取依赖缓存key
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :return: 依赖缓存key
-        :last_editors: HuangJianYi
-        """
-        return CryptoHelper.md5_encrypt(dependency_key+cache_key)
-
-    def __get_dependency_cache(self, dependency_key, cache_key):
-        """
-        :Description: 获取依赖缓存值
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :return: 依赖缓存值
-        :last_editors: HuangJianYi
-        """
-        dependency_cache_key = self.__get_dependency_cache_key(dependency_key,cache_key)
-        redis_init = self.__redis_init()
-        dependency_date_value = redis_init.get(dependency_key)
-        if not dependency_date_value:
-            redis_init.delete(dependency_cache_key)
-            return None
-        dependency_date = TimeHelper.format_time_to_datetime(dependency_date_value)
-        cache_savetime_key = dependency_cache_key + "_savetime"
-        cache_savetime_value = redis_init.get(cache_savetime_key)
-        if not cache_savetime_value:
-            redis_init.delete(cache_savetime_key)
-            redis_init.delete(dependency_cache_key)
-            return None
-        cache_savetime_date = TimeHelper.format_time_to_datetime(cache_savetime_value)
-        if cache_savetime_date < dependency_date:
-            redis_init.delete(cache_savetime_key)
-            redis_init.delete(dependency_cache_key)
-            return None
-        cache_data = redis_init.get(dependency_cache_key)
-        if not cache_data:
-            return None
-        elif cache_data == 'null':
-            return cache_data
-        elif cache_data == '0':
-            return cache_data
-        else:
-            cache_data = json.loads(cache_data)
-            return cache_data
-                             
-    def __set_dependency_cache(self, dependency_key, cache_key,value, cache_expire):
-        """
-        :Description: 获取依赖缓存值
-        :param dependency_key: 依赖键
-        :param cache_key: 缓存key
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if not value:
-            return
-        redis_init = self.__redis_init()
-        dependency_date_value = redis_init.get(dependency_key)
-        if not dependency_date_value:
-            redis_init.set(dependency_key,str(TimeHelper.get_now_format_time()),ex=config.get_value("dependency_cache_expire",60*60))
-        dependency_cache_key = self.__get_dependency_cache_key(dependency_key,cache_key)
-        redis_init.set(dependency_cache_key + "_savetime",str(TimeHelper.get_now_format_time()),ex=cache_expire)
-        return redis_init.set(dependency_cache_key,JsonHelper.json_dumps(value),ex=cache_expire)
-
-    def __redis_init(self, db=None, decode_responses=True):
-        """
-        :description: redis初始化
-        :return: redis_cli
-        :last_editors: HuangJianYi
-        """
-        host = config.get_value("redis")["host"]
-        port = config.get_value("redis")["port"]
-        if not db:
-            db = config.get_value("redis")["db"]
-        password = config.get_value("redis")["password"]
-        redis_cli = RedisHelper.redis_init(host, port, db, password, decode_responses=decode_responses)
-        return redis_cli
-
-    def delete_dependency_key(self, dependency_key=''):
-        """
-        :Description: 删除依赖键
-        :param dependency_key: 依赖键,为空则删除默认依赖建
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        redis_init = self.__redis_init()
-        return redis_init.delete(self.__get_dependency_key(dependency_key))
-
-    def get_cache_list(self, where='', group_by='', order_by='', limit='', params=None,dependency_key='', cache_expire=600):
-        """
-        :Description: 根据条件获取列表
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 模型实体列表
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT * FROM {self.table_name}{where}{group_by}{order_by}{limit};"
-        
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "entitylist_" + self.table_name + "_" + self.__get_cache_key('*',where,group_by,order_by,limit,params)
-        list_row = self.__get_dependency_cache(dependency_key,cache_key)
-        if list_row and config.get_value("is_redis_cache",True) == True:
-            if list_row == 'null':
-                return None    
-            return self._BaseModel__row_entity_list(list_row) 
-        else:
-            list_row = self.db.fetch_all_rows(sql, params)
-            cache_value = deepcopy(list_row)
-            if not cache_value:
-                cache_value = None
-            self.__set_dependency_cache(dependency_key,cache_key,cache_value,cache_expire)
-            return self._BaseModel__row_entity_list(list_row)
-
-    def get_cache_page_list(self, field="*", page_index=0, page_size=20, where='', group_by='', order_by='', params=None, dependency_key='', cache_expire=600):
-        """
-        :Description: 分页获取数据
-        :param field: 查询字段 
-        :param page_index: 分页页码 0为第一页
-        :param page_size: 分页返回数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 模型实体列表
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY " + group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        limit = f"{str(int(page_index) * int(page_size))},{str(page_size)}"
-
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit};"
-        count_sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by};"
-        
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "entitypagelist_" + self.table_name + "_" + self.__get_cache_key(field,where,group_by,order_by,limit,params)
-        page_list = self.__get_dependency_cache(dependency_key,cache_key)
-        if page_list and config.get_value("is_redis_cache",True) == True:
-            return self._BaseModel__row_entity_list(page_list["data"]),page_list["row_count"]
-        else:
-            list_row = self.db.fetch_all_rows(sql, params)
-            row = self.db.fetch_one_row(count_sql, params)
-            if row and 'count' in row and int(row['count']) > 0:
-                row_count = int(row["count"])
-            else:
-                row_count = 0
-            page_list = {}
-            page_list["data"] = list_row
-            page_list["row_count"] = row_count
-            self.__set_dependency_cache(dependency_key,cache_key,page_list,cache_expire)
-            return self._BaseModel__row_entity_list(page_list["data"]), row_count
-            
-    def get_cache_entity(self, where='', group_by='', order_by='',  params=None, dependency_key='', cache_expire=600):
-        """
-        :Description: 根据条件获取实体对象
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 模型实体
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        sql = f"SELECT * FROM {self.table_name}{where}{group_by}{order_by} LIMIT 1;"
-
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "entity_" + self.table_name + "_" + self.__get_cache_key('*',where,group_by,order_by,'1',params)
-        one_row = self.__get_dependency_cache(dependency_key,cache_key)
-        if one_row and config.get_value("is_redis_cache",True) == True:
-            if one_row == 'null':
-                return None    
-            return self._BaseModel__row_entity(one_row)
-        else:
-            one_row = self.db.fetch_one_row(sql, params)
-            self.__set_dependency_cache(dependency_key,cache_key,one_row,cache_expire)
-            return self._BaseModel__row_entity(one_row)
-
-    def get_cache_entity_by_id(self, primary_key_id, dependency_key='', cache_expire=600):
-        """
-        :Description: 根据主键值获取实体对象
-        :param primary_key_id: 主键ID值
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 模型实体
-        :last_editors: HuangJianYi
-        """
-        where = f"{self.primary_key_field}=%s"
-        params = [primary_key_id]
-        sql = f"SELECT * FROM {self.table_name} WHERE {where};"
- 
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "entityone_" + self.table_name + "_" + self.__get_cache_key('*',where,'','','',params)
-        one_row = self.__get_dependency_cache(dependency_key,cache_key)
-        if one_row and config.get_value("is_redis_cache",True) == True:
-            if one_row == 'null':
-                return None 
-            return self._BaseModel__row_entity(one_row)
-        else:
-            one_row = self.db.fetch_one_row(sql,params)
-            self.__set_dependency_cache(dependency_key,cache_key,one_row,cache_expire)
-            return self._BaseModel__row_entity(one_row)
-
-    def get_cache_total(self, where='', group_by='', field=None, params=None,dependency_key='', cache_expire=600):
-        """
-        :Description: 根据条件获取数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param params: 参数化查询参数
-        :param field: count(传参)
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 查询符合条件的行的数量
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if not field:
-            field = self.primary_key_field
-        sql = f"SELECT COUNT({field}) AS count FROM {self.table_name}{where}{group_by};"
-
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "total_" + self.table_name + "_" + self.__get_cache_key(field,where,group_by,'','',params)
-        total = self.__get_dependency_cache(dependency_key,cache_key)
-        if total and config.get_value("is_redis_cache",True) == True:
-            if total == '0':
-                return 0
-            else:
-                return total
-        else:
-            list_row = self.db.fetch_one_row(sql, params)
-            if list_row and 'count' in list_row:
-                self.__set_dependency_cache(dependency_key,cache_key,list_row['count'],cache_expire)
-                return list_row['count']
-            return 0
-
-    def get_cache_dict(self, where='', group_by='', order_by='', limit='', field="*", params=None, dependency_key='', cache_expire=600):
-        """
-        :Description: 返回字典dict
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param field: 查询字段 
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 返回匹配条件的第一行字典数据
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit}"
-
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "dict_" + self.table_name + "_" + self.__get_cache_key(field,where,group_by,order_by,limit,params)
-        one_row = self.__get_dependency_cache(dependency_key,cache_key)
-        
-        if one_row and config.get_value("is_redis_cache",True) == True:
-            if one_row == 'null':
-                return None    
-            return one_row
-        else:
-            one_row = self.db.fetch_one_row(sql, params)
-            self.__set_dependency_cache(dependency_key,cache_key,one_row,cache_expire)
-            return one_row
-
-    def get_cache_dict_by_id(self, primary_key_id, dependency_key='', cache_expire=600, field="*"):
-        """
-        :Description: 根据主键ID获取dict
-        :param primary_key_id: 主键ID值
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :param field: 查询字段 
-        :return: 返回匹配id的第一行字典数据
-        :last_editors: HuangJianYi
-        """
-        where = f"{self.primary_key_field}=%s"
-        params = [primary_key_id]
-        sql = f"SELECT {field} FROM {self.table_name} WHERE {where};"
-
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "dictone_" + self.table_name + "_" + self.__get_cache_key(field,where,'','','',params)
-        one_row = self.__get_dependency_cache(dependency_key,cache_key)
-        if one_row and config.get_value("is_redis_cache",True) == True:
-            if one_row == 'null':
-                return None    
-            return one_row
-        else:
-            one_row = self.db.fetch_one_row(sql,params)
-            self.__set_dependency_cache(dependency_key,cache_key,one_row,cache_expire)
-            return one_row
-
-    def get_cache_dict_list(self, where='', group_by='', order_by='', limit='', field="*", params=None, dependency_key='',cache_expire=600):
-        """
-        :Description: 返回字典列表dict list
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param limit:  LIMIT 语句
-        :param field: 查询字段 
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY "+group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        if limit:
-            limit = " LIMIT "+str(limit)
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
-
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "dictlist_" + self.table_name + "_" + self.__get_cache_key(field,where,group_by,order_by,limit,params)
-        list = self.__get_dependency_cache(dependency_key,cache_key)
-        if list and config.get_value("is_redis_cache",True) == True:
-            return list
-        else:
-            list = self.db.fetch_all_rows(sql, params)
-            self.__set_dependency_cache(dependency_key,cache_key,list,cache_expire)
-            return list
-
-    def get_cache_dict_page_list(self, field="*", page_index=0 ,page_size=20, where='', group_by='' ,order_by='' ,params=None, dependency_key='', cache_expire=600):
-        """
-        :Description: 获取分页字典数据
-        :param field: 查询字段 
-        :param page_index: 分页页码 0为第一页
-        :param page_size: 分页返回数据数量
-        :param where: 数据库查询条件语句
-        :param group_by: GROUP BY 语句
-        :param order_by:  ORDER BY 语句
-        :param params: 参数化查询参数
-        :param dependencyKey: 依赖键
-        :param cache_expire: 缓存时间（单位秒）
-        :return: 数据字典数组
-        :last_editors: HuangJianYi
-        """
-        if where and where.strip() != '':
-            where = " WHERE " + where
-        if group_by and group_by.strip() != '':
-            group_by = " GROUP BY " + group_by
-        if order_by and order_by.strip() != '':
-            order_by = " ORDER BY " + order_by
-        limit = f"{str(int(page_index) * int(page_size))},{str(page_size)}"
-        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit}"
-        count_sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by};"
-   
-        dependency_key = self.__get_dependency_key(str(dependency_key))
-        cache_key = "dictpagelist_" + self.table_name + "_" + self.__get_cache_key(field,where,group_by,order_by,limit,params)
-        page_list = self.__get_dependency_cache(dependency_key,cache_key)
-        if page_list and config.get_value("is_redis_cache",True) == True:
-            return page_list["data"],page_list["row_count"]
-        else:
-            list_row = self.db.fetch_all_rows(sql, params)
-            row = self.db.fetch_one_row(count_sql, params)
-            if row and 'count' in row and int(row['count']) > 0:
-                row_count = int(row["count"])
-            else:
-                row_count = 0
-            page_list = {}
-            page_list["data"] = list_row
-            page_list["row_count"] = row_count
-            self.__set_dependency_cache(dependency_key,cache_key,page_list,cache_expire)
-            return list_row, row_count
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-03-06 23:17:54
+@LastEditTime: 2023-07-13 16:11:57
+@LastEditors: HuangJianYi
+:Description: 数据缓存业务模型
+"""
+import json
+from copy import deepcopy
+from seven_framework.base_model import *
+from seven_framework import *
+from seven_framework.redis import *
+from seven_cloudapp_frame.libs.common import *
+
+class CacheModel(BaseModel):
+
+    def __init__(self, model_class, sub_table):
+        """
+        :Description: 数据缓存业务模型,用于mysql数据同步到redis，dependency_cache_expire(依赖建缓存时间默认300分钟，普通缓存默认30分钟),查询结果是None和0不会被缓存，除非配置文件设置is_cache_empty=True
+        :param model_class: 实体对象类
+        :param sub_table: 分表标识
+        :last_editors: HuangJianYi
+        """
+        self.cache_prefix = "data_cache"
+        super(CacheModel,self).__init__(model_class, sub_table)
+
+    def get_dependency_key(self, dependency_key=''):
+        """
+        :Description: 获取依赖建
+        :param dependencyKey: 依赖键
+        :return: 依赖建
+        :last_editors: HuangJianYi
+        """
+        if not dependency_key:
+            dependency_key = self.table_name.lower()
+        return self.cache_prefix + ":" + "dependency_" + dependency_key
+
+    def get_cache_key(self, prefix_key, field='*', where='', group_by='', order_by='', limit='', params=None):
+        """
+        :Description: 获取缓存key
+        :param prefix_key: 缓存key前缀[entity、entityone、entitylist、entitypagelist、total、dict、dictone、dictlist、dictpagelist]
+        :param field: 查询字段
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param params: 参数化查询参数
+        :return: 缓存key
+        :last_editors: HuangJianYi
+        """
+        params_str = ""
+        if params:
+            if isinstance(params,list):
+                for param in params:
+                    params_str += "_" + str(param)
+            else:
+                params_str += "_" + str(params)
+        suffix_key = CryptoHelper.md5_encrypt(str(field + "_" + where + "_" + group_by + "_" + order_by + "_" + limit + params_str).replace(" ", "").lower())
+        return prefix_key + "_" + self.table_name + "_" + suffix_key
+
+    def get_dependency_cache_key(self, dependency_key, cache_key):
+        """
+        :Description: 获取依赖缓存key
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :return: 依赖缓存key
+        :last_editors: HuangJianYi
+        """
+        return self.cache_prefix + ":" + CryptoHelper.md5_encrypt(dependency_key+cache_key)
+
+    def get_dependency_cache(self, dependency_key, cache_key, redis_config_dict=None):
+        """
+        :Description: 获取依赖缓存值
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :param redis_config_dict: redis_config_dict
+        :return: 依赖缓存值
+        :last_editors: HuangJianYi
+        """
+        if share_config.get_value("is_redis_cache",True) == False:
+            return None
+        dependency_cache_key = self.get_dependency_cache_key(dependency_key, cache_key)
+        redis_init = self.__redis_init(config_dict=redis_config_dict)
+        dependency_date_value = redis_init.get(dependency_key)
+        if not dependency_date_value:
+            redis_init.delete(dependency_cache_key)
+            return None
+        dependency_date = TimeHelper.format_time_to_datetime(dependency_date_value)
+        cache_savetime_key = dependency_cache_key + "_savetime"
+        cache_savetime_value = redis_init.get(cache_savetime_key)
+        if not cache_savetime_value:
+            redis_init.delete(cache_savetime_key)
+            redis_init.delete(dependency_cache_key)
+            return None
+        cache_savetime_date = TimeHelper.format_time_to_datetime(cache_savetime_value)
+        if cache_savetime_date < dependency_date:
+            redis_init.delete(cache_savetime_key)
+            redis_init.delete(dependency_cache_key)
+            return None
+        cache_data = redis_init.get(dependency_cache_key)
+        if not cache_data:
+            return None
+        elif cache_data in ['null','0']:
+            return cache_data
+        else:
+            size = len(cache_data) / 1024
+            limit_size = share_config.get_value("cache_limit_size", 500) # 单位KB
+            if size >= limit_size and limit_size > 0:
+                if hasattr(self, "db"):
+                    if hasattr(self.db, "context"):
+                        if hasattr(self.db.context, "logging_link_error"):
+                            self.db.context.logging_link_error(f"超过缓存值大小阀值{limit_size}KB,当前值为{size}KB,dependency_key:{dependency_key}")
+            cache_data = json.loads(cache_data)
+            return cache_data
+
+    def log_cache(self, dependency_key, cache_key, cache_data, sql, params):
+        """
+        :Description: 记录从缓存取到的数据到日志
+        :param dependency_key: dependency_key
+        :param cache_key: cache_key
+        :param cache_data: 缓存数据
+        :param sql: sql
+        :param params: params
+        :return:
+        :last_editors: HuangJianYi
+        """
+        if hasattr(self, "db") and share_config.get_value("log_redis_cache",True):
+            if hasattr(self.db, "context"):
+                if hasattr(self.db.context, "logging_link_info"):
+                    log_info = {"sql":sql, "params":params, "result":cache_data, "dependency_key":dependency_key, "cache_key":self.get_dependency_cache_key(dependency_key,cache_key)}
+                    self.db.context.logging_link_info("data_cache:" + JsonHelper.json_dumps(log_info))
+
+    def set_dependency_cache(self, dependency_key, cache_key, value, cache_expire, redis_config_dict=None):
+        """
+        :Description: 设置依赖缓存值
+        :param dependency_key: 依赖键
+        :param cache_key: 缓存key
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        is_cache_empty = share_config.get_value("is_cache_empty",False)
+        if is_cache_empty == False:
+            if not value:
+                return
+        redis_init = self.__redis_init(config_dict=redis_config_dict)
+        dependency_date_value = redis_init.get(dependency_key)
+        if not dependency_date_value:
+            redis_init.set(dependency_key,str(TimeHelper.get_now_format_time()),ex=share_config.get_value("dependency_cache_expire",5*60*60))
+        dependency_cache_key = self.get_dependency_cache_key(dependency_key,cache_key)
+        redis_init.set(dependency_cache_key + "_savetime",str(TimeHelper.get_now_format_time()),ex=cache_expire)
+        return redis_init.set(dependency_cache_key,JsonHelper.json_dumps(value),ex=cache_expire)
+
+    def __redis_init(self, config_dict=None, decode_responses=True):
+        """
+        :description: redis初始化
+        :param config_dict: config_dict
+        :param decode_responses: decode_responses
+        :return: redis_cli
+        :last_editors: HuangJianYi
+        """
+        if not config_dict:
+            config_dict = config.get_value("redis_cache")
+            if not config_dict:
+                config_dict = config.get_value("redis")
+        redis_cli = RedisHelper.redis_init(config_dict=config_dict, decode_responses=decode_responses)
+        return redis_cli
+
+    def delete_dependency_key(self, dependency_key='', delay_delete_time=0.01, redis_config_dict=None):
+        """
+        :Description: 删除依赖键,支持延迟删除和重试机制，同时删除多个依赖建建议传数组，不要分开多次调用
+        :param dependency_key: 依赖键,为空则删除默认依赖建
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if share_config.get_value("is_redis_cache",True) == True:
+            count = 0
+            while count < 2:
+                count += 1
+                try:
+                    success_count = 0
+                    redis_init = self.__redis_init(config_dict=redis_config_dict)
+                    if delay_delete_time > 0:
+                        time.sleep(delay_delete_time)
+                    if isinstance(dependency_key,list):
+                        dependency_keys = []
+                        for key in dependency_key:
+                            dependency_keys.append(self.get_dependency_key(key))
+                        success_count = redis_init.delete(*dependency_keys)
+                        if success_count == len(dependency_key):
+                            break
+                    else:
+                        success_count = redis_init.delete(self.get_dependency_key(dependency_key))
+                        if success_count == 1:
+                            break
+                except:
+                    print(traceback.print_exc())
+                    pass
+
+    def get_cache_list(self, where='', group_by='', order_by='', limit='', field="*", params=None,dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取列表
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体列表
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entitylist',field,where,group_by,order_by,limit,params)
+        list_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if list_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, list_row, sql, params)
+            if list_row == 'null':
+                return []
+            return self._BaseModel__row_entity_list(list_row)
+        else:
+            list_row = self.db.fetch_all_rows(sql, params)
+            cache_value = deepcopy(list_row)
+            if not cache_value:
+                cache_value = []
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,cache_value,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity_list(list_row)
+
+    def get_cache_page_list(self, field="*", page_index=0, page_size=20, where='', group_by='', order_by='', params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
+        """
+        :Description: 分页获取数据
+        :param field: 查询字段 
+        :param page_index: 分页页码 0为第一页
+        :param page_size: 分页返回数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体列表
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY " + group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+
+        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entitypagelist',field,where,group_by,order_by,limit,params)
+        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if page_list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, page_list, sql, params)
+            if page_count_mode == "total":
+                return self._BaseModel__row_entity_list(page_list["data"]),page_list["row_count"]
+            elif page_count_mode == "next":
+                return self._BaseModel__row_entity_list(page_list["data"]),bool(page_list["is_next_page"])
+            else:
+                return self._BaseModel__row_entity_list(page_list["data"])
+        else:
+            page_list = {}
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            if page_count_mode == "total":
+                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
+                if group_by:
+                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
+                row = self.db.fetch_one_row(sql, params)
+                if row and 'count' in row and int(row['count']) > 0:
+                    row_count = int(row["count"])
+                else:
+                    row_count = 0
+                page_list["data"] = list_row
+                page_list["row_count"] = row_count
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"]), row_count
+            elif page_count_mode == "next":
+                is_next_page = len(list_row) == page_size+1
+                if list_row and len(list_row) > 0:
+                    list_row = list_row[:page_size]
+                page_list["data"] = list_row
+                page_list["is_next_page"] = is_next_page
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"]), is_next_page
+            else:
+                page_list["data"] = list_row
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return self._BaseModel__row_entity_list(page_list["data"])
+
+    def get_cache_entity(self, where='', group_by='', order_by='',  params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取实体对象
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        sql = f"SELECT * FROM {self.table_name}{where}{group_by}{order_by} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entity','*',where,group_by,order_by,'1',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return self._BaseModel__row_entity(one_row)
+        else:
+            one_row = self.db.fetch_one_row(sql, params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity(one_row)
+
+    def get_cache_entity_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据主键值获取实体对象
+        :param primary_key_id: 主键ID值
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 模型实体
+        :last_editors: HuangJianYi
+        """
+        where = f"{self.primary_key_field}=%s"
+        params = [primary_key_id]
+        sql = f"SELECT * FROM {self.table_name} WHERE {where} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('entityone','*',where,'','','',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return self._BaseModel__row_entity(one_row)
+        else:
+            one_row = self.db.fetch_one_row(sql,params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            return self._BaseModel__row_entity(one_row)
+
+    def get_cache_total(self, where='', group_by='', field=None, params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 根据条件获取数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param params: 参数化查询参数
+        :param field: count(传参)
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 查询符合条件的行的数量
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if not field:
+            field = self.primary_key_field
+        sql = f"SELECT COUNT({field}) AS count FROM {self.table_name}{where}{group_by};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('total',field,where,group_by,'','',params)
+        total = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if total and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, total, sql, params)
+            if total == '0':
+                return 0
+            else:
+                return total
+        else:
+            list_row = self.db.fetch_one_row(sql, params)
+            if list_row and 'count' in list_row:
+                config_cache_expire = share_config.get_value("cache_expire",0)
+                if config_cache_expire > 0:
+                    cache_expire = config_cache_expire
+                self.set_dependency_cache(dependency_key,cache_key,list_row['count'],cache_expire,redis_config_dict)
+                return list_row['count']
+            return 0
+
+    def get_cache_dict(self, where='', group_by='', order_by='', limit='1', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 返回字典dict
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 返回匹配条件的第一行字典数据
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit}"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dict',field,where,group_by,order_by,limit,params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return one_row
+        else:
+            one_row = self.db.fetch_one_row(sql, params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            if one_row:
+                for field in one_row:
+                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return one_row
+
+    def get_cache_dict_by_id(self, primary_key_id, dependency_key='', cache_expire=1800, field="*", redis_config_dict=None):
+        """
+        :Description: 根据主键ID获取dict
+        :param primary_key_id: 主键ID值
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param field: 查询字段
+        :param redis_config_dict: redis_config_dict
+        :return: 返回匹配id的第一行字典数据
+        :last_editors: HuangJianYi
+        """
+        where = f"{self.primary_key_field}=%s"
+        params = [primary_key_id]
+        sql = f"SELECT {field} FROM {self.table_name} WHERE {where} LIMIT 1;"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictone',field,where,'','','',params)
+        one_row = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if one_row and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, one_row, sql, params)
+            if one_row == 'null':
+                return None
+            return one_row
+        else:
+            one_row = self.db.fetch_one_row(sql,params)
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,one_row,cache_expire,redis_config_dict)
+            if one_row:
+                for field in one_row:
+                    one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return one_row
+
+    def get_cache_dict_list(self, where='', group_by='', order_by='', limit='', field="*", params=None, dependency_key='', cache_expire=1800, redis_config_dict=None):
+        """
+        :Description: 返回字典列表dict list
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param limit:  LIMIT 语句
+        :param field: 查询字段 
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param redis_config_dict: redis_config_dict
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY "+group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+        if limit:
+            limit = " LIMIT "+str(limit)
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by}{limit};"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictlist',field,where,group_by,order_by,limit,params)
+        list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, list, sql, params)
+            return list
+        else:
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            self.set_dependency_cache(dependency_key,cache_key,list_row,cache_expire,redis_config_dict)
+            if list_row and len(list_row) > 0:
+                for one_row in list_row:
+                    for field in one_row:
+                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            return list_row
+
+    def get_cache_dict_page_list(self, field="*", page_index=0 ,page_size=20, where='', group_by='' ,order_by='' , params=None, dependency_key='', cache_expire=1800, page_count_mode='total', redis_config_dict=None):
+        """
+        :Description: 获取分页字典数据
+        :param field: 查询字段 
+        :param page_index: 分页页码 0为第一页
+        :param page_size: 分页返回数据数量
+        :param where: 数据库查询条件语句
+        :param group_by: GROUP BY 语句
+        :param order_by:  ORDER BY 语句
+        :param params: 参数化查询参数
+        :param dependencyKey: 依赖键
+        :param cache_expire: 缓存时间（单位秒）
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :param redis_config_dict: redis_config_dict
+        :return: 数据字典数组
+        :last_editors: HuangJianYi
+        """
+        if where and where.strip() != '':
+            where = " WHERE " + where
+        if group_by and group_by.strip() != '':
+            group_by = " GROUP BY " + group_by
+        if order_by and order_by.strip() != '':
+            order_by = " ORDER BY " + order_by
+
+        limit = f"{str(int(page_index) * int(page_size))},{str(page_size if page_count_mode != 'next' else page_size+1)}"
+        sql = f"SELECT {field} FROM {self.table_name}{where}{group_by}{order_by} LIMIT {limit}"
+
+        dependency_key = self.get_dependency_key(str(dependency_key))
+        cache_key = self.get_cache_key('dictpagelist',field,where,group_by,order_by,limit,params)
+        page_list = self.get_dependency_cache(dependency_key,cache_key,redis_config_dict)
+        if page_list and share_config.get_value("is_redis_cache",True) == True:
+            self.log_cache(dependency_key, cache_key, page_list, sql, params)
+            if page_count_mode == "total":
+                return page_list["data"],page_list["row_count"]
+            elif page_count_mode == "next":
+                return page_list["data"],bool(page_list["is_next_page"])
+            else:
+                return page_list["data"]
+        else:
+            config_cache_expire = share_config.get_value("cache_expire",0)
+            if config_cache_expire > 0:
+                cache_expire = config_cache_expire
+            page_list = {}
+            list_row = self.db.fetch_all_rows(sql, params)
+            if not list_row:
+                list_row = []
+            if list_row and len(list_row) > 0:
+                for one_row in list_row:
+                    for field in one_row:
+                        one_row[field] = self._BaseModel__convert_field_type(one_row[field])
+            if page_count_mode == "total":
+                sql = f"SELECT COUNT({self.primary_key_field}) AS count FROM {self.table_name}{where}{group_by}"
+                if group_by:
+                    sql = f"SELECT COUNT(*) as count FROM ({sql}) temp_table;"
+                row = self.db.fetch_one_row(sql, params)
+                if row and 'count' in row and int(row['count']) > 0:
+                    row_count = int(row["count"])
+                else:
+                    row_count = 0
+                page_list["data"] = list_row
+                page_list["row_count"] = row_count
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row, row_count
+            elif page_count_mode == "next":
+                is_next_page = len(list_row) == page_size+1
+                if list_row and len(list_row) > 0:
+                    list_row = list_row[:page_size]
+                page_list["data"] = list_row
+                page_list["is_next_page"] = is_next_page
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row, is_next_page
+            else:
+                page_list["data"] = list_row
+                self.set_dependency_cache(dependency_key,cache_key,page_list,cache_expire,redis_config_dict)
+                return list_row
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/console_models/asset_console_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/console_models/asset_console_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,260 +1,287 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-19 13:37:16
-@LastEditTime: 2021-10-21 10:48:44
-@LastEditors: HuangJianYi
-@Description: 
-"""
-import threading, multiprocessing
-from seven_framework.console.base_console import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.asset.asset_inventory_model import *
-from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
-from seven_cloudapp_frame.models.db_models.asset.asset_log_model import *
-
-
-
-class AssetConsoleModel():
-    """
-    :description: 资产控制台业务模型
-    """
-    def console_asset_warn(self, mod_count=10):
-        """
-        :description: 控制台资产预警
-        :param mod_count: 单表队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        sub_table_count = config.get_value("asset_sub_table_count", 0)
-        if sub_table_count == 0:
-
-            self._start_process_user_asset_warn(None, mod_count)
-            self._start_process_asset_inventory_warn(None, mod_count)
-
-        else:
-            for i in range(sub_table_count):
-                self._start_process_user_asset_warn(str(i), mod_count)
-                self._start_process_asset_inventory_warn(str(i), mod_count)
-
-        l = threading.Thread(target=self._process_onlyid_warn, args=[])
-        l.start()
-
-        k = threading.Thread(target=self._push_warn_notice, args=[])
-        k.start()
-
-    def _start_process_user_asset_warn(self, sub_table, mod_count):
-
-        for i in range(mod_count):
-
-            t = threading.Thread(target=self._process_user_asset_warn, args=[sub_table, i, mod_count])
-            t.start()
-
-    def _start_process_asset_inventory_warn(self, sub_table, mod_count):
-
-        for i in range(mod_count):
-
-            j = threading.Thread(target=self._process_asset_inventory_warn, args=[sub_table, i, mod_count])
-            j.start()
-
-    def _process_user_asset_warn(self, sub_table, mod_value, mod_count):
-        """
-        :description: 处理用户资产负数预警
-        :param sub_table: 分表名称
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        asset_log_model = AssetLogModel(sub_table=sub_table)
-        asset_warn_notice_model = AssetWarnNoticeModel()
-        print(f"{TimeHelper.get_now_format_time()} 用户资产负数预警队列{mod_value}启动")
-        while True:
-            try:
-                now_date = TimeHelper.get_now_format_time()
-                now_day_int = SevenHelper.get_now_day_int()
-                asset_log_list = asset_log_model.get_list(f"MOD(user_id,{mod_count})={mod_value} and now_value<0 and {now_day_int}>warn_day ", order_by="create_date asc", limit="100")
-                if len(asset_log_list) > 0:
-                    for asset_log in asset_log_list:
-                        try:
-                            asset_log.warn_date = now_date
-                            asset_log.warn_day = now_day_int
-                            asset_log_model.update_entity(asset_log, "warn_date,warn_day")
-
-                            asset_warn_notice = AssetWarnNotice()
-                            asset_warn_notice.app_id = asset_log.app_id
-                            asset_warn_notice.act_id = asset_log.act_id
-                            asset_warn_notice.handler_name = asset_log.handler_name
-                            asset_warn_notice.request_code = asset_log.request_code
-                            asset_warn_notice.user_id = asset_log.user_id
-                            asset_warn_notice.open_id = asset_log.open_id
-                            asset_warn_notice.user_nick = asset_log.user_nick
-                            asset_warn_notice.asset_type = asset_log.asset_type
-                            asset_warn_notice.asset_object_id = asset_log.asset_object_id
-                            if asset_log.asset_type == 1:
-                                asset_warn_notice.log_title = "次数异常"
-                                asset_warn_notice.info_desc = f"值为负数:{asset_log.now_value}"
-                            elif asset_log.asset_type == 2:
-                                asset_warn_notice.log_title = "积分异常"
-                                asset_warn_notice.info_desc = f"值为负数:{asset_log.now_value}"
-                            else:
-                                asset_warn_notice.log_title = f"价格档位异常"
-                                asset_warn_notice.info_desc = f"档位ID:{asset_log.asset_object_id},值为负数:{asset_log.now_value}"
-
-                            asset_warn_notice.info_json = SevenHelper.json_dumps(asset_log)
-                            asset_warn_notice.create_date = now_date
-                            asset_warn_notice.create_day = now_day_int
-                            asset_warn_notice_model.add_entity(asset_warn_notice)
-
-                        except Exception as ex:
-                            logger_error.error(f"用户资产负数预警队列{mod_value}异常,json串:{SevenHelper.json_dumps(asset_log)},ex:{traceback.format_exc()}")
-                            continue
-                else:
-                    time.sleep(10)
-            except Exception as ex:
-                time.sleep(10)
-
-    def _process_onlyid_warn(self):
-        """
-        :description: 处理唯一值并发预警
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        asset_warn_notice_model = AssetWarnNoticeModel()
-        redis_init = SevenHelper.redis_init()
-        while True:
-            try:
-                hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
-                hkeys = redis_init.hkeys(hash_name_1)
-                if len(hkeys)<=0:
-                    time.sleep(10)
-                    continue
-                for key in hkeys:
-                    date_start = TimeHelper.format_time_to_datetime(format='%Y-%m-%d %H:%M')
-                    date_end = date_start + datetime.timedelta(minutes=5)
-                    date_list = []
-                    while date_start < date_end:
-                        date_list.append(str(TimeHelper.datetime_to_format_time(date_start, '%Y%m%d%H%M')))
-                        date_start += datetime.timedelta(minutes=1)
-                    hash_name_2 = f"{hash_name_1}:{key}"
-                    value_list = redis_init.hmget(hash_name_2,date_list)
-                    if not value_list or len(value_list)<=0:
-                        continue
-                    count = 0
-                    for value in value_list:
-                        count += int(value)
-                    if count <= 0:
-                        continue
-                    hash_value_1 = redis_init.hget(hash_name_1,key)
-                    hash_value_1 = SevenHelper.json_loads(hash_value_1) if hash_value_1 else {"app_id":"","handler_name":""}
-                    asset_warn_notice = AssetWarnNotice()
-                    asset_warn_notice.app_id = hash_value_1["app_id"]
-                    asset_warn_notice.act_id = 0
-                    asset_warn_notice.handler_name = hash_value_1["handler_name"]
-                    asset_warn_notice.request_code =""
-                    asset_warn_notice.user_id = ""
-                    asset_warn_notice.open_id = ""
-                    asset_warn_notice.user_nick = ""
-                    asset_warn_notice.asset_type = 0
-                    asset_warn_notice.asset_object_id = ""
-                    asset_warn_notice.log_title = "并发拦截"
-                    asset_warn_notice.info_desc = f"{date_start}-{date_end}进行了{count}次拦截"
-                    asset_warn_notice.info_json = {}
-                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
-                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
-                    asset_warn_notice_model.add_entity(asset_warn_notice)
-                time.sleep(5*60)
-            except Exception as ex:
-                time.sleep(10)
-
-    def _push_warn_notice(self):
-        """
-        :description: 推送预警通知到消息系统
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        asset_warn_notice_model = AssetWarnNoticeModel()
-        while True:
-            try:
-                message_system_db = int(config.get_value("message_system_db",100))
-                redis_init = SevenHelper.redis_init(message_system_db)
-                warn_notice_list = asset_warn_notice_model.get_list("is_notice=0",order_by="create_date asc",limit="50")
-                if len(warn_notice_list) > 0:
-                    for warn_notice in warn_notice_list:
-                        try:
-                            push_message = {}
-                            push_message["project_id"] = int(config.get_value("project_name",0))
-                            push_message["app_id"] = warn_notice.app_id
-                            push_message["action_id"] = warn_notice.act_id
-                            push_message["taobao_nick_name"] = warn_notice.user_nick
-                            push_message["error_type"] = warn_notice.log_title
-                            push_message["error_message"] = warn_notice.info_desc
-                            push_message["handler"] = warn_notice.handler_name
-                            redis_init.lpush("warning_notice_queue", JsonHelper.json_dumps(push_message))
-                            warn_notice.is_notice = 1
-                            warn_notice.notice_date = SevenHelper.get_now_datetime()
-                            asset_warn_notice_model.update_entity(warn_notice,"is_notice,notice_date")
-                        except Exception as ex:
-                            logger_error.error(f"推送预警通知异常,json串:{SevenHelper.json_dumps(warn_notice)},ex:{traceback.format_exc()}")
-                            continue
-                time.sleep(1)
-            except Exception as ex:
-                time.sleep(10)
-
-    def _process_asset_inventory_warn(self, sub_table, mod_value, mod_count):
-        """
-        :description: 处理资产每日进销存是否对等预警
-        :param sub_table: 分表名称
-        :param mod_value: 当前队列值
-        :param mod_count: 队列数
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        asset_inventory_model = AssetInventoryModel(sub_table=sub_table)
-        asset_warn_notice_model = AssetWarnNoticeModel()
-        print(f"{TimeHelper.get_now_format_time()} 资产每日进销存预警队列{mod_value}启动")
-        while True:
-            try:
-                now_date = TimeHelper.get_now_format_time()
-                now_day_int = SevenHelper.get_now_day_int()
-                asset_inventory_list = asset_inventory_model.get_list(f"MOD(user_id,{mod_count})={mod_value} and create_day={now_day_int} and process_count=0", order_by="create_date asc", limit="100")
-                if len(asset_inventory_list) > 0:
-                    for asset_inventory in asset_inventory_list:
-                        try:
-                            asset_inventory.process_count = 1
-                            asset_inventory.process_date = now_date
-                            asset_inventory_model.update_entity(asset_inventory, "process_count,process_date")
-
-                            if (asset_inventory.history_value + asset_inventory.inc_value + asset_inventory.dec_value) != asset_inventory.now_value:
-
-                                asset_warn_notice = AssetWarnNotice()
-                                asset_warn_notice.app_id = asset_inventory.app_id
-                                asset_warn_notice.act_id = asset_inventory.act_id
-                                asset_warn_notice.handler_name = ""
-                                asset_warn_notice.request_code = ""
-                                asset_warn_notice.user_id = asset_inventory.user_id
-                                asset_warn_notice.open_id = asset_inventory.open_id
-                                asset_warn_notice.user_nick = asset_inventory.user_nick
-                                asset_warn_notice.asset_type = asset_inventory.asset_type
-                                asset_warn_notice.asset_object_id = asset_inventory.asset_object_id
-                                asset_warn_notice.info_desc = f"历史值:{asset_inventory.history_value},增加：{asset_inventory.inc_value},减少：{asset_inventory.dec_value},当前值:{asset_inventory.now_value}"
-                                if asset_inventory.asset_type == 1:
-                                    asset_warn_notice.log_title = "次数进销存异常"
-                                elif asset_inventory.asset_type == 2:
-                                    asset_warn_notice.log_title = "积分进销存异常"
-                                else:
-                                    asset_warn_notice.log_title = "价格档位进销存异常"
-                                    asset_warn_notice.info_desc = f"档位ID:{asset_inventory.asset_object_id}," + asset_warn_notice.info_desc
-
-                                asset_warn_notice.info_json = SevenHelper.json_dumps(asset_inventory)
-                                asset_warn_notice.create_date = now_date
-                                asset_warn_notice.create_day = now_day_int
-                                asset_warn_notice_model.add_entity(asset_warn_notice)
-
-                        except Exception as ex:
-                            logger_error.error(f"资产每日进销存预警队列{mod_value}异常,json串:{SevenHelper.json_dumps(asset_inventory)},ex:{traceback.format_exc()}")
-                            continue
-                else:
-                    time.sleep(60 * 60)
-            except Exception as ex:
-                time.sleep(10)
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-19 13:37:16
+@LastEditTime: 2023-04-20 19:18:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+import threading, multiprocessing
+from seven_framework.console.base_console import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.asset.asset_inventory_model import *
+from seven_cloudapp_frame.models.db_models.asset.asset_warn_notice_model import *
+
+
+
+class AssetConsoleModel():
+    """
+    :description: 资产控制台业务模型
+    """
+    def console_asset(self, mod_count=1):
+        """
+        :description: 控制台资产预警
+        :param mod_count: 单表队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        for i in range(mod_count):
+            j = threading.Thread(target=self._process_asset_inventory_warn, args=[i, mod_count])
+            j.start()
+
+        n = threading.Thread(target=self._process_asset_inventory_queue, args=[])
+        n.start()
+
+        t = threading.Thread(target=self._process_asset_intercept_queue, args=[])
+        t.start()
+
+    def _process_onlyid_warn(self):
+        """
+        :description: 处理唯一值并发预警
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                redis_init = SevenHelper.redis_init()
+                hash_name_1 = f"warn_handler_list_{str(SevenHelper.get_now_int(fmt='%Y%m%d'))}"
+                hkeys = redis_init.hkeys(hash_name_1)
+                if len(hkeys)<=0:
+                    time.sleep(1)
+                    continue
+                for key in hkeys:
+                    date_start = TimeHelper.format_time_to_datetime(format='%Y-%m-%d %H:%M')
+                    date_end = date_start + datetime.timedelta(minutes=5)
+                    date_list = []
+                    while date_start < date_end:
+                        date_list.append(str(TimeHelper.datetime_to_format_time(date_start, '%Y%m%d%H%M')))
+                        date_start += datetime.timedelta(minutes=1)
+                    hash_name_2 = f"{hash_name_1}:{key}"
+                    value_list = redis_init.hmget(hash_name_2,date_list)
+                    if not value_list or len(value_list)<=0:
+                        continue
+                    count = 0
+                    for value in value_list:
+                        count += int(value)
+                    if count <= 0:
+                        continue
+                    hash_value_1 = redis_init.hget(hash_name_1,key)
+                    hash_value_1 = SevenHelper.json_loads(hash_value_1) if hash_value_1 else {"app_id":"","handler_name":""}
+                    asset_warn_notice = AssetWarnNotice()
+                    asset_warn_notice.app_id = hash_value_1["app_id"]
+                    asset_warn_notice.act_id = 0
+                    asset_warn_notice.ascription_type = 2
+                    asset_warn_notice.handler_name = hash_value_1["handler_name"]
+                    asset_warn_notice.request_code =""
+                    asset_warn_notice.user_id = ""
+                    asset_warn_notice.open_id = ""
+                    asset_warn_notice.user_nick = ""
+                    asset_warn_notice.asset_type = 0
+                    asset_warn_notice.asset_object_id = ""
+                    asset_warn_notice.log_title = "重复请求拦截"
+                    asset_warn_notice.info_desc = f"{date_start}-{date_end}进行了{count}次拦截"
+                    asset_warn_notice.info_json = {}
+                    asset_warn_notice.create_date = SevenHelper.get_now_datetime()
+                    asset_warn_notice.create_day = SevenHelper.get_now_day_int()
+                    asset_warn_notice_model.add_entity(asset_warn_notice)
+                time.sleep(5*60)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _push_warn_notice(self):
+        """
+        :description: 推送预警通知到消息系统
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                redis_init = SevenHelper.redis_init(config_dict=config.get_value("warn_redis"))
+                warn_notice_list = asset_warn_notice_model.get_list("is_notice=0 and ascription_type=1",order_by="create_date asc",limit="200")
+                if len(warn_notice_list) > 0:
+                    for warn_notice in warn_notice_list:
+                        try:
+                            push_message = {}
+                            push_message["project_id"] = int(config.get_value("project_name",0))
+                            push_message["app_id"] = warn_notice.app_id
+                            push_message["action_id"] = warn_notice.act_id
+                            push_message["taobao_nick_name"] = warn_notice.user_nick
+                            push_message["error_type"] = warn_notice.log_title
+                            push_message["error_message"] = warn_notice.info_desc
+                            push_message["handler"] = warn_notice.handler_name
+                            redis_init.lpush("warning_notice_queue", JsonHelper.json_dumps(push_message))
+                            warn_notice.is_notice = 1
+                            warn_notice.notice_date = SevenHelper.get_now_datetime()
+                            asset_warn_notice_model.update_entity(warn_notice,"is_notice,notice_date")
+                        except Exception as ex:
+                            logger_error.error(f"推送预警通知异常,json串:{SevenHelper.json_dumps(warn_notice)},ex:{traceback.format_exc()}")
+                            continue
+                time.sleep(1)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _process_asset_inventory_warn(self, mod_value, mod_count):
+        """
+        :description: 处理资产每日进销存是否对等预警
+        :param mod_value: 当前队列值
+        :param mod_count: 队列数
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        print(f"{TimeHelper.get_now_format_time()} 资产每日进销存预警队列{mod_value}启动")
+        while True:
+            try:
+                time.sleep(0.1)
+                asset_inventory_model = AssetInventoryModel()
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                now_date = TimeHelper.get_now_format_time()
+                now_day_int = SevenHelper.get_now_day_int()
+                if mod_count == 1:
+                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0", order_by="create_date asc", limit="200")
+                else:
+                    asset_inventory_list = asset_inventory_model.get_list(f"create_day={now_day_int} and process_count=0 and MOD(user_id,{mod_count})={mod_value}", order_by="create_date asc", limit="200")
+                if len(asset_inventory_list) > 0:
+                    for asset_inventory in asset_inventory_list:
+                        try:
+                            asset_inventory.process_count = 1
+                            asset_inventory.process_date = now_date
+                            asset_inventory_model.update_entity(asset_inventory, "process_count,process_date")
+
+                            if (asset_inventory.history_value + asset_inventory.inc_value + asset_inventory.dec_value) != asset_inventory.now_value:
+
+                                asset_warn_notice = AssetWarnNotice()
+                                asset_warn_notice.app_id = asset_inventory.app_id
+                                asset_warn_notice.act_id = asset_inventory.act_id
+                                asset_warn_notice.handler_name = ""
+                                asset_warn_notice.request_code = ""
+                                asset_warn_notice.user_id = asset_inventory.user_id
+                                asset_warn_notice.open_id = asset_inventory.open_id
+                                asset_warn_notice.user_nick = asset_inventory.user_nick
+                                asset_warn_notice.asset_type = asset_inventory.asset_type
+                                asset_warn_notice.asset_object_id = asset_inventory.asset_object_id
+                                asset_warn_notice.info_desc = f"历史值:{asset_inventory.history_value},增加：{asset_inventory.inc_value},减少：{asset_inventory.dec_value},当前值:{asset_inventory.now_value}"
+                                if asset_inventory.asset_type == 1:
+                                    asset_warn_notice.log_title = "次数进销存异常"
+                                elif asset_inventory.asset_type == 2:
+                                    asset_warn_notice.log_title = "积分进销存异常"
+                                elif asset_inventory.asset_type == 3:
+                                    asset_warn_notice.log_title = "价格档位进销存异常"
+                                    asset_warn_notice.info_desc = f"档位ID:{asset_inventory.asset_object_id}," + asset_warn_notice.info_desc
+                                else:
+                                    asset_warn_notice.log_title = f"资产类型：{asset_inventory.asset_type}异常"
+                                asset_warn_notice.info_json = SevenHelper.json_dumps(asset_inventory)
+                                asset_warn_notice.create_date = now_date
+                                asset_warn_notice.create_day = now_day_int
+                                asset_warn_notice_model.add_entity(asset_warn_notice)
+
+                        except Exception as ex:
+                            logger_error.error(f"资产每日进销存预警队列{mod_value}异常,json串:{SevenHelper.json_dumps(asset_inventory)},ex:{traceback.format_exc()}")
+                            continue
+                else:
+                    time.sleep(60 * 60)
+            except Exception as ex:
+                time.sleep(5)
+
+    def _process_asset_inventory_queue(self):
+        """
+        :description: 处理资产队列入进销存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = SevenHelper.redis_init()
+                asset_inventory_model = AssetInventoryModel()
+                asset_queue_json = redis_init.lpop(f"asset_queue_list")
+                if not asset_queue_json:
+                    time.sleep(1)
+                    continue
+                asset_queue_dict = SevenHelper.json_loads(asset_queue_json)
+                try:
+                    old_asset_inventory_id = 0
+                    app_id = asset_queue_dict["app_id"]
+                    act_id = asset_queue_dict["act_id"]
+                    open_id = asset_queue_dict["open_id"]
+                    user_nick = asset_queue_dict["user_nick"]
+                    user_id = asset_queue_dict["user_id"]
+                    asset_type = asset_queue_dict["asset_type"]
+                    asset_object_id = asset_queue_dict["asset_object_id"]
+                    now_day_int = asset_queue_dict["now_day_int"]
+                    create_date = asset_queue_dict["create_date"]
+                    now_value = asset_queue_dict["now_value"]
+                    operate_value = asset_queue_dict["operate_value"]
+                    history_asset_value = asset_queue_dict["history_asset_value"]
+                    if act_id > 0:
+                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
+                    else:
+                        asset_inventory_id_md5 = CryptoHelper.md5_encrypt_int(f"{app_id}_0_{user_id}_{asset_type}_{asset_object_id}_{now_day_int}")
+                    asset_inventory = asset_inventory_model.get_entity("id_md5=%s",params=[asset_inventory_id_md5])
+                    asset_inventory_update_sql = f"process_count=0,now_value={now_value}"
+                    if asset_inventory:
+                        old_asset_inventory_id = asset_inventory.id
+                        if operate_value > 0:
+                            asset_inventory_update_sql += f",inc_value=inc_value+{operate_value}"
+                        else:
+                            asset_inventory_update_sql += f",dec_value=dec_value+{operate_value}"
+                    else:
+                        asset_inventory = AssetInventory()
+                        asset_inventory.id_md5 = asset_inventory_id_md5
+                        asset_inventory.app_id = app_id
+                        asset_inventory.act_id = act_id
+                        asset_inventory.user_id = user_id
+                        asset_inventory.open_id = open_id
+                        asset_inventory.user_nick = user_nick
+                        asset_inventory.asset_type = asset_type
+                        asset_inventory.asset_object_id = asset_object_id
+                        if operate_value > 0:
+                            asset_inventory.inc_value += operate_value
+                        else:
+                            asset_inventory.dec_value += operate_value
+                        asset_inventory.history_value = history_asset_value
+                        asset_inventory.now_value = now_value
+                        asset_inventory.create_date = create_date
+                        asset_inventory.create_day = now_day_int
+                    if old_asset_inventory_id != 0:
+                        asset_inventory_model.update_table(asset_inventory_update_sql, "id=%s", params=[old_asset_inventory_id])
+                    else:
+                        asset_inventory_model.add_entity(asset_inventory)
+                except Exception as ex:
+                    asset_queue_dict["process_count"] += 1
+                    if asset_queue_dict["process_count"] <= 10:
+                        redis_init.rpush(f"asset_queue_list", SevenHelper.json_dumps(asset_queue_dict))
+                    else:
+                        logger_error.error(f"资产队列异常,json串:{SevenHelper.json_dumps(asset_queue_dict)},ex:{traceback.format_exc()}")
+                    continue
+            except Exception as ex:
+                logger_error.error(f"资产队列异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
+
+    def _process_asset_intercept_queue(self):
+        """
+        :description: 处理资产拦截队列入库
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        while True:
+            try:
+                time.sleep(0.1)
+                redis_init = SevenHelper.redis_init()
+                asset_warn_notice_model = AssetWarnNoticeModel()
+                queue_json = redis_init.lpop(f"asset_intercept_queue_list")
+                if not queue_json:
+                    time.sleep(1)
+                    continue
+                try:
+                    queue_dict = SevenHelper.json_loads(queue_json)
+                    asset_warn_notice = SevenHelper.auto_mapper(AssetWarnNotice,queue_dict)
+                    asset_warn_notice_model.add_entity(asset_warn_notice)
+                except Exception as ex:
+                    continue
+            except Exception as ex:
+                logger_error.error(f"资产拦截队列异常,ex:{traceback.format_exc()}")
+                time.sleep(5)
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_module_model.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,78 +1,74 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:58:31
-@LastEditTime: 2021-07-29 11:47:47
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class ActInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActInfoModel, self).__init__(ActInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActInfo:
-
-    def __init__(self):
-        super(ActInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_name = ""  # 活动名称
-        self.act_type = 0  # 活动类型
-        self.theme_id = 0  # 主题标识
-        self.store_url = ""  # 店铺地址
-        self.close_word = ""  # 关闭小程序文案
-        self.is_share = 0  # 是否开启分享(1是0否)
-        self.share_desc_json = ""  # 分享内容
-        self.is_rule = 0  # 是否显示规则（1是0否）
-        self.rule_desc_json = ""  # 规则内容
-        self.start_date = "1900-01-01 00:00:00"  # 开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 结束时间
-        self.is_black = 0  # 是否开启黑名单
-        self.refund_count = 0  # 退款次数
-        self.finish_menu_config_json = ""  # 已配置的菜单json
-        self.is_finish = 0  # 是否完成配置
-        self.is_launch = 0  # 是否开启投放（1是0否）
-        self.is_del = 0  # 是否删除（1是0否）
-        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
-        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.sort_index = 0  # 排序号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_name', 'act_type', 'theme_id', 'store_url', 'close_word', 'is_share', 'share_desc_json', 'is_rule', 'rule_desc_json', 'start_date', 'end_date', 'is_black', 'refund_count', 'finish_menu_config_json', 'is_finish', 'is_launch', 'is_del', 'join_ways', 'is_fictitious', 'task_asset_type_json', 'is_release', 'release_date', 'sort_index', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2023-03-13 11:22:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ActModuleModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActModuleModel, self).__init__(ActModule, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActModule:
+
+    def __init__(self):
+        super(ActModule, self).__init__()
+        self.id = 0  #
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.business_type = 0  # 业务类型(0无1机台2活动)
+        self.module_name = ""  # 模块名称
+        self.module_sub_name = ""  # 模块短名称
+        self.module_type = 0  # 模块类型
+        self.start_date = "1900-01-01 00:00:00"  # 开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 结束时间
+        self.skin_id = 0  # 皮肤标识
+        self.module_pic = ""  # 模块图片
+        self.module_desc = ""  # 描述信息
+        self.price = 0  # 价格
+        self.price_gear_id = 0  # 档位标识
+        self.ip_id = 0  # IP标识
+        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.is_del = 0  # 是否删除（1是0否）
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'business_type', 'module_name', 'module_sub_name', 'module_type', 'start_date', 'end_date', 'skin_id', 'module_pic', 'module_desc', 'price', 'price_gear_id', 'ip_id', 'join_ways', 'is_fictitious', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'is_del', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_module_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_module_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_user_report_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,72 +1,78 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-08-04 10:56:42
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ActModuleModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActModuleModel, self).__init__(ActModule, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActModule:
-
-    def __init__(self):
-        super(ActModule, self).__init__()
-        self.id = 0  #
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_name = ""  # 模块名称
-        self.module_sub_name = ""  # 模块短名称
-        self.start_date = "1900-01-01 00:00:00"  # 开始时间
-        self.end_date = "1900-01-01 00:00:00"  # 结束时间
-        self.skin_id = 0  # 皮肤标识
-        self.module_pic = ""  # 模块图片
-        self.module_desc = ""  # 描述信息
-        self.price = 0  # 价格
-        self.price_gear_id = 0  # 档位标识
-        self.ip_id = 0  # IP标识
-        self.join_ways = 0  # 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        self.is_fictitious = 0  # 是否开启虚拟中奖（1是0否）
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.is_del = 0  # 是否删除（1是0否）
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_name', 'module_sub_name', 'start_date', 'end_date', 'skin_id', 'module_pic', 'module_desc', 'price', 'price_gear_id', 'ip_id', 'join_ways', 'is_fictitious', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'is_del', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_module_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-08-24 15:02:41
+@LastEditTime: 2022-08-25 09:35:33
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class StatUserReportModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatUserReportModel, self).__init__(StatUserReport, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatUserReport:
+
+    def __init__(self):
+        super(StatUserReport, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.i6 = 0  # i6
+        self.i7 = 0  # i7
+        self.i8 = 0  # i8
+        self.i9 = 0  # i9
+        self.i10 = 0  # i10
+        self.i11 = 0  # i11
+        self.i12 = 0  # i12
+        self.i13 = 0  # i13
+        self.i14 = 0  # i14
+        self.i15 = 0  # i15
+        self.i16 = 0  # i16
+        self.i17 = 0  # i17
+        self.i18 = 0  # i18
+        self.i19 = 0  # i19
+        self.i20 = 0  # i20
+        self.d1 = 0  # d1
+        self.d2 = 0  # d2
+        self.d3 = 0  # d3
+        self.d4 = 0  # d4
+        self.d5 = 0  # d5
+        self.d6 = 0  # d6
+        self.d7 = 0  # d7
+        self.d8 = 0  # d8
+        self.d9 = 0  # d9
+        self.d10 = 0  # d10
+        self.create_day = 0  # 创建天
+        self.create_month = 0  # 创建月
+        self.create_year = 0  # 创建年
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'i1', 'i2', 'i3', 'i4', 'i5', 'i6', 'i7', 'i8', 'i9', 'i10', 'i11', 'i12', 'i13', 'i14', 'i15', 'i16', 'i17', 'i18', 'i19', 'i20', 'd1', 'd2', 'd3', 'd4', 'd5', 'd6', 'd7', 'd8', 'd9', 'd10', 'create_day', 'create_month', 'create_year', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_user_report_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/act/act_type_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/act/act_type_model.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,55 +1,59 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:28:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ActTypeModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ActTypeModel, self).__init__(ActType, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ActType:
-
-    def __init__(self):
-        super(ActType, self).__init__()
-        self.id = 0  # id
-        self.type_name = ""  # 类型名称
-        self.type_sub_name = ""  # 类型子名称
-        self.type_pic = ""  # 类型图片
-        self.market_ids = ""  # 所属营销方案id串（逗号分隔多个）
-        self.experience_pic = ""  # 体验二维码图
-        self.play_process_json = ""  # 玩法流程  举例:{"title": "玩法流程", "process_list": ["1.用户可通过付费购买获得拆盲盒次数"]}
-        self.suit_behavior_json = ""  # 适用行为 举例:{"title": "适用行业", "behavior_list": ["所有行业"]}
-        self.market_function_json = ""  # 营销功能 举例:{"title": "营销功能", "function_list": ["提升商品销量", "提升商品权重"]}
-        self.type_desc = ""  # 类型描述
-        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'type_name', 'type_sub_name', 'type_pic', 'market_ids', 'experience_pic', 'play_process_json', 'suit_behavior_json', 'market_function_json', 'type_desc', 'task_asset_type_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "act_type_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-07-29 18:28:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ActTypeModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ActTypeModel, self).__init__(ActType, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ActType:
+
+    def __init__(self):
+        super(ActType, self).__init__()
+        self.id = 0  # id
+        self.type_name = ""  # 类型名称
+        self.type_sub_name = ""  # 类型子名称
+        self.type_pic = ""  # 类型图片
+        self.market_ids = ""  # 所属营销方案id串（逗号分隔多个）
+        self.experience_pic = ""  # 体验二维码图
+        self.play_process_json = ""  # 玩法流程  举例:{"title": "玩法流程", "process_list": ["1.用户可通过付费购买获得拆盲盒次数"]}
+        self.suit_behavior_json = ""  # 适用行为 举例:{"title": "适用行业", "behavior_list": ["所有行业"]}
+        self.market_function_json = ""  # 营销功能 举例:{"title": "营销功能", "function_list": ["提升商品销量", "提升商品权重"]}
+        self.type_desc = ""  # 类型描述
+        self.task_asset_type_json = ""  # 任务货币类型（字典数组）
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ''  # s1
+        self.s2 = ''  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'type_name', 'type_sub_name', 'type_pic', 'market_ids', 'experience_pic', 'play_process_json', 'suit_behavior_json', 'market_function_json', 'type_desc', 'task_asset_type_json', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "act_type_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/app/app_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/base/base_info_model.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,72 +1,70 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-20 10:09:52
-@LastEditTime: 2021-07-29 18:28:39
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AppInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AppInfoModel, self).__init__(AppInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AppInfo:
-
-    def __init__(self):
-        super(AppInfo, self).__init__()
-        self.id = 0  # id
-        self.store_name = ""  # 店铺名称
-        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
-        self.store_id = 0  # 店铺ID
-        self.store_icon = ""  # 店铺图标
-        self.seller_id = ""  # 卖家ID
-        self.app_id = ""  # app_id
-        self.app_name = ""  # 应用名称
-        self.app_icon = ""  # 应用图标
-        self.app_url = ""  # 小程序链接
-        self.app_ver = ""  # 应用版本
-        self.app_key = ""  # 应用密钥
-        self.access_token = ""  # access_token
-        self.preview_url = ""  # 预览地址
-        self.app_desc = ""  # 应用介绍
-        self.template_id = ""  # 模板标识
-        self.template_ver = ""  # 模板版本号
-        self.clients = ""  # 适用客户端（taobao和tmall）
-        self.app_telephone = ""  # 手机号码
-        self.is_instance = 0  # 是否实例化：0-未实例化，1-已实例化
-        self.instance_date = "1900-01-01 00:00:00"  # 实例化时间
-        self.is_setting = 0  # 是否完成数据配置：0-未完成，1-已配置
-        self.expiration_date = "1900-01-01 00:00:00"  # 过期时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.current_limit_count = 0  # 限流数量
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'store_name', 'store_user_nick', 'store_id', 'store_icon', 'seller_id', 'app_id', 'app_name', 'app_icon', 'app_url', 'app_ver', 'app_key', 'access_token', 'preview_url', 'app_desc', 'template_id', 'template_ver', 'clients', 'app_telephone', 'is_instance', 'instance_date', 'is_setting', 'expiration_date', 'modify_date', 'current_limit_count', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "app_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-20 10:09:52
+@LastEditTime: 2021-07-29 18:30:00
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class BaseInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(BaseInfoModel, self).__init__(BaseInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class BaseInfo:
+
+    def __init__(self):
+        super(BaseInfo, self).__init__()
+        self.id = 0  # id
+        self.guid = ""  # guid
+        self.product_name = ""  # 产品名称
+        self.product_icon = ""  # 产品图标
+        self.product_desc = ""  # 产品简介
+        self.service_market_url = ""  # 服务市场链接
+        self.customer_service = ""  # 客服号
+        self.experience_pic = ""  # 案例二维码图
+        self.client_ver = ""  # 客户端版本号
+        self.server_ver = ""  # 服务端版本号
+        self.update_function = ""  # 版本更新内容
+        self.update_function_b = ""  # 千牛端版本更新内容
+        self.store_study_url = ""  # 店铺装修教程图文地址（如何上架小程序）
+        self.study_url = ""  # 后台配置图文教程
+        self.video_url = ""  # 后台配置视频教程
+        self.course_url = ""  # 主账号授权子账号教程
+        self.decoration_poster_json = ""  # 装修海报
+        self.menu_config_json = ""  # 菜单配置信息
+        self.is_remind_phone = 0  # 是否提醒提示配置手机号
+        self.is_force_update = 0  # 是个强制更新客户端版本
+        self.is_contact_us = 0  # 是否提醒联系我们
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'guid', 'product_name', 'product_icon', 'product_desc', 'service_market_url', 'customer_service', 'experience_pic', 'client_ver', 'server_ver', 'update_function', 'update_function_b', 'store_study_url', 'study_url', 'video_url', 'course_url', 'decoration_poster_json', 'menu_config_json', 'is_remind_phone', 'is_force_update', 'is_contact_us', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "base_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_inventory_model.py`

 * *Ordering differences only*

 * *Files 14% similar despite different names*

```diff
@@ -1,56 +1,56 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-19 22:41:48
-@LastEditTime: 2021-09-02 18:30:45
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AssetInventoryModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetInventoryModel, self).__init__(AssetInventory, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetInventory:
-
-    def __init__(self):
-        super(AssetInventory, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id+create_day)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 对象标识
-        self.inc_value = 0  # 增加值
-        self.dec_value = 0  # 消耗值
-        self.history_value = 0  # 今天之前的资产值
-        self.now_value = 0  # 当前的资产值
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建时间天
-        self.process_count = 0  # 处理次数
-        self.process_date = "1900-01-01 00:00:00"  # 处理时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'inc_value', 'dec_value', 'history_value', 'now_value', 'create_date', 'create_day', 'process_count', 'process_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_inventory_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-19 22:41:48
+@LastEditTime: 2021-09-02 18:30:45
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AssetInventoryModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetInventoryModel, self).__init__(AssetInventory, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetInventory:
+
+    def __init__(self):
+        super(AssetInventory, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id+create_day)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_id = ""  # 对象标识
+        self.inc_value = 0  # 增加值
+        self.dec_value = 0  # 消耗值
+        self.history_value = 0  # 今天之前的资产值
+        self.now_value = 0  # 当前的资产值
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建时间天
+        self.process_count = 0  # 处理次数
+        self.process_date = "1900-01-01 00:00:00"  # 处理时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'inc_value', 'dec_value', 'history_value', 'now_value', 'create_date', 'create_day', 'process_count', 'process_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_inventory_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_log_model.py`

 * *Files 10% similar despite different names*

```diff
@@ -1,66 +1,66 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2021-10-11 16:24:40
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class AssetLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetLogModel, self).__init__(AssetLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetLog:
-
-    def __init__(self):
-        super(AssetLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 昵称
-        self.log_title = ""  # 标题
-        self.info_json = ""  # 详情信息
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
-        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购.业务自定义类型从101起，避免跟公共冲突）
-        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
-        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
-        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
-        self.operate_type = 0  # 操作类型 （0累计 1消耗）
-        self.operate_value = 0  # 操作值
-        self.history_value = 0  # 历史值
-        self.now_value = 0  # 当前值
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
-        self.warn_day = 0  # 预警天
-        self.i1 = 0  # i1
-        self.s1 = ""  # s1
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2022-10-27 17:08:11
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AssetLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetLogModel, self).__init__(AssetLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetLog:
+
+    def __init__(self):
+        super(AssetLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.log_title = ""  # 标题
+        self.info_json = ""  # 详情信息
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位4-运费券，业务自定义类型从101起，避免跟公共冲突)
+        self.asset_object_id = ""  # 资产对象标识（比如资产类型是价格档位则对应档位id）
+        self.source_type = 0  # 来源类型（1-购买2-任务3-手动配置4-抽奖5-回购6-兑换7-退款.业务自定义类型从101起，避免跟公共冲突）
+        self.source_object_id = ""  # 来源对象标识(比如来源类型是任务则对应任务类型)
+        self.source_object_name = ""  # 来源对象名称(比如来源类型是任务则对应任务名称)
+        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
+        self.operate_type = 0  # 操作类型 （0累计 1消耗）
+        self.operate_value = 0  # 操作值
+        self.history_value = 0  # 历史值
+        self.now_value = 0  # 当前值
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.warn_date = "1900-01-01 00:00:00"  # 预警时间
+        self.warn_day = 0  # 预警天
+        self.i1 = 0  # i1
+        self.s1 = ""  # s1
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'asset_type', 'asset_object_id', 'source_type', 'source_object_id', 'source_object_name', 'only_id', 'operate_type', 'operate_value', 'history_value', 'now_value', 'handler_name', 'request_code', 'create_date', 'create_day', 'warn_date', 'warn_day', 'i1', 's1']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_only_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/counter/counter_config_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,47 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2021-09-02 20:41:40
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class AssetOnlyModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetOnlyModel, self).__init__(AssetOnly, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetOnly:
-
-    def __init__(self):
-        super(AssetOnly, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+user_id+only_id)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动ID
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.only_id = ""  # 唯一标识(用于并发操作时校验避免重复操作)
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'only_id', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_only_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2022-12-07 14:18:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class CounterConfigModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(CounterConfigModel, self).__init__(CounterConfig, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class CounterConfig:
+
+    def __init__(self):
+        super(CounterConfig, self).__init__()
+        self.id = 0  # id
+        self.key_name = ""  # 计数key
+        self.key_expire = 0  # 计数key过期时间
+        self.db_connect_key = ""  # 数据库连接串Key
+        self.table_name = ""  # 表名
+        self.id_field_name = ""  # 主键字段名称
+        self.value_field_name = ""  # 值字段名称
+        self.is_release = 0  # 是否发布(1是0否)
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'key_name', 'key_expire', 'db_connect_key', 'table_name', 'id_field_name', 'value_field_name', 'is_release', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "counter_config_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/asset/asset_warn_notice_model.py`

 * *Files 11% similar despite different names*

```diff
@@ -1,47 +1,48 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-
-
-class AssetWarnNoticeModel(BaseModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(AssetWarnNoticeModel, self).__init__(AssetWarnNotice, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class AssetWarnNotice:
-
-    def __init__(self):
-        super(AssetWarnNotice, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 对象标识
-        self.handler_name = ""  # 接口名称
-        self.request_code = ""  # 请求代码
-        self.log_title = ""  # 标题
-        self.info_desc = ""  # 详情
-        self.info_json = ""  # 详情json
-        self.is_notice = 0  # 是否通知
-        self.notice_date = "1900-01-01 00:00:00"  # 通知时间
-        self.create_day = 0  # 创建时间天
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'handler_name', 'request_code', 'log_title', 'info_desc', 'info_json', 'is_notice', 'notice_date', 'create_day', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "asset_warn_notice_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+
+
+class AssetWarnNoticeModel(BaseModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AssetWarnNoticeModel, self).__init__(AssetWarnNotice, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AssetWarnNotice:
+
+    def __init__(self):
+        super(AssetWarnNotice, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.ascription_type = 1 # 归属类型(1-预警2-拦截)
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_id = ""  # 对象标识
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.log_title = ""  # 标题
+        self.info_desc = ""  # 详情
+        self.info_json = ""  # 详情json
+        self.is_notice = 0  # 是否通知
+        self.notice_date = "1900-01-01 00:00:00"  # 通知时间
+        self.create_day = 0  # 创建时间天
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id','ascription_type', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'handler_name', 'request_code', 'log_title', 'info_desc', 'info_json', 'is_notice', 'notice_date', 'create_day', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "asset_warn_notice_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/base/base_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,70 +1,61 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-20 10:09:52
-@LastEditTime: 2021-07-29 18:30:00
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class BaseInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(BaseInfoModel, self).__init__(BaseInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class BaseInfo:
-
-    def __init__(self):
-        super(BaseInfo, self).__init__()
-        self.id = 0  # id
-        self.guid = ""  # guid
-        self.product_name = ""  # 产品名称
-        self.product_icon = ""  # 产品图标
-        self.product_desc = ""  # 产品简介
-        self.service_market_url = ""  # 服务市场链接
-        self.customer_service = ""  # 客服号
-        self.experience_pic = ""  # 案例二维码图
-        self.client_ver = ""  # 客户端版本号
-        self.server_ver = ""  # 服务端版本号
-        self.update_function = ""  # 版本更新内容
-        self.update_function_b = ""  # 千牛端版本更新内容
-        self.store_study_url = ""  # 店铺装修教程图文地址（如何上架小程序）
-        self.study_url = ""  # 后台配置图文教程
-        self.video_url = ""  # 后台配置视频教程
-        self.course_url = ""  # 主账号授权子账号教程
-        self.decoration_poster_json = ""  # 装修海报
-        self.menu_config_json = ""  # 菜单配置信息
-        self.is_remind_phone = 0  # 是否提醒提示配置手机号
-        self.is_force_update = 0  # 是个强制更新客户端版本
-        self.is_contact_us = 0  # 是否提醒联系我们
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'guid', 'product_name', 'product_icon', 'product_desc', 'service_market_url', 'customer_service', 'experience_pic', 'client_ver', 'server_ver', 'update_function', 'update_function_b', 'store_study_url', 'study_url', 'video_url', 'course_url', 'decoration_poster_json', 'menu_config_json', 'is_remind_phone', 'is_force_update', 'is_contact_us', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "base_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-16 19:14:40
+@LastEditTime: 2023-06-01 13:44:08
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PayOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PayOrderModel, self).__init__(PayOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PayOrder:
+
+    def __init__(self):
+        super(PayOrder, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.pay_order_no = ""  # 支付单号
+        self.order_name = ""  # 订单名称
+        self.order_desc = ""  # 订单描述
+        self.source_type = 0  # 来源类型（1-购买2-邮费.业务自定义类型从101起，避免跟公共冲突）
+        self.out_order_no = ""  # 平台交易单号
+        self.order_status = 0  # 订单状态:0等待买家付款1付款成功2支付关闭11交易成功20退款关闭
+        self.pay_amount = 0  # 支付金额（单位：元）
+        self.discount_amount = 0  # 优惠金额（单位：元）
+        self.refund_amount = 0  # 退款金额（单位：元）
+        self.buy_num = 0  # 购买数量
+        self.buy_object_id = ""  # 购买对象标识
+        self.buy_object_name = ""  # 购买对象名称
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
+        self.process_count = 0 # 处理次数
+        self.process_date = "1900-01-01 00:00:00"  # 处理时间
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'pay_order_no', 'order_name', 'order_desc', 'source_type', 'out_order_no', 'order_status', 'pay_amount', 'discount_amount', 'refund_amount', 'buy_num', 'buy_object_id', 'buy_object_name', 'create_date', 'pay_date', 'process_count', 'process_date', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "pay_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_product_model.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,49 +1,47 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-16 09:42:13
-@LastEditTime: 2021-08-16 09:47:53
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class BrowseLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(BrowseLogModel, self).__init__(BrowseLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class BrowseLog:
-
-    def __init__(self):
-        super(BrowseLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # 邀请人OpenID
-        self.goods_id = ""  # 商品id
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "browse_log_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:58:26
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionProductModel(CacheModel):
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionProductModel, self).__init__(FunctionProduct, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionProduct:
+    def __init__(self):
+        super(FunctionProduct, self).__init__()
+        self.app_id = 0  # 程序标识
+        self.app_code = ""  # 程序代码
+        self.app_name = ""  # 程序名称
+        self.parent_id = 0  # 父标识
+        self.name_path = ""  # 程序名路径
+        self.id_path = ""  # 父路经
+        self.sort_index = 0  # 排序
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['app_id', 'app_code', 'app_name', 'parent_id', 'name_path', 'id_path', 'sort_index', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "app_id"
+
+    def __str__(self):
+        return "function_product_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,47 +1,51 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-16 09:42:13
-@LastEditTime: 2021-08-16 09:49:09
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-class CollectLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CollectLogModel, self).__init__(CollectLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CollectLog:
-
-    def __init__(self):
-        super(CollectLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.goods_id = 0  # 商品id
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "collect_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2021-07-29 18:35:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatLogModel, self).__init__(StatLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatLog:
+
+    def __init__(self):
+        super(StatLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.orm_id = 0  # 映射标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.key_value = 0  # key值
+        self.create_day = 0  # 创建日
+        self.create_month = 0  # 创建月
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'orm_id', 'user_id', 'open_id', 'key_value', 'create_day', 'create_month', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/course_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,40 +1,51 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class CourseInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CourseInfoModel, self).__init__(CourseInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CourseInfo:
-
-    def __init__(self):
-        super(CourseInfo, self).__init__()
-        self.id = 0  # id
-        self.title = ""  # 标题
-        self.course_type_id = 0  # 类型
-        self.link = ""  # 链接地址
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'title', 'course_type_id', 'link', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "course_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2021-07-29 18:30:54
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FriendLinkModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(FriendLinkModel, self).__init__(FriendLink, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class FriendLink:
+
+    def __init__(self):
+        super(FriendLink, self).__init__()
+        self.id = 0  # id
+        self.title = ""  # 标题
+        self.product_id = 0  # 产品id（0-其他，-1未选择）
+        self.ad_pic = ""  # 互推广告图
+        self.big_pic = ""  # 互推大图
+        self.product_link = ""  # 产品链接地址
+        self.associated_url = ""  # 关联地址
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'title', 'product_id', 'ad_pic', 'big_pic', 'product_link', 'associated_url', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "friend_link_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/course/course_type_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/dict/dict_info_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,37 +1,53 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class CourseTypeModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(CourseTypeModel, self).__init__(CourseType, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class CourseType:
-
-    def __init__(self):
-        super(CourseType, self).__init__()
-        self.id = 0  # id
-        self.title = ""  # 标题
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'title', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "course_type_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-09-26 15:19:56
+@LastEditTime: 2022-09-28 11:13:26
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class DictInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(DictInfoModel, self).__init__(DictInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class DictInfo:
+
+    def __init__(self):
+        super(DictInfo, self).__init__()
+        self.id = 0  # id
+        self.dict_type = 0  # 字典类型
+        self.dict_name = ""  # 字典名称
+        self.dict_value = ""  # 字典值
+        self.dict_pic = ""  # 字典图片
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.parent_id = 0  # 父节点
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'dict_type', 'dict_name', 'dict_value', 'dict_pic', 'sort_index', 'is_release', 'create_date', 'modify_date', 'parent_id', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "dict_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/friend/friend_link_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/browse/browse_log_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,51 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:30:54
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class FriendLinkModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(FriendLinkModel, self).__init__(FriendLink, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class FriendLink:
-
-    def __init__(self):
-        super(FriendLink, self).__init__()
-        self.id = 0  # id
-        self.title = ""  # 标题
-        self.product_id = 0  # 产品id（0-其他，-1未选择）
-        self.ad_pic = ""  # 互推广告图
-        self.big_pic = ""  # 互推大图
-        self.product_link = ""  # 产品链接地址
-        self.associated_url = ""  # 关联地址
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'title', 'product_id', 'ad_pic', 'big_pic', 'product_link', 'associated_url', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "friend_link_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-16 09:42:13
+@LastEditTime: 2021-08-16 09:47:53
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class BrowseLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(BrowseLogModel, self).__init__(BrowseLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class BrowseLog:
+
+    def __init__(self):
+        super(BrowseLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # 邀请人OpenID
+        self.goods_id = ""  # 商品id
+        self.is_handle = 0  # 是否处理（1处理0未处理）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "browse_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/invite/invite_log_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,51 +1,52 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-12 17:38:51
-@LastEditTime: 2021-08-12 17:43:37
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class InviteLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(InviteLogModel, self).__init__(InviteLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class InviteLog:
-
-    def __init__(self):
-        super(InviteLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 邀请人用户标识
-        self.open_id = ""  # 邀请人OpenID
-        self.invite_user_id = "" # 受邀人用户标识
-        self.invite_open_id = ""  # 受邀人OpenID
-        self.invite_user_nick = ""  # 受邀人昵称
-        self.invite_avatar = ""  # 受邀人头像
-        self.is_handle = 0  # 是否处理（1处理0未处理）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_day = 0  # 创建天
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'invite_user_id', 'invite_open_id', 'invite_user_nick', 'invite_avatar', 'is_handle', 'create_date', 'create_day']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "invite_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-12 17:38:51
+@LastEditTime: 2021-11-24 10:38:24
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class InviteLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(InviteLogModel, self).__init__(InviteLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class InviteLog:
+
+    def __init__(self):
+        super(InviteLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 邀请人用户标识
+        self.open_id = ""  # 邀请人OpenID
+        self.invite_user_id = "" # 受邀人用户标识
+        self.invite_open_id = ""  # 受邀人OpenID
+        self.invite_user_nick = ""  # 受邀人昵称
+        self.invite_avatar = ""  # 受邀人头像
+        self.is_handle = 0  # 是否处理（1处理0未处理）
+        self.is_invited_handle = 0  #受邀人是否处理（1处理0未处理）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'invite_user_id', 'invite_open_id', 'invite_user_nick', 'invite_avatar', 'is_handle', 'is_invited_handle', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "invite_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/ip/ip_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_user_log_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,49 +1,51 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-08-02 09:53:32
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class IpInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(IpInfoModel, self).__init__(IpInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class IpInfo:
-
-    def __init__(self):
-        super(IpInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.ip_name = ""  # ip名称
-        self.ip_pic = ""  # ip图片
-        self.show_pic = ""  # 展示图片
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1发布0未发布）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'ip_name', 'ip_pic', 'show_pic', 'sort_index', 'is_release', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "ip_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2022-08-24 15:02:41
+@LastEditTime: 2022-11-24 16:39:38
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatUserLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatUserLogModel, self).__init__(StatUserLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatUserLog:
+
+    def __init__(self):
+        super(StatUserLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.key_name = ""  # key名称
+        self.key_value = 0  # key值
+        self.request_code = ""  # 请求代码
+        self.create_day = 0  # 创建日
+        self.create_month = 0  # 创建月
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'key_name', 'key_value', 'request_code', 'create_day', 'create_month', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_user_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/launch/launch_goods_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/collect/collect_log_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,49 +1,47 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-08-10 18:06:23
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class LaunchGoodsModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(LaunchGoodsModel, self).__init__(LaunchGoods, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class LaunchGoods:
-
-    def __init__(self):
-        super(LaunchGoods, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用唯一标识
-        self.act_id = 0  # 活动标识
-        self.goods_id = ""  # 商品ID
-        self.is_launch = 0  # 是否投放(0：不投放 1：投放)
-        self.is_sync = 0  # 是否同步（0不同步 1：同步）
-        self.error_message = ""  # 同步失败原因
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.launch_date = "1900-01-01 00:00:00"  # 投放时间
-        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'goods_id', 'is_launch', 'is_sync', 'error_message', 'create_date', 'launch_date', 'sync_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "launch_goods_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-16 09:42:13
+@LastEditTime: 2021-08-16 09:49:09
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class CollectLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(CollectLogModel, self).__init__(CollectLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class CollectLog:
+
+    def __init__(self):
+        super(CollectLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.goods_id = 0  # 商品id
+        self.is_handle = 0  # 是否处理（1处理0未处理）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'goods_id', 'is_handle', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "collect_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/refund/refund_order_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,48 +1,55 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-03 15:45:17
-@LastEditTime: 2021-08-03 15:45:58
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class MarketingProgramModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(MarketingProgramModel, self).__init__(MarketingProgram, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class MarketingProgram:
-
-    def __init__(self):
-        super(MarketingProgram, self).__init__()
-        self.id = 0  # id
-        self.link_title = ""  # 链接标题
-        self.link_url = ""  # 链接地址
-        self.content = ""  # 内容说明
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'link_title', 'link_url', 'content', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "marketing_program_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-09-13 16:26:10
+@LastEditTime: 2021-09-30 10:19:50
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class RefundOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(RefundOrderModel, self).__init__(RefundOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class RefundOrder:
+
+    def __init__(self):
+        super(RefundOrder, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.refund_type = 1  # 退款类型（1-手动 2-自动）
+        self.pay_order_no = ""  # 支付单号
+        self.refund_no = ""  # 退款单号
+        self.out_refund_no = ""  # 平台退款单号
+        self.out_order_no = ""  # 平台交易单号
+        self.refund_amount = 0  # 退款金额
+        self.refund_status = 0  # 退款状态 1商户申请退款中2退款处理中3退款成功4退款失败5退款关闭
+        self.refund_reason = ""  # 退款理由
+        self.refund_date = "1900-01-01 00:00:00"  # 退款时间
+        self.refund_result_detail = ""  # 退款结果描述
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'refund_type', 'pay_order_no', 'refund_no', 'out_refund_no', 'out_order_no', 'refund_amount', 'refund_status', 'refund_reason', 'refund_date', 'refund_result_detail', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "refund_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/material/material_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/price/price_gear_model.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,41 +1,46 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class MaterialInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(MaterialInfoModel, self).__init__(MaterialInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class MaterialInfo:
-
-    def __init__(self):
-        super(MaterialInfo, self).__init__()
-        self.id = 0  # id
-        self.position_id = 0  # 素材位置（1店铺首页装修图2商品详情页装修海报3直播间活动浮窗半图卡片4直播间互动浮窗全图卡片）
-        self.title = ""  # 素材名称
-        self.icon = ""  # 素材图
-        self.link = ""  # 链接地址
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'position_id', 'title', 'icon', 'link', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "material_info_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PriceGearModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PriceGearModel, self).__init__(PriceGear, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PriceGear:
+
+    def __init__(self):
+        super(PriceGear, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.relation_type = 0  # 关联类型：1商品skuid关联2商品id关联
+        self.goods_id = ""  # 商品ID
+        self.sku_id = ""  # sku_id
+        self.price_gear_name = ""  # 档位名称
+        self.price_gear_pic = ""  # 档位图片
+        self.price = 0  # 价格
+        self.is_del = 0  # 是否删除（1是0否）
+        self.sort_index = 0 # 排序
+        self.effective_date = "1900-01-01 00:00:00"  # 有效时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.remark = ""  # 备注
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'relation_type', 'goods_id', 'sku_id', 'price_gear_name', 'price_gear_pic', 'price', 'is_del', 'sort_index', 'effective_date', 'create_date', 'modify_date', 'remark']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "price_gear_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/middler/middler_product_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,50 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 15:05:22
-@LastEditTime: 2021-07-29 18:33:10
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class MiddlerProductModel(CacheModel):
-    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
-        super(MiddlerProductModel, self).__init__(MiddlerProduct, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class MiddlerProduct:
-
-    def __init__(self):
-        super(MiddlerProduct, self).__init__()
-        self.id = 0  # id
-        self.guid = ""  # guid
-        self.app_key = 0  # app_key
-        self.app_secret = ""  # app_secret
-        self.product_name = ""  # 产品名称
-        self.product_type = 0  # 产品类型：1云开发，2云应用
-        self.product_icon = ""  # 产品图标
-        self.db_key = ""  # 数据库key
-        self.contains_name = ""  # 产品服务名称列表（如：一起来盖楼,互动游戏宝,互动PK宝盒）
-        self.is_release = 0  # 是否发布（1是0否）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'guid', 'app_key', 'app_secret', 'product_name', 'product_type', 'product_icon', 'db_key', 'contains_name', 'is_release', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "middler_product_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 15:05:22
+@LastEditTime: 2021-07-29 18:33:10
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class MiddlerProductModel(CacheModel):
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(MiddlerProductModel, self).__init__(MiddlerProduct, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class MiddlerProduct:
+
+    def __init__(self):
+        super(MiddlerProduct, self).__init__()
+        self.id = 0  # id
+        self.guid = ""  # guid
+        self.app_key = 0  # app_key
+        self.app_secret = ""  # app_secret
+        self.product_name = ""  # 产品名称
+        self.product_type = 0  # 产品类型：1云开发，2云应用
+        self.product_icon = ""  # 产品图标
+        self.db_key = ""  # 数据库key
+        self.contains_name = ""  # 产品服务名称列表（如：一起来盖楼,互动游戏宝,互动PK宝盒）
+        self.is_release = 0  # 是否发布（1是0否）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'guid', 'app_key', 'app_secret', 'product_name', 'product_type', 'product_icon', 'db_key', 'contains_name', 'is_release', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "middler_product_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/operation/operation_log_model.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,57 +1,63 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 10:11:35
-@LastEditTime: 2021-08-02 14:39:04
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class OperationLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(OperationLogModel, self).__init__(OperationLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class OperationLog:
-
-    def __init__(self):
-        super(OperationLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.operation_type = 0  # 操作类型：1-add，2-update，3-delete
-        self.title = ""  # 标题
-        self.detail = ""  # 当前信息
-        self.update_detail = ""  # 更新之后的信息
-        self.request_params = ""  # 传入的参数
-        self.model_name = ""  # 模块或表名称
-        self.protocol = ""  # protocol(http或https)
-        self.method = ""  # method
-        self.handler_name = ""  # handler_name
-        self.request_host = ""  # request_host
-        self.request_uri = ""  # request_uri
-        self.remote_ip = ""  # remote_ip
-        self.operate_user_id = ""  # 操作人标识
-        self.operate_user_name = ""  # 操作人名称
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'operation_type', 'title', 'detail', 'update_detail', 'request_params', 'model_name', 'protocol', 'method', 'handler_name', 'request_host', 'request_uri', 'remote_ip', 'operate_user_id', 'operate_user_name', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "operation_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 10:11:35
+@LastEditTime: 2022-10-19 14:49:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class OperationLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(OperationLogModel, self).__init__(OperationLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class OperationLog:
+
+    def __init__(self):
+        super(OperationLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.operation_type = 0  # 操作类型：1-add，2-update，3-delete 4-还原 5-复制
+        self.title = ""  # 标题
+        self.operation_desc = "" # 描述
+        self.detail = ""  # 当前信息
+        self.update_detail = ""  # 更新之后的信息
+        self.request_params = ""  # 传入的参数
+        self.model_name = ""  # 模块或表名称
+        self.operation_ways = 1  # 操作方式(1单一操作2批量操作)
+        self.protocol = ""  # protocol(http或https)
+        self.method = ""  # method
+        self.handler_name = ""  # handler_name
+        self.request_host = ""  # request_host
+        self.request_uri = ""  # request_uri
+        self.remote_ip = ""  # remote_ip
+        self.request_code = "" # 请求代码
+        self.operate_user_id = ""  # 操作人标识
+        self.operate_user_name = ""  # 操作人名称
+        self.operate_role_id = ""  # 操作角色标识
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'operation_type', 'title', 'operation_desc', 'detail', 'update_detail', 'request_params', 'model_name', 'operation_ways', 'protocol', 'method', 'handler_name', 'request_host', 'request_uri', 'remote_ip', 'request_code', 'operate_user_id', 'operate_user_name', 'operate_role_id', 'create_date', 'create_day']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "operation_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/pay/pay_order_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/third/third_pay_order_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,54 +1,66 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-09-16 19:14:40
-@LastEditTime: 2021-09-28 18:39:01
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PayOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PayOrderModel, self).__init__(PayOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PayOrder:
-
-    def __init__(self):
-        super(PayOrder, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.pay_order_no = ""  # 支付单号
-        self.order_name = ""  # 订单名称
-        self.order_desc = ""  # 订单描述
-        self.source_type = 0  # 来源类型（1-购买2-邮费.业务自定义类型从101起，避免跟公共冲突）
-        self.out_order_no = ""  # 平台交易单号
-        self.order_status = 0  # 订单状态:0等待买家付款1付款成功2支付关闭11交易成功20退款关闭
-        self.pay_amount = 0  # 支付金额（单位：元）
-        self.refund_amount = 0  # 退款金额（单位：元）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'pay_order_no', 'order_name', 'order_desc', 'source_type', 'out_order_no', 'order_status', 'pay_amount', 'refund_amount', 'create_date', 'pay_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "pay_order_tb"
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+
+
+class ThirdPayOrderModel(BaseModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ThirdPayOrderModel, self).__init__(ThirdPayOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+    
+class ThirdPayOrder:
+
+    def __init__(self):
+        super(ThirdPayOrder, self).__init__()
+        self.id = 0  # id
+        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.goods_code = ""  # 商品编码
+        self.goods_name = ""  # 商品名称
+        self.sku_id = ""  # sku_id
+        self.sku_name = ""  # sku_name
+        self.buy_num = 0  # 购买数量
+        self.pay_price = 0  # 购买金额
+        self.main_pay_order_no = ""  # 第三方主订单号
+        self.sub_pay_order_no = ""  # 第三方子订单号
+        self.order_status = ""  # 订单状态
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_id = ""  # 资产对象标识
+        self.surplus_count = 0  # 剩余资产值
+        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+        
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "third_pay_order_tb"
+
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/prize/prize_order_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/prize/prize_roster_model.py`

 * *Files 18% similar despite different names*

```diff
@@ -1,82 +1,88 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-10-19 18:25:27
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class PrizeOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(PrizeOrderModel, self).__init__(PrizeOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class PrizeOrder:
-
-    def __init__(self):
-        super(PrizeOrder, self).__init__()
-        self.id = 0  # id
-        self.order_no = ""  # 订单号
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.real_name = ""  # 真实姓名
-        self.telephone = ""  # 手机号码
-        self.province = ""  # 所在省
-        self.city = ""  # 所在市
-        self.county = ""  # 所在区
-        self.street = ""  # 所在街道
-        self.address = ""  # 收货地址
-        self.deliver_date = "1900-01-01 00:00:00"  # 发货时间
-        self.express_no = ""  # 快递单号
-        self.express_company = ""  # 快递公司
-        self.order_status = 0  # 订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        self.buyer_remark = ""  # 买家备注
-        self.seller_remark = ""  # 卖家备注
-        self.is_free_freight = 0  # 是否包邮
-        self.freight_price = 0  # 运费金额
-        self.freight_pay_order_no = ""  # 运费支付单号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.create_month = 0  # 创建月
-        self.create_day = 0  # 创建天
-        self.sync_status = 0  # 订单同步状态，用于遁甲或者ERP同步订单（0未同步，1同步成功，2同步失败）
-        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
-        self.sync_count = 0  # 同步次数
-        self.sync_result = ""  # 同步结果
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'order_no', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'real_name', 'telephone', 'province', 'city', 'county', 'street', 'address', 'deliver_date', 'express_no', 'express_company', 'order_status', 'buyer_remark', 'seller_remark', 'is_free_freight', 'freight_price', 'freight_pay_order_no', 'create_date', 'create_month', 'create_day', 'sync_status', 'sync_date', 'sync_count', 'sync_result', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1','d2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "prize_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-10-27 16:48:27
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class PrizeRosterModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(PrizeRosterModel, self).__init__(PrizeRoster, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class PrizeRoster:
+
+    def __init__(self):
+        super(PrizeRoster, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.order_no = ""  # 订单号
+        self.source_type = 0  # 来源类型（0-活动奖品1-任务奖品2-兑换奖品）业务自定义从101开始
+        self.source_object_id = ""  # 来源对象标识
+        self.module_id = 0  # 活动模块标识
+        self.module_name = ""  # 活动模块名称
+        self.goods_type = 0  # 物品类型（1虚拟2实物）
+        self.prize_type = 0  # 奖品类型(1现货2优惠券3红包4参与奖5预售6积分7卡片)业务自定义从101开始
+        self.prize_id = 0  # 奖品标识
+        self.prize_name = ""  # 奖品名称
+        self.prize_pic = ""  # 奖品图
+        self.prize_detail_json = ""  # 奖品详情json
+        self.prize_price = 0  # 奖品价格
+        self.tag_name = ""  # 标签名称(奖项名称)
+        self.tag_id = 0  # 标签ID(奖项标识)
+        self.logistics_status = 0  # 物流状态（0未发货1已发货2不予发货）
+        self.prize_status = 0  # 奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        self.pay_status = 0  # 支付状态(0未支付1已支付2已退款3处理中)
+        self.goods_id = ""  # 商品ID
+        self.goods_code = ""  # 商品编码
+        self.goods_code_list = ""  # 多个sku商品编码
+        self.is_sku = 0  # 是否有SKU
+        self.sku_id = ""  # sku_id
+        self.sku_name = ""  # sku_name
+        self.sku_json = ""  # sku详情json
+        self.main_pay_order_no = ""  # 支付主订单号
+        self.sub_pay_order_no = ""  # 支付子订单号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.request_code = ""  # 请求代码
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return [
+            'id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'order_no', 'source_type', 'source_object_id', 'module_id', 'module_name', 'goods_type', 'prize_type', 'prize_id', 'prize_name', 'prize_pic', 'prize_detail_json', 'prize_price', 'tag_name', 'tag_id', 'logistics_status', 'prize_status', 'pay_status', 'goods_id', 'goods_code', 'goods_code_list', 'is_sku', 'sku_id', 'sku_name', 'sku_json', 'main_pay_order_no', 'sub_pay_order_no', 'create_date', 'request_code', 'i1', 'i2',
+            'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2'
+        ]
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "prize_roster_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/product/product_price_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/function/function_info_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,48 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:55:09
-@LastEditTime: 2021-07-29 18:34:42
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ProductPriceModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ProductPriceModel, self).__init__(ProductPrice, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ProductPrice:
-
-    def __init__(self):
-        super(ProductPrice, self).__init__()
-        self.id = 0  # id
-        self.plan_name = ""  # 计划名称
-        self.begin_time = "1900-01-01 00:00:00"  # 开始时间
-        self.end_time = "1900-01-01 00:00:00"  # 结束时间
-        self.content = ""  # 内容 举例:[{'price': 1, 'link_url': '2', 'time': '3个月', 'costprice': 1, 'title': '1'}, {'price': 2, 'link_url': '3', 'time': '6个月', 'costprice': 2, 'title': '2'}, {'price': 4, 'link_url': '5', 'time': '12个月', 'costprice': 4, 'title': '4'}]
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_time = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'plan_name', 'begin_time', 'end_time', 'content', 'is_release', 'release_date', 'create_time', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "product_price_tb"
+# -*- coding: utf-8 -*-
+"""
+:Author: HuangJingCan
+:Date: 2022-12-15 10:52:33
+:LastEditTime: 2022-12-15 13:57:08
+:LastEditors: HuangJingCan
+:Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class FunctionInfoModel(CacheModel):
+
+    def __init__(self, db_connect_key='db_middler_platform', sub_table=None, db_transaction=None, context=None):
+        super(FunctionInfoModel, self).__init__(FunctionInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class FunctionInfo:
+    def __init__(self):
+        super(FunctionInfo, self).__init__()
+        self.id = 0  # id
+        self.product_id = 0  # 产品id
+        self.function_name = ""  # 功能名称
+        self.key_name = ""  # key名称
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布：0未发布1已发布
+        self.operation_user = ""  # 操作用户
+        self.use_count = 0  # 使用数量
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'product_id', 'function_name', 'key_name', 'sort_index', 'is_release', 'operation_user', 'use_count', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "function_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/saas/saas_custom_model.py`

 * *Ordering differences only*

 * *Files 12% similar despite different names*

```diff
@@ -1,50 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 17:00:16
-@LastEditTime: 2021-07-29 18:34:56
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class SaasCustomModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(SaasCustomModel, self).__init__(SaasCustom, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class SaasCustom:
-
-    def __init__(self):
-        super(SaasCustom, self).__init__()
-        self.id = 0  #
-        self.cloud_app_id = 0  # 云应用id
-        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
-        self.app_name = ""  # 应用名称
-        self.app_icon = ""  # 应用图标
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
-        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'cloud_app_id', 'store_user_nick', 'app_name', 'app_icon', 'is_release', 'release_date', 'service_date_start', 'service_date_end', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "saas_custom_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 17:00:16
+@LastEditTime: 2021-07-29 18:34:56
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class SaasCustomModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(SaasCustomModel, self).__init__(SaasCustom, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class SaasCustom:
+
+    def __init__(self):
+        super(SaasCustom, self).__init__()
+        self.id = 0  #
+        self.cloud_app_id = 0  # 云应用id
+        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
+        self.app_name = ""  # 应用名称
+        self.app_icon = ""  # 应用图标
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.service_date_start = "1900-01-01 00:00:00"  # 服务开始时间
+        self.service_date_end = "1900-01-01 00:00:00"  # 服务结束时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'cloud_app_id', 'store_user_nick', 'app_name', 'app_icon', 'is_release', 'release_date', 'service_date_start', 'service_date_end', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "saas_custom_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/skin/skin_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_account_model.py`

 * *Files 20% similar despite different names*

```diff
@@ -1,49 +1,60 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 15:41:57
-@LastEditTime: 2021-07-29 18:35:20
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class SkinInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(SkinInfoModel, self).__init__(SkinInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class SkinInfo:
-
-    def __init__(self):
-        super(SkinInfo, self).__init__()
-        self.id = 0  # id
-        self.skin_name = ""  # 皮肤名称
-        self.theme_id = 0  # 主题标识
-        self.client_json = ""  # 客户端内容json
-        self.server_json = ""  # 服务端内容json
-        self.out_id = ""  # 外部id
-        self.theme_out_id = ""  # 外部主题id
-        self.sort_index = 0  # 排序
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'skin_name', 'theme_id', 'client_json', 'server_json', 'out_id', 'theme_out_id', 'sort_index', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "skin_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 10:59:39
+@LastEditTime: 2022-07-20 14:11:07
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserAccountModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserAccountModel, self).__init__(UserAccount, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class UserAccount:
+
+    def __init__(self):
+        super(UserAccount, self).__init__()
+        self.id = 0  # id
+        self.union_id = ""  # union_id
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.user_nick_encrypt = ""  # 昵称加密值
+        self.mix_nick = ""  # 混淆昵称
+        self.avatar = ""  # 头像
+        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
+        self.full_name = ""  # 姓名
+        self.telephone = ""  #电话号码
+        self.sex = 0  #性别（1-男，2-女）
+        self.birthday = "1900-01-01"  #生日
+        self.certificate_type = 1  #证件类型(1身份证2军官证)
+        self.certificate_no = "" #证件号码
+        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_ip = "" #创建IP
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+        self.login_date = "1900-01-01 00:00:00"  # 登录时间
+        self.login_ip = "" #登录IP
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'union_id', 'open_id', 'user_nick', 'user_nick_encrypt', 'mix_nick', 'avatar', 'user_state', 'full_name', 'telephone', 'sex', 'birthday', 'certificate_type', 'certificate_no', 'relieve_date', 'create_date', 'create_ip', 'modify_date', 'login_date', 'login_ip']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_account_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/special/special_goods_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/special/special_goods_model.py`

 * *Ordering differences only*

 * *Files 17% similar despite different names*

```diff
@@ -1,45 +1,45 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-28 16:41:14
-@LastEditTime: 2021-08-10 18:06:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class SpecialGoodsModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(SpecialGoodsModel, self).__init__(SpecialGoods, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class SpecialGoods:
-
-    def __init__(self):
-        super(SpecialGoods, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用唯一标识
-        self.goods_id = ""  # 商品ID
-        self.goods_name = ""  # 商品名称
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'goods_id', 'goods_name', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "special_goods_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-28 16:41:14
+@LastEditTime: 2021-08-10 18:06:59
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class SpecialGoodsModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(SpecialGoodsModel, self).__init__(SpecialGoods, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class SpecialGoods:
+
+    def __init__(self):
+        super(SpecialGoods, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用唯一标识
+        self.goods_id = ""  # 商品ID
+        self.goods_name = ""  # 商品名称
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'goods_id', 'goods_name', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "special_goods_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_queue_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,50 +1,45 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2021-07-29 18:35:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatLogModel, self).__init__(StatLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatLog:
-
-    def __init__(self):
-        super(StatLog, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.orm_id = 0  # 映射标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.key_value = 0  # key值
-        self.create_day = 0  # 创建日
-        self.create_month = 0  # 创建月
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'orm_id', 'user_id', 'open_id', 'key_value', 'create_day', 'create_month', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_log_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatQueueModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatQueueModel, self).__init__(StatQueue, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatQueue:
+
+    def __init__(self):
+        super(StatQueue, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.key_name = ""  # key名称
+        self.key_value = 0  # key值
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.process_count = 0  # 处理次数
+        self.process_result = ""  # 处理结果
+        self.process_date = "1900-01-01 00:00:00"  # 处理时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id','object_id', 'user_id', 'open_id', 'key_name', 'key_value', 'request_code', 'create_date', 'process_count', 'process_result', 'process_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_queue_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,56 +1,74 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2021-09-10 16:11:30
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatOrmModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatOrmModel, self).__init__(StatOrm, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatOrm:
-
-    def __init__(self):
-        super(StatOrm, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.group_name = ""  # 分组名称
-        self.group_sub_name = ""  # 分组子名称
-        self.key_name = ""  # key名称
-        self.key_value = ""  # key值
-        self.value_type = 0 # 输出类型(1-int，2-decimal)
-        self.repeat_type = 0  # 去重方式(0不去重1当日去重2全部去重)
-        self.sort_index = 0  # 排序号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.is_show = 0  # 是否显示(1是0否)
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'group_name', 'group_sub_name', 'key_name', 'key_value', 'value_type', 'repeat_type', 'sort_index', 'create_date', 'is_show', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_orm_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:57:24
+@LastEditTime: 2022-01-21 16:34:17
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaoPayOrderModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaoPayOrderModel, self).__init__(TaoPayOrder, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaoPayOrder:
+
+    def __init__(self):
+        super(TaoPayOrder, self).__init__()
+        self.id = 0  # id(act_id+user_id+guid)md5int生成
+        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.goods_code = ""  # 商品编码
+        self.goods_name = ""  # 商品名称
+        self.sku_id = ""  # sku_id
+        self.sku_name = ""  # sku_name
+        self.buy_num = 0  # 购买数量
+        self.pay_price = 0  # 购买金额
+        self.main_pay_order_no = ""  # 淘宝主订单号
+        self.sub_pay_order_no = ""  # 淘宝子订单号
+        self.order_status = ""  # 订单状态
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
+        self.asset_object_name = ""  # 资产对象名称
+        self.asset_object_id = ""  # 资产对象标识
+        self.surplus_count = 0  # 剩余资产值
+        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_name', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "tao_pay_order_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_report_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,49 +1,50 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 09:40:36
-@LastEditTime: 2021-07-29 18:36:50
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class StatReportModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(StatReportModel, self).__init__(StatReport, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class StatReport:
-
-    def __init__(self):
-        super(StatReport, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.key_name = ""  # key名称
-        self.key_value = 0  # key值
-        self.create_day = 0  # 创建天
-        self.create_month = 0  # 创建月
-        self.create_year = 0  # 创建年
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'key_name', 'key_value', 'create_day', 'create_month', 'create_year', 'create_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "stat_report_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2021-07-29 18:36:50
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatReportModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatReportModel, self).__init__(StatReport, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatReport:
+
+    def __init__(self):
+        super(StatReport, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.key_name = ""  # key名称
+        self.key_value = 0  # key值
+        self.create_day = 0  # 创建天
+        self.create_month = 0  # 创建月
+        self.create_year = 0  # 创建年
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'key_name', 'key_value', 'create_day', 'create_month', 'create_year', 'create_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_report_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/erp/erp_relation_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,51 +1,41 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2021-07-29 18:37:15
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoCouponModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoCouponModel, self).__init__(TaoCoupon, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoCoupon:
-
-    def __init__(self):
-        super(TaoCoupon, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.prize_id = 0  # 奖品标识
-        self.coupon_type = 0  # 优惠券类型(0无1店铺优惠券2商品优惠券)
-        self.right_ename = ""  # 发放的权益(奖品)唯一标识
-        self.pool_id = ""  # 奖池ID
-        self.coupon_start_date = "1900-01-01 00:00:00"  # 优惠券开始时间
-        self.coupon_end_date = "1900-01-01 00:00:00"  # 优惠券结束时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'prize_id', 'coupon_type', 'right_ename', 'pool_id', 'coupon_start_date', 'coupon_end_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_coupon_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class ErpRelationModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(ErpRelationModel, self).__init__(ErpRelation, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class ErpRelation:
+
+    def __init__(self):
+        super(ErpRelation, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.app_key = ""  # 应用密钥(商家实例化生成的app_key)
+        self.store_name = ""  # 店铺名称
+        self.is_release = 0  # 是否发布(1是0否)
+        self.start_date = "1900-01-01 00:00:00"  # 开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 结束时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.sync_date = "1900-01-01 00:00:00"  # 同步时间
+        self.return_date = "1900-01-01 00:00:00"  # 回传时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'app_key', 'store_name', 'is_release', 'start_date', 'end_date', 'create_date', 'sync_date', 'return_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "erp_relation_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_login_log_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/launch/launch_plan_model.py`

 * *Files 19% similar despite different names*

```diff
@@ -1,47 +1,48 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2021-07-29 18:37:28
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoLoginLogModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoLoginLogModel, self).__init__(TaoLoginLog, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoLoginLog:
-
-    def __init__(self):
-        super(TaoLoginLog, self).__init__()
-        self.id = 0  # id
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.store_user_nick = ""  # 主帐号名称（会员名）
-        self.is_master = 0  # 是否主账号（1是0否）
-        self.request_params = ""  # 参数
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'open_id', 'user_nick', 'store_user_nick', 'is_master', 'request_params', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_login_log_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-07-13 17:51:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+class LaunchPlanModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(LaunchPlanModel, self).__init__(LaunchPlan, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class LaunchPlan:
+
+    def __init__(self):
+        super(LaunchPlan, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用唯一标识
+        self.act_id = 0  # 活动标识
+        self.tb_launch_id = 0  # 淘宝投放计划标识
+        self.launch_url = ""  # 投放链接
+        self.start_date = "1900-01-01 00:00:00" # 投放开始时间
+        self.end_date = "1900-01-01 00:00:00"  # 投放结束时间
+        self.status = 0  # 投放状态
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'tb_launch_id', 'launch_url', 'start_date', 'end_date', 'status', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "launch_plan_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/tao/tao_pay_order_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_info_model.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,73 +1,75 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-27 10:57:24
-@LastEditTime: 2021-09-02 15:31:21
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaoPayOrderModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaoPayOrderModel, self).__init__(TaoPayOrder, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaoPayOrder:
-
-    def __init__(self):
-        super(TaoPayOrder, self).__init__()
-        self.id = 0  # id(act_id+user_id+guid)md5int生成
-        self.ascription_type = 0  # 归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.goods_code = ""  # 商品编码
-        self.goods_name = ""  # 商品名称
-        self.sku_id = ""  # sku_id
-        self.sku_name = ""  # sku_name
-        self.buy_num = 0  # 购买数量
-        self.pay_price = 0  # 购买金额
-        self.main_pay_order_no = ""  # 淘宝主订单号
-        self.sub_pay_order_no = ""  # 淘宝子订单号
-        self.order_status = ""  # 订单状态
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位)
-        self.asset_object_id = ""  # 资产对象标识
-        self.surplus_count = 0  # 剩余资产值
-        self.prize_ids = ""  # 奖品ID列表（逗号隔开）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.pay_date = "1900-01-01 00:00:00"  # 支付时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'ascription_type', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'goods_code', 'goods_name', 'sku_id', 'sku_name', 'buy_num', 'pay_price', 'main_pay_order_no', 'sub_pay_order_no', 'order_status', 'asset_type', 'asset_object_id', 'surplus_count', 'prize_ids', 'create_date', 'pay_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "tao_pay_order_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 10:59:39
+@LastEditTime: 2022-01-24 10:11:52
+@LastEditors: HuangJianYi
+@Description: 
+"""
+
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserInfoModel, self).__init__(UserInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserInfo:
+
+    def __init__(self):
+        super(UserInfo, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = ""  # id_md5(act_id+user_id)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.union_id = ""  # union_id
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.user_nick_encrypt = ""  # 昵称加密值
+        self.avatar = ""  # 头像
+        self.is_auth = 0  # 是否授权（1是0否）
+        self.is_new = 0  # 是否新用户
+        self.pay_price = 0  # 累计支付金额
+        self.pay_num = 0  # 累计支付笔数
+        self.login_token = ""  # 登录令牌
+        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
+        self.is_member = 0  # 是否会员
+        self.is_member_before = 0  # 用户最初会员状态
+        self.is_favor = 0  # 是否关注店铺
+        self.is_favor_before = 0  # 用户最初关注状态（0未关注1已关注）
+        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.i5 = 0  # i5
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+        self.s5 = ""  # s5
+        self.d1 = "1900-01-01 00:00:00"  # d1
+        self.d2 = "1900-01-01 00:00:00"  # d2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'union_id', 'open_id', 'user_nick', 'user_nick_encrypt', 'avatar', 'is_auth', 'is_new', 'pay_price', 'pay_num', 'login_token', 'user_state', 'is_member', 'is_member_before', 'is_favor', 'is_favor_before', 'relieve_date', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/task_count_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_black_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,53 +1,53 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-10 10:09:06
-@LastEditTime: 2021-09-02 17:41:04
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-
-
-class TaskCountModel(BaseModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaskCountModel, self).__init__(TaskCount, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaskCount:
-
-    def __init__(self):
-        super(TaskCount, self).__init__()
-        self.id = 0  # 标识
-        self.id_md5 = 0  # id_md5(actid+moduleid+tasktype+tasksubtype+userid)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.task_type = 0  # 任务类型（枚举TaskType）
-        self.task_sub_type = ""  # 任务子类型(用于指定任务里的再细分，比如:指定金额任务分不同档位金额)
-        self.complete_count = 0  # 任务完成数
-        self.now_count = 0  # 当前计数
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.modify_day = 0  # 更新天(19000101)
-        self.remark = ""  # 备注
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'task_type', 'task_sub_type', 'complete_count', 'now_count', 'create_date', 'modify_date', 'modify_day', 'remark']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "task_count_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-22 16:03:01
+@LastEditTime: 2021-07-29 18:39:05
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserBlackModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserBlackModel, self).__init__(UserBlack, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserBlack:
+
+    def __init__(self):
+        super(UserBlack, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.black_type = 0  # 拉黑类型（1自动2手动）
+        self.reason = ""  # 申请原因
+        self.audit_status = 0  # 审核状态(0黑名单1申请中2同意3拒绝)
+        self.audit_remark = ""  # 审核备注
+        self.refund_count = 0  # 退款次数
+        self.refund_order_data = ""  # 退款主订单号(逗号分隔)
+        self.create_date = "1900-01-01 00:00:00"  # 申请时间
+        self.audit_date = "1900-01-01 00:00:00"  # 审核时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'black_type', 'reason', 'audit_status', 'audit_remark', 'refund_count', 'refund_order_data', 'create_date', 'audit_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_black_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/task/task_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/ip/ip_type_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,56 +1,49 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-10 10:09:06
-@LastEditTime: 2021-08-12 10:11:20
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class TaskInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(TaskInfoModel, self).__init__(TaskInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class TaskInfo:
-
-    def __init__(self):
-        super(TaskInfo, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.module_id = 0  # 活动模块标识
-        self.complete_type = 0  # 完成类型(1每日任务2每周任务3持久任务)
-        self.task_name = ""  # 任务名称
-        self.task_type = 0  # 任务类型（公共枚举TaskType，业务继承公共枚举进行拓展）
-        self.config_json = ""  # 任务配置（json字符串，TaskType里面的注释都有详细例子）
-        self.sort_index = 0  # 排序
-        self.is_release = 0  # 是否发布
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'module_id', 'complete_type', 'task_name', 'task_type', 'config_json', 'sort_index', 'is_release', 'create_date', 'modify_date', 'i1', 'i2', 's1', 's2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "task_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:55:09
+@LastEditTime: 2022-07-28 18:29:51
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class IpTypeModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(IpTypeModel, self).__init__(IpType, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+
+class IpType:
+
+    def __init__(self):
+        super(IpType, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.type_name = ""  # 类型名称
+        self.type_pic = ""  # 类型图片
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1发布0未发布）
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'type_name', 'type_pic', 'sort_index', 'is_release', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "ip_type_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/theme_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/tao/tao_coupon_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,48 +1,54 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 15:41:57
-@LastEditTime: 2021-07-29 18:37:59
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ThemeInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ThemeInfoModel, self).__init__(ThemeInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ThemeInfo:
-
-    def __init__(self):
-        super(ThemeInfo, self).__init__()
-        self.id = 0  # id
-        self.app_id = ""  # 应用唯一标识
-        self.theme_name = ""  # 主题名称
-        self.server_json = ""  # 服务端内容json
-        self.out_id = ""  # 外部id
-        self.sort_index = 0  # 排序号
-        self.is_release = 0  # 是否发布（1发布0未发布）
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'theme_name', 'server_json', 'out_id', 'sort_index', 'is_release', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "theme_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-27 10:57:24
+@LastEditTime: 2021-12-10 14:32:30
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaoCouponModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaoCouponModel, self).__init__(TaoCoupon, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaoCoupon:
+
+    def __init__(self):
+        super(TaoCoupon, self).__init__()
+        self.id = 0  # 标识
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.prize_id = 0  # 奖品标识
+        self.coupon_type = 0  # 优惠券类型(0无1店铺优惠券2商品优惠券3会员专享优惠券)
+        self.coupon_url = ""  # 优惠劵地址
+        self.coupon_price = 0  # 优惠券面额
+        self.use_sill_price = 0  # 使用门槛金额
+        self.right_ename = ""  # 发放的权益(奖品)唯一标识
+        self.pool_id = ""  # 奖池ID
+        self.coupon_start_date = "1900-01-01 00:00:00"  # 优惠券开始时间
+        self.coupon_end_date = "1900-01-01 00:00:00"  # 优惠券结束时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'prize_id', 'coupon_type', 'coupon_url', 'coupon_price', 'use_sill_price', 'right_ename', 'pool_id', 'coupon_start_date', 'coupon_end_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "tao_coupon_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/theme/theme_ver_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/marketing/marketing_program_model.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,46 +1,48 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-26 15:41:57
-@LastEditTime: 2021-07-29 18:38:20
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class ThemeVerModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(ThemeVerModel, self).__init__(ThemeVer, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class ThemeVer:
-
-    def __init__(self):
-        super(ThemeVer, self).__init__()
-        self.id = 0  # id
-        self.theme_id = 0  # 主题标识
-        self.out_id = ""  # 外部id
-        self.client_json = ""  # 客户端内容json
-        self.ver_no = ""  # 客户端版本号
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'theme_id', 'out_id', 'client_json', 'ver_no', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "theme_ver_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-03 15:45:17
+@LastEditTime: 2021-08-03 15:45:58
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class MarketingProgramModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(MarketingProgramModel, self).__init__(MarketingProgram, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class MarketingProgram:
+
+    def __init__(self):
+        super(MarketingProgram, self).__init__()
+        self.id = 0  # id
+        self.link_title = ""  # 链接标题
+        self.link_url = ""  # 链接地址
+        self.content = ""  # 内容说明
+        self.sort_index = 0  # 排序
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'link_title', 'link_url', 'content', 'sort_index', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "marketing_program_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_account_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/stat/stat_orm_model.py`

 * *Files 27% similar despite different names*

```diff
@@ -1,49 +1,58 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 10:59:39
-@LastEditTime: 2021-08-12 13:46:44
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserAccountModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserAccountModel, self).__init__(UserAccount, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-
-class UserAccount:
-
-    def __init__(self):
-        super(UserAccount, self).__init__()
-        self.id = 0  # id
-        self.union_id = ""  # union_id
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.avatar = ""  # 头像
-        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
-        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 修改时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'union_id', 'open_id', 'user_nick', 'avatar', 'user_state', 'relieve_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_account_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-26 09:40:36
+@LastEditTime: 2023-05-24 18:33:19
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class StatOrmModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(StatOrmModel, self).__init__(StatOrm, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class StatOrm:
+
+    def __init__(self):
+        super(StatOrm, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.object_id = ""  # 对象标识
+        self.group_name = ""  # 分组名称
+        self.group_sub_name = ""  # 分组子名称
+        self.key_name = ""  # key名称
+        self.key_value = ""  # key值
+        self.tip_title = "" # 提示标题
+        self.value_type = 0 # 输出类型(1-int，2-decimal)
+        self.repeat_type = 0  # 去重方式(0不去重1当日去重2全部去重)
+        self.sort_index = 0  # 排序号
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.is_show = 0  # 是否显示(1是0否)
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'object_id', 'group_name', 'group_sub_name', 'key_name', 'key_value', 'tip_title', 'value_type', 'repeat_type', 'sort_index', 'create_date', 'is_show', 'i1', 'i2', 's1', 's2']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "stat_orm_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_asset_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/user/user_asset_model.py`

 * *Files 17% similar despite different names*

```diff
@@ -1,52 +1,52 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-15 17:17:08
-@LastEditTime: 2021-09-02 18:27:58
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserAssetModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserAssetModel, self).__init__(UserAsset, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class UserAsset:
-
-    def __init__(self):
-        super(UserAsset, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位，业务自定义类型从101起，避免跟公共冲突)
-        self.asset_object_id = ""  # 资产对象标识
-        self.asset_value = 0  # 资产值
-        self.asset_check_code = ""  # 资产检验码(id+asset_value+加密签名)md5生成
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'asset_value', 'asset_check_code', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_asset_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2021-09-02 18:27:58
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class UserAssetModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(UserAssetModel, self).__init__(UserAsset, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class UserAsset:
+
+    def __init__(self):
+        super(UserAsset, self).__init__()
+        self.id = 0  # id
+        self.id_md5 = 0  # id_md5(act_id+user_id+asset_type+asset_object_id)md5int生成
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 用户昵称
+        self.asset_type = 0  # 资产类型(1-次数2-积分3-价格档位4-运费券，业务自定义类型从101起，避免跟公共冲突)
+        self.asset_object_id = ""  # 资产对象标识
+        self.asset_value = 0  # 资产值
+        self.asset_check_code = ""  # 资产检验码(id+asset_value+加密签名)md5生成
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'asset_type', 'asset_object_id', 'asset_value', 'asset_check_code', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "user_asset_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_black_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/task/task_log_model.py`

 * *Files 21% similar despite different names*

```diff
@@ -1,53 +1,61 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 16:03:01
-@LastEditTime: 2021-07-29 18:39:05
-@LastEditors: HuangJianYi
-@Description: 
-"""
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserBlackModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserBlackModel, self).__init__(UserBlack, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class UserBlack:
-
-    def __init__(self):
-        super(UserBlack, self).__init__()
-        self.id = 0  # 标识
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 用户昵称
-        self.black_type = 0  # 拉黑类型（1自动2手动）
-        self.reason = ""  # 申请原因
-        self.audit_status = 0  # 审核状态(0黑名单1申请中2同意3拒绝)
-        self.audit_remark = ""  # 审核备注
-        self.refund_count = 0  # 退款次数
-        self.refund_order_data = ""  # 退款主订单号(逗号分隔)
-        self.create_date = "1900-01-01 00:00:00"  # 申请时间
-        self.audit_date = "1900-01-01 00:00:00"  # 审核时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'app_id', 'act_id', 'user_id', 'open_id', 'user_nick', 'black_type', 'reason', 'audit_status', 'audit_remark', 'refund_count', 'refund_order_data', 'create_date', 'audit_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_black_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-15 17:17:08
+@LastEditTime: 2023-05-18 14:32:11
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class TaskLogModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(TaskLogModel, self).__init__(TaskLog, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class TaskLog:
+
+    def __init__(self):
+        super(TaskLog, self).__init__()
+        self.id = 0  # id
+        self.app_id = ""  # 应用标识
+        self.act_id = 0  # 活动标识
+        self.module_id = 0  # 活动模块标识
+        self.user_id = 0  # 用户标识
+        self.open_id = ""  # open_id
+        self.user_nick = ""  # 昵称
+        self.log_title = ""  # 标题
+        self.info_json = ""  # 详情信息
+        self.task_type = 0  # 任务类型
+        self.task_sub_type = ""  # 任务子类型
+        self.task_name = ""  # 任务名称
+        self.reward_type = ""  # 奖励类型
+        self.reward_object_id = ""  # 奖励对象标识
+        self.reward_name = ""  # 奖励名称
+        self.reward_num = 0  # 奖励数量
+        self.handler_name = ""  # 接口名称
+        self.request_code = ""  # 请求代码
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.create_day = 0  # 创建天
+        self.i1 = 0  # i1
+        self.s1 = ""  # s1
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'app_id', 'act_id', 'module_id', 'user_id', 'open_id', 'user_nick', 'log_title', 'info_json', 'task_type', 'task_sub_type', 'task_name', 'reward_type', 'reward_object_id', 'reward_name', 'reward_num', 'handler_name', 'request_code', 'create_date', 'create_day', 'i1', 's1']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "task_log_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/user/user_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/app/app_info_model.py`

 * *Files 23% similar despite different names*

```diff
@@ -1,74 +1,75 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 10:59:39
-@LastEditTime: 2021-09-02 17:19:36
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class UserInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(UserInfoModel, self).__init__(UserInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class UserInfo:
-
-    def __init__(self):
-        super(UserInfo, self).__init__()
-        self.id = 0  # id
-        self.id_md5 = ""  # id_md5(act_id+user_id)md5int生成
-        self.app_id = ""  # 应用标识
-        self.act_id = 0  # 活动标识
-        self.user_id = 0  # 用户标识
-        self.union_id = ""  # union_id
-        self.open_id = ""  # open_id
-        self.user_nick = ""  # 昵称
-        self.avatar = ""  # 头像
-        self.is_auth = 0  # 是否授权（1是0否）
-        self.is_new = 0  # 是否新用户
-        self.pay_price = 0  # 累计支付金额
-        self.pay_num = 0  # 累计支付笔数
-        self.login_token = ""  # 登录令牌
-        self.user_state = 0  # 用户状态（0-正常，1-黑名单）
-        self.is_member = 0  # 是否会员
-        self.is_member_before = 0  # 用户最初会员状态
-        self.is_favor = 0  # 是否关注店铺
-        self.is_favor_before = 0  # 用户最初关注状态（0未关注1已关注）
-        self.relieve_date = "1900-01-01 00:00:00"  # 解禁时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-        self.i1 = 0  # i1
-        self.i2 = 0  # i2
-        self.i3 = 0  # i3
-        self.i4 = 0  # i4
-        self.i5 = 0  # i5
-        self.s1 = ""  # s1
-        self.s2 = ""  # s2
-        self.s3 = ""  # s3
-        self.s4 = ""  # s4
-        self.s5 = ""  # s5
-        self.d1 = "1900-01-01 00:00:00"  # d1
-        self.d2 = "1900-01-01 00:00:00"  # d2
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'id_md5', 'app_id', 'act_id', 'user_id', 'union_id', 'open_id', 'user_nick', 'avatar', 'is_auth', 'is_new', 'pay_price', 'pay_num', 'login_token', 'user_state', 'is_member', 'is_member_before', 'is_favor', 'is_favor_before', 'relieve_date', 'create_date', 'modify_date', 'i1', 'i2', 'i3', 'i4', 'i5', 's1', 's2', 's3', 's4', 's5', 'd1', 'd2']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "user_info_tb"
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-07-20 10:09:52
+@LastEditTime: 2022-07-28 11:34:40
+@LastEditors: HuangJianYi
+@Description: 
+"""
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class AppInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(AppInfoModel, self).__init__(AppInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class AppInfo:
+
+    def __init__(self):
+        super(AppInfo, self).__init__()
+        self.id = 0  # id
+        self.store_name = ""  # 店铺名称
+        self.store_user_nick = ""  # 店铺主帐号名称（会员名）
+        self.main_user_open_id = "" # 店铺主账号open_id
+        self.store_id = 0  # 店铺ID
+        self.store_icon = ""  # 店铺图标
+        self.seller_id = ""  # 卖家ID
+        self.app_id = ""  # app_id
+        self.app_name = ""  # 应用名称
+        self.app_icon = ""  # 应用图标
+        self.app_url = ""  # 小程序链接
+        self.app_ver = ""  # 应用版本
+        self.app_key = ""  # 应用密钥
+        self.access_token = ""  # access_token
+        self.preview_url = ""  # 预览地址
+        self.app_desc = ""  # 应用介绍
+        self.template_id = ""  # 模板标识
+        self.template_ver = ""  # 模板版本号
+        self.clients = ""  # 适用客户端（taobao和tmall）
+        self.app_telephone = ""  # 手机号码
+        self.is_instance = 0  # 是否实例化：0-未实例化，1-已实例化
+        self.instance_date = "1900-01-01 00:00:00"  # 实例化时间
+        self.is_setting = 0  # 是否完成数据配置：0-未完成，1-已配置
+        self.expiration_date = "1900-01-01 00:00:00"  # 过期时间
+        self.project_code = ""  # 项目编码
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+        self.is_gm = 0  # 是否开启gm权限：0-否，1-是
+        self.current_limit_count = 0  # 限流数量
+        self.i1 = 0  # i1
+        self.i2 = 0  # i2
+        self.i3 = 0  # i3
+        self.i4 = 0  # i4
+        self.s1 = ""  # s1
+        self.s2 = ""  # s2
+        self.s3 = ""  # s3
+        self.s4 = ""  # s4
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'store_name', 'store_user_nick','main_user_open_id', 'store_id', 'store_icon', 'seller_id', 'app_id', 'app_name', 'app_icon', 'app_url', 'app_ver', 'app_key', 'access_token', 'preview_url', 'app_desc', 'template_id', 'template_ver', 'clients', 'app_telephone', 'is_instance', 'instance_date', 'is_setting', 'expiration_date', 'project_code', 'modify_date', 'is_gm', 'current_limit_count', 'i1', 'i2', 'i3', 'i4', 's1', 's2', 's3', 's4']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "app_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/db_models/version/version_info_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/db_models/version/version_info_model.py`

 * *Ordering differences only*

 * *Files 16% similar despite different names*

```diff
@@ -1,42 +1,42 @@
-#此文件由rigger自动生成
-from seven_framework.mysql import MySQLHelper
-from seven_framework.base_model import *
-from seven_cloudapp_frame.models.cache_model import *
-
-
-class VersionInfoModel(CacheModel):
-    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
-        super(VersionInfoModel, self).__init__(VersionInfo, sub_table)
-        self.db = MySQLHelper(config.get_value(db_connect_key))
-        self.db_connect_key = db_connect_key
-        self.db_transaction = db_transaction
-        self.db.context = context
-
-    #方法扩展请继承此类
-
-class VersionInfo:
-
-    def __init__(self):
-        super(VersionInfo, self).__init__()
-        self.id = 0  # id
-        self.type_id = 0  # 类型（1消费者端2千牛端）
-        self.version_number = ""  # 更新版本号
-        self.is_force_update = 0  # 是否强制更新（1是0否）
-        self.content = ""  # 更新内容
-        self.update_scope = 0  # 更新范围(1-全部,会同步更新到baseinfo表2-指定用户) 取最新记录，如果指定用户取最新记录的值，否则取baseinfo表的值
-        self.white_lists = ""  # 更新白名单(多个逗号分隔)
-        self.is_release = 0  # 是否发布（1是0否）
-        self.release_date = "1900-01-01 00:00:00"  # 发布时间
-        self.create_date = "1900-01-01 00:00:00"  # 创建时间
-        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
-
-    @classmethod
-    def get_field_list(self):
-        return ['id', 'type_id', 'version_number', 'is_force_update', 'content', 'update_scope', 'white_lists', 'is_release', 'release_date', 'create_date', 'modify_date']
-
-    @classmethod
-    def get_primary_key(self):
-        return "id"
-
-    def __str__(self):
-        return "version_info_tb"
+#此文件由rigger自动生成
+from seven_framework.mysql import MySQLHelper
+from seven_framework.base_model import *
+from seven_cloudapp_frame.models.cache_model import *
+
+
+class VersionInfoModel(CacheModel):
+    def __init__(self, db_connect_key='db_cloudapp', sub_table=None, db_transaction=None, context=None):
+        super(VersionInfoModel, self).__init__(VersionInfo, sub_table)
+        self.db = MySQLHelper(config.get_value(db_connect_key))
+        self.db_connect_key = db_connect_key
+        self.db_transaction = db_transaction
+        self.db.context = context
+
+    #方法扩展请继承此类
+
+class VersionInfo:
+
+    def __init__(self):
+        super(VersionInfo, self).__init__()
+        self.id = 0  # id
+        self.type_id = 0  # 类型（1消费者端2千牛端）
+        self.version_number = ""  # 更新版本号
+        self.is_force_update = 0  # 是否强制更新（1是0否）
+        self.content = ""  # 更新内容
+        self.update_scope = 0  # 更新范围(1-全部,会同步更新到baseinfo表2-指定用户) 取最新记录，如果指定用户取最新记录的值，否则取baseinfo表的值
+        self.white_lists = ""  # 更新白名单(多个逗号分隔)
+        self.is_release = 0  # 是否发布（1是0否）
+        self.release_date = "1900-01-01 00:00:00"  # 发布时间
+        self.create_date = "1900-01-01 00:00:00"  # 创建时间
+        self.modify_date = "1900-01-01 00:00:00"  # 更新时间
+
+    @classmethod
+    def get_field_list(self):
+        return ['id', 'type_id', 'version_number', 'is_force_update', 'content', 'update_scope', 'white_lists', 'is_release', 'release_date', 'create_date', 'modify_date']
+
+    @classmethod
+    def get_primary_key(self):
+        return "id"
+
+    def __str__(self):
+        return "version_info_tb"
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/goods_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/goods_base_model.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,134 +1,190 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-18 17:42:13
-@LastEditTime: 2021-08-26 10:29:19
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import PageInfo
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.db_models.special.special_goods_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-
-class GoodsBaseModel():
-    """
-    :description: 商品相关业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-   
-    def get_special_goods_list(self, app_id, goods_name, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
-        """
-        :description: 专属下单商品列表
-        :param app_id：应用标识
-        :param goods_name：商品名称
-        :param access_tokene：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录top请求日志
-        :param page_index：页索引
-        :param page_size：页大小
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        condition = "app_id=%s"
-        params = [app_id]
-        if goods_name:
-            condition += " and goods_name=%s"
-            params.append(goods_name)
-
-        special_goods_model = SpecialGoodsModel(context=self.context)
-        page_list, total = special_goods_model.get_dict_page_list("*", page_index, page_size, condition, params=params)
-        if not page_list:
-            invoke_result_data.data = []
-            return invoke_result_data
-
-        resp_special_goods = {}
-        resp_on_sale_goods = {}
-        act_prize_list = []
-        goods_id_list = [str(special_goods["goods_id"]) for special_goods in page_list]
-        if len(goods_id_list) > 0:
-            goods_ids = ",".join(goods_id_list)
-            act_prize_list = ActPrizeModel(context=self.context).get_dict_list(SevenHelper.get_condition_by_str_list("goods_id",goods_id_list))
-            top_base_model = TopBaseModel(context=self.context)
-            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp_on_sale_goods = invoke_result_data.data
-            if "error_message" in resp_on_sale_goods.keys():
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = resp_on_sale_goods["error_message"]
-                return invoke_result_data
-            invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
-            if invoke_result_data.success == False:
-                return invoke_result_data
-            resp_special_goods = invoke_result_data.data
-
-        # resp_on_sale_goods = {'items_seller_list_get_response': {'items': {'item': [{'input_str': '123321', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645237589892, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20000:6151601944:品牌:15phoe/衣窝风;20021:105255:主要材质:棉;20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色;8560225:740132938:上市时间:2015年冬季;13021751:3251403:货号:123321', 'skus': {'sku': [{'created': '2021-05-23 16:00:15', 'modified': '2021-05-23 16:00:15', 'price': '10.00', 'properties': '20509:12430609;1627207:28341', 'properties_name': '20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色', 'quantity': 10, 'sku_id': 4818446850738}]}, 'title': '专属测试523男士包头帽'}, {'input_str': '', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645938651976, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20021:105255:主要材质:棉', 'title': '523170000'}]}, 'request_id': '41zzkkd2aorh'}}
-        # resp_special_goods = {'opentrade_special_items_query_response': {'items': {'number': [645938651976, 645237589892, 634388910274, 641313416583, 641692061394, 641691601551, 632998091188, 639914960755]}, 'request_id': '5aaavqza0p93'}}
-
-        for special_goods in page_list:
-            if "items_seller_list_get_response" in resp_on_sale_goods.keys():
-                if "items" in resp_on_sale_goods["items_seller_list_get_response"].keys():
-                    cur_resp_goods_list = [resp_goods for resp_goods in resp_on_sale_goods["items_seller_list_get_response"]["items"]["item"] if resp_goods["num_iid"] == special_goods["goods_id"]]
-                    if len(cur_resp_goods_list) > 0:
-                        special_goods["title"] = cur_resp_goods_list[0]["title"]
-                        special_goods["price"] = cur_resp_goods_list[0]["price"]
-                    else:
-                        special_goods["title"] = ""
-                        special_goods["price"] = 0.00
-
-                    if special_goods["title"] != "" and special_goods["title"] != special_goods["goods_name"]:
-                        special_goods_model.update_table("goods_name=%s", "id=%s", params=[special_goods["title"], special_goods["id"]])
-
-            if "opentrade_special_items_query_response" in resp_special_goods.keys():
-                if "items" in resp_special_goods["opentrade_special_items_query_response"].keys():
-                    cur_resp_special_goods_list = [goods_id for goods_id in resp_special_goods["opentrade_special_items_query_response"]["items"]["number"] if goods_id == special_goods["goods_id"]]
-                    if len(cur_resp_special_goods_list) <= 0:
-                        special_goods["is_bind"] = 1
-                    else:
-                        special_goods["is_bind"] = 0
-
-            cur_act_prize_list = [act_prize for act_prize in act_prize_list if act_prize["goods_id"] == special_goods["goods_id"]]
-            special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
-
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        invoke_result_data.data = page_info
-        return invoke_result_data
-        
-    def bind_special_goods(self, app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log=False):
-        """
-        :description: 专属下单商品绑定(单个商品)
-        :param app_id：应用标识
-        :param goods_id：商品ID
-        :param goods_name: 商品名称
-        :param access_tokene：access_token
-        :param app_key：app_key
-        :param app_secret：app_secret
-        :param is_log：是否记录top请求日志
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        top_base_model = TopBaseModel(context=self.context)
-        invoke_result_data = top_base_model.open_trade_special_items_bind(app_id, goods_id, access_token, app_key, app_secret, is_log)
-        if invoke_result_data.success == False:
-            return invoke_result_data
-        special_goods_model = SpecialGoodsModel()
-        special_goods = special_goods_model.get_dict("app_id=%s and goods_id=%s", params=[app_id, goods_id])
-        if not special_goods:
-            special_goods = SpecialGoods()
-            special_goods.app_id = app_id
-            special_goods.goods_id = goods_id
-            special_goods.goods_name = goods_name
-            special_goods.create_date = SevenHelper.get_now_datetime()
-            special_goods_model.add_entity(special_goods)
-        else:
-            special_goods.goods_id = goods_id
-            special_goods.goods_name = goods_name
-            special_goods.modify_date = SevenHelper.get_now_datetime()
-            special_goods_model.update_entity(special_goods,"goods_id,goods_name,modify_date")
-        return invoke_result_data
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-18 17:42:13
+@LastEditTime: 2023-05-25 18:41:53
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import PageInfo
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.db_models.special.special_goods_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+
+class GoodsBaseModel():
+    """
+    :description: 商品相关业务模型
+    """
+    def __init__(self,context=None,logging_error=None,logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def get_special_goods_list(self, app_id, goods_name, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
+        """
+        :description: 专属下单商品列表（只取小程序内的历史绑定过的商品列表）
+        :param app_id：应用标识
+        :param goods_name：商品名称
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :param page_index：页索引
+        :param page_size：页大小
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        condition = "app_id=%s"
+        params = [app_id]
+        if goods_name:
+            condition += " and goods_name=%s"
+            params.append(goods_name)
+
+        special_goods_model = SpecialGoodsModel(context=self.context)
+        page_list, total = special_goods_model.get_dict_page_list("*", page_index, page_size, condition, order_by="id asc", params=params)
+        if not page_list:
+            invoke_result_data.data = []
+            return invoke_result_data
+
+        resp_special_goods = {}
+        resp_on_sale_goods = {}
+        act_prize_list = []
+        goods_id_list = [str(special_goods["goods_id"]) for special_goods in page_list]
+        if len(goods_id_list) > 0:
+            goods_ids = ",".join(goods_id_list)
+            condition_where = ConditionWhere()
+            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",goods_id_list))
+            condition_where.add_condition("is_del=0")
+            act_prize_list = ActPrizeModel(context=self.context).get_dict_list(condition_where.to_string())
+            top_base_model = TopBaseModel(context=self.context)
+            invoke_result_data = top_base_model.get_goods_list_by_goodsids(goods_ids, access_token, app_key, app_secret, "num_iid,title,nick,pic_url,price", is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp_on_sale_goods = invoke_result_data.data
+            if "error_message" in resp_on_sale_goods.keys():
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = resp_on_sale_goods["error_message"]
+                return invoke_result_data
+            invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            resp_special_goods = invoke_result_data.data
+
+        # resp_on_sale_goods = {'items_seller_list_get_response': {'items': {'item': [{'input_str': '123321', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645237589892, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20000:6151601944:品牌:15phoe/衣窝风;20021:105255:主要材质:棉;20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色;8560225:740132938:上市时间:2015年冬季;13021751:3251403:货号:123321', 'skus': {'sku': [{'created': '2021-05-23 16:00:15', 'modified': '2021-05-23 16:00:15', 'price': '10.00', 'properties': '20509:12430609;1627207:28341', 'properties_name': '20509:12430609:尺码:S（54-56cm）;1627207:28341:颜色分类:黑色', 'quantity': 10, 'sku_id': 4818446850738}]}, 'title': '专属测试523男士包头帽'}, {'input_str': '', 'newprepay': 'default', 'nick': 'loveyouhk', 'num_iid': 645938651976, 'pic_url': 'https://img.alicdn.com/bao/uploaded/i4/305104024/O1CN01hjxRJe1fb2PfX01n8_!!305104024.jpg', 'price': '10.00', 'property_alias': '', 'props_name': '20021:105255:主要材质:棉', 'title': '523170000'}]}, 'request_id': '41zzkkd2aorh'}}
+        # resp_special_goods = {'opentrade_special_items_query_response': {'items': {'number': [645938651976, 645237589892, 634388910274, 641313416583, 641692061394, 641691601551, 632998091188, 639914960755]}, 'request_id': '5aaavqza0p93'}}
+
+        for special_goods in page_list:
+            if "items_seller_list_get_response" in resp_on_sale_goods.keys():
+                if "items" in resp_on_sale_goods["items_seller_list_get_response"].keys():
+                    cur_resp_goods_list = [resp_goods for resp_goods in resp_on_sale_goods["items_seller_list_get_response"]["items"]["item"] if str(resp_goods.get("num_iid", "")) == special_goods["goods_id"]]
+                    if len(cur_resp_goods_list) > 0:
+                        special_goods["title"] = cur_resp_goods_list[0]["title"]
+                        special_goods["price"] = cur_resp_goods_list[0]["price"]
+                    else:
+                        special_goods["title"] = ""
+                        special_goods["price"] = 0.00
+
+                    if special_goods["title"] != "" and special_goods["title"] != special_goods["goods_name"]:
+                        special_goods_model.update_table("goods_name=%s", "id=%s", params=[special_goods["title"], special_goods["id"]])
+
+            if "opentrade_special_items_query_response" in resp_special_goods.keys():
+                if "items" in resp_special_goods["opentrade_special_items_query_response"].keys():
+                    cur_resp_special_goods_list = [goods_id for goods_id in resp_special_goods["opentrade_special_items_query_response"]["items"]["number"] if str(goods_id) == special_goods["goods_id"]]
+                    if len(cur_resp_special_goods_list) <= 0:
+                        special_goods["is_bind"] = 1
+                    else:
+                        special_goods["is_bind"] = 0
+
+            cur_act_prize_list = [act_prize for act_prize in act_prize_list if act_prize["goods_id"] == special_goods["goods_id"]]
+            special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
+
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        invoke_result_data.data = page_info
+        return invoke_result_data
+
+    def get_special_goods_list_for_tb(self, app_id, goods_id, access_token, app_key, app_secret, is_log=False, page_index=0, page_size=20):
+        """
+        :description: 专属下单商品列表（取淘宝接口返回的已绑定的商品列表）
+        :param app_id：应用标识
+        :param goods_id：商品ID
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :param page_index：页索引
+        :param page_size：页大小
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        special_goods_id_list = []
+        special_goods_list = []
+        top_base_model = TopBaseModel(context=self.context)
+        invoke_result_data = top_base_model.open_trade_special_items_query(app_id, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        if len(invoke_result_data.data["opentrade_special_items_query_response"]["items"]) <= 0:
+            invoke_result_data.data = PageInfo(page_index, page_size, 0, [])
+            return invoke_result_data
+        special_goods_id_list = invoke_result_data.data["opentrade_special_items_query_response"]["items"]["number"]
+
+        if goods_id and goods_id in special_goods_id_list:
+            record_count = 1
+            special_goods_id_list=[goods_id]
+        else:
+            record_count = len(special_goods_id_list)
+            special_goods_id_list = special_goods_id_list[page_index*page_size:(page_index+1)*page_size]
+        if len(special_goods_id_list)>0:
+            special_goods_ids = ",".join([str(i) for i in special_goods_id_list])
+            invoke_result_data = top_base_model.get_goods_list_by_goodsids(special_goods_ids, access_token, app_key, app_secret,"num_iid,title,pic_url,price", is_log)
+            if invoke_result_data.success == False:
+                return invoke_result_data
+            special_goods_list = invoke_result_data.data["items_seller_list_get_response"]["items"]["item"]
+            act_prize_model = ActPrizeModel(context=self.context)
+            condition_where = ConditionWhere()
+            condition_where.add_condition(SevenHelper.get_condition_by_str_list("goods_id",special_goods_id_list))
+            condition_where.add_condition("is_del=0")
+            act_prize_dict_list = act_prize_model.get_dict_list(condition_where.to_string())
+            for special_goods in special_goods_list:
+                cur_act_prize_list = [act_prize for act_prize in act_prize_dict_list if act_prize["goods_id"] == special_goods["goods_id"]]
+                special_goods["is_select"] = 1 if len(cur_act_prize_list) > 0 else 0
+
+        page_info = PageInfo(page_index, page_size, record_count, special_goods_list)
+        invoke_result_data.data = page_info
+        return invoke_result_data
+
+    def bind_special_goods(self, app_id, goods_id, goods_name, access_token, app_key, app_secret, is_log=False):
+        """
+        :description: 专属下单商品绑定(单个商品)
+        :param app_id：应用标识
+        :param goods_id：商品ID
+        :param goods_name: 商品名称
+        :param access_tokene：access_token
+        :param app_key：app_key
+        :param app_secret：app_secret
+        :param is_log：是否记录top请求日志
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        top_base_model = TopBaseModel(context=self.context)
+        invoke_result_data = top_base_model.open_trade_special_items_bind(app_id, goods_id, access_token, app_key, app_secret, is_log)
+        if invoke_result_data.success == False:
+            return invoke_result_data
+        special_goods_model = SpecialGoodsModel()
+        special_goods = special_goods_model.get_dict("app_id=%s and goods_id=%s", limit="1", params=[app_id, goods_id])
+        if not special_goods:
+            special_goods = SpecialGoods()
+            special_goods.app_id = app_id
+            special_goods.goods_id = goods_id
+            special_goods.goods_name = goods_name
+            special_goods.create_date = SevenHelper.get_now_datetime()
+            special_goods_model.add_entity(special_goods)
+        else:
+            special_goods.goods_id = goods_id
+            special_goods.goods_name = goods_name
+            special_goods.modify_date = SevenHelper.get_now_datetime()
+            special_goods_model.update_entity(special_goods,"goods_id,goods_name,modify_date")
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/module_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/module_base_model.py`

 * *Files 22% similar despite different names*

```diff
@@ -1,268 +1,275 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-05 10:54:36
-@LastEditTime: 2021-09-18 11:49:54
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import *
-
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-class ModuleBaseModel():
-    """
-    :description: 活动模块业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-
-
-    def _delete_act_module_dependency_key(self,act_id,module_id):
-            """
-            :description: 删除活动模块依赖建
-            :param act_id: 活动标识
-            :param module_id: 活动模块标识
-            :return: 
-            :last_editors: HuangJianYi
-            """
-            try:
-                redis_init = SevenHelper.redis_init()
-                if module_id:
-                    redis_init.delete(f"act_module:moduleid_{module_id}")
-                if act_id:
-                    redis_init.delete(f"act_module_list:actid_{act_id}")
-            except Exception as ex:
-                pass
-        
-    def get_act_module_dict(self,module_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取活动模块
-        :param module_id: 模块标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布或删除的数据
-        :return: 返回活动模块
-        :last_editors: HuangJianYi
-        """
-        act_module_model = ActModuleModel(context=self.context)
-        if is_cache:
-            dependency_key = f"act_module:moduleid_{module_id}"
-            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=dependency_key)
-        else:
-            act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if is_filter == True:
-            if not act_module_dict or act_module_dict["is_release"] == 0 or act_module_dict["is_del"] == 1:
-                return None
-        return act_module_dict
-
-    def get_act_module_list(self,app_id,act_id,module_name,start_date,end_date,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],is_cache=True):
-        """
-        :description: 获取活动信息列表
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_name: 模块名称
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param is_del: 是否回收站1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :param order_by：排序
-        :param condition：条件
-        :param params：参数化数组
-        :param is_cache: 是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s AND act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        if is_del !=-1:
-            where += " AND is_del=%s"
-            params_list.append(is_del)
-        if module_name:
-            where += " AND module_name=%s"
-            params_list.append(module_name)
-        if start_date != "":
-            where += " AND start_date>=%s"
-            params_list.append(start_date)
-        if end_date != "":
-            where += " AND end_date<=%s"
-            params_list.append(end_date)
-        if is_cache:
-            page_list, total = ActModuleModel(context=self.context).get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=f"act_module_list:actid_{act_id}")
-        else:
-            page_list, total = ActModuleModel(context=self.context).get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list)    
-        return page_list, total
-
-    def save_act_module(self,app_id,act_id,module_id,module_name,module_sub_name,start_date,end_date,module_pic,module_desc,price,price_gear_id,ip_id,join_ways,is_fictitious,sort_index,is_release,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2):
-        """
-        :description: 添加活动模块信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param module_name: 模块名称
-        :param module_sub_name: 模块短名称
-        :param start_date: 开始时间
-        :param end_date: 结束时间
-        :param module_pic: 模块图片
-        :param module_desc: 描述信息
-        :param price: 价格
-        :param price_gear_id: 档位标识
-        :param ip_id: IP标识
-        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
-        :param is_fictitious: 是否开启虚拟中奖（1是0否）
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        
-        is_add = False
-        old_act_module = None
-        now_datetime = SevenHelper.get_now_datetime()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module = None
-        if module_id > 0:
-            act_module = act_module_model.get_entity_by_id(module_id)
-            if not act_module or act_module.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动模块信息不存在"
-                return invoke_result_data
-            old_act_module = deepcopy(act_module)
-        if not act_module:
-            is_add = True
-            act_module = ActModule()
-
-        act_module.app_id = app_id
-        act_module.act_id = act_id
-        act_module.module_name = module_name
-        act_module.module_sub_name = module_sub_name
-        act_module.start_date = start_date
-        act_module.end_date = end_date
-        act_module.module_pic = module_pic
-        act_module.module_desc = module_desc
-        act_module.price = price
-        act_module.price_gear_id = price_gear_id
-        act_module.ip_id = ip_id
-        act_module.join_ways = join_ways
-        act_module.is_fictitious = is_fictitious
-        act_module.sort_index = sort_index
-        act_module.is_release = is_release
-        act_module.release_date = now_datetime
-        act_module.i1 = i1
-        act_module.i2 = i2
-        act_module.i3 = i3
-        act_module.i4 = i4
-        act_module.i5 = i5
-        act_module.s1 = s1
-        act_module.s2 = s2
-        act_module.s3 = s3
-        act_module.s4 = s4
-        act_module.s5 = s5
-        act_module.d1 = d1
-        act_module.d2 = d2
-        act_module.modify_date = now_datetime
-        
-        if is_add:
-            act_module.create_date = now_datetime
-            act_module.id = act_module_model.add_entity(act_module)
-        else:
-            act_module_model.update_entity(act_module,exclude_field_list="app_id,act_id")
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = act_module
-        result["old"] = old_act_module
-        invoke_result_data.data = result
-        self._delete_act_module_dependency_key(act_id,act_module.id)
-        return invoke_result_data
-        
-    def update_act_module_status(self,app_id,module_id,is_del):
-        """
-        :description: 删除或者还原活动模块
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if not act_module_dict or act_module_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动模块信息不存在"
-            return invoke_result_data
-        is_release = 0 if is_del == 1 else 1
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_module_model.update_table("is_del=%s,is_release=%s,release_date=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, modify_date, module_id])
-        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
-        return invoke_result_data
-    
-    def release_act_module(self,app_id,module_id,is_release):
-        """
-        :description: 活动模块上下架
-        :param app_id：应用标识
-        :param module_id：活动模块标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        act_module_dict = act_module_model.get_dict_by_id(module_id)
-        if not act_module_dict or act_module_dict["app_id"]!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "no_module"
-            invoke_result_data.error_message = "活动信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = act_module_model.update_table("release_date=%s,is_release=%s", "id=%s", [SevenHelper.get_now_datetime(), is_release, module_id])
-        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
-        return invoke_result_data
-    
-    def update_act_module_price(self,app_id,act_id,prize_gear_id):
-        """
-        :description: 更新活动模块价格
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param prize_gear_id：档位标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_module_model = ActModuleModel(context=self.context)
-        price_gear_model = PriceGearModel(context=self.context)
-        price_gear_dict = price_gear_model.get_dict_by_id(prize_gear_id)
-        if not price_gear_dict or price_gear_dict["app_id"]!= app_id or price_gear_dict["act_id"] != act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "价格档位信息不存在"
-            return invoke_result_data
-        invoke_result_data.success = act_module_model.update_table("price=%s", "act_id=%s and price_gears_id=%s", params=[price_gear_dict["price"], act_id, prize_gear_id])
-        self._delete_act_module_dependency_key(act_id,0)
-        return invoke_result_data
-    
-
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-05 10:54:36
+@LastEditTime: 2023-03-13 11:29:15
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.seven_model import *
+
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+class ModuleBaseModel():
+    """
+    :description: 活动模块业务模型
+    """
+    def __init__(self, context=None, logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+
+    def _delete_act_module_dependency_key(self, act_id, module_id, delay_delete_time=0.01):
+        """
+        :description: 删除活动模块依赖建
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = []
+        if module_id:
+            dependency_key_list.append(DependencyKey.act_module(module_id))
+        if act_id:
+            dependency_key_list.append(DependencyKey.act_module_list(act_id))
+        ActModuleModel().delete_dependency_key(dependency_key_list, delay_delete_time)
+        
+
+    def get_act_module_dict(self,module_id,is_cache=True,is_filter=True):
+        """
+        :description: 获取活动模块
+        :param module_id: 模块标识
+        :param is_cache: 是否缓存
+        :param is_filter: 是否过滤未发布或删除的数据
+        :return: 返回活动模块
+        :last_editors: HuangJianYi
+        """
+        act_module_model = ActModuleModel(context=self.context)
+        if is_cache:
+            dependency_key = DependencyKey.act_module(module_id)
+            act_module_dict = act_module_model.get_cache_dict_by_id(module_id,dependency_key=dependency_key)
+        else:
+            act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if is_filter == True:
+            if not act_module_dict or act_module_dict["is_release"] == 0 or act_module_dict["is_del"] == 1:
+                return None
+        return act_module_dict
+
+    def get_act_module_list(self,app_id,act_id,module_name,start_date,end_date,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],is_cache=True):
+        """
+        :description: 获取活动信息列表
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_name: 模块名称
+        :param start_date：开始时间
+        :param end_date：结束时间
+        :param is_del: 是否回收站1是0否
+        :param page_size: 条数
+        :param page_index: 页数
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :param is_cache: 是否缓存
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s AND act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        if is_del !=-1:
+            where += " AND is_del=%s"
+            params_list.append(is_del)
+        if module_name:
+            where += " AND module_name=%s"
+            params_list.append(module_name)
+        if start_date != "":
+            where += " AND start_date>=%s"
+            params_list.append(start_date)
+        if end_date != "":
+            where += " AND end_date<=%s"
+            params_list.append(end_date)
+        if is_cache:
+            page_list, total = ActModuleModel(context=self.context).get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_module_list(act_id))
+        else:
+            page_list, total = ActModuleModel(context=self.context).get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list)
+        return page_list, total
+
+    def save_act_module(self,app_id,act_id,module_id,module_name,module_sub_name,start_date,end_date,module_pic,module_desc,price,price_gear_id,ip_id,join_ways,is_fictitious,sort_index,is_release,i1,i2,i3,i4,i5,s1,s2,s3,s4,s5,d1,d2,business_type=0,module_type=0):
+        """
+        :description: 添加活动模块信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_id: 活动模块标识
+        :param module_name: 模块名称
+        :param module_sub_name: 模块短名称
+        :param start_date: 开始时间
+        :param end_date: 结束时间
+        :param module_pic: 模块图片
+        :param module_desc: 描述信息
+        :param price: 价格
+        :param price_gear_id: 档位标识
+        :param ip_id: IP标识
+        :param join_ways: 活动参与条件（0所有1关注店铺2加入会员3指定用户）
+        :param is_fictitious: 是否开启虚拟中奖（1是0否）
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :param business_type: 业务类型(0无1机台2活动)
+        :param module_type: 模块类型
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        is_add = False
+        old_act_module = None
+        now_datetime = SevenHelper.get_now_datetime()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module = None
+        if module_id > 0:
+            act_module = act_module_model.get_entity_by_id(module_id)
+            if not act_module or act_module.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动模块信息不存在"
+                return invoke_result_data
+            old_act_module = deepcopy(act_module)
+        if not act_module:
+            is_add = True
+            act_module = ActModule()
+
+        act_module.app_id = app_id
+        act_module.act_id = act_id
+        act_module.business_type = business_type
+        act_module.module_name = module_name
+        act_module.module_sub_name = module_sub_name
+        act_module.module_type = module_type
+        act_module.start_date = start_date
+        act_module.end_date = end_date
+        act_module.module_pic = module_pic
+        act_module.module_desc = module_desc
+        act_module.price = price
+        act_module.price_gear_id = price_gear_id
+        act_module.ip_id = ip_id
+        act_module.join_ways = join_ways
+        act_module.is_fictitious = is_fictitious
+        act_module.sort_index = sort_index
+        act_module.is_release = is_release
+        act_module.release_date = now_datetime
+        act_module.i1 = i1
+        act_module.i2 = i2
+        act_module.i3 = i3
+        act_module.i4 = i4
+        act_module.i5 = i5
+        act_module.s1 = s1
+        act_module.s2 = s2
+        act_module.s3 = s3
+        act_module.s4 = s4
+        act_module.s5 = s5
+        act_module.d1 = d1
+        act_module.d2 = d2
+        act_module.modify_date = now_datetime
+
+        if is_add:
+            act_module.create_date = now_datetime
+            act_module.id = act_module_model.add_entity(act_module)
+        else:
+            act_module_model.update_entity(act_module,exclude_field_list="app_id,act_id")
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = act_module
+        result["old"] = old_act_module
+        invoke_result_data.data = result
+        self._delete_act_module_dependency_key(act_id,act_module.id)
+        return invoke_result_data
+
+    def update_act_module_status(self,app_id,module_id,is_del):
+        """
+        :description: 删除或者还原活动模块
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param is_del：0-还原，1-删除
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if not act_module_dict or act_module_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动模块信息不存在"
+            return invoke_result_data
+        is_release = 0
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_module_model.update_table("is_del=%s,is_release=%s,release_date=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, modify_date, module_id])
+        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
+        invoke_result_data.data = act_module_dict
+        return invoke_result_data
+
+    def release_act_module(self,app_id,module_id,is_release):
+        """
+        :description: 活动模块上下架
+        :param app_id：应用标识
+        :param module_id：活动模块标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        act_module_dict = act_module_model.get_dict_by_id(module_id)
+        if not act_module_dict or act_module_dict["app_id"]!=app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "no_module"
+            invoke_result_data.error_message = "活动信息不存在"
+            return invoke_result_data
+        invoke_result_data.success = act_module_model.update_table("release_date=%s,is_release=%s", "id=%s", [SevenHelper.get_now_datetime(), is_release, module_id])
+        self._delete_act_module_dependency_key(act_module_dict["act_id"],module_id)
+        invoke_result_data.data = act_module_dict
+        return invoke_result_data
+
+    def update_act_module_price(self,app_id,act_id,prize_gear_id):
+        """
+        :description: 更新活动模块价格
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_gear_id：档位标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_module_model = ActModuleModel(context=self.context)
+        price_gear_model = PriceGearModel(context=self.context)
+        price_gear_dict = price_gear_model.get_dict_by_id(prize_gear_id)
+        if not price_gear_dict or price_gear_dict["app_id"]!= app_id or price_gear_dict["act_id"] != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "价格档位信息不存在"
+            return invoke_result_data
+        invoke_result_data.success = act_module_model.update_table("price=%s", "act_id=%s and price_gears_id=%s", params=[price_gear_dict["price"], act_id, prize_gear_id])
+        self._delete_act_module_dependency_key(act_id,0)
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/order_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/order_base_model.py`

 * *Files 26% similar despite different names*

```diff
@@ -1,830 +1,1155 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-09 09:24:43
-@LastEditTime: 2021-10-12 17:54:09
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.user_base_model import UserBaseModel
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.models.app_base_model import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.price_base_model import *
-from seven_cloudapp_frame.models.asset_base_model import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_pay_order_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-
-
-class OrderBaseModel(FrameBaseModel):
-    """
-    :description: 订单和中奖记录相关业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-        super(OrderBaseModel,self).__init__(context)
-    
-    def _delete_prize_order_dependency_key(self,act_id):
-        """
-        :description: 删除订单依赖建
-        :param act_id: 活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        try:
-            redis_init = SevenHelper.redis_init()
-            if act_id:
-                redis_init.delete(f"prize_order_list:actid_{act_id}")
-        except Exception as ex:
-            pass
-
-    def get_prize_order_list(self,app_id,act_id,user_id,open_id,nick_name,order_no,real_name,telephone,address,order_status,create_date_start,create_date_end,page_size=20,page_index=0,order_by="create_date desc",field="*",is_search_roster=False,is_cache=True):
-        """
-        :description: 用户奖品订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param order_no：订单号
-        :param nick_name：用户昵称
-        :param real_name：用户名字
-        :param telephone：联系电话
-        :param address：收货地址
-        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
-        :param create_date_start：订单创建时间开始
-        :param create_date_end：订单创建时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param order_by：排序
-        :param field：查询字段
-        :param is_search_roster：是否查询订单关联中奖记录
-        :param is_cache：是否缓存
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id,act_id]
-        page_info = PageInfo(page_index, page_size, 0, [])
-        
-        if not app_id or not act_id:
-            return page_info
-        if user_id:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if order_no:
-            condition += " AND order_no=%s"
-            params.append(order_no)
-        if nick_name:
-            condition += " AND user_nick=%s"
-            params.append(nick_name)
-        if real_name:
-            condition += " AND real_name=%s"
-            params.append(real_name)
-        if telephone:
-            condition += " AND telephone=%s"
-            params.append(telephone)
-        if address:
-            address = f"{address}%"
-            condition += " AND address like %s"
-            params.append(address)
-        if order_status >=-2:
-            condition += " AND order_status=%s"
-            params.append(order_status)
-        if create_date_start:
-            condition += " AND create_date>=%s"
-            params.append(create_date_start)
-        if create_date_end:
-            condition += " AND create_date<=%s"
-            params.append(create_date_end)
-        prize_order_model = PrizeOrderModel(context=self.context)
-        if is_cache:
-            dependency_key=f"prize_order_list:actid_{act_id}"
-            if user_id:
-                dependency_key += f"_userid_{user_id}"
-            page_list, total = prize_order_model.get_cache_dict_page_list(field, page_index, page_size, condition, "", order_by, params,dependency_key)
-        else:
-            page_list, total = prize_order_model.get_dict_page_list(field, page_index, page_size, condition, "", order_by, params)
-        if is_search_roster == True:
-            prize_roster_model = PrizeRosterModel(context=self.context)
-            if page_list and len(page_list)>0:
-                order_no_list = [str(i['order_no']) for i in page_list]
-                order_nos = ",".join(order_no_list)
-                prize_roster_list_dict = prize_roster_model.get_dict_list("order_no in (" + order_nos + ")")
-                for i in range(len(page_list)):
-                    roster_list = [prize_roster for prize_roster in prize_roster_list_dict if page_list[i]["order_no"] == prize_roster["order_no"]]
-                    page_list[i]["roster_list"] = roster_list
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def update_prize_order_status(self,app_id,prize_order_id,order_status,express_company="",express_no=""):
-        """
-        :description: 更新用户奖品订单状态
-        :param app_id：应用标识
-        :param prize_order_id：奖品订单标识
-        :param order_status：订单状态
-        :param express_company：快递公司
-        :param express_no：快递单号
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        now_datetime = SevenHelper.get_now_datetime()
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
-        prize_order_model = PrizeOrderModel(context=self.context,db_transaction=db_transaction)
-        prize_roster_model = PrizeRosterModel(context=self.context,db_transaction=db_transaction)
-        invoke_result_data = InvokeResultData()
-
-        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
-        if not prize_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-1"
-            return invoke_result_data
-        if prize_order.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-2"
-            return invoke_result_data
-        try:
-            db_transaction.begin_transaction()
-            if order_status == 1:
-                if not express_company and not express_no:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message ="快递公司或快递单号不能为空"
-                    return invoke_result_data
-                update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s,modify_date=%s"
-                params = [express_company, express_no, now_datetime, now_datetime, prize_order_id]
-                prize_order_model.update_table(update_sql, "id=%s", params)
-                prize_roster_model.update_table("logistics_status=1", "act_id=%s and order_no=%s", [prize_order.act_id,prize_order.order_no])
-            if order_status == 2:
-                update_sql = "order_status=2,modify_date=%s"
-                params = [now_datetime, prize_order_id]
-                prize_order_model.update_table(update_sql, "id=%s", params)
-                prize_roster_model.update_table("logistics_status=2", "act_id=%s and order_no=%s", [prize_order.act_id,prize_order.order_no])
-            else:
-                prize_order_model.update_table("order_status=%s,modify_date=%s", "id=%s", [order_status, now_datetime, prize_order_id])
-            result = db_transaction.commit_transaction()
-            if result == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message ="操作失败"
-                return invoke_result_data
-                
-        except Exception as ex:
-            self.context.logging_link_error(traceback.format_exc())
-            db_transaction.rollback_transaction()
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="操作失败"
-            return invoke_result_data
-
-        return invoke_result_data
-
-    def update_prize_order_seller_remark(self,app_id,prize_order_id,seller_remark):
-        """
-        :description: 更新用户奖品订单卖家备注
-        :param app_id：应用标识
-        :param prize_order_id：奖品订单标识
-        :param seller_remark：卖家备注
-        :return: 实体模型InvokeResultData
-        :last_editors: HuangJianYi
-        """
-        now_datetime = SevenHelper.get_now_datetime()
-        prize_order_model = PrizeOrderModel(context=self.context)
-        invoke_result_data = InvokeResultData()
-
-        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
-        if not prize_order:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-1"
-            return invoke_result_data
-        if prize_order.app_id!=app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="奖品订单信息不存在-2"
-            return invoke_result_data
-        prize_order_model.update_table("seller_remark=%s,modify_date=%s", "id=%s", [seller_remark, now_datetime, prize_order_id])
-        return invoke_result_data
-
-    def import_prize_order(self,app_id,act_id,content_type,content,ref_head_name='小程序订单号'):
-        """
-        :description: 
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
-        :param content：字符串内容
-        :param ref_head_name：关联表头名称
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="无效活动,无法导入订单"
-            return invoke_result_data
-        data = []   
-        if content_type == 1:
-            data = base64.decodebytes(content.encode())
-            if not os.path.exists("temp"):
-                os.makedirs("temp")
-            path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
-            with open(path, 'ba') as f:
-                buf = bytearray(data)
-                f.write(buf)
-            f.close()
-        else:
-            data = SevenHelper.json_loads(content.decode())
-
-        order_no_index = -1
-        express_no_index = -1
-        express_company_index = -1
-
-        data = ExcelHelper.input(path)
-        data_total = len(data)
-        # 表格头部
-        if data_total > 0:
-            title_list = data[0]
-            if ref_head_name in title_list:
-                order_no_index = title_list.index(ref_head_name)
-            if "物流单号" in title_list:
-                express_no_index = title_list.index("物流单号")
-            if "物流公司" in title_list:
-                express_company_index = title_list.index("物流公司")
-
-        if order_no_index == -1 or express_no_index == -1 or express_company_index == -1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="缺少必要字段，无法导入订单"
-            return invoke_result_data
-        prize_order_model = PrizeOrderModel(context=self.context)
-        prize_roster_model = PrizeRosterModel(context=self.context)
-        # 数据导入
-        for i in range(1, data_total):
-            row = data[i]
-            order_no = row[order_no_index]
-            express_no = row[express_no_index]
-            express_company = row[express_company_index]
-            if order_no and express_no and express_company:
-                now_datetime = SevenHelper.get_now_datetime()
-                update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
-                params = [express_company, express_no, now_datetime, app_id,act_id,order_no]
-                prize_order_model.update_table(update_sql, "app_id=%s and act_id=%s and order_no=%s", params)
-                prize_roster_model.update_table("logistics_status=1", "app_id=%s and act_id=%s and order_no=%s", [app_id,act_id,order_no])
-
-        os.remove(path)
-
-        return invoke_result_data
-
-    def get_tao_pay_order_list(self,app_id,act_id,user_id,open_id,nick_name,pay_date_start,pay_date_end,page_size=20,page_index=0,field='*'):
-        """
-        :description: 用户购买订单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户唯一标识
-        :param open_id：open_id
-        :param nick_name：用户昵称
-        :param pay_date_start：订单支付时间开始
-        :param pay_date_end：订单支付时间结束
-        :param page_size：页大小
-        :param page_index：页索引
-        :param field：查询字段
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        condition = "app_id=%s and act_id=%s"
-        params = [app_id,act_id]
-        page_info = PageInfo(page_index, page_size, 0, [])
-        
-        if not act_id:
-            return page_info
-        if not user_id and not open_id:
-            return page_info
-        if user_id:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if nick_name:
-            condition += " AND user_nick=%s"
-            params.append(nick_name)
-        if pay_date_start:
-            condition += " AND pay_date>=%s"
-            params.append(pay_date_start)
-        if pay_date_end:
-            condition += " AND pay_date<=%s"
-            params.append(pay_date_end)
-        page_list, total = TaoPayOrderModel(context=self.context).get_dict_page_list(field, page_index, page_size, condition, "", "pay_date desc", params)
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-    
-    def select_prize_order(self,app_id,act_id,user_id,login_token,prize_ids,real_name,telephone,province,city,county,street,address):
-        """
-        :description: 选择奖品进行下单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param login_token:用户访问令牌
-        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
-        :param real_name:用户名
-        :param telephone:电话
-        :param province:省
-        :param city:市
-        :param county:区县
-        :param street:街道
-        :param address:地址
-        :return 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message ="无效活动,无法创建订单"
-            return invoke_result_data
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
-        user_info_model = UserInfoModel(db_transaction=db_transaction, context=self)
-        prize_roster_model = PrizeRosterModel(db_transaction=db_transaction, context=self)
-        prize_order_model = PrizeOrderModel(db_transaction=db_transaction, context=self)
-        prize_ids_list = []
-        if prize_ids:
-            prize_ids_list = prize_ids.split(',')
-            for prize_id in prize_ids_list:
-                try:
-                    prize_id = int(prize_id)    
-                except Exception as ex:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message ="存在无法识别的奖品标识"
-                    return invoke_result_data
-                    
-        #获取用户信息
-        user_info_dict = user_info_model.get_dict_by_id("act_id=%s and user_id=%s", params=[act_id, user_id])
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户不存在"
-            return invoke_result_data
-        if user_info_dict["login_token"] != login_token:  
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "已在另一台设备登录,无法操作"
-            return invoke_result_data
-        if int(user_info_dict["user_state"]) == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "user_exception"
-            invoke_result_data.error_message = "账号异常,请联系客服处理"
-            return invoke_result_data
-        
-        acquire_lock_name = f"create_prize_order_queue_{act_id}_{user_id}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "请求超时,请稍后再试"
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            return invoke_result_data
-        #用户奖品列表
-        if len(prize_ids_list)>0:
-            prize_roster_list = prize_roster_model.get_list("act_id=%s and id in (" + prize_ids + ") and prize_status=0",params=[act_id])
-            if len(prize_roster_list) == 0:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,所选下单奖品不存在"
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-        else:
-            prize_roster_list = prize_roster_model.get_list("act_id=%s and prize_status=0")
-       
-        prize_order_model = PrizeOrderModel(context=self.context)
-        now_date = SevenHelper.get_now_datetime()
-        prize_order = PrizeOrder()
-        prize_order.app_id = app_id
-        prize_order.user_id = user_id
-        prize_order.user_nick = user_info_dict["user_nick"]
-        prize_order.open_id = user_info_dict["open_id"]
-        prize_order.act_id = act_id
-        prize_order.real_name = real_name
-        prize_order.telephone = telephone
-        prize_order.province = province
-        prize_order.city = city
-        prize_order.county = county
-        prize_order.street = street
-        prize_order.address = address
-        prize_order.order_status = 0
-        prize_order.create_date = now_date
-        prize_order.modify_date = now_date
-        prize_order.order_no = SevenHelper.create_order_id()
-
-        for prize_roster in prize_roster_list:
-            prize_roster.order_no = prize_order.order_no
-            prize_roster.prize_status = 1
-        try:
-            db_transaction.begin_transaction()
-            prize_order_model.add_entity(prize_order)
-            prize_roster_model.update_list(prize_roster_list, "order_no,prize_status")
-            result = db_transaction.commit_transaction()
-            if result == False:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,下单失败"
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-                return invoke_result_data
-        except Exception as ex:
-            db_transaction.rollback_transaction()
-            self.context.logging_link_error("create_prize_order:" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "对不起,下单失败"
-            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-            return invoke_result_data
-
-        SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-        self._delete_prize_order_dependency_key(act_id)
-        invoke_result_data.data = prize_order.__dict__
-        return invoke_result_data
-
-    def _get_pay_order_no_list(self,app_id,user_id):
-        """
-        :description: 获取已获取奖励的订单子编号列表
-        :param app_id:应用标识
-        :param user_id:用户标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        redis_init = SevenHelper.redis_init()
-        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
-        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
-        pay_order_list = []
-        is_add = False
-        if not pay_order_no_list or len(pay_order_no_list)<=0:
-            tao_pay_order_model = TaoPayOrderModel(context=self.context)
-            pay_order_list = tao_pay_order_model.get_dict_list("app_id=%s and user_id=%s",field="sub_pay_order_no", params=[app_id,user_id])
-            is_add = True
-            
-        if len(pay_order_list) >0:
-            for item in pay_order_list:
-                pay_order_no_list.append(item["sub_pay_order_no"])
-                if is_add == True:
-                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
-                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-        return pay_order_no_list,redis_init,pay_order_cache_key
-
-    def sync_tao_pay_order(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,asset_type=3,goods_id="",sku_id="",ascription_type=1,app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5):
-        """
-        :description: 同步淘宝支付订单给用户加资产
-        :param app_id:应用标识
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param user_id:用户标识
-        :param login_token:访问令牌
-        :param handler_name:接口名称
-        :param request_code:请求代码
-        :param asset_type:资产类型(1-次数2-积分3-价格档位)
-        :param goods_id:商品ID（资产类型为3-价格档位 无需填写）
-        :param sku_id:sku_id (资产类型为3-价格档位 无需填写)
-        :param ascription_type:归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :param check_user_nick:是否校验昵称为空
-        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
-        :return 
-        :last_editors: HuangJianYi
-        """
-        acquire_lock_name = f"sync_tao_pay_order:{act_id}_{module_id}_{user_id}"
-        identifier = ""
-        try:
-            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,True,check_user_nick,continue_request_expire,acquire_lock_name)
-            if invoke_result_data.success == True:
-                act_info_dict = invoke_result_data.data["act_info_dict"]
-                act_module_dict = invoke_result_data.data["act_module_dict"]
-                user_info_dict = invoke_result_data.data["user_info_dict"]
-                identifier = invoke_result_data.data["identifier"]
-                
-                # 获取订单
-                app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id)
-                access_token = app_info_dict["access_token"] if app_info_dict else ""
-                top_base_model = TopBaseModel(context=self.context)
-                order_data = []
-                if act_info_dict['start_date'] != "":
-                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret, act_info_dict['start_date'],is_log=is_log)
-                    if invoke_result_data.success == True:
-                        order_data = invoke_result_data.data
-                else:
-                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret,is_log=is_log)
-                    if invoke_result_data.success == True:
-                        order_data = invoke_result_data.data
-                if len(order_data)>0: 
-                    pay_order_no_list,redis_init,pay_order_cache_key = self._get_pay_order_no_list(app_id,user_id)
-                    
-                    goods_ids_list = []
-                    #满足奖励条件的订单
-                    reward_order_list = []
-                    #所有相关商品订单
-                    all_order_list = []
-                    if asset_type == 3:
-                        price_base_model = PriceBaseModel(context=self.context)
-                        price_gear_dict_list = price_base_model.get_price_gear_list(app_id,act_id,100,0).data
-                        for price_gear_dict in price_gear_dict_list:
-                            goods_ids_list.append(price_gear_dict["goods_id"])
-                    else:
-                        goods_ids_list.append(str(goods_id))
-                        
-                    for item in order_data:
-                        for order in item["orders"]["order"]:
-                            if str(order["num_iid"]) in goods_ids_list:
-                                if order["status"] in self.rewards_status():
-                                    order["pay_time"] = item["pay_time"]
-                                    order["tid"] = item["tid"]
-                                    reward_order_list.append(order)
-                                if "pay_time" in item:
-                                    order["tid"] = item["tid"]
-                                    order["pay_time"] = item["pay_time"]
-                                    all_order_list.append(order)
-                                    
-                    pay_price = 0
-                    pay_num = 0
-                    buy_num = 0
-                    tao_pay_order_list = []
-                    for order in reward_order_list:
-                        try:
-                            #判断是否已经加过奖励
-                            if order["oid"] not in pay_order_no_list:
-                                asset_object_id = ""
-                                payment = round(decimal.Decimal(order["payment"] if order["payment"] else decimal.Decimal(order["price"]) * int(order["num"])), 2)
-                                if asset_type == 3:
-                                    now_price_gear_dict = None
-                                    for price_gear_dict in price_gear_dict_list:
-                                        if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(order["pay_time"])) and price_gear_dict["goods_id"] == str(order["num_iid"]):
-                                            #关联类型：1商品skuid关联2商品id关联
-                                            if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(order["sku_id"]):
-                                                continue
-                                            now_price_gear_dict = price_gear_dict
-                                    if not now_price_gear_dict:
-                                        continue
-                                    asset_object_id = now_price_gear_dict["id"]
-                                else:
-                                    if str(goods_id) != str(order["num_iid"]):
-                                        continue
-                                    if sku_id and str(sku_id) != str(order["sku_id"]):
-                                        continue
-                                        
-                                tao_pay_order = TaoPayOrder()
-                                tao_pay_order.app_id = app_id
-                                tao_pay_order.act_id = act_id
-                                tao_pay_order.ascription_type = ascription_type
-                                tao_pay_order.user_id = user_id
-                                tao_pay_order.open_id = user_info_dict["open_id"]
-                                tao_pay_order.user_nick = user_info_dict["user_nick"]
-                                tao_pay_order.main_pay_order_no = order['tid']
-                                tao_pay_order.sub_pay_order_no = order['oid']
-                                tao_pay_order.goods_code = order['num_iid']
-                                tao_pay_order.goods_name = order['title']
-                                if "sku_id" in order.keys():
-                                    tao_pay_order.sku_id = order['sku_id']
-                                    sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token,app_key, app_secret,is_log)
-                                    tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
-                                tao_pay_order.buy_num = order['num']
-                                tao_pay_order.pay_price = order['payment']
-                                tao_pay_order.order_status = order['status']
-                                tao_pay_order.create_date = SevenHelper.get_now_datetime()
-                                tao_pay_order.asset_type = asset_type
-                                tao_pay_order.asset_object_id = asset_object_id
-                                tao_pay_order.surplus_count = order['num']
-                                tao_pay_order.pay_date = order['pay_time'] 
-                                tao_pay_order_list.append(tao_pay_order)
-                                
-                                pay_price = decimal.Decimal(pay_price) + payment
-                                pay_num = pay_num + 1
-                                buy_num = buy_num + order['num']          
-                        except Exception as ex:
-                            self.context.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
-                            continue
-                    if len(tao_pay_order_list) > 0:
-                        result = TaoPayOrderModel(context=self.context).add_list(tao_pay_order_list)
-                        if result == True and buy_num > 0: 
-                            asset_base_model = AssetBaseModel(context=self.context)
-                            invoke_result_data.data = {}
-                            invoke_result_data.data["asset_list"] = []
-                            for item in tao_pay_order_list:       
-                                only_id = str(item.sub_pay_order_no)
-                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,item.buy_num,item.asset_object_id,1,"","","购买",only_id,handler_name,request_code,info_json={})
-                                if asset_invoke_result_data.success == False:
-                                    invoke_result_data.success = False
-                                    invoke_result_data.error_code = "error"
-                                    invoke_result_data.error_message = "变更资产失败"
-                                else:
-                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
-                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
-                                    data = {}
-                                    data["asset_type"] = asset_type
-                                    data["asset_object_id"] = item.asset_object_id
-                                    data["buy_num"] = item.buy_num
-                                    invoke_result_data.data["asset_list"].append(data)
-                            invoke_result_data.data["buy_num"] = buy_num
-                            invoke_result_data.data["pay_price"] = pay_price
-                            invoke_result_data.data["pay_num"] = pay_num
-                        else:
-                            invoke_result_data.success = False
-                            invoke_result_data.error_code = "error"
-                            invoke_result_data.error_message = "没有匹配订单"
-                    else:
-                        invoke_result_data.success = False
-                        invoke_result_data.error_code = "error"
-                        invoke_result_data.error_message = "没有匹配订单"
-                    if len(all_order_list) >0:
-                        user_base_model = UserBaseModel(context=self.context)
-                        black_status = user_base_model.check_pull_black(user_info_dict,act_info_dict["is_black"],act_info_dict["refund_count"],all_order_list)
-                        if black_status == True:
-                            invoke_result_data.data = {} if not invoke_result_data.data else invoke_result_data.data
-                            invoke_result_data.data["user_state"] = 1
-                else:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "没有订单"  
-        except Exception as ex:
-            self.context.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"    
-        finally:
-            self.business_process_executed(act_id,module_id,user_id,handler_name,acquire_lock_name,identifier)
-
-        return invoke_result_data
-        
-    def get_prize_roster_list(self,app_id,act_id,module_id,user_id,open_id="",user_nick="",order_no="",goods_type=-1,prize_type=-1,logistics_status=-1,prize_status=-1,pay_status=-1,page_size=20,page_index=0,create_date_start="",create_date_end="",order_by="create_date desc",field="*",condition="",params=[],is_cache=True):
-        """
-        :description: 用户中奖记录列表
-        :description: 如果有进行数据缓存，创建中奖记录时需清掉依赖建
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param module_id：活动模块标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：用户昵称
-        :param order_no：订单号
-        :param goods_type：物品类型（1虚拟2实物）
-        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
-        :param logistics_status：物流状态（0未发货1已发货2不予发货）
-        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
-        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
-        :param page_size：页大小
-        :param page_index：页索引
-        :param create_date_start：开始时间
-        :param create_date_end：结束时间
-        :param order_by：排序
-        :param field：查询字段
-        :param condition：条件
-        :param params：参数化数组
-        :param is_cache：是否缓存
-        :return: PageInfo
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s AND act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        page_info = PageInfo(page_index, page_size, 0, [])
-        
-        if not app_id or not act_id:
-            return page_info
-        if module_id:
-            where += " AND module_id=%s"
-            params_list.append(module_id)
-        if user_id:
-            where += " AND user_id=%s"
-            params_list.append(user_id)
-        if open_id:
-            where += " AND open_id=%s"
-            params_list.append(open_id)
-        if user_nick:
-            where += " AND user_nick=%s"
-            params_list.append(user_nick)
-        if order_no:
-            where += " AND order_no=%s"
-            params_list.append(order_no)
-        if goods_type !=-1:
-            where += " AND goods_type=%s"
-            params_list.append(goods_type)
-        if prize_type !=-1:
-            where += " AND prize_type=%s"
-            params_list.append(prize_type)
-        if logistics_status !=-1:
-            where += " AND logistics_status=%s"
-            params_list.append(logistics_status)
-        if prize_status !=-1:
-            where += " AND prize_status=%s"
-            params_list.append(prize_status)
-        if pay_status !=-1:
-            where += " AND pay_status=%s"
-            params_list.append(pay_status)
-        if create_date_start:
-            where += " AND create_date>=%s"
-            params_list.append(create_date_start)
-        if create_date_end:
-            where += " AND create_date<=%s"
-            params_list.append(create_date_end)
-        
-        prize_roster_model = PrizeRosterModel(context=self.context)
-        if is_cache:
-            dependency_key = f"prize_roster_list:actid_{act_id}"
-            if user_id:
-                    dependency_key += f"_userid_{user_id}"
-            page_list, total = prize_roster_model.get_cache_dict_page_list(field, page_index, page_size, where, "", order_by, params_list,dependency_key)
-        else:
-            page_list, total = prize_roster_model.get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list)
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def get_horseracelamp_list(self,act_id,module_id,page_size=30):
-        """
-        :description: 获取跑马灯奖品列表
-        :param act_id:活动标识
-        :param module_id:活动模块标识
-        :param page_size：页大小
-        :return list
-        :last_editors: HuangJianYi
-        """
-        condition = "act_id=%s"
-        params = [act_id]
-        if module_id:
-            condition+= " and module_id=%s"
-            params.append(module_id)
-        act_prize_list_dict = ActPrizeModel(context=self.context).get_cache_list("act_id=%s and is_prize_notice=0 and is_del=0", params=[act_id],cache_expire=60)
-        if act_prize_list_dict:
-            prize_id_list = [str(i["id"]) for i in act_prize_list_dict]
-            if len(prize_id_list) > 0:
-                prize_ids = ",".join(prize_id_list)
-                condition += " and prize_id not in (" + prize_ids + ")"
-        condition += f" and create_date>'{TimeHelper.add_hours_by_format_time(hour=-1)}'"
-        prize_roster_model = PrizeRosterModel(context=self.context)
-        prize_roster_list = prize_roster_model.get_cache_dict_list(condition, "", "create_date desc", str(page_size), "user_nick,prize_name,tag_id,module_name", params,cache_expire=60)
-        total = int(len(prize_roster_list))
-        if total == 0:
-            prize_roster_list = []
-        else:
-            for i in range(len(prize_roster_list)):
-                if prize_roster_list[i]["user_nick"]:
-                    length = len(prize_roster_list[i]["user_nick"])
-                    if length > 2:
-                        user_nick = prize_roster_list[i]["user_nick"][0:length - 2] + "**"
-                    else:
-                        user_nick = prize_roster_list[i]["user_nick"][0:1] + "*"
-                    prize_roster_list[i]["user_nick"] = user_nick
-        if total < page_size:
-            module_condition = "act_id=%s and is_fictitious=1"
-            module_params = [act_id]
-            if module_id > 0:
-                module_condition += " and id=%s"
-                module_params = [act_id, module_id]
-            act_module_list = ActModuleModel(context=self.context).get_cache_list(module_condition, params=module_params,cache_expire=60)
-            if len(act_module_list) > 0:
-                module_id_list = [str(i.id) for i in act_module_list]
-                module_ids = ",".join(module_id_list)
-                add_num = page_size - total
-                act_prize_model = ActPrizeModel(context=self.context)
-                prize_condition = "act_id=%s and is_prize_notice=1"
-                prize_params = [act_id]
-                if module_id > 0:
-                    prize_condition += " and module_id=%s"
-                    prize_params.append(module_id)
-                else:
-                    prize_condition += " and module_id in (" + module_ids + ")"
-                false_act_prize_list = act_prize_model.get_cache_list(prize_condition, order_by="probability desc,chance desc", limit="30", params=prize_params,cache_expire=60)
-                if len(false_act_prize_list) > 0 and add_num > 0:
-                    now_datetime = TimeHelper.add_hours_by_format_time(hour=-random.randint(0, 1000))
-                    user_info_list_dict = UserInfoModel(context=self.context).get_dict_list("act_id<%s and create_date>%s", params=[act_id,now_datetime], limit=str(add_num))
-
-                    for i in range(len(user_info_list_dict)):
-                        false_act_prize = false_act_prize_list[random.randint(0, len(false_act_prize_list))]
-                        if len(false_act_prize) <= 0:
-                            continue
-                        prize_roster = {}
-                        if user_info_list_dict[i]["user_nick"]:
-                            length = len(user_info_list_dict[i]["user_nick"])
-                            if length > 2:
-                                user_nick = user_info_list_dict[i]["user_nick"][0:length - 2] + "**"
-                            else:
-                                user_nick = user_info_list_dict[i]["user_nick"][0:1] + "*"
-                        prize_roster["user_nick"] = user_nick
-                        prize_roster["prize_name"] = false_act_prize.prize_name
-                        prize_roster["tag_id"] = false_act_prize.tag_id
-                        act_module_filter = [act_module for act_module in act_module_list if false_act_prize.module_id == act_module.id]
-                        prize_roster["module_name"] = act_module_filter[0].module_name if len(act_module_filter) > 0 else ""
-                        prize_roster_list.append(prize_roster)
-        
-        return prize_roster_list
-        
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 09:24:43
+@LastEditTime: 2023-06-25 17:20:45
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.libs.customize.wechat_helper import WeChatPayRequest
+from seven_cloudapp_frame.models.user_base_model import UserBaseModel
+from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.models.app_base_model import *
+from seven_cloudapp_frame.models.top_base_model import *
+from seven_cloudapp_frame.models.price_base_model import *
+from seven_cloudapp_frame.models.asset_base_model import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_order_model import *
+from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_pay_order_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
+from seven_cloudapp_frame.models.db_models.pay.pay_order_model import *
+from seven_cloudapp_frame.models.db_models.refund.refund_order_model import *
+
+
+class OrderBaseModel(FrameBaseModel):
+    """
+    :description: 订单和中奖记录相关业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+        super(OrderBaseModel,self).__init__(context)
+
+    def _delete_prize_order_dependency_key(self, act_id, user_id, delay_delete_time=0.1):
+        """
+        :description: 删除订单依赖建
+        :param act_id: 活动标识
+        :param user_id: 用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PrizeOrderModel().delete_dependency_key(DependencyKey.prize_order_list(act_id,user_id), delay_delete_time)
+        
+    def _delete_prize_roster_dependency_key(self, act_id, user_id, delay_delete_time=0.1, app_id=''):
+        """
+        :description: 删除中奖记录依赖建
+        :param act_id: 活动标识
+        :param user_id: 用户标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :param app_id: 应用标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PrizeRosterModel().delete_dependency_key(DependencyKey.prize_roster_list(act_id, user_id, app_id), delay_delete_time)
+
+    def get_prize_order_list(self, app_id, act_id, user_id, open_id, nick_name, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size=20, page_index=0, order_by="create_date desc", field="*", is_search_roster=False, is_cache=True, condition="", params=[], prize_roster_sub_table=None, page_count_mode="total"):
+        """
+        :description: 用户奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param order_by：排序
+        :param field：查询字段
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param is_cache：是否缓存
+        :param condition：条件
+        :param params：参数化数组
+        :param prize_roster_sub_table：奖品记录分表名称
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return:
+        :last_editors: HuangJianYi
+        """
+        page_list = []
+
+        where = "app_id=%s"
+        params_list = [app_id]
+        if act_id >= 0:
+            where += " AND act_id=%s"
+            params_list.append(act_id)
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        if user_id:
+            where += " AND user_id=%s"
+            params_list.append(user_id)
+        if open_id:
+            where += " AND open_id=%s"
+            params_list.append(open_id)
+        if order_no:
+            where += " AND order_no=%s"
+            params_list.append(order_no)
+        if nick_name:
+            where += " AND user_nick=%s"
+            params_list.append(nick_name)
+        if real_name:
+            where += " AND real_name=%s"
+            params_list.append(real_name)
+        if telephone:
+            where += " AND telephone=%s"
+            params_list.append(telephone)
+        if address:
+            address = f"{address}%"
+            where += " AND address like %s"
+            params_list.append(address)
+        if order_status >=-2:
+            where += " AND order_status=%s"
+            params_list.append(order_status)
+        if create_date_start:
+            where += " AND create_date>=%s"
+            params_list.append(create_date_start)
+        if create_date_end:
+            where += " AND create_date<=%s"
+            params_list.append(create_date_end)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        if is_cache:
+            page_list = prize_order_model.get_cache_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, dependency_key=DependencyKey.prize_order_list(act_id,user_id), page_count_mode=page_count_mode)
+        else:
+            page_list = prize_order_model.get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list, page_count_mode)
+        result = None
+        if page_count_mode in ['total','next']:
+            result = page_list[1]
+            page_list = page_list[0]
+        if is_search_roster == True:
+            if not prize_roster_sub_table:
+                prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+            prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
+            if page_list and len(page_list)>0:
+                order_no_list = [str(i['order_no']) for i in page_list]
+                prize_roster_list_dict = prize_roster_model.get_dict_list(SevenHelper.get_condition_by_str_list("order_no",order_no_list))
+                for i in range(len(page_list)):
+                    roster_list = [prize_roster for prize_roster in prize_roster_list_dict if page_list[i]["order_no"] == prize_roster["order_no"]]
+                    page_list[i]["roster_list"] = roster_list
+        if page_count_mode in ['total','next']:
+            return page_list, result
+        return page_list
+
+    def update_prize_order_status(self,app_id,act_id,prize_order_id,order_status,express_company="",express_no="",prize_roster_sub_table=None):
+        """
+        :description: 更新用户奖品订单状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param order_status：订单状态
+        :param express_company：快递公司
+        :param express_no：快递单号
+        :param prize_roster_sub_table：奖品记录分表名称
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        now_datetime = SevenHelper.get_now_datetime()
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
+        if not prize_roster_sub_table:
+            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, db_transaction=db_transaction, context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        try:
+            db_transaction.begin_transaction()
+            if order_status == 1:
+                if not express_company and not express_no:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message ="快递公司或快递单号不能为空"
+                    return invoke_result_data
+                update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s,modify_date=%s"
+                params = [express_company, express_no, now_datetime, now_datetime, prize_order_id]
+                prize_order_model.update_table(update_sql, "id=%s", params)
+                prize_roster_model.update_table("logistics_status=1", "order_no=%s", [prize_order.order_no])
+            elif order_status == 2:
+                update_sql = "order_status=2,modify_date=%s"
+                params = [now_datetime, prize_order_id]
+                prize_order_model.update_table(update_sql, "id=%s", params)
+                prize_roster_model.update_table("logistics_status=2", "order_no=%s", [prize_order.order_no])
+            else:
+                prize_order_model.update_table("order_status=%s,modify_date=%s", "id=%s", [order_status, now_datetime, prize_order_id])
+                if order_status == 0:
+                    prize_roster_model.update_table("logistics_status=0", "order_no=%s", [prize_order.order_no])
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                raise Exception("执行事务失败",message)
+            prize_order_model.delete_dependency_key(DependencyKey.prize_order_list(prize_order.act_id,prize_order.user_id))
+
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error(traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error(traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="操作失败"
+            return invoke_result_data
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+
+    def update_prize_order_seller_remark(self,app_id,act_id,prize_order_id,seller_remark):
+        """
+        :description: 更新用户奖品订单卖家备注
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param seller_remark：卖家备注
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        now_datetime = SevenHelper.get_now_datetime()
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        prize_order_model.update_table("seller_remark=%s,modify_date=%s", "id=%s", [seller_remark, now_datetime, prize_order_id])
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+    
+    def update_prize_order_receive_address(self, app_id, act_id, prize_order_id, province=None, city=None, county=None, street=None, address=None, real_name=None, telephone=None):
+        """
+        :description: 更新用户奖品订单收货地址
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :param real_name:用户名
+        :param telephone:电话
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+
+        now_datetime = SevenHelper.get_now_datetime()
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        invoke_result_data = InvokeResultData()
+
+        prize_order = prize_order_model.get_entity_by_id(prize_order_id)
+        if not prize_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-1"
+            return invoke_result_data
+        if prize_order.app_id != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-2"
+            return invoke_result_data
+        if prize_order.act_id != act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品订单信息不存在-3"
+            return invoke_result_data
+        if province != None:
+            prize_order.province = province
+        if city != None:
+            prize_order.city = city
+        if county != None:
+            prize_order.county = county
+        if street != None:
+            prize_order.street = street
+        if address != None:
+            prize_order.address = address
+        if real_name != None:
+            prize_order.real_name = real_name
+        if telephone != None:
+            prize_order.telephone = telephone
+        prize_order_model.update_table("province=%s,city=%s,county=%s,street=%s,address=%s,real_name=%s,telephone=%s,modify_date=%s", "id=%s", [prize_order.province, prize_order.city, prize_order.county, prize_order.street, prize_order.address, prize_order.real_name, prize_order.telephone, now_datetime, prize_order_id])
+        return invoke_result_data
+
+    def import_prize_order(self, app_id, act_id, content_type, content, ref_head_name='小程序订单号', prize_roster_sub_table=None):
+        """
+        :description: 
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
+        :param content：字符串内容
+        :param ref_head_name：关联表头名称
+        :param prize_roster_sub_table：奖品记录分表名称
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),context=self.context)
+        if not prize_roster_sub_table:
+            prize_roster_sub_table = self.get_business_sub_table("prize_roster_tb",{"app_id":app_id})
+        prize_roster_model = PrizeRosterModel(sub_table=prize_roster_sub_table, context=self.context)
+        data = []
+        total_num = 0
+        if content_type == 1:
+            data = base64.decodebytes(str(content).encode())
+            if not os.path.exists("temp"):
+                os.makedirs("temp")
+            path = "temp/" + UUIDHelper.get_uuid() + ".xlsx"
+            with open(path, 'ba') as f:
+                buf = bytearray(data)
+                f.write(buf)
+            f.close()
+            order_no_index = -1
+            express_no_index = -1
+            express_company_index = -1
+
+            data = ExcelHelper.input(path)
+            data_total = len(data)
+            # 表格头部
+            if data_total > 0:
+                title_list = data[0]
+                if ref_head_name in title_list:
+                    order_no_index = title_list.index(ref_head_name)
+                if "物流单号" in title_list:
+                    express_no_index = title_list.index("物流单号")
+                if "物流公司" in title_list:
+                    express_company_index = title_list.index("物流公司")
+
+            if order_no_index == -1 or express_no_index == -1 or express_company_index == -1:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="缺少必要字段，无法导入订单"
+                return invoke_result_data
+            # 数据导入
+            for i in range(1, data_total):
+                row = data[i]
+                order_no = str(row[order_no_index]).strip()
+                express_no = str(row[express_no_index]).strip()
+                express_company = str(row[express_company_index]).strip()
+                if order_no and express_no and express_company:
+                    now_datetime = SevenHelper.get_now_datetime()
+                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
+                    params = [express_company, express_no, now_datetime, order_no]
+                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
+                    if result == True:
+                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
+                        total_num += 1
+            os.remove(path)
+        else:
+            data = SevenHelper.json_loads(content)
+            for row in data:
+                order_no = str(row[ref_head_name]).strip()
+                express_no = str(row['物流单号']).strip()
+                express_company = str(row['物流公司']).strip()
+                if order_no and express_no and express_company:
+                    now_datetime = SevenHelper.get_now_datetime()
+                    update_sql = "order_status=1,express_company=%s,express_no=%s,deliver_date=%s"
+                    params = [express_company, express_no, now_datetime, order_no]
+                    result = prize_order_model.update_table(update_sql, "order_no=%s", params)
+                    if result == True:
+                        prize_roster_model.update_table("logistics_status=1", "order_no=%s", [order_no])
+                        total_num += 1
+                else:
+                    continue
+        invoke_result_data.data = {"total_num": total_num}
+        return invoke_result_data
+
+    def select_prize_order(self,app_id,act_id,user_id,login_token,prize_ids,real_name,telephone,province,city,county,street,address):
+        """
+        :description: 选择奖品进行下单
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param login_token:用户访问令牌
+        :param prize_ids:用户奖品id串，逗号分隔（为空则将所有未下单的奖品进行下单）
+        :param real_name:用户名
+        :param telephone:电话
+        :param province:省
+        :param city:市
+        :param county:区县
+        :param street:街道
+        :param address:地址
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+
+        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"),context=self.context)
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}), db_transaction=db_transaction, context=self.context)
+        prize_order_model = PrizeOrderModel(sub_table=self.get_business_sub_table("prize_order_tb",{"app_id":app_id}),db_transaction=db_transaction, context=self.context)
+        prize_ids_list = []
+        if prize_ids:
+            prize_ids_list = prize_ids.split(',')
+            for prize_id in prize_ids_list:
+                try:
+                    prize_id = int(prize_id)
+                except Exception as ex:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message ="存在无法识别的奖品标识"
+                    return invoke_result_data
+
+        #获取用户信息
+        if act_id > 0 :
+            user_info_model = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":app_id}), context=self.context)
+            user_info_dict = user_info_model.get_dict("act_id=%s and user_id=%s", limit="1", params=[act_id, user_id])
+            if not user_info_dict:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "用户不存在"
+                return invoke_result_data
+            if user_info_dict["login_token"] != login_token:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "已在另一台设备登录,无法操作"
+                return invoke_result_data
+            if int(user_info_dict["user_state"]) == 1:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "user_exception"
+                invoke_result_data.error_message = "账号异常,请联系客服处理"
+                return invoke_result_data
+        
+        acquire_lock_name = f"create_prize_order_queue_{act_id}_{user_id}" if act_id > 0 else f"create_prize_order_queue_{app_id}_0_{user_id}"
+        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
+        if acquire_lock_status == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "acquire_lock"
+            invoke_result_data.error_message = "请求超时,请稍后再试"
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            return invoke_result_data
+        #用户奖品列表
+        if len(prize_ids_list)>0:
+            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0 and id in (" + prize_ids + ")",params=[app_id, act_id, user_id])
+            if len(prize_roster_list) == 0:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,所选下单奖品不存在"
+                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+                return invoke_result_data
+        else:
+            prize_roster_list = prize_roster_model.get_list("app_id=%s and act_id=%s and user_id=%s and prize_status=0",params=[app_id, act_id, user_id])
+
+        now_date = SevenHelper.get_now_datetime()
+        prize_order = PrizeOrder()
+        prize_order.app_id = app_id
+        prize_order.user_id = user_id
+        prize_order.user_nick = user_info_dict["user_nick"]
+        prize_order.open_id = user_info_dict["open_id"]
+        prize_order.act_id = act_id
+        prize_order.real_name = real_name
+        prize_order.telephone = telephone
+        prize_order.province = province
+        prize_order.city = city
+        prize_order.county = county
+        prize_order.street = street
+        prize_order.address = address
+        prize_order.order_status = 0
+        prize_order.create_date = now_date
+        prize_order.modify_date = now_date
+        prize_order.order_no = SevenHelper.create_order_id()
+
+        for prize_roster in prize_roster_list:
+            prize_roster.order_no = prize_order.order_no
+            prize_roster.prize_status = 1
+        try:
+            db_transaction.begin_transaction()
+            prize_order_model.add_entity(prize_order)
+            prize_roster_model.update_list(prize_roster_list, "order_no,prize_status")
+            result,message = db_transaction.commit_transaction(True)
+            if result == False:
+                raise Exception("执行事务失败",message)
+            prize_roster_model.delete_dependency_key([DependencyKey.prize_roster_list(act_id, user_id, app_id),DependencyKey.prize_order_list(act_id,user_id)])
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("create_prize_order:" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("create_prize_order:" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "对不起,下单失败"
+            SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+            return invoke_result_data
+
+        SevenHelper.redis_release_lock(acquire_lock_name, identifier)
+        self._delete_prize_order_dependency_key(act_id,user_id)
+        self._delete_prize_roster_dependency_key(act_id=act_id, user_id=user_id, app_id=app_id)
+        invoke_result_data.data = prize_order.__dict__
+        return invoke_result_data
+
+    def get_tao_pay_order_list(self,app_id,act_id,user_id,open_id,nick_name,pay_date_start,pay_date_end,page_size=20,page_index=0,field="*",order_by="pay_date desc",condition="",params=[]):
+        """
+        :description: 淘宝用户购买订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户唯一标识
+        :param open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :param field：查询字段
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :return: PageInfo
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s and act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " AND " + condition
+            params_list.extend(params)
+        page_info = PageInfo(page_index, page_size, 0, [])
+
+        if not act_id:
+            return page_info
+        if user_id:
+            where += " AND user_id=%s"
+            params_list.append(user_id)
+        if open_id:
+            where += " AND open_id=%s"
+            params_list.append(open_id)
+        if nick_name:
+            where += " AND user_nick=%s"
+            params_list.append(nick_name)
+        if pay_date_start:
+            where += " AND pay_date>=%s"
+            params_list.append(pay_date_start)
+        if pay_date_end:
+            where += " AND pay_date<=%s"
+            params_list.append(pay_date_end)
+        page_list, total = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}), context=self.context).get_dict_page_list(field, page_index, page_size, where, "", order_by, params_list)
+        page_info = PageInfo(page_index, page_size, total, page_list)
+        return page_info
+
+    def _get_tao_pay_order_no_list(self,app_id,user_id):
+        """
+        :description: 获取已获取奖励的订单子编号列表
+        :param app_id:应用标识
+        :param user_id:用户标识
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        redis_init = SevenHelper.redis_init()
+        pay_order_cache_key = f"sub_pay_order_no_list:appid_{app_id}_userid_{user_id}"
+        pay_order_no_list = redis_init.lrange(pay_order_cache_key,0,-1)
+        pay_order_list = []
+        is_add = False
+        if not pay_order_no_list or len(pay_order_no_list)<=0:
+            tao_pay_order_model = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context)
+            pay_order_list = tao_pay_order_model.get_dict_list("app_id=%s and user_id=%s",field="sub_pay_order_no", params=[app_id,user_id])
+            is_add = True
+
+        if len(pay_order_list) >0:
+            for item in pay_order_list:
+                pay_order_no_list.append(item["sub_pay_order_no"])
+                if is_add == True:
+                    redis_init.lpush(pay_order_cache_key,item["sub_pay_order_no"])
+                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+        return pay_order_no_list,redis_init,pay_order_cache_key
+
+    def sync_tao_pay_order(self,app_id,act_id,module_id,user_id,login_token,handler_name,request_code,asset_type=3,goods_id="",sku_id="",ascription_type=1,app_key="",app_secret="",is_log=False,check_user_nick=True,continue_request_expire=5,support_presale_order=False):
+        """
+        :description: 同步淘宝支付订单给用户加资产
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param user_id:用户标识
+        :param login_token:访问令牌
+        :param handler_name:接口名称
+        :param request_code:请求代码
+        :param asset_type:资产类型(1-次数2-积分3-价格档位)
+        :param goods_id:商品ID（资产类型为3-价格档位 无需填写）
+        :param sku_id:sku_id (资产类型为3-价格档位 无需填写)
+        :param ascription_type:归属类型（0-抽奖次数订单1-邮费次数订单2-任务订单）
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录top请求日志
+        :param check_user_nick:是否校验昵称为空
+        :param continue_request_expire:连续请求过期时间，为0不进行校验，单位秒
+        :param support_presale_order:是否支持预售订单
+        :return 
+        :last_editors: HuangJianYi
+        """
+        acquire_lock_name = f"sync_tao_pay_order:{act_id}_{module_id}_{user_id}"
+        identifier = ""
+        try:
+            invoke_result_data = self.business_process_executing(app_id,act_id,module_id,user_id,login_token,handler_name,False,check_user_nick,continue_request_expire,acquire_lock_name)
+            if invoke_result_data.success == True:
+                act_info_dict = invoke_result_data.data["act_info_dict"]
+                act_module_dict = invoke_result_data.data["act_module_dict"]
+                user_info_dict = invoke_result_data.data["user_info_dict"]
+                identifier = invoke_result_data.data["identifier"]
+
+                # 获取订单
+                app_info_dict = AppBaseModel(context=self.context).get_app_info_dict(app_id)
+                access_token = app_info_dict["access_token"] if app_info_dict else ""
+                top_base_model = TopBaseModel(context=self.context)
+                order_data = []
+                if act_info_dict['start_date'] != "":
+                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret, act_info_dict['start_date'],is_log=is_log)
+                    if invoke_result_data.success == True:
+                        order_data = invoke_result_data.data
+                else:
+                    invoke_result_data = top_base_model.get_buy_order_list(user_info_dict["open_id"], access_token,app_key,app_secret,is_log=is_log)
+                    if invoke_result_data.success == True:
+                        order_data = invoke_result_data.data
+                if len(order_data)>0:
+                    pay_order_no_list,redis_init,pay_order_cache_key = self._get_tao_pay_order_no_list(app_id,user_id)
+
+                    goods_ids_list = []
+                    #满足奖励条件的订单
+                    reward_order_list = []
+                    #所有相关商品订单
+                    all_order_list = []
+                    if asset_type == 3:
+                        price_base_model = PriceBaseModel(context=self.context)
+                        price_gear_dict_list = price_base_model.get_price_gear_list(app_id,act_id,100,0,page_count_mode='none')
+                        for price_gear_dict in price_gear_dict_list:
+                            goods_ids_list.append(price_gear_dict["goods_id"])
+                    else:
+                        goods_ids_list.append(str(goods_id))
+
+                    for item in order_data:
+                        for order in item["orders"]["order"]:
+                            if str(order["num_iid"]) in goods_ids_list:
+                                order["step_paid_fee"] = item["step_paid_fee"] if "step_paid_fee" in item.keys() else 0
+                                order["type"] = item["type"]
+                                if "pay_time" in item:
+                                    order["tid"] = item["tid"]
+                                    order["pay_time"] = item["pay_time"]
+                                if support_presale_order == True:
+                                    if order["status"] in self.rewards_status() or (order["type"] == "step" and order["step_trade_status"] != "FRONT_NOPAID_FINAL_NOPAID"):
+                                        reward_order_list.append(order)
+                                else:
+                                    if order["status"] in self.rewards_status():
+                                        reward_order_list.append(order)
+                
+                                all_order_list.append(order)
+
+                    pay_price = 0
+                    pay_num = 0
+                    buy_num = 0
+                    tao_pay_order_list = []
+                    for order in reward_order_list:
+                        try:
+                            #判断是否已经加过奖励
+                            if order["oid"] not in pay_order_no_list:
+                                asset_object_name = ""
+                                asset_object_id = ""
+                                if asset_type == 3:
+                                    now_price_gear_dict = None
+                                    for price_gear_dict in price_gear_dict_list:
+                                        if (price_gear_dict["effective_date"] == '1900-01-01 00:00:00' or TimeHelper.format_time_to_datetime(price_gear_dict["effective_date"]) < TimeHelper.format_time_to_datetime(order["pay_time"])) and price_gear_dict["goods_id"] == str(order["num_iid"]):
+                                            #关联类型：1商品skuid关联2商品id关联
+                                            if price_gear_dict["relation_type"] == 1 and price_gear_dict["sku_id"] != str(order["sku_id"]):
+                                                continue
+                                            now_price_gear_dict = price_gear_dict
+                                    if not now_price_gear_dict:
+                                        continue
+                                    asset_object_id = now_price_gear_dict["id"]
+                                    asset_object_name = now_price_gear_dict["price_gear_name"]
+                                else:
+                                    if str(goods_id) != str(order["num_iid"]):
+                                        continue
+                                    if sku_id and str(sku_id) != str(order["sku_id"]):
+                                        continue
+
+                                tao_pay_order = TaoPayOrder()
+                                tao_pay_order.app_id = app_id
+                                tao_pay_order.act_id = act_id
+                                tao_pay_order.ascription_type = ascription_type
+                                tao_pay_order.user_id = user_id
+                                tao_pay_order.open_id = user_info_dict["open_id"]
+                                tao_pay_order.user_nick = user_info_dict["user_nick"]
+                                tao_pay_order.main_pay_order_no = order['tid']
+                                tao_pay_order.sub_pay_order_no = order['oid']
+                                tao_pay_order.goods_code = order['num_iid']
+                                tao_pay_order.goods_name = order['title']
+                                if "sku_id" in order.keys():
+                                    tao_pay_order.sku_id = order['sku_id']
+                                    sku_invoke_result_data = top_base_model.get_sku_name(int(order['num_iid']), int(order['sku_id']), access_token,app_key, app_secret,is_log)
+                                    tao_pay_order.sku_name = sku_invoke_result_data.data if sku_invoke_result_data.success == True else ""
+                                tao_pay_order.buy_num = order['num']
+                                tao_pay_order.pay_price = order['payment']
+                                tao_pay_order.order_status = order['status']
+                                tao_pay_order.create_date = SevenHelper.get_now_datetime()
+                                tao_pay_order.asset_type = asset_type
+                                tao_pay_order.asset_object_id = asset_object_id
+                                tao_pay_order.asset_object_name = asset_object_name
+                                tao_pay_order.surplus_count = order['num']
+                                tao_pay_order.pay_date = order['pay_time']
+                                tao_pay_order_list.append(tao_pay_order)
+                                if support_presale_order == True:
+                                    payment = decimal.Decimal(order["step_paid_fee"]) if order["type"] == "step" and decimal.Decimal(order["step_paid_fee"]) > 0 else decimal.Decimal(order["payment"])
+                                else:
+                                    payment = decimal.Decimal(order["payment"])
+                                pay_price = decimal.Decimal(pay_price) + payment
+                                pay_num = pay_num + 1
+                                buy_num = buy_num + order['num']
+                        except Exception as ex:
+                            if self.context:
+                                self.context.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
+                            elif self.logging_link_info:
+                                self.logging_link_info(str(order) + "【同步淘宝支付订单】" + traceback.format_exc())
+                            continue
+                    if len(tao_pay_order_list) > 0:
+                        result = TaoPayOrderModel(sub_table=FrameBaseModel(context=self.context).get_business_sub_table("tao_pay_order_tb",{"app_id":app_id}),context=self.context).add_list(tao_pay_order_list)
+                        if result == True and buy_num > 0:
+                            asset_base_model = AssetBaseModel(context=self.context)
+                            invoke_result_data.data = {}
+                            invoke_result_data.data["asset_list"] = []
+                            for item in tao_pay_order_list:
+                                only_id = str(item.sub_pay_order_no)
+                                asset_invoke_result_data = asset_base_model.update_user_asset(app_id,act_id,module_id,user_id,user_info_dict["open_id"],user_info_dict["user_nick"],asset_type,item.buy_num,item.asset_object_id,1,"","","购买",only_id,handler_name,request_code,info_json={})
+                                if asset_invoke_result_data.success == False:
+                                    invoke_result_data.success = False
+                                    invoke_result_data.error_code = "error"
+                                    invoke_result_data.error_message = "变更资产失败"
+                                else:
+                                    redis_init.lpush(pay_order_cache_key,item.sub_pay_order_no)
+                                    redis_init.expire(pay_order_cache_key, 30 * 24 * 3600)
+                                    data = {}
+                                    data["asset_type"] = asset_type
+                                    data["asset_object_id"] = item.asset_object_id
+                                    data["buy_num"] = item.buy_num
+                                    invoke_result_data.data["asset_list"].append(data)
+                            invoke_result_data.data["buy_num"] = buy_num
+                            invoke_result_data.data["pay_price"] = pay_price
+                            invoke_result_data.data["pay_num"] = pay_num
+                        else:
+                            invoke_result_data.success = False
+                            invoke_result_data.error_code = "error"
+                            invoke_result_data.error_message = "没有匹配订单"
+                    else:
+                        invoke_result_data.success = False
+                        invoke_result_data.error_code = "error"
+                        invoke_result_data.error_message = "没有匹配订单"
+                    if len(all_order_list) >0:
+                        user_base_model = UserBaseModel(context=self.context)
+                        black_status = user_base_model.check_pull_black(user_info_dict,act_info_dict["is_black"],act_info_dict["refund_count"],all_order_list)
+                        if black_status == True:
+                            invoke_result_data.data = {} if not invoke_result_data.data else invoke_result_data.data
+                            invoke_result_data.data["user_state"] = 1
+                else:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "没有订单"
+        except Exception as ex:
+            if self.context:
+                self.context.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
+            elif self.logging_link_error:
+                self.logging_link_error("【同步淘宝支付订单】" + traceback.format_exc())
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "exception"
+            invoke_result_data.error_message = "系统繁忙,请稍后再试"
+        finally:
+            self.business_process_executed(act_id,module_id,user_id,handler_name,acquire_lock_name,identifier)
+
+        return invoke_result_data
+
+    def get_prize_roster_list(self,app_id,act_id,module_id,user_id,open_id="",user_nick="",order_no="",goods_type=-1,prize_type=-1,logistics_status=-1,prize_status=-1,pay_status=-1,page_size=20,page_index=0,create_date_start="",create_date_end="",order_by="create_date desc",field="*",condition="",params=[],is_cache=True, page_count_mode="total"):
+        """
+        :description: 用户中奖记录列表
+        :description: 如果有进行数据缓存，创建中奖记录时需清掉依赖建
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param user_nick：用户昵称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :param order_by：排序
+        :param field：查询字段
+        :param condition：条件
+        :param params：参数化数组
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :return:
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s")
+        params_list = [app_id]
+        if act_id >= 0:
+            condition_where.add_condition("act_id=%s")
+            params_list.append(act_id)
+        if module_id:
+            condition_where.add_condition("module_id=%s")
+            params_list.append(module_id)
+        if user_id:
+            condition_where.add_condition("user_id=%s")
+            params_list.append(user_id)
+        if open_id:
+            condition_where.add_condition("open_id=%s")
+            params_list.append(open_id)
+        if user_nick:
+            condition_where.add_condition("user_nick=%s")
+            params_list.append(user_nick)
+        if order_no:
+            condition_where.add_condition("order_no=%s")
+            params_list.append(order_no)
+        if goods_type !=-1:
+            condition_where.add_condition("goods_type=%s")
+            params_list.append(goods_type)
+        if prize_type !=-1:
+            condition_where.add_condition("prize_type=%s")
+            params_list.append(prize_type)
+        if logistics_status !=-1:
+            condition_where.add_condition("logistics_status=%s")
+            params_list.append(logistics_status)
+        if prize_status !=-1:
+            condition_where.add_condition("prize_status=%s")
+            params_list.append(prize_status)
+        if pay_status !=-1:
+            condition_where.add_condition("pay_status=%s")
+            params_list.append(pay_status)
+        if create_date_start:
+            condition_where.add_condition("create_date>=%s")
+            params_list.append(create_date_start)
+        if create_date_end:
+            condition_where.add_condition("create_date<=%s")
+            params_list.append(create_date_end)
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        if is_cache:
+            page_list = prize_roster_model.get_cache_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id), page_count_mode=page_count_mode)
+        else:
+            page_list = prize_roster_model.get_dict_page_list(field, page_index, page_size, condition_where.to_string(), "", order_by, params_list, page_count_mode)
+        return page_list
+
+    def get_horseracelamp_list(self, app_id, act_id, module_id, is_search_module=False, condition="", params=[], page_size=30):
+        """
+        :description: 获取跑马灯奖品列表
+        :param app_id:应用标识
+        :param act_id:活动标识
+        :param module_id:活动模块标识
+        :param is_search_module:是否查询活动模块
+        :param condition：条件
+        :param params：参数数组
+        :param page_size：页大小
+        :return list
+        :last_editors: HuangJianYi
+        """
+        condition_where = ConditionWhere()
+        condition_where.add_condition("app_id=%s")
+        params_list = [app_id]
+        if act_id >= 0:
+            condition_where.add_condition("act_id=%s")
+            params_list.append(act_id)
+        if is_search_module == True and module_id:
+            condition_where.add_condition("module_id=%s")
+            params_list.append(module_id)
+        if condition:
+            condition_where.add_condition(condition)
+            params_list.extend(params)
+        act_prize_list_dict = ActPrizeModel(context=self.context).get_cache_dict_list("act_id=%s and is_prize_notice=1 and is_del=0", params=[act_id],cache_expire=60)
+        if act_prize_list_dict:
+            if len(act_prize_list_dict) > 100:
+                act_prize_list_dict = random.sample(act_prize_list_dict,50)
+
+            prize_id_list = [str(i["id"]) for i in act_prize_list_dict]
+            if len(prize_id_list) > 0:
+                prize_ids = ",".join(prize_id_list)
+                condition_where.add_condition("prize_id in (" + prize_ids + ")")
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        prize_roster_list = prize_roster_model.get_cache_dict_list(condition_where.to_string(), "", "create_date desc", str(page_size), "user_nick,prize_name,tag_id,module_name", params_list, cache_expire=60)
+        total = int(len(prize_roster_list))
+        if total == 0:
+            prize_roster_list = []
+        else:
+            for i in range(len(prize_roster_list)):
+                if prize_roster_list[i]["user_nick"]:
+                    length = len(prize_roster_list[i]["user_nick"])
+                    if length > 2:
+                        user_nick = prize_roster_list[i]["user_nick"][0:length - 2] + "**"
+                    else:
+                        user_nick = prize_roster_list[i]["user_nick"][0:1] + "*"
+                    prize_roster_list[i]["user_nick"] = user_nick
+        act_module_list = []
+        if total < page_size:
+            add_num = page_size - total
+            act_prize_model = ActPrizeModel(context=self.context)
+            prize_condition = "act_id=%s and is_prize_notice=1"
+            prize_params = [act_id]
+
+            if is_search_module == True:
+                module_condition = "act_id=%s and is_fictitious=1"
+                module_params = [act_id]
+                if module_id >0:
+                    module_condition += " and id=%s"
+                    module_params = [act_id, module_id]
+                act_module_list = ActModuleModel(context=self.context).get_cache_list(module_condition, params=module_params,cache_expire=60)
+                if len(act_module_list) > 0:
+                    module_id_list = [str(i.id) for i in act_module_list]
+                    module_ids = ",".join(module_id_list)
+                    prize_condition += " and module_id in (" + module_ids + ")"
+            false_act_prize_list = act_prize_model.get_cache_list(prize_condition, order_by="probability desc,chance desc", limit="30", params=prize_params,cache_expire=60)
+            if len(false_act_prize_list) > 0 and add_num > 0:
+                now_datetime = TimeHelper.add_hours_by_format_time(hour=-random.randint(0, 1000))
+                user_info_list_dict = UserInfoModel(sub_table=self.get_business_sub_table("user_info_tb",{"app_id":false_act_prize_list[0].app_id}),context=self.context).get_dict_list("act_id<%s and create_date>%s", params=[act_id,now_datetime], limit=str(add_num))
+
+                for i in range(len(user_info_list_dict)):
+                    false_act_prize = false_act_prize_list[random.randint(0, len(false_act_prize_list)-1)]
+                    if not false_act_prize:
+                        continue
+                    prize_roster = {}
+                    user_nick = ""
+                    if user_info_list_dict[i]["user_nick"]:
+                        length = len(user_info_list_dict[i]["user_nick"])
+                        if length > 2:
+                            user_nick = user_info_list_dict[i]["user_nick"][0:length - 2] + "**"
+                        else:
+                            user_nick = user_info_list_dict[i]["user_nick"][0:1] + "*"
+                    prize_roster["user_nick"] = user_nick
+                    prize_roster["prize_name"] = false_act_prize.prize_name
+                    prize_roster["tag_id"] = false_act_prize.tag_id
+                    act_module_filter = [act_module for act_module in act_module_list if false_act_prize.module_id == act_module.id]
+                    prize_roster["module_name"] = act_module_filter[0].module_name if len(act_module_filter) > 0 else ""
+                    prize_roster_list.append(prize_roster)
+
+        return prize_roster_list
+
+    def get_coupon_prize(self, app_id, act_id, user_id, user_prize_id, app_key, app_secret, is_log=False):
+        """
+        :description: 领取淘宝优惠券
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_prize_id:用户奖品标识
+        :param app_key:app_key
+        :param app_secret:app_secret
+        :param is_log:是否记录日志
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        app_base_model = AppBaseModel(context=self.context)
+        app_info_dict = app_base_model.get_app_info_dict(app_id)
+        if not app_info_dict:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="小程序不存在"
+            return invoke_result_data
+        access_token = app_info_dict["access_token"]
+        if access_token == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="未授权请联系客服授权"
+            return invoke_result_data
+        prize_roster_model = PrizeRosterModel(sub_table=self.get_business_sub_table("prize_roster_tb",{"app_id":app_id}),context=self.context)
+        prize_roster_dict = prize_roster_model.get_cache_dict_by_id(user_prize_id, dependency_key=DependencyKey.prize_roster_list(act_id,user_id,app_id))
+        if not prize_roster_dict or prize_roster_dict['user_id'] != user_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品不存在"
+            return invoke_result_data
+        tao_coupon_model = TaoCouponModel(context=self.context)
+        tao_coupon_dict = tao_coupon_model.get_dict(where="prize_id=%s", limit="1", params=[prize_roster_dict["prize_id"]])
+        if not tao_coupon_dict or tao_coupon_dict['right_ename'] == "":
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="奖品不是优惠券,无需领取"
+            return invoke_result_data
+        top_base_model = TopBaseModel(context=self.context)
+        top_invoke_result_data = top_base_model.alibaba_benefit_send(tao_coupon_dict['right_ename'], prize_roster_dict["open_id"], access_token, app_key, app_secret, is_log)
+        if top_invoke_result_data.success == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="领取失败"
+            return invoke_result_data
+        resp = top_invoke_result_data.data
+        if resp["alibaba_benefit_send_response"]:
+            if resp["alibaba_benefit_send_response"]["result_success"] == True:
+                prize_roster_model.update_table("prize_status=1", "id=%s", params=[user_prize_id])
+                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
+                result = {}
+                result["prize_name"] = resp["alibaba_benefit_send_response"]["prize_name"]
+                invoke_result_data.data = result
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_INVALID_OR_DELETED":
+                prize_roster_model.update_table("prize_status=10", "id=%s", params=[user_prize_id])
+                prize_roster_model.delete_dependency_key(DependencyKey.prize_roster_list(act_id,user_id,app_id))
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券无效或已删除"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "COUPON_NOT_EXISTS":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券不存在"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_SINGLE_COUPON_COUNT_EXCEED_LIMIT":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：优惠券超过限额"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "USER_PERMISSION_EXCEED_MAX_RIGHT_COUNT_IN_DAY":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：同一张优惠券每天限领取一次"
+                return invoke_result_data
+            if resp["alibaba_benefit_send_response"]["result_code"] == "APPLY_ONE_SELLER_COUNT_EXCEED_LIMIT":
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="领取失败：用户优惠券超出10张限制"
+                return invoke_result_data
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="领取失败"
+            invoke_result_data.data = resp["alibaba_benefit_send_response"]["result_code"]
+            return invoke_result_data
+            
+        else:
+            result = resp["sub_msg"] if resp["sub_msg"] else ""
+            if result == "" and resp["result_msg"]:
+                result = resp["result_msg"]
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = f"领取失败:{result}"
+            return invoke_result_data
+
+    def create_wechat_refund(self, source_type, app_id, act_id, pay_order_no, refund_amount = 0, refund_reason = ""):
+        """
+        :description: 创建微信退款
+        :param source_type：来源类型（1用户申请退款2人工审核退款3自动退款）
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param pay_order_no：支付单号
+        :param refund_reason：退款原因
+        :return 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        pay_order_model = PayOrderModel(context=self)
+        refund_order_model = RefundOrderModel(context=self)
+        #请求太频繁限制
+        if SevenHelper.is_continue_request(f"create_wechat_refund:{app_id}_{pay_order_no}", 1000) == False:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="请求太频繁,请稍后再试"
+            return invoke_result_data
+
+        pay_order = pay_order_model.get_entity("pay_order_no=%s", params=pay_order_no)
+        if not pay_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，找不到支付订单"
+            return invoke_result_data
+
+        refund_order = refund_order_model.get_entity(where="pay_order_no=%s AND refund_status in (1,2)", params=[pay_order_no])
+        if refund_order:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，退款处理中"
+            return invoke_result_data
+        if refund_amount <= 0:
+            refund_amount = pay_order.pay_amount
+        if pay_order.refund_amount + refund_amount > pay_order.pay_amount:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="退款总金额不能超过支付金额"
+            return invoke_result_data
+            
+        refund_status = 0
+        if source_type == 1:
+            refund_reason = refund_reason
+            refund_status = 1
+        elif source_type == 2:
+            refund_reason = "人工审核退款"
+        elif source_type == 3:
+            refund_reason = "自动退款"
+        
+        
+        refund_no = SevenHelper.create_order_id()
+        #创建退款预订单
+        refund_order = RefundOrder()
+        refund_order.app_id = app_id
+        refund_order.act_id = act_id
+        refund_order.user_id = pay_order.user_id
+        refund_order.open_id = pay_order.open_id
+        refund_order.pay_order_no = pay_order_no
+        refund_order.refund_no = refund_no
+        refund_order.out_order_no = pay_order.out_order_no
+        refund_order.refund_amount = refund_amount
+        refund_order.refund_status = refund_status
+        refund_order.refund_reason = refund_reason
+        refund_order.create_date = SevenHelper.get_now_datetime()
+        refund_order.id = refund_order_model.add_entity(refund_order)
+        if refund_order.id <= 0:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message ="对不起，创建退款订单失败"
+            return invoke_result_data
+        
+        if source_type != 1:
+            wechat_pay = share_config.get_value("wechat_pay")
+            #退款异步通知地址
+            notify_url = wechat_pay["notify_url"]
+            result_data = WeChatPayRequest().create_refund(refund_no, pay_order.pay_order_no, notify_url, refund_amount, pay_order.pay_amount)
+            if result_data.success == False:
+                refund_order_model.del_entity("id=%s", params=refund_order.id)
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message ="对不起，创建退款订单异常"
+                return invoke_result_data
+            refund_order_model.update_table("refund_status=2", "id=%s", params=refund_order.id)
+            invoke_result_data.data = refund_no
+
+        return invoke_result_data
+
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/price_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/price_base_model.py`

 * *Files 15% similar despite different names*

```diff
@@ -1,227 +1,228 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-02 14:26:29
-@LastEditTime: 2021-08-26 10:29:43
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.act_base_model import *
-from seven_cloudapp_frame.models.launch_base_model import *
-from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
-
-
-class PriceBaseModel():
-    """
-    :description: 价格档位业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-    
-    def _delete_price_gear_dependency_key(self,act_id):
-        """
-        :description: 删除价格档位依赖建
-        :param act_id: 活动标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        try:
-            redis_init = SevenHelper.redis_init()
-            if act_id:
-                redis_init.delete(f"price_gear_list:actid_{act_id}")
-        except Exception as ex:
-            pass
-        
-    def save_price_gear(self,app_id,act_id,price_gear_id,relation_type,price_gear_name,price_gear_pic,price,goods_id,sku_id,remark=""):
-        """
-        :description: 保存价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param relation_type：关联类型：1商品skuid关联2商品id关联
-        :param price_gear_name：档位名称
-        :param price_gear_pic：档位图片
-        :param price：价格
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :param remark：备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear = None
-        old_price_gear = None
-        price_gear_model = PriceGearModel(context=self.context)
-        if price_gear_id > 0:
-            price_gear = price_gear_model.get_entity_by_id(price_gear_id)
-        is_add = False
-        if not price_gear:
-            is_add = True
-            price_gear = PriceGear()
-        else:
-            old_price_gear = deepcopy(price_gear)
-        try:
-            price = decimal.Decimal(price)
-        except Exception as ex:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "参数price类型错误"
-            return invoke_result_data
-
-        if goods_id != "":
-            price_gear_goodsid = price_gear_model.get_entity("act_id!=%s and goods_id=%s", params=[act_id, goods_id])
-            if price_gear_goodsid:
-                act_info_dict = ActInfoModel(context=self.context).get_dict_by_id(price_gear_goodsid.act_id)
-                act_name = act_info_dict["act_name"] if act_info_dict else ""
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = f"此商品ID已关联活动{act_name},无法使用"
-                return invoke_result_data
-
-        price_gear.app_id = app_id
-        price_gear.act_id = act_id
-        price_gear.relation_type = relation_type
-        price_gear.price = price
-        price_gear.price_gear_name = price_gear_name
-        price_gear.price_gear_pic = price_gear_pic
-        price_gear.goods_id = goods_id
-        price_gear.sku_id = sku_id
-        price_gear.remark = remark
-        price_gear.modify_date = SevenHelper.get_now_datetime()
-
-        if is_add:
-            if sku_id != "":
-                price_gear_goodsid_skuid = price_gear_model.get_total("sku_id=%s", params=[sku_id])
-                if price_gear_goodsid_skuid:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
-                    return invoke_result_data
-            price_gear.effective_date = SevenHelper.get_now_datetime()
-            price_gear.id = price_gear_model.add_entity(price_gear)
-        else:
-            if sku_id != "":
-                price_gear_goodsid_skuid = price_gear_model.get_total("id!=%s and sku_id=%s", params=[price_gear.id, sku_id])
-                if price_gear_goodsid_skuid:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
-                    return invoke_result_data
-            price_gear_model.update_entity(price_gear)
-        
-        launch_goods_id = price_gear.goods_id if price_gear else ''
-        old_goods_id = old_price_gear.goods_id if old_price_gear else ''
-        launch_base_model = LaunchBaseModel(context=self.context)
-        launch_base_model.add_launch_goods(app_id,act_id, launch_goods_id, old_goods_id,"2")
-
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = price_gear
-        result["old"] = old_price_gear
-        invoke_result_data.data = result
-        self._delete_price_gear_dependency_key(act_id)
-        return invoke_result_data
-
-    def get_price_gear_list(self,app_id,act_id,page_size,page_index,order_by="id desc",is_del=0,is_cache=True):
-        """
-        :description: 获取价格档位列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_index：页索引
-        :param page_size：页大小
-        :param order_by：排序
-        :param is_del：是否回收站1是0否
-        :param is_cache：是否缓存
-        :return: list
-        :last_editors: HuangJianYi
-        """
-        condition = "app_id=%s and act_id=%s"
-        if is_del == 1:
-            condition+=" and is_del=1"
-        else:
-            condition+=" and is_del=0"
-
-        params = [app_id,act_id]
-        price_gear_model = PriceGearModel(context=self.context)
-        if is_cache == True:
-            page_list, total = price_gear_model.get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=f"price_gear_list:actid_{act_id}")
-        else:
-            page_list, total = price_gear_model.get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params)
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def update_price_gear_status(self,app_id,act_id,price_gear_id,is_del):
-        """
-        :description: 删除或恢复价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param is_del：1删除0恢复
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear_model = PriceGearModel(context=self.context)
-        price_gear_dict = price_gear_model.get_dict_by_id(price_gear_id)
-        if not price_gear_dict or price_gear_dict["act_id"] != act_id or price_gear_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "价格档位信息不存在"
-            return invoke_result_data
-        goods_id =  price_gear_dict["goods_id"]
-        invoke_result_data.success = price_gear_model.update_table("is_del=%s,goods_id='',sku_id=''", "id=%s", [is_del, price_gear_id])
-        if invoke_result_data.success ==True and is_del == 1:
-            launch_base_model = LaunchBaseModel(context=self.context)
-            launch_base_model.update_launch_goods(act_id, goods_id,"2")
-        self._delete_price_gear_dependency_key(act_id)
-        return invoke_result_data
-    
-    def check_price_gear(self,app_id,act_id,price_gear_id,goods_id,sku_id):
-        """
-        :description: 验证价格档位
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param price_gear_id：价格档位标识
-        :param goods_id：商品ID
-        :param sku_id：sku_id
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        price_gear_model = PriceGearModel(context=self.context)
-        condtion = "app_id=%s and goods_id=%s"
-        params = [app_id, goods_id]
-        if price_gear_id > 0:
-            condtion += " and id!=%s"
-            params.append(price_gear_id)
-        price_gear_dict_list = price_gear_model.get_dict_list(condtion, params=params)
-        is_fail = False
-        bind_act_id = 0
-        if price_gear_dict_list:
-            if not sku_id:
-                is_fail = True
-                bind_act_id = price_gear_dict_list[0]["act_id"]
-            else:
-                for price_gear_dict in price_gear_dict_list:
-                    if price_gear_dict["relation_type"] == 1 or price_gear_dict["sku_id"] == sku_id:
-                        is_fail = True
-                        bind_act_id = int(price_gear_dict["act_id"])
-                        break
-        #验证失败
-        if is_fail == True:
-            if act_id == bind_act_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "对不起,该商品已绑定其他价格档位"
-                return invoke_result_data
-            else:
-                act_info = ActInfoModel(context=self.context).get_cache_entity_by_id(bind_act_id)
-                if act_info:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "对不起,该商品已绑定" + act_info.act_name + "活动"
-                    return invoke_result_data
-        return invoke_result_data
-    
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-02 14:26:29
+@LastEditTime: 2023-01-04 15:59:34
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.act_base_model import *
+from seven_cloudapp_frame.models.launch_base_model import *
+from seven_cloudapp_frame.models.db_models.price.price_gear_model import *
+
+
+class PriceBaseModel():
+    """
+    :description: 价格档位业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_price_gear_dependency_key(self, act_id, delay_delete_time=0.01):
+        """
+        :description: 删除价格档位依赖建
+        :param act_id: 活动标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        PriceGearModel().delete_dependency_key(DependencyKey.price_gear_list(act_id), delay_delete_time)
+
+    def save_price_gear(self,app_id,act_id,price_gear_id,relation_type,price_gear_name,price_gear_pic,price,goods_id,sku_id,remark="",sort_index=0):
+        """
+        :description: 保存价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param relation_type：关联类型：1-商品skuid关联2-商品id关联
+        :param price_gear_name：档位名称
+        :param price_gear_pic：档位图片
+        :param price：价格
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :param remark：备注
+        :param sort_index：排序
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear = None
+        old_price_gear = None
+        price_gear_model = PriceGearModel(context=self.context)
+        if price_gear_id > 0:
+            price_gear = price_gear_model.get_entity_by_id(price_gear_id)
+        is_add = False
+        if not price_gear:
+            is_add = True
+            price_gear = PriceGear()
+        else:
+            old_price_gear = deepcopy(price_gear)
+        try:
+            price = decimal.Decimal(price)
+        except Exception as ex:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "参数price类型错误"
+            return invoke_result_data
+
+        if goods_id != "":
+            price_gear_goodsid = price_gear_model.get_entity("act_id!=%s and goods_id=%s", params=[act_id, goods_id])
+            if price_gear_goodsid:
+                act_info_dict = ActInfoModel(context=self.context).get_dict_by_id(price_gear_goodsid.act_id)
+                act_name = act_info_dict["act_name"] if act_info_dict else ""
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = f"此商品ID已关联活动{act_name},无法使用"
+                return invoke_result_data
+
+        price_gear.app_id = app_id
+        price_gear.act_id = act_id
+        price_gear.relation_type = relation_type
+        price_gear.price = price
+        price_gear.price_gear_name = price_gear_name
+        price_gear.price_gear_pic = price_gear_pic
+        price_gear.goods_id = goods_id
+        price_gear.sku_id = sku_id
+        price_gear.remark = remark
+        price_gear.sort_index = sort_index
+        price_gear.modify_date = SevenHelper.get_now_datetime()
+
+        if is_add:
+            if sku_id != "":
+                price_gear_goodsid_skuid = price_gear_model.get_total("sku_id=%s", params=[sku_id])
+                if price_gear_goodsid_skuid:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
+                    return invoke_result_data
+            price_gear.create_date = SevenHelper.get_now_datetime()
+            price_gear.effective_date = SevenHelper.get_now_datetime()
+            price_gear.id = price_gear_model.add_entity(price_gear)
+        else:
+            if sku_id != "":
+                price_gear_goodsid_skuid = price_gear_model.get_total("id!=%s and sku_id=%s", params=[price_gear.id, sku_id])
+                if price_gear_goodsid_skuid:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = f"当前SKUID已绑定价格档位,请更换"
+                    return invoke_result_data
+            price_gear_model.update_entity(price_gear)
+
+        launch_goods_id = price_gear.goods_id if price_gear else ''
+        old_goods_id = old_price_gear.goods_id if old_price_gear else ''
+        launch_base_model = LaunchBaseModel(context=self.context)
+        launch_base_model.add_launch_goods(app_id,act_id, launch_goods_id, old_goods_id,"2")
+
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = price_gear
+        result["old"] = old_price_gear
+        invoke_result_data.data = result
+        self._delete_price_gear_dependency_key(act_id)
+        return invoke_result_data
+
+    def get_price_gear_list(self,app_id,act_id,page_size,page_index,order_by="id desc",is_del=0,is_cache=True, page_count_mode="total"):
+        """
+        :description: 获取价格档位列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param page_index：页索引
+        :param page_size：页大小
+        :param order_by：排序
+        :param is_del：是否回收站1是0否
+        :param is_cache：是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算
+        :return:
+        :last_editors: HuangJianYi
+        """
+        condition = "app_id=%s and act_id=%s"
+        if is_del == 1:
+            condition += " and is_del=1"
+        else:
+            condition += " and is_del=0"
+
+        params = [app_id,act_id]
+        price_gear_model = PriceGearModel(context=self.context)
+        if is_cache == True:
+            page_list = price_gear_model.get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,dependency_key=DependencyKey.price_gear_list(act_id),page_count_mode=page_count_mode)
+        else:
+            page_list = price_gear_model.get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=condition, group_by="", order_by=order_by,params=params,page_count_mode=page_count_mode)
+        return page_list
+
+    def update_price_gear_status(self,app_id,act_id,price_gear_id,is_del):
+        """
+        :description: 删除或恢复价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param is_del：1删除0恢复
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear_model = PriceGearModel(context=self.context)
+        price_gear_dict = price_gear_model.get_dict_by_id(price_gear_id)
+        if not price_gear_dict or price_gear_dict["act_id"] != act_id or price_gear_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "价格档位信息不存在"
+            return invoke_result_data
+        goods_id =  price_gear_dict["goods_id"]
+        invoke_result_data.success = price_gear_model.update_table("is_del=%s,goods_id='',sku_id=''", "id=%s", [is_del, price_gear_id])
+        if invoke_result_data.success ==True and is_del == 1:
+            launch_base_model = LaunchBaseModel(context=self.context)
+            launch_base_model.update_launch_goods(act_id, goods_id,"2")
+        self._delete_price_gear_dependency_key(act_id)
+        invoke_result_data.data = price_gear_dict
+        return invoke_result_data
+
+    def check_price_gear(self,app_id,act_id,price_gear_id,goods_id,sku_id):
+        """
+        :description: 验证价格档位
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param price_gear_id：价格档位标识
+        :param goods_id：商品ID
+        :param sku_id：sku_id
+        :return:
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        price_gear_model = PriceGearModel(context=self.context)
+        condtion = "app_id=%s and goods_id=%s"
+        params = [app_id, goods_id]
+        if price_gear_id > 0:
+            condtion += " and id!=%s"
+            params.append(price_gear_id)
+        price_gear_dict_list = price_gear_model.get_dict_list(condtion, params=params)
+        is_fail = False
+        bind_act_id = 0
+        if price_gear_dict_list:
+            if not sku_id:
+                is_fail = True
+                bind_act_id = price_gear_dict_list[0]["act_id"]
+            else:
+                for price_gear_dict in price_gear_dict_list:
+                    if price_gear_dict["relation_type"] == 2 or price_gear_dict["sku_id"] == sku_id:
+                        is_fail = True
+                        bind_act_id = int(price_gear_dict["act_id"])
+                        break
+        #验证失败
+        if is_fail == True:
+            if act_id == bind_act_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "对不起,该商品已绑定其他价格档位"
+                return invoke_result_data
+            else:
+                act_info = ActInfoModel(context=self.context).get_cache_entity_by_id(bind_act_id)
+                if act_info:
+                    invoke_result_data.success = False
+                    invoke_result_data.error_code = "error"
+                    invoke_result_data.error_message = "对不起,该商品已绑定" + act_info.act_name + "活动"
+                    return invoke_result_data
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/prize_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/models/prize_base_model.py`

 * *Files 16% similar despite different names*

```diff
@@ -1,313 +1,327 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-08-04 13:41:15
-@LastEditTime: 2021-10-09 10:57:45
-@LastEditors: HuangJianYi
-@Description: 
-"""
-from seven_cloudapp_frame.models.seven_model import *
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-
-class PrizeBaseModel():
-    """
-    :description: 活动奖品业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-
-    def _delete_act_prize_dependency_key(self,act_id,prize_id):
-        """
-        :description: 删除活动奖品依赖建
-        :param act_id: 活动标识
-        :param prize_id: 奖品标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        try:
-            redis_init = SevenHelper.redis_init()
-            if prize_id:
-                redis_init.delete(f"act_prize:prizeid_{prize_id}")
-            if act_id:
-                redis_init.delete(f"act_prize_list:actid_{act_id}")
-        except Exception as ex:
-            pass
-             
-    def get_act_prize_dict(self,prize_id,is_cache=True,is_filter=True):
-        """
-        :description: 获取活动模块
-        :param prize_id: 奖品标识
-        :param is_cache: 是否缓存
-        :param is_filter: 是否过滤未发布或删除的数据
-        :return: 返回活动奖品
-        :last_editors: HuangJianYi
-        """
-        act_prize_model = ActPrizeModel(context=self.context)
-        if is_cache:
-            dependency_key = f"act_prize:prizeid_{prize_id}"
-            act_prize_dict = act_prize_model.get_cache_dict_by_id(prize_id,dependency_key=dependency_key)
-        else:
-            act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if is_filter == True:
-            if not act_prize_dict or act_prize_dict["is_release"] == 0 or act_prize_dict["is_del"] == 1:
-                return None
-        return act_prize_dict
-
-    def get_act_prize_list(self,app_id,act_id,module_id,prize_name,ascription_type,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],is_cache=True):
-        """
-        :description: 获取活动奖品列表
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_name: 奖品名称
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param is_del：是否回收站1是0否
-        :param page_size: 条数
-        :param page_index: 页数
-        :param order_by：排序
-        :param condition：条件
-        :param params：参数化数组
-        :param is_cache: 是否缓存
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        where = "app_id=%s AND act_id=%s"
-        params_list = [app_id,act_id]
-        if condition:
-            where += " AND " + condition
-            params_list.extend(params)
-        if ascription_type !=0:
-            where += " and ascription_type=%s"
-            params_list.append(is_del)
-        if is_del !=-1:
-            where += " and is_del=%s"
-            params_list.append(is_del)
-        if module_id !=0:
-            where += " and module_id=%s"
-            params_list.append(module_id)
-        if prize_name:
-            where += " and prize_name=%s"
-            params_list.append(prize_name)
-        act_prize_model = ActPrizeModel(context=self.context)
-        if is_cache:
-            page_list, total = act_prize_model.get_cache_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=f"act_prize_list:actid_{act_id}")
-        else:
-            page_list, total = act_prize_model.get_dict_page_list(field="*", page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list)    
-        return page_list, total
-
-    def save_act_prize(self,app_id,act_id,module_id,prize_id,prize_name,prize_title,prize_pic,prize_detail_json,goods_id,goods_code,goods_code_list,goods_type,prize_type,prize_price,probability,chance,prize_limit,is_prize_notice,surplus,is_surplus,lottery_type,tag_name,tag_id,is_sku,sku_json,sort_index,is_release,ascription_type=0,i1=0,i2=0,i3=0,i4=0,i5=0,s1='',s2='',s3='',s4='',s5='',d1='',d2=''):
-        """
-        :description: 保存活动模块信息
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param module_id: 活动模块标识
-        :param prize_id: 奖品标识
-        :param prize_name: 奖品名称
-        :param prize_title: 奖品子标题
-        :param prize_pic: 奖品图
-        :param prize_detail_json: 奖品详情图（json）
-        :param goods_id: 商品ID
-        :param goods_code: 商品编码
-        :param goods_code_list: 多个sku商品编码
-        :param goods_type: 物品类型（1虚拟2实物）
-        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
-        :param prize_price: 奖品价值
-        :param probability: 奖品权重
-        :param chance: 概率
-        :param prize_limit: 中奖限制数
-        :param is_prize_notice: 是否显示跑马灯(1是0否)
-        :param surplus: 当前库存
-        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
-        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
-        :param tag_name: 标签名称(奖项名称)
-        :param tag_id: 标签ID(奖项标识)
-        :param is_sku: 是否有SKU
-        :param sku_json: sku详情json
-        :param sort_index: 排序
-        :param is_release: 是否发布（1是0否）
-        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
-        :param i1: i1
-        :param i2: i2
-        :param i3: i3
-        :param i4: i4
-        :param i5: i5
-        :param s1: s1
-        :param s2: s2
-        :param s3: s3
-        :param s4: s4
-        :param s5: s5
-        :param d1: d1
-        :param d2: d2
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not module_id and not act_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        
-        is_add = False
-        old_act_prize = None
-        act_prize = None
-        now_datetime = SevenHelper.get_now_datetime()
-        act_prize_model = ActPrizeModel(context=self.context)
-        if prize_id > 0:
-            act_prize = act_prize_model.get_entity_by_id(prize_id)
-            if not act_prize or act_prize.app_id != app_id:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "活动奖品信息不存在"
-                return invoke_result_data
-            old_act_prize = deepcopy(act_prize)
-        if not act_prize:
-            is_add = True
-            act_prize = ActPrize()
-
-        act_prize.app_id = app_id
-        act_prize.act_id = act_id
-        act_prize.module_id = module_id
-        act_prize.ascription_type = ascription_type
-        act_prize.prize_name = prize_name
-        act_prize.prize_title = prize_title
-        act_prize.prize_pic = prize_pic
-        act_prize.prize_detail_json = prize_detail_json if prize_detail_json else []
-        act_prize.goods_id = goods_id
-        act_prize.goods_code = goods_code
-        act_prize.goods_code_list = goods_code_list
-        act_prize.goods_type = goods_type
-        act_prize.prize_type = prize_type
-        act_prize.prize_price = prize_price
-        act_prize.probability = probability
-        act_prize.chance = chance
-        act_prize.prize_limit = prize_limit
-        act_prize.is_prize_notice = is_prize_notice
-        act_prize.is_surplus = is_surplus
-        act_prize.lottery_type = lottery_type
-        act_prize.tag_name = tag_name
-        act_prize.tag_id = tag_id
-        act_prize.is_sku = is_sku
-        act_prize.sku_json = sku_json if sku_json else {}
-        act_prize.sort_index = sort_index
-        act_prize.is_release = is_release
-        act_prize.i1 = i1
-        act_prize.i2 = i2
-        act_prize.i3 = i3
-        act_prize.i4 = i4
-        act_prize.i5 = i5
-        act_prize.s1 = s1
-        act_prize.s2 = s2
-        act_prize.s3 = s3
-        act_prize.s4 = s4
-        act_prize.s5 = s5
-        act_prize.d1 = d1
-        act_prize.d2 = d2
-        act_prize.modify_date = now_datetime
-        
-        # 奖品类型为参与奖时
-        surplus = 9999 if prize_type == 4 else surplus
-        
-        if is_add:
-            act_prize.create_date = now_datetime
-            act_prize.surplus = surplus
-            act_prize.prize_total = surplus
-            act_prize.id = act_prize_model.add_entity(act_prize)
-        else:
-            act_prize_model.update_entity(act_prize,exclude_field_list="app_id,act_id,module_id,prize_total,surplus,hand_out")
-            operate_num = surplus - act_prize.prize_total
-            if operate_num != 0:
-                act_prize_model.update_table(f"surplus=surplus+{operate_num},prize_total=prize_total+{operate_num}", "id=%s", act_prize.id)
-            
-        result = {}
-        result["is_add"] = is_add
-        result["new"] = act_prize
-        result["old"] = old_act_prize
-        invoke_result_data.data = result
-        self._delete_act_prize_dependency_key(act_id,act_prize.id)
-        return invoke_result_data
-    
-    def save_tao_coupon(self,app_id,act_id,prize_id,coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date):
-        """
-        :description: 添加奖品关联优惠券
-        :param app_id: 应用标识
-        :param act_id: 活动标识
-        :param prize_id: 奖品标识
-        :param coupon_type: 优惠券类型(0无1店铺优惠券2商品优惠券)
-        :param right_ename: 发放的权益(奖品)唯一标识
-        :param pool_id: 奖池ID
-        :param coupon_start_date: 优惠券开始时间
-        :param coupon_end_date: 优惠券结束时间
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        tao_coupon = None
-        tao_coupon_model = TaoCouponModel(context=self.context)
-        if prize_id > 0:
-            tao_coupon = tao_coupon_model.get_entity("act_id=%s and prize_id=%s",params=[act_id,prize_id])
-        if not tao_coupon:
-            tao_coupon = TaoCoupon()
-        tao_coupon.app_id = app_id
-        tao_coupon.act_id = act_id
-        tao_coupon.coupon_type = coupon_type
-        tao_coupon.right_ename = right_ename
-        tao_coupon.pool_id = pool_id
-        tao_coupon.coupon_start_date = coupon_start_date if coupon_start_date else "1900-01-01 00:00:00"
-        tao_coupon.coupon_end_date = coupon_end_date if coupon_end_date else "2900-01-01 00:00:00"
-        tao_coupon.modify_date = SevenHelper.get_now_datetime()
-        tao_coupon_model.add_update_entity(tao_coupon)
-        return invoke_result_data
-
-    def update_act_prize_status(self,app_id,prize_id,is_del):
-        """
-        :description: 删除或者还原活动奖品
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :param is_del：0-还原，1-删除
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_prize_model = ActPrizeModel(context=self.context)
-        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动奖品信息不存在"
-            return invoke_result_data
-        is_release = 0 if is_del == 1 else 1
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_prize_model.update_table("is_del=%s,is_release=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, prize_id])
-        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],prize_id)
-        return invoke_result_data
-    
-    def release_act_prize(self,app_id,prize_id,is_release):
-        """
-        :description: 活动奖品上下架
-        :param app_id：应用标识
-        :param prize_id：奖品标识
-        :param is_release: 是否发布 1-是 0-否
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        act_prize_model = ActPrizeModel(context=self.context)
-        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
-        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "活动奖品不存在"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        invoke_result_data.success = act_prize_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, prize_id])
-        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],prize_id)
-        return invoke_result_data
-
-    
-
-    
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-04 13:41:15
+@LastEditTime: 2023-02-21 13:38:22
+@LastEditors: HuangJianYi
+@Description: 
+"""
+from seven_cloudapp_frame.models.seven_model import *
+from seven_cloudapp_frame.libs.customize.seven_helper import *
+from seven_cloudapp_frame.models.db_models.act.act_module_model import *
+from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
+from seven_cloudapp_frame.models.db_models.tao.tao_coupon_model import *
+from seven_cloudapp_frame.models.db_models.user.user_info_model import *
+
+class PrizeBaseModel():
+    """
+    :description: 活动奖品业务模型
+    """
+    def __init__(self, context=None,logging_error=None, logging_info=None):
+        self.context = context
+        self.logging_link_error = logging_error
+        self.logging_link_info = logging_info
+
+    def _delete_act_prize_dependency_key(self, act_id, model_id, prize_id, delay_delete_time=0.01):
+        """
+        :description: 删除活动奖品依赖建
+        :param act_id: 活动标识
+        :param model_id: 模块标识
+        :param prize_id: 奖品标识
+        :param delay_delete_time: 延迟删除时间，传0则不进行延迟
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        dependency_key_list = []
+        if prize_id:
+            dependency_key_list.append(DependencyKey.act_prize(prize_id))
+        if act_id:
+            dependency_key_list.append(DependencyKey.act_prize_list(act_id))
+            if model_id:
+                dependency_key_list.append(DependencyKey.act_prize_list(act_id, model_id))
+        ActPrizeModel().delete_dependency_key(dependency_key_list,delay_delete_time)
+
+
+    def get_act_prize_dict(self,prize_id,is_cache=True,is_filter=True):
+        """
+        :description: 获取活动模块
+        :param prize_id: 奖品标识
+        :param is_cache: 是否缓存
+        :param is_filter: 是否过滤未发布或删除的数据
+        :return: 返回活动奖品
+        :last_editors: HuangJianYi
+        """
+        act_prize_model = ActPrizeModel(context=self.context)
+        if is_cache:
+            act_prize_dict = act_prize_model.get_cache_dict_by_id(prize_id,dependency_key=DependencyKey.act_prize(prize_id))
+        else:
+            act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if is_filter == True:
+            if not act_prize_dict or act_prize_dict["is_release"] == 0 or act_prize_dict["is_del"] == 1:
+                return None
+        return act_prize_dict
+
+    def get_act_prize_list(self,app_id,act_id,module_id,prize_name,ascription_type,is_del,page_size,page_index,order_by="sort_index desc,id asc",condition="",params=[],field="*",is_cache=True,page_count_mode="total"):
+        """
+        :description: 获取活动奖品列表
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_name: 奖品名称
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param is_del：是否回收站1是0否
+        :param page_size: 条数
+        :param page_index: 页数
+        :param order_by：排序
+        :param condition：条件
+        :param params：参数化数组
+        :param field:查询字段
+        :param is_cache: 是否缓存
+        :param page_count_mode: 分页计数模式 total-计算总数(默认) next-计算是否有下一页(bool) none-不计算       
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        where = "app_id=%s and act_id=%s"
+        params_list = [app_id,act_id]
+        if condition:
+            where += " and " + condition
+            params_list.extend(params)
+        if ascription_type != -1:
+            where += " and ascription_type=%s"
+            params_list.append(ascription_type)
+        if is_del !=-1:
+            where += " and is_del=%s"
+            params_list.append(is_del)
+        if module_id:
+            where += " and module_id=%s"
+            params_list.append(module_id)
+        if prize_name:
+            where += " and prize_name=%s"
+            params_list.append(prize_name)
+        act_prize_model = ActPrizeModel(context=self.context)
+        if is_cache:
+            page_list = act_prize_model.get_cache_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,dependency_key=DependencyKey.act_prize_list(act_id,module_id),page_count_mode=page_count_mode)
+        else:
+            page_list = act_prize_model.get_dict_page_list(field=field, page_index=page_index, page_size=page_size, where=where, group_by="", order_by=order_by, params=params_list,page_count_mode=page_count_mode)
+        return page_list
+
+    def save_act_prize(self,app_id,act_id,module_id,prize_id,prize_name,prize_title,prize_pic,prize_detail_json,goods_id,goods_code,goods_code_list,goods_type,prize_type,prize_price,probability,chance,prize_limit,is_prize_notice,prize_total,is_surplus,lottery_type,tag_name,tag_id,is_sku,sku_json,sort_index,is_release,ascription_type=0,i1=0,i2=0,i3=0,i4=0,i5=0,s1='',s2='',s3='',s4='',s5='',d1='',d2=''):
+        """
+        :description: 保存活动模块信息
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param module_id: 活动模块标识
+        :param prize_id: 奖品标识
+        :param prize_name: 奖品名称
+        :param prize_title: 奖品子标题
+        :param prize_pic: 奖品图
+        :param prize_detail_json: 奖品详情图（json）
+        :param goods_id: 商品ID
+        :param goods_code: 商品编码
+        :param goods_code_list: 多个sku商品编码
+        :param goods_type: 物品类型（1虚拟2实物）
+        :param prize_type: 奖品类型(1现货2优惠券3红包4参与奖、谢谢参与5预售)
+        :param prize_price: 奖品价值
+        :param probability: 奖品权重
+        :param chance: 概率
+        :param prize_limit: 中奖限制数
+        :param is_prize_notice: 是否显示跑马灯(1是0否)
+        :param prize_total: 变动后的奖品总数
+        :param is_surplus: 是否显示奖品库存（1显示0-不显示）
+        :param lottery_type: 出奖类型（1概率出奖 2强制概率）
+        :param tag_name: 标签名称(奖项名称)
+        :param tag_id: 标签ID(奖项标识)
+        :param is_sku: 是否有SKU
+        :param sku_json: sku详情json
+        :param sort_index: 排序
+        :param is_release: 是否发布（1是0否）
+        :param ascription_type: 奖品归属类型（0-活动奖品1-任务奖品）
+        :param i1: i1
+        :param i2: i2
+        :param i3: i3
+        :param i4: i4
+        :param i5: i5
+        :param s1: s1
+        :param s2: s2
+        :param s3: s3
+        :param s4: s4
+        :param s5: s5
+        :param d1: d1
+        :param d2: d2
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        if not module_id and not act_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "param_error"
+            invoke_result_data.error_message = "参数不能为空或等于0"
+            return invoke_result_data
+
+        is_add = False
+        old_act_prize = None
+        act_prize = None
+        now_datetime = SevenHelper.get_now_datetime()
+        act_prize_model = ActPrizeModel(context=self.context)
+        if prize_id > 0:
+            act_prize = act_prize_model.get_entity_by_id(prize_id)
+            if not act_prize or act_prize.app_id != app_id:
+                invoke_result_data.success = False
+                invoke_result_data.error_code = "error"
+                invoke_result_data.error_message = "活动奖品信息不存在"
+                return invoke_result_data
+            old_act_prize = deepcopy(act_prize)
+        if not act_prize:
+            is_add = True
+            act_prize = ActPrize()
+
+        act_prize.app_id = app_id
+        act_prize.act_id = act_id
+        act_prize.module_id = module_id
+        act_prize.ascription_type = ascription_type
+        act_prize.prize_name = prize_name
+        act_prize.prize_title = prize_title
+        act_prize.prize_pic = prize_pic
+        act_prize.prize_detail_json = prize_detail_json if prize_detail_json else []
+        act_prize.goods_id = goods_id
+        act_prize.goods_code = goods_code
+        act_prize.goods_code_list = goods_code_list
+        act_prize.goods_type = goods_type
+        act_prize.prize_type = prize_type
+        act_prize.prize_price = prize_price
+        act_prize.probability = probability
+        act_prize.chance = chance
+        act_prize.prize_limit = prize_limit
+        act_prize.is_prize_notice = is_prize_notice
+        act_prize.is_surplus = is_surplus
+        act_prize.lottery_type = lottery_type
+        act_prize.tag_name = tag_name
+        act_prize.tag_id = tag_id
+        act_prize.is_sku = is_sku
+        act_prize.sku_json = sku_json if sku_json else {}
+        act_prize.sort_index = sort_index
+        act_prize.is_release = is_release
+        act_prize.i1 = i1
+        act_prize.i2 = i2
+        act_prize.i3 = i3
+        act_prize.i4 = i4
+        act_prize.i5 = i5
+        act_prize.s1 = s1
+        act_prize.s2 = s2
+        act_prize.s3 = s3
+        act_prize.s4 = s4
+        act_prize.s5 = s5
+        act_prize.d1 = d1
+        act_prize.d2 = d2
+        act_prize.modify_date = now_datetime
+
+        # 奖品类型为参与奖时
+        prize_total = 9999 if prize_type == 4 else prize_total
+
+        if is_add:
+            act_prize.create_date = now_datetime
+            act_prize.surplus = prize_total
+            act_prize.prize_total = prize_total
+            act_prize.id = act_prize_model.add_entity(act_prize)
+        else:
+            act_prize_model.update_entity(act_prize,exclude_field_list="app_id,act_id,module_id,prize_total,surplus,hand_out")
+            operate_num = prize_total - act_prize.prize_total
+            if operate_num != 0:
+                act_prize_model.update_table(f"surplus=surplus+{operate_num},prize_total=prize_total+{operate_num}", "id=%s", act_prize.id)
+
+        result = {}
+        result["is_add"] = is_add
+        result["new"] = act_prize
+        result["old"] = old_act_prize
+        invoke_result_data.data = result
+        self._delete_act_prize_dependency_key(act_id,module_id,act_prize.id)
+        return invoke_result_data
+
+    def save_tao_coupon(self,app_id,act_id,prize_id,coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price):
+        """
+        :description: 添加奖品关联优惠券
+        :param app_id: 应用标识
+        :param act_id: 活动标识
+        :param prize_id: 奖品标识
+        :param coupon_type: 优惠券类型(0无1店铺优惠券2商品优惠券3会员专享优惠券)
+        :param right_ename: 发放的权益(奖品)唯一标识
+        :param pool_id: 奖池ID
+        :param coupon_start_date: 优惠券开始时间
+        :param coupon_end_date: 优惠券结束时间
+        :param coupon_url: 优惠劵地址
+        :param coupon_price: 优惠券面额
+        :param use_sill_price: 使用门槛金额
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        tao_coupon = None
+        tao_coupon_model = TaoCouponModel(context=self.context)
+        if prize_id > 0:
+            tao_coupon = tao_coupon_model.get_entity("act_id=%s and prize_id=%s",params=[act_id,prize_id])
+        if not tao_coupon:
+            tao_coupon = TaoCoupon()
+        tao_coupon.app_id = app_id
+        tao_coupon.act_id = act_id
+        tao_coupon.prize_id = prize_id
+        tao_coupon.coupon_type = coupon_type
+        tao_coupon.right_ename = right_ename
+        tao_coupon.pool_id = pool_id
+        tao_coupon.coupon_start_date = coupon_start_date if coupon_start_date else "1900-01-01 00:00:00"
+        tao_coupon.coupon_end_date = coupon_end_date if coupon_end_date else "2900-01-01 00:00:00"
+        tao_coupon.coupon_url = coupon_url
+        tao_coupon.coupon_price = coupon_price
+        tao_coupon.use_sill_price = use_sill_price
+
+        tao_coupon.modify_date = SevenHelper.get_now_datetime()
+        tao_coupon.id = tao_coupon_model.add_update_entity(tao_coupon, update_sql="coupon_type=%s,right_ename=%s,pool_id=%s,coupon_start_date=%s,coupon_end_date=%s,coupon_url=%s,coupon_price=%s,use_sill_price=%s,modify_date=%s",params=[coupon_type,right_ename,pool_id,coupon_start_date,coupon_end_date,coupon_url,coupon_price,use_sill_price,tao_coupon.modify_date])
+        invoke_result_data.data=tao_coupon.id
+        tao_coupon_model.delete_dependency_key([DependencyKey.coupon(tao_coupon.id),DependencyKey.coupon_list(act_id)])
+        return invoke_result_data
+
+    def update_act_prize_status(self,app_id,prize_id,is_del):
+        """
+        :description: 删除或者还原活动奖品
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :param is_del：0-还原，1-删除
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_prize_model = ActPrizeModel(context=self.context)
+        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动奖品信息不存在"
+            return invoke_result_data
+        is_release = 0 if is_del == 1 else 1
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_prize_model.update_table("is_del=%s,is_release=%s,modify_date=%s", "id=%s", [is_del, is_release, modify_date, prize_id])
+        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
+        invoke_result_data.data = act_prize_dict
+        return invoke_result_data
+
+    def release_act_prize(self,app_id,prize_id,is_release):
+        """
+        :description: 活动奖品上下架
+        :param app_id：应用标识
+        :param prize_id：奖品标识
+        :param is_release: 是否发布 1-是 0-否
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        invoke_result_data = InvokeResultData()
+        act_prize_model = ActPrizeModel(context=self.context)
+        act_prize_dict = act_prize_model.get_dict_by_id(prize_id)
+        if not act_prize_dict or act_prize_dict["app_id"] != app_id:
+            invoke_result_data.success = False
+            invoke_result_data.error_code = "error"
+            invoke_result_data.error_message = "活动奖品不存在"
+            return invoke_result_data
+        modify_date = SevenHelper.get_now_datetime()
+        invoke_result_data.success = act_prize_model.update_table("modify_date=%s,is_release=%s", "id=%s", [modify_date, is_release, prize_id])
+        self._delete_act_prize_dependency_key(act_prize_dict["act_id"],act_prize_dict["module_id"],prize_id)
+        invoke_result_data.data = act_prize_dict
+        return invoke_result_data
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/models/user_base_model.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/handlers/server/order_s.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,714 +1,635 @@
-# -*- coding: utf-8 -*-
-"""
-@Author: HuangJianYi
-@Date: 2021-07-22 11:10:20
-@LastEditTime: 2021-10-19 14:16:08
-@LastEditors: HuangJianYi
-@Description: 
-"""
-
-from seven_cloudapp_frame.libs.customize.seven_helper import *
-from seven_cloudapp_frame.models.top_base_model import *
-from seven_cloudapp_frame.models.frame_base_model import FrameBaseModel
-from seven_cloudapp_frame.models.db_models.user.user_account_model import *
-from seven_cloudapp_frame.models.db_models.user.user_info_model import *
-from seven_cloudapp_frame.models.db_models.user.user_black_model import *
-from seven_cloudapp_frame.models.db_models.act.act_module_model import *
-from seven_cloudapp_frame.models.db_models.act.act_prize_model import *
-from seven_cloudapp_frame.models.db_models.prize.prize_roster_model import *
-
-class UserBaseModel(FrameBaseModel):
-    """
-    :description: 用户信息业务模型
-    """
-    def __init__(self, context):
-        self.context = context
-        super(UserBaseModel,self).__init__(context)
-
-    def _get_user_info_id_md5(self, act_id, user_id):
-        """
-        :description: 生成用户信息唯一标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :return: 用户信息唯一标识
-        :last_editors: HuangJianYi
-        """
-        if not act_id or not user_id:
-            return 0
-        return CryptoHelper.md5_encrypt_int(f"{act_id}_{user_id}")
-
-    def get_user_info_dependency_key(self, act_id, id_md5, open_id=""):
-        """
-        :description: 获取用户信息缓存key
-        :param user_info_id：用户信息标识
-        :param id_md5：用户md5标识
-        :param open_id：open_id
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        if id_md5:
-            return  f"user_info:actid_{act_id}_idmd5_{id_md5}"
-        else:
-            return  f"user_info:actid_{act_id}_openid_{open_id}"
-
-    def _delete_user_info_cache(self,act_id,id_md5):
-        """
-        :description: 删除用户信息缓存
-        :param act_id：活动标识
-        :param id_md5：用户md5标识
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        cache_key = self.get_user_info_dependency_key(act_id,id_md5)
-        redis_init = SevenHelper.redis_init()
-        redis_init.delete(cache_key)
-
-    def get_user_info_dict(self,app_id, act_id, user_id,open_id="",is_cache=True):
-        """
-        :description: 获取用户信息单条记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param is_cache：是否缓存
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        user_info_dict = None
-        if not act_id or (not user_id and not open_id):
-            return user_info_dict
-        user_info_model = UserInfoModel(context=self.context)
-        id_md5 = self._get_user_info_id_md5(act_id,user_id)
-        dependency_key = self.get_user_info_dependency_key(act_id,id_md5,open_id)
-        if id_md5:
-            if is_cache:
-                user_info_dict = user_info_model.get_cache_dict("id_md5=%s",params=[id_md5],dependency_key=dependency_key)
-            else:
-                
-                user_info_dict = user_info_model.get_dict("id_md5=%s",params=[id_md5])
-        else:
-            if is_cache:
-                user_info_dict = user_info_model.get_cache_dict(dependency_key=dependency_key,where="act_id=%s and open_id=%s", params=[act_id, open_id])
-            else:
-                user_info_dict = user_info_model.get_dict("act_id=%s and open_id=%s", params=[act_id, open_id])
-                
-        if user_info_dict and user_info_dict["app_id"] != app_id:
-            user_info_dict = None
-        return user_info_dict
-          
-    def get_user_list(self, app_id, act_id, page_size=20, page_index=0, user_state=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
-        """
-        :description: 获取用户信息列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：条数
-        :param page_index：页数
-        :param user_state：用户状态
-        :param user_id：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param order_by：排序
-        :return: 返回PageInfo
-        :last_editors: HuangJianYi
-        """
-        page_info = PageInfo(page_index, page_size, 0, [])
-        if not act_id:
-            return page_info
-
-        condition = "act_id=%s"
-        params = [act_id]
-
-        if app_id:
-            condition += " AND app_id=%s"
-            params.append(app_id)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if user_state != -1:
-            condition += " AND user_state=%s"
-            params.append(user_state)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-
-        page_list, total = UserInfoModel(context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
-
-        page_info = PageInfo(page_index, page_size, total, page_list)
-    
-    def get_join_member_url(self,access_token,app_key,app_secret,is_log):
-        """
-        :description: 获取加入会员地址
-        :param access_token:access_token
-        :param app_key:app_key
-        :param app_secret:app_secret
-        :param is_log:是否记录top请求日志
-        :return 
-        :last_editors: HuangJianYi
-        """
-        top_base_model = TopBaseModel(context=self.context)
-        return top_base_model.get_join_member_url(access_token,app_key,app_secret,is_log)
-    
-    def save_user_by_openid(self, app_id, act_id, open_id, user_nick, avatar, union_id=""):
-        """
-        :description: 获取或更新用户信息（主要用于登录）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :param union_id：union_id
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or not open_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        acquire_lock_name = f"save_user_by_openid:{app_id}_{open_id}"
-        acquire_lock_status, identifier = SevenHelper.redis_acquire_lock(acquire_lock_name)
-        if acquire_lock_status == False:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "acquire_lock"
-            invoke_result_data.error_message = "请求超时,请稍后再试"
-            return invoke_result_data
-
-        user_account_model = UserAccountModel(context=self.context)
-        user_info = None
-        user_info_model = UserInfoModel(context=self.context)
-        now_datetime = SevenHelper.get_now_datetime()
-        try:
-            user_account = user_account_model.get_entity("open_id=%s",params=[open_id])
-            if not user_account:
-                user_account = UserAccount()
-                user_account.union_id = union_id
-                user_account.open_id = open_id
-                user_account.user_nick = user_nick
-                user_account.avatar = avatar
-                user_account.is_auth = 0
-                user_account.user_state = 0
-                user_account.create_date = now_datetime
-                user_account.modify_date = now_datetime
-                user_account.id = user_account_model.add_entity(user_account)
-            else:
-                user_account.user_nick = user_nick if user_nick and user_account.user_nick != user_nick else user_account.user_nick
-                user_account.avatar = avatar if avatar and user_account.avatar != avatar else user_account.avatar
-                user_account_model.update_entity(user_account, "user_nick,avatar")
-                
-            user_info = user_info_model.get_entity("act_id=%s and open_id=%s", params=[act_id, open_id])
-            if not user_info:
-                user_info = UserInfo()
-                user_info.id_md5 = self._get_user_info_id_md5(act_id, user_account.id)
-                user_info.app_id = app_id
-                user_info.act_id = act_id
-                user_info.open_id = open_id
-                user_info.user_id = user_account.id
-                user_info.is_new = 1
-                user_info.user_nick = user_account.user_nick
-                user_info.avatar = user_account.avatar
-                user_info.user_nick = user_nick if user_nick else user_info.user_nick
-                user_info.avatar = avatar if avatar else user_info.avatar
-                user_info.create_date = now_datetime
-                user_info.modify_date = now_datetime
-                user_info.login_token = SevenHelper.get_random(16)
-                user_info_model.add_entity(user_info)
-            else:
-                if user_info.app_id != app_id:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "非法操作"
-                    return invoke_result_data
-                user_info.user_nick = user_account.user_nick
-                user_info.avatar = user_account.avatar
-                user_info.is_new = 0
-                user_info.modify_date = now_datetime
-                user_info.login_token = SevenHelper.get_random(16)
-                user_info_model.update_entity(user_info, "modify_date,login_token,is_new,user_nick,avatar")
-                
-                self._delete_user_info_cache(user_info.act_id,user_info.id_md5)
-                    
-        except Exception as ex:
-            self.context.logging_link_error("【获取或更新用户信息】" + traceback.format_exc())
-        finally:
-                SevenHelper.redis_release_lock(acquire_lock_name, identifier)
-        
-        invoke_result_data.data = user_info.__dict__
-        return invoke_result_data
-
-    def update_user_info(self, app_id, act_id, user_id, open_id, user_nick, avatar,is_member_before=-1,is_favor_before=-1):
-        """
-        :description: 更新用户信息（主要用于授权更新昵称和头像）
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :param user_nick：昵称
-        :param avatar：头像
-        :param is_member_before：初始会员状态
-        :param is_favor_before：初始关注状态
-        :return: 返回用户信息
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        if not act_id or (not user_id and not open_id):
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-
-        user_account_model = UserAccountModel(context=self.context)
-        user_info_dict = None
-        user_info_model = UserInfoModel(context=self.context)
-
-        try:
-            user_info_dict = self.get_user_info_dict(app_id, act_id, user_id,open_id)
-            if not user_info_dict:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "error"
-                invoke_result_data.error_message = "更新失败，找不到用户信息"
-                return invoke_result_data
-            else:
-                if user_info_dict["app_id"] != app_id:
-                    invoke_result_data.success = False
-                    invoke_result_data.error_code = "error"
-                    invoke_result_data.error_message = "非法操作"
-                    return invoke_result_data
-                user_info_dict["is_member_before"] = is_member_before if is_member_before!=-1 else user_info_dict["is_member_before"]
-                user_info_dict["is_favor_before"] = is_favor_before if is_favor_before!=-1 else user_info_dict["is_favor_before"]    
-                user_info_dict["user_nick"] = user_nick if user_nick else user_info_dict["user_nick"]
-                user_info_dict["avatar"] = avatar if avatar else user_info_dict["avatar"]
-                user_info_dict["modify_date"] = SevenHelper.get_now_datetime()
-                user_info_model.update_table("user_nick=%s,avatar=%s,modify_date=%s,is_member_before=%s,is_favor_before=%s","id=%s",params=[user_info_dict["user_nick"],user_info_dict["avatar"],user_info_dict["modify_date"],user_info_dict["is_member_before"],user_info_dict["is_favor_before"],user_info_dict["id"]])
-                
-                self._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
-                
-                update_sql = ""
-                params = []
-                if user_nick:
-                    update_sql = "user_nick=%s"
-                    params.append(user_nick)
-                if avatar:
-                    update_sql += "," if update_sql else ""
-                    update_sql += "avatar=%s"
-                    params.append(avatar)
-                params.append(user_info_dict["user_id"])
-                user_account_model.update_table(update_sql, "id=%s", params=params)
-
-        except Exception as ex:
-            self.context.logging_link_error("【更新用户信息】" + traceback.format_exc())
-
-        return invoke_result_data
-
-    def update_user_state(self, app_id, act_id, user_id, user_state):
-        """
-        :description: 更新用户状态
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param user_state: 用户状态（0-正常，1-黑名单）
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        id_md5 = self._get_user_info_id_md5(act_id, user_id)
-        user_info_model = UserInfoModel(context=self.context)
-        user_info = user_info_model.get_entity("id_md5=%s",params=[id_md5])
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        if user_info.user_state == user_state:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户状态没变无需更新"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        if user_state == 0:
-            user_info.relieve_date = modify_date
-        user_info.user_state = user_state
-        user_info.modify_date = modify_date
-        user_info_model.update_entity(user_info, "user_state,relieve_date,modify_date")
-        
-        self._delete_user_info_cache(user_info.act_id,user_info.id_md5)
-
-        return invoke_result_data
-
-    def update_user_state_by_black(self,app_id,act_id,user_id):
-        """
-        :description: 用户拉入黑名单
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-
-        id_md5 = self._get_user_info_id_md5(act_id, user_id)
-        db_transaction = DbTransaction(db_config_dict=config.get_value("db_cloudapp"))
-        user_info_model = UserInfoModel(db_transaction=db_transaction,context=self.context)
-        user_black_model = UserBlackModel(db_transaction=db_transaction, context=self.context)
-
-        user_info = user_info_model.get_entity("id_md5=%s",params=[id_md5])
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        if user_info.user_state == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "该用户已是黑名单"
-            return invoke_result_data
-        modify_date = SevenHelper.get_now_datetime()
-        user_info.user_state = 1
-        user_info.modify_date = modify_date
-
-        user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[user_info.act_id, user_info.user_id])
-
-        try:
-            db_transaction.begin_transaction()
-
-            user_info_model.update_entity(user_info, "user_state,modify_date")
-            if not user_black:
-                #添加到用户黑名单管理表
-                user_black = UserBlack()
-                user_black.app_id = user_info.app_id
-                user_black.act_id = user_info.act_id
-                user_black.user_id = user_info.user_id
-                user_black.open_id = user_info.open_id
-                user_black.user_nick = user_info.user_nick
-                user_black.black_type = 2
-                user_black.refund_order_data = []
-                user_black.create_date = SevenHelper.get_now_datetime()
-                user_black_model.add_entity(user_black)
-            else:
-                user_black.audit_status = 0
-                user_black.black_type = 2
-                user_black.create_date = SevenHelper.get_now_datetime()
-                user_black_model.update_entity(user_black)
-
-            result = db_transaction.commit_transaction()
-            if not result:
-                invoke_result_data.success = False
-                invoke_result_data.error_code = "fail"
-                invoke_result_data.error_message = "系统繁忙,请稍后再试"
-                return invoke_result_data
-            invoke_result_data.data = {"user_info":user_info.__dict__}
-            self._delete_user_info_cache(user_info.act_id,user_info.id_md5)
-
-        except Exception as ex:
-            db_transaction.rollback_transaction()
-            self.context.logging_link_error("【更新用户状态黑名单】" + traceback.format_exc())
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "exception"
-            invoke_result_data.error_message = "系统繁忙,请稍后再试"
-
-        return invoke_result_data
-
-    def apply_black_unbind(self,app_id,act_id,user_id, open_id="",reason="误封号,申请解封"):
-        """
-        :description: 申请黑名单解绑
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param open_id：open_id
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if not act_id or (not user_id and not open_id):
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_info_dict = self.get_user_info_dict(act_id,user_id,open_id)
-        if not user_info_dict:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        if user_info_dict["app_id"] != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-
-        if user_info_dict["user_state"] == 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "账号正常,无需申请解封"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        user_black = user_black_model.get_entity("act_id=%s and user_id=%s", order_by="create_date desc", params=[act_id, user_id])
-        if not user_black:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "账号正常,无需申请解封"
-            return invoke_result_data
-        if user_black.audit_status == 1:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "请耐心等待客服处理"
-            return invoke_result_data
-
-        user_black.audit_status = 1
-        user_black.reason = reason
-        user_black_model.update_entity(user_black, "audit_status,reason")
-        return invoke_result_data
-    
-    def audit_user_black(self,app_id,black_id,audit_status,audit_remark=""):
-        """
-        :description: 审核黑名单
-        :param app_id：应用标识
-        :param black_id：用户黑名单管理id
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param audit_remark：审核备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if black_id <= 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        black_info = user_black_model.get_entity_by_id(black_id)
-        if not black_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "找不到该条记录"
-            return invoke_result_data
-        if black_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-            
-        user_info_model = UserInfoModel(context=self.context)
-        id_md5 = self._get_user_info_id_md5(black_info.act_id, black_info.user_id)
-        user_info = user_info_model.get_entity("id_md5=%s",params=[id_md5])
-        if not user_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "用户信息不存在"
-            return invoke_result_data
-        audit_date = SevenHelper.get_now_datetime()
-        condition = "audit_status=%s,audit_date=%s"
-        params = [audit_status, audit_date]
-        if audit_remark:
-            condition+=",audit_remark=%s"
-            params.append(audit_remark)
-        params.append(black_id)
-        if audit_status == 0:
-            condition+=",black_type=2"
-            user_black_model.update_table(condition, "id=%s", params)
-            user_info.user_state = 1
-            user_info.modify_date = audit_date
-            user_info_model.update_entity(user_info,"user_state,modify_date")
-        elif audit_status == 2:
-            user_black_model.update_table(condition, "id=%s", params)
-            user_info.user_state = 0
-            user_info.modify_date = audit_date
-            user_info.relieve_date = audit_date
-            user_info_model.update_entity(user_info, "user_state,modify_date,modify_date")
-        elif audit_status == 3:
-            user_black_model.update_table(condition, "id=%s", params)
-         
-        invoke_result_data.data = {"user_info":user_info.__dict__}
-        self._delete_user_info_cache(user_info.act_id,user_info.id_md5)
-        
-        return invoke_result_data
-
-    def update_audit_remark(self,app_id,black_id,audit_remark):
-        """
-        :description: 修改审核备注
-        :param app_id：应用标识
-        :param black_id：用户黑名单管理id
-        :param audit_remark：审核备注
-        :return:
-        :last_editors: HuangJianYi
-        """
-        invoke_result_data = InvokeResultData()
-        if black_id <= 0:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "param_error"
-            invoke_result_data.error_message = "参数不能为空或等于0"
-            return invoke_result_data
-        user_black_model = UserBlackModel(context=self.context)
-        black_info = user_black_model.get_entity_by_id(black_id)
-        if not black_info:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "找不到该条记录"
-            return invoke_result_data
-        if black_info.app_id != app_id:
-            invoke_result_data.success = False
-            invoke_result_data.error_code = "error"
-            invoke_result_data.error_message = "非法操作"
-            return invoke_result_data
-        user_black_model.update_table("audit_remark=%s", "id=%s", [audit_remark,black_id])
-        return invoke_result_data        
-        
-    def get_black_info_dict(self, app_id, act_id, user_id,is_cache=True):
-        """
-        :description: 获取黑名单单条记录
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param user_id：用户标识
-        :param is_cache：是否缓存
-        :return:
-        :last_editors: HuangJianYi
-        """
-        user_black_dict = None
-        if not act_id or not user_id:
-            return user_black_dict
-        user_info_dict = self.get_user_info_dict(app_id, act_id, user_id)
-        if not user_info_dict:
-            return user_black_dict
-        where = "act_id=%s and user_id=%s"
-        params = [act_id, user_id]
-        user_black_model = UserBlackModel(context=self.context)
-        if is_cache:
-            user_black_dict = user_black_model.get_cache_dict(dependency_key=f"user_black:{act_id}_{user_id}",where=where, params=params)
-        else:
-            user_black_dict = user_black_model.get_dict(where, params=params)
-        return user_black_dict       
-
-    def get_black_list(self, app_id, act_id, page_size=20, page_index=0, audit_status=-1, user_id=0, start_date="", end_date="", user_nick="", open_id="", order_by="id desc"):
-        """
-        :description: 获取用户黑名单列表
-        :param app_id：应用标识
-        :param act_id：活动标识
-        :param page_size：条数
-        :param page_index：页数
-        :param audit_status：审核状态(0黑名单1申请中2同意3拒绝)
-        :param user_id：用户标识
-        :param start_date：开始时间
-        :param end_date：结束时间
-        :param user_nick：昵称
-        :param open_id：open_id
-        :param order_by：排序
-        :return: 返回PageInfo
-        :last_editors: HuangJianYi
-        """
-        page_info = PageInfo(page_index, page_size, 0, [])
-        if not act_id:
-            return page_info
-
-        condition = "act_id=%s"
-        params = [act_id]
-
-        if app_id:
-            condition += " AND app_id=%s"
-            params.append(app_id)
-        if user_id != 0:
-            condition += " AND user_id=%s"
-            params.append(user_id)
-        if audit_status != -1:
-            condition += " AND audit_status=%s"
-            params.append(audit_status)
-        if open_id:
-            condition += " AND open_id=%s"
-            params.append(open_id)
-        if user_nick:
-            condition += " AND user_nick=%s"
-            params.append(user_nick)
-        if start_date:
-            condition += " AND create_date>=%s"
-            params.append(start_date)
-        if end_date:
-            condition += " AND create_date<=%s"
-            params.append(end_date)
-
-        page_list, total = UserBlackModel(context=self.context).get_dict_page_list("*", page_index, page_size, condition, order_by=order_by, params=params)
-        for user_black in page_list:
-            user_black["refund_order_data"] = SevenHelper.json_loads(user_black["refund_order_data"]) if user_black["refund_order_data"] else []
-
-        page_info = PageInfo(page_index, page_size, total, page_list)
-        return page_info
-
-    def check_pull_black(self,user_info_dict,is_black,refund_count,all_order_data):
-        """
-        :description: 校验是否拉黑
-        :param user_info_dict：用户信息字典
-        :param is_black：是否拉黑
-        :param refund_count：退款次数
-        :param all_order_data:淘宝订单列表
-        :return: 
-        :last_editors: HuangJianYi
-        """
-        result = False
-        try:
-            if user_info_dict["user_state"] == 0 and is_black == 1 and refund_count > 0:
-                #退款的订单  子订单存在退款 记录一次
-                refund_order_data = [i for i in all_order_data if i["refund_status"] not in self.refund_status()]
-                #如果不是黑用户 并且存在退款时间 代表黑用户解禁
-                if user_info_dict["relieve_date"] != '1900-01-01 00:00:00':
-                    refund_order_data = [i for i in refund_order_data if TimeHelper.format_time_to_datetime(str(i['pay_time'])) > TimeHelper.format_time_to_datetime(str(user_info_dict["relieve_date"]))]
-                #超过变成黑用户
-                if len(refund_order_data) >= refund_count:
-                    result = True
-                    user_info_model = UserInfoModel(context=self.context)
-                    user_info_model.update_table("user_state=1", "id=%s", user_info_dict["id"])
-                    user_black_model = UserBlackModel(context=self.context)
-                    user_black = user_black_model.get_entity("act_id=%s and user_id=%s", params=[user_info_dict["act_id"], user_info_dict["user_id"]])
-                    if user_black:
-                        user_black.black_type = 1
-                        user_black.reason = ""
-                        user_black.audit_status = 0
-                        user_black.audit_remark = ""
-                        user_black.refund_count += len(refund_order_data)
-                        all_refund_order_data = SevenHelper.json_loads(user_black.refund_order_data)
-                        if len(refund_order_data) > 0:
-                            for item in refund_order_data:
-                                all_refund_order_data.append(item)
-                        user_black.refund_order_data = SevenHelper.json_dumps(all_refund_order_data)
-                        user_black_model.update_entity(user_black)
-                    else:
-                        user_black = UserBlack()
-                        user_black.app_id = user_info_dict["app_id"]
-                        user_black.act_id = user_info_dict["act_id"]
-                        user_black.user_id = user_info_dict["user_id"]
-                        user_black.open_id = user_info_dict["open_id"]
-                        user_black.user_nick = user_info_dict["user_nick"]
-                        user_black.black_type = 1
-                        user_black.reason = ""
-                        user_black.audit_status = 0
-                        user_black.audit_remark = ""
-                        user_black.refund_count = len(refund_order_data)
-                        user_black.refund_order_data = SevenHelper.json_dumps(refund_order_data)
-                        user_black.create_date = SevenHelper.get_now_datetime()
-                        user_black_model.add_entity(user_black)
-                    self._delete_user_info_cache(user_info_dict["act_id"],user_info_dict["id_md5"])
-        except Exception as ex:
-            self.context.logging_link_error("【校验是否拉黑】" + traceback.format_exc())
-            result = False
-        return result
- 
-    
+# -*- coding: utf-8 -*-
+"""
+@Author: HuangJianYi
+@Date: 2021-08-09 14:11:52
+@LastEditTime: 2023-04-20 19:06:26
+@LastEditors: HuangJianYi
+@Description: 订单模块
+"""
+from seven_cloudapp_frame.models.enum import *
+from seven_cloudapp_frame.libs.customize.oss2_helper import *
+from seven_cloudapp_frame.handlers.frame_base import *
+from seven_cloudapp_frame.models.order_base_model import *
+
+
+class PayOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户购买订单列表
+    """
+    def get_async(self):
+        """
+        :description: 用户购买订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param main_pay_order_no：淘宝主订单号
+        :param sub_pay_order_no：淘宝子订单号
+        :param page_size：页大小
+        :param page_index：页索引
+        :return:
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        pay_date_start = self.get_param("pay_date_start")
+        pay_date_end = self.get_param("pay_date_end")
+        main_pay_order_no = self.get_param("main_pay_order_no")
+        sub_pay_order_no = self.get_param("sub_pay_order_no")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+
+        if main_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "main_pay_order_no=%s"
+            params.append(main_pay_order_no)
+        if sub_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "sub_pay_order_no=%s"
+            params.append(sub_pay_order_no)
+
+        order_base_model = OrderBaseModel(context=self)
+        page_info = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size=page_size, page_index=page_index, field=field, order_by=order_by, condition=condition, params=params)
+        ref_params = {}
+        page_info.data = self.business_process_executed(page_info.data, ref_params)
+        return self.response_json_success(page_info)
+
+
+class PrizeOrderListHandler(ClientBaseHandler):
+    """
+    :description: 用户奖品订单列表
+    """
+    def get_async(self):
+        """
+        :description: 用户奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_id：用户标识
+        :param user_open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param is_search_roster：是否查询订单关联中奖记录
+        :param page_size：页大小
+        :param page_index：页索引
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        order_no = self.get_param("order_no")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        address = self.get_param("address")
+        order_status = int(self.get_param("order_status",-10))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        order_by = self.get_param("order_by","create_date desc")
+        is_search_roster = self.get_param_int("is_search_roster", 0)
+        is_search_roster = False if is_search_roster == 0 else True
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 20))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list, total = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=is_search_roster, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params))
+        return self.response_json_success(page_info)
+
+
+class PrizeRosterListHandler(ClientBaseHandler):
+    """
+    :description: 用户中奖记录列表
+    """
+    def get_async(self):
+        """
+        :description: 用户中奖记录列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param module_name：模块名称
+        :param prize_name：奖品名称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :param page_size：页大小
+        :param page_index：页索引
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        order_no = self.get_param("order_no")
+        user_nick = self.get_param("nick_name")
+        module_name = self.get_param("module_name")
+        prize_name = self.get_param("prize_name")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success({"data": []})
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        condition_where = ConditionWhere()
+        if condition:
+            condition_where.add_condition(condition)
+        if module_name:
+            condition_where.add_condition("module_name=%s")
+            params.append(module_name)
+        if prize_name:
+            condition_where.add_condition("prize_name=%s")
+            params.append(prize_name)
+
+        order_base_model = OrderBaseModel(context=self)
+        page_list, total = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition_where.to_string(), params=params, is_cache=False)
+        ref_params = {}
+        page_info = PageInfo(page_index, page_size, total, self.business_process_executed(page_list, ref_params=ref_params))
+        return self.response_json_success(page_info)
+
+
+class UpdatePrizeOrderSellerRemarkHandler(ClientBaseHandler):
+    """
+    :description: 更新奖品订单卖家备注
+    """
+    @filter_check_params("prize_order_id")
+    def get_async(self):
+        """
+        :description: 更新奖品订单卖家备注
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param seller_remark：卖家备注
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_order_id = int(self.get_param("prize_order_id", 0))
+        seller_remark = self.get_param("seller_remark")
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.update_prize_order_seller_remark(app_id, act_id, prize_order_id, seller_remark)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "修改订单备注；用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
+        return self.response_json_success()
+
+
+class UpdatePrizeOrderStatusHandler(ClientBaseHandler):
+    """
+    :description: 更新用户奖品订单状态
+    """
+    @filter_check_params("prize_order_id,order_status")
+    def get_async(self):
+        """
+        :description: 更新用户奖品订单状态
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param prize_order_id：奖品订单标识
+        :param order_status：订单状态
+        :param express_company：快递公司
+        :param express_no：快递单号
+        :return: 实体模型InvokeResultData
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        prize_order_id = int(self.get_param("prize_order_id", 0))
+        order_status = int(self.get_param("order_status", 0))
+        express_company = self.get_param("express_company")
+        express_no = self.get_param("express_no")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.update_prize_order_status(app_id, act_id, prize_order_id, order_status, express_company, express_no, prize_roster_sub_table)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        title = "修改订单状态；"
+        if order_status == 1:
+            title = "发货；"
+        elif  order_status == 2:
+            title = "不予发货；"
+        title = title + "用户昵称：" + invoke_result_data.data["user_nick"] + "，openid：" + invoke_result_data.data["open_id"]
+        self.create_operation_log(operation_type=OperationType.operate.value, model_name="prize_order_tb", title=title)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class ImportPrizeOrderHandler(ClientBaseHandler):
+    """
+    :description: 导入奖品订单进行发货
+    """
+    @filter_check_params("content")
+    def post_async(self):
+        """
+        :description: 导入奖品订单进行发货
+        :param app_id：应用标识
+        :param content_type：内容类型 1-base64字符串内容 2-json字符串内容
+        :param content：字符串内容
+        :param act_id：活动标识
+        :param ref_head_name：关联表头名称，可不传
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        content = self.get_param("content")
+        content_type = int(self.get_param("content_type", 1))
+        ref_head_name = self.get_param("ref_head_name", "小程序订单号")
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
+        order_base_model = OrderBaseModel(context=self)
+        invoke_result_data = order_base_model.import_prize_order(app_id, act_id, content_type, content, ref_head_name, prize_roster_sub_table)
+        if invoke_result_data.success == False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        self.create_operation_log(operation_type=OperationType.import_data.value, model_name="prize_order_tb", title=operate_title)
+        ref_params = {}
+        invoke_result_data = self.business_process_executed(invoke_result_data, ref_params)
+        if invoke_result_data.success ==False:
+            return self.response_json_error(invoke_result_data.error_code, invoke_result_data.error_message)
+        return self.response_json_success(invoke_result_data.data)
+
+
+class PrizeOrderExportHandler(ClientBaseHandler):
+    """
+    :description: 导出奖品订单列表
+    """
+    def get_async(self):
+        """
+        :description: 导出奖品订单列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param open_id：open_id
+        :param order_no：订单号
+        :param nick_name：用户昵称
+        :param real_name：用户名字
+        :param telephone：联系电话
+        :param address：收货地址
+        :param order_status：订单状态（-1未付款-2付款中0未发货1已发货2不予发货3已退款4交易成功）
+        :param create_date_start：订单创建时间开始
+        :param create_date_end：订单创建时间结束
+        :param page_size：页大小
+        :param page_index：页索引
+        :return
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        order_no = self.get_param("order_no")
+        real_name = self.get_param("real_name")
+        telephone = self.get_param("telephone")
+        address = self.get_param("address")
+        order_status = int(self.get_param("order_status", -10))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "发货列表"
+        prize_roster_sub_table = invoke_result_data.data["prize_roster_sub_table"] if invoke_result_data.data.__contains__("prize_roster_sub_table") else None
+
+        order_base_model = OrderBaseModel(context=self)
+        prize_order_list_dict = []
+        if page_size <= 500:
+            prize_order_list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, page_size, page_index, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_prize_order_list(app_id, act_id, user_id, user_open_id, user_nick, order_no, real_name, telephone, address, order_status, create_date_start, create_date_end, max_page_size, begin_page_index + i, order_by, field=field, is_search_roster=True, is_cache=False, condition=condition, params=params, prize_roster_sub_table=prize_roster_sub_table, page_count_mode='none')
+                if len(list_dict) <= 0:
+                    break
+                prize_order_list_dict.extend(list_dict)
+
+        ref_params = {}
+        result_data = self.business_process_executed(prize_order_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_order_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data,ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        if len(result_data) > 0:
+            frame_base_model = FrameBaseModel(context=self)
+            for prize_order_dict in result_data:
+                for prize_roster_dict in prize_order_dict["roster_list"]:
+                    data_row = {}
+                    data_row["小程序订单号"] = prize_order_dict["order_no"]
+                    data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
+                    data_row["淘宝名"] = prize_order_dict["user_nick"]
+                    data_row["openid"] = prize_order_dict["open_id"]
+                    data_row["模块名称"] = prize_roster_dict["module_name"]
+                    data_row["奖品名称"] = prize_roster_dict["prize_name"]
+                    data_row["商家编码"] = prize_roster_dict["goods_code"]
+                    data_row["姓名"] = prize_order_dict["real_name"]
+                    data_row["手机号"] = prize_order_dict["telephone"]
+                    data_row["省份"] = prize_order_dict["province"]
+                    data_row["城市"] = prize_order_dict["city"]
+                    data_row["区县"] = prize_order_dict["county"]
+                    data_row["街道"] = prize_order_dict["street"]
+                    data_row["收货地址"] = prize_order_dict["address"]
+                    data_row["物流单号"] = prize_order_dict["express_no"]
+                    data_row["物流公司"] = prize_order_dict["express_company"]
+                    if str(prize_order_dict["deliver_date"]) == "1900-01-01 00:00:00":
+                        data_row["发货时间"] = ""
+                    else:
+                        data_row["发货时间"] = str(prize_order_dict["deliver_date"])
+                    data_row["订单状态"] = frame_base_model.get_order_status_name(prize_order_dict["order_status"])
+                    data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
+                    data_row["奖品规格"] = prize_roster_dict["sku_name"]
+                    data_row["备注"] = prize_order_dict["seller_remark"]
+                    result_list.append(data_row)
+        return result_list
+
+
+class PrizeRosterExportHandler(ClientBaseHandler):
+    """
+    :description: 导出用户中奖记录列表
+    """
+    def get_async(self):
+        """
+        :description: 导出用户中奖记录列表
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param module_id：活动模块标识
+        :param user_id：用户标识
+        :param open_id：open_id
+        :param nick_name：用户昵称
+        :param order_no：订单号
+        :param goods_type：物品类型（1虚拟2实物）
+        :param prize_type：奖品类型(1现货2优惠券3红包4参与奖5预售)
+        :param logistics_status：物流状态（0未发货1已发货2不予发货）
+        :param prize_status：奖品状态（0未下单（未领取）1已下单（已领取）2已回购10已隐藏（删除）11无需发货）
+        :param pay_status：支付状态(0未支付1已支付2已退款3处理中)
+        :param page_size：页大小
+        :param page_index：页索引
+        :param create_date_start：开始时间
+        :param create_date_end：结束时间
+        :return 
+        :last_editors: HuangJianYi
+        """
+        app_id =self.get_app_id()
+        act_id = self.get_act_id()
+        module_id = int(self.get_param("module_id", 0))
+        order_no = self.get_param("order_no")
+        user_id = self.get_user_id()
+        user_nick = self.get_param("nick_name")
+        user_open_id = self.get_param("user_open_id")
+        goods_type = int(self.get_param("goods_type", -1))
+        prize_type = int(self.get_param("prize_type", -1))
+        logistics_status = int(self.get_param("logistics_status", -1))
+        prize_status = int(self.get_param("prize_status", -1))
+        pay_status = int(self.get_param("pay_status", -1))
+        create_date_start = self.get_param("create_date_start")
+        create_date_end = self.get_param("create_date_end")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "中奖记录列表"
+
+        order_base_model = OrderBaseModel(context=self)
+        prize_roster_list_dict = []
+        if page_size <= 500:
+            prize_roster_list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, page_size, page_index, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_prize_roster_list(app_id, act_id, module_id, user_id, user_open_id, user_nick, order_no, goods_type, prize_type, logistics_status, prize_status, pay_status, max_page_size, begin_page_index + i, create_date_start, create_date_end, order_by=order_by, field=field, condition=condition, params=params, is_cache=False, page_count_mode='none')
+                if len(list_dict) <= 0:
+                    break
+                prize_roster_list_dict.extend(list_dict)
+        ref_params = {}
+        result_data = self.business_process_executed(prize_roster_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="prize_roster_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        for prize_roster_dict in result_data:
+            data_row = {}
+            data_row["行为编号"] = prize_roster_dict["id"]
+            data_row["小程序订单号"] = prize_roster_dict["order_no"]
+            data_row["淘宝子订单号"] = prize_roster_dict["sub_pay_order_no"]
+            data_row["淘宝名"] = prize_roster_dict["user_nick"]
+            data_row["openid"] = prize_roster_dict["open_id"]
+            data_row["模块名称"] = prize_roster_dict["module_name"]
+            data_row["奖品名称"] = prize_roster_dict["prize_name"]
+            data_row["奖品价值"] = str(prize_roster_dict["prize_price"])
+            data_row["奖品规格"] = prize_roster_dict["sku_name"]
+            data_row["商家编码"] = prize_roster_dict["goods_code"]
+            data_row["获得时间"] = prize_roster_dict["create_date"]
+            if prize_roster_dict["order_no"] == "":
+                data_row["状态"] = "未下单"
+            else:
+                data_row["状态"] = "已下单"
+            result_list.append(data_row)
+        return result_list
+
+
+class TaoPayOrderExportHandler(ClientBaseHandler):
+    """
+    :description: 淘宝支付订单批量导出
+    """
+    def get_async(self):
+        """
+        :description: 淘宝支付订单批量导出
+        :param app_id：应用标识
+        :param act_id：活动标识
+        :param user_code：用户标识
+        :param user_open_id：open_id
+        :param nick_name：用户昵称
+        :param pay_date_start：订单支付时间开始
+        :param pay_date_end：订单支付时间结束
+        :param main_pay_order_no：淘宝主订单号
+        :param sub_pay_order_no：淘宝子订单号
+        :param page_size：页大小
+        :param page_index：页索引
+        :return: 
+        :last_editors: HuangJianYi
+        """
+        app_id = self.get_app_id()
+        act_id = self.get_act_id()
+        user_id = self.get_user_id()
+        user_open_id = self.get_param("user_open_id")
+        user_nick = self.get_param("nick_name")
+        pay_date_start = self.get_param("pay_date_start")
+        pay_date_end = self.get_param("pay_date_end")
+        main_pay_order_no = self.get_param("main_pay_order_no")
+        sub_pay_order_no = self.get_param("sub_pay_order_no")
+        page_index = int(self.get_param("page_index", 0))
+        page_size = int(self.get_param("page_size", 500))
+
+        invoke_result_data = self.business_process_executing()
+        if invoke_result_data.success == False:
+            return self.response_json_success("")
+        if not invoke_result_data.data:
+            invoke_result_data.data = {}
+        condition = invoke_result_data.data["condition"] if invoke_result_data.data.__contains__("condition") else ""
+        params = invoke_result_data.data["params"] if invoke_result_data.data.__contains__("params") else []
+        order_by = invoke_result_data.data["order_by"] if invoke_result_data.data.__contains__("order_by") else "create_date desc"
+        field = invoke_result_data.data["field"] if invoke_result_data.data.__contains__("field") else "*"
+        operate_title = invoke_result_data.data["operate_title"] if invoke_result_data.data.__contains__("operate_title") else "支付订单列表"
+
+        if main_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "main_pay_order_no=%s"
+            params.append(main_pay_order_no)
+        if sub_pay_order_no:
+            condition += " and " if condition else ""
+            condition += "sub_pay_order_no=%s"
+            params.append(sub_pay_order_no)
+
+        order_base_model = OrderBaseModel(context=self)
+        tao_pay_order_list_dict = []
+        if page_size <= 500:
+            tao_pay_order_list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, page_size, page_index, field=field, order_by=order_by, condition=condition, params=params).data
+        else:
+            max_page_size = 500
+            repeat_count = page_size // max_page_size  # 循环次数
+            begin_page_index = page_index * repeat_count  # 开始页码
+            for i in range(repeat_count):
+                list_dict = order_base_model.get_tao_pay_order_list(app_id, act_id, user_id, user_open_id, user_nick, pay_date_start, pay_date_end, max_page_size, begin_page_index + i, field=field, order_by=order_by, condition=condition, params=params).data
+                if len(list_dict) <= 0:
+                    break
+                tao_pay_order_list_dict.extend(list_dict)
+
+        ref_params = {}
+        result_data = self.business_process_executed(tao_pay_order_list_dict, ref_params)
+        resource_path = OSS2Helper.export_excel(result_data)
+        self.create_operation_log(operation_type=OperationType.export.value, model_name="tao_pay_order_tb", title=operate_title)
+        return self.response_json_success(resource_path)
+
+    def business_process_executed(self, result_data, ref_params):
+        """
+        :description: 执行后事件
+        :param result_data:result_data
+        :param ref_params: 关联参数
+        :return:
+        :last_editors: HuangJianYi
+        """
+        result_list = []
+        for tao_pay_order_dict in result_data:
+            data_row = {}
+            data_row["淘宝主订单号"] = tao_pay_order_dict["main_pay_order_no"]
+            data_row["淘宝子订单号"] = tao_pay_order_dict["sub_pay_order_no"]
+            data_row["淘宝名"] = tao_pay_order_dict["user_nick"]
+            data_row["openid"] = tao_pay_order_dict["open_id"]
+            data_row["商家编码"] = tao_pay_order_dict["goods_code"]
+            data_row["商品名称"] = tao_pay_order_dict["goods_name"]
+            data_row["购买数量"] = tao_pay_order_dict["buy_num"]
+            data_row["支付金额"] = tao_pay_order_dict["pay_price"]
+            data_row["支付时间"] = TimeHelper.datetime_to_format_time(tao_pay_order_dict["pay_date"])
+            result_list.append(data_row)
+        return result_list
```

### Comparing `seven_cloudapp_frame-1.0.9.9/seven_cloudapp_frame/route.py` & `seven_cloudapp_frame-1.0.90/seven_cloudapp_frame/route.py`

 * *Files 14% similar despite different names*

```diff
@@ -1,148 +1,174 @@
-﻿# -*- coding: utf-8 -*-
-"""
-:Author: HuangJianYi
-:Date: 2020-04-16 14:38:22
-@LastEditTime: 2021-10-15 15:44:31
-@LastEditors: HuangJianYi
-:Description: 基础路由   业务方可以直接使用语句 handlers.extend(seven_cloudapp_frame.route.seven_cloudapp_frame_route()) 引入
-"""
-# 框架引用
-from seven_framework.web_tornado.monitor import MonitorHandler
-from seven_cloudapp_frame.handlers.core import *
-from seven_cloudapp_frame.handlers.server import *
-from seven_cloudapp_frame.handlers.client import *
-
-
-def seven_cloudapp_frame_route():
-    return [
-        (r"/monitor", MonitorHandler),
-        (r"/", IndexHandler),
-        #客户端
-        (r"/client/address_list", address.AddressInfoListHandler),  #收货地址列表
-        (r"/client/login", user.LoginHandler),  #小程序登录
-        (r"/client/update_user_info", user.UpdateUserInfoHandler),  #更新用户信息如昵称、头像等
-        (r"/client/check_is_member", user.CheckIsMemberHandler),  #校验是否是店铺会员
-        (r"/client/apply_black_unbind", user.ApplyBlackUnbindHandler),  #申请黑名单解封
-        (r"/client/user_asset_list", user.UserAssetListHandler),  #用户资产列表
-        (r"/client/asset_log_list", user.AssetLogListHandler),  #用户资产流水列表
-        (r"/client/get_join_member_url", user.GetJoinMemberUrlHandler),  #加入会员地址
-        (r"/client/get_coupon_prize", user.GetCouponPrizeHandler),  #领取淘宝优惠券
-        (r"/client/theme_info", theme.ThemeInfoHandler),  #主题信息
-        (r"/client/save_theme", theme.SaveThemeHandler),  #保存主题信息，由前端通过工具进行保存
-        (r"/client/save_skin", theme.SaveSkinHandler),  #保存皮肤信息，由前端通过工具进行保存
-        (r"/client/theme_info_list", theme.ThemeInfoListHandler),  #主题列表
-        (r"/client/skin_info_list", theme.SkinInfoListHandler),  #皮肤列表
-        (r"/client/ip_info_list", ip.IpInfoListHandler),  #ip信息列表
-        (r"/client/act_info", act.ActInfoHandler),  #活动信息
-        (r"/client/act_prize_list", act.ActPrizeListHandler),  #活动奖品列表
-        (r"/client/app_expire", app.AppExpireHandler),  #小程序过期时间
-        (r"/client/sku_info", goods.SkuInfoHandler),  #sku信息
-        (r"/client/goods_list", goods.GoodsListHandler),  #商品列表
-        (r"/client/horseracelamp_list", order.HorseracelampListHandler),  #中奖记录跑马灯列表
-        (r"/client/prize_order_list", order.PrizeOrderListHandler),  #用户订单列表
-        (r"/client/create_prize_order", order.SelectPrizeOrderHandler),  #选择中奖记录进行下单
-        (r"/client/submit_sku", order.SubmitSkuHandler),  #中奖记录选择sku
-        (r"/client/prize_roster_list", order.PrizeRosterListHandler),  #中奖记录列表
-        (r"/client/sync_pay_order", order.SyncPayOrderHandler),  #同步淘宝支付订单给用户加资产
-        (r"/client/task_info_list", task.TaskInfoListHandler),  #任务列表
-        (r"/client/receive_reward", task.ReceiveRewardHandler),  #统一领取任务奖励
-        (r"/client/free_gift", task.FreeGiftHandler),  #免费领取、新人有礼等任务
-        (r"/client/one_sign", task.OneSignHandler),  #单次签到任务
-        (r"/client/weekly_sign", task.WeeklySignHandler),  #每周签到任务
-        (r"/client/cumulative_sign", task.CumulativeSignHandler),  #累计签到任务
-        (r"/client/invite_new_user", task.InviteNewUserHandler),  #邀请新用户任务
-        (r"/client/invite_join_member", task.InviteJoinMemberHandler),  #邀请加入会员任务
-        (r"/client/browse_site", task.BrowseSiteHandler),  #处理浏览网址相关任务 如：浏览店铺、浏览直播间、浏览会场/专题
-        (r"/client/collect_goods", task.CollectGoodsHandler),  #收藏商品任务
-        (r"/client/browse_goods", task.BrowseGoodsHandler),  #浏览商品任务
-        (r"/client/favor_store", task.FavorStoreHandler),  #关注店铺任务
-        (r"/client/join_member", task.JoinMemberHandler),  #加入会员任务
-        (r"/client/share_report", stat.ShareReportHandler),  #分享统计上报
-        (r"/client/invite_report", stat.InviteReportHandler),  #邀请进入统计上报
-        (r"/client/wvoucher_order", pay.WechatVoucherOrderHandler),  #创建微信预订单
-        (r"/client/wpay_notify", pay.WechatPayNotifyHandler),  #微信支付异步通知
-        (r"/client/wrefund_notify", pay.WechatRefundNotifyHandler),  #微信退款异步通知
-        (r"/client/tvoucher_order", pay.TiktokVoucherOrderHandler),  #创建抖音预订单
-        (r"/client/tpay_notify", pay.TiktokPayNotifyHandler),  #抖音支付异步通知
-        (r"/client/trefund_notify", pay.TiktokRefundNotifyHandler),  #抖音退款异步通知
-
-        #后台和千牛端
-        (r"/server/saas_custom", base_s.SaasCustomHandler),  #saas定制化信息获取
-        (r"/server/login", user_s.LoginHandler),  #千牛端登录
-        (r"/server/left_navigation", base_s.LeftNavigationHandler),  #左侧导航
-        (r"/server/right_navigation", base_s.RightExplainHandler),  #右侧各种教程和说明导航
-        (r"/server/friend_link_list", base_s.FriendLinkListHandler),  #获取友情链接列表
-        (r"/server/send_sms", base_s.SendSmsHandler),  #发短信
-        (r"/server/app_info", app_s.AppInfoHandler),  #应用信息
-        (r"/server/get_app_id", app_s.GetAppIDHandler),  #根据店铺名称返回应用标识 用于GM工具
-        (r"/server/instantiate", app_s.InstantiateAppHandler),  #实例化小程序
-        (r"/server/version_upgrade", app_s.VersionUpgradeHandler),  #小程序端版本升级
-        (r"/server/update_telephone", app_s.UpdateTelephoneHandler),  #更新手机号
-        (r"/server/act_type_list", act_s.ActTypeListHandler),  #活动类型列表
-        (r"/server/next_progress", act_s.NextProgressHandler),  #活动下一步操作
-        (r"/server/add_act_info", act_s.AddActInfoHandler),  #添加活动
-        (r"/server/update_act_info", act_s.UpdateActInfoHandler),  #修改活动
-        (r"/server/act_info_list", act_s.ActInfoListHandler),  #活动列表
-        (r"/server/act_info", act_s.ActInfoHandler),  #单条活动信息
-        (r"/server/delete_act_info", act_s.DeleteActInfoHandler),  #删除活动（假删除）
-        (r"/server/review_act_info", act_s.ReviewActInfoHandler),  #还原活动
-        (r"/server/release_act_info", act_s.ReleaseActInfoHandler),  #上下架活动
-        (r"/server/create_act_qrcode", act_s.CreateActQrCodeHandler),  #生成小程序二维码
-        (r"/server/save_act_module", module_s.SaveActModuleHandler),  #保存活动模块信息（保存新增和修改）
-        (r"/server/act_module", module_s.ActModuleHandler),  #单条活动模块信息
-        (r"/server/act_module_list", module_s.ActModuleListHandler),  #活动模块列表
-        (r"/server/delete_act_module", module_s.DeleteActModuleHandler),  #删除活动模块（假删除）
-        (r"/server/review_act_module", module_s.ReviewActModuleHandler),  #还原活动模块
-        (r"/server/release_act_module", module_s.ReleaseActModuleHandler),  #上下架活动模块
-        (r"/server/save_act_prize", prize_s.SaveActPrizeHandler),  #保存活动奖品
-        (r"/server/act_prize_list", prize_s.ActPrizeListHandler),  #活动奖品列表
-        (r"/server/delete_act_prize", prize_s.DeleteActPrizeHandler),  #删除活动奖品（假删除）
-        (r"/server/review_act_prize", prize_s.ReviewActPrizeHandler),  #还原活动奖品
-        (r"/server/release_act_prize", prize_s.ReleaseActPrizeHandler),  #上下架活动奖品
-        (r"/server/pay_order_list", order_s.PayOrderListHandler),  #淘宝支付订单列表
-        (r"/server/prize_order_list", order_s.PrizeOrderListHandler),  #奖品订单列表
-        (r"/server/prize_roster_list", order_s.PrizeRosterListHandler),  #用户中奖记录列表
-        (r"/server/prize_order_export", order_s.PrizeOrderExportHandler),  #导出奖品订单列表
-        (r"/server/prize_roster_export", order_s.PrizeRosterExportHandler),  #导出用户中奖记录列表
-        (r"/server/update_prize_order_status", order_s.UpdatePrizeOrderStatusHandler),  #更新奖品订单状态
-        (r"/server/update_prize_order_seller_remark", order_s.UpdatePrizeOrderSellerRemarkHandler),  #更新奖品订单卖家备注
-        (r"/server/import_prize_order", order_s.ImportPrizeOrderHandler),  #导入发货订单
-        (r"/server/stat_report_list", report_s.StatReportListHandler),  #报表数据列表(表格)
-        (r"/server/trend_report_list", report_s.TrendReportListHandler),  #报表数据列表(趋势图)
-        (r"/server/user_info_list", user_s.UserInfoListHandler),  #用户信息列表
-        (r"/server/update_user_status", user_s.UpdateUserStatusHandler),  #更新用户状态（0正常1黑名单）
-        (r"/server/update_user_status_by_black", user_s.UpdateUserStatusByBlackHandler),  #更新用户状态(黑名单管理模式)
-        (r"/server/audit_user_black", user_s.AuditUserBlackHandler),  #审核黑名单状态
-        (r"/server/update_audit_remark", user_s.UpdateAuditRemarkHandler),  #修改审核备注
-        (r"/server/user_black_list", user_s.UserBlackListHandler),  #黑名单列表
-        (r"/server/update_user_asset", user_s.UpdateUserAssetHandler),  #更新用户资产值
-        (r"/server/batch_update_user_asset", user_s.BatchUpdateUserAssetHandler),  #批量更新用户资产值
-        (r"/server/asset_log_list", user_s.AssetLogListHandler),  #资产流水列表
-        (r"/server/init_launch_goods", launch_s.ResetLaunchGoodsHandler),  #重置商品投放 删除已投放的记录并将活动投放状态改为未投放
-        (r"/server/init_launch_goods", launch_s.InitLaunchGoodsHandler),  #初始化投放商品
-        (r"/server/async_launch_goods", launch_s.AsyncLaunchGoodsHandler),  #同步投放商品（小程序投放-商品绑定/解绑）
-        (r"/server/launch_goods_list", launch_s.LaunchGoodsListHandler),  #投放商品列表
-        (r"/server/update_launch_goods_status", launch_s.UpdateLaunchGoodsStatusHandler),  #更新投放商品的状态
-        (r"/server/init_launch_goods_callback", launch_s.InitLaunchGoodsCallBackHandler),  #初始化投放商品回调接口
-        (r"/server/update_theme", theme_s.UpdateThemeHandler),  #更新主题
-        (r"/server/theme_info_list", theme_s.ThemeInfoListHandler),  #主题信息列表
-        (r"/server/skin_info_list", theme_s.SkinInfoListHandler),  #皮肤信息列表
-        (r"/server/save_ip_info", ip_s.SaveIpInfoHandler),  #保存ip信息
-        (r"/server/delete_ip_info", ip_s.DeleteIpInfoHandler),  #删除ip信息
-        (r"/server/ip_info_list", ip_s.IpInfoListHandler),  #ip信息列表
-        (r"/server/release_ip_info", ip_s.ReleaseIpInfoHandler),  #上下架ip信息
-        (r"/server/save_price_gear", price_s.SavePriceGearHandler),  #保存价格档位信息
-        (r"/server/price_gear_list", price_s.PriceGearListHandler),  #价格档位列表
-        (r"/server/delete_price_gear", price_s.DeletePriceGearHandler),  #删除价格档位（假删除）
-        (r"/server/review_price_gear", price_s.ReviewPriceGearHandler),  #还原价格档位
-        (r"/server/check_price_gear", price_s.CheckPriceGearHandler),  #校验价格档位
-        (r"/server/inventory_goods_list", goods_s.InventoryGoodsListHandler),  #仓库中的商品列表
-        (r"/server/goods_list", goods_s.GoodsListHandler),  #在售中的商品列表
-        (r"/server/goods_list_by_goodsids", goods_s.GoodsListByGoodsIDHandler),  #根据商品ID返回在售中商品列表
-        (r"/server/goods_info", goods_s.GoodsInfoHandler),  #商品信息
-        (r"/server/benefit_detail", goods_s.BenefitDetailHandler),  #获取优惠券详情信息
-        (r"/server/task_info_list", task_s.TaskInfoListHandler),  #任务信息列表
-        (r"/server/save_task_info", task_s.SaveTaskInfoHandler),  #保存任务信息
-        (r"/server/special_goods_list", goods_s.SpecialGoodsListHandler),  #专属下单商品列表
-        (r"/server/bind_special_goods", goods_s.BindSpecialGoodsHandler),  #专属下单商品绑定
+﻿# -*- coding: utf-8 -*-
+"""
+:Author: HuangJianYi
+:Date: 2020-04-16 14:38:22
+@LastEditTime: 2023-02-16 17:56:48
+@LastEditors: HuangJianYi
+:Description: 基础路由   业务方可以直接使用语句 handlers.extend(seven_cloudapp_frame.route.seven_cloudapp_frame_route()) 引入
+"""
+# 框架引用
+from seven_framework.web_tornado.monitor import MonitorHandler
+from seven_cloudapp_frame.handlers.core import *
+from seven_cloudapp_frame.handlers.server import *
+from seven_cloudapp_frame.handlers.client import *
+
+
+def seven_cloudapp_frame_route():
+    return [
+        (r"/monitor", MonitorHandler),
+        (r"/", IndexHandler),
+        #客户端
+        (r"/client/address_list", address.AddressInfoListHandler),  #行政区列表
+        (r"/client/login", user.LoginHandler),  #小程序登录
+        (r"/client/update_user_info", user.UpdateUserInfoHandler),  #更新用户信息如昵称、头像等
+        (r"/client/check_is_member", user.CheckIsMemberHandler),  #校验是否是店铺会员
+        (r"/client/apply_black_unbind", user.ApplyBlackUnbindHandler),  #申请黑名单解封
+        (r"/client/get_unbind_apply", user.GetUnbindApplyHandler),  #获取黑名单解封申请记录
+        (r"/client/user_asset_list", user.GetUserAssetHandler),  #获取单条用户资产
+        (r"/client/user_asset_list", user.UserAssetListHandler),  #用户资产列表
+        (r"/client/asset_log_list", user.AssetLogListHandler),  #用户资产流水列表
+        (r"/client/get_join_member_url", user.GetJoinMemberUrlHandler),  #加入会员地址
+        (r"/client/get_coupon_prize", user.GetCouponPrizeHandler),  #领取淘宝优惠券
+        (r"/client/user_address_list", user.UserAddressListHandler),  #收货地址列表
+        (r"/client/save_user_address", user.SaveUserAddressHandler),  #保存收货地址
+        (r"/client/get_crm_integral", user.GetCrmIntegralHandler),  #获取淘宝店铺积分
+        (r"/client/theme_info", theme.ThemeInfoHandler),  #主题信息
+        (r"/client/save_theme", theme.SaveThemeHandler),  #保存主题信息，由前端通过工具进行保存
+        (r"/client/save_skin", theme.SaveSkinHandler),  #保存皮肤信息，由前端通过工具进行保存
+        (r"/client/theme_info_list", theme.ThemeInfoListHandler),  #主题列表
+        (r"/client/skin_info_list", theme.SkinInfoListHandler),  #皮肤列表
+        (r"/client/ip_info_list", ip_c.IpInfoListHandler),  #ip信息列表
+        (r"/client/act_info", act.ActInfoHandler),  #活动信息
+        (r"/client/act_prize_list", act.ActPrizeListHandler),  #活动奖品列表
+        (r"/client/cms_info_list", act.CmsInfoListHandler),  #位置信息列表
+        (r"/client/price_gear_list", act.PriceGearListHandler),  #价格档位列表
+        (r"/client/create_wechat_qrcode", app.CreateWeChatQrCodeHandler),  # 获取微信小程序码 
+        (r"/client/app_expire", app.AppExpireHandler),  #小程序过期时间
+        (r"/client/get_high_power_list", app.GetHighPowerListHandler),  #获取中台配置的高级权限列表
+        (r"/client/add_wechat_subscribe", app.AddWechatSubscribeHandler),  #添加微信订阅次数
+        (r"/client/upload_file", app.UploadFileHandler),  #上传文件
+        (r"/client/sku_info", goods.SkuInfoHandler),  #sku信息
+        (r"/client/goods_list", goods.GoodsListHandler),  #商品列表
+        (r"/client/horseracelamp_list", order.HorseracelampListHandler),  #中奖记录跑马灯列表
+        (r"/client/prize_order_list", order.PrizeOrderListHandler),  #用户订单列表
+        (r"/client/create_prize_order", order.SelectPrizeOrderHandler),  #选择中奖记录进行下单
+        (r"/client/submit_sku", order.SubmitSkuHandler),  #中奖记录选择sku
+        (r"/client/prize_roster_list", order.PrizeRosterListHandler),  #中奖记录列表
+        (r"/client/sync_pay_order", order.SyncPayOrderHandler),  #同步淘宝支付订单给用户加资产
+        (r"/client/task_info_list", task.TaskInfoListHandler),  #任务列表
+        (r"/client/receive_reward", task.ReceiveRewardHandler),  #统一领取任务奖励
+        (r"/client/free_gift", task.FreeGiftHandler),  #免费领取、新人有礼等任务
+        (r"/client/one_sign", task.OneSignHandler),  #单次签到任务
+        (r"/client/weekly_sign", task.WeeklySignHandler),  #每周签到任务
+        (r"/client/cumulative_sign", task.CumulativeSignHandler),  #累计签到任务
+        (r"/client/invite_new_user", task.InviteNewUserHandler),  #邀请新用户任务
+        (r"/client/invite_join_member", task.InviteJoinMemberHandler),  #邀请加入会员任务
+        (r"/client/browse_site", task.BrowseSiteHandler),  #处理浏览网址相关任务 如：浏览店铺、浏览直播间、浏览会场/专题
+        (r"/client/collect_goods", task.CollectGoodsHandler),  #收藏商品任务
+        (r"/client/browse_goods", task.BrowseGoodsHandler),  #浏览商品任务
+        (r"/client/favor_store", task.FavorStoreHandler),  #关注店铺任务
+        (r"/client/join_member", task.JoinMemberHandler),  #加入会员任务
+        (r"/client/task_share", task.ShareHandler),  #分享奖励任务
+        (r"/client/share_report", stat.ShareReportHandler),  #分享统计上报
+        (r"/client/invite_report", stat.InviteReportHandler),  #邀请进入统计上报
+        (r"/client/stat_report", stat.StatReportHandler),  #通用统计上报
+        (r"/client/wvoucher_order", pay.WechatVoucherOrderHandler),  #创建微信预订单
+        (r"/client/wpay_notify", pay.WechatPayNotifyHandler),  #微信支付异步通知
+        (r"/client/wrefund_notify", pay.WechatRefundNotifyHandler),  #微信退款异步通知
+        (r"/client/tvoucher_order", pay.TiktokVoucherOrderHandler),  #创建抖音预订单
+        (r"/client/tpay_notify", pay.TiktokPayNotifyHandler),  #抖音支付异步通知
+        (r"/client/trefund_notify", pay.TiktokRefundNotifyHandler),  #抖音退款异步通知
+
+        #后台和千牛端
+        (r"/server/left_navigation", base_s.LeftNavigationHandler),  #左侧导航
+        (r"/server/friend_link_list", base_s.FriendLinkListHandler),  #获取友情链接产品互推列表
+        (r"/server/send_sms", base_s.SendSmsHandler),  #发短信
+        (r"/server/get_product_price", base_s.GetProductPriceHandler),  #获取产品价格信息
+        (r"/server/get_high_power_list", app_s.GetHighPowerListHandler),  #获取中台配置的高级权限列表
+        (r"/server/app_info", app_s.AppInfoHandler),  #应用信息
+        (r"/server/check_gm_power", app_s.CheckGmPowerHandler),  #根据店铺名称返回应用标识 用于GM工具
+        (r"/server/get_appid_by_gm", app_s.GetAppidByGmHandler),  #获取是否有GM工具权限 用于GM工具
+        (r"/server/instantiate", app_s.InstantiateAppHandler),  #实例化小程序
+        (r"/server/version_upgrade", app_s.VersionUpgradeHandler),  #小程序端版本升级
+        (r"/server/update_telephone", app_s.UpdateTelephoneHandler),  #更新手机号
+        (r"/server/get_short_url", app_s.GetShortUrlHandler),  #淘宝短链接
+        (r"/server/update_store_asset", app_s.UpdateStoreAssetHandler),  #更新商家资产值
+        (r"/server/store_asset_list", app_s.StoreAssetListHandler),  #商家资产列表
+        (r"/server/store_asset_log_list", app_s.StoreAssetLogListHandler),  #商家资产流水列表
+        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
+        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
+        (r"/server/act_type_list", act_s.ActTypeListHandler),  #活动类型列表
+        (r"/server/next_progress", act_s.NextProgressHandler),  #活动下一步操作
+        (r"/server/add_act_info", act_s.AddActInfoHandler),  #添加活动
+        (r"/server/update_act_info", act_s.UpdateActInfoHandler),  #修改活动
+        (r"/server/act_info_list", act_s.ActInfoListHandler),  #活动列表
+        (r"/server/act_info", act_s.ActInfoHandler),  #单条活动信息
+        (r"/server/delete_act_info", act_s.DeleteActInfoHandler),  #删除活动（假删除）
+        (r"/server/review_act_info", act_s.ReviewActInfoHandler),  #还原活动
+        (r"/server/release_act_info", act_s.ReleaseActInfoHandler),  #上下架活动
+        (r"/server/create_act_qrcode", act_s.CreateActQrCodeHandler),  #生成小程序二维码
+        (r"/server/save_act_module", module_s.SaveActModuleHandler),  #保存活动模块信息（保存新增和修改）
+        (r"/server/act_module", module_s.ActModuleHandler),  #单条活动模块信息
+        (r"/server/act_module_list", module_s.ActModuleListHandler),  #活动模块列表
+        (r"/server/delete_act_module", module_s.DeleteActModuleHandler),  #删除活动模块（假删除）
+        (r"/server/review_act_module", module_s.ReviewActModuleHandler),  #还原活动模块
+        (r"/server/release_act_module", module_s.ReleaseActModuleHandler),  #上下架活动模块
+        (r"/server/save_act_prize", prize_s.SaveActPrizeHandler),  #保存活动奖品
+        (r"/server/act_prize_list", prize_s.ActPrizeListHandler),  #活动奖品列表
+        (r"/server/delete_act_prize", prize_s.DeleteActPrizeHandler),  #删除活动奖品（假删除）
+        (r"/server/review_act_prize", prize_s.ReviewActPrizeHandler),  #还原活动奖品
+        (r"/server/release_act_prize", prize_s.ReleaseActPrizeHandler),  #上下架活动奖品
+        (r"/server/act_prize_export", prize_s.ActPrizeExportHandler),  #导出活动奖品列表
+        (r"/server/pay_order_list", order_s.PayOrderListHandler),  #淘宝支付订单列表
+        (r"/server/prize_order_list", order_s.PrizeOrderListHandler),  #奖品订单列表
+        (r"/server/prize_roster_list", order_s.PrizeRosterListHandler),  #用户中奖记录列表
+        (r"/server/prize_order_export", order_s.PrizeOrderExportHandler),  #导出奖品订单列表
+        (r"/server/prize_roster_export", order_s.PrizeRosterExportHandler),  #导出用户中奖记录列表
+        (r"/server/tao_pay_order_export", order_s.TaoPayOrderExportHandler),  #导出淘宝订单列表
+        (r"/server/update_prize_order_status", order_s.UpdatePrizeOrderStatusHandler),  #更新奖品订单状态
+        (r"/server/update_prize_order_seller_remark", order_s.UpdatePrizeOrderSellerRemarkHandler),  #更新奖品订单卖家备注
+        (r"/server/import_prize_order", order_s.ImportPrizeOrderHandler),  #导入发货订单
+        (r"/server/stat_report_list", report_s.StatReportListHandler),  #报表数据列表(表格)
+        (r"/server/trend_report_list", report_s.TrendReportListHandler),  #报表数据列表(趋势图)
+        (r"/server/login", user_s.LoginHandler),  #千牛端登录
+        (r"/server/user_info_list", user_s.UserInfoListHandler),  #用户信息列表
+        (r"/server/update_user_status", user_s.UpdateUserStatusHandler),  #更新用户状态（0正常1黑名单）
+        (r"/server/update_user_status_by_black", user_s.UpdateUserStatusByBlackHandler),  #更新用户状态(黑名单管理模式)
+        (r"/server/audit_user_black", user_s.AuditUserBlackHandler),  #审核黑名单状态
+        (r"/server/update_audit_remark", user_s.UpdateAuditRemarkHandler),  #修改审核备注
+        (r"/server/user_black_list", user_s.UserBlackListHandler),  #黑名单列表
+        (r"/server/update_user_asset", user_s.UpdateUserAssetHandler),  #更新用户资产值
+        (r"/server/batch_update_user_asset", user_s.BatchUpdateUserAssetHandler),  #批量更新用户资产值
+        (r"/server/user_asset_list", user_s.UserAssetListHandler),  #用户资产列表
+        (r"/server/asset_log_list", user_s.AssetLogListHandler),  #资产流水列表
+        (r"/server/init_launch_goods", launch_s.ResetLaunchGoodsHandler),  #重置商品投放 删除已投放的记录并将活动投放状态改为未投放
+        (r"/server/init_launch_goods", launch_s.InitLaunchGoodsHandler),  #初始化投放商品
+        (r"/server/async_launch_goods", launch_s.AsyncLaunchGoodsHandler),  #同步投放商品（小程序投放-商品绑定/解绑）
+        (r"/server/launch_goods_list", launch_s.LaunchGoodsListHandler),  #投放商品列表
+        (r"/server/update_launch_goods_status", launch_s.UpdateLaunchGoodsStatusHandler),  #更新投放商品的状态
+        (r"/server/init_launch_goods_callback", launch_s.InitLaunchGoodsCallBackHandler),  #初始化投放商品回调接口
+        (r"/server/update_theme", theme_s.UpdateThemeHandler),  #更新主题
+        (r"/server/theme_info_list", theme_s.ThemeInfoListHandler),  #主题信息列表
+        (r"/server/skin_info_list", theme_s.SkinInfoListHandler),  #皮肤信息列表
+        (r"/server/save_ip_type", ip_s.SaveIpTypeHandler),  #保存ip类型
+        (r"/server/ip_type_list", ip_s.IpTypeListHandler),  #ip类型列表
+        (r"/server/release_ip_type", ip_s.ReleaseIpTypeHandler),  #上下架ip类型
+        (r"/server/save_ip_info", ip_s.SaveIpInfoHandler),  #保存ip信息
+        (r"/server/delete_ip_info", ip_s.DeleteIpInfoHandler),  #删除ip信息
+        (r"/server/ip_info_list", ip_s.IpInfoListHandler),  #ip信息列表
+        (r"/server/release_ip_info", ip_s.ReleaseIpInfoHandler),  #上下架ip信息
+        (r"/server/save_price_gear", price_s.SavePriceGearHandler),  #保存价格档位信息
+        (r"/server/price_gear_list", price_s.PriceGearListHandler),  #价格档位列表
+        (r"/server/delete_price_gear", price_s.DeletePriceGearHandler),  #删除价格档位（假删除）
+        (r"/server/review_price_gear", price_s.ReviewPriceGearHandler),  #还原价格档位
+        (r"/server/check_price_gear", price_s.CheckPriceGearHandler),  #校验价格档位
+        (r"/server/inventory_goods_list", goods_s.InventoryGoodsListHandler),  #仓库中的商品列表
+        (r"/server/goods_list", goods_s.GoodsListHandler),  #在售中的商品列表
+        (r"/server/goods_list_by_goodsids", goods_s.GoodsListByGoodsIDHandler),  #根据商品ID返回在售中商品列表
+        (r"/server/goods_info", goods_s.GoodsInfoHandler),  #商品信息
+        (r"/server/benefit_detail", goods_s.BenefitDetailHandler),  #获取优惠券详情信息
+        (r"/server/special_goods_list", goods_s.SpecialGoodsListHandler),  #专属下单商品列表
+        (r"/server/bind_special_goods", goods_s.BindSpecialGoodsHandler),  #专属下单商品绑定
+        (r"/server/cms_info_list", cms_s.CmsInfoListHandler),  #获取资讯列表
+        (r"/server/save_cms_info", cms_s.SaveCmsInfoHandler),  #保存资讯信息
     ]
```

