# Comparing `tmp/mlrun-1.4.0rc9-py3-none-any.whl.zip` & `tmp/mlrun-1.5.0rc1-py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,412 +1,449 @@
-Zip file size: 1195619 bytes, number of entries: 410
--rw-r--r--  2.0 unx     8727 b- defN 23-Jun-01 16:11 mlrun/__init__.py
--rw-r--r--  2.0 unx    49342 b- defN 23-Jun-01 16:11 mlrun/__main__.py
--rw-r--r--  2.0 unx    55437 b- defN 23-Jun-01 16:11 mlrun/config.py
--rw-r--r--  2.0 unx     6780 b- defN 23-Jun-01 16:11 mlrun/errors.py
--rw-r--r--  2.0 unx    39296 b- defN 23-Jun-01 16:11 mlrun/execution.py
--rw-r--r--  2.0 unx    15624 b- defN 23-Jun-01 16:11 mlrun/features.py
--rw-r--r--  2.0 unx     4876 b- defN 23-Jun-01 16:11 mlrun/k8s_utils.py
--rw-r--r--  2.0 unx    29646 b- defN 23-Jun-01 16:11 mlrun/kfpops.py
--rw-r--r--  2.0 unx     8360 b- defN 23-Jun-01 16:11 mlrun/lists.py
--rw-r--r--  2.0 unx    58708 b- defN 23-Jun-01 16:11 mlrun/model.py
--rw-r--r--  2.0 unx    11828 b- defN 23-Jun-01 16:11 mlrun/render.py
--rw-r--r--  2.0 unx    64686 b- defN 23-Jun-01 16:11 mlrun/run.py
--rw-r--r--  2.0 unx     7783 b- defN 23-Jun-01 16:11 mlrun/secrets.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/__init__.py
--rw-r--r--  2.0 unx     2105 b- defN 23-Jun-01 16:11 mlrun/api/alembic.ini
--rw-r--r--  2.0 unx      685 b- defN 23-Jun-01 16:11 mlrun/api/constants.py
--rw-r--r--  2.0 unx    25653 b- defN 23-Jun-01 16:11 mlrun/api/initial_data.py
--rw-r--r--  2.0 unx     7573 b- defN 23-Jun-01 16:11 mlrun/api/launcher.py
--rw-r--r--  2.0 unx    26457 b- defN 23-Jun-01 16:11 mlrun/api/main.py
--rw-r--r--  2.0 unx     5247 b- defN 23-Jun-01 16:11 mlrun/api/middlewares.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/api/__init__.py
--rw-r--r--  2.0 unx     4243 b- defN 23-Jun-01 16:11 mlrun/api/api/api.py
--rw-r--r--  2.0 unx     3197 b- defN 23-Jun-01 16:11 mlrun/api/api/deps.py
--rw-r--r--  2.0 unx    37347 b- defN 23-Jun-01 16:11 mlrun/api/api/utils.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/__init__.py
--rw-r--r--  2.0 unx    10452 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/artifacts.py
--rw-r--r--  2.0 unx     1199 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/auth.py
--rw-r--r--  2.0 unx     3618 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/background_tasks.py
--rw-r--r--  2.0 unx     1214 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/client_spec.py
--rw-r--r--  2.0 unx     1175 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/clusterization_spec.py
--rw-r--r--  2.0 unx    29192 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/feature_store.py
--rw-r--r--  2.0 unx     6104 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/files.py
--rw-r--r--  2.0 unx     5896 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/frontend_spec.py
--rw-r--r--  2.0 unx    36777 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/functions.py
--rw-r--r--  2.0 unx     5935 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/grafana_proxy.py
--rw-r--r--  2.0 unx     1344 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/healthz.py
--rw-r--r--  2.0 unx    10312 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/hub.py
--rw-r--r--  2.0 unx     2445 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/logs.py
--rw-r--r--  2.0 unx    15651 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/model_endpoints.py
--rw-r--r--  2.0 unx     3756 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/operations.py
--rw-r--r--  2.0 unx     9165 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/pipelines.py
--rw-r--r--  2.0 unx    11494 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/projects.py
--rw-r--r--  2.0 unx     9078 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/runs.py
--rw-r--r--  2.0 unx     9035 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/runtime_resources.py
--rw-r--r--  2.0 unx    10554 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/schedules.py
--rw-r--r--  2.0 unx     6061 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/secrets.py
--rw-r--r--  2.0 unx     5298 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/submit.py
--rw-r--r--  2.0 unx     4849 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/tags.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/internal/__init__.py
--rw-r--r--  2.0 unx     1043 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/internal/config.py
--rw-r--r--  2.0 unx     1718 b- defN 23-Jun-01 16:11 mlrun/api/api/endpoints/internal/memory_reports.py
--rw-r--r--  2.0 unx     1209 b- defN 23-Jun-01 16:11 mlrun/api/crud/__init__.py
--rw-r--r--  2.0 unx     5610 b- defN 23-Jun-01 16:11 mlrun/api/crud/artifacts.py
--rw-r--r--  2.0 unx     7331 b- defN 23-Jun-01 16:11 mlrun/api/crud/client_spec.py
--rw-r--r--  2.0 unx     1055 b- defN 23-Jun-01 16:11 mlrun/api/crud/clusterization_spec.py
--rw-r--r--  2.0 unx    18628 b- defN 23-Jun-01 16:11 mlrun/api/crud/feature_store.py
--rw-r--r--  2.0 unx     3556 b- defN 23-Jun-01 16:11 mlrun/api/crud/functions.py
--rw-r--r--  2.0 unx    12025 b- defN 23-Jun-01 16:11 mlrun/api/crud/hub.py
--rw-r--r--  2.0 unx     9409 b- defN 23-Jun-01 16:11 mlrun/api/crud/logs.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Jun-01 16:11 mlrun/api/crud/notifications.py
--rw-r--r--  2.0 unx    14090 b- defN 23-Jun-01 16:11 mlrun/api/crud/pipelines.py
--rw-r--r--  2.0 unx    14269 b- defN 23-Jun-01 16:11 mlrun/api/crud/projects.py
--rw-r--r--  2.0 unx     5963 b- defN 23-Jun-01 16:11 mlrun/api/crud/runs.py
--rw-r--r--  2.0 unx     5575 b- defN 23-Jun-01 16:11 mlrun/api/crud/runtime_resources.py
--rw-r--r--  2.0 unx    20145 b- defN 23-Jun-01 16:11 mlrun/api/crud/secrets.py
--rw-r--r--  2.0 unx     3277 b- defN 23-Jun-01 16:11 mlrun/api/crud/tags.py
--rw-r--r--  2.0 unx      722 b- defN 23-Jun-01 16:11 mlrun/api/crud/model_monitoring/__init__.py
--rw-r--r--  2.0 unx    15692 b- defN 23-Jun-01 16:11 mlrun/api/crud/model_monitoring/grafana.py
--rw-r--r--  2.0 unx    43000 b- defN 23-Jun-01 16:11 mlrun/api/crud/model_monitoring/model_endpoints.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/crud/runtimes/__init__.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/crud/runtimes/nuclio/__init__.py
--rw-r--r--  2.0 unx    18551 b- defN 23-Jun-01 16:11 mlrun/api/crud/runtimes/nuclio/function.py
--rw-r--r--  2.0 unx    11398 b- defN 23-Jun-01 16:11 mlrun/api/crud/runtimes/nuclio/helpers.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/db/__init__.py
--rw-r--r--  2.0 unx    15056 b- defN 23-Jun-01 16:11 mlrun/api/db/base.py
--rw-r--r--  2.0 unx      816 b- defN 23-Jun-01 16:11 mlrun/api/db/init_db.py
--rw-r--r--  2.0 unx      993 b- defN 23-Jun-01 16:11 mlrun/api/db/session.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/__init__.py
--rw-r--r--  2.0 unx   145804 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/db.py
--rw-r--r--  2.0 unx     2340 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/helpers.py
--rw-r--r--  2.0 unx     2542 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/session.py
--rw-r--r--  2.0 unx     1105 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/models/__init__.py
--rw-r--r--  2.0 unx    20909 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/models/models_mysql.py
--rw-r--r--  2.0 unx    18571 b- defN 23-Jun-01 16:11 mlrun/api/db/sqldb/models/models_sqlite.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/env.py
--rw-r--r--  2.0 unx     1203 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
--rw-r--r--  2.0 unx     4614 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
--rw-r--r--  2.0 unx     1936 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
--rw-r--r--  2.0 unx     1909 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1415 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
--rw-r--r--  2.0 unx     1504 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1649 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx    24057 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
--rw-r--r--  2.0 unx     2662 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
--rw-r--r--  2.0 unx     1351 b- defN 23-Jun-01 16:11 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     2906 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/env.py
--rw-r--r--  2.0 unx    11473 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
--rw-r--r--  2.0 unx     1348 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
--rw-r--r--  2.0 unx     5180 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
--rw-r--r--  2.0 unx     2595 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
--rw-r--r--  2.0 unx     1388 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
--rw-r--r--  2.0 unx     1767 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
--rw-r--r--  2.0 unx     1360 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
--rw-r--r--  2.0 unx     1259 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
--rw-r--r--  2.0 unx     2352 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
--rw-r--r--  2.0 unx     1482 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
--rw-r--r--  2.0 unx     1892 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
--rw-r--r--  2.0 unx     1882 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
--rw-r--r--  2.0 unx     1420 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
--rw-r--r--  2.0 unx     2034 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
--rw-r--r--  2.0 unx     1828 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
--rw-r--r--  2.0 unx     1380 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
--rw-r--r--  2.0 unx     1831 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
--rw-r--r--  2.0 unx     3936 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
--rw-r--r--  2.0 unx     2588 b- defN 23-Jun-01 16:11 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
--rw-r--r--  2.0 unx    13338 b- defN 23-Jun-01 16:11 mlrun/api/schemas/__init__.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/__init__.py
--rw-r--r--  2.0 unx     1092 b- defN 23-Jun-01 16:11 mlrun/api/utils/asyncio.py
--rw-r--r--  2.0 unx     7371 b- defN 23-Jun-01 16:11 mlrun/api/utils/background_tasks.py
--rw-r--r--  2.0 unx    25911 b- defN 23-Jun-01 16:11 mlrun/api/utils/builder.py
--rw-r--r--  2.0 unx     2431 b- defN 23-Jun-01 16:11 mlrun/api/utils/helpers.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jun-01 16:11 mlrun/api/utils/memory_reports.py
--rw-r--r--  2.0 unx     2599 b- defN 23-Jun-01 16:11 mlrun/api/utils/periodic.py
--rw-r--r--  2.0 unx    39305 b- defN 23-Jun-01 16:11 mlrun/api/utils/scheduler.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/__init__.py
--rw-r--r--  2.0 unx    12383 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/verifier.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/providers/__init__.py
--rw-r--r--  2.0 unx     1381 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/providers/base.py
--rw-r--r--  2.0 unx     1460 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/providers/nop.py
--rw-r--r--  2.0 unx    10883 b- defN 23-Jun-01 16:11 mlrun/api/utils/auth/providers/opa.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/__init__.py
--rw-r--r--  2.0 unx    13271 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/chief.py
--rw-r--r--  2.0 unx    31249 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/iguazio.py
--rw-r--r--  2.0 unx    12281 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/log_collector.py
--rw-r--r--  2.0 unx     9916 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/nuclio.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/protocols/__init__.py
--rw-r--r--  2.0 unx     2567 b- defN 23-Jun-01 16:11 mlrun/api/utils/clients/protocols/grpc.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/__init__.py
--rw-r--r--  2.0 unx     3305 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/alembic.py
--rw-r--r--  2.0 unx     8214 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/backup.py
--rw-r--r--  2.0 unx     3787 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/mysql.py
--rw-r--r--  2.0 unx      992 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/sql_collation.py
--rw-r--r--  2.0 unx     3861 b- defN 23-Jun-01 16:11 mlrun/api/utils/db/sqlite_migration.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/__init__.py
--rw-r--r--  2.0 unx    17423 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/follower.py
--rw-r--r--  2.0 unx    19372 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/leader.py
--rw-r--r--  2.0 unx     7133 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/member.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/remotes/__init__.py
--rw-r--r--  2.0 unx     2659 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/remotes/follower.py
--rw-r--r--  2.0 unx     2094 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/remotes/leader.py
--rw-r--r--  2.0 unx     5000 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/remotes/nop_follower.py
--rw-r--r--  2.0 unx     3861 b- defN 23-Jun-01 16:11 mlrun/api/utils/projects/remotes/nop_leader.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/__init__.py
--rw-r--r--  2.0 unx     1202 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/db.py
--rw-r--r--  2.0 unx    22651 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/k8s.py
--rw-r--r--  2.0 unx      840 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/logs_dir.py
--rw-r--r--  2.0 unx     1279 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/project_member.py
--rw-r--r--  2.0 unx     1063 b- defN 23-Jun-01 16:11 mlrun/api/utils/singletons/scheduler.py
--rw-r--r--  2.0 unx     1091 b- defN 23-Jun-01 16:11 mlrun/artifacts/__init__.py
--rw-r--r--  2.0 unx    30849 b- defN 23-Jun-01 16:11 mlrun/artifacts/base.py
--rw-r--r--  2.0 unx    20432 b- defN 23-Jun-01 16:11 mlrun/artifacts/dataset.py
--rw-r--r--  2.0 unx    12594 b- defN 23-Jun-01 16:11 mlrun/artifacts/manager.py
--rw-r--r--  2.0 unx    23673 b- defN 23-Jun-01 16:11 mlrun/artifacts/model.py
--rw-r--r--  2.0 unx    15383 b- defN 23-Jun-01 16:11 mlrun/artifacts/plots.py
--rw-r--r--  2.0 unx      571 b- defN 23-Jun-01 16:11 mlrun/common/__init__.py
--rw-r--r--  2.0 unx      660 b- defN 23-Jun-01 16:11 mlrun/common/constants.py
--rw-r--r--  2.0 unx     5670 b- defN 23-Jun-01 16:11 mlrun/common/model_monitoring.py
--rw-r--r--  2.0 unx      790 b- defN 23-Jun-01 16:11 mlrun/common/types.py
--rw-r--r--  2.0 unx     3973 b- defN 23-Jun-01 16:11 mlrun/common/schemas/__init__.py
--rw-r--r--  2.0 unx     1923 b- defN 23-Jun-01 16:11 mlrun/common/schemas/artifact.py
--rw-r--r--  2.0 unx     5251 b- defN 23-Jun-01 16:11 mlrun/common/schemas/auth.py
--rw-r--r--  2.0 unx     1553 b- defN 23-Jun-01 16:11 mlrun/common/schemas/background_task.py
--rw-r--r--  2.0 unx     2751 b- defN 23-Jun-01 16:11 mlrun/common/schemas/client_spec.py
--rw-r--r--  2.0 unx      888 b- defN 23-Jun-01 16:11 mlrun/common/schemas/clusterization_spec.py
--rw-r--r--  2.0 unx     6243 b- defN 23-Jun-01 16:11 mlrun/common/schemas/constants.py
--rw-r--r--  2.0 unx     3671 b- defN 23-Jun-01 16:11 mlrun/common/schemas/feature_store.py
--rw-r--r--  2.0 unx     2546 b- defN 23-Jun-01 16:11 mlrun/common/schemas/frontend_spec.py
--rw-r--r--  2.0 unx     3971 b- defN 23-Jun-01 16:11 mlrun/common/schemas/function.py
--rw-r--r--  2.0 unx      705 b- defN 23-Jun-01 16:11 mlrun/common/schemas/http.py
--rw-r--r--  2.0 unx     4245 b- defN 23-Jun-01 16:11 mlrun/common/schemas/hub.py
--rw-r--r--  2.0 unx     1395 b- defN 23-Jun-01 16:11 mlrun/common/schemas/k8s.py
--rw-r--r--  2.0 unx      920 b- defN 23-Jun-01 16:11 mlrun/common/schemas/memory_reports.py
--rw-r--r--  2.0 unx    12593 b- defN 23-Jun-01 16:11 mlrun/common/schemas/model_endpoints.py
--rw-r--r--  2.0 unx      879 b- defN 23-Jun-01 16:11 mlrun/common/schemas/notification.py
--rw-r--r--  2.0 unx     1907 b- defN 23-Jun-01 16:11 mlrun/common/schemas/object.py
--rw-r--r--  2.0 unx     1184 b- defN 23-Jun-01 16:11 mlrun/common/schemas/pipeline.py
--rw-r--r--  2.0 unx     4094 b- defN 23-Jun-01 16:11 mlrun/common/schemas/project.py
--rw-r--r--  2.0 unx     1636 b- defN 23-Jun-01 16:11 mlrun/common/schemas/runtime_resource.py
--rw-r--r--  2.0 unx     4188 b- defN 23-Jun-01 16:11 mlrun/common/schemas/schedule.py
--rw-r--r--  2.0 unx     1484 b- defN 23-Jun-01 16:11 mlrun/common/schemas/secret.py
--rw-r--r--  2.0 unx      905 b- defN 23-Jun-01 16:11 mlrun/common/schemas/tag.py
--rw-r--r--  2.0 unx     1087 b- defN 23-Jun-01 16:11 mlrun/data_types/__init__.py
--rw-r--r--  2.0 unx     4647 b- defN 23-Jun-01 16:11 mlrun/data_types/data_types.py
--rw-r--r--  2.0 unx     5813 b- defN 23-Jun-01 16:11 mlrun/data_types/infer.py
--rw-r--r--  2.0 unx     9426 b- defN 23-Jun-01 16:11 mlrun/data_types/spark.py
--rw-r--r--  2.0 unx     3443 b- defN 23-Jun-01 16:11 mlrun/datastore/__init__.py
--rw-r--r--  2.0 unx     6946 b- defN 23-Jun-01 16:11 mlrun/datastore/azure_blob.py
--rw-r--r--  2.0 unx    18450 b- defN 23-Jun-01 16:11 mlrun/datastore/base.py
--rw-r--r--  2.0 unx     7995 b- defN 23-Jun-01 16:11 mlrun/datastore/datastore.py
--rw-r--r--  2.0 unx     3791 b- defN 23-Jun-01 16:11 mlrun/datastore/filestore.py
--rw-r--r--  2.0 unx     5114 b- defN 23-Jun-01 16:11 mlrun/datastore/google_cloud_storage.py
--rw-r--r--  2.0 unx     2627 b- defN 23-Jun-01 16:11 mlrun/datastore/inmem.py
--rw-r--r--  2.0 unx     4873 b- defN 23-Jun-01 16:11 mlrun/datastore/redis.py
--rw-r--r--  2.0 unx     7035 b- defN 23-Jun-01 16:11 mlrun/datastore/s3.py
--rw-r--r--  2.0 unx    34376 b- defN 23-Jun-01 16:11 mlrun/datastore/sources.py
--rw-r--r--  2.0 unx     1410 b- defN 23-Jun-01 16:11 mlrun/datastore/spark_udf.py
--rw-r--r--  2.0 unx     6895 b- defN 23-Jun-01 16:11 mlrun/datastore/store_resources.py
--rw-r--r--  2.0 unx    62102 b- defN 23-Jun-01 16:11 mlrun/datastore/targets.py
--rw-r--r--  2.0 unx     2900 b- defN 23-Jun-01 16:11 mlrun/datastore/utils.py
--rw-r--r--  2.0 unx     8097 b- defN 23-Jun-01 16:11 mlrun/datastore/v3io.py
--rw-r--r--  2.0 unx     1343 b- defN 23-Jun-01 16:11 mlrun/datastore/wasbfs/__init__.py
--rw-r--r--  2.0 unx     6152 b- defN 23-Jun-01 16:11 mlrun/datastore/wasbfs/fs.py
--rw-r--r--  2.0 unx     2816 b- defN 23-Jun-01 16:11 mlrun/db/__init__.py
--rw-r--r--  2.0 unx    15968 b- defN 23-Jun-01 16:11 mlrun/db/base.py
--rw-r--r--  2.0 unx   130841 b- defN 23-Jun-01 16:11 mlrun/db/httpdb.py
--rw-r--r--  2.0 unx    13197 b- defN 23-Jun-01 16:11 mlrun/db/nopdb.py
--rw-r--r--  2.0 unx    25577 b- defN 23-Jun-01 16:11 mlrun/db/sqldb.py
--rw-r--r--  2.0 unx     1501 b- defN 23-Jun-01 16:11 mlrun/feature_store/__init__.py
--rw-r--r--  2.0 unx    43719 b- defN 23-Jun-01 16:11 mlrun/feature_store/api.py
--rw-r--r--  2.0 unx    12781 b- defN 23-Jun-01 16:11 mlrun/feature_store/common.py
--rw-r--r--  2.0 unx    47683 b- defN 23-Jun-01 16:11 mlrun/feature_store/feature_set.py
--rw-r--r--  2.0 unx    21940 b- defN 23-Jun-01 16:11 mlrun/feature_store/feature_vector.py
--rw-r--r--  2.0 unx    11681 b- defN 23-Jun-01 16:11 mlrun/feature_store/ingestion.py
--rw-r--r--  2.0 unx    29357 b- defN 23-Jun-01 16:11 mlrun/feature_store/steps.py
--rw-r--r--  2.0 unx     1232 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/__init__.py
--rw-r--r--  2.0 unx    25911 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/base.py
--rw-r--r--  2.0 unx     4261 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/dask_merger.py
--rw-r--r--  2.0 unx     7141 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/job.py
--rw-r--r--  2.0 unx     4765 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/local_merger.py
--rw-r--r--  2.0 unx     3352 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/online.py
--rw-r--r--  2.0 unx     9661 b- defN 23-Jun-01 16:11 mlrun/feature_store/retrieval/spark_merger.py
--rw-r--r--  2.0 unx      743 b- defN 23-Jun-01 16:11 mlrun/frameworks/__init__.py
--rw-r--r--  2.0 unx    11466 b- defN 23-Jun-01 16:11 mlrun/frameworks/parallel_coordinates.py
--rw-r--r--  2.0 unx      962 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/__init__.py
--rw-r--r--  2.0 unx     8515 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/artifacts_library.py
--rw-r--r--  2.0 unx    21018 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/mlrun_interface.py
--rw-r--r--  2.0 unx    55376 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/model_handler.py
--rw-r--r--  2.0 unx     3469 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/plan.py
--rw-r--r--  2.0 unx     5757 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/producer.py
--rw-r--r--  2.0 unx     9209 b- defN 23-Jun-01 16:11 mlrun/frameworks/_common/utils.py
--rw-r--r--  2.0 unx      750 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/__init__.py
--rw-r--r--  2.0 unx     1151 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/model_handler.py
--rw-r--r--  2.0 unx      996 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/utils.py
--rw-r--r--  2.0 unx      787 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/loggers/__init__.py
--rw-r--r--  2.0 unx    11531 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/loggers/logger.py
--rw-r--r--  2.0 unx    14777 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx    28414 b- defN 23-Jun-01 16:11 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
--rw-r--r--  2.0 unx      956 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/__init__.py
--rw-r--r--  2.0 unx     3169 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/artifacts_library.py
--rw-r--r--  2.0 unx    16957 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/model_handler.py
--rw-r--r--  2.0 unx     2368 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/pkl_model_server.py
--rw-r--r--  2.0 unx     4881 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plan.py
--rw-r--r--  2.0 unx     4061 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/producer.py
--rw-r--r--  2.0 unx    10490 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/utils.py
--rw-r--r--  2.0 unx      737 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/loggers/__init__.py
--rw-r--r--  2.0 unx     5684 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/loggers/logger.py
--rw-r--r--  2.0 unx     6453 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
--rw-r--r--  2.0 unx      922 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/__init__.py
--rw-r--r--  2.0 unx     5212 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
--rw-r--r--  2.0 unx     6078 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
--rw-r--r--  2.0 unx     6658 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/dataset_plan.py
--rw-r--r--  2.0 unx     5318 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
--rw-r--r--  2.0 unx     6993 b- defN 23-Jun-01 16:11 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
--rw-r--r--  2.0 unx      706 b- defN 23-Jun-01 16:11 mlrun/frameworks/auto_mlrun/__init__.py
--rw-r--r--  2.0 unx    23796 b- defN 23-Jun-01 16:11 mlrun/frameworks/auto_mlrun/auto_mlrun.py
--rw-r--r--  2.0 unx      721 b- defN 23-Jun-01 16:11 mlrun/frameworks/huggingface/__init__.py
--rw-r--r--  2.0 unx     6083 b- defN 23-Jun-01 16:11 mlrun/frameworks/huggingface/model_server.py
--rw-r--r--  2.0 unx    15883 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/__init__.py
--rw-r--r--  2.0 unx    13891 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/model_handler.py
--rw-r--r--  2.0 unx     9189 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/model_server.py
--rw-r--r--  2.0 unx     8278 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/utils.py
--rw-r--r--  2.0 unx      857 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/callbacks/__init__.py
--rw-r--r--  2.0 unx     4081 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/callbacks/callback.py
--rw-r--r--  2.0 unx     5156 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     4137 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx      842 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
--rw-r--r--  2.0 unx     1624 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
--rw-r--r--  2.0 unx    14256 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
--rw-r--r--  2.0 unx     1333 b- defN 23-Jun-01 16:11 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
--rw-r--r--  2.0 unx      791 b- defN 23-Jun-01 16:11 mlrun/frameworks/onnx/__init__.py
--rw-r--r--  2.0 unx     6098 b- defN 23-Jun-01 16:11 mlrun/frameworks/onnx/dataset.py
--rw-r--r--  2.0 unx     2405 b- defN 23-Jun-01 16:11 mlrun/frameworks/onnx/mlrun_interface.py
--rw-r--r--  2.0 unx     6203 b- defN 23-Jun-01 16:11 mlrun/frameworks/onnx/model_handler.py
--rw-r--r--  2.0 unx     7061 b- defN 23-Jun-01 16:11 mlrun/frameworks/onnx/model_server.py
--rw-r--r--  2.0 unx    22056 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/__init__.py
--rw-r--r--  2.0 unx    27904 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks_handler.py
--rw-r--r--  2.0 unx    44639 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/mlrun_interface.py
--rw-r--r--  2.0 unx    22465 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/model_handler.py
--rw-r--r--  2.0 unx    10136 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/model_server.py
--rw-r--r--  2.0 unx     4515 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/utils.py
--rw-r--r--  2.0 unx      896 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks/__init__.py
--rw-r--r--  2.0 unx    11524 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks/callback.py
--rw-r--r--  2.0 unx    23166 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     9310 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    26661 b- defN 23-Jun-01 16:11 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10892 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/__init__.py
--rw-r--r--  2.0 unx     5852 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/estimator.py
--rw-r--r--  2.0 unx     7117 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/metric.py
--rw-r--r--  2.0 unx    12215 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/metrics_library.py
--rw-r--r--  2.0 unx    14126 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/mlrun_interface.py
--rw-r--r--  2.0 unx     4745 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/model_handler.py
--rw-r--r--  2.0 unx     1209 b- defN 23-Jun-01 16:11 mlrun/frameworks/sklearn/utils.py
--rw-r--r--  2.0 unx    10455 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/__init__.py
--rw-r--r--  2.0 unx    16627 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/mlrun_interface.py
--rw-r--r--  2.0 unx    28247 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/model_handler.py
--rw-r--r--  2.0 unx     9565 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/model_server.py
--rw-r--r--  2.0 unx     4284 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/utils.py
--rw-r--r--  2.0 unx      844 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/callbacks/__init__.py
--rw-r--r--  2.0 unx    21886 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
--rw-r--r--  2.0 unx     8791 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
--rw-r--r--  2.0 unx    28728 b- defN 23-Jun-01 16:11 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
--rw-r--r--  2.0 unx    10287 b- defN 23-Jun-01 16:11 mlrun/frameworks/xgboost/__init__.py
--rw-r--r--  2.0 unx      878 b- defN 23-Jun-01 16:11 mlrun/frameworks/xgboost/mlrun_interface.py
--rw-r--r--  2.0 unx    11617 b- defN 23-Jun-01 16:11 mlrun/frameworks/xgboost/model_handler.py
--rw-r--r--  2.0 unx     1069 b- defN 23-Jun-01 16:11 mlrun/frameworks/xgboost/utils.py
--rw-r--r--  2.0 unx      577 b- defN 23-Jun-01 16:11 mlrun/launcher/__init__.py
--rw-r--r--  2.0 unx    15203 b- defN 23-Jun-01 16:11 mlrun/launcher/base.py
--rw-r--r--  2.0 unx     6163 b- defN 23-Jun-01 16:11 mlrun/launcher/client.py
--rw-r--r--  2.0 unx     1883 b- defN 23-Jun-01 16:11 mlrun/launcher/factory.py
--rw-r--r--  2.0 unx    10568 b- defN 23-Jun-01 16:11 mlrun/launcher/local.py
--rw-r--r--  2.0 unx     6769 b- defN 23-Jun-01 16:11 mlrun/launcher/remote.py
--rw-r--r--  2.0 unx      760 b- defN 23-Jun-01 16:11 mlrun/mlutils/__init__.py
--rw-r--r--  2.0 unx     5325 b- defN 23-Jun-01 16:11 mlrun/mlutils/data.py
--rw-r--r--  2.0 unx     2598 b- defN 23-Jun-01 16:11 mlrun/mlutils/models.py
--rw-r--r--  2.0 unx    30120 b- defN 23-Jun-01 16:11 mlrun/mlutils/plots.py
--rw-r--r--  2.0 unx     1208 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/__init__.py
--rw-r--r--  2.0 unx    23948 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/features_drift_table.py
--rw-r--r--  2.0 unx     9756 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/helpers.py
--rw-r--r--  2.0 unx     5196 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/model_endpoint.py
--rw-r--r--  2.0 unx    36885 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/model_monitoring_batch.py
--rw-r--r--  2.0 unx    43134 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stream_processing_fs.py
--rw-r--r--  2.0 unx     4240 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/__init__.py
--rw-r--r--  2.0 unx    17356 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
--rw-r--r--  2.0 unx     5695 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/model_endpoint_store.py
--rw-r--r--  2.0 unx    15706 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
--rw-r--r--  2.0 unx      884 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/models/__init__.py
--rw-r--r--  2.0 unx      655 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/models/base.py
--rw-r--r--  2.0 unx     3741 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/models/mysql.py
--rw-r--r--  2.0 unx     3658 b- defN 23-Jun-01 16:11 mlrun/model_monitoring/stores/models/sqlite.py
--rw-r--r--  2.0 unx     2400 b- defN 23-Jun-01 16:11 mlrun/platforms/__init__.py
--rw-r--r--  2.0 unx    23997 b- defN 23-Jun-01 16:11 mlrun/platforms/iguazio.py
--rw-r--r--  2.0 unx    11852 b- defN 23-Jun-01 16:11 mlrun/platforms/other.py
--rw-r--r--  2.0 unx     1153 b- defN 23-Jun-01 16:11 mlrun/projects/__init__.py
--rw-r--r--  2.0 unx    17582 b- defN 23-Jun-01 16:11 mlrun/projects/operations.py
--rw-r--r--  2.0 unx    38343 b- defN 23-Jun-01 16:11 mlrun/projects/pipelines.py
--rw-r--r--  2.0 unx   114938 b- defN 23-Jun-01 16:11 mlrun/projects/project.py
--rw-r--r--  2.0 unx     8773 b- defN 23-Jun-01 16:11 mlrun/runtimes/__init__.py
--rw-r--r--  2.0 unx    86181 b- defN 23-Jun-01 16:11 mlrun/runtimes/base.py
--rw-r--r--  2.0 unx     6689 b- defN 23-Jun-01 16:11 mlrun/runtimes/constants.py
--rw-r--r--  2.0 unx    30353 b- defN 23-Jun-01 16:11 mlrun/runtimes/daskjob.py
--rw-r--r--  2.0 unx     9561 b- defN 23-Jun-01 16:11 mlrun/runtimes/funcdoc.py
--rw-r--r--  2.0 unx    45205 b- defN 23-Jun-01 16:11 mlrun/runtimes/function.py
--rw-r--r--  2.0 unx     4911 b- defN 23-Jun-01 16:11 mlrun/runtimes/function_reference.py
--rw-r--r--  2.0 unx     6530 b- defN 23-Jun-01 16:11 mlrun/runtimes/generators.py
--rw-r--r--  2.0 unx    15410 b- defN 23-Jun-01 16:11 mlrun/runtimes/kubejob.py
--rw-r--r--  2.0 unx    19158 b- defN 23-Jun-01 16:11 mlrun/runtimes/local.py
--rw-r--r--  2.0 unx     2885 b- defN 23-Jun-01 16:11 mlrun/runtimes/nuclio.py
--rw-r--r--  2.0 unx    60808 b- defN 23-Jun-01 16:11 mlrun/runtimes/pod.py
--rw-r--r--  2.0 unx     7695 b- defN 23-Jun-01 16:11 mlrun/runtimes/remotesparkjob.py
--rw-r--r--  2.0 unx    29858 b- defN 23-Jun-01 16:11 mlrun/runtimes/serving.py
--rw-r--r--  2.0 unx    21048 b- defN 23-Jun-01 16:11 mlrun/runtimes/utils.py
--rw-r--r--  2.0 unx      790 b- defN 23-Jun-01 16:11 mlrun/runtimes/mpijob/__init__.py
--rw-r--r--  2.0 unx    14713 b- defN 23-Jun-01 16:11 mlrun/runtimes/mpijob/abstract.py
--rw-r--r--  2.0 unx    13845 b- defN 23-Jun-01 16:11 mlrun/runtimes/mpijob/v1.py
--rw-r--r--  2.0 unx     8460 b- defN 23-Jun-01 16:11 mlrun/runtimes/mpijob/v1alpha1.py
--rw-r--r--  2.0 unx      673 b- defN 23-Jun-01 16:11 mlrun/runtimes/package/__init__.py
--rw-r--r--  2.0 unx    27068 b- defN 23-Jun-01 16:11 mlrun/runtimes/package/context_handler.py
--rw-r--r--  2.0 unx      751 b- defN 23-Jun-01 16:11 mlrun/runtimes/sparkjob/__init__.py
--rw-r--r--  2.0 unx    35028 b- defN 23-Jun-01 16:11 mlrun/runtimes/sparkjob/abstract.py
--rw-r--r--  2.0 unx    28746 b- defN 23-Jun-01 16:11 mlrun/runtimes/sparkjob/spark3job.py
--rw-r--r--  2.0 unx     1078 b- defN 23-Jun-01 16:11 mlrun/serving/__init__.py
--rw-r--r--  2.0 unx     6116 b- defN 23-Jun-01 16:11 mlrun/serving/merger.py
--rw-r--r--  2.0 unx    18038 b- defN 23-Jun-01 16:11 mlrun/serving/remote.py
--rw-r--r--  2.0 unx    55277 b- defN 23-Jun-01 16:11 mlrun/serving/routers.py
--rw-r--r--  2.0 unx    20247 b- defN 23-Jun-01 16:11 mlrun/serving/server.py
--rw-r--r--  2.0 unx      836 b- defN 23-Jun-01 16:11 mlrun/serving/serving_wrapper.py
--rw-r--r--  2.0 unx    54169 b- defN 23-Jun-01 16:11 mlrun/serving/states.py
--rw-r--r--  2.0 unx     3902 b- defN 23-Jun-01 16:11 mlrun/serving/utils.py
--rw-r--r--  2.0 unx    11814 b- defN 23-Jun-01 16:11 mlrun/serving/v1_serving.py
--rw-r--r--  2.0 unx    21460 b- defN 23-Jun-01 16:11 mlrun/serving/v2_serving.py
--rw-r--r--  2.0 unx      826 b- defN 23-Jun-01 16:11 mlrun/utils/__init__.py
--rw-r--r--  2.0 unx    10397 b- defN 23-Jun-01 16:11 mlrun/utils/async_http.py
--rw-r--r--  2.0 unx     3456 b- defN 23-Jun-01 16:11 mlrun/utils/azure_vault.py
--rw-r--r--  2.0 unx     6245 b- defN 23-Jun-01 16:11 mlrun/utils/clones.py
--rw-r--r--  2.0 unx     1662 b- defN 23-Jun-01 16:11 mlrun/utils/db.py
--rw-r--r--  2.0 unx    43736 b- defN 23-Jun-01 16:11 mlrun/utils/helpers.py
--rw-r--r--  2.0 unx     7093 b- defN 23-Jun-01 16:11 mlrun/utils/http.py
--rw-r--r--  2.0 unx     7035 b- defN 23-Jun-01 16:11 mlrun/utils/logger.py
--rw-r--r--  2.0 unx    10516 b- defN 23-Jun-01 16:11 mlrun/utils/model_monitoring.py
--rw-r--r--  2.0 unx     3954 b- defN 23-Jun-01 16:11 mlrun/utils/regex.py
--rw-r--r--  2.0 unx      883 b- defN 23-Jun-01 16:11 mlrun/utils/singleton.py
--rw-r--r--  2.0 unx     1319 b- defN 23-Jun-01 16:11 mlrun/utils/v3io_clients.py
--rw-r--r--  2.0 unx    10447 b- defN 23-Jun-01 16:11 mlrun/utils/vault.py
--rw-r--r--  2.0 unx      990 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/__init__.py
--rw-r--r--  2.0 unx    12720 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification_pusher.py
--rw-r--r--  2.0 unx     1803 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/__init__.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/base.py
--rw-r--r--  2.0 unx     1971 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/console.py
--rw-r--r--  2.0 unx     4722 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/git.py
--rw-r--r--  2.0 unx     2021 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/ipython.py
--rw-r--r--  2.0 unx     3751 b- defN 23-Jun-01 16:11 mlrun/utils/notifications/notification/slack.py
--rw-r--r--  2.0 unx      614 b- defN 23-Jun-01 16:11 mlrun/utils/version/__init__.py
--rw-r--r--  2.0 unx       88 b- defN 23-Jun-01 16:12 mlrun/utils/version/version.json
--rw-r--r--  2.0 unx     1970 b- defN 23-Jun-01 16:11 mlrun/utils/version/version.py
--rw-r--r--  2.0 unx    11357 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/LICENSE
--rw-r--r--  2.0 unx    16853 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/METADATA
--rw-r--r--  2.0 unx       92 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/WHEEL
--rw-r--r--  2.0 unx       47 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/entry_points.txt
--rw-r--r--  2.0 unx        6 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/top_level.txt
--rw-rw-r--  2.0 unx    38489 b- defN 23-Jun-01 16:12 mlrun-1.4.0rc9.dist-info/RECORD
-410 files, 4456793 bytes uncompressed, 1134229 bytes compressed:  74.6%
+Zip file size: 1280599 bytes, number of entries: 447
+-rw-r--r--  2.0 unx     8770 b- defN 23-Jul-20 14:54 mlrun/__init__.py
+-rw-r--r--  2.0 unx    49544 b- defN 23-Jul-20 14:54 mlrun/__main__.py
+-rw-r--r--  2.0 unx    56719 b- defN 23-Jul-20 14:54 mlrun/config.py
+-rw-r--r--  2.0 unx     6780 b- defN 23-Jul-20 14:54 mlrun/errors.py
+-rw-r--r--  2.0 unx    39600 b- defN 23-Jul-20 14:54 mlrun/execution.py
+-rw-r--r--  2.0 unx    15624 b- defN 23-Jul-20 14:54 mlrun/features.py
+-rw-r--r--  2.0 unx     4876 b- defN 23-Jul-20 14:54 mlrun/k8s_utils.py
+-rw-r--r--  2.0 unx    29701 b- defN 23-Jul-20 14:54 mlrun/kfpops.py
+-rw-r--r--  2.0 unx     8779 b- defN 23-Jul-20 14:54 mlrun/lists.py
+-rw-r--r--  2.0 unx    60635 b- defN 23-Jul-20 14:54 mlrun/model.py
+-rw-r--r--  2.0 unx    13016 b- defN 23-Jul-20 14:54 mlrun/render.py
+-rw-r--r--  2.0 unx    51474 b- defN 23-Jul-20 14:54 mlrun/run.py
+-rw-r--r--  2.0 unx     7783 b- defN 23-Jul-20 14:54 mlrun/secrets.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/__init__.py
+-rw-r--r--  2.0 unx     2105 b- defN 23-Jul-20 14:54 mlrun/api/alembic.ini
+-rw-r--r--  2.0 unx      685 b- defN 23-Jul-20 14:54 mlrun/api/constants.py
+-rw-r--r--  2.0 unx    25653 b- defN 23-Jul-20 14:54 mlrun/api/initial_data.py
+-rw-r--r--  2.0 unx     8068 b- defN 23-Jul-20 14:54 mlrun/api/launcher.py
+-rw-r--r--  2.0 unx    27304 b- defN 23-Jul-20 14:54 mlrun/api/main.py
+-rw-r--r--  2.0 unx     5289 b- defN 23-Jul-20 14:54 mlrun/api/middlewares.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/api/__init__.py
+-rw-r--r--  2.0 unx     4243 b- defN 23-Jul-20 14:54 mlrun/api/api/api.py
+-rw-r--r--  2.0 unx     3197 b- defN 23-Jul-20 14:54 mlrun/api/api/deps.py
+-rw-r--r--  2.0 unx    40172 b- defN 23-Jul-20 14:54 mlrun/api/api/utils.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/__init__.py
+-rw-r--r--  2.0 unx    10452 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/artifacts.py
+-rw-r--r--  2.0 unx     1199 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/auth.py
+-rw-r--r--  2.0 unx     3618 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/background_tasks.py
+-rw-r--r--  2.0 unx     1214 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/client_spec.py
+-rw-r--r--  2.0 unx     1175 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/clusterization_spec.py
+-rw-r--r--  2.0 unx    29192 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/feature_store.py
+-rw-r--r--  2.0 unx     6370 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/files.py
+-rw-r--r--  2.0 unx     5946 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/frontend_spec.py
+-rw-r--r--  2.0 unx    38107 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/functions.py
+-rw-r--r--  2.0 unx     6086 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/grafana_proxy.py
+-rw-r--r--  2.0 unx     1344 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/healthz.py
+-rw-r--r--  2.0 unx    10312 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/hub.py
+-rw-r--r--  2.0 unx     2445 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/logs.py
+-rw-r--r--  2.0 unx    15734 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/model_endpoints.py
+-rw-r--r--  2.0 unx     3756 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/operations.py
+-rw-r--r--  2.0 unx     9231 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/pipelines.py
+-rw-r--r--  2.0 unx    11494 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/projects.py
+-rw-r--r--  2.0 unx    10372 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/runs.py
+-rw-r--r--  2.0 unx     9035 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/runtime_resources.py
+-rw-r--r--  2.0 unx    12544 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/schedules.py
+-rw-r--r--  2.0 unx     6061 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/secrets.py
+-rw-r--r--  2.0 unx     5327 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/submit.py
+-rw-r--r--  2.0 unx     4849 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/tags.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/__init__.py
+-rw-r--r--  2.0 unx     1043 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/config.py
+-rw-r--r--  2.0 unx     1718 b- defN 23-Jul-20 14:54 mlrun/api/api/endpoints/internal/memory_reports.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-Jul-20 14:54 mlrun/api/crud/__init__.py
+-rw-r--r--  2.0 unx     5610 b- defN 23-Jul-20 14:54 mlrun/api/crud/artifacts.py
+-rw-r--r--  2.0 unx     7378 b- defN 23-Jul-20 14:54 mlrun/api/crud/client_spec.py
+-rw-r--r--  2.0 unx     1055 b- defN 23-Jul-20 14:54 mlrun/api/crud/clusterization_spec.py
+-rw-r--r--  2.0 unx    18971 b- defN 23-Jul-20 14:54 mlrun/api/crud/feature_store.py
+-rw-r--r--  2.0 unx     3556 b- defN 23-Jul-20 14:54 mlrun/api/crud/functions.py
+-rw-r--r--  2.0 unx    12025 b- defN 23-Jul-20 14:54 mlrun/api/crud/hub.py
+-rw-r--r--  2.0 unx     9409 b- defN 23-Jul-20 14:54 mlrun/api/crud/logs.py
+-rw-r--r--  2.0 unx     5498 b- defN 23-Jul-20 14:54 mlrun/api/crud/notifications.py
+-rw-r--r--  2.0 unx    14999 b- defN 23-Jul-20 14:54 mlrun/api/crud/pipelines.py
+-rw-r--r--  2.0 unx    15240 b- defN 23-Jul-20 14:54 mlrun/api/crud/projects.py
+-rw-r--r--  2.0 unx     5963 b- defN 23-Jul-20 14:54 mlrun/api/crud/runs.py
+-rw-r--r--  2.0 unx     5575 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtime_resources.py
+-rw-r--r--  2.0 unx    21560 b- defN 23-Jul-20 14:54 mlrun/api/crud/secrets.py
+-rw-r--r--  2.0 unx     3277 b- defN 23-Jul-20 14:54 mlrun/api/crud/tags.py
+-rw-r--r--  2.0 unx      759 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    19956 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/deployment.py
+-rw-r--r--  2.0 unx    17486 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/grafana.py
+-rw-r--r--  2.0 unx     4613 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx    30723 b- defN 23-Jul-20 14:54 mlrun/api/crud/model_monitoring/model_endpoints.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/__init__.py
+-rw-r--r--  2.0 unx    18762 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/function.py
+-rw-r--r--  2.0 unx    11510 b- defN 23-Jul-20 14:54 mlrun/api/crud/runtimes/nuclio/helpers.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/db/__init__.py
+-rw-r--r--  2.0 unx    15311 b- defN 23-Jul-20 14:54 mlrun/api/db/base.py
+-rw-r--r--  2.0 unx      739 b- defN 23-Jul-20 14:54 mlrun/api/db/init_db.py
+-rw-r--r--  2.0 unx      994 b- defN 23-Jul-20 14:54 mlrun/api/db/session.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/__init__.py
+-rw-r--r--  2.0 unx   148913 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/db.py
+-rw-r--r--  2.0 unx     2340 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/helpers.py
+-rw-r--r--  2.0 unx     1105 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/__init__.py
+-rw-r--r--  2.0 unx    21345 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/models_mysql.py
+-rw-r--r--  2.0 unx    19014 b- defN 23-Jul-20 14:54 mlrun/api/db/sqldb/models/models_sqlite.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/env.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py
+-rw-r--r--  2.0 unx     4614 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py
+-rw-r--r--  2.0 unx     1936 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py
+-rw-r--r--  2.0 unx     1909 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1415 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py
+-rw-r--r--  2.0 unx     1504 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1649 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx    24057 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py
+-rw-r--r--  2.0 unx     2662 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py
+-rw-r--r--  2.0 unx     1351 b- defN 23-Jul-20 14:54 mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     2906 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/env.py
+-rw-r--r--  2.0 unx    11473 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py
+-rw-r--r--  2.0 unx     1348 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py
+-rw-r--r--  2.0 unx     5180 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py
+-rw-r--r--  2.0 unx     2595 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py
+-rw-r--r--  2.0 unx     1388 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py
+-rw-r--r--  2.0 unx     1767 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py
+-rw-r--r--  2.0 unx     1360 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py
+-rw-r--r--  2.0 unx     1259 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py
+-rw-r--r--  2.0 unx     2352 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py
+-rw-r--r--  2.0 unx     1482 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py
+-rw-r--r--  2.0 unx     1892 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py
+-rw-r--r--  2.0 unx     1882 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py
+-rw-r--r--  2.0 unx     1420 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py
+-rw-r--r--  2.0 unx     2034 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py
+-rw-r--r--  2.0 unx     1828 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py
+-rw-r--r--  2.0 unx     1380 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py
+-rw-r--r--  2.0 unx     1831 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py
+-rw-r--r--  2.0 unx     3936 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py
+-rw-r--r--  2.0 unx     2588 b- defN 23-Jul-20 14:54 mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py
+-rw-r--r--  2.0 unx    13571 b- defN 23-Jul-20 14:54 mlrun/api/schemas/__init__.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/__init__.py
+-rw-r--r--  2.0 unx     1092 b- defN 23-Jul-20 14:54 mlrun/api/utils/asyncio.py
+-rw-r--r--  2.0 unx     7371 b- defN 23-Jul-20 14:54 mlrun/api/utils/background_tasks.py
+-rw-r--r--  2.0 unx    26977 b- defN 23-Jul-20 14:54 mlrun/api/utils/builder.py
+-rw-r--r--  2.0 unx     2512 b- defN 23-Jul-20 14:54 mlrun/api/utils/helpers.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-20 14:54 mlrun/api/utils/memory_reports.py
+-rw-r--r--  2.0 unx     2760 b- defN 23-Jul-20 14:54 mlrun/api/utils/periodic.py
+-rw-r--r--  2.0 unx    42624 b- defN 23-Jul-20 14:54 mlrun/api/utils/scheduler.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/__init__.py
+-rw-r--r--  2.0 unx    12383 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/verifier.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/__init__.py
+-rw-r--r--  2.0 unx     1381 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/base.py
+-rw-r--r--  2.0 unx     1460 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/nop.py
+-rw-r--r--  2.0 unx    10883 b- defN 23-Jul-20 14:54 mlrun/api/utils/auth/providers/opa.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/__init__.py
+-rw-r--r--  2.0 unx    13688 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/chief.py
+-rw-r--r--  2.0 unx    32674 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/iguazio.py
+-rw-r--r--  2.0 unx    12281 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/log_collector.py
+-rw-r--r--  2.0 unx     9911 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/nuclio.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/protocols/__init__.py
+-rw-r--r--  2.0 unx     2567 b- defN 23-Jul-20 14:54 mlrun/api/utils/clients/protocols/grpc.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/__init__.py
+-rw-r--r--  2.0 unx     3305 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/alembic.py
+-rw-r--r--  2.0 unx     8214 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/backup.py
+-rw-r--r--  2.0 unx     3787 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/mysql.py
+-rw-r--r--  2.0 unx      992 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/sql_collation.py
+-rw-r--r--  2.0 unx     3861 b- defN 23-Jul-20 14:54 mlrun/api/utils/db/sqlite_migration.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/__init__.py
+-rw-r--r--  2.0 unx     1721 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/base.py
+-rw-r--r--  2.0 unx     1630 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/events_factory.py
+-rw-r--r--  2.0 unx     8798 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/iguazio.py
+-rw-r--r--  2.0 unx     1739 b- defN 23-Jul-20 14:54 mlrun/api/utils/events/nop.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/__init__.py
+-rw-r--r--  2.0 unx    17760 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/follower.py
+-rw-r--r--  2.0 unx    19412 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/leader.py
+-rw-r--r--  2.0 unx     7133 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/member.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/__init__.py
+-rw-r--r--  2.0 unx     2659 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/follower.py
+-rw-r--r--  2.0 unx     2094 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/leader.py
+-rw-r--r--  2.0 unx     4995 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/nop_follower.py
+-rw-r--r--  2.0 unx     3854 b- defN 23-Jul-20 14:54 mlrun/api/utils/projects/remotes/nop_leader.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/runtimes/__init__.py
+-rw-r--r--  2.0 unx     1675 b- defN 23-Jul-20 14:54 mlrun/api/utils/runtimes/nuclio.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/__init__.py
+-rw-r--r--  2.0 unx     1203 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/db.py
+-rw-r--r--  2.0 unx    24570 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/k8s.py
+-rw-r--r--  2.0 unx      840 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/logs_dir.py
+-rw-r--r--  2.0 unx     1312 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/project_member.py
+-rw-r--r--  2.0 unx     1064 b- defN 23-Jul-20 14:54 mlrun/api/utils/singletons/scheduler.py
+-rw-r--r--  2.0 unx     1123 b- defN 23-Jul-20 14:54 mlrun/artifacts/__init__.py
+-rw-r--r--  2.0 unx    31144 b- defN 23-Jul-20 14:54 mlrun/artifacts/base.py
+-rw-r--r--  2.0 unx    20485 b- defN 23-Jul-20 14:54 mlrun/artifacts/dataset.py
+-rw-r--r--  2.0 unx    12594 b- defN 23-Jul-20 14:54 mlrun/artifacts/manager.py
+-rw-r--r--  2.0 unx    24241 b- defN 23-Jul-20 14:54 mlrun/artifacts/model.py
+-rw-r--r--  2.0 unx    15383 b- defN 23-Jul-20 14:54 mlrun/artifacts/plots.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/common/__init__.py
+-rw-r--r--  2.0 unx      660 b- defN 23-Jul-20 14:54 mlrun/common/constants.py
+-rw-r--r--  2.0 unx     1108 b- defN 23-Jul-20 14:54 mlrun/common/helpers.py
+-rw-r--r--  2.0 unx      790 b- defN 23-Jul-20 14:54 mlrun/common/types.py
+-rw-r--r--  2.0 unx      571 b- defN 23-Jul-20 14:54 mlrun/common/db/__init__.py
+-rw-r--r--  2.0 unx     2542 b- defN 23-Jul-20 14:54 mlrun/common/db/sql_session.py
+-rw-r--r--  2.0 unx      721 b- defN 23-Jul-20 14:54 mlrun/common/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx     2312 b- defN 23-Jul-20 14:54 mlrun/common/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx     4384 b- defN 23-Jul-20 14:54 mlrun/common/schemas/__init__.py
+-rw-r--r--  2.0 unx     1923 b- defN 23-Jul-20 14:54 mlrun/common/schemas/artifact.py
+-rw-r--r--  2.0 unx     5490 b- defN 23-Jul-20 14:54 mlrun/common/schemas/auth.py
+-rw-r--r--  2.0 unx     1553 b- defN 23-Jul-20 14:54 mlrun/common/schemas/background_task.py
+-rw-r--r--  2.0 unx     2751 b- defN 23-Jul-20 14:54 mlrun/common/schemas/client_spec.py
+-rw-r--r--  2.0 unx      888 b- defN 23-Jul-20 14:54 mlrun/common/schemas/clusterization_spec.py
+-rw-r--r--  2.0 unx     6243 b- defN 23-Jul-20 14:54 mlrun/common/schemas/constants.py
+-rw-r--r--  2.0 unx     1026 b- defN 23-Jul-20 14:54 mlrun/common/schemas/events.py
+-rw-r--r--  2.0 unx     3723 b- defN 23-Jul-20 14:54 mlrun/common/schemas/feature_store.py
+-rw-r--r--  2.0 unx     2546 b- defN 23-Jul-20 14:54 mlrun/common/schemas/frontend_spec.py
+-rw-r--r--  2.0 unx     4432 b- defN 23-Jul-20 14:54 mlrun/common/schemas/function.py
+-rw-r--r--  2.0 unx      705 b- defN 23-Jul-20 14:54 mlrun/common/schemas/http.py
+-rw-r--r--  2.0 unx     4245 b- defN 23-Jul-20 14:54 mlrun/common/schemas/hub.py
+-rw-r--r--  2.0 unx     1395 b- defN 23-Jul-20 14:54 mlrun/common/schemas/k8s.py
+-rw-r--r--  2.0 unx      920 b- defN 23-Jul-20 14:54 mlrun/common/schemas/memory_reports.py
+-rw-r--r--  2.0 unx     1518 b- defN 23-Jul-20 14:54 mlrun/common/schemas/notification.py
+-rw-r--r--  2.0 unx     1986 b- defN 23-Jul-20 14:54 mlrun/common/schemas/object.py
+-rw-r--r--  2.0 unx     1184 b- defN 23-Jul-20 14:54 mlrun/common/schemas/pipeline.py
+-rw-r--r--  2.0 unx     4177 b- defN 23-Jul-20 14:54 mlrun/common/schemas/project.py
+-rw-r--r--  2.0 unx      776 b- defN 23-Jul-20 14:54 mlrun/common/schemas/regex.py
+-rw-r--r--  2.0 unx     1010 b- defN 23-Jul-20 14:54 mlrun/common/schemas/runs.py
+-rw-r--r--  2.0 unx     1636 b- defN 23-Jul-20 14:54 mlrun/common/schemas/runtime_resource.py
+-rw-r--r--  2.0 unx     4556 b- defN 23-Jul-20 14:54 mlrun/common/schemas/schedule.py
+-rw-r--r--  2.0 unx     1484 b- defN 23-Jul-20 14:54 mlrun/common/schemas/secret.py
+-rw-r--r--  2.0 unx      905 b- defN 23-Jul-20 14:54 mlrun/common/schemas/tag.py
+-rw-r--r--  2.0 unx     1300 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx     5068 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/constants.py
+-rw-r--r--  2.0 unx     1444 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/grafana.py
+-rw-r--r--  2.0 unx    11152 b- defN 23-Jul-20 14:54 mlrun/common/schemas/model_monitoring/model_endpoints.py
+-rw-r--r--  2.0 unx     1087 b- defN 23-Jul-20 14:54 mlrun/data_types/__init__.py
+-rw-r--r--  2.0 unx     4647 b- defN 23-Jul-20 14:54 mlrun/data_types/data_types.py
+-rw-r--r--  2.0 unx     5813 b- defN 23-Jul-20 14:54 mlrun/data_types/infer.py
+-rw-r--r--  2.0 unx     9426 b- defN 23-Jul-20 14:54 mlrun/data_types/spark.py
+-rw-r--r--  2.0 unx     4089 b- defN 23-Jul-20 14:54 mlrun/datastore/__init__.py
+-rw-r--r--  2.0 unx     6946 b- defN 23-Jul-20 14:54 mlrun/datastore/azure_blob.py
+-rw-r--r--  2.0 unx    22471 b- defN 23-Jul-20 14:54 mlrun/datastore/base.py
+-rw-r--r--  2.0 unx     8377 b- defN 23-Jul-20 14:54 mlrun/datastore/datastore.py
+-rw-r--r--  2.0 unx     6302 b- defN 23-Jul-20 14:54 mlrun/datastore/dbfs_store.py
+-rw-r--r--  2.0 unx     3791 b- defN 23-Jul-20 14:54 mlrun/datastore/filestore.py
+-rw-r--r--  2.0 unx     5114 b- defN 23-Jul-20 14:54 mlrun/datastore/google_cloud_storage.py
+-rw-r--r--  2.0 unx      622 b- defN 23-Jul-20 14:54 mlrun/datastore/helpers.py
+-rw-r--r--  2.0 unx     2779 b- defN 23-Jul-20 14:54 mlrun/datastore/inmem.py
+-rw-r--r--  2.0 unx     4873 b- defN 23-Jul-20 14:54 mlrun/datastore/redis.py
+-rw-r--r--  2.0 unx     7035 b- defN 23-Jul-20 14:54 mlrun/datastore/s3.py
+-rw-r--r--  2.0 unx    37671 b- defN 23-Jul-20 14:54 mlrun/datastore/sources.py
+-rw-r--r--  2.0 unx     1498 b- defN 23-Jul-20 14:54 mlrun/datastore/spark_udf.py
+-rw-r--r--  2.0 unx     6906 b- defN 23-Jul-20 14:54 mlrun/datastore/store_resources.py
+-rw-r--r--  2.0 unx    63310 b- defN 23-Jul-20 14:54 mlrun/datastore/targets.py
+-rw-r--r--  2.0 unx     5438 b- defN 23-Jul-20 14:54 mlrun/datastore/utils.py
+-rw-r--r--  2.0 unx     8099 b- defN 23-Jul-20 14:54 mlrun/datastore/v3io.py
+-rw-r--r--  2.0 unx     1343 b- defN 23-Jul-20 14:54 mlrun/datastore/wasbfs/__init__.py
+-rw-r--r--  2.0 unx     6152 b- defN 23-Jul-20 14:54 mlrun/datastore/wasbfs/fs.py
+-rw-r--r--  2.0 unx     2816 b- defN 23-Jul-20 14:54 mlrun/db/__init__.py
+-rw-r--r--  2.0 unx    16194 b- defN 23-Jul-20 14:54 mlrun/db/base.py
+-rw-r--r--  2.0 unx   133910 b- defN 23-Jul-20 14:54 mlrun/db/httpdb.py
+-rw-r--r--  2.0 unx    13209 b- defN 23-Jul-20 14:54 mlrun/db/nopdb.py
+-rw-r--r--  2.0 unx    25590 b- defN 23-Jul-20 14:54 mlrun/db/sqldb.py
+-rw-r--r--  2.0 unx     1501 b- defN 23-Jul-20 14:54 mlrun/feature_store/__init__.py
+-rw-r--r--  2.0 unx    44918 b- defN 23-Jul-20 14:54 mlrun/feature_store/api.py
+-rw-r--r--  2.0 unx    12809 b- defN 23-Jul-20 14:54 mlrun/feature_store/common.py
+-rw-r--r--  2.0 unx    48102 b- defN 23-Jul-20 14:54 mlrun/feature_store/feature_set.py
+-rw-r--r--  2.0 unx    22173 b- defN 23-Jul-20 14:54 mlrun/feature_store/feature_vector.py
+-rw-r--r--  2.0 unx    11681 b- defN 23-Jul-20 14:54 mlrun/feature_store/ingestion.py
+-rw-r--r--  2.0 unx    29357 b- defN 23-Jul-20 14:54 mlrun/feature_store/steps.py
+-rw-r--r--  2.0 unx     1260 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/__init__.py
+-rw-r--r--  2.0 unx    30286 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/base.py
+-rw-r--r--  2.0 unx     4623 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/dask_merger.py
+-rw-r--r--  2.0 unx     7657 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/job.py
+-rw-r--r--  2.0 unx     4252 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/local_merger.py
+-rw-r--r--  2.0 unx     9565 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/spark_merger.py
+-rw-r--r--  2.0 unx     6296 b- defN 23-Jul-20 14:54 mlrun/feature_store/retrieval/storey_merger.py
+-rw-r--r--  2.0 unx      743 b- defN 23-Jul-20 14:54 mlrun/frameworks/__init__.py
+-rw-r--r--  2.0 unx    11466 b- defN 23-Jul-20 14:54 mlrun/frameworks/parallel_coordinates.py
+-rw-r--r--  2.0 unx      962 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/__init__.py
+-rw-r--r--  2.0 unx     8515 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/artifacts_library.py
+-rw-r--r--  2.0 unx    21018 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/mlrun_interface.py
+-rw-r--r--  2.0 unx    55376 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/model_handler.py
+-rw-r--r--  2.0 unx     3469 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/plan.py
+-rw-r--r--  2.0 unx     5757 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/producer.py
+-rw-r--r--  2.0 unx     9209 b- defN 23-Jul-20 14:54 mlrun/frameworks/_common/utils.py
+-rw-r--r--  2.0 unx      750 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/__init__.py
+-rw-r--r--  2.0 unx     1151 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/model_handler.py
+-rw-r--r--  2.0 unx      996 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/utils.py
+-rw-r--r--  2.0 unx      787 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/__init__.py
+-rw-r--r--  2.0 unx    11531 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/logger.py
+-rw-r--r--  2.0 unx    14777 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx    28414 b- defN 23-Jul-20 14:54 mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py
+-rw-r--r--  2.0 unx      956 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/__init__.py
+-rw-r--r--  2.0 unx     3169 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/artifacts_library.py
+-rw-r--r--  2.0 unx    16957 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/model_handler.py
+-rw-r--r--  2.0 unx     2723 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/pkl_model_server.py
+-rw-r--r--  2.0 unx     4881 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plan.py
+-rw-r--r--  2.0 unx     4061 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/producer.py
+-rw-r--r--  2.0 unx    10490 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/utils.py
+-rw-r--r--  2.0 unx      737 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/__init__.py
+-rw-r--r--  2.0 unx     5684 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/logger.py
+-rw-r--r--  2.0 unx     6453 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/loggers/mlrun_logger.py
+-rw-r--r--  2.0 unx      922 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/__init__.py
+-rw-r--r--  2.0 unx     4943 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py
+-rw-r--r--  2.0 unx     6078 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py
+-rw-r--r--  2.0 unx     6658 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/dataset_plan.py
+-rw-r--r--  2.0 unx     5318 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/feature_importance_plan.py
+-rw-r--r--  2.0 unx     6993 b- defN 23-Jul-20 14:54 mlrun/frameworks/_ml_common/plans/roc_curve_plan.py
+-rw-r--r--  2.0 unx      706 b- defN 23-Jul-20 14:54 mlrun/frameworks/auto_mlrun/__init__.py
+-rw-r--r--  2.0 unx    23796 b- defN 23-Jul-20 14:54 mlrun/frameworks/auto_mlrun/auto_mlrun.py
+-rw-r--r--  2.0 unx      721 b- defN 23-Jul-20 14:54 mlrun/frameworks/huggingface/__init__.py
+-rw-r--r--  2.0 unx     6083 b- defN 23-Jul-20 14:54 mlrun/frameworks/huggingface/model_server.py
+-rw-r--r--  2.0 unx    15883 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/__init__.py
+-rw-r--r--  2.0 unx    13891 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/model_handler.py
+-rw-r--r--  2.0 unx     9189 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/model_server.py
+-rw-r--r--  2.0 unx     8278 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/utils.py
+-rw-r--r--  2.0 unx      857 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/__init__.py
+-rw-r--r--  2.0 unx     4081 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/callback.py
+-rw-r--r--  2.0 unx     5156 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     4137 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx      842 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py
+-rw-r--r--  2.0 unx     1624 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py
+-rw-r--r--  2.0 unx    14256 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py
+-rw-r--r--  2.0 unx     1333 b- defN 23-Jul-20 14:54 mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py
+-rw-r--r--  2.0 unx      791 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/__init__.py
+-rw-r--r--  2.0 unx     6098 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/dataset.py
+-rw-r--r--  2.0 unx     2405 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/mlrun_interface.py
+-rw-r--r--  2.0 unx     6203 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/model_handler.py
+-rw-r--r--  2.0 unx     7061 b- defN 23-Jul-20 14:54 mlrun/frameworks/onnx/model_server.py
+-rw-r--r--  2.0 unx    22056 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/__init__.py
+-rw-r--r--  2.0 unx    27904 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks_handler.py
+-rw-r--r--  2.0 unx    44639 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/mlrun_interface.py
+-rw-r--r--  2.0 unx    22465 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/model_handler.py
+-rw-r--r--  2.0 unx    10136 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/model_server.py
+-rw-r--r--  2.0 unx     4515 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/utils.py
+-rw-r--r--  2.0 unx      896 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/__init__.py
+-rw-r--r--  2.0 unx    11524 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/callback.py
+-rw-r--r--  2.0 unx    23166 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     9310 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    26661 b- defN 23-Jul-20 14:54 mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10892 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/__init__.py
+-rw-r--r--  2.0 unx     5852 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/estimator.py
+-rw-r--r--  2.0 unx     7117 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/metric.py
+-rw-r--r--  2.0 unx    12215 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/metrics_library.py
+-rw-r--r--  2.0 unx    14126 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/mlrun_interface.py
+-rw-r--r--  2.0 unx     4745 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/model_handler.py
+-rw-r--r--  2.0 unx     1209 b- defN 23-Jul-20 14:54 mlrun/frameworks/sklearn/utils.py
+-rw-r--r--  2.0 unx    10455 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/__init__.py
+-rw-r--r--  2.0 unx    16627 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/mlrun_interface.py
+-rw-r--r--  2.0 unx    28247 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/model_handler.py
+-rw-r--r--  2.0 unx     9565 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/model_server.py
+-rw-r--r--  2.0 unx     4284 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/utils.py
+-rw-r--r--  2.0 unx      844 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/__init__.py
+-rw-r--r--  2.0 unx    21886 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/logging_callback.py
+-rw-r--r--  2.0 unx     8791 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py
+-rw-r--r--  2.0 unx    28728 b- defN 23-Jul-20 14:54 mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py
+-rw-r--r--  2.0 unx    10287 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/__init__.py
+-rw-r--r--  2.0 unx      878 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/mlrun_interface.py
+-rw-r--r--  2.0 unx    11617 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/model_handler.py
+-rw-r--r--  2.0 unx     1069 b- defN 23-Jul-20 14:54 mlrun/frameworks/xgboost/utils.py
+-rw-r--r--  2.0 unx      577 b- defN 23-Jul-20 14:54 mlrun/launcher/__init__.py
+-rw-r--r--  2.0 unx    15792 b- defN 23-Jul-20 14:54 mlrun/launcher/base.py
+-rw-r--r--  2.0 unx     6169 b- defN 23-Jul-20 14:54 mlrun/launcher/client.py
+-rw-r--r--  2.0 unx     2182 b- defN 23-Jul-20 14:54 mlrun/launcher/factory.py
+-rw-r--r--  2.0 unx    10815 b- defN 23-Jul-20 14:54 mlrun/launcher/local.py
+-rw-r--r--  2.0 unx     6770 b- defN 23-Jul-20 14:54 mlrun/launcher/remote.py
+-rw-r--r--  2.0 unx      760 b- defN 23-Jul-20 14:54 mlrun/mlutils/__init__.py
+-rw-r--r--  2.0 unx     5325 b- defN 23-Jul-20 14:54 mlrun/mlutils/data.py
+-rw-r--r--  2.0 unx     2598 b- defN 23-Jul-20 14:54 mlrun/mlutils/models.py
+-rw-r--r--  2.0 unx    30120 b- defN 23-Jul-20 14:54 mlrun/mlutils/plots.py
+-rw-r--r--  2.0 unx      872 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/__init__.py
+-rw-r--r--  2.0 unx    23970 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/features_drift_table.py
+-rw-r--r--  2.0 unx     2388 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/helpers.py
+-rw-r--r--  2.0 unx     5214 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/model_endpoint.py
+-rw-r--r--  2.0 unx    37289 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/model_monitoring_batch.py
+-rw-r--r--  2.0 unx    43133 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stream_processing.py
+-rw-r--r--  2.0 unx     4475 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/tracking_policy.py
+-rw-r--r--  2.0 unx     4248 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/__init__.py
+-rw-r--r--  2.0 unx    20351 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/kv_model_endpoint_store.py
+-rw-r--r--  2.0 unx     5695 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/model_endpoint_store.py
+-rw-r--r--  2.0 unx    15960 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/sql_model_endpoint_store.py
+-rw-r--r--  2.0 unx      884 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/__init__.py
+-rw-r--r--  2.0 unx      655 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/base.py
+-rw-r--r--  2.0 unx     4153 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/mysql.py
+-rw-r--r--  2.0 unx     4070 b- defN 23-Jul-20 14:54 mlrun/model_monitoring/stores/models/sqlite.py
+-rw-r--r--  2.0 unx     7101 b- defN 23-Jul-20 14:54 mlrun/package/__init__.py
+-rw-r--r--  2.0 unx    13974 b- defN 23-Jul-20 14:54 mlrun/package/context_handler.py
+-rw-r--r--  2.0 unx     1204 b- defN 23-Jul-20 14:54 mlrun/package/errors.py
+-rw-r--r--  2.0 unx    12606 b- defN 23-Jul-20 14:54 mlrun/package/packager.py
+-rw-r--r--  2.0 unx    37275 b- defN 23-Jul-20 14:54 mlrun/package/packagers_manager.py
+-rw-r--r--  2.0 unx      769 b- defN 23-Jul-20 14:54 mlrun/package/packagers/__init__.py
+-rw-r--r--  2.0 unx    20060 b- defN 23-Jul-20 14:54 mlrun/package/packagers/default_packager.py
+-rw-r--r--  2.0 unx    20618 b- defN 23-Jul-20 14:54 mlrun/package/packagers/numpy_packagers.py
+-rw-r--r--  2.0 unx    35951 b- defN 23-Jul-20 14:54 mlrun/package/packagers/pandas_packagers.py
+-rw-r--r--  2.0 unx    21528 b- defN 23-Jul-20 14:54 mlrun/package/packagers/python_standard_library_packagers.py
+-rw-r--r--  2.0 unx     1722 b- defN 23-Jul-20 14:54 mlrun/package/utils/__init__.py
+-rw-r--r--  2.0 unx     7567 b- defN 23-Jul-20 14:54 mlrun/package/utils/_archiver.py
+-rw-r--r--  2.0 unx     6393 b- defN 23-Jul-20 14:54 mlrun/package/utils/_formatter.py
+-rw-r--r--  2.0 unx    10926 b- defN 23-Jul-20 14:54 mlrun/package/utils/_pickler.py
+-rw-r--r--  2.0 unx     2379 b- defN 23-Jul-20 14:54 mlrun/package/utils/_supported_format.py
+-rw-r--r--  2.0 unx     3709 b- defN 23-Jul-20 14:54 mlrun/package/utils/log_hint_utils.py
+-rw-r--r--  2.0 unx    14825 b- defN 23-Jul-20 14:54 mlrun/package/utils/type_hint_utils.py
+-rw-r--r--  2.0 unx     2400 b- defN 23-Jul-20 14:54 mlrun/platforms/__init__.py
+-rw-r--r--  2.0 unx    23997 b- defN 23-Jul-20 14:54 mlrun/platforms/iguazio.py
+-rw-r--r--  2.0 unx    11852 b- defN 23-Jul-20 14:54 mlrun/platforms/other.py
+-rw-r--r--  2.0 unx     1153 b- defN 23-Jul-20 14:54 mlrun/projects/__init__.py
+-rw-r--r--  2.0 unx    17602 b- defN 23-Jul-20 14:54 mlrun/projects/operations.py
+-rw-r--r--  2.0 unx    38781 b- defN 23-Jul-20 14:54 mlrun/projects/pipelines.py
+-rw-r--r--  2.0 unx   127746 b- defN 23-Jul-20 14:54 mlrun/projects/project.py
+-rw-r--r--  2.0 unx     8692 b- defN 23-Jul-20 14:54 mlrun/runtimes/__init__.py
+-rw-r--r--  2.0 unx    86542 b- defN 23-Jul-20 14:54 mlrun/runtimes/base.py
+-rw-r--r--  2.0 unx     6689 b- defN 23-Jul-20 14:54 mlrun/runtimes/constants.py
+-rw-r--r--  2.0 unx    30353 b- defN 23-Jul-20 14:54 mlrun/runtimes/daskjob.py
+-rw-r--r--  2.0 unx     9994 b- defN 23-Jul-20 14:54 mlrun/runtimes/funcdoc.py
+-rw-r--r--  2.0 unx    44880 b- defN 23-Jul-20 14:54 mlrun/runtimes/function.py
+-rw-r--r--  2.0 unx     4911 b- defN 23-Jul-20 14:54 mlrun/runtimes/function_reference.py
+-rw-r--r--  2.0 unx     6530 b- defN 23-Jul-20 14:54 mlrun/runtimes/generators.py
+-rw-r--r--  2.0 unx    15482 b- defN 23-Jul-20 14:54 mlrun/runtimes/kubejob.py
+-rw-r--r--  2.0 unx    19579 b- defN 23-Jul-20 14:54 mlrun/runtimes/local.py
+-rw-r--r--  2.0 unx     2885 b- defN 23-Jul-20 14:54 mlrun/runtimes/nuclio.py
+-rw-r--r--  2.0 unx    61740 b- defN 23-Jul-20 14:54 mlrun/runtimes/pod.py
+-rw-r--r--  2.0 unx     7695 b- defN 23-Jul-20 14:54 mlrun/runtimes/remotesparkjob.py
+-rw-r--r--  2.0 unx    30505 b- defN 23-Jul-20 14:54 mlrun/runtimes/serving.py
+-rw-r--r--  2.0 unx    20801 b- defN 23-Jul-20 14:54 mlrun/runtimes/utils.py
+-rw-r--r--  2.0 unx      790 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/__init__.py
+-rw-r--r--  2.0 unx    14713 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/abstract.py
+-rw-r--r--  2.0 unx    13845 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/v1.py
+-rw-r--r--  2.0 unx     8460 b- defN 23-Jul-20 14:54 mlrun/runtimes/mpijob/v1alpha1.py
+-rw-r--r--  2.0 unx      751 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/__init__.py
+-rw-r--r--  2.0 unx    35028 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/abstract.py
+-rw-r--r--  2.0 unx    28746 b- defN 23-Jul-20 14:54 mlrun/runtimes/sparkjob/spark3job.py
+-rw-r--r--  2.0 unx     1078 b- defN 23-Jul-20 14:54 mlrun/serving/__init__.py
+-rw-r--r--  2.0 unx     6116 b- defN 23-Jul-20 14:54 mlrun/serving/merger.py
+-rw-r--r--  2.0 unx    18038 b- defN 23-Jul-20 14:54 mlrun/serving/remote.py
+-rw-r--r--  2.0 unx    55318 b- defN 23-Jul-20 14:54 mlrun/serving/routers.py
+-rw-r--r--  2.0 unx    20439 b- defN 23-Jul-20 14:54 mlrun/serving/server.py
+-rw-r--r--  2.0 unx      836 b- defN 23-Jul-20 14:54 mlrun/serving/serving_wrapper.py
+-rw-r--r--  2.0 unx    54310 b- defN 23-Jul-20 14:54 mlrun/serving/states.py
+-rw-r--r--  2.0 unx     3902 b- defN 23-Jul-20 14:54 mlrun/serving/utils.py
+-rw-r--r--  2.0 unx    11814 b- defN 23-Jul-20 14:54 mlrun/serving/v1_serving.py
+-rw-r--r--  2.0 unx    21823 b- defN 23-Jul-20 14:54 mlrun/serving/v2_serving.py
+-rw-r--r--  2.0 unx      826 b- defN 23-Jul-20 14:54 mlrun/utils/__init__.py
+-rw-r--r--  2.0 unx    10636 b- defN 23-Jul-20 14:54 mlrun/utils/async_http.py
+-rw-r--r--  2.0 unx     3456 b- defN 23-Jul-20 14:54 mlrun/utils/azure_vault.py
+-rw-r--r--  2.0 unx     6245 b- defN 23-Jul-20 14:54 mlrun/utils/clones.py
+-rw-r--r--  2.0 unx     1920 b- defN 23-Jul-20 14:54 mlrun/utils/condition_evaluator.py
+-rw-r--r--  2.0 unx     1702 b- defN 23-Jul-20 14:54 mlrun/utils/db.py
+-rw-r--r--  2.0 unx    47157 b- defN 23-Jul-20 14:54 mlrun/utils/helpers.py
+-rw-r--r--  2.0 unx     8241 b- defN 23-Jul-20 14:54 mlrun/utils/http.py
+-rw-r--r--  2.0 unx     7035 b- defN 23-Jul-20 14:54 mlrun/utils/logger.py
+-rw-r--r--  2.0 unx     4303 b- defN 23-Jul-20 14:54 mlrun/utils/regex.py
+-rw-r--r--  2.0 unx      883 b- defN 23-Jul-20 14:54 mlrun/utils/singleton.py
+-rw-r--r--  2.0 unx     1319 b- defN 23-Jul-20 14:54 mlrun/utils/v3io_clients.py
+-rw-r--r--  2.0 unx    10447 b- defN 23-Jul-20 14:54 mlrun/utils/vault.py
+-rw-r--r--  2.0 unx      990 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/__init__.py
+-rw-r--r--  2.0 unx    19870 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification_pusher.py
+-rw-r--r--  2.0 unx     2113 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/__init__.py
+-rw-r--r--  2.0 unx     2293 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/base.py
+-rw-r--r--  2.0 unx     1971 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/console.py
+-rw-r--r--  2.0 unx     5221 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/git.py
+-rw-r--r--  2.0 unx     1962 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/ipython.py
+-rw-r--r--  2.0 unx     3898 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/slack.py
+-rw-r--r--  2.0 unx     1865 b- defN 23-Jul-20 14:54 mlrun/utils/notifications/notification/webhook.py
+-rw-r--r--  2.0 unx      614 b- defN 23-Jul-20 14:54 mlrun/utils/version/__init__.py
+-rw-r--r--  2.0 unx       88 b- defN 23-Jul-20 14:55 mlrun/utils/version/version.json
+-rw-r--r--  2.0 unx     1970 b- defN 23-Jul-20 14:54 mlrun/utils/version/version.py
+-rw-r--r--  2.0 unx    11357 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/LICENSE
+-rw-r--r--  2.0 unx    17014 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/METADATA
+-rw-r--r--  2.0 unx       92 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/WHEEL
+-rw-r--r--  2.0 unx       47 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/entry_points.txt
+-rw-r--r--  2.0 unx        6 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx    41956 b- defN 23-Jul-20 14:55 mlrun-1.5.0rc1.dist-info/RECORD
+447 files, 4772684 bytes uncompressed, 1213687 bytes compressed:  74.6%
```

## zipnote {}

```diff
@@ -195,17 +195,23 @@
 
 Filename: mlrun/api/crud/tags.py
 Comment: 
 
 Filename: mlrun/api/crud/model_monitoring/__init__.py
 Comment: 
 
+Filename: mlrun/api/crud/model_monitoring/deployment.py
+Comment: 
+
 Filename: mlrun/api/crud/model_monitoring/grafana.py
 Comment: 
 
+Filename: mlrun/api/crud/model_monitoring/helpers.py
+Comment: 
+
 Filename: mlrun/api/crud/model_monitoring/model_endpoints.py
 Comment: 
 
 Filename: mlrun/api/crud/runtimes/__init__.py
 Comment: 
 
 Filename: mlrun/api/crud/runtimes/nuclio/__init__.py
@@ -234,17 +240,14 @@
 
 Filename: mlrun/api/db/sqldb/db.py
 Comment: 
 
 Filename: mlrun/api/db/sqldb/helpers.py
 Comment: 
 
-Filename: mlrun/api/db/sqldb/session.py
-Comment: 
-
 Filename: mlrun/api/db/sqldb/models/__init__.py
 Comment: 
 
 Filename: mlrun/api/db/sqldb/models/models_mysql.py
 Comment: 
 
 Filename: mlrun/api/db/sqldb/models/models_sqlite.py
@@ -423,14 +426,29 @@
 
 Filename: mlrun/api/utils/db/sql_collation.py
 Comment: 
 
 Filename: mlrun/api/utils/db/sqlite_migration.py
 Comment: 
 
+Filename: mlrun/api/utils/events/__init__.py
+Comment: 
+
+Filename: mlrun/api/utils/events/base.py
+Comment: 
+
+Filename: mlrun/api/utils/events/events_factory.py
+Comment: 
+
+Filename: mlrun/api/utils/events/iguazio.py
+Comment: 
+
+Filename: mlrun/api/utils/events/nop.py
+Comment: 
+
 Filename: mlrun/api/utils/projects/__init__.py
 Comment: 
 
 Filename: mlrun/api/utils/projects/follower.py
 Comment: 
 
 Filename: mlrun/api/utils/projects/leader.py
@@ -450,14 +468,20 @@
 
 Filename: mlrun/api/utils/projects/remotes/nop_follower.py
 Comment: 
 
 Filename: mlrun/api/utils/projects/remotes/nop_leader.py
 Comment: 
 
+Filename: mlrun/api/utils/runtimes/__init__.py
+Comment: 
+
+Filename: mlrun/api/utils/runtimes/nuclio.py
+Comment: 
+
 Filename: mlrun/api/utils/singletons/__init__.py
 Comment: 
 
 Filename: mlrun/api/utils/singletons/db.py
 Comment: 
 
 Filename: mlrun/api/utils/singletons/k8s.py
@@ -492,20 +516,32 @@
 
 Filename: mlrun/common/__init__.py
 Comment: 
 
 Filename: mlrun/common/constants.py
 Comment: 
 
-Filename: mlrun/common/model_monitoring.py
+Filename: mlrun/common/helpers.py
 Comment: 
 
 Filename: mlrun/common/types.py
 Comment: 
 
+Filename: mlrun/common/db/__init__.py
+Comment: 
+
+Filename: mlrun/common/db/sql_session.py
+Comment: 
+
+Filename: mlrun/common/model_monitoring/__init__.py
+Comment: 
+
+Filename: mlrun/common/model_monitoring/helpers.py
+Comment: 
+
 Filename: mlrun/common/schemas/__init__.py
 Comment: 
 
 Filename: mlrun/common/schemas/artifact.py
 Comment: 
 
 Filename: mlrun/common/schemas/auth.py
@@ -519,14 +555,17 @@
 
 Filename: mlrun/common/schemas/clusterization_spec.py
 Comment: 
 
 Filename: mlrun/common/schemas/constants.py
 Comment: 
 
+Filename: mlrun/common/schemas/events.py
+Comment: 
+
 Filename: mlrun/common/schemas/feature_store.py
 Comment: 
 
 Filename: mlrun/common/schemas/frontend_spec.py
 Comment: 
 
 Filename: mlrun/common/schemas/function.py
@@ -540,41 +579,56 @@
 
 Filename: mlrun/common/schemas/k8s.py
 Comment: 
 
 Filename: mlrun/common/schemas/memory_reports.py
 Comment: 
 
-Filename: mlrun/common/schemas/model_endpoints.py
-Comment: 
-
 Filename: mlrun/common/schemas/notification.py
 Comment: 
 
 Filename: mlrun/common/schemas/object.py
 Comment: 
 
 Filename: mlrun/common/schemas/pipeline.py
 Comment: 
 
 Filename: mlrun/common/schemas/project.py
 Comment: 
 
+Filename: mlrun/common/schemas/regex.py
+Comment: 
+
+Filename: mlrun/common/schemas/runs.py
+Comment: 
+
 Filename: mlrun/common/schemas/runtime_resource.py
 Comment: 
 
 Filename: mlrun/common/schemas/schedule.py
 Comment: 
 
 Filename: mlrun/common/schemas/secret.py
 Comment: 
 
 Filename: mlrun/common/schemas/tag.py
 Comment: 
 
+Filename: mlrun/common/schemas/model_monitoring/__init__.py
+Comment: 
+
+Filename: mlrun/common/schemas/model_monitoring/constants.py
+Comment: 
+
+Filename: mlrun/common/schemas/model_monitoring/grafana.py
+Comment: 
+
+Filename: mlrun/common/schemas/model_monitoring/model_endpoints.py
+Comment: 
+
 Filename: mlrun/data_types/__init__.py
 Comment: 
 
 Filename: mlrun/data_types/data_types.py
 Comment: 
 
 Filename: mlrun/data_types/infer.py
@@ -591,20 +645,26 @@
 
 Filename: mlrun/datastore/base.py
 Comment: 
 
 Filename: mlrun/datastore/datastore.py
 Comment: 
 
+Filename: mlrun/datastore/dbfs_store.py
+Comment: 
+
 Filename: mlrun/datastore/filestore.py
 Comment: 
 
 Filename: mlrun/datastore/google_cloud_storage.py
 Comment: 
 
+Filename: mlrun/datastore/helpers.py
+Comment: 
+
 Filename: mlrun/datastore/inmem.py
 Comment: 
 
 Filename: mlrun/datastore/redis.py
 Comment: 
 
 Filename: mlrun/datastore/s3.py
@@ -681,18 +741,18 @@
 
 Filename: mlrun/feature_store/retrieval/job.py
 Comment: 
 
 Filename: mlrun/feature_store/retrieval/local_merger.py
 Comment: 
 
-Filename: mlrun/feature_store/retrieval/online.py
+Filename: mlrun/feature_store/retrieval/spark_merger.py
 Comment: 
 
-Filename: mlrun/feature_store/retrieval/spark_merger.py
+Filename: mlrun/feature_store/retrieval/storey_merger.py
 Comment: 
 
 Filename: mlrun/frameworks/__init__.py
 Comment: 
 
 Filename: mlrun/frameworks/parallel_coordinates.py
 Comment: 
@@ -984,15 +1044,18 @@
 
 Filename: mlrun/model_monitoring/model_endpoint.py
 Comment: 
 
 Filename: mlrun/model_monitoring/model_monitoring_batch.py
 Comment: 
 
-Filename: mlrun/model_monitoring/stream_processing_fs.py
+Filename: mlrun/model_monitoring/stream_processing.py
+Comment: 
+
+Filename: mlrun/model_monitoring/tracking_policy.py
 Comment: 
 
 Filename: mlrun/model_monitoring/stores/__init__.py
 Comment: 
 
 Filename: mlrun/model_monitoring/stores/kv_model_endpoint_store.py
 Comment: 
@@ -1011,14 +1074,65 @@
 
 Filename: mlrun/model_monitoring/stores/models/mysql.py
 Comment: 
 
 Filename: mlrun/model_monitoring/stores/models/sqlite.py
 Comment: 
 
+Filename: mlrun/package/__init__.py
+Comment: 
+
+Filename: mlrun/package/context_handler.py
+Comment: 
+
+Filename: mlrun/package/errors.py
+Comment: 
+
+Filename: mlrun/package/packager.py
+Comment: 
+
+Filename: mlrun/package/packagers_manager.py
+Comment: 
+
+Filename: mlrun/package/packagers/__init__.py
+Comment: 
+
+Filename: mlrun/package/packagers/default_packager.py
+Comment: 
+
+Filename: mlrun/package/packagers/numpy_packagers.py
+Comment: 
+
+Filename: mlrun/package/packagers/pandas_packagers.py
+Comment: 
+
+Filename: mlrun/package/packagers/python_standard_library_packagers.py
+Comment: 
+
+Filename: mlrun/package/utils/__init__.py
+Comment: 
+
+Filename: mlrun/package/utils/_archiver.py
+Comment: 
+
+Filename: mlrun/package/utils/_formatter.py
+Comment: 
+
+Filename: mlrun/package/utils/_pickler.py
+Comment: 
+
+Filename: mlrun/package/utils/_supported_format.py
+Comment: 
+
+Filename: mlrun/package/utils/log_hint_utils.py
+Comment: 
+
+Filename: mlrun/package/utils/type_hint_utils.py
+Comment: 
+
 Filename: mlrun/platforms/__init__.py
 Comment: 
 
 Filename: mlrun/platforms/iguazio.py
 Comment: 
 
 Filename: mlrun/platforms/other.py
@@ -1089,20 +1203,14 @@
 
 Filename: mlrun/runtimes/mpijob/v1.py
 Comment: 
 
 Filename: mlrun/runtimes/mpijob/v1alpha1.py
 Comment: 
 
-Filename: mlrun/runtimes/package/__init__.py
-Comment: 
-
-Filename: mlrun/runtimes/package/context_handler.py
-Comment: 
-
 Filename: mlrun/runtimes/sparkjob/__init__.py
 Comment: 
 
 Filename: mlrun/runtimes/sparkjob/abstract.py
 Comment: 
 
 Filename: mlrun/runtimes/sparkjob/spark3job.py
@@ -1146,29 +1254,29 @@
 
 Filename: mlrun/utils/azure_vault.py
 Comment: 
 
 Filename: mlrun/utils/clones.py
 Comment: 
 
+Filename: mlrun/utils/condition_evaluator.py
+Comment: 
+
 Filename: mlrun/utils/db.py
 Comment: 
 
 Filename: mlrun/utils/helpers.py
 Comment: 
 
 Filename: mlrun/utils/http.py
 Comment: 
 
 Filename: mlrun/utils/logger.py
 Comment: 
 
-Filename: mlrun/utils/model_monitoring.py
-Comment: 
-
 Filename: mlrun/utils/regex.py
 Comment: 
 
 Filename: mlrun/utils/singleton.py
 Comment: 
 
 Filename: mlrun/utils/v3io_clients.py
@@ -1197,35 +1305,38 @@
 
 Filename: mlrun/utils/notifications/notification/ipython.py
 Comment: 
 
 Filename: mlrun/utils/notifications/notification/slack.py
 Comment: 
 
+Filename: mlrun/utils/notifications/notification/webhook.py
+Comment: 
+
 Filename: mlrun/utils/version/__init__.py
 Comment: 
 
 Filename: mlrun/utils/version/version.json
 Comment: 
 
 Filename: mlrun/utils/version/version.py
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/LICENSE
+Filename: mlrun-1.5.0rc1.dist-info/LICENSE
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/METADATA
+Filename: mlrun-1.5.0rc1.dist-info/METADATA
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/WHEEL
+Filename: mlrun-1.5.0rc1.dist-info/WHEEL
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/entry_points.txt
+Filename: mlrun-1.5.0rc1.dist-info/entry_points.txt
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/top_level.txt
+Filename: mlrun-1.5.0rc1.dist-info/top_level.txt
 Comment: 
 
-Filename: mlrun-1.4.0rc9.dist-info/RECORD
+Filename: mlrun-1.5.0rc1.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mlrun/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -31,14 +31,15 @@
 
 from .config import config as mlconf
 from .datastore import DataItem, store_manager
 from .db import get_run_db
 from .errors import MLRunInvalidArgumentError, MLRunNotFoundError
 from .execution import MLClientCtx
 from .model import RunObject, RunTemplate, new_task
+from .package import ArtifactType, DefaultPackager, Packager, handler
 from .platforms import (
     VolumeMount,
     auto_mount,
     mount_v3io,
     mount_v3io_extended,
     mount_v3io_legacy,
     v3io_cred,
@@ -58,22 +59,21 @@
     _run_pipeline,
     code_to_function,
     function_to_module,
     get_dataitem,
     get_object,
     get_or_create_ctx,
     get_pipeline,
-    handler,
     import_function,
     new_function,
     run_local,
     run_pipeline,
     wait_for_pipeline_completion,
 )
-from .runtimes import ArtifactType, new_model_server
+from .runtimes import new_model_server
 from .secrets import get_secret_or_env
 from .utils.version import Version
 
 __version__ = Version().get()["version"]
 
 
 def get_version():
```

## mlrun/__main__.py

```diff
@@ -1,10 +1,10 @@
 #!/usr/bin/env python
 
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -29,14 +29,15 @@
 import click
 import dotenv
 import pandas as pd
 import yaml
 from tabulate import tabulate
 
 import mlrun
+from mlrun.common.helpers import parse_versioned_object_uri
 
 from .config import config as mlconf
 from .db import get_run_db
 from .errors import err_to_str
 from .model import RunTemplate
 from .platforms import auto_mount as auto_mount_modifier
 from .projects import load_project
@@ -51,15 +52,14 @@
 from .secrets import SecretsStore
 from .utils import (
     dict_to_yaml,
     get_in,
     is_relative_path,
     list2dict,
     logger,
-    parse_versioned_object_uri,
     run_keys,
     update_in,
 )
 from .utils.version import Version
 
 pd.set_option("mode.chained_assignment", None)
 
@@ -759,18 +759,19 @@
 
     elif kind.startswith("art"):
         run_db = get_run_db()
         artifacts = run_db.list_artifacts(
             name, project=project, tag=tag, labels=selector
         )
         df = artifacts.to_df()[
-            ["tree", "key", "iter", "kind", "path", "hash", "updated"]
+            ["tree", "key", "iter", "kind", "path", "hash", "updated", "uri"]
         ]
         df["tree"] = df["tree"].apply(lambda x: f"..{x[-8:]}")
         df["hash"] = df["hash"].apply(lambda x: f"..{x[-6:]}")
+        df["updated"] = df["updated"].apply(time_str)
         print(tabulate(df, headers="keys"))
 
     elif kind.startswith("func"):
         run_db = get_run_db()
         if name:
             f = run_db.get_function(name, project=project, tag=tag)
             print(dict_to_yaml(f))
@@ -1085,33 +1086,38 @@
             # TODO: Remove this in 1.5.0
             FutureWarning,
         )
 
     if db:
         mlconf.dbpath = db
 
-    proj = load_project(context, url, name, init_git=init_git, clone=clone, save=save)
+    # set the CLI/GIT parameters in load_project() so they can be used by project setup scripts
+    parameters = fill_params(param) if param else {}
+    if git_repo:
+        parameters["git_repo"] = git_repo
+    if git_issue:
+        parameters["git_issue"] = git_issue
+    commit = environ.get("GITHUB_SHA") or environ.get("CI_COMMIT_SHA")
+    if commit and not parameters.get("commit_id"):
+        parameters["commit_id"] = commit
+
+    proj = load_project(
+        context,
+        url,
+        name,
+        init_git=init_git,
+        clone=clone,
+        save=save,
+        parameters=parameters,
+    )
     url_str = " from " + url if url else ""
     print(f"Loading project {proj.name}{url_str} into {context}:\n")
 
     if is_relative_path(artifact_path):
         artifact_path = path.abspath(artifact_path)
-    if param:
-        proj.spec.params = fill_params(param, proj.spec.params)
-    if git_repo:
-        proj.spec.params["git_repo"] = git_repo
-    if git_issue:
-        proj.spec.params["git_issue"] = git_issue
-    commit = (
-        proj.get_param("commit_id")
-        or environ.get("GITHUB_SHA")
-        or environ.get("CI_COMMIT_SHA")
-    )
-    if commit:
-        proj.spec.params["commit_id"] = commit
     if secrets:
         secrets = line2keylist(secrets, "kind", "source")
         secret_store = SecretsStore.from_list(secrets)
         # Used to run a workflow with secrets in runtime, without using or storing k8s secrets.
         # To run a scheduled workflow or to use those secrets in other runs, save
         # the secrets in k8s and use the --save-secret flag
         proj._secrets = secret_store
```

## mlrun/config.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -74,15 +74,14 @@
     "dask_kfp_image": "mlrun/ml-base",  # image to use for dask KFP runner (defaults to mlrun/ml-base)
     "igz_version": "",  # the version of the iguazio system the API is running on
     "iguazio_api_url": "",  # the url to iguazio api
     "spark_app_image": "",  # image to use for spark operator app runtime
     "spark_app_image_tag": "",  # image tag to use for spark operator app runtime
     "spark_history_server_path": "",  # spark logs directory for spark history server
     "spark_operator_version": "spark-3",  # the version of the spark operator in use
-    "builder_alpine_image": "alpine:3.13.1",  # builder alpine image (as kaniko's initContainer)
     "package_path": "mlrun",  # mlrun pip package
     "default_base_image": "mlrun/mlrun",  # default base image when doing .deploy()
     # template for project default image name. Parameter {name} will be replaced with project name
     "default_project_image_name": ".mlrun-project-image-{name}",
     "default_project": "default",  # default project name
     "default_archive": "",  # default remote archive URL (for build tar.gz)
     "mpijob_crd_version": "",  # mpijob crd version (e.g: "v1alpha1". must be in: mlrun.runtime.MPIJobCRDVersions)
@@ -283,14 +282,15 @@
             #   onClusterIP |  enrich with an ingress only when `mlrun.config.httpdb.nuclio.default_service_type`
             #                  is set to ClusterIP
             #  ---------------------------------------------------------------------
             # Note: adding a mode requires special handling on
             # - mlrun.runtimes.constants.NuclioIngressAddTemplatedIngressModes
             # - mlrun.runtimes.function.enrich_function_with_ingress
             "add_templated_ingress_host_mode": "never",
+            "explicit_ack": "enabled",
         },
         "logs": {
             "decode": {
                 # Replace with a replacement marker. Uses  (U+FFFD, the official REPLACEMENT CHARACTER).
                 # see https://docs.python.org/3/library/codecs.html#error-handlers for more info and options
                 "errors": "replace",
             },
@@ -367,17 +367,20 @@
             # which will resolve by the existence of secret
             "insecure_push_registry_mode": "auto",
             # the requirement specifier used by the builder when installing mlrun in images when it runs
             # pip install <requirement_specifier>, e.g. mlrun==0.5.4, mlrun~=0.5,
             # git+https://github.com/mlrun/mlrun@development. by default uses the version
             "mlrun_version_specifier": "",
             "kaniko_image": "gcr.io/kaniko-project/executor:v1.8.0",  # kaniko builder image
-            "kaniko_init_container_image": "alpine:3.13.1",
+            "kaniko_init_container_image": "alpine:3.18",
             # image for kaniko init container when docker registry is ECR
             "kaniko_aws_cli_image": "amazon/aws-cli:2.7.10",
+            # kaniko sometimes fails to get filesystem from image, this is a workaround to retry the process
+            # a known issue in Kaniko - https://github.com/GoogleContainerTools/kaniko/issues/1717
+            "kaniko_image_fs_extraction_retries": "3",
             # additional docker build args in json encoded base64 format
             "build_args": "",
             "pip_ca_secret_name": "",
             "pip_ca_secret_key": "",
             "pip_ca_path": "/etc/ssl/certs/mlrun/pip-ca-certificates.crt",
             # template for the prefix that the function target image will be enforced to have (as long as it's targeted
             # to be in the configured registry). Supported template values are: {project} {name}
@@ -410,15 +413,15 @@
         # storage such as the parquet file which is generated from the monitoring stream function for the drift analysis
         "offline_storage_path": "model-endpoints/{kind}",
         # Default http path that points to the monitoring stream nuclio function. Will be used as a stream path
         # when the user is working in CE environment and has not provided any stream path.
         "default_http_sink": "http://nuclio-{project}-model-monitoring-stream.mlrun.svc.cluster.local:8080",
         "batch_processing_function_branch": "master",
         "parquet_batching_max_events": 10000,
-        # See mlrun.common.schemas.ModelEndpointStoreType for available options
+        # See mlrun.model_monitoring.stores.ModelEndpointStoreType for available options
         "store_type": "v3io-nosql",
         "endpoint_store_connection": "",
     },
     "secret_stores": {
         "vault": {
             # URLs to access Vault. For example, in a local env (Minikube on Mac) these would be:
             # http://docker.for.mac.localhost:8200
@@ -450,15 +453,15 @@
         "data_prefixes": {
             "default": "v3io:///projects/{project}/FeatureStore/{name}/{kind}",
             "nosql": "v3io:///projects/{project}/FeatureStore/{name}/{kind}",
             "redisnosql": "redis:///projects/{project}/FeatureStore/{name}/{kind}",
         },
         "default_targets": "parquet,nosql",
         "default_job_image": "mlrun/mlrun",
-        "flush_interval": 300,
+        "flush_interval": None,
     },
     "ui": {
         "projects_prefix": "projects",  # The UI link prefix for projects
         "url": "",  # remote/external mlrun UI url (for hyperlinks)
     },
     "hub": {
         "k8s_secrets_project_name": "-hub-secrets",
@@ -537,14 +540,35 @@
         "get_logs": {
             # the number of retries to get logs from the log collector
             "max_retries": 3,
         },
         # interval for stopping log collection for runs which are in a terminal state
         "stop_logs_interval": 3600,
     },
+    # Configurations for the `mlrun.package` sub-package involving packagers - logging returned outputs and parsing
+    # inputs data items:
+    "packagers": {
+        # Whether to enable packagers. True will wrap each run in the `mlrun.package.handler` decorator to log and parse
+        # using packagers.
+        "enabled": True,
+        # Whether to treat returned tuples from functions as a tuple and not as multiple returned items. If True, all
+        # returned values will be packaged together as the tuple they are returned in. Default is False to enable
+        # logging multiple returned items.
+        "pack_tuples": False,
+    },
+    # Events are currently (and only) used to audit changes and record access to MLRun entities (such as secrets)
+    "events": {
+        # supported modes "enabled", "disabled".
+        # "enabled" - events are emitted.
+        # "disabled" - a nop client is used (aka doing nothing).
+        "mode": "disabled",
+        "verbose": False,
+        # used for igz client when emitting events
+        "access_key": "",
+    },
 }
 
 _is_running_as_api = None
 
 
 def is_running_as_api():
     # MLRUN_IS_API_SERVER is set when running the api server which is being done through the CLI command mlrun db
```

## mlrun/errors.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/execution.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -459,24 +459,34 @@
                 self._update_run()
             return default
         return self._parameters[key]
 
     def _load_project_object(self):
         if not self._project_object:
             if not self._project:
-                self.logger.warning("get_project_param called without a project name")
+                self.logger.warning(
+                    "Project cannot be loaded without a project name set in the context"
+                )
                 return None
             if not self._rundb:
                 self.logger.warning(
-                    "cannot retrieve project parameters - MLRun DB is not accessible"
+                    "Cannot retrieve project data - MLRun DB is not accessible"
                 )
                 return None
             self._project_object = self._rundb.get_project(self._project)
         return self._project_object
 
+    def get_project_object(self):
+        """
+        Get the MLRun project object by the project name set in the context.
+
+        :return: The project object or None if it couldn't be retrieved.
+        """
+        return self._load_project_object()
+
     def get_project_param(self, key: str, default=None):
         """get a parameter from the run's project's parameters"""
         if not self._load_project_object():
             return default
 
         return self._project_object.get_param(key, default)
```

## mlrun/features.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/k8s_utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/kfpops.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -14,14 +14,15 @@
 import getpass
 import json
 import os
 import os.path
 from copy import deepcopy
 from typing import Dict, List, Union
 
+import inflection
 from kfp import dsl
 from kubernetes import client as k8s_client
 
 import mlrun
 from mlrun.errors import err_to_str
 
 from .config import config
@@ -708,14 +709,22 @@
     nodes = workflow["status"].get("nodes", {})
     dag = {}
     for node in nodes.values():
         name = node["displayName"]
         record = {
             k: node[k] for k in ["phase", "startedAt", "finishedAt", "type", "id"]
         }
+
+        # snake case
+        # align kfp fields to mlrun snake case convention
+        # create snake_case for consistency.
+        # retain the camelCase for compatibility
+        for key in list(record.keys()):
+            record[inflection.underscore(key)] = record[key]
+
         record["parent"] = node.get("boundaryID", "")
         record["name"] = name
         record["children"] = node.get("children", [])
         if name in templates:
             record["function"] = templates[name].get("function")
             record["run_type"] = templates[name].get("run_type")
         dag[node["id"]] = record
@@ -743,29 +752,17 @@
         if step and step in dag:
             dag[step]["run_uid"] = get_in(run, "metadata.uid")
             dag[step]["kind"] = get_in(run, "metadata.labels.kind")
             error = get_in(run, "status.error")
             if error:
                 dag[step]["error"] = error
 
-    short_run = {"graph": dag}
-    short_run["run"] = {
-        k: str(v)
-        for k, v in kfp_run["run"].items()
-        if k
-        in [
-            "id",
-            "name",
-            "status",
-            "error",
-            "created_at",
-            "scheduled_at",
-            "finished_at",
-            "description",
-        ]
+    short_run = {
+        "graph": dag,
+        "run": mlrun.utils.helpers.format_run(kfp_run["run"]),
     }
     short_run["run"]["project"] = project
     short_run["run"]["message"] = message
     return short_run
 
 
 def show_kfp_run(run, clear_output=False):
```

## mlrun/lists.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -88,15 +88,17 @@
                     }
                     rows.append(copy(row))
             else:
                 rows.append(row)
 
         return [list_header] + rows
 
-    def to_df(self, flat=False, extend_iterations=False, cache=True):
+    def to_df(
+        self, flat: bool = False, extend_iterations: bool = False, cache: bool = True
+    ) -> pd.DataFrame:
         """convert the run list to a dataframe"""
         if hasattr(self, "_df") and cache:
             return self._df
         rows = self.to_rows(extend_iterations=extend_iterations)
         df = pd.DataFrame(rows[1:], columns=rows[0])  # .set_index('iter')
         df["start"] = pd.to_datetime(df["start"])
 
@@ -175,18 +177,24 @@
             "hash": ["hash", "metadata.hash"],
             "viewer": ["viewer", "spec.viewer"],
             "updated": ["updated", "metadata.updated"],
             "description": ["description", "metadata.description"],
             "producer": ["producer", "spec.producer"],
             "sources": ["sources", "spec.sources"],
             "labels": ["labels", "metadata.labels"],
+            # important: the uri item must be the last one in this dict since there is no artifact.uri, and we fill it
+            # in the following for loop as the "last_index" in the dict
+            "uri": ["uri", "uri"],
         }
         for artifact in self:
             fields_index = 0 if is_legacy_artifact(artifact) else 1
             row = [get_in(artifact, v[fields_index], "") for k, v in head.items()]
+            artifact_uri = dict_to_artifact(artifact).uri
+            last_index = len(row) - 1
+            row[last_index] = artifact_uri
             rows.append(row)
 
         return [head.keys()] + rows
 
     def to_df(self, flat=False):
         """convert the artifact list to a dataframe"""
         rows = self.to_rows()
```

## mlrun/model.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -20,15 +20,18 @@
 import warnings
 from collections import OrderedDict
 from copy import deepcopy
 from datetime import datetime
 from os import environ
 from typing import Any, Dict, List, Optional, Tuple, Union
 
+import pydantic.error_wrappers
+
 import mlrun
+import mlrun.common.schemas.notification
 
 from .utils import (
     dict_to_json,
     dict_to_yaml,
     get_artifact_target,
     is_legacy_artifact,
     logger,
@@ -55,15 +58,19 @@
         ):
             raise ValueError(f"parameter {name} must be a dict or object")
         if new_type and (isinstance(param, dict) or param is None):
             return new_type.from_dict(param)
         return param
 
     def to_dict(self, fields=None, exclude=None):
-        """convert the object to a python dictionary"""
+        """convert the object to a python dictionary
+
+        :param fields:  list of fields to include in the dict
+        :param exclude: list of fields to exclude from the dict
+        """
         struct = {}
         fields = fields or self._dict_fields
         if not fields:
             fields = list(inspect.signature(self.__init__).parameters.keys())
         for t in fields:
             if not exclude or t not in exclude:
                 val = getattr(self, t, None)
@@ -98,21 +105,27 @@
             for deprecated_field, new_field in deprecated_fields.items():
                 field_value = struct.get(new_field) or struct.get(deprecated_field)
                 if field_value:
                     setattr(new_obj, new_field, field_value)
 
         return new_obj
 
-    def to_yaml(self) -> str:
-        """convert the object to yaml"""
-        return dict_to_yaml(self.to_dict())
+    def to_yaml(self, exclude=None) -> str:
+        """convert the object to yaml
 
-    def to_json(self):
-        """convert the object to json"""
-        return dict_to_json(self.to_dict())
+        :param exclude: list of fields to exclude from the yaml
+        """
+        return dict_to_yaml(self.to_dict(exclude=exclude))
+
+    def to_json(self, exclude=None):
+        """convert the object to json
+
+        :param exclude: list of fields to exclude from the json
+        """
+        return dict_to_json(self.to_dict(exclude=exclude))
 
     def to_str(self):
         """convert the object to string (with dict layout)"""
         return self.__str__()
 
     def __str__(self):
         return str(self.to_dict())
@@ -532,24 +545,45 @@
         severity=None,
         when=None,
         condition=None,
         params=None,
         status=None,
         sent_time=None,
     ):
-        self.kind = kind
-        self.name = name
-        self.message = message
-        self.severity = severity
-        self.when = when
-        self.condition = condition
+        self.kind = kind or mlrun.common.schemas.notification.NotificationKind.slack
+        self.name = name or ""
+        self.message = message or ""
+        self.severity = (
+            severity or mlrun.common.schemas.notification.NotificationSeverity.INFO
+        )
+        self.when = when or ["completed"]
+        self.condition = condition or ""
         self.params = params or {}
         self.status = status
         self.sent_time = sent_time
 
+        self.validate_notification()
+
+    def validate_notification(self):
+        try:
+            mlrun.common.schemas.notification.Notification(**self.to_dict())
+        except pydantic.error_wrappers.ValidationError as exc:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "Invalid notification object"
+            ) from exc
+
+    @staticmethod
+    def validate_notification_uniqueness(notifications: List["Notification"]):
+        """Validate that all notifications in the list are unique by name"""
+        names = [notification.name for notification in notifications]
+        if len(names) != len(set(names)):
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "Notification names must be unique"
+            )
+
 
 class RunMetadata(ModelObj):
     """Run metadata"""
 
     def __init__(
         self,
         uid=None,
@@ -777,22 +811,25 @@
         """
         Set the returns list to log the returning values at the end of a run.
 
         :param returns: The return list to set.
 
         :raise MLRunInvalidArgumentError: In case one of the values in the list is invalid.
         """
+        # This import is located in the method due to circular imports error.
+        from mlrun.package.utils import LogHintUtils
+
         if returns is None:
             self._returns = None
             return
         self._verify_list(returns, "returns")
 
         # Validate:
         for log_hint in returns:
-            mlrun.run._parse_log_hint(log_hint=log_hint)
+            LogHintUtils.parse_log_hint(log_hint=log_hint)
 
         # Store the results:
         self._returns = returns
 
     @property
     def hyper_param_options(self) -> HyperParamOptions:
         return self._hyper_param_options
@@ -862,15 +899,15 @@
         elif isinstance(notifications, ObjectList):
             self._notifications = notifications
         else:
             raise ValueError("Notifications must be a list")
 
     def extract_type_hints_from_inputs(self):
         """
-        This method extracts the type hints from the inputs keys in the input dictionary.
+        This method extracts the type hints from the input keys in the input dictionary.
 
         As a result, after the method ran the inputs dictionary - a dictionary of parameter names as keys and paths as
         values, will be cleared from type hints and the extracted type hints will be saved in the spec's inputs type
         hints dictionary - a dictionary of parameter names as keys and their type hints as values. If a parameter is
         not in the type hints dictionary, its type hint will be `mlrun.DataItem` by default.
         """
         # Validate there are inputs to read:
@@ -945,15 +982,15 @@
         :return: The value as key and type hint tuple.
 
         :raise MLRunInvalidArgumentError: If an incorrect pattern was provided.
         """
         # Validate correct pattern:
         if input_key.count(":") > 1:
             raise mlrun.errors.MLRunInvalidArgumentError(
-                f"Incorrect input pattern. Inputs keys can have only a single ':' in them to specify the desired type "
+                f"Incorrect input pattern. Input keys can have only a single ':' in them to specify the desired type "
                 f"the input will be parsed as. Given: {input_key}."
             )
 
         # Split into key and type:
         value_key, value_type = input_key.replace(" ", "").split(":")
 
         return value_key, value_type
@@ -1157,14 +1194,28 @@
     def status(self) -> RunStatus:
         return self._status
 
     @status.setter
     def status(self, status):
         self._status = self._verify_dict(status, "status", RunStatus)
 
+    @property
+    def error(self) -> str:
+        """error string if failed"""
+        if self.status:
+            if self.status.state != "error":
+                return f"Run state ({self.status.state}) is not in error state"
+            return (
+                self.status.error
+                or self.status.reason
+                or self.status.status_text
+                or "Unknown error"
+            )
+        return ""
+
     def output(self, key):
         """return the value of a specific result or artifact by key"""
         self._outputs_wait_for_completion()
         if self.status.results and key in self.status.results:
             return self.status.results.get(key)
         artifact = self._artifact(key)
         if artifact:
@@ -1328,15 +1379,14 @@
             total_time += sleep
             if timeout and total_time > timeout:
                 raise mlrun.errors.MLRunTimeoutError(
                     "Run did not reach terminal state on time"
                 )
         if logs_enabled and not logs_interval:
             self.logs(watch=False)
-
         if raise_on_failure and state != mlrun.runtimes.constants.RunStates.completed:
             raise mlrun.errors.MLRunRuntimeError(
                 f"task {self.metadata.name} did not complete (state={state})"
             )
 
         return state
```

## mlrun/render.py

```diff
@@ -1,26 +1,29 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import pathlib
+import typing
 import uuid
 from os import environ, path
 
 import pandas as pd
 
+import mlrun.utils
+
 from .config import config
 from .datastore import uri_to_ipython
 from .utils import dict_to_list, get_in, is_ipython
 
 JUPYTER_SERVER_ROOT = environ.get("HOME", "/User")
 supported_viewers = [
     ".htm",
@@ -68,15 +71,21 @@
         return html_summary(title, df.to_html(escape=False), size)
 
 
 def dict_html(x):
     return "".join([f'<div class="dictlist">{i}</div>' for i in dict_to_list(x)])
 
 
-def link_to_ipython(link):
+def link_to_ipython(link: str):
+    """
+    Convert a link (e.g. v3io path) to a jupyter notebook local link.
+
+    :param link: the link to convert
+    :return:     the converted link and ref for expanding the file in the notebook
+    """
     valid = pathlib.Path(link).suffix in supported_viewers
     ref = 'class="artifact" onclick="expandPanel(this)" paneName="result" '
     if "://" not in link:
         abs = path.abspath(link)
         if abs.startswith(JUPYTER_SERVER_ROOT) and valid:
             return abs.replace(JUPYTER_SERVER_ROOT, "/files"), ref
         else:
@@ -91,30 +100,50 @@
 def link_html(text, link=""):
     if not link:
         link = text
     link, ref = link_to_ipython(link)
     return f'<div {ref}title="{link}">{text}</div>'
 
 
-def artifacts_html(x, pathcol="path"):
-    if not x:
+def artifacts_html(
+    artifacts: typing.List[dict],
+    attribute_name: str = "path",
+):
+    """
+    Generate HTML for a list of artifacts. The HTML will be a list of links to the artifacts to be presented in the
+    jupyter notebook. The links will be clickable and will open the artifact in a new tab.
+
+    :param artifacts:       contains a list of artifact dictionaries
+    :param attribute_name:  the attribute of the artifact to use as the link text
+    :return:                the generated HTML
+    """
+    if not artifacts:
         return ""
     html = ""
-    for i in x:
-        # support legacy format
-        if pathcol in i:
-            link, ref = link_to_ipython(i[pathcol])
+
+    for artifact in artifacts:
+        # TODO: remove this in 1.5.0 once we no longer support legacy format
+        if mlrun.utils.is_legacy_artifact(artifact):
+            attribute_value = artifact.get(attribute_name)
         else:
-            link, ref = link_to_ipython(i["spec"][pathcol])
+            attribute_value = artifact["spec"].get(attribute_name)
 
-        if "key" in i:
-            key = i["key"]
+        if mlrun.utils.is_legacy_artifact(artifact):
+            key = artifact["key"]
         else:
-            key = i["metadata"]["key"]
+            key = artifact["metadata"]["key"]
 
+        if not attribute_value:
+            mlrun.utils.logger.warning(
+                "Artifact is incomplete, omitting from output (most likely due to a failed artifact logging)",
+                artifact_key=key,
+            )
+            continue
+
+        link, ref = link_to_ipython(attribute_value)
         html += f'<div {ref}title="{link}">{key}</div>'
     return html
 
 
 def inputs_html(x):
     if not x:
         return ""
@@ -334,15 +363,20 @@
     html = get_style() + jscripts + table.replace('="result', '="' + rnd)
     return ipython_display(html, display)
 
 
 uid_template = '<div title="{}"><a href="{}/{}/{}/jobs/monitor/{}/overview" target="_blank" >...{}</a></div>'
 
 
-def runs_to_html(df, display=True, classes=None, short=False):
+def runs_to_html(
+    df: pd.DataFrame,
+    display: bool = True,
+    classes: typing.Optional[typing.Union[str, list, tuple]] = None,
+    short: bool = False,
+):
     def time_str(x):
         try:
             return x.strftime("%b %d %H:%M:%S")
         except ValueError:
             return ""
 
     df["results"] = df["results"].apply(dict_html)
@@ -370,25 +404,21 @@
         df.drop("labels", axis=1, inplace=True)
         df.drop("inputs", axis=1, inplace=True)
         df.drop("artifacts", axis=1, inplace=True)
     else:
         df["labels"] = df["labels"].apply(dict_html)
         df["inputs"] = df["inputs"].apply(inputs_html)
         df["artifacts"] = df["artifacts"].apply(
-            lambda x: artifacts_html(x, "target_path")
+            lambda artifacts: artifacts_html(artifacts, "target_path"),
         )
 
     def expand_error(x):
         if x["state"] == "error":
             title = str(x["error"])
-            state = f'<div style="color: red;" title="{title}">'
-
-            # TODO: is this replacement needed?
-            state.replace('"', "'")
-            state += f'{x["state"]}</div>'
+            state = f'<div style="color: red;" title="{title}">{x["state"]}</div>'
             x["state"] = state
         return x
 
     df = df.apply(expand_error, axis=1)
     df.drop("error", axis=1, inplace=True)
     with pd.option_context("display.max_colwidth", None):
         return get_tblframe(df, display, classes=classes)
```

## mlrun/run.py

```diff
@@ -1,53 +1,50 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-import functools
-import importlib
 import importlib.util as imputil
-import inspect
 import json
 import os
 import pathlib
-import re
 import socket
 import tempfile
 import time
 import uuid
 import warnings
 from base64 import b64decode
-from collections import OrderedDict
 from copy import deepcopy
 from os import environ, makedirs, path
 from pathlib import Path
-from typing import Callable, Dict, List, Optional, Tuple, Type, Union
+from typing import Dict, List, Optional, Tuple, Union
 
 import nuclio
 import yaml
 from deprecated import deprecated
 from kfp import Client
 
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 from mlrun.kfpops import format_summary_from_kfp_run, show_kfp_run
 
+from .common.helpers import parse_versioned_object_uri
 from .config import config as mlconf
 from .datastore import store_manager
 from .db import get_or_set_dburl, get_run_db
+from .errors import MLRunInvalidArgumentError, MLRunTimeoutError
 from .execution import MLClientCtx
 from .model import BaseMetadata, RunObject, RunTemplate
 from .runtimes import (
     DaskCluster,
     HandlerRuntime,
     KubejobRuntime,
     LocalRuntime,
@@ -57,23 +54,21 @@
     RemoteSparkRuntime,
     RuntimeKinds,
     ServingRuntime,
     Spark3Runtime,
     get_runtime_class,
 )
 from .runtimes.funcdoc import update_function_entry_points
-from .runtimes.package.context_handler import ArtifactType, ContextHandler
 from .runtimes.serving import serving_subkind
 from .runtimes.utils import add_code_metadata, global_context
 from .utils import (
     extend_hub_uri_if_needed,
     get_in,
     logger,
     new_pipe_metadata,
-    parse_versioned_object_uri,
     retry_until_successful,
     run_keys,
     update_in,
 )
 
 
 class RunStatuses(object):
@@ -107,14 +102,20 @@
         return [
             status
             for status in RunStatuses.all()
             if status not in RunStatuses.stable_statuses()
         ]
 
 
+# TODO: remove in 1.6.0
+@deprecated(
+    version="1.4.0",
+    reason="'run_local' will be removed in 1.6.0, use 'function.run(local=True)' instead",
+    category=FutureWarning,
+)
 def run_local(
     task=None,
     command="",
     name: str = "",
     args: list = None,
     workdir=None,
     project: str = "",
@@ -158,14 +159,15 @@
                      in the key field of the dictionary after a colon, e.g: "<key> : <type_hint>".
     :param artifact_path: default artifact output path
     :param mode:    Runtime mode for more details head to `mlrun.new_function`
     :param allow_empty_resources:   Allow passing non materialized set/vector as input to jobs
                                     (allows to have function which don't depend on having targets,
                                     e.g a function which accepts a feature vector uri and generate
                                      the offline vector e.g. parquet_ for it if it doesn't exist)
+    :param notifications:   list of notifications to push when the run is completed
     :param returns:  List of configurations for how to log the returning values from the handler's run (as artifacts or
                      results). The list's length must be equal to the amount of returning objects. A configuration may
                      be given as:
 
                      * A string of the key to use to log the returning value as result or as an artifact. To specify
                        The artifact type, it is possible to pass a string in the following structure:
                        "<key> : <type>". Available artifact types can be seen in `mlrun.ArtifactType`. If no artifact
@@ -546,14 +548,15 @@
     args: list = None,
     runtime=None,
     mode=None,
     handler: str = None,
     source: str = None,
     requirements: Union[str, List[str]] = None,
     kfp=None,
+    requirements_file: str = "",
 ):
     """Create a new ML function from base properties
 
     example::
 
            # define a container based function (the `training.py` must exist in the container workdir)
            f = new_function(command='training.py -x {x}', image='myrepo/image:latest', kind='job')
@@ -586,15 +589,16 @@
                      the entire file will be executed (as main).
                      for nuclio functions the handler is in the form of module:function, defaults to "main:handler"
     :param source:   valid absolute path or URL to git, zip, or tar file, e.g.
                      `git://github.com/mlrun/something.git`,
                      `http://some/url/file.zip`
                      note path source must exist on the image or exist locally when run is local
                      (it is recommended to use 'function.spec.workdir' when source is a filepath instead)
-    :param requirements: list of python packages or pip requirements file path, defaults to None
+    :param requirements:        a list of python packages, defaults to None
+    :param requirements_file:   path to a python requirements file
     :param kfp:      reserved, flag indicating running within kubeflow pipeline
 
     :return: function object
     """
     # don't override given dict
     if runtime and isinstance(runtime, dict):
         runtime = deepcopy(runtime)
@@ -642,24 +646,28 @@
     runner.kfp = kfp
     if mode:
         runner.spec.mode = mode
     if source:
         runner.spec.build.source = source
     if handler:
         if kind == RuntimeKinds.serving:
-            raise mlrun.errors.MLRunInvalidArgumentError(
+            raise MLRunInvalidArgumentError(
                 "cannot set the handler for serving runtime"
             )
         elif kind in RuntimeKinds.nuclio_runtimes():
             runner.spec.function_handler = handler
         else:
             runner.spec.default_handler = handler
 
     if requirements:
-        runner.with_requirements(requirements, prepare_image_for_deploy=False)
+        runner.with_requirements(
+            requirements,
+            requirements_file=requirements_file,
+            prepare_image_for_deploy=False,
+        )
 
     runner.prepare_image_for_deploy()
     return runner
 
 
 def _process_runtime(command, runtime, kind):
     if runtime and hasattr(runtime, "to_dict"):
@@ -693,14 +701,15 @@
     embed_code: bool = True,
     description: str = "",
     requirements: Union[str, List[str]] = None,
     categories: List[str] = None,
     labels: Dict[str, str] = None,
     with_doc: bool = True,
     ignored_tags=None,
+    requirements_file: str = "",
 ) -> Union[
     MpiRuntimeV1Alpha1,
     MpiRuntimeV1,
     RemoteRuntime,
     ServingRuntime,
     DaskCluster,
     KubejobRuntime,
@@ -746,14 +755,16 @@
     :param kind:         function runtime type string - nuclio, job, etc. (see docstring for all options)
     :param image:        base docker image to use for building the function container, defaults to None
     :param code_output:  specify '.' to generate python module from the current jupyter notebook
     :param embed_code:   indicates whether or not to inject the code directly into the function runtime spec,
                          defaults to True
     :param description:  short function description, defaults to ''
     :param requirements: list of python packages or pip requirements file path, defaults to None
+    :param requirements: a list of python packages
+    :param requirements_file: path to a python requirements file
     :param categories:   list of categories for mlrun Function Hub, defaults to None
     :param labels:       immutable name/value pairs to tag the function with useful metadata, defaults to None
     :param with_doc:     indicates whether to document the function parameters, defaults to True
     :param ignored_tags: notebook cells to ignore when converting notebooks to py code (separated by ';')
 
     :return:
         pre-configured function object from a mlrun runtime class
@@ -798,15 +809,15 @@
         fn.spec.image = image or get_in(spec, "spec.image", "")
         fn.spec.filename = filename or get_in(spec, "spec.filename", "")
         fn.spec.build.base_image = get_in(spec, "spec.build.baseImage")
         fn.spec.build.commands = get_in(spec, "spec.build.commands")
         fn.spec.build.secret = get_in(spec, "spec.build.secret")
 
         if requirements:
-            fn.with_requirements(requirements)
+            fn.with_requirements(requirements, requirements_file=requirements_file)
 
         if embed_code:
             fn.spec.build.functionSourceCode = get_in(
                 spec, "spec.build.functionSourceCode"
             )
 
         if fn.kind != "local":
@@ -845,14 +856,20 @@
     name, spec, code = nuclio.build_file(
         filename,
         name=name,
         handler=handler or "handler",
         kind=subkind,
         ignored_tags=ignored_tags,
     )
+    spec["spec"]["env"].append(
+        {
+            "name": "MLRUN_HTTPDB__NUCLIO__EXPLICIT_ACK",
+            "value": mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
+        }
+    )
     spec_kind = get_in(spec, "kind", "")
     if not kind and spec_kind not in ["", "Function"]:
         kind = spec_kind.lower()
 
         # if its a nuclio subkind, redo nb parsing
         is_nuclio, subkind = resolve_nuclio_subkind(kind)
         if is_nuclio:
@@ -1333,295 +1350,11 @@
         if len(running) == 0:
             break
         time.sleep(sleep)
         total_time += sleep
         if timeout and total_time > timeout:
             if silent:
                 break
-            raise mlrun.errors.MLRunTimeoutError(
-                "some runs did not reach terminal state on time"
-            )
+            raise MLRunTimeoutError("some runs did not reach terminal state on time")
         runs = running
 
     return completed
-
-
-def _parse_type_hint(type_hint: Union[Type, str]) -> Type:
-    """
-    Parse a given type hint from string to its actual hinted type class object. The string must be one of the following:
-
-    * Python builtin type - one of ``tuple``, ``list``, ``set``, ``dict`` and ``bytearray``.
-    * Full module import path. An alias is not allowed (if ``import pandas as pd`` is used, the type hint cannot be
-      ``pd.DataFrame`` but ``pandas.DataFrame``).
-
-    The type class on its own (like `DataFrame`) cannot be used as the scope of the decorator is not the same as the
-    handler itself, hence modules and objects that were imported in the handler's scope are not available. This is the
-    same reason import aliases cannot be used as well.
-
-    If the provided type hint is not a string, it will simply be returned as is.
-
-    **Notice**: This method should only run on client side as it dependent on user requirements.
-
-    :param type_hint: The type hint to parse.
-
-    :return: The hinted type.
-
-    :raise MLRunInvalidArgumentError: In case the type hint is not following the 2 options mentioned above.
-    """
-    if not isinstance(type_hint, str):
-        return type_hint
-
-    # TODO: Remove once Packager is implemented (it will support typing hints)
-    # If a typing hint is provided, we return a dummy Union type so the parser will skip the data item:
-    if type_hint.startswith("typing."):
-        return Union[int, str]
-
-    # Validate the type hint is a valid module path:
-    if not bool(
-        re.fullmatch(r"([a-zA-Z_][a-zA-Z0-9_]*\.)*[a-zA-Z_][a-zA-Z0-9_]*", type_hint)
-    ):
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            f"Invalid type hint. An input type hint must be a valid python class name or its module import path. For "
-            f"example: 'list', 'pandas.DataFrame', 'numpy.ndarray', 'sklearn.linear_model.LinearRegression'. Type hint "
-            f"given: '{type_hint}'."
-        )
-
-    # Look for a builtin type (rest of the builtin types like `int`, `str`, `float` should be treated as results, hence
-    # not given as an input to an MLRun function, but as a parameter):
-    builtin_types = {
-        tuple.__name__: tuple,
-        list.__name__: list,
-        set.__name__: set,
-        dict.__name__: dict,
-        bytearray.__name__: bytearray,
-    }
-    if type_hint in builtin_types:
-        return builtin_types[type_hint]
-
-    # If it's not a builtin, its should have a full module path:
-    if "." not in type_hint:
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            f"MLRun tried to get the type hint '{type_hint}' but it can't as it is not a valid builtin Python type "
-            f"(one of {', '.join(list(builtin_types.keys()))}). Pay attention using only the type as string is not "
-            f"allowed as the handler's scope is different then MLRun's. To properly give a type hint, please specify "
-            f"the full module path. For example: do not use `DataFrame`, use `pandas.DataFrame`."
-        )
-
-    # Import the module to receive the hinted type:
-    try:
-        # Get the module path and the type class (If we'll wish to support inner classes, the `rsplit` won't work):
-        module_path, type_hint = type_hint.rsplit(".", 1)
-        # Replace alias if needed (alias assumed to be imported already, hence we look in globals):
-        # For example:
-        # If in handler scope there was `import A.B.C as abc` and user gave a type hint "abc.Something" then:
-        # `module_path[0]` will be equal to "abc". Then, because it is an alias, it will appear in the globals, so we'll
-        # replace the alias with the full module name in order to import the module.
-        module_path = module_path.split(".")
-        if module_path[0] in globals():
-            module_path[0] = globals()[module_path[0]].__name__
-        module_path = ".".join(module_path)
-        # Import the module:
-        module = importlib.import_module(module_path)
-        # Get the class type from the module:
-        type_hint = getattr(module, type_hint)
-    except ModuleNotFoundError as module_not_found_error:
-        # May be raised from `importlib.import_module` in case the module does not exist.
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            f"MLRun tried to get the type hint '{type_hint}' but the module '{module_path}' cannot be imported. "
-            f"Keep in mind that using alias in the module path (meaning: import module as alias) is not allowed. "
-            f"If the module path is correct, please make sure the module package is installed in the python "
-            f"interpreter."
-        ) from module_not_found_error
-    except AttributeError as attribute_error:
-        # May be raised from `getattr(module, type_hint)` in case the class type cannot be imported directly from the
-        # imported module.
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            f"MLRun tried to get the type hint '{type_hint}' from the module '{module.__name__}' but it seems it "
-            f"doesn't exist. Make sure the class can be imported from the module with the exact module path you "
-            f"passed. Notice inner classes (a class inside of a class) are not supported."
-        ) from attribute_error
-
-    return type_hint
-
-
-def _parse_log_hint(
-    log_hint: Union[Dict[str, str], str, None]
-) -> Union[Dict[str, str], None]:
-    """
-    Parse a given log hint from string to a logging configuration dictionary. The string will be read as the artifact
-    key ('key' in the dictionary) and if the string have a single colon, the following structure is assumed:
-    "<artifact_key> : <artifact_type>". The artifact type must be on of the values of `ArtifactType`'s enum.
-
-    If a logging configuration dictionary is received, it will be validated to have a key field and valid artifact type
-    value.
-
-    None will be returned as None.
-
-    :param log_hint: The log hint to parse.
-
-    :return: The hinted logging configuration.
-
-    :raise MLRunInvalidArgumentError: In case the log hint is not following the string structure, the artifact type is
-                                      not valid or the dictionary is missing the key field.
-    """
-    # Check for None value:
-    if log_hint is None:
-        return None
-
-    # If the log hint was provided as a string, construct a dictionary out of it:
-    if isinstance(log_hint, str):
-        # Check if only key is given:
-        if ":" not in log_hint:
-            log_hint = {"key": log_hint}
-        # Check for valid "<key> : <artifact type>" pattern:
-        else:
-            if log_hint.count(":") > 1:
-                raise mlrun.errors.MLRunInvalidArgumentError(
-                    f"Incorrect log hint pattern. Output keys can have only a single ':' in them to specify the "
-                    f"desired artifact type the returned value will be logged as: '<artifact_key> : <artifact_type>', "
-                    f"but given: {log_hint}"
-                )
-            # Split into key and type:
-            key, artifact_type = log_hint.replace(" ", "").split(":")
-            log_hint = {"key": key, "artifact_type": artifact_type}
-
-    # TODO: Replace with constants keys once mlrun.package is implemented.
-    # Validate the log hint dictionary has the mandatory key:
-    if "key" not in log_hint:
-        raise mlrun.errors.MLRunInvalidArgumentError(
-            f"An output log hint dictionary must include the 'key' - the artifact key (it's name). The following "
-            f"log hint is missing the key: {log_hint}."
-        )
-
-    # Validate the artifact type is valid:
-    if "artifact_type" in log_hint:
-        valid_artifact_types = [t.value for t in ArtifactType.__members__.values()]
-        if log_hint["artifact_type"] not in valid_artifact_types:
-            raise mlrun.errors.MLRunInvalidArgumentError(
-                f"The following artifact type '{log_hint['artifact_type']}' is not a valid `ArtifactType`. "
-                f"Please select one of the following: {','.join(valid_artifact_types)}"
-            )
-
-    return log_hint
-
-
-def handler(
-    labels: Dict[str, str] = None,
-    outputs: List[Union[str, Dict[str, str]]] = None,
-    inputs: Union[bool, Dict[str, Union[str, Type]]] = True,
-):
-    """
-    MLRun's handler is a decorator to wrap a function and enable setting labels, automatic `mlrun.DataItem` parsing and
-    outputs logging.
-
-    :param labels:  Labels to add to the run. Expecting a dictionary with the labels names as keys. Default: None.
-    :param outputs: Logging configurations for the function's returned values. Expecting a list of tuples and None
-                    values:
-
-                    * str - A string in the format of '{key}:{artifact_type}'. If a string was given without ':' it will
-                      indicate the key and the artifact type will be according to the returned value type. The artifact
-                      types can be one of: "dataset", "directory", "file", "object", "plot" and "result".
-
-                    * Dict[str, str] - A dictionary of logging configuration. the key 'key' is mandatory for the logged
-                      artifact key.
-
-                    * None - Do not log the output.
-
-                    The list length must be equal to the total amount of returned values from the function. Default is
-                    None - meaning no outputs will be logged.
-
-    :param inputs: Parsing configurations for the arguments passed as inputs via the `run` method of an MLRun function.
-                   Can be passed as a boolean value or a dictionary:
-
-                   * True - Parse all found inputs to the assigned type hint in the function's signature. If there is no
-                     type hint assigned, the value will remain an `mlrun.DataItem`.
-                   * False - Do not parse inputs, leaving the inputs as `mlrun.DataItem`.
-                   * Dict[str, Union[Type, str]] - A dictionary with argument name as key and the expected type to parse
-                     the `mlrun.DataItem` to. The expected type can be a string as well, idicating the full module path.
-
-                   **Notice**: Type hints from the `typing` module (e.g. `typing.Optional`, `typing.Union`,
-                   `typing.List` etc.) are currently not supported but will be in the future.
-
-                   Default: True.
-
-    Example::
-
-            import mlrun
-
-            @mlrun.handler(outputs=["my_array", None, "my_multiplier"])
-            def my_handler(array: np.ndarray, m: int):
-                array = array * m
-                m += 1
-                return array, "I won't be logged", m
-
-            >>> mlrun_function = mlrun.code_to_function("my_code.py", kind="job")
-            >>> run_object = mlrun_function.run(
-            ...     handler="my_handler",
-            ...     inputs={"array": "store://my_array_Artifact"},
-            ...     params={"m": 2}
-            ... )
-            >>> run_object.outputs
-            {'my_multiplier': 3, 'my_array': 'store://...'}
-    """
-
-    def decorator(func: Callable):
-        def wrapper(*args: tuple, **kwargs: dict):
-            nonlocal labels
-            nonlocal outputs
-            nonlocal inputs
-
-            # Set default `inputs` - inspect the full signature and add the user's input on top of it:
-            if inputs:
-                # Get the available parameters type hints from the function's signature:
-                func_signature = inspect.signature(func)
-                parameters = OrderedDict(
-                    {
-                        parameter.name: parameter.annotation
-                        for parameter in func_signature.parameters.values()
-                    }
-                )
-                # If user input is given, add it on top of the collected defaults (from signature), strings type hints
-                # will be parsed to their actual types:
-                if isinstance(inputs, dict):
-                    parameters.update(
-                        {
-                            parameter_name: _parse_type_hint(type_hint=type_hint)
-                            for parameter_name, type_hint in inputs.items()
-                        }
-                    )
-                inputs = parameters
-
-            # Create a context handler and look for a context:
-            context_handler = ContextHandler()
-            context_handler.look_for_context(args=args, kwargs=kwargs)
-
-            # If an MLRun context is found, parse arguments pre-run (kwargs are parsed inplace):
-            if context_handler.is_context_available() and inputs:
-                args = context_handler.parse_inputs(
-                    args=args, kwargs=kwargs, type_hints=inputs
-                )
-
-            # Call the original function and get the returning values:
-            func_outputs = func(*args, **kwargs)
-
-            # If an MLRun context is found, set the given labels and log the returning values to MLRun via the context:
-            if context_handler.is_context_available():
-                if labels:
-                    context_handler.set_labels(labels=labels)
-                if outputs:
-                    context_handler.log_outputs(
-                        outputs=func_outputs
-                        if isinstance(func_outputs, tuple)
-                        else [func_outputs],
-                        log_hints=[
-                            _parse_log_hint(log_hint=log_hint) for log_hint in outputs
-                        ],
-                    )
-                    return  # Do not return any values as the returning values were logged to MLRun.
-            return func_outputs
-
-        # Make sure to pass the wrapped function's signature (argument list, type hints and doc strings) to the wrapper:
-        wrapper = functools.wraps(func)(wrapper)
-
-        return wrapper
-
-    return decorator
```

## mlrun/secrets.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/constants.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/initial_data.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/launcher.py

```diff
@@ -10,27 +10,40 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 from typing import Dict, List, Optional, Union
 
 import mlrun.api.crud
-import mlrun.api.db.sqldb.session
+import mlrun.common.db.sql_session
 import mlrun.common.schemas.schedule
 import mlrun.config
 import mlrun.execution
-import mlrun.launcher.base
+import mlrun.launcher.base as launcher
+import mlrun.launcher.factory
 import mlrun.runtimes
 import mlrun.runtimes.generators
 import mlrun.runtimes.utils
 import mlrun.utils
 import mlrun.utils.regex
 
 
-class ServerSideLauncher(mlrun.launcher.base.BaseLauncher):
+def initialize_launcher():
+    """Set the factory custom launcher to the server side launcher"""
+    mlrun.launcher.factory.LauncherFactory().set_launcher(ServerSideLauncher)
+
+
+class ServerSideLauncher(launcher.BaseLauncher):
+    def __init__(self, local: bool = False, **kwargs):
+        super().__init__(**kwargs)
+        if local:
+            raise mlrun.errors.MLRunInternalServerError(
+                "Launch of local run inside the server is not allowed"
+            )
+
     def launch(
         self,
         runtime: mlrun.runtimes.BaseRuntime,
         task: Optional[
             Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
         ] = None,
         handler: Optional[str] = None,
@@ -143,24 +156,26 @@
 
         runtime._post_run(result, execution)  # hook for runtime specific cleanup
 
         return self._wrap_run_result(runtime, result, run, err=last_err)
 
     @staticmethod
     def enrich_runtime(
-        runtime: "mlrun.runtimes.base.BaseRuntime", project: Optional[str] = ""
+        runtime: "mlrun.runtimes.base.BaseRuntime", project_name: Optional[str] = ""
     ):
         """
         Enrich the runtime object with the project spec and metadata.
         This is done only on the server side, since it's the source of truth for the project, and we want to keep the
         client side enrichment as minimal as possible.
         """
         # ensure the runtime has a project before we enrich it with the project's spec
         runtime.metadata.project = (
-            project or runtime.metadata.project or mlrun.config.config.default_project
+            project_name
+            or runtime.metadata.project
+            or mlrun.config.config.default_project
         )
         project = runtime._get_db().get_project(runtime.metadata.project)
         # this is mainly for tests with nop db
         # in normal use cases if no project is found we will get an error
         if project:
             project = mlrun.projects.project.MlrunProject.from_dict(project.dict())
             mlrun.projects.pipelines.enrich_function_object(
@@ -169,15 +184,15 @@
 
     def _save_notifications(self, runobj):
         if not self._run_has_valid_notifications(runobj):
             return
 
         # If in the api server, we can assume that watch=False, so we save notification
         # configs to the DB, for the run monitor to later pick up and push.
-        session = mlrun.api.db.sqldb.session.create_session()
+        session = mlrun.common.db.sql_session.create_session()
         mlrun.api.crud.Notifications().store_run_notifications(
             session,
             runobj.spec.notifications,
             runobj.metadata.uid,
             runobj.metadata.project,
         )
```

## mlrun/api/main.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -32,14 +32,15 @@
 import mlrun.lists
 import mlrun.utils
 import mlrun.utils.notifications
 import mlrun.utils.version
 from mlrun.api.api.api import api_router
 from mlrun.api.db.session import close_session, create_session
 from mlrun.api.initial_data import init_data
+from mlrun.api.launcher import initialize_launcher
 from mlrun.api.middlewares import init_middlewares
 from mlrun.api.utils.periodic import (
     cancel_all_periodic_functions,
     cancel_periodic_function,
     run_function_periodically,
 )
 from mlrun.api.utils.singletons.db import get_db, initialize_db
@@ -100,21 +101,27 @@
     )
 
 
 @app.exception_handler(mlrun.errors.MLRunHTTPStatusError)
 async def http_status_error_handler(
     request: fastapi.Request, exc: mlrun.errors.MLRunHTTPStatusError
 ):
+    request_id = None
+
+    # request might not have request id when the error is raised before the request id is set on middleware
+    if hasattr(request.state, "request_id"):
+        request_id = request.state.request_id
     status_code = exc.response.status_code
     error_message = repr(exc)
     logger.warning(
         "Request handling returned error status",
         error_message=error_message,
         status_code=status_code,
         traceback=traceback.format_exc(),
+        request_id=request_id,
     )
     return await http_exception_handler(
         request,
         fastapi.HTTPException(status_code=status_code, detail=error_message),
     )
 
 
@@ -130,14 +137,15 @@
         concurrent.futures.ThreadPoolExecutor(
             max_workers=int(config.httpdb.max_workers)
         )
     )
 
     initialize_logs_dir()
     initialize_db()
+    initialize_launcher()
 
     if (
         config.httpdb.clusterization.worker.sync_with_chief.mode
         == mlrun.common.schemas.WaitForChiefToReachOnlineStateFeatureFlag.enabled
         and config.httpdb.clusterization.role
         == mlrun.common.schemas.ClusterizationRole.worker
     ):
@@ -268,20 +276,25 @@
     """
     This function is responsible for initiating the logs collection process. It will get a list of all runs which are
     in a state which requires logs collection and will initiate the logs collection process for each of them.
     :param start_logs_limit: a semaphore which limits the number of concurrent logs collection processes
     """
     db_session = await fastapi.concurrency.run_in_threadpool(create_session)
     try:
+        # we don't want initiate logs collection for aborted runs
+        run_states = mlrun.runtimes.constants.RunStates.all()
+        run_states.remove(mlrun.runtimes.constants.RunStates.aborted)
+
         # list all the runs in the system which we didn't request logs collection for yet
         runs = await fastapi.concurrency.run_in_threadpool(
             get_db().list_distinct_runs_uids,
             db_session,
             requested_logs_modes=[False],
             only_uids=False,
+            states=run_states,
         )
         if runs:
             logger.debug(
                 "Found runs which require logs collection",
                 runs_uids=[run.get("metadata", {}).get("uid", None) for run in runs],
             )
             await _start_log_and_update_runs(start_logs_limit, db_session, runs)
@@ -441,15 +454,20 @@
     db_session = await fastapi.concurrency.run_in_threadpool(create_session)
     try:
         runs = await fastapi.concurrency.run_in_threadpool(
             get_db().list_distinct_runs_uids,
             db_session,
             requested_logs_modes=[True],
             only_uids=False,
-            states=mlrun.runtimes.constants.RunStates.terminal_states(),
+            states=mlrun.runtimes.constants.RunStates.terminal_states()
+            + [
+                # add unknown state as well, as it's possible that the run reached such state
+                # usually it happens when run pods get preempted
+                mlrun.runtimes.constants.RunStates.unknown,
+            ],
         )
 
         if len(runs) > 0:
             logger.debug(
                 "Stopping logs for runs which reached terminal state before startup",
                 runs_count=len(runs),
             )
@@ -587,15 +605,17 @@
 
     if not len(runs):
         return
 
     # Unmasking the run parameters from secrets before handing them over to the notification handler
     # as importing the `Secrets` crud in the notification handler will cause a circular import
     unmasked_runs = [
-        mlrun.api.api.utils.unmask_notification_params_secret_on_task(run)
+        mlrun.api.api.utils.unmask_notification_params_secret_on_task(
+            db, db_session, run
+        )
         for run in runs
     ]
 
     logger.debug(
         "Got terminal runs with configured notifications", runs_amount=len(runs)
     )
     mlrun.utils.notifications.NotificationPusher(unmasked_runs).push(db)
```

## mlrun/api/middlewares.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -42,14 +42,15 @@
     request_id = str(uuid.uuid4())
     silent_logging_paths = [
         "healthz",
     ]
     path_with_query_string = uvicorn.protocols.utils.get_path_with_query_string(
         request.scope
     )
+    request.state.request_id = request_id
     start_time = time.perf_counter_ns()
     if not any(
         silent_logging_path in path_with_query_string
         for silent_logging_path in silent_logging_paths
     ):
         logger.debug(
             "Received request",
```

## mlrun/api/api/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/api.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/deps.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -24,31 +24,33 @@
 
 import kubernetes.client
 from fastapi import HTTPException
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
+import mlrun.api.db.base
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.singletons.k8s
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.runtimes.pod
 import mlrun.utils.helpers
 from mlrun.api.db.sqldb.db import SQLDB
 from mlrun.api.utils.singletons.db import get_db
 from mlrun.api.utils.singletons.logs_dir import get_logs_dir
 from mlrun.api.utils.singletons.scheduler import get_scheduler
+from mlrun.common.helpers import parse_versioned_object_uri
 from mlrun.config import config
 from mlrun.db.sqldb import SQLDB as SQLRunDB
 from mlrun.errors import err_to_str
 from mlrun.run import import_function, new_function
 from mlrun.runtimes.utils import enrich_function_from_dict
-from mlrun.utils import get_in, logger, parse_versioned_object_uri
+from mlrun.utils import get_in, logger
 
 
 def log_and_raise(status=HTTPStatus.BAD_REQUEST.value, **kw):
     logger.error(str(kw))
     raise HTTPException(status_code=status, detail=kw)
 
 
@@ -198,15 +200,14 @@
     _, _, _, response = await run_in_threadpool(
         submit_run_sync, db_session, auth_info, data
     )
     return response
 
 
 def apply_enrichment_and_validation_on_task(task):
-
     # Masking notification config params from the task object
     mask_notification_params_on_task(task)
 
 
 def mask_notification_params_on_task(task):
     run_uid = get_in(task, "metadata.uid")
     project = get_in(task, "metadata.project")
@@ -220,20 +221,20 @@
                     project, run_uid, notification_object
                 ).to_dict()
             )
     task.setdefault("spec", {})["notifications"] = masked_notifications
 
 
 def mask_notification_params_with_secret(
-    project: str, run_uid: str, notification_object: mlrun.model.Notification
+    project: str, parent: str, notification_object: mlrun.model.Notification
 ) -> mlrun.model.Notification:
     if notification_object.params and "secret" not in notification_object.params:
         secret_key = mlrun.api.crud.Secrets().generate_client_project_secret_key(
             mlrun.api.crud.SecretsClientType.notifications,
-            run_uid,
+            parent,
             notification_object.name,
         )
         mlrun.api.crud.Secrets().store_project_secrets(
             project,
             mlrun.common.schemas.SecretsData(
                 provider=mlrun.common.schemas.SecretProviderName.kubernetes,
                 secrets={secret_key: json.dumps(notification_object.params)},
@@ -241,22 +242,51 @@
             allow_internal_secrets=True,
         )
         notification_object.params = {"secret": secret_key}
 
     return notification_object
 
 
-def unmask_notification_params_secret_on_task(run):
+def unmask_notification_params_secret_on_task(
+    db: mlrun.api.db.base.DBInterface,
+    db_session: Session,
+    run: typing.Union[dict, mlrun.model.RunObject],
+):
     if isinstance(run, dict):
         run = mlrun.model.RunObject.from_dict(run)
 
-    run.spec.notifications = [
-        unmask_notification_params_secret(run.metadata.project, notification)
-        for notification in run.spec.notifications
-    ]
+    notifications = []
+    for notification in run.spec.notifications:
+        invalid_notifications = []
+        try:
+            notifications.append(
+                unmask_notification_params_secret(run.metadata.project, notification)
+            )
+        except Exception as exc:
+            logger.warning(
+                "Failed to unmask notification params, notification will not be sent",
+                project=run.metadata.project,
+                run_uid=run.metadata.uid,
+                notification=notification.name,
+                exc=err_to_str(exc),
+            )
+            # set error status in order to later save the db
+            notification.status = mlrun.common.schemas.NotificationStatus.ERROR
+            invalid_notifications.append(notification)
+
+        if invalid_notifications:
+            db.store_run_notifications(
+                db_session,
+                invalid_notifications,
+                run.metadata.uid,
+                run.metadata.project,
+            )
+
+    run.spec.notifications = notifications
+
     return run
 
 
 def unmask_notification_params_secret(
     project: str, notification_object: mlrun.model.Notification
 ) -> mlrun.model.Notification:
     params = notification_object.params or {}
@@ -302,14 +332,59 @@
         mlrun.common.schemas.SecretProviderName.kubernetes,
         secret_key=params_secret,
         allow_internal_secrets=True,
         allow_secrets_from_k8s=True,
     )
 
 
+def validate_and_mask_notification_list(
+    notifications: typing.List[
+        typing.Union[mlrun.model.Notification, mlrun.common.schemas.Notification, dict]
+    ],
+    parent: str,
+    project: str,
+) -> typing.List[mlrun.model.Notification]:
+    """
+    Validates notification schema, uniqueness and masks notification params with secret if needed.
+    If at least one of the validation steps fails, the function will raise an exception and cause the API to return
+    an error response.
+    :param notifications: list of notification objects
+    :param parent: parent identifier
+    :param project: project name
+    :return: list of validated and masked notification objects
+    """
+    notification_objects = []
+
+    for notification in notifications:
+        if isinstance(notification, dict):
+            notification_object = mlrun.model.Notification.from_dict(notification)
+        elif isinstance(notification, mlrun.common.schemas.Notification):
+            notification_object = mlrun.model.Notification.from_dict(
+                notification.dict()
+            )
+        elif isinstance(notification, mlrun.model.Notification):
+            notification_object = notification
+        else:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "notification must be a dict or a Notification object"
+            )
+
+        # validate notification schema
+        mlrun.common.schemas.Notification(**notification_object.to_dict())
+
+        notification_objects.append(notification_object)
+
+    mlrun.model.Notification.validate_notification_uniqueness(notification_objects)
+
+    return [
+        mask_notification_params_with_secret(project, parent, notification_object)
+        for notification_object in notification_objects
+    ]
+
+
 def apply_enrichment_and_validation_on_function(
     function,
     auth_info: mlrun.common.schemas.AuthInfo,
     ensure_auth: bool = True,
     perform_auto_mount: bool = True,
     validate_service_account: bool = True,
     mask_sensitive_data: bool = True,
@@ -738,15 +813,14 @@
         )
         return
 
     if mlrun.mlconf.function.spec.security_context.enrichment_mode in [
         mlrun.common.schemas.SecurityContextEnrichmentModes.override.value,
         mlrun.common.schemas.SecurityContextEnrichmentModes.retain.value,
     ]:
-
         # before iguazio 3.6 the user unix id is not passed in the session verification response headers
         # so we need to request it explicitly
         if auth_info.user_unix_id is None:
             iguazio_client = mlrun.api.utils.clients.iguazio.Client()
             if (
                 mlrun.api.utils.clients.iguazio.SessionPlanes.control
                 not in auth_info.planes
```

## mlrun/api/api/endpoints/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/artifacts.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/auth.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/background_tasks.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/client_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/clusterization_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/feature_store.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/files.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -17,14 +17,15 @@
 
 import fastapi
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.api.deps
 import mlrun.api.crud.secrets
 import mlrun.api.utils.auth.verifier
+import mlrun.api.utils.singletons.k8s
 import mlrun.common.schemas
 from mlrun.api.api.utils import get_obj_path, get_secrets, log_and_raise
 from mlrun.datastore import store_manager
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
 router = fastapi.APIRouter()
@@ -192,21 +193,28 @@
         "size": stat.size,
         "modified": stat.modified,
         "mimetype": ctype,
     }
 
 
 async def _verify_and_get_project_secrets(project, auth_info):
+    # If running on Docker or locally, we cannot retrieve project secrets, so skip.
+    if not mlrun.api.utils.singletons.k8s.get_k8s_helper(
+        silent=True
+    ).is_running_inside_kubernetes_cluster():
+        return {}
+
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
         mlrun.common.schemas.AuthorizationResourceTypes.secret,
         project,
         mlrun.common.schemas.SecretProviderName.kubernetes,
         mlrun.common.schemas.AuthorizationAction.read,
         auth_info,
     )
+
     secrets_data = await run_in_threadpool(
         mlrun.api.crud.Secrets().list_project_secrets,
         project,
         mlrun.common.schemas.SecretProviderName.kubernetes,
         allow_secrets_from_k8s=True,
     )
     return secrets_data.secrets or {}
```

## mlrun/api/api/endpoints/frontend_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,14 +16,15 @@
 
 import fastapi
 import semver
 
 import mlrun.api.api.deps
 import mlrun.api.utils.builder
 import mlrun.api.utils.clients.iguazio
+import mlrun.api.utils.runtimes.nuclio
 import mlrun.common.schemas
 import mlrun.runtimes
 import mlrun.runtimes.utils
 import mlrun.utils.helpers
 from mlrun.api.api.utils import get_allowed_path_prefixes_list
 from mlrun.config import config
 from mlrun.platforms import is_iguazio_session_cookie
@@ -113,15 +114,15 @@
         project_membership = mlrun.common.schemas.ProjectMembershipFeatureFlag.enabled
     authentication = mlrun.common.schemas.AuthenticationFeatureFlag(
         mlrun.mlconf.httpdb.authentication.mode
     )
     nuclio_streams = mlrun.common.schemas.NuclioStreamsFeatureFlag.disabled
 
     if mlrun.mlconf.get_parsed_igz_version() and semver.VersionInfo.parse(
-        mlrun.runtimes.utils.resolve_nuclio_version()
+        mlrun.api.utils.runtimes.nuclio.resolve_nuclio_version()
     ) >= semver.VersionInfo.parse("1.7.8"):
         nuclio_streams = mlrun.common.schemas.NuclioStreamsFeatureFlag.enabled
 
     preemption_nodes = mlrun.common.schemas.PreemptionNodesFeatureFlag.disabled
     if mlrun.mlconf.is_preemption_nodes_configured():
         preemption_nodes = mlrun.common.schemas.PreemptionNodesFeatureFlag.enabled
```

## mlrun/api/api/endpoints/functions.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -30,37 +30,40 @@
     Request,
     Response,
 )
 from fastapi.concurrency import run_in_threadpool
 from kubernetes.client.rest import ApiException
 from sqlalchemy.orm import Session
 
-import mlrun.api.crud
+import mlrun.api.crud.model_monitoring.deployment
 import mlrun.api.crud.runtimes.nuclio.function
 import mlrun.api.db.session
 import mlrun.api.launcher
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.background_tasks
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.singletons.k8s
 import mlrun.api.utils.singletons.project_member
 import mlrun.common.model_monitoring
+import mlrun.common.model_monitoring.helpers
 import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.api.utils import get_run_db_instance, log_and_raise, log_path
 from mlrun.api.crud.secrets import Secrets, SecretsClientType
 from mlrun.api.utils.builder import build_runtime
 from mlrun.api.utils.singletons.scheduler import get_scheduler
+from mlrun.common.helpers import parse_versioned_object_uri
+from mlrun.common.model_monitoring.helpers import parse_model_endpoint_store_prefix
 from mlrun.config import config
 from mlrun.errors import MLRunRuntimeError, err_to_str
+from mlrun.model_monitoring.tracking_policy import TrackingPolicy
 from mlrun.run import new_function
 from mlrun.runtimes import RuntimeKinds, ServingRuntime, runtime_resources_map
 from mlrun.runtimes.utils import get_item_name
-from mlrun.utils import get_in, logger, parse_versioned_object_uri, update_in
-from mlrun.utils.model_monitoring import parse_model_endpoint_store_prefix
+from mlrun.utils import get_in, logger, update_in
 
 router = APIRouter()
 
 
 @router.post(
     "/func/{project}/{name}",
     deprecated=True,
@@ -159,23 +162,26 @@
     await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
         mlrun.common.schemas.AuthorizationResourceTypes.function,
         project,
         name,
         mlrun.common.schemas.AuthorizationAction.delete,
         auth_info,
     )
-
     #  If the requested function has a schedule, we must delete it before deleting the function
-    schedule = await run_in_threadpool(
-        get_scheduler().get_schedule,
-        db_session,
-        project,
-        name,
-    )
-    if schedule:
+    try:
+        function_schedule = await run_in_threadpool(
+            get_scheduler().get_schedule,
+            db_session,
+            project,
+            name,
+        )
+    except mlrun.errors.MLRunNotFoundError:
+        function_schedule = None
+
+    if function_schedule:
         # when deleting a function, we should also delete its schedules if exists
         # schedules are only supposed to be run by the chief, therefore, if the function has a schedule,
         # and we are running in worker, we send the request to the chief client
         if (
             mlrun.mlconf.httpdb.clusterization.role
             != mlrun.common.schemas.ClusterizationRole.chief
         ):
@@ -441,51 +447,53 @@
         tag,
         offset,
         logs,
     )
 
 
 def _handle_job_deploy_status(
-    db_session,
-    fn,
-    name,
-    project,
-    tag,
-    offset,
-    logs,
+    db_session: Session,
+    fn: dict,
+    name: str,
+    project: str,
+    tag: str,
+    offset: int,
+    logs: bool,
 ):
     # job deploy status
-    state = get_in(fn, "status.state", "")
+    function_state = get_in(fn, "status.state", "")
     pod = get_in(fn, "status.build_pod", "")
     image = get_in(fn, "spec.build.image", "")
     out = b""
     if not pod:
-        if state == mlrun.common.schemas.FunctionState.ready:
+        if function_state == mlrun.common.schemas.FunctionState.ready:
             # when the function has been built we set the created image into the `spec.image` for reference see at the
             # end of the function where we resolve if the status is ready and then set the spec.build.image to
             # spec.image
             # TODO: spec shouldn't hold backend enriched attributes, but rather in the status block
             #   therefore need set it as a new attribute in status.image which will ease our resolution
             #   of whether it is a user defined image or MLRun enriched one.
             image = image or get_in(fn, "spec.image")
         return Response(
             content=out,
             media_type="text/plain",
             headers={
-                "function_status": state,
+                "function_status": function_state,
                 "function_image": image,
                 "builder_pod": pod,
             },
         )
 
     # read from log file
-    terminal_states = ["failed", "error", "ready"]
     log_file = log_path(project, f"build_{name}__{tag or 'latest'}")
-    if state in terminal_states and log_file.exists():
-        if state == mlrun.common.schemas.FunctionState.ready:
+    if (
+        function_state in mlrun.common.schemas.FunctionState.terminal_states()
+        and log_file.exists()
+    ):
+        if function_state == mlrun.common.schemas.FunctionState.ready:
             # when the function has been built we set the created image into the `spec.image` for reference see at the
             # end of the function where we resolve if the status is ready and then set the spec.build.image to
             # spec.image
             # TODO: spec shouldn't hold backend enriched attributes, but rather in the status block
             #   therefore need set it as a new attribute in status.image which will ease our resolution
             #   of whether it is a user defined image or MLRun enriched one.
             image = image or get_in(fn, "spec.image")
@@ -493,79 +501,107 @@
         with log_file.open("rb") as fp:
             fp.seek(offset)
             out = fp.read()
         return Response(
             content=out,
             media_type="text/plain",
             headers={
-                "x-mlrun-function-status": state,
-                "function_status": state,
+                "x-mlrun-function-status": function_state,
+                "function_status": function_state,
                 "function_image": image,
                 "builder_pod": pod,
             },
         )
 
-    # TODO: change state to pod_status
-    state = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False).get_pod_status(
-        pod
-    )
-    logger.info("Resolved pod status", pod_status=state, pod_name=pod)
-
-    if state == "succeeded":
-        logger.info("Build completed successfully")
-        state = mlrun.common.schemas.FunctionState.ready
-    if state in ["failed", "error"]:
-        logger.error("Build failed", pod_name=pod, pod_status=state)
-        state = mlrun.common.schemas.FunctionState.error
+    build_pod_state = mlrun.api.utils.singletons.k8s.get_k8s_helper(
+        silent=False
+    ).get_pod_status(pod)
+    logger.debug(
+        "Resolved pod status",
+        function_name=name,
+        pod_status=build_pod_state,
+        pod_name=pod,
+    )
+
+    normalized_pod_function_state = (
+        mlrun.common.schemas.FunctionState.get_function_state_from_pod_state(
+            build_pod_state
+        )
+    )
+    if normalized_pod_function_state == mlrun.common.schemas.FunctionState.ready:
+        logger.info(
+            "Build completed successfully",
+            function_name=name,
+            pod=pod,
+            pod_state=build_pod_state,
+        )
+    elif normalized_pod_function_state == mlrun.common.schemas.FunctionState.error:
+        logger.error(
+            "Build failed", function_name=name, pod_name=pod, pod_status=build_pod_state
+        )
 
-    if (logs and state != "pending") or state in terminal_states:
+    if (
+        (
+            logs
+            and normalized_pod_function_state
+            != mlrun.common.schemas.FunctionState.pending
+        )
+        or normalized_pod_function_state
+        in mlrun.common.schemas.FunctionState.terminal_states()
+    ):
         try:
             resp = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False).logs(pod)
         except ApiException as exc:
             logger.warning(
                 "Failed to get build logs",
                 function_name=name,
-                function_state=state,
+                function_state=normalized_pod_function_state,
                 pod=pod,
                 exc_info=exc,
             )
             resp = ""
 
-        if state in terminal_states:
+        if (
+            normalized_pod_function_state
+            in mlrun.common.schemas.FunctionState.terminal_states()
+        ):
             # TODO: move to log collector
             log_file.parent.mkdir(parents=True, exist_ok=True)
             with log_file.open("wb") as fp:
                 fp.write(resp.encode())
 
         if resp and logs:
             # begin from the offset number and then encode
             out = resp[offset:].encode()
 
-    update_in(fn, "status.state", state)
-    if state == mlrun.common.schemas.FunctionState.ready:
-        update_in(fn, "spec.image", image)
-
-    versioned = False
-    if state == mlrun.common.schemas.FunctionState.ready:
-        versioned = True
-    mlrun.api.crud.Functions().store_function(
-        db_session,
-        fn,
-        name,
-        project,
-        tag,
-        versioned=versioned,
-    )
+    # check if the previous function state is different from the current build pod state, if that is the case then
+    # update the function and store to the database
+    if function_state != normalized_pod_function_state:
+        update_in(fn, "status.state", normalized_pod_function_state)
+
+        versioned = False
+        if normalized_pod_function_state == mlrun.common.schemas.FunctionState.ready:
+            update_in(fn, "spec.image", image)
+            versioned = True
+
+        mlrun.api.crud.Functions().store_function(
+            db_session,
+            fn,
+            name,
+            project,
+            tag,
+            versioned=versioned,
+        )
 
     return Response(
         content=out,
         media_type="text/plain",
         headers={
-            "x-mlrun-function-status": state,
-            "function_status": state,
+            "x-mlrun-function-status": normalized_pod_function_state,
+            "function_status": normalized_pod_function_state,
             "function_image": image,
             "builder_pod": pod,
         },
     )
 
 
 def _handle_nuclio_deploy_status(
@@ -659,24 +695,24 @@
     client_version=None,
     client_python_version=None,
 ):
     fn = None
     ready = None
     try:
         fn = new_function(runtime=function)
-        mlrun.api.launcher.ServerSideLauncher.enrich_runtime(runtime=fn)
     except Exception as err:
         logger.error(traceback.format_exc())
         log_and_raise(
             HTTPStatus.BAD_REQUEST.value,
             reason=f"runtime error: {err_to_str(err)}",
         )
     try:
         run_db = get_run_db_instance(db_session)
         fn.set_db_connection(run_db)
+        mlrun.api.launcher.ServerSideLauncher.enrich_runtime(runtime=fn)
         fn.save(versioned=False)
         if fn.kind in RuntimeKinds.nuclio_runtimes():
             mlrun.api.api.utils.apply_enrichment_and_validation_on_function(
                 fn,
                 auth_info,
             )
 
@@ -688,44 +724,42 @@
 
                         # Generating model monitoring access key
                         model_monitoring_access_key = None
                         if not mlrun.mlconf.is_ce_mode():
                             model_monitoring_access_key = _process_model_monitoring_secret(
                                 db_session,
                                 fn.metadata.project,
-                                mlrun.common.model_monitoring.ProjectSecretKeys.ACCESS_KEY,
+                                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ACCESS_KEY,
                             )
 
-                            stream_path = mlrun.utils.model_monitoring.get_stream_path(
-                                project=fn.metadata.project
+                            stream_path = (
+                                mlrun.api.crud.model_monitoring.get_stream_path(
+                                    project=fn.metadata.project
+                                )
                             )
 
                             if stream_path.startswith("v3io://"):
                                 # Initialize model monitoring V3IO stream
                                 _create_model_monitoring_stream(
                                     project=fn.metadata.project,
                                     function=fn,
                                     stream_path=stream_path,
                                 )
 
                         if fn.spec.tracking_policy:
                             # Convert to `TrackingPolicy` object as `fn.spec.tracking_policy` is provided as a dict
-                            fn.spec.tracking_policy = (
-                                mlrun.utils.model_monitoring.TrackingPolicy.from_dict(
-                                    fn.spec.tracking_policy
-                                )
+                            fn.spec.tracking_policy = TrackingPolicy.from_dict(
+                                fn.spec.tracking_policy
                             )
                         else:
                             # Initialize tracking policy with default values
-                            fn.spec.tracking_policy = (
-                                mlrun.utils.model_monitoring.TrackingPolicy()
-                            )
+                            fn.spec.tracking_policy = TrackingPolicy()
 
                         # deploy both model monitoring stream and model monitoring batch job
-                        mlrun.api.crud.ModelEndpoints().deploy_monitoring_functions(
+                        mlrun.api.crud.model_monitoring.deployment.MonitoringDeployment().deploy_monitoring_functions(
                             project=fn.metadata.project,
                             db_session=db_session,
                             auth_info=auth_info,
                             tracking_policy=fn.spec.tracking_policy,
                             model_monitoring_access_key=model_monitoring_access_key,
                         )
                 except Exception as exc:
```

## mlrun/api/api/endpoints/grafana_proxy.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -17,19 +17,18 @@
 from http import HTTPStatus
 from typing import List, Union
 
 from fastapi import APIRouter, Depends, Request, Response
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
-import mlrun.api.crud
+import mlrun.api.crud.model_monitoring.deployment
 import mlrun.api.crud.model_monitoring.grafana
-import mlrun.api.utils.auth.verifier
-import mlrun.common.model_monitoring
-import mlrun.common.schemas
+import mlrun.api.crud.model_monitoring.helpers
+import mlrun.common.schemas.model_monitoring.grafana
 from mlrun.api.api import deps
 
 router = APIRouter(prefix="/grafana-proxy/model-endpoints")
 
 NAME_TO_SEARCH_FUNCTION_DICTIONARY = {
     "list_projects": mlrun.api.crud.model_monitoring.grafana.grafana_list_projects,
 }
@@ -49,15 +48,15 @@
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
 ):
     """
     Root of grafana proxy for the model-endpoints API, used for validating the model-endpoints data source
     connectivity.
     """
     if not mlrun.mlconf.is_ce_mode():
-        mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
+        mlrun.api.crud.model_monitoring.helpers.get_access_key(auth_info)
     return Response(status_code=HTTPStatus.OK.value)
 
 
 @router.post("/search", response_model=List[str])
 async def grafana_proxy_model_endpoints_search(
     request: Request,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
@@ -73,15 +72,15 @@
     :param request:    An api request with the required target and parameters.
     :param auth_info:  The auth info of the request.
     :param db_session: A session that manages the current dialog with the database.
 
     :return: List of results. e.g. list of available project names.
     """
     if not mlrun.mlconf.is_ce_mode():
-        mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
+        mlrun.api.crud.model_monitoring.helpers.get_access_key(auth_info)
     body = await request.json()
     query_parameters = mlrun.api.crud.model_monitoring.grafana.parse_search_parameters(
         body
     )
     mlrun.api.crud.model_monitoring.grafana.validate_query_parameters(
         query_parameters, SUPPORTED_SEARCH_FUNCTIONS
     )
@@ -100,25 +99,26 @@
     return result
 
 
 @router.post(
     "/query",
     response_model=List[
         Union[
-            mlrun.common.schemas.GrafanaTable,
-            mlrun.common.schemas.GrafanaTimeSeriesTarget,
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaTable,
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaTimeSeriesTarget,
         ]
     ],
 )
 async def grafana_proxy_model_endpoints_query(
     request: Request,
     auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
 ) -> List[
     Union[
-        mlrun.common.schemas.GrafanaTable, mlrun.common.schemas.GrafanaTimeSeriesTarget
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaTable,
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaTimeSeriesTarget,
     ]
 ]:
     """
     Query route for model-endpoints grafana proxy API, used for creating an interface between grafana queries and
     model-endpoints logic.
 
     This implementation requires passing target_endpoint query parameter in order to dispatch different
```

## mlrun/api/api/endpoints/healthz.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/hub.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/logs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/model_endpoints.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,15 +19,16 @@
 from typing import List, Optional
 
 from fastapi import APIRouter, Depends, Query
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.deps
-import mlrun.api.crud
+import mlrun.api.crud.model_monitoring.deployment
+import mlrun.api.crud.model_monitoring.helpers
 import mlrun.api.utils.auth.verifier
 import mlrun.common.schemas
 from mlrun.errors import MLRunConflictError
 
 router = APIRouter(prefix="/projects/{project}/model-endpoints")
 
 
@@ -60,15 +61,15 @@
         mlrun.common.schemas.AuthorizationResourceTypes.model_endpoint,
         project,
         endpoint_id,
         mlrun.common.schemas.AuthorizationAction.store,
         auth_info,
     )
     # get_access_key will validate the needed auth (which is used later) exists in the request
-    mlrun.api.crud.ModelEndpoints().get_access_key(auth_info)
+    mlrun.api.crud.model_monitoring.helpers.get_access_key(auth_info)
     if project != model_endpoint.metadata.project:
         raise MLRunConflictError(
             f"Can't store endpoint of project {model_endpoint.metadata.project} into project {project}"
         )
     if endpoint_id != model_endpoint.metadata.uid:
         raise MLRunConflictError(
             f"Mismatch between endpoint_id {endpoint_id} and ModelEndpoint.metadata.uid {model_endpoint.metadata.uid}."
```

## mlrun/api/api/endpoints/operations.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/pipelines.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -114,14 +114,82 @@
         namespace = config.namespace
     response = await _create_pipeline(
         auth_info, request, namespace, experiment_name, run_name, project
     )
     return response
 
 
+@router.get("/{run_id}")
+async def get_pipeline(
+    run_id: str,
+    project: str,
+    namespace: str = Query(config.namespace),
+    format_: mlrun.common.schemas.PipelinesFormat = Query(
+        mlrun.common.schemas.PipelinesFormat.summary, alias="format"
+    ),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
+        mlrun.api.api.deps.authenticate_request
+    ),
+    db_session: Session = Depends(deps.get_db_session),
+):
+    pipeline = await run_in_threadpool(
+        mlrun.api.crud.Pipelines().get_pipeline,
+        db_session,
+        run_id,
+        project,
+        namespace,
+        format_,
+    )
+    if project == "*":
+        # In some flows the user may use SDK functions that won't require them to specify the pipeline's project (for
+        # backwards compatibility reasons), so the client will just send * in the project, in that case we use the
+        # legacy flow in which we first get the pipeline, resolve the project out of it, and only then query permissions
+        # we don't use the return value from this function since the user may have asked for a different format than
+        # summary which is the one used inside
+        await _get_pipeline_without_project(db_session, auth_info, run_id, namespace)
+    else:
+        await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
+            mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
+            project,
+            run_id,
+            mlrun.common.schemas.AuthorizationAction.read,
+            auth_info,
+        )
+    return pipeline
+
+
+async def _get_pipeline_without_project(
+    db_session: Session,
+    auth_info: mlrun.common.schemas.AuthInfo,
+    run_id: str,
+    namespace: str,
+):
+    """
+    This function is for when we receive a get pipeline request without the client specifying the project
+    So we first get the pipeline, resolve the project out of it, and now that we know the project, we can verify
+    permissions
+    """
+    run = await run_in_threadpool(
+        mlrun.api.crud.Pipelines().get_pipeline,
+        db_session,
+        run_id,
+        namespace=namespace,
+        # minimal format that includes the project
+        format_=mlrun.common.schemas.PipelinesFormat.summary,
+    )
+    await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
+        mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
+        run["run"]["project"],
+        run["run"]["id"],
+        mlrun.common.schemas.AuthorizationAction.read,
+        auth_info,
+    )
+    return run
+
+
 async def _create_pipeline(
     auth_info: mlrun.common.schemas.AuthInfo,
     request: Request,
     namespace: str,
     experiment_name: str,
     run_name: str,
     project: typing.Optional[str] = None,
@@ -192,70 +260,7 @@
             content_type=content_type,
         )
         return None
     workflow_manifest = yaml.load(data, Loader=yaml.FullLoader)
     return mlrun.api.crud.Pipelines().resolve_project_from_workflow_manifest(
         workflow_manifest
     )
-
-
-@router.get("/{run_id}")
-async def get_pipeline(
-    run_id: str,
-    project: str,
-    namespace: str = Query(config.namespace),
-    format_: mlrun.common.schemas.PipelinesFormat = Query(
-        mlrun.common.schemas.PipelinesFormat.summary, alias="format"
-    ),
-    auth_info: mlrun.common.schemas.AuthInfo = Depends(
-        mlrun.api.api.deps.authenticate_request
-    ),
-    db_session: Session = Depends(deps.get_db_session),
-):
-    pipeline = mlrun.api.crud.Pipelines().get_pipeline(
-        db_session, run_id, project, namespace, format_
-    )
-    if project == "*":
-        # In some flows the user may use SDK functions that won't require them to specify the pipeline's project (for
-        # backwards compatibility reasons), so the client will just send * in the project, in that case we use the
-        # legacy flow in which we first get the pipeline, resolve the project out of it, and only then query permissions
-        # we don't use the return value from this function since the user may have asked for a different format than
-        # summary which is the one used inside
-        await _get_pipeline_without_project(db_session, auth_info, run_id, namespace)
-    else:
-        await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-            mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
-            project,
-            run_id,
-            mlrun.common.schemas.AuthorizationAction.read,
-            auth_info,
-        )
-    return pipeline
-
-
-async def _get_pipeline_without_project(
-    db_session: Session,
-    auth_info: mlrun.common.schemas.AuthInfo,
-    run_id: str,
-    namespace: str,
-):
-    """
-    This function is for when we receive a get pipeline request without the client specifying the project
-    So we first get the pipeline, resolve the project out of it, and now that we know the project, we can verify
-    permissions
-    """
-    run = await run_in_threadpool(
-        mlrun.api.crud.Pipelines().get_pipeline,
-        db_session,
-        run_id,
-        namespace=namespace,
-        # minimal format that includes the project
-        format_=mlrun.common.schemas.PipelinesFormat.summary,
-    )
-    await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
-        mlrun.common.schemas.AuthorizationResourceTypes.pipeline,
-        run["run"]["project"],
-        run["run"]["id"],
-        mlrun.common.schemas.AuthorizationAction.read,
-        auth_info,
-    )
-    return run
```

## mlrun/api/api/endpoints/projects.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/runs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import datetime
 from http import HTTPStatus
 from typing import List
 
-from fastapi import APIRouter, Depends, Query, Request
+from fastapi import APIRouter, Body, Depends, Query, Request, Response
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.singletons.project_member
 import mlrun.common.schemas
@@ -279,7 +279,47 @@
         name,
         project,
         labels,
         state,
         days_ago,
     )
     return {}
+
+
+@router.put(
+    "/projects/{project}/runs/{uid}/notifications",
+    status_code=HTTPStatus.OK.value,
+)
+async def set_run_notifications(
+    project: str,
+    uid: str,
+    set_notifications_request: mlrun.common.schemas.SetNotificationRequest = Body(...),
+    auth_info: mlrun.common.schemas.AuthInfo = Depends(
+        mlrun.api.api.deps.authenticate_request
+    ),
+    db_session: Session = Depends(mlrun.api.api.deps.get_db_session),
+):
+    await run_in_threadpool(
+        mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
+        db_session,
+        project,
+        auth_info=auth_info,
+    )
+
+    # check permission per object type
+    await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
+        mlrun.common.schemas.AuthorizationResourceTypes.run,
+        project,
+        resource_name=uid,
+        action=mlrun.common.schemas.AuthorizationAction.update,
+        auth_info=auth_info,
+    )
+
+    await run_in_threadpool(
+        mlrun.api.crud.Notifications().set_object_notifications,
+        db_session,
+        auth_info,
+        project,
+        set_notifications_request.notifications,
+        mlrun.common.schemas.RunIdentifier(uid=uid),
+    )
+    return Response(status_code=HTTPStatus.OK.value)
```

## mlrun/api/api/endpoints/runtime_resources.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/schedules.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,14 +16,15 @@
 
 import fastapi
 from fastapi import APIRouter, Depends, Response
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.utils
+import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.singletons.project_member
 import mlrun.common.schemas
 from mlrun.api.api import deps
 from mlrun.api.utils.singletons.scheduler import get_scheduler
 from mlrun.utils import logger
@@ -301,7 +302,64 @@
             project=project,
         )
         chief_client = mlrun.api.utils.clients.chief.Client()
         return await chief_client.delete_schedules(project=project, request=request)
 
     await run_in_threadpool(get_scheduler().delete_schedules, db_session, project)
     return Response(status_code=HTTPStatus.NO_CONTENT.value)
+
+
+@router.put("/{name}/notifications", status_code=HTTPStatus.OK.value)
+async def set_schedule_notifications(
+    project: str,
+    name: str,
+    request: fastapi.Request,
+    set_notifications_request: mlrun.common.schemas.SetNotificationRequest = fastapi.Body(
+        ...
+    ),
+    auth_info: mlrun.common.schemas.AuthInfo = fastapi.Depends(
+        mlrun.api.api.deps.authenticate_request
+    ),
+    db_session: Session = fastapi.Depends(mlrun.api.api.deps.get_db_session),
+):
+    await fastapi.concurrency.run_in_threadpool(
+        mlrun.api.utils.singletons.project_member.get_project_member().ensure_project,
+        db_session,
+        project,
+        auth_info=auth_info,
+    )
+
+    # check permission per object type
+    await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
+        mlrun.common.schemas.AuthorizationResourceTypes.schedule,
+        project,
+        resource_name=name,
+        action=mlrun.common.schemas.AuthorizationAction.update,
+        auth_info=auth_info,
+    )
+
+    if (
+        mlrun.mlconf.httpdb.clusterization.role
+        != mlrun.common.schemas.ClusterizationRole.chief
+    ):
+        logger.info(
+            "Requesting to set schedule notifications, re-routing to chief",
+            project=project,
+            schedule=set_notifications_request.dict(),
+        )
+        chief_client = mlrun.api.utils.clients.chief.Client()
+        return await chief_client.set_schedule_notifications(
+            project=project,
+            schedule_name=name,
+            request=request,
+            json=set_notifications_request.dict(),
+        )
+
+    await fastapi.concurrency.run_in_threadpool(
+        mlrun.api.crud.Notifications().set_object_notifications,
+        db_session,
+        auth_info,
+        project,
+        set_notifications_request.notifications,
+        mlrun.common.schemas.ScheduleIdentifier(name=name),
+    )
+    return fastapi.Response(status_code=HTTPStatus.OK.value)
```

## mlrun/api/api/endpoints/secrets.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/submit.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,14 +19,15 @@
 from fastapi import APIRouter, Depends, Header, Request
 from sqlalchemy.orm import Session
 
 import mlrun.api.api.utils
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.chief
 import mlrun.api.utils.singletons.project_member
+import mlrun.common.helpers
 import mlrun.common.schemas
 import mlrun.utils.helpers
 from mlrun.api.api import deps
 from mlrun.utils import logger
 
 router = APIRouter()
 
@@ -64,15 +65,15 @@
     function_dict, function_url, task = mlrun.api.api.utils.parse_submit_run_body(data)
     if function_url and "://" not in function_url:
         (
             function_project,
             function_name,
             _,
             _,
-        ) = mlrun.utils.helpers.parse_versioned_object_uri(function_url)
+        ) = mlrun.common.helpers.parse_versioned_object_uri(function_url)
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_resource_permissions(
             mlrun.common.schemas.AuthorizationResourceTypes.function,
             function_project,
             function_name,
             mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
```

## mlrun/api/api/endpoints/tags.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/internal/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/internal/config.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/api/endpoints/internal/memory_reports.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/artifacts.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/client_spec.py

```diff
@@ -1,25 +1,26 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
+import mlrun.api.utils.runtimes.nuclio
 import mlrun.common.schemas
 import mlrun.utils.singleton
 from mlrun.config import Config, config, default_config
-from mlrun.runtimes.utils import resolve_mpijob_crd_version, resolve_nuclio_version
+from mlrun.runtimes.utils import resolve_mpijob_crd_version
 
 
 class ClientSpec(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     def get_client_spec(
         self, client_version: str = None, client_python_version: str = None
@@ -40,15 +41,15 @@
                 config.kfp_image, client_version, client_python_version
             ),
             kfp_url=config.resolve_kfp_url(),
             dask_kfp_image=self._resolve_image_by_client_versions(
                 config.dask_kfp_image, client_version, client_python_version
             ),
             api_url=config.httpdb.api_url,
-            nuclio_version=resolve_nuclio_version(),
+            nuclio_version=mlrun.api.utils.runtimes.nuclio.resolve_nuclio_version(),
             spark_operator_version=config.spark_operator_version,
             calculate_artifact_hash=config.artifacts.calculate_hash,
             generate_artifact_target_path_from_artifact_hash=config.artifacts.generate_target_path_from_artifact_hash,
             redis_url=config.redis.url,
             redis_type=config.redis.type,
             sql_url=config.sql.url,
             # These don't have a default value, but we don't send them if they are not set to allow the client to know
```

## mlrun/api/crud/clusterization_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/feature_store.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -31,14 +31,17 @@
     def create_feature_set(
         self,
         db_session: sqlalchemy.orm.Session,
         project: str,
         feature_set: mlrun.common.schemas.FeatureSet,
         versioned: bool = True,
     ) -> str:
+        if not feature_set.spec.engine:
+            feature_set.spec.engine = "storey"
+
         return self._create_object(
             db_session,
             project,
             feature_set,
             versioned,
         )
 
@@ -48,14 +51,22 @@
         project: str,
         name: str,
         feature_set: mlrun.common.schemas.FeatureSet,
         tag: typing.Optional[str] = None,
         uid: typing.Optional[str] = None,
         versioned: bool = True,
     ) -> str:
+        if not feature_set.spec.engine:
+            feature_set.spec.engine = "storey"
+
+        if not feature_set.status.state:
+            feature_set.status.state = (
+                mlrun.common.schemas.object.ObjectStatusState.CREATED
+            )
+
         return self._store_object(
             db_session,
             project,
             name,
             feature_set,
             tag,
             uid,
```

## mlrun/api/crud/functions.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/hub.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/logs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/notifications.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,36 +13,38 @@
 # limitations under the License.
 #
 import typing
 
 import sqlalchemy.orm
 
 import mlrun.api.api.utils
+import mlrun.api.db.sqldb.db
+import mlrun.api.utils.scheduler
 import mlrun.api.utils.singletons.db
+import mlrun.api.utils.singletons.scheduler
+import mlrun.common.schemas
 import mlrun.utils.singleton
 
 
 class Notifications(
     metaclass=mlrun.utils.singleton.Singleton,
 ):
     def store_run_notifications(
         self,
         session: sqlalchemy.orm.Session,
         notification_objects: typing.List[mlrun.model.Notification],
         run_uid: str,
         project: str = None,
     ):
         project = project or mlrun.mlconf.default_project
-        notification_objects_to_store = []
-        for notification_object in notification_objects:
-            notification_objects_to_store.append(
-                mlrun.api.api.utils.mask_notification_params_with_secret(
-                    project, run_uid, notification_object
-                )
+        notification_objects_to_store = (
+            mlrun.api.api.utils.validate_and_mask_notification_list(
+                notification_objects, run_uid, project
             )
+        )
 
         mlrun.api.utils.singletons.db.get_db().store_run_notifications(
             session, notification_objects_to_store, run_uid, project
         )
 
     def list_run_notifications(
         self,
@@ -74,7 +76,74 @@
             # unique constraint on name, run_uid, project, so the list will contain one item at most
             notification = notifications[0]
             mlrun.api.api.utils.delete_notification_params_secret(project, notification)
 
         mlrun.api.utils.singletons.db.get_db().delete_run_notifications(
             session, name, run_uid, project
         )
+
+    @staticmethod
+    def set_object_notifications(
+        db_session: sqlalchemy.orm.Session,
+        auth_info: mlrun.common.schemas.AuthInfo,
+        project: str,
+        notifications: typing.List[mlrun.common.schemas.Notification],
+        notification_parent: typing.Union[
+            mlrun.common.schemas.RunIdentifier, mlrun.common.schemas.ScheduleIdentifier
+        ],
+    ):
+        """
+        Sets notifications on given object (run or schedule, might be extended in the future).
+        This will replace any existing notifications.
+        :param db_session: DB session
+        :param auth_info: Authorization info
+        :param project: Project name
+        :param notifications: List of notifications to set
+        :param notification_parent: Identifier of the object on which to set the notifications
+        """
+        set_notification_methods = {
+            "run": {
+                "factory": mlrun.api.utils.singletons.db.get_db,
+                "method_name": mlrun.api.db.sqldb.db.SQLDB.set_run_notifications.__name__,
+                "identifier_key": "uid",
+            },
+            "schedule": {
+                "factory": mlrun.api.utils.singletons.scheduler.get_scheduler,
+                "method_name": mlrun.api.utils.scheduler.Scheduler.set_schedule_notifications.__name__,
+                "identifier_key": "name",
+            },
+        }
+
+        set_notification_method = set_notification_methods.get(
+            notification_parent.kind, {}
+        )
+        factory = set_notification_method.get("factory")
+        if not factory:
+            raise mlrun.errors.MLRunNotFoundError(
+                f"couldn't find factory for object kind: {notification_parent.kind}"
+            )
+        set_func = set_notification_method.get("method_name")
+        if not set_func:
+            raise mlrun.errors.MLRunNotFoundError(
+                f"couldn't find set notification function for object kind: {notification_parent.kind}"
+            )
+        identifier_key = set_notification_method.get("identifier_key")
+        if not identifier_key:
+            raise mlrun.errors.MLRunNotFoundError(
+                f"couldn't find identifier key for object kind: {notification_parent.kind}"
+            )
+
+        notification_objects_to_set = (
+            mlrun.api.api.utils.validate_and_mask_notification_list(
+                notifications,
+                getattr(notification_parent, identifier_key),
+                project,
+            )
+        )
+
+        getattr(factory(), set_func)(
+            session=db_session,
+            project=project,
+            notifications=notification_objects_to_set,
+            identifier=notification_parent,
+            auth_info=auth_info,
+        )
```

## mlrun/api/crud/pipelines.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,18 +16,20 @@
 import http
 import json
 import tempfile
 import traceback
 import typing
 
 import kfp
+import kfp_server_api
 import sqlalchemy.orm
 
 import mlrun
 import mlrun.api.api.utils
+import mlrun.common.helpers
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.kfpops
 import mlrun.utils.helpers
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
@@ -54,20 +56,16 @@
         if format_ == mlrun.common.schemas.PipelinesFormat.summary:
             # we don't support summary format in list pipelines since the returned runs doesn't include the workflow
             # manifest status that includes the nodes section we use to generate the DAG.
             # (There is a workflow manifest under the run's pipeline_spec field, but it doesn't include the status)
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "Summary format is not supported for list pipelines, use get instead"
             )
-        kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
-        if not kfp_url:
-            raise mlrun.errors.MLRunNotFoundError(
-                "KubeFlow Pipelines is not configured"
-            )
-        kfp_client = kfp.Client(host=kfp_url)
+
+        kfp_client = self.initialize_kfp_client(namespace)
         if project != "*":
             run_dicts = []
             while page_token is not None:
                 # kfp doesn't allow us to pass both a page_token and the filter. When we have a token from previous
                 # call, we will strip out the filter and use the token to continue (the token contains the details of
                 # the filter that was used to create it)
                 response = kfp_client._run_api.list_runs(
@@ -97,42 +95,69 @@
             runs = [run.to_dict() for run in response.runs or []]
             total_size = response.total_size
             next_page_token = response.next_page_token
         runs = self._format_runs(db_session, runs, format_)
 
         return total_size, next_page_token, runs
 
+    def delete_pipelines_runs(self, db_session: sqlalchemy.orm.Session, project: str):
+        _, _, project_pipeline_runs = self.list_pipelines(
+            db_session=db_session,
+            project=project,
+            format_=mlrun.common.schemas.PipelinesFormat.metadata_only,
+        )
+        kfp_client = self.initialize_kfp_client()
+
+        if project_pipeline_runs:
+            logger.debug(
+                "Detected pipeline runs for project, deleting them",
+                project=project,
+                pipeline_run_ids=[run["id"] for run in project_pipeline_runs],
+            )
+
+        for pipeline_run in project_pipeline_runs:
+            try:
+                # delete pipeline run also terminates it if it is in progress
+                kfp_client._run_api.delete_run(pipeline_run["id"])
+            except Exception as exc:
+                # we don't want to fail the entire delete operation if we failed to delete a single pipeline run
+                # so it won't fail the delete project operation. we will log the error and continue
+                logger.warning(
+                    "Failed to delete pipeline run",
+                    project=project,
+                    pipeline_run_id=pipeline_run["id"],
+                    exc_info=exc,
+                )
+        logger.debug("Finished deleting pipeline runs", project=project)
+
     def get_pipeline(
         self,
         db_session: sqlalchemy.orm.Session,
         run_id: str,
         project: typing.Optional[str] = None,
         namespace: typing.Optional[str] = None,
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.summary,
     ):
-        kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
-        if not kfp_url:
-            raise mlrun.errors.MLRunBadRequestError(
-                "KubeFlow Pipelines is not configured"
-            )
-        kfp_client = kfp.Client(host=kfp_url)
+        kfp_client = self.initialize_kfp_client(namespace)
         run = None
         try:
             api_run_detail = kfp_client.get_run(run_id)
             if api_run_detail.run:
                 run = api_run_detail.to_dict()["run"]
                 if project and project != "*":
                     run_project = self.resolve_project_from_pipeline(run)
                     if run_project != project:
                         raise mlrun.errors.MLRunNotFoundError(
                             f"Pipeline run with id {run_id} is not of project {project}"
                         )
                 run = self._format_run(
                     db_session, run, format_, api_run_detail.to_dict()
                 )
+        except kfp_server_api.ApiException as exc:
+            mlrun.errors.raise_for_status_code(int(exc.status), err_to_str(exc))
         except mlrun.errors.MLRunHTTPStatusError:
             raise
         except Exception as exc:
             raise mlrun.errors.MLRunRuntimeError(
                 f"Failed getting kfp run: {err_to_str(exc)}"
             ) from exc
 
@@ -156,34 +181,28 @@
         else:
             mlrun.api.api.utils.log_and_raise(
                 http.HTTPStatus.BAD_REQUEST.value,
                 reason=f"unsupported pipeline type {content_type}",
             )
 
         logger.debug("Writing pipeline to temp file", content_type=content_type)
-        print(str(data))
 
         pipeline_file = tempfile.NamedTemporaryFile(suffix=content_type)
         with open(pipeline_file.name, "wb") as fp:
             fp.write(data)
 
         logger.info(
             "Creating pipeline",
             experiment_name=experiment_name,
             run_name=run_name,
             arguments=arguments,
         )
 
         try:
-            kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
-            if not kfp_url:
-                raise mlrun.errors.MLRunBadRequestError(
-                    "KubeFlow Pipelines is not configured"
-                )
-            kfp_client = kfp.Client(host=kfp_url)
+            kfp_client = self.initialize_kfp_client(namespace)
             experiment = kfp_client.create_experiment(name=experiment_name)
             run = kfp_client.run_pipeline(
                 experiment.id, run_name, pipeline_file.name, params=arguments
             )
         except Exception as exc:
             logger.warning(
                 "Failed creating pipeline",
@@ -194,14 +213,23 @@
                 f"Failed creating pipeline: {err_to_str(exc)}"
             )
         finally:
             pipeline_file.close()
 
         return run
 
+    @staticmethod
+    def initialize_kfp_client(namespace: typing.Optional[str] = None) -> kfp.Client:
+        kfp_url = mlrun.mlconf.resolve_kfp_url(namespace)
+        if not kfp_url:
+            raise mlrun.errors.MLRunNotFoundError(
+                "KubeFlow Pipelines is not configured"
+            )
+        return kfp.Client(host=kfp_url)
+
     def _format_runs(
         self,
         db_session: sqlalchemy.orm.Session,
         runs: typing.List[dict],
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
     ) -> typing.List[dict]:
         formatted_runs = []
@@ -216,30 +244,16 @@
         format_: mlrun.common.schemas.PipelinesFormat = mlrun.common.schemas.PipelinesFormat.metadata_only,
         api_run_detail: typing.Optional[dict] = None,
     ) -> dict:
         run["project"] = self.resolve_project_from_pipeline(run)
         if format_ == mlrun.common.schemas.PipelinesFormat.full:
             return run
         elif format_ == mlrun.common.schemas.PipelinesFormat.metadata_only:
-            return {
-                k: str(v)
-                for k, v in run.items()
-                if k
-                in [
-                    "id",
-                    "name",
-                    "project",
-                    "status",
-                    "error",
-                    "created_at",
-                    "scheduled_at",
-                    "finished_at",
-                    "description",
-                ]
-            }
+            return mlrun.utils.helpers.format_run(run, with_project=True)
+
         elif format_ == mlrun.common.schemas.PipelinesFormat.name_only:
             return run.get("name")
         elif format_ == mlrun.common.schemas.PipelinesFormat.summary:
             if not api_run_detail:
                 raise mlrun.errors.MLRunRuntimeError(
                     "The full kfp api_run_detail object is needed to generate the summary format"
                 )
@@ -273,15 +287,15 @@
                     function_url = command[index + 1]
                     if function_url.startswith("db://"):
                         (
                             project,
                             _,
                             _,
                             _,
-                        ) = mlrun.utils.helpers.parse_versioned_object_uri(
+                        ) = mlrun.common.helpers.parse_versioned_object_uri(
                             function_url[len("db://") :]
                         )
                         if project:
                             return project
         if has_runtime_flags:
             for index, argument in enumerate(command):
                 if (argument == "-r" or argument == "--runtime") and index + 1 < len(
@@ -299,15 +313,14 @@
                             project = parsed_runtime.get("metadata", {}).get("project")
                             if project:
                                 return project
 
         return None
 
     def resolve_project_from_pipeline(self, pipeline):
-
         workflow_manifest = json.loads(
             pipeline.get("pipeline_spec", {}).get("workflow_manifest") or "{}"
         )
         return self.resolve_project_from_workflow_manifest(workflow_manifest)
 
     def resolve_project_from_workflow_manifest(self, workflow_manifest):
         templates = workflow_manifest.get("spec", {}).get("templates", [])
```

## mlrun/api/crud/projects.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,26 +19,27 @@
 
 import fastapi.concurrency
 import humanfriendly
 import sqlalchemy.orm
 
 import mlrun.api.crud
 import mlrun.api.db.session
-import mlrun.api.utils.projects.remotes.follower
+import mlrun.api.utils.events.events_factory as events_factory
+import mlrun.api.utils.projects.remotes.follower as project_follower
 import mlrun.api.utils.singletons.db
 import mlrun.api.utils.singletons.k8s
 import mlrun.api.utils.singletons.scheduler
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Projects(
-    mlrun.api.utils.projects.remotes.follower.Member,
+    project_follower.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def __init__(self) -> None:
         super().__init__()
         self._cache = {
             "project_resources_counters": {"value": None, "ttl": datetime.datetime.min}
         }
@@ -154,14 +155,19 @@
 
         # delete runtime resources
         mlrun.api.crud.RuntimeResources().delete_runtime_resources(
             session,
             label_selector=f"mlrun/project={name}",
             force=True,
         )
+        if mlrun.mlconf.resolve_kfp_url():
+            logger.debug("Removing KFP pipelines runs for project", project=name)
+            mlrun.api.crud.pipelines.Pipelines().delete_pipelines_runs(
+                db_session=session, project=name
+            )
 
         # log collector service will delete the logs, so we don't need to do it here
         if (
             mlrun.mlconf.log_collector.mode
             == mlrun.common.schemas.LogsCollectorMode.legacy
         ):
             mlrun.api.crud.Logs().delete_logs(name)
@@ -172,17 +178,37 @@
         )
 
         # delete model monitoring resources
         mlrun.api.crud.ModelEndpoints().delete_model_endpoints_resources(name)
 
         # delete project secrets - passing None will delete all secrets
         if mlrun.mlconf.is_api_running_on_k8s():
-            mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
-                name, None
+            secrets = None
+            (
+                secret_name,
+                action,
+            ) = mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
+                name, secrets
             )
+            if action:
+                events_client = events_factory.EventsFactory().get_events_client()
+                events_client.emit(
+                    events_client.generate_project_secret_event(
+                        name,
+                        secret_name,
+                        action=action,
+                    )
+                )
+
+            else:
+                logger.debug(
+                    "No project secrets to delete",
+                    action=action,
+                    secret_name=secret_name,
+                )
 
     def get_project(
         self, session: sqlalchemy.orm.Session, name: str
     ) -> mlrun.common.schemas.Project:
         return mlrun.api.utils.singletons.db.get_db().get_project(session, name)
 
     def list_projects(
```

## mlrun/api/crud/runs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/runtime_resources.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/secrets.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,16 @@
 # limitations under the License.
 #
 import enum
 import json
 import typing
 import uuid
 
+import mlrun.api.utils.clients.iguazio
+import mlrun.api.utils.events.events_factory as events_factory
 import mlrun.api.utils.singletons.k8s
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 import mlrun.utils.vault
@@ -99,17 +101,32 @@
             mlrun.utils.vault.init_project_vault_configuration(project)
 
             # If no secrets were passed, no need to touch the actual secrets.
             if secrets_to_store:
                 mlrun.utils.vault.store_vault_project_secrets(project, secrets_to_store)
         elif secrets.provider == mlrun.common.schemas.SecretProviderName.kubernetes:
             if mlrun.api.utils.singletons.k8s.get_k8s_helper():
-                mlrun.api.utils.singletons.k8s.get_k8s_helper().store_project_secrets(
+                (
+                    secret_name,
+                    action,
+                ) = mlrun.api.utils.singletons.k8s.get_k8s_helper().store_project_secrets(
                     project, secrets_to_store
                 )
+                secret_keys = [secret_name for secret_name in secrets_to_store.keys()]
+
+                if action:
+                    events_client = events_factory.EventsFactory().get_events_client()
+                    event = events_client.generate_project_secret_event(
+                        project=project,
+                        secret_name=secret_name,
+                        secret_keys=secret_keys,
+                        action=action,
+                    )
+                    events_client.emit(event)
+
             else:
                 raise mlrun.errors.MLRunInternalServerError(
                     "K8s provider cannot be initialized"
                 )
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Provider requested is not supported. provider = {secrets.provider}"
@@ -138,18 +155,25 @@
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Storing auth secret is not implemented for provider {secret.provider}"
             )
         if not mlrun.api.utils.singletons.k8s.get_k8s_helper():
             raise mlrun.errors.MLRunInternalServerError(
                 "K8s provider cannot be initialized"
             )
-        return mlrun.api.utils.singletons.k8s.get_k8s_helper().store_auth_secret(
+
+        # ignore the returned action as we don't need to emit an event for auth secrets (they are internal)
+        (
+            auth_secret_name,
+            _,
+        ) = mlrun.api.utils.singletons.k8s.get_k8s_helper().store_auth_secret(
             secret.username, secret.access_key
         )
 
+        return auth_secret_name
+
     def delete_auth_secret(
         self,
         provider: mlrun.common.schemas.SecretProviderName,
         secret_name: str,
     ):
         if provider != mlrun.common.schemas.SecretProviderName.kubernetes:
             raise mlrun.errors.MLRunInvalidArgumentError(
@@ -188,17 +212,31 @@
 
         if provider == mlrun.common.schemas.SecretProviderName.vault:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Delete secret is not implemented for provider {provider}"
             )
         elif provider == mlrun.common.schemas.SecretProviderName.kubernetes:
             if mlrun.api.utils.singletons.k8s.get_k8s_helper():
-                mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
+                (
+                    secret_name,
+                    action,
+                ) = mlrun.api.utils.singletons.k8s.get_k8s_helper().delete_project_secrets(
                     project, secrets
                 )
+
+                if action:
+                    events_client = events_factory.EventsFactory().get_events_client()
+                    event = events_client.generate_project_secret_event(
+                        project=project,
+                        secret_name=secret_name,
+                        secret_keys=secrets,
+                        action=action,
+                    )
+                    events_client.emit(event)
+
             else:
                 raise mlrun.errors.MLRunInternalServerError(
                     "K8s provider cannot be initialized"
                 )
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"Provider requested is not supported. provider = {provider}"
```

## mlrun/api/crud/tags.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/model_monitoring/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,8 +10,9 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 # flake8: noqa: F401 - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
+from .helpers import get_stream_path
 from .model_endpoints import ModelEndpoints
```

## mlrun/api/crud/model_monitoring/grafana.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,22 +16,20 @@
 from typing import Any, Dict, List, Optional, Set
 
 import numpy as np
 import pandas as pd
 from fastapi.concurrency import run_in_threadpool
 from sqlalchemy.orm import Session
 
-import mlrun.api.crud
 import mlrun.api.utils.auth.verifier
-import mlrun.common.model_monitoring
 import mlrun.common.schemas
 from mlrun.api.utils.singletons.project_member import get_project_member
+from mlrun.common.model_monitoring.helpers import parse_model_endpoint_store_prefix
 from mlrun.errors import MLRunBadRequestError
 from mlrun.utils import config, logger
-from mlrun.utils.model_monitoring import parse_model_endpoint_store_prefix
 from mlrun.utils.v3io_clients import get_frames_client
 
 
 def grafana_list_projects(
     db_session: Session,
     auth_info: mlrun.common.schemas.AuthInfo,
     query_parameters: Dict[str, str],
@@ -51,23 +49,22 @@
         db_session,
         format_=mlrun.common.schemas.ProjectsFormat.name_only,
         leader_session=auth_info.session,
     )
     return projects_output.projects
 
 
-# TODO: remove in 1.5.0 the following functions: grafana_list_endpoints, grafana_individual_feature_analysis,
-#  grafana_overall_feature_analysis, grafana_income_features, parse_query_parameters, drop_grafana_escape_chars,
+# The following functions were not removed due to backward compatibility that is related to iguazio version <= 3.5.2
 
 
 async def grafana_list_endpoints(
     body: Dict[str, Any],
     query_parameters: Dict[str, str],
     auth_info: mlrun.common.schemas.AuthInfo,
-) -> List[mlrun.common.schemas.GrafanaTable]:
+) -> List[mlrun.common.schemas.model_monitoring.grafana.GrafanaTable]:
     project = query_parameters.get("project")
 
     # Filters
     model = query_parameters.get("model", None)
     function = query_parameters.get("function", None)
     labels = query_parameters.get("labels", "")
     labels = labels.split(",") if labels else []
@@ -76,14 +73,17 @@
     metrics = query_parameters.get("metrics", "")
     metrics = metrics.split(",") if metrics else []
 
     # Time range for metrics
     start = body.get("rangeRaw", {}).get("start", "now-1h")
     end = body.get("rangeRaw", {}).get("end", "now")
 
+    # Endpoint type filter - will be used to filter the router models
+    filter_router = query_parameters.get("filter_router", None)
+
     if project:
         await mlrun.api.utils.auth.verifier.AuthVerifier().query_project_permissions(
             project,
             mlrun.common.schemas.AuthorizationAction.read,
             auth_info,
         )
     endpoint_list = await run_in_threadpool(
@@ -105,58 +105,86 @@
             _endpoint.metadata.uid,
         ),
         auth_info,
     )
     endpoint_list.endpoints = allowed_endpoints
 
     columns = [
-        mlrun.common.schemas.GrafanaColumn(text="endpoint_id", type="string"),
-        mlrun.common.schemas.GrafanaColumn(text="endpoint_function", type="string"),
-        mlrun.common.schemas.GrafanaColumn(text="endpoint_model", type="string"),
-        mlrun.common.schemas.GrafanaColumn(text="endpoint_model_class", type="string"),
-        mlrun.common.schemas.GrafanaColumn(text="first_request", type="time"),
-        mlrun.common.schemas.GrafanaColumn(text="last_request", type="time"),
-        mlrun.common.schemas.GrafanaColumn(text="accuracy", type="number"),
-        mlrun.common.schemas.GrafanaColumn(text="error_count", type="number"),
-        mlrun.common.schemas.GrafanaColumn(text="drift_status", type="number"),
-        mlrun.common.schemas.GrafanaColumn(
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="endpoint_id", type="string"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="endpoint_function", type="string"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="endpoint_model", type="string"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="endpoint_model_class", type="string"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="first_request", type="time"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="last_request", type="time"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="accuracy", type="number"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="error_count", type="number"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="drift_status", type="number"
+        ),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
             text="predictions_per_second", type="number"
         ),
-        mlrun.common.schemas.GrafanaColumn(text="latency_avg_1h", type="number"),
+        mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+            text="latency_avg_1h", type="number"
+        ),
     ]
 
-    table = mlrun.common.schemas.GrafanaTable(columns=columns)
+    table = mlrun.common.schemas.model_monitoring.grafana.GrafanaTable(columns=columns)
     for endpoint in endpoint_list.endpoints:
+        if (
+            filter_router
+            and endpoint.status.endpoint_type
+            == mlrun.common.model_monitoring.EndpointType.ROUTER
+        ):
+            continue
         row = [
             endpoint.metadata.uid,
             endpoint.spec.function_uri,
             endpoint.spec.model,
             endpoint.spec.model_class,
             endpoint.status.first_request,
             endpoint.status.last_request,
             "N/A",  # Leaving here for backwards compatibility
             endpoint.status.error_count,
             endpoint.status.drift_status,
         ]
 
         if (
             endpoint.status.metrics
-            and mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
+            and mlrun.common.schemas.model_monitoring.EventKeyMetrics.GENERIC
             in endpoint.status.metrics
         ):
             row.extend(
                 [
                     endpoint.status.metrics[
-                        mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
+                        mlrun.common.schemas.model_monitoring.EventKeyMetrics.GENERIC
                     ][
-                        mlrun.common.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND
+                        mlrun.common.schemas.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND
                     ],
                     endpoint.status.metrics[
-                        mlrun.common.model_monitoring.EventKeyMetrics.GENERIC
-                    ][mlrun.common.model_monitoring.EventLiveStats.LATENCY_AVG_1H],
+                        mlrun.common.schemas.model_monitoring.EventKeyMetrics.GENERIC
+                    ][
+                        mlrun.common.schemas.model_monitoring.EventLiveStats.LATENCY_AVG_1H
+                    ],
                 ]
             )
 
         table.add_row(*row)
 
     return [table]
 
@@ -185,26 +213,46 @@
     )
 
     # Load JSON data from KV, make sure not to fail if a field is missing
     feature_stats = endpoint.status.feature_stats or {}
     current_stats = endpoint.status.current_stats or {}
     drift_measures = endpoint.status.drift_measures or {}
 
-    table = mlrun.common.schemas.GrafanaTable(
+    table = mlrun.common.schemas.model_monitoring.grafana.GrafanaTable(
         columns=[
-            mlrun.common.schemas.GrafanaColumn(text="feature_name", type="string"),
-            mlrun.common.schemas.GrafanaColumn(text="actual_min", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="actual_mean", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="actual_max", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="expected_min", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="expected_mean", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="expected_max", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="tvd", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="hellinger", type="number"),
-            mlrun.common.schemas.GrafanaColumn(text="kld", type="number"),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="feature_name", type="string"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="actual_min", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="actual_mean", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="actual_max", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="expected_min", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="expected_mean", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="expected_max", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="tvd", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="hellinger", type="number"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn(
+                text="kld", type="number"
+            ),
         ]
     )
 
     for feature, base_stat in feature_stats.items():
         current_stat = current_stats.get(feature, {})
         drift_measure = drift_measures.get(feature, {})
 
@@ -242,22 +290,34 @@
         mlrun.api.crud.ModelEndpoints().get_model_endpoint,
         auth_info=auth_info,
         project=project,
         endpoint_id=endpoint_id,
         feature_analysis=True,
     )
 
-    table = mlrun.common.schemas.GrafanaTable(
+    table = mlrun.common.schemas.model_monitoring.grafana.GrafanaTable(
         columns=[
-            mlrun.common.schemas.GrafanaNumberColumn(text="tvd_sum"),
-            mlrun.common.schemas.GrafanaNumberColumn(text="tvd_mean"),
-            mlrun.common.schemas.GrafanaNumberColumn(text="hellinger_sum"),
-            mlrun.common.schemas.GrafanaNumberColumn(text="hellinger_mean"),
-            mlrun.common.schemas.GrafanaNumberColumn(text="kld_sum"),
-            mlrun.common.schemas.GrafanaNumberColumn(text="kld_mean"),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="tvd_sum"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="tvd_mean"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="hellinger_sum"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="hellinger_mean"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="kld_sum"
+            ),
+            mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn(
+                text="kld_mean"
+            ),
         ]
     )
 
     if endpoint.status.drift_measures:
         table.add_row(
             endpoint.status.drift_measures.get("tvd_sum"),
             endpoint.status.drift_measures.get("tvd_mean"),
@@ -327,17 +387,19 @@
         end=end,
     )
 
     data.drop(["endpoint_id"], axis=1, inplace=True, errors="ignore")
     data.index = data.index.astype(np.int64) // 10**6
 
     for feature, indexed_values in data.to_dict().items():
-        target = mlrun.common.schemas.GrafanaTimeSeriesTarget(target=feature)
+        target = mlrun.common.schemas.model_monitoring.grafana.GrafanaTimeSeriesTarget(
+            target=feature
+        )
         for index, value in indexed_values.items():
-            data_point = mlrun.common.schemas.GrafanaDataPoint(
+            data_point = mlrun.common.schemas.model_monitoring.grafana.GrafanaDataPoint(
                 value=float(value), timestamp=index
             )
             target.add_data_point(data_point)
         time_series.append(target)
 
     return time_series
 
@@ -350,15 +412,15 @@
     """
 
     # Try to get the target
     targets = request_body.get("targets", [])
 
     if len(targets) > 1:
         logger.warn(
-            f"The 'targets' list contains more then one element ({len(targets)}), all targets except the first one are "
+            f"The 'targets' list contains more than one element ({len(targets)}), all targets except the first one are "
             f"ignored."
         )
 
     target_obj = targets[0] if targets else {}
     target_query = target_obj.get("target") if target_obj else ""
 
     if not target_query:
```

## mlrun/api/crud/model_monitoring/model_endpoints.py

```diff
@@ -1,44 +1,35 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-import json
+
 import os
 import typing
 import warnings
 
 import sqlalchemy.orm
 
-import mlrun.api.api.endpoints.functions
 import mlrun.api.api.utils
-import mlrun.api.crud.runtimes.nuclio.function
-import mlrun.api.utils.singletons.k8s
+import mlrun.api.crud.model_monitoring.deployment
+import mlrun.api.crud.model_monitoring.helpers
 import mlrun.artifacts
-import mlrun.common.model_monitoring as model_monitoring_constants
-import mlrun.common.schemas
-import mlrun.common.schemas.model_endpoints
-import mlrun.config
-import mlrun.datastore.store_resources
-import mlrun.errors
+import mlrun.common.helpers
+import mlrun.common.schemas.model_monitoring
 import mlrun.feature_store
-import mlrun.model_monitoring.helpers
-import mlrun.utils.helpers
-import mlrun.utils.model_monitoring
-import mlrun.utils.v3io_clients
 from mlrun.model_monitoring.stores import get_model_endpoint_store
 from mlrun.utils import logger
 
 
 class ModelEndpoints:
     """Provide different methods for handling model endpoints such as listing, writing and deleting"""
 
@@ -111,26 +102,27 @@
             if not model_endpoint.status.feature_stats and hasattr(
                 model_obj, "feature_stats"
             ):
                 model_endpoint.status.feature_stats = model_obj.spec.feature_stats
             # Get labels from model object if not found in model endpoint object
             if not model_endpoint.spec.label_names and model_obj.spec.outputs:
                 model_label_names = [
-                    self._clean_feature_name(f.name) for f in model_obj.spec.outputs
+                    mlrun.api.crud.model_monitoring.helpers.clean_feature_name(f.name)
+                    for f in model_obj.spec.outputs
                 ]
                 model_endpoint.spec.label_names = model_label_names
 
             # Get algorithm from model object if not found in model endpoint object
             if not model_endpoint.spec.algorithm and model_obj.spec.algorithm:
                 model_endpoint.spec.algorithm = model_obj.spec.algorithm
 
             # Create monitoring feature set if monitoring found in model endpoint object
             if (
                 model_endpoint.spec.monitoring_mode
-                == mlrun.common.model_monitoring.ModelMonitoringMode.enabled.value
+                == mlrun.common.schemas.model_monitoring.ModelMonitoringMode.enabled.value
             ):
                 monitoring_feature_set = self.create_monitoring_feature_set(
                     model_endpoint, model_obj, db_session, run_db
                 )
                 # Link model endpoint object to feature set URI
                 model_endpoint.status.monitoring_feature_set_uri = (
                     monitoring_feature_set.uri
@@ -139,15 +131,15 @@
         # If feature_stats was either populated by model_uri or by manual input, make sure to keep the names
         # of the features. If feature_names was supplied, replace the names set in feature_stats, otherwise - make
         # sure to keep a clean version of the names
         if model_endpoint.status.feature_stats:
             logger.info("Feature stats found, cleaning feature names")
             if model_endpoint.spec.feature_names:
                 # Validate that the length of feature_stats is equal to the length of feature_names and label_names
-                self._validate_length_features_and_labels(model_endpoint)
+                self._validate_length_features_and_labels(model_endpoint=model_endpoint)
 
                 # Clean feature names in both feature_stats and feature_names
             (
                 model_endpoint.status.feature_stats,
                 model_endpoint.spec.feature_names,
             ) = self._adjust_feature_names_and_stats(model_endpoint=model_endpoint)
 
@@ -166,16 +158,52 @@
         )
         model_endpoint_store.write_model_endpoint(endpoint=model_endpoint.flat_dict())
 
         logger.info("Model endpoint created", endpoint_id=model_endpoint.metadata.uid)
 
         return model_endpoint
 
-    def create_monitoring_feature_set(
+    def patch_model_endpoint(
         self,
+        project: str,
+        endpoint_id: str,
+        attributes: dict,
+    ) -> mlrun.common.schemas.ModelEndpoint:
+        """
+        Update a model endpoint record with a given attributes.
+
+        :param project: The name of the project.
+        :param endpoint_id: The unique id of the model endpoint.
+        :param attributes: Dictionary of attributes that will be used for update the model endpoint. Note that the keys
+                           of the attributes dictionary should exist in the DB table. More details about the model
+                           endpoint available attributes can be found under
+                           :py:class:`~mlrun.common.schemas.ModelEndpoint`.
+
+        :return: A patched `ModelEndpoint` object.
+        """
+
+        # Generate a model endpoint store object and apply the update process
+        model_endpoint_store = get_model_endpoint_store(
+            project=project,
+        )
+        model_endpoint_store.update_model_endpoint(
+            endpoint_id=endpoint_id, attributes=attributes
+        )
+
+        logger.info("Model endpoint table updated", endpoint_id=endpoint_id)
+
+        # Get the patched model endpoint record
+        model_endpoint_record = model_endpoint_store.get_model_endpoint(
+            endpoint_id=endpoint_id,
+        )
+
+        return self._convert_into_model_endpoint_object(endpoint=model_endpoint_record)
+
+    @staticmethod
+    def create_monitoring_feature_set(
         model_endpoint: mlrun.common.schemas.ModelEndpoint,
         model_obj: mlrun.artifacts.ModelArtifact,
         db_session: sqlalchemy.orm.Session,
         run_db: mlrun.db.sqldb.SQLDB,
     ):
         """
         Create monitoring feature set with the relevant parquet target.
@@ -186,31 +214,36 @@
         :param run_db:            A run db instance which will be used for retrieving the feature vector in case
                                   the features are not found in the model object.
 
         :return:                  Feature set object for the monitoring of the current model endpoint.
         """
 
         # Define a new feature set
-        _, serving_function_name, _, _ = mlrun.utils.helpers.parse_versioned_object_uri(
+        (
+            _,
+            serving_function_name,
+            _,
+            _,
+        ) = mlrun.common.helpers.parse_versioned_object_uri(
             model_endpoint.spec.function_uri
         )
 
         model_name = model_endpoint.spec.model.replace(":", "-")
 
         feature_set = mlrun.feature_store.FeatureSet(
             f"monitoring-{serving_function_name}-{model_name}",
-            entities=[model_monitoring_constants.EventFieldType.ENDPOINT_ID],
-            timestamp_key=model_monitoring_constants.EventFieldType.TIMESTAMP,
+            entities=[mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID],
+            timestamp_key=mlrun.common.schemas.model_monitoring.EventFieldType.TIMESTAMP,
             description=f"Monitoring feature set for endpoint: {model_endpoint.spec.model}",
         )
         feature_set.metadata.project = model_endpoint.metadata.project
 
         feature_set.metadata.labels = {
-            model_monitoring_constants.EventFieldType.ENDPOINT_ID: model_endpoint.metadata.uid,
-            model_monitoring_constants.EventFieldType.MODEL_CLASS: model_endpoint.spec.model_class,
+            mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID: model_endpoint.metadata.uid,
+            mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_CLASS: model_endpoint.spec.model_class,
         }
 
         # Add features to the feature set according to the model object
         if model_obj.spec.inputs:
             for feature in model_obj.spec.inputs:
                 feature_set.add_feature(
                     mlrun.feature_store.Feature(
@@ -235,22 +268,22 @@
         else:
             logger.warn(
                 "Could not find any features in the model object and in the Feature Vector"
             )
 
         # Define parquet target for this feature set
         parquet_path = (
-            self._get_monitoring_parquet_path(
+            mlrun.api.crud.model_monitoring.helpers.get_monitoring_parquet_path(
                 db_session=db_session, project=model_endpoint.metadata.project
             )
             + f"/key={model_endpoint.metadata.uid}"
         )
 
         parquet_target = mlrun.datastore.targets.ParquetTarget(
-            model_monitoring_constants.FileTargetKind.PARQUET, parquet_path
+            mlrun.common.schemas.model_monitoring.FileTargetKind.PARQUET, parquet_path
         )
         driver = mlrun.datastore.targets.get_target_driver(parquet_target, feature_set)
 
         feature_set.set_targets(
             [mlrun.datastore.targets.ParquetTarget(path=parquet_path)],
             with_defaults=False,
         )
@@ -264,133 +297,14 @@
             model_endpoint=model_endpoint.spec.model,
             parquet_target=parquet_path,
         )
 
         return feature_set
 
     @staticmethod
-    def _get_monitoring_parquet_path(
-        db_session: sqlalchemy.orm.Session, project: str
-    ) -> str:
-        """Getting model monitoring parquet target for the current project. The parquet target path is based on the
-        project artifact path. If project artifact path is not defined, the parquet target path will be based on MLRun
-        artifact path.
-
-        :param db_session: A session that manages the current dialog with the database. Will be used in this function
-                           to get the project record from DB.
-        :param project:    Project name.
-
-        :return:           Monitoring parquet target path.
-        """
-
-        # Get the artifact path from the project record that was stored in the DB
-        project_obj = mlrun.api.crud.projects.Projects().get_project(
-            session=db_session, name=project
-        )
-        artifact_path = project_obj.spec.artifact_path
-        # Generate monitoring parquet path value
-        parquet_path = mlrun.mlconf.get_model_monitoring_file_target_path(
-            project=project,
-            kind=model_monitoring_constants.FileTargetKind.PARQUET,
-            target="offline",
-            artifact_path=artifact_path,
-        )
-        return parquet_path
-
-    @staticmethod
-    def _validate_length_features_and_labels(model_endpoint):
-        """
-        Validate that the length of feature_stats is equal to the length of `feature_names` and `label_names`
-
-        :param model_endpoint:    An object representing the model endpoint.
-        """
-
-        # Getting the length of label names, feature_names and feature_stats
-        len_of_label_names = (
-            0
-            if not model_endpoint.spec.label_names
-            else len(model_endpoint.spec.label_names)
-        )
-        len_of_feature_names = len(model_endpoint.spec.feature_names)
-        len_of_feature_stats = len(model_endpoint.status.feature_stats)
-
-        if len_of_feature_stats != len_of_feature_names + len_of_label_names:
-            raise mlrun.errors.MLRunInvalidArgumentError(
-                f"The length of model endpoint feature_stats is not equal to the "
-                f"length of model endpoint feature names and labels "
-                f"feature_stats({len_of_feature_stats}), "
-                f"feature_names({len_of_feature_names}),"
-                f"label_names({len_of_label_names}"
-            )
-
-    def _adjust_feature_names_and_stats(
-        self, model_endpoint
-    ) -> typing.Tuple[typing.Dict, typing.List]:
-        """
-        Create a clean matching version of feature names for both `feature_stats` and `feature_names`. Please note that
-        label names exist only in `feature_stats` and `label_names`.
-
-        :param model_endpoint:    An object representing the model endpoint.
-        :return: A tuple of:
-             [0] = Dictionary of feature stats with cleaned names
-             [1] = List of cleaned feature names
-        """
-        clean_feature_stats = {}
-        clean_feature_names = []
-        for i, (feature, stats) in enumerate(
-            model_endpoint.status.feature_stats.items()
-        ):
-            clean_name = self._clean_feature_name(feature)
-            clean_feature_stats[clean_name] = stats
-            # Exclude the label columns from the feature names
-            if (
-                model_endpoint.spec.label_names
-                and clean_name in model_endpoint.spec.label_names
-            ):
-                continue
-            clean_feature_names.append(clean_name)
-        return clean_feature_stats, clean_feature_names
-
-    def patch_model_endpoint(
-        self,
-        project: str,
-        endpoint_id: str,
-        attributes: dict,
-    ) -> mlrun.common.schemas.ModelEndpoint:
-        """
-        Update a model endpoint record with a given attributes.
-
-        :param project: The name of the project.
-        :param endpoint_id: The unique id of the model endpoint.
-        :param attributes: Dictionary of attributes that will be used for update the model endpoint. Note that the keys
-                           of the attributes dictionary should exist in the DB table. More details about the model
-                           endpoint available attributes can be found under
-                           :py:class:`~mlrun.common.schemas.ModelEndpoint`.
-
-        :return: A patched `ModelEndpoint` object.
-        """
-
-        # Generate a model endpoint store object and apply the update process
-        model_endpoint_store = get_model_endpoint_store(
-            project=project,
-        )
-        model_endpoint_store.update_model_endpoint(
-            endpoint_id=endpoint_id, attributes=attributes
-        )
-
-        logger.info("Model endpoint table updated", endpoint_id=endpoint_id)
-
-        # Get the patched model endpoint record
-        model_endpoint_record = model_endpoint_store.get_model_endpoint(
-            endpoint_id=endpoint_id,
-        )
-
-        return self._convert_into_model_endpoint_object(endpoint=model_endpoint_record)
-
-    @staticmethod
     def delete_model_endpoint(
         project: str,
         endpoint_id: str,
     ):
         """
         Delete the record of a given model endpoint based on endpoint id.
 
@@ -532,17 +446,15 @@
             start=start,
             end=end,
             top_level=top_level,
             uids=uids,
         )
 
         # Initialize an empty model endpoints list
-        endpoint_list = mlrun.common.schemas.model_endpoints.ModelEndpointList(
-            endpoints=[]
-        )
+        endpoint_list = mlrun.common.schemas.ModelEndpointList(endpoints=[])
 
         # Generate a model endpoint store object and get a list of model endpoint dictionaries
         endpoint_store = get_model_endpoint_store(
             access_key=auth_info.data_session, project=project
         )
 
         endpoint_dictionary_list = endpoint_store.list_model_endpoints(
@@ -550,15 +462,14 @@
             model=model,
             labels=labels,
             top_level=top_level,
             uids=uids,
         )
 
         for endpoint_dict in endpoint_dictionary_list:
-
             # Convert to `ModelEndpoint` object
             endpoint_obj = self._convert_into_model_endpoint_object(
                 endpoint=endpoint_dict
             )
 
             # If time metrics were provided, retrieve the results from the time series DB
             if metrics:
@@ -571,17 +482,120 @@
                 )
 
             # Add the `ModelEndpoint` object into the model endpoints list
             endpoint_list.endpoints.append(endpoint_obj)
 
         return endpoint_list
 
+    def verify_project_has_no_model_endpoints(self, project_name: str):
+        """Verify that there no  model endpoint records in the DB by trying to list all of the project model endpoints.
+        This method is usually being used during the process of deleting a project.
+
+        :param project_name: project name.
+        """
+        auth_info = mlrun.common.schemas.AuthInfo(
+            data_session=os.getenv("V3IO_ACCESS_KEY")
+        )
+
+        if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
+            return
+
+        endpoints = self.list_model_endpoints(auth_info, project_name)
+        if endpoints.endpoints:
+            raise mlrun.errors.MLRunPreconditionFailedError(
+                f"Project {project_name} can not be deleted since related resources found: model endpoints"
+            )
+
+    @staticmethod
+    def delete_model_endpoints_resources(project_name: str):
+        """
+        Delete all model endpoints resources.
+
+        :param project_name: The name of the project.
+        """
+        auth_info = mlrun.common.schemas.AuthInfo(
+            data_session=os.getenv("V3IO_ACCESS_KEY")
+        )
+
+        # We would ideally base on config.v3io_api but can't for backwards compatibility reasons,
+        # we're using the igz version heuristic
+        if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
+            return
+
+        # Generate a model endpoint store object and get a list of model endpoint dictionaries
+        endpoint_store = get_model_endpoint_store(
+            access_key=auth_info.data_session, project=project_name
+        )
+        endpoints = endpoint_store.list_model_endpoints()
+
+        # Delete model endpoints resources from databases using the model endpoint store object
+        endpoint_store.delete_model_endpoints_resources(endpoints)
+
+    @staticmethod
+    def _validate_length_features_and_labels(
+        model_endpoint: mlrun.common.schemas.ModelEndpoint,
+    ):
+        """
+        Validate that the length of feature_stats is equal to the length of `feature_names` and `label_names`
+
+        :param model_endpoint:    An object representing the model endpoint.
+        """
+
+        # Getting the length of label names, feature_names and feature_stats
+        len_of_label_names = (
+            0
+            if not model_endpoint.spec.label_names
+            else len(model_endpoint.spec.label_names)
+        )
+        len_of_feature_names = len(model_endpoint.spec.feature_names)
+        len_of_feature_stats = len(model_endpoint.status.feature_stats)
+
+        if len_of_feature_stats != len_of_feature_names + len_of_label_names:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                f"The length of model endpoint feature_stats is not equal to the "
+                f"length of model endpoint feature names and labels "
+                f"feature_stats({len_of_feature_stats}), "
+                f"feature_names({len_of_feature_names}),"
+                f"label_names({len_of_label_names}"
+            )
+
+    @staticmethod
+    def _adjust_feature_names_and_stats(
+        model_endpoint,
+    ) -> typing.Tuple[typing.Dict, typing.List]:
+        """
+        Create a clean matching version of feature names for both `feature_stats` and `feature_names`. Please note that
+        label names exist only in `feature_stats` and `label_names`.
+
+        :param model_endpoint:    An object representing the model endpoint.
+        :return: A tuple of:
+             [0] = Dictionary of feature stats with cleaned names
+             [1] = List of cleaned feature names
+        """
+        clean_feature_stats = {}
+        clean_feature_names = []
+        for i, (feature, stats) in enumerate(
+            model_endpoint.status.feature_stats.items()
+        ):
+            clean_name = mlrun.api.crud.model_monitoring.helpers.clean_feature_name(
+                feature
+            )
+            clean_feature_stats[clean_name] = stats
+            # Exclude the label columns from the feature names
+            if (
+                model_endpoint.spec.label_names
+                and clean_name in model_endpoint.spec.label_names
+            ):
+                continue
+            clean_feature_names.append(clean_name)
+        return clean_feature_stats, clean_feature_names
+
     @staticmethod
     def _add_real_time_metrics(
-        model_endpoint_store: mlrun.model_monitoring.stores.ModelEndpointStore,
+        model_endpoint_store: mlrun.model_monitoring.ModelEndpointStore,
         model_endpoint_object: mlrun.common.schemas.ModelEndpoint,
         metrics: typing.List[str] = None,
         start: str = "now-1h",
         end: str = "now",
     ) -> mlrun.common.schemas.ModelEndpoint:
         """Add real time metrics from the time series DB to a provided `ModelEndpoint` object. The real time metrics
            will be stored under `ModelEndpoint.status.metrics.real_time`
@@ -612,359 +626,49 @@
             endpoint_id=model_endpoint_object.metadata.uid,
             start=start,
             end=end,
             metrics=metrics,
         )
         if endpoint_metrics:
             model_endpoint_object.status.metrics[
-                model_monitoring_constants.EventKeyMetrics.REAL_TIME
+                mlrun.common.schemas.model_monitoring.EventKeyMetrics.REAL_TIME
             ] = endpoint_metrics
         return model_endpoint_object
 
+    @staticmethod
     def _convert_into_model_endpoint_object(
-        self, endpoint: typing.Dict[str, typing.Any], feature_analysis: bool = False
+        endpoint: typing.Dict[str, typing.Any], feature_analysis: bool = False
     ) -> mlrun.common.schemas.ModelEndpoint:
         """
         Create a `ModelEndpoint` object according to a provided model endpoint dictionary.
 
-        :param endpoint:         Dictinoary that represents a DB record of a model endpoint which need to be converted
+        :param endpoint:         Dictionary that represents a DB record of a model endpoint which need to be converted
                                  into a valid `ModelEndpoint` object.
         :param feature_analysis: When True, the base feature statistics and current feature statistics will be added to
                                  the output of the resulting object.
 
-        :return: A `ModelEndpoint` object.
+        :return: A `~mlrun.common.schemas.ModelEndpoint` object.
         """
 
         # Convert into `ModelEndpoint` object
         endpoint_obj = mlrun.common.schemas.ModelEndpoint().from_flat_dict(endpoint)
 
         # If feature analysis was applied, add feature stats and current stats to the model endpoint result
         if feature_analysis and endpoint_obj.spec.feature_names:
-
-            endpoint_features = self.get_endpoint_features(
-                feature_names=endpoint_obj.spec.feature_names,
-                feature_stats=endpoint_obj.status.feature_stats,
-                current_stats=endpoint_obj.status.current_stats,
+            endpoint_features = (
+                mlrun.api.crud.model_monitoring.deployment.get_endpoint_features(
+                    feature_names=endpoint_obj.spec.feature_names,
+                    feature_stats=endpoint_obj.status.feature_stats,
+                    current_stats=endpoint_obj.status.current_stats,
+                )
             )
             if endpoint_features:
                 endpoint_obj.status.features = endpoint_features
                 # Add the latest drift measures results (calculated by the model monitoring batch)
-                drift_measures = self._json_loads_if_not_none(
+                drift_measures = mlrun.api.crud.model_monitoring.helpers.json_loads_if_not_none(
                     endpoint.get(
-                        model_monitoring_constants.EventFieldType.DRIFT_MEASURES
+                        mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_MEASURES
                     )
                 )
                 endpoint_obj.status.drift_measures = drift_measures
 
         return endpoint_obj
-
-    @staticmethod
-    def get_endpoint_features(
-        feature_names: typing.List[str],
-        feature_stats: dict = None,
-        current_stats: dict = None,
-    ) -> typing.List[mlrun.common.schemas.Features]:
-        """
-        Getting a new list of features that exist in feature_names along with their expected (feature_stats) and
-        actual (current_stats) stats. The expected stats were calculated during the creation of the model endpoint,
-        usually based on the data from the Model Artifact. The actual stats are based on the results from the latest
-        model monitoring batch job.
-
-        param feature_names: List of feature names.
-        param feature_stats: Dictionary of feature stats that were stored during the creation of the model endpoint
-                             object.
-        param current_stats: Dictionary of the latest stats that were stored during the last run of the model monitoring
-                             batch job.
-
-        return: List of feature objects. Each feature has a name, weight, expected values, and actual values. More info
-                can be found under `mlrun.common.schemas.Features`.
-        """
-
-        # Initialize feature and current stats dictionaries
-        safe_feature_stats = feature_stats or {}
-        safe_current_stats = current_stats or {}
-
-        # Create feature object and add it to a general features list
-        features = []
-        for name in feature_names:
-            if feature_stats is not None and name not in feature_stats:
-                logger.warn("Feature missing from 'feature_stats'", name=name)
-            if current_stats is not None and name not in current_stats:
-                logger.warn("Feature missing from 'current_stats'", name=name)
-            f = mlrun.common.schemas.Features.new(
-                name, safe_feature_stats.get(name), safe_current_stats.get(name)
-            )
-            features.append(f)
-        return features
-
-    @staticmethod
-    def _json_loads_if_not_none(field: typing.Any) -> typing.Any:
-        return (
-            json.loads(field)
-            if field and field != "null" and field is not None
-            else None
-        )
-
-    def deploy_monitoring_functions(
-        self,
-        project: str,
-        model_monitoring_access_key: str,
-        db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.common.schemas.AuthInfo,
-        tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
-    ):
-        """
-        Invoking monitoring deploying functions.
-
-        :param project:                     The name of the project.
-        :param model_monitoring_access_key: Access key to apply the model monitoring process.
-        :param db_session:                  A session that manages the current dialog with the database.
-        :param auth_info:                   The auth info of the request.
-        :param tracking_policy:             Model monitoring configurations.
-        """
-        self.deploy_model_monitoring_stream_processing(
-            project=project,
-            model_monitoring_access_key=model_monitoring_access_key,
-            db_session=db_session,
-            auth_info=auth_info,
-            tracking_policy=tracking_policy,
-        )
-        self.deploy_model_monitoring_batch_processing(
-            project=project,
-            model_monitoring_access_key=model_monitoring_access_key,
-            db_session=db_session,
-            auth_info=auth_info,
-            tracking_policy=tracking_policy,
-        )
-
-    def verify_project_has_no_model_endpoints(self, project_name: str):
-        auth_info = mlrun.common.schemas.AuthInfo(
-            data_session=os.getenv("V3IO_ACCESS_KEY")
-        )
-
-        if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
-            return
-
-        endpoints = self.list_model_endpoints(auth_info, project_name)
-        if endpoints.endpoints:
-            raise mlrun.errors.MLRunPreconditionFailedError(
-                f"Project {project_name} can not be deleted since related resources found: model endpoints"
-            )
-
-    @staticmethod
-    def delete_model_endpoints_resources(project_name: str):
-        """
-        Delete all model endpoints resources.
-
-        :param project_name: The name of the project.
-        """
-        auth_info = mlrun.common.schemas.AuthInfo(
-            data_session=os.getenv("V3IO_ACCESS_KEY")
-        )
-
-        # We would ideally base on config.v3io_api but can't for backwards compatibility reasons,
-        # we're using the igz version heuristic
-        if not mlrun.mlconf.igz_version or not mlrun.mlconf.v3io_api:
-            return
-
-        # Generate a model endpoint store object and get a list of model endpoint dictionaries
-        endpoint_store = get_model_endpoint_store(
-            access_key=auth_info.data_session, project=project_name
-        )
-        endpoints = endpoint_store.list_model_endpoints()
-
-        # Delete model endpoints resources from databases using the model endpoint store object
-        endpoint_store.delete_model_endpoints_resources(endpoints)
-
-    def deploy_model_monitoring_stream_processing(
-        self,
-        project: str,
-        model_monitoring_access_key: str,
-        db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.common.schemas.AuthInfo,
-        tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
-    ):
-        """
-        Deploying model monitoring stream real time nuclio function. The goal of this real time function is
-        to monitor the log of the data stream. It is triggered when a new log entry is detected.
-        It processes the new events into statistics that are then written to statistics databases.
-
-        :param project:                     The name of the project.
-        :param model_monitoring_access_key: Access key to apply the model monitoring process.
-        :param db_session:                  A session that manages the current dialog with the database.
-        :param auth_info:                   The auth info of the request.
-        :param tracking_policy:             Model monitoring configurations.
-        """
-
-        logger.info(
-            "Checking if model monitoring stream is already deployed",
-            project=project,
-        )
-        try:
-            # validate that the model monitoring stream has not yet been deployed
-            mlrun.api.crud.runtimes.nuclio.function.get_nuclio_deploy_status(
-                name="model-monitoring-stream",
-                project=project,
-                tag="",
-                auth_info=auth_info,
-            )
-            logger.info(
-                "Detected model monitoring stream processing function already deployed",
-                project=project,
-            )
-            return
-        except mlrun.errors.MLRunNotFoundError:
-            logger.info(
-                "Deploying model monitoring stream processing function", project=project
-            )
-
-        # Get parquet target value for model monitoring stream function
-        parquet_target = self._get_monitoring_parquet_path(
-            db_session=db_session, project=project
-        )
-
-        fn = mlrun.model_monitoring.helpers.initial_model_monitoring_stream_processing_function(
-            project=project,
-            model_monitoring_access_key=model_monitoring_access_key,
-            tracking_policy=tracking_policy,
-            auth_info=auth_info,
-            parquet_target=parquet_target,
-        )
-
-        mlrun.api.api.endpoints.functions._build_function(
-            db_session=db_session, auth_info=auth_info, function=fn
-        )
-
-    def deploy_model_monitoring_batch_processing(
-        self,
-        project: str,
-        model_monitoring_access_key: str,
-        db_session: sqlalchemy.orm.Session,
-        auth_info: mlrun.common.schemas.AuthInfo,
-        tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
-    ):
-        """
-        Deploying model monitoring batch job. The goal of this job is to identify drift in the data
-        based on the latest batch of events. By default, this job is executed on the hour every hour.
-        Note that if the monitoring batch job was already deployed then you will have to delete the
-        old monitoring batch job before deploying a new one.
-
-        :param project:                     The name of the project.
-        :param model_monitoring_access_key: Access key to apply the model monitoring process.
-        :param db_session:                  A session that manages the current dialog with the database.
-        :param auth_info:                   The auth info of the request.
-        :param tracking_policy:             Model monitoring configurations.
-        """
-
-        logger.info(
-            "Checking if model monitoring batch processing function is already deployed",
-            project=project,
-        )
-
-        # Try to list functions that named model monitoring batch
-        # to make sure that this job has not yet been deployed
-        function_list = mlrun.api.utils.singletons.db.get_db().list_functions(
-            session=db_session, name="model-monitoring-batch", project=project
-        )
-
-        if function_list:
-            logger.info(
-                "Detected model monitoring batch processing function already deployed",
-                project=project,
-            )
-            return
-
-        # Create a monitoring batch job function object
-        fn = mlrun.model_monitoring.helpers.get_model_monitoring_batch_function(
-            project=project,
-            model_monitoring_access_key=model_monitoring_access_key,
-            db_session=db_session,
-            auth_info=auth_info,
-            tracking_policy=tracking_policy,
-        )
-
-        # Get the function uri
-        function_uri = fn.save(versioned=True)
-        function_uri = function_uri.replace("db://", "")
-
-        task = mlrun.new_task(name="model-monitoring-batch", project=project)
-        task.spec.function = function_uri
-
-        # Apply batching interval params
-        interval_list = [
-            tracking_policy.default_batch_intervals.minute,
-            tracking_policy.default_batch_intervals.hour,
-            tracking_policy.default_batch_intervals.day,
-        ]
-        minutes, hours, days = self._get_batching_interval_param(interval_list)
-        batch_dict = {"minutes": minutes, "hours": hours, "days": days}
-
-        task.spec.parameters[
-            model_monitoring_constants.EventFieldType.BATCH_INTERVALS_DICT
-        ] = batch_dict
-
-        data = {
-            "task": task.to_dict(),
-            "schedule": self._convert_to_cron_string(
-                tracking_policy.default_batch_intervals
-            ),
-        }
-
-        logger.info(
-            "Deploying model monitoring batch processing function", project=project
-        )
-
-        # Add job schedule policy (every hour by default)
-        mlrun.api.api.utils.submit_run_sync(
-            db_session=db_session, auth_info=auth_info, data=data
-        )
-
-    @staticmethod
-    def _clean_feature_name(feature_name):
-        return feature_name.replace(" ", "_").replace("(", "").replace(")", "")
-
-    @staticmethod
-    def get_access_key(auth_info: mlrun.common.schemas.AuthInfo):
-        """
-        Getting access key from the current data session. This method is usually used to verify that the session
-        is valid and contains an access key.
-
-        param auth_info: The auth info of the request.
-
-        :return: Access key as a string.
-        """
-        access_key = auth_info.data_session
-        if not access_key:
-            raise mlrun.errors.MLRunBadRequestError("Data session is missing")
-        return access_key
-
-    @staticmethod
-    def _get_batching_interval_param(intervals_list: typing.List):
-        """Converting each value in the intervals list into a float number. None
-        Values will be converted into 0.0.
-
-        param intervals_list: A list of values based on the ScheduleCronTrigger expression. Note that at the moment
-                              it supports minutes, hours, and days. e.g. [0, '*/1', None] represents on the hour
-                              every hour.
-
-        :return: A tuple of:
-                 [0] = minutes interval as a float
-                 [1] = hours interval as a float
-                 [2] = days interval as a float
-        """
-        return tuple(
-            [
-                0.0
-                if isinstance(interval, (float, int)) or interval is None
-                else float(f"0{interval.partition('/')[-1]}")
-                for interval in intervals_list
-            ]
-        )
-
-    @staticmethod
-    def _convert_to_cron_string(
-        cron_trigger: mlrun.common.schemas.schedule.ScheduleCronTrigger,
-    ):
-        """Converting the batch interval `ScheduleCronTrigger` into a cron trigger expression"""
-        return "{} {} {} * *".format(
-            cron_trigger.minute, cron_trigger.hour, cron_trigger.day
-        ).replace("None", "*")
```

## mlrun/api/crud/runtimes/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/runtimes/nuclio/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/crud/runtimes/nuclio/function.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -420,14 +420,19 @@
         "spec.serviceType",
         function.spec.service_type or mlrun.mlconf.httpdb.nuclio.default_service_type,
     )
     if function.spec.readiness_timeout:
         nuclio_spec.set_config(
             "spec.readinessTimeoutSeconds", function.spec.readiness_timeout
         )
+    if function.spec.readiness_timeout_before_failure:
+        nuclio_spec.set_config(
+            "spec.waitReadinessTimeoutBeforeFailure",
+            function.spec.readiness_timeout_before_failure,
+        )
     if function.spec.resources:
         nuclio_spec.set_config("spec.resources", function.spec.resources)
 
     # don't send default or any priority class name if nuclio is not compatible
     if (
         function.spec.priority_class_name
         and mlrun.runtimes.function.validate_nuclio_version_compatibility("1.6.18")
```

## mlrun/api/crud/runtimes/nuclio/helpers.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,16 @@
 # limitations under the License.
 #
 import urllib.parse
 
 import semver
 
 import mlrun
+import mlrun.api.utils.clients.nuclio
+import mlrun.api.utils.runtimes.nuclio
 import mlrun.api.utils.singletons.k8s
 import mlrun.runtimes
 from mlrun.utils import logger
 
 
 def resolve_function_http_trigger(function_spec):
     for trigger_name, trigger_config in function_spec.get("triggers", {}).items():
@@ -186,15 +188,17 @@
     """
     Return whether the Nuclio version is in the range, inclusive for min, exclusive for max - [min, max)
     """
     resolved_nuclio_version = None
     try:
         parsed_min_version = semver.VersionInfo.parse(min_version)
         parsed_max_version = semver.VersionInfo.parse(max_version)
-        resolved_nuclio_version = mlrun.runtimes.utils.resolve_nuclio_version()
+        resolved_nuclio_version = (
+            mlrun.api.utils.runtimes.nuclio.resolve_nuclio_version()
+        )
         parsed_current_version = semver.VersionInfo.parse(resolved_nuclio_version)
     except ValueError:
         logger.warning(
             "Unable to parse nuclio version, assuming in range",
             nuclio_version=resolved_nuclio_version,
             min_version=min_version,
             max_version=max_version,
```

## mlrun/api/db/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/db/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -609,7 +609,17 @@
         session,
         name: str = None,
         run_uid: str = None,
         project: str = None,
         commit: bool = True,
     ):
         pass
+
+    def set_run_notifications(
+        self,
+        session,
+        project: str,
+        notifications: typing.List[mlrun.model.Notification],
+        identifiers: typing.List[mlrun.common.schemas.RunIdentifier],
+        **kwargs,
+    ):
+        pass
```

## mlrun/api/db/init_db.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,14 +10,12 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from mlrun.api.db.sqldb.models import Base
-from mlrun.api.db.sqldb.session import get_engine
-from mlrun.config import config
+from mlrun.common.db.sql_session import get_engine
 
 
 def init_db() -> None:
-    if config.httpdb.db_type != "filedb":
-        Base.metadata.create_all(bind=get_engine())
+    Base.metadata.create_all(bind=get_engine())
```

## mlrun/api/db/session.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,15 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from sqlalchemy.orm import Session
 
-from mlrun.api.db.sqldb.session import create_session as sqldb_create_session
+from mlrun.common.db.sql_session import create_session as sqldb_create_session
 
 
 def create_session() -> Session:
     return sqldb_create_session()
 
 
 def close_session(db_session):
```

## mlrun/api/db/sqldb/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/db/sqldb/db.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -78,15 +78,14 @@
     logger,
     update_in,
     validate_artifact_key_name,
     validate_tag_name,
 )
 
 NULL = None  # Avoid flake8 issuing warnings when comparing in filter
-run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
 unversioned_tagged_object_uid_prefix = "unversioned-"
 
 conflict_messages = [
     "(sqlite3.IntegrityError) UNIQUE constraint failed",
     "(pymysql.err.IntegrityError) (1062",
     "(pymysql.err.IntegrityError) (1586",
 ]
@@ -1386,15 +1385,15 @@
             if not tag:
                 tag = obj.Tag(project=project, name=name, obj_name=obj.name)
             tag.obj_id = obj.id
             tags.append(tag)
         self._upsert(session, tags)
 
     def create_project(self, session: Session, project: mlrun.common.schemas.Project):
-        logger.debug("Creating project in DB", project=project)
+        logger.debug("Creating project in DB", project_name=project.metadata.name)
         created = datetime.utcnow()
         project.metadata.created = created
         # TODO: handle taking out the functions/workflows/artifacts out of the project and save them separately
         project_record = Project(
             name=project.metadata.name,
             description=project.spec.description,
             source=project.spec.source,
@@ -1407,15 +1406,22 @@
         update_labels(project_record, labels)
         self._upsert(session, [project_record])
 
     @retry_on_conflict
     def store_project(
         self, session: Session, name: str, project: mlrun.common.schemas.Project
     ):
-        logger.debug("Storing project in DB", name=name, project=project)
+        logger.debug(
+            "Storing project in DB",
+            name=name,
+            project_metadata=project.metadata,
+            project_owner=project.spec.owner,
+            project_desired_state=project.spec.desired_state,
+            project_status=project.status,
+        )
         project_record = self._get_project_record(
             session, name, raise_on_not_found=False
         )
         if not project_record:
             self.create_project(session, project)
         else:
             self._update_project_record_from_project(session, project_record, project)
@@ -1739,15 +1745,15 @@
 
     def _get_project_record(
         self,
         session: Session,
         name: str = None,
         project_id: int = None,
         raise_on_not_found: bool = True,
-    ) -> Project:
+    ) -> typing.Optional[Project]:
         if not any([project_id, name]):
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "One of 'name' or 'project_id' must be provided"
             )
         project_record = self._query(
             session, Project, name=name, id=project_id
         ).one_or_none()
@@ -2282,15 +2288,14 @@
 
     def _update_feature_set_spec(
         self, feature_set: FeatureSet, new_feature_set_dict: dict
     ):
         feature_set_spec = new_feature_set_dict.get("spec")
         features = feature_set_spec.pop("features", [])
         entities = feature_set_spec.pop("entities", [])
-
         self._update_feature_set_features(feature_set, features)
         self._update_feature_set_entities(feature_set, entities)
 
     @staticmethod
     def _common_object_validate_and_perform_uid_change(
         object_dict: dict,
         tag,
@@ -2447,15 +2452,14 @@
         versioned=True,
     ) -> str:
         (uid, tag, feature_set_dict,) = self._validate_and_enrich_record_for_creation(
             session, feature_set, FeatureSet, project, versioned
         )
 
         db_feature_set = FeatureSet(project=project)
-
         self._update_db_record_from_object_dict(db_feature_set, feature_set_dict, uid)
         self._update_feature_set_spec(db_feature_set, feature_set_dict)
 
         self._upsert(session, [db_feature_set])
         self.tag_objects_v2(session, [db_feature_set], project, tag)
 
         return uid
@@ -2857,40 +2861,58 @@
             session.add(object_)
         self._commit(session, objects, ignore)
 
     def _commit(self, session, objects, ignore=False):
         def _try_commit_obj():
             try:
                 session.commit()
-            except SQLAlchemyError as err:
+            except SQLAlchemyError as sql_err:
                 session.rollback()
-                cls = objects[0].__class__.__name__
-                if "database is locked" in str(err):
+                classes = list(set([object_.__class__.__name__ for object_ in objects]))
+
+                # if the database is locked, we raise a retryable error
+                if "database is locked" in str(sql_err):
                     logger.warning(
-                        "Database is locked. Retrying", cls=cls, err=str(err)
+                        "Database is locked. Retrying",
+                        classes_to_commit=classes,
+                        err=str(sql_err),
                     )
                     raise mlrun.errors.MLRunRuntimeError(
                         "Failed committing changes, database is locked"
-                    ) from err
+                    ) from sql_err
+
+                # the error is not retryable, so we try to identify weather there was a conflict or not
+                # either way - we wrap the error with a fatal error so the retry mechanism will stop
                 logger.warning(
-                    "Failed committing changes to DB", cls=cls, err=err_to_str(err)
+                    "Failed committing changes to DB",
+                    classes=classes,
+                    err=err_to_str(sql_err),
                 )
                 if not ignore:
+                    # get the identifiers of the objects that failed to commit, for logging purposes
                     identifiers = ",".join(
                         object_.get_identifier_string() for object_ in objects
                     )
-                    # We want to retry only when database is locked so for any other scenario escalate to fatal failure
+
+                    mlrun_error = mlrun.errors.MLRunRuntimeError(
+                        f"Failed committing changes to DB. classes={classes} objects={identifiers}"
+                    )
+
+                    # check if the error is a conflict error
+                    if any([message in str(sql_err) for message in conflict_messages]):
+                        mlrun_error = mlrun.errors.MLRunConflictError(
+                            f"Conflict - at least one of the objects already exists: {identifiers}"
+                        )
+
+                    # we want to keep the exception stack trace, but we also want the retry mechanism to stop
+                    # so, we raise a new indicative exception from the original sql exception (this keeps
+                    # the stack trace intact), and then wrap it with a fatal error (which stops the retry mechanism).
+                    # Note - this way, the exception is raised from this code section, and not from the retry function.
                     try:
-                        if any([message in str(err) for message in conflict_messages]):
-                            raise mlrun.errors.MLRunConflictError(
-                                f"Conflict - {cls} already exists: {identifiers}"
-                            ) from err
-                        raise mlrun.errors.MLRunRuntimeError(
-                            f"Failed committing changes to DB. class={cls} objects={identifiers}"
-                        ) from err
+                        raise mlrun_error from sql_err
                     except (
                         mlrun.errors.MLRunRuntimeError,
                         mlrun.errors.MLRunConflictError,
                     ) as exc:
                         raise mlrun.errors.MLRunFatalFailureError(
                             original_exception=exc
                         )
@@ -2912,15 +2934,15 @@
         if uid:
             # uid may be either a single uid (string) or a list of uids
             uid = mlrun.utils.helpers.as_list(uid)
             query = query.filter(Run.uid.in_(uid))
         return self._add_labels_filter(session, query, Run, labels)
 
     def _get_db_notifications(
-        self, session, cls, name: str = None, parent_id: int = None, project: str = None
+        self, session, cls, name: str = None, parent_id: str = None, project: str = None
     ):
         return self._query(
             session, cls.Notification, name=name, parent_id=parent_id, project=project
         ).all()
 
     def _latest_uid_filter(self, session, query):
         # Create a sub query of latest uid (by updated) per (project,key)
@@ -3681,14 +3703,20 @@
         db_notifications = {
             notification.name: notification
             for notification in self._get_db_notifications(
                 session, cls, parent_id=parent_id
             )
         }
         notifications = []
+        logger.debug(
+            "Storing notifications",
+            notifications_length=len(notification_objects),
+            parent_id=parent_id,
+            project=project,
+        )
         for notification_model in notification_objects:
             new_notification = False
             notification = db_notifications.get(notification_model.name, None)
             if not notification:
                 new_notification = True
                 notification = cls.Notification(
                     name=notification_model.name, parent_id=parent_id, project=project
@@ -3705,14 +3733,15 @@
                 or mlrun.common.schemas.NotificationStatus.PENDING
             )
             notification.sent_time = notification_model.sent_time
 
             logger.debug(
                 f"Storing {'new' if new_notification else 'existing'} notification",
                 notification_name=notification.name,
+                notification_status=notification.status,
                 parent_id=parent_id,
                 project=project,
             )
             notifications.append(notification)
 
         self._upsert(session, notifications)
 
@@ -3760,7 +3789,49 @@
 
         query = self._get_db_notifications(session, Run, name, run_id, project)
         for notification in query:
             session.delete(notification)
 
         if commit:
             session.commit()
+
+    def set_run_notifications(
+        self,
+        session: Session,
+        project: str,
+        notifications: typing.List[mlrun.model.Notification],
+        identifier: mlrun.common.schemas.RunIdentifier,
+        **kwargs,
+    ):
+        """
+        Set notifications for a run. This will replace any existing notifications.
+        :param session: SQLAlchemy session
+        :param project: Project name
+        :param notifications: List of notifications to set
+        :param identifier: Run identifier
+        :param kwargs: Ignored additional arguments (for interfacing purposes)
+        """
+        run = self._get_run(session, identifier.uid, project, None)
+        if not run:
+            raise mlrun.errors.MLRunNotFoundError(
+                f"Run not found: project={project}, uid={identifier.uid}"
+            )
+
+        run.struct.setdefault("spec", {})["notifications"] = [
+            notification.to_dict() for notification in notifications
+        ]
+
+        # update run, delete and store notifications all in one transaction.
+        # using session.add instead of upsert, so we don't commit the run.
+        # the commit will happen at the end (in store_run_notifications, or manually at the end).
+        session.add(run)
+        self.delete_run_notifications(
+            session, run_uid=run.uid, project=project, commit=False
+        )
+        if notifications:
+            self.store_run_notifications(
+                session,
+                notification_objects=notifications,
+                run_uid=run.uid,
+                project=project,
+            )
+        self._commit(session, [run], ignore=True)
```

## mlrun/api/db/sqldb/helpers.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/db/sqldb/models/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/db/sqldb/models/models_mysql.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2019 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -34,29 +34,31 @@
 
 import mlrun.common.schemas
 import mlrun.utils.db
 from mlrun.api.utils.db.sql_collation import SQLCollationUtil
 
 Base = declarative_base()
 NULL = None  # Avoid flake8 issuing warnings when comparing in filter
-run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
 
 
 def make_label(table):
     class Label(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_labels"
         __table_args__ = (
             UniqueConstraint("name", "parent", name=f"_{table}_labels_uc"),
         )
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         value = Column(String(255, collation=SQLCollationUtil.collation()))
         parent = Column(Integer, ForeignKey(f"{table}.id"))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.parent}/{self.name}/{self.value}"
+
     return Label
 
 
 def make_tag(table):
     class Tag(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_tags"
         __table_args__ = (
@@ -82,14 +84,17 @@
 
         id = Column(Integer, primary_key=True)
         project = Column(String(255, collation=SQLCollationUtil.collation()))
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         obj_id = Column(Integer, ForeignKey(f"{table}.id"))
         obj_name = Column(String(255, collation=SQLCollationUtil.collation()))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.project}/{self.name}"
+
     return Tag
 
 
 def make_notification(table):
     class Notification(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_notifications"
         __table_args__ = (
@@ -254,14 +259,17 @@
         updated = Column(
             sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3),
             default=datetime.now(timezone.utc),
         )
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         timeout = Column(Integer)
 
+        def get_identifier_string(self) -> str:
+            return f"{self.project}/{self.name}"
+
     class Schedule(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "schedules_v2"
         __table_args__ = (UniqueConstraint("project", "name", name="_schedules_v2_uc"),)
 
         Label = make_label(__tablename__)
 
         id = Column(Integer, primary_key=True)
@@ -313,14 +321,17 @@
     class User(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "users"
         __table_args__ = (UniqueConstraint("name", name="_users_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.name}"
+
     class Project(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "projects"
         # For now since we use project name a lot
         __table_args__ = (UniqueConstraint("name", name="_projects_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
@@ -504,14 +515,17 @@
         id = Column(Integer, primary_key=True)
         version = Column(String(255, collation=SQLCollationUtil.collation()))
         created = Column(
             sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3),
             default=datetime.now(timezone.utc),
         )
 
+        def get_identifier_string(self) -> str:
+            return f"{self.version}"
+
 
 # Must be after all table definitions
 _tagged = [cls for cls in Base.__subclasses__() if hasattr(cls, "Tag")]
 _labeled = [cls for cls in Base.__subclasses__() if hasattr(cls, "Label")]
 _with_notifications = [
     cls for cls in Base.__subclasses__() if hasattr(cls, "Notification")
 ]
```

## mlrun/api/db/sqldb/models/models_sqlite.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2019 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -35,29 +35,31 @@
 
 import mlrun.common.schemas
 import mlrun.utils.db
 from mlrun.api.utils.db.sql_collation import SQLCollationUtil
 
 Base = declarative_base()
 NULL = None  # Avoid flake8 issuing warnings when comparing in filter
-run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
 
 
 def make_label(table):
     class Label(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_labels"
         __table_args__ = (
             UniqueConstraint("name", "parent", name=f"_{table}_labels_uc"),
         )
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         value = Column(String(255, collation=SQLCollationUtil.collation()))
         parent = Column(Integer, ForeignKey(f"{table}.id"))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.parent}/{self.name}/{self.value}"
+
     return Label
 
 
 def make_tag(table):
     class Tag(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_tags"
         __table_args__ = (
@@ -86,14 +88,17 @@
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         obj_id = Column(Integer, ForeignKey(f"{table}.id"))
         obj_name = Column(
             String(255, collation=SQLCollationUtil.collation()),
             ForeignKey(f"{table}.name"),
         )
 
+        def get_identifier_string(self) -> str:
+            return f"{self.project}/{self.name}"
+
     return Tag
 
 
 def make_notification(table):
     class Notification(Base, mlrun.utils.db.BaseModel):
         __tablename__ = f"{table}_notifications"
         __table_args__ = (
@@ -238,14 +243,17 @@
             String(255, collation=SQLCollationUtil.collation()), nullable=False
         )
         created = Column(TIMESTAMP, default=datetime.now(timezone.utc))
         updated = Column(TIMESTAMP, default=datetime.now(timezone.utc))
         state = Column(String(255, collation=SQLCollationUtil.collation()))
         timeout = Column(Integer)
 
+        def get_identifier_string(self) -> str:
+            return f"{self.project}/{self.name}"
+
     class Schedule(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "schedules_v2"
         __table_args__ = (UniqueConstraint("project", "name", name="_schedules_v2_uc"),)
 
         Label = make_label(__tablename__)
 
         id = Column(Integer, primary_key=True)
@@ -297,14 +305,17 @@
     class User(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "users"
         __table_args__ = (UniqueConstraint("name", name="_users_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.name}"
+
     class Project(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "projects"
         # For now since we use project name a lot
         __table_args__ = (UniqueConstraint("name", name="_projects_uc"),)
 
         id = Column(Integer, primary_key=True)
         name = Column(String(255, collation=SQLCollationUtil.collation()))
@@ -343,15 +354,15 @@
         name = Column(String(255, collation=SQLCollationUtil.collation()))
         value_type = Column(String(255, collation=SQLCollationUtil.collation()))
 
         Label = make_label(__tablename__)
         labels = relationship(Label, cascade="all, delete-orphan")
 
         def get_identifier_string(self) -> str:
-            return f"{self.project}/{self.name}"
+            return f"{self.feature_set_id}/{self.name}"
 
     class Entity(Base, mlrun.utils.db.BaseModel):
         __tablename__ = "entities"
         id = Column(Integer, primary_key=True)
         feature_set_id = Column(Integer, ForeignKey("feature_sets.id"))
 
         name = Column(String(255, collation=SQLCollationUtil.collation()))
@@ -460,14 +471,17 @@
         __tablename__ = "data_versions"
         __table_args__ = (UniqueConstraint("version", name="_versions_uc"),)
 
         id = Column(Integer, primary_key=True)
         version = Column(String(255, collation=SQLCollationUtil.collation()))
         created = Column(TIMESTAMP, default=datetime.now(timezone.utc))
 
+        def get_identifier_string(self) -> str:
+            return f"{self.version}"
+
 
 # Must be after all table definitions
 _tagged = [cls for cls in Base.__subclasses__() if hasattr(cls, "Tag")]
 _labeled = [cls for cls in Base.__subclasses__() if hasattr(cls, "Label")]
 _with_notifications = [
     cls for cls in Base.__subclasses__() if hasattr(cls, "Notification")
 ]
```

## mlrun/api/migrations_mysql/env.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/env.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/schemas/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -32,14 +32,15 @@
 import mlrun.common.schemas.constants as old_constants
 import mlrun.common.schemas.feature_store as old_feature_store
 import mlrun.common.schemas.frontend_spec as old_frontend_spec
 import mlrun.common.schemas.function as old_function
 import mlrun.common.schemas.http as old_http
 import mlrun.common.schemas.k8s as old_k8s
 import mlrun.common.schemas.memory_reports as old_memory_reports
+import mlrun.common.schemas.model_monitoring.grafana
 import mlrun.common.schemas.object as old_object
 import mlrun.common.schemas.pipeline as old_pipeline
 import mlrun.common.schemas.project as old_project
 import mlrun.common.schemas.runtime_resource as old_runtime_resource
 import mlrun.common.schemas.schedule as old_schedule
 import mlrun.common.schemas.secret as old_secret
 import mlrun.common.schemas.tag as old_tag
@@ -159,21 +160,31 @@
 last_source_index = DeprecationHelper(mlrun.common.schemas.last_source_index)
 MostCommonObjectTypesReport = DeprecationHelper(
     mlrun.common.schemas.MostCommonObjectTypesReport
 )
 ObjectTypeReport = DeprecationHelper(mlrun.common.schemas.ObjectTypeReport)
 Features = DeprecationHelper(mlrun.common.schemas.Features)
 FeatureValues = DeprecationHelper(mlrun.common.schemas.FeatureValues)
-GrafanaColumn = DeprecationHelper(mlrun.common.schemas.GrafanaColumn)
-GrafanaDataPoint = DeprecationHelper(mlrun.common.schemas.GrafanaDataPoint)
-GrafanaNumberColumn = DeprecationHelper(mlrun.common.schemas.GrafanaNumberColumn)
-GrafanaStringColumn = DeprecationHelper(mlrun.common.schemas.GrafanaStringColumn)
-GrafanaTable = DeprecationHelper(mlrun.common.schemas.GrafanaTable)
+GrafanaColumn = DeprecationHelper(
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaColumn
+)
+GrafanaDataPoint = DeprecationHelper(
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaDataPoint
+)
+GrafanaNumberColumn = DeprecationHelper(
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaNumberColumn
+)
+GrafanaStringColumn = DeprecationHelper(
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaStringColumn
+)
+GrafanaTable = DeprecationHelper(
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaTable
+)
 GrafanaTimeSeriesTarget = DeprecationHelper(
-    mlrun.common.schemas.GrafanaTimeSeriesTarget
+    mlrun.common.schemas.model_monitoring.grafana.GrafanaTimeSeriesTarget
 )
 ModelEndpoint = DeprecationHelper(mlrun.common.schemas.ModelEndpoint)
 ModelEndpointList = DeprecationHelper(mlrun.common.schemas.ModelEndpointList)
 ModelEndpointMetadata = DeprecationHelper(mlrun.common.schemas.ModelEndpointMetadata)
 ModelEndpointSpec = DeprecationHelper(mlrun.common.schemas.ModelEndpointSpec)
 ModelEndpointStatus = DeprecationHelper(mlrun.common.schemas.ModelEndpointStatus)
 ModelMonitoringStoreKinds = DeprecationHelper(
```

## mlrun/api/utils/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/asyncio.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/background_tasks.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/builder.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,27 +11,29 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import os.path
 import pathlib
 import re
 import tempfile
+import typing
 from base64 import b64decode, b64encode
 from os import path
 from urllib.parse import urlparse
 
 from kubernetes import client
 
 import mlrun.api.utils.singletons.k8s
 import mlrun.common.constants
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.runtimes.utils
 import mlrun.utils
 from mlrun.config import config
+from mlrun.utils.helpers import remove_image_protocol_prefix
 
 
 def make_dockerfile(
     base_image: str,
     commands: list = None,
     source: str = None,
     requirements_path: str = None,
@@ -130,15 +132,24 @@
 
     if not dockertext and not dockerfile:
         raise ValueError("docker file or text must be specified")
 
     if dockertext:
         dockerfile = "/empty/Dockerfile"
 
-    args = ["--dockerfile", dockerfile, "--context", context, "--destination", dest]
+    args = [
+        "--dockerfile",
+        dockerfile,
+        "--context",
+        context,
+        "--destination",
+        dest,
+        "--image-fs-extract-retry",
+        config.httpdb.builder.kaniko_image_fs_extraction_retries,
+    ]
     for value, flag in [
         (config.httpdb.builder.insecure_pull_registry_mode, "--insecure-pull"),
         (config.httpdb.builder.insecure_push_registry_mode, "--insecure"),
     ]:
         if value == "disabled":
             continue
         if value == "enabled" or (value == "auto" and not secret_name):
@@ -324,35 +335,17 @@
 ):
     runtime_spec = runtime.spec if runtime else None
     builder_env = builder_env or {}
     image_target, secret_name = resolve_image_target_and_registry_secret(
         image_target, registry, secret_name
     )
 
-    requirements_path = "/empty/requirements.txt"
-    if requirements and isinstance(requirements, list):
-        requirements_list = requirements
-    else:
-        requirements_list = []
-        requirements_path = requirements or requirements_path
-
-    commands = commands or []
-    if with_mlrun:
-        # mlrun prerequisite - upgrade pip
-        upgrade_pip_command = resolve_upgrade_pip_command(commands)
-        if upgrade_pip_command:
-            commands.append(upgrade_pip_command)
-
-        mlrun_version = resolve_mlrun_install_command_version(
-            mlrun_version_specifier, client_version, commands
-        )
-
-        # mlrun must be installed with other python requirements in the same pip command to avoid version conflicts
-        if mlrun_version:
-            requirements_list.insert(0, mlrun_version)
+    commands, requirements_list, requirements_path = _resolve_build_requirements(
+        requirements, commands, with_mlrun, mlrun_version_specifier, client_version
+    )
 
     if not inline_code and not source and not commands and not requirements:
         mlrun.utils.logger.info("skipping build, nothing to add")
         return "skipped"
 
     context = "/context"
     to_mount = False
@@ -688,14 +681,16 @@
             )
         image_target_components = [registry, image_target]
         if repository and repository not in image_target:
             image_target_components = [registry, repository, image_target]
 
         return "/".join(image_target_components), secret_name
 
+    image_target = remove_image_protocol_prefix(image_target)
+
     return image_target, secret_name
 
 
 def _generate_builder_env(project, builder_env):
     k8s = mlrun.api.utils.singletons.k8s.get_k8s_helper(silent=False)
     secret_name = k8s.get_project_secret_name(project)
     existing_secret_keys = k8s.get_project_secret_keys(project, filter_internal=True)
@@ -707,7 +702,47 @@
             value_from = client.V1EnvVarSource(
                 secret_key_ref=client.V1SecretKeySelector(name=secret_name, key=key)
             )
             env.append(client.V1EnvVar(name=key, value_from=value_from))
     for key, value in builder_env.items():
         env.append(client.V1EnvVar(name=key, value=value))
     return env
+
+
+def _resolve_build_requirements(
+    requirements: typing.Union[typing.List, str],
+    commands: typing.List,
+    with_mlrun: bool,
+    mlrun_version_specifier: typing.Optional[str],
+    client_version: typing.Optional[str],
+):
+    """
+    Resolve build requirements list, requirements path and commands.
+    If mlrun requirement is needed, we add a pip upgrade command to the commands list (prerequisite).
+    """
+    requirements_path = "/empty/requirements.txt"
+    if requirements and isinstance(requirements, list):
+        requirements_list = requirements
+    else:
+        requirements_list = []
+        requirements_path = requirements or requirements_path
+    commands = commands or []
+
+    if with_mlrun:
+        # mlrun prerequisite - upgrade pip
+        upgrade_pip_command = resolve_upgrade_pip_command(commands)
+        if upgrade_pip_command:
+            commands.append(upgrade_pip_command)
+
+        mlrun_version = resolve_mlrun_install_command_version(
+            mlrun_version_specifier, client_version, commands
+        )
+
+        # mlrun must be installed with other python requirements in the same pip command to avoid version conflicts
+        if mlrun_version:
+            requirements_list.insert(0, mlrun_version)
+
+    if not requirements_list:
+        # no requirements, we don't need a requirements file
+        requirements_path = ""
+
+    return commands, requirements_list, requirements_path
```

## mlrun/api/utils/helpers.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -53,14 +53,18 @@
 
     async def async_wrapper(*args, **kwargs):
         _ensure_running_on_chief()
         return await function(*args, **kwargs)
 
     if asyncio.iscoroutinefunction(function):
         return async_wrapper
+
+    # ensure method name is preserved
+    wrapper.__name__ = function.__name__
+
     return wrapper
 
 
 def minimize_project_schema(
     project: mlrun.common.schemas.Project,
 ) -> mlrun.common.schemas.Project:
     project.spec.functions = None
```

## mlrun/api/utils/memory_reports.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/periodic.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -23,30 +23,40 @@
 
 tasks: typing.Dict = {}
 
 
 # This module is different from mlrun.db.periodic in that this module's functions aren't supposed to persist
 # also this module supports asyncio while the other currently not
 # TODO: merge the modules
-async def _periodic_function_wrapper(interval: int, function, *args, **kwargs):
+async def _periodic_function_wrapper(
+    interval: typing.Union[int, float], function, *args, **kwargs
+):
     while True:
         try:
             if asyncio.iscoroutinefunction(function):
                 await function(*args, **kwargs)
             else:
                 await run_in_threadpool(function, *args, **kwargs)
-        except Exception:
+        except Exception as exc:
             logger.warning(
-                f"Failed during periodic function execution: {function.__name__}, exc: {traceback.format_exc()}"
+                "Failed during periodic function execution",
+                func_name=function.__name__,
+                exc=mlrun.errors.err_to_str(exc),
+                tb=traceback.format_exc(),
             )
         await asyncio.sleep(interval)
 
 
 def run_function_periodically(
-    interval: int, name: str, replace: bool, function, *args, **kwargs
+    interval: typing.Union[float, int],
+    name: str,
+    replace: bool,
+    function,
+    *args,
+    **kwargs
 ):
     global tasks
     logger.debug("Submitting function to run periodically", name=name)
     if name in tasks:
         if not replace:
             message = "Task with that name already exists"
             logger.warning(message, name=name)
```

## mlrun/api/utils/scheduler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -23,14 +23,15 @@
 import fastapi.concurrency
 import humanfriendly
 from apscheduler.jobstores.base import JobLookupError
 from apscheduler.schedulers.asyncio import AsyncIOScheduler
 from apscheduler.triggers.cron import CronTrigger as APSchedulerCronTrigger
 from sqlalchemy.orm import Session
 
+import mlrun.api.api.utils
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.helpers
 import mlrun.common.schemas
 import mlrun.errors
 from mlrun.api.db.session import close_session, create_session
 from mlrun.api.utils.singletons.db import get_db
@@ -133,14 +134,17 @@
             concurrency_limit=concurrency_limit,
         )
         self._ensure_auth_info_has_access_key(auth_info, kind)
         secret_name = self._store_schedule_secrets_using_auth_secret(auth_info)
         # We use the schedule labels to keep track of the access-key to use. Note that this is the name of the secret,
         # not the secret value itself. Therefore, it can be kept in a non-secure field.
         labels = self._append_access_key_secret_to_labels(labels, secret_name)
+
+        self._enrich_schedule_notifications(project, name, scheduled_object)
+
         get_db().create_schedule(
             db_session,
             project,
             name,
             kind,
             scheduled_object,
             cron_trigger,
@@ -206,14 +210,16 @@
         )
 
         db_schedule = get_db().get_schedule(db_session, project, name)
         self._ensure_auth_info_has_access_key(auth_info, db_schedule.kind)
         secret_name = self._store_schedule_secrets_using_auth_secret(auth_info)
         labels = self._append_access_key_secret_to_labels(labels, secret_name)
 
+        self._enrich_schedule_notifications(project, name, scheduled_object)
+
         get_db().update_schedule(
             db_session,
             project,
             name,
             scheduled_object,
             cron_trigger,
             labels,
@@ -273,38 +279,41 @@
     def delete_schedule(
         self,
         db_session: Session,
         project: str,
         name: str,
     ):
         logger.debug("Deleting schedule", project=project, name=name)
-        self._remove_schedule_scheduler_resources(project, name)
+        self._remove_schedule_scheduler_resources(db_session, project, name)
         get_db().delete_schedule(db_session, project, name)
 
     @mlrun.api.utils.helpers.ensure_running_on_chief
     def delete_schedules(
         self,
         db_session: Session,
         project: str,
     ):
         schedules = self.list_schedules(
             db_session,
             project,
         )
         logger.debug("Deleting schedules", project=project)
         for schedule in schedules.schedules:
-            self._remove_schedule_scheduler_resources(schedule.project, schedule.name)
+            self._remove_schedule_scheduler_resources(
+                db_session, schedule.project, schedule.name
+            )
         get_db().delete_schedules(db_session, project)
 
-    def _remove_schedule_scheduler_resources(self, project, name):
+    def _remove_schedule_scheduler_resources(self, db_session: Session, project, name):
         self._remove_schedule_from_scheduler(project, name)
         # This is kept for backwards compatibility - if schedule was using the "old" format of storing secrets, then
         # this is a good opportunity to remove them. Using the new method we don't remove secrets since they are per
         # access-key and there may be other entities (runtimes, for example) using the same secret.
         self._remove_schedule_secrets(project, name)
+        self._remove_schedule_notification_secrets(db_session, project, name)
 
     def _remove_schedule_from_scheduler(self, project, name):
         job_id = self._resolve_job_id(project, name)
         # don't fail on delete if job doesn't exist
         job = self._scheduler.get_job(job_id)
         if job:
             self._scheduler.remove_job(job_id)
@@ -333,14 +342,41 @@
             project,
             name,
             db_schedule.concurrency_limit,
             auth_info,
         )
         return await function(*args, **kwargs)
 
+    @mlrun.api.utils.helpers.ensure_running_on_chief
+    def set_schedule_notifications(
+        self,
+        session: Session,
+        project: str,
+        identifier: mlrun.common.schemas.ScheduleIdentifier,
+        notifications: List[mlrun.model.Notification],
+        auth_info: mlrun.common.schemas.AuthInfo,
+    ):
+        """
+        Set notifications for a schedule. This will replace any existing notifications.
+        :param session: DB session
+        :param project: Project name
+        :param identifier: Schedule identifier
+        :param notifications: List of notifications to set
+        :param auth_info: Authorization info
+        """
+        name = identifier.name
+        logger.debug("Setting schedule notifications", project=project, name=name)
+        db_schedule = get_db().get_schedule(session, project, name)
+        scheduled_object = db_schedule.scheduled_object
+        if scheduled_object:
+            scheduled_object.get("task", {}).get("spec", {})["notifications"] = [
+                notification.to_dict() for notification in notifications
+            ]
+        self.update_schedule(session, auth_info, project, name, scheduled_object)
+
     def _ensure_auth_info_has_access_key(
         self,
         auth_info: mlrun.common.schemas.AuthInfo,
         kind: mlrun.common.schemas.ScheduleKinds,
     ):
         import mlrun.api.crud
 
@@ -590,15 +626,15 @@
                     "Cron trigger too frequent. Rejecting",
                     cron_trigger=cron_trigger,
                     next_run_time=next_run_time,
                     second_next_run_time=second_next_run_time,
                     delta=second_next_run_time - next_run_time,
                 )
                 raise ValueError(
-                    f"Cron trigger too frequent. no more then one job "
+                    f"Cron trigger too frequent. no more than one job "
                     f"per {self._min_allowed_interval} is allowed"
                 )
 
     def _create_schedule_in_scheduler(
         self,
         project: str,
         name: str,
@@ -852,14 +888,63 @@
     def _resolve_job_id(self, project, name) -> str:
         """
         :return: returns the identifier that will be used inside the APScheduler
         """
         return self._job_id_separator.join([project, name])
 
     @staticmethod
+    def _enrich_schedule_notifications(
+        project: str, schedule_name: str, scheduled_object: Union[Dict, Callable]
+    ):
+        if not isinstance(scheduled_object, dict):
+            return
+
+        schedule_notifications = (
+            scheduled_object.get("task", {}).get("spec", {}).get("notifications")
+        )
+        if schedule_notifications:
+            scheduled_object["task"]["spec"]["notifications"] = [
+                notification.to_dict()
+                for notification in mlrun.api.api.utils.validate_and_mask_notification_list(
+                    schedule_notifications, schedule_name, project
+                )
+            ]
+
+    @staticmethod
+    def _remove_schedule_notification_secrets(
+        db_session: Session, project: str, schedule_name: str
+    ):
+        try:
+            db_schedule = get_db().get_schedule(
+                db_session,
+                project,
+                schedule_name,
+            )
+        except mlrun.errors.MLRunNotFoundError:
+            # we allow deleting a schedule even if it does not exist in the DB
+            logger.debug(
+                "Failed to find schedule. Continuing",
+                project=project,
+                schedule_name=schedule_name,
+            )
+            return
+
+        if db_schedule and isinstance(db_schedule.scheduled_object, dict):
+            notifications = (
+                db_schedule.scheduled_object.get("task", {})
+                .get("spec", {})
+                .get("notifications")
+            )
+            if notifications:
+                for notification in notifications:
+                    mlrun.api.api.utils.delete_notification_params_secret(
+                        project, mlrun.model.Notification.from_dict(notification)
+                    )
+
+    @staticmethod
     async def submit_run_wrapper(
         scheduler,
         scheduled_object,
         project_name,
         schedule_name,
         schedule_concurrency_limit,
         auth_info: mlrun.common.schemas.AuthInfo,
```

## mlrun/api/utils/auth/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/auth/verifier.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/auth/providers/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/auth/providers/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/auth/providers/nop.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/auth/providers/opa.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/clients/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/clients/chief.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -172,14 +172,27 @@
                     chief_response
                 )
 
             return mlrun.common.schemas.ClusterizationSpec(
                 **(await chief_response.json())
             )
 
+    async def set_schedule_notifications(
+        self, project: str, schedule_name: str, request: fastapi.Request, json: dict
+    ) -> fastapi.Response:
+        """
+        Schedules are running only on chief
+        """
+        return await self._proxy_request_to_chief(
+            "PUT",
+            f"projects/{project}/schedules/{schedule_name}/notifications",
+            request,
+            json,
+        )
+
     async def _proxy_request_to_chief(
         self,
         method,
         path,
         request: fastapi.Request = None,
         json: dict = None,
         raise_on_failure: bool = False,
```

## mlrun/api/utils/clients/iguazio.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -20,18 +20,19 @@
 import http
 import json
 import typing
 import urllib.parse
 
 import aiohttp
 import fastapi
+import igz_mgmt.schemas.manual_events
 import requests.adapters
 from fastapi.concurrency import run_in_threadpool
 
-import mlrun.api.utils.projects.remotes.leader
+import mlrun.api.utils.projects.remotes.leader as project_leader
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.helpers
 import mlrun.utils.singleton
 from mlrun.utils import get_in, logger
 
 
@@ -68,15 +69,15 @@
         return [
             SessionPlanes.data,
             SessionPlanes.control,
         ]
 
 
 class Client(
-    mlrun.api.utils.projects.remotes.leader.Member,
+    project_leader.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def __init__(self, *args, **kwargs) -> None:
         super().__init__(*args, **kwargs)
         self._session = mlrun.utils.HTTPSessionWithRetry(
             retry_on_exception=mlrun.mlconf.httpdb.projects.retry_leader_request_on_exception
             == mlrun.common.schemas.HTTPSessionRetryMode.enabled.value,
@@ -85,45 +86,16 @@
         self._api_url = mlrun.mlconf.iguazio_api_url
         # The job is expected to be completed in less than 5 seconds. If 10 seconds have passed and the job
         # has not been completed, increase the interval to retry every 5 seconds
         self._wait_for_job_completion_retry_interval = mlrun.utils.create_step_backoff(
             [[1, 10], [5, None]]
         )
         self._wait_for_project_terminal_state_retry_interval = 5
-
-    def try_get_grafana_service_url(self, session: str) -> typing.Optional[str]:
-        """
-        Try to find a ready grafana app service, and return its URL
-        If nothing found, returns None
-        """
-        logger.debug("Getting grafana service url from Iguazio")
-        response = self._send_request_to_api(
-            "GET",
-            "app_services_manifests",
-            "Failed getting app services manifests from Iguazio",
-            session,
-        )
-        response_body = response.json()
-        for app_services_manifest in response_body.get("data", []):
-            for app_service in app_services_manifest.get("attributes", {}).get(
-                "app_services", []
-            ):
-                if (
-                    app_service.get("spec", {}).get("kind") == "grafana"
-                    and app_service.get("status", {}).get("state") == "ready"
-                    and len(app_service.get("status", {}).get("urls", [])) > 0
-                ):
-                    url_kind_to_url = {}
-                    for url in app_service["status"]["urls"]:
-                        url_kind_to_url[url["kind"]] = url["url"]
-                    # precedence for https
-                    for kind in ["https", "http"]:
-                        if kind in url_kind_to_url:
-                            return url_kind_to_url[kind]
-        return None
+        self._logger = logger.get_child("iguazio-client")
+        self._igz_clients = {}
 
     def verify_request_session(
         self, request: fastapi.Request
     ) -> mlrun.common.schemas.AuthInfo:
         """
         Proxy the request to one of the session verification endpoints (which will verify the session of the request)
         """
@@ -179,47 +151,51 @@
             "POST",
             "self/get_or_create_access_key",
             "Failed getting or creating iguazio access key",
             session,
             json=body,
         )
         if response.status_code == http.HTTPStatus.CREATED.value:
-            logger.debug("Created access key in Iguazio", planes=planes)
+            self._logger.debug("Created access key in Iguazio", planes=planes)
         return response.json()["data"]["id"]
 
     def create_project(
         self,
         session: str,
         project: mlrun.common.schemas.Project,
         wait_for_completion: bool = True,
     ) -> bool:
-        logger.debug("Creating project in Iguazio", project=project)
+        self._logger.debug("Creating project in Iguazio", project=project.metadata.name)
         body = self._transform_mlrun_project_to_iguazio_project(project)
         return self._create_project_in_iguazio(
-            session, project.metadata.name, body, wait_for_completion
+            session,
+            project.metadata.name,
+            body,
+            wait_for_completion,
+            timeout=60,
         )
 
     def update_project(
         self,
         session: str,
         name: str,
         project: mlrun.common.schemas.Project,
     ):
-        logger.debug("Updating project in Iguazio", name=name)
+        self._logger.debug("Updating project in Iguazio", name=name)
         body = self._transform_mlrun_project_to_iguazio_project(project)
         self._put_project_to_iguazio(session, name, body)
 
     def delete_project(
         self,
         session: str,
         name: str,
         deletion_strategy: mlrun.common.schemas.DeletionStrategy = mlrun.common.schemas.DeletionStrategy.default(),
         wait_for_completion: bool = True,
     ) -> bool:
-        logger.debug(
+        self._logger.debug(
             "Deleting project in Iguazio",
             name=name,
             deletion_strategy=deletion_strategy,
         )
         body = self._transform_mlrun_project_to_iguazio_project(
             mlrun.common.schemas.Project(
                 metadata=mlrun.common.schemas.ProjectMetadata(name=name)
@@ -236,24 +212,24 @@
                 session,
                 headers=headers,
                 json=body,
             )
         except requests.HTTPError as exc:
             if exc.response.status_code != http.HTTPStatus.NOT_FOUND.value:
                 raise
-            logger.debug(
+            self._logger.debug(
                 "Project not found in Iguazio. Considering deletion as successful",
                 name=name,
                 deletion_strategy=deletion_strategy,
             )
             return False
         else:
             if wait_for_completion:
                 job_id = response.json()["data"]["id"]
-                logger.debug(
+                self._logger.debug(
                     "Waiting for project deletion job in Iguazio",
                     name=name,
                     job_id=job_id,
                 )
                 self._wait_for_job_completion(
                     session, job_id, "Project deletion job failed"
                 )
@@ -315,14 +291,62 @@
     @property
     def is_sync(self):
         """
         False because client is synchronous
         """
         return True
 
+    def try_get_grafana_service_url(self, session: str) -> typing.Optional[str]:
+        """
+        Try to find a ready grafana app service, and return its URL
+        If nothing found, returns None
+        """
+        self._logger.debug("Getting grafana service url from Iguazio")
+        response = self._send_request_to_api(
+            "GET",
+            "app_services_manifests",
+            "Failed getting app services manifests from Iguazio",
+            session,
+        )
+        response_body = response.json()
+        for app_services_manifest in response_body.get("data", []):
+            for app_service in app_services_manifest.get("attributes", {}).get(
+                "app_services", []
+            ):
+                if (
+                    app_service.get("spec", {}).get("kind") == "grafana"
+                    and app_service.get("status", {}).get("state") == "ready"
+                    and len(app_service.get("status", {}).get("urls", [])) > 0
+                ):
+                    url_kind_to_url = {}
+                    for url in app_service["status"]["urls"]:
+                        url_kind_to_url[url["kind"]] = url["url"]
+                    # precedence for https
+                    for kind in ["https", "http"]:
+                        if kind in url_kind_to_url:
+                            return url_kind_to_url[kind]
+        return None
+
+    def emit_manual_event(self, access_key: str, event: igz_mgmt.Event):
+        """
+        Emit a manual event to Iguazio
+        """
+        client = self._get_igz_client(access_key)
+        igz_mgmt.ManualEvents.emit(
+            http_client=client, event=event, audit_tenant_id=client.tenant_id
+        )
+
+    def _get_igz_client(self, access_key: str) -> igz_mgmt.Client:
+        if not self._igz_clients.get(access_key):
+            self._igz_clients[access_key] = igz_mgmt.Client(
+                endpoint=self._api_url,
+                access_key=access_key,
+            )
+        return self._igz_clients[access_key]
+
     def _list_project_names(
         self,
         session: str,
         updated_after: typing.Optional[datetime.datetime] = None,
         page_size: typing.Optional[int] = None,
     ) -> typing.Tuple[typing.List[str], typing.Optional[datetime.datetime]]:
         params = {}
@@ -368,50 +392,73 @@
                 iguazio_project["attributes"]["updated_at"]
             )
             if latest_updated_at is None or latest_updated_at < updated_at:
                 latest_updated_at = updated_at
         return latest_updated_at
 
     def _create_project_in_iguazio(
-        self, session: str, name: str, body: dict, wait_for_completion: bool
+        self,
+        session: str,
+        name: str,
+        body: dict,
+        wait_for_completion: bool,
+        **kwargs,
     ) -> bool:
-        _, job_id = self._post_project_to_iguazio(session, body)
+        _, job_id = self._post_project_to_iguazio(session, body, **kwargs)
         if wait_for_completion:
-            logger.debug(
+            self._logger.debug(
                 "Waiting for project creation job in Iguazio",
                 name=name,
                 job_id=job_id,
             )
             self._wait_for_job_completion(
                 session, job_id, "Project creation job failed"
             )
+            self._logger.debug(
+                "Successfully created project in Iguazio",
+                name=name,
+                job_id=job_id,
+            )
             return False
         return True
 
     def _post_project_to_iguazio(
-        self, session: str, body: dict
+        self,
+        session: str,
+        body: dict,
+        **kwargs,
     ) -> typing.Tuple[mlrun.common.schemas.Project, str]:
         response = self._send_request_to_api(
-            "POST", "projects", "Failed creating project in Iguazio", session, json=body
+            "POST",
+            "projects",
+            "Failed creating project in Iguazio",
+            session,
+            json=body,
+            **kwargs,
         )
         response_body = response.json()
         return (
             self._transform_iguazio_project_to_mlrun_project(response_body["data"]),
             response_body["data"]["relationships"]["last_job"]["data"]["id"],
         )
 
     def _put_project_to_iguazio(
-        self, session: str, name: str, body: dict
+        self,
+        session: str,
+        name: str,
+        body: dict,
+        **kwargs,
     ) -> mlrun.common.schemas.Project:
         response = self._send_request_to_api(
             "PUT",
             f"projects/__name__/{name}",
             "Failed updating project in Iguazio",
             session,
             json=body,
+            **kwargs,
         )
         return self._transform_iguazio_project_to_mlrun_project(response.json()["data"])
 
     def _get_project_from_iguazio_without_parsing(
         self, session: str, name: str, enrich_owner_access_key: bool = False
     ):
         params = {"include": "owner"}
@@ -441,15 +488,15 @@
             if _job_state not in JobStates.terminal_states():
                 raise Exception(f"Job in progress. State: {_job_state}")
             return _job_state, response_body["data"]["attributes"]["result"]
 
         job_state, job_result = mlrun.utils.helpers.retry_until_successful(
             self._wait_for_job_completion_retry_interval,
             360,
-            logger,
+            self._logger,
             False,
             _verify_job_in_terminal_state,
         )
         if job_state != JobStates.completed:
             status_code = None
             try:
                 parsed_result = json.loads(job_result)
@@ -458,14 +505,15 @@
                 if "status" in parsed_result:
                     status_code = int(parsed_result["status"])
             except Exception:
                 pass
             if not status_code:
                 raise mlrun.errors.MLRunRuntimeError(error_message)
             raise mlrun.errors.raise_for_status_code(status_code, error_message)
+        self._logger.debug("Job completed successfully", job_id=job_id)
 
     def _send_request_to_api(
         self, method, path, error_message: str, session=None, **kwargs
     ):
         url = f"{self._api_url}/api/{path}"
         self._prepare_request_kwargs(session, path, kwargs=kwargs)
         response = self._session.request(method, url, verify=False, **kwargs)
@@ -711,27 +759,30 @@
                 if isinstance(dict_[key], enum.Enum):
                     dict_[key] = dict_[key].value
 
     def _handle_error_response(
         self, method, path, response, response_body, error_message, kwargs
     ):
         log_kwargs = copy.deepcopy(kwargs)
+
+        # this can be big and spammy
+        log_kwargs.pop("json", None)
         log_kwargs.update({"method": method, "path": path})
         try:
             ctx = response_body.get("meta", {}).get("ctx")
             errors = response_body.get("errors", [])
         except Exception:
             pass
         else:
             if errors:
                 error_message = f"{error_message}: {str(errors)}"
             if errors or ctx:
                 log_kwargs.update({"ctx": ctx, "errors": errors})
 
-        logger.warning("Request to iguazio failed", **log_kwargs)
+        self._logger.warning("Request to iguazio failed", **log_kwargs)
         mlrun.errors.raise_for_status(response, error_message)
 
 
 class AsyncClient(Client):
     def __init__(
         self,
         *args,
```

## mlrun/api/utils/clients/log_collector.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/clients/nuclio.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,23 +16,23 @@
 import enum
 import http
 import typing
 
 import requests.adapters
 import sqlalchemy.orm
 
-import mlrun.api.utils.projects.remotes.follower
+import mlrun.api.utils.projects.remotes.follower as project_follower
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.singleton
 from mlrun.utils import logger
 
 
 class Client(
-    mlrun.api.utils.projects.remotes.follower.Member,
+    project_follower.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def __init__(self) -> None:
         super().__init__()
         self._session = mlrun.utils.HTTPSessionWithRetry(verbose=True)
         self._api_url = mlrun.config.config.nuclio_dashboard_url
```

## mlrun/api/utils/clients/protocols/grpc.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/alembic.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/backup.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/mysql.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/sql_collation.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/db/sqlite_migration.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/follower.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -23,30 +23,30 @@
 
 import mlrun.api.crud
 import mlrun.api.db.session
 import mlrun.api.utils.auth.verifier
 import mlrun.api.utils.clients.iguazio
 import mlrun.api.utils.clients.nuclio
 import mlrun.api.utils.periodic
-import mlrun.api.utils.projects.member
+import mlrun.api.utils.projects.member as project_member
 import mlrun.api.utils.projects.remotes.leader
 import mlrun.api.utils.projects.remotes.nop_leader
 import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
 
 class Member(
-    mlrun.api.utils.projects.member.Member,
+    project_member.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def initialize(self):
         logger.info("Initializing projects follower")
         self._leader_name = mlrun.mlconf.httpdb.projects.leader
         self._sync_session = None
         self._leader_client: mlrun.api.utils.projects.remotes.leader.Member
@@ -342,19 +342,26 @@
                     set(db_projects.projects).difference(leader_project_names)
                 )
                 for project_to_remove in projects_to_remove:
                     logger.info(
                         "Found project in the DB that is not in leader. Removing",
                         name=project_to_remove,
                     )
-                    mlrun.api.crud.Projects().delete_project(
-                        db_session,
-                        project_to_remove,
-                        mlrun.common.schemas.DeletionStrategy.cascading,
-                    )
+                    try:
+                        mlrun.api.crud.Projects().delete_project(
+                            db_session,
+                            project_to_remove,
+                            mlrun.common.schemas.DeletionStrategy.cascading,
+                        )
+                    except Exception as exc:
+                        logger.warning(
+                            "Failed to delete project from DB, continuing...",
+                            name=project_to_remove,
+                            exc=err_to_str(exc),
+                        )
             if latest_updated_at:
 
                 # sanity and defensive programming - if the leader returned a latest_updated_at that is older
                 # than the epoch, we'll set it to the epoch
                 epoch = pytz.UTC.localize(datetime.datetime.utcfromtimestamp(0))
                 if latest_updated_at < epoch:
                     latest_updated_at = epoch
```

## mlrun/api/utils/projects/leader.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,29 +19,30 @@
 import humanfriendly
 import sqlalchemy.orm
 
 import mlrun.api.db.session
 import mlrun.api.utils.clients.nuclio
 import mlrun.api.utils.periodic
 import mlrun.api.utils.projects.member
+import mlrun.api.utils.projects.member as project_member
 import mlrun.api.utils.projects.remotes.follower
 import mlrun.api.utils.projects.remotes.nop_follower
 import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.utils
 import mlrun.utils.helpers
 import mlrun.utils.regex
 import mlrun.utils.singleton
 from mlrun.errors import err_to_str
 from mlrun.utils import logger
 
 
 class Member(
-    mlrun.api.utils.projects.member.Member,
+    project_member.Member,
     metaclass=mlrun.utils.singleton.AbstractSingleton,
 ):
     def initialize(self):
         logger.info("Initializing projects leader")
         self._initialize_followers()
         self._periodic_sync_interval_seconds = humanfriendly.parse_timespan(
             mlrun.config.config.httpdb.projects.periodic_sync_interval
```

## mlrun/api/utils/projects/member.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/remotes/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/remotes/follower.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/remotes/leader.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/projects/remotes/nop_follower.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -14,20 +14,20 @@
 #
 import typing
 
 import mergedeep
 import sqlalchemy.orm
 
 import mlrun.api.utils.helpers
-import mlrun.api.utils.projects.remotes.follower
+import mlrun.api.utils.projects.remotes.follower as project_follower
 import mlrun.common.schemas
 import mlrun.errors
 
 
-class Member(mlrun.api.utils.projects.remotes.follower.Member):
+class Member(project_follower.Member):
     def __init__(self) -> None:
         super().__init__()
         self._projects: typing.Dict[str, mlrun.common.schemas.Project] = {}
 
     def create_project(
         self, session: sqlalchemy.orm.Session, project: mlrun.common.schemas.Project
     ):
```

## mlrun/api/utils/projects/remotes/nop_leader.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,21 +11,21 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import datetime
 import typing
 
-import mlrun.api.utils.projects.remotes.leader
+import mlrun.api.utils.projects.remotes.leader as project_leader
 import mlrun.api.utils.singletons.project_member
 import mlrun.common.schemas
 import mlrun.errors
 
 
-class Member(mlrun.api.utils.projects.remotes.leader.Member):
+class Member(project_leader.Member):
     def __init__(self) -> None:
         super().__init__()
         self.db_session = None
         self.project_owner_access_key = ""
         self._project_role = mlrun.common.schemas.ProjectsRole.nop
 
     def create_project(
```

## mlrun/api/utils/singletons/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/singletons/db.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,15 +10,15 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from mlrun.api.db.base import DBInterface
 from mlrun.api.db.sqldb.db import SQLDB
-from mlrun.api.db.sqldb.session import create_session
+from mlrun.common.db.sql_session import create_session
 from mlrun.config import config
 from mlrun.utils import logger
 
 # TODO: something nicer
 db: DBInterface = None
```

## mlrun/api/utils/singletons/k8s.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -15,15 +15,15 @@
 import hashlib
 import time
 import typing
 
 from kubernetes import client, config
 from kubernetes.client.rest import ApiException
 
-import mlrun.api.schemas
+import mlrun.common.schemas
 import mlrun.config as mlconfig
 import mlrun.errors
 import mlrun.platforms.iguazio
 from mlrun.utils import logger
 
 _k8s = None
 
@@ -294,17 +294,20 @@
             hashed_access_key=hashed_access_key
         )
 
     @staticmethod
     def _hash_access_key(access_key: str):
         return hashlib.sha224(access_key.encode()).hexdigest()
 
-    def store_project_secrets(self, project, secrets, namespace=""):
+    def store_project_secrets(
+        self, project, secrets, namespace=""
+    ) -> (str, typing.Optional[mlrun.common.schemas.SecretEventActions]):
         secret_name = self.get_project_secret_name(project)
-        self.store_secrets(secret_name, secrets, namespace)
+        action = self.store_secrets(secret_name, secrets, namespace)
+        return secret_name, action
 
     def read_auth_secret(self, secret_name, namespace="", raise_on_not_found=False):
         namespace = self.resolve_namespace(namespace)
 
         try:
             secret_data = self.v1api.read_namespaced_secret(secret_name, namespace).data
         except ApiException as exc:
@@ -326,47 +329,64 @@
         def _get_secret_value(key):
             if secret_data.get(key):
                 return base64.b64decode(secret_data[key]).decode("utf-8")
             else:
                 return None
 
         username = _get_secret_value(
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username")
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key("username")
         )
         access_key = _get_secret_value(
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("access_key")
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key("access_key")
         )
 
         return username, access_key
 
-    def store_auth_secret(self, username: str, access_key: str, namespace="") -> str:
+    def store_auth_secret(
+        self, username: str, access_key: str, namespace=""
+    ) -> (str, typing.Optional[mlrun.common.schemas.SecretEventActions]):
+        """
+        Store the given access key as a secret in the cluster. The secret name is generated from the access key
+        :return: returns the secret name and the action taken against the secret
+        """
         secret_name = self.get_auth_secret_name(access_key)
         secret_data = {
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key("username"): username,
-            mlrun.api.schemas.AuthSecretData.get_field_secret_key(
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key(
+                "username"
+            ): username,
+            mlrun.common.schemas.AuthSecretData.get_field_secret_key(
                 "access_key"
             ): access_key,
         }
-        self.store_secrets(
+        action = self.store_secrets(
             secret_name,
             secret_data,
             namespace,
             type_=SecretTypes.v3io_fuse,
             labels={"mlrun/username": username},
         )
-        return secret_name
+        return secret_name, action
 
     def store_secrets(
         self,
         secret_name,
         secrets,
         namespace="",
         type_=SecretTypes.opaque,
         labels: typing.Optional[dict] = None,
-    ):
+    ) -> typing.Optional[mlrun.common.schemas.SecretEventActions]:
+        """
+        Store secrets in a kubernetes secret object
+        :param secret_name: the project secret name
+        :param secrets:     the secrets to delete
+        :param namespace:   k8s namespace
+        :param type_:       k8s secret type
+        :param labels:      k8s labels for the secret
+        :return: returns the action if the secret was created or updated, None if nothing changed
+        """
         namespace = self.resolve_namespace(namespace)
         try:
             k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
         except ApiException as exc:
             # If secret doesn't exist, we'll simply create it
             if exc.status != 404:
                 logger.error(
@@ -375,67 +395,88 @@
                 raise exc
             k8s_secret = client.V1Secret(type=type_)
             k8s_secret.metadata = client.V1ObjectMeta(
                 name=secret_name, namespace=namespace, labels=labels
             )
             k8s_secret.string_data = secrets
             self.v1api.create_namespaced_secret(namespace, k8s_secret)
-            return
+            return mlrun.common.schemas.SecretEventActions.created
 
         secret_data = k8s_secret.data.copy()
         for key, value in secrets.items():
             secret_data[key] = base64.b64encode(value.encode()).decode("utf-8")
 
         k8s_secret.data = secret_data
         self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
+        return mlrun.common.schemas.SecretEventActions.updated
 
     def load_secret(self, secret_name, namespace=""):
         namespace = namespace or self.resolve_namespace(namespace)
 
         try:
             k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
         except ApiException:
             return None
 
         return k8s_secret.data
 
-    def delete_project_secrets(self, project, secrets, namespace=""):
+    def delete_project_secrets(
+        self, project, secrets, namespace=""
+    ) -> (str, typing.Optional[mlrun.common.schemas.SecretEventActions]):
+        """
+        Delete secrets from a kubernetes secret object
+        :return: returns the secret name and the action taken against the secret
+        """
         secret_name = self.get_project_secret_name(project)
-        self.delete_secrets(secret_name, secrets, namespace)
+        action = self.delete_secrets(secret_name, secrets, namespace)
+        return secret_name, action
 
     def delete_auth_secret(self, secret_ref: str, namespace=""):
         self.delete_secrets(secret_ref, {}, namespace)
 
-    def delete_secrets(self, secret_name, secrets, namespace=""):
+    def delete_secrets(
+        self, secret_name, secrets, namespace=""
+    ) -> typing.Optional[mlrun.common.schemas.SecretEventActions]:
+        """
+        Delete secrets from a kubernetes secret object
+        :param secret_name: the project secret name
+        :param secrets:     the secrets to delete
+        :param namespace:   k8s namespace
+        :return: returns the action if the secret was deleted or updated, None if nothing changed
+        """
         namespace = self.resolve_namespace(namespace)
 
         try:
             k8s_secret = self.v1api.read_namespaced_secret(secret_name, namespace)
         except ApiException as exc:
-            # If secret does not exist, return as if the deletion was successfully
             if exc.status == 404:
-                return
+                logger.info(
+                    "Project secret does not exist, nothing to delete.",
+                    secret_name=secret_name,
+                )
+                return None
             else:
                 logger.error(
                     f"failed to retrieve k8s secret: {mlrun.errors.err_to_str(exc)}"
                 )
                 raise exc
 
-        if not secrets:
-            secret_data = {}
-        else:
+        secret_data = {}
+        if secrets:
             secret_data = k8s_secret.data.copy()
             for secret in secrets:
                 secret_data.pop(secret, None)
 
-        if not secret_data:
-            self.v1api.delete_namespaced_secret(secret_name, namespace)
-        else:
+        if secret_data:
             k8s_secret.data = secret_data
             self.v1api.replace_namespaced_secret(secret_name, namespace, k8s_secret)
+            return mlrun.common.schemas.SecretEventActions.updated
+
+        self.v1api.delete_namespaced_secret(secret_name, namespace)
+        return mlrun.common.schemas.SecretEventActions.deleted
 
     def _get_project_secrets_raw_data(self, project, namespace=""):
         secret_name = self.get_project_secret_name(project)
         return self._get_secret_raw_data(secret_name, namespace)
 
     def _get_secret_raw_data(self, secret_name, namespace=""):
         namespace = self.resolve_namespace(namespace)
```

## mlrun/api/utils/singletons/logs_dir.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/api/utils/singletons/project_member.py

```diff
@@ -1,28 +1,31 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
+
+import typing
+
 import mlrun.api.utils.projects.follower
 import mlrun.api.utils.projects.leader
 import mlrun.api.utils.projects.member
 import mlrun.config
 
 # TODO: something nicer
-project_member: mlrun.api.utils.projects.member.Member = None
+project_member: typing.Optional[mlrun.api.utils.projects.member.Member] = None
 
 
 def initialize_project_member():
     global project_member
     if mlrun.config.config.httpdb.projects.leader in ["mlrun", "nop-self-leader"]:
         project_member = mlrun.api.utils.projects.leader.Member()
         project_member.initialize()
```

## mlrun/api/utils/singletons/scheduler.py

```diff
@@ -1,23 +1,23 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-from mlrun.api.db.sqldb.session import create_session
 from mlrun.api.utils.scheduler import Scheduler
+from mlrun.common.db.sql_session import create_session
 
 # TODO: something nicer
 scheduler: Scheduler = None
 
 
 async def initialize_scheduler():
     global scheduler
```

## mlrun/artifacts/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,12 +13,12 @@
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
 # Don't remove this, used by sphinx documentation
 __all__ = ["get_model", "update_model"]
 
-from .base import Artifact, get_artifact_meta
+from .base import Artifact, ArtifactMetadata, ArtifactSpec, get_artifact_meta
 from .dataset import DatasetArtifact, TableArtifact, update_dataset_meta
 from .manager import ArtifactManager, ArtifactProducer, dict_to_artifact
 from .model import ModelArtifact, get_model, update_model
 from .plots import BokehArtifact, ChartArtifact, PlotArtifact, PlotlyArtifact
```

## mlrun/artifacts/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -79,14 +79,15 @@
         "target_path",
         "viewer",
         "inline",
         "format",
         "size",
         "db_key",
         "extra_data",
+        "unpackaging_instructions",
     ]
 
     _extra_fields = ["annotations", "producer", "sources", "license", "encoding"]
 
     def __init__(
         self,
         src_path=None,
@@ -94,23 +95,25 @@
         viewer=None,
         is_inline=False,
         format=None,
         size=None,
         db_key=None,
         extra_data=None,
         body=None,
+        unpackaging_instructions: dict = None,
     ):
         self.src_path = src_path
         self.target_path = target_path
         self.viewer = viewer
         self._is_inline = is_inline
         self.format = format
         self.size = size
         self.db_key = db_key
         self.extra_data = extra_data or {}
+        self.unpackaging_instructions = unpackaging_instructions
 
         self._body = body
         self.encoding = None
         self.annotations = None
         self.sources = []
         self.producer = None
         self.license = ""
@@ -691,18 +694,18 @@
         return self._spec
 
     @spec.setter
     def spec(self, spec):
         self._spec = self._verify_dict(spec, "spec", LinkArtifactSpec)
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyArtifact' will be removed in 1.5.0, use 'Artifact' instead",
+    reason="'LegacyArtifact' will be removed in 1.6.0, use 'Artifact' instead",
     category=FutureWarning,
 )
 class LegacyArtifact(ModelObj):
 
     _dict_fields = [
         "key",
         "kind",
@@ -858,18 +861,18 @@
     def artifact_kind(self):
         return self.kind
 
     def generate_target_path(self, artifact_path, producer):
         return generate_target_path(self, artifact_path, producer)
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyDirArtifact' will be removed in 1.5.0, use 'DirArtifact' instead",
+    reason="'LegacyDirArtifact' will be removed in 1.6.0, use 'DirArtifact' instead",
     category=FutureWarning,
 )
 class LegacyDirArtifact(LegacyArtifact):
     _dict_fields = [
         "key",
         "kind",
         "iter",
@@ -894,18 +897,18 @@
             file_path = os.path.join(self.src_path, f)
             if not os.path.isfile(file_path):
                 raise ValueError(f"file {file_path} not found, cant upload")
             target = os.path.join(self.target_path, f)
             store_manager.object(url=target).upload(file_path)
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyLinkArtifact' will be removed in 1.5.0, use 'LinkArtifact' instead",
+    reason="'LegacyLinkArtifact' will be removed in 1.6.0, use 'LinkArtifact' instead",
     category=FutureWarning,
 )
 class LegacyLinkArtifact(LegacyArtifact):
     _dict_fields = LegacyArtifact._dict_fields + [
         "link_iteration",
         "link_key",
         "link_tree",
@@ -1020,12 +1023,15 @@
     if artifact_path and not artifact_path.endswith("/"):
         artifact_path += "/"
     if producer.kind == "run":
         artifact_path += f"{producer.name}/{item.iter or 0}/"
 
     suffix = "/"
     if not item.is_dir:
-        suffix = os.path.splitext(item.src_path or "")[1]
+
+        # suffixes yields a list of suffixes, e.g. ['.tar', '.gz']
+        # join them together to get the full suffix, e.g. '.tar.gz'
+        suffix = "".join(pathlib.Path(item.src_path or "").suffixes)
         if not suffix and item.format:
             suffix = f".{item.format}"
 
     return f"{artifact_path}{item.key}{suffix}"
```

## mlrun/artifacts/dataset.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -22,15 +22,15 @@
 from pandas.io.json import build_table_schema
 
 import mlrun
 import mlrun.common.schemas
 import mlrun.utils.helpers
 
 from ..datastore import is_store_uri, store_manager
-from .base import Artifact, ArtifactSpec, LegacyArtifact
+from .base import Artifact, ArtifactSpec, LegacyArtifact, StorePrefix
 
 default_preview_rows_length = 20
 max_preview_columns = 100
 max_csv = 10000
 ddf_sample_pct = 0.2
 max_ddf_size = 1
 
@@ -122,14 +122,15 @@
         self.label_column = None
 
 
 class DatasetArtifact(Artifact):
     kind = mlrun.common.schemas.ArtifactCategories.dataset
     # List of all the supported saving formats of a DataFrame:
     SUPPORTED_FORMATS = ["csv", "parquet", "pq", "tsdb", "kv"]
+    _store_prefix = StorePrefix.Dataset
 
     def __init__(
         self,
         key: str = None,
         df=None,
         preview: int = None,
         format: str = "",  # TODO: should be changed to 'fmt'.
@@ -317,18 +318,18 @@
         return self.status.stats
 
     @stats.setter
     def stats(self, stats):
         self.status.stats = stats
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyTableArtifact' will be removed in 1.5.0, use 'TableArtifact' instead",
+    reason="'LegacyTableArtifact' will be removed in 1.6.0, use 'TableArtifact' instead",
     category=FutureWarning,
 )
 class LegacyTableArtifact(LegacyArtifact):
     _dict_fields = LegacyArtifact._dict_fields + ["schema", "header"]
     kind = "table"
 
     def __init__(
@@ -370,18 +371,18 @@
         if not self._is_df:
             return self._body
         csv_buffer = StringIO()
         self._body.to_csv(csv_buffer, line_terminator="\n", encoding="utf-8")
         return csv_buffer.getvalue()
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyDatasetArtifact' will be removed in 1.5.0, use 'DatasetArtifact' instead",
+    reason="'LegacyDatasetArtifact' will be removed in 1.6.0, use 'DatasetArtifact' instead",
     category=FutureWarning,
 )
 class LegacyDatasetArtifact(LegacyArtifact):
     # List of all the supported saving formats of a DataFrame:
     SUPPORTED_FORMATS = ["csv", "parquet", "pq", "tsdb", "kv"]
 
     _dict_fields = LegacyArtifact._dict_fields + [
```

## mlrun/artifacts/manager.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -61,15 +61,15 @@
     "table": TableArtifact,
     "model": ModelArtifact,
     "dataset": DatasetArtifact,
     "plotly": PlotlyArtifact,
     "bokeh": BokehArtifact,
 }
 
-# TODO - Remove this when legacy types are deleted in 1.5.0
+# TODO - Remove this when legacy types are deleted in 1.6.0
 legacy_artifact_types = {
     "": LegacyArtifact,
     "dir": LegacyDirArtifact,
     "link": LegacyLinkArtifact,
     "plot": LegacyPlotArtifact,
     "chart": LegacyChartArtifact,
     "table": LegacyTableArtifact,
```

## mlrun/artifacts/model.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -325,15 +325,17 @@
                 artifact_path=artifact_path,
             )
 
         upload_extra_data(
             artifact=self, extra_data=self.spec.extra_data, artifact_path=artifact_path
         )
 
-        spec_body = self.to_yaml()
+        # the model spec yaml should not include the tag, as the same model can be used with different tags,
+        # and the tag is not part of the model spec but the metadata of the model artifact
+        spec_body = _remove_tag_from_spec_yaml(self)
         spec_target_path = None
 
         if mlrun.mlconf.artifacts.generate_target_path_from_artifact_hash:
 
             # resolving target_path for the model spec
             _, spec_target_path = self.resolve_body_target_hash_path(
                 body=spec_body, artifact_path=artifact_path
@@ -351,32 +353,31 @@
             # the model_file doesn't represent the actual target file name of the model, so we need to update it
             self.spec.model_target_file = target_model_path.split("/")[-1]
 
         spec_target_path = spec_target_path or path.join(
             self.spec.target_path, model_spec_filename
         )
         store_manager.object(url=spec_target_path).put(spec_body)
-        self.spec.extra_data[model_spec_filename] = spec_target_path
 
     def _get_file_body(self):
         body = self.spec.get_body()
         if body:
             return body
         src_model_path = _get_src_path(self, self.spec.model_file)
         if src_model_path and path.isfile(src_model_path):
             with open(src_model_path, "rb") as fp:
                 return fp.read()
         target_model_path = path.join(self.spec.target_path, self.spec.model_file)
         return mlrun.get_dataitem(target_model_path).get()
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyModelArtifact' will be removed in 1.5.0, use 'ModelArtifact' instead",
+    reason="'LegacyModelArtifact' will be removed in 1.6.0, use 'ModelArtifact' instead",
     category=FutureWarning,
 )
 class LegacyModelArtifact(LegacyArtifact):
     """ML Model artifact
 
     Store link to ML model file(s) along with the model metrics, parameters, schema, and stats
     """
@@ -608,14 +609,20 @@
     for k, v in extra_data.items():
         extra_dataitems[k] = store_manager.object(
             url=_get_file_path(target, v, isdir=is_dir), key=k
         )
     return extra_dataitems
 
 
+def _remove_tag_from_spec_yaml(model_spec):
+    spec_dict = model_spec.to_dict()
+    spec_dict["metadata"].pop("tag", None)
+    return yaml.dump(spec_dict)
+
+
 def update_model(
     model_artifact,
     parameters: dict = None,
     metrics: dict = None,
     extra_data: dict = None,
     inputs: List[Feature] = None,
     outputs: List[Feature] = None,
@@ -686,15 +693,19 @@
             if hasattr(item, "target_path"):
                 extra_data[key] = item.target_path
 
         upload_extra_data(model_spec, extra_data, prefix=key_prefix, update_spec=True)
 
     if write_spec_copy:
         spec_path = path.join(model_spec.target_path, model_spec_filename)
-        store_manager.object(url=spec_path).put(model_spec.to_yaml())
+
+        # the model spec yaml should not include the tag, as the same model can be used with different tags,
+        # and the tag is not part of the model spec but the metadata of the model artifact
+        model_spec_yaml = _remove_tag_from_spec_yaml(model_spec)
+        store_manager.object(url=spec_path).put(model_spec_yaml)
 
     model_spec.db_key = model_spec.db_key or model_spec.key
     if store_object:
         mlrun.get_run_db().store_artifact(
             model_spec.db_key,
             model_spec.to_dict(),
             model_spec.tree,
```

## mlrun/artifacts/plots.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -240,18 +240,18 @@
         Get the artifact's body - the Plotly figure's html code.
 
         :return: The figure's html code.
         """
         return self._figure.to_html()
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyPlotArtifact' will be removed in 1.5.0, use 'PlotArtifact' instead",
+    reason="'LegacyPlotArtifact' will be removed in 1.6.0, use 'PlotArtifact' instead",
     category=FutureWarning,
 )
 class LegacyPlotArtifact(LegacyArtifact):
     _TEMPLATE = """
 <h3 style="text-align:center">{}</h3>
 <img title="{}" src="data:image/png;base64,{}">
 """
@@ -287,18 +287,18 @@
             canvas.print_png(png_output)
             data = png_output.getvalue()
 
         data_uri = base64.b64encode(data).decode("utf-8")
         return self._TEMPLATE.format(self.description or self.key, self.key, data_uri)
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyChartArtifact' will be removed in 1.5.0, use 'ChartArtifact' instead",
+    reason="'LegacyChartArtifact' will be removed in 1.6.0, use 'ChartArtifact' instead",
     category=FutureWarning,
 )
 class LegacyChartArtifact(LegacyArtifact):
     _TEMPLATE = """
 <html>
   <head>
     <script
@@ -361,18 +361,18 @@
         return (
             self._TEMPLATE.replace("$data$", dict_to_json(data))
             .replace("$opts$", dict_to_json(self.options))
             .replace("$chart$", self.chart)
         )
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyBokehArtifact' will be removed in 1.5.0, use 'BokehArtifact' instead",
+    reason="'LegacyBokehArtifact' will be removed in 1.6.0, use 'BokehArtifact' instead",
     category=FutureWarning,
 )
 class LegacyBokehArtifact(LegacyArtifact):
     """
     Bokeh artifact is an artifact for saving Bokeh generated figures. They will be stored in a html format.
     """
 
@@ -417,18 +417,18 @@
         """
         from bokeh.embed import file_html
         from bokeh.resources import CDN
 
         return file_html(self._figure, CDN, self.key)
 
 
-# TODO: remove in 1.5.0
+# TODO: remove in 1.6.0
 @deprecated(
     version="1.3.0",
-    reason="'LegacyPlotlyArtifact' will be removed in 1.5.0, use 'PlotlyArtifact' instead",
+    reason="'LegacyPlotlyArtifact' will be removed in 1.6.0, use 'PlotlyArtifact' instead",
     category=FutureWarning,
 )
 class LegacyPlotlyArtifact(LegacyArtifact):
     """
     Plotly artifact is an artifact for saving Plotly generated figures. They will be stored in a html format.
     """
```

## mlrun/common/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/constants.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/types.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -43,14 +43,20 @@
     HeaderNames,
     LogsCollectorMode,
     OrderType,
     PatchMode,
     RunPartitionByField,
     SortField,
 )
+from .events import (
+    AuthSecretEventActions,
+    EventClientKinds,
+    EventsModes,
+    SecretEventActions,
+)
 from .feature_store import (
     EntitiesOutput,
     Entity,
     EntityListOutput,
     EntityRecord,
     Feature,
     FeatureListOutput,
@@ -87,31 +93,43 @@
     HubSource,
     HubSourceSpec,
     IndexedHubSource,
     last_source_index,
 )
 from .k8s import NodeSelectorOperator, Resources, ResourceSpec
 from .memory_reports import MostCommonObjectTypesReport, ObjectTypeReport
-from .model_endpoints import (
+from .model_monitoring import (
+    EndpointType,
+    EndpointUID,
+    EventFieldType,
+    EventKeyMetrics,
     Features,
     FeatureValues,
     GrafanaColumn,
     GrafanaDataPoint,
     GrafanaNumberColumn,
     GrafanaStringColumn,
     GrafanaTable,
     GrafanaTimeSeriesTarget,
     ModelEndpoint,
     ModelEndpointList,
     ModelEndpointMetadata,
     ModelEndpointSpec,
     ModelEndpointStatus,
+    ModelMonitoringMode,
     ModelMonitoringStoreKinds,
+    TimeSeriesTarget,
+)
+from .notification import (
+    Notification,
+    NotificationKind,
+    NotificationSeverity,
+    NotificationStatus,
+    SetNotificationRequest,
 )
-from .notification import NotificationSeverity, NotificationStatus
 from .object import ObjectKind, ObjectMetadata, ObjectSpec, ObjectStatus
 from .pipeline import PipelinesFormat, PipelinesOutput, PipelinesPagination
 from .project import (
     IguazioProject,
     Project,
     ProjectDesiredState,
     ProjectMetadata,
@@ -120,25 +138,28 @@
     ProjectsOutput,
     ProjectSpec,
     ProjectState,
     ProjectStatus,
     ProjectSummariesOutput,
     ProjectSummary,
 )
+from .regex import RegexMatchModes
+from .runs import RunIdentifier
 from .runtime_resource import (
     GroupedByJobRuntimeResourcesOutput,
     GroupedByProjectRuntimeResourcesOutput,
     KindRuntimeResources,
     ListRuntimeResourcesGroupByField,
     RuntimeResource,
     RuntimeResources,
     RuntimeResourcesOutput,
 )
 from .schedule import (
     ScheduleCronTrigger,
+    ScheduleIdentifier,
     ScheduleInput,
     ScheduleKinds,
     ScheduleOutput,
     ScheduleRecord,
     SchedulesOutput,
     ScheduleUpdate,
 )
```

## mlrun/common/schemas/artifact.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/auth.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -82,15 +82,17 @@
             AuthorizationResourceTypes.secret: "/projects/{project_name}/secrets/{resource_name}",
             AuthorizationResourceTypes.run: "/projects/{project_name}/runs/{resource_name}",
             # runtime resource doesn't have an identifier, we don't need any auth granularity behind project level
             AuthorizationResourceTypes.runtime_resource: "/projects/{project_name}/runtime-resources",
             AuthorizationResourceTypes.model_endpoint: "/projects/{project_name}/model-endpoints/{resource_name}",
             AuthorizationResourceTypes.pipeline: "/projects/{project_name}/pipelines/{resource_name}",
             # Hub sources are not project-scoped, and auth is globally on the sources endpoint.
-            AuthorizationResourceTypes.hub_source: "/hub/sources",
+            # TODO - this was reverted to /marketplace since MLRun needs to be able to run with old igz versions. Once
+            # we only have support for igz versions that support /hub (>=3.5.4), change this to "/hub/sources".
+            AuthorizationResourceTypes.hub_source: "/marketplace/sources",
         }[self].format(project_name=project_name, resource_name=resource_name)
 
 
 class AuthorizationVerificationInput(pydantic.BaseModel):
     resource: str
     action: AuthorizationAction
```

## mlrun/common/schemas/background_task.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/client_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/clusterization_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/constants.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/feature_store.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -44,14 +44,15 @@
     class Config:
         extra = Extra.allow
 
 
 class FeatureSetSpec(ObjectSpec):
     entities: List[Entity] = []
     features: List[Feature] = []
+    engine: Optional[str] = Field(default="storey")
 
 
 class FeatureSet(BaseModel):
     kind: ObjectKind = Field(ObjectKind.feature_set, const=True)
     metadata: ObjectMetadata
     spec: FeatureSetSpec
     status: ObjectStatus
```

## mlrun/common/schemas/frontend_spec.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/function.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -41,14 +41,31 @@
     # there is currently an abuse usage of the builder (lower) pod state as the function state, ideally these two would
     # map to deploying but for backwards compatibility reasons we have to keep them
     running = "running"
     pending = "pending"
     # same goes for the build which is not coming from the pod, but is used and we can't just omit it for BC reasons
     build = "build"
 
+    @classmethod
+    def get_function_state_from_pod_state(cls, pod_state: str):
+        if pod_state == "succeeded":
+            return cls.ready
+        if pod_state in ["failed", "error"]:
+            return cls.error
+        if pod_state in ["running", "pending"]:
+            return getattr(cls, pod_state)
+        return cls.unknown
+
+    @classmethod
+    def terminal_states(cls):
+        return [
+            cls.ready,
+            cls.error,
+        ]
+
 
 class PreemptionModes(mlrun.common.types.StrEnum):
     # makes function pods be able to run on preemptible nodes
     allow = "allow"
     # makes the function pods run on preemptible nodes only
     constrain = "constrain"
     # prevents the function pods from running on preemptible nodes
```

## mlrun/common/schemas/http.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/hub.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/k8s.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/memory_reports.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/notification.py

```diff
@@ -1,30 +1,58 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import datetime
+import typing
+
+import pydantic
 
 import mlrun.common.types
 
 
+class NotificationKind(mlrun.common.types.StrEnum):
+    console = "console"
+    git = "git"
+    ipython = "ipython"
+    slack = "slack"
+    webhook = "webhook"
+
+
 class NotificationSeverity(mlrun.common.types.StrEnum):
     INFO = "info"
     DEBUG = "debug"
     VERBOSE = "verbose"
     WARNING = "warning"
     ERROR = "error"
 
 
 class NotificationStatus(mlrun.common.types.StrEnum):
     PENDING = "pending"
     SENT = "sent"
     ERROR = "error"
+
+
+class Notification(pydantic.BaseModel):
+    kind: NotificationKind
+    name: str
+    message: str
+    severity: NotificationSeverity
+    when: typing.List[str]
+    condition: str
+    params: typing.Dict[str, typing.Any] = None
+    status: NotificationStatus = None
+    sent_time: typing.Union[str, datetime.datetime] = None
+
+
+class SetNotificationRequest(pydantic.BaseModel):
+    notifications: typing.List[Notification] = None
```

## mlrun/common/schemas/object.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -74,7 +74,11 @@
     feature_set = "FeatureSet"
     background_task = "BackgroundTask"
     feature_vector = "FeatureVector"
     model_endpoint = "model-endpoint"
     hub_source = "HubSource"
     hub_item = "HubItem"
     hub_catalog = "HubCatalog"
+
+
+class ObjectStatusState(mlrun.common.types.StrEnum):
+    CREATED = "created"
```

## mlrun/common/schemas/pipeline.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/project.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -79,14 +79,15 @@
     artifacts: typing.Optional[list] = []
     artifact_path: typing.Optional[str] = None
     conda: typing.Optional[str] = None
     source: typing.Optional[str] = None
     subpath: typing.Optional[str] = None
     origin_url: typing.Optional[str] = None
     desired_state: typing.Optional[ProjectDesiredState] = ProjectDesiredState.online
+    custom_packagers: typing.Optional[typing.List[typing.Tuple[str, bool]]] = None
 
     class Config:
         extra = pydantic.Extra.allow
 
 
 class Project(pydantic.BaseModel):
     kind: ObjectKind = pydantic.Field(ObjectKind.project, const=True)
```

## mlrun/common/schemas/runtime_resource.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/schedule.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,14 +11,21 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 from datetime import datetime
 from typing import Any, List, Optional, Union
 
+# TODO: When we remove support for python 3.7, we can use Literal from the typing package.
+#       Remove the following try/except block with import from typing_extensions.
+try:
+    from typing import Literal
+except ImportError:
+    from typing_extensions import Literal
+
 from pydantic import BaseModel
 
 import mlrun.common.types
 from mlrun.common.schemas.auth import Credentials
 from mlrun.common.schemas.object import LabelRecord
 
 
@@ -132,7 +139,12 @@
     last_run: Optional[dict] = {}
     labels: Optional[dict] = {}
     credentials: Credentials = Credentials()
 
 
 class SchedulesOutput(BaseModel):
     schedules: List[ScheduleOutput]
+
+
+class ScheduleIdentifier(BaseModel):
+    kind: Literal["schedule"] = "schedule"
+    name: str
```

## mlrun/common/schemas/secret.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/common/schemas/tag.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/data_types/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/data_types/data_types.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/data_types/infer.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/data_types/spark.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -25,27 +25,32 @@
     "CSVSource",
     "ParquetSource",
     "BigQuerySource",
     "HttpSource",
     "StreamSource",
     "KafkaSource",
     "RedisStore",
+    "DatabricksFileSystemDisableCache",
+    "DatabricksFileBugFixed",
 ]
 
+import fsspec
+
 import mlrun.datastore.wasbfs
 
 from ..platforms.iguazio import (
     HTTPOutputStream,
     KafkaOutputStream,
     OutputStream,
     parse_path,
 )
 from ..utils import logger
 from .base import DataItem
 from .datastore import StoreManager, in_memory_store, uri_to_ipython
+from .dbfs_store import DatabricksFileBugFixed, DatabricksFileSystemDisableCache
 from .s3 import parse_s3_bucket_and_key
 from .sources import (
     BigQuerySource,
     CSVSource,
     HttpSource,
     KafkaSource,
     ParquetSource,
@@ -58,14 +63,30 @@
     parse_store_uri,
 )
 from .targets import CSVTarget, NoSqlTarget, ParquetTarget, StreamTarget
 from .utils import parse_kafka_url
 
 store_manager = StoreManager()
 
+if hasattr(fsspec, "register_implementation"):
+    fsspec.register_implementation(
+        "dbfs", DatabricksFileSystemDisableCache, clobber=True
+    )
+else:
+    from fsspec.registry import known_implementations
+
+    known_implementations["dbfs"] = {
+        "class": "mlrun.datastore.dbfs_store.DatabricksFileSystemDisableCache",
+        "err": "Please make sure your fsspec version supports dbfs",
+    }
+
+    del known_implementations
+
+del fsspec  # clear the module namespace
+
 
 def set_in_memory_item(key, value):
     item = store_manager.object(f"memory://{key}")
     item.put(value)
     return item
```

## mlrun/datastore/azure_blob.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/base.py

```diff
@@ -1,36 +1,41 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
-import sys
 import tempfile
 import urllib.parse
 from base64 import b64encode
 from os import path, remove
+from typing import Optional, Union
 
 import dask.dataframe as dd
 import fsspec
 import orjson
 import pandas as pd
+import pyarrow
+import pytz
 import requests
 import urllib3
 
 import mlrun.errors
 from mlrun.errors import err_to_str
-from mlrun.utils import is_ipython, logger
+from mlrun.utils import StorePrefix, is_ipython, logger
+
+from .store_resources import is_store_uri, parse_store_uri
+from .utils import filter_df_start_end_time, select_columns_from_df
 
 verify_ssl = False
 if not verify_ssl:
     urllib3.disable_warnings(urllib3.exceptions.InsecureRequestWarning)
 
 
 class FileStats:
@@ -61,22 +66,33 @@
         return False
 
     @property
     def is_unstructured(self):
         return True
 
     @staticmethod
+    def _sanitize_url(url):
+        """
+        Extract only the schema, netloc, and path from an input URL if they exist,
+        excluding parameters, query, or fragments.
+        """
+        parsed_url = urllib.parse.urlparse(url)
+        scheme = f"{parsed_url.scheme}:" if parsed_url.scheme else ""
+        netloc = f"//{parsed_url.netloc}" if parsed_url.netloc else "//"
+        return f"{scheme}{netloc}{parsed_url.path}"
+
+    @staticmethod
     def uri_to_kfp(endpoint, subpath):
         raise ValueError("data store doesnt support KFP URLs")
 
     @staticmethod
     def uri_to_ipython(endpoint, subpath):
         return ""
 
-    def get_filesystem(self, silent=True):
+    def get_filesystem(self, silent=True) -> Optional[fsspec.AbstractFileSystem]:
         """return fsspec file system object, if supported"""
         return None
 
     def supports_isdir(self):
         """Whether the data store supports isdir"""
         return True
 
@@ -132,40 +148,108 @@
         with open(target_path, mode) as fp:
             fp.write(data)
             fp.close()
 
     def upload(self, key, src_path):
         pass
 
+    @staticmethod
+    def _parquet_reader(df_module, url, file_system, time_column, start_time, end_time):
+        from storey.utils import find_filters, find_partitions
+
+        def set_filters(
+            partitions_time_attributes, start_time_inner, end_time_inner, kwargs
+        ):
+            filters = []
+            find_filters(
+                partitions_time_attributes,
+                start_time_inner,
+                end_time_inner,
+                filters,
+                time_column,
+            )
+            kwargs["filters"] = filters
+
+        def reader(*args, **kwargs):
+            if start_time or end_time:
+                if time_column is None:
+                    raise mlrun.errors.MLRunInvalidArgumentError(
+                        "When providing start_time or end_time, must provide time_column"
+                    )
+
+                partitions_time_attributes = find_partitions(url, file_system)
+                set_filters(
+                    partitions_time_attributes,
+                    start_time,
+                    end_time,
+                    kwargs,
+                )
+                try:
+                    return df_module.read_parquet(*args, **kwargs)
+                except pyarrow.lib.ArrowInvalid as ex:
+                    if not str(ex).startswith(
+                        "Cannot compare timestamp with timezone to timestamp without timezone"
+                    ):
+                        raise ex
+
+                    if start_time.tzinfo:
+                        start_time_inner = start_time.replace(tzinfo=None)
+                        end_time_inner = end_time.replace(tzinfo=None)
+                    else:
+                        start_time_inner = start_time.replace(tzinfo=pytz.utc)
+                        end_time_inner = end_time.replace(tzinfo=pytz.utc)
+
+                    set_filters(
+                        partitions_time_attributes,
+                        start_time_inner,
+                        end_time_inner,
+                        kwargs,
+                    )
+                    return df_module.read_parquet(*args, **kwargs)
+            else:
+                return df_module.read_parquet(*args, **kwargs)
+
+        return reader
+
     def as_df(
         self,
         url,
         subpath,
         columns=None,
         df_module=None,
         format="",
         start_time=None,
         end_time=None,
         time_column=None,
         **kwargs,
     ):
         df_module = df_module or pd
-        parsed_url = urllib.parse.urlparse(url)
-        filepath = parsed_url.path
-        if filepath.endswith(".csv") or format == "csv":
+        file_url = self._sanitize_url(url)
+        is_csv, is_json, drop_time_column = False, False, False
+        file_system = self.get_filesystem()
+        if file_url.endswith(".csv") or format == "csv":
+            is_csv = True
+            drop_time_column = False
             if columns:
+                if (
+                    time_column
+                    and (start_time or end_time)
+                    and time_column not in columns
+                ):
+                    columns.append(time_column)
+                    drop_time_column = True
                 kwargs["usecols"] = columns
+
             reader = df_module.read_csv
-            filesystem = self.get_filesystem()
-            if filesystem:
-                if filesystem.isdir(filepath):
+            if file_system:
+                if file_system.isdir(file_url):
 
                     def reader(*args, **kwargs):
                         base_path = args[0]
-                        file_entries = filesystem.listdir(base_path)
+                        file_entries = file_system.listdir(base_path)
                         filenames = []
                         for file_entry in file_entries:
                             if (
                                 file_entry["name"].endswith(".csv")
                                 and file_entry["size"] > 0
                                 and file_entry["type"] == "file"
                             ):
@@ -173,80 +257,70 @@
                                 filename = filename.split("/")[-1]
                                 filenames.append(filename)
                         dfs = []
                         for filename in filenames:
                             updated_args = [f"{base_path}/{filename}"]
                             updated_args.extend(args[1:])
                             dfs.append(df_module.read_csv(*updated_args, **kwargs))
-                        return pd.concat(dfs)
+                        return df_module.concat(dfs)
 
         elif (
-            filepath.endswith(".parquet")
-            or filepath.endswith(".pq")
+            file_url.endswith(".parquet")
+            or file_url.endswith(".pq")
             or format == "parquet"
         ):
             if columns:
                 kwargs["columns"] = columns
 
-            def reader(*args, **kwargs):
-                if start_time or end_time:
-                    if sys.version_info < (3, 7):
-                        raise ValueError(
-                            f"feature not supported for python version {sys.version_info}"
-                        )
-
-                    if time_column is None:
-                        raise mlrun.errors.MLRunInvalidArgumentError(
-                            "When providing start_time or end_time, must provide time_column"
-                        )
-
-                    from storey.utils import find_filters, find_partitions
-
-                    filters = []
-                    partitions_time_attributes = find_partitions(url, file_system)
-
-                    find_filters(
-                        partitions_time_attributes,
-                        start_time,
-                        end_time,
-                        filters,
-                        time_column,
-                    )
-                    kwargs["filters"] = filters
-
-                return df_module.read_parquet(*args, **kwargs)
+            reader = self._parquet_reader(
+                df_module, url, file_system, time_column, start_time, end_time
+            )
 
-        elif filepath.endswith(".json") or format == "json":
+        elif file_url.endswith(".json") or format == "json":
+            is_json = True
             reader = df_module.read_json
 
         else:
             raise Exception(f"file type unhandled {url}")
 
-        file_system = self.get_filesystem()
         if file_system:
-            if self.supports_isdir() and file_system.isdir(url) or df_module == dd:
+            if self.supports_isdir() and file_system.isdir(file_url) or df_module == dd:
                 storage_options = self.get_storage_options()
                 if storage_options:
                     kwargs["storage_options"] = storage_options
-                return reader(url, **kwargs)
+                df = reader(url, **kwargs)
             else:
 
                 file = url
                 # Workaround for ARROW-12472 affecting pyarrow 3.x and 4.x.
                 if file_system.protocol != "file":
                     # If not dir, use file_system.open() to avoid regression when pandas < 1.2 and does not
                     # support the storage_options parameter.
                     file = file_system.open(url)
 
-                return reader(file, **kwargs)
-
-        temp_file = tempfile.NamedTemporaryFile(delete=False)
-        self.download(self._join(subpath), temp_file.name)
-        df = reader(temp_file.name, **kwargs)
-        remove(temp_file.name)
+                df = reader(file, **kwargs)
+        else:
+            temp_file = tempfile.NamedTemporaryFile(delete=False)
+            self.download(self._join(subpath), temp_file.name)
+            df = reader(temp_file.name, **kwargs)
+            remove(temp_file.name)
+
+        if is_json or is_csv:
+            # for parquet file the time filtering is executed in `reader`
+            df = filter_df_start_end_time(
+                df,
+                time_column=time_column,
+                start_time=start_time,
+                end_time=end_time,
+            )
+            if drop_time_column:
+                df.drop(columns=[time_column], inplace=True)
+        if is_json:
+            # for csv and parquet files the columns select is executed in `reader`.
+            df = select_columns_from_df(df, columns=columns)
         return df
 
     def to_dict(self):
         return {
             "name": self.name,
             "url": f"{self.kind}://{self.endpoint}/{self.subpath}",
             "secret_pfx": self.secret_pfx,
@@ -414,30 +488,41 @@
             self._local_path = ""
 
     def as_df(
         self,
         columns=None,
         df_module=None,
         format="",
+        time_column=None,
+        start_time=None,
+        end_time=None,
         **kwargs,
     ):
         """return a dataframe object (generated from the dataitem).
 
-        :param columns:   optional, list of columns to select
-        :param df_module: optional, py module used to create the DataFrame (e.g. pd, dd, cudf, ..)
-        :param format:    file format, if not specified it will be deducted from the suffix
+        :param columns:     optional, list of columns to select
+        :param df_module:   optional, py module used to create the DataFrame (e.g. pd, dd, cudf, ..)
+        :param format:      file format, if not specified it will be deducted from the suffix
+        :param start_time:  filters out data before this time
+        :param end_time:    filters out data after this time
+        :param time_column: Store timestamp_key will be used if None.
+                            The results will be filtered by this column and start_time & end_time.
         """
-        return self._store.as_df(
+        df = self._store.as_df(
             self._url,
             self._path,
             columns=columns,
             df_module=df_module,
             format=format,
+            time_column=time_column,
+            start_time=start_time,
+            end_time=end_time,
             **kwargs,
         )
+        return df
 
     def show(self, format=None):
         """show the data object content in Jupyter
 
         :param format: format to use (when there is no/wrong suffix), e.g. 'png'
         """
         if not is_ipython:
@@ -463,14 +548,27 @@
         elif suffix == ".json":
             display.display(display.JSON(orjson.loads(self.get())))
         elif suffix == ".md":
             display.display(display.Markdown(self.get(encoding="utf-8")))
         else:
             logger.error(f"unsupported show() format {suffix} for {self.url}")
 
+    def get_artifact_type(self) -> Union[str, None]:
+        """
+        Check if the data item represents an Artifact (one of Artifact, DatasetArtifact and ModelArtifact). If it does
+        it return the store uri prefix (artifacts, datasets or models), otherwise None.
+
+        :return: The store prefix of the artifact if it is an artifact data item and None if not.
+        """
+        if self.artifact_url and is_store_uri(url=self.artifact_url):
+            store_uri_prefix = parse_store_uri(self.artifact_url)[0]
+            if StorePrefix.is_artifact(prefix=store_uri_prefix):
+                return store_uri_prefix
+        return None
+
     def __str__(self):
         return self.url
 
     def __repr__(self):
         return f"'{self.url}'"
```

## mlrun/datastore/datastore.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -82,14 +82,18 @@
         try:
             from .google_cloud_storage import GoogleCloudStorageStore
         except ImportError:
             raise mlrun.errors.MLRunMissingDependencyError(
                 "Google cloud storage packages are missing, use pip install mlrun[google-cloud-storage]"
             )
         return GoogleCloudStorageStore
+    elif schema == "dbfs":
+        from .dbfs_store import DBFSStore
+
+        return DBFSStore
     else:
         raise ValueError(f"unsupported store scheme ({schema})")
 
 
 def uri_to_ipython(link):
     schema, endpoint, parsed_url = parse_url(link)
     if schema in [DB_SCHEMA, "memory"]:
@@ -171,14 +175,19 @@
         if is_store_uri(url):
             artifact_url = url
             meta, url = self.get_store_artifact(
                 url, project, allow_empty_resources, secrets
             )
 
         store, subpath = self.get_or_create_store(url, secrets=secrets)
+        schema, endpoint, parsed_url = parse_url(url)
+        #  TODO: Modify the URL replacement to be outside of the dataitem. Dataitem class should
+        #   be implemented as a generic class.
+        if endpoint and schema == "dbfs":
+            url = url.replace(endpoint, "", 1)
         return DataItem(key, store, subpath, url, meta=meta, artifact_url=artifact_url)
 
     def get_or_create_store(self, url, secrets: dict = None) -> (DataStore, str):
         schema, endpoint, parsed_url = parse_url(url)
         subpath = parsed_url.path
 
         if schema == "memory":
```

## mlrun/datastore/filestore.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/google_cloud_storage.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2021 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/inmem.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -76,9 +76,12 @@
             if columns:
                 kwargs["columns"] = columns
             reader = df_module.read_parquet
         elif url.endswith(".json") or format == "json":
             reader = df_module.read_json
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(f"file type unhandled {url}")
+        # InMemoryStore store do not filter on time
+        for field in ["time_column", "start_time", "end_time"]:
+            kwargs.pop(field, None)
 
         return reader(item, **kwargs)
```

## mlrun/datastore/redis.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2022 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/s3.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/sources.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -28,15 +28,20 @@
 import mlrun
 from mlrun.secrets import SecretsStore
 
 from ..config import config
 from ..model import DataSource
 from ..platforms.iguazio import parse_path
 from ..utils import get_class
-from .utils import store_path_to_spark
+from .utils import (
+    _generate_sql_query_with_time_filter,
+    filter_df_start_end_time,
+    select_columns_from_df,
+    store_path_to_spark,
+)
 
 
 def get_source_from_dict(source):
     kind = source.get("kind", "")
     if not kind:
         return None
     return source_kind_to_driver[kind].from_dict(source)
@@ -69,40 +74,56 @@
 
         return storey.SyncEmitSource(context=context)
 
     def get_table_object(self):
         """get storey Table object"""
         return None
 
-    def to_dataframe(self):
-        return mlrun.store_manager.object(url=self.path).as_df()
-
-    def filter_df_start_end_time(self, df, time_field):
-        # give priority to source time_field over the feature set's timestamp_key
-        if self.time_field:
-            time_field = self.time_field
-
-        if self.start_time or self.end_time:
-            self.start_time = (
-                datetime.min if self.start_time is None else self.start_time
-            )
-            self.end_time = datetime.max if self.end_time is None else self.end_time
-            df = df.filter(
-                (df[time_field] > self.start_time) & (df[time_field] <= self.end_time)
-            )
-        return df
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
+        """return the source data as dataframe"""
+        return mlrun.store_manager.object(url=self.path).as_df(
+            columns=columns,
+            df_module=df_module,
+            start_time=start_time or self.start_time,
+            end_time=end_time or self.end_time,
+            time_column=time_field or self.time_field,
+        )
 
-    def to_spark_df(self, session, named_view=False, time_field=None):
+    def to_spark_df(self, session, named_view=False, time_field=None, columns=None):
         if self.support_spark:
             df = session.read.load(**self.get_spark_options())
             if named_view:
                 df.createOrReplaceTempView(self.name)
-            return df
+            return self._filter_spark_df(df, time_field, columns)
         raise NotImplementedError()
 
+    def _filter_spark_df(self, df, time_field=None, columns=None):
+        if not (columns or time_field):
+            return df
+
+        from pyspark.sql.functions import col
+
+        if time_field:
+            if self.start_time:
+                df = df.filter(col(time_field) > self.start_time)
+            if self.end_time:
+                df = df.filter(col(time_field) <= self.end_time)
+
+        if columns:
+            df = df.select([col(name) for name in columns])
+        return df
+
     def get_spark_options(self):
         # options used in spark.read.load(**options)
         raise NotImplementedError()
 
     def is_iterator(self):
         return False
 
@@ -182,37 +203,50 @@
         return {
             "path": store_path_to_spark(self.path),
             "format": "csv",
             "header": "true",
             "inferSchema": "true",
         }
 
-    def to_spark_df(self, session, named_view=False, time_field=None):
+    def to_spark_df(self, session, named_view=False, time_field=None, columns=None):
         import pyspark.sql.functions as funcs
 
         df = session.read.load(**self.get_spark_options())
 
         parse_dates = self._parse_dates or []
         if time_field and time_field not in parse_dates:
             parse_dates.append(time_field)
 
         for col_name, col_type in df.dtypes:
             if parse_dates and col_name in parse_dates:
                 df = df.withColumn(col_name, funcs.col(col_name).cast("timestamp"))
         if named_view:
             df.createOrReplaceTempView(self.name)
-        return df
+        return self._filter_spark_df(df, time_field, columns)
 
-    def to_dataframe(self):
-        kwargs = self.attributes.get("reader_args", {})
-        chunksize = self.attributes.get("chunksize")
-        if chunksize:
-            kwargs["chunksize"] = chunksize
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
+        reader_args = self.attributes.get("reader_args", {})
         return mlrun.store_manager.object(url=self.path).as_df(
-            parse_dates=self._parse_dates, **kwargs
+            columns=columns,
+            df_module=df_module,
+            format="csv",
+            start_time=start_time or self.start_time,
+            end_time=end_time or self.end_time,
+            time_column=time_field or self.time_field,
+            parse_dates=self._parse_dates,
+            chunksize=self.attributes.get("chunksize"),
+            **reader_args,
         )
 
     def is_iterator(self):
         return bool(self.attributes.get("chunksize"))
 
 
 class ParquetSource(BaseSourceDriver):
@@ -311,18 +345,32 @@
 
     def get_spark_options(self):
         return {
             "path": store_path_to_spark(self.path),
             "format": "parquet",
         }
 
-    def to_dataframe(self):
-        kwargs = self.attributes.get("reader_args", {})
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
+        reader_args = self.attributes.get("reader_args", {})
         return mlrun.store_manager.object(url=self.path).as_df(
-            format="parquet", **kwargs
+            columns=columns,
+            df_module=df_module,
+            start_time=start_time or self.start_time,
+            end_time=end_time or self.end_time,
+            time_column=time_field or self.time_field,
+            format="parquet",
+            **reader_args,
         )
 
 
 class BigQuerySource(BaseSourceDriver):
     """
     Reads Google BigQuery query results as input source for a flow.
 
@@ -375,14 +423,15 @@
         key_field: str = None,
         time_field: str = None,
         schedule: str = None,
         start_time=None,
         end_time=None,
         gcp_project: str = None,
         spark_options: dict = None,
+        **kwargs,
     ):
         if query and table:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "cannot specify both table and query args"
             )
         # Otherwise, the client library does not fully respect the limit
         if (
@@ -407,14 +456,15 @@
             name,
             attributes=attrs,
             key_field=key_field,
             time_field=time_field,
             schedule=schedule,
             start_time=start_time,
             end_time=end_time,
+            **kwargs,
         )
 
     def _get_credentials_string(self):
         gcp_project = self.attributes.get("gcp_project", None)
         key = "GCP_CREDENTIALS"
         gcp_cred_string = os.getenv(key) or os.getenv(
             SecretsStore.k8s_env_variable_name_for_secret(key)
@@ -429,15 +479,23 @@
             gcp_cred_dict = json.loads(gcp_cred_string, strict=False)
             credentials = service_account.Credentials.from_service_account_info(
                 gcp_cred_dict
             )
             return credentials, gcp_project or gcp_cred_dict["project_id"]
         return None, gcp_project
 
-    def to_dataframe(self):
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
         from google.cloud import bigquery
         from google.cloud.bigquery_storage_v1 import BigQueryReadClient
 
         def schema_to_dtypes(schema):
             from mlrun.data_types.data_types import gbq_to_pandas_dtype
 
             dtypes = {}
@@ -466,24 +524,35 @@
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "table or query args must be specified"
             )
 
         dtypes = schema_to_dtypes(rows_iterator.schema)
         if chunksize:
             # passing bqstorage_client greatly improves performance
-            return rows_iterator.to_dataframe_iterable(
+            df = rows_iterator.to_dataframe_iterable(
                 bqstorage_client=BigQueryReadClient(), dtypes=dtypes
             )
         else:
-            return rows_iterator.to_dataframe(dtypes=dtypes)
+            df = rows_iterator.to_dataframe(dtypes=dtypes)
+
+        # TODO : filter as part of the query
+        return select_columns_from_df(
+            filter_df_start_end_time(
+                df,
+                time_column=time_field or self.time_field,
+                start_time=start_time or self.start_time,
+                end_time=end_time or self.end_time,
+            ),
+            columns=columns,
+        )
 
     def is_iterator(self):
         return bool(self.attributes.get("chunksize"))
 
-    def to_spark_df(self, session, named_view=False, time_field=None):
+    def to_spark_df(self, session, named_view=False, time_field=None, columns=None):
         options = copy(self.attributes.get("spark_options", {}))
         credentials, gcp_project = self._get_credentials_string()
         if credentials:
             options["credentials"] = b64encode(credentials.encode("utf-8")).decode(
                 "utf-8"
             )
         if gcp_project:
@@ -505,15 +574,15 @@
             options["query"] = query
         elif table:
             options["path"] = table
 
         df = session.read.format("bigquery").load(**options)
         if named_view:
             df.createOrReplaceTempView(self.name)
-        return df
+        return self._filter_spark_df(df, time_field, columns)
 
 
 class SnowflakeSource(BaseSourceDriver):
     """
     Reads Snowflake query results as input source for a flow.
 
     The Snowflake cluster's password must be provided using the SNOWFLAKE_PASSWORD environment variable or secret.
@@ -560,14 +629,15 @@
         end_time=None,
         query: str = None,
         url: str = None,
         user: str = None,
         database: str = None,
         schema: str = None,
         warehouse: str = None,
+        **kwargs,
     ):
         attrs = {
             "query": query,
             "url": url,
             "user": user,
             "database": database,
             "schema": schema,
@@ -578,14 +648,15 @@
             name,
             attributes=attrs,
             key_field=key_field,
             time_field=time_field,
             schedule=schedule,
             start_time=start_time,
             end_time=end_time,
+            **kwargs,
         )
 
     def _get_password(self):
         key = "SNOWFLAKE_PASSWORD"
         snowflake_password = os.getenv(key) or os.getenv(
             SecretsStore.k8s_env_variable_name_for_secret(key)
         )
@@ -669,15 +740,15 @@
 
         return storey.DataframeSource(
             dfs=self._df,
             key_field=self.key_field or key_field,
             context=self.context or context,
         )
 
-    def to_dataframe(self):
+    def to_dataframe(self, **kwargs):
         return self._df
 
     def is_iterator(self):
         return self.iterator
 
 
 class OnlineSource(BaseSourceDriver):
@@ -718,14 +789,15 @@
         )
         source_args = self.attributes.get("source_args", {})
 
         src_class = source_class(
             context=context,
             key_field=self.key_field,
             full_event=True,
+            explicit_ack=mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
             **source_args,
         )
 
         return src_class
 
     def add_nuclio_trigger(self, function):
         raise mlrun.errors.MLRunInvalidArgumentError(
@@ -844,15 +916,23 @@
             sasl["enabled"] = True
             sasl["user"] = sasl_user
             sasl["password"] = sasl_pass
         if sasl:
             attributes["sasl"] = sasl
         super().__init__(attributes=attributes, **kwargs)
 
-    def to_dataframe(self):
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
         raise mlrun.MLRunInvalidArgumentError(
             "KafkaSource does not support batch processing"
         )
 
     def add_nuclio_trigger(self, function):
         extra_attributes = copy(self.attributes)
         partitions = extra_attributes.pop("partitions", None)
@@ -885,21 +965,23 @@
         schedule: str = None,
         start_time: Optional[Union[datetime, str]] = None,
         end_time: Optional[Union[datetime, str]] = None,
         db_url: str = None,
         table_name: str = None,
         spark_options: dict = None,
         time_fields: List[str] = None,
+        parse_dates: List[str] = None,
+        **kwargs,
     ):
         """
         Reads SqlDB as input source for a flow.
         example::
-            db_path = "mysql+pymysql://<username>:<password>@<host>:<port>/<db_name>"
+            db_url = "mysql+pymysql://<username>:<password>@<host>:<port>/<db_name>"
             source = SQLSource(
-                collection_name='source_name', db_path=self.db, key_field='key'
+                table_name='source_name', db_url=db_url, key_field='key'
             )
         :param name:            source name
         :param chunksize:       number of rows per chunk (default large single chunk)
         :param key_field:       the column to be used as the key for the collection.
         :param time_field:      the column to be parsed as timestamp for events. Defaults to None
         :param start_time:      filters out data before this time
         :param end_time:        filters out data after this time
@@ -908,58 +990,87 @@
                                 cause the job to run every 30 minutes
         :param db_url:         url string connection to sql database.
                                 If not set, the MLRUN_SQL__URL environment variable will be used.
         :param table_name:      the name of the collection to access,
                                 from the current database
         :param spark_options:   additional spark read options
         :param time_fields :    all the field to be parsed as timestamp.
+        :param parse_dates :    all the field to be parsed as timestamp.
         """
-
+        if time_fields:
+            warnings.warn(
+                "'time_fields' is deprecated, use 'parse_dates' instead. "
+                "This will be removed in 1.6.0",
+                # TODO: Remove this in 1.6.0
+                FutureWarning,
+            )
+            parse_dates = time_fields
         db_url = db_url or mlrun.mlconf.sql.url
         if db_url is None:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "cannot specify without db_path arg or secret MLRUN_SQL__URL"
             )
+        if time_field:
+            if parse_dates:
+                time_fields.append(time_field)
+            else:
+                parse_dates = [time_field]
         attrs = {
             "chunksize": chunksize,
             "spark_options": spark_options,
             "table_name": table_name,
             "db_path": db_url,
-            "time_fields": time_fields,
+            "parse_dates": parse_dates,
         }
         attrs = {key: value for key, value in attrs.items() if value is not None}
         super().__init__(
             name,
             attributes=attrs,
             key_field=key_field,
             time_field=time_field,
             schedule=schedule,
             start_time=start_time,
             end_time=end_time,
+            **kwargs,
         )
 
-    def to_dataframe(self):
-        import sqlalchemy as db
+    def to_dataframe(
+        self,
+        columns=None,
+        df_module=None,
+        entities=None,
+        start_time=None,
+        end_time=None,
+        time_field=None,
+    ):
+        import sqlalchemy as sqlalchemy
 
-        query = self.attributes.get("query", None)
         db_path = self.attributes.get("db_path")
         table_name = self.attributes.get("table_name")
-        params = None
-        if not query:
-            query = "SELECT * FROM %(table)s"
-            params = {"table": table_name}
+        parse_dates = self.attributes.get("parse_dates")
+        time_field = time_field or self.time_field
+        start_time = start_time or self.start_time
+        end_time = end_time or self.end_time
         if table_name and db_path:
-            engine = db.create_engine(db_path)
+            engine = sqlalchemy.create_engine(db_path)
+            query, parse_dates = _generate_sql_query_with_time_filter(
+                table_name=table_name,
+                engine=engine,
+                time_column=time_field,
+                parse_dates=parse_dates,
+                start_time=start_time,
+                end_time=end_time,
+            )
             with engine.connect() as con:
                 return pd.read_sql(
                     query,
                     con=con,
-                    params=params,
                     chunksize=self.attributes.get("chunksize"),
-                    parse_dates=self.attributes.get("time_fields"),
+                    parse_dates=parse_dates,
+                    columns=columns,
                 )
         else:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "table_name and db_name args must be specified"
             )
 
     def to_step(self, key_field=None, time_field=None, context=None):
```

## mlrun/datastore/spark_udf.py

```diff
@@ -21,19 +21,23 @@
     list_to_hash = [str(element) for element in list_to_hash]
     str_concatted = "".join(list_to_hash)
     sha1 = hashlib.sha1()
     sha1.update(str_concatted.encode("utf8"))
     return sha1.hexdigest()
 
 
-def _redis_stringify_key(key_list):
+def _redis_stringify_key(*args):
+    if len(args) == 1:
+        key_list = args[0]
+    else:
+        key_list = list(args)
     suffix = "}:static"
     if isinstance(key_list, list):
-        if len(key_list) >= 2:
-            return str(key_list[0]) + "." + _hash_list(key_list[1:]) + suffix
+        if len(key_list) >= 3:
+            return str(key_list[0]) + "." + _hash_list(*key_list[1:]) + suffix
         if len(key_list) == 2:
             return str(key_list[0]) + "." + str(key_list[1]) + suffix
         return str(key_list[0]) + suffix
     return str(key_list) + suffix
 
 
 hash_and_concat_v3io_udf = udf(_hash_list, StringType())
```

## mlrun/datastore/store_resources.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,20 +12,17 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
 import mlrun
 from mlrun.config import config
-from mlrun.utils.helpers import (
-    is_legacy_artifact,
-    parse_artifact_uri,
-    parse_versioned_object_uri,
-)
+from mlrun.utils.helpers import is_legacy_artifact, parse_artifact_uri
 
+from ..common.helpers import parse_versioned_object_uri
 from ..platforms.iguazio import parse_path
 from ..utils import DB_SCHEMA, StorePrefix
 from .targets import get_online_target
 
 
 def is_store_uri(url):
     """detect if the uri starts with the store schema prefix"""
```

## mlrun/datastore/targets.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,15 @@
 # limitations under the License.
 import ast
 import datetime
 import os
 import random
 import sys
 import time
+import warnings
 from collections import Counter
 from copy import copy
 from typing import Any, Dict, List, Optional, Union
 from urllib.parse import urlparse
 
 import pandas as pd
 import sqlalchemy
@@ -31,15 +32,21 @@
 from mlrun.model import DataSource, DataTarget, DataTargetBase, TargetPathObject
 from mlrun.utils import now_date
 from mlrun.utils.v3io_clients import get_frames_client
 
 from .. import errors
 from ..data_types import ValueType
 from ..platforms.iguazio import parse_path, split_path
-from .utils import parse_kafka_url, store_path_to_spark
+from .utils import (
+    _generate_sql_query_with_time_filter,
+    filter_df_start_end_time,
+    parse_kafka_url,
+    select_columns_from_df,
+    store_path_to_spark,
+)
 
 
 class TargetTypes:
     csv = "csv"
     parquet = "parquet"
     nosql = "nosql"
     redisnosql = "redisnosql"
@@ -71,19 +78,20 @@
 
 
 def default_target_names():
     targets = mlrun.mlconf.feature_store.default_targets
     return [target.strip() for target in targets.split(",")]
 
 
-def get_default_targets():
+def get_default_targets(offline_only=False):
     """initialize the default feature set targets list"""
     return [
         DataTargetBase(target, name=str(target), partitioned=(target == "parquet"))
         for target in default_target_names()
+        if not offline_only or not target == "nosql"
     ]
 
 
 def update_targets_run_id_for_ingest(overwrite, targets, targets_in_status):
     run_id = generate_target_run_id()
     for target in targets:
         if overwrite or not (target.name in targets_in_status.keys()):
@@ -983,14 +991,17 @@
         **kwargs,
     ):
         df = super().as_df(
             columns=columns,
             df_module=df_module,
             entities=entities,
             format="csv",
+            start_time=start_time,
+            end_time=end_time,
+            time_column=time_column,
             **kwargs,
         )
         if entities:
             df.set_index(keys=entities, inplace=True)
         return df
 
     def is_single_file(self):
@@ -1470,15 +1481,23 @@
         columns=None,
         df_module=None,
         start_time=None,
         end_time=None,
         time_column=None,
         **kwargs,
     ):
-        return self._df
+        return select_columns_from_df(
+            filter_df_start_end_time(
+                self._df,
+                time_column=time_column,
+                start_time=start_time,
+                end_time=end_time,
+            ),
+            columns,
+        )
 
 
 class SQLTarget(BaseStoreTarget):
     kind = TargetTypes.sql
     is_online = True
     support_spark = False
     support_storey = True
@@ -1501,22 +1520,23 @@
         schema: Dict[str, Any] = None,
         primary_key_column: str = "",
         if_exists: str = "append",
         create_table: bool = False,
         # create_according_to_data: bool = False,
         time_fields: List[str] = None,
         varchar_len: int = 50,
+        parse_dates: List[str] = None,
     ):
         """
         Write to SqlDB as output target for a flow.
         example::
-             db_path = "sqlite:///stockmarket.db"
+             db_url = "sqlite:///stockmarket.db"
              schema = {'time': datetime.datetime, 'ticker': str,
                     'bid': float, 'ask': float, 'ind': int}
-             target = SqlDBTarget(table_name=f'{name}-tatget', db_path=db_path, create_table=True,
+             target = SqlDBTarget(table_name=f'{name}-target', db_url=db_url, create_table=True,
                                    schema=schema, primary_key_column=key)
         :param name:
         :param path:
         :param attributes:
         :param after_step:
         :param partitioned:
         :param key_bucketing_number:
@@ -1538,29 +1558,38 @@
                                             - replace: If table exists, drop it, recreate it, and insert data.
                                             - append: If table exists, insert data. Create if does not exist.
         :param create_table:                pass True if you want to create new table named by
                                             table_name with schema on current database.
         :param create_according_to_data:    (not valid)
         :param time_fields :    all the field to be parsed as timestamp.
         :param varchar_len :    the defalut len of the all the varchar column (using if needed to create the table).
+        :param parse_dates :    all the field to be parsed as timestamp.
         """
         create_according_to_data = False  # TODO: open for user
+        if time_fields:
+            warnings.warn(
+                "'time_fields' is deprecated, use 'parse_dates' instead. "
+                "This will be removed in 1.6.0",
+                # TODO: Remove this in 1.6.0
+                FutureWarning,
+            )
+            parse_dates = time_fields
         db_url = db_url or mlrun.mlconf.sql.url
         if db_url is None or table_name is None:
             attr = {}
         else:
             # check for table existence and acts according to the user input
             self._primary_key_column = primary_key_column
 
             attr = {
                 "table_name": table_name,
                 "db_path": db_url,
                 "create_according_to_data": create_according_to_data,
                 "if_exists": if_exists,
-                "time_fields": time_fields,
+                "parse_dates": parse_dates,
                 "varchar_len": varchar_len,
             }
             path = (
                 f"mlrunSql://@{db_url}//@{table_name}"
                 f"//@{str(create_according_to_data)}//@{if_exists}//@{primary_key_column}//@{create_table}"
             )
 
@@ -1639,25 +1668,32 @@
         start_time=None,
         end_time=None,
         time_column=None,
         **kwargs,
     ):
         db_path, table_name, _, _, _, _ = self._parse_url()
         engine = sqlalchemy.create_engine(db_path)
+        parse_dates: Optional[List[str]] = self.attributes.get("parse_dates")
         with engine.connect() as conn:
+            query, parse_dates = _generate_sql_query_with_time_filter(
+                table_name=table_name,
+                engine=engine,
+                time_column=time_column,
+                parse_dates=parse_dates,
+                start_time=start_time,
+                end_time=end_time,
+            )
             df = pd.read_sql(
-                "SELECT * FROM %(table)s",
+                query,
                 con=conn,
-                params={"table": self.attributes.get("table_name")},
-                parse_dates=self.attributes.get("time_fields"),
+                parse_dates=parse_dates,
+                columns=columns,
             )
             if self._primary_key_column:
                 df.set_index(self._primary_key_column, inplace=True)
-            if columns:
-                df = df[columns]
         return df
 
     def write_dataframe(
         self, df, key_column=None, timestamp_key=None, chunk_id=0, **kwargs
     ):
         self._create_sql_table()
```

## mlrun/datastore/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,17 @@
 # limitations under the License.
 #
 import tarfile
 import tempfile
 import typing
 from urllib.parse import parse_qs, urlparse
 
+import pandas as pd
+import sqlalchemy
+
 import mlrun.datastore
 
 
 def store_path_to_spark(path):
     if path.startswith("redis://") or path.startswith("rediss://"):
         url = urlparse(path)
         if url.path:
@@ -69,15 +72,97 @@
     else:
         topic = url.path
         topic = topic.lstrip("/")
     return topic, bootstrap_servers
 
 
 def upload_tarball(source_dir, target, secrets=None):
-
     # will delete the temp file
     with tempfile.NamedTemporaryFile(suffix=".tar.gz") as temp_fh:
         with tarfile.open(mode="w:gz", fileobj=temp_fh) as tar:
             tar.add(source_dir, arcname="")
         stores = mlrun.datastore.store_manager.set(secrets)
         datastore, subpath = stores.get_or_create_store(target)
         datastore.upload(subpath, temp_fh.name)
+
+
+def filter_df_start_end_time(
+    df: typing.Union[pd.DataFrame, typing.Iterator[pd.DataFrame]],
+    time_column: str = None,
+    start_time: pd.Timestamp = None,
+    end_time: pd.Timestamp = None,
+) -> typing.Union[pd.DataFrame, typing.Iterator[pd.DataFrame]]:
+    if not time_column or (not start_time and not end_time):
+        return df
+    if isinstance(df, pd.DataFrame):
+        return _execute_time_filter(df, time_column, start_time, end_time)
+    else:
+        return filter_df_generator(df, time_column, start_time, end_time)
+
+
+def filter_df_generator(
+    dfs: typing.Iterator[pd.DataFrame],
+    time_field: str,
+    start_time: pd.Timestamp,
+    end_time: pd.Timestamp,
+) -> typing.Iterator[pd.DataFrame]:
+    for df in dfs:
+        yield _execute_time_filter(df, time_field, start_time, end_time)
+
+
+def _execute_time_filter(
+    df: pd.DataFrame, time_column: str, start_time: pd.Timestamp, end_time: pd.Timestamp
+):
+    df[time_column] = pd.to_datetime(df[time_column])
+    if start_time:
+        df = df[df[time_column] > start_time]
+    if end_time:
+        df = df[df[time_column] <= end_time]
+    return df
+
+
+def select_columns_from_df(
+    df: typing.Union[pd.DataFrame, typing.Iterator[pd.DataFrame]],
+    columns: typing.List[str],
+) -> typing.Union[pd.DataFrame, typing.Iterator[pd.DataFrame]]:
+    if not columns:
+        return df
+    if isinstance(df, pd.DataFrame):
+        return df[columns]
+    else:
+        return select_columns_generator(df, columns)
+
+
+def select_columns_generator(
+    dfs: typing.Union[pd.DataFrame, typing.Iterator[pd.DataFrame]],
+    columns: typing.List[str],
+) -> typing.Iterator[pd.DataFrame]:
+    for df in dfs:
+        yield df[columns]
+
+
+def _generate_sql_query_with_time_filter(
+    table_name: str,
+    engine: sqlalchemy.engine.Engine,
+    time_column: str,
+    parse_dates: typing.List[str],
+    start_time: pd.Timestamp,
+    end_time: pd.Timestamp,
+):
+    table = sqlalchemy.Table(
+        table_name,
+        sqlalchemy.MetaData(),
+        autoload=True,
+        autoload_with=engine,
+    )
+    query = sqlalchemy.select(table)
+    if time_column:
+        if parse_dates and time_column not in parse_dates:
+            parse_dates.append(time_column)
+        else:
+            parse_dates = [time_column]
+        if start_time:
+            query = query.filter(getattr(table.c, time_column) > start_time)
+        if end_time:
+            query = query.filter(getattr(table.c, time_column) <= end_time)
+
+    return query, parse_dates
```

## mlrun/datastore/v3io.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -18,30 +18,29 @@
 from copy import deepcopy
 from datetime import datetime
 
 import fsspec
 import v3io.dataplane
 
 import mlrun
+from mlrun.datastore.helpers import ONE_GB, ONE_MB
 
 from ..platforms.iguazio import parse_path, split_path
 from .base import (
     DataStore,
     FileStats,
     basic_auth_header,
     get_range,
     http_get,
     http_head,
     http_put,
     http_upload,
 )
 
 V3IO_LOCAL_ROOT = "v3io"
-ONE_GB = 1024 * 1024 * 1024
-ONE_MB = 1024 * 1024
 
 
 class V3ioStore(DataStore):
     def __init__(self, parent, schema, name, endpoint="", secrets: dict = None):
         super().__init__(parent, name, schema, endpoint, secrets=secrets)
         self.endpoint = self.endpoint or mlrun.mlconf.v3io_api
```

## mlrun/datastore/wasbfs/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2020 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/datastore/wasbfs/fs.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2022 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/db/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/db/base.py

```diff
@@ -1,22 +1,23 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import datetime
+import typing
 import warnings
 from abc import ABC, abstractmethod
 from typing import List, Optional, Union
 
 import mlrun.common.schemas
 import mlrun.model_monitoring.model_endpoint
 
@@ -45,15 +46,15 @@
         pass
 
     @abstractmethod
     def update_run(self, updates: dict, uid, project="", iter=0):
         pass
 
     @abstractmethod
-    def abort_run(self, uid, project="", iter=0):
+    def abort_run(self, uid, project="", iter=0, timeout=45):
         pass
 
     @abstractmethod
     def read_run(self, uid, project="", iter=0):
         pass
 
     @abstractmethod
@@ -608,7 +609,15 @@
         func: "mlrun.runtimes.BaseRuntime",
         offset: int = 0,
         logs: bool = True,
         last_log_timestamp: float = 0.0,
         verbose: bool = False,
     ):
         pass
+
+    def set_run_notifications(
+        self,
+        project: str,
+        runs: typing.List[mlrun.model.RunObject],
+        notifications: typing.List[mlrun.model.Notification],
+    ):
+        pass
```

## mlrun/db/httpdb.py

```diff
@@ -1,8 +1,8 @@
-00000000: 2320 436f 7079 7269 6768 7420 3230 3138  # Copyright 2018
+00000000: 2320 436f 7079 7269 6768 7420 3230 3233  # Copyright 2023
 00000010: 2049 6775 617a 696f 0a23 0a23 204c 6963   Iguazio.#.# Lic
 00000020: 656e 7365 6420 756e 6465 7220 7468 6520  ensed under the 
 00000030: 4170 6163 6865 204c 6963 656e 7365 2c20  Apache License, 
 00000040: 5665 7273 696f 6e20 322e 3020 2874 6865  Version 2.0 (the
 00000050: 2022 4c69 6365 6e73 6522 293b 0a23 2079   "License");.# y
 00000060: 6f75 206d 6179 206e 6f74 2075 7365 2074  ou may not use t
 00000070: 6869 7320 6669 6c65 2065 7863 6570 7420  his file except 
@@ -31,8148 +31,8340 @@
 000001e0: 6e73 6520 666f 7220 7468 6520 7370 6563  nse for the spec
 000001f0: 6966 6963 206c 616e 6775 6167 6520 676f  ific language go
 00000200: 7665 726e 696e 6720 7065 726d 6973 7369  verning permissi
 00000210: 6f6e 7320 616e 640a 2320 6c69 6d69 7461  ons and.# limita
 00000220: 7469 6f6e 7320 756e 6465 7220 7468 6520  tions under the 
 00000230: 4c69 6365 6e73 652e 0a69 6d70 6f72 7420  License..import 
 00000240: 656e 756d 0a69 6d70 6f72 7420 6874 7470  enum.import http
-00000250: 0a69 6d70 6f72 7420 7465 6d70 6669 6c65  .import tempfile
-00000260: 0a69 6d70 6f72 7420 7469 6d65 0a69 6d70  .import time.imp
-00000270: 6f72 7420 7472 6163 6562 6163 6b0a 696d  ort traceback.im
-00000280: 706f 7274 2074 7970 696e 670a 696d 706f  port typing.impo
-00000290: 7274 2077 6172 6e69 6e67 730a 6672 6f6d  rt warnings.from
-000002a0: 2064 6174 6574 696d 6520 696d 706f 7274   datetime import
-000002b0: 2064 6174 6574 696d 650a 6672 6f6d 206f   datetime.from o
-000002c0: 7320 696d 706f 7274 2070 6174 682c 2072  s import path, r
-000002d0: 656d 6f76 650a 6672 6f6d 2074 7970 696e  emove.from typin
-000002e0: 6720 696d 706f 7274 2044 6963 742c 204c  g import Dict, L
-000002f0: 6973 742c 204f 7074 696f 6e61 6c2c 2055  ist, Optional, U
-00000300: 6e69 6f6e 0a0a 696d 706f 7274 206b 6670  nion..import kfp
-00000310: 0a69 6d70 6f72 7420 7265 7175 6573 7473  .import requests
-00000320: 0a69 6d70 6f72 7420 7365 6d76 6572 0a0a  .import semver..
-00000330: 696d 706f 7274 206d 6c72 756e 0a69 6d70  import mlrun.imp
-00000340: 6f72 7420 6d6c 7275 6e2e 6170 692e 7574  ort mlrun.api.ut
-00000350: 696c 732e 6865 6c70 6572 730a 696d 706f  ils.helpers.impo
-00000360: 7274 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rt mlrun.common.
-00000370: 7363 6865 6d61 730a 696d 706f 7274 206d  schemas.import m
-00000380: 6c72 756e 2e6d 6f64 656c 5f6d 6f6e 6974  lrun.model_monit
-00000390: 6f72 696e 672e 6d6f 6465 6c5f 656e 6470  oring.model_endp
-000003a0: 6f69 6e74 0a69 6d70 6f72 7420 6d6c 7275  oint.import mlru
-000003b0: 6e2e 7072 6f6a 6563 7473 0a66 726f 6d20  n.projects.from 
-000003c0: 6d6c 7275 6e2e 6572 726f 7273 2069 6d70  mlrun.errors imp
-000003d0: 6f72 7420 4d4c 5275 6e49 6e76 616c 6964  ort MLRunInvalid
-000003e0: 4172 6775 6d65 6e74 4572 726f 722c 2065  ArgumentError, e
-000003f0: 7272 5f74 6f5f 7374 720a 0a66 726f 6d20  rr_to_str..from 
-00000400: 2e2e 6172 7469 6661 6374 7320 696d 706f  ..artifacts impo
-00000410: 7274 2041 7274 6966 6163 740a 6672 6f6d  rt Artifact.from
-00000420: 202e 2e63 6f6e 6669 6720 696d 706f 7274   ..config import
-00000430: 2063 6f6e 6669 670a 6672 6f6d 202e 2e66   config.from ..f
-00000440: 6561 7475 7265 5f73 746f 7265 2069 6d70  eature_store imp
-00000450: 6f72 7420 4665 6174 7572 6553 6574 2c20  ort FeatureSet, 
-00000460: 4665 6174 7572 6556 6563 746f 720a 6672  FeatureVector.fr
-00000470: 6f6d 202e 2e6c 6973 7473 2069 6d70 6f72  om ..lists impor
-00000480: 7420 4172 7469 6661 6374 4c69 7374 2c20  t ArtifactList, 
-00000490: 5275 6e4c 6973 740a 6672 6f6d 202e 2e72  RunList.from ..r
-000004a0: 756e 7469 6d65 7320 696d 706f 7274 2042  untimes import B
-000004b0: 6173 6552 756e 7469 6d65 0a66 726f 6d20  aseRuntime.from 
-000004c0: 2e2e 7574 696c 7320 696d 706f 7274 2028  ..utils import (
-000004d0: 0a20 2020 2064 6174 6574 696d 655f 746f  .    datetime_to
-000004e0: 5f69 736f 2c0a 2020 2020 6469 6374 5f74  _iso,.    dict_t
-000004f0: 6f5f 6a73 6f6e 2c0a 2020 2020 6c6f 6767  o_json,.    logg
-00000500: 6572 2c0a 2020 2020 6e65 775f 7069 7065  er,.    new_pipe
-00000510: 5f6d 6574 6164 6174 612c 0a20 2020 206e  _metadata,.    n
-00000520: 6f72 6d61 6c69 7a65 5f6e 616d 652c 0a20  ormalize_name,. 
-00000530: 2020 2076 6572 7369 6f6e 2c0a 290a 6672     version,.).fr
-00000540: 6f6d 202e 6261 7365 2069 6d70 6f72 7420  om .base import 
-00000550: 5275 6e44 4245 7272 6f72 2c20 5275 6e44  RunDBError, RunD
-00000560: 4249 6e74 6572 6661 6365 0a0a 5f61 7274  BInterface.._art
-00000570: 6966 6163 745f 6b65 7973 203d 205b 0a20  ifact_keys = [. 
-00000580: 2020 2022 666f 726d 6174 222c 0a20 2020     "format",.   
-00000590: 2022 696e 6c69 6e65 222c 0a20 2020 2022   "inline",.    "
-000005a0: 6b65 7922 2c0a 2020 2020 2273 7263 5f70  key",.    "src_p
-000005b0: 6174 6822 2c0a 2020 2020 2274 6172 6765  ath",.    "targe
-000005c0: 745f 7061 7468 222c 0a20 2020 2022 7669  t_path",.    "vi
-000005d0: 6577 6572 222c 0a5d 0a0a 0a64 6566 2062  ewer",.]...def b
-000005e0: 6f6f 6c32 7374 7228 7661 6c29 3a0a 2020  ool2str(val):.  
-000005f0: 2020 7265 7475 726e 2022 7965 7322 2069    return "yes" i
-00000600: 6620 7661 6c20 656c 7365 2022 6e6f 220a  f val else "no".
-00000610: 0a0a 636c 6173 7320 4854 5450 5275 6e44  ..class HTTPRunD
-00000620: 4228 5275 6e44 4249 6e74 6572 6661 6365  B(RunDBInterface
-00000630: 293a 0a20 2020 2022 2222 496e 7465 7266  ):.    """Interf
-00000640: 6163 6520 666f 7220 6163 6365 7373 696e  ace for accessin
-00000650: 6720 616e 6420 6d61 6e69 7075 6c61 7469  g and manipulati
-00000660: 6e67 2074 6865 203a 7079 3a6d 6f64 3a60  ng the :py:mod:`
-00000670: 6d6c 7275 6e60 2070 6572 7369 7374 656e  mlrun` persisten
-00000680: 7420 7374 6f72 652c 206d 6169 6e74 6169  t store, maintai
-00000690: 6e69 6e67 2074 6865 2066 756c 6c20 7374  ning the full st
-000006a0: 6174 650a 2020 2020 616e 6420 6361 7461  ate.    and cata
-000006b0: 6c6f 6720 6f66 206f 626a 6563 7473 2074  log of objects t
-000006c0: 6861 7420 4d4c 5275 6e20 7573 6573 2e20  hat MLRun uses. 
-000006d0: 5468 6520 3a70 793a 636c 6173 733a 6048  The :py:class:`H
-000006e0: 5454 5052 756e 4442 6020 636c 6173 7320  TTPRunDB` class 
-000006f0: 7365 7276 6573 2061 7320 6120 636c 6965  serves as a clie
-00000700: 6e74 2d73 6964 6520 7072 6f78 7920 746f  nt-side proxy to
-00000710: 2074 6865 204d 4c52 756e 0a20 2020 2041   the MLRun.    A
-00000720: 5049 2073 6572 7669 6365 2077 6869 6368  PI service which
-00000730: 206d 6169 6e74 6169 6e73 2074 6865 2061   maintains the a
-00000740: 6374 7561 6c20 6461 7461 2d73 746f 7265  ctual data-store
-00000750: 2c20 6163 6365 7373 6573 2074 6865 2073  , accesses the s
-00000760: 6572 7665 7220 7468 726f 7567 6820 5245  erver through RE
-00000770: 5354 2041 5049 732e 0a0a 2020 2020 5468  ST APIs...    Th
-00000780: 6520 636c 6173 7320 7072 6f76 6964 6573  e class provides
-00000790: 2066 756e 6374 696f 6e73 2066 6f72 2061   functions for a
-000007a0: 6363 6573 7369 6e67 2061 6e64 206d 6f64  ccessing and mod
-000007b0: 6966 7969 6e67 2074 6865 2076 6172 696f  ifying the vario
-000007c0: 7573 206f 626a 6563 7473 2074 6861 7420  us objects that 
-000007d0: 6172 6520 7573 6564 2062 7920 4d4c 5275  are used by MLRu
-000007e0: 6e20 696e 2069 7473 0a20 2020 206f 7065  n in its.    ope
-000007f0: 7261 7469 6f6e 2e20 5468 6520 6675 6e63  ration. The func
-00000800: 7469 6f6e 7320 7072 6f76 6964 6564 2066  tions provided f
-00000810: 6f6c 6c6f 7720 736f 6d65 2073 7461 6e64  ollow some stand
-00000820: 6172 6420 6775 6964 656c 696e 6573 2c20  ard guidelines, 
-00000830: 7768 6963 6820 6172 653a 0a0a 2020 2020  which are:..    
-00000840: 2d20 4576 6572 7920 6f62 6a65 6374 2069  - Every object i
-00000850: 6e20 4d4c 5275 6e20 6578 6973 7473 2069  n MLRun exists i
-00000860: 6e20 7468 6520 636f 6e74 6578 7420 6f66  n the context of
-00000870: 2061 2070 726f 6a65 6374 2028 6578 6365   a project (exce
-00000880: 7074 2070 726f 6a65 6374 7320 7468 656d  pt projects them
-00000890: 7365 6c76 6573 292e 2057 6865 6e20 7265  selves). When re
-000008a0: 6665 7265 6e63 696e 6720 616e 206f 626a  ferencing an obj
-000008b0: 6563 740a 2020 2020 2020 7468 726f 7567  ect.      throug
-000008c0: 6820 616e 7920 4150 492c 2061 2070 726f  h any API, a pro
-000008d0: 6a65 6374 206e 616d 6520 6d75 7374 2062  ject name must b
-000008e0: 6520 7072 6f76 6964 6564 2e20 5468 6520  e provided. The 
-000008f0: 6465 6661 756c 7420 666f 7220 6d6f 7374  default for most
-00000900: 2041 5049 7320 6973 2066 6f72 2061 6e20   APIs is for an 
-00000910: 656d 7074 7920 7072 6f6a 6563 7420 6e61  empty project na
-00000920: 6d65 2c20 7768 6963 680a 2020 2020 2020  me, which.      
-00000930: 7769 6c6c 2062 6520 7265 706c 6163 6564  will be replaced
-00000940: 2062 7920 7468 6520 6e61 6d65 206f 6620   by the name of 
-00000950: 7468 6520 6465 6661 756c 7420 7072 6f6a  the default proj
-00000960: 6563 7420 2875 7375 616c 6c79 2060 6064  ect (usually ``d
-00000970: 6566 6175 6c74 6060 292e 2054 6865 7265  efault``). There
-00000980: 666f 7265 2c20 6966 2070 6572 666f 726d  fore, if perform
-00000990: 696e 6720 616e 2041 5049 2074 6f0a 2020  ing an API to.  
-000009a0: 2020 2020 6c69 7374 2066 756e 6374 696f      list functio
-000009b0: 6e73 2c20 666f 7220 6578 616d 706c 652c  ns, for example,
-000009c0: 2061 6e64 206e 6f74 2070 726f 7669 6469   and not providi
-000009d0: 6e67 2061 2070 726f 6a65 6374 206e 616d  ng a project nam
-000009e0: 6520 2d20 7468 6520 7265 7375 6c74 2077  e - the result w
-000009f0: 696c 6c20 6e6f 7420 6265 2066 756e 6374  ill not be funct
-00000a00: 696f 6e73 2066 726f 6d20 616c 6c0a 2020  ions from all.  
-00000a10: 2020 2020 7072 6f6a 6563 7473 2062 7574      projects but
-00000a20: 2072 6174 6865 7220 6672 6f6d 2074 6865   rather from the
-00000a30: 2060 6064 6566 6175 6c74 6060 2070 726f   ``default`` pro
-00000a40: 6a65 6374 2e0a 2020 2020 2d20 4d61 6e79  ject..    - Many
-00000a50: 206f 626a 6563 7473 2063 616e 2062 6520   objects can be 
-00000a60: 6173 7369 676e 6564 206c 6162 656c 732c  assigned labels,
-00000a70: 2061 6e64 206c 6973 7465 642f 7175 6572   and listed/quer
-00000a80: 6965 6420 6279 206c 6162 656c 2e20 5468  ied by label. Th
-00000a90: 6520 6c61 6265 6c20 7061 7261 6d65 7465  e label paramete
-00000aa0: 7220 666f 7220 7175 6572 7920 4150 4973  r for query APIs
-00000ab0: 2061 6c6c 6f77 7320 666f 720a 2020 2020   allows for.    
-00000ac0: 2020 6c69 7374 696e 6720 6f62 6a65 6374    listing object
-00000ad0: 7320 7468 6174 3a0a 0a20 2020 2020 202d  s that:..      -
-00000ae0: 2048 6176 6520 6120 7370 6563 6966 6963   Have a specific
-00000af0: 206c 6162 656c 2c20 6279 2061 736b 696e   label, by askin
-00000b00: 6720 666f 7220 6060 6c61 6265 6c3d 223c  g for ``label="<
-00000b10: 6c61 6265 6c5f 6e61 6d65 3e22 6060 2e20  label_name>"``. 
-00000b20: 496e 2074 6869 7320 6361 7365 2074 6865  In this case the
-00000b30: 2061 6374 7561 6c20 7661 6c75 6520 6f66   actual value of
-00000b40: 2074 6865 206c 6162 656c 0a20 2020 2020   the label.     
-00000b50: 2020 2064 6f65 736e 2774 206d 6174 7465     doesn't matte
-00000b60: 7220 616e 6420 6576 6572 7920 6f62 6a65  r and every obje
-00000b70: 6374 2077 6974 6820 7468 6174 206c 6162  ct with that lab
-00000b80: 656c 2077 696c 6c20 6265 2072 6574 7572  el will be retur
-00000b90: 6e65 640a 2020 2020 2020 2d20 4861 7665  ned.      - Have
-00000ba0: 2061 206c 6162 656c 2077 6974 6820 6120   a label with a 
-00000bb0: 7370 6563 6966 6963 2076 616c 7565 2e20  specific value. 
-00000bc0: 5468 6973 2069 7320 646f 6e65 2062 7920  This is done by 
-00000bd0: 7370 6563 6966 7969 6e67 2060 606c 6162  specifying ``lab
-00000be0: 656c 3d22 3c6c 6162 656c 5f6e 616d 653e  el="<label_name>
-00000bf0: 3d3c 6c61 6265 6c5f 7661 6c75 653e 2260  =<label_value>"`
-00000c00: 602e 2049 6e20 7468 6973 0a20 2020 2020  `. In this.     
-00000c10: 2020 2063 6173 6520 6f6e 6c79 206f 626a     case only obj
-00000c20: 6563 7473 2077 686f 7365 206c 6162 656c  ects whose label
-00000c30: 206d 6174 6368 6573 2074 6865 2076 616c   matches the val
-00000c40: 7565 2077 696c 6c20 6265 2072 6574 7572  ue will be retur
-00000c50: 6e65 640a 0a20 2020 202d 204d 6f73 7420  ned..    - Most 
-00000c60: 6f62 6a65 6374 7320 6861 7665 2061 2060  objects have a `
-00000c70: 6063 7265 6174 6560 6020 6d65 7468 6f64  `create`` method
-00000c80: 2061 7320 7765 6c6c 2061 7320 6120 6060   as well as a ``
-00000c90: 7374 6f72 6560 6020 6d65 7468 6f64 2e20  store`` method. 
-00000ca0: 4372 6561 7465 2063 616e 206f 6e6c 7920  Create can only 
-00000cb0: 6265 2063 616c 6c65 6420 7768 656e 2073  be called when s
-00000cc0: 7563 6820 616e 0a20 2020 2020 2064 6f65  uch an.      doe
-00000cd0: 7320 6e6f 7420 6578 6973 7420 7965 742c  s not exist yet,
-00000ce0: 2077 6869 6c65 2073 746f 7265 2061 6c6c   while store all
-00000cf0: 6f77 7320 666f 7220 6569 7468 6572 2063  ows for either c
-00000d00: 7265 6174 696e 6720 6120 6e65 7720 6f62  reating a new ob
-00000d10: 6a65 6374 206f 7220 6f76 6572 7772 6974  ject or overwrit
-00000d20: 696e 6720 616e 2065 7869 7374 696e 6720  ing an existing 
-00000d30: 6f62 6a65 6374 2e0a 2020 2020 2d20 536f  object..    - So
-00000d40: 6d65 206f 626a 6563 7473 2068 6176 6520  me objects have 
-00000d50: 6120 6060 7665 7273 696f 6e65 6460 6020  a ``versioned`` 
-00000d60: 6f70 7469 6f6e 2c20 696e 2077 6869 6368  option, in which
-00000d70: 2063 6173 6520 6f76 6572 7772 6974 696e   case overwritin
-00000d80: 6720 7468 6520 7361 6d65 206f 626a 6563  g the same objec
-00000d90: 7420 7769 7468 2061 2064 6966 6665 7265  t with a differe
-00000da0: 6e74 2076 6572 7369 6f6e 206f 660a 2020  nt version of.  
-00000db0: 2020 2020 6974 2064 6f65 7320 6e6f 7420      it does not 
-00000dc0: 6465 6c65 7465 2074 6865 2070 7265 7669  delete the previ
-00000dd0: 6f75 7320 7665 7273 696f 6e2c 2062 7574  ous version, but
-00000de0: 2072 6174 6865 7220 6372 6561 7465 7320   rather creates 
-00000df0: 6120 6e65 7720 7665 7273 696f 6e20 6f66  a new version of
-00000e00: 2074 6865 206f 626a 6563 7420 616e 6420   the object and 
-00000e10: 6b65 6570 7320 626f 7468 2076 6572 7369  keeps both versi
-00000e20: 6f6e 732e 0a20 2020 2020 2056 6572 7369  ons..      Versi
-00000e30: 6f6e 6564 206f 626a 6563 7473 2075 7375  oned objects usu
-00000e40: 616c 6c79 2068 6176 6520 6120 6060 7569  ally have a ``ui
-00000e50: 6460 6020 7072 6f70 6572 7479 2077 6869  d`` property whi
-00000e60: 6368 2069 7320 6261 7365 6420 6f6e 2074  ch is based on t
-00000e70: 6865 6972 2063 6f6e 7465 6e74 2061 6e64  heir content and
-00000e80: 2061 6c6c 6f77 7320 746f 2072 6566 6572   allows to refer
-00000e90: 656e 6365 2061 0a20 2020 2020 2073 7065  ence a.      spe
-00000ea0: 6369 6669 6320 7665 7273 696f 6e20 6f66  cific version of
-00000eb0: 2061 6e20 6f62 6a65 6374 2028 6f74 6865   an object (othe
-00000ec0: 7220 7468 616e 2074 6167 6769 6e67 206f  r than tagging o
-00000ed0: 626a 6563 7473 2c20 7768 6963 6820 616c  bjects, which al
-00000ee0: 736f 2061 6c6c 6f77 7320 666f 7220 6561  so allows for ea
-00000ef0: 7379 2072 6566 6572 656e 6369 6e67 292e  sy referencing).
-00000f00: 0a20 2020 202d 204d 616e 7920 6f62 6a65  .    - Many obje
-00000f10: 6374 7320 6861 7665 2062 6f74 6820 6120  cts have both a 
-00000f20: 6060 7374 6f72 6560 6020 6675 6e63 7469  ``store`` functi
-00000f30: 6f6e 2061 6e64 2061 2060 6070 6174 6368  on and a ``patch
-00000f40: 6060 2066 756e 6374 696f 6e2e 2054 6865  `` function. The
-00000f50: 7365 2061 7265 2075 7365 6420 696e 2074  se are used in t
-00000f60: 6865 2073 616d 6520 7761 7920 6173 2074  he same way as t
-00000f70: 6865 0a20 2020 2020 2063 6f72 7265 7370  he.      corresp
-00000f80: 6f6e 6469 6e67 2052 4553 5420 7665 7262  onding REST verb
-00000f90: 7320 2d20 6120 6060 7374 6f72 6560 6020  s - a ``store`` 
-00000fa0: 6973 2070 6173 7365 6420 6120 6675 6c6c  is passed a full
-00000fb0: 206f 626a 6563 7420 616e 6420 7769 6c6c   object and will
-00000fc0: 2062 6173 6963 616c 6c79 2070 6572 666f   basically perfo
-00000fd0: 726d 2061 2050 5554 206f 7065 7261 7469  rm a PUT operati
-00000fe0: 6f6e 2c0a 2020 2020 2020 7265 706c 6163  on,.      replac
-00000ff0: 696e 6720 7468 6520 6675 6c6c 206f 626a  ing the full obj
-00001000: 6563 7420 2869 6620 6974 2065 7869 7374  ect (if it exist
-00001010: 7329 2077 6869 6c65 2060 6070 6174 6368  s) while ``patch
-00001020: 6060 2072 6563 6569 7665 7320 6a75 7374  `` receives just
-00001030: 2061 2064 6963 7469 6f6e 6172 7920 636f   a dictionary co
-00001040: 6e74 6169 6e69 6e67 2074 6865 2064 6966  ntaining the dif
-00001050: 6665 7265 6e63 6573 2074 6f0a 2020 2020  ferences to.    
-00001060: 2020 6265 2061 7070 6c69 6564 2074 6f20    be applied to 
-00001070: 7468 6520 6f62 6a65 6374 2c20 616e 6420  the object, and 
-00001080: 7769 6c6c 206d 6572 6765 2074 686f 7365  will merge those
-00001090: 2063 6861 6e67 6573 2074 6f20 7468 6520   changes to the 
-000010a0: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
-000010b0: 2054 6865 2060 6070 6174 6368 6060 0a20   The ``patch``. 
-000010c0: 2020 2020 206f 7065 7261 7469 6f6e 2061       operation a
-000010d0: 6c73 6f20 6861 7320 6120 7374 7261 7465  lso has a strate
-000010e0: 6779 2061 7373 6967 6e65 6420 746f 2069  gy assigned to i
-000010f0: 7420 7768 6963 6820 6465 7465 726d 696e  t which determin
-00001100: 6573 2068 6f77 2074 6865 206d 6572 6765  es how the merge
-00001110: 206c 6f67 6963 2073 686f 756c 6420 6265   logic should be
-00001120: 6861 7665 2e0a 2020 2020 2020 5468 6520  have..      The 
-00001130: 7374 7261 7465 6779 2063 616e 2062 6520  strategy can be 
-00001140: 6569 7468 6572 2060 6072 6570 6c61 6365  either ``replace
-00001150: 6060 206f 7220 6060 6164 6469 7469 7665  `` or ``additive
-00001160: 6060 2e20 466f 7220 6675 7274 6865 7220  ``. For further 
-00001170: 6465 7461 696c 7320 6f6e 2074 686f 7365  details on those
-00001180: 2073 7472 6174 6567 6965 732c 2072 6566   strategies, ref
-00001190: 6572 0a20 2020 2020 2074 6f20 6874 7470  er.      to http
-000011a0: 733a 2f2f 7079 7069 2e6f 7267 2f70 726f  s://pypi.org/pro
-000011b0: 6a65 6374 2f6d 6572 6765 6465 6570 2f0a  ject/mergedeep/.
-000011c0: 2020 2020 2222 220a 0a20 2020 206b 696e      """..    kin
-000011d0: 6420 3d20 2268 7474 7022 0a0a 2020 2020  d = "http"..    
-000011e0: 6465 6620 5f5f 696e 6974 5f5f 2873 656c  def __init__(sel
-000011f0: 662c 2062 6173 655f 7572 6c2c 2075 7365  f, base_url, use
-00001200: 723d 2222 2c20 7061 7373 776f 7264 3d22  r="", password="
-00001210: 222c 2074 6f6b 656e 3d22 2229 3a0a 2020  ", token=""):.  
-00001220: 2020 2020 2020 7365 6c66 2e62 6173 655f        self.base_
-00001230: 7572 6c20 3d20 6261 7365 5f75 726c 0a20  url = base_url. 
-00001240: 2020 2020 2020 2073 656c 662e 7573 6572         self.user
-00001250: 203d 2075 7365 720a 2020 2020 2020 2020   = user.        
-00001260: 7365 6c66 2e70 6173 7377 6f72 6420 3d20  self.password = 
-00001270: 7061 7373 776f 7264 0a20 2020 2020 2020  password.       
-00001280: 2073 656c 662e 746f 6b65 6e20 3d20 746f   self.token = to
-00001290: 6b65 6e0a 2020 2020 2020 2020 7365 6c66  ken.        self
-000012a0: 2e73 6572 7665 725f 7665 7273 696f 6e20  .server_version 
-000012b0: 3d20 2222 0a20 2020 2020 2020 2073 656c  = "".        sel
-000012c0: 662e 7365 7373 696f 6e20 3d20 4e6f 6e65  f.session = None
-000012d0: 0a20 2020 2020 2020 2073 656c 662e 5f77  .        self._w
-000012e0: 6169 745f 666f 725f 7072 6f6a 6563 745f  ait_for_project_
-000012f0: 7465 726d 696e 616c 5f73 7461 7465 5f72  terminal_state_r
-00001300: 6574 7279 5f69 6e74 6572 7661 6c20 3d20  etry_interval = 
-00001310: 330a 2020 2020 2020 2020 7365 6c66 2e5f  3.        self._
-00001320: 7761 6974 5f66 6f72 5f62 6163 6b67 726f  wait_for_backgro
-00001330: 756e 645f 7461 736b 5f74 6572 6d69 6e61  und_task_termina
-00001340: 6c5f 7374 6174 655f 7265 7472 795f 696e  l_state_retry_in
-00001350: 7465 7276 616c 203d 2033 0a20 2020 2020  terval = 3.     
-00001360: 2020 2073 656c 662e 5f77 6169 745f 666f     self._wait_fo
-00001370: 725f 7072 6f6a 6563 745f 6465 6c65 7469  r_project_deleti
-00001380: 6f6e 5f69 6e74 6572 7661 6c20 3d20 330a  on_interval = 3.
-00001390: 2020 2020 2020 2020 7365 6c66 2e63 6c69          self.cli
-000013a0: 656e 745f 7665 7273 696f 6e20 3d20 7665  ent_version = ve
-000013b0: 7273 696f 6e2e 5665 7273 696f 6e28 292e  rsion.Version().
-000013c0: 6765 7428 295b 2276 6572 7369 6f6e 225d  get()["version"]
-000013d0: 0a20 2020 2020 2020 2073 656c 662e 7079  .        self.py
-000013e0: 7468 6f6e 5f76 6572 7369 6f6e 203d 2073  thon_version = s
-000013f0: 7472 2876 6572 7369 6f6e 2e56 6572 7369  tr(version.Versi
-00001400: 6f6e 2829 2e67 6574 5f70 7974 686f 6e5f  on().get_python_
-00001410: 7665 7273 696f 6e28 2929 0a0a 2020 2020  version())..    
-00001420: 6465 6620 5f5f 7265 7072 5f5f 2873 656c  def __repr__(sel
-00001430: 6629 3a0a 2020 2020 2020 2020 636c 7320  f):.        cls 
-00001440: 3d20 7365 6c66 2e5f 5f63 6c61 7373 5f5f  = self.__class__
-00001450: 2e5f 5f6e 616d 655f 5f0a 2020 2020 2020  .__name__.      
-00001460: 2020 7265 7475 726e 2066 227b 636c 737d    return f"{cls}
-00001470: 287b 7365 6c66 2e62 6173 655f 7572 6c21  ({self.base_url!
-00001480: 727d 2922 0a0a 2020 2020 4073 7461 7469  r})"..    @stati
-00001490: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
-000014a0: 6765 745f 6170 695f 7061 7468 5f70 7265  get_api_path_pre
-000014b0: 6669 7828 7665 7273 696f 6e3a 2073 7472  fix(version: str
-000014c0: 203d 204e 6f6e 6529 202d 3e20 7374 723a   = None) -> str:
-000014d0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-000014e0: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
-000014f0: 696f 6e3a 2041 5049 2076 6572 7369 6f6e  ion: API version
-00001500: 2074 6f20 7573 652c 204e 6f6e 6520 2874   to use, None (t
-00001510: 6865 2064 6566 6175 6c74 2920 7769 6c6c  he default) will
-00001520: 206d 6561 6e20 746f 2075 7365 2074 6865   mean to use the
-00001530: 2064 6566 6175 6c74 2076 616c 7565 2066   default value f
-00001540: 726f 6d20 6d6c 636f 6e66 2c0a 2020 2020  rom mlconf,.    
-00001550: 2020 2020 2066 6f72 2075 6e2d 7665 7273       for un-vers
-00001560: 696f 6e65 6420 6170 6920 7365 7420 616e  ioned api set an
-00001570: 2065 6d70 7479 2073 7472 696e 672e 0a20   empty string.. 
-00001580: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00001590: 2020 2069 6620 7665 7273 696f 6e20 6973     if version is
-000015a0: 206e 6f74 204e 6f6e 653a 0a20 2020 2020   not None:.     
-000015b0: 2020 2020 2020 2072 6574 7572 6e20 6622         return f"
-000015c0: 6170 692f 7b76 6572 7369 6f6e 7d22 2069  api/{version}" i
-000015d0: 6620 7665 7273 696f 6e20 656c 7365 2022  f version else "
-000015e0: 6170 6922 0a0a 2020 2020 2020 2020 6170  api"..        ap
-000015f0: 695f 7665 7273 696f 6e5f 7061 7468 203d  i_version_path =
-00001600: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
-00001610: 2261 7069 2f7b 636f 6e66 6967 2e61 7069  "api/{config.api
-00001620: 5f62 6173 655f 7665 7273 696f 6e7d 2220  _base_version}" 
-00001630: 6966 2063 6f6e 6669 672e 6170 695f 6261  if config.api_ba
-00001640: 7365 5f76 6572 7369 6f6e 2065 6c73 6520  se_version else 
-00001650: 2261 7069 220a 2020 2020 2020 2020 290a  "api".        ).
-00001660: 2020 2020 2020 2020 7265 7475 726e 2061          return a
-00001670: 7069 5f76 6572 7369 6f6e 5f70 6174 680a  pi_version_path.
-00001680: 0a20 2020 2064 6566 2067 6574 5f62 6173  .    def get_bas
-00001690: 655f 6170 695f 7572 6c28 7365 6c66 2c20  e_api_url(self, 
-000016a0: 7061 7468 3a20 7374 722c 2076 6572 7369  path: str, versi
-000016b0: 6f6e 3a20 7374 7220 3d20 4e6f 6e65 2920  on: str = None) 
-000016c0: 2d3e 2073 7472 3a0a 2020 2020 2020 2020  -> str:.        
-000016d0: 7061 7468 5f70 7265 6669 7820 3d20 7365  path_prefix = se
-000016e0: 6c66 2e67 6574 5f61 7069 5f70 6174 685f  lf.get_api_path_
-000016f0: 7072 6566 6978 2876 6572 7369 6f6e 290a  prefix(version).
-00001700: 2020 2020 2020 2020 7572 6c20 3d20 6622          url = f"
-00001710: 7b73 656c 662e 6261 7365 5f75 726c 7d2f  {self.base_url}/
-00001720: 7b70 6174 685f 7072 6566 6978 7d2f 7b70  {path_prefix}/{p
-00001730: 6174 687d 220a 2020 2020 2020 2020 7265  ath}".        re
-00001740: 7475 726e 2075 726c 0a0a 2020 2020 6465  turn url..    de
-00001750: 6620 6170 695f 6361 6c6c 280a 2020 2020  f api_call(.    
-00001760: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-00001770: 2020 6d65 7468 6f64 2c0a 2020 2020 2020    method,.      
-00001780: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
-00001790: 6572 726f 723d 4e6f 6e65 2c0a 2020 2020  error=None,.    
-000017a0: 2020 2020 7061 7261 6d73 3d4e 6f6e 652c      params=None,
-000017b0: 0a20 2020 2020 2020 2062 6f64 793d 4e6f  .        body=No
-000017c0: 6e65 2c0a 2020 2020 2020 2020 6a73 6f6e  ne,.        json
-000017d0: 3d4e 6f6e 652c 0a20 2020 2020 2020 2068  =None,.        h
-000017e0: 6561 6465 7273 3d4e 6f6e 652c 0a20 2020  eaders=None,.   
-000017f0: 2020 2020 2074 696d 656f 7574 3d34 352c       timeout=45,
-00001800: 0a20 2020 2020 2020 2076 6572 7369 6f6e  .        version
-00001810: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
-00001820: 2020 2020 2020 2222 2250 6572 666f 726d        """Perform
-00001830: 2061 2064 6972 6563 7420 5245 5354 2041   a direct REST A
-00001840: 5049 2063 616c 6c20 6f6e 2074 6865 203a  PI call on the :
-00001850: 7079 3a6d 6f64 3a60 6d6c 7275 6e60 2041  py:mod:`mlrun` A
-00001860: 5049 2073 6572 7665 722e 0a0a 2020 2020  PI server...    
-00001870: 2020 2020 4361 7574 696f 6e3a 0a20 2020      Caution:.   
-00001880: 2020 2020 2020 2020 2046 6f72 2061 6476           For adv
-00001890: 616e 6365 6420 7573 6167 6520 2d20 7072  anced usage - pr
-000018a0: 6566 6572 2075 7369 6e67 2074 6865 2076  efer using the v
-000018b0: 6172 696f 7573 2041 5049 7320 6578 706f  arious APIs expo
-000018c0: 7365 6420 7468 726f 7567 6820 7468 6973  sed through this
-000018d0: 2063 6c61 7373 2c20 7261 7468 6572 2074   class, rather t
-000018e0: 6861 6e0a 2020 2020 2020 2020 2020 2020  han.            
-000018f0: 6469 7265 6374 6c79 2069 6e76 6f6b 696e  directly invokin
-00001900: 6720 5245 5354 2063 616c 6c73 2e0a 0a20  g REST calls... 
-00001910: 2020 2020 2020 203a 7061 7261 6d20 6d65         :param me
-00001920: 7468 6f64 3a20 5245 5354 206d 6574 686f  thod: REST metho
-00001930: 6420 2850 4f53 542c 2047 4554 2c20 5055  d (POST, GET, PU
-00001940: 542e 2e2e 290a 2020 2020 2020 2020 3a70  T...).        :p
-00001950: 6172 616d 2070 6174 683a 2050 6174 6820  aram path: Path 
-00001960: 746f 2065 6e64 706f 696e 7420 6578 6563  to endpoint exec
-00001970: 7574 6564 2c20 666f 7220 6578 616d 706c  uted, for exampl
-00001980: 6520 6060 2270 726f 6a65 6374 7322 6060  e ``"projects"``
-00001990: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000019a0: 6572 726f 723a 2045 7272 6f72 2074 6f20  error: Error to 
-000019b0: 7265 7475 726e 2069 6620 4150 4920 696e  return if API in
-000019c0: 766f 6361 7469 6f6e 2066 6169 6c73 0a20  vocation fails. 
-000019d0: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-000019e0: 7261 6d73 3a20 5265 7374 2070 6172 616d  rams: Rest param
-000019f0: 6574 6572 732c 2070 6173 7365 6420 6173  eters, passed as
-00001a00: 2061 2064 6963 7469 6f6e 6172 793a 2060   a dictionary: `
-00001a10: 607b 223c 7061 7261 6d2d 6e61 6d65 3e22  `{"<param-name>"
-00001a20: 3a20 3c22 7061 7261 6d2d 7661 6c75 6522  : <"param-value"
-00001a30: 3e7d 6060 0a20 2020 2020 2020 203a 7061  >}``.        :pa
-00001a40: 7261 6d20 626f 6479 3a20 5061 796c 6f61  ram body: Payloa
-00001a50: 6420 746f 2062 6520 7061 7373 6564 2069  d to be passed i
-00001a60: 6e20 7468 6520 6361 6c6c 2e20 4966 2075  n the call. If u
-00001a70: 7369 6e67 204a 534f 4e20 6f62 6a65 6374  sing JSON object
-00001a80: 732c 2070 7265 6665 7220 7573 696e 6720  s, prefer using 
-00001a90: 7468 6520 6060 6a73 6f6e 6060 2070 6172  the ``json`` par
-00001aa0: 616d 0a20 2020 2020 2020 203a 7061 7261  am.        :para
-00001ab0: 6d20 6a73 6f6e 3a20 4a53 4f4e 2070 6179  m json: JSON pay
-00001ac0: 6c6f 6164 2074 6f20 6265 2070 6173 7365  load to be passe
-00001ad0: 6420 696e 2074 6865 2063 616c 6c0a 2020  d in the call.  
-00001ae0: 2020 2020 2020 3a70 6172 616d 2068 6561        :param hea
-00001af0: 6465 7273 3a20 5245 5354 2068 6561 6465  ders: REST heade
-00001b00: 7273 2c20 7061 7373 6564 2061 7320 6120  rs, passed as a 
-00001b10: 6469 6374 696f 6e61 7279 3a20 6060 7b22  dictionary: ``{"
-00001b20: 3c68 6561 6465 722d 6e61 6d65 3e22 3a20  <header-name>": 
-00001b30: 223c 6865 6164 6572 2d76 616c 7565 3e22  "<header-value>"
-00001b40: 7d60 600a 2020 2020 2020 2020 3a70 6172  }``.        :par
-00001b50: 616d 2074 696d 656f 7574 3a20 4150 4920  am timeout: API 
-00001b60: 6361 6c6c 2074 696d 656f 7574 0a20 2020  call timeout.   
-00001b70: 2020 2020 203a 7061 7261 6d20 7665 7273       :param vers
-00001b80: 696f 6e3a 2041 5049 2076 6572 7369 6f6e  ion: API version
-00001b90: 2074 6f20 7573 652c 204e 6f6e 6520 2874   to use, None (t
-00001ba0: 6865 2064 6566 6175 6c74 2920 7769 6c6c  he default) will
-00001bb0: 206d 6561 6e20 746f 2075 7365 2074 6865   mean to use the
-00001bc0: 2064 6566 6175 6c74 2076 616c 7565 2066   default value f
-00001bd0: 726f 6d20 636f 6e66 6967 2c0a 2020 2020  rom config,.    
-00001be0: 2020 2020 2066 6f72 2075 6e2d 7665 7273       for un-vers
-00001bf0: 696f 6e65 6420 6170 6920 7365 7420 616e  ioned api set an
-00001c00: 2065 6d70 7479 2073 7472 696e 672e 0a0a   empty string...
-00001c10: 2020 2020 2020 2020 3a72 6574 7572 6e3a          :return:
-00001c20: 2050 7974 686f 6e20 4854 5450 2072 6573   Python HTTP res
-00001c30: 706f 6e73 6520 6f62 6a65 6374 0a20 2020  ponse object.   
-00001c40: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00001c50: 2075 726c 203d 2073 656c 662e 6765 745f   url = self.get_
-00001c60: 6261 7365 5f61 7069 5f75 726c 2870 6174  base_api_url(pat
-00001c70: 682c 2076 6572 7369 6f6e 290a 2020 2020  h, version).    
-00001c80: 2020 2020 6b77 203d 207b 0a20 2020 2020      kw = {.     
-00001c90: 2020 2020 2020 206b 6579 3a20 7661 6c75         key: valu
-00001ca0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-00001cb0: 7220 6b65 792c 2076 616c 7565 2069 6e20  r key, value in 
-00001cc0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00001cd0: 2020 2822 7061 7261 6d73 222c 2070 6172    ("params", par
-00001ce0: 616d 7329 2c0a 2020 2020 2020 2020 2020  ams),.          
-00001cf0: 2020 2020 2020 2822 6461 7461 222c 2062        ("data", b
-00001d00: 6f64 7929 2c0a 2020 2020 2020 2020 2020  ody),.          
-00001d10: 2020 2020 2020 2822 6a73 6f6e 222c 206a        ("json", j
-00001d20: 736f 6e29 2c0a 2020 2020 2020 2020 2020  son),.          
-00001d30: 2020 2020 2020 2822 6865 6164 6572 7322        ("headers"
-00001d40: 2c20 6865 6164 6572 7329 2c0a 2020 2020  , headers),.    
-00001d50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00001d60: 2020 2020 2020 6966 2076 616c 7565 2069        if value i
-00001d70: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
-00001d80: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
-00001d90: 2073 656c 662e 7573 6572 3a0a 2020 2020   self.user:.    
-00001da0: 2020 2020 2020 2020 6b77 5b22 6175 7468          kw["auth
-00001db0: 225d 203d 2028 7365 6c66 2e75 7365 722c  "] = (self.user,
-00001dc0: 2073 656c 662e 7061 7373 776f 7264 290a   self.password).
-00001dd0: 2020 2020 2020 2020 656c 6966 2073 656c          elif sel
-00001de0: 662e 746f 6b65 6e3a 0a20 2020 2020 2020  f.token:.       
-00001df0: 2020 2020 2023 2049 6775 617a 696f 2061       # Iguazio a
-00001e00: 7574 6820 646f 6573 6e27 7420 7375 7070  uth doesn't supp
-00001e10: 6f72 7420 7061 7373 696e 6720 746f 6b65  ort passing toke
-00001e20: 6e20 7468 726f 7567 6820 6265 6172 6572  n through bearer
-00001e30: 2c20 736f 2075 7365 2063 6f6f 6b69 6520  , so use cookie 
-00001e40: 696e 7374 6561 640a 2020 2020 2020 2020  instead.        
-00001e50: 2020 2020 6966 206d 6c72 756e 2e70 6c61      if mlrun.pla
-00001e60: 7466 6f72 6d73 2e69 6775 617a 696f 2e69  tforms.iguazio.i
-00001e70: 735f 6967 7561 7a69 6f5f 7365 7373 696f  s_iguazio_sessio
-00001e80: 6e28 7365 6c66 2e74 6f6b 656e 293a 0a20  n(self.token):. 
-00001e90: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-00001ea0: 6573 7369 6f6e 5f63 6f6f 6b69 6520 3d20  ession_cookie = 
-00001eb0: 6627 6a3a 7b7b 2273 6964 223a 2022 7b73  f'j:{{"sid": "{s
-00001ec0: 656c 662e 746f 6b65 6e7d 227d 7d27 0a20  elf.token}"}}'. 
-00001ed0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00001ee0: 6f6f 6b69 6573 203d 207b 0a20 2020 2020  ookies = {.     
-00001ef0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-00001f00: 7365 7373 696f 6e22 3a20 7365 7373 696f  session": sessio
-00001f10: 6e5f 636f 6f6b 6965 2c0a 2020 2020 2020  n_cookie,.      
-00001f20: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
-00001f30: 2020 2020 2020 2020 2020 2020 6b77 5b22              kw["
-00001f40: 636f 6f6b 6965 7322 5d20 3d20 636f 6f6b  cookies"] = cook
-00001f50: 6965 730a 2020 2020 2020 2020 2020 2020  ies.            
-00001f60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00001f70: 2020 2020 2020 6966 2022 4175 7468 6f72        if "Author
-00001f80: 697a 6174 696f 6e22 206e 6f74 2069 6e20  ization" not in 
-00001f90: 6b77 2e73 6574 6465 6661 756c 7428 2268  kw.setdefault("h
-00001fa0: 6561 6465 7273 222c 207b 7d29 3a0a 2020  eaders", {}):.  
-00001fb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00001fc0: 2020 6b77 5b22 6865 6164 6572 7322 5d2e    kw["headers"].
-00001fd0: 7570 6461 7465 287b 2241 7574 686f 7269  update({"Authori
-00001fe0: 7a61 7469 6f6e 223a 2022 4265 6172 6572  zation": "Bearer
-00001ff0: 2022 202b 2073 656c 662e 746f 6b65 6e7d   " + self.token}
-00002000: 290a 0a20 2020 2020 2020 2069 6620 6d6c  )..        if ml
-00002010: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00002020: 6173 2e48 6561 6465 724e 616d 6573 2e63  as.HeaderNames.c
-00002030: 6c69 656e 745f 7665 7273 696f 6e20 6e6f  lient_version no
-00002040: 7420 696e 206b 772e 7365 7464 6566 6175  t in kw.setdefau
-00002050: 6c74 280a 2020 2020 2020 2020 2020 2020  lt(.            
-00002060: 2268 6561 6465 7273 222c 207b 7d0a 2020  "headers", {}.  
-00002070: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00002080: 2020 2020 206b 775b 2268 6561 6465 7273       kw["headers
-00002090: 225d 2e75 7064 6174 6528 0a20 2020 2020  "].update(.     
-000020a0: 2020 2020 2020 2020 2020 207b 0a20 2020             {.   
-000020b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000020c0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-000020d0: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
-000020e0: 732e 636c 6965 6e74 5f76 6572 7369 6f6e  s.client_version
-000020f0: 3a20 7365 6c66 2e63 6c69 656e 745f 7665  : self.client_ve
-00002100: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
-00002110: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
-00002120: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00002130: 4865 6164 6572 4e61 6d65 732e 7079 7468  HeaderNames.pyth
-00002140: 6f6e 5f76 6572 7369 6f6e 3a20 7365 6c66  on_version: self
-00002150: 2e70 7974 686f 6e5f 7665 7273 696f 6e2c  .python_version,
-00002160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002170: 207d 0a20 2020 2020 2020 2020 2020 2029   }.            )
-00002180: 0a0a 2020 2020 2020 2020 2320 7265 7175  ..        # requ
-00002190: 6573 7473 206e 6f20 6c6f 6e67 6572 2073  ests no longer s
-000021a0: 7570 706f 7274 7320 6865 6164 6572 2076  upports header v
-000021b0: 616c 7565 7320 746f 2062 6520 656e 756d  alues to be enum
-000021c0: 2028 6874 7470 733a 2f2f 6769 7468 7562   (https://github
-000021d0: 2e63 6f6d 2f70 7366 2f72 6571 7565 7374  .com/psf/request
-000021e0: 732f 7075 6c6c 2f36 3135 3429 0a20 2020  s/pull/6154).   
-000021f0: 2020 2020 2023 2063 6f6e 7665 7274 2074       # convert t
-00002200: 6f20 7374 7269 6e67 732e 2044 6f20 7468  o strings. Do th
-00002210: 6520 7361 6d65 2066 6f72 2070 6172 616d  e same for param
-00002220: 7320 666f 7220 6e69 6365 6e65 7373 0a20  s for niceness. 
-00002230: 2020 2020 2020 2066 6f72 2064 6963 745f         for dict_
-00002240: 2069 6e20 5b68 6561 6465 7273 2c20 7061   in [headers, pa
-00002250: 7261 6d73 5d3a 0a20 2020 2020 2020 2020  rams]:.         
-00002260: 2020 2069 6620 6469 6374 5f20 6973 206e     if dict_ is n
-00002270: 6f74 204e 6f6e 653a 0a20 2020 2020 2020  ot None:.       
-00002280: 2020 2020 2020 2020 2066 6f72 206b 6579           for key
-00002290: 2069 6e20 6469 6374 5f2e 6b65 7973 2829   in dict_.keys()
-000022a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000022b0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
-000022c0: 6e63 6528 6469 6374 5f5b 6b65 795d 2c20  nce(dict_[key], 
-000022d0: 656e 756d 2e45 6e75 6d29 3a0a 2020 2020  enum.Enum):.    
-000022e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000022f0: 2020 2020 6469 6374 5f5b 6b65 795d 203d      dict_[key] =
-00002300: 2064 6963 745f 5b6b 6579 5d2e 7661 6c75   dict_[key].valu
-00002310: 650a 0a20 2020 2020 2020 2069 6620 6e6f  e..        if no
-00002320: 7420 7365 6c66 2e73 6573 7369 6f6e 3a0a  t self.session:.
-00002330: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00002340: 2e73 6573 7369 6f6e 203d 2073 656c 662e  .session = self.
-00002350: 5f69 6e69 745f 7365 7373 696f 6e28 290a  _init_session().
-00002360: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00002370: 2020 2020 2020 2020 2020 7265 7370 6f6e            respon
-00002380: 7365 203d 2073 656c 662e 7365 7373 696f  se = self.sessio
-00002390: 6e2e 7265 7175 6573 7428 0a20 2020 2020  n.request(.     
-000023a0: 2020 2020 2020 2020 2020 206d 6574 686f             metho
-000023b0: 642c 2075 726c 2c20 7469 6d65 6f75 743d  d, url, timeout=
-000023c0: 7469 6d65 6f75 742c 2076 6572 6966 793d  timeout, verify=
-000023d0: 4661 6c73 652c 202a 2a6b 770a 2020 2020  False, **kw.    
-000023e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-000023f0: 2020 6578 6365 7074 2072 6571 7565 7374    except request
-00002400: 732e 5265 7175 6573 7445 7863 6570 7469  s.RequestExcepti
-00002410: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
-00002420: 2020 2020 2020 2065 7272 6f72 203d 2066         error = f
-00002430: 227b 6572 725f 746f 5f73 7472 2865 7863  "{err_to_str(exc
-00002440: 297d 3a20 7b65 7272 6f72 7d22 2069 6620  )}: {error}" if 
-00002450: 6572 726f 7220 656c 7365 2065 7272 5f74  error else err_t
-00002460: 6f5f 7374 7228 6578 6329 0a20 2020 2020  o_str(exc).     
-00002470: 2020 2020 2020 2072 6169 7365 206d 6c72         raise mlr
-00002480: 756e 2e65 7272 6f72 732e 4d4c 5275 6e52  un.errors.MLRunR
-00002490: 756e 7469 6d65 4572 726f 7228 6572 726f  untimeError(erro
-000024a0: 7229 2066 726f 6d20 6578 630a 0a20 2020  r) from exc..   
-000024b0: 2020 2020 2069 6620 6e6f 7420 7265 7370       if not resp
-000024c0: 6f6e 7365 2e6f 6b3a 0a20 2020 2020 2020  onse.ok:.       
-000024d0: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
-000024e0: 2e63 6f6e 7465 6e74 3a0a 2020 2020 2020  .content:.      
-000024f0: 2020 2020 2020 2020 2020 7472 793a 0a20            try:. 
-00002500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002510: 2020 2064 6174 6120 3d20 7265 7370 6f6e     data = respon
-00002520: 7365 2e6a 736f 6e28 290a 2020 2020 2020  se.json().      
-00002530: 2020 2020 2020 2020 2020 2020 2020 6572                er
-00002540: 726f 725f 6465 7461 696c 7320 3d20 6461  ror_details = da
-00002550: 7461 2e67 6574 2822 6465 7461 696c 222c  ta.get("detail",
-00002560: 207b 7d29 0a20 2020 2020 2020 2020 2020   {}).           
-00002570: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
-00002580: 6572 726f 725f 6465 7461 696c 733a 0a20  error_details:. 
-00002590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000025a0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-000025b0: 726e 696e 6728 2246 6169 6c65 6420 7061  rning("Failed pa
-000025c0: 7273 696e 6720 6572 726f 7220 7265 7370  rsing error resp
-000025d0: 6f6e 7365 2062 6f64 7922 2c20 6461 7461  onse body", data
-000025e0: 3d64 6174 6129 0a20 2020 2020 2020 2020  =data).         
-000025f0: 2020 2020 2020 2065 7863 6570 7420 4578         except Ex
-00002600: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00002610: 2020 2020 2020 2020 2020 2020 2065 7272               err
-00002620: 6f72 5f64 6574 6169 6c73 203d 2022 220a  or_details = "".
-00002630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002640: 6966 2065 7272 6f72 5f64 6574 6169 6c73  if error_details
-00002650: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00002660: 2020 2020 2020 6572 726f 725f 6465 7461        error_deta
-00002670: 696c 7320 3d20 6622 6465 7461 696c 733a  ils = f"details:
-00002680: 207b 6572 726f 725f 6465 7461 696c 737d   {error_details}
-00002690: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-000026a0: 2020 2020 2020 6572 726f 7220 3d20 6622        error = f"
-000026b0: 7b65 7272 6f72 7d20 7b65 7272 6f72 5f64  {error} {error_d
-000026c0: 6574 6169 6c73 7d22 2069 6620 6572 726f  etails}" if erro
-000026d0: 7220 656c 7365 2065 7272 6f72 5f64 6574  r else error_det
-000026e0: 6169 6c73 0a20 2020 2020 2020 2020 2020  ails.           
-000026f0: 2020 2020 2020 2020 206d 6c72 756e 2e65           mlrun.e
-00002700: 7272 6f72 732e 7261 6973 655f 666f 725f  rrors.raise_for_
-00002710: 7374 6174 7573 2872 6573 706f 6e73 652c  status(response,
-00002720: 2065 7272 6f72 290a 0a20 2020 2020 2020   error)..       
-00002730: 2020 2020 206d 6c72 756e 2e65 7272 6f72       mlrun.error
-00002740: 732e 7261 6973 655f 666f 725f 7374 6174  s.raise_for_stat
-00002750: 7573 2872 6573 706f 6e73 652c 2065 7272  us(response, err
-00002760: 6f72 290a 0a20 2020 2020 2020 2072 6574  or)..        ret
-00002770: 7572 6e20 7265 7370 6f6e 7365 0a0a 2020  urn response..  
-00002780: 2020 6465 6620 5f69 6e69 745f 7365 7373    def _init_sess
-00002790: 696f 6e28 7365 6c66 293a 0a20 2020 2020  ion(self):.     
-000027a0: 2020 2072 6574 7572 6e20 6d6c 7275 6e2e     return mlrun.
-000027b0: 7574 696c 732e 4854 5450 5365 7373 696f  utils.HTTPSessio
-000027c0: 6e57 6974 6852 6574 7279 280a 2020 2020  nWithRetry(.    
-000027d0: 2020 2020 2020 2020 7265 7472 795f 6f6e          retry_on
-000027e0: 5f65 7863 6570 7469 6f6e 3d63 6f6e 6669  _exception=confi
-000027f0: 672e 6874 7470 6462 2e72 6574 7279 5f61  g.httpdb.retry_a
-00002800: 7069 5f63 616c 6c5f 6f6e 5f65 7863 6570  pi_call_on_excep
-00002810: 7469 6f6e 0a20 2020 2020 2020 2020 2020  tion.           
-00002820: 203d 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e   == mlrun.common
-00002830: 2e73 6368 656d 6173 2e48 5454 5053 6573  .schemas.HTTPSes
-00002840: 7369 6f6e 5265 7472 794d 6f64 652e 656e  sionRetryMode.en
-00002850: 6162 6c65 642e 7661 6c75 650a 2020 2020  abled.value.    
-00002860: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
-00002870: 7061 7468 5f6f 6628 7365 6c66 2c20 7072  path_of(self, pr
-00002880: 6566 6978 2c20 7072 6f6a 6563 742c 2075  efix, project, u
-00002890: 6964 293a 0a20 2020 2020 2020 2070 726f  id):.        pro
-000028a0: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
-000028b0: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
-000028c0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
-000028d0: 2072 6574 7572 6e20 6622 7b70 7265 6669   return f"{prefi
-000028e0: 787d 2f7b 7072 6f6a 6563 747d 2f7b 7569  x}/{project}/{ui
-000028f0: 647d 220a 0a20 2020 2064 6566 2063 6f6e  d}"..    def con
-00002900: 6e65 6374 2873 656c 662c 2073 6563 7265  nect(self, secre
-00002910: 7473 3d4e 6f6e 6529 3a0a 2020 2020 2020  ts=None):.      
-00002920: 2020 2222 2243 6f6e 6e65 6374 2074 6f20    """Connect to 
-00002930: 7468 6520 4d4c 5275 6e20 4150 4920 7365  the MLRun API se
-00002940: 7276 6572 2e20 4d75 7374 2062 6520 6361  rver. Must be ca
-00002950: 6c6c 6564 2070 7269 6f72 2074 6f20 6578  lled prior to ex
-00002960: 6563 7574 696e 6720 616e 7920 6f74 6865  ecuting any othe
-00002970: 7220 6d65 7468 6f64 2e0a 2020 2020 2020  r method..      
-00002980: 2020 5468 6520 636f 6465 2075 7469 6c69    The code utili
-00002990: 7a65 7320 7468 6520 5552 4c20 666f 7220  zes the URL for 
-000029a0: 7468 6520 4150 4920 7365 7276 6572 2066  the API server f
-000029b0: 726f 6d20 7468 6520 636f 6e66 6967 7572  rom the configur
-000029c0: 6174 696f 6e20 2d20 6060 6d6c 636f 6e66  ation - ``mlconf
-000029d0: 2e64 6270 6174 6860 602e 0a0a 2020 2020  .dbpath``...    
-000029e0: 2020 2020 466f 7220 6578 616d 706c 653a      For example:
-000029f0: 3a0a 0a20 2020 2020 2020 2020 2020 206d  :..            m
-00002a00: 6c63 6f6e 662e 6462 7061 7468 203d 206d  lconf.dbpath = m
-00002a10: 6c63 6f6e 662e 6462 7061 7468 206f 7220  lconf.dbpath or 
-00002a20: 2768 7474 703a 2f2f 6d6c 7275 6e2d 6170  'http://mlrun-ap
-00002a30: 693a 3830 3830 270a 2020 2020 2020 2020  i:8080'.        
-00002a40: 2020 2020 6462 203d 2067 6574 5f72 756e      db = get_run
-00002a50: 5f64 6228 292e 636f 6e6e 6563 7428 290a  _db().connect().
-00002a60: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-00002a70: 2020 2020 2320 6861 636b 2074 6f20 616c      # hack to al
-00002a80: 6c6f 7720 756e 6974 2074 6573 7473 2074  low unit tests t
-00002a90: 6f20 696e 7374 616e 7469 6174 6520 4854  o instantiate HT
-00002aa0: 5450 5275 6e44 4220 7769 7468 6f75 7420  TPRunDB without 
-00002ab0: 6120 7265 616c 2073 6572 7665 7220 6265  a real server be
-00002ac0: 6869 6e64 0a20 2020 2020 2020 2069 6620  hind.        if 
-00002ad0: 226d 6f63 6b2d 7365 7276 6572 2220 696e  "mock-server" in
-00002ae0: 2073 656c 662e 6261 7365 5f75 726c 3a0a   self.base_url:.
-00002af0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00002b00: 726e 0a20 2020 2020 2020 2072 6573 7020  rn.        resp 
-00002b10: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-00002b20: 2247 4554 222c 2022 636c 6965 6e74 2d73  "GET", "client-s
-00002b30: 7065 6322 2c20 7469 6d65 6f75 743d 3529  pec", timeout=5)
-00002b40: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-00002b50: 2020 2020 2020 2020 2020 7365 7276 6572            server
-00002b60: 5f63 6667 203d 2072 6573 702e 6a73 6f6e  _cfg = resp.json
-00002b70: 2829 0a20 2020 2020 2020 2020 2020 2073  ().            s
-00002b80: 656c 662e 7365 7276 6572 5f76 6572 7369  elf.server_versi
-00002b90: 6f6e 203d 2073 6572 7665 725f 6366 675b  on = server_cfg[
-00002ba0: 2276 6572 7369 6f6e 225d 0a20 2020 2020  "version"].     
-00002bb0: 2020 2020 2020 2073 656c 662e 5f76 616c         self._val
-00002bc0: 6964 6174 655f 7665 7273 696f 6e5f 636f  idate_version_co
-00002bd0: 6d70 6174 6962 696c 6974 7928 7365 6c66  mpatibility(self
-00002be0: 2e73 6572 7665 725f 7665 7273 696f 6e2c  .server_version,
-00002bf0: 2063 6f6e 6669 672e 7665 7273 696f 6e29   config.version)
-00002c00: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00002c10: 6669 672e 6e61 6d65 7370 6163 6520 3d20  fig.namespace = 
-00002c20: 636f 6e66 6967 2e6e 616d 6573 7061 6365  config.namespace
-00002c30: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
-00002c40: 6574 2822 6e61 6d65 7370 6163 6522 290a  et("namespace").
-00002c50: 2020 2020 2020 2020 2020 2020 6966 2028              if (
-00002c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00002c70: 2022 6e61 6d65 7370 6163 6522 2069 6e20   "namespace" in 
-00002c80: 7365 7276 6572 5f63 6667 0a20 2020 2020  server_cfg.     
-00002c90: 2020 2020 2020 2020 2020 2061 6e64 2073             and s
-00002ca0: 6572 7665 725f 6366 675b 226e 616d 6573  erver_cfg["names
-00002cb0: 7061 6365 225d 2021 3d20 636f 6e66 6967  pace"] != config
-00002cc0: 2e6e 616d 6573 7061 6365 0a20 2020 2020  .namespace.     
-00002cd0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
-00002ce0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
-00002cf0: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
-00002d00: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-00002d10: 7761 726e 696e 6721 2c20 7365 7276 6572  warning!, server
-00002d20: 2028 7b73 6572 7665 725f 6366 675b 276e   ({server_cfg['n
-00002d30: 616d 6573 7061 6365 275d 7d29 2061 6e64  amespace']}) and
-00002d40: 2063 6c69 656e 7420 287b 636f 6e66 6967   client ({config
-00002d50: 2e6e 616d 6573 7061 6365 7d29 220a 2020  .namespace})".  
-00002d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002d70: 2020 2220 6e61 6d65 7370 6163 6520 646f    " namespace do
-00002d80: 6e27 7420 6d61 7463 6822 0a20 2020 2020  n't match".     
-00002d90: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00002da0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-00002db0: 6967 2e63 652e 6d6f 6465 2061 6e64 2063  ig.ce.mode and c
-00002dc0: 6f6e 6669 672e 6365 2e6d 6f64 6520 213d  onfig.ce.mode !=
-00002dd0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00002de0: 2263 655f 6d6f 6465 222c 2022 2229 3a0a  "ce_mode", ""):.
-00002df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e00: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
-00002e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e20: 2020 2020 6622 7761 726e 696e 6721 2c20      f"warning!, 
-00002e30: 7365 7276 6572 2028 7b73 6572 7665 725f  server ({server_
-00002e40: 6366 675b 2763 655f 6d6f 6465 275d 7d29  cfg['ce_mode']})
-00002e50: 2061 6e64 2063 6c69 656e 7420 287b 636f   and client ({co
-00002e60: 6e66 6967 2e63 652e 6d6f 6465 7d29 220a  nfig.ce.mode})".
-00002e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002e80: 2020 2020 2220 4345 206d 6f64 6520 646f      " CE mode do
-00002e90: 6e27 7420 6d61 7463 6822 0a20 2020 2020  n't match".     
-00002ea0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00002eb0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00002ec0: 6365 203d 2073 6572 7665 725f 6366 672e  ce = server_cfg.
-00002ed0: 6765 7428 2263 6522 2920 6f72 2063 6f6e  get("ce") or con
-00002ee0: 6669 672e 6365 0a0a 2020 2020 2020 2020  fig.ce..        
-00002ef0: 2020 2020 2320 6765 7420 6465 6661 756c      # get defaul
-00002f00: 7473 2066 726f 6d20 7265 6d6f 7465 2073  ts from remote s
-00002f10: 6572 7665 720a 2020 2020 2020 2020 2020  erver.          
-00002f20: 2020 636f 6e66 6967 2e72 656d 6f74 655f    config.remote_
-00002f30: 686f 7374 203d 2063 6f6e 6669 672e 7265  host = config.re
-00002f40: 6d6f 7465 5f68 6f73 7420 6f72 2073 6572  mote_host or ser
-00002f50: 7665 725f 6366 672e 6765 7428 2272 656d  ver_cfg.get("rem
-00002f60: 6f74 655f 686f 7374 2229 0a20 2020 2020  ote_host").     
-00002f70: 2020 2020 2020 2063 6f6e 6669 672e 6d70         config.mp
-00002f80: 696a 6f62 5f63 7264 5f76 6572 7369 6f6e  ijob_crd_version
-00002f90: 203d 2063 6f6e 6669 672e 6d70 696a 6f62   = config.mpijob
-00002fa0: 5f63 7264 5f76 6572 7369 6f6e 206f 7220  _crd_version or 
-00002fb0: 7365 7276 6572 5f63 6667 2e67 6574 280a  server_cfg.get(.
-00002fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00002fd0: 226d 7069 6a6f 625f 6372 645f 7665 7273  "mpijob_crd_vers
-00002fe0: 696f 6e22 0a20 2020 2020 2020 2020 2020  ion".           
-00002ff0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-00003000: 6f6e 6669 672e 7569 2e75 726c 203d 2063  onfig.ui.url = c
-00003010: 6f6e 6669 672e 7265 736f 6c76 655f 7569  onfig.resolve_ui
-00003020: 5f75 726c 2829 206f 7220 7365 7276 6572  _url() or server
-00003030: 5f63 6667 2e67 6574 2822 7569 5f75 726c  _cfg.get("ui_url
-00003040: 2229 0a20 2020 2020 2020 2020 2020 2063  ").            c
-00003050: 6f6e 6669 672e 6172 7469 6661 6374 5f70  onfig.artifact_p
-00003060: 6174 6820 3d20 636f 6e66 6967 2e61 7274  ath = config.art
-00003070: 6966 6163 745f 7061 7468 206f 7220 7365  ifact_path or se
-00003080: 7276 6572 5f63 6667 2e67 6574 280a 2020  rver_cfg.get(.  
-00003090: 2020 2020 2020 2020 2020 2020 2020 2261                "a
-000030a0: 7274 6966 6163 745f 7061 7468 220a 2020  rtifact_path".  
-000030b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000030c0: 2020 2020 2020 2020 636f 6e66 6967 2e66          config.f
-000030d0: 6561 7475 7265 5f73 746f 7265 2e64 6174  eature_store.dat
-000030e0: 615f 7072 6566 6978 6573 203d 2028 0a20  a_prefixes = (. 
-000030f0: 2020 2020 2020 2020 2020 2020 2020 2063                 c
-00003100: 6f6e 6669 672e 6665 6174 7572 655f 7374  onfig.feature_st
-00003110: 6f72 652e 6461 7461 5f70 7265 6669 7865  ore.data_prefixe
-00003120: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00003130: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
-00003140: 6765 7428 2266 6561 7475 7265 5f73 746f  get("feature_sto
-00003150: 7265 5f64 6174 615f 7072 6566 6978 6573  re_data_prefixes
-00003160: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
-00003170: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
-00003180: 6669 672e 7370 6172 6b5f 6170 705f 696d  fig.spark_app_im
-00003190: 6167 6520 3d20 636f 6e66 6967 2e73 7061  age = config.spa
-000031a0: 726b 5f61 7070 5f69 6d61 6765 206f 7220  rk_app_image or 
-000031b0: 7365 7276 6572 5f63 6667 2e67 6574 280a  server_cfg.get(.
-000031c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000031d0: 2273 7061 726b 5f61 7070 5f69 6d61 6765  "spark_app_image
-000031e0: 220a 2020 2020 2020 2020 2020 2020 290a  ".            ).
-000031f0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003200: 6967 2e73 7061 726b 5f61 7070 5f69 6d61  ig.spark_app_ima
-00003210: 6765 5f74 6167 203d 2063 6f6e 6669 672e  ge_tag = config.
-00003220: 7370 6172 6b5f 6170 705f 696d 6167 655f  spark_app_image_
-00003230: 7461 6720 6f72 2073 6572 7665 725f 6366  tag or server_cf
-00003240: 672e 6765 7428 0a20 2020 2020 2020 2020  g.get(.         
-00003250: 2020 2020 2020 2022 7370 6172 6b5f 6170         "spark_ap
-00003260: 705f 696d 6167 655f 7461 6722 0a20 2020  p_image_tag".   
-00003270: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-00003280: 2020 2020 2020 2063 6f6e 6669 672e 7370         config.sp
-00003290: 6172 6b5f 6869 7374 6f72 795f 7365 7276  ark_history_serv
-000032a0: 6572 5f70 6174 6820 3d20 280a 2020 2020  er_path = (.    
-000032b0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-000032c0: 6967 2e73 7061 726b 5f68 6973 746f 7279  ig.spark_history
-000032d0: 5f73 6572 7665 725f 7061 7468 0a20 2020  _server_path.   
-000032e0: 2020 2020 2020 2020 2020 2020 206f 7220               or 
-000032f0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003300: 7370 6172 6b5f 6869 7374 6f72 795f 7365  spark_history_se
-00003310: 7276 6572 5f70 6174 6822 290a 2020 2020  rver_path").    
-00003320: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003330: 2020 2020 2020 636f 6e66 6967 2e68 7474        config.htt
-00003340: 7064 622e 6275 696c 6465 722e 646f 636b  pdb.builder.dock
-00003350: 6572 5f72 6567 6973 7472 7920 3d20 280a  er_registry = (.
-00003360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003370: 636f 6e66 6967 2e68 7474 7064 622e 6275  config.httpdb.bu
-00003380: 696c 6465 722e 646f 636b 6572 5f72 6567  ilder.docker_reg
-00003390: 6973 7472 790a 2020 2020 2020 2020 2020  istry.          
-000033a0: 2020 2020 2020 6f72 2073 6572 7665 725f        or server_
-000033b0: 6366 672e 6765 7428 2264 6f63 6b65 725f  cfg.get("docker_
-000033c0: 7265 6769 7374 7279 2229 0a20 2020 2020  registry").     
-000033d0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-000033e0: 2020 2020 2063 6f6e 6669 672e 6874 7470       config.http
-000033f0: 6462 2e61 7069 5f75 726c 203d 2063 6f6e  db.api_url = con
-00003400: 6669 672e 6874 7470 6462 2e61 7069 5f75  fig.httpdb.api_u
-00003410: 726c 206f 7220 7365 7276 6572 5f63 6667  rl or server_cfg
-00003420: 2e67 6574 2822 6170 695f 7572 6c22 290a  .get("api_url").
-00003430: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003440: 6967 2e6e 7563 6c69 6f5f 7665 7273 696f  ig.nuclio_versio
-00003450: 6e20 3d20 636f 6e66 6967 2e6e 7563 6c69  n = config.nucli
-00003460: 6f5f 7665 7273 696f 6e20 6f72 2073 6572  o_version or ser
-00003470: 7665 725f 6366 672e 6765 7428 0a20 2020  ver_cfg.get(.   
-00003480: 2020 2020 2020 2020 2020 2020 2022 6e75               "nu
-00003490: 636c 696f 5f76 6572 7369 6f6e 220a 2020  clio_version".  
-000034a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-000034b0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
-000034c0: 6566 6175 6c74 5f66 756e 6374 696f 6e5f  efault_function_
-000034d0: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
-000034e0: 616d 6520 3d20 280a 2020 2020 2020 2020  ame = (.        
-000034f0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
-00003500: 6566 6175 6c74 5f66 756e 6374 696f 6e5f  efault_function_
-00003510: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
-00003520: 616d 650a 2020 2020 2020 2020 2020 2020  ame.            
-00003530: 2020 2020 6f72 2073 6572 7665 725f 6366      or server_cf
-00003540: 672e 6765 7428 2264 6566 6175 6c74 5f66  g.get("default_f
-00003550: 756e 6374 696f 6e5f 7072 696f 7269 7479  unction_priority
-00003560: 5f63 6c61 7373 5f6e 616d 6522 290a 2020  _class_name").  
-00003570: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-00003580: 2020 2020 2020 2020 636f 6e66 6967 2e76          config.v
-00003590: 616c 6964 5f66 756e 6374 696f 6e5f 7072  alid_function_pr
-000035a0: 696f 7269 7479 5f63 6c61 7373 5f6e 616d  iority_class_nam
-000035b0: 6573 203d 2028 0a20 2020 2020 2020 2020  es = (.         
-000035c0: 2020 2020 2020 2063 6f6e 6669 672e 7661         config.va
-000035d0: 6c69 645f 6675 6e63 7469 6f6e 5f70 7269  lid_function_pri
-000035e0: 6f72 6974 795f 636c 6173 735f 6e61 6d65  ority_class_name
-000035f0: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
-00003600: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
-00003610: 6765 7428 2276 616c 6964 5f66 756e 6374  get("valid_funct
-00003620: 696f 6e5f 7072 696f 7269 7479 5f63 6c61  ion_priority_cla
-00003630: 7373 5f6e 616d 6573 2229 0a20 2020 2020  ss_names").     
-00003640: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00003650: 2020 2020 2063 6f6e 6669 672e 6172 7469       config.arti
-00003660: 6661 6374 732e 6361 6c63 756c 6174 655f  facts.calculate_
-00003670: 6861 7368 203d 2028 0a20 2020 2020 2020  hash = (.       
-00003680: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003690: 6172 7469 6661 6374 732e 6361 6c63 756c  artifacts.calcul
-000036a0: 6174 655f 6861 7368 0a20 2020 2020 2020  ate_hash.       
-000036b0: 2020 2020 2020 2020 2069 6620 636f 6e66           if conf
-000036c0: 6967 2e61 7274 6966 6163 7473 2e63 616c  ig.artifacts.cal
-000036d0: 6375 6c61 7465 5f68 6173 6820 6973 206e  culate_hash is n
-000036e0: 6f74 204e 6f6e 650a 2020 2020 2020 2020  ot None.        
-000036f0: 2020 2020 2020 2020 656c 7365 2073 6572          else ser
-00003700: 7665 725f 6366 672e 6765 7428 2263 616c  ver_cfg.get("cal
-00003710: 6375 6c61 7465 5f61 7274 6966 6163 745f  culate_artifact_
-00003720: 6861 7368 2229 0a20 2020 2020 2020 2020  hash").         
-00003730: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-00003740: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
-00003750: 732e 6765 6e65 7261 7465 5f74 6172 6765  s.generate_targe
-00003760: 745f 7061 7468 5f66 726f 6d5f 6172 7469  t_path_from_arti
-00003770: 6661 6374 5f68 6173 6820 3d20 280a 2020  fact_hash = (.  
-00003780: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00003790: 6e66 6967 2e61 7274 6966 6163 7473 2e67  nfig.artifacts.g
-000037a0: 656e 6572 6174 655f 7461 7267 6574 5f70  enerate_target_p
-000037b0: 6174 685f 6672 6f6d 5f61 7274 6966 6163  ath_from_artifac
-000037c0: 745f 6861 7368 0a20 2020 2020 2020 2020  t_hash.         
-000037d0: 2020 2020 2020 2069 6620 636f 6e66 6967         if config
-000037e0: 2e61 7274 6966 6163 7473 2e67 656e 6572  .artifacts.gener
-000037f0: 6174 655f 7461 7267 6574 5f70 6174 685f  ate_target_path_
-00003800: 6672 6f6d 5f61 7274 6966 6163 745f 6861  from_artifact_ha
-00003810: 7368 2069 7320 6e6f 7420 4e6f 6e65 0a20  sh is not None. 
-00003820: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00003830: 6c73 6520 7365 7276 6572 5f63 6667 2e67  lse server_cfg.g
-00003840: 6574 2822 6765 6e65 7261 7465 5f61 7274  et("generate_art
-00003850: 6966 6163 745f 7461 7267 6574 5f70 6174  ifact_target_pat
-00003860: 685f 6672 6f6d 5f61 7274 6966 6163 745f  h_from_artifact_
-00003870: 6861 7368 2229 0a20 2020 2020 2020 2020  hash").         
-00003880: 2020 2029 0a0a 2020 2020 2020 2020 2020     )..          
-00003890: 2020 636f 6e66 6967 2e72 6564 6973 2e75    config.redis.u
-000038a0: 726c 203d 2063 6f6e 6669 672e 7265 6469  rl = config.redi
-000038b0: 732e 7572 6c20 6f72 2073 6572 7665 725f  s.url or server_
-000038c0: 6366 672e 6765 7428 2272 6564 6973 5f75  cfg.get("redis_u
-000038d0: 726c 2229 0a20 2020 2020 2020 2020 2020  rl").           
-000038e0: 2023 2061 6c6c 6f77 2063 6c69 656e 7420   # allow client 
-000038f0: 746f 2073 6574 2074 6865 2064 6566 6175  to set the defau
-00003900: 6c74 2070 6172 7469 616c 2057 4120 666f  lt partial WA fo
-00003910: 7220 6c61 636b 206f 6620 7375 7070 6f72  r lack of suppor
-00003920: 7420 6f66 2070 6572 2d74 6172 6765 7420  t of per-target 
-00003930: 6175 7869 6c69 6172 7920 6f70 7469 6f6e  auxiliary option
-00003940: 730a 2020 2020 2020 2020 2020 2020 636f  s.            co
-00003950: 6e66 6967 2e72 6564 6973 2e74 7970 6520  nfig.redis.type 
-00003960: 3d20 636f 6e66 6967 2e72 6564 6973 2e74  = config.redis.t
-00003970: 7970 6520 6f72 2073 6572 7665 725f 6366  ype or server_cf
-00003980: 672e 6765 7428 2272 6564 6973 5f74 7970  g.get("redis_typ
-00003990: 6522 290a 0a20 2020 2020 2020 2020 2020  e")..           
-000039a0: 2063 6f6e 6669 672e 7371 6c2e 7572 6c20   config.sql.url 
-000039b0: 3d20 636f 6e66 6967 2e73 716c 2e75 726c  = config.sql.url
-000039c0: 206f 7220 7365 7276 6572 5f63 6667 2e67   or server_cfg.g
-000039d0: 6574 2822 7371 6c5f 7572 6c22 290a 2020  et("sql_url").  
-000039e0: 2020 2020 2020 2020 2020 2320 5468 6573            # Thes
-000039f0: 6520 6861 7665 2061 2064 6566 6175 6c74  e have a default
-00003a00: 2076 616c 7565 2c20 7468 6572 6566 6f72   value, therefor
-00003a10: 6520 6c6f 6361 6c20 636f 6e66 6967 2077  e local config w
-00003a20: 696c 6c20 616c 7761 7973 2068 6176 6520  ill always have 
-00003a30: 6120 7661 6c75 652c 2070 7269 6f72 6974  a value, priorit
-00003a40: 697a 6520 7468 650a 2020 2020 2020 2020  ize the.        
-00003a50: 2020 2020 2320 4150 4920 7661 6c75 6520      # API value 
-00003a60: 6669 7273 740a 2020 2020 2020 2020 2020  first.          
-00003a70: 2020 636f 6e66 6967 2e75 692e 7072 6f6a    config.ui.proj
-00003a80: 6563 7473 5f70 7265 6669 7820 3d20 280a  ects_prefix = (.
-00003a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00003aa0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003ab0: 7569 5f70 726f 6a65 6374 735f 7072 6566  ui_projects_pref
-00003ac0: 6978 2229 206f 7220 636f 6e66 6967 2e75  ix") or config.u
-00003ad0: 692e 7072 6f6a 6563 7473 5f70 7265 6669  i.projects_prefi
-00003ae0: 780a 2020 2020 2020 2020 2020 2020 290a  x.            ).
-00003af0: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00003b00: 6967 2e6b 6670 5f69 6d61 6765 203d 2073  ig.kfp_image = s
-00003b10: 6572 7665 725f 6366 672e 6765 7428 226b  erver_cfg.get("k
-00003b20: 6670 5f69 6d61 6765 2229 206f 7220 636f  fp_image") or co
-00003b30: 6e66 6967 2e6b 6670 5f69 6d61 6765 0a20  nfig.kfp_image. 
-00003b40: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00003b50: 672e 6b66 705f 7572 6c20 3d20 7365 7276  g.kfp_url = serv
-00003b60: 6572 5f63 6667 2e67 6574 2822 6b66 705f  er_cfg.get("kfp_
-00003b70: 7572 6c22 2920 6f72 2063 6f6e 6669 672e  url") or config.
-00003b80: 6b66 705f 7572 6c0a 2020 2020 2020 2020  kfp_url.        
-00003b90: 2020 2020 636f 6e66 6967 2e64 6173 6b5f      config.dask_
-00003ba0: 6b66 705f 696d 6167 6520 3d20 280a 2020  kfp_image = (.  
-00003bb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00003bc0: 7276 6572 5f63 6667 2e67 6574 2822 6461  rver_cfg.get("da
-00003bd0: 736b 5f6b 6670 5f69 6d61 6765 2229 206f  sk_kfp_image") o
-00003be0: 7220 636f 6e66 6967 2e64 6173 6b5f 6b66  r config.dask_kf
-00003bf0: 705f 696d 6167 650a 2020 2020 2020 2020  p_image.        
-00003c00: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00003c10: 2020 636f 6e66 6967 2e73 6372 6170 655f    config.scrape_
-00003c20: 6d65 7472 6963 7320 3d20 280a 2020 2020  metrics = (.    
-00003c30: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-00003c40: 6572 5f63 6667 2e67 6574 2822 7363 7261  er_cfg.get("scra
-00003c50: 7065 5f6d 6574 7269 6373 2229 0a20 2020  pe_metrics").   
-00003c60: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00003c70: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-00003c80: 7363 7261 7065 5f6d 6574 7269 6373 2229  scrape_metrics")
-00003c90: 2069 7320 6e6f 7420 4e6f 6e65 0a20 2020   is not None.   
-00003ca0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
-00003cb0: 6520 636f 6e66 6967 2e73 6372 6170 655f  e config.scrape_
-00003cc0: 6d65 7472 6963 730a 2020 2020 2020 2020  metrics.        
-00003cd0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00003ce0: 2020 636f 6e66 6967 2e68 7562 5f75 726c    config.hub_url
-00003cf0: 203d 2073 6572 7665 725f 6366 672e 6765   = server_cfg.ge
-00003d00: 7428 2268 7562 5f75 726c 2229 206f 7220  t("hub_url") or 
-00003d10: 636f 6e66 6967 2e68 7562 5f75 726c 0a20  config.hub_url. 
-00003d20: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00003d30: 672e 6465 6661 756c 745f 6675 6e63 7469  g.default_functi
-00003d40: 6f6e 5f6e 6f64 655f 7365 6c65 6374 6f72  on_node_selector
-00003d50: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00003d60: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
-00003d70: 6765 7428 2264 6566 6175 6c74 5f66 756e  get("default_fun
-00003d80: 6374 696f 6e5f 6e6f 6465 5f73 656c 6563  ction_node_selec
-00003d90: 746f 7222 290a 2020 2020 2020 2020 2020  tor").          
-00003da0: 2020 2020 2020 6f72 2063 6f6e 6669 672e        or config.
-00003db0: 6465 6661 756c 745f 6675 6e63 7469 6f6e  default_function
-00003dc0: 5f6e 6f64 655f 7365 6c65 6374 6f72 0a20  _node_selector. 
-00003dd0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-00003de0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
-00003df0: 6967 7a5f 7665 7273 696f 6e20 3d20 7365  igz_version = se
-00003e00: 7276 6572 5f63 6667 2e67 6574 2822 6967  rver_cfg.get("ig
-00003e10: 7a5f 7665 7273 696f 6e22 2920 6f72 2063  z_version") or c
-00003e20: 6f6e 6669 672e 6967 7a5f 7665 7273 696f  onfig.igz_versio
-00003e30: 6e0a 2020 2020 2020 2020 2020 2020 636f  n.            co
-00003e40: 6e66 6967 2e73 746f 7261 6765 2e61 7574  nfig.storage.aut
-00003e50: 6f5f 6d6f 756e 745f 7479 7065 203d 2028  o_mount_type = (
-00003e60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003e70: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00003e80: 2261 7574 6f5f 6d6f 756e 745f 7479 7065  "auto_mount_type
-00003e90: 2229 206f 7220 636f 6e66 6967 2e73 746f  ") or config.sto
-00003ea0: 7261 6765 2e61 7574 6f5f 6d6f 756e 745f  rage.auto_mount_
-00003eb0: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-00003ec0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-00003ed0: 6f6e 6669 672e 7374 6f72 6167 652e 6175  onfig.storage.au
-00003ee0: 746f 5f6d 6f75 6e74 5f70 6172 616d 7320  to_mount_params 
-00003ef0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
-00003f00: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
-00003f10: 6574 2822 6175 746f 5f6d 6f75 6e74 5f70  et("auto_mount_p
-00003f20: 6172 616d 7322 2920 6f72 2063 6f6e 6669  arams") or confi
-00003f30: 672e 7374 6f72 6167 652e 6175 746f 5f6d  g.storage.auto_m
-00003f40: 6f75 6e74 5f70 6172 616d 730a 2020 2020  ount_params.    
-00003f50: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00003f60: 2020 2020 2020 636f 6e66 6967 2e73 7061        config.spa
-00003f70: 726b 5f6f 7065 7261 746f 725f 7665 7273  rk_operator_vers
-00003f80: 696f 6e20 3d20 280a 2020 2020 2020 2020  ion = (.        
-00003f90: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
-00003fa0: 6667 2e67 6574 2822 7370 6172 6b5f 6f70  fg.get("spark_op
-00003fb0: 6572 6174 6f72 5f76 6572 7369 6f6e 2229  erator_version")
-00003fc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00003fd0: 206f 7220 636f 6e66 6967 2e73 7061 726b   or config.spark
-00003fe0: 5f6f 7065 7261 746f 725f 7665 7273 696f  _operator_versio
-00003ff0: 6e0a 2020 2020 2020 2020 2020 2020 290a  n.            ).
-00004000: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
-00004010: 6967 2e64 6566 6175 6c74 5f74 656e 736f  ig.default_tenso
-00004020: 7262 6f61 7264 5f6c 6f67 735f 7061 7468  rboard_logs_path
-00004030: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
-00004040: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
-00004050: 6765 7428 2264 6566 6175 6c74 5f74 656e  get("default_ten
-00004060: 736f 7262 6f61 7264 5f6c 6f67 735f 7061  sorboard_logs_pa
-00004070: 7468 2229 0a20 2020 2020 2020 2020 2020  th").           
-00004080: 2020 2020 206f 7220 636f 6e66 6967 2e64       or config.d
-00004090: 6566 6175 6c74 5f74 656e 736f 7262 6f61  efault_tensorboa
-000040a0: 7264 5f6c 6f67 735f 7061 7468 0a20 2020  rd_logs_path.   
-000040b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-000040c0: 2020 2020 2020 2063 6f6e 6669 672e 6465         config.de
-000040d0: 6661 756c 745f 6675 6e63 7469 6f6e 5f70  fault_function_p
-000040e0: 6f64 5f72 6573 6f75 7263 6573 203d 2028  od_resources = (
-000040f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00004100: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00004110: 2264 6566 6175 6c74 5f66 756e 6374 696f  "default_functio
-00004120: 6e5f 706f 645f 7265 736f 7572 6365 7322  n_pod_resources"
-00004130: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00004140: 2020 6f72 2063 6f6e 6669 672e 6465 6661    or config.defa
-00004150: 756c 745f 6675 6e63 7469 6f6e 5f70 6f64  ult_function_pod
-00004160: 5f72 6573 6f75 7263 6573 0a20 2020 2020  _resources.     
-00004170: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-00004180: 2020 2020 2063 6f6e 6669 672e 6675 6e63       config.func
-00004190: 7469 6f6e 5f64 6566 6175 6c74 732e 7072  tion_defaults.pr
-000041a0: 6565 6d70 7469 6f6e 5f6d 6f64 6520 3d20  eemption_mode = 
-000041b0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-000041c0: 2020 7365 7276 6572 5f63 6667 2e67 6574    server_cfg.get
-000041d0: 2822 6465 6661 756c 745f 7072 6565 6d70  ("default_preemp
-000041e0: 7469 6f6e 5f6d 6f64 6522 290a 2020 2020  tion_mode").    
-000041f0: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
-00004200: 6f6e 6669 672e 6675 6e63 7469 6f6e 5f64  onfig.function_d
-00004210: 6566 6175 6c74 732e 7072 6565 6d70 7469  efaults.preempti
-00004220: 6f6e 5f6d 6f64 650a 2020 2020 2020 2020  on_mode.        
-00004230: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
-00004240: 2020 636f 6e66 6967 2e70 7265 656d 7074    config.preempt
-00004250: 6962 6c65 5f6e 6f64 6573 2e6e 6f64 655f  ible_nodes.node_
-00004260: 7365 6c65 6374 6f72 203d 2028 0a20 2020  selector = (.   
-00004270: 2020 2020 2020 2020 2020 2020 2073 6572               ser
-00004280: 7665 725f 6366 672e 6765 7428 2270 7265  ver_cfg.get("pre
-00004290: 656d 7074 6962 6c65 5f6e 6f64 6573 5f6e  emptible_nodes_n
-000042a0: 6f64 655f 7365 6c65 6374 6f72 2229 0a20  ode_selector"). 
-000042b0: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-000042c0: 7220 636f 6e66 6967 2e70 7265 656d 7074  r config.preempt
-000042d0: 6962 6c65 5f6e 6f64 6573 2e6e 6f64 655f  ible_nodes.node_
-000042e0: 7365 6c65 6374 6f72 0a20 2020 2020 2020  selector.       
-000042f0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00004300: 2020 2063 6f6e 6669 672e 7072 6565 6d70     config.preemp
-00004310: 7469 626c 655f 6e6f 6465 732e 746f 6c65  tible_nodes.tole
-00004320: 7261 7469 6f6e 7320 3d20 280a 2020 2020  rations = (.    
-00004330: 2020 2020 2020 2020 2020 2020 7365 7276              serv
-00004340: 6572 5f63 6667 2e67 6574 2822 7072 6565  er_cfg.get("pree
-00004350: 6d70 7469 626c 655f 6e6f 6465 735f 746f  mptible_nodes_to
-00004360: 6c65 7261 7469 6f6e 7322 290a 2020 2020  lerations").    
-00004370: 2020 2020 2020 2020 2020 2020 6f72 2063              or c
-00004380: 6f6e 6669 672e 7072 6565 6d70 7469 626c  onfig.preemptibl
-00004390: 655f 6e6f 6465 732e 746f 6c65 7261 7469  e_nodes.tolerati
-000043a0: 6f6e 730a 2020 2020 2020 2020 2020 2020  ons.            
-000043b0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
-000043c0: 6e66 6967 2e66 6f72 6365 5f72 756e 5f6c  nfig.force_run_l
-000043d0: 6f63 616c 203d 2028 0a20 2020 2020 2020  ocal = (.       
-000043e0: 2020 2020 2020 2020 2073 6572 7665 725f           server_
-000043f0: 6366 672e 6765 7428 2266 6f72 6365 5f72  cfg.get("force_r
-00004400: 756e 5f6c 6f63 616c 2229 206f 7220 636f  un_local") or co
-00004410: 6e66 6967 2e66 6f72 6365 5f72 756e 5f6c  nfig.force_run_l
-00004420: 6f63 616c 0a20 2020 2020 2020 2020 2020  ocal.           
-00004430: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
-00004440: 6f6e 6669 672e 6675 6e63 7469 6f6e 203d  onfig.function =
-00004450: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
-00004460: 2266 756e 6374 696f 6e22 2920 6f72 2063  "function") or c
-00004470: 6f6e 6669 672e 6675 6e63 7469 6f6e 0a20  onfig.function. 
-00004480: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
-00004490: 672e 6874 7470 6462 2e6c 6f67 7320 3d20  g.httpdb.logs = 
-000044a0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
-000044b0: 6c6f 6773 2229 206f 7220 636f 6e66 6967  logs") or config
-000044c0: 2e68 7474 7064 622e 6c6f 6773 0a0a 2020  .httpdb.logs..  
-000044d0: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-000044e0: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
-000044f0: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00004500: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
-00004510: 2020 2020 2020 2020 2020 2022 4661 696c             "Fail
-00004520: 6564 2073 796e 6369 6e67 2063 6f6e 6669  ed syncing confi
-00004530: 6720 6672 6f6d 2073 6572 7665 7222 2c0a  g from server",.
-00004540: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00004550: 6578 633d 6572 725f 746f 5f73 7472 2865  exc=err_to_str(e
-00004560: 7863 292c 0a20 2020 2020 2020 2020 2020  xc),.           
-00004570: 2020 2020 2074 7261 6365 6261 636b 3d74       traceback=t
-00004580: 7261 6365 6261 636b 2e66 6f72 6d61 745f  raceback.format_
-00004590: 6578 6328 292c 0a20 2020 2020 2020 2020  exc(),.         
-000045a0: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
-000045b0: 7572 6e20 7365 6c66 0a0a 2020 2020 6465  urn self..    de
-000045c0: 6620 7374 6f72 655f 6c6f 6728 7365 6c66  f store_log(self
-000045d0: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
-000045e0: 222c 2062 6f64 793d 4e6f 6e65 2c20 6170  ", body=None, ap
-000045f0: 7065 6e64 3d46 616c 7365 293a 0a20 2020  pend=False):.   
-00004600: 2020 2020 2022 2222 5361 7665 2061 206c       """Save a l
-00004610: 6f67 2070 6572 7369 7374 656e 746c 792e  og persistently.
-00004620: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00004630: 2075 6964 3a20 4c6f 6720 756e 6971 7565   uid: Log unique
-00004640: 2049 440a 2020 2020 2020 2020 3a70 6172   ID.        :par
-00004650: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00004660: 6563 7420 6e61 6d65 2066 6f72 2077 6869  ect name for whi
-00004670: 6368 2074 6869 7320 6c6f 6720 6265 6c6f  ch this log belo
-00004680: 6e67 730a 2020 2020 2020 2020 3a70 6172  ngs.        :par
-00004690: 616d 2062 6f64 793a 2054 6865 2061 6374  am body: The act
-000046a0: 7561 6c20 6c6f 6720 746f 2073 746f 7265  ual log to store
-000046b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000046c0: 6170 7065 6e64 3a20 5768 6574 6865 7220  append: Whether 
-000046d0: 746f 2061 7070 656e 6420 7468 6520 6c6f  to append the lo
-000046e0: 6720 7072 6f76 6964 6564 2069 6e20 6060  g provided in ``
-000046f0: 626f 6479 6060 2074 6f20 616e 2065 7869  body`` to an exi
-00004700: 7374 696e 6720 6c6f 6720 7769 7468 2074  sting log with t
-00004710: 6865 2073 616d 6520 6060 7569 6460 6020  he same ``uid`` 
-00004720: 6f72 2074 6f0a 2020 2020 2020 2020 2020  or to.          
-00004730: 2020 6372 6561 7465 2061 206e 6577 206c    create a new l
-00004740: 6f67 2e20 4966 2073 6574 2074 6f20 6060  og. If set to ``
-00004750: 4661 6c73 6560 602c 2061 6e20 6578 6973  False``, an exis
-00004760: 7469 6e67 206c 6f67 2077 6974 6820 7361  ting log with sa
-00004770: 6d65 2060 6075 6964 6060 2077 696c 6c20  me ``uid`` will 
-00004780: 6265 206f 7665 7277 7269 7474 656e 0a20  be overwritten. 
-00004790: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-000047a0: 2020 2020 6966 206e 6f74 2062 6f64 793a      if not body:
-000047b0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-000047c0: 7572 6e0a 0a20 2020 2020 2020 2070 6174  urn..        pat
-000047d0: 6820 3d20 7365 6c66 2e5f 7061 7468 5f6f  h = self._path_o
-000047e0: 6628 226c 6f67 222c 2070 726f 6a65 6374  f("log", project
-000047f0: 2c20 7569 6429 0a20 2020 2020 2020 2070  , uid).        p
-00004800: 6172 616d 7320 3d20 7b22 6170 7065 6e64  arams = {"append
-00004810: 223a 2062 6f6f 6c32 7374 7228 6170 7065  ": bool2str(appe
-00004820: 6e64 297d 0a20 2020 2020 2020 2065 7272  nd)}.        err
-00004830: 6f72 203d 2066 2273 746f 7265 206c 6f67  or = f"store log
-00004840: 207b 7072 6f6a 6563 747d 2f7b 7569 647d   {project}/{uid}
-00004850: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-00004860: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
-00004870: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
-00004880: 616d 732c 2062 6f64 7929 0a0a 2020 2020  ams, body)..    
-00004890: 6465 6620 6765 745f 6c6f 6728 7365 6c66  def get_log(self
-000048a0: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
-000048b0: 222c 206f 6666 7365 743d 302c 2073 697a  ", offset=0, siz
-000048c0: 653d 2d31 293a 0a20 2020 2020 2020 2022  e=-1):.        "
-000048d0: 2222 5265 7472 6965 7665 2061 206c 6f67  ""Retrieve a log
-000048e0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-000048f0: 6d20 7569 643a 204c 6f67 2075 6e69 7175  m uid: Log uniqu
-00004900: 6520 4944 0a20 2020 2020 2020 203a 7061  e ID.        :pa
-00004910: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
-00004920: 6a65 6374 206e 616d 6520 666f 7220 7768  ject name for wh
-00004930: 6963 6820 7468 6520 6c6f 6720 6265 6c6f  ich the log belo
-00004940: 6e67 730a 2020 2020 2020 2020 3a70 6172  ngs.        :par
-00004950: 616d 206f 6666 7365 743a 2052 6574 7269  am offset: Retri
-00004960: 6576 6520 7061 7274 6961 6c20 6c6f 672c  eve partial log,
-00004970: 2067 6574 2075 7020 746f 2060 6073 697a   get up to ``siz
-00004980: 6560 6020 6279 7465 7320 7374 6172 7469  e`` bytes starti
-00004990: 6e67 2061 7420 6f66 6673 6574 2060 606f  ng at offset ``o
-000049a0: 6666 7365 7460 600a 2020 2020 2020 2020  ffset``.        
-000049b0: 2020 2020 6672 6f6d 2062 6567 696e 6e69      from beginni
-000049c0: 6e67 206f 6620 6c6f 670a 2020 2020 2020  ng of log.      
-000049d0: 2020 3a70 6172 616d 2073 697a 653a 2053    :param size: S
-000049e0: 6565 2060 606f 6666 7365 7460 602e 2049  ee ``offset``. I
-000049f0: 6620 7365 7420 746f 2060 602d 3160 6020  f set to ``-1`` 
-00004a00: 2874 6865 2064 6566 6175 6c74 2920 7769  (the default) wi
-00004a10: 6c6c 2072 6574 7269 6576 6520 616c 6c20  ll retrieve all 
-00004a20: 6461 7461 2074 6f20 656e 6420 6f66 206c  data to end of l
-00004a30: 6f67 2e0a 2020 2020 2020 2020 3a72 6574  og..        :ret
-00004a40: 7572 6e73 3a20 5468 6520 666f 6c6c 6f77  urns: The follow
-00004a50: 696e 6720 6f62 6a65 6374 733a 0a0a 2020  ing objects:..  
-00004a60: 2020 2020 2020 2020 2020 2d20 7374 6174            - stat
-00004a70: 6520 2d20 5468 6520 7374 6174 6520 6f66  e - The state of
-00004a80: 2074 6865 2072 756e 7469 6d65 206f 626a   the runtime obj
-00004a90: 6563 7420 7768 6963 6820 6765 6e65 7261  ect which genera
-00004aa0: 7465 7320 7468 6973 206c 6f67 2c20 6966  tes this log, if
-00004ab0: 2069 7420 6578 6973 7473 2e20 496e 2063   it exists. In c
-00004ac0: 6173 6520 6e6f 206b 6e6f 776e 2073 7461  ase no known sta
-00004ad0: 7465 0a20 2020 2020 2020 2020 2020 2020  te.             
-00004ae0: 2065 7869 7374 732c 2074 6869 7320 7769   exists, this wi
-00004af0: 6c6c 2062 6520 6060 756e 6b6e 6f77 6e60  ll be ``unknown`
-00004b00: 602e 0a20 2020 2020 2020 2020 2020 202d  `..            -
-00004b10: 2063 6f6e 7465 6e74 202d 2054 6865 2061   content - The a
-00004b20: 6374 7561 6c20 6c6f 6720 636f 6e74 656e  ctual log conten
-00004b30: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
-00004b40: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00004b50: 207b 226f 6666 7365 7422 3a20 6f66 6673   {"offset": offs
-00004b60: 6574 2c20 2273 697a 6522 3a20 7369 7a65  et, "size": size
-00004b70: 7d0a 2020 2020 2020 2020 7061 7468 203d  }.        path =
-00004b80: 2073 656c 662e 5f70 6174 685f 6f66 2822   self._path_of("
-00004b90: 6c6f 6722 2c20 7072 6f6a 6563 742c 2075  log", project, u
-00004ba0: 6964 290a 2020 2020 2020 2020 6572 726f  id).        erro
-00004bb0: 7220 3d20 6622 6765 7420 6c6f 6720 7b70  r = f"get log {p
-00004bc0: 726f 6a65 6374 7d2f 7b75 6964 7d22 0a20  roject}/{uid}". 
-00004bd0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00004be0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00004bf0: 222c 2070 6174 682c 2065 7272 6f72 2c20  ", path, error, 
-00004c00: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
-00004c10: 2020 2020 2020 2069 6620 7265 7370 2e68         if resp.h
-00004c20: 6561 6465 7273 3a0a 2020 2020 2020 2020  eaders:.        
-00004c30: 2020 2020 7374 6174 6520 3d20 7265 7370      state = resp
-00004c40: 2e68 6561 6465 7273 2e67 6574 2822 782d  .headers.get("x-
-00004c50: 6d6c 7275 6e2d 7275 6e2d 7374 6174 6522  mlrun-run-state"
-00004c60: 2c20 2222 290a 2020 2020 2020 2020 2020  , "").          
-00004c70: 2020 7265 7475 726e 2073 7461 7465 2e6c    return state.l
-00004c80: 6f77 6572 2829 2c20 7265 7370 2e63 6f6e  ower(), resp.con
-00004c90: 7465 6e74 0a0a 2020 2020 2020 2020 7265  tent..        re
-00004ca0: 7475 726e 2022 756e 6b6e 6f77 6e22 2c20  turn "unknown", 
-00004cb0: 7265 7370 2e63 6f6e 7465 6e74 0a0a 2020  resp.content..  
-00004cc0: 2020 6465 6620 7761 7463 685f 6c6f 6728    def watch_log(
-00004cd0: 7365 6c66 2c20 7569 642c 2070 726f 6a65  self, uid, proje
-00004ce0: 6374 3d22 222c 2077 6174 6368 3d54 7275  ct="", watch=Tru
-00004cf0: 652c 206f 6666 7365 743d 3029 3a0a 2020  e, offset=0):.  
-00004d00: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
-00004d10: 6520 6c6f 6773 206f 6620 6120 7275 6e6e  e logs of a runn
-00004d20: 696e 6720 7072 6f63 6573 732c 2061 6e64  ing process, and
-00004d30: 2077 6174 6368 2074 6865 2070 726f 6772   watch the progr
-00004d40: 6573 7320 6f66 2074 6865 2065 7865 6375  ess of the execu
-00004d50: 7469 6f6e 2075 6e74 696c 2069 7420 636f  tion until it co
-00004d60: 6d70 6c65 7465 732e 2054 6869 730a 2020  mpletes. This.  
-00004d70: 2020 2020 2020 6d65 7468 6f64 2077 696c        method wil
-00004d80: 6c20 7072 696e 7420 6f75 7420 7468 6520  l print out the 
-00004d90: 6c6f 6773 2061 6e64 2063 6f6e 7469 6e75  logs and continu
-00004da0: 6520 746f 2070 6572 696f 6469 6361 6c6c  e to periodicall
-00004db0: 7920 706f 6c6c 2066 6f72 2c20 616e 6420  y poll for, and 
-00004dc0: 7072 696e 742c 206e 6577 206c 6f67 7320  print, new logs 
-00004dd0: 6173 206c 6f6e 6720 6173 2074 6865 0a20  as long as the. 
-00004de0: 2020 2020 2020 2073 7461 7465 206f 6620         state of 
-00004df0: 7468 6520 7275 6e74 696d 6520 7768 6963  the runtime whic
-00004e00: 6820 6765 6e65 7261 7465 7320 7468 6973  h generates this
-00004e10: 206c 6f67 2069 7320 6569 7468 6572 2060   log is either `
-00004e20: 6070 656e 6469 6e67 6060 206f 7220 6060  `pending`` or ``
-00004e30: 7275 6e6e 696e 6760 602e 0a0a 2020 2020  running``...    
-00004e40: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
-00004e50: 5468 6520 7569 6420 6f66 2074 6865 206c  The uid of the l
-00004e60: 6f67 206f 626a 6563 7420 746f 2077 6174  og object to wat
-00004e70: 6368 2e0a 2020 2020 2020 2020 3a70 6172  ch..        :par
-00004e80: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00004e90: 6563 7420 7468 6174 2074 6865 206c 6f67  ect that the log
-00004ea0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
-00004eb0: 2020 2020 203a 7061 7261 6d20 7761 7463       :param watc
-00004ec0: 683a 2049 6620 7365 7420 746f 2060 6054  h: If set to ``T
-00004ed0: 7275 6560 6020 7769 6c6c 2063 6f6e 7469  rue`` will conti
-00004ee0: 6e75 6520 7472 6163 6b69 6e67 2074 6865  nue tracking the
-00004ef0: 206c 6f67 2061 7320 6465 7363 7269 6265   log as describe
-00004f00: 6420 6162 6f76 652e 204f 7468 6572 7769  d above. Otherwi
-00004f10: 7365 2074 6869 7320 6675 6e63 7469 6f6e  se this function
-00004f20: 0a20 2020 2020 2020 2020 2020 2069 7320  .            is 
-00004f30: 7072 6163 7469 6361 6c6c 7920 6571 7569  practically equi
-00004f40: 7661 6c65 6e74 2074 6f20 7468 6520 3a70  valent to the :p
-00004f50: 793a 6675 6e63 3a60 7e67 6574 5f6c 6f67  y:func:`~get_log
-00004f60: 6020 6675 6e63 7469 6f6e 2e0a 2020 2020  ` function..    
-00004f70: 2020 2020 3a70 6172 616d 206f 6666 7365      :param offse
-00004f80: 743a 204d 696e 696d 616c 206f 6666 7365  t: Minimal offse
-00004f90: 7420 696e 2074 6865 206c 6f67 2074 6f20  t in the log to 
-00004fa0: 7761 7463 682e 0a20 2020 2020 2020 203a  watch..        :
-00004fb0: 7265 7475 726e 733a 2054 6865 2066 696e  returns: The fin
-00004fc0: 616c 2073 7461 7465 206f 6620 7468 6520  al state of the 
-00004fd0: 6c6f 6720 6265 696e 6720 7761 7463 6865  log being watche
-00004fe0: 642e 0a20 2020 2020 2020 2022 2222 0a0a  d..        """..
-00004ff0: 2020 2020 2020 2020 7374 6174 652c 2074          state, t
-00005000: 6578 7420 3d20 7365 6c66 2e67 6574 5f6c  ext = self.get_l
-00005010: 6f67 2875 6964 2c20 7072 6f6a 6563 742c  og(uid, project,
-00005020: 206f 6666 7365 743d 6f66 6673 6574 290a   offset=offset).
-00005030: 2020 2020 2020 2020 6966 2074 6578 743a          if text:
-00005040: 0a20 2020 2020 2020 2020 2020 2070 7269  .            pri
-00005050: 6e74 2874 6578 742e 6465 636f 6465 2865  nt(text.decode(e
-00005060: 7272 6f72 733d 6d6c 7275 6e2e 6d6c 636f  rrors=mlrun.mlco
-00005070: 6e66 2e68 7474 7064 622e 6c6f 6773 2e64  nf.httpdb.logs.d
-00005080: 6563 6f64 652e 6572 726f 7273 2929 0a20  ecode.errors)). 
-00005090: 2020 2020 2020 2069 6620 7761 7463 683a         if watch:
-000050a0: 0a20 2020 2020 2020 2020 2020 206e 696c  .            nil
-000050b0: 5f72 6573 7020 3d20 300a 2020 2020 2020  _resp = 0.      
-000050c0: 2020 2020 2020 7768 696c 6520 7374 6174        while stat
-000050d0: 6520 696e 205b 2270 656e 6469 6e67 222c  e in ["pending",
-000050e0: 2022 7275 6e6e 696e 6722 5d3a 0a20 2020   "running"]:.   
-000050f0: 2020 2020 2020 2020 2020 2020 206f 6666               off
-00005100: 7365 7420 2b3d 206c 656e 2874 6578 7429  set += len(text)
-00005110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005120: 2023 2069 6620 7765 2067 6574 2033 206e   # if we get 3 n
-00005130: 696c 2072 6573 706f 6e73 6573 2069 6e20  il responses in 
-00005140: 6120 726f 772c 2069 6e63 7265 6173 6520  a row, increase 
-00005150: 7468 6520 736c 6565 7020 7469 6d65 2074  the sleep time t
-00005160: 6f20 3130 2073 6563 6f6e 6473 0a20 2020  o 10 seconds.   
-00005170: 2020 2020 2020 2020 2020 2020 2023 2054               # T
-00005180: 4f44 4f3a 2072 6566 6163 746f 7220 7468  ODO: refactor th
-00005190: 6973 2074 6f20 7573 6520 6120 636f 6e64  is to use a cond
-000051a0: 6974 696f 6e61 6c20 6261 636b 6f66 6620  itional backoff 
-000051b0: 6d65 6368 616e 6973 6d0a 2020 2020 2020  mechanism.      
-000051c0: 2020 2020 2020 2020 2020 6966 206e 696c            if nil
-000051d0: 5f72 6573 7020 3c20 333a 0a20 2020 2020  _resp < 3:.     
-000051e0: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-000051f0: 696d 652e 736c 6565 7028 696e 7428 6d6c  ime.sleep(int(ml
-00005200: 7275 6e2e 6d6c 636f 6e66 2e68 7474 7064  run.mlconf.httpd
-00005210: 622e 6c6f 6773 2e70 756c 6c5f 6c6f 6773  b.logs.pull_logs
-00005220: 5f64 6566 6175 6c74 5f69 6e74 6572 7661  _default_interva
-00005230: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
-00005240: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-00005250: 2020 2020 2020 2020 2020 2020 2020 7469                ti
-00005260: 6d65 2e73 6c65 6570 280a 2020 2020 2020  me.sleep(.      
-00005270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005280: 2020 696e 7428 0a20 2020 2020 2020 2020    int(.         
-00005290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000052a0: 2020 206d 6c72 756e 2e6d 6c63 6f6e 662e     mlrun.mlconf.
-000052b0: 6874 7470 6462 2e6c 6f67 732e 7075 6c6c  httpdb.logs.pull
-000052c0: 5f6c 6f67 735f 6261 636b 6f66 665f 6e6f  _logs_backoff_no
-000052d0: 5f6c 6f67 735f 6465 6661 756c 745f 696e  _logs_default_in
-000052e0: 7465 7276 616c 0a20 2020 2020 2020 2020  terval.         
-000052f0: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00005300: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00005310: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-00005320: 2020 2020 2020 2073 7461 7465 2c20 7465         state, te
-00005330: 7874 203d 2073 656c 662e 6765 745f 6c6f  xt = self.get_lo
-00005340: 6728 7569 642c 2070 726f 6a65 6374 2c20  g(uid, project, 
-00005350: 6f66 6673 6574 3d6f 6666 7365 7429 0a20  offset=offset). 
-00005360: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00005370: 6620 7465 7874 3a0a 2020 2020 2020 2020  f text:.        
-00005380: 2020 2020 2020 2020 2020 2020 6e69 6c5f              nil_
-00005390: 7265 7370 203d 2030 0a20 2020 2020 2020  resp = 0.       
-000053a0: 2020 2020 2020 2020 2020 2020 2070 7269               pri
-000053b0: 6e74 280a 2020 2020 2020 2020 2020 2020  nt(.            
-000053c0: 2020 2020 2020 2020 2020 2020 7465 7874              text
-000053d0: 2e64 6563 6f64 6528 6572 726f 7273 3d6d  .decode(errors=m
-000053e0: 6c72 756e 2e6d 6c63 6f6e 662e 6874 7470  lrun.mlconf.http
-000053f0: 6462 2e6c 6f67 732e 6465 636f 6465 2e65  db.logs.decode.e
-00005400: 7272 6f72 7329 2c0a 2020 2020 2020 2020  rrors),.        
-00005410: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00005420: 656e 643d 2222 2c0a 2020 2020 2020 2020  end="",.        
-00005430: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-00005440: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00005450: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005460: 2020 2020 2020 2020 6e69 6c5f 7265 7370          nil_resp
-00005470: 202b 3d20 310a 2020 2020 2020 2020 656c   += 1.        el
-00005480: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00005490: 6f66 6673 6574 202b 3d20 6c65 6e28 7465  offset += len(te
-000054a0: 7874 290a 0a20 2020 2020 2020 2072 6574  xt)..        ret
-000054b0: 7572 6e20 7374 6174 652c 206f 6666 7365  urn state, offse
-000054c0: 740a 0a20 2020 2064 6566 2073 746f 7265  t..    def store
-000054d0: 5f72 756e 2873 656c 662c 2073 7472 7563  _run(self, struc
-000054e0: 742c 2075 6964 2c20 7072 6f6a 6563 743d  t, uid, project=
-000054f0: 2222 2c20 6974 6572 3d30 293a 0a20 2020  "", iter=0):.   
-00005500: 2020 2020 2022 2222 5374 6f72 6520 7275       """Store ru
-00005510: 6e20 6465 7461 696c 7320 696e 2074 6865  n details in the
-00005520: 2044 422e 2054 6869 7320 6d65 7468 6f64   DB. This method
-00005530: 2069 7320 7573 7561 6c6c 7920 6361 6c6c   is usually call
-00005540: 6564 2066 726f 6d20 7769 7468 696e 206f  ed from within o
-00005550: 7468 6572 203a 7079 3a6d 6f64 3a60 6d6c  ther :py:mod:`ml
-00005560: 7275 6e60 2066 6c6f 7773 0a20 2020 2020  run` flows.     
-00005570: 2020 2061 6e64 206e 6f74 2063 616c 6c65     and not calle
-00005580: 6420 6469 7265 6374 6c79 2062 7920 7468  d directly by th
-00005590: 6520 7573 6572 2e22 2222 0a0a 2020 2020  e user."""..    
-000055a0: 2020 2020 7061 7468 203d 2073 656c 662e      path = self.
-000055b0: 5f70 6174 685f 6f66 2822 7275 6e22 2c20  _path_of("run", 
-000055c0: 7072 6f6a 6563 742c 2075 6964 290a 2020  project, uid).  
-000055d0: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-000055e0: 2269 7465 7222 3a20 6974 6572 7d0a 2020  "iter": iter}.  
-000055f0: 2020 2020 2020 6572 726f 7220 3d20 6622        error = f"
-00005600: 7374 6f72 6520 7275 6e20 7b70 726f 6a65  store run {proje
-00005610: 6374 7d2f 7b75 6964 7d22 0a20 2020 2020  ct}/{uid}".     
-00005620: 2020 2062 6f64 7920 3d20 5f61 735f 6a73     body = _as_js
-00005630: 6f6e 2873 7472 7563 7429 0a20 2020 2020  on(struct).     
-00005640: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
-00005650: 2822 504f 5354 222c 2070 6174 682c 2065  ("POST", path, e
-00005660: 7272 6f72 2c20 7061 7261 6d73 3d70 6172  rror, params=par
-00005670: 616d 732c 2062 6f64 793d 626f 6479 290a  ams, body=body).
-00005680: 0a20 2020 2064 6566 2075 7064 6174 655f  .    def update_
-00005690: 7275 6e28 7365 6c66 2c20 7570 6461 7465  run(self, update
-000056a0: 733a 2064 6963 742c 2075 6964 2c20 7072  s: dict, uid, pr
-000056b0: 6f6a 6563 743d 2222 2c20 6974 6572 3d30  oject="", iter=0
-000056c0: 293a 0a20 2020 2020 2020 2022 2222 5570  ):.        """Up
-000056d0: 6461 7465 2074 6865 2064 6574 6169 6c73  date the details
-000056e0: 206f 6620 6120 7374 6f72 6564 2072 756e   of a stored run
-000056f0: 2069 6e20 7468 6520 4442 2e22 2222 0a0a   in the DB."""..
-00005700: 2020 2020 2020 2020 7061 7468 203d 2073          path = s
-00005710: 656c 662e 5f70 6174 685f 6f66 2822 7275  elf._path_of("ru
-00005720: 6e22 2c20 7072 6f6a 6563 742c 2075 6964  n", project, uid
-00005730: 290a 2020 2020 2020 2020 7061 7261 6d73  ).        params
-00005740: 203d 207b 2269 7465 7222 3a20 6974 6572   = {"iter": iter
-00005750: 7d0a 2020 2020 2020 2020 6572 726f 7220  }.        error 
-00005760: 3d20 6622 7570 6461 7465 2072 756e 207b  = f"update run {
-00005770: 7072 6f6a 6563 747d 2f7b 7569 647d 220a  project}/{uid}".
-00005780: 2020 2020 2020 2020 626f 6479 203d 205f          body = _
-00005790: 6173 5f6a 736f 6e28 7570 6461 7465 7329  as_json(updates)
-000057a0: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-000057b0: 695f 6361 6c6c 2822 5041 5443 4822 2c20  i_call("PATCH", 
-000057c0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
-000057d0: 616d 733d 7061 7261 6d73 2c20 626f 6479  ams=params, body
-000057e0: 3d62 6f64 7929 0a0a 2020 2020 6465 6620  =body)..    def 
-000057f0: 6162 6f72 745f 7275 6e28 7365 6c66 2c20  abort_run(self, 
-00005800: 7569 642c 2070 726f 6a65 6374 3d22 222c  uid, project="",
-00005810: 2069 7465 723d 3029 3a0a 2020 2020 2020   iter=0):.      
-00005820: 2020 2222 220a 2020 2020 2020 2020 4162    """.        Ab
-00005830: 6f72 7420 6120 7275 6e6e 696e 6720 7275  ort a running ru
-00005840: 6e20 2d20 7769 6c6c 2072 656d 6f76 6520  n - will remove 
-00005850: 7468 6520 7275 6e27 7320 7275 6e74 696d  the run's runtim
-00005860: 6520 7265 736f 7572 6365 7320 616e 6420  e resources and 
-00005870: 6d61 726b 2069 7473 2073 7461 7465 2061  mark its state a
-00005880: 7320 6162 6f72 7465 640a 2020 2020 2020  s aborted.      
-00005890: 2020 2222 220a 2020 2020 2020 2020 7365    """.        se
-000058a0: 6c66 2e75 7064 6174 655f 7275 6e28 0a20  lf.update_run(. 
-000058b0: 2020 2020 2020 2020 2020 207b 2273 7461             {"sta
-000058c0: 7475 732e 7374 6174 6522 3a20 6d6c 7275  tus.state": mlru
-000058d0: 6e2e 7275 6e74 696d 6573 2e63 6f6e 7374  n.runtimes.const
-000058e0: 616e 7473 2e52 756e 5374 6174 6573 2e61  ants.RunStates.a
-000058f0: 626f 7274 6564 7d2c 0a20 2020 2020 2020  borted},.       
-00005900: 2020 2020 2075 6964 2c0a 2020 2020 2020       uid,.      
-00005910: 2020 2020 2020 7072 6f6a 6563 742c 0a20        project,. 
-00005920: 2020 2020 2020 2020 2020 2069 7465 722c             iter,
-00005930: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-00005940: 6465 6620 7265 6164 5f72 756e 2873 656c  def read_run(sel
-00005950: 662c 2075 6964 2c20 7072 6f6a 6563 743d  f, uid, project=
-00005960: 2222 2c20 6974 6572 3d30 293a 0a20 2020  "", iter=0):.   
-00005970: 2020 2020 2022 2222 5265 6164 2074 6865       """Read the
-00005980: 2064 6574 6169 6c73 206f 6620 6120 7374   details of a st
-00005990: 6f72 6564 2072 756e 2066 726f 6d20 7468  ored run from th
-000059a0: 6520 4442 2e0a 0a20 2020 2020 2020 203a  e DB...        :
-000059b0: 7061 7261 6d20 7569 643a 2054 6865 2072  param uid: The r
-000059c0: 756e 2773 2075 6e69 7175 6520 4944 2e0a  un's unique ID..
-000059d0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-000059e0: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-000059f0: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
-00005a00: 6172 616d 2069 7465 723a 2049 7465 7261  aram iter: Itera
-00005a10: 7469 6f6e 2077 6974 6869 6e20 6120 7370  tion within a sp
-00005a20: 6563 6966 6963 2065 7865 6375 7469 6f6e  ecific execution
-00005a30: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00005a40: 2020 2020 2020 2070 6174 6820 3d20 7365         path = se
-00005a50: 6c66 2e5f 7061 7468 5f6f 6628 2272 756e  lf._path_of("run
-00005a60: 222c 2070 726f 6a65 6374 2c20 7569 6429  ", project, uid)
-00005a70: 0a20 2020 2020 2020 2070 6172 616d 7320  .        params 
-00005a80: 3d20 7b22 6974 6572 223a 2069 7465 727d  = {"iter": iter}
-00005a90: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-00005aa0: 2066 2267 6574 2072 756e 207b 7072 6f6a   f"get run {proj
-00005ab0: 6563 747d 2f7b 7569 647d 220a 2020 2020  ect}/{uid}".    
-00005ac0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00005ad0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
-00005ae0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
-00005af0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-00005b00: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
-00005b10: 6a73 6f6e 2829 5b22 6461 7461 225d 0a0a  json()["data"]..
-00005b20: 2020 2020 6465 6620 6465 6c5f 7275 6e28      def del_run(
-00005b30: 7365 6c66 2c20 7569 642c 2070 726f 6a65  self, uid, proje
-00005b40: 6374 3d22 222c 2069 7465 723d 3029 3a0a  ct="", iter=0):.
-00005b50: 2020 2020 2020 2020 2222 2244 656c 6574          """Delet
-00005b60: 6520 6465 7461 696c 7320 6f66 2061 2073  e details of a s
-00005b70: 7065 6369 6669 6320 7275 6e20 6672 6f6d  pecific run from
-00005b80: 2044 422e 0a0a 2020 2020 2020 2020 3a70   DB...        :p
-00005b90: 6172 616d 2075 6964 3a20 556e 6971 7565  aram uid: Unique
-00005ba0: 2049 4420 666f 7220 7468 6520 7370 6563   ID for the spec
-00005bb0: 6966 6963 2072 756e 2074 6f20 6465 6c65  ific run to dele
-00005bc0: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
-00005bd0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00005be0: 6563 7420 7468 6174 2074 6865 2072 756e  ect that the run
-00005bf0: 2062 656c 6f6e 6773 2074 6f2e 0a20 2020   belongs to..   
-00005c00: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
-00005c10: 3a20 4974 6572 6174 696f 6e20 7769 7468  : Iteration with
-00005c20: 696e 2061 2073 7065 6369 6669 6320 7461  in a specific ta
-00005c30: 736b 2e0a 2020 2020 2020 2020 2222 220a  sk..        """.
-00005c40: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-00005c50: 7365 6c66 2e5f 7061 7468 5f6f 6628 2272  self._path_of("r
-00005c60: 756e 222c 2070 726f 6a65 6374 2c20 7569  un", project, ui
-00005c70: 6429 0a20 2020 2020 2020 2070 6172 616d  d).        param
-00005c80: 7320 3d20 7b22 6974 6572 223a 2069 7465  s = {"iter": ite
-00005c90: 727d 0a20 2020 2020 2020 2065 7272 6f72  r}.        error
-00005ca0: 203d 2066 2264 656c 2072 756e 207b 7072   = f"del run {pr
-00005cb0: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
-00005cc0: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-00005cd0: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
-00005ce0: 7468 2c20 6572 726f 722c 2070 6172 616d  th, error, param
-00005cf0: 733d 7061 7261 6d73 290a 0a20 2020 2064  s=params)..    d
-00005d00: 6566 206c 6973 745f 7275 6e73 280a 2020  ef list_runs(.  
-00005d10: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00005d20: 2020 2020 6e61 6d65 3d4e 6f6e 652c 0a20      name=None,. 
-00005d30: 2020 2020 2020 2075 6964 3a20 4f70 7469         uid: Opti
-00005d40: 6f6e 616c 5b55 6e69 6f6e 5b73 7472 2c20  onal[Union[str, 
-00005d50: 4c69 7374 5b73 7472 5d5d 5d20 3d20 4e6f  List[str]]] = No
-00005d60: 6e65 2c0a 2020 2020 2020 2020 7072 6f6a  ne,.        proj
-00005d70: 6563 743d 4e6f 6e65 2c0a 2020 2020 2020  ect=None,.      
-00005d80: 2020 6c61 6265 6c73 3d4e 6f6e 652c 0a20    labels=None,. 
-00005d90: 2020 2020 2020 2073 7461 7465 3d4e 6f6e         state=Non
-00005da0: 652c 0a20 2020 2020 2020 2073 6f72 743d  e,.        sort=
-00005db0: 5472 7565 2c0a 2020 2020 2020 2020 6c61  True,.        la
-00005dc0: 7374 3d30 2c0a 2020 2020 2020 2020 6974  st=0,.        it
-00005dd0: 6572 3d46 616c 7365 2c0a 2020 2020 2020  er=False,.      
-00005de0: 2020 7374 6172 745f 7469 6d65 5f66 726f    start_time_fro
-00005df0: 6d3a 2064 6174 6574 696d 6520 3d20 4e6f  m: datetime = No
-00005e00: 6e65 2c0a 2020 2020 2020 2020 7374 6172  ne,.        star
-00005e10: 745f 7469 6d65 5f74 6f3a 2064 6174 6574  t_time_to: datet
-00005e20: 696d 6520 3d20 4e6f 6e65 2c0a 2020 2020  ime = None,.    
-00005e30: 2020 2020 6c61 7374 5f75 7064 6174 655f      last_update_
-00005e40: 7469 6d65 5f66 726f 6d3a 2064 6174 6574  time_from: datet
-00005e50: 696d 6520 3d20 4e6f 6e65 2c0a 2020 2020  ime = None,.    
-00005e60: 2020 2020 6c61 7374 5f75 7064 6174 655f      last_update_
-00005e70: 7469 6d65 5f74 6f3a 2064 6174 6574 696d  time_to: datetim
-00005e80: 6520 3d20 4e6f 6e65 2c0a 2020 2020 2020  e = None,.      
-00005e90: 2020 7061 7274 6974 696f 6e5f 6279 3a20    partition_by: 
-00005ea0: 556e 696f 6e5b 6d6c 7275 6e2e 636f 6d6d  Union[mlrun.comm
-00005eb0: 6f6e 2e73 6368 656d 6173 2e52 756e 5061  on.schemas.RunPa
-00005ec0: 7274 6974 696f 6e42 7946 6965 6c64 2c20  rtitionByField, 
-00005ed0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00005ee0: 2020 2020 2072 6f77 735f 7065 725f 7061       rows_per_pa
-00005ef0: 7274 6974 696f 6e3a 2069 6e74 203d 2031  rtition: int = 1
-00005f00: 2c0a 2020 2020 2020 2020 7061 7274 6974  ,.        partit
-00005f10: 696f 6e5f 736f 7274 5f62 793a 2055 6e69  ion_sort_by: Uni
-00005f20: 6f6e 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e  on[mlrun.common.
-00005f30: 7363 6865 6d61 732e 536f 7274 4669 656c  schemas.SortFiel
-00005f40: 642c 2073 7472 5d20 3d20 4e6f 6e65 2c0a  d, str] = None,.
-00005f50: 2020 2020 2020 2020 7061 7274 6974 696f          partitio
-00005f60: 6e5f 6f72 6465 723a 2055 6e69 6f6e 5b0a  n_order: Union[.
-00005f70: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
-00005f80: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00005f90: 2e4f 7264 6572 5479 7065 2c20 7374 720a  .OrderType, str.
-00005fa0: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00005fb0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00005fc0: 2e4f 7264 6572 5479 7065 2e64 6573 632c  .OrderType.desc,
-00005fd0: 0a20 2020 2020 2020 206d 6178 5f70 6172  .        max_par
-00005fe0: 7469 7469 6f6e 733a 2069 6e74 203d 2030  titions: int = 0
-00005ff0: 2c0a 2020 2020 2020 2020 7769 7468 5f6e  ,.        with_n
-00006000: 6f74 6966 6963 6174 696f 6e73 3a20 626f  otifications: bo
-00006010: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00006020: 2920 2d3e 2052 756e 4c69 7374 3a0a 2020  ) -> RunList:.  
-00006030: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
-00006040: 6520 6120 6c69 7374 206f 6620 7275 6e73  e a list of runs
-00006050: 2c20 6669 6c74 6572 6564 2062 7920 7661  , filtered by va
-00006060: 7269 6f75 7320 6f70 7469 6f6e 732e 0a20  rious options.. 
-00006070: 2020 2020 2020 2045 7861 6d70 6c65 3a3a         Example::
-00006080: 0a0a 2020 2020 2020 2020 2020 2020 7275  ..            ru
-00006090: 6e73 203d 2064 622e 6c69 7374 5f72 756e  ns = db.list_run
-000060a0: 7328 6e61 6d65 3d27 646f 776e 6c6f 6164  s(name='download
-000060b0: 272c 2070 726f 6a65 6374 3d27 6972 6973  ', project='iris
-000060c0: 272c 206c 6162 656c 733d 276f 776e 6572  ', labels='owner
-000060d0: 3d61 646d 696e 2729 0a20 2020 2020 2020  =admin').       
-000060e0: 2020 2020 2023 2049 6620 7275 6e6e 696e       # If runnin
-000060f0: 6720 696e 204a 7570 7974 6572 2c20 6361  g in Jupyter, ca
-00006100: 6e20 7573 6520 7468 6520 2e73 686f 7728  n use the .show(
-00006110: 2920 6675 6e63 7469 6f6e 2074 6f20 6469  ) function to di
-00006120: 7370 6c61 7920 7468 6520 7265 7375 6c74  splay the result
-00006130: 730a 2020 2020 2020 2020 2020 2020 6462  s.            db
-00006140: 2e6c 6973 745f 7275 6e73 286e 616d 653d  .list_runs(name=
-00006150: 2727 2c20 7072 6f6a 6563 743d 7072 6f6a  '', project=proj
-00006160: 6563 745f 6e61 6d65 292e 7368 6f77 2829  ect_name).show()
-00006170: 0a0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00006180: 6d20 6e61 6d65 3a20 4e61 6d65 206f 6620  m name: Name of 
-00006190: 7468 6520 7275 6e20 746f 2072 6574 7269  the run to retri
-000061a0: 6576 652e 0a20 2020 2020 2020 203a 7061  eve..        :pa
-000061b0: 7261 6d20 7569 643a 2055 6e69 7175 6520  ram uid: Unique 
-000061c0: 4944 206f 6620 7468 6520 7275 6e2c 206f  ID of the run, o
-000061d0: 7220 6120 6c69 7374 206f 6620 7275 6e20  r a list of run 
-000061e0: 5549 4473 2e0a 2020 2020 2020 2020 3a70  UIDs..        :p
-000061f0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
-00006200: 6f6a 6563 7420 7468 6174 2074 6865 2072  oject that the r
-00006210: 756e 7320 6265 6c6f 6e67 7320 746f 2e0a  uns belongs to..
-00006220: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-00006230: 6162 656c 733a 204c 6973 7420 7275 6e73  abels: List runs
-00006240: 2074 6861 7420 6861 7665 2061 2073 7065   that have a spe
-00006250: 6369 6669 6320 6c61 6265 6c20 6173 7369  cific label assi
-00006260: 676e 6564 2e20 4375 7272 656e 746c 7920  gned. Currently 
-00006270: 6f6e 6c79 2061 2073 696e 676c 6520 6c61  only a single la
-00006280: 6265 6c20 6669 6c74 6572 2063 616e 2062  bel filter can b
-00006290: 650a 2020 2020 2020 2020 2020 2020 6170  e.            ap
-000062a0: 706c 6965 642c 206f 7468 6572 7769 7365  plied, otherwise
-000062b0: 2072 6573 756c 7420 7769 6c6c 2062 6520   result will be 
-000062c0: 656d 7074 792e 0a20 2020 2020 2020 203a  empty..        :
-000062d0: 7061 7261 6d20 7374 6174 653a 204c 6973  param state: Lis
-000062e0: 7420 6f6e 6c79 2072 756e 7320 7768 6f73  t only runs whos
-000062f0: 6520 7374 6174 6520 6973 2073 7065 6369  e state is speci
-00006300: 6669 6564 2e0a 2020 2020 2020 2020 3a70  fied..        :p
-00006310: 6172 616d 2073 6f72 743a 2057 6865 7468  aram sort: Wheth
-00006320: 6572 2074 6f20 736f 7274 2074 6865 2072  er to sort the r
-00006330: 6573 756c 7420 6163 636f 7264 696e 6720  esult according 
-00006340: 746f 2074 6865 6972 2073 7461 7274 2074  to their start t
-00006350: 696d 652e 204f 7468 6572 7769 7365 2c20  ime. Otherwise, 
-00006360: 7265 7375 6c74 7320 7769 6c6c 2062 650a  results will be.
-00006370: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00006380: 726e 6564 2062 7920 7468 6569 7220 696e  rned by their in
-00006390: 7465 726e 616c 206f 7264 6572 2069 6e20  ternal order in 
-000063a0: 7468 6520 4442 2028 6f72 6465 7220 7769  the DB (order wi
-000063b0: 6c6c 206e 6f74 2062 6520 6775 6172 616e  ll not be guaran
-000063c0: 7465 6564 292e 0a20 2020 2020 2020 203a  teed)..        :
-000063d0: 7061 7261 6d20 6c61 7374 3a20 4465 7072  param last: Depr
-000063e0: 6563 6174 6564 202d 2063 7572 7265 6e74  ecated - current
-000063f0: 6c79 206e 6f74 2075 7365 642e 0a20 2020  ly not used..   
-00006400: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
-00006410: 3a20 4966 2060 6054 7275 6560 6020 7265  : If ``True`` re
-00006420: 7475 726e 2072 756e 7320 6672 6f6d 2061  turn runs from a
-00006430: 6c6c 2069 7465 7261 7469 6f6e 732e 204f  ll iterations. O
-00006440: 7468 6572 7769 7365 2c20 7265 7475 726e  therwise, return
-00006450: 206f 6e6c 7920 7275 6e73 2077 686f 7365   only runs whose
-00006460: 2060 6069 7465 7260 6020 6973 2030 2e0a   ``iter`` is 0..
-00006470: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
-00006480: 7461 7274 5f74 696d 655f 6672 6f6d 3a20  tart_time_from: 
-00006490: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
-000064a0: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
-000064b0: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
-000064c0: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
-000064d0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000064e0: 2073 7461 7274 5f74 696d 655f 746f 3a20   start_time_to: 
-000064f0: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
-00006500: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
-00006510: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
-00006520: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
-00006530: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00006540: 206c 6173 745f 7570 6461 7465 5f74 696d   last_update_tim
-00006550: 655f 6672 6f6d 3a20 4669 6c74 6572 2062  e_from: Filter b
-00006560: 7920 7275 6e20 6c61 7374 2075 7064 6174  y run last updat
-00006570: 6520 7469 6d65 2069 6e20 6060 286c 6173  e time in ``(las
-00006580: 745f 7570 6461 7465 5f74 696d 655f 6672  t_update_time_fr
-00006590: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
-000065a0: 6c61 7374 5f75 7064 6174 655f 7469 6d65  last_update_time
-000065b0: 5f74 6f29 6060 2e0a 2020 2020 2020 2020  _to)``..        
-000065c0: 3a70 6172 616d 206c 6173 745f 7570 6461  :param last_upda
-000065d0: 7465 5f74 696d 655f 746f 3a20 4669 6c74  te_time_to: Filt
-000065e0: 6572 2062 7920 7275 6e20 6c61 7374 2075  er by run last u
-000065f0: 7064 6174 6520 7469 6d65 2069 6e20 6060  pdate time in ``
-00006600: 286c 6173 745f 7570 6461 7465 5f74 696d  (last_update_tim
-00006610: 655f 6672 6f6d 2c20 6c61 7374 5f75 7064  e_from, last_upd
-00006620: 6174 655f 7469 6d65 5f74 6f29 6060 2e0a  ate_time_to)``..
-00006630: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-00006640: 6172 7469 7469 6f6e 5f62 793a 2046 6965  artition_by: Fie
-00006650: 6c64 2074 6f20 6772 6f75 7020 7265 7375  ld to group resu
-00006660: 6c74 7320 6279 2e20 4f6e 6c79 2061 6c6c  lts by. Only all
-00006670: 6f77 6564 2076 616c 7565 2069 7320 606e  owed value is `n
-00006680: 616d 6560 2e20 5768 656e 2060 7061 7274  ame`. When `part
-00006690: 6974 696f 6e5f 6279 6020 6973 2073 7065  ition_by` is spe
-000066a0: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
-000066b0: 2020 2020 7468 6520 6070 6172 7469 7469      the `partiti
-000066c0: 6f6e 5f73 6f72 745f 6279 6020 7061 7261  on_sort_by` para
-000066d0: 6d65 7465 7220 6d75 7374 2062 6520 7072  meter must be pr
-000066e0: 6f76 6964 6564 2061 7320 7765 6c6c 2e0a  ovided as well..
-000066f0: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-00006700: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
-00006710: 6e3a 2048 6f77 206d 616e 7920 746f 7020  n: How many top 
-00006720: 726f 7773 2028 7065 7220 736f 7274 696e  rows (per sortin
-00006730: 6720 6465 6669 6e65 6420 6279 2060 7061  g defined by `pa
-00006740: 7274 6974 696f 6e5f 736f 7274 5f62 7960  rtition_sort_by`
-00006750: 2061 6e64 2060 7061 7274 6974 696f 6e5f   and `partition_
-00006760: 6f72 6465 7260 290a 2020 2020 2020 2020  order`).        
-00006770: 2020 2020 746f 2072 6574 7572 6e20 7065      to return pe
-00006780: 7220 6772 6f75 702e 2044 6566 6175 6c74  r group. Default
-00006790: 2076 616c 7565 2069 7320 312e 0a20 2020   value is 1..   
-000067a0: 2020 2020 203a 7061 7261 6d20 7061 7274       :param part
-000067b0: 6974 696f 6e5f 736f 7274 5f62 793a 2057  ition_sort_by: W
-000067c0: 6861 7420 6669 656c 6420 746f 2073 6f72  hat field to sor
-000067d0: 7420 7468 6520 7265 7375 6c74 7320 6279  t the results by
-000067e0: 2c20 7769 7468 696e 2065 6163 6820 7061  , within each pa
-000067f0: 7274 6974 696f 6e20 6465 6669 6e65 6420  rtition defined 
-00006800: 6279 2060 7061 7274 6974 696f 6e5f 6279  by `partition_by
-00006810: 602e 0a20 2020 2020 2020 2020 2020 2043  `..            C
-00006820: 7572 7265 6e74 6c79 2074 6865 206f 6e6c  urrently the onl
-00006830: 7920 616c 6c6f 7765 6420 7661 6c75 6573  y allowed values
-00006840: 2061 7265 2060 6372 6561 7465 6460 2061   are `created` a
-00006850: 6e64 2060 7570 6461 7465 6460 2e0a 2020  nd `updated`..  
-00006860: 2020 2020 2020 3a70 6172 616d 2070 6172        :param par
-00006870: 7469 7469 6f6e 5f6f 7264 6572 3a20 4f72  tition_order: Or
-00006880: 6465 7220 6f66 2073 6f72 7469 6e67 2077  der of sorting w
-00006890: 6974 6869 6e20 7061 7274 6974 696f 6e73  ithin partitions
-000068a0: 202d 2060 6173 6360 206f 7220 6064 6573   - `asc` or `des
-000068b0: 6360 2e20 4465 6661 756c 7420 6973 2060  c`. Default is `
-000068c0: 6465 7363 602e 0a20 2020 2020 2020 203a  desc`..        :
-000068d0: 7061 7261 6d20 6d61 785f 7061 7274 6974  param max_partit
-000068e0: 696f 6e73 3a20 4d61 7869 6d61 6c20 6e75  ions: Maximal nu
-000068f0: 6d62 6572 206f 6620 7061 7274 6974 696f  mber of partitio
-00006900: 6e73 2074 6f20 696e 636c 7564 6520 696e  ns to include in
-00006910: 2074 6865 2072 6573 756c 742e 2044 6566   the result. Def
-00006920: 6175 6c74 2069 7320 6030 6020 7768 6963  ault is `0` whic
-00006930: 6820 6d65 616e 7320 6e6f 0a20 2020 2020  h means no.     
-00006940: 2020 2020 2020 206c 696d 6974 2e0a 2020         limit..  
-00006950: 2020 2020 2020 3a70 6172 616d 2077 6974        :param wit
-00006960: 685f 6e6f 7469 6669 6361 7469 6f6e 733a  h_notifications:
-00006970: 2052 6574 7572 6e20 7275 6e73 2077 6974   Return runs wit
-00006980: 6820 6e6f 7469 6669 6361 7469 6f6e 732c  h notifications,
-00006990: 2061 6e64 206a 6f69 6e20 7468 656d 2074   and join them t
-000069a0: 6f20 7468 6520 7265 7370 6f6e 7365 2e20  o the response. 
-000069b0: 4465 6661 756c 7420 6973 2060 4661 6c73  Default is `Fals
-000069c0: 6560 2e0a 2020 2020 2020 2020 2222 220a  e`..        """.
-000069d0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-000069e0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-000069f0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00006a00: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
-00006a10: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
-00006a20: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
-00006a30: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
-00006a40: 6964 223a 2075 6964 2c0a 2020 2020 2020  id": uid,.      
-00006a50: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
-00006a60: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
-00006a70: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-00006a80: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-00006a90: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
-00006aa0: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-00006ab0: 2020 2020 2022 736f 7274 223a 2062 6f6f       "sort": boo
-00006ac0: 6c32 7374 7228 736f 7274 292c 0a20 2020  l2str(sort),.   
-00006ad0: 2020 2020 2020 2020 2022 6974 6572 223a           "iter":
-00006ae0: 2062 6f6f 6c32 7374 7228 6974 6572 292c   bool2str(iter),
-00006af0: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
-00006b00: 6172 745f 7469 6d65 5f66 726f 6d22 3a20  art_time_from": 
-00006b10: 6461 7465 7469 6d65 5f74 6f5f 6973 6f28  datetime_to_iso(
-00006b20: 7374 6172 745f 7469 6d65 5f66 726f 6d29  start_time_from)
-00006b30: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-00006b40: 7461 7274 5f74 696d 655f 746f 223a 2064  tart_time_to": d
-00006b50: 6174 6574 696d 655f 746f 5f69 736f 2873  atetime_to_iso(s
-00006b60: 7461 7274 5f74 696d 655f 746f 292c 0a20  tart_time_to),. 
-00006b70: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
-00006b80: 5f75 7064 6174 655f 7469 6d65 5f66 726f  _update_time_fro
-00006b90: 6d22 3a20 6461 7465 7469 6d65 5f74 6f5f  m": datetime_to_
-00006ba0: 6973 6f28 6c61 7374 5f75 7064 6174 655f  iso(last_update_
-00006bb0: 7469 6d65 5f66 726f 6d29 2c0a 2020 2020  time_from),.    
-00006bc0: 2020 2020 2020 2020 226c 6173 745f 7570          "last_up
-00006bd0: 6461 7465 5f74 696d 655f 746f 223a 2064  date_time_to": d
-00006be0: 6174 6574 696d 655f 746f 5f69 736f 286c  atetime_to_iso(l
-00006bf0: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
-00006c00: 746f 292c 0a20 2020 2020 2020 2020 2020  to),.           
-00006c10: 2022 7769 7468 2d6e 6f74 6966 6963 6174   "with-notificat
-00006c20: 696f 6e73 223a 2077 6974 685f 6e6f 7469  ions": with_noti
-00006c30: 6669 6361 7469 6f6e 732c 0a20 2020 2020  fications,.     
-00006c40: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
-00006c50: 2070 6172 7469 7469 6f6e 5f62 793a 0a20   partition_by:. 
-00006c60: 2020 2020 2020 2020 2020 2070 6172 616d             param
-00006c70: 732e 7570 6461 7465 280a 2020 2020 2020  s.update(.      
-00006c80: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
-00006c90: 6765 6e65 7261 7465 5f70 6172 7469 7469  generate_partiti
-00006ca0: 6f6e 5f62 795f 7061 7261 6d73 280a 2020  on_by_params(.  
-00006cb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006cc0: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
-00006cd0: 6368 656d 6173 2e52 756e 5061 7274 6974  chemas.RunPartit
-00006ce0: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
-00006cf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d00: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
-00006d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d20: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
-00006d30: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
-00006d40: 2020 2020 2020 2020 2020 7061 7274 6974            partit
-00006d50: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
-00006d60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00006d70: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00006d80: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00006d90: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
-00006da0: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
-00006db0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00006dc0: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
-00006dd0: 726f 7220 3d20 226c 6973 7420 7275 6e73  ror = "list runs
-00006de0: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
-00006df0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00006e00: 4745 5422 2c20 2272 756e 7322 2c20 6572  GET", "runs", er
-00006e10: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
-00006e20: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
-00006e30: 726e 2052 756e 4c69 7374 2872 6573 702e  rn RunList(resp.
-00006e40: 6a73 6f6e 2829 5b22 7275 6e73 225d 290a  json()["runs"]).
-00006e50: 0a20 2020 2064 6566 2064 656c 5f72 756e  .    def del_run
-00006e60: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
-00006e70: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
-00006e80: 206c 6162 656c 733d 4e6f 6e65 2c20 7374   labels=None, st
-00006e90: 6174 653d 4e6f 6e65 2c20 6461 7973 5f61  ate=None, days_a
-00006ea0: 676f 3d30 293a 0a20 2020 2020 2020 2022  go=0):.        "
-00006eb0: 2222 4465 6c65 7465 2061 2067 726f 7570  ""Delete a group
-00006ec0: 206f 6620 7275 6e73 2069 6465 6e74 6966   of runs identif
-00006ed0: 6965 6420 6279 2074 6865 2070 6172 616d  ied by the param
-00006ee0: 6574 6572 7320 6f66 2074 6865 2066 756e  eters of the fun
-00006ef0: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
-00006f00: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
-00006f10: 2020 2020 2020 2064 622e 6465 6c5f 7275         db.del_ru
-00006f20: 6e73 2873 7461 7465 3d27 636f 6d70 6c65  ns(state='comple
-00006f30: 7465 6427 290a 0a20 2020 2020 2020 203a  ted')..        :
-00006f40: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
-00006f50: 206f 6620 7468 6520 7461 736b 2077 6869   of the task whi
-00006f60: 6368 2074 6865 2072 756e 7320 6265 6c6f  ch the runs belo
-00006f70: 6e67 2074 6f2e 0a20 2020 2020 2020 203a  ng to..        :
-00006f80: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00006f90: 726f 6a65 6374 2074 6f20 7768 6963 6820  roject to which 
-00006fa0: 7468 6520 7275 6e73 2062 656c 6f6e 672e  the runs belong.
-00006fb0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00006fc0: 6c61 6265 6c73 3a20 4669 6c74 6572 2072  labels: Filter r
-00006fd0: 756e 7320 7468 6174 2061 7265 206c 6162  uns that are lab
-00006fe0: 656c 6564 2075 7369 6e67 2074 6865 7365  eled using these
-00006ff0: 2073 7065 6369 6669 6320 6c61 6265 6c20   specific label 
-00007000: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
-00007010: 3a70 6172 616d 2073 7461 7465 3a20 4669  :param state: Fi
-00007020: 6c74 6572 206f 6e6c 7920 7275 6e73 2077  lter only runs w
-00007030: 6869 6368 2061 7265 2069 6e20 7468 6973  hich are in this
-00007040: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
-00007050: 3a70 6172 616d 2064 6179 735f 6167 6f3a  :param days_ago:
-00007060: 2046 696c 7465 7220 7275 6e73 2077 686f   Filter runs who
-00007070: 7365 2073 7461 7274 2074 696d 6520 6973  se start time is
-00007080: 206e 6577 6572 2074 6861 6e20 7468 6973   newer than this
-00007090: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
-000070a0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-000070b0: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-000070c0: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-000070d0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-000070e0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-000070f0: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00007100: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
-00007110: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
-00007120: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
-00007130: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
-00007140: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
-00007150: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
-00007160: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
-00007170: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
-00007180: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
-00007190: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000071a0: 2020 6572 726f 7220 3d20 2264 656c 2072    error = "del r
-000071b0: 756e 7322 0a20 2020 2020 2020 2073 656c  uns".        sel
-000071c0: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
-000071d0: 5445 222c 2022 7275 6e73 222c 2065 7272  TE", "runs", err
-000071e0: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
-000071f0: 7329 0a0a 2020 2020 6465 6620 7374 6f72  s)..    def stor
-00007200: 655f 6172 7469 6661 6374 2873 656c 662c  e_artifact(self,
-00007210: 206b 6579 2c20 6172 7469 6661 6374 2c20   key, artifact, 
-00007220: 7569 642c 2069 7465 723d 4e6f 6e65 2c20  uid, iter=None, 
-00007230: 7461 673d 4e6f 6e65 2c20 7072 6f6a 6563  tag=None, projec
-00007240: 743d 2222 293a 0a20 2020 2020 2020 2022  t=""):.        "
-00007250: 2222 5374 6f72 6520 616e 2061 7274 6966  ""Store an artif
-00007260: 6163 7420 696e 2074 6865 2044 422e 0a0a  act in the DB...
-00007270: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
-00007280: 6579 3a20 4964 656e 7469 6679 696e 6720  ey: Identifying 
-00007290: 6b65 7920 6f66 2074 6865 2061 7274 6966  key of the artif
-000072a0: 6163 742e 0a20 2020 2020 2020 203a 7061  act..        :pa
-000072b0: 7261 6d20 6172 7469 6661 6374 3a20 5468  ram artifact: Th
-000072c0: 6520 6163 7475 616c 2061 7274 6966 6163  e actual artifac
-000072d0: 7420 746f 2073 746f 7265 2e0a 2020 2020  t to store..    
-000072e0: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
-000072f0: 4120 756e 6971 7565 2049 4420 666f 7220  A unique ID for 
-00007300: 7468 6973 2073 7065 6369 6669 6320 7665  this specific ve
-00007310: 7273 696f 6e20 6f66 2074 6865 2061 7274  rsion of the art
-00007320: 6966 6163 742e 0a20 2020 2020 2020 203a  ifact..        :
-00007330: 7061 7261 6d20 6974 6572 3a20 5468 6520  param iter: The 
-00007340: 7461 736b 2069 7465 7261 7469 6f6e 2077  task iteration w
-00007350: 6869 6368 2067 656e 6572 6174 6564 2074  hich generated t
-00007360: 6869 7320 6172 7469 6661 6374 2e20 4966  his artifact. If
-00007370: 2060 6069 7465 7260 6020 6973 206e 6f74   ``iter`` is not
-00007380: 2060 604e 6f6e 6560 6020 7468 6520 6974   ``None`` the it
-00007390: 6572 6174 696f 6e20 7769 6c6c 0a20 2020  eration will.   
-000073a0: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
-000073b0: 6420 746f 2074 6865 206b 6579 2070 726f  d to the key pro
-000073c0: 7669 6465 6420 746f 2067 656e 6572 6174  vided to generat
-000073d0: 6520 6120 756e 6971 7565 206b 6579 2066  e a unique key f
-000073e0: 6f72 2074 6865 2061 7274 6966 6163 7420  or the artifact 
-000073f0: 6f66 2074 6865 2073 7065 6369 6669 6320  of the specific 
-00007400: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
-00007410: 2020 203a 7061 7261 6d20 7461 673a 2054     :param tag: T
-00007420: 6167 206f 6620 7468 6520 6172 7469 6661  ag of the artifa
-00007430: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
-00007440: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00007450: 6563 7420 7468 6174 2074 6865 2061 7274  ect that the art
-00007460: 6966 6163 7420 6265 6c6f 6e67 7320 746f  ifact belongs to
-00007470: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00007480: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
-00007490: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-000074a0: 732f 7b70 726f 6a65 6374 7d2f 6172 7469  s/{project}/arti
-000074b0: 6661 6374 732f 7b75 6964 7d2f 7b6b 6579  facts/{uid}/{key
-000074c0: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
-000074d0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-000074e0: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
-000074f0: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
-00007500: 6966 2069 7465 723a 0a20 2020 2020 2020  if iter:.       
-00007510: 2020 2020 2070 6172 616d 735b 2269 7465       params["ite
-00007520: 7222 5d20 3d20 7374 7228 6974 6572 290a  r"] = str(iter).
-00007530: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-00007540: 2066 2273 746f 7265 2061 7274 6966 6163   f"store artifac
-00007550: 7420 7b70 726f 6a65 6374 7d2f 7b75 6964  t {project}/{uid
-00007560: 7d2f 7b6b 6579 7d22 0a0a 2020 2020 2020  }/{key}"..      
-00007570: 2020 626f 6479 203d 205f 6173 5f6a 736f    body = _as_jso
-00007580: 6e28 6172 7469 6661 6374 290a 2020 2020  n(artifact).    
-00007590: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
-000075a0: 6c28 2250 4f53 5422 2c20 656e 6470 6f69  l("POST", endpoi
-000075b0: 6e74 5f70 6174 682c 2065 7272 6f72 2c20  nt_path, error, 
-000075c0: 7061 7261 6d73 3d70 6172 616d 732c 2062  params=params, b
-000075d0: 6f64 793d 626f 6479 290a 0a20 2020 2064  ody=body)..    d
-000075e0: 6566 2072 6561 645f 6172 7469 6661 6374  ef read_artifact
-000075f0: 2873 656c 662c 206b 6579 2c20 7461 673d  (self, key, tag=
-00007600: 4e6f 6e65 2c20 6974 6572 3d4e 6f6e 652c  None, iter=None,
-00007610: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
-00007620: 2020 2020 2020 2222 2252 6561 6420 616e        """Read an
-00007630: 2061 7274 6966 6163 742c 2069 6465 6e74   artifact, ident
-00007640: 6966 6965 6420 6279 2069 7473 206b 6579  ified by its key
-00007650: 2c20 7461 6720 616e 6420 6974 6572 6174  , tag and iterat
-00007660: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
-00007670: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00007680: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00007690: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-000076a0: 2020 2020 2074 6167 203d 2074 6167 206f       tag = tag o
-000076b0: 7220 226c 6174 6573 7422 0a20 2020 2020  r "latest".     
-000076c0: 2020 2065 6e64 706f 696e 745f 7061 7468     endpoint_path
-000076d0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-000076e0: 726f 6a65 6374 7d2f 6172 7469 6661 6374  roject}/artifact
-000076f0: 732f 7b6b 6579 7d3f 7461 673d 7b74 6167  s/{key}?tag={tag
-00007700: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-00007710: 203d 2066 2272 6561 6420 6172 7469 6661   = f"read artifa
-00007720: 6374 207b 7072 6f6a 6563 747d 2f7b 6b65  ct {project}/{ke
-00007730: 797d 220a 2020 2020 2020 2020 2320 6578  y}".        # ex
-00007740: 706c 6963 6974 6c79 2073 6574 2061 7274  plicitly set art
-00007750: 6966 6163 7473 2066 6f72 6d61 7420 746f  ifacts format to
-00007760: 2027 6675 6c6c 2720 7369 6e63 6520 6f6c   'full' since ol
-00007770: 6420 7365 7276 6572 7320 6d61 7920 6465  d servers may de
-00007780: 6661 756c 7420 746f 2027 6c65 6761 6379  fault to 'legacy
-00007790: 270a 2020 2020 2020 2020 7061 7261 6d73  '.        params
-000077a0: 203d 207b 2266 6f72 6d61 7422 3a20 6d6c   = {"format": ml
-000077b0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-000077c0: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
-000077d0: 6174 2e66 756c 6c2e 7661 6c75 657d 0a20  at.full.value}. 
-000077e0: 2020 2020 2020 2069 6620 6974 6572 3a0a         if iter:.
-000077f0: 2020 2020 2020 2020 2020 2020 7061 7261              para
-00007800: 6d73 5b22 6974 6572 225d 203d 2073 7472  ms["iter"] = str
-00007810: 2869 7465 7229 0a20 2020 2020 2020 2072  (iter).        r
-00007820: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
-00007830: 616c 6c28 2247 4554 222c 2065 6e64 706f  all("GET", endpo
-00007840: 696e 745f 7061 7468 2c20 6572 726f 722c  int_path, error,
-00007850: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
-00007860: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00007870: 6573 702e 6a73 6f6e 2829 5b22 6461 7461  esp.json()["data
-00007880: 225d 0a0a 2020 2020 6465 6620 6465 6c5f  "]..    def del_
-00007890: 6172 7469 6661 6374 2873 656c 662c 206b  artifact(self, k
-000078a0: 6579 2c20 7461 673d 4e6f 6e65 2c20 7072  ey, tag=None, pr
-000078b0: 6f6a 6563 743d 2222 293a 0a20 2020 2020  oject=""):.     
-000078c0: 2020 2022 2222 4465 6c65 7465 2061 6e20     """Delete an 
-000078d0: 6172 7469 6661 6374 2e22 2222 0a0a 2020  artifact."""..  
-000078e0: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
-000078f0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
-00007900: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
-00007910: 6163 7473 2f7b 6b65 797d 220a 2020 2020  acts/{key}".    
-00007920: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-00007930: 2020 2020 2020 2020 2020 2022 6b65 7922             "key"
-00007940: 3a20 6b65 792c 0a20 2020 2020 2020 2020  : key,.         
-00007950: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
-00007960: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-00007970: 2065 7272 6f72 203d 2066 2264 656c 2061   error = f"del a
-00007980: 7274 6966 6163 7420 7b70 726f 6a65 6374  rtifact {project
-00007990: 7d2f 7b6b 6579 7d22 0a20 2020 2020 2020  }/{key}".       
-000079a0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-000079b0: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
-000079c0: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
-000079d0: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
-000079e0: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
-000079f0: 6661 6374 7328 0a20 2020 2020 2020 2073  facts(.        s
-00007a00: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
-00007a10: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
-00007a20: 7072 6f6a 6563 743d 4e6f 6e65 2c0a 2020  project=None,.  
-00007a30: 2020 2020 2020 7461 673d 4e6f 6e65 2c0a        tag=None,.
-00007a40: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
-00007a50: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b44  Optional[Union[D
-00007a60: 6963 745b 7374 722c 2073 7472 5d2c 204c  ict[str, str], L
-00007a70: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
-00007a80: 652c 0a20 2020 2020 2020 2073 696e 6365  e,.        since
-00007a90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
-00007aa0: 6e74 696c 3d4e 6f6e 652c 0a20 2020 2020  ntil=None,.     
-00007ab0: 2020 2069 7465 723a 2069 6e74 203d 204e     iter: int = N
-00007ac0: 6f6e 652c 0a20 2020 2020 2020 2062 6573  one,.        bes
-00007ad0: 745f 6974 6572 6174 696f 6e3a 2062 6f6f  t_iteration: boo
-00007ae0: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
-00007af0: 2020 206b 696e 643a 2073 7472 203d 204e     kind: str = N
-00007b00: 6f6e 652c 0a20 2020 2020 2020 2063 6174  one,.        cat
-00007b10: 6567 6f72 793a 2055 6e69 6f6e 5b73 7472  egory: Union[str
-00007b20: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-00007b30: 6368 656d 6173 2e41 7274 6966 6163 7443  chemas.ArtifactC
-00007b40: 6174 6567 6f72 6965 735d 203d 204e 6f6e  ategories] = Non
-00007b50: 652c 0a20 2020 2029 202d 3e20 4172 7469  e,.    ) -> Arti
-00007b60: 6661 6374 4c69 7374 3a0a 2020 2020 2020  factList:.      
-00007b70: 2020 2222 224c 6973 7420 6172 7469 6661    """List artifa
-00007b80: 6374 7320 6669 6c74 6572 6564 2062 7920  cts filtered by 
-00007b90: 7661 7269 6f75 7320 7061 7261 6d65 7465  various paramete
-00007ba0: 7273 2e0a 0a20 2020 2020 2020 2045 7861  rs...        Exa
-00007bb0: 6d70 6c65 733a 3a0a 0a20 2020 2020 2020  mples::..       
-00007bc0: 2020 2020 2023 2053 686f 7720 6c61 7465       # Show late
-00007bd0: 7374 2076 6572 7369 6f6e 206f 6620 616c  st version of al
-00007be0: 6c20 6172 7469 6661 6374 7320 696e 2070  l artifacts in p
-00007bf0: 726f 6a65 6374 0a20 2020 2020 2020 2020  roject.         
-00007c00: 2020 206c 6174 6573 745f 6172 7469 6661     latest_artifa
-00007c10: 6374 7320 3d20 6462 2e6c 6973 745f 6172  cts = db.list_ar
-00007c20: 7469 6661 6374 7328 2727 2c20 7461 673d  tifacts('', tag=
-00007c30: 276c 6174 6573 7427 2c20 7072 6f6a 6563  'latest', projec
-00007c40: 743d 2769 7269 7327 290a 2020 2020 2020  t='iris').      
-00007c50: 2020 2020 2020 2320 6368 6563 6b20 6469        # check di
-00007c60: 6666 6572 656e 7420 6172 7469 6661 6374  fferent artifact
-00007c70: 2076 6572 7369 6f6e 7320 666f 7220 6120   versions for a 
-00007c80: 7370 6563 6966 6963 2061 7274 6966 6163  specific artifac
-00007c90: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
-00007ca0: 7375 6c74 5f76 6572 7369 6f6e 7320 3d20  sult_versions = 
-00007cb0: 6462 2e6c 6973 745f 6172 7469 6661 6374  db.list_artifact
-00007cc0: 7328 2772 6573 756c 7473 272c 2074 6167  s('results', tag
-00007cd0: 3d27 2a27 2c20 7072 6f6a 6563 743d 2769  ='*', project='i
-00007ce0: 7269 7327 290a 2020 2020 2020 2020 2020  ris').          
-00007cf0: 2020 2320 5368 6f77 2061 7274 6966 6163    # Show artifac
-00007d00: 7473 2077 6974 6820 6c61 6265 6c20 6669  ts with label fi
-00007d10: 6c74 6572 7320 2d20 626f 7468 2075 706c  lters - both upl
-00007d20: 6f61 6465 6420 616e 6420 6f66 2062 696e  oaded and of bin
-00007d30: 6172 7920 7479 7065 0a20 2020 2020 2020  ary type.       
-00007d40: 2020 2020 2072 6573 756c 745f 6c61 6265       result_labe
-00007d50: 6c73 203d 2064 622e 6c69 7374 5f61 7274  ls = db.list_art
-00007d60: 6966 6163 7473 2827 7265 7375 6c74 7327  ifacts('results'
-00007d70: 2c20 7461 673d 272a 272c 2070 726f 6a65  , tag='*', proje
-00007d80: 6374 3d27 6972 6973 272c 206c 6162 656c  ct='iris', label
-00007d90: 733d 5b27 7570 6c6f 6164 6564 272c 2027  s=['uploaded', '
-00007da0: 7479 7065 3d62 696e 6172 7927 5d29 0a0a  type=binary'])..
-00007db0: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
-00007dc0: 616d 653a 204e 616d 6520 6f66 2061 7274  ame: Name of art
-00007dd0: 6966 6163 7473 2074 6f20 7265 7472 6965  ifacts to retrie
-00007de0: 7665 2e20 4e61 6d65 2069 7320 7573 6564  ve. Name is used
-00007df0: 2061 7320 6120 6c69 6b65 2071 7565 7279   as a like query
-00007e00: 2c20 616e 6420 6973 206e 6f74 2063 6173  , and is not cas
-00007e10: 652d 7365 6e73 6974 6976 652e 2054 6869  e-sensitive. Thi
-00007e20: 7320 6d65 616e 730a 2020 2020 2020 2020  s means.        
-00007e30: 2020 2020 7468 6174 2071 7565 7279 696e      that queryin
-00007e40: 6720 666f 7220 6060 6e61 6d65 6060 206d  g for ``name`` m
-00007e50: 6179 2072 6574 7572 6e20 6172 7469 6661  ay return artifa
-00007e60: 6374 7320 6e61 6d65 6420 6060 6d79 5f4e  cts named ``my_N
-00007e70: 616d 655f 3160 6020 6f72 2060 6073 7572  ame_1`` or ``sur
-00007e80: 6e61 6d65 6060 2e0a 2020 2020 2020 2020  name``..        
-00007e90: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-00007ea0: 5072 6f6a 6563 7420 6e61 6d65 2e0a 2020  Project name..  
-00007eb0: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
-00007ec0: 3a20 5265 7475 726e 2061 7274 6966 6163  : Return artifac
-00007ed0: 7473 2061 7373 6967 6e65 6420 7468 6973  ts assigned this
-00007ee0: 2074 6167 2e0a 2020 2020 2020 2020 3a70   tag..        :p
-00007ef0: 6172 616d 206c 6162 656c 733a 2052 6574  aram labels: Ret
-00007f00: 7572 6e20 6172 7469 6661 6374 7320 7468  urn artifacts th
-00007f10: 6174 2068 6176 6520 7468 6573 6520 6c61  at have these la
-00007f20: 6265 6c73 2e20 4c61 6265 6c73 2063 616e  bels. Labels can
-00007f30: 2065 6974 6865 7220 6265 2061 2064 6963   either be a dic
-00007f40: 7469 6f6e 6172 7920 7b22 6c61 6265 6c22  tionary {"label"
-00007f50: 3a20 2276 616c 7565 227d 206f 720a 2020  : "value"} or.  
-00007f60: 2020 2020 2020 2020 2020 6120 6c69 7374            a list
-00007f70: 206f 6620 226c 6162 656c 3d76 616c 7565   of "label=value
-00007f80: 2220 286d 6174 6368 206c 6162 656c 206b  " (match label k
-00007f90: 6579 2061 6e64 2076 616c 7565 2920 6f72  ey and value) or
-00007fa0: 2022 6c61 6265 6c22 2028 6d61 7463 6820   "label" (match 
-00007fb0: 6a75 7374 206c 6162 656c 206b 6579 2920  just label key) 
-00007fc0: 7374 7269 6e67 732e 0a20 2020 2020 2020  strings..       
-00007fd0: 203a 7061 7261 6d20 7369 6e63 653a 204e   :param since: N
-00007fe0: 6f74 2069 6e20 7573 6520 696e 203a 7079  ot in use in :py
-00007ff0: 3a63 6c61 7373 3a60 4854 5450 5275 6e44  :class:`HTTPRunD
-00008000: 4260 2e0a 2020 2020 2020 2020 3a70 6172  B`..        :par
-00008010: 616d 2075 6e74 696c 3a20 4e6f 7420 696e  am until: Not in
-00008020: 2075 7365 2069 6e20 3a70 793a 636c 6173   use in :py:clas
-00008030: 733a 6048 5454 5052 756e 4442 602e 0a20  s:`HTTPRunDB`.. 
-00008040: 2020 2020 2020 203a 7061 7261 6d20 6974         :param it
-00008050: 6572 3a20 5265 7475 726e 2061 7274 6966  er: Return artif
-00008060: 6163 7473 2066 726f 6d20 6120 7370 6563  acts from a spec
-00008070: 6966 6963 2069 7465 7261 7469 6f6e 2028  ific iteration (
-00008080: 7768 6572 6520 6060 6974 6572 3d30 6060  where ``iter=0``
-00008090: 206d 6561 6e73 2074 6865 2072 6f6f 7420   means the root 
-000080a0: 6974 6572 6174 696f 6e29 2e20 4966 0a20  iteration). If. 
-000080b0: 2020 2020 2020 2020 2020 2060 604e 6f6e             ``Non
-000080c0: 6560 6020 2864 6566 6175 6c74 2920 7265  e`` (default) re
-000080d0: 7475 726e 2061 7274 6966 6163 7473 2066  turn artifacts f
-000080e0: 726f 6d20 616c 6c20 6974 6572 6174 696f  rom all iteratio
-000080f0: 6e73 2e0a 2020 2020 2020 2020 3a70 6172  ns..        :par
-00008100: 616d 2062 6573 745f 6974 6572 6174 696f  am best_iteratio
-00008110: 6e3a 2052 6574 7572 6e73 2074 6865 2061  n: Returns the a
-00008120: 7274 6966 6163 7420 7768 6963 6820 6265  rtifact which be
-00008130: 6c6f 6e67 7320 746f 2074 6865 2062 6573  longs to the bes
-00008140: 7420 6974 6572 6174 696f 6e20 6f66 2061  t iteration of a
-00008150: 2067 6976 656e 2072 756e 2c20 696e 2074   given run, in t
-00008160: 6865 2063 6173 6520 6f66 0a20 2020 2020  he case of.     
-00008170: 2020 2020 2020 2061 7274 6966 6163 7473         artifacts
-00008180: 2067 656e 6572 6174 6564 2066 726f 6d20   generated from 
-00008190: 6120 6879 7065 722d 7061 7261 6d20 7275  a hyper-param ru
-000081a0: 6e2e 2049 6620 6f6e 6c79 2061 2073 696e  n. If only a sin
-000081b0: 676c 6520 6974 6572 6174 696f 6e20 6578  gle iteration ex
-000081c0: 6973 7473 2c20 7769 6c6c 2072 6574 7572  ists, will retur
-000081d0: 6e20 7468 6520 6172 7469 6661 6374 0a20  n the artifact. 
-000081e0: 2020 2020 2020 2020 2020 2066 726f 6d20             from 
-000081f0: 7468 6174 2069 7465 7261 7469 6f6e 2e20  that iteration. 
-00008200: 4966 2075 7369 6e67 2060 6062 6573 745f  If using ``best_
-00008210: 6974 6572 6060 2c20 7468 6520 6060 6974  iter``, the ``it
-00008220: 6572 6060 2070 6172 616d 6574 6572 206d  er`` parameter m
-00008230: 7573 7420 6e6f 7420 6265 2075 7365 642e  ust not be used.
-00008240: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00008250: 6b69 6e64 3a20 5265 7475 726e 2061 7274  kind: Return art
-00008260: 6966 6163 7473 206f 6620 7468 6520 7265  ifacts of the re
-00008270: 7175 6573 7465 6420 6b69 6e64 2e0a 2020  quested kind..  
-00008280: 2020 2020 2020 3a70 6172 616d 2063 6174        :param cat
-00008290: 6567 6f72 793a 2052 6574 7572 6e20 6172  egory: Return ar
-000082a0: 7469 6661 6374 7320 6f66 2074 6865 2072  tifacts of the r
-000082b0: 6571 7565 7374 6564 2063 6174 6567 6f72  equested categor
-000082c0: 792e 0a20 2020 2020 2020 2022 2222 0a0a  y..        """..
-000082d0: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-000082e0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
-000082f0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-00008300: 6563 740a 0a20 2020 2020 2020 206c 6162  ect..        lab
-00008310: 656c 7320 3d20 6c61 6265 6c73 206f 7220  els = labels or 
-00008320: 5b5d 0a20 2020 2020 2020 2069 6620 6973  [].        if is
-00008330: 696e 7374 616e 6365 286c 6162 656c 732c  instance(labels,
-00008340: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
-00008350: 2020 2020 6c61 6265 6c73 203d 205b 6622      labels = [f"
-00008360: 7b6b 6579 7d3d 7b76 616c 7565 7d22 2066  {key}={value}" f
-00008370: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
-00008380: 206c 6162 656c 732e 6974 656d 7328 295d   labels.items()]
-00008390: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
-000083a0: 203d 207b 0a20 2020 2020 2020 2020 2020   = {.           
-000083b0: 2022 6e61 6d65 223a 206e 616d 652c 0a20   "name": name,. 
-000083c0: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-000083d0: 3a20 7461 672c 0a20 2020 2020 2020 2020  : tag,.         
-000083e0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
-000083f0: 6c73 2c0a 2020 2020 2020 2020 2020 2020  ls,.            
-00008400: 2269 7465 7222 3a20 6974 6572 2c0a 2020  "iter": iter,.  
-00008410: 2020 2020 2020 2020 2020 2262 6573 742d            "best-
-00008420: 6974 6572 6174 696f 6e22 3a20 6265 7374  iteration": best
-00008430: 5f69 7465 7261 7469 6f6e 2c0a 2020 2020  _iteration,.    
-00008440: 2020 2020 2020 2020 226b 696e 6422 3a20          "kind": 
-00008450: 6b69 6e64 2c0a 2020 2020 2020 2020 2020  kind,.          
-00008460: 2020 2263 6174 6567 6f72 7922 3a20 6361    "category": ca
-00008470: 7465 676f 7279 2c0a 2020 2020 2020 2020  tegory,.        
-00008480: 2020 2020 2266 6f72 6d61 7422 3a20 6d6c      "format": ml
-00008490: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-000084a0: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
-000084b0: 6174 2e66 756c 6c2e 7661 6c75 652c 0a20  at.full.value,. 
-000084c0: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
-000084d0: 2065 7272 6f72 203d 2022 6c69 7374 2061   error = "list a
-000084e0: 7274 6966 6163 7473 220a 2020 2020 2020  rtifacts".      
-000084f0: 2020 656e 6470 6f69 6e74 5f70 6174 6820    endpoint_path 
-00008500: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00008510: 6f6a 6563 747d 2f61 7274 6966 6163 7473  oject}/artifacts
-00008520: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
-00008530: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00008540: 4745 5422 2c20 656e 6470 6f69 6e74 5f70  GET", endpoint_p
-00008550: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
-00008560: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
-00008570: 2020 2076 616c 7565 7320 3d20 4172 7469     values = Arti
-00008580: 6661 6374 4c69 7374 2872 6573 702e 6a73  factList(resp.js
-00008590: 6f6e 2829 5b22 6172 7469 6661 6374 7322  on()["artifacts"
-000085a0: 5d29 0a20 2020 2020 2020 2076 616c 7565  ]).        value
-000085b0: 732e 7461 6720 3d20 7461 670a 2020 2020  s.tag = tag.    
-000085c0: 2020 2020 7265 7475 726e 2076 616c 7565      return value
-000085d0: 730a 0a20 2020 2064 6566 2064 656c 5f61  s..    def del_a
-000085e0: 7274 6966 6163 7473 2873 656c 662c 206e  rtifacts(self, n
-000085f0: 616d 653d 4e6f 6e65 2c20 7072 6f6a 6563  ame=None, projec
-00008600: 743d 4e6f 6e65 2c20 7461 673d 4e6f 6e65  t=None, tag=None
-00008610: 2c20 6c61 6265 6c73 3d4e 6f6e 652c 2064  , labels=None, d
-00008620: 6179 735f 6167 6f3d 3029 3a0a 2020 2020  ays_ago=0):.    
-00008630: 2020 2020 2222 2244 656c 6574 6520 6172      """Delete ar
-00008640: 7469 6661 6374 7320 7265 6665 7265 6e63  tifacts referenc
-00008650: 6564 2062 7920 7468 6520 7061 7261 6d65  ed by the parame
-00008660: 7465 7273 2e0a 0a20 2020 2020 2020 203a  ters...        :
-00008670: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
-00008680: 206f 6620 6172 7469 6661 6374 7320 746f   of artifacts to
-00008690: 2064 656c 6574 652e 204e 6f74 6520 7468   delete. Note th
-000086a0: 6174 2074 6869 7320 6973 2061 206c 696b  at this is a lik
-000086b0: 6520 7175 6572 792c 2061 6e64 2069 7320  e query, and is 
-000086c0: 6361 7365 2d69 6e73 656e 7369 7469 7665  case-insensitive
-000086d0: 2e20 5365 650a 2020 2020 2020 2020 2020  . See.          
-000086e0: 2020 3a70 793a 6675 6e63 3a60 7e6c 6973    :py:func:`~lis
-000086f0: 745f 6172 7469 6661 6374 7360 2066 6f72  t_artifacts` for
-00008700: 206d 6f72 6520 6465 7461 696c 732e 0a20   more details.. 
-00008710: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-00008720: 6f6a 6563 743a 2050 726f 6a65 6374 2074  oject: Project t
-00008730: 6861 7420 6172 7469 6661 6374 7320 6265  hat artifacts be
-00008740: 6c6f 6e67 2074 6f2e 0a20 2020 2020 2020  long to..       
-00008750: 203a 7061 7261 6d20 7461 673a 2043 686f   :param tag: Cho
-00008760: 6f73 6520 6172 7469 6661 6374 7320 7768  ose artifacts wh
-00008770: 6f20 6172 6520 6173 7369 676e 6564 2074  o are assigned t
-00008780: 6869 7320 7461 672e 0a20 2020 2020 2020  his tag..       
-00008790: 203a 7061 7261 6d20 6c61 6265 6c73 3a20   :param labels: 
-000087a0: 4368 6f6f 7365 2061 7274 6966 6163 7473  Choose artifacts
-000087b0: 2077 6869 6368 2061 7265 206c 6162 656c   which are label
-000087c0: 6564 2e0a 2020 2020 2020 2020 3a70 6172  ed..        :par
-000087d0: 616d 2064 6179 735f 6167 6f3a 2054 6869  am days_ago: Thi
-000087e0: 7320 7061 7261 6d65 7465 7220 6973 2064  s parameter is d
-000087f0: 6570 7265 6361 7465 6420 616e 6420 6e6f  eprecated and no
-00008800: 7420 7573 6564 2e0a 2020 2020 2020 2020  t used..        
-00008810: 2222 220a 2020 2020 2020 2020 7072 6f6a  """.        proj
-00008820: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
-00008830: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00008840: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-00008850: 7061 7261 6d73 203d 207b 0a20 2020 2020  params = {.     
-00008860: 2020 2020 2020 2022 6e61 6d65 223a 206e         "name": n
-00008870: 616d 652c 0a20 2020 2020 2020 2020 2020  ame,.           
-00008880: 2022 7461 6722 3a20 7461 672c 0a20 2020   "tag": tag,.   
-00008890: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
-000088a0: 3a20 6c61 6265 6c73 206f 7220 5b5d 2c0a  : labels or [],.
-000088b0: 2020 2020 2020 2020 2020 2020 2264 6179              "day
-000088c0: 735f 6167 6f22 3a20 7374 7228 6461 7973  s_ago": str(days
-000088d0: 5f61 676f 292c 0a20 2020 2020 2020 207d  _ago),.        }
-000088e0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
-000088f0: 2022 6465 6c20 6172 7469 6661 6374 7322   "del artifacts"
-00008900: 0a20 2020 2020 2020 2065 6e64 706f 696e  .        endpoin
-00008910: 745f 7061 7468 203d 2066 2270 726f 6a65  t_path = f"proje
-00008920: 6374 732f 7b70 726f 6a65 6374 7d2f 6172  cts/{project}/ar
-00008930: 7469 6661 6374 7322 0a20 2020 2020 2020  tifacts".       
-00008940: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-00008950: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
-00008960: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
-00008970: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
-00008980: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
-00008990: 6661 6374 5f74 6167 7328 0a20 2020 2020  fact_tags(.     
-000089a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000089b0: 2070 726f 6a65 6374 3d4e 6f6e 652c 0a20   project=None,. 
-000089c0: 2020 2020 2020 2063 6174 6567 6f72 793a         category:
-000089d0: 2055 6e69 6f6e 5b73 7472 2c20 6d6c 7275   Union[str, mlru
-000089e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000089f0: 2e41 7274 6966 6163 7443 6174 6567 6f72  .ArtifactCategor
-00008a00: 6965 735d 203d 204e 6f6e 652c 0a20 2020  ies] = None,.   
-00008a10: 2029 202d 3e20 4c69 7374 5b73 7472 5d3a   ) -> List[str]:
-00008a20: 0a20 2020 2020 2020 2022 2222 5265 7475  .        """Retu
-00008a30: 726e 2061 206c 6973 7420 6f66 2061 6c6c  rn a list of all
-00008a40: 2074 6865 2074 6167 7320 6173 7369 676e   the tags assign
-00008a50: 6564 2074 6f20 6172 7469 6661 6374 7320  ed to artifacts 
-00008a60: 696e 2074 6865 2073 636f 7065 206f 6620  in the scope of 
-00008a70: 7468 6520 6769 7665 6e20 7072 6f6a 6563  the given projec
-00008a80: 742e 2222 220a 0a20 2020 2020 2020 2070  t."""..        p
-00008a90: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-00008aa0: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-00008ab0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-00008ac0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
-00008ad0: 203d 2066 2246 6169 6c65 6420 6c69 7374   = f"Failed list
-00008ae0: 696e 6720 6172 7469 6661 6374 2074 6167  ing artifact tag
-00008af0: 732e 2070 726f 6a65 6374 3d7b 7072 6f6a  s. project={proj
-00008b00: 6563 747d 220a 2020 2020 2020 2020 7061  ect}".        pa
-00008b10: 7261 6d73 203d 207b 2263 6174 6567 6f72  rams = {"categor
-00008b20: 7922 3a20 6361 7465 676f 7279 7d20 6966  y": category} if
-00008b30: 2063 6174 6567 6f72 7920 656c 7365 207b   category else {
-00008b40: 7d0a 0a20 2020 2020 2020 2072 6573 706f  }..        respo
-00008b50: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-00008b60: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-00008b70: 2022 4745 5422 2c20 6622 7072 6f6a 6563   "GET", f"projec
-00008b80: 7473 2f7b 7072 6f6a 6563 747d 2f61 7274  ts/{project}/art
-00008b90: 6966 6163 742d 7461 6773 222c 2065 7272  ifact-tags", err
-00008ba0: 6f72 5f6d 6573 7361 6765 2c20 7061 7261  or_message, para
-00008bb0: 6d73 3d70 6172 616d 730a 2020 2020 2020  ms=params.      
-00008bc0: 2020 290a 2020 2020 2020 2020 7265 7475    ).        retu
-00008bd0: 726e 2072 6573 706f 6e73 652e 6a73 6f6e  rn response.json
-00008be0: 2829 5b22 7461 6773 225d 0a0a 2020 2020  ()["tags"]..    
-00008bf0: 6465 6620 7374 6f72 655f 6675 6e63 7469  def store_functi
-00008c00: 6f6e 280a 2020 2020 2020 2020 7365 6c66  on(.        self
-00008c10: 2c0a 2020 2020 2020 2020 6675 6e63 7469  ,.        functi
-00008c20: 6f6e 3a20 7479 7069 6e67 2e55 6e69 6f6e  on: typing.Union
-00008c30: 5b6d 6c72 756e 2e72 756e 7469 6d65 732e  [mlrun.runtimes.
-00008c40: 4261 7365 5275 6e74 696d 652c 2064 6963  BaseRuntime, dic
-00008c50: 745d 2c0a 2020 2020 2020 2020 6e61 6d65  t],.        name
-00008c60: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00008c70: 743d 2222 2c0a 2020 2020 2020 2020 7461  t="",.        ta
-00008c80: 673d 4e6f 6e65 2c0a 2020 2020 2020 2020  g=None,.        
-00008c90: 7665 7273 696f 6e65 643d 4661 6c73 652c  versioned=False,
-00008ca0: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-00008cb0: 2222 2253 746f 7265 2061 2066 756e 6374  """Store a funct
-00008cc0: 696f 6e20 6f62 6a65 6374 2e20 4675 6e63  ion object. Func
-00008cd0: 7469 6f6e 2069 7320 6964 656e 7469 6669  tion is identifi
-00008ce0: 6564 2062 7920 6974 7320 6e61 6d65 2061  ed by its name a
-00008cf0: 6e64 2074 6167 2c20 616e 6420 6361 6e20  nd tag, and can 
-00008d00: 6265 2076 6572 7369 6f6e 6564 2e22 2222  be versioned."""
-00008d10: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-00008d20: 6d6c 7275 6e2e 7574 696c 732e 6e6f 726d  mlrun.utils.norm
-00008d30: 616c 697a 655f 6e61 6d65 286e 616d 6529  alize_name(name)
-00008d40: 0a20 2020 2020 2020 2069 6620 6861 7361  .        if hasa
-00008d50: 7474 7228 6675 6e63 7469 6f6e 2c20 2274  ttr(function, "t
-00008d60: 6f5f 6469 6374 2229 3a0a 2020 2020 2020  o_dict"):.      
-00008d70: 2020 2020 2020 6675 6e63 7469 6f6e 203d        function =
-00008d80: 2066 756e 6374 696f 6e2e 746f 5f64 6963   function.to_dic
-00008d90: 7428 290a 0a20 2020 2020 2020 2070 6172  t()..        par
-00008da0: 616d 7320 3d20 7b22 7461 6722 3a20 7461  ams = {"tag": ta
-00008db0: 672c 2022 7665 7273 696f 6e65 6422 3a20  g, "versioned": 
-00008dc0: 7665 7273 696f 6e65 647d 0a20 2020 2020  versioned}.     
-00008dd0: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
-00008de0: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
-00008df0: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
-00008e00: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00008e10: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00008e20: 747d 2f66 756e 6374 696f 6e73 2f7b 6e61  t}/functions/{na
-00008e30: 6d65 7d22 0a0a 2020 2020 2020 2020 6572  me}"..        er
-00008e40: 726f 7220 3d20 6622 7374 6f72 6520 6675  ror = f"store fu
-00008e50: 6e63 7469 6f6e 207b 7072 6f6a 6563 747d  nction {project}
-00008e60: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-00008e70: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
-00008e80: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00008e90: 2020 2022 504f 5354 222c 2070 6174 682c     "POST", path,
-00008ea0: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
-00008eb0: 6172 616d 732c 2062 6f64 793d 6469 6374  arams, body=dict
-00008ec0: 5f74 6f5f 6a73 6f6e 2866 756e 6374 696f  _to_json(functio
-00008ed0: 6e29 0a20 2020 2020 2020 2029 0a0a 2020  n).        )..  
-00008ee0: 2020 2020 2020 2320 6861 7368 206b 6579        # hash key
-00008ef0: 206f 7074 696f 6e61 6c20 746f 2062 6520   optional to be 
-00008f00: 6261 636b 7761 7264 7320 636f 6d70 6174  backwards compat
-00008f10: 6962 6c65 2074 6f20 4150 4920 763c 302e  ible to API v<0.
-00008f20: 342e 3130 2069 6e20 7768 6963 6820 6974  4.10 in which it
-00008f30: 2077 6173 6e27 7420 696e 2074 6865 2072   wasn't in the r
-00008f40: 6573 706f 6e73 650a 2020 2020 2020 2020  esponse.        
-00008f50: 7265 7475 726e 2072 6573 702e 6a73 6f6e  return resp.json
-00008f60: 2829 2e67 6574 2822 6861 7368 5f6b 6579  ().get("hash_key
-00008f70: 2229 0a0a 2020 2020 6465 6620 6765 745f  ")..    def get_
-00008f80: 6675 6e63 7469 6f6e 2873 656c 662c 206e  function(self, n
-00008f90: 616d 652c 2070 726f 6a65 6374 3d22 222c  ame, project="",
-00008fa0: 2074 6167 3d4e 6f6e 652c 2068 6173 685f   tag=None, hash_
-00008fb0: 6b65 793d 2222 293a 0a20 2020 2020 2020  key=""):.       
-00008fc0: 2022 2222 5265 7472 6965 7665 2064 6574   """Retrieve det
-00008fd0: 6169 6c73 206f 6620 6120 7370 6563 6966  ails of a specif
-00008fe0: 6963 2066 756e 6374 696f 6e2c 2069 6465  ic function, ide
-00008ff0: 6e74 6966 6965 6420 6279 2069 7473 206e  ntified by its n
-00009000: 616d 6520 616e 6420 706f 7465 6e74 6961  ame and potentia
-00009010: 6c6c 7920 6120 7461 6720 6f72 2066 756e  lly a tag or fun
-00009020: 6374 696f 6e20 6861 7368 2e22 2222 0a0a  ction hash."""..
-00009030: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00009040: 207b 2274 6167 223a 2074 6167 2c20 2268   {"tag": tag, "h
-00009050: 6173 685f 6b65 7922 3a20 6861 7368 5f6b  ash_key": hash_k
-00009060: 6579 7d0a 2020 2020 2020 2020 7072 6f6a  ey}.        proj
-00009070: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
-00009080: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00009090: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-000090a0: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-000090b0: 732f 7b70 726f 6a65 6374 7d2f 6675 6e63  s/{project}/func
-000090c0: 7469 6f6e 732f 7b6e 616d 657d 220a 2020  tions/{name}".  
-000090d0: 2020 2020 2020 6572 726f 7220 3d20 6622        error = f"
-000090e0: 6765 7420 6675 6e63 7469 6f6e 207b 7072  get function {pr
-000090f0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-00009100: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00009110: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00009120: 222c 2070 6174 682c 2065 7272 6f72 2c20  ", path, error, 
-00009130: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
-00009140: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00009150: 7370 2e6a 736f 6e28 295b 2266 756e 6322  sp.json()["func"
-00009160: 5d0a 0a20 2020 2064 6566 2064 656c 6574  ]..    def delet
-00009170: 655f 6675 6e63 7469 6f6e 2873 656c 662c  e_function(self,
-00009180: 206e 616d 653a 2073 7472 2c20 7072 6f6a   name: str, proj
-00009190: 6563 743a 2073 7472 203d 2022 2229 3a0a  ect: str = ""):.
-000091a0: 2020 2020 2020 2020 2222 2244 656c 6574          """Delet
-000091b0: 6520 6120 6675 6e63 7469 6f6e 2062 656c  e a function bel
-000091c0: 6f6e 6769 6e67 2074 6f20 6120 7370 6563  onging to a spec
-000091d0: 6966 6963 2070 726f 6a65 6374 2e22 2222  ific project."""
-000091e0: 0a0a 2020 2020 2020 2020 7072 6f6a 6563  ..        projec
-000091f0: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
-00009200: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
-00009210: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
-00009220: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-00009230: 7b70 726f 6a65 6374 7d2f 6675 6e63 7469  {project}/functi
-00009240: 6f6e 732f 7b6e 616d 657d 220a 2020 2020  ons/{name}".    
-00009250: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
-00009260: 6520 3d20 6622 4661 696c 6564 2064 656c  e = f"Failed del
-00009270: 6574 696e 6720 6675 6e63 7469 6f6e 207b  eting function {
-00009280: 7072 6f6a 6563 747d 2f7b 6e61 6d65 7d22  project}/{name}"
-00009290: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-000092a0: 695f 6361 6c6c 2822 4445 4c45 5445 222c  i_call("DELETE",
-000092b0: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
-000092c0: 7361 6765 290a 0a20 2020 2064 6566 206c  sage)..    def l
-000092d0: 6973 745f 6675 6e63 7469 6f6e 7328 7365  ist_functions(se
-000092e0: 6c66 2c20 6e61 6d65 3d4e 6f6e 652c 2070  lf, name=None, p
-000092f0: 726f 6a65 6374 3d4e 6f6e 652c 2074 6167  roject=None, tag
-00009300: 3d4e 6f6e 652c 206c 6162 656c 733d 4e6f  =None, labels=No
-00009310: 6e65 293a 0a20 2020 2020 2020 2022 2222  ne):.        """
-00009320: 5265 7472 6965 7665 2061 206c 6973 7420  Retrieve a list 
-00009330: 6f66 2066 756e 6374 696f 6e73 2c20 6669  of functions, fi
-00009340: 6c74 6572 6564 2062 7920 7370 6563 6966  ltered by specif
-00009350: 6963 2063 7269 7465 7269 612e 0a0a 2020  ic criteria...  
-00009360: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
-00009370: 653a 2052 6574 7572 6e20 6f6e 6c79 2066  e: Return only f
-00009380: 756e 6374 696f 6e73 2077 6974 6820 6120  unctions with a 
-00009390: 7370 6563 6966 6963 206e 616d 652e 0a20  specific name.. 
-000093a0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-000093b0: 6f6a 6563 743a 2052 6574 7572 6e20 6675  oject: Return fu
-000093c0: 6e63 7469 6f6e 7320 6265 6c6f 6e67 696e  nctions belongin
-000093d0: 6720 746f 2074 6869 7320 7072 6f6a 6563  g to this projec
-000093e0: 742e 2049 6620 6e6f 7420 7370 6563 6966  t. If not specif
-000093f0: 6965 642c 2074 6865 2064 6566 6175 6c74  ied, the default
-00009400: 2070 726f 6a65 6374 2069 7320 7573 6564   project is used
-00009410: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00009420: 2074 6167 3a20 5265 7475 726e 2066 756e   tag: Return fun
-00009430: 6374 696f 6e20 7665 7273 696f 6e73 2077  ction versions w
-00009440: 6974 6820 7370 6563 6966 6963 2074 6167  ith specific tag
-00009450: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
-00009460: 6d20 6c61 6265 6c73 3a20 5265 7475 726e  m labels: Return
-00009470: 2066 756e 6374 696f 6e73 2074 6861 7420   functions that 
-00009480: 6861 7665 2073 7065 6369 6669 6320 6c61  have specific la
-00009490: 6265 6c73 2061 7373 6967 6e65 6420 746f  bels assigned to
-000094a0: 2074 6865 6d2e 0a20 2020 2020 2020 203a   them..        :
-000094b0: 7265 7475 726e 733a 204c 6973 7420 6f66  returns: List of
-000094c0: 2066 756e 6374 696f 6e20 6f62 6a65 6374   function object
-000094d0: 7320 2861 7320 6469 6374 696f 6e61 7279  s (as dictionary
-000094e0: 292e 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
-000094f0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-00009500: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
-00009510: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
-00009520: 6374 0a20 2020 2020 2020 2070 6172 616d  ct.        param
-00009530: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
-00009540: 2020 226e 616d 6522 3a20 6e61 6d65 2c0a    "name": name,.
-00009550: 2020 2020 2020 2020 2020 2020 2274 6167              "tag
-00009560: 223a 2074 6167 2c0a 2020 2020 2020 2020  ": tag,.        
-00009570: 2020 2020 226c 6162 656c 223a 206c 6162      "label": lab
-00009580: 656c 7320 6f72 205b 5d2c 0a20 2020 2020  els or [],.     
-00009590: 2020 207d 0a20 2020 2020 2020 2065 7272     }.        err
-000095a0: 6f72 203d 2022 6c69 7374 2066 756e 6374  or = "list funct
-000095b0: 696f 6e73 220a 2020 2020 2020 2020 7061  ions".        pa
-000095c0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-000095d0: 7b70 726f 6a65 6374 7d2f 6675 6e63 7469  {project}/functi
-000095e0: 6f6e 7322 0a20 2020 2020 2020 2072 6573  ons".        res
-000095f0: 7020 3d20 7365 6c66 2e61 7069 5f63 616c  p = self.api_cal
-00009600: 6c28 2247 4554 222c 2070 6174 682c 2065  l("GET", path, e
-00009610: 7272 6f72 2c20 7061 7261 6d73 3d70 6172  rror, params=par
-00009620: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
-00009630: 7572 6e20 7265 7370 2e6a 736f 6e28 295b  urn resp.json()[
-00009640: 2266 756e 6373 225d 0a0a 2020 2020 6465  "funcs"]..    de
-00009650: 6620 6c69 7374 5f72 756e 7469 6d65 5f72  f list_runtime_r
-00009660: 6573 6f75 7263 6573 280a 2020 2020 2020  esources(.      
-00009670: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00009680: 7072 6f6a 6563 743a 204f 7074 696f 6e61  project: Optiona
-00009690: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
-000096a0: 2020 2020 2020 206c 6162 656c 5f73 656c         label_sel
-000096b0: 6563 746f 723a 204f 7074 696f 6e61 6c5b  ector: Optional[
-000096c0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-000096d0: 2020 2020 206b 696e 643a 204f 7074 696f       kind: Optio
-000096e0: 6e61 6c5b 7374 725d 203d 204e 6f6e 652c  nal[str] = None,
-000096f0: 0a20 2020 2020 2020 206f 626a 6563 745f  .        object_
-00009700: 6964 3a20 4f70 7469 6f6e 616c 5b73 7472  id: Optional[str
-00009710: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00009720: 2020 6772 6f75 705f 6279 3a20 4f70 7469    group_by: Opti
-00009730: 6f6e 616c 5b0a 2020 2020 2020 2020 2020  onal[.          
-00009740: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
-00009750: 6368 656d 6173 2e4c 6973 7452 756e 7469  chemas.ListRunti
-00009760: 6d65 5265 736f 7572 6365 7347 726f 7570  meResourcesGroup
-00009770: 4279 4669 656c 640a 2020 2020 2020 2020  ByField.        
-00009780: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
-00009790: 2d3e 2055 6e69 6f6e 5b0a 2020 2020 2020  -> Union[.      
-000097a0: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
-000097b0: 6368 656d 6173 2e52 756e 7469 6d65 5265  chemas.RuntimeRe
-000097c0: 736f 7572 6365 734f 7574 7075 742c 0a20  sourcesOutput,. 
-000097d0: 2020 2020 2020 206d 6c72 756e 2e63 6f6d         mlrun.com
-000097e0: 6d6f 6e2e 7363 6865 6d61 732e 4772 6f75  mon.schemas.Grou
-000097f0: 7065 6442 794a 6f62 5275 6e74 696d 6552  pedByJobRuntimeR
-00009800: 6573 6f75 7263 6573 4f75 7470 7574 2c0a  esourcesOutput,.
-00009810: 2020 2020 2020 2020 6d6c 7275 6e2e 636f          mlrun.co
-00009820: 6d6d 6f6e 2e73 6368 656d 6173 2e47 726f  mmon.schemas.Gro
-00009830: 7570 6564 4279 5072 6f6a 6563 7452 756e  upedByProjectRun
-00009840: 7469 6d65 5265 736f 7572 6365 734f 7574  timeResourcesOut
-00009850: 7075 742c 0a20 2020 205d 3a0a 2020 2020  put,.    ]:.    
-00009860: 2020 2020 2222 224c 6973 7420 6375 7272      """List curr
-00009870: 656e 7420 7275 6e74 696d 6520 7265 736f  ent runtime reso
-00009880: 7572 6365 732c 2077 6869 6368 2061 7265  urces, which are
-00009890: 2075 7375 616c 6c79 2028 6275 7420 6e6f   usually (but no
-000098a0: 7420 6c69 6d69 7465 6420 746f 2920 4b75  t limited to) Ku
-000098b0: 6265 726e 6574 6573 2070 6f64 7320 6f72  bernetes pods or
-000098c0: 2043 5244 732e 0a20 2020 2020 2020 2046   CRDs..        F
-000098d0: 756e 6374 696f 6e20 6170 706c 6965 7320  unction applies 
-000098e0: 666f 7220 7275 6e73 206f 6620 7479 7065  for runs of type
-000098f0: 2060 5b27 6461 736b 272c 2027 6a6f 6227   `['dask', 'job'
-00009900: 2c20 2773 7061 726b 272c 2027 7265 6d6f  , 'spark', 'remo
-00009910: 7465 2d73 7061 726b 272c 2027 6d70 696a  te-spark', 'mpij
-00009920: 6f62 275d 602c 2061 6e64 2077 696c 6c20  ob']`, and will 
-00009930: 7265 7475 726e 2070 6572 0a20 2020 2020  return per.     
-00009940: 2020 2072 756e 7469 6d65 206b 696e 6420     runtime kind 
-00009950: 6120 6c69 7374 206f 6620 7468 6520 7275  a list of the ru
-00009960: 6e74 696d 6520 7265 736f 7572 6365 7320  ntime resources 
-00009970: 2877 6869 6368 206d 6179 2068 6176 6520  (which may have 
-00009980: 616c 7265 6164 7920 636f 6d70 6c65 7465  already complete
-00009990: 6420 7468 6569 7220 6578 6563 7574 696f  d their executio
-000099a0: 6e29 2e0a 0a20 2020 2020 2020 203a 7061  n)...        :pa
-000099b0: 7261 6d20 7072 6f6a 6563 743a 2047 6574  ram project: Get
-000099c0: 206f 6e6c 7920 7275 6e74 696d 6520 7265   only runtime re
-000099d0: 736f 7572 6365 7320 6f66 2061 2073 7065  sources of a spe
-000099e0: 6369 6669 6320 7072 6f6a 6563 742c 2062  cific project, b
-000099f0: 7920 6465 6661 756c 7420 4e6f 6e65 2c20  y default None, 
-00009a00: 7768 6963 6820 7769 6c6c 2072 6574 7572  which will retur
-00009a10: 6e20 6f6e 6c79 2074 6865 0a20 2020 2020  n only the.     
-00009a20: 2020 2020 2020 2070 726f 6a65 6374 7320         projects 
-00009a30: 796f 7527 7265 2061 7574 686f 7269 7a65  you're authorize
-00009a40: 6420 746f 2073 6565 2e0a 2020 2020 2020  d to see..      
-00009a50: 2020 3a70 6172 616d 206c 6162 656c 5f73    :param label_s
-00009a60: 656c 6563 746f 723a 2041 206c 6162 656c  elector: A label
-00009a70: 2066 696c 7465 7220 7468 6174 2077 696c   filter that wil
-00009a80: 6c20 6265 2070 6173 7365 6420 746f 204b  l be passed to K
-00009a90: 7562 6572 6e65 7465 7320 666f 7220 6669  ubernetes for fi
-00009aa0: 6c74 6572 696e 6720 7468 6520 7265 7375  ltering the resu
-00009ab0: 6c74 7320 6163 636f 7264 696e 670a 2020  lts according.  
-00009ac0: 2020 2020 2020 2020 2020 746f 2074 6865            to the
-00009ad0: 6972 206c 6162 656c 732e 0a20 2020 2020  ir labels..     
-00009ae0: 2020 203a 7061 7261 6d20 6b69 6e64 3a20     :param kind: 
-00009af0: 5468 6520 6b69 6e64 206f 6620 7275 6e74  The kind of runt
-00009b00: 696d 6520 746f 2071 7565 7279 2e20 4d61  ime to query. Ma
-00009b10: 7920 6265 206f 6e65 206f 6620 605b 2764  y be one of `['d
-00009b20: 6173 6b27 2c20 276a 6f62 272c 2027 7370  ask', 'job', 'sp
-00009b30: 6172 6b27 2c20 2772 656d 6f74 652d 7370  ark', 'remote-sp
-00009b40: 6172 6b27 2c20 276d 7069 6a6f 6227 5d60  ark', 'mpijob']`
-00009b50: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00009b60: 6f62 6a65 6374 5f69 643a 2054 6865 2069  object_id: The i
-00009b70: 6465 6e74 6966 6965 7220 6f66 2074 6865  dentifier of the
-00009b80: 206d 6c72 756e 206f 626a 6563 7420 746f   mlrun object to
-00009b90: 2071 7565 7279 2069 7473 2072 756e 7469   query its runti
-00009ba0: 6d65 2072 6573 6f75 7263 6573 2e20 666f  me resources. fo
-00009bb0: 7220 6d6f 7374 2066 756e 6374 696f 6e20  r most function 
-00009bc0: 7275 6e74 696d 6573 2c0a 2020 2020 2020  runtimes,.      
-00009bd0: 2020 2020 2020 7275 6e74 696d 6520 7265        runtime re
-00009be0: 736f 7572 6365 7320 6172 6520 7065 7220  sources are per 
-00009bf0: 5275 6e2c 2066 6f72 2077 6869 6368 2074  Run, for which t
-00009c00: 6865 2069 6465 6e74 6966 6965 7220 6973  he identifier is
-00009c10: 2074 6865 2052 756e 2773 2055 4944 2e20   the Run's UID. 
-00009c20: 466f 7220 6461 736b 2072 756e 7469 6d65  For dask runtime
-00009c30: 2c20 7468 6520 7275 6e74 696d 650a 2020  , the runtime.  
-00009c40: 2020 2020 2020 2020 2020 7265 736f 7572            resour
-00009c50: 6365 7320 6172 6520 7065 7220 4675 6e63  ces are per Func
-00009c60: 7469 6f6e 2c20 666f 7220 7768 6963 6820  tion, for which 
-00009c70: 7468 6520 6964 656e 7469 6669 6572 2069  the identifier i
-00009c80: 7320 7468 6520 4675 6e63 7469 6f6e 2773  s the Function's
-00009c90: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
-00009ca0: 7061 7261 6d20 6772 6f75 705f 6279 3a20  param group_by: 
-00009cb0: 4f62 6a65 6374 2074 6f20 6772 6f75 7020  Object to group 
-00009cc0: 7265 7375 6c74 7320 6279 2e20 416c 6c6f  results by. Allo
-00009cd0: 7765 6420 7661 6c75 6573 2061 7265 2060  wed values are `
-00009ce0: 6a6f 6260 2061 6e64 2060 7072 6f6a 6563  job` and `projec
-00009cf0: 7460 2e0a 2020 2020 2020 2020 2222 220a  t`..        """.
-00009d00: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00009d10: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-00009d20: 6c61 6265 6c5f 7365 6c65 6374 6f72 223a  label_selector":
-00009d30: 206c 6162 656c 5f73 656c 6563 746f 722c   label_selector,
-00009d40: 0a20 2020 2020 2020 2020 2020 2022 6772  .            "gr
-00009d50: 6f75 702d 6279 223a 2067 726f 7570 5f62  oup-by": group_b
-00009d60: 792c 0a20 2020 2020 2020 2020 2020 2022  y,.            "
-00009d70: 6b69 6e64 223a 206b 696e 642c 0a20 2020  kind": kind,.   
-00009d80: 2020 2020 2020 2020 2022 6f62 6a65 6374           "object
-00009d90: 2d69 6422 3a20 6f62 6a65 6374 5f69 642c  -id": object_id,
-00009da0: 0a20 2020 2020 2020 207d 0a20 2020 2020  .        }.     
-00009db0: 2020 2070 726f 6a65 6374 5f70 6174 6820     project_path 
-00009dc0: 3d20 7072 6f6a 6563 7420 6966 2070 726f  = project if pro
-00009dd0: 6a65 6374 2065 6c73 6520 222a 220a 2020  ject else "*".  
-00009de0: 2020 2020 2020 6572 726f 7220 3d20 2246        error = "F
-00009df0: 6169 6c65 6420 6c69 7374 696e 6720 7275  ailed listing ru
-00009e00: 6e74 696d 6520 7265 736f 7572 6365 7322  ntime resources"
-00009e10: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
-00009e20: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
-00009e30: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
-00009e40: 4745 5422 2c20 6622 7072 6f6a 6563 7473  GET", f"projects
-00009e50: 2f7b 7072 6f6a 6563 745f 7061 7468 7d2f  /{project_path}/
-00009e60: 7275 6e74 696d 652d 7265 736f 7572 6365  runtime-resource
-00009e70: 7322 2c20 6572 726f 722c 2070 6172 616d  s", error, param
-00009e80: 733d 7061 7261 6d73 0a20 2020 2020 2020  s=params.       
-00009e90: 2029 0a20 2020 2020 2020 2069 6620 6772   ).        if gr
-00009ea0: 6f75 705f 6279 2069 7320 4e6f 6e65 3a0a  oup_by is None:.
-00009eb0: 2020 2020 2020 2020 2020 2020 7374 7275              stru
-00009ec0: 6374 7572 6564 5f6c 6973 7420 3d20 5b0a  ctured_list = [.
-00009ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009ee0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00009ef0: 656d 6173 2e4b 696e 6452 756e 7469 6d65  emas.KindRuntime
-00009f00: 5265 736f 7572 6365 7328 2a2a 6b69 6e64  Resources(**kind
-00009f10: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
-00009f20: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
-00009f30: 2020 2020 666f 7220 6b69 6e64 5f72 756e      for kind_run
-00009f40: 7469 6d65 5f72 6573 6f75 7263 6573 2069  time_resources i
-00009f50: 6e20 7265 7370 6f6e 7365 2e6a 736f 6e28  n response.json(
-00009f60: 290a 2020 2020 2020 2020 2020 2020 5d0a  ).            ].
-00009f70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00009f80: 726e 2073 7472 7563 7475 7265 645f 6c69  rn structured_li
-00009f90: 7374 0a20 2020 2020 2020 2065 6c69 6620  st.        elif 
-00009fa0: 6772 6f75 705f 6279 203d 3d20 6d6c 7275  group_by == mlru
-00009fb0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00009fc0: 2e4c 6973 7452 756e 7469 6d65 5265 736f  .ListRuntimeReso
-00009fd0: 7572 6365 7347 726f 7570 4279 4669 656c  urcesGroupByFiel
-00009fe0: 642e 6a6f 623a 0a20 2020 2020 2020 2020  d.job:.         
-00009ff0: 2020 2073 7472 7563 7475 7265 645f 6469     structured_di
-0000a000: 6374 203d 207b 7d0a 2020 2020 2020 2020  ct = {}.        
-0000a010: 2020 2020 666f 7220 7072 6f6a 6563 742c      for project,
-0000a020: 206a 6f62 5f72 756e 7469 6d65 5f72 6573   job_runtime_res
-0000a030: 6f75 7263 6573 5f6d 6170 2069 6e20 7265  ources_map in re
-0000a040: 7370 6f6e 7365 2e6a 736f 6e28 292e 6974  sponse.json().it
-0000a050: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
-0000a060: 2020 2020 2020 2066 6f72 206a 6f62 5f69         for job_i
-0000a070: 642c 2072 756e 7469 6d65 5f72 6573 6f75  d, runtime_resou
-0000a080: 7263 6573 2069 6e20 6a6f 625f 7275 6e74  rces in job_runt
-0000a090: 696d 655f 7265 736f 7572 6365 735f 6d61  ime_resources_ma
-0000a0a0: 702e 6974 656d 7328 293a 0a20 2020 2020  p.items():.     
-0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000a0c0: 7472 7563 7475 7265 645f 6469 6374 2e73  tructured_dict.s
-0000a0d0: 6574 6465 6661 756c 7428 7072 6f6a 6563  etdefault(projec
-0000a0e0: 742c 207b 7d29 5b0a 2020 2020 2020 2020  t, {})[.        
-0000a0f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a100: 6a6f 625f 6964 0a20 2020 2020 2020 2020  job_id.         
-0000a110: 2020 2020 2020 2020 2020 205d 203d 206d             ] = m
-0000a120: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0000a130: 6d61 732e 5275 6e74 696d 6552 6573 6f75  mas.RuntimeResou
-0000a140: 7263 6573 282a 2a72 756e 7469 6d65 5f72  rces(**runtime_r
-0000a150: 6573 6f75 7263 6573 290a 2020 2020 2020  esources).      
-0000a160: 2020 2020 2020 7265 7475 726e 2073 7472        return str
-0000a170: 7563 7475 7265 645f 6469 6374 0a20 2020  uctured_dict.   
-0000a180: 2020 2020 2065 6c69 6620 6772 6f75 705f       elif group_
-0000a190: 6279 203d 3d20 6d6c 7275 6e2e 636f 6d6d  by == mlrun.comm
-0000a1a0: 6f6e 2e73 6368 656d 6173 2e4c 6973 7452  on.schemas.ListR
-0000a1b0: 756e 7469 6d65 5265 736f 7572 6365 7347  untimeResourcesG
-0000a1c0: 726f 7570 4279 4669 656c 642e 7072 6f6a  roupByField.proj
-0000a1d0: 6563 743a 0a20 2020 2020 2020 2020 2020  ect:.           
-0000a1e0: 2073 7472 7563 7475 7265 645f 6469 6374   structured_dict
-0000a1f0: 203d 207b 7d0a 2020 2020 2020 2020 2020   = {}.          
-0000a200: 2020 666f 7220 7072 6f6a 6563 742c 206b    for project, k
-0000a210: 696e 645f 7275 6e74 696d 655f 7265 736f  ind_runtime_reso
-0000a220: 7572 6365 735f 6d61 7020 696e 2072 6573  urces_map in res
-0000a230: 706f 6e73 652e 6a73 6f6e 2829 2e69 7465  ponse.json().ite
-0000a240: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000a250: 2020 2020 2020 666f 7220 6b69 6e64 2c20        for kind, 
-0000a260: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
-0000a270: 7320 696e 206b 696e 645f 7275 6e74 696d  s in kind_runtim
-0000a280: 655f 7265 736f 7572 6365 735f 6d61 702e  e_resources_map.
-0000a290: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0000a2a0: 2020 2020 2020 2020 2020 2020 2073 7472               str
-0000a2b0: 7563 7475 7265 645f 6469 6374 2e73 6574  uctured_dict.set
-0000a2c0: 6465 6661 756c 7428 7072 6f6a 6563 742c  default(project,
-0000a2d0: 207b 7d29 5b0a 2020 2020 2020 2020 2020   {})[.          
-0000a2e0: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
-0000a2f0: 6e64 0a20 2020 2020 2020 2020 2020 2020  nd.             
-0000a300: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
-0000a310: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0000a320: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
-0000a330: 282a 2a72 756e 7469 6d65 5f72 6573 6f75  (**runtime_resou
-0000a340: 7263 6573 290a 2020 2020 2020 2020 2020  rces).          
-0000a350: 2020 7265 7475 726e 2073 7472 7563 7475    return structu
-0000a360: 7265 645f 6469 6374 0a20 2020 2020 2020  red_dict.       
-0000a370: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000a380: 2020 2072 6169 7365 204e 6f74 496d 706c     raise NotImpl
-0000a390: 656d 656e 7465 6445 7272 6f72 280a 2020  ementedError(.  
-0000a3a0: 2020 2020 2020 2020 2020 2020 2020 6622                f"
-0000a3b0: 5072 6f76 6964 6564 2067 726f 7570 2062  Provided group b
-0000a3c0: 7920 6669 656c 6420 6973 206e 6f74 2073  y field is not s
-0000a3d0: 7570 706f 7274 6564 2e20 6772 6f75 705f  upported. group_
-0000a3e0: 6279 3d7b 6772 6f75 705f 6279 7d22 0a20  by={group_by}". 
-0000a3f0: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
-0000a400: 2020 6465 6620 6465 6c65 7465 5f72 756e    def delete_run
-0000a410: 7469 6d65 5f72 6573 6f75 7263 6573 280a  time_resources(.
-0000a420: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000a430: 2020 2020 2020 7072 6f6a 6563 743a 204f        project: O
-0000a440: 7074 696f 6e61 6c5b 7374 725d 203d 204e  ptional[str] = N
-0000a450: 6f6e 652c 0a20 2020 2020 2020 206c 6162  one,.        lab
-0000a460: 656c 5f73 656c 6563 746f 723a 204f 7074  el_selector: Opt
-0000a470: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
-0000a480: 652c 0a20 2020 2020 2020 206b 696e 643a  e,.        kind:
-0000a490: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
-0000a4a0: 204e 6f6e 652c 0a20 2020 2020 2020 206f   None,.        o
-0000a4b0: 626a 6563 745f 6964 3a20 4f70 7469 6f6e  bject_id: Option
-0000a4c0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0000a4d0: 2020 2020 2020 2020 666f 7263 653a 2062          force: b
-0000a4e0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
-0000a4f0: 2020 2020 2067 7261 6365 5f70 6572 696f       grace_perio
-0000a500: 643a 2069 6e74 203d 204e 6f6e 652c 0a20  d: int = None,. 
-0000a510: 2020 2029 202d 3e20 6d6c 7275 6e2e 636f     ) -> mlrun.co
-0000a520: 6d6d 6f6e 2e73 6368 656d 6173 2e47 726f  mmon.schemas.Gro
-0000a530: 7570 6564 4279 5072 6f6a 6563 7452 756e  upedByProjectRun
-0000a540: 7469 6d65 5265 736f 7572 6365 734f 7574  timeResourcesOut
-0000a550: 7075 743a 0a20 2020 2020 2020 2022 2222  put:.        """
-0000a560: 4465 6c65 7465 2061 6c6c 2072 756e 7469  Delete all runti
-0000a570: 6d65 2072 6573 6f75 7263 6573 2077 6869  me resources whi
-0000a580: 6368 2061 7265 2069 6e20 7465 726d 696e  ch are in termin
-0000a590: 616c 2073 7461 7465 2e0a 0a20 2020 2020  al state...     
-0000a5a0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-0000a5b0: 743a 2044 656c 6574 6520 6f6e 6c79 2072  t: Delete only r
-0000a5c0: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
-0000a5d0: 206f 6620 6120 7370 6563 6966 6963 2070   of a specific p
-0000a5e0: 726f 6a65 6374 2c20 6279 2064 6566 6175  roject, by defau
-0000a5f0: 6c74 204e 6f6e 652c 2077 6869 6368 2077  lt None, which w
-0000a600: 696c 6c20 6465 6c65 7465 206f 6e6c 790a  ill delete only.
-0000a610: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0000a620: 2074 6865 2070 726f 6a65 6374 7320 796f   the projects yo
-0000a630: 7527 7265 2061 7574 686f 7269 7a65 6420  u're authorized 
-0000a640: 746f 2064 656c 6574 6520 6672 6f6d 2e0a  to delete from..
-0000a650: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
-0000a660: 6162 656c 5f73 656c 6563 746f 723a 2044  abel_selector: D
-0000a670: 656c 6574 6520 6f6e 6c79 2072 756e 7469  elete only runti
-0000a680: 6d65 2072 6573 6f75 7263 6573 206d 6174  me resources mat
-0000a690: 6368 696e 6720 7468 6520 6c61 6265 6c20  ching the label 
-0000a6a0: 7365 6c65 6374 6f72 2e0a 2020 2020 2020  selector..      
-0000a6b0: 2020 3a70 6172 616d 206b 696e 643a 2054    :param kind: T
-0000a6c0: 6865 206b 696e 6420 6f66 2072 756e 7469  he kind of runti
-0000a6d0: 6d65 2074 6f20 6465 6c65 7465 2e20 4d61  me to delete. Ma
-0000a6e0: 7920 6265 206f 6e65 206f 6620 605b 2764  y be one of `['d
-0000a6f0: 6173 6b27 2c20 276a 6f62 272c 2027 7370  ask', 'job', 'sp
-0000a700: 6172 6b27 2c20 2772 656d 6f74 652d 7370  ark', 'remote-sp
-0000a710: 6172 6b27 2c20 276d 7069 6a6f 6227 5d60  ark', 'mpijob']`
-0000a720: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000a730: 6f62 6a65 6374 5f69 643a 2054 6865 2069  object_id: The i
-0000a740: 6465 6e74 6966 6965 7220 6f66 2074 6865  dentifier of the
-0000a750: 206d 6c72 756e 206f 626a 6563 7420 746f   mlrun object to
-0000a760: 2064 656c 6574 6520 6974 7320 7275 6e74   delete its runt
-0000a770: 696d 6520 7265 736f 7572 6365 732e 2066  ime resources. f
-0000a780: 6f72 206d 6f73 7420 6675 6e63 7469 6f6e  or most function
-0000a790: 0a20 2020 2020 2020 2020 2020 2072 756e  .            run
-0000a7a0: 7469 6d65 732c 2072 756e 7469 6d65 2072  times, runtime r
-0000a7b0: 6573 6f75 7263 6573 2061 7265 2070 6572  esources are per
-0000a7c0: 2052 756e 2c20 666f 7220 7768 6963 6820   Run, for which 
-0000a7d0: 7468 6520 6964 656e 7469 6669 6572 2069  the identifier i
-0000a7e0: 7320 7468 6520 5275 6e27 7320 5549 442e  s the Run's UID.
-0000a7f0: 2046 6f72 2064 6173 6b20 7275 6e74 696d   For dask runtim
-0000a800: 652c 2074 6865 0a20 2020 2020 2020 2020  e, the.         
-0000a810: 2020 2072 756e 7469 6d65 2072 6573 6f75     runtime resou
-0000a820: 7263 6573 2061 7265 2070 6572 2046 756e  rces are per Fun
-0000a830: 6374 696f 6e2c 2066 6f72 2077 6869 6368  ction, for which
-0000a840: 2074 6865 2069 6465 6e74 6966 6965 7220   the identifier 
-0000a850: 6973 2074 6865 2046 756e 6374 696f 6e27  is the Function'
-0000a860: 7320 6e61 6d65 2e0a 2020 2020 2020 2020  s name..        
-0000a870: 3a70 6172 616d 2066 6f72 6365 3a20 466f  :param force: Fo
-0000a880: 7263 6520 6465 6c65 7469 6f6e 202d 2064  rce deletion - d
-0000a890: 656c 6574 6520 7468 6520 7275 6e74 696d  elete the runtim
-0000a8a0: 6520 7265 736f 7572 6365 2065 7665 6e20  e resource even 
-0000a8b0: 6966 2069 7427 7320 6e6f 7420 696e 2074  if it's not in t
-0000a8c0: 6572 6d69 6e61 6c20 7374 6174 6520 6f72  erminal state or
-0000a8d0: 2069 6620 7468 6520 6772 6163 650a 2020   if the grace.  
-0000a8e0: 2020 2020 2020 2020 2020 7065 7269 6f64            period
-0000a8f0: 2064 6964 6e27 7420 7061 7373 2e0a 2020   didn't pass..  
-0000a900: 2020 2020 2020 3a70 6172 616d 2067 7261        :param gra
-0000a910: 6365 5f70 6572 696f 643a 2047 7261 6365  ce_period: Grace
-0000a920: 2070 6572 696f 6420 6769 7665 6e20 746f   period given to
-0000a930: 2074 6865 2072 756e 7469 6d65 2072 6573   the runtime res
-0000a940: 6f75 7263 6520 6265 666f 7265 2074 6865  ource before the
-0000a950: 7920 6172 6520 6163 7475 616c 6c79 2072  y are actually r
-0000a960: 656d 6f76 6564 2c20 636f 756e 7465 6420  emoved, counted 
-0000a970: 6672 6f6d 0a20 2020 2020 2020 2020 2020  from.           
-0000a980: 2074 6865 206d 6f6d 656e 7420 7468 6579   the moment they
-0000a990: 206d 6f76 6564 2074 6f20 7465 726d 696e   moved to termin
-0000a9a0: 616c 2073 7461 7465 2028 6465 6661 756c  al state (defaul
-0000a9b0: 7473 2074 6f20 6d6c 7275 6e2e 6d6c 636f  ts to mlrun.mlco
-0000a9c0: 6e66 2e72 756e 7469 6d65 5f72 6573 6f75  nf.runtime_resou
-0000a9d0: 7263 6573 5f64 656c 6574 696f 6e5f 6772  rces_deletion_gr
-0000a9e0: 6163 655f 7065 7269 6f64 292e 0a0a 2020  ace_period)...  
-0000a9f0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-0000aa00: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-0000aa10: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0000aa20: 2e47 726f 7570 6564 4279 5072 6f6a 6563  .GroupedByProjec
-0000aa30: 7452 756e 7469 6d65 5265 736f 7572 6365  tRuntimeResource
-0000aa40: 734f 7574 7075 7460 206c 6973 7469 6e67  sOutput` listing
-0000aa50: 2074 6865 2072 756e 7469 6d65 2072 6573   the runtime res
-0000aa60: 6f75 7263 6573 0a20 2020 2020 2020 2020  ources.         
-0000aa70: 2020 2074 6861 7420 7765 7265 2072 656d     that were rem
-0000aa80: 6f76 6564 2e0a 2020 2020 2020 2020 2222  oved..        ""
-0000aa90: 220a 2020 2020 2020 2020 6966 2067 7261  ".        if gra
-0000aaa0: 6365 5f70 6572 696f 6420 6973 204e 6f6e  ce_period is Non
-0000aab0: 653a 0a20 2020 2020 2020 2020 2020 2067  e:.            g
-0000aac0: 7261 6365 5f70 6572 696f 6420 3d20 636f  race_period = co
-0000aad0: 6e66 6967 2e72 756e 7469 6d65 5f72 6573  nfig.runtime_res
-0000aae0: 6f75 7263 6573 5f64 656c 6574 696f 6e5f  ources_deletion_
-0000aaf0: 6772 6163 655f 7065 7269 6f64 0a20 2020  grace_period.   
-0000ab00: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
-0000ab10: 696e 666f 280a 2020 2020 2020 2020 2020  info(.          
-0000ab20: 2020 2020 2020 2255 7369 6e67 2064 6566        "Using def
-0000ab30: 6175 6c74 2067 7261 6365 2070 6572 696f  ault grace perio
-0000ab40: 6420 666f 7220 7275 6e74 696d 6520 7265  d for runtime re
-0000ab50: 736f 7572 6365 7320 6465 6c65 7469 6f6e  sources deletion
-0000ab60: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
-0000ab70: 2020 2067 7261 6365 5f70 6572 696f 643d     grace_period=
-0000ab80: 6772 6163 655f 7065 7269 6f64 2c0a 2020  grace_period,.  
-0000ab90: 2020 2020 2020 2020 2020 290a 0a20 2020            )..   
-0000aba0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-0000abb0: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
-0000abc0: 656c 2d73 656c 6563 746f 7222 3a20 6c61  el-selector": la
-0000abd0: 6265 6c5f 7365 6c65 6374 6f72 2c0a 2020  bel_selector,.  
-0000abe0: 2020 2020 2020 2020 2020 226b 696e 6422            "kind"
-0000abf0: 3a20 6b69 6e64 2c0a 2020 2020 2020 2020  : kind,.        
-0000ac00: 2020 2020 226f 626a 6563 742d 6964 223a      "object-id":
-0000ac10: 206f 626a 6563 745f 6964 2c0a 2020 2020   object_id,.    
-0000ac20: 2020 2020 2020 2020 2266 6f72 6365 223a          "force":
-0000ac30: 2066 6f72 6365 2c0a 2020 2020 2020 2020   force,.        
-0000ac40: 2020 2020 2267 7261 6365 2d70 6572 696f      "grace-perio
-0000ac50: 6422 3a20 6772 6163 655f 7065 7269 6f64  d": grace_period
-0000ac60: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
-0000ac70: 2020 2020 6572 726f 7220 3d20 2246 6169      error = "Fai
-0000ac80: 6c65 6420 6465 6c65 7469 6e67 2072 756e  led deleting run
-0000ac90: 7469 6d65 2072 6573 6f75 7263 6573 220a  time resources".
-0000aca0: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
-0000acb0: 7061 7468 203d 2070 726f 6a65 6374 2069  path = project i
-0000acc0: 6620 7072 6f6a 6563 7420 656c 7365 2022  f project else "
-0000acd0: 2a22 0a20 2020 2020 2020 2072 6573 706f  *".        respo
-0000ace0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-0000acf0: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-0000ad00: 2022 4445 4c45 5445 222c 0a20 2020 2020   "DELETE",.     
-0000ad10: 2020 2020 2020 2066 2270 726f 6a65 6374         f"project
-0000ad20: 732f 7b70 726f 6a65 6374 5f70 6174 687d  s/{project_path}
-0000ad30: 2f72 756e 7469 6d65 2d72 6573 6f75 7263  /runtime-resourc
-0000ad40: 6573 222c 0a20 2020 2020 2020 2020 2020  es",.           
-0000ad50: 2065 7272 6f72 2c0a 2020 2020 2020 2020   error,.        
-0000ad60: 2020 2020 7061 7261 6d73 3d70 6172 616d      params=param
-0000ad70: 732c 0a20 2020 2020 2020 2029 0a20 2020  s,.        ).   
-0000ad80: 2020 2020 2073 7472 7563 7475 7265 645f       structured_
-0000ad90: 6469 6374 203d 207b 7d0a 2020 2020 2020  dict = {}.      
-0000ada0: 2020 666f 7220 7072 6f6a 6563 742c 206b    for project, k
-0000adb0: 696e 645f 7275 6e74 696d 655f 7265 736f  ind_runtime_reso
-0000adc0: 7572 6365 735f 6d61 7020 696e 2072 6573  urces_map in res
-0000add0: 706f 6e73 652e 6a73 6f6e 2829 2e69 7465  ponse.json().ite
-0000ade0: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
-0000adf0: 2020 666f 7220 6b69 6e64 2c20 7275 6e74    for kind, runt
-0000ae00: 696d 655f 7265 736f 7572 6365 7320 696e  ime_resources in
-0000ae10: 206b 696e 645f 7275 6e74 696d 655f 7265   kind_runtime_re
-0000ae20: 736f 7572 6365 735f 6d61 702e 6974 656d  sources_map.item
-0000ae30: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-0000ae40: 2020 2020 2073 7472 7563 7475 7265 645f       structured_
-0000ae50: 6469 6374 2e73 6574 6465 6661 756c 7428  dict.setdefault(
-0000ae60: 7072 6f6a 6563 742c 207b 7d29 5b0a 2020  project, {})[.  
-0000ae70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ae80: 2020 6b69 6e64 0a20 2020 2020 2020 2020    kind.         
-0000ae90: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
-0000aea0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0000aeb0: 5275 6e74 696d 6552 6573 6f75 7263 6573  RuntimeResources
-0000aec0: 282a 2a72 756e 7469 6d65 5f72 6573 6f75  (**runtime_resou
-0000aed0: 7263 6573 290a 2020 2020 2020 2020 7265  rces).        re
-0000aee0: 7475 726e 2073 7472 7563 7475 7265 645f  turn structured_
-0000aef0: 6469 6374 0a0a 2020 2020 6465 6620 6372  dict..    def cr
-0000af00: 6561 7465 5f73 6368 6564 756c 6528 0a20  eate_schedule(. 
-0000af10: 2020 2020 2020 2073 656c 662c 2070 726f         self, pro
-0000af20: 6a65 6374 3a20 7374 722c 2073 6368 6564  ject: str, sched
-0000af30: 756c 653a 206d 6c72 756e 2e63 6f6d 6d6f  ule: mlrun.commo
-0000af40: 6e2e 7363 6865 6d61 732e 5363 6865 6475  n.schemas.Schedu
-0000af50: 6c65 496e 7075 740a 2020 2020 293a 0a20  leInput.    ):. 
-0000af60: 2020 2020 2020 2022 2222 4372 6561 7465         """Create
-0000af70: 2061 206e 6577 2073 6368 6564 756c 6520   a new schedule 
-0000af80: 6f6e 2074 6865 2067 6976 656e 2070 726f  on the given pro
-0000af90: 6a65 6374 2e20 5468 6520 6465 7461 696c  ject. The detail
-0000afa0: 7320 6f6e 2074 6865 2061 6374 7561 6c20  s on the actual 
-0000afb0: 6f62 6a65 6374 2074 6f20 7363 6865 6475  object to schedu
-0000afc0: 6c65 2061 7320 7765 6c6c 2061 7320 7468  le as well as th
-0000afd0: 650a 2020 2020 2020 2020 7363 6865 6475  e.        schedu
-0000afe0: 6c65 2069 7473 656c 6620 6172 6520 7769  le itself are wi
-0000aff0: 7468 696e 2074 6865 2073 6368 6564 756c  thin the schedul
-0000b000: 6520 6f62 6a65 6374 2070 726f 7669 6465  e object provide
-0000b010: 642e 0a20 2020 2020 2020 2054 6865 203a  d..        The :
-0000b020: 7079 3a63 6c61 7373 3a60 7e53 6368 6564  py:class:`~Sched
-0000b030: 756c 6543 726f 6e54 7269 6767 6572 6020  uleCronTrigger` 
-0000b040: 666f 6c6c 6f77 7320 7468 6520 6775 6964  follows the guid
-0000b050: 656c 696e 6573 2069 6e0a 2020 2020 2020  elines in.      
-0000b060: 2020 6874 7470 733a 2f2f 6170 7363 6865    https://apsche
-0000b070: 6475 6c65 722e 7265 6164 7468 6564 6f63  duler.readthedoc
-0000b080: 732e 696f 2f65 6e2f 332e 782f 6d6f 6475  s.io/en/3.x/modu
-0000b090: 6c65 732f 7472 6967 6765 7273 2f63 726f  les/triggers/cro
-0000b0a0: 6e2e 6874 6d6c 2e0a 2020 2020 2020 2020  n.html..        
-0000b0b0: 4974 2061 6c73 6f20 7375 7070 6f72 7473  It also supports
-0000b0c0: 2061 203a 7079 3a66 756e 633a 607e 5363   a :py:func:`~Sc
-0000b0d0: 6865 6475 6c65 4372 6f6e 5472 6967 6765  heduleCronTrigge
-0000b0e0: 722e 6672 6f6d 5f63 726f 6e74 6162 6020  r.from_crontab` 
-0000b0f0: 6675 6e63 7469 6f6e 2074 6861 7420 6163  function that ac
-0000b100: 6365 7074 7320 610a 2020 2020 2020 2020  cepts a.        
-0000b110: 6372 6f6e 7461 622d 666f 726d 6174 7465  crontab-formatte
-0000b120: 6420 7374 7269 6e67 2028 7365 6520 6874  d string (see ht
-0000b130: 7470 733a 2f2f 656e 2e77 696b 6970 6564  tps://en.wikiped
-0000b140: 6961 2e6f 7267 2f77 696b 692f 4372 6f6e  ia.org/wiki/Cron
-0000b150: 2066 6f72 206d 6f72 6520 696e 666f 726d   for more inform
-0000b160: 6174 696f 6e20 6f6e 2074 6865 2066 6f72  ation on the for
-0000b170: 6d61 7420 616e 640a 2020 2020 2020 2020  mat and.        
-0000b180: 6e6f 7465 2074 6861 7420 7468 6520 3020  note that the 0 
-0000b190: 7765 656b 6461 7920 6973 2061 6c77 6179  weekday is alway
-0000b1a0: 7320 6d6f 6e64 6179 292e 0a0a 0a20 2020  s monday)....   
-0000b1b0: 2020 2020 2045 7861 6d70 6c65 3a3a 0a0a       Example::..
-0000b1c0: 2020 2020 2020 2020 2020 2020 6672 6f6d              from
-0000b1d0: 206d 6c72 756e 2e63 6f6d 6d6f 6e20 696d   mlrun.common im
-0000b1e0: 706f 7274 2073 6368 656d 6173 0a0a 2020  port schemas..  
-0000b1f0: 2020 2020 2020 2020 2020 2320 4578 6563            # Exec
-0000b200: 7574 6520 7468 6520 6765 745f 6461 7461  ute the get_data
-0000b210: 5f66 756e 6320 6675 6e63 7469 6f6e 2065  _func function e
-0000b220: 7665 7279 2054 7565 7364 6179 2061 7420  very Tuesday at 
-0000b230: 3135 3a33 300a 2020 2020 2020 2020 2020  15:30.          
-0000b240: 2020 7363 6865 6475 6c65 203d 2073 6368    schedule = sch
-0000b250: 656d 6173 2e53 6368 6564 756c 6549 6e70  emas.ScheduleInp
-0000b260: 7574 280a 2020 2020 2020 2020 2020 2020  ut(.            
-0000b270: 2020 2020 6e61 6d65 3d22 7275 6e5f 6675      name="run_fu
-0000b280: 6e63 5f6f 6e5f 7475 6573 6461 7973 222c  nc_on_tuesdays",
-0000b290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b2a0: 206b 696e 643d 226a 6f62 222c 0a20 2020   kind="job",.   
-0000b2b0: 2020 2020 2020 2020 2020 2020 2073 6368               sch
-0000b2c0: 6564 756c 6564 5f6f 626a 6563 743d 6765  eduled_object=ge
-0000b2d0: 745f 6461 7461 5f66 756e 632c 0a20 2020  t_data_func,.   
-0000b2e0: 2020 2020 2020 2020 2020 2020 2063 726f               cro
-0000b2f0: 6e5f 7472 6967 6765 723d 7363 6865 6d61  n_trigger=schema
-0000b300: 732e 5363 6865 6475 6c65 4372 6f6e 5472  s.ScheduleCronTr
-0000b310: 6967 6765 7228 6461 795f 6f66 5f77 6565  igger(day_of_wee
-0000b320: 6b3d 2774 7565 272c 2068 6f75 723d 3135  k='tue', hour=15
-0000b330: 2c20 6d69 6e75 7465 3d33 3029 2c0a 2020  , minute=30),.  
-0000b340: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000b350: 2020 2020 2020 2020 6462 2e63 7265 6174          db.creat
-0000b360: 655f 7363 6865 6475 6c65 2870 726f 6a65  e_schedule(proje
-0000b370: 6374 5f6e 616d 652c 2073 6368 6564 756c  ct_name, schedul
-0000b380: 6529 0a20 2020 2020 2020 2022 2222 0a0a  e).        """..
-0000b390: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-0000b3a0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
-0000b3b0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-0000b3c0: 6563 740a 2020 2020 2020 2020 7061 7468  ect.        path
-0000b3d0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-0000b3e0: 726f 6a65 6374 7d2f 7363 6865 6475 6c65  roject}/schedule
-0000b3f0: 7322 0a0a 2020 2020 2020 2020 6572 726f  s"..        erro
-0000b400: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-0000b410: 696c 6564 2063 7265 6174 696e 6720 7363  iled creating sc
-0000b420: 6865 6475 6c65 207b 7072 6f6a 6563 747d  hedule {project}
-0000b430: 2f7b 7363 6865 6475 6c65 2e6e 616d 657d  /{schedule.name}
-0000b440: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-0000b450: 7069 5f63 616c 6c28 2250 4f53 5422 2c20  pi_call("POST", 
-0000b460: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-0000b470: 6167 652c 2062 6f64 793d 6469 6374 5f74  age, body=dict_t
-0000b480: 6f5f 6a73 6f6e 2873 6368 6564 756c 652e  o_json(schedule.
-0000b490: 6469 6374 2829 2929 0a0a 2020 2020 6465  dict()))..    de
-0000b4a0: 6620 7570 6461 7465 5f73 6368 6564 756c  f update_schedul
-0000b4b0: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
-0000b4c0: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
-0000b4d0: 616d 653a 2073 7472 2c20 7363 6865 6475  ame: str, schedu
-0000b4e0: 6c65 3a20 6d6c 7275 6e2e 636f 6d6d 6f6e  le: mlrun.common
-0000b4f0: 2e73 6368 656d 6173 2e53 6368 6564 756c  .schemas.Schedul
-0000b500: 6555 7064 6174 650a 2020 2020 293a 0a20  eUpdate.    ):. 
-0000b510: 2020 2020 2020 2022 2222 5570 6461 7465         """Update
-0000b520: 2061 6e20 6578 6973 7469 6e67 2073 6368   an existing sch
-0000b530: 6564 756c 652c 2072 6570 6c61 6365 2069  edule, replace i
-0000b540: 7420 7769 7468 2074 6865 2064 6574 6169  t with the detai
-0000b550: 6c73 2063 6f6e 7461 696e 6564 2069 6e20  ls contained in 
-0000b560: 7468 6520 7363 6865 6475 6c65 206f 626a  the schedule obj
-0000b570: 6563 742e 2222 220a 0a20 2020 2020 2020  ect."""..       
-0000b580: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-0000b590: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-0000b5a0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-0000b5b0: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
-0000b5c0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
-0000b5d0: 2f73 6368 6564 756c 6573 2f7b 6e61 6d65  /schedules/{name
-0000b5e0: 7d22 0a0a 2020 2020 2020 2020 6572 726f  }"..        erro
-0000b5f0: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
-0000b600: 696c 6564 2075 7064 6174 696e 6720 7363  iled updating sc
-0000b610: 6865 6475 6c65 207b 7072 6f6a 6563 747d  hedule {project}
-0000b620: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-0000b630: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-0000b640: 5055 5422 2c20 7061 7468 2c20 6572 726f  PUT", path, erro
-0000b650: 725f 6d65 7373 6167 652c 2062 6f64 793d  r_message, body=
-0000b660: 6469 6374 5f74 6f5f 6a73 6f6e 2873 6368  dict_to_json(sch
-0000b670: 6564 756c 652e 6469 6374 2829 2929 0a0a  edule.dict()))..
-0000b680: 2020 2020 6465 6620 6765 745f 7363 6865      def get_sche
-0000b690: 6475 6c65 280a 2020 2020 2020 2020 7365  dule(.        se
-0000b6a0: 6c66 2c20 7072 6f6a 6563 743a 2073 7472  lf, project: str
-0000b6b0: 2c20 6e61 6d65 3a20 7374 722c 2069 6e63  , name: str, inc
-0000b6c0: 6c75 6465 5f6c 6173 745f 7275 6e3a 2062  lude_last_run: b
-0000b6d0: 6f6f 6c20 3d20 4661 6c73 650a 2020 2020  ool = False.    
-0000b6e0: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
-0000b6f0: 6e2e 7363 6865 6d61 732e 5363 6865 6475  n.schemas.Schedu
-0000b700: 6c65 4f75 7470 7574 3a0a 2020 2020 2020  leOutput:.      
-0000b710: 2020 2222 2252 6574 7269 6576 6520 6465    """Retrieve de
-0000b720: 7461 696c 7320 6f66 2074 6865 2073 6368  tails of the sch
-0000b730: 6564 756c 6520 696e 2071 7565 7374 696f  edule in questio
-0000b740: 6e2e 2042 6573 6964 6573 2072 6574 7572  n. Besides retur
-0000b750: 6e69 6e67 2074 6865 2064 6574 6169 6c73  ning the details
-0000b760: 206f 6620 7468 6520 7363 6865 6475 6c65   of the schedule
-0000b770: 206f 626a 6563 7420 6974 7365 6c66 2c0a   object itself,.
-0000b780: 2020 2020 2020 2020 7468 6973 2066 756e          this fun
-0000b790: 6374 696f 6e20 616c 736f 2072 6574 7572  ction also retur
-0000b7a0: 6e73 2074 6865 206e 6578 7420 7363 6865  ns the next sche
-0000b7b0: 6475 6c65 6420 7275 6e20 666f 7220 7468  duled run for th
-0000b7c0: 6973 2073 7065 6369 6669 6320 7363 6865  is specific sche
-0000b7d0: 6475 6c65 2c20 6173 2077 656c 6c20 6173  dule, as well as
-0000b7e0: 2070 6f74 656e 7469 616c 6c79 2074 6865   potentially the
-0000b7f0: 0a20 2020 2020 2020 2072 6573 756c 7473  .        results
-0000b800: 206f 6620 7468 6520 6c61 7374 2072 756e   of the last run
-0000b810: 2065 7865 6375 7465 6420 7468 726f 7567   executed throug
-0000b820: 6820 7468 6973 2073 6368 6564 756c 652e  h this schedule.
-0000b830: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000b840: 2070 726f 6a65 6374 3a20 5072 6f6a 6563   project: Projec
-0000b850: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-0000b860: 3a70 6172 616d 206e 616d 653a 204e 616d  :param name: Nam
-0000b870: 6520 6f66 2074 6865 2073 6368 6564 756c  e of the schedul
-0000b880: 6520 6f62 6a65 6374 2074 6f20 7175 6572  e object to quer
-0000b890: 792e 0a20 2020 2020 2020 203a 7061 7261  y..        :para
-0000b8a0: 6d20 696e 636c 7564 655f 6c61 7374 5f72  m include_last_r
-0000b8b0: 756e 3a20 5768 6574 6865 7220 746f 2069  un: Whether to i
-0000b8c0: 6e63 6c75 6465 2074 6865 2072 6573 756c  nclude the resul
-0000b8d0: 7473 206f 6620 7468 6520 7363 6865 6475  ts of the schedu
-0000b8e0: 6c65 2773 206c 6173 7420 7275 6e20 696e  le's last run in
-0000b8f0: 2074 6865 2072 6573 706f 6e73 652e 0a20   the response.. 
-0000b900: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-0000b910: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-0000b920: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-0000b930: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-0000b940: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-0000b950: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-0000b960: 6374 7d2f 7363 6865 6475 6c65 732f 7b6e  ct}/schedules/{n
-0000b970: 616d 657d 220a 2020 2020 2020 2020 6572  ame}".        er
-0000b980: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-0000b990: 4661 696c 6564 2067 6574 7469 6e67 2073  Failed getting s
-0000b9a0: 6368 6564 756c 6520 666f 7220 7b70 726f  chedule for {pro
-0000b9b0: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
-0000b9c0: 2020 2020 2020 7265 7370 203d 2073 656c        resp = sel
-0000b9d0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
-0000b9e0: 2020 2020 2020 2020 2247 4554 222c 2070          "GET", p
-0000b9f0: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
-0000ba00: 6765 2c20 7061 7261 6d73 3d7b 2269 6e63  ge, params={"inc
-0000ba10: 6c75 6465 5f6c 6173 745f 7275 6e22 3a20  lude_last_run": 
-0000ba20: 696e 636c 7564 655f 6c61 7374 5f72 756e  include_last_run
-0000ba30: 7d0a 2020 2020 2020 2020 290a 2020 2020  }.        ).    
-0000ba40: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
-0000ba50: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0000ba60: 5363 6865 6475 6c65 4f75 7470 7574 282a  ScheduleOutput(*
-0000ba70: 2a72 6573 702e 6a73 6f6e 2829 290a 0a20  *resp.json()).. 
-0000ba80: 2020 2064 6566 206c 6973 745f 7363 6865     def list_sche
-0000ba90: 6475 6c65 7328 0a20 2020 2020 2020 2073  dules(.        s
-0000baa0: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
-0000bab0: 6a65 6374 3a20 7374 722c 0a20 2020 2020  ject: str,.     
-0000bac0: 2020 206e 616d 653a 2073 7472 203d 204e     name: str = N
-0000bad0: 6f6e 652c 0a20 2020 2020 2020 206b 696e  one,.        kin
-0000bae0: 643a 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  d: mlrun.common.
-0000baf0: 7363 6865 6d61 732e 5363 6865 6475 6c65  schemas.Schedule
-0000bb00: 4b69 6e64 7320 3d20 4e6f 6e65 2c0a 2020  Kinds = None,.  
-0000bb10: 2020 2020 2020 696e 636c 7564 655f 6c61        include_la
-0000bb20: 7374 5f72 756e 3a20 626f 6f6c 203d 2046  st_run: bool = F
-0000bb30: 616c 7365 2c0a 2020 2020 2920 2d3e 206d  alse,.    ) -> m
-0000bb40: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0000bb50: 6d61 732e 5363 6865 6475 6c65 734f 7574  mas.SchedulesOut
-0000bb60: 7075 743a 0a20 2020 2020 2020 2022 2222  put:.        """
-0000bb70: 5265 7472 6965 7665 206c 6973 7420 6f66  Retrieve list of
-0000bb80: 2073 6368 6564 756c 6573 206f 6620 7370   schedules of sp
-0000bb90: 6563 6966 6963 206e 616d 6520 6f72 206b  ecific name or k
-0000bba0: 696e 642e 0a0a 2020 2020 2020 2020 3a70  ind...        :p
-0000bbb0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
-0000bbc0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
-0000bbd0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
-0000bbe0: 204e 616d 6520 6f66 2073 6368 6564 756c   Name of schedul
-0000bbf0: 6520 746f 2072 6574 7269 6576 652e 2043  e to retrieve. C
-0000bc00: 616e 2062 6520 6f6d 6974 7465 6420 746f  an be omitted to
-0000bc10: 206c 6973 7420 616c 6c20 7363 6865 6475   list all schedu
-0000bc20: 6c65 732e 0a20 2020 2020 2020 203a 7061  les..        :pa
-0000bc30: 7261 6d20 6b69 6e64 3a20 4b69 6e64 206f  ram kind: Kind o
-0000bc40: 6620 7363 6865 6475 6c65 206f 626a 6563  f schedule objec
-0000bc50: 7473 2074 6f20 7265 7472 6965 7665 2c20  ts to retrieve, 
-0000bc60: 6361 6e20 6265 2065 6974 6865 7220 6060  can be either ``
-0000bc70: 6a6f 6260 6020 6f72 2060 6070 6970 656c  job`` or ``pipel
-0000bc80: 696e 6560 602e 0a20 2020 2020 2020 203a  ine``..        :
-0000bc90: 7061 7261 6d20 696e 636c 7564 655f 6c61  param include_la
-0000bca0: 7374 5f72 756e 3a20 5768 6574 6865 7220  st_run: Whether 
-0000bcb0: 746f 2072 6574 7572 6e20 666f 7220 6561  to return for ea
-0000bcc0: 6368 2073 6368 6564 756c 6520 7265 7475  ch schedule retu
-0000bcd0: 726e 6564 2061 6c73 6f20 7468 6520 7265  rned also the re
-0000bce0: 7375 6c74 7320 6f66 2074 6865 206c 6173  sults of the las
-0000bcf0: 7420 7275 6e20 6f66 0a20 2020 2020 2020  t run of.       
-0000bd00: 2020 2020 2074 6861 7420 7363 6865 6475       that schedu
-0000bd10: 6c65 2e0a 2020 2020 2020 2020 2222 220a  le..        """.
-0000bd20: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0000bd30: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-0000bd40: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-0000bd50: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
-0000bd60: 616d 7320 3d20 7b22 6b69 6e64 223a 206b  ams = {"kind": k
-0000bd70: 696e 642c 2022 6e61 6d65 223a 206e 616d  ind, "name": nam
-0000bd80: 652c 2022 696e 636c 7564 655f 6c61 7374  e, "include_last
-0000bd90: 5f72 756e 223a 2069 6e63 6c75 6465 5f6c  _run": include_l
-0000bda0: 6173 745f 7275 6e7d 0a20 2020 2020 2020  ast_run}.       
-0000bdb0: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
-0000bdc0: 7473 2f7b 7072 6f6a 6563 747d 2f73 6368  ts/{project}/sch
-0000bdd0: 6564 756c 6573 220a 2020 2020 2020 2020  edules".        
-0000bde0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-0000bdf0: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
-0000be00: 2073 6368 6564 756c 6573 2066 6f72 207b   schedules for {
-0000be10: 7072 6f6a 6563 747d 203f 207b 6b69 6e64  project} ? {kind
-0000be20: 7d20 7b6e 616d 657d 220a 2020 2020 2020  } {name}".      
-0000be30: 2020 7265 7370 203d 2073 656c 662e 6170    resp = self.ap
-0000be40: 695f 6361 6c6c 2822 4745 5422 2c20 7061  i_call("GET", pa
-0000be50: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
-0000be60: 652c 2070 6172 616d 733d 7061 7261 6d73  e, params=params
-0000be70: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000be80: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0000be90: 6865 6d61 732e 5363 6865 6475 6c65 734f  hemas.SchedulesO
-0000bea0: 7574 7075 7428 2a2a 7265 7370 2e6a 736f  utput(**resp.jso
-0000beb0: 6e28 2929 0a0a 2020 2020 6465 6620 6465  n())..    def de
-0000bec0: 6c65 7465 5f73 6368 6564 756c 6528 7365  lete_schedule(se
-0000bed0: 6c66 2c20 7072 6f6a 6563 743a 2073 7472  lf, project: str
-0000bee0: 2c20 6e61 6d65 3a20 7374 7229 3a0a 2020  , name: str):.  
-0000bef0: 2020 2020 2020 2222 2244 656c 6574 6520        """Delete 
-0000bf00: 6120 7370 6563 6966 6963 2073 6368 6564  a specific sched
-0000bf10: 756c 6520 6279 206e 616d 652e 2222 220a  ule by name.""".
-0000bf20: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0000bf30: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
-0000bf40: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-0000bf50: 6a65 6374 0a20 2020 2020 2020 2070 6174  ject.        pat
-0000bf60: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-0000bf70: 7072 6f6a 6563 747d 2f73 6368 6564 756c  project}/schedul
-0000bf80: 6573 2f7b 6e61 6d65 7d22 0a20 2020 2020  es/{name}".     
-0000bf90: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
-0000bfa0: 203d 2066 2246 6169 6c65 6420 6465 6c65   = f"Failed dele
-0000bfb0: 7469 6e67 2073 6368 6564 756c 6520 7b70  ting schedule {p
-0000bfc0: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
-0000bfd0: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
-0000bfe0: 5f63 616c 6c28 2244 454c 4554 4522 2c20  _call("DELETE", 
-0000bff0: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
-0000c000: 6167 6529 0a0a 2020 2020 6465 6620 696e  age)..    def in
-0000c010: 766f 6b65 5f73 6368 6564 756c 6528 7365  voke_schedule(se
-0000c020: 6c66 2c20 7072 6f6a 6563 743a 2073 7472  lf, project: str
-0000c030: 2c20 6e61 6d65 3a20 7374 7229 3a0a 2020  , name: str):.  
-0000c040: 2020 2020 2020 2222 2245 7865 6375 7465        """Execute
-0000c050: 2074 6865 206f 626a 6563 7420 7265 6665   the object refe
-0000c060: 7265 6e63 6564 2062 7920 7468 6520 7363  renced by the sc
-0000c070: 6865 6475 6c65 2069 6d6d 6564 6961 7465  hedule immediate
-0000c080: 6c79 2e22 2222 0a0a 2020 2020 2020 2020  ly."""..        
-0000c090: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
-0000c0a0: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
-0000c0b0: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
-0000c0c0: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-0000c0d0: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-0000c0e0: 7363 6865 6475 6c65 732f 7b6e 616d 657d  schedules/{name}
-0000c0f0: 2f69 6e76 6f6b 6522 0a20 2020 2020 2020  /invoke".       
-0000c100: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-0000c110: 2066 2246 6169 6c65 6420 696e 766f 6b69   f"Failed invoki
-0000c120: 6e67 2073 6368 6564 756c 6520 7b70 726f  ng schedule {pro
-0000c130: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
-0000c140: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
-0000c150: 616c 6c28 2250 4f53 5422 2c20 7061 7468  all("POST", path
-0000c160: 2c20 6572 726f 725f 6d65 7373 6167 6529  , error_message)
-0000c170: 0a0a 2020 2020 6465 6620 7265 6d6f 7465  ..    def remote
-0000c180: 5f62 7569 6c64 6572 280a 2020 2020 2020  _builder(.      
-0000c190: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000c1a0: 6675 6e63 2c0a 2020 2020 2020 2020 7769  func,.        wi
-0000c1b0: 7468 5f6d 6c72 756e 2c0a 2020 2020 2020  th_mlrun,.      
-0000c1c0: 2020 6d6c 7275 6e5f 7665 7273 696f 6e5f    mlrun_version_
-0000c1d0: 7370 6563 6966 6965 723d 4e6f 6e65 2c0a  specifier=None,.
-0000c1e0: 2020 2020 2020 2020 736b 6970 5f64 6570          skip_dep
-0000c1f0: 6c6f 7965 643d 4661 6c73 652c 0a20 2020  loyed=False,.   
-0000c200: 2020 2020 2062 7569 6c64 6572 5f65 6e76       builder_env
-0000c210: 3d4e 6f6e 652c 0a20 2020 2029 3a0a 2020  =None,.    ):.  
-0000c220: 2020 2020 2020 2222 2242 7569 6c64 2074        """Build t
-0000c230: 6865 2070 6f64 2069 6d61 6765 2066 6f72  he pod image for
-0000c240: 2061 2066 756e 6374 696f 6e2c 2066 6f72   a function, for
-0000c250: 2065 7865 6375 7469 6f6e 206f 6e20 6120   execution on a 
-0000c260: 7265 6d6f 7465 2063 6c75 7374 6572 2e20  remote cluster. 
-0000c270: 5468 6973 2069 7320 6578 6563 7574 6564  This is executed
-0000c280: 2062 7920 7468 6520 4d4c 5275 6e0a 2020   by the MLRun.  
-0000c290: 2020 2020 2020 4150 4920 7365 7276 6572        API server
-0000c2a0: 2c20 616e 6420 6372 6561 7465 7320 6120  , and creates a 
-0000c2b0: 446f 636b 6572 2069 6d61 6765 206f 7574  Docker image out
-0000c2c0: 206f 6620 7468 6520 6675 6e63 7469 6f6e   of the function
-0000c2d0: 2070 726f 7669 6465 6420 616e 6420 616e   provided and an
-0000c2e0: 7920 7370 6563 6966 6963 2062 7569 6c64  y specific build
-0000c2f0: 0a20 2020 2020 2020 2069 6e73 7472 7563  .        instruc
-0000c300: 7469 6f6e 7320 7072 6f76 6964 6564 2077  tions provided w
-0000c310: 6974 6869 6e2e 2054 6869 7320 6973 2061  ithin. This is a
-0000c320: 2070 7265 2d72 6571 7569 7369 7465 2066   pre-requisite f
-0000c330: 6f72 2072 656d 6f74 656c 7920 6578 6563  or remotely exec
-0000c340: 7574 696e 6720 6120 6675 6e63 7469 6f6e  uting a function
-0000c350: 2c20 756e 6c65 7373 2075 7369 6e67 0a20  , unless using. 
-0000c360: 2020 2020 2020 2061 2070 7265 2d64 6570         a pre-dep
-0000c370: 6c6f 7965 6420 696d 6167 652e 0a0a 2020  loyed image...  
-0000c380: 2020 2020 2020 3a70 6172 616d 2066 756e        :param fun
-0000c390: 633a 2046 756e 6374 696f 6e20 746f 2062  c: Function to b
-0000c3a0: 7569 6c64 2e0a 2020 2020 2020 2020 3a70  uild..        :p
-0000c3b0: 6172 616d 2077 6974 685f 6d6c 7275 6e3a  aram with_mlrun:
-0000c3c0: 2057 6865 7468 6572 2074 6f20 6164 6420   Whether to add 
-0000c3d0: 4d4c 5275 6e20 7061 636b 6167 6520 746f  MLRun package to
-0000c3e0: 2074 6865 2062 7569 6c74 2070 6163 6b61   the built packa
-0000c3f0: 6765 2e20 5468 6973 2069 7320 6e6f 7420  ge. This is not 
-0000c400: 7265 7175 6972 6564 2069 6620 7573 696e  required if usin
-0000c410: 6720 6120 6261 7365 0a20 2020 2020 2020  g a base.       
-0000c420: 2020 2020 2069 6d61 6765 2074 6861 7420       image that 
-0000c430: 616c 7265 6164 7920 6861 7320 4d4c 5275  already has MLRu
-0000c440: 6e20 696e 2069 742e 0a20 2020 2020 2020  n in it..       
-0000c450: 203a 7061 7261 6d20 6d6c 7275 6e5f 7665   :param mlrun_ve
-0000c460: 7273 696f 6e5f 7370 6563 6966 6965 723a  rsion_specifier:
-0000c470: 2056 6572 7369 6f6e 206f 6620 4d4c 5275   Version of MLRu
-0000c480: 6e20 746f 2069 6e63 6c75 6465 2069 6e20  n to include in 
-0000c490: 7468 6520 6275 696c 7420 696d 6167 652e  the built image.
-0000c4a0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000c4b0: 736b 6970 5f64 6570 6c6f 7965 643a 2053  skip_deployed: S
-0000c4c0: 6b69 7020 7468 6520 6275 696c 6420 6966  kip the build if
-0000c4d0: 2077 6520 616c 7265 6164 7920 6861 7665   we already have
-0000c4e0: 2061 6e20 696d 6167 6520 666f 7220 7468   an image for th
-0000c4f0: 6520 6675 6e63 7469 6f6e 2e0a 2020 2020  e function..    
-0000c500: 2020 2020 3a70 6172 616d 2062 7569 6c64      :param build
-0000c510: 6572 5f65 6e76 3a20 2020 4b61 6e69 6b6f  er_env:   Kaniko
-0000c520: 2062 7569 6c64 6572 2070 6f64 2065 6e76   builder pod env
-0000c530: 2076 6172 7320 6469 6374 2028 666f 7220   vars dict (for 
-0000c540: 636f 6e66 6967 2f63 7265 6465 6e74 6961  config/credentia
-0000c550: 6c73 290a 2020 2020 2020 2020 2222 220a  ls).        """.
-0000c560: 0a20 2020 2020 2020 2074 7279 3a0a 2020  .        try:.  
-0000c570: 2020 2020 2020 2020 2020 7265 7120 3d20            req = 
-0000c580: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0000c590: 2020 2266 756e 6374 696f 6e22 3a20 6675    "function": fu
-0000c5a0: 6e63 2e74 6f5f 6469 6374 2829 2c0a 2020  nc.to_dict(),.  
-0000c5b0: 2020 2020 2020 2020 2020 2020 2020 2277                "w
-0000c5c0: 6974 685f 6d6c 7275 6e22 3a20 626f 6f6c  ith_mlrun": bool
-0000c5d0: 3273 7472 2877 6974 685f 6d6c 7275 6e29  2str(with_mlrun)
-0000c5e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000c5f0: 2020 2273 6b69 705f 6465 706c 6f79 6564    "skip_deployed
-0000c600: 223a 2073 6b69 705f 6465 706c 6f79 6564  ": skip_deployed
-0000c610: 2c0a 2020 2020 2020 2020 2020 2020 7d0a  ,.            }.
-0000c620: 2020 2020 2020 2020 2020 2020 6966 206d              if m
-0000c630: 6c72 756e 5f76 6572 7369 6f6e 5f73 7065  lrun_version_spe
-0000c640: 6369 6669 6572 3a0a 2020 2020 2020 2020  cifier:.        
-0000c650: 2020 2020 2020 2020 7265 715b 226d 6c72          req["mlr
-0000c660: 756e 5f76 6572 7369 6f6e 5f73 7065 6369  un_version_speci
-0000c670: 6669 6572 225d 203d 206d 6c72 756e 5f76  fier"] = mlrun_v
-0000c680: 6572 7369 6f6e 5f73 7065 6369 6669 6572  ersion_specifier
-0000c690: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000c6a0: 6275 696c 6465 725f 656e 763a 0a20 2020  builder_env:.   
-0000c6b0: 2020 2020 2020 2020 2020 2020 2072 6571               req
-0000c6c0: 5b22 6275 696c 6465 725f 656e 7622 5d20  ["builder_env"] 
-0000c6d0: 3d20 6275 696c 6465 725f 656e 760a 2020  = builder_env.  
-0000c6e0: 2020 2020 2020 2020 2020 7265 7370 203d            resp =
-0000c6f0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
-0000c700: 504f 5354 222c 2022 6275 696c 642f 6675  POST", "build/fu
-0000c710: 6e63 7469 6f6e 222c 206a 736f 6e3d 7265  nction", json=re
-0000c720: 7129 0a20 2020 2020 2020 2065 7863 6570  q).        excep
-0000c730: 7420 4f53 4572 726f 7220 6173 2065 7272  t OSError as err
-0000c740: 3a0a 2020 2020 2020 2020 2020 2020 6c6f  :.            lo
-0000c750: 6767 6572 2e65 7272 6f72 2866 2265 7272  gger.error(f"err
-0000c760: 6f72 2073 7562 6d69 7474 696e 6720 6275  or submitting bu
-0000c770: 696c 6420 7461 736b 3a20 7b65 7272 5f74  ild task: {err_t
-0000c780: 6f5f 7374 7228 6572 7229 7d22 290a 2020  o_str(err)}").  
-0000c790: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000c7a0: 4f53 4572 726f 7228 6622 6572 726f 723a  OSError(f"error:
-0000c7b0: 2063 616e 6e6f 7420 7375 626d 6974 2062   cannot submit b
-0000c7c0: 7569 6c64 2c20 7b65 7272 5f74 6f5f 7374  uild, {err_to_st
-0000c7d0: 7228 6572 7229 7d22 290a 0a20 2020 2020  r(err)}")..     
-0000c7e0: 2020 2069 6620 6e6f 7420 7265 7370 2e6f     if not resp.o
-0000c7f0: 6b3a 0a20 2020 2020 2020 2020 2020 206c  k:.            l
-0000c800: 6f67 6765 722e 6572 726f 7228 6622 6261  ogger.error(f"ba
-0000c810: 6420 7265 7370 2121 5c6e 7b72 6573 702e  d resp!!\n{resp.
-0000c820: 7465 7874 7d22 290a 2020 2020 2020 2020  text}").        
-0000c830: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000c840: 7272 6f72 2822 6261 6420 6675 6e63 7469  rror("bad functi
-0000c850: 6f6e 2072 756e 2072 6573 706f 6e73 6522  on run response"
-0000c860: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0000c870: 6e20 7265 7370 2e6a 736f 6e28 290a 0a20  n resp.json().. 
-0000c880: 2020 2064 6566 2067 6574 5f62 7569 6c64     def get_build
-0000c890: 6572 5f73 7461 7475 7328 0a20 2020 2020  er_status(.     
-0000c8a0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0000c8b0: 2066 756e 633a 2042 6173 6552 756e 7469   func: BaseRunti
-0000c8c0: 6d65 2c0a 2020 2020 2020 2020 6f66 6673  me,.        offs
-0000c8d0: 6574 3a20 696e 7420 3d20 302c 0a20 2020  et: int = 0,.   
-0000c8e0: 2020 2020 206c 6f67 733a 2062 6f6f 6c20       logs: bool 
-0000c8f0: 3d20 5472 7565 2c0a 2020 2020 2020 2020  = True,.        
-0000c900: 6c61 7374 5f6c 6f67 5f74 696d 6573 7461  last_log_timesta
-0000c910: 6d70 3a20 666c 6f61 7420 3d20 302e 302c  mp: float = 0.0,
-0000c920: 0a20 2020 2020 2020 2076 6572 626f 7365  .        verbose
-0000c930: 3a20 626f 6f6c 203d 2046 616c 7365 2c0a  : bool = False,.
-0000c940: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-0000c950: 2222 5265 7472 6965 7665 2074 6865 2073  ""Retrieve the s
-0000c960: 7461 7475 7320 6f66 2061 2062 7569 6c64  tatus of a build
-0000c970: 206f 7065 7261 7469 6f6e 2063 7572 7265   operation curre
-0000c980: 6e74 6c79 2069 6e20 7072 6f67 7265 7373  ntly in progress
-0000c990: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0000c9a0: 6d20 6675 6e63 3a20 2020 2020 2020 2020  m func:         
-0000c9b0: 2020 2020 2020 2046 756e 6374 696f 6e20         Function 
-0000c9c0: 6f62 6a65 6374 2074 6861 7420 6973 2062  object that is b
-0000c9d0: 6569 6e67 2062 7569 6c74 2e0a 2020 2020  eing built..    
-0000c9e0: 2020 2020 3a70 6172 616d 206f 6666 7365      :param offse
-0000c9f0: 743a 2020 2020 2020 2020 2020 2020 2020  t:              
-0000ca00: 4f66 6673 6574 2069 6e74 6f20 7468 6520  Offset into the 
-0000ca10: 6275 696c 6420 6c6f 6773 2074 6f20 7265  build logs to re
-0000ca20: 7472 6965 7665 206c 6f67 7320 6672 6f6d  trieve logs from
-0000ca30: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000ca40: 206c 6f67 733a 2020 2020 2020 2020 2020   logs:          
-0000ca50: 2020 2020 2020 5368 6f75 6c64 2062 7569        Should bui
-0000ca60: 6c64 206c 6f67 7320 6265 2072 6574 7269  ld logs be retri
-0000ca70: 6576 6564 2e0a 2020 2020 2020 2020 3a70  eved..        :p
-0000ca80: 6172 616d 206c 6173 745f 6c6f 675f 7469  aram last_log_ti
-0000ca90: 6d65 7374 616d 703a 2020 4c61 7374 2074  mestamp:  Last t
-0000caa0: 696d 6573 7461 6d70 206f 6620 6c6f 6773  imestamp of logs
-0000cab0: 2074 6861 7420 7765 7265 2061 6c72 6561   that were alrea
-0000cac0: 6479 2072 6574 7269 6576 6564 2e20 4675  dy retrieved. Fu
-0000cad0: 6e63 7469 6f6e 2077 696c 6c20 7265 7475  nction will retu
-0000cae0: 726e 206f 6e6c 7920 6c6f 6773 0a20 2020  rn only logs.   
-0000caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000cb10: 206c 6174 6572 2074 6861 6e20 7468 6973   later than this
-0000cb20: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
-0000cb30: 2020 2020 3a70 6172 616d 2076 6572 626f      :param verbo
-0000cb40: 7365 3a20 2020 2020 2020 2020 2020 2020  se:             
-0000cb50: 4164 6420 7665 7262 6f73 6520 6c6f 6773  Add verbose logs
-0000cb60: 2069 6e74 6f20 7468 6520 6f75 7470 7574   into the output
-0000cb70: 2e0a 0a20 2020 2020 2020 203a 7265 7475  ...        :retu
-0000cb80: 726e 733a 2054 6865 2066 6f6c 6c6f 7769  rns: The followi
-0000cb90: 6e67 2070 6172 616d 6574 6572 733a 0a0a  ng parameters:..
-0000cba0: 2020 2020 2020 2020 2020 2020 2d20 5465              - Te
-0000cbb0: 7874 206f 6620 6275 696c 6465 7220 6c6f  xt of builder lo
-0000cbc0: 6773 2e0a 2020 2020 2020 2020 2020 2020  gs..            
-0000cbd0: 2d20 5469 6d65 7374 616d 7020 6f66 206c  - Timestamp of l
-0000cbe0: 6173 7420 6c6f 6720 7265 7472 6965 7665  ast log retrieve
-0000cbf0: 642c 2074 6f20 6265 2075 7365 6420 696e  d, to be used in
-0000cc00: 2073 7562 7365 7175 656e 7420 6361 6c6c   subsequent call
-0000cc10: 7320 746f 2074 6869 7320 6675 6e63 7469  s to this functi
-0000cc20: 6f6e 2e0a 0a20 2020 2020 2020 2020 2020  on...           
-0000cc30: 2054 6865 2066 756e 6374 696f 6e20 616c   The function al
-0000cc40: 736f 2075 7064 6174 6573 2069 6e74 6572  so updates inter
-0000cc50: 6e61 6c20 6d65 6d62 6572 7320 6f66 2074  nal members of t
-0000cc60: 6865 2060 6066 756e 6360 6020 6f62 6a65  he ``func`` obje
-0000cc70: 6374 2074 6f20 7265 666c 6563 7420 6275  ct to reflect bu
-0000cc80: 696c 6420 7072 6f63 6573 7320 696e 666f  ild process info
-0000cc90: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000cca0: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000ccb0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0000ccc0: 207b 0a20 2020 2020 2020 2020 2020 2020   {.             
-0000ccd0: 2020 2022 6e61 6d65 223a 206e 6f72 6d61     "name": norma
-0000cce0: 6c69 7a65 5f6e 616d 6528 6675 6e63 2e6d  lize_name(func.m
-0000ccf0: 6574 6164 6174 612e 6e61 6d65 292c 0a20  etadata.name),. 
-0000cd00: 2020 2020 2020 2020 2020 2020 2020 2022                 "
-0000cd10: 7072 6f6a 6563 7422 3a20 6675 6e63 2e6d  project": func.m
-0000cd20: 6574 6164 6174 612e 7072 6f6a 6563 742c  etadata.project,
-0000cd30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000cd40: 2022 7461 6722 3a20 6675 6e63 2e6d 6574   "tag": func.met
-0000cd50: 6164 6174 612e 7461 672c 0a20 2020 2020  adata.tag,.     
-0000cd60: 2020 2020 2020 2020 2020 2022 6c6f 6773             "logs
-0000cd70: 223a 2062 6f6f 6c32 7374 7228 6c6f 6773  ": bool2str(logs
-0000cd80: 292c 0a20 2020 2020 2020 2020 2020 2020  ),.             
-0000cd90: 2020 2022 6f66 6673 6574 223a 2073 7472     "offset": str
-0000cda0: 286f 6666 7365 7429 2c0a 2020 2020 2020  (offset),.      
-0000cdb0: 2020 2020 2020 2020 2020 226c 6173 745f            "last_
-0000cdc0: 6c6f 675f 7469 6d65 7374 616d 7022 3a20  log_timestamp": 
-0000cdd0: 7374 7228 6c61 7374 5f6c 6f67 5f74 696d  str(last_log_tim
-0000cde0: 6573 7461 6d70 292c 0a20 2020 2020 2020  estamp),.       
-0000cdf0: 2020 2020 2020 2020 2022 7665 7262 6f73           "verbos
-0000ce00: 6522 3a20 626f 6f6c 3273 7472 2876 6572  e": bool2str(ver
-0000ce10: 626f 7365 292c 0a20 2020 2020 2020 2020  bose),.         
-0000ce20: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-0000ce30: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
-0000ce40: 5f63 616c 6c28 2247 4554 222c 2022 6275  _call("GET", "bu
-0000ce50: 696c 642f 7374 6174 7573 222c 2070 6172  ild/status", par
-0000ce60: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
-0000ce70: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-0000ce80: 6f72 2061 7320 6572 723a 0a20 2020 2020  or as err:.     
-0000ce90: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-0000cea0: 726f 7228 6622 6572 726f 7220 6765 7474  ror(f"error gett
-0000ceb0: 696e 6720 6275 696c 6420 7374 6174 7573  ing build status
-0000cec0: 3a20 7b65 7272 5f74 6f5f 7374 7228 6572  : {err_to_str(er
-0000ced0: 7229 7d22 290a 2020 2020 2020 2020 2020  r)}").          
-0000cee0: 2020 7261 6973 6520 4f53 4572 726f 7228    raise OSError(
-0000cef0: 6622 6572 726f 723a 2063 616e 6e6f 7420  f"error: cannot 
-0000cf00: 6765 7420 6275 696c 6420 7374 6174 7573  get build status
-0000cf10: 2c20 7b65 7272 5f74 6f5f 7374 7228 6572  , {err_to_str(er
-0000cf20: 7229 7d22 290a 0a20 2020 2020 2020 2069  r)}")..        i
-0000cf30: 6620 6e6f 7420 7265 7370 2e6f 6b3a 0a20  f not resp.ok:. 
-0000cf40: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000cf50: 722e 7761 726e 696e 6728 6622 6661 696c  r.warning(f"fail
-0000cf60: 6564 2072 6573 702c 207b 7265 7370 2e74  ed resp, {resp.t
-0000cf70: 6578 747d 2229 0a20 2020 2020 2020 2020  ext}").         
-0000cf80: 2020 2072 6169 7365 2052 756e 4442 4572     raise RunDBEr
-0000cf90: 726f 7228 2262 6164 2066 756e 6374 696f  ror("bad functio
-0000cfa0: 6e20 6275 696c 6420 7265 7370 6f6e 7365  n build response
-0000cfb0: 2229 0a0a 2020 2020 2020 2020 6966 2072  ")..        if r
-0000cfc0: 6573 702e 6865 6164 6572 733a 0a20 2020  esp.headers:.   
-0000cfd0: 2020 2020 2020 2020 2066 756e 632e 7374           func.st
-0000cfe0: 6174 7573 2e73 7461 7465 203d 2072 6573  atus.state = res
-0000cff0: 702e 6865 6164 6572 732e 6765 7428 2278  p.headers.get("x
-0000d000: 2d6d 6c72 756e 2d66 756e 6374 696f 6e2d  -mlrun-function-
-0000d010: 7374 6174 7573 222c 2022 2229 0a20 2020  status", "").   
-0000d020: 2020 2020 2020 2020 206c 6173 745f 6c6f           last_lo
-0000d030: 675f 7469 6d65 7374 616d 7020 3d20 666c  g_timestamp = fl
-0000d040: 6f61 7428 0a20 2020 2020 2020 2020 2020  oat(.           
-0000d050: 2020 2020 2072 6573 702e 6865 6164 6572       resp.header
-0000d060: 732e 6765 7428 2278 2d6d 6c72 756e 2d6c  s.get("x-mlrun-l
-0000d070: 6173 742d 7469 6d65 7374 616d 7022 2c20  ast-timestamp", 
-0000d080: 2230 2e30 2229 0a20 2020 2020 2020 2020  "0.0").         
-0000d090: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
-0000d0a0: 2069 6620 6675 6e63 2e6b 696e 6420 696e   if func.kind in
-0000d0b0: 206d 6c72 756e 2e72 756e 7469 6d65 732e   mlrun.runtimes.
-0000d0c0: 5275 6e74 696d 654b 696e 6473 2e6e 7563  RuntimeKinds.nuc
-0000d0d0: 6c69 6f5f 7275 6e74 696d 6573 2829 3a0a  lio_runtimes():.
-0000d0e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d0f0: 6675 6e63 2e73 7461 7475 732e 6164 6472  func.status.addr
-0000d100: 6573 7320 3d20 7265 7370 2e68 6561 6465  ess = resp.heade
-0000d110: 7273 2e67 6574 2822 782d 6d6c 7275 6e2d  rs.get("x-mlrun-
-0000d120: 6164 6472 6573 7322 2c20 2222 290a 2020  address", "").  
-0000d130: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000d140: 6e63 2e73 7461 7475 732e 6e75 636c 696f  nc.status.nuclio
-0000d150: 5f6e 616d 6520 3d20 7265 7370 2e68 6561  _name = resp.hea
-0000d160: 6465 7273 2e67 6574 2822 782d 6d6c 7275  ders.get("x-mlru
-0000d170: 6e2d 6e61 6d65 222c 2022 2229 0a20 2020  n-name", "").   
-0000d180: 2020 2020 2020 2020 2020 2020 2066 756e               fun
-0000d190: 632e 7374 6174 7573 2e69 6e74 6572 6e61  c.status.interna
-0000d1a0: 6c5f 696e 766f 6361 7469 6f6e 5f75 726c  l_invocation_url
-0000d1b0: 7320 3d20 7265 7370 2e68 6561 6465 7273  s = resp.headers
-0000d1c0: 2e67 6574 280a 2020 2020 2020 2020 2020  .get(.          
-0000d1d0: 2020 2020 2020 2020 2020 2278 2d6d 6c72            "x-mlr
-0000d1e0: 756e 2d69 6e74 6572 6e61 6c2d 696e 766f  un-internal-invo
-0000d1f0: 6361 7469 6f6e 2d75 726c 7322 2c20 2222  cation-urls", ""
-0000d200: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d210: 2029 2e73 706c 6974 2822 2c22 290a 2020   ).split(",").  
-0000d220: 2020 2020 2020 2020 2020 2020 2020 6675                fu
-0000d230: 6e63 2e73 7461 7475 732e 6578 7465 726e  nc.status.extern
-0000d240: 616c 5f69 6e76 6f63 6174 696f 6e5f 7572  al_invocation_ur
-0000d250: 6c73 203d 2072 6573 702e 6865 6164 6572  ls = resp.header
-0000d260: 732e 6765 7428 0a20 2020 2020 2020 2020  s.get(.         
-0000d270: 2020 2020 2020 2020 2020 2022 782d 6d6c             "x-ml
-0000d280: 7275 6e2d 6578 7465 726e 616c 2d69 6e76  run-external-inv
-0000d290: 6f63 6174 696f 6e2d 7572 6c73 222c 2022  ocation-urls", "
-0000d2a0: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0000d2b0: 2020 292e 7370 6c69 7428 222c 2229 0a20    ).split(","). 
-0000d2c0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-0000d2d0: 756e 632e 7374 6174 7573 2e63 6f6e 7461  unc.status.conta
-0000d2e0: 696e 6572 5f69 6d61 6765 203d 2072 6573  iner_image = res
-0000d2f0: 702e 6865 6164 6572 732e 6765 7428 0a20  p.headers.get(. 
-0000d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d310: 2020 2022 782d 6d6c 7275 6e2d 636f 6e74     "x-mlrun-cont
-0000d320: 6169 6e65 722d 696d 6167 6522 2c20 2222  ainer-image", ""
-0000d330: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d340: 2029 0a20 2020 2020 2020 2020 2020 2065   ).            e
-0000d350: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000d360: 2020 2020 2066 756e 632e 7374 6174 7573       func.status
-0000d370: 2e62 7569 6c64 5f70 6f64 203d 2072 6573  .build_pod = res
-0000d380: 702e 6865 6164 6572 732e 6765 7428 2262  p.headers.get("b
-0000d390: 7569 6c64 6572 5f70 6f64 222c 2022 2229  uilder_pod", "")
-0000d3a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d3b0: 2066 756e 632e 7370 6563 2e69 6d61 6765   func.spec.image
-0000d3c0: 203d 2072 6573 702e 6865 6164 6572 732e   = resp.headers.
-0000d3d0: 6765 7428 2266 756e 6374 696f 6e5f 696d  get("function_im
-0000d3e0: 6167 6522 2c20 2222 290a 0a20 2020 2020  age", "")..     
-0000d3f0: 2020 2074 6578 7420 3d20 2222 0a20 2020     text = "".   
-0000d400: 2020 2020 2069 6620 7265 7370 2e63 6f6e       if resp.con
-0000d410: 7465 6e74 3a0a 2020 2020 2020 2020 2020  tent:.          
-0000d420: 2020 7465 7874 203d 2072 6573 702e 636f    text = resp.co
-0000d430: 6e74 656e 742e 6465 636f 6465 2829 0a20  ntent.decode(). 
-0000d440: 2020 2020 2020 2072 6574 7572 6e20 7465         return te
-0000d450: 7874 2c20 6c61 7374 5f6c 6f67 5f74 696d  xt, last_log_tim
-0000d460: 6573 7461 6d70 0a0a 2020 2020 6465 6620  estamp..    def 
-0000d470: 7265 6d6f 7465 5f73 7461 7274 2873 656c  remote_start(sel
-0000d480: 662c 2066 756e 635f 7572 6c29 202d 3e20  f, func_url) -> 
-0000d490: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0000d4a0: 656d 6173 2e42 6163 6b67 726f 756e 6454  emas.BackgroundT
-0000d4b0: 6173 6b3a 0a20 2020 2020 2020 2022 2222  ask:.        """
-0000d4c0: 4578 6563 7574 6520 6120 6675 6e63 7469  Execute a functi
-0000d4d0: 6f6e 2072 656d 6f74 656c 792c 2055 7365  on remotely, Use
-0000d4e0: 6420 666f 7220 6060 6461 736b 6060 2066  d for ``dask`` f
-0000d4f0: 756e 6374 696f 6e73 2e0a 0a20 2020 2020  unctions...     
-0000d500: 2020 203a 7061 7261 6d20 6675 6e63 5f75     :param func_u
-0000d510: 726c 3a20 5552 4c20 746f 2074 6865 2066  rl: URL to the f
-0000d520: 756e 6374 696f 6e20 746f 2062 6520 6578  unction to be ex
-0000d530: 6563 7574 6564 2e0a 2020 2020 2020 2020  ecuted..        
-0000d540: 3a72 6574 7572 6e73 3a20 4120 4261 636b  :returns: A Back
-0000d550: 6772 6f75 6e64 5461 736b 206f 626a 6563  groundTask objec
-0000d560: 742c 2077 6974 6820 6465 7461 696c 7320  t, with details 
-0000d570: 6f6e 2065 7865 6375 7469 6f6e 2070 726f  on execution pro
-0000d580: 6365 7373 2061 6e64 2069 7473 2073 7461  cess and its sta
-0000d590: 7475 732e 0a20 2020 2020 2020 2022 2222  tus..        """
-0000d5a0: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
-0000d5b0: 2020 2020 2020 2020 2020 2072 6571 203d             req =
-0000d5c0: 207b 2266 756e 6374 696f 6e55 726c 223a   {"functionUrl":
-0000d5d0: 2066 756e 635f 7572 6c7d 0a20 2020 2020   func_url}.     
-0000d5e0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-0000d5f0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-0000d600: 2020 2020 2020 2020 2020 2020 2022 504f               "PO
-0000d610: 5354 222c 0a20 2020 2020 2020 2020 2020  ST",.           
-0000d620: 2020 2020 2022 7374 6172 742f 6675 6e63       "start/func
-0000d630: 7469 6f6e 222c 0a20 2020 2020 2020 2020  tion",.         
-0000d640: 2020 2020 2020 206a 736f 6e3d 7265 712c         json=req,
-0000d650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d660: 2074 696d 656f 7574 3d69 6e74 2863 6f6e   timeout=int(con
-0000d670: 6669 672e 7375 626d 6974 5f74 696d 656f  fig.submit_timeo
-0000d680: 7574 2920 6f72 2036 302c 0a20 2020 2020  ut) or 60,.     
-0000d690: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
-0000d6a0: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
-0000d6b0: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
-0000d6c0: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
-0000d6d0: 2866 2265 7272 6f72 2073 7461 7274 696e  (f"error startin
-0000d6e0: 6720 6675 6e63 7469 6f6e 3a20 7b65 7272  g function: {err
-0000d6f0: 5f74 6f5f 7374 7228 6572 7229 7d22 290a  _to_str(err)}").
-0000d700: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-0000d710: 6520 4f53 4572 726f 7228 6622 6572 726f  e OSError(f"erro
-0000d720: 723a 2063 616e 6e6f 7420 7374 6172 7420  r: cannot start 
-0000d730: 6675 6e63 7469 6f6e 2c20 7b65 7272 5f74  function, {err_t
-0000d740: 6f5f 7374 7228 6572 7229 7d22 290a 0a20  o_str(err)}").. 
-0000d750: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-0000d760: 7370 2e6f 6b3a 0a20 2020 2020 2020 2020  sp.ok:.         
-0000d770: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
-0000d780: 6622 6261 6420 7265 7370 2121 5c6e 7b72  f"bad resp!!\n{r
-0000d790: 6573 702e 7465 7874 7d22 290a 2020 2020  esp.text}").    
-0000d7a0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000d7b0: 6c75 6545 7272 6f72 2822 6261 6420 6675  lueError("bad fu
-0000d7c0: 6e63 7469 6f6e 2073 7461 7274 2072 6573  nction start res
-0000d7d0: 706f 6e73 6522 290a 0a20 2020 2020 2020  ponse")..       
-0000d7e0: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
-0000d7f0: 6d6d 6f6e 2e73 6368 656d 6173 2e42 6163  mmon.schemas.Bac
-0000d800: 6b67 726f 756e 6454 6173 6b28 2a2a 7265  kgroundTask(**re
-0000d810: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
-0000d820: 6465 6620 6765 745f 7072 6f6a 6563 745f  def get_project_
-0000d830: 6261 636b 6772 6f75 6e64 5f74 6173 6b28  background_task(
-0000d840: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0000d850: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-0000d860: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
-0000d870: 653a 2073 7472 2c0a 2020 2020 2920 2d3e  e: str,.    ) ->
-0000d880: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0000d890: 6865 6d61 732e 4261 636b 6772 6f75 6e64  hemas.Background
-0000d8a0: 5461 736b 3a0a 2020 2020 2020 2020 2222  Task:.        ""
-0000d8b0: 2252 6574 7269 6576 6520 7570 6461 7465  "Retrieve update
-0000d8c0: 6420 696e 666f 726d 6174 696f 6e20 6f6e  d information on
-0000d8d0: 2061 2070 726f 6a65 6374 2062 6163 6b67   a project backg
-0000d8e0: 726f 756e 6420 7461 736b 2062 6569 6e67  round task being
-0000d8f0: 2065 7865 6375 7465 642e 2222 220a 0a20   executed.""".. 
-0000d900: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
-0000d910: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
-0000d920: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
-0000d930: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
-0000d940: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0000d950: 6f6a 6563 747d 2f62 6163 6b67 726f 756e  oject}/backgroun
-0000d960: 642d 7461 736b 732f 7b6e 616d 657d 220a  d-tasks/{name}".
-0000d970: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-0000d980: 7373 6167 6520 3d20 280a 2020 2020 2020  ssage = (.      
-0000d990: 2020 2020 2020 6622 4661 696c 6564 2067        f"Failed g
-0000d9a0: 6574 7469 6e67 2070 726f 6a65 6374 2062  etting project b
-0000d9b0: 6163 6b67 726f 756e 6420 7461 736b 2e20  ackground task. 
-0000d9c0: 7072 6f6a 6563 743d 7b70 726f 6a65 6374  project={project
-0000d9d0: 7d2c 206e 616d 653d 7b6e 616d 657d 220a  }, name={name}".
-0000d9e0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000d9f0: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
-0000da00: 662e 6170 695f 6361 6c6c 2822 4745 5422  f.api_call("GET"
-0000da10: 2c20 7061 7468 2c20 6572 726f 725f 6d65  , path, error_me
-0000da20: 7373 6167 6529 0a20 2020 2020 2020 2072  ssage).        r
-0000da30: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
-0000da40: 6f6e 2e73 6368 656d 6173 2e42 6163 6b67  on.schemas.Backg
-0000da50: 726f 756e 6454 6173 6b28 2a2a 7265 7370  roundTask(**resp
-0000da60: 6f6e 7365 2e6a 736f 6e28 2929 0a0a 2020  onse.json())..  
-0000da70: 2020 6465 6620 6765 745f 6261 636b 6772    def get_backgr
-0000da80: 6f75 6e64 5f74 6173 6b28 7365 6c66 2c20  ound_task(self, 
-0000da90: 6e61 6d65 3a20 7374 7229 202d 3e20 6d6c  name: str) -> ml
-0000daa0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000dab0: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
-0000dac0: 6b3a 0a20 2020 2020 2020 2022 2222 5265  k:.        """Re
-0000dad0: 7472 6965 7665 2075 7064 6174 6564 2069  trieve updated i
-0000dae0: 6e66 6f72 6d61 7469 6f6e 206f 6e20 6120  nformation on a 
-0000daf0: 6261 636b 6772 6f75 6e64 2074 6173 6b20  background task 
-0000db00: 6265 696e 6720 6578 6563 7574 6564 2e22  being executed."
-0000db10: 2222 0a0a 2020 2020 2020 2020 7061 7468  ""..        path
-0000db20: 203d 2066 2262 6163 6b67 726f 756e 642d   = f"background-
-0000db30: 7461 736b 732f 7b6e 616d 657d 220a 2020  tasks/{name}".  
-0000db40: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-0000db50: 6167 6520 3d20 6622 4661 696c 6564 2067  age = f"Failed g
-0000db60: 6574 7469 6e67 2062 6163 6b67 726f 756e  etting backgroun
-0000db70: 6420 7461 736b 2e20 6e61 6d65 3d7b 6e61  d task. name={na
-0000db80: 6d65 7d22 0a20 2020 2020 2020 2072 6573  me}".        res
-0000db90: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-0000dba0: 5f63 616c 6c28 2247 4554 222c 2070 6174  _call("GET", pat
-0000dbb0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-0000dbc0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-0000dbd0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0000dbe0: 6865 6d61 732e 4261 636b 6772 6f75 6e64  hemas.Background
-0000dbf0: 5461 736b 282a 2a72 6573 706f 6e73 652e  Task(**response.
-0000dc00: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-0000dc10: 2072 656d 6f74 655f 7374 6174 7573 2873   remote_status(s
-0000dc20: 656c 662c 2070 726f 6a65 6374 2c20 6e61  elf, project, na
-0000dc30: 6d65 2c20 6b69 6e64 2c20 7365 6c65 6374  me, kind, select
-0000dc40: 6f72 293a 0a20 2020 2020 2020 2022 2222  or):.        """
-0000dc50: 5265 7472 6965 7665 2073 7461 7475 7320  Retrieve status 
-0000dc60: 6f66 2061 2066 756e 6374 696f 6e20 6265  of a function be
-0000dc70: 696e 6720 6578 6563 7574 6564 2072 656d  ing executed rem
-0000dc80: 6f74 656c 7920 2872 656c 6576 616e 7420  otely (relevant 
-0000dc90: 746f 2060 6064 6173 6b60 6020 6675 6e63  to ``dask`` func
-0000dca0: 7469 6f6e 7329 2e0a 0a20 2020 2020 2020  tions)...       
-0000dcb0: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
-0000dcc0: 2054 6865 2070 726f 6a65 6374 206f 6620   The project of 
-0000dcd0: 7468 6520 6675 6e63 7469 6f6e 0a20 2020  the function.   
-0000dce0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-0000dcf0: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
-0000dd00: 6520 6675 6e63 7469 6f6e 0a20 2020 2020  e function.     
-0000dd10: 2020 203a 7061 7261 6d20 6b69 6e64 3a20     :param kind: 
-0000dd20: 5468 6520 6b69 6e64 206f 6620 7468 6520  The kind of the 
-0000dd30: 6675 6e63 7469 6f6e 2c20 6375 7272 656e  function, curren
-0000dd40: 746c 7920 6060 6461 736b 6060 2069 7320  tly ``dask`` is 
-0000dd50: 7375 7070 6f72 7465 642e 0a20 2020 2020  supported..     
-0000dd60: 2020 203a 7061 7261 6d20 7365 6c65 6374     :param select
-0000dd70: 6f72 3a20 5365 6c65 6374 6f72 2063 6c61  or: Selector cla
-0000dd80: 7573 6520 746f 2062 6520 6170 706c 6965  use to be applie
-0000dd90: 6420 746f 2074 6865 204b 7562 6572 6e65  d to the Kuberne
-0000dda0: 7465 7320 7374 6174 7573 2071 7565 7279  tes status query
-0000ddb0: 2074 6f20 6669 6c74 6572 2074 6865 2072   to filter the r
-0000ddc0: 6573 756c 7473 2e0a 2020 2020 2020 2020  esults..        
-0000ddd0: 2222 220a 0a20 2020 2020 2020 2074 7279  """..        try
-0000dde0: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0000ddf0: 7120 3d20 7b22 6b69 6e64 223a 206b 696e  q = {"kind": kin
-0000de00: 642c 2022 7365 6c65 6374 6f72 223a 2073  d, "selector": s
-0000de10: 656c 6563 746f 722c 2022 7072 6f6a 6563  elector, "projec
-0000de20: 7422 3a20 7072 6f6a 6563 742c 2022 6e61  t": project, "na
-0000de30: 6d65 223a 206e 616d 657d 0a20 2020 2020  me": name}.     
-0000de40: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-0000de50: 6c66 2e61 7069 5f63 616c 6c28 2250 4f53  lf.api_call("POS
-0000de60: 5422 2c20 2273 7461 7475 732f 6675 6e63  T", "status/func
-0000de70: 7469 6f6e 222c 206a 736f 6e3d 7265 7129  tion", json=req)
-0000de80: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000de90: 4f53 4572 726f 7220 6173 2065 7272 3a0a  OSError as err:.
-0000dea0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0000deb0: 6572 2e65 7272 6f72 2866 2265 7272 6f72  er.error(f"error
-0000dec0: 2073 7461 7274 696e 6720 6675 6e63 7469   starting functi
-0000ded0: 6f6e 3a20 7b65 7272 5f74 6f5f 7374 7228  on: {err_to_str(
-0000dee0: 6572 7229 7d22 290a 2020 2020 2020 2020  err)}").        
-0000def0: 2020 2020 7261 6973 6520 4f53 4572 726f      raise OSErro
-0000df00: 7228 6622 6572 726f 723a 2063 616e 6e6f  r(f"error: canno
-0000df10: 7420 7374 6172 7420 6675 6e63 7469 6f6e  t start function
-0000df20: 2c20 7b65 7272 5f74 6f5f 7374 7228 6572  , {err_to_str(er
-0000df30: 7229 7d22 290a 0a20 2020 2020 2020 2069  r)}")..        i
-0000df40: 6620 6e6f 7420 7265 7370 2e6f 6b3a 0a20  f not resp.ok:. 
-0000df50: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0000df60: 722e 6572 726f 7228 6622 6261 6420 7265  r.error(f"bad re
-0000df70: 7370 2121 5c6e 7b72 6573 702e 7465 7874  sp!!\n{resp.text
-0000df80: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
-0000df90: 7261 6973 6520 5661 6c75 6545 7272 6f72  raise ValueError
-0000dfa0: 2822 6261 6420 6675 6e63 7469 6f6e 2073  ("bad function s
-0000dfb0: 7461 7475 7320 7265 7370 6f6e 7365 2229  tatus response")
-0000dfc0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-0000dfd0: 2072 6573 702e 6a73 6f6e 2829 5b22 6461   resp.json()["da
-0000dfe0: 7461 225d 0a0a 2020 2020 6465 6620 7375  ta"]..    def su
-0000dff0: 626d 6974 5f6a 6f62 280a 2020 2020 2020  bmit_job(.      
-0000e000: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0000e010: 7275 6e73 7065 632c 0a20 2020 2020 2020  runspec,.       
-0000e020: 2073 6368 6564 756c 653a 2055 6e69 6f6e   schedule: Union
-0000e030: 5b73 7472 2c20 6d6c 7275 6e2e 636f 6d6d  [str, mlrun.comm
-0000e040: 6f6e 2e73 6368 656d 6173 2e53 6368 6564  on.schemas.Sched
-0000e050: 756c 6543 726f 6e54 7269 6767 6572 5d20  uleCronTrigger] 
-0000e060: 3d20 4e6f 6e65 2c0a 2020 2020 293a 0a20  = None,.    ):. 
-0000e070: 2020 2020 2020 2022 2222 5375 626d 6974         """Submit
-0000e080: 2061 206a 6f62 2066 6f72 2072 656d 6f74   a job for remot
-0000e090: 6520 6578 6563 7574 696f 6e2e 0a0a 2020  e execution...  
-0000e0a0: 2020 2020 2020 3a70 6172 616d 2072 756e        :param run
-0000e0b0: 7370 6563 3a20 5468 6520 7275 6e74 696d  spec: The runtim
-0000e0c0: 6520 6f62 6a65 6374 2073 7065 6320 2854  e object spec (T
-0000e0d0: 6173 6b29 2074 6f20 6578 6563 7574 652e  ask) to execute.
-0000e0e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-0000e0f0: 7363 6865 6475 6c65 3a20 5768 6574 6865  schedule: Whethe
-0000e100: 7220 746f 2073 6368 6564 756c 6520 7468  r to schedule th
-0000e110: 6973 206a 6f62 2075 7369 6e67 2061 2043  is job using a C
-0000e120: 726f 6e20 7472 6967 6765 722e 2049 6620  ron trigger. If 
-0000e130: 6e6f 7420 7370 6563 6966 6965 642c 2074  not specified, t
-0000e140: 6865 206a 6f62 2077 696c 6c20 6265 2073  he job will be s
-0000e150: 7562 6d69 7474 6564 0a20 2020 2020 2020  ubmitted.       
-0000e160: 2020 2020 2069 6d6d 6564 6961 7465 6c79       immediately
-0000e170: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-0000e180: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
-0000e190: 2020 2020 2020 2020 7265 7120 3d20 7b22          req = {"
-0000e1a0: 7461 736b 223a 2072 756e 7370 6563 2e74  task": runspec.t
-0000e1b0: 6f5f 6469 6374 2829 7d0a 2020 2020 2020  o_dict()}.      
-0000e1c0: 2020 2020 2020 6966 2073 6368 6564 756c        if schedul
-0000e1d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
-0000e1e0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-0000e1f0: 2873 6368 6564 756c 652c 206d 6c72 756e  (schedule, mlrun
-0000e200: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0000e210: 5363 6865 6475 6c65 4372 6f6e 5472 6967  ScheduleCronTrig
-0000e220: 6765 7229 3a0a 2020 2020 2020 2020 2020  ger):.          
-0000e230: 2020 2020 2020 2020 2020 7363 6865 6475            schedu
-0000e240: 6c65 203d 2073 6368 6564 756c 652e 6469  le = schedule.di
-0000e250: 6374 2829 0a20 2020 2020 2020 2020 2020  ct().           
-0000e260: 2020 2020 2072 6571 5b22 7363 6865 6475       req["schedu
-0000e270: 6c65 225d 203d 2073 6368 6564 756c 650a  le"] = schedule.
-0000e280: 2020 2020 2020 2020 2020 2020 7469 6d65              time
-0000e290: 6f75 7420 3d20 2869 6e74 2863 6f6e 6669  out = (int(confi
-0000e2a0: 672e 7375 626d 6974 5f74 696d 656f 7574  g.submit_timeout
-0000e2b0: 2920 6f72 2031 3230 2920 2b20 3230 0a20  ) or 120) + 20. 
-0000e2c0: 2020 2020 2020 2020 2020 2072 6573 7020             resp 
-0000e2d0: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
-0000e2e0: 2250 4f53 5422 2c20 2273 7562 6d69 745f  "POST", "submit_
-0000e2f0: 6a6f 6222 2c20 6a73 6f6e 3d72 6571 2c20  job", json=req, 
-0000e300: 7469 6d65 6f75 743d 7469 6d65 6f75 7429  timeout=timeout)
-0000e310: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
-0000e320: 2072 6571 7565 7374 732e 4854 5450 4572   requests.HTTPEr
-0000e330: 726f 7220 6173 2065 7272 3a0a 2020 2020  ror as err:.    
-0000e340: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
-0000e350: 7272 6f72 2866 2265 7272 6f72 2073 7562  rror(f"error sub
-0000e360: 6d69 7474 696e 6720 7461 736b 3a20 7b65  mitting task: {e
-0000e370: 7272 5f74 6f5f 7374 7228 6572 7229 7d22  rr_to_str(err)}"
-0000e380: 290a 2020 2020 2020 2020 2020 2020 2320  ).            # 
-0000e390: 6e6f 7420 6372 6561 7469 6e67 2061 206e  not creating a n
-0000e3a0: 6577 2065 7863 6570 7469 6f6e 2068 6572  ew exception her
-0000e3b0: 652c 2069 6e20 6f72 6465 7220 746f 206b  e, in order to k
-0000e3c0: 6565 7020 7468 6520 7265 7370 6f6e 7365  eep the response
-0000e3d0: 2061 6e64 2073 7461 7475 7320 636f 6465   and status code
-0000e3e0: 2069 6e20 7468 6520 6578 6365 7074 696f   in the exceptio
-0000e3f0: 6e0a 2020 2020 2020 2020 2020 2020 7261  n.            ra
-0000e400: 6973 650a 0a20 2020 2020 2020 2065 7863  ise..        exc
-0000e410: 6570 7420 4f53 4572 726f 7220 6173 2065  ept OSError as e
-0000e420: 7272 3a0a 2020 2020 2020 2020 2020 2020  rr:.            
-0000e430: 6c6f 6767 6572 2e65 7272 6f72 2866 2265  logger.error(f"e
-0000e440: 7272 6f72 2073 7562 6d69 7474 696e 6720  rror submitting 
-0000e450: 7461 736b 3a20 7b65 7272 5f74 6f5f 7374  task: {err_to_st
-0000e460: 7228 6572 7229 7d22 290a 2020 2020 2020  r(err)}").      
-0000e470: 2020 2020 2020 7261 6973 6520 4f53 4572        raise OSEr
-0000e480: 726f 7228 2265 7272 6f72 3a20 6361 6e6e  ror("error: cann
-0000e490: 6f74 2073 7562 6d69 7420 7461 736b 2229  ot submit task")
-0000e4a0: 2066 726f 6d20 6572 720a 0a20 2020 2020   from err..     
-0000e4b0: 2020 2069 6620 6e6f 7420 7265 7370 2e6f     if not resp.o
-0000e4c0: 6b3a 0a20 2020 2020 2020 2020 2020 206c  k:.            l
-0000e4d0: 6f67 6765 722e 6572 726f 7228 6622 6261  ogger.error(f"ba
-0000e4e0: 6420 7265 7370 2121 5c6e 7b72 6573 702e  d resp!!\n{resp.
-0000e4f0: 7465 7874 7d22 290a 2020 2020 2020 2020  text}").        
-0000e500: 2020 2020 7261 6973 6520 5661 6c75 6545      raise ValueE
-0000e510: 7272 6f72 2866 2262 6164 2066 756e 6374  rror(f"bad funct
-0000e520: 696f 6e20 7275 6e20 7265 7370 6f6e 7365  ion run response
-0000e530: 2c20 7b72 6573 702e 7465 7874 7d22 290a  , {resp.text}").
-0000e540: 0a20 2020 2020 2020 2072 6573 7020 3d20  .        resp = 
-0000e550: 7265 7370 2e6a 736f 6e28 290a 2020 2020  resp.json().    
-0000e560: 2020 2020 7265 7475 726e 2072 6573 705b      return resp[
-0000e570: 2264 6174 6122 5d0a 0a20 2020 2064 6566  "data"]..    def
-0000e580: 2073 7562 6d69 745f 7069 7065 6c69 6e65   submit_pipeline
-0000e590: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-0000e5a0: 2020 2020 2020 2020 7072 6f6a 6563 742c          project,
-0000e5b0: 0a20 2020 2020 2020 2070 6970 656c 696e  .        pipelin
-0000e5c0: 652c 0a20 2020 2020 2020 2061 7267 756d  e,.        argum
-0000e5d0: 656e 7473 3d4e 6f6e 652c 0a20 2020 2020  ents=None,.     
-0000e5e0: 2020 2065 7870 6572 696d 656e 743d 4e6f     experiment=No
-0000e5f0: 6e65 2c0a 2020 2020 2020 2020 7275 6e3d  ne,.        run=
-0000e600: 4e6f 6e65 2c0a 2020 2020 2020 2020 6e61  None,.        na
-0000e610: 6d65 7370 6163 653d 4e6f 6e65 2c0a 2020  mespace=None,.  
-0000e620: 2020 2020 2020 6172 7469 6661 6374 5f70        artifact_p
-0000e630: 6174 683d 4e6f 6e65 2c0a 2020 2020 2020  ath=None,.      
-0000e640: 2020 6f70 733d 4e6f 6e65 2c0a 2020 2020    ops=None,.    
-0000e650: 2020 2020 2320 544f 444f 3a20 6465 7072      # TODO: depr
-0000e660: 6563 6174 6564 2c20 7265 6d6f 7665 2069  ecated, remove i
-0000e670: 6e20 312e 352e 300a 2020 2020 2020 2020  n 1.5.0.        
-0000e680: 7474 6c3d 4e6f 6e65 2c0a 2020 2020 2020  ttl=None,.      
-0000e690: 2020 636c 6561 6e75 705f 7474 6c3d 4e6f    cleanup_ttl=No
-0000e6a0: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
-0000e6b0: 2020 2022 2222 5375 626d 6974 2061 204b     """Submit a K
-0000e6c0: 4650 2070 6970 656c 696e 6520 666f 7220  FP pipeline for 
-0000e6d0: 6578 6563 7574 696f 6e2e 0a0a 2020 2020  execution...    
-0000e6e0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-0000e6f0: 6374 3a20 5468 6520 7072 6f6a 6563 7420  ct: The project 
-0000e700: 6f66 2074 6865 2070 6970 656c 696e 650a  of the pipeline.
-0000e710: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0000e720: 6970 656c 696e 653a 2050 6970 656c 696e  ipeline: Pipelin
-0000e730: 6520 6675 6e63 7469 6f6e 206f 7220 7061  e function or pa
-0000e740: 7468 2074 6f20 2e79 616d 6c2f 2e7a 6970  th to .yaml/.zip
-0000e750: 2070 6970 656c 696e 6520 6669 6c65 2e0a   pipeline file..
-0000e760: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0000e770: 7267 756d 656e 7473 3a20 4120 6469 6374  rguments: A dict
-0000e780: 696f 6e61 7279 206f 6620 6172 6775 6d65  ionary of argume
-0000e790: 6e74 7320 746f 2070 6173 7320 746f 2074  nts to pass to t
-0000e7a0: 6865 2070 6970 656c 696e 652e 0a20 2020  he pipeline..   
-0000e7b0: 2020 2020 203a 7061 7261 6d20 6578 7065       :param expe
-0000e7c0: 7269 6d65 6e74 3a20 4120 6e61 6d65 2074  riment: A name t
-0000e7d0: 6f20 6173 7369 676e 2066 6f72 2074 6865  o assign for the
-0000e7e0: 2073 7065 6369 6669 6320 6578 7065 7269   specific experi
-0000e7f0: 6d65 6e74 2e0a 2020 2020 2020 2020 3a70  ment..        :p
-0000e800: 6172 616d 2072 756e 3a20 4120 6e61 6d65  aram run: A name
-0000e810: 2066 6f72 2074 6869 7320 7370 6563 6966   for this specif
-0000e820: 6963 2072 756e 2e0a 2020 2020 2020 2020  ic run..        
-0000e830: 3a70 6172 616d 206e 616d 6573 7061 6365  :param namespace
-0000e840: 3a20 4b75 6265 726e 6574 6573 206e 616d  : Kubernetes nam
-0000e850: 6573 7061 6365 2074 6f20 6578 6563 7574  espace to execut
-0000e860: 6520 7468 6520 7069 7065 6c69 6e65 2069  e the pipeline i
-0000e870: 6e2e 0a20 2020 2020 2020 203a 7061 7261  n..        :para
-0000e880: 6d20 6172 7469 6661 6374 5f70 6174 683a  m artifact_path:
-0000e890: 2041 2070 6174 6820 746f 2061 7274 6966   A path to artif
-0000e8a0: 6163 7473 2075 7365 6420 6279 2074 6869  acts used by thi
-0000e8b0: 7320 7069 7065 6c69 6e65 2e0a 2020 2020  s pipeline..    
-0000e8c0: 2020 2020 3a70 6172 616d 206f 7073 3a20      :param ops: 
-0000e8d0: 5472 616e 7366 6f72 6d65 7273 2074 6f20  Transformers to 
-0000e8e0: 6170 706c 7920 6f6e 2061 6c6c 206f 7073  apply on all ops
-0000e8f0: 2069 6e20 7468 6520 7069 7065 6c69 6e65   in the pipeline
-0000e900: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000e910: 2074 746c 3a20 7069 7065 6c69 6e65 2063   ttl: pipeline c
-0000e920: 6c65 616e 7570 2074 746c 2069 6e20 7365  leanup ttl in se
-0000e930: 6373 2028 7469 6d65 2074 6f20 7761 6974  cs (time to wait
-0000e940: 2061 6674 6572 2077 6f72 6b66 6c6f 7720   after workflow 
-0000e950: 636f 6d70 6c65 7469 6f6e 2c20 6174 2077  completion, at w
-0000e960: 6869 6368 2070 6f69 6e74 2074 6865 2077  hich point the w
-0000e970: 6f72 6b66 6c6f 770a 2020 2020 2020 2020  orkflow.        
-0000e980: 2020 2020 2020 2020 2020 2020 616e 6420              and 
-0000e990: 616c 6c20 6974 7320 7265 736f 7572 6365  all its resource
-0000e9a0: 7320 6172 6520 6465 6c65 7465 6429 2028  s are deleted) (
-0000e9b0: 6465 7072 6563 6174 6564 2c20 7573 6520  deprecated, use 
-0000e9c0: 636c 6561 6e75 705f 7474 6c20 696e 7374  cleanup_ttl inst
-0000e9d0: 6561 6429 0a20 2020 2020 2020 203a 7061  ead).        :pa
-0000e9e0: 7261 6d20 636c 6561 6e75 705f 7474 6c3a  ram cleanup_ttl:
-0000e9f0: 2070 6970 656c 696e 6520 636c 6561 6e75   pipeline cleanu
-0000ea00: 7020 7474 6c20 696e 2073 6563 7320 2874  p ttl in secs (t
-0000ea10: 696d 6520 746f 2077 6169 7420 6166 7465  ime to wait afte
-0000ea20: 7220 776f 726b 666c 6f77 2063 6f6d 706c  r workflow compl
-0000ea30: 6574 696f 6e2c 2061 7420 7768 6963 6820  etion, at which 
-0000ea40: 706f 696e 7420 7468 650a 2020 2020 2020  point the.      
-0000ea50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ea60: 2020 2020 2020 776f 726b 666c 6f77 2061        workflow a
-0000ea70: 6e64 2061 6c6c 2069 7473 2072 6573 6f75  nd all its resou
-0000ea80: 7263 6573 2061 7265 2064 656c 6574 6564  rces are deleted
-0000ea90: 290a 2020 2020 2020 2020 2222 220a 0a20  ).        """.. 
-0000eaa0: 2020 2020 2020 2069 6620 7474 6c3a 0a20         if ttl:. 
-0000eab0: 2020 2020 2020 2020 2020 2077 6172 6e69             warni
-0000eac0: 6e67 732e 7761 726e 280a 2020 2020 2020  ngs.warn(.      
-0000ead0: 2020 2020 2020 2020 2020 2227 7474 6c27            "'ttl'
-0000eae0: 2069 7320 6465 7072 6563 6174 6564 2c20   is deprecated, 
-0000eaf0: 7573 6520 2763 6c65 616e 7570 5f74 746c  use 'cleanup_ttl
-0000eb00: 2720 696e 7374 6561 642e 2022 0a20 2020  ' instead. ".   
-0000eb10: 2020 2020 2020 2020 2020 2020 2022 5468               "Th
-0000eb20: 6973 2077 696c 6c20 6265 2072 656d 6f76  is will be remov
-0000eb30: 6564 2069 6e20 312e 352e 3022 2c0a 2020  ed in 1.5.0",.  
-0000eb40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0000eb50: 544f 444f 3a20 5265 6d6f 7665 2074 6869  TODO: Remove thi
-0000eb60: 7320 696e 2031 2e35 2e30 0a20 2020 2020  s in 1.5.0.     
-0000eb70: 2020 2020 2020 2020 2020 2046 7574 7572             Futur
-0000eb80: 6557 6172 6e69 6e67 2c0a 2020 2020 2020  eWarning,.      
-0000eb90: 2020 2020 2020 290a 0a20 2020 2020 2020        )..       
-0000eba0: 2069 6620 6973 696e 7374 616e 6365 2870   if isinstance(p
-0000ebb0: 6970 656c 696e 652c 2073 7472 293a 0a20  ipeline, str):. 
-0000ebc0: 2020 2020 2020 2020 2020 2070 6970 655f             pipe_
-0000ebd0: 6669 6c65 203d 2070 6970 656c 696e 650a  file = pipeline.
-0000ebe0: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
-0000ebf0: 2020 2020 2020 2020 2020 7069 7065 5f66            pipe_f
-0000ec00: 696c 6520 3d20 7465 6d70 6669 6c65 2e4e  ile = tempfile.N
-0000ec10: 616d 6564 5465 6d70 6f72 6172 7946 696c  amedTemporaryFil
-0000ec20: 6528 7375 6666 6978 3d22 2e79 616d 6c22  e(suffix=".yaml"
-0000ec30: 2c20 6465 6c65 7465 3d46 616c 7365 292e  , delete=False).
-0000ec40: 6e61 6d65 0a20 2020 2020 2020 2020 2020  name.           
-0000ec50: 2063 6f6e 6620 3d20 6e65 775f 7069 7065   conf = new_pipe
-0000ec60: 5f6d 6574 6164 6174 6128 0a20 2020 2020  _metadata(.     
-0000ec70: 2020 2020 2020 2020 2020 2061 7274 6966             artif
-0000ec80: 6163 745f 7061 7468 3d61 7274 6966 6163  act_path=artifac
-0000ec90: 745f 7061 7468 2c0a 2020 2020 2020 2020  t_path,.        
-0000eca0: 2020 2020 2020 2020 636c 6561 6e75 705f          cleanup_
-0000ecb0: 7474 6c3d 636c 6561 6e75 705f 7474 6c20  ttl=cleanup_ttl 
-0000ecc0: 6f72 2074 746c 2c0a 2020 2020 2020 2020  or ttl,.        
-0000ecd0: 2020 2020 2020 2020 6f70 5f74 7261 6e73          op_trans
-0000ece0: 666f 726d 6572 733d 6f70 732c 0a20 2020  formers=ops,.   
-0000ecf0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
-0000ed00: 2020 2020 2020 206b 6670 2e63 6f6d 7069         kfp.compi
-0000ed10: 6c65 722e 436f 6d70 696c 6572 2829 2e63  ler.Compiler().c
-0000ed20: 6f6d 7069 6c65 280a 2020 2020 2020 2020  ompile(.        
-0000ed30: 2020 2020 2020 2020 7069 7065 6c69 6e65          pipeline
-0000ed40: 2c20 7069 7065 5f66 696c 652c 2074 7970  , pipe_file, typ
-0000ed50: 655f 6368 6563 6b3d 4661 6c73 652c 2070  e_check=False, p
-0000ed60: 6970 656c 696e 655f 636f 6e66 3d63 6f6e  ipeline_conf=con
-0000ed70: 660a 2020 2020 2020 2020 2020 2020 290a  f.            ).
-0000ed80: 0a20 2020 2020 2020 2069 6620 7069 7065  .        if pipe
-0000ed90: 5f66 696c 652e 656e 6473 7769 7468 2822  _file.endswith("
-0000eda0: 2e79 616d 6c22 293a 0a20 2020 2020 2020  .yaml"):.       
-0000edb0: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
-0000edc0: 2263 6f6e 7465 6e74 2d74 7970 6522 3a20  "content-type": 
-0000edd0: 2261 7070 6c69 6361 7469 6f6e 2f79 616d  "application/yam
-0000ede0: 6c22 7d0a 2020 2020 2020 2020 656c 6966  l"}.        elif
-0000edf0: 2070 6970 655f 6669 6c65 2e65 6e64 7377   pipe_file.endsw
-0000ee00: 6974 6828 222e 7a69 7022 293a 0a20 2020  ith(".zip"):.   
-0000ee10: 2020 2020 2020 2020 2068 6561 6465 7273           headers
-0000ee20: 203d 207b 2263 6f6e 7465 6e74 2d74 7970   = {"content-typ
-0000ee30: 6522 3a20 2261 7070 6c69 6361 7469 6f6e  e": "application
-0000ee40: 2f7a 6970 227d 0a20 2020 2020 2020 2065  /zip"}.        e
-0000ee50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000ee60: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
-0000ee70: 7228 2270 6970 656c 696e 6520 6669 6c65  r("pipeline file
-0000ee80: 206d 7573 7420 6265 202e 7961 6d6c 206f   must be .yaml o
-0000ee90: 7220 2e7a 6970 2229 0a20 2020 2020 2020  r .zip").       
-0000eea0: 2069 6620 6172 6775 6d65 6e74 733a 0a20   if arguments:. 
-0000eeb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-0000eec0: 7420 6973 696e 7374 616e 6365 2861 7267  t isinstance(arg
-0000eed0: 756d 656e 7473 2c20 6469 6374 293a 0a20  uments, dict):. 
-0000eee0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-0000eef0: 6169 7365 2056 616c 7565 4572 726f 7228  aise ValueError(
-0000ef00: 2261 7267 756d 656e 7473 206d 7573 7420  "arguments must 
-0000ef10: 6265 2064 6963 7420 7479 7065 2229 0a20  be dict type"). 
-0000ef20: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-0000ef30: 7273 5b6d 6c72 756e 2e63 6f6d 6d6f 6e2e  rs[mlrun.common.
-0000ef40: 7363 6865 6d61 732e 4865 6164 6572 4e61  schemas.HeaderNa
-0000ef50: 6d65 732e 7069 7065 6c69 6e65 5f61 7267  mes.pipeline_arg
-0000ef60: 756d 656e 7473 5d20 3d20 7374 7228 0a20  uments] = str(. 
-0000ef70: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-0000ef80: 7267 756d 656e 7473 0a20 2020 2020 2020  rguments.       
-0000ef90: 2020 2020 2029 0a0a 2020 2020 2020 2020       )..        
-0000efa0: 6966 206e 6f74 2070 6174 682e 6973 6669  if not path.isfi
-0000efb0: 6c65 2870 6970 655f 6669 6c65 293a 0a20  le(pipe_file):. 
-0000efc0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
-0000efd0: 204f 5345 7272 6f72 2866 2266 696c 6520   OSError(f"file 
-0000efe0: 7b70 6970 655f 6669 6c65 7d20 646f 6573  {pipe_file} does
-0000eff0: 6e74 2065 7869 7374 2229 0a20 2020 2020  nt exist").     
-0000f000: 2020 2077 6974 6820 6f70 656e 2870 6970     with open(pip
-0000f010: 655f 6669 6c65 2c20 2272 6222 2920 6173  e_file, "rb") as
-0000f020: 2066 703a 0a20 2020 2020 2020 2020 2020   fp:.           
-0000f030: 2064 6174 6120 3d20 6670 2e72 6561 6428   data = fp.read(
-0000f040: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-0000f050: 2069 7369 6e73 7461 6e63 6528 7069 7065   isinstance(pipe
-0000f060: 6c69 6e65 2c20 7374 7229 3a0a 2020 2020  line, str):.    
-0000f070: 2020 2020 2020 2020 7265 6d6f 7665 2870          remove(p
-0000f080: 6970 655f 6669 6c65 290a 0a20 2020 2020  ipe_file)..     
-0000f090: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0000f0a0: 2020 2020 7061 7261 6d73 203d 207b 226e      params = {"n
-0000f0b0: 616d 6573 7061 6365 223a 206e 616d 6573  amespace": names
-0000f0c0: 7061 6365 2c20 2265 7870 6572 696d 656e  pace, "experimen
-0000f0d0: 7422 3a20 6578 7065 7269 6d65 6e74 2c20  t": experiment, 
-0000f0e0: 2272 756e 223a 2072 756e 7d0a 2020 2020  "run": run}.    
-0000f0f0: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-0000f100: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-0000f110: 2020 2020 2020 2020 2020 2020 2020 2250                "P
-0000f120: 4f53 5422 2c0a 2020 2020 2020 2020 2020  OST",.          
-0000f130: 2020 2020 2020 6622 7072 6f6a 6563 7473        f"projects
-0000f140: 2f7b 7072 6f6a 6563 747d 2f70 6970 656c  /{project}/pipel
-0000f150: 696e 6573 222c 0a20 2020 2020 2020 2020  ines",.         
-0000f160: 2020 2020 2020 2070 6172 616d 733d 7061         params=pa
-0000f170: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
-0000f180: 2020 2020 2020 7469 6d65 6f75 743d 3230        timeout=20
-0000f190: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0000f1a0: 2020 626f 6479 3d64 6174 612c 0a20 2020    body=data,.   
-0000f1b0: 2020 2020 2020 2020 2020 2020 2068 6561               hea
-0000f1c0: 6465 7273 3d68 6561 6465 7273 2c0a 2020  ders=headers,.  
-0000f1d0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0000f1e0: 2020 2020 6578 6365 7074 204f 5345 7272      except OSErr
-0000f1f0: 6f72 2061 7320 6572 723a 0a20 2020 2020  or as err:.     
-0000f200: 2020 2020 2020 206c 6f67 6765 722e 6572         logger.er
-0000f210: 726f 7228 6622 6572 726f 7220 6361 6e6e  ror(f"error cann
-0000f220: 6f74 2073 7562 6d69 7420 7069 7065 6c69  ot submit pipeli
-0000f230: 6e65 3a20 7b65 7272 5f74 6f5f 7374 7228  ne: {err_to_str(
-0000f240: 6572 7229 7d22 290a 2020 2020 2020 2020  err)}").        
-0000f250: 2020 2020 7261 6973 6520 4f53 4572 726f      raise OSErro
-0000f260: 7228 6622 6572 726f 723a 2063 616e 6e6f  r(f"error: canno
-0000f270: 7420 6361 6e6e 6f74 2073 7562 6d69 7420  t cannot submit 
-0000f280: 7069 7065 6c69 6e65 2c20 7b65 7272 5f74  pipeline, {err_t
-0000f290: 6f5f 7374 7228 6572 7229 7d22 290a 0a20  o_str(err)}").. 
-0000f2a0: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
-0000f2b0: 7370 2e6f 6b3a 0a20 2020 2020 2020 2020  sp.ok:.         
-0000f2c0: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
-0000f2d0: 6622 6261 6420 7265 7370 2121 5c6e 7b72  f"bad resp!!\n{r
-0000f2e0: 6573 702e 7465 7874 7d22 290a 2020 2020  esp.text}").    
-0000f2f0: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
-0000f300: 6c75 6545 7272 6f72 2866 2262 6164 2073  lueError(f"bad s
-0000f310: 7562 6d69 7420 7069 7065 6c69 6e65 2072  ubmit pipeline r
-0000f320: 6573 706f 6e73 652c 207b 7265 7370 2e74  esponse, {resp.t
-0000f330: 6578 747d 2229 0a0a 2020 2020 2020 2020  ext}")..        
-0000f340: 7265 7370 203d 2072 6573 702e 6a73 6f6e  resp = resp.json
-0000f350: 2829 0a20 2020 2020 2020 206c 6f67 6765  ().        logge
-0000f360: 722e 696e 666f 2866 2273 7562 6d69 7474  r.info(f"submitt
-0000f370: 6564 2070 6970 656c 696e 6520 7b72 6573  ed pipeline {res
-0000f380: 705b 276e 616d 6527 5d7d 2069 643d 7b72  p['name']} id={r
-0000f390: 6573 705b 2769 6427 5d7d 2229 0a20 2020  esp['id']}").   
-0000f3a0: 2020 2020 2072 6574 7572 6e20 7265 7370       return resp
-0000f3b0: 5b22 6964 225d 0a0a 2020 2020 6465 6620  ["id"]..    def 
-0000f3c0: 6c69 7374 5f70 6970 656c 696e 6573 280a  list_pipelines(.
-0000f3d0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0000f3e0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
-0000f3f0: 7472 2c0a 2020 2020 2020 2020 6e61 6d65  tr,.        name
-0000f400: 7370 6163 653a 2073 7472 203d 204e 6f6e  space: str = Non
-0000f410: 652c 0a20 2020 2020 2020 2073 6f72 745f  e,.        sort_
-0000f420: 6279 3a20 7374 7220 3d20 2222 2c0a 2020  by: str = "",.  
-0000f430: 2020 2020 2020 7061 6765 5f74 6f6b 656e        page_token
-0000f440: 3a20 7374 7220 3d20 2222 2c0a 2020 2020  : str = "",.    
-0000f450: 2020 2020 6669 6c74 6572 5f3a 2073 7472      filter_: str
-0000f460: 203d 2022 222c 0a20 2020 2020 2020 2066   = "",.        f
-0000f470: 6f72 6d61 745f 3a20 556e 696f 6e5b 0a20  ormat_: Union[. 
-0000f480: 2020 2020 2020 2020 2020 2073 7472 2c20             str, 
-0000f490: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0000f4a0: 656d 6173 2e50 6970 656c 696e 6573 466f  emas.PipelinesFo
-0000f4b0: 726d 6174 0a20 2020 2020 2020 205d 203d  rmat.        ] =
-0000f4c0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0000f4d0: 6865 6d61 732e 5069 7065 6c69 6e65 7346  hemas.PipelinesF
-0000f4e0: 6f72 6d61 742e 6d65 7461 6461 7461 5f6f  ormat.metadata_o
-0000f4f0: 6e6c 792c 0a20 2020 2020 2020 2070 6167  nly,.        pag
-0000f500: 655f 7369 7a65 3a20 696e 7420 3d20 4e6f  e_size: int = No
-0000f510: 6e65 2c0a 2020 2020 2920 2d3e 206d 6c72  ne,.    ) -> mlr
-0000f520: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-0000f530: 732e 5069 7065 6c69 6e65 734f 7574 7075  s.PipelinesOutpu
-0000f540: 743a 0a20 2020 2020 2020 2022 2222 5265  t:.        """Re
-0000f550: 7472 6965 7665 2061 206c 6973 7420 6f66  trieve a list of
-0000f560: 204b 4650 2070 6970 656c 696e 6573 2e20   KFP pipelines. 
-0000f570: 5468 6973 2066 756e 6374 696f 6e20 6361  This function ca
-0000f580: 6e20 6265 2069 6e76 6f6b 6564 2074 6f20  n be invoked to 
-0000f590: 6765 7420 616c 6c20 7069 7065 6c69 6e65  get all pipeline
-0000f5a0: 7320 6672 6f6d 2061 6c6c 2070 726f 6a65  s from all proje
-0000f5b0: 6374 732c 0a20 2020 2020 2020 2062 7920  cts,.        by 
-0000f5c0: 7370 6563 6966 7969 6e67 2060 6070 726f  specifying ``pro
-0000f5d0: 6a65 6374 3d2a 6060 2c20 696e 2077 6869  ject=*``, in whi
-0000f5e0: 6368 2063 6173 6520 7061 6769 6e61 7469  ch case paginati
-0000f5f0: 6f6e 2063 616e 2062 6520 7573 6564 2061  on can be used a
-0000f600: 6e64 2074 6865 2076 6172 696f 7573 2073  nd the various s
-0000f610: 6f72 7469 6e67 2061 6e64 2070 6167 696e  orting and pagin
-0000f620: 6174 696f 6e0a 2020 2020 2020 2020 7072  ation.        pr
-0000f630: 6f70 6572 7469 6573 2063 616e 2062 6520  operties can be 
-0000f640: 6170 706c 6965 642e 2049 6620 6120 7370  applied. If a sp
-0000f650: 6563 6966 6963 2070 726f 6a65 6374 2069  ecific project i
-0000f660: 7320 7265 7175 6573 7465 642c 2074 6865  s requested, the
-0000f670: 6e20 7468 6520 7061 6769 6e61 7469 6f6e  n the pagination
-0000f680: 206f 7074 696f 6e73 2063 616e 6e6f 7420   options cannot 
-0000f690: 6265 0a20 2020 2020 2020 2075 7365 6420  be.        used 
-0000f6a0: 616e 6420 7061 6769 6e61 7469 6f6e 2069  and pagination i
-0000f6b0: 7320 6e6f 7420 6170 706c 6965 642e 0a0a  s not applied...
-0000f6c0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
-0000f6d0: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
-0000f6e0: 6e61 6d65 2e20 4361 6e20 6265 2060 602a  name. Can be ``*
-0000f6f0: 6060 2066 6f72 2071 7565 7279 2061 6372  `` for query acr
-0000f700: 6f73 7320 616c 6c20 7072 6f6a 6563 7473  oss all projects
-0000f710: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0000f720: 206e 616d 6573 7061 6365 3a20 4b75 6265   namespace: Kube
-0000f730: 726e 6574 6573 206e 616d 6573 7061 6365  rnetes namespace
-0000f740: 2069 6e20 7768 6963 6820 7468 6520 7069   in which the pi
-0000f750: 7065 6c69 6e65 7320 6172 6520 6578 6563  pelines are exec
-0000f760: 7574 696e 672e 0a20 2020 2020 2020 203a  uting..        :
-0000f770: 7061 7261 6d20 736f 7274 5f62 793a 2046  param sort_by: F
-0000f780: 6965 6c64 2074 6f20 736f 7274 2074 6865  ield to sort the
-0000f790: 2072 6573 756c 7473 2062 792e 0a20 2020   results by..   
-0000f7a0: 2020 2020 203a 7061 7261 6d20 7061 6765       :param page
-0000f7b0: 5f74 6f6b 656e 3a20 5573 6520 666f 7220  _token: Use for 
-0000f7c0: 7061 6769 6e61 7469 6f6e 2c20 746f 2072  pagination, to r
-0000f7d0: 6574 7269 6576 6520 6e65 7874 2070 6167  etrieve next pag
-0000f7e0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0000f7f0: 6d20 6669 6c74 6572 5f3a 204b 7562 6572  m filter_: Kuber
-0000f800: 6e65 7465 7320 6669 6c74 6572 2074 6f20  netes filter to 
-0000f810: 6170 706c 7920 746f 2074 6865 2071 7565  apply to the que
-0000f820: 7279 2c20 6361 6e20 6265 2075 7365 6420  ry, can be used 
-0000f830: 746f 2066 696c 7465 7220 6f6e 2073 7065  to filter on spe
-0000f840: 6369 6669 6320 6f62 6a65 6374 2066 6965  cific object fie
-0000f850: 6c64 732e 0a20 2020 2020 2020 203a 7061  lds..        :pa
-0000f860: 7261 6d20 666f 726d 6174 5f3a 2052 6573  ram format_: Res
-0000f870: 756c 7420 666f 726d 6174 2e20 4361 6e20  ult format. Can 
-0000f880: 6265 206f 6e65 206f 663a 0a0a 2020 2020  be one of:..    
-0000f890: 2020 2020 2020 2020 2d20 6060 6675 6c6c          - ``full
-0000f8a0: 6060 202d 2072 6574 7572 6e20 7468 6520  `` - return the 
-0000f8b0: 6675 6c6c 206f 626a 6563 7473 2e0a 2020  full objects..  
-0000f8c0: 2020 2020 2020 2020 2020 2d20 6060 6d65            - ``me
-0000f8d0: 7461 6461 7461 5f6f 6e6c 7960 6020 2864  tadata_only`` (d
-0000f8e0: 6566 6175 6c74 2920 2d20 7265 7475 726e  efault) - return
-0000f8f0: 206a 7573 7420 6d65 7461 6461 7461 206f   just metadata o
-0000f900: 6620 7468 6520 7069 7065 6c69 6e65 7320  f the pipelines 
-0000f910: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
-0000f920: 2020 2020 202d 2060 606e 616d 655f 6f6e       - ``name_on
-0000f930: 6c79 6060 202d 2072 6574 7572 6e20 6a75  ly`` - return ju
-0000f940: 7374 2074 6865 206e 616d 6573 206f 6620  st the names of 
-0000f950: 7468 6520 7069 7065 6c69 6e65 206f 626a  the pipeline obj
-0000f960: 6563 7473 2e0a 2020 2020 2020 2020 3a70  ects..        :p
-0000f970: 6172 616d 2070 6167 655f 7369 7a65 3a20  aram page_size: 
-0000f980: 5369 7a65 206f 6620 6120 7369 6e67 6c65  Size of a single
-0000f990: 2070 6167 6520 7768 656e 2061 7070 6c79   page when apply
-0000f9a0: 696e 6720 7061 6769 6e61 7469 6f6e 2e0a  ing pagination..
-0000f9b0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000f9c0: 2020 2020 2069 6620 7072 6f6a 6563 7420       if project 
-0000f9d0: 213d 2022 2a22 2061 6e64 2028 7061 6765  != "*" and (page
-0000f9e0: 5f74 6f6b 656e 206f 7220 7061 6765 5f73  _token or page_s
-0000f9f0: 697a 6529 3a0a 2020 2020 2020 2020 2020  ize):.          
-0000fa00: 2020 7261 6973 6520 6d6c 7275 6e2e 6572    raise mlrun.er
-0000fa10: 726f 7273 2e4d 4c52 756e 496e 7661 6c69  rors.MLRunInvali
-0000fa20: 6441 7267 756d 656e 7445 7272 6f72 280a  dArgumentError(.
-0000fa30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000fa40: 2246 696c 7465 7269 6e67 2062 7920 7072  "Filtering by pr
-0000fa50: 6f6a 6563 7420 6361 6e20 6e6f 7420 6265  oject can not be
-0000fa60: 2075 7365 6420 746f 6765 7468 6572 2077   used together w
-0000fa70: 6974 6820 7061 6769 6e61 7469 6f6e 220a  ith pagination".
-0000fa80: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0000fa90: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-0000faa0: 0a20 2020 2020 2020 2020 2020 2022 6e61  .            "na
-0000fab0: 6d65 7370 6163 6522 3a20 6e61 6d65 7370  mespace": namesp
-0000fac0: 6163 652c 0a20 2020 2020 2020 2020 2020  ace,.           
-0000fad0: 2022 736f 7274 5f62 7922 3a20 736f 7274   "sort_by": sort
-0000fae0: 5f62 792c 0a20 2020 2020 2020 2020 2020  _by,.           
-0000faf0: 2022 7061 6765 5f74 6f6b 656e 223a 2070   "page_token": p
-0000fb00: 6167 655f 746f 6b65 6e2c 0a20 2020 2020  age_token,.     
-0000fb10: 2020 2020 2020 2022 6669 6c74 6572 223a         "filter":
-0000fb20: 2066 696c 7465 725f 2c0a 2020 2020 2020   filter_,.      
-0000fb30: 2020 2020 2020 2266 6f72 6d61 7422 3a20        "format": 
-0000fb40: 666f 726d 6174 5f2c 0a20 2020 2020 2020  format_,.       
-0000fb50: 2020 2020 2022 7061 6765 5f73 697a 6522       "page_size"
-0000fb60: 3a20 7061 6765 5f73 697a 652c 0a20 2020  : page_size,.   
-0000fb70: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
-0000fb80: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-0000fb90: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
-0000fba0: 2070 6970 656c 696e 6573 2c20 7175 6572   pipelines, quer
-0000fbb0: 793a 207b 7061 7261 6d73 7d22 0a20 2020  y: {params}".   
-0000fbc0: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-0000fbd0: 7365 6c66 2e61 7069 5f63 616c 6c28 0a20  self.api_call(. 
-0000fbe0: 2020 2020 2020 2020 2020 2022 4745 5422             "GET"
-0000fbf0: 2c20 6622 7072 6f6a 6563 7473 2f7b 7072  , f"projects/{pr
-0000fc00: 6f6a 6563 747d 2f70 6970 656c 696e 6573  oject}/pipelines
-0000fc10: 222c 2065 7272 6f72 5f6d 6573 7361 6765  ", error_message
-0000fc20: 2c20 7061 7261 6d73 3d70 6172 616d 730a  , params=params.
-0000fc30: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000fc40: 2020 7265 7475 726e 206d 6c72 756e 2e63    return mlrun.c
-0000fc50: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5069  ommon.schemas.Pi
-0000fc60: 7065 6c69 6e65 734f 7574 7075 7428 2a2a  pelinesOutput(**
-0000fc70: 7265 7370 6f6e 7365 2e6a 736f 6e28 2929  response.json())
-0000fc80: 0a0a 2020 2020 6465 6620 6765 745f 7069  ..    def get_pi
-0000fc90: 7065 6c69 6e65 280a 2020 2020 2020 2020  peline(.        
-0000fca0: 7365 6c66 2c0a 2020 2020 2020 2020 7275  self,.        ru
-0000fcb0: 6e5f 6964 3a20 7374 722c 0a20 2020 2020  n_id: str,.     
-0000fcc0: 2020 206e 616d 6573 7061 6365 3a20 7374     namespace: st
-0000fcd0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
-0000fce0: 2020 7469 6d65 6f75 743a 2069 6e74 203d    timeout: int =
-0000fcf0: 2031 302c 0a20 2020 2020 2020 2066 6f72   10,.        for
-0000fd00: 6d61 745f 3a20 556e 696f 6e5b 0a20 2020  mat_: Union[.   
-0000fd10: 2020 2020 2020 2020 2073 7472 2c20 6d6c           str, ml
-0000fd20: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-0000fd30: 6173 2e50 6970 656c 696e 6573 466f 726d  as.PipelinesForm
-0000fd40: 6174 0a20 2020 2020 2020 205d 203d 206d  at.        ] = m
-0000fd50: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0000fd60: 6d61 732e 5069 7065 6c69 6e65 7346 6f72  mas.PipelinesFor
-0000fd70: 6d61 742e 7375 6d6d 6172 792c 0a20 2020  mat.summary,.   
-0000fd80: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
-0000fd90: 7220 3d20 4e6f 6e65 2c0a 2020 2020 293a  r = None,.    ):
-0000fda0: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
-0000fdb0: 6965 7665 2064 6574 6169 6c73 206f 6620  ieve details of 
-0000fdc0: 6120 7370 6563 6966 6963 2070 6970 656c  a specific pipel
-0000fdd0: 696e 6520 7573 696e 6720 6974 7320 7275  ine using its ru
-0000fde0: 6e20 4944 2028 6173 2070 726f 7669 6465  n ID (as provide
-0000fdf0: 6420 7768 656e 2074 6865 2070 6970 656c  d when the pipel
-0000fe00: 696e 6520 7761 7320 6578 6563 7574 6564  ine was executed
-0000fe10: 292e 2222 220a 0a20 2020 2020 2020 2074  )."""..        t
-0000fe20: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0000fe30: 7061 7261 6d73 203d 207b 7d0a 2020 2020  params = {}.    
-0000fe40: 2020 2020 2020 2020 6966 206e 616d 6573          if names
-0000fe50: 7061 6365 3a0a 2020 2020 2020 2020 2020  pace:.          
-0000fe60: 2020 2020 2020 7061 7261 6d73 5b22 6e61        params["na
-0000fe70: 6d65 7370 6163 6522 5d20 3d20 6e61 6d65  mespace"] = name
-0000fe80: 7370 6163 650a 2020 2020 2020 2020 2020  space.          
-0000fe90: 2020 7061 7261 6d73 5b22 666f 726d 6174    params["format
-0000fea0: 225d 203d 2066 6f72 6d61 745f 0a20 2020  "] = format_.   
-0000feb0: 2020 2020 2020 2020 2070 726f 6a65 6374           project
-0000fec0: 5f70 6174 6820 3d20 7072 6f6a 6563 7420  _path = project 
-0000fed0: 6966 2070 726f 6a65 6374 2065 6c73 6520  if project else 
-0000fee0: 222a 220a 2020 2020 2020 2020 2020 2020  "*".            
-0000fef0: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
-0000ff00: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-0000ff10: 2020 2020 2020 2247 4554 222c 0a20 2020        "GET",.   
-0000ff20: 2020 2020 2020 2020 2020 2020 2066 2270               f"p
-0000ff30: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-0000ff40: 5f70 6174 687d 2f70 6970 656c 696e 6573  _path}/pipelines
-0000ff50: 2f7b 7275 6e5f 6964 7d22 2c0a 2020 2020  /{run_id}",.    
-0000ff60: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0000ff70: 6d73 3d70 6172 616d 732c 0a20 2020 2020  ms=params,.     
-0000ff80: 2020 2020 2020 2020 2020 2074 696d 656f             timeo
-0000ff90: 7574 3d74 696d 656f 7574 2c0a 2020 2020  ut=timeout,.    
-0000ffa0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0000ffb0: 2020 6578 6365 7074 204f 5345 7272 6f72    except OSError
-0000ffc0: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
-0000ffd0: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
-0000ffe0: 7228 6622 6572 726f 7220 6361 6e6e 6f74  r(f"error cannot
-0000fff0: 2067 6574 2070 6970 656c 696e 653a 207b   get pipeline: {
-00010000: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
-00010010: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-00010020: 6169 7365 204f 5345 7272 6f72 2866 2265  aise OSError(f"e
-00010030: 7272 6f72 3a20 6361 6e6e 6f74 2067 6574  rror: cannot get
-00010040: 2070 6970 656c 696e 652c 207b 6572 725f   pipeline, {err_
-00010050: 746f 5f73 7472 2865 7272 297d 2229 0a0a  to_str(err)}")..
-00010060: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
-00010070: 6573 702e 6f6b 3a0a 2020 2020 2020 2020  esp.ok:.        
-00010080: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
-00010090: 2866 2262 6164 2072 6573 7021 215c 6e7b  (f"bad resp!!\n{
-000100a0: 7265 7370 2e74 6578 747d 2229 0a20 2020  resp.text}").   
-000100b0: 2020 2020 2020 2020 2072 6169 7365 2056           raise V
-000100c0: 616c 7565 4572 726f 7228 6622 6261 6420  alueError(f"bad 
-000100d0: 6765 7420 7069 7065 6c69 6e65 2072 6573  get pipeline res
-000100e0: 706f 6e73 652c 207b 7265 7370 2e74 6578  ponse, {resp.tex
-000100f0: 747d 2229 0a0a 2020 2020 2020 2020 7265  t}")..        re
-00010100: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
-00010110: 0a0a 2020 2020 4073 7461 7469 636d 6574  ..    @staticmet
-00010120: 686f 640a 2020 2020 6465 6620 5f72 6573  hod.    def _res
-00010130: 6f6c 7665 5f72 6566 6572 656e 6365 2874  olve_reference(t
-00010140: 6167 2c20 7569 6429 3a0a 2020 2020 2020  ag, uid):.      
-00010150: 2020 6966 2075 6964 2061 6e64 2074 6167    if uid and tag
-00010160: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
-00010170: 6973 6520 4d4c 5275 6e49 6e76 616c 6964  ise MLRunInvalid
-00010180: 4172 6775 6d65 6e74 4572 726f 7228 2262  ArgumentError("b
-00010190: 6f74 6820 7569 6420 616e 6420 7461 6720  oth uid and tag 
-000101a0: 7765 7265 2070 726f 7669 6465 6422 290a  were provided").
-000101b0: 2020 2020 2020 2020 7265 7475 726e 2075          return u
-000101c0: 6964 206f 7220 7461 6720 6f72 2022 6c61  id or tag or "la
-000101d0: 7465 7374 220a 0a20 2020 2064 6566 2063  test"..    def c
-000101e0: 7265 6174 655f 6665 6174 7572 655f 7365  reate_feature_se
-000101f0: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-00010200: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
-00010210: 5f73 6574 3a20 556e 696f 6e5b 6469 6374  _set: Union[dict
-00010220: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-00010230: 6368 656d 6173 2e46 6561 7475 7265 5365  chemas.FeatureSe
-00010240: 742c 2046 6561 7475 7265 5365 745d 2c0a  t, FeatureSet],.
-00010250: 2020 2020 2020 2020 7072 6f6a 6563 743d          project=
-00010260: 2222 2c0a 2020 2020 2020 2020 7665 7273  "",.        vers
-00010270: 696f 6e65 643d 5472 7565 2c0a 2020 2020  ioned=True,.    
-00010280: 2920 2d3e 2064 6963 743a 0a20 2020 2020  ) -> dict:.     
-00010290: 2020 2022 2222 4372 6561 7465 2061 206e     """Create a n
-000102a0: 6577 203a 7079 3a63 6c61 7373 3a60 7e6d  ew :py:class:`~m
-000102b0: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
-000102c0: 7265 2e46 6561 7475 7265 5365 7460 2061  re.FeatureSet` a
-000102d0: 6e64 2073 6176 6520 696e 2074 6865 203a  nd save in the :
-000102e0: 7079 3a6d 6f64 3a60 6d6c 7275 6e60 2044  py:mod:`mlrun` D
-000102f0: 422e 2054 6865 0a20 2020 2020 2020 2066  B. The.        f
-00010300: 6561 7475 7265 2d73 6574 206d 7573 7420  eature-set must 
-00010310: 6e6f 7420 7072 6576 696f 7573 6c79 2065  not previously e
-00010320: 7869 7374 2069 6e20 7468 6520 4442 2e0a  xist in the DB..
-00010330: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00010340: 6665 6174 7572 655f 7365 743a 2054 6865  feature_set: The
-00010350: 206e 6577 203a 7079 3a63 6c61 7373 3a60   new :py:class:`
-00010360: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00010370: 746f 7265 2e46 6561 7475 7265 5365 7460  tore.FeatureSet`
-00010380: 2074 6f20 6372 6561 7465 2e0a 2020 2020   to create..    
-00010390: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-000103a0: 6374 3a20 4e61 6d65 206f 6620 7072 6f6a  ct: Name of proj
-000103b0: 6563 7420 7468 6973 2066 6561 7475 7265  ect this feature
-000103c0: 2d73 6574 2062 656c 6f6e 6773 2074 6f2e  -set belongs to.
-000103d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000103e0: 7665 7273 696f 6e65 643a 2057 6865 7468  versioned: Wheth
-000103f0: 6572 2074 6f20 6d61 696e 7461 696e 2076  er to maintain v
-00010400: 6572 7369 6f6e 7320 666f 7220 7468 6973  ersions for this
-00010410: 2066 6561 7475 7265 2d73 6574 2e20 416c   feature-set. Al
-00010420: 6c20 7665 7273 696f 6e73 206f 6620 6120  l versions of a 
-00010430: 7665 7273 696f 6e65 6420 6f62 6a65 6374  versioned object
-00010440: 0a20 2020 2020 2020 2020 2020 2077 696c  .            wil
-00010450: 6c20 6265 206b 6570 7420 696e 2074 6865  l be kept in the
-00010460: 2044 4220 616e 6420 6361 6e20 6265 2072   DB and can be r
-00010470: 6574 7269 6576 6564 2075 6e74 696c 2065  etrieved until e
-00010480: 7870 6c69 6369 746c 7920 6465 6c65 7465  xplicitly delete
-00010490: 642e 0a20 2020 2020 2020 203a 7265 7475  d..        :retu
-000104a0: 726e 733a 2054 6865 203a 7079 3a63 6c61  rns: The :py:cla
-000104b0: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
-000104c0: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
-000104d0: 5365 7460 206f 626a 6563 7420 2861 7320  Set` object (as 
-000104e0: 6469 6374 292e 0a20 2020 2020 2020 2022  dict)..        "
-000104f0: 2222 0a20 2020 2020 2020 2069 6620 6973  "".        if is
-00010500: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
-00010510: 5f73 6574 2c20 6d6c 7275 6e2e 636f 6d6d  _set, mlrun.comm
-00010520: 6f6e 2e73 6368 656d 6173 2e46 6561 7475  on.schemas.Featu
-00010530: 7265 5365 7429 3a0a 2020 2020 2020 2020  reSet):.        
-00010540: 2020 2020 6665 6174 7572 655f 7365 7420      feature_set 
-00010550: 3d20 6665 6174 7572 655f 7365 742e 6469  = feature_set.di
-00010560: 6374 2829 0a20 2020 2020 2020 2065 6c69  ct().        eli
-00010570: 6620 6973 696e 7374 616e 6365 2866 6561  f isinstance(fea
-00010580: 7475 7265 5f73 6574 2c20 4665 6174 7572  ture_set, Featur
-00010590: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
-000105a0: 2020 2066 6561 7475 7265 5f73 6574 203d     feature_set =
-000105b0: 2066 6561 7475 7265 5f73 6574 2e74 6f5f   feature_set.to_
-000105c0: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
-000105d0: 7072 6f6a 6563 7420 3d20 280a 2020 2020  project = (.    
-000105e0: 2020 2020 2020 2020 7072 6f6a 6563 740a          project.
-000105f0: 2020 2020 2020 2020 2020 2020 6f72 2066              or f
-00010600: 6561 7475 7265 5f73 6574 5b22 6d65 7461  eature_set["meta
-00010610: 6461 7461 225d 2e67 6574 2822 7072 6f6a  data"].get("proj
-00010620: 6563 7422 2c20 4e6f 6e65 290a 2020 2020  ect", None).    
-00010630: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
-00010640: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-00010650: 740a 2020 2020 2020 2020 290a 2020 2020  t.        ).    
-00010660: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-00010670: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-00010680: 6665 6174 7572 652d 7365 7473 220a 2020  feature-sets".  
-00010690: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
-000106a0: 2276 6572 7369 6f6e 6564 223a 2076 6572  "versioned": ver
-000106b0: 7369 6f6e 6564 7d0a 0a20 2020 2020 2020  sioned}..       
-000106c0: 206e 616d 6520 3d20 6665 6174 7572 655f   name = feature_
-000106d0: 7365 745b 226d 6574 6164 6174 6122 5d5b  set["metadata"][
-000106e0: 226e 616d 6522 5d0a 2020 2020 2020 2020  "name"].        
-000106f0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-00010700: 6622 4661 696c 6564 2063 7265 6174 696e  f"Failed creatin
-00010710: 6720 6665 6174 7572 652d 7365 7420 7b70  g feature-set {p
-00010720: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
-00010730: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-00010740: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-00010750: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
-00010760: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-00010770: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
-00010780: 6572 726f 725f 6d65 7373 6167 652c 0a20  error_message,. 
-00010790: 2020 2020 2020 2020 2020 2070 6172 616d             param
-000107a0: 733d 7061 7261 6d73 2c0a 2020 2020 2020  s=params,.      
-000107b0: 2020 2020 2020 626f 6479 3d64 6963 745f        body=dict_
-000107c0: 746f 5f6a 736f 6e28 6665 6174 7572 655f  to_json(feature_
-000107d0: 7365 7429 2c0a 2020 2020 2020 2020 290a  set),.        ).
-000107e0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-000107f0: 6573 702e 6a73 6f6e 2829 0a0a 2020 2020  esp.json()..    
-00010800: 6465 6620 6765 745f 6665 6174 7572 655f  def get_feature_
-00010810: 7365 7428 0a20 2020 2020 2020 2073 656c  set(.        sel
-00010820: 662c 206e 616d 653a 2073 7472 2c20 7072  f, name: str, pr
-00010830: 6f6a 6563 743a 2073 7472 203d 2022 222c  oject: str = "",
-00010840: 2074 6167 3a20 7374 7220 3d20 4e6f 6e65   tag: str = None
-00010850: 2c20 7569 643a 2073 7472 203d 204e 6f6e  , uid: str = Non
-00010860: 650a 2020 2020 2920 2d3e 2046 6561 7475  e.    ) -> Featu
-00010870: 7265 5365 743a 0a20 2020 2020 2020 2022  reSet:.        "
-00010880: 2222 5265 7472 6965 7665 2061 207e 6d6c  ""Retrieve a ~ml
-00010890: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
-000108a0: 652e 4665 6174 7572 6553 6574 6020 6f62  e.FeatureSet` ob
-000108b0: 6a65 6374 2e20 4966 2062 6f74 6820 6060  ject. If both ``
-000108c0: 7461 6760 6020 616e 6420 6060 7569 6460  tag`` and ``uid`
-000108d0: 6020 6172 6520 6e6f 7420 7370 6563 6966  ` are not specif
-000108e0: 6965 642c 2074 6865 6e0a 2020 2020 2020  ied, then.      
-000108f0: 2020 7468 6520 6f62 6a65 6374 2074 6167    the object tag
-00010900: 6765 6420 6060 6c61 7465 7374 6060 2077  ged ``latest`` w
-00010910: 696c 6c20 6265 2072 6574 7269 6576 6564  ill be retrieved
-00010920: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-00010930: 6d20 6e61 6d65 3a20 4e61 6d65 206f 6620  m name: Name of 
-00010940: 6f62 6a65 6374 2074 6f20 7265 7472 6965  object to retrie
-00010950: 7665 2e0a 2020 2020 2020 2020 3a70 6172  ve..        :par
-00010960: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
-00010970: 6563 7420 7468 6520 4665 6174 7572 6553  ect the FeatureS
-00010980: 6574 2062 656c 6f6e 6773 2074 6f2e 0a20  et belongs to.. 
-00010990: 2020 2020 2020 203a 7061 7261 6d20 7461         :param ta
-000109a0: 673a 2054 6167 206f 6620 7468 6520 7370  g: Tag of the sp
-000109b0: 6563 6966 6963 206f 626a 6563 7420 7665  ecific object ve
-000109c0: 7273 696f 6e20 746f 2072 6574 7269 6576  rsion to retriev
-000109d0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-000109e0: 6d20 7569 643a 2075 6964 206f 6620 7468  m uid: uid of th
-000109f0: 6520 6f62 6a65 6374 2074 6f20 7265 7472  e object to retr
-00010a00: 6965 7665 2028 6361 6e20 6f6e 6c79 2062  ieve (can only b
-00010a10: 6520 7573 6564 2066 6f72 2076 6572 7369  e used for versi
-00010a20: 6f6e 6564 206f 626a 6563 7473 292e 0a20  oned objects).. 
-00010a30: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00010a40: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00010a50: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
-00010a60: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
-00010a70: 2020 2020 2020 2020 7265 6665 7265 6e63          referenc
-00010a80: 6520 3d20 7365 6c66 2e5f 7265 736f 6c76  e = self._resolv
-00010a90: 655f 7265 6665 7265 6e63 6528 7461 672c  e_reference(tag,
-00010aa0: 2075 6964 290a 2020 2020 2020 2020 7061   uid).        pa
-00010ab0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-00010ac0: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
-00010ad0: 652d 7365 7473 2f7b 6e61 6d65 7d2f 7265  e-sets/{name}/re
-00010ae0: 6665 7265 6e63 6573 2f7b 7265 6665 7265  ferences/{refere
-00010af0: 6e63 657d 220a 2020 2020 2020 2020 6572  nce}".        er
-00010b00: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
-00010b10: 4661 696c 6564 2072 6574 7269 6576 696e  Failed retrievin
-00010b20: 6720 6665 6174 7572 652d 7365 7420 7b70  g feature-set {p
-00010b30: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
-00010b40: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-00010b50: 656c 662e 6170 695f 6361 6c6c 2822 4745  elf.api_call("GE
-00010b60: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
-00010b70: 6d65 7373 6167 6529 0a20 2020 2020 2020  message).       
-00010b80: 2072 6574 7572 6e20 4665 6174 7572 6553   return FeatureS
-00010b90: 6574 2e66 726f 6d5f 6469 6374 2872 6573  et.from_dict(res
-00010ba0: 702e 6a73 6f6e 2829 290a 0a20 2020 2064  p.json())..    d
-00010bb0: 6566 206c 6973 745f 6665 6174 7572 6573  ef list_features
-00010bc0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00010bd0: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-00010be0: 2073 7472 2c0a 2020 2020 2020 2020 6e61   str,.        na
-00010bf0: 6d65 3a20 7374 7220 3d20 4e6f 6e65 2c0a  me: str = None,.
-00010c00: 2020 2020 2020 2020 7461 673a 2073 7472          tag: str
-00010c10: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00010c20: 2065 6e74 6974 6965 733a 204c 6973 745b   entities: List[
-00010c30: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00010c40: 2020 2020 206c 6162 656c 733a 204c 6973       labels: Lis
-00010c50: 745b 7374 725d 203d 204e 6f6e 652c 0a20  t[str] = None,. 
-00010c60: 2020 2029 202d 3e20 4c69 7374 5b64 6963     ) -> List[dic
-00010c70: 745d 3a0a 2020 2020 2020 2020 2222 224c  t]:.        """L
-00010c80: 6973 7420 6665 6174 7572 652d 7365 7473  ist feature-sets
-00010c90: 2077 6869 6368 2063 6f6e 7461 696e 2073   which contain s
-00010ca0: 7065 6369 6669 6320 6665 6174 7572 6573  pecific features
-00010cb0: 2e20 5468 6973 2066 756e 6374 696f 6e20  . This function 
-00010cc0: 6d61 7920 7265 7475 726e 206d 756c 7469  may return multi
-00010cd0: 706c 6520 7665 7273 696f 6e73 206f 6620  ple versions of 
-00010ce0: 7468 6520 7361 6d65 0a20 2020 2020 2020  the same.       
-00010cf0: 2066 6561 7475 7265 2d73 6574 2069 6620   feature-set if 
-00010d00: 6120 7370 6563 6966 6963 2074 6167 2069  a specific tag i
-00010d10: 7320 6e6f 7420 7265 7175 6573 7465 642e  s not requested.
-00010d20: 204e 6f74 6520 7468 6174 2074 6865 2076   Note that the v
-00010d30: 6172 696f 7573 2066 696c 7465 7273 206f  arious filters o
-00010d40: 6620 7468 6973 2066 756e 6374 696f 6e20  f this function 
-00010d50: 6163 7475 616c 6c79 0a20 2020 2020 2020  actually.       
-00010d60: 2072 6566 6572 2074 6f20 7468 6520 6665   refer to the fe
-00010d70: 6174 7572 652d 7365 7420 6f62 6a65 6374  ature-set object
-00010d80: 2063 6f6e 7461 696e 696e 6720 7468 6520   containing the 
-00010d90: 6665 6174 7572 6573 2c20 6e6f 7420 746f  features, not to
-00010da0: 2074 6865 2066 6561 7475 7265 7320 7468   the features th
-00010db0: 656d 7365 6c76 6573 2e0a 0a20 2020 2020  emselves...     
-00010dc0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00010dd0: 743a 2050 726f 6a65 6374 2077 6869 6368  t: Project which
-00010de0: 2063 6f6e 7461 696e 7320 7468 6573 6520   contains these 
-00010df0: 6665 6174 7572 6573 2e0a 2020 2020 2020  features..      
-00010e00: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
-00010e10: 616d 6520 6f66 2074 6865 2066 6561 7475  ame of the featu
-00010e20: 7265 2074 6f20 6c6f 6f6b 2066 6f72 2e20  re to look for. 
-00010e30: 5468 6520 6e61 6d65 2069 7320 7573 6564  The name is used
-00010e40: 2069 6e20 6120 6c69 6b65 2071 7565 7279   in a like query
-00010e50: 2c20 616e 6420 6973 206e 6f74 2063 6173  , and is not cas
-00010e60: 652d 7365 6e73 6974 6976 652e 2046 6f72  e-sensitive. For
-00010e70: 0a20 2020 2020 2020 2020 2020 2065 7861  .            exa
-00010e80: 6d70 6c65 2c20 6c6f 6f6b 696e 6720 666f  mple, looking fo
-00010e90: 7220 6060 6665 6174 6060 2077 696c 6c20  r ``feat`` will 
-00010ea0: 7265 7475 726e 2066 6561 7475 7265 7320  return features 
-00010eb0: 7768 6963 6820 6172 6520 6e61 6d65 6420  which are named 
-00010ec0: 6060 4d79 4665 6174 7572 6560 6020 6173  ``MyFeature`` as
-00010ed0: 2077 656c 6c20 6173 2060 6064 6566 6561   well as ``defea
-00010ee0: 7460 602e 0a20 2020 2020 2020 203a 7061  t``..        :pa
-00010ef0: 7261 6d20 7461 673a 2052 6574 7572 6e20  ram tag: Return 
-00010f00: 6665 6174 7572 652d 7365 7473 2077 6869  feature-sets whi
-00010f10: 6368 2063 6f6e 7461 696e 2074 6865 2066  ch contain the f
-00010f20: 6561 7475 7265 7320 6c6f 6f6b 6564 2066  eatures looked f
-00010f30: 6f72 2c20 616e 6420 6172 6520 7461 6767  or, and are tagg
-00010f40: 6564 2077 6974 6820 7468 6520 7370 6563  ed with the spec
-00010f50: 6966 6963 2074 6167 2e0a 2020 2020 2020  ific tag..      
-00010f60: 2020 3a70 6172 616d 2065 6e74 6974 6965    :param entitie
-00010f70: 733a 2052 6574 7572 6e20 6f6e 6c79 2066  s: Return only f
-00010f80: 6561 7475 7265 2d73 6574 7320 7768 6963  eature-sets whic
-00010f90: 6820 636f 6e74 6169 6e20 616e 2065 6e74  h contain an ent
-00010fa0: 6974 7920 7768 6f73 6520 6e61 6d65 2069  ity whose name i
-00010fb0: 7320 636f 6e74 6169 6e65 6420 696e 2074  s contained in t
-00010fc0: 6869 7320 6c69 7374 2e0a 2020 2020 2020  his list..      
-00010fd0: 2020 3a70 6172 616d 206c 6162 656c 733a    :param labels:
-00010fe0: 2052 6574 7572 6e20 6f6e 6c79 2066 6561   Return only fea
-00010ff0: 7475 7265 2d73 6574 7320 7768 6963 6820  ture-sets which 
-00011000: 6172 6520 6c61 6265 6c65 6420 6173 2072  are labeled as r
-00011010: 6571 7565 7374 6564 2e0a 2020 2020 2020  equested..      
-00011020: 2020 3a72 6574 7572 6e73 3a20 4120 6c69    :returns: A li
-00011030: 7374 206f 6620 6d61 7070 696e 6720 6672  st of mapping fr
-00011040: 6f6d 2066 6561 7475 7265 2074 6f20 6120  om feature to a 
-00011050: 6469 6765 7374 206f 6620 7468 6520 6665  digest of the fe
-00011060: 6174 7572 652d 7365 742c 2077 6869 6368  ature-set, which
-00011070: 2063 6f6e 7461 696e 7320 7468 6520 6665   contains the fe
-00011080: 6174 7572 652d 7365 740a 2020 2020 2020  ature-set.      
-00011090: 2020 2020 2020 6d65 7461 2d64 6174 612e        meta-data.
-000110a0: 204d 756c 7469 706c 6520 656e 7472 6965   Multiple entrie
-000110b0: 7320 6d61 7920 6265 2072 6574 7572 6e65  s may be returne
-000110c0: 6420 666f 7220 616e 7920 7370 6563 6966  d for any specif
-000110d0: 6963 2066 6561 7475 7265 2064 7565 2074  ic feature due t
-000110e0: 6f20 6d75 6c74 6970 6c65 2074 6167 7320  o multiple tags 
-000110f0: 6f72 2076 6572 7369 6f6e 730a 2020 2020  or versions.    
-00011100: 2020 2020 2020 2020 6f66 2074 6865 2066          of the f
-00011110: 6561 7475 7265 2d73 6574 2e0a 2020 2020  eature-set..    
-00011120: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
-00011130: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00011140: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-00011150: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-00011160: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
-00011170: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
-00011180: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
-00011190: 2020 2020 2020 2274 6167 223a 2074 6167        "tag": tag
-000111a0: 2c0a 2020 2020 2020 2020 2020 2020 2265  ,.            "e
-000111b0: 6e74 6974 7922 3a20 656e 7469 7469 6573  ntity": entities
-000111c0: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
-000111d0: 2020 2020 226c 6162 656c 223a 206c 6162      "label": lab
-000111e0: 656c 7320 6f72 205b 5d2c 0a20 2020 2020  els or [],.     
-000111f0: 2020 207d 0a0a 2020 2020 2020 2020 7061     }..        pa
-00011200: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-00011210: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
-00011220: 6573 220a 0a20 2020 2020 2020 2065 7272  es"..        err
-00011230: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-00011240: 6169 6c65 6420 6c69 7374 696e 6720 6665  ailed listing fe
-00011250: 6174 7572 6573 2c20 7072 6f6a 6563 743a  atures, project:
-00011260: 207b 7072 6f6a 6563 747d 2c20 7175 6572   {project}, quer
-00011270: 793a 207b 7061 7261 6d73 7d22 0a20 2020  y: {params}".   
-00011280: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
-00011290: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
-000112a0: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
-000112b0: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
-000112c0: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
-000112d0: 7572 6e20 7265 7370 2e6a 736f 6e28 295b  urn resp.json()[
-000112e0: 2266 6561 7475 7265 7322 5d0a 0a20 2020  "features"]..   
-000112f0: 2064 6566 206c 6973 745f 656e 7469 7469   def list_entiti
-00011300: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
-00011310: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00011320: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
-00011330: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
-00011340: 2c0a 2020 2020 2020 2020 7461 673a 2073  ,.        tag: s
-00011350: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-00011360: 2020 206c 6162 656c 733a 204c 6973 745b     labels: List[
-00011370: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00011380: 2029 202d 3e20 4c69 7374 5b64 6963 745d   ) -> List[dict]
-00011390: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
-000113a0: 7269 6576 6520 6120 6c69 7374 206f 6620  rieve a list of 
-000113b0: 656e 7469 7469 6573 2061 6e64 2074 6865  entities and the
-000113c0: 6972 206d 6170 7069 6e67 2074 6f20 7468  ir mapping to th
-000113d0: 6520 636f 6e74 6169 6e69 6e67 2066 6561  e containing fea
-000113e0: 7475 7265 2d73 6574 732e 2054 6869 7320  ture-sets. This 
-000113f0: 6675 6e63 7469 6f6e 2069 7320 7369 6d69  function is simi
-00011400: 6c61 720a 2020 2020 2020 2020 746f 2074  lar.        to t
-00011410: 6865 203a 7079 3a66 756e 633a 607e 6c69  he :py:func:`~li
-00011420: 7374 5f66 6561 7475 7265 7360 2066 756e  st_features` fun
-00011430: 6374 696f 6e2c 2061 6e64 2075 7365 7320  ction, and uses 
-00011440: 7468 6520 7361 6d65 206c 6f67 6963 2e20  the same logic. 
-00011450: 486f 7765 7665 722c 2074 6865 2065 6e74  However, the ent
-00011460: 6974 6965 7320 6172 6520 6d61 7463 6865  ities are matche
-00011470: 640a 2020 2020 2020 2020 6167 6169 6e73  d.        agains
-00011480: 7420 7468 6520 6e61 6d65 2072 6174 6865  t the name rathe
-00011490: 7220 7468 616e 2074 6865 2066 6561 7475  r than the featu
-000114a0: 7265 732e 0a20 2020 2020 2020 2022 2222  res..        """
-000114b0: 0a0a 2020 2020 2020 2020 7072 6f6a 6563  ..        projec
-000114c0: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
-000114d0: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
-000114e0: 6f6a 6563 740a 2020 2020 2020 2020 7061  oject.        pa
-000114f0: 7261 6d73 203d 207b 0a20 2020 2020 2020  rams = {.       
-00011500: 2020 2020 2022 6e61 6d65 223a 206e 616d       "name": nam
-00011510: 652c 0a20 2020 2020 2020 2020 2020 2022  e,.            "
-00011520: 7461 6722 3a20 7461 672c 0a20 2020 2020  tag": tag,.     
-00011530: 2020 2020 2020 2022 6c61 6265 6c22 3a20         "label": 
-00011540: 6c61 6265 6c73 206f 7220 5b5d 2c0a 2020  labels or [],.  
-00011550: 2020 2020 2020 7d0a 0a20 2020 2020 2020        }..       
-00011560: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
-00011570: 7473 2f7b 7072 6f6a 6563 747d 2f65 6e74  ts/{project}/ent
-00011580: 6974 6965 7322 0a0a 2020 2020 2020 2020  ities"..        
-00011590: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-000115a0: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
-000115b0: 2065 6e74 6974 6965 732c 2070 726f 6a65   entities, proje
-000115c0: 6374 3a20 7b70 726f 6a65 6374 7d2c 2071  ct: {project}, q
-000115d0: 7565 7279 3a20 7b70 6172 616d 737d 220a  uery: {params}".
-000115e0: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
-000115f0: 656c 662e 6170 695f 6361 6c6c 2822 4745  elf.api_call("GE
-00011600: 5422 2c20 7061 7468 2c20 6572 726f 725f  T", path, error_
-00011610: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
-00011620: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
-00011630: 7265 7475 726e 2072 6573 702e 6a73 6f6e  return resp.json
-00011640: 2829 5b22 656e 7469 7469 6573 225d 0a0a  ()["entities"]..
-00011650: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00011660: 640a 2020 2020 6465 6620 5f67 656e 6572  d.    def _gener
-00011670: 6174 655f 7061 7274 6974 696f 6e5f 6279  ate_partition_by
-00011680: 5f70 6172 616d 7328 0a20 2020 2020 2020  _params(.       
-00011690: 2070 6172 7469 7469 6f6e 5f62 795f 636c   partition_by_cl
-000116a0: 732c 0a20 2020 2020 2020 2070 6172 7469  s,.        parti
-000116b0: 7469 6f6e 5f62 792c 0a20 2020 2020 2020  tion_by,.       
-000116c0: 2072 6f77 735f 7065 725f 7061 7274 6974   rows_per_partit
-000116d0: 696f 6e2c 0a20 2020 2020 2020 2073 6f72  ion,.        sor
-000116e0: 745f 6279 2c0a 2020 2020 2020 2020 6f72  t_by,.        or
-000116f0: 6465 722c 0a20 2020 2020 2020 206d 6178  der,.        max
-00011700: 5f70 6172 7469 7469 6f6e 733d 4e6f 6e65  _partitions=None
-00011710: 2c0a 2020 2020 293a 0a0a 2020 2020 2020  ,.    ):..      
-00011720: 2020 7061 7274 6974 696f 6e5f 7061 7261    partition_para
-00011730: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
-00011740: 2020 2022 7061 7274 6974 696f 6e2d 6279     "partition-by
-00011750: 223a 2070 6172 7469 7469 6f6e 5f62 792c  ": partition_by,
-00011760: 0a20 2020 2020 2020 2020 2020 2022 726f  .            "ro
-00011770: 7773 2d70 6572 2d70 6172 7469 7469 6f6e  ws-per-partition
-00011780: 223a 2072 6f77 735f 7065 725f 7061 7274  ": rows_per_part
-00011790: 6974 696f 6e2c 0a20 2020 2020 2020 2020  ition,.         
-000117a0: 2020 2022 7061 7274 6974 696f 6e2d 736f     "partition-so
-000117b0: 7274 2d62 7922 3a20 736f 7274 5f62 792c  rt-by": sort_by,
-000117c0: 0a20 2020 2020 2020 2020 2020 2022 7061  .            "pa
-000117d0: 7274 6974 696f 6e2d 6f72 6465 7222 3a20  rtition-order": 
-000117e0: 6f72 6465 722c 0a20 2020 2020 2020 207d  order,.        }
-000117f0: 0a20 2020 2020 2020 2069 6620 6d61 785f  .        if max_
-00011800: 7061 7274 6974 696f 6e73 2069 7320 6e6f  partitions is no
-00011810: 7420 4e6f 6e65 3a0a 2020 2020 2020 2020  t None:.        
-00011820: 2020 2020 7061 7274 6974 696f 6e5f 7061      partition_pa
-00011830: 7261 6d73 5b22 6d61 782d 7061 7274 6974  rams["max-partit
-00011840: 696f 6e73 225d 203d 206d 6178 5f70 6172  ions"] = max_par
-00011850: 7469 7469 6f6e 730a 2020 2020 2020 2020  titions.        
-00011860: 7265 7475 726e 2070 6172 7469 7469 6f6e  return partition
-00011870: 5f70 6172 616d 730a 0a20 2020 2064 6566  _params..    def
-00011880: 206c 6973 745f 6665 6174 7572 655f 7365   list_feature_se
-00011890: 7473 280a 2020 2020 2020 2020 7365 6c66  ts(.        self
-000118a0: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-000118b0: 743a 2073 7472 203d 2022 222c 0a20 2020  t: str = "",.   
-000118c0: 2020 2020 206e 616d 653a 2073 7472 203d       name: str =
-000118d0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-000118e0: 6167 3a20 7374 7220 3d20 4e6f 6e65 2c0a  ag: str = None,.
-000118f0: 2020 2020 2020 2020 7374 6174 653a 2073          state: s
-00011900: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
-00011910: 2020 2065 6e74 6974 6965 733a 204c 6973     entities: Lis
-00011920: 745b 7374 725d 203d 204e 6f6e 652c 0a20  t[str] = None,. 
-00011930: 2020 2020 2020 2066 6561 7475 7265 733a         features:
-00011940: 204c 6973 745b 7374 725d 203d 204e 6f6e   List[str] = Non
-00011950: 652c 0a20 2020 2020 2020 206c 6162 656c  e,.        label
-00011960: 733a 204c 6973 745b 7374 725d 203d 204e  s: List[str] = N
-00011970: 6f6e 652c 0a20 2020 2020 2020 2070 6172  one,.        par
-00011980: 7469 7469 6f6e 5f62 793a 2055 6e69 6f6e  tition_by: Union
-00011990: 5b0a 2020 2020 2020 2020 2020 2020 6d6c  [.            ml
-000119a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-000119b0: 6173 2e46 6561 7475 7265 5374 6f72 6550  as.FeatureStoreP
-000119c0: 6172 7469 7469 6f6e 4279 4669 656c 642c  artitionByField,
-000119d0: 2073 7472 0a20 2020 2020 2020 205d 203d   str.        ] =
-000119e0: 204e 6f6e 652c 0a20 2020 2020 2020 2072   None,.        r
-000119f0: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
-00011a00: 6e3a 2069 6e74 203d 2031 2c0a 2020 2020  n: int = 1,.    
-00011a10: 2020 2020 7061 7274 6974 696f 6e5f 736f      partition_so
-00011a20: 7274 5f62 793a 2055 6e69 6f6e 5b6d 6c72  rt_by: Union[mlr
-00011a30: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00011a40: 732e 536f 7274 4669 656c 642c 2073 7472  s.SortField, str
-00011a50: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
-00011a60: 2020 7061 7274 6974 696f 6e5f 6f72 6465    partition_orde
-00011a70: 723a 2055 6e69 6f6e 5b0a 2020 2020 2020  r: Union[.      
-00011a80: 2020 2020 2020 6d6c 7275 6e2e 636f 6d6d        mlrun.comm
-00011a90: 6f6e 2e73 6368 656d 6173 2e4f 7264 6572  on.schemas.Order
-00011aa0: 5479 7065 2c20 7374 720a 2020 2020 2020  Type, str.      
-00011ab0: 2020 5d20 3d20 6d6c 7275 6e2e 636f 6d6d    ] = mlrun.comm
-00011ac0: 6f6e 2e73 6368 656d 6173 2e4f 7264 6572  on.schemas.Order
-00011ad0: 5479 7065 2e64 6573 632c 0a20 2020 2029  Type.desc,.    )
-00011ae0: 202d 3e20 4c69 7374 5b46 6561 7475 7265   -> List[Feature
-00011af0: 5365 745d 3a0a 2020 2020 2020 2020 2222  Set]:.        ""
-00011b00: 2252 6574 7269 6576 6520 6120 6c69 7374  "Retrieve a list
-00011b10: 206f 6620 6665 6174 7572 652d 7365 7473   of feature-sets
-00011b20: 206d 6174 6368 696e 6720 7468 6520 6372   matching the cr
-00011b30: 6974 6572 6961 2070 726f 7669 6465 642e  iteria provided.
-00011b40: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00011b50: 2070 726f 6a65 6374 3a20 5072 6f6a 6563   project: Projec
-00011b60: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
-00011b70: 3a70 6172 616d 206e 616d 653a 204e 616d  :param name: Nam
-00011b80: 6520 6f66 2066 6561 7475 7265 2d73 6574  e of feature-set
-00011b90: 2074 6f20 6d61 7463 682e 2054 6869 7320   to match. This 
-00011ba0: 6973 2061 206c 696b 6520 7175 6572 792c  is a like query,
-00011bb0: 2061 6e64 2069 7320 6361 7365 2d69 6e73   and is case-ins
-00011bc0: 656e 7369 7469 7665 2e0a 2020 2020 2020  ensitive..      
-00011bd0: 2020 3a70 6172 616d 2074 6167 3a20 4d61    :param tag: Ma
-00011be0: 7463 6820 6665 6174 7572 652d 7365 7473  tch feature-sets
-00011bf0: 2077 6974 6820 7370 6563 6966 6963 2074   with specific t
-00011c00: 6167 2e0a 2020 2020 2020 2020 3a70 6172  ag..        :par
-00011c10: 616d 2073 7461 7465 3a20 4d61 7463 6820  am state: Match 
-00011c20: 6665 6174 7572 652d 7365 7473 2077 6974  feature-sets wit
-00011c30: 6820 6120 7370 6563 6966 6963 2073 7461  h a specific sta
-00011c40: 7465 2e0a 2020 2020 2020 2020 3a70 6172  te..        :par
-00011c50: 616d 2065 6e74 6974 6965 733a 204d 6174  am entities: Mat
-00011c60: 6368 2066 6561 7475 7265 2d73 6574 7320  ch feature-sets 
-00011c70: 7768 6963 6820 636f 6e74 6169 6e20 656e  which contain en
-00011c80: 7469 7469 6573 2077 686f 7365 206e 616d  tities whose nam
-00011c90: 6520 6973 2069 6e20 7468 6973 206c 6973  e is in this lis
-00011ca0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
-00011cb0: 6d20 6665 6174 7572 6573 3a20 4d61 7463  m features: Matc
-00011cc0: 6820 6665 6174 7572 652d 7365 7473 2077  h feature-sets w
-00011cd0: 6869 6368 2063 6f6e 7461 696e 2066 6561  hich contain fea
-00011ce0: 7475 7265 7320 7768 6f73 6520 6e61 6d65  tures whose name
-00011cf0: 2069 7320 696e 2074 6869 7320 6c69 7374   is in this list
-00011d00: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00011d10: 206c 6162 656c 733a 204d 6174 6368 2066   labels: Match f
-00011d20: 6561 7475 7265 2d73 6574 7320 7768 6963  eature-sets whic
-00011d30: 6820 6861 7665 2074 6865 7365 206c 6162  h have these lab
-00011d40: 656c 732e 0a20 2020 2020 2020 203a 7061  els..        :pa
-00011d50: 7261 6d20 7061 7274 6974 696f 6e5f 6279  ram partition_by
-00011d60: 3a20 4669 656c 6420 746f 2067 726f 7570  : Field to group
-00011d70: 2072 6573 756c 7473 2062 792e 204f 6e6c   results by. Onl
-00011d80: 7920 616c 6c6f 7765 6420 7661 6c75 6520  y allowed value 
-00011d90: 6973 2060 6e61 6d65 602e 2057 6865 6e20  is `name`. When 
-00011da0: 6070 6172 7469 7469 6f6e 5f62 7960 2069  `partition_by` i
-00011db0: 7320 7370 6563 6966 6965 642c 0a20 2020  s specified,.   
-00011dc0: 2020 2020 2020 2020 2074 6865 2060 7061           the `pa
-00011dd0: 7274 6974 696f 6e5f 736f 7274 5f62 7960  rtition_sort_by`
-00011de0: 2070 6172 616d 6574 6572 206d 7573 7420   parameter must 
-00011df0: 6265 2070 726f 7669 6465 6420 6173 2077  be provided as w
-00011e00: 656c 6c2e 0a20 2020 2020 2020 203a 7061  ell..        :pa
-00011e10: 7261 6d20 726f 7773 5f70 6572 5f70 6172  ram rows_per_par
-00011e20: 7469 7469 6f6e 3a20 486f 7720 6d61 6e79  tition: How many
-00011e30: 2074 6f70 2072 6f77 7320 2870 6572 2073   top rows (per s
-00011e40: 6f72 7469 6e67 2064 6566 696e 6564 2062  orting defined b
-00011e50: 7920 6070 6172 7469 7469 6f6e 5f73 6f72  y `partition_sor
-00011e60: 745f 6279 6020 616e 6420 6070 6172 7469  t_by` and `parti
-00011e70: 7469 6f6e 5f6f 7264 6572 6029 0a20 2020  tion_order`).   
-00011e80: 2020 2020 2020 2020 2074 6f20 7265 7475           to retu
-00011e90: 726e 2070 6572 2067 726f 7570 2e20 4465  rn per group. De
-00011ea0: 6661 756c 7420 7661 6c75 6520 6973 2031  fault value is 1
-00011eb0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00011ec0: 2070 6172 7469 7469 6f6e 5f73 6f72 745f   partition_sort_
-00011ed0: 6279 3a20 5768 6174 2066 6965 6c64 2074  by: What field t
-00011ee0: 6f20 736f 7274 2074 6865 2072 6573 756c  o sort the resul
-00011ef0: 7473 2062 792c 2077 6974 6869 6e20 6561  ts by, within ea
-00011f00: 6368 2070 6172 7469 7469 6f6e 2064 6566  ch partition def
-00011f10: 696e 6564 2062 7920 6070 6172 7469 7469  ined by `partiti
-00011f20: 6f6e 5f62 7960 2e0a 2020 2020 2020 2020  on_by`..        
-00011f30: 2020 2020 4375 7272 656e 746c 7920 7468      Currently th
-00011f40: 6520 6f6e 6c79 2061 6c6c 6f77 6564 2076  e only allowed v
-00011f50: 616c 7565 2061 7265 2060 6372 6561 7465  alue are `create
-00011f60: 6460 2061 6e64 2060 7570 6461 7465 6460  d` and `updated`
-00011f70: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00011f80: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-00011f90: 3a20 4f72 6465 7220 6f66 2073 6f72 7469  : Order of sorti
-00011fa0: 6e67 2077 6974 6869 6e20 7061 7274 6974  ng within partit
-00011fb0: 696f 6e73 202d 2060 6173 6360 206f 7220  ions - `asc` or 
-00011fc0: 6064 6573 6360 2e20 4465 6661 756c 7420  `desc`. Default 
-00011fd0: 6973 2060 6465 7363 602e 0a20 2020 2020  is `desc`..     
-00011fe0: 2020 203a 7265 7475 726e 733a 204c 6973     :returns: Lis
-00011ff0: 7420 6f66 206d 6174 6368 696e 6720 3a70  t of matching :p
-00012000: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-00012010: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-00012020: 6174 7572 6553 6574 6020 6f62 6a65 6374  atureSet` object
-00012030: 732e 0a20 2020 2020 2020 2022 2222 0a0a  s..        """..
-00012040: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
-00012050: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
-00012060: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
-00012070: 6563 740a 0a20 2020 2020 2020 2070 6172  ect..        par
-00012080: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
-00012090: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
-000120a0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
-000120b0: 7461 7465 223a 2073 7461 7465 2c0a 2020  tate": state,.  
-000120c0: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
-000120d0: 2074 6167 2c0a 2020 2020 2020 2020 2020   tag,.          
-000120e0: 2020 2265 6e74 6974 7922 3a20 656e 7469    "entity": enti
-000120f0: 7469 6573 206f 7220 5b5d 2c0a 2020 2020  ties or [],.    
-00012100: 2020 2020 2020 2020 2266 6561 7475 7265          "feature
-00012110: 223a 2066 6561 7475 7265 7320 6f72 205b  ": features or [
-00012120: 5d2c 0a20 2020 2020 2020 2020 2020 2022  ],.            "
-00012130: 6c61 6265 6c22 3a20 6c61 6265 6c73 206f  label": labels o
-00012140: 7220 5b5d 2c0a 2020 2020 2020 2020 7d0a  r [],.        }.
-00012150: 2020 2020 2020 2020 6966 2070 6172 7469          if parti
-00012160: 7469 6f6e 5f62 793a 0a20 2020 2020 2020  tion_by:.       
-00012170: 2020 2020 2070 6172 616d 732e 7570 6461       params.upda
-00012180: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
-00012190: 2020 2020 7365 6c66 2e5f 6765 6e65 7261      self._genera
-000121a0: 7465 5f70 6172 7469 7469 6f6e 5f62 795f  te_partition_by_
-000121b0: 7061 7261 6d73 280a 2020 2020 2020 2020  params(.        
-000121c0: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
-000121d0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000121e0: 2e46 6561 7475 7265 5374 6f72 6550 6172  .FeatureStorePar
-000121f0: 7469 7469 6f6e 4279 4669 656c 642c 0a20  titionByField,. 
-00012200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012210: 2020 2070 6172 7469 7469 6f6e 5f62 792c     partition_by,
-00012220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00012230: 2020 2020 2072 6f77 735f 7065 725f 7061       rows_per_pa
-00012240: 7274 6974 696f 6e2c 0a20 2020 2020 2020  rtition,.       
-00012250: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00012260: 7469 7469 6f6e 5f73 6f72 745f 6279 2c0a  tition_sort_by,.
-00012270: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012280: 2020 2020 7061 7274 6974 696f 6e5f 6f72      partition_or
-00012290: 6465 722c 0a20 2020 2020 2020 2020 2020  der,.           
-000122a0: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-000122b0: 2020 2029 0a0a 2020 2020 2020 2020 7061     )..        pa
-000122c0: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-000122d0: 7b70 726f 6a65 6374 7d2f 6665 6174 7572  {project}/featur
-000122e0: 652d 7365 7473 220a 0a20 2020 2020 2020  e-sets"..       
-000122f0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00012300: 2028 0a20 2020 2020 2020 2020 2020 2066   (.            f
-00012310: 2246 6169 6c65 6420 6c69 7374 696e 6720  "Failed listing 
-00012320: 6665 6174 7572 652d 7365 7473 2c20 7072  feature-sets, pr
-00012330: 6f6a 6563 743a 207b 7072 6f6a 6563 747d  oject: {project}
-00012340: 2c20 7175 6572 793a 207b 7061 7261 6d73  , query: {params
-00012350: 7d22 0a20 2020 2020 2020 2029 0a20 2020  }".        ).   
-00012360: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
-00012370: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
-00012380: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
-00012390: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
-000123a0: 616d 7329 0a20 2020 2020 2020 2066 6561  ams).        fea
-000123b0: 7475 7265 5f73 6574 7320 3d20 7265 7370  ture_sets = resp
-000123c0: 2e6a 736f 6e28 295b 2266 6561 7475 7265  .json()["feature
-000123d0: 5f73 6574 7322 5d0a 2020 2020 2020 2020  _sets"].        
-000123e0: 6966 2066 6561 7475 7265 5f73 6574 733a  if feature_sets:
-000123f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00012400: 7572 6e20 5b46 6561 7475 7265 5365 742e  urn [FeatureSet.
-00012410: 6672 6f6d 5f64 6963 7428 6f62 6a29 2066  from_dict(obj) f
-00012420: 6f72 206f 626a 2069 6e20 6665 6174 7572  or obj in featur
-00012430: 655f 7365 7473 5d0a 0a20 2020 2064 6566  e_sets]..    def
-00012440: 2073 746f 7265 5f66 6561 7475 7265 5f73   store_feature_s
-00012450: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
-00012460: 2c0a 2020 2020 2020 2020 6665 6174 7572  ,.        featur
-00012470: 655f 7365 743a 2055 6e69 6f6e 5b64 6963  e_set: Union[dic
-00012480: 742c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  t, mlrun.common.
-00012490: 7363 6865 6d61 732e 4665 6174 7572 6553  schemas.FeatureS
-000124a0: 6574 2c20 4665 6174 7572 6553 6574 5d2c  et, FeatureSet],
-000124b0: 0a20 2020 2020 2020 206e 616d 653d 4e6f  .        name=No
-000124c0: 6e65 2c0a 2020 2020 2020 2020 7072 6f6a  ne,.        proj
-000124d0: 6563 743d 2222 2c0a 2020 2020 2020 2020  ect="",.        
-000124e0: 7461 673d 4e6f 6e65 2c0a 2020 2020 2020  tag=None,.      
-000124f0: 2020 7569 643d 4e6f 6e65 2c0a 2020 2020    uid=None,.    
-00012500: 2020 2020 7665 7273 696f 6e65 643d 5472      versioned=Tr
-00012510: 7565 2c0a 2020 2020 2920 2d3e 2064 6963  ue,.    ) -> dic
-00012520: 743a 0a20 2020 2020 2020 2022 2222 5361  t:.        """Sa
-00012530: 7665 2061 203a 7079 3a63 6c61 7373 3a60  ve a :py:class:`
-00012540: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00012550: 746f 7265 2e46 6561 7475 7265 5365 7460  tore.FeatureSet`
-00012560: 206f 626a 6563 7420 696e 2074 6865 203a   object in the :
-00012570: 7079 3a6d 6f64 3a60 6d6c 7275 6e60 2044  py:mod:`mlrun` D
-00012580: 422e 2054 6865 0a20 2020 2020 2020 2066  B. The.        f
-00012590: 6561 7475 7265 2d73 6574 2063 616e 2062  eature-set can b
-000125a0: 6520 6569 7468 6572 2061 206e 6577 206f  e either a new o
-000125b0: 626a 6563 7420 6f72 2061 206d 6f64 6966  bject or a modif
-000125c0: 6963 6174 696f 6e20 746f 2065 7869 7374  ication to exist
-000125d0: 696e 6720 6f62 6a65 6374 2072 6566 6572  ing object refer
-000125e0: 656e 6365 6420 6279 2074 6865 2070 6172  enced by the par
-000125f0: 616d 7320 6f66 0a20 2020 2020 2020 2074  ams of.        t
-00012600: 6865 2066 756e 6374 696f 6e2e 0a0a 2020  he function...  
-00012610: 2020 2020 2020 3a70 6172 616d 2066 6561        :param fea
-00012620: 7475 7265 5f73 6574 3a20 5468 6520 3a70  ture_set: The :p
-00012630: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-00012640: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-00012650: 6174 7572 6553 6574 6020 746f 2073 746f  atureSet` to sto
-00012660: 7265 2e0a 2020 2020 2020 2020 3a70 6172  re..        :par
-00012670: 616d 206e 616d 653a 2020 2020 4e61 6d65  am name:    Name
-00012680: 206f 6620 6665 6174 7572 6520 7365 742e   of feature set.
-00012690: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000126a0: 7072 6f6a 6563 743a 204e 616d 6520 6f66  project: Name of
-000126b0: 2070 726f 6a65 6374 2074 6869 7320 6665   project this fe
-000126c0: 6174 7572 652d 7365 7420 6265 6c6f 6e67  ature-set belong
-000126d0: 7320 746f 2e0a 2020 2020 2020 2020 3a70  s to..        :p
-000126e0: 6172 616d 2074 6167 3a20 5468 6520 6060  aram tag: The ``
-000126f0: 7461 6760 6020 6f66 2074 6865 206f 626a  tag`` of the obj
-00012700: 6563 7420 746f 2072 6570 6c61 6365 2069  ect to replace i
-00012710: 6e20 7468 6520 4442 2c20 666f 7220 6578  n the DB, for ex
-00012720: 616d 706c 6520 6060 6c61 7465 7374 6060  ample ``latest``
-00012730: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00012740: 2075 6964 3a20 5468 6520 6060 7569 6460   uid: The ``uid`
-00012750: 6020 6f66 2074 6865 206f 626a 6563 7420  ` of the object 
-00012760: 746f 2072 6570 6c61 6365 2069 6e20 7468  to replace in th
-00012770: 6520 4442 2e20 4966 2075 7369 6e67 2074  e DB. If using t
-00012780: 6869 7320 7061 7261 6d65 7465 722c 2074  his parameter, t
-00012790: 6865 206d 6f64 6966 6965 6420 6f62 6a65  he modified obje
-000127a0: 6374 0a20 2020 2020 2020 2020 2020 206d  ct.            m
-000127b0: 7573 7420 6861 7665 2074 6865 2073 616d  ust have the sam
-000127c0: 6520 6060 7569 6460 6020 6f66 2074 6865  e ``uid`` of the
-000127d0: 2070 7265 7669 6f75 736c 792d 6578 6973   previously-exis
-000127e0: 7469 6e67 206f 626a 6563 742e 2054 6869  ting object. Thi
-000127f0: 7320 6361 6e6e 6f74 2062 6520 7573 6564  s cannot be used
-00012800: 2066 6f72 206e 6f6e 2d76 6572 7369 6f6e   for non-version
-00012810: 6564 206f 626a 6563 7473 2e0a 2020 2020  ed objects..    
-00012820: 2020 2020 3a70 6172 616d 2076 6572 7369      :param versi
-00012830: 6f6e 6564 3a20 5768 6574 6865 7220 746f  oned: Whether to
-00012840: 206d 6169 6e74 6169 6e20 7665 7273 696f   maintain versio
-00012850: 6e73 2066 6f72 2074 6869 7320 6665 6174  ns for this feat
-00012860: 7572 652d 7365 742e 2041 6c6c 2076 6572  ure-set. All ver
-00012870: 7369 6f6e 7320 6f66 2061 2076 6572 7369  sions of a versi
-00012880: 6f6e 6564 206f 626a 6563 740a 2020 2020  oned object.    
-00012890: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
-000128a0: 6b65 7074 2069 6e20 7468 6520 4442 2061  kept in the DB a
-000128b0: 6e64 2063 616e 2062 6520 7265 7472 6965  nd can be retrie
-000128c0: 7665 6420 756e 7469 6c20 6578 706c 6963  ved until explic
-000128d0: 6974 6c79 2064 656c 6574 6564 2e0a 2020  itly deleted..  
-000128e0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-000128f0: 5468 6520 3a70 793a 636c 6173 733a 607e  The :py:class:`~
-00012900: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
-00012910: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
-00012920: 6f62 6a65 6374 2028 6173 2064 6963 7429  object (as dict)
-00012930: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
-00012940: 2020 2020 2020 2072 6566 6572 656e 6365         reference
-00012950: 203d 2073 656c 662e 5f72 6573 6f6c 7665   = self._resolve
-00012960: 5f72 6566 6572 656e 6365 2874 6167 2c20  _reference(tag, 
-00012970: 7569 6429 0a20 2020 2020 2020 2070 6172  uid).        par
-00012980: 616d 7320 3d20 7b22 7665 7273 696f 6e65  ams = {"versione
-00012990: 6422 3a20 7665 7273 696f 6e65 647d 0a0a  d": versioned}..
-000129a0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-000129b0: 7461 6e63 6528 6665 6174 7572 655f 7365  tance(feature_se
-000129c0: 742c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  t, mlrun.common.
-000129d0: 7363 6865 6d61 732e 4665 6174 7572 6553  schemas.FeatureS
-000129e0: 6574 293a 0a20 2020 2020 2020 2020 2020  et):.           
-000129f0: 2066 6561 7475 7265 5f73 6574 203d 2066   feature_set = f
-00012a00: 6561 7475 7265 5f73 6574 2e64 6963 7428  eature_set.dict(
-00012a10: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00012a20: 7369 6e73 7461 6e63 6528 6665 6174 7572  sinstance(featur
-00012a30: 655f 7365 742c 2046 6561 7475 7265 5365  e_set, FeatureSe
-00012a40: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00012a50: 6665 6174 7572 655f 7365 7420 3d20 6665  feature_set = fe
-00012a60: 6174 7572 655f 7365 742e 746f 5f64 6963  ature_set.to_dic
-00012a70: 7428 290a 0a20 2020 2020 2020 206e 616d  t()..        nam
-00012a80: 6520 3d20 6e61 6d65 206f 7220 6665 6174  e = name or feat
-00012a90: 7572 655f 7365 745b 226d 6574 6164 6174  ure_set["metadat
-00012aa0: 6122 5d5b 226e 616d 6522 5d0a 2020 2020  a"]["name"].    
-00012ab0: 2020 2020 7072 6f6a 6563 7420 3d20 280a      project = (.
-00012ac0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
-00012ad0: 6563 7420 6f72 2066 6561 7475 7265 5f73  ect or feature_s
-00012ae0: 6574 5b22 6d65 7461 6461 7461 225d 2e67  et["metadata"].g
-00012af0: 6574 2822 7072 6f6a 6563 7422 2920 6f72  et("project") or
-00012b00: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
-00012b10: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-00012b20: 290a 2020 2020 2020 2020 7061 7468 203d  ).        path =
-00012b30: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-00012b40: 6a65 6374 7d2f 6665 6174 7572 652d 7365  ject}/feature-se
-00012b50: 7473 2f7b 6e61 6d65 7d2f 7265 6665 7265  ts/{name}/refere
-00012b60: 6e63 6573 2f7b 7265 6665 7265 6e63 657d  nces/{reference}
-00012b70: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
-00012b80: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00012b90: 6564 2073 746f 7269 6e67 2066 6561 7475  ed storing featu
-00012ba0: 7265 2d73 6574 207b 7072 6f6a 6563 747d  re-set {project}
-00012bb0: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-00012bc0: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
-00012bd0: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00012be0: 2020 2022 5055 5422 2c20 7061 7468 2c20     "PUT", path, 
-00012bf0: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
-00012c00: 6172 616d 733d 7061 7261 6d73 2c20 626f  arams=params, bo
-00012c10: 6479 3d64 6963 745f 746f 5f6a 736f 6e28  dy=dict_to_json(
-00012c20: 6665 6174 7572 655f 7365 7429 0a20 2020  feature_set).   
-00012c30: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
-00012c40: 6574 7572 6e20 7265 7370 2e6a 736f 6e28  eturn resp.json(
-00012c50: 290a 0a20 2020 2064 6566 2070 6174 6368  )..    def patch
-00012c60: 5f66 6561 7475 7265 5f73 6574 280a 2020  _feature_set(.  
-00012c70: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
-00012c80: 2020 2020 6e61 6d65 2c0a 2020 2020 2020      name,.      
-00012c90: 2020 6665 6174 7572 655f 7365 745f 7570    feature_set_up
-00012ca0: 6461 7465 3a20 6469 6374 2c0a 2020 2020  date: dict,.    
-00012cb0: 2020 2020 7072 6f6a 6563 743d 2222 2c0a      project="",.
-00012cc0: 2020 2020 2020 2020 7461 673d 4e6f 6e65          tag=None
-00012cd0: 2c0a 2020 2020 2020 2020 7569 643d 4e6f  ,.        uid=No
-00012ce0: 6e65 2c0a 2020 2020 2020 2020 7061 7463  ne,.        patc
-00012cf0: 685f 6d6f 6465 3a20 556e 696f 6e5b 0a20  h_mode: Union[. 
-00012d00: 2020 2020 2020 2020 2020 2073 7472 2c20             str, 
-00012d10: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00012d20: 656d 6173 2e50 6174 6368 4d6f 6465 0a20  emas.PatchMode. 
-00012d30: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
-00012d40: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00012d50: 5061 7463 684d 6f64 652e 7265 706c 6163  PatchMode.replac
-00012d60: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-00012d70: 2020 2222 224d 6f64 6966 7920 2870 6174    """Modify (pat
-00012d80: 6368 2920 616e 2065 7869 7374 696e 6720  ch) an existing 
-00012d90: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-00012da0: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
-00012db0: 4665 6174 7572 6553 6574 6020 6f62 6a65  FeatureSet` obje
-00012dc0: 6374 2e0a 2020 2020 2020 2020 5468 6520  ct..        The 
-00012dd0: 6f62 6a65 6374 2069 7320 6964 656e 7469  object is identi
-00012de0: 6669 6564 2062 7920 6974 7320 6e61 6d65  fied by its name
-00012df0: 2028 616e 6420 7072 6f6a 6563 7420 6974   (and project it
-00012e00: 2062 656c 6f6e 6773 2074 6f29 2c20 6173   belongs to), as
-00012e10: 2077 656c 6c20 6173 206f 7074 696f 6e61   well as optiona
-00012e20: 6c6c 7920 6120 6060 7461 6760 6020 6f72  lly a ``tag`` or
-00012e30: 2069 7473 0a20 2020 2020 2020 2060 6075   its.        ``u
-00012e40: 6964 6060 2028 666f 7220 7665 7273 696f  id`` (for versio
-00012e50: 6e65 6420 6f62 6a65 6374 292e 2049 6620  ned object). If 
-00012e60: 626f 7468 2060 6074 6167 6060 2061 6e64  both ``tag`` and
-00012e70: 2060 6075 6964 6060 2061 7265 206f 6d69   ``uid`` are omi
-00012e80: 7474 6564 2074 6865 6e20 7468 6520 6f62  tted then the ob
-00012e90: 6a65 6374 2077 6974 6820 7461 6720 6060  ject with tag ``
-00012ea0: 6c61 7465 7374 6060 0a20 2020 2020 2020  latest``.       
-00012eb0: 2069 7320 6d6f 6469 6669 6564 2e0a 0a20   is modified... 
-00012ec0: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
-00012ed0: 6d65 3a20 4e61 6d65 206f 6620 7468 6520  me: Name of the 
-00012ee0: 6f62 6a65 6374 2074 6f20 7061 7463 682e  object to patch.
-00012ef0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00012f00: 6665 6174 7572 655f 7365 745f 7570 6461  feature_set_upda
-00012f10: 7465 3a20 5468 6520 6d6f 6469 6669 6361  te: The modifica
-00012f20: 7469 6f6e 7320 6e65 6564 6564 2069 6e20  tions needed in 
-00012f30: 7468 6520 6f62 6a65 6374 2e20 5468 6973  the object. This
-00012f40: 2070 6172 616d 6574 6572 206f 6e6c 7920   parameter only 
-00012f50: 6861 7320 7468 6520 6368 616e 6765 7320  has the changes 
-00012f60: 696e 2069 742c 0a20 2020 2020 2020 2020  in it,.         
-00012f70: 2020 206e 6f74 2061 2066 756c 6c20 6f62     not a full ob
-00012f80: 6a65 6374 2e0a 2020 2020 2020 2020 2020  ject..          
-00012f90: 2020 4578 616d 706c 653a 3a0a 0a20 2020    Example::..   
-00012fa0: 2020 2020 2020 2020 2020 2020 2066 6561               fea
-00012fb0: 7475 7265 5f73 6574 5f75 7064 6174 6520  ture_set_update 
-00012fc0: 3d20 7b22 7374 6174 7573 223a 207b 2270  = {"status": {"p
-00012fd0: 726f 6365 7373 6564 2220 3a20 5472 7565  rocessed" : True
-00012fe0: 7d7d 0a0a 2020 2020 2020 2020 2020 2020  }}..            
-00012ff0: 5769 6c6c 2061 7070 6c79 2074 6865 2066  Will apply the f
-00013000: 6965 6c64 2060 6073 7461 7475 732e 7072  ield ``status.pr
-00013010: 6f63 6573 7365 6460 6020 746f 2074 6865  ocessed`` to the
-00013020: 2065 7869 7374 696e 6720 6f62 6a65 6374   existing object
-00013030: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00013040: 2070 726f 6a65 6374 3a20 5072 6f6a 6563   project: Projec
-00013050: 7420 7768 6963 6820 636f 6e74 6169 6e73  t which contains
-00013060: 2074 6865 206d 6f64 6966 6965 6420 6f62   the modified ob
-00013070: 6a65 6374 2e0a 2020 2020 2020 2020 3a70  ject..        :p
-00013080: 6172 616d 2074 6167 3a20 5468 6520 7461  aram tag: The ta
-00013090: 6720 6f66 2074 6865 206f 626a 6563 7420  g of the object 
-000130a0: 746f 206d 6f64 6966 792e 0a20 2020 2020  to modify..     
-000130b0: 2020 203a 7061 7261 6d20 7569 643a 2075     :param uid: u
-000130c0: 6964 206f 6620 7468 6520 6f62 6a65 6374  id of the object
-000130d0: 2074 6f20 6d6f 6469 6679 2e0a 2020 2020   to modify..    
-000130e0: 2020 2020 3a70 6172 616d 2070 6174 6368      :param patch
-000130f0: 5f6d 6f64 653a 2054 6865 2073 7472 6174  _mode: The strat
-00013100: 6567 7920 666f 7220 6d65 7267 696e 6720  egy for merging 
-00013110: 7468 6520 6368 616e 6765 7320 7769 7468  the changes with
-00013120: 2074 6865 2065 7869 7374 696e 6720 6f62   the existing ob
-00013130: 6a65 6374 2e20 4361 6e20 6265 2065 6974  ject. Can be eit
-00013140: 6865 7220 6060 7265 706c 6163 6560 600a  her ``replace``.
-00013150: 2020 2020 2020 2020 2020 2020 6f72 2060              or `
-00013160: 6061 6464 6974 6976 6560 602e 0a20 2020  `additive``..   
-00013170: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-00013180: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
-00013190: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
-000131a0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
-000131b0: 2020 2020 2072 6566 6572 656e 6365 203d       reference =
-000131c0: 2073 656c 662e 5f72 6573 6f6c 7665 5f72   self._resolve_r
-000131d0: 6566 6572 656e 6365 2874 6167 2c20 7569  eference(tag, ui
-000131e0: 6429 0a20 2020 2020 2020 2068 6561 6465  d).        heade
-000131f0: 7273 203d 207b 6d6c 7275 6e2e 636f 6d6d  rs = {mlrun.comm
-00013200: 6f6e 2e73 6368 656d 6173 2e48 6561 6465  on.schemas.Heade
-00013210: 724e 616d 6573 2e70 6174 6368 5f6d 6f64  rNames.patch_mod
-00013220: 653a 2070 6174 6368 5f6d 6f64 657d 0a20  e: patch_mode}. 
-00013230: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00013240: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00013250: 747d 2f66 6561 7475 7265 2d73 6574 732f  t}/feature-sets/
-00013260: 7b6e 616d 657d 2f72 6566 6572 656e 6365  {name}/reference
-00013270: 732f 7b72 6566 6572 656e 6365 7d22 0a20  s/{reference}". 
-00013280: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00013290: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-000132a0: 7570 6461 7469 6e67 2066 6561 7475 7265  updating feature
-000132b0: 2d73 6574 207b 7072 6f6a 6563 747d 2f7b  -set {project}/{
-000132c0: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
-000132d0: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-000132e0: 2020 2020 2020 2020 2020 2250 4154 4348            "PATCH
-000132f0: 222c 0a20 2020 2020 2020 2020 2020 2070  ",.            p
-00013300: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
-00013310: 2065 7272 6f72 5f6d 6573 7361 6765 2c0a   error_message,.
-00013320: 2020 2020 2020 2020 2020 2020 626f 6479              body
-00013330: 3d64 6963 745f 746f 5f6a 736f 6e28 6665  =dict_to_json(fe
-00013340: 6174 7572 655f 7365 745f 7570 6461 7465  ature_set_update
-00013350: 292c 0a20 2020 2020 2020 2020 2020 2068  ),.            h
-00013360: 6561 6465 7273 3d68 6561 6465 7273 2c0a  eaders=headers,.
-00013370: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00013380: 6566 2064 656c 6574 655f 6665 6174 7572  ef delete_featur
-00013390: 655f 7365 7428 7365 6c66 2c20 6e61 6d65  e_set(self, name
-000133a0: 2c20 7072 6f6a 6563 743d 2222 2c20 7461  , project="", ta
-000133b0: 673d 4e6f 6e65 2c20 7569 643d 4e6f 6e65  g=None, uid=None
-000133c0: 293a 0a20 2020 2020 2020 2022 2222 4465  ):.        """De
-000133d0: 6c65 7465 2061 203a 7079 3a63 6c61 7373  lete a :py:class
-000133e0: 3a60 7e6d 6c72 756e 2e66 6561 7475 7265  :`~mlrun.feature
-000133f0: 5f73 746f 7265 2e46 6561 7475 7265 5365  _store.FeatureSe
-00013400: 7460 206f 626a 6563 7420 6672 6f6d 2074  t` object from t
-00013410: 6865 2044 422e 0a20 2020 2020 2020 2049  he DB..        I
-00013420: 6620 6060 7461 6760 6020 6f72 2060 6075  f ``tag`` or ``u
-00013430: 6964 6060 2061 7265 2073 7065 6369 6669  id`` are specifi
-00013440: 6564 2c20 7468 656e 206a 7573 7420 7468  ed, then just th
-00013450: 6520 7665 7273 696f 6e20 7265 6665 7265  e version refere
-00013460: 6e63 6564 2062 7920 7468 656d 2077 696c  nced by them wil
-00013470: 6c20 6265 2064 656c 6574 6564 2e20 5573  l be deleted. Us
-00013480: 696e 6720 626f 7468 0a20 2020 2020 2020  ing both.       
-00013490: 2069 7320 6e6f 7420 616c 6c6f 7765 642e   is not allowed.
-000134a0: 0a20 2020 2020 2020 2049 6620 6e6f 6e65  .        If none
-000134b0: 2061 7265 2073 7065 6369 6669 6564 2c20   are specified, 
-000134c0: 7468 656e 2061 6c6c 2069 6e73 7461 6e63  then all instanc
-000134d0: 6573 206f 6620 7468 6520 6f62 6a65 6374  es of the object
-000134e0: 2077 686f 7365 206e 616d 6520 6973 2060   whose name is `
-000134f0: 606e 616d 6560 6020 7769 6c6c 2062 6520  `name`` will be 
-00013500: 6465 6c65 7465 642e 0a20 2020 2020 2020  deleted..       
-00013510: 2022 2222 0a20 2020 2020 2020 2070 726f   """.        pro
-00013520: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
-00013530: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
-00013540: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
-00013550: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
-00013560: 7473 2f7b 7072 6f6a 6563 747d 2f66 6561  ts/{project}/fea
-00013570: 7475 7265 2d73 6574 732f 7b6e 616d 657d  ture-sets/{name}
-00013580: 220a 0a20 2020 2020 2020 2069 6620 7461  "..        if ta
-00013590: 6720 6f72 2075 6964 3a0a 2020 2020 2020  g or uid:.      
-000135a0: 2020 2020 2020 7265 6665 7265 6e63 6520        reference 
-000135b0: 3d20 7365 6c66 2e5f 7265 736f 6c76 655f  = self._resolve_
-000135c0: 7265 6665 7265 6e63 6528 7461 672c 2075  reference(tag, u
-000135d0: 6964 290a 2020 2020 2020 2020 2020 2020  id).            
-000135e0: 7061 7468 203d 2070 6174 6820 2b20 6622  path = path + f"
-000135f0: 2f72 6566 6572 656e 6365 732f 7b72 6566  /references/{ref
-00013600: 6572 656e 6365 7d22 0a0a 2020 2020 2020  erence}"..      
-00013610: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-00013620: 3d20 6622 4661 696c 6564 2064 656c 6574  = f"Failed delet
-00013630: 696e 6720 6665 6174 7572 652d 7365 7420  ing feature-set 
-00013640: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-00013650: 7365 6c66 2e61 7069 5f63 616c 6c28 2244  self.api_call("D
-00013660: 454c 4554 4522 2c20 7061 7468 2c20 6572  ELETE", path, er
-00013670: 726f 725f 6d65 7373 6167 6529 0a0a 2020  ror_message)..  
-00013680: 2020 6465 6620 6372 6561 7465 5f66 6561    def create_fea
-00013690: 7475 7265 5f76 6563 746f 7228 0a20 2020  ture_vector(.   
-000136a0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-000136b0: 2020 2066 6561 7475 7265 5f76 6563 746f     feature_vecto
-000136c0: 723a 2055 6e69 6f6e 5b64 6963 742c 206d  r: Union[dict, m
-000136d0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-000136e0: 6d61 732e 4665 6174 7572 6556 6563 746f  mas.FeatureVecto
-000136f0: 722c 2046 6561 7475 7265 5665 6374 6f72  r, FeatureVector
-00013700: 5d2c 0a20 2020 2020 2020 2070 726f 6a65  ],.        proje
-00013710: 6374 3d22 222c 0a20 2020 2020 2020 2076  ct="",.        v
-00013720: 6572 7369 6f6e 6564 3d54 7275 652c 0a20  ersioned=True,. 
-00013730: 2020 2029 202d 3e20 6469 6374 3a0a 2020     ) -> dict:.  
-00013740: 2020 2020 2020 2222 2243 7265 6174 6520        """Create 
-00013750: 6120 6e65 7720 3a70 793a 636c 6173 733a  a new :py:class:
-00013760: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
-00013770: 7374 6f72 652e 4665 6174 7572 6556 6563  store.FeatureVec
-00013780: 746f 7260 2061 6e64 2073 6176 6520 696e  tor` and save in
-00013790: 2074 6865 203a 7079 3a6d 6f64 3a60 6d6c   the :py:mod:`ml
-000137a0: 7275 6e60 2044 422e 0a0a 2020 2020 2020  run` DB...      
-000137b0: 2020 3a70 6172 616d 2066 6561 7475 7265    :param feature
-000137c0: 5f76 6563 746f 723a 2054 6865 206e 6577  _vector: The new
-000137d0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
-000137e0: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
-000137f0: 2e46 6561 7475 7265 5665 6374 6f72 6020  .FeatureVector` 
-00013800: 746f 2063 7265 6174 652e 0a20 2020 2020  to create..     
-00013810: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-00013820: 743a 204e 616d 6520 6f66 2070 726f 6a65  t: Name of proje
-00013830: 6374 2074 6869 7320 6665 6174 7572 652d  ct this feature-
-00013840: 7665 6374 6f72 2062 656c 6f6e 6773 2074  vector belongs t
-00013850: 6f2e 0a20 2020 2020 2020 203a 7061 7261  o..        :para
-00013860: 6d20 7665 7273 696f 6e65 643a 2057 6865  m versioned: Whe
-00013870: 7468 6572 2074 6f20 6d61 696e 7461 696e  ther to maintain
-00013880: 2076 6572 7369 6f6e 7320 666f 7220 7468   versions for th
-00013890: 6973 2066 6561 7475 7265 2d76 6563 746f  is feature-vecto
-000138a0: 722e 2041 6c6c 2076 6572 7369 6f6e 7320  r. All versions 
-000138b0: 6f66 2061 2076 6572 7369 6f6e 6564 206f  of a versioned o
-000138c0: 626a 6563 740a 2020 2020 2020 2020 2020  bject.          
-000138d0: 2020 7769 6c6c 2062 6520 6b65 7074 2069    will be kept i
-000138e0: 6e20 7468 6520 4442 2061 6e64 2063 616e  n the DB and can
-000138f0: 2062 6520 7265 7472 6965 7665 6420 756e   be retrieved un
-00013900: 7469 6c20 6578 706c 6963 6974 6c79 2064  til explicitly d
-00013910: 656c 6574 6564 2e0a 2020 2020 2020 2020  eleted..        
-00013920: 3a72 6574 7572 6e73 3a20 5468 6520 3a70  :returns: The :p
-00013930: 793a 636c 6173 733a 607e 6d6c 7275 6e2e  y:class:`~mlrun.
-00013940: 6665 6174 7572 655f 7374 6f72 652e 4665  feature_store.Fe
-00013950: 6174 7572 6556 6563 746f 7260 206f 626a  atureVector` obj
-00013960: 6563 7420 2861 7320 6469 6374 292e 0a20  ect (as dict).. 
-00013970: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-00013980: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
-00013990: 2866 6561 7475 7265 5f76 6563 746f 722c  (feature_vector,
-000139a0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-000139b0: 6865 6d61 732e 4665 6174 7572 6556 6563  hemas.FeatureVec
-000139c0: 746f 7229 3a0a 2020 2020 2020 2020 2020  tor):.          
-000139d0: 2020 6665 6174 7572 655f 7665 6374 6f72    feature_vector
-000139e0: 203d 2066 6561 7475 7265 5f76 6563 746f   = feature_vecto
-000139f0: 722e 6469 6374 2829 0a20 2020 2020 2020  r.dict().       
-00013a00: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00013a10: 2866 6561 7475 7265 5f76 6563 746f 722c  (feature_vector,
-00013a20: 2046 6561 7475 7265 5665 6374 6f72 293a   FeatureVector):
-00013a30: 0a20 2020 2020 2020 2020 2020 2066 6561  .            fea
-00013a40: 7475 7265 5f76 6563 746f 7220 3d20 6665  ture_vector = fe
-00013a50: 6174 7572 655f 7665 6374 6f72 2e74 6f5f  ature_vector.to_
-00013a60: 6469 6374 2829 0a0a 2020 2020 2020 2020  dict()..        
-00013a70: 7072 6f6a 6563 7420 3d20 280a 2020 2020  project = (.    
-00013a80: 2020 2020 2020 2020 7072 6f6a 6563 740a          project.
-00013a90: 2020 2020 2020 2020 2020 2020 6f72 2066              or f
-00013aa0: 6561 7475 7265 5f76 6563 746f 725b 226d  eature_vector["m
-00013ab0: 6574 6164 6174 6122 5d2e 6765 7428 2270  etadata"].get("p
-00013ac0: 726f 6a65 6374 222c 204e 6f6e 6529 0a20  roject", None). 
-00013ad0: 2020 2020 2020 2020 2020 206f 7220 636f             or co
-00013ae0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
-00013af0: 6a65 6374 0a20 2020 2020 2020 2029 0a20  ject.        ). 
-00013b00: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00013b10: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00013b20: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
-00013b30: 7273 220a 2020 2020 2020 2020 7061 7261  rs".        para
-00013b40: 6d73 203d 207b 2276 6572 7369 6f6e 6564  ms = {"versioned
-00013b50: 223a 2076 6572 7369 6f6e 6564 7d0a 0a20  ": versioned}.. 
-00013b60: 2020 2020 2020 206e 616d 6520 3d20 6665         name = fe
-00013b70: 6174 7572 655f 7665 6374 6f72 5b22 6d65  ature_vector["me
-00013b80: 7461 6461 7461 225d 5b22 6e61 6d65 225d  tadata"]["name"]
-00013b90: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-00013ba0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
-00013bb0: 6420 6372 6561 7469 6e67 2066 6561 7475  d creating featu
-00013bc0: 7265 2d76 6563 746f 7220 7b70 726f 6a65  re-vector {proje
-00013bd0: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
-00013be0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
-00013bf0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-00013c00: 2020 2020 2020 2250 4f53 5422 2c0a 2020        "POST",.  
-00013c10: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
-00013c20: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00013c30: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
-00013c40: 2020 2020 2020 2070 6172 616d 733d 7061         params=pa
-00013c50: 7261 6d73 2c0a 2020 2020 2020 2020 2020  rams,.          
-00013c60: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
-00013c70: 736f 6e28 6665 6174 7572 655f 7665 6374  son(feature_vect
-00013c80: 6f72 292c 0a20 2020 2020 2020 2029 0a20  or),.        ). 
-00013c90: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
-00013ca0: 7370 2e6a 736f 6e28 290a 0a20 2020 2064  sp.json()..    d
-00013cb0: 6566 2067 6574 5f66 6561 7475 7265 5f76  ef get_feature_v
-00013cc0: 6563 746f 7228 0a20 2020 2020 2020 2073  ector(.        s
-00013cd0: 656c 662c 206e 616d 653a 2073 7472 2c20  elf, name: str, 
-00013ce0: 7072 6f6a 6563 743a 2073 7472 203d 2022  project: str = "
-00013cf0: 222c 2074 6167 3a20 7374 7220 3d20 4e6f  ", tag: str = No
-00013d00: 6e65 2c20 7569 643a 2073 7472 203d 204e  ne, uid: str = N
-00013d10: 6f6e 650a 2020 2020 2920 2d3e 2046 6561  one.    ) -> Fea
-00013d20: 7475 7265 5665 6374 6f72 3a0a 2020 2020  tureVector:.    
-00013d30: 2020 2020 2222 2252 6574 7572 6e20 6120      """Return a 
-00013d40: 7370 6563 6966 6963 2066 6561 7475 7265  specific feature
-00013d50: 2d76 6563 746f 7220 7265 6665 7265 6e63  -vector referenc
-00013d60: 6564 2062 7920 6974 7320 7461 6720 6f72  ed by its tag or
-00013d70: 2075 6964 2e20 4966 206e 6f6e 6520 6172   uid. If none ar
-00013d80: 6520 7072 6f76 6964 6564 2c20 6060 6c61  e provided, ``la
-00013d90: 7465 7374 6060 2074 6167 2077 696c 6c0a  test`` tag will.
-00013da0: 2020 2020 2020 2020 6265 2075 7365 642e          be used.
-00013db0: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
-00013dc0: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
-00013dd0: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
-00013de0: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
-00013df0: 2072 6566 6572 656e 6365 203d 2073 656c   reference = sel
-00013e00: 662e 5f72 6573 6f6c 7665 5f72 6566 6572  f._resolve_refer
-00013e10: 656e 6365 2874 6167 2c20 7569 6429 0a20  ence(tag, uid). 
-00013e20: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00013e30: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00013e40: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
-00013e50: 7273 2f7b 6e61 6d65 7d2f 7265 6665 7265  rs/{name}/refere
-00013e60: 6e63 6573 2f7b 7265 6665 7265 6e63 657d  nces/{reference}
-00013e70: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
-00013e80: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
-00013e90: 6564 2072 6574 7269 6576 696e 6720 6665  ed retrieving fe
-00013ea0: 6174 7572 652d 7665 6374 6f72 207b 7072  ature-vector {pr
-00013eb0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
-00013ec0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
-00013ed0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
-00013ee0: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
-00013ef0: 6573 7361 6765 290a 2020 2020 2020 2020  essage).        
-00013f00: 7265 7475 726e 2046 6561 7475 7265 5665  return FeatureVe
-00013f10: 6374 6f72 2e66 726f 6d5f 6469 6374 2872  ctor.from_dict(r
-00013f20: 6573 702e 6a73 6f6e 2829 290a 0a20 2020  esp.json())..   
-00013f30: 2064 6566 206c 6973 745f 6665 6174 7572   def list_featur
-00013f40: 655f 7665 6374 6f72 7328 0a20 2020 2020  e_vectors(.     
-00013f50: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00013f60: 2070 726f 6a65 6374 3a20 7374 7220 3d20   project: str = 
-00013f70: 2222 2c0a 2020 2020 2020 2020 6e61 6d65  "",.        name
-00013f80: 3a20 7374 7220 3d20 4e6f 6e65 2c0a 2020  : str = None,.  
-00013f90: 2020 2020 2020 7461 673a 2073 7472 203d        tag: str =
-00013fa0: 204e 6f6e 652c 0a20 2020 2020 2020 2073   None,.        s
-00013fb0: 7461 7465 3a20 7374 7220 3d20 4e6f 6e65  tate: str = None
-00013fc0: 2c0a 2020 2020 2020 2020 6c61 6265 6c73  ,.        labels
-00013fd0: 3a20 4c69 7374 5b73 7472 5d20 3d20 4e6f  : List[str] = No
-00013fe0: 6e65 2c0a 2020 2020 2020 2020 7061 7274  ne,.        part
-00013ff0: 6974 696f 6e5f 6279 3a20 556e 696f 6e5b  ition_by: Union[
-00014000: 0a20 2020 2020 2020 2020 2020 206d 6c72  .            mlr
-00014010: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00014020: 732e 4665 6174 7572 6553 746f 7265 5061  s.FeatureStorePa
-00014030: 7274 6974 696f 6e42 7946 6965 6c64 2c20  rtitionByField, 
-00014040: 7374 720a 2020 2020 2020 2020 5d20 3d20  str.        ] = 
-00014050: 4e6f 6e65 2c0a 2020 2020 2020 2020 726f  None,.        ro
-00014060: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
-00014070: 3a20 696e 7420 3d20 312c 0a20 2020 2020  : int = 1,.     
-00014080: 2020 2070 6172 7469 7469 6f6e 5f73 6f72     partition_sor
-00014090: 745f 6279 3a20 556e 696f 6e5b 6d6c 7275  t_by: Union[mlru
-000140a0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000140b0: 2e53 6f72 7446 6965 6c64 2c20 7374 725d  .SortField, str]
-000140c0: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-000140d0: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
-000140e0: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
-000140f0: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
-00014100: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00014110: 7970 652c 2073 7472 0a20 2020 2020 2020  ype, str.       
-00014120: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
-00014130: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
-00014140: 7970 652e 6465 7363 2c0a 2020 2020 2920  ype.desc,.    ) 
-00014150: 2d3e 204c 6973 745b 4665 6174 7572 6556  -> List[FeatureV
-00014160: 6563 746f 725d 3a0a 2020 2020 2020 2020  ector]:.        
-00014170: 2222 2252 6574 7269 6576 6520 6120 6c69  """Retrieve a li
-00014180: 7374 206f 6620 6665 6174 7572 652d 7665  st of feature-ve
-00014190: 6374 6f72 7320 6d61 7463 6869 6e67 2074  ctors matching t
-000141a0: 6865 2063 7269 7465 7269 6120 7072 6f76  he criteria prov
-000141b0: 6964 6564 2e0a 0a20 2020 2020 2020 203a  ided...        :
-000141c0: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-000141d0: 726f 6a65 6374 206e 616d 652e 0a20 2020  roject name..   
-000141e0: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-000141f0: 3a20 4e61 6d65 206f 6620 6665 6174 7572  : Name of featur
-00014200: 652d 7665 6374 6f72 2074 6f20 6d61 7463  e-vector to matc
-00014210: 682e 2054 6869 7320 6973 2061 206c 696b  h. This is a lik
-00014220: 6520 7175 6572 792c 2061 6e64 2069 7320  e query, and is 
-00014230: 6361 7365 2d69 6e73 656e 7369 7469 7665  case-insensitive
-00014240: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-00014250: 2074 6167 3a20 4d61 7463 6820 6665 6174   tag: Match feat
-00014260: 7572 652d 7665 6374 6f72 7320 7769 7468  ure-vectors with
-00014270: 2073 7065 6369 6669 6320 7461 672e 0a20   specific tag.. 
-00014280: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00014290: 6174 653a 204d 6174 6368 2066 6561 7475  ate: Match featu
-000142a0: 7265 2d76 6563 746f 7273 2077 6974 6820  re-vectors with 
-000142b0: 6120 7370 6563 6966 6963 2073 7461 7465  a specific state
-000142c0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-000142d0: 206c 6162 656c 733a 204d 6174 6368 2066   labels: Match f
-000142e0: 6561 7475 7265 2d76 6563 746f 7273 2077  eature-vectors w
-000142f0: 6869 6368 2068 6176 6520 7468 6573 6520  hich have these 
-00014300: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
-00014310: 3a70 6172 616d 2070 6172 7469 7469 6f6e  :param partition
-00014320: 5f62 793a 2046 6965 6c64 2074 6f20 6772  _by: Field to gr
-00014330: 6f75 7020 7265 7375 6c74 7320 6279 2e20  oup results by. 
-00014340: 4f6e 6c79 2061 6c6c 6f77 6564 2076 616c  Only allowed val
-00014350: 7565 2069 7320 606e 616d 6560 2e20 5768  ue is `name`. Wh
-00014360: 656e 2060 7061 7274 6974 696f 6e5f 6279  en `partition_by
-00014370: 6020 6973 2073 7065 6369 6669 6564 2c0a  ` is specified,.
-00014380: 2020 2020 2020 2020 2020 2020 7468 6520              the 
-00014390: 6070 6172 7469 7469 6f6e 5f73 6f72 745f  `partition_sort_
-000143a0: 6279 6020 7061 7261 6d65 7465 7220 6d75  by` parameter mu
-000143b0: 7374 2062 6520 7072 6f76 6964 6564 2061  st be provided a
-000143c0: 7320 7765 6c6c 2e0a 2020 2020 2020 2020  s well..        
-000143d0: 3a70 6172 616d 2072 6f77 735f 7065 725f  :param rows_per_
-000143e0: 7061 7274 6974 696f 6e3a 2048 6f77 206d  partition: How m
-000143f0: 616e 7920 746f 7020 726f 7773 2028 7065  any top rows (pe
-00014400: 7220 736f 7274 696e 6720 6465 6669 6e65  r sorting define
-00014410: 6420 6279 2060 7061 7274 6974 696f 6e5f  d by `partition_
-00014420: 736f 7274 5f62 7960 2061 6e64 2060 7061  sort_by` and `pa
-00014430: 7274 6974 696f 6e5f 6f72 6465 7260 290a  rtition_order`).
-00014440: 2020 2020 2020 2020 2020 2020 746f 2072              to r
-00014450: 6574 7572 6e20 7065 7220 6772 6f75 702e  eturn per group.
-00014460: 2044 6566 6175 6c74 2076 616c 7565 2069   Default value i
-00014470: 7320 312e 0a20 2020 2020 2020 203a 7061  s 1..        :pa
-00014480: 7261 6d20 7061 7274 6974 696f 6e5f 736f  ram partition_so
-00014490: 7274 5f62 793a 2057 6861 7420 6669 656c  rt_by: What fiel
-000144a0: 6420 746f 2073 6f72 7420 7468 6520 7265  d to sort the re
-000144b0: 7375 6c74 7320 6279 2c20 7769 7468 696e  sults by, within
-000144c0: 2065 6163 6820 7061 7274 6974 696f 6e20   each partition 
-000144d0: 6465 6669 6e65 6420 6279 2060 7061 7274  defined by `part
-000144e0: 6974 696f 6e5f 6279 602e 0a20 2020 2020  ition_by`..     
-000144f0: 2020 2020 2020 2043 7572 7265 6e74 6c79         Currently
-00014500: 2074 6865 206f 6e6c 7920 616c 6c6f 7765   the only allowe
-00014510: 6420 7661 6c75 6573 2061 7265 2060 6372  d values are `cr
-00014520: 6561 7465 6460 2061 6e64 2060 7570 6461  eated` and `upda
-00014530: 7465 6460 2e0a 2020 2020 2020 2020 3a70  ted`..        :p
-00014540: 6172 616d 2070 6172 7469 7469 6f6e 5f6f  aram partition_o
-00014550: 7264 6572 3a20 4f72 6465 7220 6f66 2073  rder: Order of s
-00014560: 6f72 7469 6e67 2077 6974 6869 6e20 7061  orting within pa
-00014570: 7274 6974 696f 6e73 202d 2060 6173 6360  rtitions - `asc`
-00014580: 206f 7220 6064 6573 6360 2e20 4465 6661   or `desc`. Defa
-00014590: 756c 7420 6973 2060 6465 7363 602e 0a20  ult is `desc`.. 
-000145a0: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-000145b0: 204c 6973 7420 6f66 206d 6174 6368 696e   List of matchin
-000145c0: 6720 3a70 793a 636c 6173 733a 607e 6d6c  g :py:class:`~ml
-000145d0: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
-000145e0: 652e 4665 6174 7572 6556 6563 746f 7260  e.FeatureVector`
-000145f0: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
-00014600: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
-00014610: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-00014620: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-00014630: 6c74 5f70 726f 6a65 6374 0a0a 2020 2020  lt_project..    
-00014640: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-00014650: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
-00014660: 223a 206e 616d 652c 0a20 2020 2020 2020  ": name,.       
-00014670: 2020 2020 2022 7374 6174 6522 3a20 7374       "state": st
-00014680: 6174 652c 0a20 2020 2020 2020 2020 2020  ate,.           
-00014690: 2022 7461 6722 3a20 7461 672c 0a20 2020   "tag": tag,.   
-000146a0: 2020 2020 2020 2020 2022 6c61 6265 6c22           "label"
-000146b0: 3a20 6c61 6265 6c73 206f 7220 5b5d 2c0a  : labels or [],.
-000146c0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000146d0: 2020 6966 2070 6172 7469 7469 6f6e 5f62    if partition_b
-000146e0: 793a 0a20 2020 2020 2020 2020 2020 2070  y:.            p
-000146f0: 6172 616d 732e 7570 6461 7465 280a 2020  arams.update(.  
-00014700: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00014710: 6c66 2e5f 6765 6e65 7261 7465 5f70 6172  lf._generate_par
-00014720: 7469 7469 6f6e 5f62 795f 7061 7261 6d73  tition_by_params
-00014730: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-00014740: 2020 2020 2020 6d6c 7275 6e2e 636f 6d6d        mlrun.comm
-00014750: 6f6e 2e73 6368 656d 6173 2e46 6561 7475  on.schemas.Featu
-00014760: 7265 5374 6f72 6550 6172 7469 7469 6f6e  reStorePartition
-00014770: 4279 4669 656c 642c 0a20 2020 2020 2020  ByField,.       
-00014780: 2020 2020 2020 2020 2020 2020 2070 6172               par
-00014790: 7469 7469 6f6e 5f62 792c 0a20 2020 2020  tition_by,.     
-000147a0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-000147b0: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
-000147c0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-000147d0: 2020 2020 2020 2070 6172 7469 7469 6f6e         partition
-000147e0: 5f73 6f72 745f 6279 2c0a 2020 2020 2020  _sort_by,.      
-000147f0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
-00014800: 7274 6974 696f 6e5f 6f72 6465 722c 0a20  rtition_order,. 
-00014810: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00014820: 0a20 2020 2020 2020 2020 2020 2029 0a0a  .            )..
-00014830: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-00014840: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
-00014850: 6374 7d2f 6665 6174 7572 652d 7665 6374  ct}/feature-vect
-00014860: 6f72 7322 0a0a 2020 2020 2020 2020 6572  ors"..        er
-00014870: 726f 725f 6d65 7373 6167 6520 3d20 280a  ror_message = (.
-00014880: 2020 2020 2020 2020 2020 2020 6622 4661              f"Fa
-00014890: 696c 6564 206c 6973 7469 6e67 2066 6561  iled listing fea
-000148a0: 7475 7265 2d76 6563 746f 7273 2c20 7072  ture-vectors, pr
-000148b0: 6f6a 6563 743a 207b 7072 6f6a 6563 747d  oject: {project}
-000148c0: 2c20 7175 6572 793a 207b 7061 7261 6d73  , query: {params
-000148d0: 7d22 0a20 2020 2020 2020 2029 0a20 2020  }".        ).   
-000148e0: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
-000148f0: 2e61 7069 5f63 616c 6c28 2247 4554 222c  .api_call("GET",
-00014900: 2070 6174 682c 2065 7272 6f72 5f6d 6573   path, error_mes
-00014910: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
-00014920: 616d 7329 0a20 2020 2020 2020 2066 6561  ams).        fea
-00014930: 7475 7265 5f76 6563 746f 7273 203d 2072  ture_vectors = r
-00014940: 6573 702e 6a73 6f6e 2829 5b22 6665 6174  esp.json()["feat
-00014950: 7572 655f 7665 6374 6f72 7322 5d0a 2020  ure_vectors"].  
-00014960: 2020 2020 2020 6966 2066 6561 7475 7265        if feature
-00014970: 5f76 6563 746f 7273 3a0a 2020 2020 2020  _vectors:.      
-00014980: 2020 2020 2020 7265 7475 726e 205b 4665        return [Fe
-00014990: 6174 7572 6556 6563 746f 722e 6672 6f6d  atureVector.from
-000149a0: 5f64 6963 7428 6f62 6a29 2066 6f72 206f  _dict(obj) for o
-000149b0: 626a 2069 6e20 6665 6174 7572 655f 7665  bj in feature_ve
-000149c0: 6374 6f72 735d 0a0a 2020 2020 6465 6620  ctors]..    def 
-000149d0: 7374 6f72 655f 6665 6174 7572 655f 7665  store_feature_ve
-000149e0: 6374 6f72 280a 2020 2020 2020 2020 7365  ctor(.        se
-000149f0: 6c66 2c0a 2020 2020 2020 2020 6665 6174  lf,.        feat
-00014a00: 7572 655f 7665 6374 6f72 3a20 556e 696f  ure_vector: Unio
-00014a10: 6e5b 6469 6374 2c20 6d6c 7275 6e2e 636f  n[dict, mlrun.co
-00014a20: 6d6d 6f6e 2e73 6368 656d 6173 2e46 6561  mmon.schemas.Fea
-00014a30: 7475 7265 5665 6374 6f72 2c20 4665 6174  tureVector, Feat
-00014a40: 7572 6556 6563 746f 725d 2c0a 2020 2020  ureVector],.    
-00014a50: 2020 2020 6e61 6d65 3d4e 6f6e 652c 0a20      name=None,. 
-00014a60: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
-00014a70: 222c 0a20 2020 2020 2020 2074 6167 3d4e  ",.        tag=N
-00014a80: 6f6e 652c 0a20 2020 2020 2020 2075 6964  one,.        uid
-00014a90: 3d4e 6f6e 652c 0a20 2020 2020 2020 2076  =None,.        v
-00014aa0: 6572 7369 6f6e 6564 3d54 7275 652c 0a20  ersioned=True,. 
-00014ab0: 2020 2029 202d 3e20 6469 6374 3a0a 2020     ) -> dict:.  
-00014ac0: 2020 2020 2020 2222 2253 746f 7265 2061        """Store a
-00014ad0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
-00014ae0: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
-00014af0: 2e46 6561 7475 7265 5665 6374 6f72 6020  .FeatureVector` 
-00014b00: 6f62 6a65 6374 2069 6e20 7468 6520 3a70  object in the :p
-00014b10: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
-00014b20: 2e20 5468 650a 2020 2020 2020 2020 6665  . The.        fe
-00014b30: 6174 7572 652d 7665 6374 6f72 2063 616e  ature-vector can
-00014b40: 2062 6520 6569 7468 6572 2061 206e 6577   be either a new
-00014b50: 206f 626a 6563 7420 6f72 2061 206d 6f64   object or a mod
-00014b60: 6966 6963 6174 696f 6e20 746f 2065 7869  ification to exi
-00014b70: 7374 696e 6720 6f62 6a65 6374 2072 6566  sting object ref
-00014b80: 6572 656e 6365 6420 6279 2074 6865 2070  erenced by the p
-00014b90: 6172 616d 730a 2020 2020 2020 2020 6f66  arams.        of
-00014ba0: 2074 6865 2066 756e 6374 696f 6e2e 0a0a   the function...
-00014bb0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00014bc0: 6561 7475 7265 5f76 6563 746f 723a 2054  eature_vector: T
-00014bd0: 6865 203a 7079 3a63 6c61 7373 3a60 7e6d  he :py:class:`~m
-00014be0: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
-00014bf0: 7265 2e46 6561 7475 7265 5665 6374 6f72  re.FeatureVector
-00014c00: 6020 746f 2073 746f 7265 2e0a 2020 2020  ` to store..    
-00014c10: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
-00014c20: 2020 2020 4e61 6d65 206f 6620 6665 6174      Name of feat
-00014c30: 7572 6520 7665 6374 6f72 2e0a 2020 2020  ure vector..    
-00014c40: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-00014c50: 6374 3a20 4e61 6d65 206f 6620 7072 6f6a  ct: Name of proj
-00014c60: 6563 7420 7468 6973 2066 6561 7475 7265  ect this feature
-00014c70: 2d76 6563 746f 7220 6265 6c6f 6e67 7320  -vector belongs 
-00014c80: 746f 2e0a 2020 2020 2020 2020 3a70 6172  to..        :par
-00014c90: 616d 2074 6167 3a20 5468 6520 6060 7461  am tag: The ``ta
-00014ca0: 6760 6020 6f66 2074 6865 206f 626a 6563  g`` of the objec
-00014cb0: 7420 746f 2072 6570 6c61 6365 2069 6e20  t to replace in 
-00014cc0: 7468 6520 4442 2c20 666f 7220 6578 616d  the DB, for exam
-00014cd0: 706c 6520 6060 6c61 7465 7374 6060 2e0a  ple ``latest``..
-00014ce0: 2020 2020 2020 2020 3a70 6172 616d 2075          :param u
-00014cf0: 6964 3a20 5468 6520 6060 7569 6460 6020  id: The ``uid`` 
-00014d00: 6f66 2074 6865 206f 626a 6563 7420 746f  of the object to
-00014d10: 2072 6570 6c61 6365 2069 6e20 7468 6520   replace in the 
-00014d20: 4442 2e20 4966 2075 7369 6e67 2074 6869  DB. If using thi
-00014d30: 7320 7061 7261 6d65 7465 722c 2074 6865  s parameter, the
-00014d40: 206d 6f64 6966 6965 6420 6f62 6a65 6374   modified object
-00014d50: 0a20 2020 2020 2020 2020 2020 206d 7573  .            mus
-00014d60: 7420 6861 7665 2074 6865 2073 616d 6520  t have the same 
-00014d70: 6060 7569 6460 6020 6f66 2074 6865 2070  ``uid`` of the p
-00014d80: 7265 7669 6f75 736c 792d 6578 6973 7469  reviously-existi
-00014d90: 6e67 206f 626a 6563 742e 2054 6869 7320  ng object. This 
-00014da0: 6361 6e6e 6f74 2062 6520 7573 6564 2066  cannot be used f
-00014db0: 6f72 206e 6f6e 2d76 6572 7369 6f6e 6564  or non-versioned
-00014dc0: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
-00014dd0: 2020 3a70 6172 616d 2076 6572 7369 6f6e    :param version
-00014de0: 6564 3a20 5768 6574 6865 7220 746f 206d  ed: Whether to m
-00014df0: 6169 6e74 6169 6e20 7665 7273 696f 6e73  aintain versions
-00014e00: 2066 6f72 2074 6869 7320 6665 6174 7572   for this featur
-00014e10: 652d 7665 6374 6f72 2e20 416c 6c20 7665  e-vector. All ve
-00014e20: 7273 696f 6e73 206f 6620 6120 7665 7273  rsions of a vers
-00014e30: 696f 6e65 6420 6f62 6a65 6374 0a20 2020  ioned object.   
-00014e40: 2020 2020 2020 2020 2077 696c 6c20 6265           will be
-00014e50: 206b 6570 7420 696e 2074 6865 2044 4220   kept in the DB 
-00014e60: 616e 6420 6361 6e20 6265 2072 6574 7269  and can be retri
-00014e70: 6576 6564 2075 6e74 696c 2065 7870 6c69  eved until expli
-00014e80: 6369 746c 7920 6465 6c65 7465 642e 0a20  citly deleted.. 
-00014e90: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
-00014ea0: 2054 6865 203a 7079 3a63 6c61 7373 3a60   The :py:class:`
-00014eb0: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
-00014ec0: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
-00014ed0: 6f72 6020 6f62 6a65 6374 2028 6173 2064  or` object (as d
-00014ee0: 6963 7429 2e0a 2020 2020 2020 2020 2222  ict)..        ""
-00014ef0: 220a 0a20 2020 2020 2020 2072 6566 6572  "..        refer
-00014f00: 656e 6365 203d 2073 656c 662e 5f72 6573  ence = self._res
-00014f10: 6f6c 7665 5f72 6566 6572 656e 6365 2874  olve_reference(t
-00014f20: 6167 2c20 7569 6429 0a20 2020 2020 2020  ag, uid).       
-00014f30: 2070 6172 616d 7320 3d20 7b22 7665 7273   params = {"vers
-00014f40: 696f 6e65 6422 3a20 7665 7273 696f 6e65  ioned": versione
-00014f50: 647d 0a0a 2020 2020 2020 2020 6966 2069  d}..        if i
-00014f60: 7369 6e73 7461 6e63 6528 6665 6174 7572  sinstance(featur
-00014f70: 655f 7665 6374 6f72 2c20 6d6c 7275 6e2e  e_vector, mlrun.
-00014f80: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e46  common.schemas.F
-00014f90: 6561 7475 7265 5665 6374 6f72 293a 0a20  eatureVector):. 
-00014fa0: 2020 2020 2020 2020 2020 2066 6561 7475             featu
-00014fb0: 7265 5f76 6563 746f 7220 3d20 6665 6174  re_vector = feat
-00014fc0: 7572 655f 7665 6374 6f72 2e64 6963 7428  ure_vector.dict(
-00014fd0: 290a 2020 2020 2020 2020 656c 6966 2069  ).        elif i
-00014fe0: 7369 6e73 7461 6e63 6528 6665 6174 7572  sinstance(featur
-00014ff0: 655f 7665 6374 6f72 2c20 4665 6174 7572  e_vector, Featur
-00015000: 6556 6563 746f 7229 3a0a 2020 2020 2020  eVector):.      
-00015010: 2020 2020 2020 6665 6174 7572 655f 7665        feature_ve
-00015020: 6374 6f72 203d 2066 6561 7475 7265 5f76  ctor = feature_v
-00015030: 6563 746f 722e 746f 5f64 6963 7428 290a  ector.to_dict().
-00015040: 0a20 2020 2020 2020 206e 616d 6520 3d20  .        name = 
-00015050: 6e61 6d65 206f 7220 6665 6174 7572 655f  name or feature_
-00015060: 7665 6374 6f72 5b22 6d65 7461 6461 7461  vector["metadata
-00015070: 225d 5b22 6e61 6d65 225d 0a20 2020 2020  "]["name"].     
-00015080: 2020 2070 726f 6a65 6374 203d 2028 0a20     project = (. 
-00015090: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
-000150a0: 6374 0a20 2020 2020 2020 2020 2020 206f  ct.            o
-000150b0: 7220 6665 6174 7572 655f 7665 6374 6f72  r feature_vector
-000150c0: 5b22 6d65 7461 6461 7461 225d 2e67 6574  ["metadata"].get
-000150d0: 2822 7072 6f6a 6563 7422 290a 2020 2020  ("project").    
-000150e0: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
-000150f0: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
-00015100: 740a 2020 2020 2020 2020 290a 2020 2020  t.        ).    
-00015110: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-00015120: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-00015130: 6665 6174 7572 652d 7665 6374 6f72 732f  feature-vectors/
-00015140: 7b6e 616d 657d 2f72 6566 6572 656e 6365  {name}/reference
-00015150: 732f 7b72 6566 6572 656e 6365 7d22 0a20  s/{reference}". 
-00015160: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00015170: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-00015180: 7374 6f72 696e 6720 6665 6174 7572 652d  storing feature-
-00015190: 7665 6374 6f72 207b 7072 6f6a 6563 747d  vector {project}
-000151a0: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-000151b0: 2072 6573 7020 3d20 7365 6c66 2e61 7069   resp = self.api
-000151c0: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-000151d0: 2020 2022 5055 5422 2c20 7061 7468 2c20     "PUT", path, 
-000151e0: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
-000151f0: 6172 616d 733d 7061 7261 6d73 2c20 626f  arams=params, bo
-00015200: 6479 3d64 6963 745f 746f 5f6a 736f 6e28  dy=dict_to_json(
-00015210: 6665 6174 7572 655f 7665 6374 6f72 290a  feature_vector).
-00015220: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00015230: 2020 7265 7475 726e 2072 6573 702e 6a73    return resp.js
-00015240: 6f6e 2829 0a0a 2020 2020 6465 6620 7061  on()..    def pa
-00015250: 7463 685f 6665 6174 7572 655f 7665 6374  tch_feature_vect
-00015260: 6f72 280a 2020 2020 2020 2020 7365 6c66  or(.        self
-00015270: 2c0a 2020 2020 2020 2020 6e61 6d65 2c0a  ,.        name,.
-00015280: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
-00015290: 7665 6374 6f72 5f75 7064 6174 653a 2064  vector_update: d
-000152a0: 6963 742c 0a20 2020 2020 2020 2070 726f  ict,.        pro
-000152b0: 6a65 6374 3d22 222c 0a20 2020 2020 2020  ject="",.       
-000152c0: 2074 6167 3d4e 6f6e 652c 0a20 2020 2020   tag=None,.     
-000152d0: 2020 2075 6964 3d4e 6f6e 652c 0a20 2020     uid=None,.   
-000152e0: 2020 2020 2070 6174 6368 5f6d 6f64 653a       patch_mode:
-000152f0: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-00015300: 2020 2020 7374 722c 206d 6c72 756e 2e63      str, mlrun.c
-00015310: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5061  ommon.schemas.Pa
-00015320: 7463 684d 6f64 650a 2020 2020 2020 2020  tchMode.        
-00015330: 5d20 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  ] = mlrun.common
-00015340: 2e73 6368 656d 6173 2e50 6174 6368 4d6f  .schemas.PatchMo
-00015350: 6465 2e72 6570 6c61 6365 2c0a 2020 2020  de.replace,.    
-00015360: 293a 0a20 2020 2020 2020 2022 2222 4d6f  ):.        """Mo
-00015370: 6469 6679 2028 7061 7463 6829 2061 6e20  dify (patch) an 
-00015380: 6578 6973 7469 6e67 203a 7079 3a63 6c61  existing :py:cla
-00015390: 7373 3a60 7e6d 6c72 756e 2e66 6561 7475  ss:`~mlrun.featu
-000153a0: 7265 5f73 746f 7265 2e46 6561 7475 7265  re_store.Feature
-000153b0: 5665 6374 6f72 6020 6f62 6a65 6374 2e0a  Vector` object..
-000153c0: 2020 2020 2020 2020 5468 6520 6f62 6a65          The obje
-000153d0: 6374 2069 7320 6964 656e 7469 6669 6564  ct is identified
-000153e0: 2062 7920 6974 7320 6e61 6d65 2028 616e   by its name (an
-000153f0: 6420 7072 6f6a 6563 7420 6974 2062 656c  d project it bel
-00015400: 6f6e 6773 2074 6f29 2c20 6173 2077 656c  ongs to), as wel
-00015410: 6c20 6173 206f 7074 696f 6e61 6c6c 7920  l as optionally 
-00015420: 6120 6060 7461 6760 6020 6f72 2069 7473  a ``tag`` or its
-00015430: 0a20 2020 2020 2020 2060 6075 6964 6060  .        ``uid``
-00015440: 2028 666f 7220 7665 7273 696f 6e65 6420   (for versioned 
-00015450: 6f62 6a65 6374 292e 2049 6620 626f 7468  object). If both
-00015460: 2060 6074 6167 6060 2061 6e64 2060 6075   ``tag`` and ``u
-00015470: 6964 6060 2061 7265 206f 6d69 7474 6564  id`` are omitted
-00015480: 2074 6865 6e20 7468 6520 6f62 6a65 6374   then the object
-00015490: 2077 6974 6820 7461 6720 6060 6c61 7465   with tag ``late
-000154a0: 7374 6060 0a20 2020 2020 2020 2069 7320  st``.        is 
-000154b0: 6d6f 6469 6669 6564 2e0a 0a20 2020 2020  modified...     
-000154c0: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
-000154d0: 4e61 6d65 206f 6620 7468 6520 6f62 6a65  Name of the obje
-000154e0: 6374 2074 6f20 7061 7463 682e 0a20 2020  ct to patch..   
-000154f0: 2020 2020 203a 7061 7261 6d20 6665 6174       :param feat
-00015500: 7572 655f 7665 6374 6f72 5f75 7064 6174  ure_vector_updat
-00015510: 653a 2054 6865 206d 6f64 6966 6963 6174  e: The modificat
-00015520: 696f 6e73 206e 6565 6465 6420 696e 2074  ions needed in t
-00015530: 6865 206f 626a 6563 742e 2054 6869 7320  he object. This 
-00015540: 7061 7261 6d65 7465 7220 6f6e 6c79 2068  parameter only h
-00015550: 6173 2074 6865 2063 6861 6e67 6573 2069  as the changes i
-00015560: 6e20 6974 2c0a 2020 2020 2020 2020 2020  n it,.          
-00015570: 2020 6e6f 7420 6120 6675 6c6c 206f 626a    not a full obj
-00015580: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
-00015590: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
-000155a0: 6a65 6374 2077 6869 6368 2063 6f6e 7461  ject which conta
-000155b0: 696e 7320 7468 6520 6d6f 6469 6669 6564  ins the modified
-000155c0: 206f 626a 6563 742e 0a20 2020 2020 2020   object..       
-000155d0: 203a 7061 7261 6d20 7461 673a 2054 6865   :param tag: The
-000155e0: 2074 6167 206f 6620 7468 6520 6f62 6a65   tag of the obje
-000155f0: 6374 2074 6f20 6d6f 6469 6679 2e0a 2020  ct to modify..  
-00015600: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
-00015610: 3a20 7569 6420 6f66 2074 6865 206f 626a  : uid of the obj
-00015620: 6563 7420 746f 206d 6f64 6966 792e 0a20  ect to modify.. 
-00015630: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
-00015640: 7463 685f 6d6f 6465 3a20 5468 6520 7374  tch_mode: The st
-00015650: 7261 7465 6779 2066 6f72 206d 6572 6769  rategy for mergi
-00015660: 6e67 2074 6865 2063 6861 6e67 6573 2077  ng the changes w
-00015670: 6974 6820 7468 6520 6578 6973 7469 6e67  ith the existing
-00015680: 206f 626a 6563 742e 2043 616e 2062 6520   object. Can be 
-00015690: 6569 7468 6572 2060 6072 6570 6c61 6365  either ``replace
-000156a0: 6060 0a20 2020 2020 2020 2020 2020 206f  ``.            o
-000156b0: 7220 6060 6164 6469 7469 7665 6060 2e0a  r ``additive``..
-000156c0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-000156d0: 2020 2020 7265 6665 7265 6e63 6520 3d20      reference = 
-000156e0: 7365 6c66 2e5f 7265 736f 6c76 655f 7265  self._resolve_re
-000156f0: 6665 7265 6e63 6528 7461 672c 2075 6964  ference(tag, uid
-00015700: 290a 2020 2020 2020 2020 7072 6f6a 6563  ).        projec
-00015710: 7420 3d20 7072 6f6a 6563 7420 6f72 2063  t = project or c
-00015720: 6f6e 6669 672e 6465 6661 756c 745f 7072  onfig.default_pr
-00015730: 6f6a 6563 740a 2020 2020 2020 2020 6865  oject.        he
-00015740: 6164 6572 7320 3d20 7b6d 6c72 756e 2e63  aders = {mlrun.c
-00015750: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4865  ommon.schemas.He
-00015760: 6164 6572 4e61 6d65 732e 7061 7463 685f  aderNames.patch_
-00015770: 6d6f 6465 3a20 7061 7463 685f 6d6f 6465  mode: patch_mode
-00015780: 7d0a 2020 2020 2020 2020 7061 7468 203d  }.        path =
-00015790: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
-000157a0: 6a65 6374 7d2f 6665 6174 7572 652d 7665  ject}/feature-ve
-000157b0: 6374 6f72 732f 7b6e 616d 657d 2f72 6566  ctors/{name}/ref
-000157c0: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
-000157d0: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
-000157e0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
-000157f0: 6169 6c65 6420 7570 6461 7469 6e67 2066  ailed updating f
-00015800: 6561 7475 7265 2d76 6563 746f 7220 7b70  eature-vector {p
-00015810: 726f 6a65 6374 7d2f 7b6e 616d 657d 220a  roject}/{name}".
-00015820: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
-00015830: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00015840: 2020 2022 5041 5443 4822 2c0a 2020 2020     "PATCH",.    
-00015850: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-00015860: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-00015870: 6d65 7373 6167 652c 0a20 2020 2020 2020  message,.       
-00015880: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
-00015890: 6f5f 6a73 6f6e 2866 6561 7475 7265 5f76  o_json(feature_v
-000158a0: 6563 746f 725f 7570 6461 7465 292c 0a20  ector_update),. 
-000158b0: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-000158c0: 7273 3d68 6561 6465 7273 2c0a 2020 2020  rs=headers,.    
-000158d0: 2020 2020 290a 0a20 2020 2064 6566 2064      )..    def d
-000158e0: 656c 6574 655f 6665 6174 7572 655f 7665  elete_feature_ve
-000158f0: 6374 6f72 2873 656c 662c 206e 616d 652c  ctor(self, name,
-00015900: 2070 726f 6a65 6374 3d22 222c 2074 6167   project="", tag
-00015910: 3d4e 6f6e 652c 2075 6964 3d4e 6f6e 6529  =None, uid=None)
-00015920: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
-00015930: 6574 6520 6120 3a70 793a 636c 6173 733a  ete a :py:class:
-00015940: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
-00015950: 7374 6f72 652e 4665 6174 7572 6556 6563  store.FeatureVec
-00015960: 746f 7260 206f 626a 6563 7420 6672 6f6d  tor` object from
-00015970: 2074 6865 2044 422e 0a20 2020 2020 2020   the DB..       
-00015980: 2049 6620 6060 7461 6760 6020 6f72 2060   If ``tag`` or `
-00015990: 6075 6964 6060 2061 7265 2073 7065 6369  `uid`` are speci
-000159a0: 6669 6564 2c20 7468 656e 206a 7573 7420  fied, then just 
-000159b0: 7468 6520 7665 7273 696f 6e20 7265 6665  the version refe
-000159c0: 7265 6e63 6564 2062 7920 7468 656d 2077  renced by them w
-000159d0: 696c 6c20 6265 2064 656c 6574 6564 2e20  ill be deleted. 
-000159e0: 5573 696e 6720 626f 7468 0a20 2020 2020  Using both.     
-000159f0: 2020 2069 7320 6e6f 7420 616c 6c6f 7765     is not allowe
-00015a00: 642e 0a20 2020 2020 2020 2049 6620 6e6f  d..        If no
-00015a10: 6e65 2061 7265 2073 7065 6369 6669 6564  ne are specified
-00015a20: 2c20 7468 656e 2061 6c6c 2069 6e73 7461  , then all insta
-00015a30: 6e63 6573 206f 6620 7468 6520 6f62 6a65  nces of the obje
-00015a40: 6374 2077 686f 7365 206e 616d 6520 6973  ct whose name is
-00015a50: 2060 606e 616d 6560 6020 7769 6c6c 2062   ``name`` will b
-00015a60: 6520 6465 6c65 7465 642e 0a20 2020 2020  e deleted..     
-00015a70: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-00015a80: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-00015a90: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
-00015aa0: 6c74 5f70 726f 6a65 6374 0a20 2020 2020  lt_project.     
-00015ab0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
-00015ac0: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
-00015ad0: 6561 7475 7265 2d76 6563 746f 7273 2f7b  eature-vectors/{
-00015ae0: 6e61 6d65 7d22 0a20 2020 2020 2020 2069  name}".        i
-00015af0: 6620 7461 6720 6f72 2075 6964 3a0a 2020  f tag or uid:.  
-00015b00: 2020 2020 2020 2020 2020 7265 6665 7265            refere
-00015b10: 6e63 6520 3d20 7365 6c66 2e5f 7265 736f  nce = self._reso
-00015b20: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
-00015b30: 672c 2075 6964 290a 2020 2020 2020 2020  g, uid).        
-00015b40: 2020 2020 7061 7468 203d 2070 6174 6820      path = path 
-00015b50: 2b20 6622 2f72 6566 6572 656e 6365 732f  + f"/references/
-00015b60: 7b72 6566 6572 656e 6365 7d22 0a0a 2020  {reference}"..  
-00015b70: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
-00015b80: 6167 6520 3d20 6622 4661 696c 6564 2064  age = f"Failed d
-00015b90: 656c 6574 696e 6720 6665 6174 7572 652d  eleting feature-
-00015ba0: 7665 6374 6f72 207b 6e61 6d65 7d22 0a20  vector {name}". 
-00015bb0: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
-00015bc0: 6361 6c6c 2822 4445 4c45 5445 222c 2070  call("DELETE", p
-00015bd0: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
-00015be0: 6765 290a 0a20 2020 2064 6566 2074 6167  ge)..    def tag
-00015bf0: 5f6f 626a 6563 7473 280a 2020 2020 2020  _objects(.      
-00015c00: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-00015c10: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
-00015c20: 2020 2020 2020 7461 675f 6e61 6d65 3a20        tag_name: 
-00015c30: 7374 722c 0a20 2020 2020 2020 206f 626a  str,.        obj
-00015c40: 6563 7473 3a20 556e 696f 6e5b 6d6c 7275  ects: Union[mlru
-00015c50: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00015c60: 2e54 6167 4f62 6a65 6374 732c 2064 6963  .TagObjects, dic
-00015c70: 745d 2c0a 2020 2020 2020 2020 7265 706c  t],.        repl
-00015c80: 6163 653a 2062 6f6f 6c20 3d20 4661 6c73  ace: bool = Fals
-00015c90: 652c 0a20 2020 2029 3a0a 2020 2020 2020  e,.    ):.      
-00015ca0: 2020 2222 2254 6167 2061 206c 6973 7420    """Tag a list 
-00015cb0: 6f66 206f 626a 6563 7473 2e0a 0a20 2020  of objects...   
-00015cc0: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
-00015cd0: 6563 743a 2050 726f 6a65 6374 2077 6869  ect: Project whi
-00015ce0: 6368 2063 6f6e 7461 696e 7320 7468 6520  ch contains the 
-00015cf0: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
-00015d00: 203a 7061 7261 6d20 7461 675f 6e61 6d65   :param tag_name
-00015d10: 3a20 5468 6520 7461 6720 746f 2073 6574  : The tag to set
-00015d20: 206f 6e20 7468 6520 6f62 6a65 6374 732e   on the objects.
-00015d30: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00015d40: 6f62 6a65 6374 733a 2054 6865 206f 626a  objects: The obj
-00015d50: 6563 7473 2074 6f20 7461 672e 0a20 2020  ects to tag..   
-00015d60: 2020 2020 203a 7061 7261 6d20 7265 706c       :param repl
-00015d70: 6163 653a 2057 6865 7468 6572 2074 6f20  ace: Whether to 
-00015d80: 7265 706c 6163 6520 7468 6520 6578 6973  replace the exis
-00015d90: 7469 6e67 2074 6167 7320 6f66 2074 6865  ting tags of the
-00015da0: 206f 626a 6563 7473 206f 7220 746f 2061   objects or to a
-00015db0: 6464 2074 6865 206e 6577 2074 6167 2074  dd the new tag t
-00015dc0: 6f20 7468 656d 2e0a 2020 2020 2020 2020  o them..        
-00015dd0: 2222 220a 0a20 2020 2020 2020 2070 6174  """..        pat
-00015de0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
-00015df0: 7072 6f6a 6563 747d 2f74 6167 732f 7b74  project}/tags/{t
-00015e00: 6167 5f6e 616d 657d 220a 2020 2020 2020  ag_name}".      
-00015e10: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-00015e20: 3d20 6622 4661 696c 6564 2074 6f20 7461  = f"Failed to ta
-00015e30: 6720 7b74 6167 5f6e 616d 657d 206f 6e20  g {tag_name} on 
-00015e40: 6f62 6a65 6374 7320 7b6f 626a 6563 7473  objects {objects
-00015e50: 7d22 0a20 2020 2020 2020 206d 6574 686f  }".        metho
-00015e60: 6420 3d20 2250 4f53 5422 2069 6620 7265  d = "POST" if re
-00015e70: 706c 6163 6520 656c 7365 2022 5055 5422  place else "PUT"
-00015e80: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
-00015e90: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
-00015ea0: 2020 2020 6d65 7468 6f64 2c0a 2020 2020      method,.    
-00015eb0: 2020 2020 2020 2020 7061 7468 2c0a 2020          path,.  
-00015ec0: 2020 2020 2020 2020 2020 6572 726f 725f            error_
-00015ed0: 6d65 7373 6167 652c 0a20 2020 2020 2020  message,.       
-00015ee0: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
-00015ef0: 6f5f 6a73 6f6e 280a 2020 2020 2020 2020  o_json(.        
-00015f00: 2020 2020 2020 2020 6f62 6a65 6374 732e          objects.
-00015f10: 6469 6374 2829 0a20 2020 2020 2020 2020  dict().         
-00015f20: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
-00015f30: 616e 6365 286f 626a 6563 7473 2c20 6d6c  ance(objects, ml
-00015f40: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00015f50: 6173 2e54 6167 4f62 6a65 6374 7329 0a20  as.TagObjects). 
-00015f60: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00015f70: 6c73 6520 6f62 6a65 6374 730a 2020 2020  lse objects.    
-00015f80: 2020 2020 2020 2020 292c 0a20 2020 2020          ),.     
-00015f90: 2020 2029 0a0a 2020 2020 6465 6620 6465     )..    def de
-00015fa0: 6c65 7465 5f6f 626a 6563 7473 5f74 6167  lete_objects_tag
-00015fb0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00015fc0: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-00015fd0: 2073 7472 2c0a 2020 2020 2020 2020 7461   str,.        ta
-00015fe0: 675f 6e61 6d65 3a20 7374 722c 0a20 2020  g_name: str,.   
-00015ff0: 2020 2020 2074 6167 5f6f 626a 6563 7473       tag_objects
-00016000: 3a20 556e 696f 6e5b 6d6c 7275 6e2e 636f  : Union[mlrun.co
-00016010: 6d6d 6f6e 2e73 6368 656d 6173 2e54 6167  mmon.schemas.Tag
-00016020: 4f62 6a65 6374 732c 2064 6963 745d 2c0a  Objects, dict],.
-00016030: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
-00016040: 2222 4465 6c65 7465 2061 2074 6167 2066  ""Delete a tag f
-00016050: 726f 6d20 6120 6c69 7374 206f 6620 6f62  rom a list of ob
-00016060: 6a65 6374 732e 0a0a 2020 2020 2020 2020  jects...        
-00016070: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-00016080: 5072 6f6a 6563 7420 7768 6963 6820 636f  Project which co
-00016090: 6e74 6169 6e73 2074 6865 206f 626a 6563  ntains the objec
-000160a0: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-000160b0: 616d 2074 6167 5f6e 616d 653a 2054 6865  am tag_name: The
-000160c0: 2074 6167 2074 6f20 6465 6c65 7465 2066   tag to delete f
-000160d0: 726f 6d20 7468 6520 6f62 6a65 6374 732e  rom the objects.
-000160e0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-000160f0: 7461 675f 6f62 6a65 6374 733a 2054 6865  tag_objects: The
-00016100: 206f 626a 6563 7473 2074 6f20 6465 6c65   objects to dele
-00016110: 7465 2074 6865 2074 6167 2066 726f 6d2e  te the tag from.
-00016120: 0a0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-00016130: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
-00016140: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
-00016150: 7d2f 7461 6773 2f7b 7461 675f 6e61 6d65  }/tags/{tag_name
-00016160: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
-00016170: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
-00016180: 6c65 6420 6465 6c65 7469 6e67 2074 6167  led deleting tag
-00016190: 2066 726f 6d20 7b74 6167 5f6e 616d 657d   from {tag_name}
-000161a0: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
-000161b0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
-000161c0: 2020 2020 2022 4445 4c45 5445 222c 0a20       "DELETE",. 
-000161d0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
-000161e0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
-000161f0: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
-00016200: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
-00016210: 745f 746f 5f6a 736f 6e28 0a20 2020 2020  t_to_json(.     
-00016220: 2020 2020 2020 2020 2020 2074 6167 5f6f             tag_o
-00016230: 626a 6563 7473 2e64 6963 7428 290a 2020  bjects.dict().  
-00016240: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00016250: 2069 7369 6e73 7461 6e63 6528 7461 675f   isinstance(tag_
-00016260: 6f62 6a65 6374 732c 206d 6c72 756e 2e63  objects, mlrun.c
-00016270: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5461  ommon.schemas.Ta
-00016280: 674f 626a 6563 7473 290a 2020 2020 2020  gObjects).      
-00016290: 2020 2020 2020 2020 2020 656c 7365 2074            else t
-000162a0: 6167 5f6f 626a 6563 7473 0a20 2020 2020  ag_objects.     
-000162b0: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
-000162c0: 2020 290a 0a20 2020 2064 6566 2074 6167    )..    def tag
-000162d0: 5f61 7274 6966 6163 7473 280a 2020 2020  _artifacts(.    
-000162e0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
-000162f0: 2020 6172 7469 6661 6374 733a 2055 6e69    artifacts: Uni
-00016300: 6f6e 5b4c 6973 745b 4172 7469 6661 6374  on[List[Artifact
-00016310: 5d2c 204c 6973 745b 6469 6374 5d2c 2041  ], List[dict], A
-00016320: 7274 6966 6163 742c 2064 6963 745d 2c0a  rtifact, dict],.
-00016330: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
-00016340: 2073 7472 2c0a 2020 2020 2020 2020 7461   str,.        ta
-00016350: 675f 6e61 6d65 3a20 7374 722c 0a20 2020  g_name: str,.   
-00016360: 2020 2020 2072 6570 6c61 6365 3a20 626f       replace: bo
-00016370: 6f6c 203d 2046 616c 7365 2c0a 2020 2020  ol = False,.    
-00016380: 293a 0a20 2020 2020 2020 2022 2222 5461  ):.        """Ta
-00016390: 6720 6120 6c69 7374 206f 6620 6172 7469  g a list of arti
-000163a0: 6661 6374 732e 0a0a 2020 2020 2020 2020  facts...        
-000163b0: 3a70 6172 616d 2061 7274 6966 6163 7473  :param artifacts
-000163c0: 3a20 5468 6520 6172 7469 6661 6374 7320  : The artifacts 
-000163d0: 746f 2074 6167 2e20 4361 6e20 6265 2061  to tag. Can be a
-000163e0: 206c 6973 7420 6f66 203a 7079 3a63 6c61   list of :py:cla
-000163f0: 7373 3a60 7e6d 6c72 756e 2e61 7274 6966  ss:`~mlrun.artif
-00016400: 6163 7473 2e41 7274 6966 6163 7460 206f  acts.Artifact` o
-00016410: 626a 6563 7473 206f 720a 2020 2020 2020  bjects or.      
-00016420: 2020 2020 2020 6469 6374 696f 6e61 7269        dictionari
-00016430: 6573 2c20 6f72 2061 2073 696e 676c 6520  es, or a single 
-00016440: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
-00016450: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-00016460: 5072 6f6a 6563 7420 7768 6963 6820 636f  Project which co
-00016470: 6e74 6169 6e73 2074 6865 2061 7274 6966  ntains the artif
-00016480: 6163 7473 2e0a 2020 2020 2020 2020 3a70  acts..        :p
-00016490: 6172 616d 2074 6167 5f6e 616d 653a 2054  aram tag_name: T
-000164a0: 6865 2074 6167 2074 6f20 7365 7420 6f6e  he tag to set on
-000164b0: 2074 6865 2061 7274 6966 6163 7473 2e0a   the artifacts..
-000164c0: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
-000164d0: 6570 6c61 6365 3a20 4966 2054 7275 652c  eplace: If True,
-000164e0: 2072 6570 6c61 6365 2065 7869 7374 696e   replace existin
-000164f0: 6720 7461 6773 2c20 6f74 6865 7277 6973  g tags, otherwis
-00016500: 6520 6170 7065 6e64 2074 6f20 6578 6973  e append to exis
-00016510: 7469 6e67 2074 6167 732e 0a20 2020 2020  ting tags..     
-00016520: 2020 2022 2222 0a20 2020 2020 2020 2074     """.        t
-00016530: 6167 5f6f 626a 6563 7473 203d 2073 656c  ag_objects = sel
-00016540: 662e 5f72 6573 6f6c 7665 5f61 7274 6966  f._resolve_artif
-00016550: 6163 7473 5f74 6f5f 7461 675f 6f62 6a65  acts_to_tag_obje
-00016560: 6374 7328 6172 7469 6661 6374 7329 0a20  cts(artifacts). 
-00016570: 2020 2020 2020 2073 656c 662e 7461 675f         self.tag_
-00016580: 6f62 6a65 6374 7328 7072 6f6a 6563 742c  objects(project,
-00016590: 2074 6167 5f6e 616d 652c 206f 626a 6563   tag_name, objec
-000165a0: 7473 3d74 6167 5f6f 626a 6563 7473 2c20  ts=tag_objects, 
-000165b0: 7265 706c 6163 653d 7265 706c 6163 6529  replace=replace)
-000165c0: 0a0a 2020 2020 6465 6620 6465 6c65 7465  ..    def delete
-000165d0: 5f61 7274 6966 6163 7473 5f74 6167 7328  _artifacts_tags(
-000165e0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-000165f0: 2020 2020 2020 2061 7274 6966 6163 7473         artifacts
-00016600: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00016610: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
-00016620: 7461 675f 6e61 6d65 3a20 7374 722c 0a20  tag_name: str,. 
-00016630: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-00016640: 2244 656c 6574 6520 7461 6720 6672 6f6d  "Delete tag from
-00016650: 2061 206c 6973 7420 6f66 2061 7274 6966   a list of artif
-00016660: 6163 7473 2e0a 0a20 2020 2020 2020 203a  acts...        :
-00016670: 7061 7261 6d20 6172 7469 6661 6374 733a  param artifacts:
-00016680: 2054 6865 2061 7274 6966 6163 7473 2074   The artifacts t
-00016690: 6f20 6465 6c65 7465 2074 6865 2074 6167  o delete the tag
-000166a0: 2066 726f 6d2e 2043 616e 2062 6520 6120   from. Can be a 
-000166b0: 6c69 7374 206f 6620 3a70 793a 636c 6173  list of :py:clas
-000166c0: 733a 607e 6d6c 7275 6e2e 6172 7469 6661  s:`~mlrun.artifa
-000166d0: 6374 732e 4172 7469 6661 6374 600a 2020  cts.Artifact`.  
-000166e0: 2020 2020 2020 2020 2020 6f62 6a65 6374            object
-000166f0: 7320 6f72 2064 6963 7469 6f6e 6172 6965  s or dictionarie
-00016700: 732c 206f 7220 6120 7369 6e67 6c65 206f  s, or a single o
-00016710: 626a 6563 742e 0a20 2020 2020 2020 203a  bject..        :
-00016720: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
-00016730: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
-00016740: 7461 696e 7320 7468 6520 6172 7469 6661  tains the artifa
-00016750: 6374 732e 0a20 2020 2020 2020 203a 7061  cts..        :pa
-00016760: 7261 6d20 7461 675f 6e61 6d65 3a20 5468  ram tag_name: Th
-00016770: 6520 7461 6720 746f 2073 6574 206f 6e20  e tag to set on 
-00016780: 7468 6520 6172 7469 6661 6374 732e 0a20  the artifacts.. 
-00016790: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
-000167a0: 2020 2074 6167 5f6f 626a 6563 7473 203d     tag_objects =
-000167b0: 2073 656c 662e 5f72 6573 6f6c 7665 5f61   self._resolve_a
-000167c0: 7274 6966 6163 7473 5f74 6f5f 7461 675f  rtifacts_to_tag_
-000167d0: 6f62 6a65 6374 7328 6172 7469 6661 6374  objects(artifact
-000167e0: 7329 0a20 2020 2020 2020 2073 656c 662e  s).        self.
-000167f0: 6465 6c65 7465 5f6f 626a 6563 7473 5f74  delete_objects_t
-00016800: 6167 2870 726f 6a65 6374 2c20 7461 675f  ag(project, tag_
-00016810: 6e61 6d65 2c20 7461 675f 6f62 6a65 6374  name, tag_object
-00016820: 7329 0a0a 2020 2020 6465 6620 6c69 7374  s)..    def list
-00016830: 5f70 726f 6a65 6374 7328 0a20 2020 2020  _projects(.     
-00016840: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-00016850: 206f 776e 6572 3a20 7374 7220 3d20 4e6f   owner: str = No
-00016860: 6e65 2c0a 2020 2020 2020 2020 666f 726d  ne,.        form
-00016870: 6174 5f3a 2055 6e69 6f6e 5b0a 2020 2020  at_: Union[.    
-00016880: 2020 2020 2020 2020 7374 722c 206d 6c72          str, mlr
-00016890: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-000168a0: 732e 5072 6f6a 6563 7473 466f 726d 6174  s.ProjectsFormat
-000168b0: 0a20 2020 2020 2020 205d 203d 206d 6c72  .        ] = mlr
-000168c0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-000168d0: 732e 5072 6f6a 6563 7473 466f 726d 6174  s.ProjectsFormat
-000168e0: 2e66 756c 6c2c 0a20 2020 2020 2020 206c  .full,.        l
-000168f0: 6162 656c 733a 204c 6973 745b 7374 725d  abels: List[str]
-00016900: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
-00016910: 2073 7461 7465 3a20 556e 696f 6e5b 7374   state: Union[st
-00016920: 722c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  r, mlrun.common.
-00016930: 7363 6865 6d61 732e 5072 6f6a 6563 7453  schemas.ProjectS
-00016940: 7461 7465 5d20 3d20 4e6f 6e65 2c0a 2020  tate] = None,.  
-00016950: 2020 2920 2d3e 204c 6973 745b 556e 696f    ) -> List[Unio
-00016960: 6e5b 6d6c 7275 6e2e 7072 6f6a 6563 7473  n[mlrun.projects
-00016970: 2e4d 6c72 756e 5072 6f6a 6563 742c 2073  .MlrunProject, s
-00016980: 7472 5d5d 3a0a 2020 2020 2020 2020 2222  tr]]:.        ""
-00016990: 2252 6574 7572 6e20 6120 6c69 7374 206f  "Return a list o
-000169a0: 6620 7468 6520 6578 6973 7469 6e67 2070  f the existing p
-000169b0: 726f 6a65 6374 732c 2070 6f74 656e 7469  rojects, potenti
-000169c0: 616c 6c79 2066 696c 7465 7265 6420 6279  ally filtered by
-000169d0: 2073 7065 6369 6669 6320 6372 6974 6572   specific criter
-000169e0: 6961 2e0a 0a20 2020 2020 2020 203a 7061  ia...        :pa
-000169f0: 7261 6d20 6f77 6e65 723a 204c 6973 7420  ram owner: List 
-00016a00: 6f6e 6c79 2070 726f 6a65 6374 7320 6265  only projects be
-00016a10: 6c6f 6e67 696e 6720 746f 2074 6869 7320  longing to this 
-00016a20: 7370 6563 6966 6963 206f 776e 6572 2e0a  specific owner..
-00016a30: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
-00016a40: 6f72 6d61 745f 3a20 466f 726d 6174 206f  ormat_: Format o
-00016a50: 6620 7468 6520 7265 7375 6c74 732e 2050  f the results. P
-00016a60: 6f73 7369 626c 6520 7661 6c75 6573 2061  ossible values a
-00016a70: 7265 3a0a 0a20 2020 2020 2020 2020 2020  re:..           
-00016a80: 202d 2060 6066 756c 6c60 6020 2864 6566   - ``full`` (def
-00016a90: 6175 6c74 2076 616c 7565 2920 2d20 5265  ault value) - Re
-00016aa0: 7475 726e 2066 756c 6c20 7072 6f6a 6563  turn full projec
-00016ab0: 7420 6f62 6a65 6374 732e 0a20 2020 2020  t objects..     
-00016ac0: 2020 2020 2020 202d 2060 606d 696e 696d         - ``minim
-00016ad0: 616c 6060 202d 2052 6574 7572 6e20 6d69  al`` - Return mi
-00016ae0: 6e69 6d61 6c20 7072 6f6a 6563 7420 6f62  nimal project ob
-00016af0: 6a65 6374 7320 286d 696e 696d 697a 6174  jects (minimizat
-00016b00: 696f 6e20 6861 7070 656e 7320 696e 2074  ion happens in t
-00016b10: 6865 2042 4529 2e0a 2020 2020 2020 2020  he BE)..        
-00016b20: 2020 2020 2d20 6060 6e61 6d65 5f6f 6e6c      - ``name_onl
-00016b30: 7960 6020 2d20 5265 7475 726e 206a 7573  y`` - Return jus
-00016b40: 7420 7468 6520 6e61 6d65 7320 6f66 2074  t the names of t
-00016b50: 6865 2070 726f 6a65 6374 732e 0a0a 2020  he projects...  
-00016b60: 2020 2020 2020 3a70 6172 616d 206c 6162        :param lab
-00016b70: 656c 733a 2046 696c 7465 7220 6279 206c  els: Filter by l
-00016b80: 6162 656c 7320 6174 7461 6368 6564 2074  abels attached t
-00016b90: 6f20 7468 6520 7072 6f6a 6563 742e 0a20  o the project.. 
-00016ba0: 2020 2020 2020 203a 7061 7261 6d20 7374         :param st
-00016bb0: 6174 653a 2046 696c 7465 7220 6279 2070  ate: Filter by p
-00016bc0: 726f 6a65 6374 2773 2073 7461 7465 2e20  roject's state. 
-00016bd0: 4361 6e20 6265 2065 6974 6865 7220 6060  Can be either ``
-00016be0: 6f6e 6c69 6e65 6060 206f 7220 6060 6172  online`` or ``ar
-00016bf0: 6368 6976 6564 6060 2e0a 2020 2020 2020  chived``..      
-00016c00: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
-00016c10: 6172 616d 7320 3d20 7b0a 2020 2020 2020  arams = {.      
-00016c20: 2020 2020 2020 226f 776e 6572 223a 206f        "owner": o
-00016c30: 776e 6572 2c0a 2020 2020 2020 2020 2020  wner,.          
-00016c40: 2020 2273 7461 7465 223a 2073 7461 7465    "state": state
-00016c50: 2c0a 2020 2020 2020 2020 2020 2020 2266  ,.            "f
-00016c60: 6f72 6d61 7422 3a20 666f 726d 6174 5f2c  ormat": format_,
-00016c70: 0a20 2020 2020 2020 2020 2020 2022 6c61  .            "la
-00016c80: 6265 6c22 3a20 6c61 6265 6c73 206f 7220  bel": labels or 
-00016c90: 5b5d 2c0a 2020 2020 2020 2020 7d0a 0a20  [],.        }.. 
-00016ca0: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00016cb0: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-00016cc0: 6c69 7374 696e 6720 7072 6f6a 6563 7473  listing projects
-00016cd0: 2c20 7175 6572 793a 207b 7061 7261 6d73  , query: {params
-00016ce0: 7d22 0a20 2020 2020 2020 2072 6573 706f  }".        respo
-00016cf0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-00016d00: 616c 6c28 2247 4554 222c 2022 7072 6f6a  all("GET", "proj
-00016d10: 6563 7473 222c 2065 7272 6f72 5f6d 6573  ects", error_mes
-00016d20: 7361 6765 2c20 7061 7261 6d73 3d70 6172  sage, params=par
-00016d30: 616d 7329 0a20 2020 2020 2020 2069 6620  ams).        if 
-00016d40: 666f 726d 6174 5f20 3d3d 206d 6c72 756e  format_ == mlrun
-00016d50: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-00016d60: 5072 6f6a 6563 7473 466f 726d 6174 2e6e  ProjectsFormat.n
-00016d70: 616d 655f 6f6e 6c79 3a0a 0a20 2020 2020  ame_only:..     
-00016d80: 2020 2020 2020 2023 2070 726f 6a65 6374         # project
-00016d90: 7320 6973 206a 7573 7420 6120 6c69 7374  s is just a list
-00016da0: 206f 6620 7374 7269 6e67 730a 2020 2020   of strings.    
-00016db0: 2020 2020 2020 2020 7265 7475 726e 2072          return r
-00016dc0: 6573 706f 6e73 652e 6a73 6f6e 2829 5b22  esponse.json()["
-00016dd0: 7072 6f6a 6563 7473 225d 0a0a 2020 2020  projects"]..    
-00016de0: 2020 2020 2320 666f 7277 6172 6473 2063      # forwards c
-00016df0: 6f6d 7061 7469 6269 6c69 7479 202d 2077  ompatibility - w
-00016e00: 6520 7761 6e74 2074 6f20 6265 2061 626c  e want to be abl
-00016e10: 6520 746f 2068 616e 646c 6520 6e65 7720  e to handle new 
-00016e20: 666f 726d 6174 7320 7468 6174 206d 6967  formats that mig
-00016e30: 6874 2062 6520 6164 6465 6420 696e 2074  ht be added in t
-00016e40: 6865 2066 7574 7572 650a 2020 2020 2020  he future.      
-00016e50: 2020 2320 6966 2066 6f72 6d61 7420 6973    # if format is
-00016e60: 206e 6f74 206b 6e6f 776e 2074 6f20 7468   not known to th
-00016e70: 6520 6170 692c 2069 7420 6973 2075 7020  e api, it is up 
-00016e80: 746f 2074 6865 2073 6572 7665 7220 746f  to the server to
-00016e90: 2072 6574 7572 6e20 6569 7468 6572 2061   return either a
-00016ea0: 6e20 6572 726f 7220 6f72 2061 2064 6566  n error or a def
-00016eb0: 6175 6c74 2066 6f72 6d61 740a 2020 2020  ault format.    
-00016ec0: 2020 2020 7265 7475 726e 205b 0a20 2020      return [.   
-00016ed0: 2020 2020 2020 2020 206d 6c72 756e 2e70           mlrun.p
-00016ee0: 726f 6a65 6374 732e 4d6c 7275 6e50 726f  rojects.MlrunPro
-00016ef0: 6a65 6374 2e66 726f 6d5f 6469 6374 2870  ject.from_dict(p
-00016f00: 726f 6a65 6374 5f64 6963 7429 0a20 2020  roject_dict).   
-00016f10: 2020 2020 2020 2020 2066 6f72 2070 726f           for pro
-00016f20: 6a65 6374 5f64 6963 7420 696e 2072 6573  ject_dict in res
-00016f30: 706f 6e73 652e 6a73 6f6e 2829 5b22 7072  ponse.json()["pr
-00016f40: 6f6a 6563 7473 225d 0a20 2020 2020 2020  ojects"].       
-00016f50: 205d 0a0a 2020 2020 6465 6620 6765 745f   ]..    def get_
-00016f60: 7072 6f6a 6563 7428 7365 6c66 2c20 6e61  project(self, na
-00016f70: 6d65 3a20 7374 7229 202d 3e20 6d6c 7275  me: str) -> mlru
-00016f80: 6e2e 7072 6f6a 6563 7473 2e4d 6c72 756e  n.projects.Mlrun
-00016f90: 5072 6f6a 6563 743a 0a20 2020 2020 2020  Project:.       
-00016fa0: 2022 2222 4765 7420 6465 7461 696c 7320   """Get details 
-00016fb0: 666f 7220 6120 7370 6563 6966 6963 2070  for a specific p
-00016fc0: 726f 6a65 6374 2e22 2222 0a0a 2020 2020  roject."""..    
-00016fd0: 2020 2020 6966 206e 6f74 206e 616d 653a      if not name:
-00016fe0: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00016ff0: 7365 204d 4c52 756e 496e 7661 6c69 6441  se MLRunInvalidA
-00017000: 7267 756d 656e 7445 7272 6f72 2822 4e61  rgumentError("Na
-00017010: 6d65 206d 7573 7420 6265 2070 726f 7669  me must be provi
-00017020: 6465 6422 290a 0a20 2020 2020 2020 2070  ded")..        p
-00017030: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
-00017040: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
-00017050: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
-00017060: 2066 2246 6169 6c65 6420 7265 7472 6965   f"Failed retrie
-00017070: 7669 6e67 2070 726f 6a65 6374 207b 6e61  ving project {na
-00017080: 6d65 7d22 0a20 2020 2020 2020 2072 6573  me}".        res
-00017090: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-000170a0: 5f63 616c 6c28 2247 4554 222c 2070 6174  _call("GET", pat
-000170b0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
-000170c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
-000170d0: 206d 6c72 756e 2e70 726f 6a65 6374 732e   mlrun.projects.
-000170e0: 4d6c 7275 6e50 726f 6a65 6374 2e66 726f  MlrunProject.fro
-000170f0: 6d5f 6469 6374 2872 6573 706f 6e73 652e  m_dict(response.
-00017100: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-00017110: 2064 656c 6574 655f 7072 6f6a 6563 7428   delete_project(
-00017120: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00017130: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
-00017140: 2c0a 2020 2020 2020 2020 6465 6c65 7469  ,.        deleti
-00017150: 6f6e 5f73 7472 6174 6567 793a 2055 6e69  on_strategy: Uni
-00017160: 6f6e 5b0a 2020 2020 2020 2020 2020 2020  on[.            
-00017170: 7374 722c 206d 6c72 756e 2e63 6f6d 6d6f  str, mlrun.commo
-00017180: 6e2e 7363 6865 6d61 732e 4465 6c65 7469  n.schemas.Deleti
-00017190: 6f6e 5374 7261 7465 6779 0a20 2020 2020  onStrategy.     
-000171a0: 2020 205d 203d 206d 6c72 756e 2e63 6f6d     ] = mlrun.com
-000171b0: 6d6f 6e2e 7363 6865 6d61 732e 4465 6c65  mon.schemas.Dele
-000171c0: 7469 6f6e 5374 7261 7465 6779 2e64 6566  tionStrategy.def
-000171d0: 6175 6c74 2829 2c0a 2020 2020 293a 0a20  ault(),.    ):. 
-000171e0: 2020 2020 2020 2022 2222 4465 6c65 7465         """Delete
-000171f0: 2061 2070 726f 6a65 6374 2e0a 0a20 2020   a project...   
-00017200: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-00017210: 3a20 4e61 6d65 206f 6620 7468 6520 7072  : Name of the pr
-00017220: 6f6a 6563 7420 746f 2064 656c 6574 652e  oject to delete.
-00017230: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00017240: 6465 6c65 7469 6f6e 5f73 7472 6174 6567  deletion_strateg
-00017250: 793a 2048 6f77 2074 6f20 7472 6561 7420  y: How to treat 
-00017260: 6368 696c 6420 6f62 6a65 6374 7320 6f66  child objects of
-00017270: 2074 6865 2070 726f 6a65 6374 2e20 506f   the project. Po
-00017280: 7373 6962 6c65 2076 616c 7565 7320 6172  ssible values ar
-00017290: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
-000172a0: 2d20 6060 7265 7374 7269 6374 6060 2028  - ``restrict`` (
-000172b0: 6465 6661 756c 7429 202d 2050 726f 6a65  default) - Proje
-000172c0: 6374 206d 7573 7420 6e6f 7420 6861 7665  ct must not have
-000172d0: 2061 6e79 2063 6869 6c64 206f 626a 6563   any child objec
-000172e0: 7473 2077 6865 6e20 6465 6c65 7465 642e  ts when deleted.
-000172f0: 2049 6620 7573 696e 6720 7468 6973 206d   If using this m
-00017300: 6f64 6520 7768 696c 650a 2020 2020 2020  ode while.      
-00017310: 2020 2020 2020 2020 6368 696c 6420 6f62          child ob
-00017320: 6a65 6374 7320 6578 6973 742c 2074 6865  jects exist, the
-00017330: 206f 7065 7261 7469 6f6e 2077 696c 6c20   operation will 
-00017340: 6661 696c 2e0a 2020 2020 2020 2020 2020  fail..          
-00017350: 2020 2d20 6060 6361 7363 6164 6560 6020    - ``cascade`` 
-00017360: 2d20 4175 746f 6d61 7469 6361 6c6c 7920  - Automatically 
-00017370: 6465 6c65 7465 2061 6c6c 2063 6869 6c64  delete all child
-00017380: 206f 626a 6563 7473 2077 6865 6e20 6465   objects when de
-00017390: 6c65 7469 6e67 2074 6865 2070 726f 6a65  leting the proje
-000173a0: 6374 2e0a 2020 2020 2020 2020 2222 220a  ct..        """.
-000173b0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
-000173c0: 6622 7072 6f6a 6563 7473 2f7b 6e61 6d65  f"projects/{name
-000173d0: 7d22 0a20 2020 2020 2020 2068 6561 6465  }".        heade
-000173e0: 7273 203d 207b 0a20 2020 2020 2020 2020  rs = {.         
-000173f0: 2020 206d 6c72 756e 2e63 6f6d 6d6f 6e2e     mlrun.common.
-00017400: 7363 6865 6d61 732e 4865 6164 6572 4e61  schemas.HeaderNa
-00017410: 6d65 732e 6465 6c65 7469 6f6e 5f73 7472  mes.deletion_str
-00017420: 6174 6567 793a 2064 656c 6574 696f 6e5f  ategy: deletion_
-00017430: 7374 7261 7465 6779 0a20 2020 2020 2020  strategy.       
-00017440: 207d 0a20 2020 2020 2020 2065 7272 6f72   }.        error
-00017450: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
-00017460: 6c65 6420 6465 6c65 7469 6e67 2070 726f  led deleting pro
-00017470: 6a65 6374 207b 6e61 6d65 7d22 0a20 2020  ject {name}".   
-00017480: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-00017490: 7365 6c66 2e61 7069 5f63 616c 6c28 2244  self.api_call("D
-000174a0: 454c 4554 4522 2c20 7061 7468 2c20 6572  ELETE", path, er
-000174b0: 726f 725f 6d65 7373 6167 652c 2068 6561  ror_message, hea
-000174c0: 6465 7273 3d68 6561 6465 7273 290a 2020  ders=headers).  
-000174d0: 2020 2020 2020 6966 2072 6573 706f 6e73        if respons
-000174e0: 652e 7374 6174 7573 5f63 6f64 6520 3d3d  e.status_code ==
-000174f0: 2068 7474 702e 4854 5450 5374 6174 7573   http.HTTPStatus
-00017500: 2e41 4343 4550 5445 443a 0a20 2020 2020  .ACCEPTED:.     
-00017510: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
-00017520: 6c66 2e5f 7761 6974 5f66 6f72 5f70 726f  lf._wait_for_pro
-00017530: 6a65 6374 5f74 6f5f 6265 5f64 656c 6574  ject_to_be_delet
-00017540: 6564 286e 616d 6529 0a0a 2020 2020 6465  ed(name)..    de
-00017550: 6620 7374 6f72 655f 7072 6f6a 6563 7428  f store_project(
-00017560: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-00017570: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
-00017580: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
-00017590: 743a 2055 6e69 6f6e 5b64 6963 742c 206d  t: Union[dict, m
-000175a0: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
-000175b0: 7275 6e50 726f 6a65 6374 2c20 6d6c 7275  runProject, mlru
-000175c0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-000175d0: 2e50 726f 6a65 6374 5d2c 0a20 2020 2029  .Project],.    )
-000175e0: 202d 3e20 6d6c 7275 6e2e 7072 6f6a 6563   -> mlrun.projec
-000175f0: 7473 2e4d 6c72 756e 5072 6f6a 6563 743a  ts.MlrunProject:
-00017600: 0a20 2020 2020 2020 2022 2222 5374 6f72  .        """Stor
-00017610: 6520 6120 7072 6f6a 6563 7420 696e 2074  e a project in t
-00017620: 6865 2044 422e 2054 6869 7320 6f70 6572  he DB. This oper
-00017630: 6174 696f 6e20 7769 6c6c 206f 7665 7277  ation will overw
-00017640: 7269 7465 2065 7869 7374 696e 6720 7072  rite existing pr
-00017650: 6f6a 6563 7420 6f66 2074 6865 2073 616d  oject of the sam
-00017660: 6520 6e61 6d65 2069 6620 6578 6973 7473  e name if exists
-00017670: 2e22 2222 0a0a 2020 2020 2020 2020 7061  ."""..        pa
-00017680: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
-00017690: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
-000176a0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-000176b0: 6622 4661 696c 6564 2073 746f 7269 6e67  f"Failed storing
-000176c0: 2070 726f 6a65 6374 207b 6e61 6d65 7d22   project {name}"
-000176d0: 0a20 2020 2020 2020 2069 6620 6973 696e  .        if isin
-000176e0: 7374 616e 6365 2870 726f 6a65 6374 2c20  stance(project, 
-000176f0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00017700: 656d 6173 2e50 726f 6a65 6374 293a 0a20  emas.Project):. 
-00017710: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
-00017720: 6374 203d 2070 726f 6a65 6374 2e64 6963  ct = project.dic
-00017730: 7428 290a 2020 2020 2020 2020 656c 6966  t().        elif
-00017740: 2069 7369 6e73 7461 6e63 6528 7072 6f6a   isinstance(proj
-00017750: 6563 742c 206d 6c72 756e 2e70 726f 6a65  ect, mlrun.proje
-00017760: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
-00017770: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
-00017780: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
-00017790: 2e74 6f5f 6469 6374 2829 0a20 2020 2020  .to_dict().     
-000177a0: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
-000177b0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-000177c0: 2020 2020 2020 2020 2022 5055 5422 2c0a           "PUT",.
-000177d0: 2020 2020 2020 2020 2020 2020 7061 7468              path
-000177e0: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
-000177f0: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
-00017800: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
-00017810: 6374 5f74 6f5f 6a73 6f6e 2870 726f 6a65  ct_to_json(proje
-00017820: 6374 292c 0a20 2020 2020 2020 2029 0a20  ct),.        ). 
-00017830: 2020 2020 2020 2069 6620 7265 7370 6f6e         if respon
-00017840: 7365 2e73 7461 7475 735f 636f 6465 203d  se.status_code =
-00017850: 3d20 6874 7470 2e48 5454 5053 7461 7475  = http.HTTPStatu
-00017860: 732e 4143 4345 5054 4544 3a0a 2020 2020  s.ACCEPTED:.    
-00017870: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00017880: 656c 662e 5f77 6169 745f 666f 725f 7072  elf._wait_for_pr
-00017890: 6f6a 6563 745f 746f 5f72 6561 6368 5f74  oject_to_reach_t
-000178a0: 6572 6d69 6e61 6c5f 7374 6174 6528 6e61  erminal_state(na
-000178b0: 6d65 290a 2020 2020 2020 2020 7265 7475  me).        retu
-000178c0: 726e 206d 6c72 756e 2e70 726f 6a65 6374  rn mlrun.project
-000178d0: 732e 4d6c 7275 6e50 726f 6a65 6374 2e66  s.MlrunProject.f
-000178e0: 726f 6d5f 6469 6374 2872 6573 706f 6e73  rom_dict(respons
-000178f0: 652e 6a73 6f6e 2829 290a 0a20 2020 2064  e.json())..    d
-00017900: 6566 2070 6174 6368 5f70 726f 6a65 6374  ef patch_project
-00017910: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
-00017920: 2020 2020 2020 2020 6e61 6d65 3a20 7374          name: st
-00017930: 722c 0a20 2020 2020 2020 2070 726f 6a65  r,.        proje
-00017940: 6374 3a20 6469 6374 2c0a 2020 2020 2020  ct: dict,.      
-00017950: 2020 7061 7463 685f 6d6f 6465 3a20 556e    patch_mode: Un
-00017960: 696f 6e5b 0a20 2020 2020 2020 2020 2020  ion[.           
-00017970: 2073 7472 2c20 6d6c 7275 6e2e 636f 6d6d   str, mlrun.comm
-00017980: 6f6e 2e73 6368 656d 6173 2e50 6174 6368  on.schemas.Patch
-00017990: 4d6f 6465 0a20 2020 2020 2020 205d 203d  Mode.        ] =
-000179a0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-000179b0: 6865 6d61 732e 5061 7463 684d 6f64 652e  hemas.PatchMode.
-000179c0: 7265 706c 6163 652c 0a20 2020 2029 202d  replace,.    ) -
-000179d0: 3e20 6d6c 7275 6e2e 7072 6f6a 6563 7473  > mlrun.projects
-000179e0: 2e4d 6c72 756e 5072 6f6a 6563 743a 0a20  .MlrunProject:. 
-000179f0: 2020 2020 2020 2022 2222 5061 7463 6820         """Patch 
-00017a00: 616e 2065 7869 7374 696e 6720 7072 6f6a  an existing proj
-00017a10: 6563 7420 6f62 6a65 6374 2e0a 0a20 2020  ect object...   
-00017a20: 2020 2020 203a 7061 7261 6d20 6e61 6d65       :param name
-00017a30: 3a20 4e61 6d65 206f 6620 7072 6f6a 6563  : Name of projec
-00017a40: 7420 746f 2070 6174 6368 2e0a 2020 2020  t to patch..    
-00017a50: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-00017a60: 6374 3a20 5468 6520 6163 7475 616c 2063  ct: The actual c
-00017a70: 6861 6e67 6573 2074 6f20 7468 6520 7072  hanges to the pr
-00017a80: 6f6a 6563 7420 6f62 6a65 6374 2e0a 2020  oject object..  
-00017a90: 2020 2020 2020 3a70 6172 616d 2070 6174        :param pat
-00017aa0: 6368 5f6d 6f64 653a 2054 6865 2073 7472  ch_mode: The str
-00017ab0: 6174 6567 7920 666f 7220 6d65 7267 696e  ategy for mergin
-00017ac0: 6720 7468 6520 6368 616e 6765 7320 7769  g the changes wi
-00017ad0: 7468 2074 6865 2065 7869 7374 696e 6720  th the existing 
-00017ae0: 6f62 6a65 6374 2e20 4361 6e20 6265 2065  object. Can be e
-00017af0: 6974 6865 7220 6060 7265 706c 6163 6560  ither ``replace`
-00017b00: 600a 2020 2020 2020 2020 2020 2020 6f72  `.            or
-00017b10: 2060 6061 6464 6974 6976 6560 602e 0a20   ``additive``.. 
-00017b20: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
-00017b30: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-00017b40: 6a65 6374 732f 7b6e 616d 657d 220a 2020  jects/{name}".  
-00017b50: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
-00017b60: 7b6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  {mlrun.common.sc
-00017b70: 6865 6d61 732e 4865 6164 6572 4e61 6d65  hemas.HeaderName
-00017b80: 732e 7061 7463 685f 6d6f 6465 3a20 7061  s.patch_mode: pa
-00017b90: 7463 685f 6d6f 6465 7d0a 2020 2020 2020  tch_mode}.      
-00017ba0: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-00017bb0: 3d20 6622 4661 696c 6564 2070 6174 6368  = f"Failed patch
-00017bc0: 696e 6720 7072 6f6a 6563 7420 7b6e 616d  ing project {nam
-00017bd0: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
-00017be0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-00017bf0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-00017c00: 2020 2250 4154 4348 222c 2070 6174 682c    "PATCH", path,
-00017c10: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
-00017c20: 626f 6479 3d64 6963 745f 746f 5f6a 736f  body=dict_to_jso
-00017c30: 6e28 7072 6f6a 6563 7429 2c20 6865 6164  n(project), head
-00017c40: 6572 733d 6865 6164 6572 730a 2020 2020  ers=headers.    
-00017c50: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00017c60: 7475 726e 206d 6c72 756e 2e70 726f 6a65  turn mlrun.proje
-00017c70: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
-00017c80: 2e66 726f 6d5f 6469 6374 2872 6573 706f  .from_dict(respo
-00017c90: 6e73 652e 6a73 6f6e 2829 290a 0a20 2020  nse.json())..   
-00017ca0: 2064 6566 2063 7265 6174 655f 7072 6f6a   def create_proj
-00017cb0: 6563 7428 0a20 2020 2020 2020 2073 656c  ect(.        sel
-00017cc0: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
-00017cd0: 6374 3a20 556e 696f 6e5b 6469 6374 2c20  ct: Union[dict, 
-00017ce0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-00017cf0: 6c72 756e 5072 6f6a 6563 742c 206d 6c72  lrunProject, mlr
-00017d00: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00017d10: 732e 5072 6f6a 6563 745d 2c0a 2020 2020  s.Project],.    
-00017d20: 2920 2d3e 206d 6c72 756e 2e70 726f 6a65  ) -> mlrun.proje
-00017d30: 6374 732e 4d6c 7275 6e50 726f 6a65 6374  cts.MlrunProject
-00017d40: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
-00017d50: 6174 6520 6120 6e65 7720 7072 6f6a 6563  ate a new projec
-00017d60: 742e 2041 2070 726f 6a65 6374 2077 6974  t. A project wit
-00017d70: 6820 7468 6520 7361 6d65 206e 616d 6520  h the same name 
-00017d80: 6d75 7374 206e 6f74 2065 7869 7374 2070  must not exist p
-00017d90: 7269 6f72 2074 6f20 6372 6561 7469 6f6e  rior to creation
-00017da0: 2e22 2222 0a0a 2020 2020 2020 2020 6966  ."""..        if
-00017db0: 2069 7369 6e73 7461 6e63 6528 7072 6f6a   isinstance(proj
-00017dc0: 6563 742c 206d 6c72 756e 2e63 6f6d 6d6f  ect, mlrun.commo
-00017dd0: 6e2e 7363 6865 6d61 732e 5072 6f6a 6563  n.schemas.Projec
-00017de0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
-00017df0: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
-00017e00: 742e 6469 6374 2829 0a20 2020 2020 2020  t.dict().       
-00017e10: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
-00017e20: 2870 726f 6a65 6374 2c20 6d6c 7275 6e2e  (project, mlrun.
-00017e30: 7072 6f6a 6563 7473 2e4d 6c72 756e 5072  projects.MlrunPr
-00017e40: 6f6a 6563 7429 3a0a 2020 2020 2020 2020  oject):.        
-00017e50: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
-00017e60: 6f6a 6563 742e 746f 5f64 6963 7428 290a  oject.to_dict().
-00017e70: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
-00017e80: 6e61 6d65 203d 2070 726f 6a65 6374 5b22  name = project["
-00017e90: 6d65 7461 6461 7461 225d 5b22 6e61 6d65  metadata"]["name
-00017ea0: 225d 0a20 2020 2020 2020 2065 7272 6f72  "].        error
-00017eb0: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
-00017ec0: 6c65 6420 6372 6561 7469 6e67 2070 726f  led creating pro
-00017ed0: 6a65 6374 207b 7072 6f6a 6563 745f 6e61  ject {project_na
-00017ee0: 6d65 7d22 0a20 2020 2020 2020 2072 6573  me}".        res
-00017ef0: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-00017f00: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-00017f10: 2020 2022 504f 5354 222c 0a20 2020 2020     "POST",.     
-00017f20: 2020 2020 2020 2022 7072 6f6a 6563 7473         "projects
-00017f30: 222c 0a20 2020 2020 2020 2020 2020 2065  ",.            e
-00017f40: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
-00017f50: 2020 2020 2020 2020 2020 626f 6479 3d64            body=d
-00017f60: 6963 745f 746f 5f6a 736f 6e28 7072 6f6a  ict_to_json(proj
-00017f70: 6563 7429 2c0a 2020 2020 2020 2020 290a  ect),.        ).
-00017f80: 2020 2020 2020 2020 6966 2072 6573 706f          if respo
-00017f90: 6e73 652e 7374 6174 7573 5f63 6f64 6520  nse.status_code 
-00017fa0: 3d3d 2068 7474 702e 4854 5450 5374 6174  == http.HTTPStat
-00017fb0: 7573 2e41 4343 4550 5445 443a 0a20 2020  us.ACCEPTED:.   
-00017fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00017fd0: 7365 6c66 2e5f 7761 6974 5f66 6f72 5f70  self._wait_for_p
-00017fe0: 726f 6a65 6374 5f74 6f5f 7265 6163 685f  roject_to_reach_
-00017ff0: 7465 726d 696e 616c 5f73 7461 7465 2870  terminal_state(p
-00018000: 726f 6a65 6374 5f6e 616d 6529 0a20 2020  roject_name).   
-00018010: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
-00018020: 6e2e 7072 6f6a 6563 7473 2e4d 6c72 756e  n.projects.Mlrun
-00018030: 5072 6f6a 6563 742e 6672 6f6d 5f64 6963  Project.from_dic
-00018040: 7428 7265 7370 6f6e 7365 2e6a 736f 6e28  t(response.json(
-00018050: 2929 0a0a 2020 2020 6465 6620 5f77 6169  ))..    def _wai
-00018060: 745f 666f 725f 7072 6f6a 6563 745f 746f  t_for_project_to
-00018070: 5f72 6561 6368 5f74 6572 6d69 6e61 6c5f  _reach_terminal_
-00018080: 7374 6174 6528 0a20 2020 2020 2020 2073  state(.        s
-00018090: 656c 662c 2070 726f 6a65 6374 5f6e 616d  elf, project_nam
-000180a0: 653a 2073 7472 0a20 2020 2029 202d 3e20  e: str.    ) -> 
-000180b0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
-000180c0: 6c72 756e 5072 6f6a 6563 743a 0a20 2020  lrunProject:.   
-000180d0: 2020 2020 2064 6566 205f 7665 7269 6679       def _verify
-000180e0: 5f70 726f 6a65 6374 5f69 6e5f 7465 726d  _project_in_term
-000180f0: 696e 616c 5f73 7461 7465 2829 3a0a 2020  inal_state():.  
-00018100: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
-00018110: 7420 3d20 7365 6c66 2e67 6574 5f70 726f  t = self.get_pro
-00018120: 6a65 6374 2870 726f 6a65 6374 5f6e 616d  ject(project_nam
-00018130: 6529 0a20 2020 2020 2020 2020 2020 2069  e).            i
-00018140: 6620 280a 2020 2020 2020 2020 2020 2020  f (.            
-00018150: 2020 2020 7072 6f6a 6563 742e 7374 6174      project.stat
-00018160: 7573 2e73 7461 7465 0a20 2020 2020 2020  us.state.       
-00018170: 2020 2020 2020 2020 206e 6f74 2069 6e20           not in 
-00018180: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00018190: 656d 6173 2e50 726f 6a65 6374 5374 6174  emas.ProjectStat
-000181a0: 652e 7465 726d 696e 616c 5f73 7461 7465  e.terminal_state
-000181b0: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-000181c0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000181d0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000181e0: 6f6e 280a 2020 2020 2020 2020 2020 2020  on(.            
-000181f0: 2020 2020 2020 2020 6622 5072 6f6a 6563          f"Projec
-00018200: 7420 6e6f 7420 696e 2074 6572 6d69 6e61  t not in termina
-00018210: 6c20 7374 6174 652e 2053 7461 7465 3a20  l state. State: 
-00018220: 7b70 726f 6a65 6374 2e73 7461 7475 732e  {project.status.
-00018230: 7374 6174 657d 220a 2020 2020 2020 2020  state}".        
-00018240: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-00018250: 2020 2020 2020 7265 7475 726e 2070 726f        return pro
-00018260: 6a65 6374 0a0a 2020 2020 2020 2020 7265  ject..        re
-00018270: 7475 726e 206d 6c72 756e 2e75 7469 6c73  turn mlrun.utils
-00018280: 2e68 656c 7065 7273 2e72 6574 7279 5f75  .helpers.retry_u
-00018290: 6e74 696c 5f73 7563 6365 7373 6675 6c28  ntil_successful(
-000182a0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-000182b0: 662e 5f77 6169 745f 666f 725f 7072 6f6a  f._wait_for_proj
-000182c0: 6563 745f 7465 726d 696e 616c 5f73 7461  ect_terminal_sta
-000182d0: 7465 5f72 6574 7279 5f69 6e74 6572 7661  te_retry_interva
-000182e0: 6c2c 0a20 2020 2020 2020 2020 2020 2031  l,.            1
-000182f0: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
-00018300: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
-00018310: 2020 2020 4661 6c73 652c 0a20 2020 2020      False,.     
-00018320: 2020 2020 2020 205f 7665 7269 6679 5f70         _verify_p
-00018330: 726f 6a65 6374 5f69 6e5f 7465 726d 696e  roject_in_termin
-00018340: 616c 5f73 7461 7465 2c0a 2020 2020 2020  al_state,.      
-00018350: 2020 290a 0a20 2020 2064 6566 205f 7761    )..    def _wa
-00018360: 6974 5f66 6f72 5f62 6163 6b67 726f 756e  it_for_backgroun
-00018370: 645f 7461 736b 5f74 6f5f 7265 6163 685f  d_task_to_reach_
-00018380: 7465 726d 696e 616c 5f73 7461 7465 280a  terminal_state(.
-00018390: 2020 2020 2020 2020 7365 6c66 2c20 6e61          self, na
-000183a0: 6d65 3a20 7374 720a 2020 2020 2920 2d3e  me: str.    ) ->
-000183b0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-000183c0: 6865 6d61 732e 4261 636b 6772 6f75 6e64  hemas.Background
-000183d0: 5461 736b 3a0a 2020 2020 2020 2020 6465  Task:.        de
-000183e0: 6620 5f76 6572 6966 795f 6261 636b 6772  f _verify_backgr
-000183f0: 6f75 6e64 5f74 6173 6b5f 696e 5f74 6572  ound_task_in_ter
-00018400: 6d69 6e61 6c5f 7374 6174 6528 293a 0a20  minal_state():. 
-00018410: 2020 2020 2020 2020 2020 2062 6163 6b67             backg
-00018420: 726f 756e 645f 7461 736b 203d 2073 656c  round_task = sel
-00018430: 662e 6765 745f 6261 636b 6772 6f75 6e64  f.get_background
-00018440: 5f74 6173 6b28 6e61 6d65 290a 2020 2020  _task(name).    
-00018450: 2020 2020 2020 2020 7374 6174 6520 3d20          state = 
-00018460: 6261 636b 6772 6f75 6e64 5f74 6173 6b2e  background_task.
-00018470: 7374 6174 7573 2e73 7461 7465 0a20 2020  status.state.   
-00018480: 2020 2020 2020 2020 2069 6620 7374 6174           if stat
-00018490: 6520 6e6f 7420 696e 206d 6c72 756e 2e63  e not in mlrun.c
-000184a0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4261  ommon.schemas.Ba
-000184b0: 636b 6772 6f75 6e64 5461 736b 5374 6174  ckgroundTaskStat
-000184c0: 652e 7465 726d 696e 616c 5f73 7461 7465  e.terminal_state
-000184d0: 7328 293a 0a20 2020 2020 2020 2020 2020  s():.           
-000184e0: 2020 2020 2072 6169 7365 2045 7863 6570       raise Excep
-000184f0: 7469 6f6e 280a 2020 2020 2020 2020 2020  tion(.          
-00018500: 2020 2020 2020 2020 2020 6622 4261 636b            f"Back
-00018510: 6772 6f75 6e64 2074 6173 6b20 6e6f 7420  ground task not 
-00018520: 696e 2074 6572 6d69 6e61 6c20 7374 6174  in terminal stat
-00018530: 652e 206e 616d 653d 7b6e 616d 657d 2c20  e. name={name}, 
-00018540: 7374 6174 653d 7b73 7461 7465 7d22 0a20  state={state}". 
-00018550: 2020 2020 2020 2020 2020 2020 2020 2029                 )
-00018560: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00018570: 7572 6e20 6261 636b 6772 6f75 6e64 5f74  urn background_t
-00018580: 6173 6b0a 0a20 2020 2020 2020 2072 6574  ask..        ret
-00018590: 7572 6e20 6d6c 7275 6e2e 7574 696c 732e  urn mlrun.utils.
-000185a0: 6865 6c70 6572 732e 7265 7472 795f 756e  helpers.retry_un
-000185b0: 7469 6c5f 7375 6363 6573 7366 756c 280a  til_successful(.
-000185c0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-000185d0: 2e5f 7761 6974 5f66 6f72 5f62 6163 6b67  ._wait_for_backg
-000185e0: 726f 756e 645f 7461 736b 5f74 6572 6d69  round_task_termi
-000185f0: 6e61 6c5f 7374 6174 655f 7265 7472 795f  nal_state_retry_
-00018600: 696e 7465 7276 616c 2c0a 2020 2020 2020  interval,.      
-00018610: 2020 2020 2020 3630 202a 2036 302c 0a20        60 * 60,. 
-00018620: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-00018630: 722c 0a20 2020 2020 2020 2020 2020 2046  r,.            F
-00018640: 616c 7365 2c0a 2020 2020 2020 2020 2020  alse,.          
-00018650: 2020 5f76 6572 6966 795f 6261 636b 6772    _verify_backgr
-00018660: 6f75 6e64 5f74 6173 6b5f 696e 5f74 6572  ound_task_in_ter
-00018670: 6d69 6e61 6c5f 7374 6174 652c 0a20 2020  minal_state,.   
-00018680: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-00018690: 5f77 6169 745f 666f 725f 7072 6f6a 6563  _wait_for_projec
-000186a0: 745f 746f 5f62 655f 6465 6c65 7465 6428  t_to_be_deleted(
-000186b0: 7365 6c66 2c20 7072 6f6a 6563 745f 6e61  self, project_na
-000186c0: 6d65 3a20 7374 7229 3a0a 2020 2020 2020  me: str):.      
-000186d0: 2020 6465 6620 5f76 6572 6966 795f 7072    def _verify_pr
-000186e0: 6f6a 6563 745f 6465 6c65 7465 6428 293a  oject_deleted():
-000186f0: 0a20 2020 2020 2020 2020 2020 2070 726f  .            pro
-00018700: 6a65 6374 7320 3d20 7365 6c66 2e6c 6973  jects = self.lis
-00018710: 745f 7072 6f6a 6563 7473 280a 2020 2020  t_projects(.    
-00018720: 2020 2020 2020 2020 2020 2020 666f 726d              form
-00018730: 6174 5f3d 6d6c 7275 6e2e 636f 6d6d 6f6e  at_=mlrun.common
-00018740: 2e73 6368 656d 6173 2e50 726f 6a65 6374  .schemas.Project
-00018750: 7346 6f72 6d61 742e 6e61 6d65 5f6f 6e6c  sFormat.name_onl
-00018760: 790a 2020 2020 2020 2020 2020 2020 290a  y.            ).
-00018770: 2020 2020 2020 2020 2020 2020 6966 2070              if p
-00018780: 726f 6a65 6374 5f6e 616d 6520 696e 2070  roject_name in p
-00018790: 726f 6a65 6374 733a 0a20 2020 2020 2020  rojects:.       
-000187a0: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-000187b0: 7863 6570 7469 6f6e 2866 2250 726f 6a65  xception(f"Proje
-000187c0: 6374 207b 7072 6f6a 6563 745f 6e61 6d65  ct {project_name
-000187d0: 7d20 7374 696c 6c20 6578 6973 7473 2229  } still exists")
-000187e0: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
-000187f0: 206d 6c72 756e 2e75 7469 6c73 2e68 656c   mlrun.utils.hel
-00018800: 7065 7273 2e72 6574 7279 5f75 6e74 696c  pers.retry_until
-00018810: 5f73 7563 6365 7373 6675 6c28 0a20 2020  _successful(.   
-00018820: 2020 2020 2020 2020 2073 656c 662e 5f77           self._w
-00018830: 6169 745f 666f 725f 7072 6f6a 6563 745f  ait_for_project_
-00018840: 6465 6c65 7469 6f6e 5f69 6e74 6572 7661  deletion_interva
-00018850: 6c2c 0a20 2020 2020 2020 2020 2020 2031  l,.            1
-00018860: 3230 2c0a 2020 2020 2020 2020 2020 2020  20,.            
-00018870: 6c6f 6767 6572 2c0a 2020 2020 2020 2020  logger,.        
-00018880: 2020 2020 4661 6c73 652c 0a20 2020 2020      False,.     
-00018890: 2020 2020 2020 205f 7665 7269 6679 5f70         _verify_p
-000188a0: 726f 6a65 6374 5f64 656c 6574 6564 2c0a  roject_deleted,.
-000188b0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-000188c0: 6566 2063 7265 6174 655f 7072 6f6a 6563  ef create_projec
-000188d0: 745f 7365 6372 6574 7328 0a20 2020 2020  t_secrets(.     
-000188e0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-000188f0: 2070 726f 6a65 6374 3a20 7374 722c 0a20   project: str,. 
-00018900: 2020 2020 2020 2070 726f 7669 6465 723a         provider:
-00018910: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
-00018920: 2020 2020 7374 722c 206d 6c72 756e 2e63      str, mlrun.c
-00018930: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
-00018940: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
-00018950: 0a20 2020 2020 2020 205d 203d 206d 6c72  .        ] = mlr
-00018960: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00018970: 732e 5365 6372 6574 5072 6f76 6964 6572  s.SecretProvider
-00018980: 4e61 6d65 2e6b 7562 6572 6e65 7465 732c  Name.kubernetes,
-00018990: 0a20 2020 2020 2020 2073 6563 7265 7473  .        secrets
-000189a0: 3a20 6469 6374 203d 204e 6f6e 652c 0a20  : dict = None,. 
-000189b0: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-000189c0: 2243 7265 6174 6520 7072 6f6a 6563 742d  "Create project-
-000189d0: 636f 6e74 6578 7420 7365 6372 6574 7320  context secrets 
-000189e0: 7573 696e 6720 6569 7468 6572 2060 6076  using either ``v
-000189f0: 6175 6c74 6060 206f 7220 6060 6b75 6265  ault`` or ``kube
-00018a00: 726e 6574 6573 6060 2070 726f 7669 6465  rnetes`` provide
-00018a10: 722e 0a20 2020 2020 2020 2057 6865 6e20  r..        When 
-00018a20: 7573 696e 6720 7769 7468 2056 6175 6c74  using with Vault
-00018a30: 2c20 7468 6973 2077 696c 6c20 6372 6561  , this will crea
-00018a40: 7465 206e 6565 6465 6420 5661 756c 7420  te needed Vault 
-00018a50: 7374 7275 6374 7572 6573 2066 6f72 2073  structures for s
-00018a60: 746f 7269 6e67 2073 6563 7265 7473 2069  toring secrets i
-00018a70: 6e20 7072 6f6a 6563 742d 636f 6e74 6578  n project-contex
-00018a80: 742c 2061 6e64 0a20 2020 2020 2020 2073  t, and.        s
-00018a90: 746f 7265 2061 2073 6574 206f 6620 7365  tore a set of se
-00018aa0: 6372 6574 2076 616c 7565 732e 2054 6865  cret values. The
-00018ab0: 206d 6574 686f 6420 6765 6e65 7261 7465   method generate
-00018ac0: 7320 4b75 6265 726e 6574 6573 2073 6572  s Kubernetes ser
-00018ad0: 7669 6365 2d61 6363 6f75 6e74 2061 6e64  vice-account and
-00018ae0: 2074 6865 2056 6175 6c74 2061 7574 6865   the Vault authe
-00018af0: 6e74 6963 6174 696f 6e0a 2020 2020 2020  ntication.      
-00018b00: 2020 7374 7275 6374 7572 6573 2074 6861    structures tha
-00018b10: 7420 6172 6520 7265 7175 6972 6564 2066  t are required f
-00018b20: 6f72 2066 756e 6374 696f 6e20 506f 6473  or function Pods
-00018b30: 2074 6f20 6175 7468 656e 7469 6361 7465   to authenticate
-00018b40: 2077 6974 6820 5661 756c 7420 616e 6420   with Vault and 
-00018b50: 6265 2061 626c 6520 746f 2065 7874 7261  be able to extra
-00018b60: 6374 2073 6563 7265 7420 7661 6c75 6573  ct secret values
-00018b70: 0a20 2020 2020 2020 2070 6173 7365 6420  .        passed 
-00018b80: 6173 2070 6172 7420 6f66 2074 6865 6972  as part of their
-00018b90: 2063 6f6e 7465 7874 2e0a 0a20 2020 2020   context...     
-00018ba0: 2020 204e 6f74 653a 0a20 2020 2020 2020     Note:.       
-00018bb0: 2020 2020 2020 2020 2054 6869 7320 6d65           This me
-00018bc0: 7468 6f64 2075 7365 6420 7769 7468 2056  thod used with V
-00018bd0: 6175 6c74 2069 7320 6375 7272 656e 746c  ault is currentl
-00018be0: 7920 696e 2074 6563 686e 6963 616c 2070  y in technical p
-00018bf0: 7265 7669 6577 2c20 616e 6420 7265 7175  review, and requ
-00018c00: 6972 6573 2061 2048 6173 6869 436f 7270  ires a HashiCorp
-00018c10: 2056 6175 6c74 0a20 2020 2020 2020 2020   Vault.         
-00018c20: 2020 2020 2020 2069 6e66 7261 7374 7275         infrastru
-00018c30: 6374 7572 6520 7072 6f70 6572 6c79 2073  cture properly s
-00018c40: 6574 2075 7020 616e 6420 636f 6e6e 6563  et up and connec
-00018c50: 7465 6420 746f 2074 6865 204d 4c52 756e  ted to the MLRun
-00018c60: 2041 5049 2073 6572 7665 722e 0a0a 2020   API server...  
-00018c70: 2020 2020 2020 5768 656e 2075 7365 6420        When used 
-00018c80: 7769 7468 204b 7562 6572 6e65 7465 732c  with Kubernetes,
-00018c90: 2074 6869 7320 7769 6c6c 206d 616b 6520   this will make 
-00018ca0: 7375 7265 2074 6861 7420 7468 6520 7072  sure that the pr
-00018cb0: 6f6a 6563 742d 7370 6563 6966 6963 206b  oject-specific k
-00018cc0: 3873 2073 6563 7265 7420 6973 2063 7265  8s secret is cre
-00018cd0: 6174 6564 2c20 616e 6420 7769 6c6c 0a20  ated, and will. 
-00018ce0: 2020 2020 2020 2070 6f70 756c 6174 6520         populate 
-00018cf0: 6974 2077 6974 6820 7468 6520 7365 6372  it with the secr
-00018d00: 6574 7320 7072 6f76 6964 6564 2c20 7265  ets provided, re
-00018d10: 706c 6163 696e 6720 7468 6569 7220 7661  placing their va
-00018d20: 6c75 6573 2069 6620 7468 6579 2065 7869  lues if they exi
-00018d30: 7374 2e0a 0a20 2020 2020 2020 203a 7061  st...        :pa
-00018d40: 7261 6d20 7072 6f6a 6563 743a 2054 6865  ram project: The
-00018d50: 2070 726f 6a65 6374 2063 6f6e 7465 7874   project context
-00018d60: 2066 6f72 2077 6869 6368 2074 6f20 6765   for which to ge
-00018d70: 6e65 7261 7465 2074 6865 2069 6e66 7261  nerate the infra
-00018d80: 2061 6e64 2073 746f 7265 2073 6563 7265   and store secre
-00018d90: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
-00018da0: 616d 2070 726f 7669 6465 723a 2054 6865  am provider: The
-00018db0: 206e 616d 6520 6f66 2074 6865 2073 6563   name of the sec
-00018dc0: 7265 7473 2d70 726f 7669 6465 7220 746f  rets-provider to
-00018dd0: 2077 6f72 6b20 7769 7468 2e20 4163 6365   work with. Acce
-00018de0: 7074 7320 610a 2020 2020 2020 2020 2020  pts a.          
-00018df0: 2020 3a70 793a 636c 6173 733a 607e 6d6c    :py:class:`~ml
-00018e00: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00018e10: 6173 2e73 6563 7265 742e 5365 6372 6574  as.secret.Secret
-00018e20: 5072 6f76 6964 6572 4e61 6d65 6020 656e  ProviderName` en
-00018e30: 756d 2e0a 2020 2020 2020 2020 3a70 6172  um..        :par
-00018e40: 616d 2073 6563 7265 7473 3a20 4120 7365  am secrets: A se
-00018e50: 7420 6f66 2073 6563 7265 7420 7661 6c75  t of secret valu
-00018e60: 6573 2074 6f20 7374 6f72 652e 0a20 2020  es to store..   
-00018e70: 2020 2020 2020 2020 2045 7861 6d70 6c65           Example
-00018e80: 3a3a 0a0a 2020 2020 2020 2020 2020 2020  ::..            
-00018e90: 2020 2020 7365 6372 6574 7320 3d20 7b27      secrets = {'
-00018ea0: 7061 7373 776f 7264 273a 2027 6d79 5061  password': 'myPa
-00018eb0: 7373 7730 7264 272c 2027 6177 735f 6b65  ssw0rd', 'aws_ke
-00018ec0: 7927 3a20 2731 3131 3232 3233 3333 277d  y': '111222333'}
-00018ed0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018ee0: 2064 622e 6372 6561 7465 5f70 726f 6a65   db.create_proje
-00018ef0: 6374 5f73 6563 7265 7473 280a 2020 2020  ct_secrets(.    
-00018f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f10: 2270 726f 6a65 6374 3122 2c0a 2020 2020  "project1",.    
-00018f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f30: 7072 6f76 6964 6572 3d6d 6c72 756e 2e63  provider=mlrun.c
-00018f40: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 5365  ommon.schemas.Se
-00018f50: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
-00018f60: 2e6b 7562 6572 6e65 7465 732c 0a20 2020  .kubernetes,.   
-00018f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018f80: 2073 6563 7265 7473 3d73 6563 7265 7473   secrets=secrets
-00018f90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018fa0: 2029 0a20 2020 2020 2020 2022 2222 0a20   ).        """. 
-00018fb0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-00018fc0: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
-00018fd0: 747d 2f73 6563 7265 7473 220a 2020 2020  t}/secrets".    
-00018fe0: 2020 2020 7365 6372 6574 735f 696e 7075      secrets_inpu
-00018ff0: 7420 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  t = mlrun.common
-00019000: 2e73 6368 656d 6173 2e53 6563 7265 7473  .schemas.Secrets
-00019010: 4461 7461 280a 2020 2020 2020 2020 2020  Data(.          
-00019020: 2020 7365 6372 6574 733d 7365 6372 6574    secrets=secret
-00019030: 732c 2070 726f 7669 6465 723d 7072 6f76  s, provider=prov
-00019040: 6964 6572 0a20 2020 2020 2020 2029 0a20  ider.        ). 
-00019050: 2020 2020 2020 2062 6f64 7920 3d20 7365         body = se
-00019060: 6372 6574 735f 696e 7075 742e 6469 6374  crets_input.dict
-00019070: 2829 0a20 2020 2020 2020 2065 7272 6f72  ().        error
-00019080: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
-00019090: 6c65 6420 6372 6561 7469 6e67 2073 6563  led creating sec
-000190a0: 7265 7420 7072 6f76 6964 6572 207b 7072  ret provider {pr
-000190b0: 6f6a 6563 747d 2f7b 7072 6f76 6964 6572  oject}/{provider
-000190c0: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
-000190d0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-000190e0: 2020 2020 2020 2250 4f53 5422 2c0a 2020        "POST",.  
-000190f0: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
-00019100: 2020 2020 2020 2020 2020 2020 6572 726f              erro
-00019110: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
-00019120: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
-00019130: 5f74 6f5f 6a73 6f6e 2862 6f64 7929 2c0a  _to_json(body),.
-00019140: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-00019150: 6566 206c 6973 745f 7072 6f6a 6563 745f  ef list_project_
-00019160: 7365 6372 6574 7328 0a20 2020 2020 2020  secrets(.       
-00019170: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
-00019180: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
-00019190: 2020 2020 2074 6f6b 656e 3a20 7374 7220       token: str 
-000191a0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-000191b0: 7072 6f76 6964 6572 3a20 556e 696f 6e5b  provider: Union[
-000191c0: 0a20 2020 2020 2020 2020 2020 2073 7472  .            str
-000191d0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
-000191e0: 6368 656d 6173 2e53 6563 7265 7450 726f  chemas.SecretPro
-000191f0: 7669 6465 724e 616d 650a 2020 2020 2020  viderName.      
-00019200: 2020 5d20 3d20 6d6c 7275 6e2e 636f 6d6d    ] = mlrun.comm
-00019210: 6f6e 2e73 6368 656d 6173 2e53 6563 7265  on.schemas.Secre
-00019220: 7450 726f 7669 6465 724e 616d 652e 6b75  tProviderName.ku
-00019230: 6265 726e 6574 6573 2c0a 2020 2020 2020  bernetes,.      
-00019240: 2020 7365 6372 6574 733a 204c 6973 745b    secrets: List[
-00019250: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-00019260: 2029 202d 3e20 6d6c 7275 6e2e 636f 6d6d   ) -> mlrun.comm
-00019270: 6f6e 2e73 6368 656d 6173 2e53 6563 7265  on.schemas.Secre
-00019280: 7473 4461 7461 3a0a 2020 2020 2020 2020  tsData:.        
-00019290: 2222 2252 6574 7269 6576 6520 7072 6f6a  """Retrieve proj
-000192a0: 6563 742d 636f 6e74 6578 7420 7365 6372  ect-context secr
-000192b0: 6574 7320 6672 6f6d 2056 6175 6c74 2e0a  ets from Vault..
-000192c0: 0a20 2020 2020 2020 204e 6f74 653a 0a20  .        Note:. 
-000192d0: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-000192e0: 6869 7320 6d65 7468 6f64 2066 6f72 2056  his method for V
-000192f0: 6175 6c74 2066 756e 6374 696f 6e61 6c69  ault functionali
-00019300: 7479 2069 7320 6375 7272 656e 746c 7920  ty is currently 
-00019310: 696e 2074 6563 686e 6963 616c 2070 7265  in technical pre
-00019320: 7669 6577 2c20 616e 6420 7265 7175 6972  view, and requir
-00019330: 6573 2061 2048 6173 6869 436f 7270 2056  es a HashiCorp V
-00019340: 6175 6c74 0a20 2020 2020 2020 2020 2020  ault.           
-00019350: 2020 2020 2069 6e66 7261 7374 7275 6374       infrastruct
-00019360: 7572 6520 7072 6f70 6572 6c79 2073 6574  ure properly set
-00019370: 2075 7020 616e 6420 636f 6e6e 6563 7465   up and connecte
-00019380: 6420 746f 2074 6865 204d 4c52 756e 2041  d to the MLRun A
-00019390: 5049 2073 6572 7665 722e 0a0a 2020 2020  PI server...    
-000193a0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
-000193b0: 6374 3a20 5468 6520 7072 6f6a 6563 7420  ct: The project 
-000193c0: 6e61 6d65 2e0a 2020 2020 2020 2020 3a70  name..        :p
-000193d0: 6172 616d 2074 6f6b 656e 3a20 5661 756c  aram token: Vaul
-000193e0: 7420 746f 6b65 6e20 746f 2075 7365 2066  t token to use f
-000193f0: 6f72 2072 6574 7269 6576 696e 6720 7365  or retrieving se
-00019400: 6372 6574 732e 0a20 2020 2020 2020 2020  crets..         
-00019410: 2020 204d 7573 7420 6265 2061 2076 616c     Must be a val
-00019420: 6964 2056 6175 6c74 2074 6f6b 656e 2c20  id Vault token, 
-00019430: 7769 7468 2070 6572 6d69 7373 696f 6e73  with permissions
-00019440: 2074 6f20 7265 7472 6965 7665 2073 6563   to retrieve sec
-00019450: 7265 7473 206f 6620 7468 6520 7072 6f6a  rets of the proj
-00019460: 6563 7420 696e 2071 7565 7374 696f 6e2e  ect in question.
-00019470: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
-00019480: 7072 6f76 6964 6572 3a20 5468 6520 6e61  provider: The na
-00019490: 6d65 206f 6620 7468 6520 7365 6372 6574  me of the secret
-000194a0: 732d 7072 6f76 6964 6572 2074 6f20 776f  s-provider to wo
-000194b0: 726b 2077 6974 682e 2043 7572 7265 6e74  rk with. Current
-000194c0: 6c79 206f 6e6c 7920 6060 7661 756c 7460  ly only ``vault`
-000194d0: 6020 6973 2061 6363 6570 7465 642e 0a20  ` is accepted.. 
-000194e0: 2020 2020 2020 203a 7061 7261 6d20 7365         :param se
-000194f0: 6372 6574 733a 2041 206c 6973 7420 6f66  crets: A list of
-00019500: 2073 6563 7265 7420 6e61 6d65 7320 746f   secret names to
-00019510: 2072 6574 7269 6576 652e 2041 6e20 656d   retrieve. An em
-00019520: 7074 7920 6c69 7374 2060 605b 5d60 6020  pty list ``[]`` 
-00019530: 7769 6c6c 2072 6574 7269 6576 6520 616c  will retrieve al
-00019540: 6c20 7365 6372 6574 7320 6173 7369 676e  l secrets assign
-00019550: 6564 0a20 2020 2020 2020 2020 2020 2074  ed.            t
-00019560: 6f20 7468 6973 2073 7065 6369 6669 6320  o this specific 
-00019570: 7072 6f6a 6563 742e 2060 606b 7562 6572  project. ``kuber
-00019580: 6e65 7465 7360 6020 7072 6f76 6964 6572  netes`` provider
-00019590: 206f 6e6c 7920 7375 7070 6f72 7473 2061   only supports a
-000195a0: 6e20 656d 7074 7920 6c69 7374 2e0a 2020  n empty list..  
-000195b0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-000195c0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-000195d0: 2020 2020 7072 6f76 6964 6572 203d 3d20      provider == 
-000195e0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-000195f0: 656d 6173 2e53 6563 7265 7450 726f 7669  emas.SecretProvi
-00019600: 6465 724e 616d 652e 7661 756c 742e 7661  derName.vault.va
-00019610: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-00019620: 616e 6420 6e6f 7420 746f 6b65 6e0a 2020  and not token.  
-00019630: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00019640: 2020 2020 2072 6169 7365 204d 4c52 756e       raise MLRun
-00019650: 496e 7661 6c69 6441 7267 756d 656e 7445  InvalidArgumentE
-00019660: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00019670: 2020 2020 2020 2241 2076 6175 6c74 2074        "A vault t
-00019680: 6f6b 656e 206d 7573 7420 6265 2070 726f  oken must be pro
-00019690: 7669 6465 6420 7768 656e 2061 6363 6573  vided when acces
-000196a0: 7369 6e67 2076 6175 6c74 2073 6563 7265  sing vault secre
-000196b0: 7473 220a 2020 2020 2020 2020 2020 2020  ts".            
-000196c0: 290a 0a20 2020 2020 2020 2070 6174 6820  )..        path 
-000196d0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-000196e0: 6f6a 6563 747d 2f73 6563 7265 7473 220a  oject}/secrets".
-000196f0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-00019700: 207b 2270 726f 7669 6465 7222 3a20 7072   {"provider": pr
-00019710: 6f76 6964 6572 2c20 2273 6563 7265 7422  ovider, "secret"
-00019720: 3a20 7365 6372 6574 737d 0a20 2020 2020  : secrets}.     
-00019730: 2020 2068 6561 6465 7273 203d 207b 6d6c     headers = {ml
-00019740: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
-00019750: 6173 2e48 6561 6465 724e 616d 6573 2e73  as.HeaderNames.s
-00019760: 6563 7265 745f 7374 6f72 655f 746f 6b65  ecret_store_toke
-00019770: 6e3a 2074 6f6b 656e 7d0a 2020 2020 2020  n: token}.      
-00019780: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
-00019790: 3d20 6622 4661 696c 6564 2072 6574 7269  = f"Failed retri
-000197a0: 6576 696e 6720 7365 6372 6574 7320 7b70  eving secrets {p
-000197b0: 726f 6a65 6374 7d2f 7b70 726f 7669 6465  roject}/{provide
-000197c0: 727d 220a 2020 2020 2020 2020 7265 7375  r}".        resu
-000197d0: 6c74 203d 2073 656c 662e 6170 695f 6361  lt = self.api_ca
-000197e0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
-000197f0: 2247 4554 222c 0a20 2020 2020 2020 2020  "GET",.         
-00019800: 2020 2070 6174 682c 0a20 2020 2020 2020     path,.       
-00019810: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
-00019820: 6765 2c0a 2020 2020 2020 2020 2020 2020  ge,.            
-00019830: 7061 7261 6d73 3d70 6172 616d 732c 0a20  params=params,. 
-00019840: 2020 2020 2020 2020 2020 2068 6561 6465             heade
-00019850: 7273 3d68 6561 6465 7273 2c0a 2020 2020  rs=headers,.    
-00019860: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
-00019870: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
-00019880: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
-00019890: 7344 6174 6128 2a2a 7265 7375 6c74 2e6a  sData(**result.j
-000198a0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
-000198b0: 6c69 7374 5f70 726f 6a65 6374 5f73 6563  list_project_sec
-000198c0: 7265 745f 6b65 7973 280a 2020 2020 2020  ret_keys(.      
-000198d0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-000198e0: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
-000198f0: 2020 2020 2020 7072 6f76 6964 6572 3a20        provider: 
-00019900: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
-00019910: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
-00019920: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
-00019930: 7265 7450 726f 7669 6465 724e 616d 650a  retProviderName.
-00019940: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
-00019950: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-00019960: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
-00019970: 616d 652e 6b75 6265 726e 6574 6573 2c0a  ame.kubernetes,.
-00019980: 2020 2020 2020 2020 746f 6b65 6e3a 2073          token: s
-00019990: 7472 203d 204e 6f6e 652c 0a20 2020 2029  tr = None,.    )
-000199a0: 202d 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e   -> mlrun.common
-000199b0: 2e73 6368 656d 6173 2e53 6563 7265 744b  .schemas.SecretK
-000199c0: 6579 7344 6174 613a 0a20 2020 2020 2020  eysData:.       
-000199d0: 2022 2222 5265 7472 6965 7665 2070 726f   """Retrieve pro
-000199e0: 6a65 6374 2d63 6f6e 7465 7874 2073 6563  ject-context sec
-000199f0: 7265 7420 6b65 7973 2066 726f 6d20 5661  ret keys from Va
-00019a00: 756c 7420 6f72 204b 7562 6572 6e65 7465  ult or Kubernete
-00019a10: 732e 0a0a 2020 2020 2020 2020 4e6f 7465  s...        Note
-00019a20: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019a30: 2020 5468 6973 206d 6574 686f 6420 666f    This method fo
-00019a40: 7220 5661 756c 7420 6675 6e63 7469 6f6e  r Vault function
-00019a50: 616c 6974 7920 6973 2063 7572 7265 6e74  ality is current
-00019a60: 6c79 2069 6e20 7465 6368 6e69 6361 6c20  ly in technical 
-00019a70: 7072 6576 6965 772c 2061 6e64 2072 6571  preview, and req
-00019a80: 7569 7265 7320 6120 4861 7368 6943 6f72  uires a HashiCor
-00019a90: 7020 5661 756c 740a 2020 2020 2020 2020  p Vault.        
-00019aa0: 2020 2020 2020 2020 696e 6672 6173 7472          infrastr
-00019ab0: 7563 7475 7265 2070 726f 7065 726c 7920  ucture properly 
-00019ac0: 7365 7420 7570 2061 6e64 2063 6f6e 6e65  set up and conne
-00019ad0: 6374 6564 2074 6f20 7468 6520 4d4c 5275  cted to the MLRu
-00019ae0: 6e20 4150 4920 7365 7276 6572 2e0a 0a20  n API server... 
-00019af0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
-00019b00: 6f6a 6563 743a 2054 6865 2070 726f 6a65  oject: The proje
-00019b10: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
-00019b20: 203a 7061 7261 6d20 7072 6f76 6964 6572   :param provider
-00019b30: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
-00019b40: 6520 7365 6372 6574 732d 7072 6f76 6964  e secrets-provid
-00019b50: 6572 2074 6f20 776f 726b 2077 6974 682e  er to work with.
-00019b60: 2041 6363 6570 7473 2061 0a20 2020 2020   Accepts a.     
-00019b70: 2020 2020 2020 203a 7079 3a63 6c61 7373         :py:class
-00019b80: 3a60 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e  :`~mlrun.common.
-00019b90: 7363 6865 6d61 732e 7365 6372 6574 2e53  schemas.secret.S
-00019ba0: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
-00019bb0: 6560 2065 6e75 6d2e 0a20 2020 2020 2020  e` enum..       
-00019bc0: 203a 7061 7261 6d20 746f 6b65 6e3a 2056   :param token: V
-00019bd0: 6175 6c74 2074 6f6b 656e 2074 6f20 7573  ault token to us
-00019be0: 6520 666f 7220 7265 7472 6965 7669 6e67  e for retrieving
-00019bf0: 2073 6563 7265 7473 2e20 4f6e 6c79 2069   secrets. Only i
-00019c00: 6e20 7573 6520 6966 2060 6070 726f 7669  n use if ``provi
-00019c10: 6465 7260 6020 6973 2060 6076 6175 6c74  der`` is ``vault
-00019c20: 6060 2e0a 2020 2020 2020 2020 2020 2020  ``..            
-00019c30: 4d75 7374 2062 6520 6120 7661 6c69 6420  Must be a valid 
-00019c40: 5661 756c 7420 746f 6b65 6e2c 2077 6974  Vault token, wit
-00019c50: 6820 7065 726d 6973 7369 6f6e 7320 746f  h permissions to
-00019c60: 2072 6574 7269 6576 6520 7365 6372 6574   retrieve secret
-00019c70: 7320 6f66 2074 6865 2070 726f 6a65 6374  s of the project
-00019c80: 2069 6e20 7175 6573 7469 6f6e 2e0a 2020   in question..  
-00019c90: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
-00019ca0: 2020 2069 6620 280a 2020 2020 2020 2020     if (.        
-00019cb0: 2020 2020 7072 6f76 6964 6572 203d 3d20      provider == 
-00019cc0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-00019cd0: 656d 6173 2e53 6563 7265 7450 726f 7669  emas.SecretProvi
-00019ce0: 6465 724e 616d 652e 7661 756c 742e 7661  derName.vault.va
-00019cf0: 6c75 650a 2020 2020 2020 2020 2020 2020  lue.            
-00019d00: 616e 6420 6e6f 7420 746f 6b65 6e0a 2020  and not token.  
-00019d10: 2020 2020 2020 293a 0a20 2020 2020 2020        ):.       
-00019d20: 2020 2020 2072 6169 7365 204d 4c52 756e       raise MLRun
-00019d30: 496e 7661 6c69 6441 7267 756d 656e 7445  InvalidArgumentE
-00019d40: 7272 6f72 280a 2020 2020 2020 2020 2020  rror(.          
-00019d50: 2020 2020 2020 2241 2076 6175 6c74 2074        "A vault t
-00019d60: 6f6b 656e 206d 7573 7420 6265 2070 726f  oken must be pro
-00019d70: 7669 6465 6420 7768 656e 2061 6363 6573  vided when acces
-00019d80: 7369 6e67 2076 6175 6c74 2073 6563 7265  sing vault secre
-00019d90: 7473 220a 2020 2020 2020 2020 2020 2020  ts".            
-00019da0: 290a 0a20 2020 2020 2020 2070 6174 6820  )..        path 
-00019db0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-00019dc0: 6f6a 6563 747d 2f73 6563 7265 742d 6b65  oject}/secret-ke
-00019dd0: 7973 220a 2020 2020 2020 2020 7061 7261  ys".        para
-00019de0: 6d73 203d 207b 2270 726f 7669 6465 7222  ms = {"provider"
-00019df0: 3a20 7072 6f76 6964 6572 7d0a 2020 2020  : provider}.    
-00019e00: 2020 2020 6865 6164 6572 7320 3d20 280a      headers = (.
-00019e10: 2020 2020 2020 2020 2020 2020 7b6d 6c72              {mlr
-00019e20: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-00019e30: 732e 4865 6164 6572 4e61 6d65 732e 7365  s.HeaderNames.se
-00019e40: 6372 6574 5f73 746f 7265 5f74 6f6b 656e  cret_store_token
-00019e50: 3a20 746f 6b65 6e7d 0a20 2020 2020 2020  : token}.       
-00019e60: 2020 2020 2069 6620 7072 6f76 6964 6572       if provider
-00019e70: 203d 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e   == mlrun.common
-00019e80: 2e73 6368 656d 6173 2e53 6563 7265 7450  .schemas.SecretP
-00019e90: 726f 7669 6465 724e 616d 652e 7661 756c  roviderName.vaul
-00019ea0: 742e 7661 6c75 650a 2020 2020 2020 2020  t.value.        
-00019eb0: 2020 2020 656c 7365 204e 6f6e 650a 2020      else None.  
-00019ec0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00019ed0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
-00019ee0: 6622 4661 696c 6564 2072 6574 7269 6576  f"Failed retriev
-00019ef0: 696e 6720 7365 6372 6574 206b 6579 7320  ing secret keys 
-00019f00: 7b70 726f 6a65 6374 7d2f 7b70 726f 7669  {project}/{provi
-00019f10: 6465 727d 220a 2020 2020 2020 2020 7265  der}".        re
-00019f20: 7375 6c74 203d 2073 656c 662e 6170 695f  sult = self.api_
-00019f30: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-00019f40: 2020 2247 4554 222c 0a20 2020 2020 2020    "GET",.       
-00019f50: 2020 2020 2070 6174 682c 0a20 2020 2020       path,.     
-00019f60: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-00019f70: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
-00019f80: 2020 7061 7261 6d73 3d70 6172 616d 732c    params=params,
-00019f90: 0a20 2020 2020 2020 2020 2020 2068 6561  .            hea
-00019fa0: 6465 7273 3d68 6561 6465 7273 2c0a 2020  ders=headers,.  
-00019fb0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
-00019fc0: 7265 7475 726e 206d 6c72 756e 2e63 6f6d  return mlrun.com
-00019fd0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
-00019fe0: 6574 4b65 7973 4461 7461 282a 2a72 6573  etKeysData(**res
-00019ff0: 756c 742e 6a73 6f6e 2829 290a 0a20 2020  ult.json())..   
-0001a000: 2064 6566 2064 656c 6574 655f 7072 6f6a   def delete_proj
-0001a010: 6563 745f 7365 6372 6574 7328 0a20 2020  ect_secrets(.   
-0001a020: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
-0001a030: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
-0001a040: 0a20 2020 2020 2020 2070 726f 7669 6465  .        provide
-0001a050: 723a 2055 6e69 6f6e 5b0a 2020 2020 2020  r: Union[.      
-0001a060: 2020 2020 2020 7374 722c 206d 6c72 756e        str, mlrun
-0001a070: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0001a080: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
-0001a090: 6d65 0a20 2020 2020 2020 205d 203d 206d  me.        ] = m
-0001a0a0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001a0b0: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
-0001a0c0: 6572 4e61 6d65 2e6b 7562 6572 6e65 7465  erName.kubernete
-0001a0d0: 732c 0a20 2020 2020 2020 2073 6563 7265  s,.        secre
-0001a0e0: 7473 3a20 4c69 7374 5b73 7472 5d20 3d20  ts: List[str] = 
-0001a0f0: 4e6f 6e65 2c0a 2020 2020 293a 0a20 2020  None,.    ):.   
-0001a100: 2020 2020 2022 2222 4465 6c65 7465 2070       """Delete p
-0001a110: 726f 6a65 6374 2d63 6f6e 7465 7874 2073  roject-context s
-0001a120: 6563 7265 7473 2066 726f 6d20 4b75 6265  ecrets from Kube
-0001a130: 726e 6574 6573 2e0a 0a20 2020 2020 2020  rnetes...       
-0001a140: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
-0001a150: 2054 6865 2070 726f 6a65 6374 206e 616d   The project nam
-0001a160: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
-0001a170: 6d20 7072 6f76 6964 6572 3a20 5468 6520  m provider: The 
-0001a180: 6e61 6d65 206f 6620 7468 6520 7365 6372  name of the secr
-0001a190: 6574 732d 7072 6f76 6964 6572 2074 6f20  ets-provider to 
-0001a1a0: 776f 726b 2077 6974 682e 2043 7572 7265  work with. Curre
-0001a1b0: 6e74 6c79 206f 6e6c 7920 6060 6b75 6265  ntly only ``kube
-0001a1c0: 726e 6574 6573 6060 2069 7320 7375 7070  rnetes`` is supp
-0001a1d0: 6f72 7465 642e 0a20 2020 2020 2020 203a  orted..        :
-0001a1e0: 7061 7261 6d20 7365 6372 6574 733a 2041  param secrets: A
-0001a1f0: 206c 6973 7420 6f66 2073 6563 7265 7420   list of secret 
-0001a200: 6e61 6d65 7320 746f 2064 656c 6574 652e  names to delete.
-0001a210: 2041 6e20 656d 7074 7920 6c69 7374 2077   An empty list w
-0001a220: 696c 6c20 6465 6c65 7465 2061 6c6c 2073  ill delete all s
-0001a230: 6563 7265 7473 2061 7373 6967 6e65 640a  ecrets assigned.
-0001a240: 2020 2020 2020 2020 2020 2020 746f 2074              to t
-0001a250: 6869 7320 7370 6563 6966 6963 2070 726f  his specific pro
-0001a260: 6a65 6374 2e0a 2020 2020 2020 2020 2222  ject..        ""
-0001a270: 220a 0a20 2020 2020 2020 2070 6174 6820  "..        path 
-0001a280: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0001a290: 6f6a 6563 747d 2f73 6563 7265 7473 220a  oject}/secrets".
-0001a2a0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0001a2b0: 207b 2270 726f 7669 6465 7222 3a20 7072   {"provider": pr
-0001a2c0: 6f76 6964 6572 2c20 2273 6563 7265 7422  ovider, "secret"
-0001a2d0: 3a20 7365 6372 6574 737d 0a20 2020 2020  : secrets}.     
-0001a2e0: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
-0001a2f0: 203d 2066 2246 6169 6c65 6420 6465 6c65   = f"Failed dele
-0001a300: 7469 6e67 2073 6563 7265 7473 207b 7072  ting secrets {pr
-0001a310: 6f6a 6563 747d 2f7b 7072 6f76 6964 6572  oject}/{provider
-0001a320: 7d22 0a20 2020 2020 2020 2073 656c 662e  }".        self.
-0001a330: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
-0001a340: 2020 2020 2020 2244 454c 4554 4522 2c0a        "DELETE",.
-0001a350: 2020 2020 2020 2020 2020 2020 7061 7468              path
-0001a360: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
-0001a370: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
-0001a380: 2020 2020 2020 2020 2070 6172 616d 733d           params=
-0001a390: 7061 7261 6d73 2c0a 2020 2020 2020 2020  params,.        
-0001a3a0: 290a 0a20 2020 2064 6566 2063 7265 6174  )..    def creat
-0001a3b0: 655f 7573 6572 5f73 6563 7265 7473 280a  e_user_secrets(.
-0001a3c0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
-0001a3d0: 2020 2020 2020 7573 6572 3a20 7374 722c        user: str,
-0001a3e0: 0a20 2020 2020 2020 2070 726f 7669 6465  .        provide
-0001a3f0: 723a 2055 6e69 6f6e 5b0a 2020 2020 2020  r: Union[.      
-0001a400: 2020 2020 2020 7374 722c 206d 6c72 756e        str, mlrun
-0001a410: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
-0001a420: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
-0001a430: 6d65 0a20 2020 2020 2020 205d 203d 206d  me.        ] = m
-0001a440: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001a450: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
-0001a460: 6572 4e61 6d65 2e76 6175 6c74 2c0a 2020  erName.vault,.  
-0001a470: 2020 2020 2020 7365 6372 6574 733a 2064        secrets: d
-0001a480: 6963 7420 3d20 4e6f 6e65 2c0a 2020 2020  ict = None,.    
-0001a490: 293a 0a20 2020 2020 2020 2022 2222 4372  ):.        """Cr
-0001a4a0: 6561 7465 2075 7365 722d 636f 6e74 6578  eate user-contex
-0001a4b0: 7420 7365 6372 6574 2069 6e20 5661 756c  t secret in Vaul
-0001a4c0: 742e 2050 6c65 6173 6520 7265 6665 7220  t. Please refer 
-0001a4d0: 746f 203a 7079 3a66 756e 633a 6063 7265  to :py:func:`cre
-0001a4e0: 6174 655f 7072 6f6a 6563 745f 7365 6372  ate_project_secr
-0001a4f0: 6574 7360 2066 6f72 206d 6f72 6520 6465  ets` for more de
-0001a500: 7461 696c 730a 2020 2020 2020 2020 616e  tails.        an
-0001a510: 6420 7374 6174 7573 206f 6620 7468 6973  d status of this
-0001a520: 2066 756e 6374 696f 6e61 6c69 7479 2e0a   functionality..
-0001a530: 0a20 2020 2020 2020 204e 6f74 653a 0a20  .        Note:. 
-0001a540: 2020 2020 2020 2020 2020 2020 2020 2054                 T
-0001a550: 6869 7320 6d65 7468 6f64 2069 7320 6375  his method is cu
-0001a560: 7272 656e 746c 7920 696e 2074 6563 686e  rrently in techn
-0001a570: 6963 616c 2070 7265 7669 6577 2c20 616e  ical preview, an
-0001a580: 6420 7265 7175 6972 6573 2061 2048 6173  d requires a Has
-0001a590: 6869 436f 7270 2056 6175 6c74 2069 6e66  hiCorp Vault inf
-0001a5a0: 7261 7374 7275 6374 7572 650a 2020 2020  rastructure.    
-0001a5b0: 2020 2020 2020 2020 2020 2020 7072 6f70              prop
-0001a5c0: 6572 6c79 2073 6574 2075 7020 616e 6420  erly set up and 
-0001a5d0: 636f 6e6e 6563 7465 6420 746f 2074 6865  connected to the
-0001a5e0: 204d 4c52 756e 2041 5049 2073 6572 7665   MLRun API serve
-0001a5f0: 722e 0a0a 2020 2020 2020 2020 3a70 6172  r...        :par
-0001a600: 616d 2075 7365 723a 2054 6865 2075 7365  am user: The use
-0001a610: 7220 636f 6e74 6578 7420 666f 7220 7768  r context for wh
-0001a620: 6963 6820 746f 2067 656e 6572 6174 6520  ich to generate 
-0001a630: 7468 6520 696e 6672 6120 616e 6420 7374  the infra and st
-0001a640: 6f72 6520 7365 6372 6574 732e 0a20 2020  ore secrets..   
-0001a650: 2020 2020 203a 7061 7261 6d20 7072 6f76       :param prov
-0001a660: 6964 6572 3a20 5468 6520 6e61 6d65 206f  ider: The name o
-0001a670: 6620 7468 6520 7365 6372 6574 732d 7072  f the secrets-pr
-0001a680: 6f76 6964 6572 2074 6f20 776f 726b 2077  ovider to work w
-0001a690: 6974 682e 2043 7572 7265 6e74 6c79 206f  ith. Currently o
-0001a6a0: 6e6c 7920 6060 7661 756c 7460 6020 6973  nly ``vault`` is
-0001a6b0: 2073 7570 706f 7274 6564 2e0a 2020 2020   supported..    
-0001a6c0: 2020 2020 3a70 6172 616d 2073 6563 7265      :param secre
-0001a6d0: 7473 3a20 4120 7365 7420 6f66 2073 6563  ts: A set of sec
-0001a6e0: 7265 7420 7661 6c75 6573 2074 6f20 7374  ret values to st
-0001a6f0: 6f72 6520 7769 7468 696e 2074 6865 2056  ore within the V
-0001a700: 6175 6c74 2e0a 2020 2020 2020 2020 2222  ault..        ""
-0001a710: 220a 2020 2020 2020 2020 7061 7468 203d  ".        path =
-0001a720: 2022 7573 6572 2d73 6563 7265 7473 220a   "user-secrets".
-0001a730: 2020 2020 2020 2020 7365 6372 6574 735f          secrets_
-0001a740: 6372 6561 7469 6f6e 5f72 6571 7565 7374  creation_request
-0001a750: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
-0001a760: 7363 6865 6d61 732e 5573 6572 5365 6372  schemas.UserSecr
-0001a770: 6574 4372 6561 7469 6f6e 5265 7175 6573  etCreationReques
-0001a780: 7428 0a20 2020 2020 2020 2020 2020 2075  t(.            u
-0001a790: 7365 723d 7573 6572 2c0a 2020 2020 2020  ser=user,.      
-0001a7a0: 2020 2020 2020 7072 6f76 6964 6572 3d70        provider=p
-0001a7b0: 726f 7669 6465 722c 0a20 2020 2020 2020  rovider,.       
-0001a7c0: 2020 2020 2073 6563 7265 7473 3d73 6563       secrets=sec
-0001a7d0: 7265 7473 2c0a 2020 2020 2020 2020 290a  rets,.        ).
-0001a7e0: 2020 2020 2020 2020 626f 6479 203d 2073          body = s
-0001a7f0: 6563 7265 7473 5f63 7265 6174 696f 6e5f  ecrets_creation_
-0001a800: 7265 7175 6573 742e 6469 6374 2829 0a20  request.dict(). 
-0001a810: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
-0001a820: 7361 6765 203d 2066 2246 6169 6c65 6420  sage = f"Failed 
-0001a830: 6372 6561 7469 6e67 2075 7365 7220 7365  creating user se
-0001a840: 6372 6574 7320 2d20 7b75 7365 727d 220a  crets - {user}".
-0001a850: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
-0001a860: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
-0001a870: 2020 2022 504f 5354 222c 0a20 2020 2020     "POST",.     
-0001a880: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
-0001a890: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
-0001a8a0: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
-0001a8b0: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
-0001a8c0: 5f6a 736f 6e28 626f 6479 292c 0a20 2020  _json(body),.   
-0001a8d0: 2020 2020 2029 0a0a 2020 2020 4073 7461       )..    @sta
-0001a8e0: 7469 636d 6574 686f 640a 2020 2020 6465  ticmethod.    de
-0001a8f0: 6620 5f76 616c 6964 6174 655f 7665 7273  f _validate_vers
-0001a900: 696f 6e5f 636f 6d70 6174 6962 696c 6974  ion_compatibilit
-0001a910: 7928 7365 7276 6572 5f76 6572 7369 6f6e  y(server_version
-0001a920: 2c20 636c 6965 6e74 5f76 6572 7369 6f6e  , client_version
-0001a930: 2920 2d3e 2062 6f6f 6c3a 0a20 2020 2020  ) -> bool:.     
-0001a940: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
-0001a950: 2020 2020 7061 7273 6564 5f73 6572 7665      parsed_serve
-0001a960: 725f 7665 7273 696f 6e20 3d20 7365 6d76  r_version = semv
-0001a970: 6572 2e56 6572 7369 6f6e 496e 666f 2e70  er.VersionInfo.p
-0001a980: 6172 7365 2873 6572 7665 725f 7665 7273  arse(server_vers
-0001a990: 696f 6e29 0a20 2020 2020 2020 2020 2020  ion).           
-0001a9a0: 2070 6172 7365 645f 636c 6965 6e74 5f76   parsed_client_v
-0001a9b0: 6572 7369 6f6e 203d 2073 656d 7665 722e  ersion = semver.
-0001a9c0: 5665 7273 696f 6e49 6e66 6f2e 7061 7273  VersionInfo.pars
-0001a9d0: 6528 636c 6965 6e74 5f76 6572 7369 6f6e  e(client_version
-0001a9e0: 290a 2020 2020 2020 2020 6578 6365 7074  ).        except
-0001a9f0: 2056 616c 7565 4572 726f 723a 0a20 2020   ValueError:.   
-0001aa00: 2020 2020 2020 2020 2023 2054 6869 7320           # This 
-0001aa10: 7769 6c6c 206d 6f73 746c 7920 6861 7070  will mostly happ
-0001aa20: 656e 2069 6e20 6465 7620 7363 656e 6172  en in dev scenar
-0001aa30: 696f 7320 7768 656e 2074 6865 2076 6572  ios when the ver
-0001aa40: 7369 6f6e 2069 7320 756e 7374 6162 6c65  sion is unstable
-0001aa50: 2061 6e64 2073 7563 6820 2d20 7468 6572   and such - ther
-0001aa60: 6566 6f72 6520 7765 2772 6520 6967 6e6f  efore we're igno
-0001aa70: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
-0001aa80: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
-0001aa90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aaa0: 2022 556e 6162 6c65 2074 6f20 7061 7273   "Unable to pars
-0001aab0: 6520 7365 7276 6572 206f 7220 636c 6965  e server or clie
-0001aac0: 6e74 2076 6572 7369 6f6e 2e20 4173 7375  nt version. Assu
-0001aad0: 6d69 6e67 2063 6f6d 7061 7469 626c 6522  ming compatible"
-0001aae0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001aaf0: 2020 7365 7276 6572 5f76 6572 7369 6f6e    server_version
-0001ab00: 3d73 6572 7665 725f 7665 7273 696f 6e2c  =server_version,
-0001ab10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001ab20: 2063 6c69 656e 745f 7665 7273 696f 6e3d   client_version=
-0001ab30: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
-0001ab40: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
-0001ab50: 2020 2020 2020 2020 2020 7265 7475 726e            return
-0001ab60: 2054 7275 650a 2020 2020 2020 2020 6966   True.        if
-0001ab70: 2028 7061 7273 6564 5f73 6572 7665 725f   (parsed_server_
-0001ab80: 7665 7273 696f 6e2e 6d61 6a6f 7220 3d3d  version.major ==
-0001ab90: 2030 2061 6e64 2070 6172 7365 645f 7365   0 and parsed_se
-0001aba0: 7276 6572 5f76 6572 7369 6f6e 2e6d 696e  rver_version.min
-0001abb0: 6f72 203d 3d20 3029 206f 7220 280a 2020  or == 0) or (.  
-0001abc0: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
-0001abd0: 5f63 6c69 656e 745f 7665 7273 696f 6e2e  _client_version.
-0001abe0: 6d61 6a6f 7220 3d3d 2030 2061 6e64 2070  major == 0 and p
-0001abf0: 6172 7365 645f 636c 6965 6e74 5f76 6572  arsed_client_ver
-0001ac00: 7369 6f6e 2e6d 696e 6f72 203d 3d20 300a  sion.minor == 0.
-0001ac10: 2020 2020 2020 2020 293a 0a20 2020 2020          ):.     
-0001ac20: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
-0001ac30: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
-0001ac40: 2020 2020 2020 2022 5365 7276 6572 206f         "Server o
-0001ac50: 7220 636c 6965 6e74 2076 6572 7369 6f6e  r client version
-0001ac60: 2069 7320 756e 7374 6162 6c65 2e20 4173   is unstable. As
-0001ac70: 7375 6d69 6e67 2063 6f6d 7061 7469 626c  suming compatibl
-0001ac80: 6522 2c0a 2020 2020 2020 2020 2020 2020  e",.            
-0001ac90: 2020 2020 7365 7276 6572 5f76 6572 7369      server_versi
-0001aca0: 6f6e 3d73 6572 7665 725f 7665 7273 696f  on=server_versio
-0001acb0: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
-0001acc0: 2020 2063 6c69 656e 745f 7665 7273 696f     client_versio
-0001acd0: 6e3d 636c 6965 6e74 5f76 6572 7369 6f6e  n=client_version
-0001ace0: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0001acf0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001ad00: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
-0001ad10: 6966 2070 6172 7365 645f 7365 7276 6572  if parsed_server
-0001ad20: 5f76 6572 7369 6f6e 2e6d 616a 6f72 2021  _version.major !
-0001ad30: 3d20 7061 7273 6564 5f63 6c69 656e 745f  = parsed_client_
-0001ad40: 7665 7273 696f 6e2e 6d61 6a6f 723a 0a20  version.major:. 
-0001ad50: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
-0001ad60: 722e 7761 726e 696e 6728 0a20 2020 2020  r.warning(.     
-0001ad70: 2020 2020 2020 2020 2020 2022 5365 7276             "Serv
-0001ad80: 6572 2061 6e64 2063 6c69 656e 7420 7665  er and client ve
-0001ad90: 7273 696f 6e73 2061 7265 2069 6e63 6f6d  rsions are incom
-0001ada0: 7061 7469 626c 6522 2c0a 2020 2020 2020  patible",.      
-0001adb0: 2020 2020 2020 2020 2020 7061 7273 6564            parsed
-0001adc0: 5f73 6572 7665 725f 7665 7273 696f 6e3d  _server_version=
-0001add0: 7061 7273 6564 5f73 6572 7665 725f 7665  parsed_server_ve
-0001ade0: 7273 696f 6e2c 0a20 2020 2020 2020 2020  rsion,.         
-0001adf0: 2020 2020 2020 2070 6172 7365 645f 636c         parsed_cl
-0001ae00: 6965 6e74 5f76 6572 7369 6f6e 3d70 6172  ient_version=par
-0001ae10: 7365 645f 636c 6965 6e74 5f76 6572 7369  sed_client_versi
-0001ae20: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001ae30: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0001ae40: 7475 726e 2046 616c 7365 0a20 2020 2020  turn False.     
-0001ae50: 2020 2069 6620 7061 7273 6564 5f73 6572     if parsed_ser
-0001ae60: 7665 725f 7665 7273 696f 6e2e 6d69 6e6f  ver_version.mino
-0001ae70: 7220 3e20 7061 7273 6564 5f63 6c69 656e  r > parsed_clien
-0001ae80: 745f 7665 7273 696f 6e2e 6d69 6e6f 7220  t_version.minor 
-0001ae90: 2b20 323a 0a20 2020 2020 2020 2020 2020  + 2:.           
-0001aea0: 206c 6f67 6765 722e 696e 666f 280a 2020   logger.info(.  
-0001aeb0: 2020 2020 2020 2020 2020 2020 2020 2242                "B
-0001aec0: 6163 6b77 6172 6473 2063 6f6d 7061 7469  ackwards compati
-0001aed0: 6269 6c69 7479 206d 6967 6874 206e 6f74  bility might not
-0001aee0: 2061 7070 6c79 2062 6574 7765 656e 2074   apply between t
-0001aef0: 6865 2073 6572 7665 7220 616e 6420 636c  he server and cl
-0001af00: 6965 6e74 2076 6572 7369 6f6e 222c 0a20  ient version",. 
-0001af10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-0001af20: 6172 7365 645f 7365 7276 6572 5f76 6572  arsed_server_ver
-0001af30: 7369 6f6e 3d70 6172 7365 645f 7365 7276  sion=parsed_serv
-0001af40: 6572 5f76 6572 7369 6f6e 2c0a 2020 2020  er_version,.    
-0001af50: 2020 2020 2020 2020 2020 2020 7061 7273              pars
-0001af60: 6564 5f63 6c69 656e 745f 7665 7273 696f  ed_client_versio
-0001af70: 6e3d 7061 7273 6564 5f63 6c69 656e 745f  n=parsed_client_
-0001af80: 7665 7273 696f 6e2c 0a20 2020 2020 2020  version,.       
-0001af90: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
-0001afa0: 2020 2072 6574 7572 6e20 4661 6c73 650a     return False.
-0001afb0: 2020 2020 2020 2020 6966 2070 6172 7365          if parse
-0001afc0: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
-0001afd0: 2e6d 696e 6f72 203e 2070 6172 7365 645f  .minor > parsed_
-0001afe0: 7365 7276 6572 5f76 6572 7369 6f6e 2e6d  server_version.m
-0001aff0: 696e 6f72 3a0a 2020 2020 2020 2020 2020  inor:.          
-0001b000: 2020 6c6f 6767 6572 2e77 6172 6e69 6e67    logger.warning
-0001b010: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
-0001b020: 2020 2243 6c69 656e 7420 7665 7273 696f    "Client versio
-0001b030: 6e20 7769 7468 2068 6967 6865 7220 7665  n with higher ve
-0001b040: 7273 696f 6e20 7468 616e 2073 6572 7665  rsion than serve
-0001b050: 7220 7665 7273 696f 6e20 6973 6e27 7420  r version isn't 
-0001b060: 7375 7070 6f72 7465 642c 220a 2020 2020  supported,".    
-0001b070: 2020 2020 2020 2020 2020 2020 2220 616c              " al
-0001b080: 6967 6e20 796f 7572 2063 6c69 656e 7420  ign your client 
-0001b090: 746f 2074 6865 2073 6572 7665 7220 7665  to the server ve
-0001b0a0: 7273 696f 6e22 2c0a 2020 2020 2020 2020  rsion",.        
-0001b0b0: 2020 2020 2020 2020 7061 7273 6564 5f73          parsed_s
-0001b0c0: 6572 7665 725f 7665 7273 696f 6e3d 7061  erver_version=pa
-0001b0d0: 7273 6564 5f73 6572 7665 725f 7665 7273  rsed_server_vers
-0001b0e0: 696f 6e2c 0a20 2020 2020 2020 2020 2020  ion,.           
-0001b0f0: 2020 2020 2070 6172 7365 645f 636c 6965       parsed_clie
-0001b100: 6e74 5f76 6572 7369 6f6e 3d70 6172 7365  nt_version=parse
-0001b110: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
-0001b120: 2c0a 2020 2020 2020 2020 2020 2020 290a  ,.            ).
-0001b130: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-0001b140: 726e 2046 616c 7365 0a20 2020 2020 2020  rn False.       
-0001b150: 2069 6620 7061 7273 6564 5f73 6572 7665   if parsed_serve
-0001b160: 725f 7665 7273 696f 6e2e 6d69 6e6f 7220  r_version.minor 
-0001b170: 213d 2070 6172 7365 645f 636c 6965 6e74  != parsed_client
-0001b180: 5f76 6572 7369 6f6e 2e6d 696e 6f72 3a0a  _version.minor:.
-0001b190: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
-0001b1a0: 6572 2e69 6e66 6f28 0a20 2020 2020 2020  er.info(.       
-0001b1b0: 2020 2020 2020 2020 2022 5365 7276 6572           "Server
-0001b1c0: 2061 6e64 2063 6c69 656e 7420 7665 7273   and client vers
-0001b1d0: 696f 6e73 2061 7265 206e 6f74 2074 6865  ions are not the
-0001b1e0: 2073 616d 6520 6275 7420 636f 6d70 6174   same but compat
-0001b1f0: 6962 6c65 222c 0a20 2020 2020 2020 2020  ible",.         
-0001b200: 2020 2020 2020 2070 6172 7365 645f 7365         parsed_se
-0001b210: 7276 6572 5f76 6572 7369 6f6e 3d70 6172  rver_version=par
-0001b220: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
-0001b230: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
-0001b240: 2020 2020 7061 7273 6564 5f63 6c69 656e      parsed_clien
-0001b250: 745f 7665 7273 696f 6e3d 7061 7273 6564  t_version=parsed
-0001b260: 5f63 6c69 656e 745f 7665 7273 696f 6e2c  _client_version,
-0001b270: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
-0001b280: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
-0001b290: 7565 0a0a 2020 2020 6465 6620 6372 6561  ue..    def crea
-0001b2a0: 7465 5f6d 6f64 656c 5f65 6e64 706f 696e  te_model_endpoin
-0001b2b0: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
-0001b2c0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
-0001b2d0: 3a20 7374 722c 0a20 2020 2020 2020 2065  : str,.        e
-0001b2e0: 6e64 706f 696e 745f 6964 3a20 7374 722c  ndpoint_id: str,
-0001b2f0: 0a20 2020 2020 2020 206d 6f64 656c 5f65  .        model_e
-0001b300: 6e64 706f 696e 743a 2055 6e69 6f6e 5b0a  ndpoint: Union[.
-0001b310: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
-0001b320: 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f 7269  n.model_monitori
-0001b330: 6e67 2e6d 6f64 656c 5f65 6e64 706f 696e  ng.model_endpoin
-0001b340: 742e 4d6f 6465 6c45 6e64 706f 696e 742c  t.ModelEndpoint,
-0001b350: 2064 6963 740a 2020 2020 2020 2020 5d2c   dict.        ],
-0001b360: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0001b370: 2222 220a 2020 2020 2020 2020 4372 6561  """.        Crea
-0001b380: 7465 7320 6120 4442 2072 6563 6f72 6420  tes a DB record 
-0001b390: 7769 7468 2074 6865 2067 6976 656e 206d  with the given m
-0001b3a0: 6f64 656c 5f65 6e64 706f 696e 7420 7265  odel_endpoint re
-0001b3b0: 636f 7264 2e0a 0a20 2020 2020 2020 203a  cord...        :
-0001b3c0: 7061 7261 6d20 7072 6f6a 6563 743a 2054  param project: T
-0001b3d0: 6865 206e 616d 6520 6f66 2074 6865 2070  he name of the p
-0001b3e0: 726f 6a65 6374 2e0a 2020 2020 2020 2020  roject..        
-0001b3f0: 3a70 6172 616d 2065 6e64 706f 696e 745f  :param endpoint_
-0001b400: 6964 3a20 5468 6520 6964 206f 6620 7468  id: The id of th
-0001b410: 6520 656e 6470 6f69 6e74 2e0a 2020 2020  e endpoint..    
-0001b420: 2020 2020 3a70 6172 616d 206d 6f64 656c      :param model
-0001b430: 5f65 6e64 706f 696e 743a 2041 6e20 6f62  _endpoint: An ob
-0001b440: 6a65 6374 2072 6570 7265 7365 6e74 696e  ject representin
-0001b450: 6720 7468 6520 6d6f 6465 6c20 656e 6470  g the model endp
-0001b460: 6f69 6e74 2e0a 2020 2020 2020 2020 2222  oint..        ""
-0001b470: 220a 0a20 2020 2020 2020 2069 6620 6973  "..        if is
-0001b480: 696e 7374 616e 6365 280a 2020 2020 2020  instance(.      
-0001b490: 2020 2020 2020 6d6f 6465 6c5f 656e 6470        model_endp
-0001b4a0: 6f69 6e74 2c20 6d6c 7275 6e2e 6d6f 6465  oint, mlrun.mode
-0001b4b0: 6c5f 6d6f 6e69 746f 7269 6e67 2e6d 6f64  l_monitoring.mod
-0001b4c0: 656c 5f65 6e64 706f 696e 742e 4d6f 6465  el_endpoint.Mode
-0001b4d0: 6c45 6e64 706f 696e 740a 2020 2020 2020  lEndpoint.      
-0001b4e0: 2020 293a 0a20 2020 2020 2020 2020 2020    ):.           
-0001b4f0: 206d 6f64 656c 5f65 6e64 706f 696e 7420   model_endpoint 
-0001b500: 3d20 6d6f 6465 6c5f 656e 6470 6f69 6e74  = model_endpoint
-0001b510: 2e74 6f5f 6469 6374 2829 0a0a 2020 2020  .to_dict()..    
-0001b520: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
-0001b530: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
-0001b540: 6d6f 6465 6c2d 656e 6470 6f69 6e74 732f  model-endpoints/
-0001b550: 7b65 6e64 706f 696e 745f 6964 7d22 0a20  {endpoint_id}". 
-0001b560: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
-0001b570: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
-0001b580: 2020 6d65 7468 6f64 3d22 504f 5354 222c    method="POST",
-0001b590: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
-0001b5a0: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
-0001b5b0: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
-0001b5c0: 5f6a 736f 6e28 6d6f 6465 6c5f 656e 6470  _json(model_endp
-0001b5d0: 6f69 6e74 292c 0a20 2020 2020 2020 2029  oint),.        )
-0001b5e0: 0a0a 2020 2020 6465 6620 6465 6c65 7465  ..    def delete
-0001b5f0: 5f6d 6f64 656c 5f65 6e64 706f 696e 7428  _model_endpoint(
-0001b600: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0001b610: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
-0001b620: 7374 722c 0a20 2020 2020 2020 2065 6e64  str,.        end
-0001b630: 706f 696e 745f 6964 3a20 7374 722c 0a20  point_id: str,. 
-0001b640: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0001b650: 220a 2020 2020 2020 2020 4465 6c65 7465  ".        Delete
-0001b660: 7320 7468 6520 4442 2072 6563 6f72 6420  s the DB record 
-0001b670: 6f66 2061 2067 6976 656e 206d 6f64 656c  of a given model
-0001b680: 2065 6e64 706f 696e 742c 2070 726f 6a65   endpoint, proje
-0001b690: 6374 2061 6e64 2065 6e64 706f 696e 745f  ct and endpoint_
-0001b6a0: 6964 2061 7265 2075 7365 6420 666f 7220  id are used for 
-0001b6b0: 6c6f 6f6b 7570 0a0a 2020 2020 2020 2020  lookup..        
-0001b6c0: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
-0001b6d0: 5468 6520 6e61 6d65 206f 6620 7468 6520  The name of the 
-0001b6e0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
-0001b6f0: 3a70 6172 616d 2065 6e64 706f 696e 745f  :param endpoint_
-0001b700: 6964 3a20 5468 6520 6964 206f 6620 7468  id: The id of th
-0001b710: 6520 656e 6470 6f69 6e74 0a20 2020 2020  e endpoint.     
-0001b720: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-0001b730: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
-0001b740: 732f 7b70 726f 6a65 6374 7d2f 6d6f 6465  s/{project}/mode
-0001b750: 6c2d 656e 6470 6f69 6e74 732f 7b65 6e64  l-endpoints/{end
-0001b760: 706f 696e 745f 6964 7d22 0a20 2020 2020  point_id}".     
-0001b770: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
-0001b780: 280a 2020 2020 2020 2020 2020 2020 6d65  (.            me
-0001b790: 7468 6f64 3d22 4445 4c45 5445 222c 0a20  thod="DELETE",. 
-0001b7a0: 2020 2020 2020 2020 2020 2070 6174 683d             path=
-0001b7b0: 7061 7468 2c0a 2020 2020 2020 2020 290a  path,.        ).
-0001b7c0: 0a20 2020 2064 6566 206c 6973 745f 6d6f  .    def list_mo
-0001b7d0: 6465 6c5f 656e 6470 6f69 6e74 7328 0a20  del_endpoints(. 
-0001b7e0: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0001b7f0: 2020 2020 2070 726f 6a65 6374 3a20 7374       project: st
-0001b800: 722c 0a20 2020 2020 2020 206d 6f64 656c  r,.        model
-0001b810: 3a20 4f70 7469 6f6e 616c 5b73 7472 5d20  : Optional[str] 
-0001b820: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001b830: 6675 6e63 7469 6f6e 3a20 4f70 7469 6f6e  function: Option
-0001b840: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0001b850: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
-0001b860: 4c69 7374 5b73 7472 5d20 3d20 4e6f 6e65  List[str] = None
-0001b870: 2c0a 2020 2020 2020 2020 7374 6172 743a  ,.        start:
-0001b880: 2073 7472 203d 2022 6e6f 772d 3168 222c   str = "now-1h",
-0001b890: 0a20 2020 2020 2020 2065 6e64 3a20 7374  .        end: st
-0001b8a0: 7220 3d20 226e 6f77 222c 0a20 2020 2020  r = "now",.     
-0001b8b0: 2020 206d 6574 7269 6373 3a20 4f70 7469     metrics: Opti
-0001b8c0: 6f6e 616c 5b4c 6973 745b 7374 725d 5d20  onal[List[str]] 
-0001b8d0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
-0001b8e0: 746f 705f 6c65 7665 6c3a 2062 6f6f 6c20  top_level: bool 
-0001b8f0: 3d20 4661 6c73 652c 0a20 2020 2020 2020  = False,.       
-0001b900: 2075 6964 733a 204f 7074 696f 6e61 6c5b   uids: Optional[
-0001b910: 4c69 7374 5b73 7472 5d5d 203d 204e 6f6e  List[str]] = Non
-0001b920: 652c 0a20 2020 2029 202d 3e20 4c69 7374  e,.    ) -> List
-0001b930: 5b6d 6c72 756e 2e6d 6f64 656c 5f6d 6f6e  [mlrun.model_mon
-0001b940: 6974 6f72 696e 672e 6d6f 6465 6c5f 656e  itoring.model_en
-0001b950: 6470 6f69 6e74 2e4d 6f64 656c 456e 6470  dpoint.ModelEndp
-0001b960: 6f69 6e74 5d3a 0a20 2020 2020 2020 2022  oint]:.        "
-0001b970: 2222 0a20 2020 2020 2020 2052 6574 7572  "".        Retur
-0001b980: 6e73 2061 206c 6973 7420 6f66 2060 4d6f  ns a list of `Mo
-0001b990: 6465 6c45 6e64 706f 696e 7460 206f 626a  delEndpoint` obj
-0001b9a0: 6563 7473 2e20 4561 6368 2060 4d6f 6465  ects. Each `Mode
-0001b9b0: 6c45 6e64 706f 696e 7460 206f 626a 6563  lEndpoint` objec
-0001b9c0: 7420 7265 7072 6573 656e 7473 2074 6865  t represents the
-0001b9d0: 2063 7572 7265 6e74 2073 7461 7465 206f   current state o
-0001b9e0: 6620 610a 2020 2020 2020 2020 6d6f 6465  f a.        mode
-0001b9f0: 6c20 656e 6470 6f69 6e74 2e20 5468 6973  l endpoint. This
-0001ba00: 2066 756e 6374 696f 6e73 2073 7570 706f   functions suppo
-0001ba10: 7274 7320 6669 6c74 6572 696e 6720 6279  rts filtering by
-0001ba20: 2074 6865 2066 6f6c 6c6f 7769 6e67 2070   the following p
-0001ba30: 6172 616d 6574 6572 733a 0a20 2020 2020  arameters:.     
-0001ba40: 2020 2031 2920 6d6f 6465 6c0a 2020 2020     1) model.    
-0001ba50: 2020 2020 3229 2066 756e 6374 696f 6e0a      2) function.
-0001ba60: 2020 2020 2020 2020 3329 206c 6162 656c          3) label
-0001ba70: 730a 2020 2020 2020 2020 3429 2074 6f70  s.        4) top
-0001ba80: 206c 6576 656c 0a20 2020 2020 2020 2035   level.        5
-0001ba90: 2920 7569 6473 0a20 2020 2020 2020 2042  ) uids.        B
-0001baa0: 7920 6465 6661 756c 742c 2077 6865 6e20  y default, when 
-0001bab0: 6e6f 2066 696c 7465 7273 2061 7265 2061  no filters are a
-0001bac0: 7070 6c69 6564 2c20 616c 6c20 6176 6169  pplied, all avai
-0001bad0: 6c61 626c 6520 656e 6470 6f69 6e74 7320  lable endpoints 
-0001bae0: 666f 7220 7468 6520 6769 7665 6e20 7072  for the given pr
-0001baf0: 6f6a 6563 7420 7769 6c6c 2062 6520 6c69  oject will be li
-0001bb00: 7374 6564 2e0a 0a20 2020 2020 2020 2049  sted...        I
-0001bb10: 6e20 6164 6469 7469 6f6e 2c20 7468 6973  n addition, this
-0001bb20: 2066 756e 6374 696f 6e73 2070 726f 7669   functions provi
-0001bb30: 6465 7320 6120 6661 6361 6465 2066 6f72  des a facade for
-0001bb40: 206c 6973 7469 6e67 2065 6e64 706f 696e   listing endpoin
-0001bb50: 7420 7265 6c61 7465 6420 6d65 7472 6963  t related metric
-0001bb60: 732e 2054 6869 7320 6661 6361 6465 2069  s. This facade i
-0001bb70: 7320 7469 6d65 2d62 6173 6564 0a20 2020  s time-based.   
-0001bb80: 2020 2020 2061 6e64 2064 6570 656e 6473       and depends
-0001bb90: 206f 6e20 7468 6520 2773 7461 7274 2720   on the 'start' 
-0001bba0: 616e 6420 2765 6e64 2720 7061 7261 6d65  and 'end' parame
-0001bbb0: 7465 7273 2e20 4279 2064 6566 6175 6c74  ters. By default
-0001bbc0: 2c20 7768 656e 2074 6865 206d 6574 7269  , when the metri
-0001bbd0: 6373 2070 6172 616d 6574 6572 2069 7320  cs parameter is 
-0001bbe0: 4e6f 6e65 2c20 6e6f 206d 6574 7269 6373  None, no metrics
-0001bbf0: 2061 7265 0a20 2020 2020 2020 2061 6464   are.        add
-0001bc00: 6564 2074 6f20 7468 6520 6f75 7470 7574  ed to the output
-0001bc10: 206f 6620 7468 6973 2066 756e 6374 696f   of this functio
-0001bc20: 6e2e 0a0a 2020 2020 2020 2020 3a70 6172  n...        :par
-0001bc30: 616d 2070 726f 6a65 6374 3a20 5468 6520  am project: The 
-0001bc40: 6e61 6d65 206f 6620 7468 6520 7072 6f6a  name of the proj
-0001bc50: 6563 740a 2020 2020 2020 2020 3a70 6172  ect.        :par
-0001bc60: 616d 206d 6f64 656c 3a20 5468 6520 6e61  am model: The na
-0001bc70: 6d65 206f 6620 7468 6520 6d6f 6465 6c20  me of the model 
-0001bc80: 746f 2066 696c 7465 7220 6279 0a20 2020  to filter by.   
-0001bc90: 2020 2020 203a 7061 7261 6d20 6675 6e63       :param func
-0001bca0: 7469 6f6e 3a20 5468 6520 6e61 6d65 206f  tion: The name o
-0001bcb0: 6620 7468 6520 6675 6e63 7469 6f6e 2074  f the function t
-0001bcc0: 6f20 6669 6c74 6572 2062 790a 2020 2020  o filter by.    
-0001bcd0: 2020 2020 3a70 6172 616d 206c 6162 656c      :param label
-0001bce0: 733a 2041 206c 6973 7420 6f66 206c 6162  s: A list of lab
-0001bcf0: 656c 7320 746f 2066 696c 7465 7220 6279  els to filter by
-0001bd00: 2e20 4c61 6265 6c20 6669 6c74 6572 7320  . Label filters 
-0001bd10: 776f 726b 2062 7920 6569 7468 6572 2066  work by either f
-0001bd20: 696c 7465 7269 6e67 2061 2073 7065 6369  iltering a speci
-0001bd30: 6669 6320 7661 6c75 6520 6f66 2061 0a20  fic value of a. 
-0001bd40: 2020 2020 2020 2020 6c61 6265 6c20 2869          label (i
-0001bd50: 2e65 2e20 6c69 7374 2822 6b65 793d 7661  .e. list("key=va
-0001bd60: 6c75 6522 2929 206f 7220 6279 206c 6f6f  lue")) or by loo
-0001bd70: 6b69 6e67 2066 6f72 2074 6865 2065 7869  king for the exi
-0001bd80: 7374 656e 6365 206f 6620 6120 6769 7665  stence of a give
-0001bd90: 6e20 6b65 7920 2869 2e65 2e20 226b 6579  n key (i.e. "key
-0001bda0: 2229 0a20 2020 2020 2020 203a 7061 7261  ").        :para
-0001bdb0: 6d20 6d65 7472 6963 733a 2041 206c 6973  m metrics: A lis
-0001bdc0: 7420 6f66 206d 6574 7269 6373 2074 6f20  t of metrics to 
-0001bdd0: 7265 7475 726e 2066 6f72 2065 6163 6820  return for each 
-0001bde0: 656e 6470 6f69 6e74 2c20 7265 6164 206d  endpoint, read m
-0001bdf0: 6f72 6520 696e 2027 5469 6d65 4d65 7472  ore in 'TimeMetr
-0001be00: 6963 270a 2020 2020 2020 2020 3a70 6172  ic'.        :par
-0001be10: 616d 2073 7461 7274 3a20 5468 6520 7374  am start: The st
-0001be20: 6172 7420 7469 6d65 206f 6620 7468 6520  art time of the 
-0001be30: 6d65 7472 6963 732e 2043 616e 2062 6520  metrics. Can be 
-0001be40: 7265 7072 6573 656e 7465 6420 6279 2061  represented by a
-0001be50: 2073 7472 696e 6720 636f 6e74 6169 6e69   string containi
-0001be60: 6e67 2061 6e20 5246 4320 3333 3339 0a20  ng an RFC 3339. 
-0001be70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be90: 7469 6d65 2c20 6120 556e 6978 2074 696d  time, a Unix tim
-0001bea0: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
-0001beb0: 6563 6f6e 6473 2c20 6120 7265 6c61 7469  econds, a relati
-0001bec0: 7665 2074 696d 6520 2860 276e 6f77 2760  ve time (`'now'`
-0001bed0: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0001bee0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bef0: 2020 2020 2060 276e 6f77 2d5b 302d 395d       `'now-[0-9]
-0001bf00: 2b5b 6d68 645d 2760 2c20 7768 6572 6520  +[mhd]'`, where 
-0001bf10: 606d 6020 3d20 6d69 6e75 7465 732c 2060  `m` = minutes, `
-0001bf20: 6860 203d 2068 6f75 7273 2c20 616e 6420  h` = hours, and 
-0001bf30: 6027 6427 6020 3d0a 2020 2020 2020 2020  `'d'` =.        
-0001bf40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf50: 2020 2020 2020 2020 2064 6179 7329 2c20           days), 
-0001bf60: 6f72 2030 2066 6f72 2074 6865 2065 6172  or 0 for the ear
-0001bf70: 6c69 6573 7420 7469 6d65 2e0a 2020 2020  liest time..    
-0001bf80: 2020 2020 3a70 6172 616d 2065 6e64 3a20      :param end: 
-0001bf90: 5468 6520 656e 6420 7469 6d65 206f 6620  The end time of 
-0001bfa0: 7468 6520 6d65 7472 6963 732e 2043 616e  the metrics. Can
-0001bfb0: 2062 6520 7265 7072 6573 656e 7465 6420   be represented 
-0001bfc0: 6279 2061 2073 7472 696e 6720 636f 6e74  by a string cont
-0001bfd0: 6169 6e69 6e67 2061 6e20 5246 4320 3333  aining an RFC 33
-0001bfe0: 3339 0a20 2020 2020 2020 2020 2020 2020  39.             
-0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 7469 6d65 2c20 6120 556e 6978      time, a Unix
-0001c010: 2074 696d 6573 7461 6d70 2069 6e20 6d69   timestamp in mi
-0001c020: 6c6c 6973 6563 6f6e 6473 2c20 6120 7265  lliseconds, a re
-0001c030: 6c61 7469 7665 2074 696d 6520 2860 276e  lative time (`'n
-0001c040: 6f77 2760 206f 720a 2020 2020 2020 2020  ow'` or.        
-0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c060: 2020 2020 2020 2020 2060 276e 6f77 2d5b           `'now-[
-0001c070: 302d 395d 2b5b 6d68 645d 2760 2c20 7768  0-9]+[mhd]'`, wh
-0001c080: 6572 6520 606d 6020 3d20 6d69 6e75 7465  ere `m` = minute
-0001c090: 732c 2060 6860 203d 2068 6f75 7273 2c20  s, `h` = hours, 
-0001c0a0: 616e 6420 6027 6427 6020 3d0a 2020 2020  and `'d'` =.    
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 2020 2020 2020 2020 2020 2020 2064 6179               day
-0001c0d0: 7329 2c20 6f72 2030 2066 6f72 2074 6865  s), or 0 for the
-0001c0e0: 2065 6172 6c69 6573 7420 7469 6d65 2e0a   earliest time..
-0001c0f0: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
-0001c100: 6f70 5f6c 6576 656c 3a20 6966 2074 7275  op_level: if tru
-0001c110: 6520 7769 6c6c 2072 6574 7572 6e20 6f6e  e will return on
-0001c120: 6c79 2072 6f75 7465 7273 2061 6e64 2065  ly routers and e
-0001c130: 6e64 706f 696e 7420 7468 6174 2061 7265  ndpoint that are
-0001c140: 204e 4f54 2063 6869 6c64 7265 6e20 6f66   NOT children of
-0001c150: 2061 6e79 2072 6f75 7465 720a 2020 2020   any router.    
-0001c160: 2020 2020 3a70 6172 616d 2075 6964 733a      :param uids:
-0001c170: 2069 6620 7061 7373 6564 2077 696c 6c20   if passed will 
-0001c180: 7265 7475 726e 2061 206c 6973 7420 604d  return a list `M
-0001c190: 6f64 656c 456e 6470 6f69 6e74 6020 6f62  odelEndpoint` ob
-0001c1a0: 6a65 6374 2077 6974 6820 7569 6420 696e  ject with uid in
-0001c1b0: 2075 6964 730a 2020 2020 2020 2020 2222   uids.        ""
-0001c1c0: 220a 0a20 2020 2020 2020 2070 6174 6820  "..        path 
-0001c1d0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0001c1e0: 6f6a 6563 747d 2f6d 6f64 656c 2d65 6e64  oject}/model-end
-0001c1f0: 706f 696e 7473 220a 0a20 2020 2020 2020  points"..       
-0001c200: 2069 6620 6c61 6265 6c73 2061 6e64 2069   if labels and i
-0001c210: 7369 6e73 7461 6e63 6528 6c61 6265 6c73  sinstance(labels
-0001c220: 2c20 6469 6374 293a 0a20 2020 2020 2020  , dict):.       
-0001c230: 2020 2020 206c 6162 656c 7320 3d20 5b66       labels = [f
-0001c240: 227b 6b65 797d 3d7b 7661 6c75 657d 2220  "{key}={value}" 
-0001c250: 666f 7220 6b65 792c 2076 616c 7565 2069  for key, value i
-0001c260: 6e20 6c61 6265 6c73 2e69 7465 6d73 2829  n labels.items()
-0001c270: 5d0a 0a20 2020 2020 2020 2072 6573 706f  ]..        respo
-0001c280: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-0001c290: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-0001c2a0: 206d 6574 686f 643d 2247 4554 222c 0a20   method="GET",. 
-0001c2b0: 2020 2020 2020 2020 2020 2070 6174 683d             path=
-0001c2c0: 7061 7468 2c0a 2020 2020 2020 2020 2020  path,.          
-0001c2d0: 2020 7061 7261 6d73 3d7b 0a20 2020 2020    params={.     
-0001c2e0: 2020 2020 2020 2020 2020 2022 6d6f 6465             "mode
-0001c2f0: 6c22 3a20 6d6f 6465 6c2c 0a20 2020 2020  l": model,.     
-0001c300: 2020 2020 2020 2020 2020 2022 6675 6e63             "func
-0001c310: 7469 6f6e 223a 2066 756e 6374 696f 6e2c  tion": function,
-0001c320: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001c330: 2022 6c61 6265 6c22 3a20 6c61 6265 6c73   "label": labels
-0001c340: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
-0001c350: 2020 2020 2020 2020 2273 7461 7274 223a          "start":
-0001c360: 2073 7461 7274 2c0a 2020 2020 2020 2020   start,.        
-0001c370: 2020 2020 2020 2020 2265 6e64 223a 2065          "end": e
-0001c380: 6e64 2c0a 2020 2020 2020 2020 2020 2020  nd,.            
-0001c390: 2020 2020 226d 6574 7269 6322 3a20 6d65      "metric": me
-0001c3a0: 7472 6963 7320 6f72 205b 5d2c 0a20 2020  trics or [],.   
-0001c3b0: 2020 2020 2020 2020 2020 2020 2022 746f               "to
-0001c3c0: 702d 6c65 7665 6c22 3a20 746f 705f 6c65  p-level": top_le
-0001c3d0: 7665 6c2c 0a20 2020 2020 2020 2020 2020  vel,.           
-0001c3e0: 2020 2020 2022 7569 6422 3a20 7569 6473       "uid": uids
-0001c3f0: 2c0a 2020 2020 2020 2020 2020 2020 7d2c  ,.            },
-0001c400: 0a20 2020 2020 2020 2029 0a0a 2020 2020  .        )..    
-0001c410: 2020 2020 2320 4765 6e65 7261 7465 2061      # Generate a
-0001c420: 206c 6973 7420 6f66 2061 206d 6f64 656c   list of a model
-0001c430: 2065 6e64 706f 696e 7420 6469 6374 696f   endpoint dictio
-0001c440: 6e61 7269 6573 0a20 2020 2020 2020 206d  naries.        m
-0001c450: 6f64 656c 5f65 6e64 706f 696e 7473 203d  odel_endpoints =
-0001c460: 2072 6573 706f 6e73 652e 6a73 6f6e 2829   response.json()
-0001c470: 5b22 656e 6470 6f69 6e74 7322 5d0a 2020  ["endpoints"].  
-0001c480: 2020 2020 2020 6966 206d 6f64 656c 5f65        if model_e
-0001c490: 6e64 706f 696e 7473 3a0a 2020 2020 2020  ndpoints:.      
-0001c4a0: 2020 2020 2020 7265 7475 726e 205b 0a20        return [. 
-0001c4b0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-0001c4c0: 6c72 756e 2e6d 6f64 656c 5f6d 6f6e 6974  lrun.model_monit
-0001c4d0: 6f72 696e 672e 6d6f 6465 6c5f 656e 6470  oring.model_endp
-0001c4e0: 6f69 6e74 2e4d 6f64 656c 456e 6470 6f69  oint.ModelEndpoi
-0001c4f0: 6e74 2e66 726f 6d5f 6469 6374 286f 626a  nt.from_dict(obj
-0001c500: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0001c510: 2020 666f 7220 6f62 6a20 696e 206d 6f64    for obj in mod
-0001c520: 656c 5f65 6e64 706f 696e 7473 0a20 2020  el_endpoints.   
-0001c530: 2020 2020 2020 2020 205d 0a20 2020 2020           ].     
-0001c540: 2020 2072 6574 7572 6e20 5b5d 0a0a 2020     return []..  
-0001c550: 2020 6465 6620 6765 745f 6d6f 6465 6c5f    def get_model_
-0001c560: 656e 6470 6f69 6e74 280a 2020 2020 2020  endpoint(.      
-0001c570: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
-0001c580: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
-0001c590: 2020 2020 2020 656e 6470 6f69 6e74 5f69        endpoint_i
-0001c5a0: 643a 2073 7472 2c0a 2020 2020 2020 2020  d: str,.        
-0001c5b0: 7374 6172 743a 204f 7074 696f 6e61 6c5b  start: Optional[
-0001c5c0: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
-0001c5d0: 2020 2020 2065 6e64 3a20 4f70 7469 6f6e       end: Option
-0001c5e0: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
-0001c5f0: 2020 2020 2020 2020 6d65 7472 6963 733a          metrics:
-0001c600: 204f 7074 696f 6e61 6c5b 4c69 7374 5b73   Optional[List[s
-0001c610: 7472 5d5d 203d 204e 6f6e 652c 0a20 2020  tr]] = None,.   
-0001c620: 2020 2020 2066 6561 7475 7265 5f61 6e61       feature_ana
-0001c630: 6c79 7369 733a 2062 6f6f 6c20 3d20 4661  lysis: bool = Fa
-0001c640: 6c73 652c 0a20 2020 2029 202d 3e20 6d6c  lse,.    ) -> ml
-0001c650: 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f  run.model_monito
-0001c660: 7269 6e67 2e6d 6f64 656c 5f65 6e64 706f  ring.model_endpo
-0001c670: 696e 742e 4d6f 6465 6c45 6e64 706f 696e  int.ModelEndpoin
-0001c680: 743a 0a20 2020 2020 2020 2022 2222 0a20  t:.        """. 
-0001c690: 2020 2020 2020 2052 6574 7572 6e73 2061         Returns a
-0001c6a0: 2073 696e 676c 6520 604d 6f64 656c 456e   single `ModelEn
-0001c6b0: 6470 6f69 6e74 6020 6f62 6a65 6374 2077  dpoint` object w
-0001c6c0: 6974 6820 6164 6469 7469 6f6e 616c 206d  ith additional m
-0001c6d0: 6574 7269 6373 2061 6e64 2066 6561 7475  etrics and featu
-0001c6e0: 7265 2072 656c 6174 6564 2064 6174 612e  re related data.
-0001c6f0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
-0001c700: 2070 726f 6a65 6374 3a20 2020 2020 2020   project:       
-0001c710: 2020 2020 2020 2020 2020 2020 2054 6865               The
-0001c720: 206e 616d 6520 6f66 2074 6865 2070 726f   name of the pro
-0001c730: 6a65 6374 0a20 2020 2020 2020 203a 7061  ject.        :pa
-0001c740: 7261 6d20 656e 6470 6f69 6e74 5f69 643a  ram endpoint_id:
-0001c750: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c760: 5468 6520 756e 6971 7565 2069 6420 6f66  The unique id of
-0001c770: 2074 6865 206d 6f64 656c 2065 6e64 706f   the model endpo
-0001c780: 696e 742e 0a20 2020 2020 2020 203a 7061  int..        :pa
-0001c790: 7261 6d20 7374 6172 743a 2020 2020 2020  ram start:      
-0001c7a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c7b0: 5468 6520 7374 6172 7420 7469 6d65 206f  The start time o
-0001c7c0: 6620 7468 6520 6d65 7472 6963 732e 2043  f the metrics. C
-0001c7d0: 616e 2062 6520 7265 7072 6573 656e 7465  an be represente
-0001c7e0: 6420 6279 2061 2073 7472 696e 6720 636f  d by a string co
-0001c7f0: 6e74 6169 6e69 6e67 2061 6e0a 2020 2020  ntaining an.    
-0001c800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c810: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c820: 2020 2020 2020 2052 4643 2033 3333 3920         RFC 3339 
-0001c830: 7469 6d65 2c20 6120 556e 6978 2074 696d  time, a Unix tim
-0001c840: 6573 7461 6d70 2069 6e20 6d69 6c6c 6973  estamp in millis
-0001c850: 6563 6f6e 6473 2c20 6120 7265 6c61 7469  econds, a relati
-0001c860: 7665 2074 696d 6520 2860 276e 6f77 2760  ve time (`'now'`
-0001c870: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
-0001c880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c890: 2020 2020 2020 2020 2020 2020 2020 2060                 `
-0001c8a0: 276e 6f77 2d5b 302d 395d 2b5b 6d68 645d  'now-[0-9]+[mhd]
-0001c8b0: 2760 2c20 7768 6572 6520 606d 6020 3d20  '`, where `m` = 
-0001c8c0: 6d69 6e75 7465 732c 2060 6860 203d 2068  minutes, `h` = h
-0001c8d0: 6f75 7273 2c20 616e 6420 6027 6427 6020  ours, and `'d'` 
-0001c8e0: 3d20 6461 7973 292c 206f 720a 2020 2020  = days), or.    
-0001c8f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c900: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c910: 2020 2020 2020 2030 2066 6f72 2074 6865         0 for the
-0001c920: 2065 6172 6c69 6573 7420 7469 6d65 2e0a   earliest time..
-0001c930: 2020 2020 2020 2020 3a70 6172 616d 2065          :param e
-0001c940: 6e64 3a20 2020 2020 2020 2020 2020 2020  nd:             
-0001c950: 2020 2020 2020 2020 2020 2054 6865 2065             The e
-0001c960: 6e64 2074 696d 6520 6f66 2074 6865 206d  nd time of the m
-0001c970: 6574 7269 6373 2e20 4361 6e20 6265 2072  etrics. Can be r
-0001c980: 6570 7265 7365 6e74 6564 2062 7920 6120  epresented by a 
-0001c990: 7374 7269 6e67 2063 6f6e 7461 696e 696e  string containin
-0001c9a0: 6720 616e 0a20 2020 2020 2020 2020 2020  g an.           
-0001c9b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c9d0: 5246 4320 3333 3339 2074 696d 652c 2061  RFC 3339 time, a
-0001c9e0: 2055 6e69 7820 7469 6d65 7374 616d 7020   Unix timestamp 
-0001c9f0: 696e 206d 696c 6c69 7365 636f 6e64 732c  in milliseconds,
-0001ca00: 2061 2072 656c 6174 6976 6520 7469 6d65   a relative time
-0001ca10: 2028 6027 6e6f 7727 6020 6f72 0a20 2020   (`'now'` or.   
-0001ca20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ca40: 2020 2020 2020 2020 6027 6e6f 772d 5b30          `'now-[0
-0001ca50: 2d39 5d2b 5b6d 6864 5d27 602c 2077 6865  -9]+[mhd]'`, whe
-0001ca60: 7265 2060 6d60 203d 206d 696e 7574 6573  re `m` = minutes
-0001ca70: 2c20 6068 6020 3d20 686f 7572 732c 2061  , `h` = hours, a
-0001ca80: 6e64 2060 2764 2760 203d 2064 6179 7329  nd `'d'` = days)
-0001ca90: 2c20 6f72 0a20 2020 2020 2020 2020 2020  , or.           
-0001caa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cac0: 3020 666f 7220 7468 6520 6561 726c 6965  0 for the earlie
-0001cad0: 7374 2074 696d 652e 0a20 2020 2020 2020  st time..       
-0001cae0: 203a 7061 7261 6d20 6d65 7472 6963 733a   :param metrics:
-0001caf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb00: 2020 2020 4120 6c69 7374 206f 6620 6d65      A list of me
-0001cb10: 7472 6963 7320 746f 2072 6574 7572 6e20  trics to return 
-0001cb20: 666f 7220 7468 6520 6d6f 6465 6c20 656e  for the model en
-0001cb30: 6470 6f69 6e74 2e20 5468 6572 6520 6172  dpoint. There ar
-0001cb40: 6520 7072 652d 6465 6669 6e65 640a 2020  e pre-defined.  
-0001cb50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cb70: 2020 2020 2020 2020 206d 6574 7269 6373           metrics
-0001cb80: 2066 6f72 206d 6f64 656c 2065 6e64 706f   for model endpo
-0001cb90: 696e 7473 2073 7563 6820 6173 2070 7265  ints such as pre
-0001cba0: 6469 6374 696f 6e73 5f70 6572 5f73 6563  dictions_per_sec
-0001cbb0: 6f6e 6420 616e 640a 2020 2020 2020 2020  ond and.        
-0001cbc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cbe0: 2020 206c 6174 656e 6379 5f61 7667 5f35     latency_avg_5
-0001cbf0: 6d20 6275 7420 616c 736f 2063 7573 746f  m but also custo
-0001cc00: 6d20 6d65 7472 6963 7320 6465 6669 6e65  m metrics define
-0001cc10: 6420 6279 2074 6865 2075 7365 722e 2050  d by the user. P
-0001cc20: 6c65 6173 6520 6e6f 7465 2074 6861 740a  lease note that.
-0001cc30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cc50: 2020 2020 2020 2020 2020 2074 6865 7365             these
-0001cc60: 206d 6574 7269 6373 2061 7265 2073 746f   metrics are sto
-0001cc70: 7265 6420 696e 2074 6865 2074 696d 6520  red in the time 
-0001cc80: 7365 7269 6573 2044 4220 616e 6420 7468  series DB and th
-0001cc90: 6520 7265 7375 6c74 7320 7769 6c6c 2062  e results will b
-0001cca0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001ccb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ccc0: 2020 2020 2020 2020 2020 2020 2061 7070               app
-0001ccd0: 6561 7265 6420 756e 6465 7220 6d6f 6465  eared under mode
-0001cce0: 6c5f 656e 6470 6f69 6e74 2e73 7065 632e  l_endpoint.spec.
-0001ccf0: 6d65 7472 6963 732e 0a20 2020 2020 2020  metrics..       
-0001cd00: 203a 7061 7261 6d20 6665 6174 7572 655f   :param feature_
-0001cd10: 616e 616c 7973 6973 3a20 2020 2020 2020  analysis:       
-0001cd20: 2020 2020 5768 656e 2054 7275 652c 2074      When True, t
-0001cd30: 6865 2062 6173 6520 6665 6174 7572 6520  he base feature 
-0001cd40: 7374 6174 6973 7469 6373 2061 6e64 2063  statistics and c
-0001cd50: 7572 7265 6e74 2066 6561 7475 7265 2073  urrent feature s
-0001cd60: 7461 7469 7374 6963 7320 7769 6c6c 0a20  tatistics will. 
-0001cd70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001cd90: 2020 2020 2020 2020 2020 6265 2061 6464            be add
-0001cda0: 6564 2074 6f20 7468 6520 6f75 7470 7574  ed to the output
-0001cdb0: 206f 6620 7468 6520 7265 7375 6c74 696e   of the resultin
-0001cdc0: 6720 6f62 6a65 6374 2e0a 0a20 2020 2020  g object...     
-0001cdd0: 2020 203a 7265 7475 726e 3a20 4120 604d     :return: A `M
-0001cde0: 6f64 656c 456e 6470 6f69 6e74 6020 6f62  odelEndpoint` ob
-0001cdf0: 6a65 6374 2e0a 2020 2020 2020 2020 2222  ject..        ""
-0001ce00: 220a 0a20 2020 2020 2020 2070 6174 6820  "..        path 
-0001ce10: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
-0001ce20: 6f6a 6563 747d 2f6d 6f64 656c 2d65 6e64  oject}/model-end
-0001ce30: 706f 696e 7473 2f7b 656e 6470 6f69 6e74  points/{endpoint
-0001ce40: 5f69 647d 220a 2020 2020 2020 2020 7265  _id}".        re
-0001ce50: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
-0001ce60: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
-0001ce70: 2020 2020 6d65 7468 6f64 3d22 4745 5422      method="GET"
-0001ce80: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
-0001ce90: 7468 3d70 6174 682c 0a20 2020 2020 2020  th=path,.       
-0001cea0: 2020 2020 2070 6172 616d 733d 7b0a 2020       params={.  
-0001ceb0: 2020 2020 2020 2020 2020 2020 2020 2273                "s
-0001cec0: 7461 7274 223a 2073 7461 7274 2c0a 2020  tart": start,.  
-0001ced0: 2020 2020 2020 2020 2020 2020 2020 2265                "e
-0001cee0: 6e64 223a 2065 6e64 2c0a 2020 2020 2020  nd": end,.      
-0001cef0: 2020 2020 2020 2020 2020 226d 6574 7269            "metri
-0001cf00: 6322 3a20 6d65 7472 6963 7320 6f72 205b  c": metrics or [
-0001cf10: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001cf20: 2020 2022 6665 6174 7572 655f 616e 616c     "feature_anal
-0001cf30: 7973 6973 223a 2066 6561 7475 7265 5f61  ysis": feature_a
-0001cf40: 6e61 6c79 7369 732c 0a20 2020 2020 2020  nalysis,.       
-0001cf50: 2020 2020 207d 2c0a 2020 2020 2020 2020       },.        
-0001cf60: 290a 0a20 2020 2020 2020 2072 6574 7572  )..        retur
-0001cf70: 6e20 6d6c 7275 6e2e 6d6f 6465 6c5f 6d6f  n mlrun.model_mo
-0001cf80: 6e69 746f 7269 6e67 2e6d 6f64 656c 5f65  nitoring.model_e
-0001cf90: 6e64 706f 696e 742e 4d6f 6465 6c45 6e64  ndpoint.ModelEnd
-0001cfa0: 706f 696e 742e 6672 6f6d 5f64 6963 7428  point.from_dict(
-0001cfb0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-0001cfc0: 706f 6e73 652e 6a73 6f6e 2829 0a20 2020  ponse.json().   
-0001cfd0: 2020 2020 2029 0a0a 2020 2020 6465 6620       )..    def 
-0001cfe0: 7061 7463 685f 6d6f 6465 6c5f 656e 6470  patch_model_endp
-0001cff0: 6f69 6e74 280a 2020 2020 2020 2020 7365  oint(.        se
-0001d000: 6c66 2c0a 2020 2020 2020 2020 7072 6f6a  lf,.        proj
-0001d010: 6563 743a 2073 7472 2c0a 2020 2020 2020  ect: str,.      
-0001d020: 2020 656e 6470 6f69 6e74 5f69 643a 2073    endpoint_id: s
-0001d030: 7472 2c0a 2020 2020 2020 2020 6174 7472  tr,.        attr
-0001d040: 6962 7574 6573 3a20 6469 6374 2c0a 2020  ibutes: dict,.  
-0001d050: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0001d060: 0a20 2020 2020 2020 2055 7064 6174 6573  .        Updates
-0001d070: 206d 6f64 656c 2065 6e64 706f 696e 7420   model endpoint 
-0001d080: 7769 7468 2070 726f 7669 6465 6420 6174  with provided at
-0001d090: 7472 6962 7574 6573 2e0a 0a20 2020 2020  tributes...     
-0001d0a0: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
-0001d0b0: 743a 2054 6865 206e 616d 6520 6f66 2074  t: The name of t
-0001d0c0: 6865 2070 726f 6a65 6374 2e0a 2020 2020  he project..    
-0001d0d0: 2020 2020 3a70 6172 616d 2065 6e64 706f      :param endpo
-0001d0e0: 696e 745f 6964 3a20 5468 6520 6964 206f  int_id: The id o
-0001d0f0: 6620 7468 6520 656e 6470 6f69 6e74 2e0a  f the endpoint..
-0001d100: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
-0001d110: 7474 7269 6275 7465 733a 2044 6963 7469  ttributes: Dicti
-0001d120: 6f6e 6172 7920 6f66 2061 7474 7269 6275  onary of attribu
-0001d130: 7465 7320 7468 6174 2077 696c 6c20 6265  tes that will be
-0001d140: 2075 7365 6420 666f 7220 7570 6461 7465   used for update
-0001d150: 2074 6865 206d 6f64 656c 2065 6e64 706f   the model endpo
-0001d160: 696e 742e 2054 6865 206b 6579 730a 2020  int. The keys.  
-0001d170: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d180: 2020 2020 2020 2020 206f 6620 7468 6973           of this
-0001d190: 2064 6963 7469 6f6e 6172 7920 7368 6f75   dictionary shou
-0001d1a0: 6c64 2065 7869 7374 2069 6e20 7468 6520  ld exist in the 
-0001d1b0: 7461 7267 6574 2074 6162 6c65 2e20 4e6f  target table. No
-0001d1c0: 7465 2074 6861 7420 7468 6520 7661 6c75  te that the valu
-0001d1d0: 6573 2073 686f 756c 6420 6265 0a20 2020  es should be.   
-0001d1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d1f0: 2020 2020 2020 2020 6672 6f6d 2074 7970          from typ
-0001d200: 6520 7374 7269 6e67 206f 7220 6672 6f6d  e string or from
-0001d210: 2061 2076 616c 6964 206e 756d 6572 6963   a valid numeric
-0001d220: 616c 2074 7970 6520 7375 6368 2061 7320  al type such as 
-0001d230: 696e 7420 6f72 2066 6c6f 6174 2e0a 2020  int or float..  
+00000250: 0a69 6d70 6f72 7420 7265 0a69 6d70 6f72  .import re.impor
+00000260: 7420 7465 6d70 6669 6c65 0a69 6d70 6f72  t tempfile.impor
+00000270: 7420 7469 6d65 0a69 6d70 6f72 7420 7472  t time.import tr
+00000280: 6163 6562 6163 6b0a 696d 706f 7274 2074  aceback.import t
+00000290: 7970 696e 670a 696d 706f 7274 2077 6172  yping.import war
+000002a0: 6e69 6e67 730a 6672 6f6d 2064 6174 6574  nings.from datet
+000002b0: 696d 6520 696d 706f 7274 2064 6174 6574  ime import datet
+000002c0: 696d 650a 6672 6f6d 206f 7320 696d 706f  ime.from os impo
+000002d0: 7274 2070 6174 682c 2072 656d 6f76 650a  rt path, remove.
+000002e0: 6672 6f6d 2074 7970 696e 6720 696d 706f  from typing impo
+000002f0: 7274 2044 6963 742c 204c 6973 742c 204f  rt Dict, List, O
+00000300: 7074 696f 6e61 6c2c 2055 6e69 6f6e 0a0a  ptional, Union..
+00000310: 696d 706f 7274 206b 6670 0a69 6d70 6f72  import kfp.impor
+00000320: 7420 7265 7175 6573 7473 0a69 6d70 6f72  t requests.impor
+00000330: 7420 7365 6d76 6572 0a0a 696d 706f 7274  t semver..import
+00000340: 206d 6c72 756e 0a69 6d70 6f72 7420 6d6c   mlrun.import ml
+00000350: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00000360: 6173 0a69 6d70 6f72 7420 6d6c 7275 6e2e  as.import mlrun.
+00000370: 6d6f 6465 6c5f 6d6f 6e69 746f 7269 6e67  model_monitoring
+00000380: 2e6d 6f64 656c 5f65 6e64 706f 696e 740a  .model_endpoint.
+00000390: 696d 706f 7274 206d 6c72 756e 2e70 726f  import mlrun.pro
+000003a0: 6a65 6374 730a 6672 6f6d 206d 6c72 756e  jects.from mlrun
+000003b0: 2e65 7272 6f72 7320 696d 706f 7274 204d  .errors import M
+000003c0: 4c52 756e 496e 7661 6c69 6441 7267 756d  LRunInvalidArgum
+000003d0: 656e 7445 7272 6f72 2c20 6572 725f 746f  entError, err_to
+000003e0: 5f73 7472 0a0a 6672 6f6d 202e 2e61 7274  _str..from ..art
+000003f0: 6966 6163 7473 2069 6d70 6f72 7420 4172  ifacts import Ar
+00000400: 7469 6661 6374 0a66 726f 6d20 2e2e 636f  tifact.from ..co
+00000410: 6e66 6967 2069 6d70 6f72 7420 636f 6e66  nfig import conf
+00000420: 6967 0a66 726f 6d20 2e2e 6665 6174 7572  ig.from ..featur
+00000430: 655f 7374 6f72 6520 696d 706f 7274 2046  e_store import F
+00000440: 6561 7475 7265 5365 742c 2046 6561 7475  eatureSet, Featu
+00000450: 7265 5665 6374 6f72 0a66 726f 6d20 2e2e  reVector.from ..
+00000460: 6c69 7374 7320 696d 706f 7274 2041 7274  lists import Art
+00000470: 6966 6163 744c 6973 742c 2052 756e 4c69  ifactList, RunLi
+00000480: 7374 0a66 726f 6d20 2e2e 7275 6e74 696d  st.from ..runtim
+00000490: 6573 2069 6d70 6f72 7420 4261 7365 5275  es import BaseRu
+000004a0: 6e74 696d 650a 6672 6f6d 202e 2e75 7469  ntime.from ..uti
+000004b0: 6c73 2069 6d70 6f72 7420 280a 2020 2020  ls import (.    
+000004c0: 6461 7465 7469 6d65 5f74 6f5f 6973 6f2c  datetime_to_iso,
+000004d0: 0a20 2020 2064 6963 745f 746f 5f6a 736f  .    dict_to_jso
+000004e0: 6e2c 0a20 2020 206c 6f67 6765 722c 0a20  n,.    logger,. 
+000004f0: 2020 206e 6577 5f70 6970 655f 6d65 7461     new_pipe_meta
+00000500: 6461 7461 2c0a 2020 2020 6e6f 726d 616c  data,.    normal
+00000510: 697a 655f 6e61 6d65 2c0a 2020 2020 7665  ize_name,.    ve
+00000520: 7273 696f 6e2c 0a29 0a66 726f 6d20 2e62  rsion,.).from .b
+00000530: 6173 6520 696d 706f 7274 2052 756e 4442  ase import RunDB
+00000540: 4572 726f 722c 2052 756e 4442 496e 7465  Error, RunDBInte
+00000550: 7266 6163 650a 0a5f 6172 7469 6661 6374  rface.._artifact
+00000560: 5f6b 6579 7320 3d20 5b0a 2020 2020 2266  _keys = [.    "f
+00000570: 6f72 6d61 7422 2c0a 2020 2020 2269 6e6c  ormat",.    "inl
+00000580: 696e 6522 2c0a 2020 2020 226b 6579 222c  ine",.    "key",
+00000590: 0a20 2020 2022 7372 635f 7061 7468 222c  .    "src_path",
+000005a0: 0a20 2020 2022 7461 7267 6574 5f70 6174  .    "target_pat
+000005b0: 6822 2c0a 2020 2020 2276 6965 7765 7222  h",.    "viewer"
+000005c0: 2c0a 5d0a 0a0a 6465 6620 626f 6f6c 3273  ,.]...def bool2s
+000005d0: 7472 2876 616c 293a 0a20 2020 2072 6574  tr(val):.    ret
+000005e0: 7572 6e20 2279 6573 2220 6966 2076 616c  urn "yes" if val
+000005f0: 2065 6c73 6520 226e 6f22 0a0a 0a63 6c61   else "no"...cla
+00000600: 7373 2048 5454 5052 756e 4442 2852 756e  ss HTTPRunDB(Run
+00000610: 4442 496e 7465 7266 6163 6529 3a0a 2020  DBInterface):.  
+00000620: 2020 2222 2249 6e74 6572 6661 6365 2066    """Interface f
+00000630: 6f72 2061 6363 6573 7369 6e67 2061 6e64  or accessing and
+00000640: 206d 616e 6970 756c 6174 696e 6720 7468   manipulating th
+00000650: 6520 3a70 793a 6d6f 643a 606d 6c72 756e  e :py:mod:`mlrun
+00000660: 6020 7065 7273 6973 7465 6e74 2073 746f  ` persistent sto
+00000670: 7265 2c20 6d61 696e 7461 696e 696e 6720  re, maintaining 
+00000680: 7468 6520 6675 6c6c 2073 7461 7465 0a20  the full state. 
+00000690: 2020 2061 6e64 2063 6174 616c 6f67 206f     and catalog o
+000006a0: 6620 6f62 6a65 6374 7320 7468 6174 204d  f objects that M
+000006b0: 4c52 756e 2075 7365 732e 2054 6865 203a  LRun uses. The :
+000006c0: 7079 3a63 6c61 7373 3a60 4854 5450 5275  py:class:`HTTPRu
+000006d0: 6e44 4260 2063 6c61 7373 2073 6572 7665  nDB` class serve
+000006e0: 7320 6173 2061 2063 6c69 656e 742d 7369  s as a client-si
+000006f0: 6465 2070 726f 7879 2074 6f20 7468 6520  de proxy to the 
+00000700: 4d4c 5275 6e0a 2020 2020 4150 4920 7365  MLRun.    API se
+00000710: 7276 6963 6520 7768 6963 6820 6d61 696e  rvice which main
+00000720: 7461 696e 7320 7468 6520 6163 7475 616c  tains the actual
+00000730: 2064 6174 612d 7374 6f72 652c 2061 6363   data-store, acc
+00000740: 6573 7365 7320 7468 6520 7365 7276 6572  esses the server
+00000750: 2074 6872 6f75 6768 2052 4553 5420 4150   through REST AP
+00000760: 4973 2e0a 0a20 2020 2054 6865 2063 6c61  Is...    The cla
+00000770: 7373 2070 726f 7669 6465 7320 6675 6e63  ss provides func
+00000780: 7469 6f6e 7320 666f 7220 6163 6365 7373  tions for access
+00000790: 696e 6720 616e 6420 6d6f 6469 6679 696e  ing and modifyin
+000007a0: 6720 7468 6520 7661 7269 6f75 7320 6f62  g the various ob
+000007b0: 6a65 6374 7320 7468 6174 2061 7265 2075  jects that are u
+000007c0: 7365 6420 6279 204d 4c52 756e 2069 6e20  sed by MLRun in 
+000007d0: 6974 730a 2020 2020 6f70 6572 6174 696f  its.    operatio
+000007e0: 6e2e 2054 6865 2066 756e 6374 696f 6e73  n. The functions
+000007f0: 2070 726f 7669 6465 6420 666f 6c6c 6f77   provided follow
+00000800: 2073 6f6d 6520 7374 616e 6461 7264 2067   some standard g
+00000810: 7569 6465 6c69 6e65 732c 2077 6869 6368  uidelines, which
+00000820: 2061 7265 3a0a 0a20 2020 202d 2045 7665   are:..    - Eve
+00000830: 7279 206f 626a 6563 7420 696e 204d 4c52  ry object in MLR
+00000840: 756e 2065 7869 7374 7320 696e 2074 6865  un exists in the
+00000850: 2063 6f6e 7465 7874 206f 6620 6120 7072   context of a pr
+00000860: 6f6a 6563 7420 2865 7863 6570 7420 7072  oject (except pr
+00000870: 6f6a 6563 7473 2074 6865 6d73 656c 7665  ojects themselve
+00000880: 7329 2e20 5768 656e 2072 6566 6572 656e  s). When referen
+00000890: 6369 6e67 2061 6e20 6f62 6a65 6374 0a20  cing an object. 
+000008a0: 2020 2020 2074 6872 6f75 6768 2061 6e79       through any
+000008b0: 2041 5049 2c20 6120 7072 6f6a 6563 7420   API, a project 
+000008c0: 6e61 6d65 206d 7573 7420 6265 2070 726f  name must be pro
+000008d0: 7669 6465 642e 2054 6865 2064 6566 6175  vided. The defau
+000008e0: 6c74 2066 6f72 206d 6f73 7420 4150 4973  lt for most APIs
+000008f0: 2069 7320 666f 7220 616e 2065 6d70 7479   is for an empty
+00000900: 2070 726f 6a65 6374 206e 616d 652c 2077   project name, w
+00000910: 6869 6368 0a20 2020 2020 2077 696c 6c20  hich.      will 
+00000920: 6265 2072 6570 6c61 6365 6420 6279 2074  be replaced by t
+00000930: 6865 206e 616d 6520 6f66 2074 6865 2064  he name of the d
+00000940: 6566 6175 6c74 2070 726f 6a65 6374 2028  efault project (
+00000950: 7573 7561 6c6c 7920 6060 6465 6661 756c  usually ``defaul
+00000960: 7460 6029 2e20 5468 6572 6566 6f72 652c  t``). Therefore,
+00000970: 2069 6620 7065 7266 6f72 6d69 6e67 2061   if performing a
+00000980: 6e20 4150 4920 746f 0a20 2020 2020 206c  n API to.      l
+00000990: 6973 7420 6675 6e63 7469 6f6e 732c 2066  ist functions, f
+000009a0: 6f72 2065 7861 6d70 6c65 2c20 616e 6420  or example, and 
+000009b0: 6e6f 7420 7072 6f76 6964 696e 6720 6120  not providing a 
+000009c0: 7072 6f6a 6563 7420 6e61 6d65 202d 2074  project name - t
+000009d0: 6865 2072 6573 756c 7420 7769 6c6c 206e  he result will n
+000009e0: 6f74 2062 6520 6675 6e63 7469 6f6e 7320  ot be functions 
+000009f0: 6672 6f6d 2061 6c6c 0a20 2020 2020 2070  from all.      p
+00000a00: 726f 6a65 6374 7320 6275 7420 7261 7468  rojects but rath
+00000a10: 6572 2066 726f 6d20 7468 6520 6060 6465  er from the ``de
+00000a20: 6661 756c 7460 6020 7072 6f6a 6563 742e  fault`` project.
+00000a30: 0a20 2020 202d 204d 616e 7920 6f62 6a65  .    - Many obje
+00000a40: 6374 7320 6361 6e20 6265 2061 7373 6967  cts can be assig
+00000a50: 6e65 6420 6c61 6265 6c73 2c20 616e 6420  ned labels, and 
+00000a60: 6c69 7374 6564 2f71 7565 7269 6564 2062  listed/queried b
+00000a70: 7920 6c61 6265 6c2e 2054 6865 206c 6162  y label. The lab
+00000a80: 656c 2070 6172 616d 6574 6572 2066 6f72  el parameter for
+00000a90: 2071 7565 7279 2041 5049 7320 616c 6c6f   query APIs allo
+00000aa0: 7773 2066 6f72 0a20 2020 2020 206c 6973  ws for.      lis
+00000ab0: 7469 6e67 206f 626a 6563 7473 2074 6861  ting objects tha
+00000ac0: 743a 0a0a 2020 2020 2020 2d20 4861 7665  t:..      - Have
+00000ad0: 2061 2073 7065 6369 6669 6320 6c61 6265   a specific labe
+00000ae0: 6c2c 2062 7920 6173 6b69 6e67 2066 6f72  l, by asking for
+00000af0: 2060 606c 6162 656c 3d22 3c6c 6162 656c   ``label="<label
+00000b00: 5f6e 616d 653e 2260 602e 2049 6e20 7468  _name>"``. In th
+00000b10: 6973 2063 6173 6520 7468 6520 6163 7475  is case the actu
+00000b20: 616c 2076 616c 7565 206f 6620 7468 6520  al value of the 
+00000b30: 6c61 6265 6c0a 2020 2020 2020 2020 646f  label.        do
+00000b40: 6573 6e27 7420 6d61 7474 6572 2061 6e64  esn't matter and
+00000b50: 2065 7665 7279 206f 626a 6563 7420 7769   every object wi
+00000b60: 7468 2074 6861 7420 6c61 6265 6c20 7769  th that label wi
+00000b70: 6c6c 2062 6520 7265 7475 726e 6564 0a20  ll be returned. 
+00000b80: 2020 2020 202d 2048 6176 6520 6120 6c61       - Have a la
+00000b90: 6265 6c20 7769 7468 2061 2073 7065 6369  bel with a speci
+00000ba0: 6669 6320 7661 6c75 652e 2054 6869 7320  fic value. This 
+00000bb0: 6973 2064 6f6e 6520 6279 2073 7065 6369  is done by speci
+00000bc0: 6679 696e 6720 6060 6c61 6265 6c3d 223c  fying ``label="<
+00000bd0: 6c61 6265 6c5f 6e61 6d65 3e3d 3c6c 6162  label_name>=<lab
+00000be0: 656c 5f76 616c 7565 3e22 6060 2e20 496e  el_value>"``. In
+00000bf0: 2074 6869 730a 2020 2020 2020 2020 6361   this.        ca
+00000c00: 7365 206f 6e6c 7920 6f62 6a65 6374 7320  se only objects 
+00000c10: 7768 6f73 6520 6c61 6265 6c20 6d61 7463  whose label matc
+00000c20: 6865 7320 7468 6520 7661 6c75 6520 7769  hes the value wi
+00000c30: 6c6c 2062 6520 7265 7475 726e 6564 0a0a  ll be returned..
+00000c40: 2020 2020 2d20 4d6f 7374 206f 626a 6563      - Most objec
+00000c50: 7473 2068 6176 6520 6120 6060 6372 6561  ts have a ``crea
+00000c60: 7465 6060 206d 6574 686f 6420 6173 2077  te`` method as w
+00000c70: 656c 6c20 6173 2061 2060 6073 746f 7265  ell as a ``store
+00000c80: 6060 206d 6574 686f 642e 2043 7265 6174  `` method. Creat
+00000c90: 6520 6361 6e20 6f6e 6c79 2062 6520 6361  e can only be ca
+00000ca0: 6c6c 6564 2077 6865 6e20 7375 6368 2061  lled when such a
+00000cb0: 6e0a 2020 2020 2020 646f 6573 206e 6f74  n.      does not
+00000cc0: 2065 7869 7374 2079 6574 2c20 7768 696c   exist yet, whil
+00000cd0: 6520 7374 6f72 6520 616c 6c6f 7773 2066  e store allows f
+00000ce0: 6f72 2065 6974 6865 7220 6372 6561 7469  or either creati
+00000cf0: 6e67 2061 206e 6577 206f 626a 6563 7420  ng a new object 
+00000d00: 6f72 206f 7665 7277 7269 7469 6e67 2061  or overwriting a
+00000d10: 6e20 6578 6973 7469 6e67 206f 626a 6563  n existing objec
+00000d20: 742e 0a20 2020 202d 2053 6f6d 6520 6f62  t..    - Some ob
+00000d30: 6a65 6374 7320 6861 7665 2061 2060 6076  jects have a ``v
+00000d40: 6572 7369 6f6e 6564 6060 206f 7074 696f  ersioned`` optio
+00000d50: 6e2c 2069 6e20 7768 6963 6820 6361 7365  n, in which case
+00000d60: 206f 7665 7277 7269 7469 6e67 2074 6865   overwriting the
+00000d70: 2073 616d 6520 6f62 6a65 6374 2077 6974   same object wit
+00000d80: 6820 6120 6469 6666 6572 656e 7420 7665  h a different ve
+00000d90: 7273 696f 6e20 6f66 0a20 2020 2020 2069  rsion of.      i
+00000da0: 7420 646f 6573 206e 6f74 2064 656c 6574  t does not delet
+00000db0: 6520 7468 6520 7072 6576 696f 7573 2076  e the previous v
+00000dc0: 6572 7369 6f6e 2c20 6275 7420 7261 7468  ersion, but rath
+00000dd0: 6572 2063 7265 6174 6573 2061 206e 6577  er creates a new
+00000de0: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
+00000df0: 6f62 6a65 6374 2061 6e64 206b 6565 7073  object and keeps
+00000e00: 2062 6f74 6820 7665 7273 696f 6e73 2e0a   both versions..
+00000e10: 2020 2020 2020 5665 7273 696f 6e65 6420        Versioned 
+00000e20: 6f62 6a65 6374 7320 7573 7561 6c6c 7920  objects usually 
+00000e30: 6861 7665 2061 2060 6075 6964 6060 2070  have a ``uid`` p
+00000e40: 726f 7065 7274 7920 7768 6963 6820 6973  roperty which is
+00000e50: 2062 6173 6564 206f 6e20 7468 6569 7220   based on their 
+00000e60: 636f 6e74 656e 7420 616e 6420 616c 6c6f  content and allo
+00000e70: 7773 2074 6f20 7265 6665 7265 6e63 6520  ws to reference 
+00000e80: 610a 2020 2020 2020 7370 6563 6966 6963  a.      specific
+00000e90: 2076 6572 7369 6f6e 206f 6620 616e 206f   version of an o
+00000ea0: 626a 6563 7420 286f 7468 6572 2074 6861  bject (other tha
+00000eb0: 6e20 7461 6767 696e 6720 6f62 6a65 6374  n tagging object
+00000ec0: 732c 2077 6869 6368 2061 6c73 6f20 616c  s, which also al
+00000ed0: 6c6f 7773 2066 6f72 2065 6173 7920 7265  lows for easy re
+00000ee0: 6665 7265 6e63 696e 6729 2e0a 2020 2020  ferencing)..    
+00000ef0: 2d20 4d61 6e79 206f 626a 6563 7473 2068  - Many objects h
+00000f00: 6176 6520 626f 7468 2061 2060 6073 746f  ave both a ``sto
+00000f10: 7265 6060 2066 756e 6374 696f 6e20 616e  re`` function an
+00000f20: 6420 6120 6060 7061 7463 6860 6020 6675  d a ``patch`` fu
+00000f30: 6e63 7469 6f6e 2e20 5468 6573 6520 6172  nction. These ar
+00000f40: 6520 7573 6564 2069 6e20 7468 6520 7361  e used in the sa
+00000f50: 6d65 2077 6179 2061 7320 7468 650a 2020  me way as the.  
+00000f60: 2020 2020 636f 7272 6573 706f 6e64 696e      correspondin
+00000f70: 6720 5245 5354 2076 6572 6273 202d 2061  g REST verbs - a
+00000f80: 2060 6073 746f 7265 6060 2069 7320 7061   ``store`` is pa
+00000f90: 7373 6564 2061 2066 756c 6c20 6f62 6a65  ssed a full obje
+00000fa0: 6374 2061 6e64 2077 696c 6c20 6261 7369  ct and will basi
+00000fb0: 6361 6c6c 7920 7065 7266 6f72 6d20 6120  cally perform a 
+00000fc0: 5055 5420 6f70 6572 6174 696f 6e2c 0a20  PUT operation,. 
+00000fd0: 2020 2020 2072 6570 6c61 6369 6e67 2074       replacing t
+00000fe0: 6865 2066 756c 6c20 6f62 6a65 6374 2028  he full object (
+00000ff0: 6966 2069 7420 6578 6973 7473 2920 7768  if it exists) wh
+00001000: 696c 6520 6060 7061 7463 6860 6020 7265  ile ``patch`` re
+00001010: 6365 6976 6573 206a 7573 7420 6120 6469  ceives just a di
+00001020: 6374 696f 6e61 7279 2063 6f6e 7461 696e  ctionary contain
+00001030: 696e 6720 7468 6520 6469 6666 6572 656e  ing the differen
+00001040: 6365 7320 746f 0a20 2020 2020 2062 6520  ces to.      be 
+00001050: 6170 706c 6965 6420 746f 2074 6865 206f  applied to the o
+00001060: 626a 6563 742c 2061 6e64 2077 696c 6c20  bject, and will 
+00001070: 6d65 7267 6520 7468 6f73 6520 6368 616e  merge those chan
+00001080: 6765 7320 746f 2074 6865 2065 7869 7374  ges to the exist
+00001090: 696e 6720 6f62 6a65 6374 2e20 5468 6520  ing object. The 
+000010a0: 6060 7061 7463 6860 600a 2020 2020 2020  ``patch``.      
+000010b0: 6f70 6572 6174 696f 6e20 616c 736f 2068  operation also h
+000010c0: 6173 2061 2073 7472 6174 6567 7920 6173  as a strategy as
+000010d0: 7369 676e 6564 2074 6f20 6974 2077 6869  signed to it whi
+000010e0: 6368 2064 6574 6572 6d69 6e65 7320 686f  ch determines ho
+000010f0: 7720 7468 6520 6d65 7267 6520 6c6f 6769  w the merge logi
+00001100: 6320 7368 6f75 6c64 2062 6568 6176 652e  c should behave.
+00001110: 0a20 2020 2020 2054 6865 2073 7472 6174  .      The strat
+00001120: 6567 7920 6361 6e20 6265 2065 6974 6865  egy can be eithe
+00001130: 7220 6060 7265 706c 6163 6560 6020 6f72  r ``replace`` or
+00001140: 2060 6061 6464 6974 6976 6560 602e 2046   ``additive``. F
+00001150: 6f72 2066 7572 7468 6572 2064 6574 6169  or further detai
+00001160: 6c73 206f 6e20 7468 6f73 6520 7374 7261  ls on those stra
+00001170: 7465 6769 6573 2c20 7265 6665 720a 2020  tegies, refer.  
+00001180: 2020 2020 746f 2068 7474 7073 3a2f 2f70      to https://p
+00001190: 7970 692e 6f72 672f 7072 6f6a 6563 742f  ypi.org/project/
+000011a0: 6d65 7267 6564 6565 702f 0a20 2020 2022  mergedeep/.    "
+000011b0: 2222 0a0a 2020 2020 6b69 6e64 203d 2022  ""..    kind = "
+000011c0: 6874 7470 220a 2020 2020 2320 6279 2064  http".    # by d
+000011d0: 6566 6175 6c74 2077 6520 646f 6e27 7420  efault we don't 
+000011e0: 7265 7472 7920 6f6e 2050 4f53 5420 7265  retry on POST re
+000011f0: 7175 6573 7420 6173 2074 6865 7920 6172  quest as they ar
+00001200: 6520 7573 7561 6c6c 7920 6e6f 7420 6964  e usually not id
+00001210: 656d 706f 7465 6e74 0a20 2020 2023 2068  empotent.    # h
+00001220: 6572 6520 6973 2061 206c 6973 7420 6f66  ere is a list of
+00001230: 2069 6465 6e74 6966 6965 6420 504f 5354   identified POST
+00001240: 2072 6571 7565 7374 7320 7468 6174 2061   requests that a
+00001250: 7265 2069 6465 6d70 6f74 656e 7420 2827  re idempotent ('
+00001260: 7374 6f72 6527 2076 7320 2763 7265 6174  store' vs 'creat
+00001270: 6527 2920 616e 6420 6361 6e20 6265 2072  e') and can be r
+00001280: 6574 7269 6564 0a20 2020 2052 4554 5249  etried.    RETRI
+00001290: 4142 4c45 5f50 4f53 545f 5041 5448 5320  ABLE_POST_PATHS 
+000012a0: 3d20 5b0a 2020 2020 2020 2020 7222 5c2f  = [.        r"\/
+000012b0: 3f70 726f 6a65 6374 735c 2f2e 2b5c 2f61  ?projects\/.+\/a
+000012c0: 7274 6966 6163 7473 5c2f 2e2b 5c2f 2e2b  rtifacts\/.+\/.+
+000012d0: 222c 0a20 2020 2020 2020 2072 225c 2f3f  ",.        r"\/?
+000012e0: 7275 6e5c 2f2e 2b5c 2f2e 2b22 2c0a 2020  run\/.+\/.+",.  
+000012f0: 2020 5d0a 0a20 2020 2064 6566 205f 5f69    ]..    def __i
+00001300: 6e69 745f 5f28 7365 6c66 2c20 6261 7365  nit__(self, base
+00001310: 5f75 726c 2c20 7573 6572 3d22 222c 2070  _url, user="", p
+00001320: 6173 7377 6f72 643d 2222 2c20 746f 6b65  assword="", toke
+00001330: 6e3d 2222 293a 0a20 2020 2020 2020 2073  n=""):.        s
+00001340: 656c 662e 6261 7365 5f75 726c 203d 2062  elf.base_url = b
+00001350: 6173 655f 7572 6c0a 2020 2020 2020 2020  ase_url.        
+00001360: 7365 6c66 2e75 7365 7220 3d20 7573 6572  self.user = user
+00001370: 0a20 2020 2020 2020 2073 656c 662e 7061  .        self.pa
+00001380: 7373 776f 7264 203d 2070 6173 7377 6f72  ssword = passwor
+00001390: 640a 2020 2020 2020 2020 7365 6c66 2e74  d.        self.t
+000013a0: 6f6b 656e 203d 2074 6f6b 656e 0a20 2020  oken = token.   
+000013b0: 2020 2020 2073 656c 662e 7365 7276 6572       self.server
+000013c0: 5f76 6572 7369 6f6e 203d 2022 220a 2020  _version = "".  
+000013d0: 2020 2020 2020 7365 6c66 2e73 6573 7369        self.sessi
+000013e0: 6f6e 203d 204e 6f6e 650a 2020 2020 2020  on = None.      
+000013f0: 2020 7365 6c66 2e5f 7761 6974 5f66 6f72    self._wait_for
+00001400: 5f70 726f 6a65 6374 5f74 6572 6d69 6e61  _project_termina
+00001410: 6c5f 7374 6174 655f 7265 7472 795f 696e  l_state_retry_in
+00001420: 7465 7276 616c 203d 2033 0a20 2020 2020  terval = 3.     
+00001430: 2020 2073 656c 662e 5f77 6169 745f 666f     self._wait_fo
+00001440: 725f 6261 636b 6772 6f75 6e64 5f74 6173  r_background_tas
+00001450: 6b5f 7465 726d 696e 616c 5f73 7461 7465  k_terminal_state
+00001460: 5f72 6574 7279 5f69 6e74 6572 7661 6c20  _retry_interval 
+00001470: 3d20 330a 2020 2020 2020 2020 7365 6c66  = 3.        self
+00001480: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
+00001490: 6374 5f64 656c 6574 696f 6e5f 696e 7465  ct_deletion_inte
+000014a0: 7276 616c 203d 2033 0a20 2020 2020 2020  rval = 3.       
+000014b0: 2073 656c 662e 636c 6965 6e74 5f76 6572   self.client_ver
+000014c0: 7369 6f6e 203d 2076 6572 7369 6f6e 2e56  sion = version.V
+000014d0: 6572 7369 6f6e 2829 2e67 6574 2829 5b22  ersion().get()["
+000014e0: 7665 7273 696f 6e22 5d0a 2020 2020 2020  version"].      
+000014f0: 2020 7365 6c66 2e70 7974 686f 6e5f 7665    self.python_ve
+00001500: 7273 696f 6e20 3d20 7374 7228 7665 7273  rsion = str(vers
+00001510: 696f 6e2e 5665 7273 696f 6e28 292e 6765  ion.Version().ge
+00001520: 745f 7079 7468 6f6e 5f76 6572 7369 6f6e  t_python_version
+00001530: 2829 290a 0a20 2020 2064 6566 205f 5f72  ())..    def __r
+00001540: 6570 725f 5f28 7365 6c66 293a 0a20 2020  epr__(self):.   
+00001550: 2020 2020 2063 6c73 203d 2073 656c 662e       cls = self.
+00001560: 5f5f 636c 6173 735f 5f2e 5f5f 6e61 6d65  __class__.__name
+00001570: 5f5f 0a20 2020 2020 2020 2072 6574 7572  __.        retur
+00001580: 6e20 6622 7b63 6c73 7d28 7b73 656c 662e  n f"{cls}({self.
+00001590: 6261 7365 5f75 726c 2172 7d29 220a 0a20  base_url!r})".. 
+000015a0: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+000015b0: 0a20 2020 2064 6566 2067 6574 5f61 7069  .    def get_api
+000015c0: 5f70 6174 685f 7072 6566 6978 2876 6572  _path_prefix(ver
+000015d0: 7369 6f6e 3a20 7374 7220 3d20 4e6f 6e65  sion: str = None
+000015e0: 2920 2d3e 2073 7472 3a0a 2020 2020 2020  ) -> str:.      
+000015f0: 2020 2222 220a 2020 2020 2020 2020 3a70    """.        :p
+00001600: 6172 616d 2076 6572 7369 6f6e 3a20 4150  aram version: AP
+00001610: 4920 7665 7273 696f 6e20 746f 2075 7365  I version to use
+00001620: 2c20 4e6f 6e65 2028 7468 6520 6465 6661  , None (the defa
+00001630: 756c 7429 2077 696c 6c20 6d65 616e 2074  ult) will mean t
+00001640: 6f20 7573 6520 7468 6520 6465 6661 756c  o use the defaul
+00001650: 7420 7661 6c75 6520 6672 6f6d 206d 6c63  t value from mlc
+00001660: 6f6e 662c 0a20 2020 2020 2020 2020 666f  onf,.         fo
+00001670: 7220 756e 2d76 6572 7369 6f6e 6564 2061  r un-versioned a
+00001680: 7069 2073 6574 2061 6e20 656d 7074 7920  pi set an empty 
+00001690: 7374 7269 6e67 2e0a 2020 2020 2020 2020  string..        
+000016a0: 2222 220a 2020 2020 2020 2020 6966 2076  """.        if v
+000016b0: 6572 7369 6f6e 2069 7320 6e6f 7420 4e6f  ersion is not No
+000016c0: 6e65 3a0a 2020 2020 2020 2020 2020 2020  ne:.            
+000016d0: 7265 7475 726e 2066 2261 7069 2f7b 7665  return f"api/{ve
+000016e0: 7273 696f 6e7d 2220 6966 2076 6572 7369  rsion}" if versi
+000016f0: 6f6e 2065 6c73 6520 2261 7069 220a 0a20  on else "api".. 
+00001700: 2020 2020 2020 2061 7069 5f76 6572 7369         api_versi
+00001710: 6f6e 5f70 6174 6820 3d20 280a 2020 2020  on_path = (.    
+00001720: 2020 2020 2020 2020 6622 6170 692f 7b63          f"api/{c
+00001730: 6f6e 6669 672e 6170 695f 6261 7365 5f76  onfig.api_base_v
+00001740: 6572 7369 6f6e 7d22 2069 6620 636f 6e66  ersion}" if conf
+00001750: 6967 2e61 7069 5f62 6173 655f 7665 7273  ig.api_base_vers
+00001760: 696f 6e20 656c 7365 2022 6170 6922 0a20  ion else "api". 
+00001770: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00001780: 2072 6574 7572 6e20 6170 695f 7665 7273   return api_vers
+00001790: 696f 6e5f 7061 7468 0a0a 2020 2020 6465  ion_path..    de
+000017a0: 6620 6765 745f 6261 7365 5f61 7069 5f75  f get_base_api_u
+000017b0: 726c 2873 656c 662c 2070 6174 683a 2073  rl(self, path: s
+000017c0: 7472 2c20 7665 7273 696f 6e3a 2073 7472  tr, version: str
+000017d0: 203d 204e 6f6e 6529 202d 3e20 7374 723a   = None) -> str:
+000017e0: 0a20 2020 2020 2020 2070 6174 685f 7072  .        path_pr
+000017f0: 6566 6978 203d 2073 656c 662e 6765 745f  efix = self.get_
+00001800: 6170 695f 7061 7468 5f70 7265 6669 7828  api_path_prefix(
+00001810: 7665 7273 696f 6e29 0a20 2020 2020 2020  version).       
+00001820: 2075 726c 203d 2066 227b 7365 6c66 2e62   url = f"{self.b
+00001830: 6173 655f 7572 6c7d 2f7b 7061 7468 5f70  ase_url}/{path_p
+00001840: 7265 6669 787d 2f7b 7061 7468 7d22 0a20  refix}/{path}". 
+00001850: 2020 2020 2020 2072 6574 7572 6e20 7572         return ur
+00001860: 6c0a 0a20 2020 2064 6566 2061 7069 5f63  l..    def api_c
+00001870: 616c 6c28 0a20 2020 2020 2020 2073 656c  all(.        sel
+00001880: 662c 0a20 2020 2020 2020 206d 6574 686f  f,.        metho
+00001890: 642c 0a20 2020 2020 2020 2070 6174 682c  d,.        path,
+000018a0: 0a20 2020 2020 2020 2065 7272 6f72 3d4e  .        error=N
+000018b0: 6f6e 652c 0a20 2020 2020 2020 2070 6172  one,.        par
+000018c0: 616d 733d 4e6f 6e65 2c0a 2020 2020 2020  ams=None,.      
+000018d0: 2020 626f 6479 3d4e 6f6e 652c 0a20 2020    body=None,.   
+000018e0: 2020 2020 206a 736f 6e3d 4e6f 6e65 2c0a       json=None,.
+000018f0: 2020 2020 2020 2020 6865 6164 6572 733d          headers=
+00001900: 4e6f 6e65 2c0a 2020 2020 2020 2020 7469  None,.        ti
+00001910: 6d65 6f75 743d 3435 2c0a 2020 2020 2020  meout=45,.      
+00001920: 2020 7665 7273 696f 6e3d 4e6f 6e65 2c0a    version=None,.
+00001930: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+00001940: 2222 5065 7266 6f72 6d20 6120 6469 7265  ""Perform a dire
+00001950: 6374 2052 4553 5420 4150 4920 6361 6c6c  ct REST API call
+00001960: 206f 6e20 7468 6520 3a70 793a 6d6f 643a   on the :py:mod:
+00001970: 606d 6c72 756e 6020 4150 4920 7365 7276  `mlrun` API serv
+00001980: 6572 2e0a 0a20 2020 2020 2020 2043 6175  er...        Cau
+00001990: 7469 6f6e 3a0a 2020 2020 2020 2020 2020  tion:.          
+000019a0: 2020 466f 7220 6164 7661 6e63 6564 2075    For advanced u
+000019b0: 7361 6765 202d 2070 7265 6665 7220 7573  sage - prefer us
+000019c0: 696e 6720 7468 6520 7661 7269 6f75 7320  ing the various 
+000019d0: 4150 4973 2065 7870 6f73 6564 2074 6872  APIs exposed thr
+000019e0: 6f75 6768 2074 6869 7320 636c 6173 732c  ough this class,
+000019f0: 2072 6174 6865 7220 7468 616e 0a20 2020   rather than.   
+00001a00: 2020 2020 2020 2020 2064 6972 6563 746c           directl
+00001a10: 7920 696e 766f 6b69 6e67 2052 4553 5420  y invoking REST 
+00001a20: 6361 6c6c 732e 0a0a 2020 2020 2020 2020  calls...        
+00001a30: 3a70 6172 616d 206d 6574 686f 643a 2052  :param method: R
+00001a40: 4553 5420 6d65 7468 6f64 2028 504f 5354  EST method (POST
+00001a50: 2c20 4745 542c 2050 5554 2e2e 2e29 0a20  , GET, PUT...). 
+00001a60: 2020 2020 2020 203a 7061 7261 6d20 7061         :param pa
+00001a70: 7468 3a20 5061 7468 2074 6f20 656e 6470  th: Path to endp
+00001a80: 6f69 6e74 2065 7865 6375 7465 642c 2066  oint executed, f
+00001a90: 6f72 2065 7861 6d70 6c65 2060 6022 7072  or example ``"pr
+00001aa0: 6f6a 6563 7473 2260 600a 2020 2020 2020  ojects"``.      
+00001ab0: 2020 3a70 6172 616d 2065 7272 6f72 3a20    :param error: 
+00001ac0: 4572 726f 7220 746f 2072 6574 7572 6e20  Error to return 
+00001ad0: 6966 2041 5049 2069 6e76 6f63 6174 696f  if API invocatio
+00001ae0: 6e20 6661 696c 730a 2020 2020 2020 2020  n fails.        
+00001af0: 3a70 6172 616d 2070 6172 616d 733a 2052  :param params: R
+00001b00: 6573 7420 7061 7261 6d65 7465 7273 2c20  est parameters, 
+00001b10: 7061 7373 6564 2061 7320 6120 6469 6374  passed as a dict
+00001b20: 696f 6e61 7279 3a20 6060 7b22 3c70 6172  ionary: ``{"<par
+00001b30: 616d 2d6e 616d 653e 223a 203c 2270 6172  am-name>": <"par
+00001b40: 616d 2d76 616c 7565 223e 7d60 600a 2020  am-value">}``.  
+00001b50: 2020 2020 2020 3a70 6172 616d 2062 6f64        :param bod
+00001b60: 793a 2050 6179 6c6f 6164 2074 6f20 6265  y: Payload to be
+00001b70: 2070 6173 7365 6420 696e 2074 6865 2063   passed in the c
+00001b80: 616c 6c2e 2049 6620 7573 696e 6720 4a53  all. If using JS
+00001b90: 4f4e 206f 626a 6563 7473 2c20 7072 6566  ON objects, pref
+00001ba0: 6572 2075 7369 6e67 2074 6865 2060 606a  er using the ``j
+00001bb0: 736f 6e60 6020 7061 7261 6d0a 2020 2020  son`` param.    
+00001bc0: 2020 2020 3a70 6172 616d 206a 736f 6e3a      :param json:
+00001bd0: 204a 534f 4e20 7061 796c 6f61 6420 746f   JSON payload to
+00001be0: 2062 6520 7061 7373 6564 2069 6e20 7468   be passed in th
+00001bf0: 6520 6361 6c6c 0a20 2020 2020 2020 203a  e call.        :
+00001c00: 7061 7261 6d20 6865 6164 6572 733a 2052  param headers: R
+00001c10: 4553 5420 6865 6164 6572 732c 2070 6173  EST headers, pas
+00001c20: 7365 6420 6173 2061 2064 6963 7469 6f6e  sed as a diction
+00001c30: 6172 793a 2060 607b 223c 6865 6164 6572  ary: ``{"<header
+00001c40: 2d6e 616d 653e 223a 2022 3c68 6561 6465  -name>": "<heade
+00001c50: 722d 7661 6c75 653e 227d 6060 0a20 2020  r-value>"}``.   
+00001c60: 2020 2020 203a 7061 7261 6d20 7469 6d65       :param time
+00001c70: 6f75 743a 2041 5049 2063 616c 6c20 7469  out: API call ti
+00001c80: 6d65 6f75 740a 2020 2020 2020 2020 3a70  meout.        :p
+00001c90: 6172 616d 2076 6572 7369 6f6e 3a20 4150  aram version: AP
+00001ca0: 4920 7665 7273 696f 6e20 746f 2075 7365  I version to use
+00001cb0: 2c20 4e6f 6e65 2028 7468 6520 6465 6661  , None (the defa
+00001cc0: 756c 7429 2077 696c 6c20 6d65 616e 2074  ult) will mean t
+00001cd0: 6f20 7573 6520 7468 6520 6465 6661 756c  o use the defaul
+00001ce0: 7420 7661 6c75 6520 6672 6f6d 2063 6f6e  t value from con
+00001cf0: 6669 672c 0a20 2020 2020 2020 2020 666f  fig,.         fo
+00001d00: 7220 756e 2d76 6572 7369 6f6e 6564 2061  r un-versioned a
+00001d10: 7069 2073 6574 2061 6e20 656d 7074 7920  pi set an empty 
+00001d20: 7374 7269 6e67 2e0a 0a20 2020 2020 2020  string...       
+00001d30: 203a 7265 7475 726e 3a20 5079 7468 6f6e   :return: Python
+00001d40: 2048 5454 5020 7265 7370 6f6e 7365 206f   HTTP response o
+00001d50: 626a 6563 740a 2020 2020 2020 2020 2222  bject.        ""
+00001d60: 220a 2020 2020 2020 2020 7572 6c20 3d20  ".        url = 
+00001d70: 7365 6c66 2e67 6574 5f62 6173 655f 6170  self.get_base_ap
+00001d80: 695f 7572 6c28 7061 7468 2c20 7665 7273  i_url(path, vers
+00001d90: 696f 6e29 0a20 2020 2020 2020 206b 7720  ion).        kw 
+00001da0: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00001db0: 6b65 793a 2076 616c 7565 0a20 2020 2020  key: value.     
+00001dc0: 2020 2020 2020 2066 6f72 206b 6579 2c20         for key, 
+00001dd0: 7661 6c75 6520 696e 2028 0a20 2020 2020  value in (.     
+00001de0: 2020 2020 2020 2020 2020 2028 2270 6172             ("par
+00001df0: 616d 7322 2c20 7061 7261 6d73 292c 0a20  ams", params),. 
+00001e00: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00001e10: 2264 6174 6122 2c20 626f 6479 292c 0a20  "data", body),. 
+00001e20: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00001e30: 226a 736f 6e22 2c20 6a73 6f6e 292c 0a20  "json", json),. 
+00001e40: 2020 2020 2020 2020 2020 2020 2020 2028                 (
+00001e50: 2268 6561 6465 7273 222c 2068 6561 6465  "headers", heade
+00001e60: 7273 292c 0a20 2020 2020 2020 2020 2020  rs),.           
+00001e70: 2029 0a20 2020 2020 2020 2020 2020 2069   ).            i
+00001e80: 6620 7661 6c75 6520 6973 206e 6f74 204e  f value is not N
+00001e90: 6f6e 650a 2020 2020 2020 2020 7d0a 0a20  one.        }.. 
+00001ea0: 2020 2020 2020 2069 6620 7365 6c66 2e75         if self.u
+00001eb0: 7365 723a 0a20 2020 2020 2020 2020 2020  ser:.           
+00001ec0: 206b 775b 2261 7574 6822 5d20 3d20 2873   kw["auth"] = (s
+00001ed0: 656c 662e 7573 6572 2c20 7365 6c66 2e70  elf.user, self.p
+00001ee0: 6173 7377 6f72 6429 0a20 2020 2020 2020  assword).       
+00001ef0: 2065 6c69 6620 7365 6c66 2e74 6f6b 656e   elif self.token
+00001f00: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
+00001f10: 4967 7561 7a69 6f20 6175 7468 2064 6f65  Iguazio auth doe
+00001f20: 736e 2774 2073 7570 706f 7274 2070 6173  sn't support pas
+00001f30: 7369 6e67 2074 6f6b 656e 2074 6872 6f75  sing token throu
+00001f40: 6768 2062 6561 7265 722c 2073 6f20 7573  gh bearer, so us
+00001f50: 6520 636f 6f6b 6965 2069 6e73 7465 6164  e cookie instead
+00001f60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00001f70: 6d6c 7275 6e2e 706c 6174 666f 726d 732e  mlrun.platforms.
+00001f80: 6967 7561 7a69 6f2e 6973 5f69 6775 617a  iguazio.is_iguaz
+00001f90: 696f 5f73 6573 7369 6f6e 2873 656c 662e  io_session(self.
+00001fa0: 746f 6b65 6e29 3a0a 2020 2020 2020 2020  token):.        
+00001fb0: 2020 2020 2020 2020 7365 7373 696f 6e5f          session_
+00001fc0: 636f 6f6b 6965 203d 2066 276a 3a7b 7b22  cookie = f'j:{{"
+00001fd0: 7369 6422 3a20 227b 7365 6c66 2e74 6f6b  sid": "{self.tok
+00001fe0: 656e 7d22 7d7d 270a 2020 2020 2020 2020  en}"}}'.        
+00001ff0: 2020 2020 2020 2020 636f 6f6b 6965 7320          cookies 
+00002000: 3d20 7b0a 2020 2020 2020 2020 2020 2020  = {.            
+00002010: 2020 2020 2020 2020 2273 6573 7369 6f6e          "session
+00002020: 223a 2073 6573 7369 6f6e 5f63 6f6f 6b69  ": session_cooki
+00002030: 652c 0a20 2020 2020 2020 2020 2020 2020  e,.             
+00002040: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00002050: 2020 2020 206b 775b 2263 6f6f 6b69 6573       kw["cookies
+00002060: 225d 203d 2063 6f6f 6b69 6573 0a20 2020  "] = cookies.   
+00002070: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00002080: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00002090: 6620 2241 7574 686f 7269 7a61 7469 6f6e  f "Authorization
+000020a0: 2220 6e6f 7420 696e 206b 772e 7365 7464  " not in kw.setd
+000020b0: 6566 6175 6c74 2822 6865 6164 6572 7322  efault("headers"
+000020c0: 2c20 7b7d 293a 0a20 2020 2020 2020 2020  , {}):.         
+000020d0: 2020 2020 2020 2020 2020 206b 775b 2268             kw["h
+000020e0: 6561 6465 7273 225d 2e75 7064 6174 6528  eaders"].update(
+000020f0: 7b22 4175 7468 6f72 697a 6174 696f 6e22  {"Authorization"
+00002100: 3a20 2242 6561 7265 7220 2220 2b20 7365  : "Bearer " + se
+00002110: 6c66 2e74 6f6b 656e 7d29 0a0a 2020 2020  lf.token})..    
+00002120: 2020 2020 6966 206d 6c72 756e 2e63 6f6d      if mlrun.com
+00002130: 6d6f 6e2e 7363 6865 6d61 732e 4865 6164  mon.schemas.Head
+00002140: 6572 4e61 6d65 732e 636c 6965 6e74 5f76  erNames.client_v
+00002150: 6572 7369 6f6e 206e 6f74 2069 6e20 6b77  ersion not in kw
+00002160: 2e73 6574 6465 6661 756c 7428 0a20 2020  .setdefault(.   
+00002170: 2020 2020 2020 2020 2022 6865 6164 6572           "header
+00002180: 7322 2c20 7b7d 0a20 2020 2020 2020 2029  s", {}.        )
+00002190: 3a0a 2020 2020 2020 2020 2020 2020 6b77  :.            kw
+000021a0: 5b22 6865 6164 6572 7322 5d2e 7570 6461  ["headers"].upda
+000021b0: 7465 280a 2020 2020 2020 2020 2020 2020  te(.            
+000021c0: 2020 2020 7b0a 2020 2020 2020 2020 2020      {.          
+000021d0: 2020 2020 2020 2020 2020 6d6c 7275 6e2e            mlrun.
+000021e0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e48  common.schemas.H
+000021f0: 6561 6465 724e 616d 6573 2e63 6c69 656e  eaderNames.clien
+00002200: 745f 7665 7273 696f 6e3a 2073 656c 662e  t_version: self.
+00002210: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
+00002220: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002230: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
+00002240: 2e73 6368 656d 6173 2e48 6561 6465 724e  .schemas.HeaderN
+00002250: 616d 6573 2e70 7974 686f 6e5f 7665 7273  ames.python_vers
+00002260: 696f 6e3a 2073 656c 662e 7079 7468 6f6e  ion: self.python
+00002270: 5f76 6572 7369 6f6e 2c0a 2020 2020 2020  _version,.      
+00002280: 2020 2020 2020 2020 2020 7d0a 2020 2020            }.    
+00002290: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000022a0: 2020 2023 2072 6571 7565 7374 7320 6e6f     # requests no
+000022b0: 206c 6f6e 6765 7220 7375 7070 6f72 7473   longer supports
+000022c0: 2068 6561 6465 7220 7661 6c75 6573 2074   header values t
+000022d0: 6f20 6265 2065 6e75 6d20 2868 7474 7073  o be enum (https
+000022e0: 3a2f 2f67 6974 6875 622e 636f 6d2f 7073  ://github.com/ps
+000022f0: 662f 7265 7175 6573 7473 2f70 756c 6c2f  f/requests/pull/
+00002300: 3631 3534 290a 2020 2020 2020 2020 2320  6154).        # 
+00002310: 636f 6e76 6572 7420 746f 2073 7472 696e  convert to strin
+00002320: 6773 2e20 446f 2074 6865 2073 616d 6520  gs. Do the same 
+00002330: 666f 7220 7061 7261 6d73 2066 6f72 206e  for params for n
+00002340: 6963 656e 6573 730a 2020 2020 2020 2020  iceness.        
+00002350: 666f 7220 6469 6374 5f20 696e 205b 6865  for dict_ in [he
+00002360: 6164 6572 732c 2070 6172 616d 735d 3a0a  aders, params]:.
+00002370: 2020 2020 2020 2020 2020 2020 6966 2064              if d
+00002380: 6963 745f 2069 7320 6e6f 7420 4e6f 6e65  ict_ is not None
+00002390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000023a0: 2020 666f 7220 6b65 7920 696e 2064 6963    for key in dic
+000023b0: 745f 2e6b 6579 7328 293a 0a20 2020 2020  t_.keys():.     
+000023c0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000023d0: 6620 6973 696e 7374 616e 6365 2864 6963  f isinstance(dic
+000023e0: 745f 5b6b 6579 5d2c 2065 6e75 6d2e 456e  t_[key], enum.En
+000023f0: 756d 293a 0a20 2020 2020 2020 2020 2020  um):.           
+00002400: 2020 2020 2020 2020 2020 2020 2064 6963               dic
+00002410: 745f 5b6b 6579 5d20 3d20 6469 6374 5f5b  t_[key] = dict_[
+00002420: 6b65 795d 2e76 616c 7565 0a0a 2020 2020  key].value..    
+00002430: 2020 2020 2320 6966 2074 6865 206d 6574      # if the met
+00002440: 686f 6420 6973 2050 4f53 542c 2077 6520  hod is POST, we 
+00002450: 6e65 6564 2074 6f20 7570 6461 7465 2074  need to update t
+00002460: 6865 2073 6573 7369 6f6e 2077 6974 6820  he session with 
+00002470: 7468 6520 6170 7072 6f70 7269 6174 6520  the appropriate 
+00002480: 7265 7472 7920 706f 6c69 6379 0a20 2020  retry policy.   
+00002490: 2020 2020 2069 6620 6e6f 7420 7365 6c66       if not self
+000024a0: 2e73 6573 7369 6f6e 206f 7220 6d65 7468  .session or meth
+000024b0: 6f64 203d 3d20 2250 4f53 5422 3a0a 2020  od == "POST":.  
+000024c0: 2020 2020 2020 2020 2020 7265 7472 795f            retry_
+000024d0: 6f6e 5f70 6f73 7420 3d20 7365 6c66 2e5f  on_post = self._
+000024e0: 6973 5f72 6574 7279 5f6f 6e5f 706f 7374  is_retry_on_post
+000024f0: 5f61 6c6c 6f77 6564 286d 6574 686f 642c  _allowed(method,
+00002500: 2070 6174 6829 0a20 2020 2020 2020 2020   path).         
+00002510: 2020 2073 656c 662e 7365 7373 696f 6e20     self.session 
+00002520: 3d20 7365 6c66 2e5f 696e 6974 5f73 6573  = self._init_ses
+00002530: 7369 6f6e 2872 6574 7279 5f6f 6e5f 706f  sion(retry_on_po
+00002540: 7374 290a 0a20 2020 2020 2020 2074 7279  st)..        try
+00002550: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
+00002560: 7370 6f6e 7365 203d 2073 656c 662e 7365  sponse = self.se
+00002570: 7373 696f 6e2e 7265 7175 6573 7428 0a20  ssion.request(. 
+00002580: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00002590: 6574 686f 642c 2075 726c 2c20 7469 6d65  ethod, url, time
+000025a0: 6f75 743d 7469 6d65 6f75 742c 2076 6572  out=timeout, ver
+000025b0: 6966 793d 4661 6c73 652c 202a 2a6b 770a  ify=False, **kw.
+000025c0: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+000025d0: 2020 2020 2020 6578 6365 7074 2072 6571        except req
+000025e0: 7565 7374 732e 5265 7175 6573 7445 7863  uests.RequestExc
+000025f0: 6570 7469 6f6e 2061 7320 6578 633a 0a20  eption as exc:. 
+00002600: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00002610: 203d 2066 227b 6572 725f 746f 5f73 7472   = f"{err_to_str
+00002620: 2865 7863 297d 3a20 7b65 7272 6f72 7d22  (exc)}: {error}"
+00002630: 2069 6620 6572 726f 7220 656c 7365 2065   if error else e
+00002640: 7272 5f74 6f5f 7374 7228 6578 6329 0a20  rr_to_str(exc). 
+00002650: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+00002660: 206d 6c72 756e 2e65 7272 6f72 732e 4d4c   mlrun.errors.ML
+00002670: 5275 6e52 756e 7469 6d65 4572 726f 7228  RunRuntimeError(
+00002680: 6572 726f 7229 2066 726f 6d20 6578 630a  error) from exc.
+00002690: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+000026a0: 7265 7370 6f6e 7365 2e6f 6b3a 0a20 2020  response.ok:.   
+000026b0: 2020 2020 2020 2020 2069 6620 7265 7370           if resp
+000026c0: 6f6e 7365 2e63 6f6e 7465 6e74 3a0a 2020  onse.content:.  
+000026d0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+000026e0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+000026f0: 2020 2020 2020 2064 6174 6120 3d20 7265         data = re
+00002700: 7370 6f6e 7365 2e6a 736f 6e28 290a 2020  sponse.json().  
+00002710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002720: 2020 6572 726f 725f 6465 7461 696c 7320    error_details 
+00002730: 3d20 6461 7461 2e67 6574 2822 6465 7461  = data.get("deta
+00002740: 696c 222c 207b 7d29 0a20 2020 2020 2020  il", {}).       
+00002750: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00002760: 6e6f 7420 6572 726f 725f 6465 7461 696c  not error_detail
+00002770: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00002780: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+00002790: 722e 7761 726e 696e 6728 2246 6169 6c65  r.warning("Faile
+000027a0: 6420 7061 7273 696e 6720 6572 726f 7220  d parsing error 
+000027b0: 7265 7370 6f6e 7365 2062 6f64 7922 2c20  response body", 
+000027c0: 6461 7461 3d64 6174 6129 0a20 2020 2020  data=data).     
+000027d0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+000027e0: 7420 4578 6365 7074 696f 6e3a 0a20 2020  t Exception:.   
+000027f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00002800: 2065 7272 6f72 5f64 6574 6169 6c73 203d   error_details =
+00002810: 2022 220a 2020 2020 2020 2020 2020 2020   "".            
+00002820: 2020 2020 6966 2065 7272 6f72 5f64 6574      if error_det
+00002830: 6169 6c73 3a0a 2020 2020 2020 2020 2020  ails:.          
+00002840: 2020 2020 2020 2020 2020 6572 726f 725f            error_
+00002850: 6465 7461 696c 7320 3d20 6622 6465 7461  details = f"deta
+00002860: 696c 733a 207b 6572 726f 725f 6465 7461  ils: {error_deta
+00002870: 696c 737d 220a 2020 2020 2020 2020 2020  ils}".          
+00002880: 2020 2020 2020 2020 2020 6572 726f 7220            error 
+00002890: 3d20 6622 7b65 7272 6f72 7d20 7b65 7272  = f"{error} {err
+000028a0: 6f72 5f64 6574 6169 6c73 7d22 2069 6620  or_details}" if 
+000028b0: 6572 726f 7220 656c 7365 2065 7272 6f72  error else error
+000028c0: 5f64 6574 6169 6c73 0a20 2020 2020 2020  _details.       
+000028d0: 2020 2020 2020 2020 2020 2020 206d 6c72               mlr
+000028e0: 756e 2e65 7272 6f72 732e 7261 6973 655f  un.errors.raise_
+000028f0: 666f 725f 7374 6174 7573 2872 6573 706f  for_status(respo
+00002900: 6e73 652c 2065 7272 6f72 290a 0a20 2020  nse, error)..   
+00002910: 2020 2020 2020 2020 206d 6c72 756e 2e65           mlrun.e
+00002920: 7272 6f72 732e 7261 6973 655f 666f 725f  rrors.raise_for_
+00002930: 7374 6174 7573 2872 6573 706f 6e73 652c  status(response,
+00002940: 2065 7272 6f72 290a 0a20 2020 2020 2020   error)..       
+00002950: 2072 6574 7572 6e20 7265 7370 6f6e 7365   return response
+00002960: 0a0a 2020 2020 6465 6620 5f69 6e69 745f  ..    def _init_
+00002970: 7365 7373 696f 6e28 7365 6c66 2c20 7265  session(self, re
+00002980: 7472 795f 6f6e 5f70 6f73 743a 2062 6f6f  try_on_post: boo
+00002990: 6c20 3d20 4661 6c73 6529 3a0a 2020 2020  l = False):.    
+000029a0: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
+000029b0: 2e75 7469 6c73 2e48 5454 5053 6573 7369  .utils.HTTPSessi
+000029c0: 6f6e 5769 7468 5265 7472 7928 0a20 2020  onWithRetry(.   
+000029d0: 2020 2020 2020 2020 2072 6574 7279 5f6f           retry_o
+000029e0: 6e5f 6578 6365 7074 696f 6e3d 636f 6e66  n_exception=conf
+000029f0: 6967 2e68 7474 7064 622e 7265 7472 795f  ig.httpdb.retry_
+00002a00: 6170 695f 6361 6c6c 5f6f 6e5f 6578 6365  api_call_on_exce
+00002a10: 7074 696f 6e0a 2020 2020 2020 2020 2020  ption.          
+00002a20: 2020 3d3d 206d 6c72 756e 2e63 6f6d 6d6f    == mlrun.commo
+00002a30: 6e2e 7363 6865 6d61 732e 4854 5450 5365  n.schemas.HTTPSe
+00002a40: 7373 696f 6e52 6574 7279 4d6f 6465 2e65  ssionRetryMode.e
+00002a50: 6e61 626c 6564 2e76 616c 7565 2c0a 2020  nabled.value,.  
+00002a60: 2020 2020 2020 2020 2020 7265 7472 795f            retry_
+00002a70: 6f6e 5f70 6f73 743d 7265 7472 795f 6f6e  on_post=retry_on
+00002a80: 5f70 6f73 742c 0a20 2020 2020 2020 2029  _post,.        )
+00002a90: 0a0a 2020 2020 6465 6620 5f70 6174 685f  ..    def _path_
+00002aa0: 6f66 2873 656c 662c 2070 7265 6669 782c  of(self, prefix,
+00002ab0: 2070 726f 6a65 6374 2c20 7569 6429 3a0a   project, uid):.
+00002ac0: 2020 2020 2020 2020 7072 6f6a 6563 7420          project 
+00002ad0: 3d20 7072 6f6a 6563 7420 6f72 2063 6f6e  = project or con
+00002ae0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
+00002af0: 6563 740a 2020 2020 2020 2020 7265 7475  ect.        retu
+00002b00: 726e 2066 227b 7072 6566 6978 7d2f 7b70  rn f"{prefix}/{p
+00002b10: 726f 6a65 6374 7d2f 7b75 6964 7d22 0a0a  roject}/{uid}"..
+00002b20: 2020 2020 6465 6620 5f69 735f 7265 7472      def _is_retr
+00002b30: 795f 6f6e 5f70 6f73 745f 616c 6c6f 7765  y_on_post_allowe
+00002b40: 6428 7365 6c66 2c20 6d65 7468 6f64 2c20  d(self, method, 
+00002b50: 7061 7468 3a20 7374 7229 3a0a 2020 2020  path: str):.    
+00002b60: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002b70: 4368 6563 6b20 6966 2074 6865 2067 6976  Check if the giv
+00002b80: 656e 2070 6174 6820 6973 2061 6c6c 6f77  en path is allow
+00002b90: 6564 2074 6f20 6265 2072 6574 7269 6564  ed to be retried
+00002ba0: 206f 6e20 504f 5354 206d 6574 686f 640a   on POST method.
+00002bb0: 2020 2020 2020 2020 3a70 6172 616d 206d          :param m
+00002bc0: 6574 686f 643a 2020 7573 6564 2074 6f20  ethod:  used to 
+00002bd0: 7665 7269 6679 2074 6861 7420 7468 6520  verify that the 
+00002be0: 6d65 7468 6f64 2069 7320 504f 5354 2073  method is POST s
+00002bf0: 696e 6365 2069 6620 7468 6572 6520 6973  ince if there is
+00002c00: 206e 6f20 7365 7373 696f 6e20 696e 6974   no session init
+00002c10: 6961 6c69 7a65 6420 7468 6572 6520 6973  ialized there is
+00002c20: 206e 6f0a 2020 2020 2020 2020 2020 2020   no.            
+00002c30: 2020 2020 2020 2020 2020 2020 6e65 6564              need
+00002c40: 2074 6f20 696e 6974 6961 6c69 7a65 2069   to initialize i
+00002c50: 7420 7769 7468 2072 6574 7279 2070 6f6c  t with retry pol
+00002c60: 6963 7920 666f 7220 504f 5354 2077 6865  icy for POST whe
+00002c70: 6e20 7468 6520 6d65 7468 6f64 2069 7320  n the method is 
+00002c80: 6e6f 7420 504f 5354 0a20 2020 2020 2020  not POST.       
+00002c90: 203a 7061 7261 6d20 7061 7468 3a20 2020   :param path:   
+00002ca0: 2074 6865 2070 6174 6820 746f 2063 6865   the path to che
+00002cb0: 636b 0a20 2020 2020 2020 203a 7265 7475  ck.        :retu
+00002cc0: 726e 3a20 2020 2020 2020 2054 7275 6520  rn:        True 
+00002cd0: 6966 2074 6865 2070 6174 6820 6973 2061  if the path is a
+00002ce0: 6c6c 6f77 6564 2074 6f20 6265 2072 6574  llowed to be ret
+00002cf0: 7269 6564 206f 6e20 504f 5354 206d 6574  ried on POST met
+00002d00: 686f 6420 616e 6420 6d65 7468 6f64 2069  hod and method i
+00002d10: 7320 504f 5354 2c20 4661 6c73 6520 6f74  s POST, False ot
+00002d20: 6865 7277 6973 650a 2020 2020 2020 2020  herwise.        
+00002d30: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00002d40: 726e 206d 6574 686f 6420 3d3d 2022 504f  rn method == "PO
+00002d50: 5354 2220 616e 6420 616e 7928 0a20 2020  ST" and any(.   
+00002d60: 2020 2020 2020 2020 2072 652e 6d61 7463           re.matc
+00002d70: 6828 7265 6765 782c 2070 6174 6829 2066  h(regex, path) f
+00002d80: 6f72 2072 6567 6578 2069 6e20 7365 6c66  or regex in self
+00002d90: 2e52 4554 5249 4142 4c45 5f50 4f53 545f  .RETRIABLE_POST_
+00002da0: 5041 5448 530a 2020 2020 2020 2020 290a  PATHS.        ).
+00002db0: 0a20 2020 2064 6566 2063 6f6e 6e65 6374  .    def connect
+00002dc0: 2873 656c 662c 2073 6563 7265 7473 3d4e  (self, secrets=N
+00002dd0: 6f6e 6529 3a0a 2020 2020 2020 2020 2222  one):.        ""
+00002de0: 2243 6f6e 6e65 6374 2074 6f20 7468 6520  "Connect to the 
+00002df0: 4d4c 5275 6e20 4150 4920 7365 7276 6572  MLRun API server
+00002e00: 2e20 4d75 7374 2062 6520 6361 6c6c 6564  . Must be called
+00002e10: 2070 7269 6f72 2074 6f20 6578 6563 7574   prior to execut
+00002e20: 696e 6720 616e 7920 6f74 6865 7220 6d65  ing any other me
+00002e30: 7468 6f64 2e0a 2020 2020 2020 2020 5468  thod..        Th
+00002e40: 6520 636f 6465 2075 7469 6c69 7a65 7320  e code utilizes 
+00002e50: 7468 6520 5552 4c20 666f 7220 7468 6520  the URL for the 
+00002e60: 4150 4920 7365 7276 6572 2066 726f 6d20  API server from 
+00002e70: 7468 6520 636f 6e66 6967 7572 6174 696f  the configuratio
+00002e80: 6e20 2d20 6060 6d6c 636f 6e66 2e64 6270  n - ``mlconf.dbp
+00002e90: 6174 6860 602e 0a0a 2020 2020 2020 2020  ath``...        
+00002ea0: 466f 7220 6578 616d 706c 653a 3a0a 0a20  For example::.. 
+00002eb0: 2020 2020 2020 2020 2020 206d 6c63 6f6e             mlcon
+00002ec0: 662e 6462 7061 7468 203d 206d 6c63 6f6e  f.dbpath = mlcon
+00002ed0: 662e 6462 7061 7468 206f 7220 2768 7474  f.dbpath or 'htt
+00002ee0: 703a 2f2f 6d6c 7275 6e2d 6170 693a 3830  p://mlrun-api:80
+00002ef0: 3830 270a 2020 2020 2020 2020 2020 2020  80'.            
+00002f00: 6462 203d 2067 6574 5f72 756e 5f64 6228  db = get_run_db(
+00002f10: 292e 636f 6e6e 6563 7428 290a 2020 2020  ).connect().    
+00002f20: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00002f30: 2320 6861 636b 2074 6f20 616c 6c6f 7720  # hack to allow 
+00002f40: 756e 6974 2074 6573 7473 2074 6f20 696e  unit tests to in
+00002f50: 7374 616e 7469 6174 6520 4854 5450 5275  stantiate HTTPRu
+00002f60: 6e44 4220 7769 7468 6f75 7420 6120 7265  nDB without a re
+00002f70: 616c 2073 6572 7665 7220 6265 6869 6e64  al server behind
+00002f80: 0a20 2020 2020 2020 2069 6620 226d 6f63  .        if "moc
+00002f90: 6b2d 7365 7276 6572 2220 696e 2073 656c  k-server" in sel
+00002fa0: 662e 6261 7365 5f75 726c 3a0a 2020 2020  f.base_url:.    
+00002fb0: 2020 2020 2020 2020 7265 7475 726e 0a20          return. 
+00002fc0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00002fd0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
+00002fe0: 222c 2022 636c 6965 6e74 2d73 7065 6322  ", "client-spec"
+00002ff0: 2c20 7469 6d65 6f75 743d 3529 0a20 2020  , timeout=5).   
+00003000: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00003010: 2020 2020 2020 7365 7276 6572 5f63 6667        server_cfg
+00003020: 203d 2072 6573 702e 6a73 6f6e 2829 0a20   = resp.json(). 
+00003030: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00003040: 7365 7276 6572 5f76 6572 7369 6f6e 203d  server_version =
+00003050: 2073 6572 7665 725f 6366 675b 2276 6572   server_cfg["ver
+00003060: 7369 6f6e 225d 0a20 2020 2020 2020 2020  sion"].         
+00003070: 2020 2073 656c 662e 5f76 616c 6964 6174     self._validat
+00003080: 655f 7665 7273 696f 6e5f 636f 6d70 6174  e_version_compat
+00003090: 6962 696c 6974 7928 7365 6c66 2e73 6572  ibility(self.ser
+000030a0: 7665 725f 7665 7273 696f 6e2c 2063 6f6e  ver_version, con
+000030b0: 6669 672e 7665 7273 696f 6e29 0a20 2020  fig.version).   
+000030c0: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+000030d0: 6e61 6d65 7370 6163 6520 3d20 636f 6e66  namespace = conf
+000030e0: 6967 2e6e 616d 6573 7061 6365 206f 7220  ig.namespace or 
+000030f0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003100: 6e61 6d65 7370 6163 6522 290a 2020 2020  namespace").    
+00003110: 2020 2020 2020 2020 6966 2028 0a20 2020          if (.   
+00003120: 2020 2020 2020 2020 2020 2020 2022 6e61               "na
+00003130: 6d65 7370 6163 6522 2069 6e20 7365 7276  mespace" in serv
+00003140: 6572 5f63 6667 0a20 2020 2020 2020 2020  er_cfg.         
+00003150: 2020 2020 2020 2061 6e64 2073 6572 7665         and serve
+00003160: 725f 6366 675b 226e 616d 6573 7061 6365  r_cfg["namespace
+00003170: 225d 2021 3d20 636f 6e66 6967 2e6e 616d  "] != config.nam
+00003180: 6573 7061 6365 0a20 2020 2020 2020 2020  espace.         
+00003190: 2020 2029 3a0a 2020 2020 2020 2020 2020     ):.          
+000031a0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+000031b0: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
+000031c0: 2020 2020 2020 2020 2020 6622 7761 726e            f"warn
+000031d0: 696e 6721 2c20 7365 7276 6572 2028 7b73  ing!, server ({s
+000031e0: 6572 7665 725f 6366 675b 276e 616d 6573  erver_cfg['names
+000031f0: 7061 6365 275d 7d29 2061 6e64 2063 6c69  pace']}) and cli
+00003200: 656e 7420 287b 636f 6e66 6967 2e6e 616d  ent ({config.nam
+00003210: 6573 7061 6365 7d29 220a 2020 2020 2020  espace})".      
+00003220: 2020 2020 2020 2020 2020 2020 2020 2220                " 
+00003230: 6e61 6d65 7370 6163 6520 646f 6e27 7420  namespace don't 
+00003240: 6d61 7463 6822 0a20 2020 2020 2020 2020  match".         
+00003250: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003260: 2020 2020 2069 6620 636f 6e66 6967 2e63       if config.c
+00003270: 652e 6d6f 6465 2061 6e64 2063 6f6e 6669  e.mode and confi
+00003280: 672e 6365 2e6d 6f64 6520 213d 2073 6572  g.ce.mode != ser
+00003290: 7665 725f 6366 672e 6765 7428 2263 655f  ver_cfg.get("ce_
+000032a0: 6d6f 6465 222c 2022 2229 3a0a 2020 2020  mode", ""):.    
+000032b0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+000032c0: 6572 2e77 6172 6e69 6e67 280a 2020 2020  er.warning(.    
+000032d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000032e0: 6622 7761 726e 696e 6721 2c20 7365 7276  f"warning!, serv
+000032f0: 6572 2028 7b73 6572 7665 725f 6366 675b  er ({server_cfg[
+00003300: 2763 655f 6d6f 6465 275d 7d29 2061 6e64  'ce_mode']}) and
+00003310: 2063 6c69 656e 7420 287b 636f 6e66 6967   client ({config
+00003320: 2e63 652e 6d6f 6465 7d29 220a 2020 2020  .ce.mode})".    
+00003330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00003340: 2220 4345 206d 6f64 6520 646f 6e27 7420  " CE mode don't 
+00003350: 6d61 7463 6822 0a20 2020 2020 2020 2020  match".         
+00003360: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00003370: 2020 2020 2063 6f6e 6669 672e 6365 203d       config.ce =
+00003380: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00003390: 2263 6522 2920 6f72 2063 6f6e 6669 672e  "ce") or config.
+000033a0: 6365 0a0a 2020 2020 2020 2020 2020 2020  ce..            
+000033b0: 2320 6765 7420 6465 6661 756c 7473 2066  # get defaults f
+000033c0: 726f 6d20 7265 6d6f 7465 2073 6572 7665  rom remote serve
+000033d0: 720a 2020 2020 2020 2020 2020 2020 636f  r.            co
+000033e0: 6e66 6967 2e72 656d 6f74 655f 686f 7374  nfig.remote_host
+000033f0: 203d 2063 6f6e 6669 672e 7265 6d6f 7465   = config.remote
+00003400: 5f68 6f73 7420 6f72 2073 6572 7665 725f  _host or server_
+00003410: 6366 672e 6765 7428 2272 656d 6f74 655f  cfg.get("remote_
+00003420: 686f 7374 2229 0a20 2020 2020 2020 2020  host").         
+00003430: 2020 2063 6f6e 6669 672e 6d70 696a 6f62     config.mpijob
+00003440: 5f63 7264 5f76 6572 7369 6f6e 203d 2063  _crd_version = c
+00003450: 6f6e 6669 672e 6d70 696a 6f62 5f63 7264  onfig.mpijob_crd
+00003460: 5f76 6572 7369 6f6e 206f 7220 7365 7276  _version or serv
+00003470: 6572 5f63 6667 2e67 6574 280a 2020 2020  er_cfg.get(.    
+00003480: 2020 2020 2020 2020 2020 2020 226d 7069              "mpi
+00003490: 6a6f 625f 6372 645f 7665 7273 696f 6e22  job_crd_version"
+000034a0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000034b0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+000034c0: 672e 7569 2e75 726c 203d 2063 6f6e 6669  g.ui.url = confi
+000034d0: 672e 7265 736f 6c76 655f 7569 5f75 726c  g.resolve_ui_url
+000034e0: 2829 206f 7220 7365 7276 6572 5f63 6667  () or server_cfg
+000034f0: 2e67 6574 2822 7569 5f75 726c 2229 0a20  .get("ui_url"). 
+00003500: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00003510: 672e 6172 7469 6661 6374 5f70 6174 6820  g.artifact_path 
+00003520: 3d20 636f 6e66 6967 2e61 7274 6966 6163  = config.artifac
+00003530: 745f 7061 7468 206f 7220 7365 7276 6572  t_path or server
+00003540: 5f63 6667 2e67 6574 280a 2020 2020 2020  _cfg.get(.      
+00003550: 2020 2020 2020 2020 2020 2261 7274 6966            "artif
+00003560: 6163 745f 7061 7468 220a 2020 2020 2020  act_path".      
+00003570: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003580: 2020 2020 636f 6e66 6967 2e66 6561 7475      config.featu
+00003590: 7265 5f73 746f 7265 2e64 6174 615f 7072  re_store.data_pr
+000035a0: 6566 6978 6573 203d 2028 0a20 2020 2020  efixes = (.     
+000035b0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+000035c0: 672e 6665 6174 7572 655f 7374 6f72 652e  g.feature_store.
+000035d0: 6461 7461 5f70 7265 6669 7865 730a 2020  data_prefixes.  
+000035e0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+000035f0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00003600: 2266 6561 7475 7265 5f73 746f 7265 5f64  "feature_store_d
+00003610: 6174 615f 7072 6566 6978 6573 2229 0a20  ata_prefixes"). 
+00003620: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+00003630: 2020 2020 2020 2020 2063 6f6e 6669 672e           config.
+00003640: 7370 6172 6b5f 6170 705f 696d 6167 6520  spark_app_image 
+00003650: 3d20 636f 6e66 6967 2e73 7061 726b 5f61  = config.spark_a
+00003660: 7070 5f69 6d61 6765 206f 7220 7365 7276  pp_image or serv
+00003670: 6572 5f63 6667 2e67 6574 280a 2020 2020  er_cfg.get(.    
+00003680: 2020 2020 2020 2020 2020 2020 2273 7061              "spa
+00003690: 726b 5f61 7070 5f69 6d61 6765 220a 2020  rk_app_image".  
+000036a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000036b0: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
+000036c0: 7061 726b 5f61 7070 5f69 6d61 6765 5f74  park_app_image_t
+000036d0: 6167 203d 2063 6f6e 6669 672e 7370 6172  ag = config.spar
+000036e0: 6b5f 6170 705f 696d 6167 655f 7461 6720  k_app_image_tag 
+000036f0: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
+00003700: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00003710: 2020 2022 7370 6172 6b5f 6170 705f 696d     "spark_app_im
+00003720: 6167 655f 7461 6722 0a20 2020 2020 2020  age_tag".       
+00003730: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00003740: 2020 2063 6f6e 6669 672e 7370 6172 6b5f     config.spark_
+00003750: 6869 7374 6f72 795f 7365 7276 6572 5f70  history_server_p
+00003760: 6174 6820 3d20 280a 2020 2020 2020 2020  ath = (.        
+00003770: 2020 2020 2020 2020 636f 6e66 6967 2e73          config.s
+00003780: 7061 726b 5f68 6973 746f 7279 5f73 6572  park_history_ser
+00003790: 7665 725f 7061 7468 0a20 2020 2020 2020  ver_path.       
+000037a0: 2020 2020 2020 2020 206f 7220 7365 7276           or serv
+000037b0: 6572 5f63 6667 2e67 6574 2822 7370 6172  er_cfg.get("spar
+000037c0: 6b5f 6869 7374 6f72 795f 7365 7276 6572  k_history_server
+000037d0: 5f70 6174 6822 290a 2020 2020 2020 2020  _path").        
+000037e0: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+000037f0: 2020 636f 6e66 6967 2e68 7474 7064 622e    config.httpdb.
+00003800: 6275 696c 6465 722e 646f 636b 6572 5f72  builder.docker_r
+00003810: 6567 6973 7472 7920 3d20 280a 2020 2020  egistry = (.    
+00003820: 2020 2020 2020 2020 2020 2020 636f 6e66              conf
+00003830: 6967 2e68 7474 7064 622e 6275 696c 6465  ig.httpdb.builde
+00003840: 722e 646f 636b 6572 5f72 6567 6973 7472  r.docker_registr
+00003850: 790a 2020 2020 2020 2020 2020 2020 2020  y.              
+00003860: 2020 6f72 2073 6572 7665 725f 6366 672e    or server_cfg.
+00003870: 6765 7428 2264 6f63 6b65 725f 7265 6769  get("docker_regi
+00003880: 7374 7279 2229 0a20 2020 2020 2020 2020  stry").         
+00003890: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+000038a0: 2063 6f6e 6669 672e 6874 7470 6462 2e61   config.httpdb.a
+000038b0: 7069 5f75 726c 203d 2063 6f6e 6669 672e  pi_url = config.
+000038c0: 6874 7470 6462 2e61 7069 5f75 726c 206f  httpdb.api_url o
+000038d0: 7220 7365 7276 6572 5f63 6667 2e67 6574  r server_cfg.get
+000038e0: 2822 6170 695f 7572 6c22 290a 2020 2020  ("api_url").    
+000038f0: 2020 2020 2020 2020 636f 6e66 6967 2e6e          config.n
+00003900: 7563 6c69 6f5f 7665 7273 696f 6e20 3d20  uclio_version = 
+00003910: 636f 6e66 6967 2e6e 7563 6c69 6f5f 7665  config.nuclio_ve
+00003920: 7273 696f 6e20 6f72 2073 6572 7665 725f  rsion or server_
+00003930: 6366 672e 6765 7428 0a20 2020 2020 2020  cfg.get(.       
+00003940: 2020 2020 2020 2020 2022 6e75 636c 696f           "nuclio
+00003950: 5f76 6572 7369 6f6e 220a 2020 2020 2020  _version".      
+00003960: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003970: 2020 2020 636f 6e66 6967 2e64 6566 6175      config.defau
+00003980: 6c74 5f66 756e 6374 696f 6e5f 7072 696f  lt_function_prio
+00003990: 7269 7479 5f63 6c61 7373 5f6e 616d 6520  rity_class_name 
+000039a0: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+000039b0: 2020 2020 636f 6e66 6967 2e64 6566 6175      config.defau
+000039c0: 6c74 5f66 756e 6374 696f 6e5f 7072 696f  lt_function_prio
+000039d0: 7269 7479 5f63 6c61 7373 5f6e 616d 650a  rity_class_name.
+000039e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000039f0: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
+00003a00: 7428 2264 6566 6175 6c74 5f66 756e 6374  t("default_funct
+00003a10: 696f 6e5f 7072 696f 7269 7479 5f63 6c61  ion_priority_cla
+00003a20: 7373 5f6e 616d 6522 290a 2020 2020 2020  ss_name").      
+00003a30: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00003a40: 2020 2020 636f 6e66 6967 2e76 616c 6964      config.valid
+00003a50: 5f66 756e 6374 696f 6e5f 7072 696f 7269  _function_priori
+00003a60: 7479 5f63 6c61 7373 5f6e 616d 6573 203d  ty_class_names =
+00003a70: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00003a80: 2020 2063 6f6e 6669 672e 7661 6c69 645f     config.valid_
+00003a90: 6675 6e63 7469 6f6e 5f70 7269 6f72 6974  function_priorit
+00003aa0: 795f 636c 6173 735f 6e61 6d65 730a 2020  y_class_names.  
+00003ab0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00003ac0: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00003ad0: 2276 616c 6964 5f66 756e 6374 696f 6e5f  "valid_function_
+00003ae0: 7072 696f 7269 7479 5f63 6c61 7373 5f6e  priority_class_n
+00003af0: 616d 6573 2229 0a20 2020 2020 2020 2020  ames").         
+00003b00: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00003b10: 2063 6f6e 6669 672e 6172 7469 6661 6374   config.artifact
+00003b20: 732e 6361 6c63 756c 6174 655f 6861 7368  s.calculate_hash
+00003b30: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+00003b40: 2020 2020 2063 6f6e 6669 672e 6172 7469       config.arti
+00003b50: 6661 6374 732e 6361 6c63 756c 6174 655f  facts.calculate_
+00003b60: 6861 7368 0a20 2020 2020 2020 2020 2020  hash.           
+00003b70: 2020 2020 2069 6620 636f 6e66 6967 2e61       if config.a
+00003b80: 7274 6966 6163 7473 2e63 616c 6375 6c61  rtifacts.calcula
+00003b90: 7465 5f68 6173 6820 6973 206e 6f74 204e  te_hash is not N
+00003ba0: 6f6e 650a 2020 2020 2020 2020 2020 2020  one.            
+00003bb0: 2020 2020 656c 7365 2073 6572 7665 725f      else server_
+00003bc0: 6366 672e 6765 7428 2263 616c 6375 6c61  cfg.get("calcula
+00003bd0: 7465 5f61 7274 6966 6163 745f 6861 7368  te_artifact_hash
+00003be0: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+00003bf0: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00003c00: 6669 672e 6172 7469 6661 6374 732e 6765  fig.artifacts.ge
+00003c10: 6e65 7261 7465 5f74 6172 6765 745f 7061  nerate_target_pa
+00003c20: 7468 5f66 726f 6d5f 6172 7469 6661 6374  th_from_artifact
+00003c30: 5f68 6173 6820 3d20 280a 2020 2020 2020  _hash = (.      
+00003c40: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00003c50: 2e61 7274 6966 6163 7473 2e67 656e 6572  .artifacts.gener
+00003c60: 6174 655f 7461 7267 6574 5f70 6174 685f  ate_target_path_
+00003c70: 6672 6f6d 5f61 7274 6966 6163 745f 6861  from_artifact_ha
+00003c80: 7368 0a20 2020 2020 2020 2020 2020 2020  sh.             
+00003c90: 2020 2069 6620 636f 6e66 6967 2e61 7274     if config.art
+00003ca0: 6966 6163 7473 2e67 656e 6572 6174 655f  ifacts.generate_
+00003cb0: 7461 7267 6574 5f70 6174 685f 6672 6f6d  target_path_from
+00003cc0: 5f61 7274 6966 6163 745f 6861 7368 2069  _artifact_hash i
+00003cd0: 7320 6e6f 7420 4e6f 6e65 0a20 2020 2020  s not None.     
+00003ce0: 2020 2020 2020 2020 2020 2065 6c73 6520             else 
+00003cf0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003d00: 6765 6e65 7261 7465 5f61 7274 6966 6163  generate_artifac
+00003d10: 745f 7461 7267 6574 5f70 6174 685f 6672  t_target_path_fr
+00003d20: 6f6d 5f61 7274 6966 6163 745f 6861 7368  om_artifact_hash
+00003d30: 2229 0a20 2020 2020 2020 2020 2020 2029  ").            )
+00003d40: 0a0a 2020 2020 2020 2020 2020 2020 636f  ..            co
+00003d50: 6e66 6967 2e72 6564 6973 2e75 726c 203d  nfig.redis.url =
+00003d60: 2063 6f6e 6669 672e 7265 6469 732e 7572   config.redis.ur
+00003d70: 6c20 6f72 2073 6572 7665 725f 6366 672e  l or server_cfg.
+00003d80: 6765 7428 2272 6564 6973 5f75 726c 2229  get("redis_url")
+00003d90: 0a20 2020 2020 2020 2020 2020 2023 2061  .            # a
+00003da0: 6c6c 6f77 2063 6c69 656e 7420 746f 2073  llow client to s
+00003db0: 6574 2074 6865 2064 6566 6175 6c74 2070  et the default p
+00003dc0: 6172 7469 616c 2057 4120 666f 7220 6c61  artial WA for la
+00003dd0: 636b 206f 6620 7375 7070 6f72 7420 6f66  ck of support of
+00003de0: 2070 6572 2d74 6172 6765 7420 6175 7869   per-target auxi
+00003df0: 6c69 6172 7920 6f70 7469 6f6e 730a 2020  liary options.  
+00003e00: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00003e10: 2e72 6564 6973 2e74 7970 6520 3d20 636f  .redis.type = co
+00003e20: 6e66 6967 2e72 6564 6973 2e74 7970 6520  nfig.redis.type 
+00003e30: 6f72 2073 6572 7665 725f 6366 672e 6765  or server_cfg.ge
+00003e40: 7428 2272 6564 6973 5f74 7970 6522 290a  t("redis_type").
+00003e50: 0a20 2020 2020 2020 2020 2020 2063 6f6e  .            con
+00003e60: 6669 672e 7371 6c2e 7572 6c20 3d20 636f  fig.sql.url = co
+00003e70: 6e66 6967 2e73 716c 2e75 726c 206f 7220  nfig.sql.url or 
+00003e80: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+00003e90: 7371 6c5f 7572 6c22 290a 2020 2020 2020  sql_url").      
+00003ea0: 2020 2020 2020 2320 5468 6573 6520 6861        # These ha
+00003eb0: 7665 2061 2064 6566 6175 6c74 2076 616c  ve a default val
+00003ec0: 7565 2c20 7468 6572 6566 6f72 6520 6c6f  ue, therefore lo
+00003ed0: 6361 6c20 636f 6e66 6967 2077 696c 6c20  cal config will 
+00003ee0: 616c 7761 7973 2068 6176 6520 6120 7661  always have a va
+00003ef0: 6c75 652c 2070 7269 6f72 6974 697a 6520  lue, prioritize 
+00003f00: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+00003f10: 2320 4150 4920 7661 6c75 6520 6669 7273  # API value firs
+00003f20: 740a 2020 2020 2020 2020 2020 2020 636f  t.            co
+00003f30: 6e66 6967 2e75 692e 7072 6f6a 6563 7473  nfig.ui.projects
+00003f40: 5f70 7265 6669 7820 3d20 280a 2020 2020  _prefix = (.    
+00003f50: 2020 2020 2020 2020 2020 2020 7365 7276              serv
+00003f60: 6572 5f63 6667 2e67 6574 2822 7569 5f70  er_cfg.get("ui_p
+00003f70: 726f 6a65 6374 735f 7072 6566 6978 2229  rojects_prefix")
+00003f80: 206f 7220 636f 6e66 6967 2e75 692e 7072   or config.ui.pr
+00003f90: 6f6a 6563 7473 5f70 7265 6669 780a 2020  ojects_prefix.  
+00003fa0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00003fb0: 2020 2020 2020 2020 636f 6e66 6967 2e6b          config.k
+00003fc0: 6670 5f69 6d61 6765 203d 2073 6572 7665  fp_image = serve
+00003fd0: 725f 6366 672e 6765 7428 226b 6670 5f69  r_cfg.get("kfp_i
+00003fe0: 6d61 6765 2229 206f 7220 636f 6e66 6967  mage") or config
+00003ff0: 2e6b 6670 5f69 6d61 6765 0a20 2020 2020  .kfp_image.     
+00004000: 2020 2020 2020 2063 6f6e 6669 672e 6b66         config.kf
+00004010: 705f 7572 6c20 3d20 7365 7276 6572 5f63  p_url = server_c
+00004020: 6667 2e67 6574 2822 6b66 705f 7572 6c22  fg.get("kfp_url"
+00004030: 2920 6f72 2063 6f6e 6669 672e 6b66 705f  ) or config.kfp_
+00004040: 7572 6c0a 2020 2020 2020 2020 2020 2020  url.            
+00004050: 636f 6e66 6967 2e64 6173 6b5f 6b66 705f  config.dask_kfp_
+00004060: 696d 6167 6520 3d20 280a 2020 2020 2020  image = (.      
+00004070: 2020 2020 2020 2020 2020 7365 7276 6572            server
+00004080: 5f63 6667 2e67 6574 2822 6461 736b 5f6b  _cfg.get("dask_k
+00004090: 6670 5f69 6d61 6765 2229 206f 7220 636f  fp_image") or co
+000040a0: 6e66 6967 2e64 6173 6b5f 6b66 705f 696d  nfig.dask_kfp_im
+000040b0: 6167 650a 2020 2020 2020 2020 2020 2020  age.            
+000040c0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000040d0: 6e66 6967 2e73 6372 6170 655f 6d65 7472  nfig.scrape_metr
+000040e0: 6963 7320 3d20 280a 2020 2020 2020 2020  ics = (.        
+000040f0: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
+00004100: 6667 2e67 6574 2822 7363 7261 7065 5f6d  fg.get("scrape_m
+00004110: 6574 7269 6373 2229 0a20 2020 2020 2020  etrics").       
+00004120: 2020 2020 2020 2020 2069 6620 7365 7276           if serv
+00004130: 6572 5f63 6667 2e67 6574 2822 7363 7261  er_cfg.get("scra
+00004140: 7065 5f6d 6574 7269 6373 2229 2069 7320  pe_metrics") is 
+00004150: 6e6f 7420 4e6f 6e65 0a20 2020 2020 2020  not None.       
+00004160: 2020 2020 2020 2020 2065 6c73 6520 636f           else co
+00004170: 6e66 6967 2e73 6372 6170 655f 6d65 7472  nfig.scrape_metr
+00004180: 6963 730a 2020 2020 2020 2020 2020 2020  ics.            
+00004190: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+000041a0: 6e66 6967 2e68 7562 5f75 726c 203d 2073  nfig.hub_url = s
+000041b0: 6572 7665 725f 6366 672e 6765 7428 2268  erver_cfg.get("h
+000041c0: 7562 5f75 726c 2229 206f 7220 636f 6e66  ub_url") or conf
+000041d0: 6967 2e68 7562 5f75 726c 0a20 2020 2020  ig.hub_url.     
+000041e0: 2020 2020 2020 2063 6f6e 6669 672e 6465         config.de
+000041f0: 6661 756c 745f 6675 6e63 7469 6f6e 5f6e  fault_function_n
+00004200: 6f64 655f 7365 6c65 6374 6f72 203d 2028  ode_selector = (
+00004210: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004220: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00004230: 2264 6566 6175 6c74 5f66 756e 6374 696f  "default_functio
+00004240: 6e5f 6e6f 6465 5f73 656c 6563 746f 7222  n_node_selector"
+00004250: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00004260: 2020 6f72 2063 6f6e 6669 672e 6465 6661    or config.defa
+00004270: 756c 745f 6675 6e63 7469 6f6e 5f6e 6f64  ult_function_nod
+00004280: 655f 7365 6c65 6374 6f72 0a20 2020 2020  e_selector.     
+00004290: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+000042a0: 2020 2020 2063 6f6e 6669 672e 6967 7a5f       config.igz_
+000042b0: 7665 7273 696f 6e20 3d20 7365 7276 6572  version = server
+000042c0: 5f63 6667 2e67 6574 2822 6967 7a5f 7665  _cfg.get("igz_ve
+000042d0: 7273 696f 6e22 2920 6f72 2063 6f6e 6669  rsion") or confi
+000042e0: 672e 6967 7a5f 7665 7273 696f 6e0a 2020  g.igz_version.  
+000042f0: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00004300: 2e73 746f 7261 6765 2e61 7574 6f5f 6d6f  .storage.auto_mo
+00004310: 756e 745f 7479 7065 203d 2028 0a20 2020  unt_type = (.   
+00004320: 2020 2020 2020 2020 2020 2020 2073 6572               ser
+00004330: 7665 725f 6366 672e 6765 7428 2261 7574  ver_cfg.get("aut
+00004340: 6f5f 6d6f 756e 745f 7479 7065 2229 206f  o_mount_type") o
+00004350: 7220 636f 6e66 6967 2e73 746f 7261 6765  r config.storage
+00004360: 2e61 7574 6f5f 6d6f 756e 745f 7479 7065  .auto_mount_type
+00004370: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00004380: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00004390: 672e 7374 6f72 6167 652e 6175 746f 5f6d  g.storage.auto_m
+000043a0: 6f75 6e74 5f70 6172 616d 7320 3d20 280a  ount_params = (.
+000043b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000043c0: 7365 7276 6572 5f63 6667 2e67 6574 2822  server_cfg.get("
+000043d0: 6175 746f 5f6d 6f75 6e74 5f70 6172 616d  auto_mount_param
+000043e0: 7322 2920 6f72 2063 6f6e 6669 672e 7374  s") or config.st
+000043f0: 6f72 6167 652e 6175 746f 5f6d 6f75 6e74  orage.auto_mount
+00004400: 5f70 6172 616d 730a 2020 2020 2020 2020  _params.        
+00004410: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00004420: 2020 636f 6e66 6967 2e73 7061 726b 5f6f    config.spark_o
+00004430: 7065 7261 746f 725f 7665 7273 696f 6e20  perator_version 
+00004440: 3d20 280a 2020 2020 2020 2020 2020 2020  = (.            
+00004450: 2020 2020 7365 7276 6572 5f63 6667 2e67      server_cfg.g
+00004460: 6574 2822 7370 6172 6b5f 6f70 6572 6174  et("spark_operat
+00004470: 6f72 5f76 6572 7369 6f6e 2229 0a20 2020  or_version").   
+00004480: 2020 2020 2020 2020 2020 2020 206f 7220               or 
+00004490: 636f 6e66 6967 2e73 7061 726b 5f6f 7065  config.spark_ope
+000044a0: 7261 746f 725f 7665 7273 696f 6e0a 2020  rator_version.  
+000044b0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+000044c0: 2020 2020 2020 2020 636f 6e66 6967 2e64          config.d
+000044d0: 6566 6175 6c74 5f74 656e 736f 7262 6f61  efault_tensorboa
+000044e0: 7264 5f6c 6f67 735f 7061 7468 203d 2028  rd_logs_path = (
+000044f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004500: 2073 6572 7665 725f 6366 672e 6765 7428   server_cfg.get(
+00004510: 2264 6566 6175 6c74 5f74 656e 736f 7262  "default_tensorb
+00004520: 6f61 7264 5f6c 6f67 735f 7061 7468 2229  oard_logs_path")
+00004530: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004540: 206f 7220 636f 6e66 6967 2e64 6566 6175   or config.defau
+00004550: 6c74 5f74 656e 736f 7262 6f61 7264 5f6c  lt_tensorboard_l
+00004560: 6f67 735f 7061 7468 0a20 2020 2020 2020  ogs_path.       
+00004570: 2020 2020 2029 0a20 2020 2020 2020 2020       ).         
+00004580: 2020 2063 6f6e 6669 672e 6465 6661 756c     config.defaul
+00004590: 745f 6675 6e63 7469 6f6e 5f70 6f64 5f72  t_function_pod_r
+000045a0: 6573 6f75 7263 6573 203d 2028 0a20 2020  esources = (.   
+000045b0: 2020 2020 2020 2020 2020 2020 2073 6572               ser
+000045c0: 7665 725f 6366 672e 6765 7428 2264 6566  ver_cfg.get("def
+000045d0: 6175 6c74 5f66 756e 6374 696f 6e5f 706f  ault_function_po
+000045e0: 645f 7265 736f 7572 6365 7322 290a 2020  d_resources").  
+000045f0: 2020 2020 2020 2020 2020 2020 2020 6f72                or
+00004600: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00004610: 6675 6e63 7469 6f6e 5f70 6f64 5f72 6573  function_pod_res
+00004620: 6f75 7263 6573 0a20 2020 2020 2020 2020  ources.         
+00004630: 2020 2029 0a20 2020 2020 2020 2020 2020     ).           
+00004640: 2063 6f6e 6669 672e 6675 6e63 7469 6f6e   config.function
+00004650: 5f64 6566 6175 6c74 732e 7072 6565 6d70  _defaults.preemp
+00004660: 7469 6f6e 5f6d 6f64 6520 3d20 280a 2020  tion_mode = (.  
+00004670: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00004680: 7276 6572 5f63 6667 2e67 6574 2822 6465  rver_cfg.get("de
+00004690: 6661 756c 745f 7072 6565 6d70 7469 6f6e  fault_preemption
+000046a0: 5f6d 6f64 6522 290a 2020 2020 2020 2020  _mode").        
+000046b0: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
+000046c0: 672e 6675 6e63 7469 6f6e 5f64 6566 6175  g.function_defau
+000046d0: 6c74 732e 7072 6565 6d70 7469 6f6e 5f6d  lts.preemption_m
+000046e0: 6f64 650a 2020 2020 2020 2020 2020 2020  ode.            
+000046f0: 290a 2020 2020 2020 2020 2020 2020 636f  ).            co
+00004700: 6e66 6967 2e70 7265 656d 7074 6962 6c65  nfig.preemptible
+00004710: 5f6e 6f64 6573 2e6e 6f64 655f 7365 6c65  _nodes.node_sele
+00004720: 6374 6f72 203d 2028 0a20 2020 2020 2020  ctor = (.       
+00004730: 2020 2020 2020 2020 2073 6572 7665 725f           server_
+00004740: 6366 672e 6765 7428 2270 7265 656d 7074  cfg.get("preempt
+00004750: 6962 6c65 5f6e 6f64 6573 5f6e 6f64 655f  ible_nodes_node_
+00004760: 7365 6c65 6374 6f72 2229 0a20 2020 2020  selector").     
+00004770: 2020 2020 2020 2020 2020 206f 7220 636f             or co
+00004780: 6e66 6967 2e70 7265 656d 7074 6962 6c65  nfig.preemptible
+00004790: 5f6e 6f64 6573 2e6e 6f64 655f 7365 6c65  _nodes.node_sele
+000047a0: 6374 6f72 0a20 2020 2020 2020 2020 2020  ctor.           
+000047b0: 2029 0a20 2020 2020 2020 2020 2020 2063   ).            c
+000047c0: 6f6e 6669 672e 7072 6565 6d70 7469 626c  onfig.preemptibl
+000047d0: 655f 6e6f 6465 732e 746f 6c65 7261 7469  e_nodes.tolerati
+000047e0: 6f6e 7320 3d20 280a 2020 2020 2020 2020  ons = (.        
+000047f0: 2020 2020 2020 2020 7365 7276 6572 5f63          server_c
+00004800: 6667 2e67 6574 2822 7072 6565 6d70 7469  fg.get("preempti
+00004810: 626c 655f 6e6f 6465 735f 746f 6c65 7261  ble_nodes_tolera
+00004820: 7469 6f6e 7322 290a 2020 2020 2020 2020  tions").        
+00004830: 2020 2020 2020 2020 6f72 2063 6f6e 6669          or confi
+00004840: 672e 7072 6565 6d70 7469 626c 655f 6e6f  g.preemptible_no
+00004850: 6465 732e 746f 6c65 7261 7469 6f6e 730a  des.tolerations.
+00004860: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+00004870: 2020 2020 2020 2020 2020 636f 6e66 6967            config
+00004880: 2e66 6f72 6365 5f72 756e 5f6c 6f63 616c  .force_run_local
+00004890: 203d 2028 0a20 2020 2020 2020 2020 2020   = (.           
+000048a0: 2020 2020 2073 6572 7665 725f 6366 672e       server_cfg.
+000048b0: 6765 7428 2266 6f72 6365 5f72 756e 5f6c  get("force_run_l
+000048c0: 6f63 616c 2229 206f 7220 636f 6e66 6967  ocal") or config
+000048d0: 2e66 6f72 6365 5f72 756e 5f6c 6f63 616c  .force_run_local
+000048e0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+000048f0: 2020 2020 2020 2020 2020 2063 6f6e 6669             confi
+00004900: 672e 6675 6e63 7469 6f6e 203d 2073 6572  g.function = ser
+00004910: 7665 725f 6366 672e 6765 7428 2266 756e  ver_cfg.get("fun
+00004920: 6374 696f 6e22 2920 6f72 2063 6f6e 6669  ction") or confi
+00004930: 672e 6675 6e63 7469 6f6e 0a20 2020 2020  g.function.     
+00004940: 2020 2020 2020 2063 6f6e 6669 672e 6874         config.ht
+00004950: 7470 6462 2e6c 6f67 7320 3d20 7365 7276  tpdb.logs = serv
+00004960: 6572 5f63 6667 2e67 6574 2822 6c6f 6773  er_cfg.get("logs
+00004970: 2229 206f 7220 636f 6e66 6967 2e68 7474  ") or config.htt
+00004980: 7064 622e 6c6f 6773 0a0a 2020 2020 2020  pdb.logs..      
+00004990: 2020 6578 6365 7074 2045 7863 6570 7469    except Excepti
+000049a0: 6f6e 2061 7320 6578 633a 0a20 2020 2020  on as exc:.     
+000049b0: 2020 2020 2020 206c 6f67 6765 722e 7761         logger.wa
+000049c0: 726e 696e 6728 0a20 2020 2020 2020 2020  rning(.         
+000049d0: 2020 2020 2020 2022 4661 696c 6564 2073         "Failed s
+000049e0: 796e 6369 6e67 2063 6f6e 6669 6720 6672  yncing config fr
+000049f0: 6f6d 2073 6572 7665 7222 2c0a 2020 2020  om server",.    
+00004a00: 2020 2020 2020 2020 2020 2020 6578 633d              exc=
+00004a10: 6572 725f 746f 5f73 7472 2865 7863 292c  err_to_str(exc),
+00004a20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00004a30: 2074 7261 6365 6261 636b 3d74 7261 6365   traceback=trace
+00004a40: 6261 636b 2e66 6f72 6d61 745f 6578 6328  back.format_exc(
+00004a50: 292c 0a20 2020 2020 2020 2020 2020 2029  ),.            )
+00004a60: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00004a70: 7365 6c66 0a0a 2020 2020 6465 6620 7374  self..    def st
+00004a80: 6f72 655f 6c6f 6728 7365 6c66 2c20 7569  ore_log(self, ui
+00004a90: 642c 2070 726f 6a65 6374 3d22 222c 2062  d, project="", b
+00004aa0: 6f64 793d 4e6f 6e65 2c20 6170 7065 6e64  ody=None, append
+00004ab0: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
+00004ac0: 2022 2222 5361 7665 2061 206c 6f67 2070   """Save a log p
+00004ad0: 6572 7369 7374 656e 746c 792e 0a0a 2020  ersistently...  
+00004ae0: 2020 2020 2020 3a70 6172 616d 2075 6964        :param uid
+00004af0: 3a20 4c6f 6720 756e 6971 7565 2049 440a  : Log unique ID.
+00004b00: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00004b10: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+00004b20: 6e61 6d65 2066 6f72 2077 6869 6368 2074  name for which t
+00004b30: 6869 7320 6c6f 6720 6265 6c6f 6e67 730a  his log belongs.
+00004b40: 2020 2020 2020 2020 3a70 6172 616d 2062          :param b
+00004b50: 6f64 793a 2054 6865 2061 6374 7561 6c20  ody: The actual 
+00004b60: 6c6f 6720 746f 2073 746f 7265 0a20 2020  log to store.   
+00004b70: 2020 2020 203a 7061 7261 6d20 6170 7065       :param appe
+00004b80: 6e64 3a20 5768 6574 6865 7220 746f 2061  nd: Whether to a
+00004b90: 7070 656e 6420 7468 6520 6c6f 6720 7072  ppend the log pr
+00004ba0: 6f76 6964 6564 2069 6e20 6060 626f 6479  ovided in ``body
+00004bb0: 6060 2074 6f20 616e 2065 7869 7374 696e  `` to an existin
+00004bc0: 6720 6c6f 6720 7769 7468 2074 6865 2073  g log with the s
+00004bd0: 616d 6520 6060 7569 6460 6020 6f72 2074  ame ``uid`` or t
+00004be0: 6f0a 2020 2020 2020 2020 2020 2020 6372  o.            cr
+00004bf0: 6561 7465 2061 206e 6577 206c 6f67 2e20  eate a new log. 
+00004c00: 4966 2073 6574 2074 6f20 6060 4661 6c73  If set to ``Fals
+00004c10: 6560 602c 2061 6e20 6578 6973 7469 6e67  e``, an existing
+00004c20: 206c 6f67 2077 6974 6820 7361 6d65 2060   log with same `
+00004c30: 6075 6964 6060 2077 696c 6c20 6265 206f  `uid`` will be o
+00004c40: 7665 7277 7269 7474 656e 0a20 2020 2020  verwritten.     
+00004c50: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00004c60: 6966 206e 6f74 2062 6f64 793a 0a20 2020  if not body:.   
+00004c70: 2020 2020 2020 2020 2072 6574 7572 6e0a           return.
+00004c80: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00004c90: 7365 6c66 2e5f 7061 7468 5f6f 6628 226c  self._path_of("l
+00004ca0: 6f67 222c 2070 726f 6a65 6374 2c20 7569  og", project, ui
+00004cb0: 6429 0a20 2020 2020 2020 2070 6172 616d  d).        param
+00004cc0: 7320 3d20 7b22 6170 7065 6e64 223a 2062  s = {"append": b
+00004cd0: 6f6f 6c32 7374 7228 6170 7065 6e64 297d  ool2str(append)}
+00004ce0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+00004cf0: 2066 2273 746f 7265 206c 6f67 207b 7072   f"store log {pr
+00004d00: 6f6a 6563 747d 2f7b 7569 647d 220a 2020  oject}/{uid}".  
+00004d10: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+00004d20: 616c 6c28 2250 4f53 5422 2c20 7061 7468  all("POST", path
+00004d30: 2c20 6572 726f 722c 2070 6172 616d 732c  , error, params,
+00004d40: 2062 6f64 7929 0a0a 2020 2020 6465 6620   body)..    def 
+00004d50: 6765 745f 6c6f 6728 7365 6c66 2c20 7569  get_log(self, ui
+00004d60: 642c 2070 726f 6a65 6374 3d22 222c 206f  d, project="", o
+00004d70: 6666 7365 743d 302c 2073 697a 653d 2d31  ffset=0, size=-1
+00004d80: 293a 0a20 2020 2020 2020 2022 2222 5265  ):.        """Re
+00004d90: 7472 6965 7665 2061 206c 6f67 2e0a 0a20  trieve a log... 
+00004da0: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
+00004db0: 643a 204c 6f67 2075 6e69 7175 6520 4944  d: Log unique ID
+00004dc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00004dd0: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
+00004de0: 206e 616d 6520 666f 7220 7768 6963 6820   name for which 
+00004df0: 7468 6520 6c6f 6720 6265 6c6f 6e67 730a  the log belongs.
+00004e00: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00004e10: 6666 7365 743a 2052 6574 7269 6576 6520  ffset: Retrieve 
+00004e20: 7061 7274 6961 6c20 6c6f 672c 2067 6574  partial log, get
+00004e30: 2075 7020 746f 2060 6073 697a 6560 6020   up to ``size`` 
+00004e40: 6279 7465 7320 7374 6172 7469 6e67 2061  bytes starting a
+00004e50: 7420 6f66 6673 6574 2060 606f 6666 7365  t offset ``offse
+00004e60: 7460 600a 2020 2020 2020 2020 2020 2020  t``.            
+00004e70: 6672 6f6d 2062 6567 696e 6e69 6e67 206f  from beginning o
+00004e80: 6620 6c6f 670a 2020 2020 2020 2020 3a70  f log.        :p
+00004e90: 6172 616d 2073 697a 653a 2053 6565 2060  aram size: See `
+00004ea0: 606f 6666 7365 7460 602e 2049 6620 7365  `offset``. If se
+00004eb0: 7420 746f 2060 602d 3160 6020 2874 6865  t to ``-1`` (the
+00004ec0: 2064 6566 6175 6c74 2920 7769 6c6c 2072   default) will r
+00004ed0: 6574 7269 6576 6520 616c 6c20 6461 7461  etrieve all data
+00004ee0: 2074 6f20 656e 6420 6f66 206c 6f67 2e0a   to end of log..
+00004ef0: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
+00004f00: 3a20 5468 6520 666f 6c6c 6f77 696e 6720  : The following 
+00004f10: 6f62 6a65 6374 733a 0a0a 2020 2020 2020  objects:..      
+00004f20: 2020 2020 2020 2d20 7374 6174 6520 2d20        - state - 
+00004f30: 5468 6520 7374 6174 6520 6f66 2074 6865  The state of the
+00004f40: 2072 756e 7469 6d65 206f 626a 6563 7420   runtime object 
+00004f50: 7768 6963 6820 6765 6e65 7261 7465 7320  which generates 
+00004f60: 7468 6973 206c 6f67 2c20 6966 2069 7420  this log, if it 
+00004f70: 6578 6973 7473 2e20 496e 2063 6173 6520  exists. In case 
+00004f80: 6e6f 206b 6e6f 776e 2073 7461 7465 0a20  no known state. 
+00004f90: 2020 2020 2020 2020 2020 2020 2065 7869               exi
+00004fa0: 7374 732c 2074 6869 7320 7769 6c6c 2062  sts, this will b
+00004fb0: 6520 6060 756e 6b6e 6f77 6e60 602e 0a20  e ``unknown``.. 
+00004fc0: 2020 2020 2020 2020 2020 202d 2063 6f6e             - con
+00004fd0: 7465 6e74 202d 2054 6865 2061 6374 7561  tent - The actua
+00004fe0: 6c20 6c6f 6720 636f 6e74 656e 742e 0a20  l log content.. 
+00004ff0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+00005000: 2020 2020 7061 7261 6d73 203d 207b 226f      params = {"o
+00005010: 6666 7365 7422 3a20 6f66 6673 6574 2c20  ffset": offset, 
+00005020: 2273 697a 6522 3a20 7369 7a65 7d0a 2020  "size": size}.  
+00005030: 2020 2020 2020 7061 7468 203d 2073 656c        path = sel
+00005040: 662e 5f70 6174 685f 6f66 2822 6c6f 6722  f._path_of("log"
+00005050: 2c20 7072 6f6a 6563 742c 2075 6964 290a  , project, uid).
+00005060: 2020 2020 2020 2020 6572 726f 7220 3d20          error = 
+00005070: 6622 6765 7420 6c6f 6720 7b70 726f 6a65  f"get log {proje
+00005080: 6374 7d2f 7b75 6964 7d22 0a20 2020 2020  ct}/{uid}".     
+00005090: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
+000050a0: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
+000050b0: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
+000050c0: 6d73 3d70 6172 616d 7329 0a20 2020 2020  ms=params).     
+000050d0: 2020 2069 6620 7265 7370 2e68 6561 6465     if resp.heade
+000050e0: 7273 3a0a 2020 2020 2020 2020 2020 2020  rs:.            
+000050f0: 7374 6174 6520 3d20 7265 7370 2e68 6561  state = resp.hea
+00005100: 6465 7273 2e67 6574 2822 782d 6d6c 7275  ders.get("x-mlru
+00005110: 6e2d 7275 6e2d 7374 6174 6522 2c20 2222  n-run-state", ""
+00005120: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+00005130: 7475 726e 2073 7461 7465 2e6c 6f77 6572  turn state.lower
+00005140: 2829 2c20 7265 7370 2e63 6f6e 7465 6e74  (), resp.content
+00005150: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+00005160: 2022 756e 6b6e 6f77 6e22 2c20 7265 7370   "unknown", resp
+00005170: 2e63 6f6e 7465 6e74 0a0a 2020 2020 6465  .content..    de
+00005180: 6620 7761 7463 685f 6c6f 6728 7365 6c66  f watch_log(self
+00005190: 2c20 7569 642c 2070 726f 6a65 6374 3d22  , uid, project="
+000051a0: 222c 2077 6174 6368 3d54 7275 652c 206f  ", watch=True, o
+000051b0: 6666 7365 743d 3029 3a0a 2020 2020 2020  ffset=0):.      
+000051c0: 2020 2222 2252 6574 7269 6576 6520 6c6f    """Retrieve lo
+000051d0: 6773 206f 6620 6120 7275 6e6e 696e 6720  gs of a running 
+000051e0: 7072 6f63 6573 732c 2061 6e64 2077 6174  process, and wat
+000051f0: 6368 2074 6865 2070 726f 6772 6573 7320  ch the progress 
+00005200: 6f66 2074 6865 2065 7865 6375 7469 6f6e  of the execution
+00005210: 2075 6e74 696c 2069 7420 636f 6d70 6c65   until it comple
+00005220: 7465 732e 2054 6869 730a 2020 2020 2020  tes. This.      
+00005230: 2020 6d65 7468 6f64 2077 696c 6c20 7072    method will pr
+00005240: 696e 7420 6f75 7420 7468 6520 6c6f 6773  int out the logs
+00005250: 2061 6e64 2063 6f6e 7469 6e75 6520 746f   and continue to
+00005260: 2070 6572 696f 6469 6361 6c6c 7920 706f   periodically po
+00005270: 6c6c 2066 6f72 2c20 616e 6420 7072 696e  ll for, and prin
+00005280: 742c 206e 6577 206c 6f67 7320 6173 206c  t, new logs as l
+00005290: 6f6e 6720 6173 2074 6865 0a20 2020 2020  ong as the.     
+000052a0: 2020 2073 7461 7465 206f 6620 7468 6520     state of the 
+000052b0: 7275 6e74 696d 6520 7768 6963 6820 6765  runtime which ge
+000052c0: 6e65 7261 7465 7320 7468 6973 206c 6f67  nerates this log
+000052d0: 2069 7320 6569 7468 6572 2060 6070 656e   is either ``pen
+000052e0: 6469 6e67 6060 206f 7220 6060 7275 6e6e  ding`` or ``runn
+000052f0: 696e 6760 602e 0a0a 2020 2020 2020 2020  ing``...        
+00005300: 3a70 6172 616d 2075 6964 3a20 5468 6520  :param uid: The 
+00005310: 7569 6420 6f66 2074 6865 206c 6f67 206f  uid of the log o
+00005320: 626a 6563 7420 746f 2077 6174 6368 2e0a  bject to watch..
+00005330: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00005340: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+00005350: 7468 6174 2074 6865 206c 6f67 2062 656c  that the log bel
+00005360: 6f6e 6773 2074 6f2e 0a20 2020 2020 2020  ongs to..       
+00005370: 203a 7061 7261 6d20 7761 7463 683a 2049   :param watch: I
+00005380: 6620 7365 7420 746f 2060 6054 7275 6560  f set to ``True`
+00005390: 6020 7769 6c6c 2063 6f6e 7469 6e75 6520  ` will continue 
+000053a0: 7472 6163 6b69 6e67 2074 6865 206c 6f67  tracking the log
+000053b0: 2061 7320 6465 7363 7269 6265 6420 6162   as described ab
+000053c0: 6f76 652e 204f 7468 6572 7769 7365 2074  ove. Otherwise t
+000053d0: 6869 7320 6675 6e63 7469 6f6e 0a20 2020  his function.   
+000053e0: 2020 2020 2020 2020 2069 7320 7072 6163           is prac
+000053f0: 7469 6361 6c6c 7920 6571 7569 7661 6c65  tically equivale
+00005400: 6e74 2074 6f20 7468 6520 3a70 793a 6675  nt to the :py:fu
+00005410: 6e63 3a60 7e67 6574 5f6c 6f67 6020 6675  nc:`~get_log` fu
+00005420: 6e63 7469 6f6e 2e0a 2020 2020 2020 2020  nction..        
+00005430: 3a70 6172 616d 206f 6666 7365 743a 204d  :param offset: M
+00005440: 696e 696d 616c 206f 6666 7365 7420 696e  inimal offset in
+00005450: 2074 6865 206c 6f67 2074 6f20 7761 7463   the log to watc
+00005460: 682e 0a20 2020 2020 2020 203a 7265 7475  h..        :retu
+00005470: 726e 733a 2054 6865 2066 696e 616c 2073  rns: The final s
+00005480: 7461 7465 206f 6620 7468 6520 6c6f 6720  tate of the log 
+00005490: 6265 696e 6720 7761 7463 6865 642e 0a20  being watched.. 
+000054a0: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+000054b0: 2020 2020 7374 6174 652c 2074 6578 7420      state, text 
+000054c0: 3d20 7365 6c66 2e67 6574 5f6c 6f67 2875  = self.get_log(u
+000054d0: 6964 2c20 7072 6f6a 6563 742c 206f 6666  id, project, off
+000054e0: 7365 743d 6f66 6673 6574 290a 2020 2020  set=offset).    
+000054f0: 2020 2020 6966 2074 6578 743a 0a20 2020      if text:.   
+00005500: 2020 2020 2020 2020 2070 7269 6e74 2874           print(t
+00005510: 6578 742e 6465 636f 6465 2865 7272 6f72  ext.decode(error
+00005520: 733d 6d6c 7275 6e2e 6d6c 636f 6e66 2e68  s=mlrun.mlconf.h
+00005530: 7474 7064 622e 6c6f 6773 2e64 6563 6f64  ttpdb.logs.decod
+00005540: 652e 6572 726f 7273 2929 0a20 2020 2020  e.errors)).     
+00005550: 2020 2069 6620 7761 7463 683a 0a20 2020     if watch:.   
+00005560: 2020 2020 2020 2020 206e 696c 5f72 6573           nil_res
+00005570: 7020 3d20 300a 2020 2020 2020 2020 2020  p = 0.          
+00005580: 2020 7768 696c 6520 7374 6174 6520 696e    while state in
+00005590: 205b 2270 656e 6469 6e67 222c 2022 7275   ["pending", "ru
+000055a0: 6e6e 696e 6722 5d3a 0a20 2020 2020 2020  nning"]:.       
+000055b0: 2020 2020 2020 2020 206f 6666 7365 7420           offset 
+000055c0: 2b3d 206c 656e 2874 6578 7429 0a20 2020  += len(text).   
+000055d0: 2020 2020 2020 2020 2020 2020 2023 2069               # i
+000055e0: 6620 7765 2067 6574 2033 206e 696c 2072  f we get 3 nil r
+000055f0: 6573 706f 6e73 6573 2069 6e20 6120 726f  esponses in a ro
+00005600: 772c 2069 6e63 7265 6173 6520 7468 6520  w, increase the 
+00005610: 736c 6565 7020 7469 6d65 2074 6f20 3130  sleep time to 10
+00005620: 2073 6563 6f6e 6473 0a20 2020 2020 2020   seconds.       
+00005630: 2020 2020 2020 2020 2023 2054 4f44 4f3a           # TODO:
+00005640: 2072 6566 6163 746f 7220 7468 6973 2074   refactor this t
+00005650: 6f20 7573 6520 6120 636f 6e64 6974 696f  o use a conditio
+00005660: 6e61 6c20 6261 636b 6f66 6620 6d65 6368  nal backoff mech
+00005670: 616e 6973 6d0a 2020 2020 2020 2020 2020  anism.          
+00005680: 2020 2020 2020 6966 206e 696c 5f72 6573        if nil_res
+00005690: 7020 3c20 333a 0a20 2020 2020 2020 2020  p < 3:.         
+000056a0: 2020 2020 2020 2020 2020 2074 696d 652e             time.
+000056b0: 736c 6565 7028 696e 7428 6d6c 7275 6e2e  sleep(int(mlrun.
+000056c0: 6d6c 636f 6e66 2e68 7474 7064 622e 6c6f  mlconf.httpdb.lo
+000056d0: 6773 2e70 756c 6c5f 6c6f 6773 5f64 6566  gs.pull_logs_def
+000056e0: 6175 6c74 5f69 6e74 6572 7661 6c29 290a  ault_interval)).
+000056f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005700: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00005710: 2020 2020 2020 2020 2020 7469 6d65 2e73            time.s
+00005720: 6c65 6570 280a 2020 2020 2020 2020 2020  leep(.          
+00005730: 2020 2020 2020 2020 2020 2020 2020 696e                in
+00005740: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+00005750: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00005760: 6c72 756e 2e6d 6c63 6f6e 662e 6874 7470  lrun.mlconf.http
+00005770: 6462 2e6c 6f67 732e 7075 6c6c 5f6c 6f67  db.logs.pull_log
+00005780: 735f 6261 636b 6f66 665f 6e6f 5f6c 6f67  s_backoff_no_log
+00005790: 735f 6465 6661 756c 745f 696e 7465 7276  s_default_interv
+000057a0: 616c 0a20 2020 2020 2020 2020 2020 2020  al.             
+000057b0: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+000057c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000057d0: 2029 0a20 2020 2020 2020 2020 2020 2020   ).             
+000057e0: 2020 2073 7461 7465 2c20 7465 7874 203d     state, text =
+000057f0: 2073 656c 662e 6765 745f 6c6f 6728 7569   self.get_log(ui
+00005800: 642c 2070 726f 6a65 6374 2c20 6f66 6673  d, project, offs
+00005810: 6574 3d6f 6666 7365 7429 0a20 2020 2020  et=offset).     
+00005820: 2020 2020 2020 2020 2020 2069 6620 7465             if te
+00005830: 7874 3a0a 2020 2020 2020 2020 2020 2020  xt:.            
+00005840: 2020 2020 2020 2020 6e69 6c5f 7265 7370          nil_resp
+00005850: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
+00005860: 2020 2020 2020 2020 2070 7269 6e74 280a           print(.
+00005870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005880: 2020 2020 2020 2020 7465 7874 2e64 6563          text.dec
+00005890: 6f64 6528 6572 726f 7273 3d6d 6c72 756e  ode(errors=mlrun
+000058a0: 2e6d 6c63 6f6e 662e 6874 7470 6462 2e6c  .mlconf.httpdb.l
+000058b0: 6f67 732e 6465 636f 6465 2e65 7272 6f72  ogs.decode.error
+000058c0: 7329 2c0a 2020 2020 2020 2020 2020 2020  s),.            
+000058d0: 2020 2020 2020 2020 2020 2020 656e 643d              end=
+000058e0: 2222 2c0a 2020 2020 2020 2020 2020 2020  "",.            
+000058f0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+00005900: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00005910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00005920: 2020 2020 6e69 6c5f 7265 7370 202b 3d20      nil_resp += 
+00005930: 310a 2020 2020 2020 2020 656c 7365 3a0a  1.        else:.
+00005940: 2020 2020 2020 2020 2020 2020 6f66 6673              offs
+00005950: 6574 202b 3d20 6c65 6e28 7465 7874 290a  et += len(text).
+00005960: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00005970: 7374 6174 652c 206f 6666 7365 740a 0a20  state, offset.. 
+00005980: 2020 2064 6566 2073 746f 7265 5f72 756e     def store_run
+00005990: 2873 656c 662c 2073 7472 7563 742c 2075  (self, struct, u
+000059a0: 6964 2c20 7072 6f6a 6563 743d 2222 2c20  id, project="", 
+000059b0: 6974 6572 3d30 293a 0a20 2020 2020 2020  iter=0):.       
+000059c0: 2022 2222 5374 6f72 6520 7275 6e20 6465   """Store run de
+000059d0: 7461 696c 7320 696e 2074 6865 2044 422e  tails in the DB.
+000059e0: 2054 6869 7320 6d65 7468 6f64 2069 7320   This method is 
+000059f0: 7573 7561 6c6c 7920 6361 6c6c 6564 2066  usually called f
+00005a00: 726f 6d20 7769 7468 696e 206f 7468 6572  rom within other
+00005a10: 203a 7079 3a6d 6f64 3a60 6d6c 7275 6e60   :py:mod:`mlrun`
+00005a20: 2066 6c6f 7773 0a20 2020 2020 2020 2061   flows.        a
+00005a30: 6e64 206e 6f74 2063 616c 6c65 6420 6469  nd not called di
+00005a40: 7265 6374 6c79 2062 7920 7468 6520 7573  rectly by the us
+00005a50: 6572 2e22 2222 0a0a 2020 2020 2020 2020  er."""..        
+00005a60: 7061 7468 203d 2073 656c 662e 5f70 6174  path = self._pat
+00005a70: 685f 6f66 2822 7275 6e22 2c20 7072 6f6a  h_of("run", proj
+00005a80: 6563 742c 2075 6964 290a 2020 2020 2020  ect, uid).      
+00005a90: 2020 7061 7261 6d73 203d 207b 2269 7465    params = {"ite
+00005aa0: 7222 3a20 6974 6572 7d0a 2020 2020 2020  r": iter}.      
+00005ab0: 2020 6572 726f 7220 3d20 6622 7374 6f72    error = f"stor
+00005ac0: 6520 7275 6e20 7b70 726f 6a65 6374 7d2f  e run {project}/
+00005ad0: 7b75 6964 7d22 0a20 2020 2020 2020 2062  {uid}".        b
+00005ae0: 6f64 7920 3d20 5f61 735f 6a73 6f6e 2873  ody = _as_json(s
+00005af0: 7472 7563 7429 0a20 2020 2020 2020 2073  truct).        s
+00005b00: 656c 662e 6170 695f 6361 6c6c 2822 504f  elf.api_call("PO
+00005b10: 5354 222c 2070 6174 682c 2065 7272 6f72  ST", path, error
+00005b20: 2c20 7061 7261 6d73 3d70 6172 616d 732c  , params=params,
+00005b30: 2062 6f64 793d 626f 6479 290a 0a20 2020   body=body)..   
+00005b40: 2064 6566 2075 7064 6174 655f 7275 6e28   def update_run(
+00005b50: 7365 6c66 2c20 7570 6461 7465 733a 2064  self, updates: d
+00005b60: 6963 742c 2075 6964 2c20 7072 6f6a 6563  ict, uid, projec
+00005b70: 743d 2222 2c20 6974 6572 3d30 2c20 7469  t="", iter=0, ti
+00005b80: 6d65 6f75 743d 3435 293a 0a20 2020 2020  meout=45):.     
+00005b90: 2020 2022 2222 5570 6461 7465 2074 6865     """Update the
+00005ba0: 2064 6574 6169 6c73 206f 6620 6120 7374   details of a st
+00005bb0: 6f72 6564 2072 756e 2069 6e20 7468 6520  ored run in the 
+00005bc0: 4442 2e22 2222 0a0a 2020 2020 2020 2020  DB."""..        
+00005bd0: 7061 7468 203d 2073 656c 662e 5f70 6174  path = self._pat
+00005be0: 685f 6f66 2822 7275 6e22 2c20 7072 6f6a  h_of("run", proj
+00005bf0: 6563 742c 2075 6964 290a 2020 2020 2020  ect, uid).      
+00005c00: 2020 7061 7261 6d73 203d 207b 2269 7465    params = {"ite
+00005c10: 7222 3a20 6974 6572 7d0a 2020 2020 2020  r": iter}.      
+00005c20: 2020 6572 726f 7220 3d20 6622 7570 6461    error = f"upda
+00005c30: 7465 2072 756e 207b 7072 6f6a 6563 747d  te run {project}
+00005c40: 2f7b 7569 647d 220a 2020 2020 2020 2020  /{uid}".        
+00005c50: 626f 6479 203d 205f 6173 5f6a 736f 6e28  body = _as_json(
+00005c60: 7570 6461 7465 7329 0a20 2020 2020 2020  updates).       
+00005c70: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00005c80: 5041 5443 4822 2c20 7061 7468 2c20 6572  PATCH", path, er
+00005c90: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+00005ca0: 6d73 2c20 626f 6479 3d62 6f64 792c 2074  ms, body=body, t
+00005cb0: 696d 656f 7574 3d74 696d 656f 7574 290a  imeout=timeout).
+00005cc0: 0a20 2020 2064 6566 2061 626f 7274 5f72  .    def abort_r
+00005cd0: 756e 2873 656c 662c 2075 6964 2c20 7072  un(self, uid, pr
+00005ce0: 6f6a 6563 743d 2222 2c20 6974 6572 3d30  oject="", iter=0
+00005cf0: 2c20 7469 6d65 6f75 743d 3435 293a 0a20  , timeout=45):. 
+00005d00: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005d10: 2020 2041 626f 7274 2061 2072 756e 6e69     Abort a runni
+00005d20: 6e67 2072 756e 202d 2077 696c 6c20 7265  ng run - will re
+00005d30: 6d6f 7665 2074 6865 2072 756e 2773 2072  move the run's r
+00005d40: 756e 7469 6d65 2072 6573 6f75 7263 6573  untime resources
+00005d50: 2061 6e64 206d 6172 6b20 6974 7320 7374   and mark its st
+00005d60: 6174 6520 6173 2061 626f 7274 6564 0a20  ate as aborted. 
+00005d70: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00005d80: 2020 2073 656c 662e 7570 6461 7465 5f72     self.update_r
+00005d90: 756e 280a 2020 2020 2020 2020 2020 2020  un(.            
+00005da0: 7b22 7374 6174 7573 2e73 7461 7465 223a  {"status.state":
+00005db0: 206d 6c72 756e 2e72 756e 7469 6d65 732e   mlrun.runtimes.
+00005dc0: 636f 6e73 7461 6e74 732e 5275 6e53 7461  constants.RunSta
+00005dd0: 7465 732e 6162 6f72 7465 647d 2c0a 2020  tes.aborted},.  
+00005de0: 2020 2020 2020 2020 2020 7569 642c 0a20            uid,. 
+00005df0: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+00005e00: 6374 2c0a 2020 2020 2020 2020 2020 2020  ct,.            
+00005e10: 6974 6572 2c0a 2020 2020 2020 2020 2020  iter,.          
+00005e20: 2020 7469 6d65 6f75 742c 0a20 2020 2020    timeout,.     
+00005e30: 2020 2029 0a0a 2020 2020 6465 6620 7265     )..    def re
+00005e40: 6164 5f72 756e 2873 656c 662c 2075 6964  ad_run(self, uid
+00005e50: 2c20 7072 6f6a 6563 743d 2222 2c20 6974  , project="", it
+00005e60: 6572 3d30 293a 0a20 2020 2020 2020 2022  er=0):.        "
+00005e70: 2222 5265 6164 2074 6865 2064 6574 6169  ""Read the detai
+00005e80: 6c73 206f 6620 6120 7374 6f72 6564 2072  ls of a stored r
+00005e90: 756e 2066 726f 6d20 7468 6520 4442 2e0a  un from the DB..
+00005ea0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00005eb0: 7569 643a 2054 6865 2072 756e 2773 2075  uid: The run's u
+00005ec0: 6e69 7175 6520 4944 2e0a 2020 2020 2020  nique ID..      
+00005ed0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00005ee0: 3a20 5072 6f6a 6563 7420 6e61 6d65 2e0a  : Project name..
+00005ef0: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+00005f00: 7465 723a 2049 7465 7261 7469 6f6e 2077  ter: Iteration w
+00005f10: 6974 6869 6e20 6120 7370 6563 6966 6963  ithin a specific
+00005f20: 2065 7865 6375 7469 6f6e 2e0a 2020 2020   execution..    
+00005f30: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00005f40: 2070 6174 6820 3d20 7365 6c66 2e5f 7061   path = self._pa
+00005f50: 7468 5f6f 6628 2272 756e 222c 2070 726f  th_of("run", pro
+00005f60: 6a65 6374 2c20 7569 6429 0a20 2020 2020  ject, uid).     
+00005f70: 2020 2070 6172 616d 7320 3d20 7b22 6974     params = {"it
+00005f80: 6572 223a 2069 7465 727d 0a20 2020 2020  er": iter}.     
+00005f90: 2020 2065 7272 6f72 203d 2066 2267 6574     error = f"get
+00005fa0: 2072 756e 207b 7072 6f6a 6563 747d 2f7b   run {project}/{
+00005fb0: 7569 647d 220a 2020 2020 2020 2020 7265  uid}".        re
+00005fc0: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
+00005fd0: 6c6c 2822 4745 5422 2c20 7061 7468 2c20  ll("GET", path, 
+00005fe0: 6572 726f 722c 2070 6172 616d 733d 7061  error, params=pa
+00005ff0: 7261 6d73 290a 2020 2020 2020 2020 7265  rams).        re
+00006000: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+00006010: 5b22 6461 7461 225d 0a0a 2020 2020 6465  ["data"]..    de
+00006020: 6620 6465 6c5f 7275 6e28 7365 6c66 2c20  f del_run(self, 
+00006030: 7569 642c 2070 726f 6a65 6374 3d22 222c  uid, project="",
+00006040: 2069 7465 723d 3029 3a0a 2020 2020 2020   iter=0):.      
+00006050: 2020 2222 2244 656c 6574 6520 6465 7461    """Delete deta
+00006060: 696c 7320 6f66 2061 2073 7065 6369 6669  ils of a specifi
+00006070: 6320 7275 6e20 6672 6f6d 2044 422e 0a0a  c run from DB...
+00006080: 2020 2020 2020 2020 3a70 6172 616d 2075          :param u
+00006090: 6964 3a20 556e 6971 7565 2049 4420 666f  id: Unique ID fo
+000060a0: 7220 7468 6520 7370 6563 6966 6963 2072  r the specific r
+000060b0: 756e 2074 6f20 6465 6c65 7465 2e0a 2020  un to delete..  
+000060c0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+000060d0: 6a65 6374 3a20 5072 6f6a 6563 7420 7468  ject: Project th
+000060e0: 6174 2074 6865 2072 756e 2062 656c 6f6e  at the run belon
+000060f0: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
+00006100: 7061 7261 6d20 6974 6572 3a20 4974 6572  param iter: Iter
+00006110: 6174 696f 6e20 7769 7468 696e 2061 2073  ation within a s
+00006120: 7065 6369 6669 6320 7461 736b 2e0a 2020  pecific task..  
+00006130: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00006140: 2020 2070 6174 6820 3d20 7365 6c66 2e5f     path = self._
+00006150: 7061 7468 5f6f 6628 2272 756e 222c 2070  path_of("run", p
+00006160: 726f 6a65 6374 2c20 7569 6429 0a20 2020  roject, uid).   
+00006170: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
+00006180: 6974 6572 223a 2069 7465 727d 0a20 2020  iter": iter}.   
+00006190: 2020 2020 2065 7272 6f72 203d 2066 2264       error = f"d
+000061a0: 656c 2072 756e 207b 7072 6f6a 6563 747d  el run {project}
+000061b0: 2f7b 7569 647d 220a 2020 2020 2020 2020  /{uid}".        
+000061c0: 7365 6c66 2e61 7069 5f63 616c 6c28 2244  self.api_call("D
+000061d0: 454c 4554 4522 2c20 7061 7468 2c20 6572  ELETE", path, er
+000061e0: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+000061f0: 6d73 290a 0a20 2020 2064 6566 206c 6973  ms)..    def lis
+00006200: 745f 7275 6e73 280a 2020 2020 2020 2020  t_runs(.        
+00006210: 7365 6c66 2c0a 2020 2020 2020 2020 6e61  self,.        na
+00006220: 6d65 3a20 4f70 7469 6f6e 616c 5b73 7472  me: Optional[str
+00006230: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00006240: 2020 7569 643a 204f 7074 696f 6e61 6c5b    uid: Optional[
+00006250: 556e 696f 6e5b 7374 722c 204c 6973 745b  Union[str, List[
+00006260: 7374 725d 5d5d 203d 204e 6f6e 652c 0a20  str]]] = None,. 
+00006270: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+00006280: 4f70 7469 6f6e 616c 5b73 7472 5d20 3d20  Optional[str] = 
+00006290: 4e6f 6e65 2c0a 2020 2020 2020 2020 6c61  None,.        la
+000062a0: 6265 6c73 3a20 4f70 7469 6f6e 616c 5b55  bels: Optional[U
+000062b0: 6e69 6f6e 5b73 7472 2c20 4c69 7374 5b73  nion[str, List[s
+000062c0: 7472 5d5d 5d20 3d20 4e6f 6e65 2c0a 2020  tr]]] = None,.  
+000062d0: 2020 2020 2020 7374 6174 653a 204f 7074        state: Opt
+000062e0: 696f 6e61 6c5b 7374 725d 203d 204e 6f6e  ional[str] = Non
+000062f0: 652c 0a20 2020 2020 2020 2073 6f72 743a  e,.        sort:
+00006300: 2062 6f6f 6c20 3d20 5472 7565 2c0a 2020   bool = True,.  
+00006310: 2020 2020 2020 6c61 7374 3a20 696e 7420        last: int 
+00006320: 3d20 302c 0a20 2020 2020 2020 2069 7465  = 0,.        ite
+00006330: 723a 2062 6f6f 6c20 3d20 4661 6c73 652c  r: bool = False,
+00006340: 0a20 2020 2020 2020 2073 7461 7274 5f74  .        start_t
+00006350: 696d 655f 6672 6f6d 3a20 4f70 7469 6f6e  ime_from: Option
+00006360: 616c 5b64 6174 6574 696d 655d 203d 204e  al[datetime] = N
+00006370: 6f6e 652c 0a20 2020 2020 2020 2073 7461  one,.        sta
+00006380: 7274 5f74 696d 655f 746f 3a20 4f70 7469  rt_time_to: Opti
+00006390: 6f6e 616c 5b64 6174 6574 696d 655d 203d  onal[datetime] =
+000063a0: 204e 6f6e 652c 0a20 2020 2020 2020 206c   None,.        l
+000063b0: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
+000063c0: 6672 6f6d 3a20 4f70 7469 6f6e 616c 5b64  from: Optional[d
+000063d0: 6174 6574 696d 655d 203d 204e 6f6e 652c  atetime] = None,
+000063e0: 0a20 2020 2020 2020 206c 6173 745f 7570  .        last_up
+000063f0: 6461 7465 5f74 696d 655f 746f 3a20 4f70  date_time_to: Op
+00006400: 7469 6f6e 616c 5b64 6174 6574 696d 655d  tional[datetime]
+00006410: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00006420: 2070 6172 7469 7469 6f6e 5f62 793a 204f   partition_by: O
+00006430: 7074 696f 6e61 6c5b 0a20 2020 2020 2020  ptional[.       
+00006440: 2020 2020 2055 6e69 6f6e 5b6d 6c72 756e       Union[mlrun
+00006450: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00006460: 5275 6e50 6172 7469 7469 6f6e 4279 4669  RunPartitionByFi
+00006470: 656c 642c 2073 7472 5d0a 2020 2020 2020  eld, str].      
+00006480: 2020 5d20 3d20 4e6f 6e65 2c0a 2020 2020    ] = None,.    
+00006490: 2020 2020 726f 7773 5f70 6572 5f70 6172      rows_per_par
+000064a0: 7469 7469 6f6e 3a20 696e 7420 3d20 312c  tition: int = 1,
+000064b0: 0a20 2020 2020 2020 2070 6172 7469 7469  .        partiti
+000064c0: 6f6e 5f73 6f72 745f 6279 3a20 4f70 7469  on_sort_by: Opti
+000064d0: 6f6e 616c 5b55 6e69 6f6e 5b6d 6c72 756e  onal[Union[mlrun
+000064e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000064f0: 536f 7274 4669 656c 642c 2073 7472 5d5d  SortField, str]]
+00006500: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00006510: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
+00006520: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
+00006530: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+00006540: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
+00006550: 7970 652c 2073 7472 0a20 2020 2020 2020  ype, str.       
+00006560: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
+00006570: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
+00006580: 7970 652e 6465 7363 2c0a 2020 2020 2020  ype.desc,.      
+00006590: 2020 6d61 785f 7061 7274 6974 696f 6e73    max_partitions
+000065a0: 3a20 696e 7420 3d20 302c 0a20 2020 2020  : int = 0,.     
+000065b0: 2020 2077 6974 685f 6e6f 7469 6669 6361     with_notifica
+000065c0: 7469 6f6e 733a 2062 6f6f 6c20 3d20 4661  tions: bool = Fa
+000065d0: 6c73 652c 0a20 2020 2029 202d 3e20 5275  lse,.    ) -> Ru
+000065e0: 6e4c 6973 743a 0a20 2020 2020 2020 2022  nList:.        "
+000065f0: 2222 5265 7472 6965 7665 2061 206c 6973  ""Retrieve a lis
+00006600: 7420 6f66 2072 756e 732c 2066 696c 7465  t of runs, filte
+00006610: 7265 6420 6279 2076 6172 696f 7573 206f  red by various o
+00006620: 7074 696f 6e73 2e0a 2020 2020 2020 2020  ptions..        
+00006630: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
+00006640: 2020 2020 2020 2072 756e 7320 3d20 6462         runs = db
+00006650: 2e6c 6973 745f 7275 6e73 286e 616d 653d  .list_runs(name=
+00006660: 2764 6f77 6e6c 6f61 6427 2c20 7072 6f6a  'download', proj
+00006670: 6563 743d 2769 7269 7327 2c20 6c61 6265  ect='iris', labe
+00006680: 6c73 3d5b 276f 776e 6572 3d61 646d 696e  ls=['owner=admin
+00006690: 272c 2027 6b69 6e64 3d6a 6f62 275d 290a  ', 'kind=job']).
+000066a0: 2020 2020 2020 2020 2020 2020 2320 4966              # If
+000066b0: 2072 756e 6e69 6e67 2069 6e20 4a75 7079   running in Jupy
+000066c0: 7465 722c 2063 616e 2075 7365 2074 6865  ter, can use the
+000066d0: 202e 7368 6f77 2829 2066 756e 6374 696f   .show() functio
+000066e0: 6e20 746f 2064 6973 706c 6179 2074 6865  n to display the
+000066f0: 2072 6573 756c 7473 0a20 2020 2020 2020   results.       
+00006700: 2020 2020 2064 622e 6c69 7374 5f72 756e       db.list_run
+00006710: 7328 6e61 6d65 3d27 272c 2070 726f 6a65  s(name='', proje
+00006720: 6374 3d70 726f 6a65 6374 5f6e 616d 6529  ct=project_name)
+00006730: 2e73 686f 7728 290a 0a0a 2020 2020 2020  .show()...      
+00006740: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
+00006750: 616d 6520 6f66 2074 6865 2072 756e 2074  ame of the run t
+00006760: 6f20 7265 7472 6965 7665 2e0a 2020 2020  o retrieve..    
+00006770: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
+00006780: 556e 6971 7565 2049 4420 6f66 2074 6865  Unique ID of the
+00006790: 2072 756e 2c20 6f72 2061 206c 6973 7420   run, or a list 
+000067a0: 6f66 2072 756e 2055 4944 732e 0a20 2020  of run UIDs..   
+000067b0: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+000067c0: 6563 743a 2050 726f 6a65 6374 2074 6861  ect: Project tha
+000067d0: 7420 7468 6520 7275 6e73 2062 656c 6f6e  t the runs belon
+000067e0: 6773 2074 6f2e 0a20 2020 2020 2020 203a  gs to..        :
+000067f0: 7061 7261 6d20 6c61 6265 6c73 3a20 4c69  param labels: Li
+00006800: 7374 2072 756e 7320 7468 6174 2068 6176  st runs that hav
+00006810: 6520 7370 6563 6966 6963 206c 6162 656c  e specific label
+00006820: 7320 6173 7369 676e 6564 2e20 6120 7369  s assigned. a si
+00006830: 6e67 6c65 206f 7220 6d75 6c74 6920 6c61  ngle or multi la
+00006840: 6265 6c20 6669 6c74 6572 2063 616e 2062  bel filter can b
+00006850: 650a 2020 2020 2020 2020 2020 2020 6170  e.            ap
+00006860: 706c 6965 642e 0a20 2020 2020 2020 203a  plied..        :
+00006870: 7061 7261 6d20 7374 6174 653a 204c 6973  param state: Lis
+00006880: 7420 6f6e 6c79 2072 756e 7320 7768 6f73  t only runs whos
+00006890: 6520 7374 6174 6520 6973 2073 7065 6369  e state is speci
+000068a0: 6669 6564 2e0a 2020 2020 2020 2020 3a70  fied..        :p
+000068b0: 6172 616d 2073 6f72 743a 2057 6865 7468  aram sort: Wheth
+000068c0: 6572 2074 6f20 736f 7274 2074 6865 2072  er to sort the r
+000068d0: 6573 756c 7420 6163 636f 7264 696e 6720  esult according 
+000068e0: 746f 2074 6865 6972 2073 7461 7274 2074  to their start t
+000068f0: 696d 652e 204f 7468 6572 7769 7365 2c20  ime. Otherwise, 
+00006900: 7265 7375 6c74 7320 7769 6c6c 2062 650a  results will be.
+00006910: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00006920: 726e 6564 2062 7920 7468 6569 7220 696e  rned by their in
+00006930: 7465 726e 616c 206f 7264 6572 2069 6e20  ternal order in 
+00006940: 7468 6520 4442 2028 6f72 6465 7220 7769  the DB (order wi
+00006950: 6c6c 206e 6f74 2062 6520 6775 6172 616e  ll not be guaran
+00006960: 7465 6564 292e 0a20 2020 2020 2020 203a  teed)..        :
+00006970: 7061 7261 6d20 6c61 7374 3a20 4465 7072  param last: Depr
+00006980: 6563 6174 6564 202d 2063 7572 7265 6e74  ecated - current
+00006990: 6c79 206e 6f74 2075 7365 642e 0a20 2020  ly not used..   
+000069a0: 2020 2020 203a 7061 7261 6d20 6974 6572       :param iter
+000069b0: 3a20 4966 2060 6054 7275 6560 6020 7265  : If ``True`` re
+000069c0: 7475 726e 2072 756e 7320 6672 6f6d 2061  turn runs from a
+000069d0: 6c6c 2069 7465 7261 7469 6f6e 732e 204f  ll iterations. O
+000069e0: 7468 6572 7769 7365 2c20 7265 7475 726e  therwise, return
+000069f0: 206f 6e6c 7920 7275 6e73 2077 686f 7365   only runs whose
+00006a00: 2060 6069 7465 7260 6020 6973 2030 2e0a   ``iter`` is 0..
+00006a10: 2020 2020 2020 2020 3a70 6172 616d 2073          :param s
+00006a20: 7461 7274 5f74 696d 655f 6672 6f6d 3a20  tart_time_from: 
+00006a30: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
+00006a40: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
+00006a50: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
+00006a60: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
+00006a70: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00006a80: 2073 7461 7274 5f74 696d 655f 746f 3a20   start_time_to: 
+00006a90: 4669 6c74 6572 2062 7920 7275 6e20 7374  Filter by run st
+00006aa0: 6172 7420 7469 6d65 2069 6e20 6060 5b73  art time in ``[s
+00006ab0: 7461 7274 5f74 696d 655f 6672 6f6d 2c20  tart_time_from, 
+00006ac0: 7374 6172 745f 7469 6d65 5f74 6f5d 6060  start_time_to]``
+00006ad0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00006ae0: 206c 6173 745f 7570 6461 7465 5f74 696d   last_update_tim
+00006af0: 655f 6672 6f6d 3a20 4669 6c74 6572 2062  e_from: Filter b
+00006b00: 7920 7275 6e20 6c61 7374 2075 7064 6174  y run last updat
+00006b10: 6520 7469 6d65 2069 6e20 6060 286c 6173  e time in ``(las
+00006b20: 745f 7570 6461 7465 5f74 696d 655f 6672  t_update_time_fr
+00006b30: 6f6d 2c0a 2020 2020 2020 2020 2020 2020  om,.            
+00006b40: 6c61 7374 5f75 7064 6174 655f 7469 6d65  last_update_time
+00006b50: 5f74 6f29 6060 2e0a 2020 2020 2020 2020  _to)``..        
+00006b60: 3a70 6172 616d 206c 6173 745f 7570 6461  :param last_upda
+00006b70: 7465 5f74 696d 655f 746f 3a20 4669 6c74  te_time_to: Filt
+00006b80: 6572 2062 7920 7275 6e20 6c61 7374 2075  er by run last u
+00006b90: 7064 6174 6520 7469 6d65 2069 6e20 6060  pdate time in ``
+00006ba0: 286c 6173 745f 7570 6461 7465 5f74 696d  (last_update_tim
+00006bb0: 655f 6672 6f6d 2c20 6c61 7374 5f75 7064  e_from, last_upd
+00006bc0: 6174 655f 7469 6d65 5f74 6f29 6060 2e0a  ate_time_to)``..
+00006bd0: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00006be0: 6172 7469 7469 6f6e 5f62 793a 2046 6965  artition_by: Fie
+00006bf0: 6c64 2074 6f20 6772 6f75 7020 7265 7375  ld to group resu
+00006c00: 6c74 7320 6279 2e20 4f6e 6c79 2061 6c6c  lts by. Only all
+00006c10: 6f77 6564 2076 616c 7565 2069 7320 606e  owed value is `n
+00006c20: 616d 6560 2e20 5768 656e 2060 7061 7274  ame`. When `part
+00006c30: 6974 696f 6e5f 6279 6020 6973 2073 7065  ition_by` is spe
+00006c40: 6369 6669 6564 2c0a 2020 2020 2020 2020  cified,.        
+00006c50: 2020 2020 7468 6520 6070 6172 7469 7469      the `partiti
+00006c60: 6f6e 5f73 6f72 745f 6279 6020 7061 7261  on_sort_by` para
+00006c70: 6d65 7465 7220 6d75 7374 2062 6520 7072  meter must be pr
+00006c80: 6f76 6964 6564 2061 7320 7765 6c6c 2e0a  ovided as well..
+00006c90: 2020 2020 2020 2020 3a70 6172 616d 2072          :param r
+00006ca0: 6f77 735f 7065 725f 7061 7274 6974 696f  ows_per_partitio
+00006cb0: 6e3a 2048 6f77 206d 616e 7920 746f 7020  n: How many top 
+00006cc0: 726f 7773 2028 7065 7220 736f 7274 696e  rows (per sortin
+00006cd0: 6720 6465 6669 6e65 6420 6279 2060 7061  g defined by `pa
+00006ce0: 7274 6974 696f 6e5f 736f 7274 5f62 7960  rtition_sort_by`
+00006cf0: 2061 6e64 2060 7061 7274 6974 696f 6e5f   and `partition_
+00006d00: 6f72 6465 7260 290a 2020 2020 2020 2020  order`).        
+00006d10: 2020 2020 746f 2072 6574 7572 6e20 7065      to return pe
+00006d20: 7220 6772 6f75 702e 2044 6566 6175 6c74  r group. Default
+00006d30: 2076 616c 7565 2069 7320 312e 0a20 2020   value is 1..   
+00006d40: 2020 2020 203a 7061 7261 6d20 7061 7274       :param part
+00006d50: 6974 696f 6e5f 736f 7274 5f62 793a 2057  ition_sort_by: W
+00006d60: 6861 7420 6669 656c 6420 746f 2073 6f72  hat field to sor
+00006d70: 7420 7468 6520 7265 7375 6c74 7320 6279  t the results by
+00006d80: 2c20 7769 7468 696e 2065 6163 6820 7061  , within each pa
+00006d90: 7274 6974 696f 6e20 6465 6669 6e65 6420  rtition defined 
+00006da0: 6279 2060 7061 7274 6974 696f 6e5f 6279  by `partition_by
+00006db0: 602e 0a20 2020 2020 2020 2020 2020 2043  `..            C
+00006dc0: 7572 7265 6e74 6c79 2074 6865 206f 6e6c  urrently the onl
+00006dd0: 7920 616c 6c6f 7765 6420 7661 6c75 6573  y allowed values
+00006de0: 2061 7265 2060 6372 6561 7465 6460 2061   are `created` a
+00006df0: 6e64 2060 7570 6461 7465 6460 2e0a 2020  nd `updated`..  
+00006e00: 2020 2020 2020 3a70 6172 616d 2070 6172        :param par
+00006e10: 7469 7469 6f6e 5f6f 7264 6572 3a20 4f72  tition_order: Or
+00006e20: 6465 7220 6f66 2073 6f72 7469 6e67 2077  der of sorting w
+00006e30: 6974 6869 6e20 7061 7274 6974 696f 6e73  ithin partitions
+00006e40: 202d 2060 6173 6360 206f 7220 6064 6573   - `asc` or `des
+00006e50: 6360 2e20 4465 6661 756c 7420 6973 2060  c`. Default is `
+00006e60: 6465 7363 602e 0a20 2020 2020 2020 203a  desc`..        :
+00006e70: 7061 7261 6d20 6d61 785f 7061 7274 6974  param max_partit
+00006e80: 696f 6e73 3a20 4d61 7869 6d61 6c20 6e75  ions: Maximal nu
+00006e90: 6d62 6572 206f 6620 7061 7274 6974 696f  mber of partitio
+00006ea0: 6e73 2074 6f20 696e 636c 7564 6520 696e  ns to include in
+00006eb0: 2074 6865 2072 6573 756c 742e 2044 6566   the result. Def
+00006ec0: 6175 6c74 2069 7320 6030 6020 7768 6963  ault is `0` whic
+00006ed0: 6820 6d65 616e 7320 6e6f 0a20 2020 2020  h means no.     
+00006ee0: 2020 2020 2020 206c 696d 6974 2e0a 2020         limit..  
+00006ef0: 2020 2020 2020 3a70 6172 616d 2077 6974        :param wit
+00006f00: 685f 6e6f 7469 6669 6361 7469 6f6e 733a  h_notifications:
+00006f10: 2052 6574 7572 6e20 7275 6e73 2077 6974   Return runs wit
+00006f20: 6820 6e6f 7469 6669 6361 7469 6f6e 732c  h notifications,
+00006f30: 2061 6e64 206a 6f69 6e20 7468 656d 2074   and join them t
+00006f40: 6f20 7468 6520 7265 7370 6f6e 7365 2e20  o the response. 
+00006f50: 4465 6661 756c 7420 6973 2060 4661 6c73  Default is `Fals
+00006f60: 6560 2e0a 2020 2020 2020 2020 2222 220a  e`..        """.
+00006f70: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00006f80: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+00006f90: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00006fa0: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
+00006fb0: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
+00006fc0: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
+00006fd0: 2c0a 2020 2020 2020 2020 2020 2020 2275  ,.            "u
+00006fe0: 6964 223a 2075 6964 2c0a 2020 2020 2020  id": uid,.      
+00006ff0: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
+00007000: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
+00007010: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00007020: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+00007030: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
+00007040: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00007050: 2020 2020 2022 736f 7274 223a 2062 6f6f       "sort": boo
+00007060: 6c32 7374 7228 736f 7274 292c 0a20 2020  l2str(sort),.   
+00007070: 2020 2020 2020 2020 2022 6974 6572 223a           "iter":
+00007080: 2062 6f6f 6c32 7374 7228 6974 6572 292c   bool2str(iter),
+00007090: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
+000070a0: 6172 745f 7469 6d65 5f66 726f 6d22 3a20  art_time_from": 
+000070b0: 6461 7465 7469 6d65 5f74 6f5f 6973 6f28  datetime_to_iso(
+000070c0: 7374 6172 745f 7469 6d65 5f66 726f 6d29  start_time_from)
+000070d0: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+000070e0: 7461 7274 5f74 696d 655f 746f 223a 2064  tart_time_to": d
+000070f0: 6174 6574 696d 655f 746f 5f69 736f 2873  atetime_to_iso(s
+00007100: 7461 7274 5f74 696d 655f 746f 292c 0a20  tart_time_to),. 
+00007110: 2020 2020 2020 2020 2020 2022 6c61 7374             "last
+00007120: 5f75 7064 6174 655f 7469 6d65 5f66 726f  _update_time_fro
+00007130: 6d22 3a20 6461 7465 7469 6d65 5f74 6f5f  m": datetime_to_
+00007140: 6973 6f28 6c61 7374 5f75 7064 6174 655f  iso(last_update_
+00007150: 7469 6d65 5f66 726f 6d29 2c0a 2020 2020  time_from),.    
+00007160: 2020 2020 2020 2020 226c 6173 745f 7570          "last_up
+00007170: 6461 7465 5f74 696d 655f 746f 223a 2064  date_time_to": d
+00007180: 6174 6574 696d 655f 746f 5f69 736f 286c  atetime_to_iso(l
+00007190: 6173 745f 7570 6461 7465 5f74 696d 655f  ast_update_time_
+000071a0: 746f 292c 0a20 2020 2020 2020 2020 2020  to),.           
+000071b0: 2022 7769 7468 2d6e 6f74 6966 6963 6174   "with-notificat
+000071c0: 696f 6e73 223a 2077 6974 685f 6e6f 7469  ions": with_noti
+000071d0: 6669 6361 7469 6f6e 732c 0a20 2020 2020  fications,.     
+000071e0: 2020 207d 0a0a 2020 2020 2020 2020 6966     }..        if
+000071f0: 2070 6172 7469 7469 6f6e 5f62 793a 0a20   partition_by:. 
+00007200: 2020 2020 2020 2020 2020 2070 6172 616d             param
+00007210: 732e 7570 6461 7465 280a 2020 2020 2020  s.update(.      
+00007220: 2020 2020 2020 2020 2020 7365 6c66 2e5f            self._
+00007230: 6765 6e65 7261 7465 5f70 6172 7469 7469  generate_partiti
+00007240: 6f6e 5f62 795f 7061 7261 6d73 280a 2020  on_by_params(.  
+00007250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007260: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
+00007270: 6368 656d 6173 2e52 756e 5061 7274 6974  chemas.RunPartit
+00007280: 696f 6e42 7946 6965 6c64 2c0a 2020 2020  ionByField,.    
+00007290: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072a0: 7061 7274 6974 696f 6e5f 6279 2c0a 2020  partition_by,.  
+000072b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000072c0: 2020 726f 7773 5f70 6572 5f70 6172 7469    rows_per_parti
+000072d0: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+000072e0: 2020 2020 2020 2020 2020 7061 7274 6974            partit
+000072f0: 696f 6e5f 736f 7274 5f62 792c 0a20 2020  ion_sort_by,.   
+00007300: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007310: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
+00007320: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00007330: 2020 2020 2020 6d61 785f 7061 7274 6974        max_partit
+00007340: 696f 6e73 2c0a 2020 2020 2020 2020 2020  ions,.          
+00007350: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+00007360: 2020 2020 290a 2020 2020 2020 2020 6572      ).        er
+00007370: 726f 7220 3d20 226c 6973 7420 7275 6e73  ror = "list runs
+00007380: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00007390: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+000073a0: 4745 5422 2c20 2272 756e 7322 2c20 6572  GET", "runs", er
+000073b0: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+000073c0: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
+000073d0: 726e 2052 756e 4c69 7374 2872 6573 702e  rn RunList(resp.
+000073e0: 6a73 6f6e 2829 5b22 7275 6e73 225d 290a  json()["runs"]).
+000073f0: 0a20 2020 2064 6566 2064 656c 5f72 756e  .    def del_run
+00007400: 7328 7365 6c66 2c20 6e61 6d65 3d4e 6f6e  s(self, name=Non
+00007410: 652c 2070 726f 6a65 6374 3d4e 6f6e 652c  e, project=None,
+00007420: 206c 6162 656c 733d 4e6f 6e65 2c20 7374   labels=None, st
+00007430: 6174 653d 4e6f 6e65 2c20 6461 7973 5f61  ate=None, days_a
+00007440: 676f 3d30 293a 0a20 2020 2020 2020 2022  go=0):.        "
+00007450: 2222 4465 6c65 7465 2061 2067 726f 7570  ""Delete a group
+00007460: 206f 6620 7275 6e73 2069 6465 6e74 6966   of runs identif
+00007470: 6965 6420 6279 2074 6865 2070 6172 616d  ied by the param
+00007480: 6574 6572 7320 6f66 2074 6865 2066 756e  eters of the fun
+00007490: 6374 696f 6e2e 0a0a 2020 2020 2020 2020  ction...        
+000074a0: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
+000074b0: 2020 2020 2020 2064 622e 6465 6c5f 7275         db.del_ru
+000074c0: 6e73 2873 7461 7465 3d27 636f 6d70 6c65  ns(state='comple
+000074d0: 7465 6427 290a 0a20 2020 2020 2020 203a  ted')..        :
+000074e0: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
+000074f0: 206f 6620 7468 6520 7461 736b 2077 6869   of the task whi
+00007500: 6368 2074 6865 2072 756e 7320 6265 6c6f  ch the runs belo
+00007510: 6e67 2074 6f2e 0a20 2020 2020 2020 203a  ng to..        :
+00007520: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+00007530: 726f 6a65 6374 2074 6f20 7768 6963 6820  roject to which 
+00007540: 7468 6520 7275 6e73 2062 656c 6f6e 672e  the runs belong.
+00007550: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00007560: 6c61 6265 6c73 3a20 4669 6c74 6572 2072  labels: Filter r
+00007570: 756e 7320 7468 6174 2061 7265 206c 6162  uns that are lab
+00007580: 656c 6564 2075 7369 6e67 2074 6865 7365  eled using these
+00007590: 2073 7065 6369 6669 6320 6c61 6265 6c20   specific label 
+000075a0: 7661 6c75 6573 2e0a 2020 2020 2020 2020  values..        
+000075b0: 3a70 6172 616d 2073 7461 7465 3a20 4669  :param state: Fi
+000075c0: 6c74 6572 206f 6e6c 7920 7275 6e73 2077  lter only runs w
+000075d0: 6869 6368 2061 7265 2069 6e20 7468 6973  hich are in this
+000075e0: 2073 7461 7465 2e0a 2020 2020 2020 2020   state..        
+000075f0: 3a70 6172 616d 2064 6179 735f 6167 6f3a  :param days_ago:
+00007600: 2046 696c 7465 7220 7275 6e73 2077 686f   Filter runs who
+00007610: 7365 2073 7461 7274 2074 696d 6520 6973  se start time is
+00007620: 206e 6577 6572 2074 6861 6e20 7468 6973   newer than this
+00007630: 2070 6172 616d 6574 6572 2e0a 2020 2020   parameter..    
+00007640: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+00007650: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+00007660: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+00007670: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+00007680: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+00007690: 2020 2020 2020 2020 2020 2020 226e 616d              "nam
+000076a0: 6522 3a20 6e61 6d65 2c0a 2020 2020 2020  e": name,.      
+000076b0: 2020 2020 2020 2270 726f 6a65 6374 223a        "project":
+000076c0: 2070 726f 6a65 6374 2c0a 2020 2020 2020   project,.      
+000076d0: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+000076e0: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+000076f0: 2020 2020 2020 2020 2022 7374 6174 6522           "state"
+00007700: 3a20 7374 6174 652c 0a20 2020 2020 2020  : state,.       
+00007710: 2020 2020 2022 6461 7973 5f61 676f 223a       "days_ago":
+00007720: 2073 7472 2864 6179 735f 6167 6f29 2c0a   str(days_ago),.
+00007730: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
+00007740: 2020 6572 726f 7220 3d20 2264 656c 2072    error = "del r
+00007750: 756e 7322 0a20 2020 2020 2020 2073 656c  uns".        sel
+00007760: 662e 6170 695f 6361 6c6c 2822 4445 4c45  f.api_call("DELE
+00007770: 5445 222c 2022 7275 6e73 222c 2065 7272  TE", "runs", err
+00007780: 6f72 2c20 7061 7261 6d73 3d70 6172 616d  or, params=param
+00007790: 7329 0a0a 2020 2020 6465 6620 7374 6f72  s)..    def stor
+000077a0: 655f 6172 7469 6661 6374 2873 656c 662c  e_artifact(self,
+000077b0: 206b 6579 2c20 6172 7469 6661 6374 2c20   key, artifact, 
+000077c0: 7569 642c 2069 7465 723d 4e6f 6e65 2c20  uid, iter=None, 
+000077d0: 7461 673d 4e6f 6e65 2c20 7072 6f6a 6563  tag=None, projec
+000077e0: 743d 2222 293a 0a20 2020 2020 2020 2022  t=""):.        "
+000077f0: 2222 5374 6f72 6520 616e 2061 7274 6966  ""Store an artif
+00007800: 6163 7420 696e 2074 6865 2044 422e 0a0a  act in the DB...
+00007810: 2020 2020 2020 2020 3a70 6172 616d 206b          :param k
+00007820: 6579 3a20 4964 656e 7469 6679 696e 6720  ey: Identifying 
+00007830: 6b65 7920 6f66 2074 6865 2061 7274 6966  key of the artif
+00007840: 6163 742e 0a20 2020 2020 2020 203a 7061  act..        :pa
+00007850: 7261 6d20 6172 7469 6661 6374 3a20 5468  ram artifact: Th
+00007860: 6520 6163 7475 616c 2061 7274 6966 6163  e actual artifac
+00007870: 7420 746f 2073 746f 7265 2e0a 2020 2020  t to store..    
+00007880: 2020 2020 3a70 6172 616d 2075 6964 3a20      :param uid: 
+00007890: 4120 756e 6971 7565 2049 4420 666f 7220  A unique ID for 
+000078a0: 7468 6973 2073 7065 6369 6669 6320 7665  this specific ve
+000078b0: 7273 696f 6e20 6f66 2074 6865 2061 7274  rsion of the art
+000078c0: 6966 6163 742e 0a20 2020 2020 2020 203a  ifact..        :
+000078d0: 7061 7261 6d20 6974 6572 3a20 5468 6520  param iter: The 
+000078e0: 7461 736b 2069 7465 7261 7469 6f6e 2077  task iteration w
+000078f0: 6869 6368 2067 656e 6572 6174 6564 2074  hich generated t
+00007900: 6869 7320 6172 7469 6661 6374 2e20 4966  his artifact. If
+00007910: 2060 6069 7465 7260 6020 6973 206e 6f74   ``iter`` is not
+00007920: 2060 604e 6f6e 6560 6020 7468 6520 6974   ``None`` the it
+00007930: 6572 6174 696f 6e20 7769 6c6c 0a20 2020  eration will.   
+00007940: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
+00007950: 6420 746f 2074 6865 206b 6579 2070 726f  d to the key pro
+00007960: 7669 6465 6420 746f 2067 656e 6572 6174  vided to generat
+00007970: 6520 6120 756e 6971 7565 206b 6579 2066  e a unique key f
+00007980: 6f72 2074 6865 2061 7274 6966 6163 7420  or the artifact 
+00007990: 6f66 2074 6865 2073 7065 6369 6669 6320  of the specific 
+000079a0: 6974 6572 6174 696f 6e2e 0a20 2020 2020  iteration..     
+000079b0: 2020 203a 7061 7261 6d20 7461 673a 2054     :param tag: T
+000079c0: 6167 206f 6620 7468 6520 6172 7469 6661  ag of the artifa
+000079d0: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
+000079e0: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+000079f0: 6563 7420 7468 6174 2074 6865 2061 7274  ect that the art
+00007a00: 6966 6163 7420 6265 6c6f 6e67 7320 746f  ifact belongs to
+00007a10: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00007a20: 2020 2020 2020 2065 6e64 706f 696e 745f         endpoint_
+00007a30: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+00007a40: 732f 7b70 726f 6a65 6374 7d2f 6172 7469  s/{project}/arti
+00007a50: 6661 6374 732f 7b75 6964 7d2f 7b6b 6579  facts/{uid}/{key
+00007a60: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
+00007a70: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00007a80: 2020 2274 6167 223a 2074 6167 2c0a 2020    "tag": tag,.  
+00007a90: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00007aa0: 6966 2069 7465 723a 0a20 2020 2020 2020  if iter:.       
+00007ab0: 2020 2020 2070 6172 616d 735b 2269 7465       params["ite
+00007ac0: 7222 5d20 3d20 7374 7228 6974 6572 290a  r"] = str(iter).
+00007ad0: 0a20 2020 2020 2020 2065 7272 6f72 203d  .        error =
+00007ae0: 2066 2273 746f 7265 2061 7274 6966 6163   f"store artifac
+00007af0: 7420 7b70 726f 6a65 6374 7d2f 7b75 6964  t {project}/{uid
+00007b00: 7d2f 7b6b 6579 7d22 0a0a 2020 2020 2020  }/{key}"..      
+00007b10: 2020 626f 6479 203d 205f 6173 5f6a 736f    body = _as_jso
+00007b20: 6e28 6172 7469 6661 6374 290a 2020 2020  n(artifact).    
+00007b30: 2020 2020 7365 6c66 2e61 7069 5f63 616c      self.api_cal
+00007b40: 6c28 2250 4f53 5422 2c20 656e 6470 6f69  l("POST", endpoi
+00007b50: 6e74 5f70 6174 682c 2065 7272 6f72 2c20  nt_path, error, 
+00007b60: 7061 7261 6d73 3d70 6172 616d 732c 2062  params=params, b
+00007b70: 6f64 793d 626f 6479 290a 0a20 2020 2064  ody=body)..    d
+00007b80: 6566 2072 6561 645f 6172 7469 6661 6374  ef read_artifact
+00007b90: 2873 656c 662c 206b 6579 2c20 7461 673d  (self, key, tag=
+00007ba0: 4e6f 6e65 2c20 6974 6572 3d4e 6f6e 652c  None, iter=None,
+00007bb0: 2070 726f 6a65 6374 3d22 2229 3a0a 2020   project=""):.  
+00007bc0: 2020 2020 2020 2222 2252 6561 6420 616e        """Read an
+00007bd0: 2061 7274 6966 6163 742c 2069 6465 6e74   artifact, ident
+00007be0: 6966 6965 6420 6279 2069 7473 206b 6579  ified by its key
+00007bf0: 2c20 7461 6720 616e 6420 6974 6572 6174  , tag and iterat
+00007c00: 696f 6e2e 2222 220a 0a20 2020 2020 2020  ion."""..       
+00007c10: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+00007c20: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+00007c30: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+00007c40: 2020 2020 2074 6167 203d 2074 6167 206f       tag = tag o
+00007c50: 7220 226c 6174 6573 7422 0a20 2020 2020  r "latest".     
+00007c60: 2020 2065 6e64 706f 696e 745f 7061 7468     endpoint_path
+00007c70: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
+00007c80: 726f 6a65 6374 7d2f 6172 7469 6661 6374  roject}/artifact
+00007c90: 732f 7b6b 6579 7d3f 7461 673d 7b74 6167  s/{key}?tag={tag
+00007ca0: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+00007cb0: 203d 2066 2272 6561 6420 6172 7469 6661   = f"read artifa
+00007cc0: 6374 207b 7072 6f6a 6563 747d 2f7b 6b65  ct {project}/{ke
+00007cd0: 797d 220a 2020 2020 2020 2020 2320 6578  y}".        # ex
+00007ce0: 706c 6963 6974 6c79 2073 6574 2061 7274  plicitly set art
+00007cf0: 6966 6163 7473 2066 6f72 6d61 7420 746f  ifacts format to
+00007d00: 2027 6675 6c6c 2720 7369 6e63 6520 6f6c   'full' since ol
+00007d10: 6420 7365 7276 6572 7320 6d61 7920 6465  d servers may de
+00007d20: 6661 756c 7420 746f 2027 6c65 6761 6379  fault to 'legacy
+00007d30: 270a 2020 2020 2020 2020 7061 7261 6d73  '.        params
+00007d40: 203d 207b 2266 6f72 6d61 7422 3a20 6d6c   = {"format": ml
+00007d50: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00007d60: 6173 2e41 7274 6966 6163 7473 466f 726d  as.ArtifactsForm
+00007d70: 6174 2e66 756c 6c2e 7661 6c75 657d 0a20  at.full.value}. 
+00007d80: 2020 2020 2020 2069 6620 6974 6572 3a0a         if iter:.
+00007d90: 2020 2020 2020 2020 2020 2020 7061 7261              para
+00007da0: 6d73 5b22 6974 6572 225d 203d 2073 7472  ms["iter"] = str
+00007db0: 2869 7465 7229 0a20 2020 2020 2020 2072  (iter).        r
+00007dc0: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
+00007dd0: 616c 6c28 2247 4554 222c 2065 6e64 706f  all("GET", endpo
+00007de0: 696e 745f 7061 7468 2c20 6572 726f 722c  int_path, error,
+00007df0: 2070 6172 616d 733d 7061 7261 6d73 290a   params=params).
+00007e00: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+00007e10: 6573 702e 6a73 6f6e 2829 5b22 6461 7461  esp.json()["data
+00007e20: 225d 0a0a 2020 2020 6465 6620 6465 6c5f  "]..    def del_
+00007e30: 6172 7469 6661 6374 2873 656c 662c 206b  artifact(self, k
+00007e40: 6579 2c20 7461 673d 4e6f 6e65 2c20 7072  ey, tag=None, pr
+00007e50: 6f6a 6563 743d 2222 293a 0a20 2020 2020  oject=""):.     
+00007e60: 2020 2022 2222 4465 6c65 7465 2061 6e20     """Delete an 
+00007e70: 6172 7469 6661 6374 2e22 2222 0a0a 2020  artifact."""..  
+00007e80: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
+00007e90: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+00007ea0: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
+00007eb0: 6163 7473 2f7b 6b65 797d 220a 2020 2020  acts/{key}".    
+00007ec0: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
+00007ed0: 2020 2020 2020 2020 2020 2022 6b65 7922             "key"
+00007ee0: 3a20 6b65 792c 0a20 2020 2020 2020 2020  : key,.         
+00007ef0: 2020 2022 7461 6722 3a20 7461 672c 0a20     "tag": tag,. 
+00007f00: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00007f10: 2065 7272 6f72 203d 2066 2264 656c 2061   error = f"del a
+00007f20: 7274 6966 6163 7420 7b70 726f 6a65 6374  rtifact {project
+00007f30: 7d2f 7b6b 6579 7d22 0a20 2020 2020 2020  }/{key}".       
+00007f40: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00007f50: 4445 4c45 5445 222c 2065 6e64 706f 696e  DELETE", endpoin
+00007f60: 745f 7061 7468 2c20 6572 726f 722c 2070  t_path, error, p
+00007f70: 6172 616d 733d 7061 7261 6d73 290a 0a20  arams=params).. 
+00007f80: 2020 2064 6566 206c 6973 745f 6172 7469     def list_arti
+00007f90: 6661 6374 7328 0a20 2020 2020 2020 2073  facts(.        s
+00007fa0: 656c 662c 0a20 2020 2020 2020 206e 616d  elf,.        nam
+00007fb0: 653d 4e6f 6e65 2c0a 2020 2020 2020 2020  e=None,.        
+00007fc0: 7072 6f6a 6563 743d 4e6f 6e65 2c0a 2020  project=None,.  
+00007fd0: 2020 2020 2020 7461 673d 4e6f 6e65 2c0a        tag=None,.
+00007fe0: 2020 2020 2020 2020 6c61 6265 6c73 3a20          labels: 
+00007ff0: 4f70 7469 6f6e 616c 5b55 6e69 6f6e 5b44  Optional[Union[D
+00008000: 6963 745b 7374 722c 2073 7472 5d2c 204c  ict[str, str], L
+00008010: 6973 745b 7374 725d 5d5d 203d 204e 6f6e  ist[str]]] = Non
+00008020: 652c 0a20 2020 2020 2020 2073 696e 6365  e,.        since
+00008030: 3d4e 6f6e 652c 0a20 2020 2020 2020 2075  =None,.        u
+00008040: 6e74 696c 3d4e 6f6e 652c 0a20 2020 2020  ntil=None,.     
+00008050: 2020 2069 7465 723a 2069 6e74 203d 204e     iter: int = N
+00008060: 6f6e 652c 0a20 2020 2020 2020 2062 6573  one,.        bes
+00008070: 745f 6974 6572 6174 696f 6e3a 2062 6f6f  t_iteration: boo
+00008080: 6c20 3d20 4661 6c73 652c 0a20 2020 2020  l = False,.     
+00008090: 2020 206b 696e 643a 2073 7472 203d 204e     kind: str = N
+000080a0: 6f6e 652c 0a20 2020 2020 2020 2063 6174  one,.        cat
+000080b0: 6567 6f72 793a 2055 6e69 6f6e 5b73 7472  egory: Union[str
+000080c0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+000080d0: 6368 656d 6173 2e41 7274 6966 6163 7443  chemas.ArtifactC
+000080e0: 6174 6567 6f72 6965 735d 203d 204e 6f6e  ategories] = Non
+000080f0: 652c 0a20 2020 2029 202d 3e20 4172 7469  e,.    ) -> Arti
+00008100: 6661 6374 4c69 7374 3a0a 2020 2020 2020  factList:.      
+00008110: 2020 2222 224c 6973 7420 6172 7469 6661    """List artifa
+00008120: 6374 7320 6669 6c74 6572 6564 2062 7920  cts filtered by 
+00008130: 7661 7269 6f75 7320 7061 7261 6d65 7465  various paramete
+00008140: 7273 2e0a 0a20 2020 2020 2020 2045 7861  rs...        Exa
+00008150: 6d70 6c65 733a 3a0a 0a20 2020 2020 2020  mples::..       
+00008160: 2020 2020 2023 2053 686f 7720 6c61 7465       # Show late
+00008170: 7374 2076 6572 7369 6f6e 206f 6620 616c  st version of al
+00008180: 6c20 6172 7469 6661 6374 7320 696e 2070  l artifacts in p
+00008190: 726f 6a65 6374 0a20 2020 2020 2020 2020  roject.         
+000081a0: 2020 206c 6174 6573 745f 6172 7469 6661     latest_artifa
+000081b0: 6374 7320 3d20 6462 2e6c 6973 745f 6172  cts = db.list_ar
+000081c0: 7469 6661 6374 7328 2727 2c20 7461 673d  tifacts('', tag=
+000081d0: 276c 6174 6573 7427 2c20 7072 6f6a 6563  'latest', projec
+000081e0: 743d 2769 7269 7327 290a 2020 2020 2020  t='iris').      
+000081f0: 2020 2020 2020 2320 6368 6563 6b20 6469        # check di
+00008200: 6666 6572 656e 7420 6172 7469 6661 6374  fferent artifact
+00008210: 2076 6572 7369 6f6e 7320 666f 7220 6120   versions for a 
+00008220: 7370 6563 6966 6963 2061 7274 6966 6163  specific artifac
+00008230: 740a 2020 2020 2020 2020 2020 2020 7265  t.            re
+00008240: 7375 6c74 5f76 6572 7369 6f6e 7320 3d20  sult_versions = 
+00008250: 6462 2e6c 6973 745f 6172 7469 6661 6374  db.list_artifact
+00008260: 7328 2772 6573 756c 7473 272c 2074 6167  s('results', tag
+00008270: 3d27 2a27 2c20 7072 6f6a 6563 743d 2769  ='*', project='i
+00008280: 7269 7327 290a 2020 2020 2020 2020 2020  ris').          
+00008290: 2020 2320 5368 6f77 2061 7274 6966 6163    # Show artifac
+000082a0: 7473 2077 6974 6820 6c61 6265 6c20 6669  ts with label fi
+000082b0: 6c74 6572 7320 2d20 626f 7468 2075 706c  lters - both upl
+000082c0: 6f61 6465 6420 616e 6420 6f66 2062 696e  oaded and of bin
+000082d0: 6172 7920 7479 7065 0a20 2020 2020 2020  ary type.       
+000082e0: 2020 2020 2072 6573 756c 745f 6c61 6265       result_labe
+000082f0: 6c73 203d 2064 622e 6c69 7374 5f61 7274  ls = db.list_art
+00008300: 6966 6163 7473 2827 7265 7375 6c74 7327  ifacts('results'
+00008310: 2c20 7461 673d 272a 272c 2070 726f 6a65  , tag='*', proje
+00008320: 6374 3d27 6972 6973 272c 206c 6162 656c  ct='iris', label
+00008330: 733d 5b27 7570 6c6f 6164 6564 272c 2027  s=['uploaded', '
+00008340: 7479 7065 3d62 696e 6172 7927 5d29 0a0a  type=binary'])..
+00008350: 2020 2020 2020 2020 3a70 6172 616d 206e          :param n
+00008360: 616d 653a 204e 616d 6520 6f66 2061 7274  ame: Name of art
+00008370: 6966 6163 7473 2074 6f20 7265 7472 6965  ifacts to retrie
+00008380: 7665 2e20 4e61 6d65 2077 6974 6820 277e  ve. Name with '~
+00008390: 2720 7072 6566 6978 2069 7320 7573 6564  ' prefix is used
+000083a0: 2061 7320 6120 6c69 6b65 2071 7565 7279   as a like query
+000083b0: 2c20 616e 6420 6973 206e 6f74 0a20 2020  , and is not.   
+000083c0: 2020 2020 2020 2020 2063 6173 652d 7365           case-se
+000083d0: 6e73 6974 6976 652e 2054 6869 7320 6d65  nsitive. This me
+000083e0: 616e 7320 7468 6174 2071 7565 7279 696e  ans that queryin
+000083f0: 6720 666f 7220 6060 7e6e 616d 6560 6020  g for ``~name`` 
+00008400: 6d61 7920 7265 7475 726e 2061 7274 6966  may return artif
+00008410: 6163 7473 206e 616d 6564 0a20 2020 2020  acts named.     
+00008420: 2020 2020 2020 2060 606d 795f 4e61 6d65         ``my_Name
+00008430: 5f31 6060 206f 7220 6060 7375 726e 616d  _1`` or ``surnam
+00008440: 6560 602e 0a20 2020 2020 2020 203a 7061  e``..        :pa
+00008450: 7261 6d20 7072 6f6a 6563 743a 2050 726f  ram project: Pro
+00008460: 6a65 6374 206e 616d 652e 0a20 2020 2020  ject name..     
+00008470: 2020 203a 7061 7261 6d20 7461 673a 2052     :param tag: R
+00008480: 6574 7572 6e20 6172 7469 6661 6374 7320  eturn artifacts 
+00008490: 6173 7369 676e 6564 2074 6869 7320 7461  assigned this ta
+000084a0: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
+000084b0: 6d20 6c61 6265 6c73 3a20 5265 7475 726e  m labels: Return
+000084c0: 2061 7274 6966 6163 7473 2074 6861 7420   artifacts that 
+000084d0: 6861 7665 2074 6865 7365 206c 6162 656c  have these label
+000084e0: 732e 204c 6162 656c 7320 6361 6e20 6569  s. Labels can ei
+000084f0: 7468 6572 2062 6520 6120 6469 6374 696f  ther be a dictio
+00008500: 6e61 7279 207b 226c 6162 656c 223a 2022  nary {"label": "
+00008510: 7661 6c75 6522 7d20 6f72 0a20 2020 2020  value"} or.     
+00008520: 2020 2020 2020 2061 206c 6973 7420 6f66         a list of
+00008530: 2022 6c61 6265 6c3d 7661 6c75 6522 2028   "label=value" (
+00008540: 6d61 7463 6820 6c61 6265 6c20 6b65 7920  match label key 
+00008550: 616e 6420 7661 6c75 6529 206f 7220 226c  and value) or "l
+00008560: 6162 656c 2220 286d 6174 6368 206a 7573  abel" (match jus
+00008570: 7420 6c61 6265 6c20 6b65 7929 2073 7472  t label key) str
+00008580: 696e 6773 2e0a 2020 2020 2020 2020 3a70  ings..        :p
+00008590: 6172 616d 2073 696e 6365 3a20 4e6f 7420  aram since: Not 
+000085a0: 696e 2075 7365 2069 6e20 3a70 793a 636c  in use in :py:cl
+000085b0: 6173 733a 6048 5454 5052 756e 4442 602e  ass:`HTTPRunDB`.
+000085c0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000085d0: 756e 7469 6c3a 204e 6f74 2069 6e20 7573  until: Not in us
+000085e0: 6520 696e 203a 7079 3a63 6c61 7373 3a60  e in :py:class:`
+000085f0: 4854 5450 5275 6e44 4260 2e0a 2020 2020  HTTPRunDB`..    
+00008600: 2020 2020 3a70 6172 616d 2069 7465 723a      :param iter:
+00008610: 2052 6574 7572 6e20 6172 7469 6661 6374   Return artifact
+00008620: 7320 6672 6f6d 2061 2073 7065 6369 6669  s from a specifi
+00008630: 6320 6974 6572 6174 696f 6e20 2877 6865  c iteration (whe
+00008640: 7265 2060 6069 7465 723d 3060 6020 6d65  re ``iter=0`` me
+00008650: 616e 7320 7468 6520 726f 6f74 2069 7465  ans the root ite
+00008660: 7261 7469 6f6e 292e 2049 660a 2020 2020  ration). If.    
+00008670: 2020 2020 2020 2020 6060 4e6f 6e65 6060          ``None``
+00008680: 2028 6465 6661 756c 7429 2072 6574 7572   (default) retur
+00008690: 6e20 6172 7469 6661 6374 7320 6672 6f6d  n artifacts from
+000086a0: 2061 6c6c 2069 7465 7261 7469 6f6e 732e   all iterations.
+000086b0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000086c0: 6265 7374 5f69 7465 7261 7469 6f6e 3a20  best_iteration: 
+000086d0: 5265 7475 726e 7320 7468 6520 6172 7469  Returns the arti
+000086e0: 6661 6374 2077 6869 6368 2062 656c 6f6e  fact which belon
+000086f0: 6773 2074 6f20 7468 6520 6265 7374 2069  gs to the best i
+00008700: 7465 7261 7469 6f6e 206f 6620 6120 6769  teration of a gi
+00008710: 7665 6e20 7275 6e2c 2069 6e20 7468 6520  ven run, in the 
+00008720: 6361 7365 206f 660a 2020 2020 2020 2020  case of.        
+00008730: 2020 2020 6172 7469 6661 6374 7320 6765      artifacts ge
+00008740: 6e65 7261 7465 6420 6672 6f6d 2061 2068  nerated from a h
+00008750: 7970 6572 2d70 6172 616d 2072 756e 2e20  yper-param run. 
+00008760: 4966 206f 6e6c 7920 6120 7369 6e67 6c65  If only a single
+00008770: 2069 7465 7261 7469 6f6e 2065 7869 7374   iteration exist
+00008780: 732c 2077 696c 6c20 7265 7475 726e 2074  s, will return t
+00008790: 6865 2061 7274 6966 6163 740a 2020 2020  he artifact.    
+000087a0: 2020 2020 2020 2020 6672 6f6d 2074 6861          from tha
+000087b0: 7420 6974 6572 6174 696f 6e2e 2049 6620  t iteration. If 
+000087c0: 7573 696e 6720 6060 6265 7374 5f69 7465  using ``best_ite
+000087d0: 7260 602c 2074 6865 2060 6069 7465 7260  r``, the ``iter`
+000087e0: 6020 7061 7261 6d65 7465 7220 6d75 7374  ` parameter must
+000087f0: 206e 6f74 2062 6520 7573 6564 2e0a 2020   not be used..  
+00008800: 2020 2020 2020 3a70 6172 616d 206b 696e        :param kin
+00008810: 643a 2052 6574 7572 6e20 6172 7469 6661  d: Return artifa
+00008820: 6374 7320 6f66 2074 6865 2072 6571 7565  cts of the reque
+00008830: 7374 6564 206b 696e 642e 0a20 2020 2020  sted kind..     
+00008840: 2020 203a 7061 7261 6d20 6361 7465 676f     :param catego
+00008850: 7279 3a20 5265 7475 726e 2061 7274 6966  ry: Return artif
+00008860: 6163 7473 206f 6620 7468 6520 7265 7175  acts of the requ
+00008870: 6573 7465 6420 6361 7465 676f 7279 2e0a  ested category..
+00008880: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+00008890: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
+000088a0: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
+000088b0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+000088c0: 0a0a 2020 2020 2020 2020 6c61 6265 6c73  ..        labels
+000088d0: 203d 206c 6162 656c 7320 6f72 205b 5d0a   = labels or [].
+000088e0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+000088f0: 7461 6e63 6528 6c61 6265 6c73 2c20 6469  tance(labels, di
+00008900: 6374 293a 0a20 2020 2020 2020 2020 2020  ct):.           
+00008910: 206c 6162 656c 7320 3d20 5b66 227b 6b65   labels = [f"{ke
+00008920: 797d 3d7b 7661 6c75 657d 2220 666f 7220  y}={value}" for 
+00008930: 6b65 792c 2076 616c 7565 2069 6e20 6c61  key, value in la
+00008940: 6265 6c73 2e69 7465 6d73 2829 5d0a 0a20  bels.items()].. 
+00008950: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00008960: 7b0a 2020 2020 2020 2020 2020 2020 226e  {.            "n
+00008970: 616d 6522 3a20 6e61 6d65 2c0a 2020 2020  ame": name,.    
+00008980: 2020 2020 2020 2020 2274 6167 223a 2074          "tag": t
+00008990: 6167 2c0a 2020 2020 2020 2020 2020 2020  ag,.            
+000089a0: 226c 6162 656c 223a 206c 6162 656c 732c  "label": labels,
+000089b0: 0a20 2020 2020 2020 2020 2020 2022 6974  .            "it
+000089c0: 6572 223a 2069 7465 722c 0a20 2020 2020  er": iter,.     
+000089d0: 2020 2020 2020 2022 6265 7374 2d69 7465         "best-ite
+000089e0: 7261 7469 6f6e 223a 2062 6573 745f 6974  ration": best_it
+000089f0: 6572 6174 696f 6e2c 0a20 2020 2020 2020  eration,.       
+00008a00: 2020 2020 2022 6b69 6e64 223a 206b 696e       "kind": kin
+00008a10: 642c 0a20 2020 2020 2020 2020 2020 2022  d,.            "
+00008a20: 6361 7465 676f 7279 223a 2063 6174 6567  category": categ
+00008a30: 6f72 792c 0a20 2020 2020 2020 2020 2020  ory,.           
+00008a40: 2022 666f 726d 6174 223a 206d 6c72 756e   "format": mlrun
+00008a50: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00008a60: 4172 7469 6661 6374 7346 6f72 6d61 742e  ArtifactsFormat.
+00008a70: 6675 6c6c 2e76 616c 7565 2c0a 2020 2020  full.value,.    
+00008a80: 2020 2020 7d0a 2020 2020 2020 2020 6572      }.        er
+00008a90: 726f 7220 3d20 226c 6973 7420 6172 7469  ror = "list arti
+00008aa0: 6661 6374 7322 0a20 2020 2020 2020 2065  facts".        e
+00008ab0: 6e64 706f 696e 745f 7061 7468 203d 2066  ndpoint_path = f
+00008ac0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+00008ad0: 6374 7d2f 6172 7469 6661 6374 7322 0a20  ct}/artifacts". 
+00008ae0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00008af0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
+00008b00: 222c 2065 6e64 706f 696e 745f 7061 7468  ", endpoint_path
+00008b10: 2c20 6572 726f 722c 2070 6172 616d 733d  , error, params=
+00008b20: 7061 7261 6d73 290a 2020 2020 2020 2020  params).        
+00008b30: 7661 6c75 6573 203d 2041 7274 6966 6163  values = Artifac
+00008b40: 744c 6973 7428 7265 7370 2e6a 736f 6e28  tList(resp.json(
+00008b50: 295b 2261 7274 6966 6163 7473 225d 290a  )["artifacts"]).
+00008b60: 2020 2020 2020 2020 7661 6c75 6573 2e74          values.t
+00008b70: 6167 203d 2074 6167 0a20 2020 2020 2020  ag = tag.       
+00008b80: 2072 6574 7572 6e20 7661 6c75 6573 0a0a   return values..
+00008b90: 2020 2020 6465 6620 6465 6c5f 6172 7469      def del_arti
+00008ba0: 6661 6374 7328 7365 6c66 2c20 6e61 6d65  facts(self, name
+00008bb0: 3d4e 6f6e 652c 2070 726f 6a65 6374 3d4e  =None, project=N
+00008bc0: 6f6e 652c 2074 6167 3d4e 6f6e 652c 206c  one, tag=None, l
+00008bd0: 6162 656c 733d 4e6f 6e65 2c20 6461 7973  abels=None, days
+00008be0: 5f61 676f 3d30 293a 0a20 2020 2020 2020  _ago=0):.       
+00008bf0: 2022 2222 4465 6c65 7465 2061 7274 6966   """Delete artif
+00008c00: 6163 7473 2072 6566 6572 656e 6365 6420  acts referenced 
+00008c10: 6279 2074 6865 2070 6172 616d 6574 6572  by the parameter
+00008c20: 732e 0a0a 2020 2020 2020 2020 3a70 6172  s...        :par
+00008c30: 616d 206e 616d 653a 204e 616d 6520 6f66  am name: Name of
+00008c40: 2061 7274 6966 6163 7473 2074 6f20 6465   artifacts to de
+00008c50: 6c65 7465 2e20 4e6f 7465 2074 6861 7420  lete. Note that 
+00008c60: 7468 6973 2069 7320 6120 6c69 6b65 2071  this is a like q
+00008c70: 7565 7279 2c20 616e 6420 6973 2063 6173  uery, and is cas
+00008c80: 652d 696e 7365 6e73 6974 6976 652e 2053  e-insensitive. S
+00008c90: 6565 0a20 2020 2020 2020 2020 2020 203a  ee.            :
+00008ca0: 7079 3a66 756e 633a 607e 6c69 7374 5f61  py:func:`~list_a
+00008cb0: 7274 6966 6163 7473 6020 666f 7220 6d6f  rtifacts` for mo
+00008cc0: 7265 2064 6574 6169 6c73 2e0a 2020 2020  re details..    
+00008cd0: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+00008ce0: 6374 3a20 5072 6f6a 6563 7420 7468 6174  ct: Project that
+00008cf0: 2061 7274 6966 6163 7473 2062 656c 6f6e   artifacts belon
+00008d00: 6720 746f 2e0a 2020 2020 2020 2020 3a70  g to..        :p
+00008d10: 6172 616d 2074 6167 3a20 4368 6f6f 7365  aram tag: Choose
+00008d20: 2061 7274 6966 6163 7473 2077 686f 2061   artifacts who a
+00008d30: 7265 2061 7373 6967 6e65 6420 7468 6973  re assigned this
+00008d40: 2074 6167 2e0a 2020 2020 2020 2020 3a70   tag..        :p
+00008d50: 6172 616d 206c 6162 656c 733a 2043 686f  aram labels: Cho
+00008d60: 6f73 6520 6172 7469 6661 6374 7320 7768  ose artifacts wh
+00008d70: 6963 6820 6172 6520 6c61 6265 6c65 642e  ich are labeled.
+00008d80: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00008d90: 6461 7973 5f61 676f 3a20 5468 6973 2070  days_ago: This p
+00008da0: 6172 616d 6574 6572 2069 7320 6465 7072  arameter is depr
+00008db0: 6563 6174 6564 2061 6e64 206e 6f74 2075  ecated and not u
+00008dc0: 7365 642e 0a20 2020 2020 2020 2022 2222  sed..        """
+00008dd0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00008de0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+00008df0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00008e00: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
+00008e10: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
+00008e20: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
+00008e30: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+00008e40: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+00008e50: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00008e60: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+00008e70: 2020 2020 2020 2020 2022 6461 7973 5f61           "days_a
+00008e80: 676f 223a 2073 7472 2864 6179 735f 6167  go": str(days_ag
+00008e90: 6f29 2c0a 2020 2020 2020 2020 7d0a 2020  o),.        }.  
+00008ea0: 2020 2020 2020 6572 726f 7220 3d20 2264        error = "d
+00008eb0: 656c 2061 7274 6966 6163 7473 220a 2020  el artifacts".  
+00008ec0: 2020 2020 2020 656e 6470 6f69 6e74 5f70        endpoint_p
+00008ed0: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+00008ee0: 2f7b 7072 6f6a 6563 747d 2f61 7274 6966  /{project}/artif
+00008ef0: 6163 7473 220a 2020 2020 2020 2020 7365  acts".        se
+00008f00: 6c66 2e61 7069 5f63 616c 6c28 2244 454c  lf.api_call("DEL
+00008f10: 4554 4522 2c20 656e 6470 6f69 6e74 5f70  ETE", endpoint_p
+00008f20: 6174 682c 2065 7272 6f72 2c20 7061 7261  ath, error, para
+00008f30: 6d73 3d70 6172 616d 7329 0a0a 2020 2020  ms=params)..    
+00008f40: 6465 6620 6c69 7374 5f61 7274 6966 6163  def list_artifac
+00008f50: 745f 7461 6773 280a 2020 2020 2020 2020  t_tags(.        
+00008f60: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00008f70: 6f6a 6563 743d 4e6f 6e65 2c0a 2020 2020  oject=None,.    
+00008f80: 2020 2020 6361 7465 676f 7279 3a20 556e      category: Un
+00008f90: 696f 6e5b 7374 722c 206d 6c72 756e 2e63  ion[str, mlrun.c
+00008fa0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4172  ommon.schemas.Ar
+00008fb0: 7469 6661 6374 4361 7465 676f 7269 6573  tifactCategories
+00008fc0: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2920  ] = None,.    ) 
+00008fd0: 2d3e 204c 6973 745b 7374 725d 3a0a 2020  -> List[str]:.  
+00008fe0: 2020 2020 2020 2222 2252 6574 7572 6e20        """Return 
+00008ff0: 6120 6c69 7374 206f 6620 616c 6c20 7468  a list of all th
+00009000: 6520 7461 6773 2061 7373 6967 6e65 6420  e tags assigned 
+00009010: 746f 2061 7274 6966 6163 7473 2069 6e20  to artifacts in 
+00009020: 7468 6520 7363 6f70 6520 6f66 2074 6865  the scope of the
+00009030: 2067 6976 656e 2070 726f 6a65 6374 2e22   given project."
+00009040: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
+00009050: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+00009060: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00009070: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+00009080: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00009090: 6622 4661 696c 6564 206c 6973 7469 6e67  f"Failed listing
+000090a0: 2061 7274 6966 6163 7420 7461 6773 2e20   artifact tags. 
+000090b0: 7072 6f6a 6563 743d 7b70 726f 6a65 6374  project={project
+000090c0: 7d22 0a20 2020 2020 2020 2070 6172 616d  }".        param
+000090d0: 7320 3d20 7b22 6361 7465 676f 7279 223a  s = {"category":
+000090e0: 2063 6174 6567 6f72 797d 2069 6620 6361   category} if ca
+000090f0: 7465 676f 7279 2065 6c73 6520 7b7d 0a0a  tegory else {}..
+00009100: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+00009110: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+00009120: 280a 2020 2020 2020 2020 2020 2020 2247  (.            "G
+00009130: 4554 222c 2066 2270 726f 6a65 6374 732f  ET", f"projects/
+00009140: 7b70 726f 6a65 6374 7d2f 6172 7469 6661  {project}/artifa
+00009150: 6374 2d74 6167 7322 2c20 6572 726f 725f  ct-tags", error_
+00009160: 6d65 7373 6167 652c 2070 6172 616d 733d  message, params=
+00009170: 7061 7261 6d73 0a20 2020 2020 2020 2029  params.        )
+00009180: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00009190: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
+000091a0: 2274 6167 7322 5d0a 0a20 2020 2064 6566  "tags"]..    def
+000091b0: 2073 746f 7265 5f66 756e 6374 696f 6e28   store_function(
+000091c0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000091d0: 2020 2020 2020 2066 756e 6374 696f 6e3a         function:
+000091e0: 2074 7970 696e 672e 556e 696f 6e5b 6d6c   typing.Union[ml
+000091f0: 7275 6e2e 7275 6e74 696d 6573 2e42 6173  run.runtimes.Bas
+00009200: 6552 756e 7469 6d65 2c20 6469 6374 5d2c  eRuntime, dict],
+00009210: 0a20 2020 2020 2020 206e 616d 652c 0a20  .        name,. 
+00009220: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
+00009230: 222c 0a20 2020 2020 2020 2074 6167 3d4e  ",.        tag=N
+00009240: 6f6e 652c 0a20 2020 2020 2020 2076 6572  one,.        ver
+00009250: 7369 6f6e 6564 3d46 616c 7365 2c0a 2020  sioned=False,.  
+00009260: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00009270: 5374 6f72 6520 6120 6675 6e63 7469 6f6e  Store a function
+00009280: 206f 626a 6563 742e 2046 756e 6374 696f   object. Functio
+00009290: 6e20 6973 2069 6465 6e74 6966 6965 6420  n is identified 
+000092a0: 6279 2069 7473 206e 616d 6520 616e 6420  by its name and 
+000092b0: 7461 672c 2061 6e64 2063 616e 2062 6520  tag, and can be 
+000092c0: 7665 7273 696f 6e65 642e 2222 220a 2020  versioned.""".  
+000092d0: 2020 2020 2020 6e61 6d65 203d 206d 6c72        name = mlr
+000092e0: 756e 2e75 7469 6c73 2e6e 6f72 6d61 6c69  un.utils.normali
+000092f0: 7a65 5f6e 616d 6528 6e61 6d65 290a 2020  ze_name(name).  
+00009300: 2020 2020 2020 6966 2068 6173 6174 7472        if hasattr
+00009310: 2866 756e 6374 696f 6e2c 2022 746f 5f64  (function, "to_d
+00009320: 6963 7422 293a 0a20 2020 2020 2020 2020  ict"):.         
+00009330: 2020 2066 756e 6374 696f 6e20 3d20 6675     function = fu
+00009340: 6e63 7469 6f6e 2e74 6f5f 6469 6374 2829  nction.to_dict()
+00009350: 0a0a 2020 2020 2020 2020 7061 7261 6d73  ..        params
+00009360: 203d 207b 2274 6167 223a 2074 6167 2c20   = {"tag": tag, 
+00009370: 2276 6572 7369 6f6e 6564 223a 2076 6572  "versioned": ver
+00009380: 7369 6f6e 6564 7d0a 2020 2020 2020 2020  sioned}.        
+00009390: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+000093a0: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+000093b0: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+000093c0: 2020 2020 7061 7468 203d 2066 2270 726f      path = f"pro
+000093d0: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+000093e0: 6675 6e63 7469 6f6e 732f 7b6e 616d 657d  functions/{name}
+000093f0: 220a 0a20 2020 2020 2020 2065 7272 6f72  "..        error
+00009400: 203d 2066 2273 746f 7265 2066 756e 6374   = f"store funct
+00009410: 696f 6e20 7b70 726f 6a65 6374 7d2f 7b6e  ion {project}/{n
+00009420: 616d 657d 220a 2020 2020 2020 2020 7265  ame}".        re
+00009430: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
+00009440: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+00009450: 2250 4f53 5422 2c20 7061 7468 2c20 6572  "POST", path, er
+00009460: 726f 722c 2070 6172 616d 733d 7061 7261  ror, params=para
+00009470: 6d73 2c20 626f 6479 3d64 6963 745f 746f  ms, body=dict_to
+00009480: 5f6a 736f 6e28 6675 6e63 7469 6f6e 290a  _json(function).
+00009490: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+000094a0: 2020 2023 2068 6173 6820 6b65 7920 6f70     # hash key op
+000094b0: 7469 6f6e 616c 2074 6f20 6265 2062 6163  tional to be bac
+000094c0: 6b77 6172 6473 2063 6f6d 7061 7469 626c  kwards compatibl
+000094d0: 6520 746f 2041 5049 2076 3c30 2e34 2e31  e to API v<0.4.1
+000094e0: 3020 696e 2077 6869 6368 2069 7420 7761  0 in which it wa
+000094f0: 736e 2774 2069 6e20 7468 6520 7265 7370  sn't in the resp
+00009500: 6f6e 7365 0a20 2020 2020 2020 2072 6574  onse.        ret
+00009510: 7572 6e20 7265 7370 2e6a 736f 6e28 292e  urn resp.json().
+00009520: 6765 7428 2268 6173 685f 6b65 7922 290a  get("hash_key").
+00009530: 0a20 2020 2064 6566 2067 6574 5f66 756e  .    def get_fun
+00009540: 6374 696f 6e28 7365 6c66 2c20 6e61 6d65  ction(self, name
+00009550: 2c20 7072 6f6a 6563 743d 2222 2c20 7461  , project="", ta
+00009560: 673d 4e6f 6e65 2c20 6861 7368 5f6b 6579  g=None, hash_key
+00009570: 3d22 2229 3a0a 2020 2020 2020 2020 2222  =""):.        ""
+00009580: 2252 6574 7269 6576 6520 6465 7461 696c  "Retrieve detail
+00009590: 7320 6f66 2061 2073 7065 6369 6669 6320  s of a specific 
+000095a0: 6675 6e63 7469 6f6e 2c20 6964 656e 7469  function, identi
+000095b0: 6669 6564 2062 7920 6974 7320 6e61 6d65  fied by its name
+000095c0: 2061 6e64 2070 6f74 656e 7469 616c 6c79   and potentially
+000095d0: 2061 2074 6167 206f 7220 6675 6e63 7469   a tag or functi
+000095e0: 6f6e 2068 6173 682e 2222 220a 0a20 2020  on hash."""..   
+000095f0: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
+00009600: 7461 6722 3a20 7461 672c 2022 6861 7368  tag": tag, "hash
+00009610: 5f6b 6579 223a 2068 6173 685f 6b65 797d  _key": hash_key}
+00009620: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00009630: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+00009640: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00009650: 6a65 6374 0a20 2020 2020 2020 2070 6174  ject.        pat
+00009660: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00009670: 7072 6f6a 6563 747d 2f66 756e 6374 696f  project}/functio
+00009680: 6e73 2f7b 6e61 6d65 7d22 0a20 2020 2020  ns/{name}".     
+00009690: 2020 2065 7272 6f72 203d 2066 2267 6574     error = f"get
+000096a0: 2066 756e 6374 696f 6e20 7b70 726f 6a65   function {proje
+000096b0: 6374 7d2f 7b6e 616d 657d 220a 2020 2020  ct}/{name}".    
+000096c0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+000096d0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+000096e0: 7061 7468 2c20 6572 726f 722c 2070 6172  path, error, par
+000096f0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+00009700: 2020 2020 7265 7475 726e 2072 6573 702e      return resp.
+00009710: 6a73 6f6e 2829 5b22 6675 6e63 225d 0a0a  json()["func"]..
+00009720: 2020 2020 6465 6620 6465 6c65 7465 5f66      def delete_f
+00009730: 756e 6374 696f 6e28 7365 6c66 2c20 6e61  unction(self, na
+00009740: 6d65 3a20 7374 722c 2070 726f 6a65 6374  me: str, project
+00009750: 3a20 7374 7220 3d20 2222 293a 0a20 2020  : str = ""):.   
+00009760: 2020 2020 2022 2222 4465 6c65 7465 2061       """Delete a
+00009770: 2066 756e 6374 696f 6e20 6265 6c6f 6e67   function belong
+00009780: 696e 6720 746f 2061 2073 7065 6369 6669  ing to a specifi
+00009790: 6320 7072 6f6a 6563 742e 2222 220a 0a20  c project.""".. 
+000097a0: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+000097b0: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+000097c0: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+000097d0: 6374 0a20 2020 2020 2020 2070 6174 6820  ct.        path 
+000097e0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+000097f0: 6f6a 6563 747d 2f66 756e 6374 696f 6e73  oject}/functions
+00009800: 2f7b 6e61 6d65 7d22 0a20 2020 2020 2020  /{name}".       
+00009810: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00009820: 2066 2246 6169 6c65 6420 6465 6c65 7469   f"Failed deleti
+00009830: 6e67 2066 756e 6374 696f 6e20 7b70 726f  ng function {pro
+00009840: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
+00009850: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+00009860: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
+00009870: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
+00009880: 6529 0a0a 2020 2020 6465 6620 6c69 7374  e)..    def list
+00009890: 5f66 756e 6374 696f 6e73 2873 656c 662c  _functions(self,
+000098a0: 206e 616d 653d 4e6f 6e65 2c20 7072 6f6a   name=None, proj
+000098b0: 6563 743d 4e6f 6e65 2c20 7461 673d 4e6f  ect=None, tag=No
+000098c0: 6e65 2c20 6c61 6265 6c73 3d4e 6f6e 6529  ne, labels=None)
+000098d0: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+000098e0: 7269 6576 6520 6120 6c69 7374 206f 6620  rieve a list of 
+000098f0: 6675 6e63 7469 6f6e 732c 2066 696c 7465  functions, filte
+00009900: 7265 6420 6279 2073 7065 6369 6669 6320  red by specific 
+00009910: 6372 6974 6572 6961 2e0a 0a20 2020 2020  criteria...     
+00009920: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+00009930: 5265 7475 726e 206f 6e6c 7920 6675 6e63  Return only func
+00009940: 7469 6f6e 7320 7769 7468 2061 2073 7065  tions with a spe
+00009950: 6369 6669 6320 6e61 6d65 2e0a 2020 2020  cific name..    
+00009960: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+00009970: 6374 3a20 5265 7475 726e 2066 756e 6374  ct: Return funct
+00009980: 696f 6e73 2062 656c 6f6e 6769 6e67 2074  ions belonging t
+00009990: 6f20 7468 6973 2070 726f 6a65 6374 2e20  o this project. 
+000099a0: 4966 206e 6f74 2073 7065 6369 6669 6564  If not specified
+000099b0: 2c20 7468 6520 6465 6661 756c 7420 7072  , the default pr
+000099c0: 6f6a 6563 7420 6973 2075 7365 642e 0a20  oject is used.. 
+000099d0: 2020 2020 2020 203a 7061 7261 6d20 7461         :param ta
+000099e0: 673a 2052 6574 7572 6e20 6675 6e63 7469  g: Return functi
+000099f0: 6f6e 2076 6572 7369 6f6e 7320 7769 7468  on versions with
+00009a00: 2073 7065 6369 6669 6320 7461 6773 2e0a   specific tags..
+00009a10: 2020 2020 2020 2020 3a70 6172 616d 206c          :param l
+00009a20: 6162 656c 733a 2052 6574 7572 6e20 6675  abels: Return fu
+00009a30: 6e63 7469 6f6e 7320 7468 6174 2068 6176  nctions that hav
+00009a40: 6520 7370 6563 6966 6963 206c 6162 656c  e specific label
+00009a50: 7320 6173 7369 676e 6564 2074 6f20 7468  s assigned to th
+00009a60: 656d 2e0a 2020 2020 2020 2020 3a72 6574  em..        :ret
+00009a70: 7572 6e73 3a20 4c69 7374 206f 6620 6675  urns: List of fu
+00009a80: 6e63 7469 6f6e 206f 626a 6563 7473 2028  nction objects (
+00009a90: 6173 2064 6963 7469 6f6e 6172 7929 2e0a  as dictionary)..
+00009aa0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+00009ab0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
+00009ac0: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
+00009ad0: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
+00009ae0: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
+00009af0: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
+00009b00: 6e61 6d65 223a 206e 616d 652c 0a20 2020  name": name,.   
+00009b10: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
+00009b20: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
+00009b30: 2022 6c61 6265 6c22 3a20 6c61 6265 6c73   "label": labels
+00009b40: 206f 7220 5b5d 2c0a 2020 2020 2020 2020   or [],.        
+00009b50: 7d0a 2020 2020 2020 2020 6572 726f 7220  }.        error 
+00009b60: 3d20 226c 6973 7420 6675 6e63 7469 6f6e  = "list function
+00009b70: 7322 0a20 2020 2020 2020 2070 6174 6820  s".        path 
+00009b80: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+00009b90: 6f6a 6563 747d 2f66 756e 6374 696f 6e73  oject}/functions
+00009ba0: 220a 2020 2020 2020 2020 7265 7370 203d  ".        resp =
+00009bb0: 2073 656c 662e 6170 695f 6361 6c6c 2822   self.api_call("
+00009bc0: 4745 5422 2c20 7061 7468 2c20 6572 726f  GET", path, erro
+00009bd0: 722c 2070 6172 616d 733d 7061 7261 6d73  r, params=params
+00009be0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00009bf0: 2072 6573 702e 6a73 6f6e 2829 5b22 6675   resp.json()["fu
+00009c00: 6e63 7322 5d0a 0a20 2020 2064 6566 206c  ncs"]..    def l
+00009c10: 6973 745f 7275 6e74 696d 655f 7265 736f  ist_runtime_reso
+00009c20: 7572 6365 7328 0a20 2020 2020 2020 2073  urces(.        s
+00009c30: 656c 662c 0a20 2020 2020 2020 2070 726f  elf,.        pro
+00009c40: 6a65 6374 3a20 4f70 7469 6f6e 616c 5b73  ject: Optional[s
+00009c50: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00009c60: 2020 2020 6c61 6265 6c5f 7365 6c65 6374      label_select
+00009c70: 6f72 3a20 4f70 7469 6f6e 616c 5b73 7472  or: Optional[str
+00009c80: 5d20 3d20 4e6f 6e65 2c0a 2020 2020 2020  ] = None,.      
+00009c90: 2020 6b69 6e64 3a20 4f70 7469 6f6e 616c    kind: Optional
+00009ca0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00009cb0: 2020 2020 2020 6f62 6a65 6374 5f69 643a        object_id:
+00009cc0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+00009cd0: 204e 6f6e 652c 0a20 2020 2020 2020 2067   None,.        g
+00009ce0: 726f 7570 5f62 793a 204f 7074 696f 6e61  roup_by: Optiona
+00009cf0: 6c5b 0a20 2020 2020 2020 2020 2020 206d  l[.            m
+00009d00: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00009d10: 6d61 732e 4c69 7374 5275 6e74 696d 6552  mas.ListRuntimeR
+00009d20: 6573 6f75 7263 6573 4772 6f75 7042 7946  esourcesGroupByF
+00009d30: 6965 6c64 0a20 2020 2020 2020 205d 203d  ield.        ] =
+00009d40: 204e 6f6e 652c 0a20 2020 2029 202d 3e20   None,.    ) -> 
+00009d50: 556e 696f 6e5b 0a20 2020 2020 2020 206d  Union[.        m
+00009d60: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00009d70: 6d61 732e 5275 6e74 696d 6552 6573 6f75  mas.RuntimeResou
+00009d80: 7263 6573 4f75 7470 7574 2c0a 2020 2020  rcesOutput,.    
+00009d90: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
+00009da0: 2e73 6368 656d 6173 2e47 726f 7570 6564  .schemas.Grouped
+00009db0: 4279 4a6f 6252 756e 7469 6d65 5265 736f  ByJobRuntimeReso
+00009dc0: 7572 6365 734f 7574 7075 742c 0a20 2020  urcesOutput,.   
+00009dd0: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+00009de0: 6e2e 7363 6865 6d61 732e 4772 6f75 7065  n.schemas.Groupe
+00009df0: 6442 7950 726f 6a65 6374 5275 6e74 696d  dByProjectRuntim
+00009e00: 6552 6573 6f75 7263 6573 4f75 7470 7574  eResourcesOutput
+00009e10: 2c0a 2020 2020 5d3a 0a20 2020 2020 2020  ,.    ]:.       
+00009e20: 2022 2222 4c69 7374 2063 7572 7265 6e74   """List current
+00009e30: 2072 756e 7469 6d65 2072 6573 6f75 7263   runtime resourc
+00009e40: 6573 2c20 7768 6963 6820 6172 6520 7573  es, which are us
+00009e50: 7561 6c6c 7920 2862 7574 206e 6f74 206c  ually (but not l
+00009e60: 696d 6974 6564 2074 6f29 204b 7562 6572  imited to) Kuber
+00009e70: 6e65 7465 7320 706f 6473 206f 7220 4352  netes pods or CR
+00009e80: 4473 2e0a 2020 2020 2020 2020 4675 6e63  Ds..        Func
+00009e90: 7469 6f6e 2061 7070 6c69 6573 2066 6f72  tion applies for
+00009ea0: 2072 756e 7320 6f66 2074 7970 6520 605b   runs of type `[
+00009eb0: 2764 6173 6b27 2c20 276a 6f62 272c 2027  'dask', 'job', '
+00009ec0: 7370 6172 6b27 2c20 2772 656d 6f74 652d  spark', 'remote-
+00009ed0: 7370 6172 6b27 2c20 276d 7069 6a6f 6227  spark', 'mpijob'
+00009ee0: 5d60 2c20 616e 6420 7769 6c6c 2072 6574  ]`, and will ret
+00009ef0: 7572 6e20 7065 720a 2020 2020 2020 2020  urn per.        
+00009f00: 7275 6e74 696d 6520 6b69 6e64 2061 206c  runtime kind a l
+00009f10: 6973 7420 6f66 2074 6865 2072 756e 7469  ist of the runti
+00009f20: 6d65 2072 6573 6f75 7263 6573 2028 7768  me resources (wh
+00009f30: 6963 6820 6d61 7920 6861 7665 2061 6c72  ich may have alr
+00009f40: 6561 6479 2063 6f6d 706c 6574 6564 2074  eady completed t
+00009f50: 6865 6972 2065 7865 6375 7469 6f6e 292e  heir execution).
+00009f60: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00009f70: 2070 726f 6a65 6374 3a20 4765 7420 6f6e   project: Get on
+00009f80: 6c79 2072 756e 7469 6d65 2072 6573 6f75  ly runtime resou
+00009f90: 7263 6573 206f 6620 6120 7370 6563 6966  rces of a specif
+00009fa0: 6963 2070 726f 6a65 6374 2c20 6279 2064  ic project, by d
+00009fb0: 6566 6175 6c74 204e 6f6e 652c 2077 6869  efault None, whi
+00009fc0: 6368 2077 696c 6c20 7265 7475 726e 206f  ch will return o
+00009fd0: 6e6c 7920 7468 650a 2020 2020 2020 2020  nly the.        
+00009fe0: 2020 2020 7072 6f6a 6563 7473 2079 6f75      projects you
+00009ff0: 2772 6520 6175 7468 6f72 697a 6564 2074  're authorized t
+0000a000: 6f20 7365 652e 0a20 2020 2020 2020 203a  o see..        :
+0000a010: 7061 7261 6d20 6c61 6265 6c5f 7365 6c65  param label_sele
+0000a020: 6374 6f72 3a20 4120 6c61 6265 6c20 6669  ctor: A label fi
+0000a030: 6c74 6572 2074 6861 7420 7769 6c6c 2062  lter that will b
+0000a040: 6520 7061 7373 6564 2074 6f20 4b75 6265  e passed to Kube
+0000a050: 726e 6574 6573 2066 6f72 2066 696c 7465  rnetes for filte
+0000a060: 7269 6e67 2074 6865 2072 6573 756c 7473  ring the results
+0000a070: 2061 6363 6f72 6469 6e67 0a20 2020 2020   according.     
+0000a080: 2020 2020 2020 2074 6f20 7468 6569 7220         to their 
+0000a090: 6c61 6265 6c73 2e0a 2020 2020 2020 2020  labels..        
+0000a0a0: 3a70 6172 616d 206b 696e 643a 2054 6865  :param kind: The
+0000a0b0: 206b 696e 6420 6f66 2072 756e 7469 6d65   kind of runtime
+0000a0c0: 2074 6f20 7175 6572 792e 204d 6179 2062   to query. May b
+0000a0d0: 6520 6f6e 6520 6f66 2060 5b27 6461 736b  e one of `['dask
+0000a0e0: 272c 2027 6a6f 6227 2c20 2773 7061 726b  ', 'job', 'spark
+0000a0f0: 272c 2027 7265 6d6f 7465 2d73 7061 726b  ', 'remote-spark
+0000a100: 272c 2027 6d70 696a 6f62 275d 600a 2020  ', 'mpijob']`.  
+0000a110: 2020 2020 2020 3a70 6172 616d 206f 626a        :param obj
+0000a120: 6563 745f 6964 3a20 5468 6520 6964 656e  ect_id: The iden
+0000a130: 7469 6669 6572 206f 6620 7468 6520 6d6c  tifier of the ml
+0000a140: 7275 6e20 6f62 6a65 6374 2074 6f20 7175  run object to qu
+0000a150: 6572 7920 6974 7320 7275 6e74 696d 6520  ery its runtime 
+0000a160: 7265 736f 7572 6365 732e 2066 6f72 206d  resources. for m
+0000a170: 6f73 7420 6675 6e63 7469 6f6e 2072 756e  ost function run
+0000a180: 7469 6d65 732c 0a20 2020 2020 2020 2020  times,.         
+0000a190: 2020 2072 756e 7469 6d65 2072 6573 6f75     runtime resou
+0000a1a0: 7263 6573 2061 7265 2070 6572 2052 756e  rces are per Run
+0000a1b0: 2c20 666f 7220 7768 6963 6820 7468 6520  , for which the 
+0000a1c0: 6964 656e 7469 6669 6572 2069 7320 7468  identifier is th
+0000a1d0: 6520 5275 6e27 7320 5549 442e 2046 6f72  e Run's UID. For
+0000a1e0: 2064 6173 6b20 7275 6e74 696d 652c 2074   dask runtime, t
+0000a1f0: 6865 2072 756e 7469 6d65 0a20 2020 2020  he runtime.     
+0000a200: 2020 2020 2020 2072 6573 6f75 7263 6573         resources
+0000a210: 2061 7265 2070 6572 2046 756e 6374 696f   are per Functio
+0000a220: 6e2c 2066 6f72 2077 6869 6368 2074 6865  n, for which the
+0000a230: 2069 6465 6e74 6966 6965 7220 6973 2074   identifier is t
+0000a240: 6865 2046 756e 6374 696f 6e27 7320 6e61  he Function's na
+0000a250: 6d65 2e0a 2020 2020 2020 2020 3a70 6172  me..        :par
+0000a260: 616d 2067 726f 7570 5f62 793a 204f 626a  am group_by: Obj
+0000a270: 6563 7420 746f 2067 726f 7570 2072 6573  ect to group res
+0000a280: 756c 7473 2062 792e 2041 6c6c 6f77 6564  ults by. Allowed
+0000a290: 2076 616c 7565 7320 6172 6520 606a 6f62   values are `job
+0000a2a0: 6020 616e 6420 6070 726f 6a65 6374 602e  ` and `project`.
+0000a2b0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+0000a2c0: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+0000a2d0: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+0000a2e0: 656c 5f73 656c 6563 746f 7222 3a20 6c61  el_selector": la
+0000a2f0: 6265 6c5f 7365 6c65 6374 6f72 2c0a 2020  bel_selector,.  
+0000a300: 2020 2020 2020 2020 2020 2267 726f 7570            "group
+0000a310: 2d62 7922 3a20 6772 6f75 705f 6279 2c0a  -by": group_by,.
+0000a320: 2020 2020 2020 2020 2020 2020 226b 696e              "kin
+0000a330: 6422 3a20 6b69 6e64 2c0a 2020 2020 2020  d": kind,.      
+0000a340: 2020 2020 2020 226f 626a 6563 742d 6964        "object-id
+0000a350: 223a 206f 626a 6563 745f 6964 2c0a 2020  ": object_id,.  
+0000a360: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+0000a370: 7072 6f6a 6563 745f 7061 7468 203d 2070  project_path = p
+0000a380: 726f 6a65 6374 2069 6620 7072 6f6a 6563  roject if projec
+0000a390: 7420 656c 7365 2022 2a22 0a20 2020 2020  t else "*".     
+0000a3a0: 2020 2065 7272 6f72 203d 2022 4661 696c     error = "Fail
+0000a3b0: 6564 206c 6973 7469 6e67 2072 756e 7469  ed listing runti
+0000a3c0: 6d65 2072 6573 6f75 7263 6573 220a 2020  me resources".  
+0000a3d0: 2020 2020 2020 7265 7370 6f6e 7365 203d        response =
+0000a3e0: 2073 656c 662e 6170 695f 6361 6c6c 280a   self.api_call(.
+0000a3f0: 2020 2020 2020 2020 2020 2020 2247 4554              "GET
+0000a400: 222c 2066 2270 726f 6a65 6374 732f 7b70  ", f"projects/{p
+0000a410: 726f 6a65 6374 5f70 6174 687d 2f72 756e  roject_path}/run
+0000a420: 7469 6d65 2d72 6573 6f75 7263 6573 222c  time-resources",
+0000a430: 2065 7272 6f72 2c20 7061 7261 6d73 3d70   error, params=p
+0000a440: 6172 616d 730a 2020 2020 2020 2020 290a  arams.        ).
+0000a450: 2020 2020 2020 2020 6966 2067 726f 7570          if group
+0000a460: 5f62 7920 6973 204e 6f6e 653a 0a20 2020  _by is None:.   
+0000a470: 2020 2020 2020 2020 2073 7472 7563 7475           structu
+0000a480: 7265 645f 6c69 7374 203d 205b 0a20 2020  red_list = [.   
+0000a490: 2020 2020 2020 2020 2020 2020 206d 6c72               mlr
+0000a4a0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0000a4b0: 732e 4b69 6e64 5275 6e74 696d 6552 6573  s.KindRuntimeRes
+0000a4c0: 6f75 7263 6573 282a 2a6b 696e 645f 7275  ources(**kind_ru
+0000a4d0: 6e74 696d 655f 7265 736f 7572 6365 7329  ntime_resources)
+0000a4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000a4f0: 2066 6f72 206b 696e 645f 7275 6e74 696d   for kind_runtim
+0000a500: 655f 7265 736f 7572 6365 7320 696e 2072  e_resources in r
+0000a510: 6573 706f 6e73 652e 6a73 6f6e 2829 0a20  esponse.json(). 
+0000a520: 2020 2020 2020 2020 2020 205d 0a20 2020             ].   
+0000a530: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000a540: 7374 7275 6374 7572 6564 5f6c 6973 740a  structured_list.
+0000a550: 2020 2020 2020 2020 656c 6966 2067 726f          elif gro
+0000a560: 7570 5f62 7920 3d3d 206d 6c72 756e 2e63  up_by == mlrun.c
+0000a570: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4c69  ommon.schemas.Li
+0000a580: 7374 5275 6e74 696d 6552 6573 6f75 7263  stRuntimeResourc
+0000a590: 6573 4772 6f75 7042 7946 6965 6c64 2e6a  esGroupByField.j
+0000a5a0: 6f62 3a0a 2020 2020 2020 2020 2020 2020  ob:.            
+0000a5b0: 7374 7275 6374 7572 6564 5f64 6963 7420  structured_dict 
+0000a5c0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
+0000a5d0: 2066 6f72 2070 726f 6a65 6374 2c20 6a6f   for project, jo
+0000a5e0: 625f 7275 6e74 696d 655f 7265 736f 7572  b_runtime_resour
+0000a5f0: 6365 735f 6d61 7020 696e 2072 6573 706f  ces_map in respo
+0000a600: 6e73 652e 6a73 6f6e 2829 2e69 7465 6d73  nse.json().items
+0000a610: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000a620: 2020 2020 666f 7220 6a6f 625f 6964 2c20      for job_id, 
+0000a630: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000a640: 7320 696e 206a 6f62 5f72 756e 7469 6d65  s in job_runtime
+0000a650: 5f72 6573 6f75 7263 6573 5f6d 6170 2e69  _resources_map.i
+0000a660: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0000a670: 2020 2020 2020 2020 2020 2020 7374 7275              stru
+0000a680: 6374 7572 6564 5f64 6963 742e 7365 7464  ctured_dict.setd
+0000a690: 6566 6175 6c74 2870 726f 6a65 6374 2c20  efault(project, 
+0000a6a0: 7b7d 295b 0a20 2020 2020 2020 2020 2020  {})[.           
+0000a6b0: 2020 2020 2020 2020 2020 2020 206a 6f62               job
+0000a6c0: 5f69 640a 2020 2020 2020 2020 2020 2020  _id.            
+0000a6d0: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
+0000a6e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0000a6f0: 2e52 756e 7469 6d65 5265 736f 7572 6365  .RuntimeResource
+0000a700: 7328 2a2a 7275 6e74 696d 655f 7265 736f  s(**runtime_reso
+0000a710: 7572 6365 7329 0a20 2020 2020 2020 2020  urces).         
+0000a720: 2020 2072 6574 7572 6e20 7374 7275 6374     return struct
+0000a730: 7572 6564 5f64 6963 740a 2020 2020 2020  ured_dict.      
+0000a740: 2020 656c 6966 2067 726f 7570 5f62 7920    elif group_by 
+0000a750: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
+0000a760: 7363 6865 6d61 732e 4c69 7374 5275 6e74  schemas.ListRunt
+0000a770: 696d 6552 6573 6f75 7263 6573 4772 6f75  imeResourcesGrou
+0000a780: 7042 7946 6965 6c64 2e70 726f 6a65 6374  pByField.project
+0000a790: 3a0a 2020 2020 2020 2020 2020 2020 7374  :.            st
+0000a7a0: 7275 6374 7572 6564 5f64 6963 7420 3d20  ructured_dict = 
+0000a7b0: 7b7d 0a20 2020 2020 2020 2020 2020 2066  {}.            f
+0000a7c0: 6f72 2070 726f 6a65 6374 2c20 6b69 6e64  or project, kind
+0000a7d0: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
+0000a7e0: 6573 5f6d 6170 2069 6e20 7265 7370 6f6e  es_map in respon
+0000a7f0: 7365 2e6a 736f 6e28 292e 6974 656d 7328  se.json().items(
+0000a800: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000a810: 2020 2066 6f72 206b 696e 642c 2072 756e     for kind, run
+0000a820: 7469 6d65 5f72 6573 6f75 7263 6573 2069  time_resources i
+0000a830: 6e20 6b69 6e64 5f72 756e 7469 6d65 5f72  n kind_runtime_r
+0000a840: 6573 6f75 7263 6573 5f6d 6170 2e69 7465  esources_map.ite
+0000a850: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+0000a860: 2020 2020 2020 2020 2020 7374 7275 6374            struct
+0000a870: 7572 6564 5f64 6963 742e 7365 7464 6566  ured_dict.setdef
+0000a880: 6175 6c74 2870 726f 6a65 6374 2c20 7b7d  ault(project, {}
+0000a890: 295b 0a20 2020 2020 2020 2020 2020 2020  )[.             
+0000a8a0: 2020 2020 2020 2020 2020 206b 696e 640a             kind.
+0000a8b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a8c0: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
+0000a8d0: 6d6d 6f6e 2e73 6368 656d 6173 2e52 756e  mmon.schemas.Run
+0000a8e0: 7469 6d65 5265 736f 7572 6365 7328 2a2a  timeResources(**
+0000a8f0: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000a900: 7329 0a20 2020 2020 2020 2020 2020 2072  s).            r
+0000a910: 6574 7572 6e20 7374 7275 6374 7572 6564  eturn structured
+0000a920: 5f64 6963 740a 2020 2020 2020 2020 656c  _dict.        el
+0000a930: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+0000a940: 7261 6973 6520 4e6f 7449 6d70 6c65 6d65  raise NotImpleme
+0000a950: 6e74 6564 4572 726f 7228 0a20 2020 2020  ntedError(.     
+0000a960: 2020 2020 2020 2020 2020 2066 2250 726f             f"Pro
+0000a970: 7669 6465 6420 6772 6f75 7020 6279 2066  vided group by f
+0000a980: 6965 6c64 2069 7320 6e6f 7420 7375 7070  ield is not supp
+0000a990: 6f72 7465 642e 2067 726f 7570 5f62 793d  orted. group_by=
+0000a9a0: 7b67 726f 7570 5f62 797d 220a 2020 2020  {group_by}".    
+0000a9b0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
+0000a9c0: 6566 2064 656c 6574 655f 7275 6e74 696d  ef delete_runtim
+0000a9d0: 655f 7265 736f 7572 6365 7328 0a20 2020  e_resources(.   
+0000a9e0: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000a9f0: 2020 2070 726f 6a65 6374 3a20 4f70 7469     project: Opti
+0000aa00: 6f6e 616c 5b73 7472 5d20 3d20 4e6f 6e65  onal[str] = None
+0000aa10: 2c0a 2020 2020 2020 2020 6c61 6265 6c5f  ,.        label_
+0000aa20: 7365 6c65 6374 6f72 3a20 4f70 7469 6f6e  selector: Option
+0000aa30: 616c 5b73 7472 5d20 3d20 4e6f 6e65 2c0a  al[str] = None,.
+0000aa40: 2020 2020 2020 2020 6b69 6e64 3a20 4f70          kind: Op
+0000aa50: 7469 6f6e 616c 5b73 7472 5d20 3d20 4e6f  tional[str] = No
+0000aa60: 6e65 2c0a 2020 2020 2020 2020 6f62 6a65  ne,.        obje
+0000aa70: 6374 5f69 643a 204f 7074 696f 6e61 6c5b  ct_id: Optional[
+0000aa80: 7374 725d 203d 204e 6f6e 652c 0a20 2020  str] = None,.   
+0000aa90: 2020 2020 2066 6f72 6365 3a20 626f 6f6c       force: bool
+0000aaa0: 203d 2046 616c 7365 2c0a 2020 2020 2020   = False,.      
+0000aab0: 2020 6772 6163 655f 7065 7269 6f64 3a20    grace_period: 
+0000aac0: 696e 7420 3d20 4e6f 6e65 2c0a 2020 2020  int = None,.    
+0000aad0: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
+0000aae0: 6e2e 7363 6865 6d61 732e 4772 6f75 7065  n.schemas.Groupe
+0000aaf0: 6442 7950 726f 6a65 6374 5275 6e74 696d  dByProjectRuntim
+0000ab00: 6552 6573 6f75 7263 6573 4f75 7470 7574  eResourcesOutput
+0000ab10: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
+0000ab20: 6574 6520 616c 6c20 7275 6e74 696d 6520  ete all runtime 
+0000ab30: 7265 736f 7572 6365 7320 7768 6963 6820  resources which 
+0000ab40: 6172 6520 696e 2074 6572 6d69 6e61 6c20  are in terminal 
+0000ab50: 7374 6174 652e 0a0a 2020 2020 2020 2020  state...        
+0000ab60: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+0000ab70: 4465 6c65 7465 206f 6e6c 7920 7275 6e74  Delete only runt
+0000ab80: 696d 6520 7265 736f 7572 6365 7320 6f66  ime resources of
+0000ab90: 2061 2073 7065 6369 6669 6320 7072 6f6a   a specific proj
+0000aba0: 6563 742c 2062 7920 6465 6661 756c 7420  ect, by default 
+0000abb0: 4e6f 6e65 2c20 7768 6963 6820 7769 6c6c  None, which will
+0000abc0: 2064 656c 6574 6520 6f6e 6c79 0a20 2020   delete only.   
+0000abd0: 2020 2020 2020 2020 2066 726f 6d20 7468           from th
+0000abe0: 6520 7072 6f6a 6563 7473 2079 6f75 2772  e projects you'r
+0000abf0: 6520 6175 7468 6f72 697a 6564 2074 6f20  e authorized to 
+0000ac00: 6465 6c65 7465 2066 726f 6d2e 0a20 2020  delete from..   
+0000ac10: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
+0000ac20: 6c5f 7365 6c65 6374 6f72 3a20 4465 6c65  l_selector: Dele
+0000ac30: 7465 206f 6e6c 7920 7275 6e74 696d 6520  te only runtime 
+0000ac40: 7265 736f 7572 6365 7320 6d61 7463 6869  resources matchi
+0000ac50: 6e67 2074 6865 206c 6162 656c 2073 656c  ng the label sel
+0000ac60: 6563 746f 722e 0a20 2020 2020 2020 203a  ector..        :
+0000ac70: 7061 7261 6d20 6b69 6e64 3a20 5468 6520  param kind: The 
+0000ac80: 6b69 6e64 206f 6620 7275 6e74 696d 6520  kind of runtime 
+0000ac90: 746f 2064 656c 6574 652e 204d 6179 2062  to delete. May b
+0000aca0: 6520 6f6e 6520 6f66 2060 5b27 6461 736b  e one of `['dask
+0000acb0: 272c 2027 6a6f 6227 2c20 2773 7061 726b  ', 'job', 'spark
+0000acc0: 272c 2027 7265 6d6f 7465 2d73 7061 726b  ', 'remote-spark
+0000acd0: 272c 2027 6d70 696a 6f62 275d 600a 2020  ', 'mpijob']`.  
+0000ace0: 2020 2020 2020 3a70 6172 616d 206f 626a        :param obj
+0000acf0: 6563 745f 6964 3a20 5468 6520 6964 656e  ect_id: The iden
+0000ad00: 7469 6669 6572 206f 6620 7468 6520 6d6c  tifier of the ml
+0000ad10: 7275 6e20 6f62 6a65 6374 2074 6f20 6465  run object to de
+0000ad20: 6c65 7465 2069 7473 2072 756e 7469 6d65  lete its runtime
+0000ad30: 2072 6573 6f75 7263 6573 2e20 666f 7220   resources. for 
+0000ad40: 6d6f 7374 2066 756e 6374 696f 6e0a 2020  most function.  
+0000ad50: 2020 2020 2020 2020 2020 7275 6e74 696d            runtim
+0000ad60: 6573 2c20 7275 6e74 696d 6520 7265 736f  es, runtime reso
+0000ad70: 7572 6365 7320 6172 6520 7065 7220 5275  urces are per Ru
+0000ad80: 6e2c 2066 6f72 2077 6869 6368 2074 6865  n, for which the
+0000ad90: 2069 6465 6e74 6966 6965 7220 6973 2074   identifier is t
+0000ada0: 6865 2052 756e 2773 2055 4944 2e20 466f  he Run's UID. Fo
+0000adb0: 7220 6461 736b 2072 756e 7469 6d65 2c20  r dask runtime, 
+0000adc0: 7468 650a 2020 2020 2020 2020 2020 2020  the.            
+0000add0: 7275 6e74 696d 6520 7265 736f 7572 6365  runtime resource
+0000ade0: 7320 6172 6520 7065 7220 4675 6e63 7469  s are per Functi
+0000adf0: 6f6e 2c20 666f 7220 7768 6963 6820 7468  on, for which th
+0000ae00: 6520 6964 656e 7469 6669 6572 2069 7320  e identifier is 
+0000ae10: 7468 6520 4675 6e63 7469 6f6e 2773 206e  the Function's n
+0000ae20: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
+0000ae30: 7261 6d20 666f 7263 653a 2046 6f72 6365  ram force: Force
+0000ae40: 2064 656c 6574 696f 6e20 2d20 6465 6c65   deletion - dele
+0000ae50: 7465 2074 6865 2072 756e 7469 6d65 2072  te the runtime r
+0000ae60: 6573 6f75 7263 6520 6576 656e 2069 6620  esource even if 
+0000ae70: 6974 2773 206e 6f74 2069 6e20 7465 726d  it's not in term
+0000ae80: 696e 616c 2073 7461 7465 206f 7220 6966  inal state or if
+0000ae90: 2074 6865 2067 7261 6365 0a20 2020 2020   the grace.     
+0000aea0: 2020 2020 2020 2070 6572 696f 6420 6469         period di
+0000aeb0: 646e 2774 2070 6173 732e 0a20 2020 2020  dn't pass..     
+0000aec0: 2020 203a 7061 7261 6d20 6772 6163 655f     :param grace_
+0000aed0: 7065 7269 6f64 3a20 4772 6163 6520 7065  period: Grace pe
+0000aee0: 7269 6f64 2067 6976 656e 2074 6f20 7468  riod given to th
+0000aef0: 6520 7275 6e74 696d 6520 7265 736f 7572  e runtime resour
+0000af00: 6365 2062 6566 6f72 6520 7468 6579 2061  ce before they a
+0000af10: 7265 2061 6374 7561 6c6c 7920 7265 6d6f  re actually remo
+0000af20: 7665 642c 2063 6f75 6e74 6564 2066 726f  ved, counted fro
+0000af30: 6d0a 2020 2020 2020 2020 2020 2020 7468  m.            th
+0000af40: 6520 6d6f 6d65 6e74 2074 6865 7920 6d6f  e moment they mo
+0000af50: 7665 6420 746f 2074 6572 6d69 6e61 6c20  ved to terminal 
+0000af60: 7374 6174 6520 2864 6566 6175 6c74 7320  state (defaults 
+0000af70: 746f 206d 6c72 756e 2e6d 6c63 6f6e 662e  to mlrun.mlconf.
+0000af80: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000af90: 735f 6465 6c65 7469 6f6e 5f67 7261 6365  s_deletion_grace
+0000afa0: 5f70 6572 696f 6429 2e0a 0a20 2020 2020  _period)...     
+0000afb0: 2020 203a 7265 7475 726e 733a 203a 7079     :returns: :py
+0000afc0: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e63  :class:`~mlrun.c
+0000afd0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4772  ommon.schemas.Gr
+0000afe0: 6f75 7065 6442 7950 726f 6a65 6374 5275  oupedByProjectRu
+0000aff0: 6e74 696d 6552 6573 6f75 7263 6573 4f75  ntimeResourcesOu
+0000b000: 7470 7574 6020 6c69 7374 696e 6720 7468  tput` listing th
+0000b010: 6520 7275 6e74 696d 6520 7265 736f 7572  e runtime resour
+0000b020: 6365 730a 2020 2020 2020 2020 2020 2020  ces.            
+0000b030: 7468 6174 2077 6572 6520 7265 6d6f 7665  that were remove
+0000b040: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
+0000b050: 2020 2020 2020 2069 6620 6772 6163 655f         if grace_
+0000b060: 7065 7269 6f64 2069 7320 4e6f 6e65 3a0a  period is None:.
+0000b070: 2020 2020 2020 2020 2020 2020 6772 6163              grac
+0000b080: 655f 7065 7269 6f64 203d 2063 6f6e 6669  e_period = confi
+0000b090: 672e 7275 6e74 696d 655f 7265 736f 7572  g.runtime_resour
+0000b0a0: 6365 735f 6465 6c65 7469 6f6e 5f67 7261  ces_deletion_gra
+0000b0b0: 6365 5f70 6572 696f 640a 2020 2020 2020  ce_period.      
+0000b0c0: 2020 2020 2020 6c6f 6767 6572 2e69 6e66        logger.inf
+0000b0d0: 6f28 0a20 2020 2020 2020 2020 2020 2020  o(.             
+0000b0e0: 2020 2022 5573 696e 6720 6465 6661 756c     "Using defaul
+0000b0f0: 7420 6772 6163 6520 7065 7269 6f64 2066  t grace period f
+0000b100: 6f72 2072 756e 7469 6d65 2072 6573 6f75  or runtime resou
+0000b110: 7263 6573 2064 656c 6574 696f 6e22 2c0a  rces deletion",.
+0000b120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b130: 6772 6163 655f 7065 7269 6f64 3d67 7261  grace_period=gra
+0000b140: 6365 5f70 6572 696f 642c 0a20 2020 2020  ce_period,.     
+0000b150: 2020 2020 2020 2029 0a0a 2020 2020 2020         )..      
+0000b160: 2020 7061 7261 6d73 203d 207b 0a20 2020    params = {.   
+0000b170: 2020 2020 2020 2020 2022 6c61 6265 6c2d           "label-
+0000b180: 7365 6c65 6374 6f72 223a 206c 6162 656c  selector": label
+0000b190: 5f73 656c 6563 746f 722c 0a20 2020 2020  _selector,.     
+0000b1a0: 2020 2020 2020 2022 6b69 6e64 223a 206b         "kind": k
+0000b1b0: 696e 642c 0a20 2020 2020 2020 2020 2020  ind,.           
+0000b1c0: 2022 6f62 6a65 6374 2d69 6422 3a20 6f62   "object-id": ob
+0000b1d0: 6a65 6374 5f69 642c 0a20 2020 2020 2020  ject_id,.       
+0000b1e0: 2020 2020 2022 666f 7263 6522 3a20 666f       "force": fo
+0000b1f0: 7263 652c 0a20 2020 2020 2020 2020 2020  rce,.           
+0000b200: 2022 6772 6163 652d 7065 7269 6f64 223a   "grace-period":
+0000b210: 2067 7261 6365 5f70 6572 696f 642c 0a20   grace_period,. 
+0000b220: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+0000b230: 2065 7272 6f72 203d 2022 4661 696c 6564   error = "Failed
+0000b240: 2064 656c 6574 696e 6720 7275 6e74 696d   deleting runtim
+0000b250: 6520 7265 736f 7572 6365 7322 0a20 2020  e resources".   
+0000b260: 2020 2020 2070 726f 6a65 6374 5f70 6174       project_pat
+0000b270: 6820 3d20 7072 6f6a 6563 7420 6966 2070  h = project if p
+0000b280: 726f 6a65 6374 2065 6c73 6520 222a 220a  roject else "*".
+0000b290: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0000b2a0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+0000b2b0: 280a 2020 2020 2020 2020 2020 2020 2244  (.            "D
+0000b2c0: 454c 4554 4522 2c0a 2020 2020 2020 2020  ELETE",.        
+0000b2d0: 2020 2020 6622 7072 6f6a 6563 7473 2f7b      f"projects/{
+0000b2e0: 7072 6f6a 6563 745f 7061 7468 7d2f 7275  project_path}/ru
+0000b2f0: 6e74 696d 652d 7265 736f 7572 6365 7322  ntime-resources"
+0000b300: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
+0000b310: 726f 722c 0a20 2020 2020 2020 2020 2020  ror,.           
+0000b320: 2070 6172 616d 733d 7061 7261 6d73 2c0a   params=params,.
+0000b330: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
+0000b340: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
+0000b350: 7420 3d20 7b7d 0a20 2020 2020 2020 2066  t = {}.        f
+0000b360: 6f72 2070 726f 6a65 6374 2c20 6b69 6e64  or project, kind
+0000b370: 5f72 756e 7469 6d65 5f72 6573 6f75 7263  _runtime_resourc
+0000b380: 6573 5f6d 6170 2069 6e20 7265 7370 6f6e  es_map in respon
+0000b390: 7365 2e6a 736f 6e28 292e 6974 656d 7328  se.json().items(
+0000b3a0: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+0000b3b0: 6f72 206b 696e 642c 2072 756e 7469 6d65  or kind, runtime
+0000b3c0: 5f72 6573 6f75 7263 6573 2069 6e20 6b69  _resources in ki
+0000b3d0: 6e64 5f72 756e 7469 6d65 5f72 6573 6f75  nd_runtime_resou
+0000b3e0: 7263 6573 5f6d 6170 2e69 7465 6d73 2829  rces_map.items()
+0000b3f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b400: 2020 7374 7275 6374 7572 6564 5f64 6963    structured_dic
+0000b410: 742e 7365 7464 6566 6175 6c74 2870 726f  t.setdefault(pro
+0000b420: 6a65 6374 2c20 7b7d 295b 0a20 2020 2020  ject, {})[.     
+0000b430: 2020 2020 2020 2020 2020 2020 2020 206b                 k
+0000b440: 696e 640a 2020 2020 2020 2020 2020 2020  ind.            
+0000b450: 2020 2020 5d20 3d20 6d6c 7275 6e2e 636f      ] = mlrun.co
+0000b460: 6d6d 6f6e 2e73 6368 656d 6173 2e52 756e  mmon.schemas.Run
+0000b470: 7469 6d65 5265 736f 7572 6365 7328 2a2a  timeResources(**
+0000b480: 7275 6e74 696d 655f 7265 736f 7572 6365  runtime_resource
+0000b490: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+0000b4a0: 6e20 7374 7275 6374 7572 6564 5f64 6963  n structured_dic
+0000b4b0: 740a 0a20 2020 2064 6566 2063 7265 6174  t..    def creat
+0000b4c0: 655f 7363 6865 6475 6c65 280a 2020 2020  e_schedule(.    
+0000b4d0: 2020 2020 7365 6c66 2c20 7072 6f6a 6563      self, projec
+0000b4e0: 743a 2073 7472 2c20 7363 6865 6475 6c65  t: str, schedule
+0000b4f0: 3a20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  : mlrun.common.s
+0000b500: 6368 656d 6173 2e53 6368 6564 756c 6549  chemas.ScheduleI
+0000b510: 6e70 7574 0a20 2020 2029 3a0a 2020 2020  nput.    ):.    
+0000b520: 2020 2020 2222 2243 7265 6174 6520 6120      """Create a 
+0000b530: 6e65 7720 7363 6865 6475 6c65 206f 6e20  new schedule on 
+0000b540: 7468 6520 6769 7665 6e20 7072 6f6a 6563  the given projec
+0000b550: 742e 2054 6865 2064 6574 6169 6c73 206f  t. The details o
+0000b560: 6e20 7468 6520 6163 7475 616c 206f 626a  n the actual obj
+0000b570: 6563 7420 746f 2073 6368 6564 756c 6520  ect to schedule 
+0000b580: 6173 2077 656c 6c20 6173 2074 6865 0a20  as well as the. 
+0000b590: 2020 2020 2020 2073 6368 6564 756c 6520         schedule 
+0000b5a0: 6974 7365 6c66 2061 7265 2077 6974 6869  itself are withi
+0000b5b0: 6e20 7468 6520 7363 6865 6475 6c65 206f  n the schedule o
+0000b5c0: 626a 6563 7420 7072 6f76 6964 6564 2e0a  bject provided..
+0000b5d0: 2020 2020 2020 2020 5468 6520 3a70 793a          The :py:
+0000b5e0: 636c 6173 733a 607e 5363 6865 6475 6c65  class:`~Schedule
+0000b5f0: 4372 6f6e 5472 6967 6765 7260 2066 6f6c  CronTrigger` fol
+0000b600: 6c6f 7773 2074 6865 2067 7569 6465 6c69  lows the guideli
+0000b610: 6e65 7320 696e 0a20 2020 2020 2020 2068  nes in.        h
+0000b620: 7474 7073 3a2f 2f61 7073 6368 6564 756c  ttps://apschedul
+0000b630: 6572 2e72 6561 6474 6865 646f 6373 2e69  er.readthedocs.i
+0000b640: 6f2f 656e 2f33 2e78 2f6d 6f64 756c 6573  o/en/3.x/modules
+0000b650: 2f74 7269 6767 6572 732f 6372 6f6e 2e68  /triggers/cron.h
+0000b660: 746d 6c2e 0a20 2020 2020 2020 2049 7420  tml..        It 
+0000b670: 616c 736f 2073 7570 706f 7274 7320 6120  also supports a 
+0000b680: 3a70 793a 6675 6e63 3a60 7e53 6368 6564  :py:func:`~Sched
+0000b690: 756c 6543 726f 6e54 7269 6767 6572 2e66  uleCronTrigger.f
+0000b6a0: 726f 6d5f 6372 6f6e 7461 6260 2066 756e  rom_crontab` fun
+0000b6b0: 6374 696f 6e20 7468 6174 2061 6363 6570  ction that accep
+0000b6c0: 7473 2061 0a20 2020 2020 2020 2063 726f  ts a.        cro
+0000b6d0: 6e74 6162 2d66 6f72 6d61 7474 6564 2073  ntab-formatted s
+0000b6e0: 7472 696e 6720 2873 6565 2068 7474 7073  tring (see https
+0000b6f0: 3a2f 2f65 6e2e 7769 6b69 7065 6469 612e  ://en.wikipedia.
+0000b700: 6f72 672f 7769 6b69 2f43 726f 6e20 666f  org/wiki/Cron fo
+0000b710: 7220 6d6f 7265 2069 6e66 6f72 6d61 7469  r more informati
+0000b720: 6f6e 206f 6e20 7468 6520 666f 726d 6174  on on the format
+0000b730: 2061 6e64 0a20 2020 2020 2020 206e 6f74   and.        not
+0000b740: 6520 7468 6174 2074 6865 2030 2077 6565  e that the 0 wee
+0000b750: 6b64 6179 2069 7320 616c 7761 7973 206d  kday is always m
+0000b760: 6f6e 6461 7929 2e0a 0a0a 2020 2020 2020  onday)....      
+0000b770: 2020 4578 616d 706c 653a 3a0a 0a20 2020    Example::..   
+0000b780: 2020 2020 2020 2020 2066 726f 6d20 6d6c           from ml
+0000b790: 7275 6e2e 636f 6d6d 6f6e 2069 6d70 6f72  run.common impor
+0000b7a0: 7420 7363 6865 6d61 730a 0a20 2020 2020  t schemas..     
+0000b7b0: 2020 2020 2020 2023 2045 7865 6375 7465         # Execute
+0000b7c0: 2074 6865 2067 6574 5f64 6174 615f 6675   the get_data_fu
+0000b7d0: 6e63 2066 756e 6374 696f 6e20 6576 6572  nc function ever
+0000b7e0: 7920 5475 6573 6461 7920 6174 2031 353a  y Tuesday at 15:
+0000b7f0: 3330 0a20 2020 2020 2020 2020 2020 2073  30.            s
+0000b800: 6368 6564 756c 6520 3d20 7363 6865 6d61  chedule = schema
+0000b810: 732e 5363 6865 6475 6c65 496e 7075 7428  s.ScheduleInput(
+0000b820: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000b830: 206e 616d 653d 2272 756e 5f66 756e 635f   name="run_func_
+0000b840: 6f6e 5f74 7565 7364 6179 7322 2c0a 2020  on_tuesdays",.  
+0000b850: 2020 2020 2020 2020 2020 2020 2020 6b69                ki
+0000b860: 6e64 3d22 6a6f 6222 2c0a 2020 2020 2020  nd="job",.      
+0000b870: 2020 2020 2020 2020 2020 7363 6865 6475            schedu
+0000b880: 6c65 645f 6f62 6a65 6374 3d67 6574 5f64  led_object=get_d
+0000b890: 6174 615f 6675 6e63 2c0a 2020 2020 2020  ata_func,.      
+0000b8a0: 2020 2020 2020 2020 2020 6372 6f6e 5f74            cron_t
+0000b8b0: 7269 6767 6572 3d73 6368 656d 6173 2e53  rigger=schemas.S
+0000b8c0: 6368 6564 756c 6543 726f 6e54 7269 6767  cheduleCronTrigg
+0000b8d0: 6572 2864 6179 5f6f 665f 7765 656b 3d27  er(day_of_week='
+0000b8e0: 7475 6527 2c20 686f 7572 3d31 352c 206d  tue', hour=15, m
+0000b8f0: 696e 7574 653d 3330 292c 0a20 2020 2020  inute=30),.     
+0000b900: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000b910: 2020 2020 2064 622e 6372 6561 7465 5f73       db.create_s
+0000b920: 6368 6564 756c 6528 7072 6f6a 6563 745f  chedule(project_
+0000b930: 6e61 6d65 2c20 7363 6865 6475 6c65 290a  name, schedule).
+0000b940: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+0000b950: 2020 2020 2070 726f 6a65 6374 203d 2070       project = p
+0000b960: 726f 6a65 6374 206f 7220 636f 6e66 6967  roject or config
+0000b970: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+0000b980: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0000b990: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+0000b9a0: 6563 747d 2f73 6368 6564 756c 6573 220a  ect}/schedules".
+0000b9b0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+0000b9c0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+0000b9d0: 6420 6372 6561 7469 6e67 2073 6368 6564  d creating sched
+0000b9e0: 756c 6520 7b70 726f 6a65 6374 7d2f 7b73  ule {project}/{s
+0000b9f0: 6368 6564 756c 652e 6e61 6d65 7d22 0a20  chedule.name}". 
+0000ba00: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
+0000ba10: 6361 6c6c 2822 504f 5354 222c 2070 6174  call("POST", pat
+0000ba20: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+0000ba30: 2c20 626f 6479 3d64 6963 745f 746f 5f6a  , body=dict_to_j
+0000ba40: 736f 6e28 7363 6865 6475 6c65 2e64 6963  son(schedule.dic
+0000ba50: 7428 2929 290a 0a20 2020 2064 6566 2075  t()))..    def u
+0000ba60: 7064 6174 655f 7363 6865 6475 6c65 280a  pdate_schedule(.
+0000ba70: 2020 2020 2020 2020 7365 6c66 2c20 7072          self, pr
+0000ba80: 6f6a 6563 743a 2073 7472 2c20 6e61 6d65  oject: str, name
+0000ba90: 3a20 7374 722c 2073 6368 6564 756c 653a  : str, schedule:
+0000baa0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+0000bab0: 6865 6d61 732e 5363 6865 6475 6c65 5570  hemas.ScheduleUp
+0000bac0: 6461 7465 0a20 2020 2029 3a0a 2020 2020  date.    ):.    
+0000bad0: 2020 2020 2222 2255 7064 6174 6520 616e      """Update an
+0000bae0: 2065 7869 7374 696e 6720 7363 6865 6475   existing schedu
+0000baf0: 6c65 2c20 7265 706c 6163 6520 6974 2077  le, replace it w
+0000bb00: 6974 6820 7468 6520 6465 7461 696c 7320  ith the details 
+0000bb10: 636f 6e74 6169 6e65 6420 696e 2074 6865  contained in the
+0000bb20: 2073 6368 6564 756c 6520 6f62 6a65 6374   schedule object
+0000bb30: 2e22 2222 0a0a 2020 2020 2020 2020 7072  ."""..        pr
+0000bb40: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+0000bb50: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+0000bb60: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
+0000bb70: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+0000bb80: 6374 732f 7b70 726f 6a65 6374 7d2f 7363  cts/{project}/sc
+0000bb90: 6865 6475 6c65 732f 7b6e 616d 657d 220a  hedules/{name}".
+0000bba0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+0000bbb0: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+0000bbc0: 6420 7570 6461 7469 6e67 2073 6368 6564  d updating sched
+0000bbd0: 756c 6520 7b70 726f 6a65 6374 7d2f 7b6e  ule {project}/{n
+0000bbe0: 616d 657d 220a 2020 2020 2020 2020 7365  ame}".        se
+0000bbf0: 6c66 2e61 7069 5f63 616c 6c28 2250 5554  lf.api_call("PUT
+0000bc00: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+0000bc10: 6573 7361 6765 2c20 626f 6479 3d64 6963  essage, body=dic
+0000bc20: 745f 746f 5f6a 736f 6e28 7363 6865 6475  t_to_json(schedu
+0000bc30: 6c65 2e64 6963 7428 2929 290a 0a20 2020  le.dict()))..   
+0000bc40: 2064 6566 2067 6574 5f73 6368 6564 756c   def get_schedul
+0000bc50: 6528 0a20 2020 2020 2020 2073 656c 662c  e(.        self,
+0000bc60: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
+0000bc70: 616d 653a 2073 7472 2c20 696e 636c 7564  ame: str, includ
+0000bc80: 655f 6c61 7374 5f72 756e 3a20 626f 6f6c  e_last_run: bool
+0000bc90: 203d 2046 616c 7365 0a20 2020 2029 202d   = False.    ) -
+0000bca0: 3e20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  > mlrun.common.s
+0000bcb0: 6368 656d 6173 2e53 6368 6564 756c 654f  chemas.ScheduleO
+0000bcc0: 7574 7075 743a 0a20 2020 2020 2020 2022  utput:.        "
+0000bcd0: 2222 5265 7472 6965 7665 2064 6574 6169  ""Retrieve detai
+0000bce0: 6c73 206f 6620 7468 6520 7363 6865 6475  ls of the schedu
+0000bcf0: 6c65 2069 6e20 7175 6573 7469 6f6e 2e20  le in question. 
+0000bd00: 4265 7369 6465 7320 7265 7475 726e 696e  Besides returnin
+0000bd10: 6720 7468 6520 6465 7461 696c 7320 6f66  g the details of
+0000bd20: 2074 6865 2073 6368 6564 756c 6520 6f62   the schedule ob
+0000bd30: 6a65 6374 2069 7473 656c 662c 0a20 2020  ject itself,.   
+0000bd40: 2020 2020 2074 6869 7320 6675 6e63 7469       this functi
+0000bd50: 6f6e 2061 6c73 6f20 7265 7475 726e 7320  on also returns 
+0000bd60: 7468 6520 6e65 7874 2073 6368 6564 756c  the next schedul
+0000bd70: 6564 2072 756e 2066 6f72 2074 6869 7320  ed run for this 
+0000bd80: 7370 6563 6966 6963 2073 6368 6564 756c  specific schedul
+0000bd90: 652c 2061 7320 7765 6c6c 2061 7320 706f  e, as well as po
+0000bda0: 7465 6e74 6961 6c6c 7920 7468 650a 2020  tentially the.  
+0000bdb0: 2020 2020 2020 7265 7375 6c74 7320 6f66        results of
+0000bdc0: 2074 6865 206c 6173 7420 7275 6e20 6578   the last run ex
+0000bdd0: 6563 7574 6564 2074 6872 6f75 6768 2074  ecuted through t
+0000bde0: 6869 7320 7363 6865 6475 6c65 2e0a 0a20  his schedule... 
+0000bdf0: 2020 2020 2020 203a 7061 7261 6d20 7072         :param pr
+0000be00: 6f6a 6563 743a 2050 726f 6a65 6374 206e  oject: Project n
+0000be10: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
+0000be20: 7261 6d20 6e61 6d65 3a20 4e61 6d65 206f  ram name: Name o
+0000be30: 6620 7468 6520 7363 6865 6475 6c65 206f  f the schedule o
+0000be40: 626a 6563 7420 746f 2071 7565 7279 2e0a  bject to query..
+0000be50: 2020 2020 2020 2020 3a70 6172 616d 2069          :param i
+0000be60: 6e63 6c75 6465 5f6c 6173 745f 7275 6e3a  nclude_last_run:
+0000be70: 2057 6865 7468 6572 2074 6f20 696e 636c   Whether to incl
+0000be80: 7564 6520 7468 6520 7265 7375 6c74 7320  ude the results 
+0000be90: 6f66 2074 6865 2073 6368 6564 756c 6527  of the schedule'
+0000bea0: 7320 6c61 7374 2072 756e 2069 6e20 7468  s last run in th
+0000beb0: 6520 7265 7370 6f6e 7365 2e0a 2020 2020  e response..    
+0000bec0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0000bed0: 2070 726f 6a65 6374 203d 2070 726f 6a65   project = proje
+0000bee0: 6374 206f 7220 636f 6e66 6967 2e64 6566  ct or config.def
+0000bef0: 6175 6c74 5f70 726f 6a65 6374 0a20 2020  ault_project.   
+0000bf00: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
+0000bf10: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+0000bf20: 2f73 6368 6564 756c 6573 2f7b 6e61 6d65  /schedules/{name
+0000bf30: 7d22 0a20 2020 2020 2020 2065 7272 6f72  }".        error
+0000bf40: 5f6d 6573 7361 6765 203d 2066 2246 6169  _message = f"Fai
+0000bf50: 6c65 6420 6765 7474 696e 6720 7363 6865  led getting sche
+0000bf60: 6475 6c65 2066 6f72 207b 7072 6f6a 6563  dule for {projec
+0000bf70: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
+0000bf80: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
+0000bf90: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+0000bfa0: 2020 2020 2022 4745 5422 2c20 7061 7468       "GET", path
+0000bfb0: 2c20 6572 726f 725f 6d65 7373 6167 652c  , error_message,
+0000bfc0: 2070 6172 616d 733d 7b22 696e 636c 7564   params={"includ
+0000bfd0: 655f 6c61 7374 5f72 756e 223a 2069 6e63  e_last_run": inc
+0000bfe0: 6c75 6465 5f6c 6173 745f 7275 6e7d 0a20  lude_last_run}. 
+0000bff0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000c000: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
+0000c010: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
+0000c020: 6564 756c 654f 7574 7075 7428 2a2a 7265  eduleOutput(**re
+0000c030: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
+0000c040: 6465 6620 6c69 7374 5f73 6368 6564 756c  def list_schedul
+0000c050: 6573 280a 2020 2020 2020 2020 7365 6c66  es(.        self
+0000c060: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+0000c070: 743a 2073 7472 2c0a 2020 2020 2020 2020  t: str,.        
+0000c080: 6e61 6d65 3a20 7374 7220 3d20 4e6f 6e65  name: str = None
+0000c090: 2c0a 2020 2020 2020 2020 6b69 6e64 3a20  ,.        kind: 
+0000c0a0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0000c0b0: 656d 6173 2e53 6368 6564 756c 654b 696e  emas.ScheduleKin
+0000c0c0: 6473 203d 204e 6f6e 652c 0a20 2020 2020  ds = None,.     
+0000c0d0: 2020 2069 6e63 6c75 6465 5f6c 6173 745f     include_last_
+0000c0e0: 7275 6e3a 2062 6f6f 6c20 3d20 4661 6c73  run: bool = Fals
+0000c0f0: 652c 0a20 2020 2029 202d 3e20 6d6c 7275  e,.    ) -> mlru
+0000c100: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0000c110: 2e53 6368 6564 756c 6573 4f75 7470 7574  .SchedulesOutput
+0000c120: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000c130: 7269 6576 6520 6c69 7374 206f 6620 7363  rieve list of sc
+0000c140: 6865 6475 6c65 7320 6f66 2073 7065 6369  hedules of speci
+0000c150: 6669 6320 6e61 6d65 206f 7220 6b69 6e64  fic name or kind
+0000c160: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0000c170: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
+0000c180: 6374 206e 616d 652e 0a20 2020 2020 2020  ct name..       
+0000c190: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
+0000c1a0: 6d65 206f 6620 7363 6865 6475 6c65 2074  me of schedule t
+0000c1b0: 6f20 7265 7472 6965 7665 2e20 4361 6e20  o retrieve. Can 
+0000c1c0: 6265 206f 6d69 7474 6564 2074 6f20 6c69  be omitted to li
+0000c1d0: 7374 2061 6c6c 2073 6368 6564 756c 6573  st all schedules
+0000c1e0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000c1f0: 206b 696e 643a 204b 696e 6420 6f66 2073   kind: Kind of s
+0000c200: 6368 6564 756c 6520 6f62 6a65 6374 7320  chedule objects 
+0000c210: 746f 2072 6574 7269 6576 652c 2063 616e  to retrieve, can
+0000c220: 2062 6520 6569 7468 6572 2060 606a 6f62   be either ``job
+0000c230: 6060 206f 7220 6060 7069 7065 6c69 6e65  `` or ``pipeline
+0000c240: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
+0000c250: 616d 2069 6e63 6c75 6465 5f6c 6173 745f  am include_last_
+0000c260: 7275 6e3a 2057 6865 7468 6572 2074 6f20  run: Whether to 
+0000c270: 7265 7475 726e 2066 6f72 2065 6163 6820  return for each 
+0000c280: 7363 6865 6475 6c65 2072 6574 7572 6e65  schedule returne
+0000c290: 6420 616c 736f 2074 6865 2072 6573 756c  d also the resul
+0000c2a0: 7473 206f 6620 7468 6520 6c61 7374 2072  ts of the last r
+0000c2b0: 756e 206f 660a 2020 2020 2020 2020 2020  un of.          
+0000c2c0: 2020 7468 6174 2073 6368 6564 756c 652e    that schedule.
+0000c2d0: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000c2e0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+0000c2f0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
+0000c300: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
+0000c310: 740a 2020 2020 2020 2020 7061 7261 6d73  t.        params
+0000c320: 203d 207b 226b 696e 6422 3a20 6b69 6e64   = {"kind": kind
+0000c330: 2c20 226e 616d 6522 3a20 6e61 6d65 2c20  , "name": name, 
+0000c340: 2269 6e63 6c75 6465 5f6c 6173 745f 7275  "include_last_ru
+0000c350: 6e22 3a20 696e 636c 7564 655f 6c61 7374  n": include_last
+0000c360: 5f72 756e 7d0a 2020 2020 2020 2020 7061  _run}.        pa
+0000c370: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+0000c380: 7b70 726f 6a65 6374 7d2f 7363 6865 6475  {project}/schedu
+0000c390: 6c65 7322 0a20 2020 2020 2020 2065 7272  les".        err
+0000c3a0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+0000c3b0: 6169 6c65 6420 6c69 7374 696e 6720 7363  ailed listing sc
+0000c3c0: 6865 6475 6c65 7320 666f 7220 7b70 726f  hedules for {pro
+0000c3d0: 6a65 6374 7d20 3f20 7b6b 696e 647d 207b  ject} ? {kind} {
+0000c3e0: 6e61 6d65 7d22 0a20 2020 2020 2020 2072  name}".        r
+0000c3f0: 6573 7020 3d20 7365 6c66 2e61 7069 5f63  esp = self.api_c
+0000c400: 616c 6c28 2247 4554 222c 2070 6174 682c  all("GET", path,
+0000c410: 2065 7272 6f72 5f6d 6573 7361 6765 2c20   error_message, 
+0000c420: 7061 7261 6d73 3d70 6172 616d 7329 0a20  params=params). 
+0000c430: 2020 2020 2020 2072 6574 7572 6e20 6d6c         return ml
+0000c440: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000c450: 6173 2e53 6368 6564 756c 6573 4f75 7470  as.SchedulesOutp
+0000c460: 7574 282a 2a72 6573 702e 6a73 6f6e 2829  ut(**resp.json()
+0000c470: 290a 0a20 2020 2064 6566 2064 656c 6574  )..    def delet
+0000c480: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
+0000c490: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
+0000c4a0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
+0000c4b0: 2020 2022 2222 4465 6c65 7465 2061 2073     """Delete a s
+0000c4c0: 7065 6369 6669 6320 7363 6865 6475 6c65  pecific schedule
+0000c4d0: 2062 7920 6e61 6d65 2e22 2222 0a0a 2020   by name."""..  
+0000c4e0: 2020 2020 2020 7072 6f6a 6563 7420 3d20        project = 
+0000c4f0: 7072 6f6a 6563 7420 6f72 2063 6f6e 6669  project or confi
+0000c500: 672e 6465 6661 756c 745f 7072 6f6a 6563  g.default_projec
+0000c510: 740a 2020 2020 2020 2020 7061 7468 203d  t.        path =
+0000c520: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0000c530: 6a65 6374 7d2f 7363 6865 6475 6c65 732f  ject}/schedules/
+0000c540: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+0000c550: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+0000c560: 6622 4661 696c 6564 2064 656c 6574 696e  f"Failed deletin
+0000c570: 6720 7363 6865 6475 6c65 207b 7072 6f6a  g schedule {proj
+0000c580: 6563 747d 2f7b 6e61 6d65 7d22 0a20 2020  ect}/{name}".   
+0000c590: 2020 2020 2073 656c 662e 6170 695f 6361       self.api_ca
+0000c5a0: 6c6c 2822 4445 4c45 5445 222c 2070 6174  ll("DELETE", pat
+0000c5b0: 682c 2065 7272 6f72 5f6d 6573 7361 6765  h, error_message
+0000c5c0: 290a 0a20 2020 2064 6566 2069 6e76 6f6b  )..    def invok
+0000c5d0: 655f 7363 6865 6475 6c65 2873 656c 662c  e_schedule(self,
+0000c5e0: 2070 726f 6a65 6374 3a20 7374 722c 206e   project: str, n
+0000c5f0: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
+0000c600: 2020 2022 2222 4578 6563 7574 6520 7468     """Execute th
+0000c610: 6520 6f62 6a65 6374 2072 6566 6572 656e  e object referen
+0000c620: 6365 6420 6279 2074 6865 2073 6368 6564  ced by the sched
+0000c630: 756c 6520 696d 6d65 6469 6174 656c 792e  ule immediately.
+0000c640: 2222 220a 0a20 2020 2020 2020 2070 726f  """..        pro
+0000c650: 6a65 6374 203d 2070 726f 6a65 6374 206f  ject = project o
+0000c660: 7220 636f 6e66 6967 2e64 6566 6175 6c74  r config.default
+0000c670: 5f70 726f 6a65 6374 0a20 2020 2020 2020  _project.       
+0000c680: 2070 6174 6820 3d20 6622 7072 6f6a 6563   path = f"projec
+0000c690: 7473 2f7b 7072 6f6a 6563 747d 2f73 6368  ts/{project}/sch
+0000c6a0: 6564 756c 6573 2f7b 6e61 6d65 7d2f 696e  edules/{name}/in
+0000c6b0: 766f 6b65 220a 2020 2020 2020 2020 6572  voke".        er
+0000c6c0: 726f 725f 6d65 7373 6167 6520 3d20 6622  ror_message = f"
+0000c6d0: 4661 696c 6564 2069 6e76 6f6b 696e 6720  Failed invoking 
+0000c6e0: 7363 6865 6475 6c65 207b 7072 6f6a 6563  schedule {projec
+0000c6f0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
+0000c700: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
+0000c710: 2822 504f 5354 222c 2070 6174 682c 2065  ("POST", path, e
+0000c720: 7272 6f72 5f6d 6573 7361 6765 290a 0a20  rror_message).. 
+0000c730: 2020 2064 6566 2072 656d 6f74 655f 6275     def remote_bu
+0000c740: 696c 6465 7228 0a20 2020 2020 2020 2073  ilder(.        s
+0000c750: 656c 662c 0a20 2020 2020 2020 2066 756e  elf,.        fun
+0000c760: 632c 0a20 2020 2020 2020 2077 6974 685f  c,.        with_
+0000c770: 6d6c 7275 6e2c 0a20 2020 2020 2020 206d  mlrun,.        m
+0000c780: 6c72 756e 5f76 6572 7369 6f6e 5f73 7065  lrun_version_spe
+0000c790: 6369 6669 6572 3d4e 6f6e 652c 0a20 2020  cifier=None,.   
+0000c7a0: 2020 2020 2073 6b69 705f 6465 706c 6f79       skip_deploy
+0000c7b0: 6564 3d46 616c 7365 2c0a 2020 2020 2020  ed=False,.      
+0000c7c0: 2020 6275 696c 6465 725f 656e 763d 4e6f    builder_env=No
+0000c7d0: 6e65 2c0a 2020 2020 293a 0a20 2020 2020  ne,.    ):.     
+0000c7e0: 2020 2022 2222 4275 696c 6420 7468 6520     """Build the 
+0000c7f0: 706f 6420 696d 6167 6520 666f 7220 6120  pod image for a 
+0000c800: 6675 6e63 7469 6f6e 2c20 666f 7220 6578  function, for ex
+0000c810: 6563 7574 696f 6e20 6f6e 2061 2072 656d  ecution on a rem
+0000c820: 6f74 6520 636c 7573 7465 722e 2054 6869  ote cluster. Thi
+0000c830: 7320 6973 2065 7865 6375 7465 6420 6279  s is executed by
+0000c840: 2074 6865 204d 4c52 756e 0a20 2020 2020   the MLRun.     
+0000c850: 2020 2041 5049 2073 6572 7665 722c 2061     API server, a
+0000c860: 6e64 2063 7265 6174 6573 2061 2044 6f63  nd creates a Doc
+0000c870: 6b65 7220 696d 6167 6520 6f75 7420 6f66  ker image out of
+0000c880: 2074 6865 2066 756e 6374 696f 6e20 7072   the function pr
+0000c890: 6f76 6964 6564 2061 6e64 2061 6e79 2073  ovided and any s
+0000c8a0: 7065 6369 6669 6320 6275 696c 640a 2020  pecific build.  
+0000c8b0: 2020 2020 2020 696e 7374 7275 6374 696f        instructio
+0000c8c0: 6e73 2070 726f 7669 6465 6420 7769 7468  ns provided with
+0000c8d0: 696e 2e20 5468 6973 2069 7320 6120 7072  in. This is a pr
+0000c8e0: 652d 7265 7175 6973 6974 6520 666f 7220  e-requisite for 
+0000c8f0: 7265 6d6f 7465 6c79 2065 7865 6375 7469  remotely executi
+0000c900: 6e67 2061 2066 756e 6374 696f 6e2c 2075  ng a function, u
+0000c910: 6e6c 6573 7320 7573 696e 670a 2020 2020  nless using.    
+0000c920: 2020 2020 6120 7072 652d 6465 706c 6f79      a pre-deploy
+0000c930: 6564 2069 6d61 6765 2e0a 0a20 2020 2020  ed image...     
+0000c940: 2020 203a 7061 7261 6d20 6675 6e63 3a20     :param func: 
+0000c950: 4675 6e63 7469 6f6e 2074 6f20 6275 696c  Function to buil
+0000c960: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+0000c970: 6d20 7769 7468 5f6d 6c72 756e 3a20 5768  m with_mlrun: Wh
+0000c980: 6574 6865 7220 746f 2061 6464 204d 4c52  ether to add MLR
+0000c990: 756e 2070 6163 6b61 6765 2074 6f20 7468  un package to th
+0000c9a0: 6520 6275 696c 7420 7061 636b 6167 652e  e built package.
+0000c9b0: 2054 6869 7320 6973 206e 6f74 2072 6571   This is not req
+0000c9c0: 7569 7265 6420 6966 2075 7369 6e67 2061  uired if using a
+0000c9d0: 2062 6173 650a 2020 2020 2020 2020 2020   base.          
+0000c9e0: 2020 696d 6167 6520 7468 6174 2061 6c72    image that alr
+0000c9f0: 6561 6479 2068 6173 204d 4c52 756e 2069  eady has MLRun i
+0000ca00: 6e20 6974 2e0a 2020 2020 2020 2020 3a70  n it..        :p
+0000ca10: 6172 616d 206d 6c72 756e 5f76 6572 7369  aram mlrun_versi
+0000ca20: 6f6e 5f73 7065 6369 6669 6572 3a20 5665  on_specifier: Ve
+0000ca30: 7273 696f 6e20 6f66 204d 4c52 756e 2074  rsion of MLRun t
+0000ca40: 6f20 696e 636c 7564 6520 696e 2074 6865  o include in the
+0000ca50: 2062 7569 6c74 2069 6d61 6765 2e0a 2020   built image..  
+0000ca60: 2020 2020 2020 3a70 6172 616d 2073 6b69        :param ski
+0000ca70: 705f 6465 706c 6f79 6564 3a20 536b 6970  p_deployed: Skip
+0000ca80: 2074 6865 2062 7569 6c64 2069 6620 7765   the build if we
+0000ca90: 2061 6c72 6561 6479 2068 6176 6520 616e   already have an
+0000caa0: 2069 6d61 6765 2066 6f72 2074 6865 2066   image for the f
+0000cab0: 756e 6374 696f 6e2e 0a20 2020 2020 2020  unction..       
+0000cac0: 203a 7061 7261 6d20 6275 696c 6465 725f   :param builder_
+0000cad0: 656e 763a 2020 204b 616e 696b 6f20 6275  env:   Kaniko bu
+0000cae0: 696c 6465 7220 706f 6420 656e 7620 7661  ilder pod env va
+0000caf0: 7273 2064 6963 7420 2866 6f72 2063 6f6e  rs dict (for con
+0000cb00: 6669 672f 6372 6564 656e 7469 616c 7329  fig/credentials)
+0000cb10: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+0000cb20: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
+0000cb30: 2020 2020 2020 2072 6571 203d 207b 0a20         req = {. 
+0000cb40: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000cb50: 6675 6e63 7469 6f6e 223a 2066 756e 632e  function": func.
+0000cb60: 746f 5f64 6963 7428 292c 0a20 2020 2020  to_dict(),.     
+0000cb70: 2020 2020 2020 2020 2020 2022 7769 7468             "with
+0000cb80: 5f6d 6c72 756e 223a 2062 6f6f 6c32 7374  _mlrun": bool2st
+0000cb90: 7228 7769 7468 5f6d 6c72 756e 292c 0a20  r(with_mlrun),. 
+0000cba0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+0000cbb0: 736b 6970 5f64 6570 6c6f 7965 6422 3a20  skip_deployed": 
+0000cbc0: 736b 6970 5f64 6570 6c6f 7965 642c 0a20  skip_deployed,. 
+0000cbd0: 2020 2020 2020 2020 2020 207d 0a20 2020             }.   
+0000cbe0: 2020 2020 2020 2020 2069 6620 6d6c 7275           if mlru
+0000cbf0: 6e5f 7665 7273 696f 6e5f 7370 6563 6966  n_version_specif
+0000cc00: 6965 723a 0a20 2020 2020 2020 2020 2020  ier:.           
+0000cc10: 2020 2020 2072 6571 5b22 6d6c 7275 6e5f       req["mlrun_
+0000cc20: 7665 7273 696f 6e5f 7370 6563 6966 6965  version_specifie
+0000cc30: 7222 5d20 3d20 6d6c 7275 6e5f 7665 7273  r"] = mlrun_vers
+0000cc40: 696f 6e5f 7370 6563 6966 6965 720a 2020  ion_specifier.  
+0000cc50: 2020 2020 2020 2020 2020 6966 2062 7569            if bui
+0000cc60: 6c64 6572 5f65 6e76 3a0a 2020 2020 2020  lder_env:.      
+0000cc70: 2020 2020 2020 2020 2020 7265 715b 2262            req["b
+0000cc80: 7569 6c64 6572 5f65 6e76 225d 203d 2062  uilder_env"] = b
+0000cc90: 7569 6c64 6572 5f65 6e76 0a20 2020 2020  uilder_env.     
+0000cca0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+0000ccb0: 6c66 2e61 7069 5f63 616c 6c28 2250 4f53  lf.api_call("POS
+0000ccc0: 5422 2c20 2262 7569 6c64 2f66 756e 6374  T", "build/funct
+0000ccd0: 696f 6e22 2c20 6a73 6f6e 3d72 6571 290a  ion", json=req).
+0000cce0: 2020 2020 2020 2020 6578 6365 7074 204f          except O
+0000ccf0: 5345 7272 6f72 2061 7320 6572 723a 0a20  SError as err:. 
+0000cd00: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0000cd10: 722e 6572 726f 7228 6622 6572 726f 7220  r.error(f"error 
+0000cd20: 7375 626d 6974 7469 6e67 2062 7569 6c64  submitting build
+0000cd30: 2074 6173 6b3a 207b 6572 725f 746f 5f73   task: {err_to_s
+0000cd40: 7472 2865 7272 297d 2229 0a20 2020 2020  tr(err)}").     
+0000cd50: 2020 2020 2020 2072 6169 7365 204f 5345         raise OSE
+0000cd60: 7272 6f72 2866 2265 7272 6f72 3a20 6361  rror(f"error: ca
+0000cd70: 6e6e 6f74 2073 7562 6d69 7420 6275 696c  nnot submit buil
+0000cd80: 642c 207b 6572 725f 746f 5f73 7472 2865  d, {err_to_str(e
+0000cd90: 7272 297d 2229 0a0a 2020 2020 2020 2020  rr)}")..        
+0000cda0: 6966 206e 6f74 2072 6573 702e 6f6b 3a0a  if not resp.ok:.
+0000cdb0: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000cdc0: 6572 2e65 7272 6f72 2866 2262 6164 2072  er.error(f"bad r
+0000cdd0: 6573 7021 215c 6e7b 7265 7370 2e74 6578  esp!!\n{resp.tex
+0000cde0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
+0000cdf0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000ce00: 7228 2262 6164 2066 756e 6374 696f 6e20  r("bad function 
+0000ce10: 7275 6e20 7265 7370 6f6e 7365 2229 0a0a  run response")..
+0000ce20: 2020 2020 2020 2020 7265 7475 726e 2072          return r
+0000ce30: 6573 702e 6a73 6f6e 2829 0a0a 2020 2020  esp.json()..    
+0000ce40: 6465 6620 6765 745f 6275 696c 6465 725f  def get_builder_
+0000ce50: 7374 6174 7573 280a 2020 2020 2020 2020  status(.        
+0000ce60: 7365 6c66 2c0a 2020 2020 2020 2020 6675  self,.        fu
+0000ce70: 6e63 3a20 4261 7365 5275 6e74 696d 652c  nc: BaseRuntime,
+0000ce80: 0a20 2020 2020 2020 206f 6666 7365 743a  .        offset:
+0000ce90: 2069 6e74 203d 2030 2c0a 2020 2020 2020   int = 0,.      
+0000cea0: 2020 6c6f 6773 3a20 626f 6f6c 203d 2054    logs: bool = T
+0000ceb0: 7275 652c 0a20 2020 2020 2020 206c 6173  rue,.        las
+0000cec0: 745f 6c6f 675f 7469 6d65 7374 616d 703a  t_log_timestamp:
+0000ced0: 2066 6c6f 6174 203d 2030 2e30 2c0a 2020   float = 0.0,.  
+0000cee0: 2020 2020 2020 7665 7262 6f73 653a 2062        verbose: b
+0000cef0: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0000cf00: 2029 3a0a 2020 2020 2020 2020 2222 2252   ):.        """R
+0000cf10: 6574 7269 6576 6520 7468 6520 7374 6174  etrieve the stat
+0000cf20: 7573 206f 6620 6120 6275 696c 6420 6f70  us of a build op
+0000cf30: 6572 6174 696f 6e20 6375 7272 656e 746c  eration currentl
+0000cf40: 7920 696e 2070 726f 6772 6573 732e 0a0a  y in progress...
+0000cf50: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+0000cf60: 756e 633a 2020 2020 2020 2020 2020 2020  unc:            
+0000cf70: 2020 2020 4675 6e63 7469 6f6e 206f 626a      Function obj
+0000cf80: 6563 7420 7468 6174 2069 7320 6265 696e  ect that is bein
+0000cf90: 6720 6275 696c 742e 0a20 2020 2020 2020  g built..       
+0000cfa0: 203a 7061 7261 6d20 6f66 6673 6574 3a20   :param offset: 
+0000cfb0: 2020 2020 2020 2020 2020 2020 204f 6666               Off
+0000cfc0: 7365 7420 696e 746f 2074 6865 2062 7569  set into the bui
+0000cfd0: 6c64 206c 6f67 7320 746f 2072 6574 7269  ld logs to retri
+0000cfe0: 6576 6520 6c6f 6773 2066 726f 6d2e 0a20  eve logs from.. 
+0000cff0: 2020 2020 2020 203a 7061 7261 6d20 6c6f         :param lo
+0000d000: 6773 3a20 2020 2020 2020 2020 2020 2020  gs:             
+0000d010: 2020 2053 686f 756c 6420 6275 696c 6420     Should build 
+0000d020: 6c6f 6773 2062 6520 7265 7472 6965 7665  logs be retrieve
+0000d030: 642e 0a20 2020 2020 2020 203a 7061 7261  d..        :para
+0000d040: 6d20 6c61 7374 5f6c 6f67 5f74 696d 6573  m last_log_times
+0000d050: 7461 6d70 3a20 204c 6173 7420 7469 6d65  tamp:  Last time
+0000d060: 7374 616d 7020 6f66 206c 6f67 7320 7468  stamp of logs th
+0000d070: 6174 2077 6572 6520 616c 7265 6164 7920  at were already 
+0000d080: 7265 7472 6965 7665 642e 2046 756e 6374  retrieved. Funct
+0000d090: 696f 6e20 7769 6c6c 2072 6574 7572 6e20  ion will return 
+0000d0a0: 6f6e 6c79 206c 6f67 730a 2020 2020 2020  only logs.      
+0000d0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d0c0: 2020 2020 2020 2020 2020 2020 2020 6c61                la
+0000d0d0: 7465 7220 7468 616e 2074 6869 7320 7061  ter than this pa
+0000d0e0: 7261 6d65 7465 722e 0a20 2020 2020 2020  rameter..       
+0000d0f0: 203a 7061 7261 6d20 7665 7262 6f73 653a   :param verbose:
+0000d100: 2020 2020 2020 2020 2020 2020 2041 6464               Add
+0000d110: 2076 6572 626f 7365 206c 6f67 7320 696e   verbose logs in
+0000d120: 746f 2074 6865 206f 7574 7075 742e 0a0a  to the output...
+0000d130: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
+0000d140: 3a20 5468 6520 666f 6c6c 6f77 696e 6720  : The following 
+0000d150: 7061 7261 6d65 7465 7273 3a0a 0a20 2020  parameters:..   
+0000d160: 2020 2020 2020 2020 202d 2054 6578 7420           - Text 
+0000d170: 6f66 2062 7569 6c64 6572 206c 6f67 732e  of builder logs.
+0000d180: 0a20 2020 2020 2020 2020 2020 202d 2054  .            - T
+0000d190: 696d 6573 7461 6d70 206f 6620 6c61 7374  imestamp of last
+0000d1a0: 206c 6f67 2072 6574 7269 6576 6564 2c20   log retrieved, 
+0000d1b0: 746f 2062 6520 7573 6564 2069 6e20 7375  to be used in su
+0000d1c0: 6273 6571 7565 6e74 2063 616c 6c73 2074  bsequent calls t
+0000d1d0: 6f20 7468 6973 2066 756e 6374 696f 6e2e  o this function.
+0000d1e0: 0a0a 2020 2020 2020 2020 2020 2020 5468  ..            Th
+0000d1f0: 6520 6675 6e63 7469 6f6e 2061 6c73 6f20  e function also 
+0000d200: 7570 6461 7465 7320 696e 7465 726e 616c  updates internal
+0000d210: 206d 656d 6265 7273 206f 6620 7468 6520   members of the 
+0000d220: 6060 6675 6e63 6060 206f 626a 6563 7420  ``func`` object 
+0000d230: 746f 2072 6566 6c65 6374 2062 7569 6c64  to reflect build
+0000d240: 2070 726f 6365 7373 2069 6e66 6f2e 0a20   process info.. 
+0000d250: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000d260: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000d270: 2020 2020 2070 6172 616d 7320 3d20 7b0a       params = {.
+0000d280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d290: 226e 616d 6522 3a20 6e6f 726d 616c 697a  "name": normaliz
+0000d2a0: 655f 6e61 6d65 2866 756e 632e 6d65 7461  e_name(func.meta
+0000d2b0: 6461 7461 2e6e 616d 6529 2c0a 2020 2020  data.name),.    
+0000d2c0: 2020 2020 2020 2020 2020 2020 2270 726f              "pro
+0000d2d0: 6a65 6374 223a 2066 756e 632e 6d65 7461  ject": func.meta
+0000d2e0: 6461 7461 2e70 726f 6a65 6374 2c0a 2020  data.project,.  
+0000d2f0: 2020 2020 2020 2020 2020 2020 2020 2274                "t
+0000d300: 6167 223a 2066 756e 632e 6d65 7461 6461  ag": func.metada
+0000d310: 7461 2e74 6167 2c0a 2020 2020 2020 2020  ta.tag,.        
+0000d320: 2020 2020 2020 2020 226c 6f67 7322 3a20          "logs": 
+0000d330: 626f 6f6c 3273 7472 286c 6f67 7329 2c0a  bool2str(logs),.
+0000d340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d350: 226f 6666 7365 7422 3a20 7374 7228 6f66  "offset": str(of
+0000d360: 6673 6574 292c 0a20 2020 2020 2020 2020  fset),.         
+0000d370: 2020 2020 2020 2022 6c61 7374 5f6c 6f67         "last_log
+0000d380: 5f74 696d 6573 7461 6d70 223a 2073 7472  _timestamp": str
+0000d390: 286c 6173 745f 6c6f 675f 7469 6d65 7374  (last_log_timest
+0000d3a0: 616d 7029 2c0a 2020 2020 2020 2020 2020  amp),.          
+0000d3b0: 2020 2020 2020 2276 6572 626f 7365 223a        "verbose":
+0000d3c0: 2062 6f6f 6c32 7374 7228 7665 7262 6f73   bool2str(verbos
+0000d3d0: 6529 2c0a 2020 2020 2020 2020 2020 2020  e),.            
+0000d3e0: 7d0a 2020 2020 2020 2020 2020 2020 7265  }.            re
+0000d3f0: 7370 203d 2073 656c 662e 6170 695f 6361  sp = self.api_ca
+0000d400: 6c6c 2822 4745 5422 2c20 2262 7569 6c64  ll("GET", "build
+0000d410: 2f73 7461 7475 7322 2c20 7061 7261 6d73  /status", params
+0000d420: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+0000d430: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
+0000d440: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
+0000d450: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
+0000d460: 2866 2265 7272 6f72 2067 6574 7469 6e67  (f"error getting
+0000d470: 2062 7569 6c64 2073 7461 7475 733a 207b   build status: {
+0000d480: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
+0000d490: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+0000d4a0: 6169 7365 204f 5345 7272 6f72 2866 2265  aise OSError(f"e
+0000d4b0: 7272 6f72 3a20 6361 6e6e 6f74 2067 6574  rror: cannot get
+0000d4c0: 2062 7569 6c64 2073 7461 7475 732c 207b   build status, {
+0000d4d0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
+0000d4e0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
+0000d4f0: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
+0000d500: 2020 2020 2020 2020 6c6f 6767 6572 2e77          logger.w
+0000d510: 6172 6e69 6e67 2866 2266 6169 6c65 6420  arning(f"failed 
+0000d520: 7265 7370 2c20 7b72 6573 702e 7465 7874  resp, {resp.text
+0000d530: 7d22 290a 2020 2020 2020 2020 2020 2020  }").            
+0000d540: 7261 6973 6520 5275 6e44 4245 7272 6f72  raise RunDBError
+0000d550: 2822 6261 6420 6675 6e63 7469 6f6e 2062  ("bad function b
+0000d560: 7569 6c64 2072 6573 706f 6e73 6522 290a  uild response").
+0000d570: 0a20 2020 2020 2020 2069 6620 7265 7370  .        if resp
+0000d580: 2e68 6561 6465 7273 3a0a 2020 2020 2020  .headers:.      
+0000d590: 2020 2020 2020 6675 6e63 2e73 7461 7475        func.statu
+0000d5a0: 732e 7374 6174 6520 3d20 7265 7370 2e68  s.state = resp.h
+0000d5b0: 6561 6465 7273 2e67 6574 2822 782d 6d6c  eaders.get("x-ml
+0000d5c0: 7275 6e2d 6675 6e63 7469 6f6e 2d73 7461  run-function-sta
+0000d5d0: 7475 7322 2c20 2222 290a 2020 2020 2020  tus", "").      
+0000d5e0: 2020 2020 2020 6c61 7374 5f6c 6f67 5f74        last_log_t
+0000d5f0: 696d 6573 7461 6d70 203d 2066 6c6f 6174  imestamp = float
+0000d600: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0000d610: 2020 7265 7370 2e68 6561 6465 7273 2e67    resp.headers.g
+0000d620: 6574 2822 782d 6d6c 7275 6e2d 6c61 7374  et("x-mlrun-last
+0000d630: 2d74 696d 6573 7461 6d70 222c 2022 302e  -timestamp", "0.
+0000d640: 3022 290a 2020 2020 2020 2020 2020 2020  0").            
+0000d650: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+0000d660: 2066 756e 632e 6b69 6e64 2069 6e20 6d6c   func.kind in ml
+0000d670: 7275 6e2e 7275 6e74 696d 6573 2e52 756e  run.runtimes.Run
+0000d680: 7469 6d65 4b69 6e64 732e 6e75 636c 696f  timeKinds.nuclio
+0000d690: 5f72 756e 7469 6d65 7328 293a 0a20 2020  _runtimes():.   
+0000d6a0: 2020 2020 2020 2020 2020 2020 2066 756e               fun
+0000d6b0: 632e 7374 6174 7573 2e61 6464 7265 7373  c.status.address
+0000d6c0: 203d 2072 6573 702e 6865 6164 6572 732e   = resp.headers.
+0000d6d0: 6765 7428 2278 2d6d 6c72 756e 2d61 6464  get("x-mlrun-add
+0000d6e0: 7265 7373 222c 2022 2229 0a20 2020 2020  ress", "").     
+0000d6f0: 2020 2020 2020 2020 2020 2066 756e 632e             func.
+0000d700: 7374 6174 7573 2e6e 7563 6c69 6f5f 6e61  status.nuclio_na
+0000d710: 6d65 203d 2072 6573 702e 6865 6164 6572  me = resp.header
+0000d720: 732e 6765 7428 2278 2d6d 6c72 756e 2d6e  s.get("x-mlrun-n
+0000d730: 616d 6522 2c20 2222 290a 2020 2020 2020  ame", "").      
+0000d740: 2020 2020 2020 2020 2020 6675 6e63 2e73            func.s
+0000d750: 7461 7475 732e 696e 7465 726e 616c 5f69  tatus.internal_i
+0000d760: 6e76 6f63 6174 696f 6e5f 7572 6c73 203d  nvocation_urls =
+0000d770: 2072 6573 702e 6865 6164 6572 732e 6765   resp.headers.ge
+0000d780: 7428 0a20 2020 2020 2020 2020 2020 2020  t(.             
+0000d790: 2020 2020 2020 2022 782d 6d6c 7275 6e2d         "x-mlrun-
+0000d7a0: 696e 7465 726e 616c 2d69 6e76 6f63 6174  internal-invocat
+0000d7b0: 696f 6e2d 7572 6c73 222c 2022 220a 2020  ion-urls", "".  
+0000d7c0: 2020 2020 2020 2020 2020 2020 2020 292e                ).
+0000d7d0: 7370 6c69 7428 222c 2229 0a20 2020 2020  split(",").     
+0000d7e0: 2020 2020 2020 2020 2020 2066 756e 632e             func.
+0000d7f0: 7374 6174 7573 2e65 7874 6572 6e61 6c5f  status.external_
+0000d800: 696e 766f 6361 7469 6f6e 5f75 726c 7320  invocation_urls 
+0000d810: 3d20 7265 7370 2e68 6561 6465 7273 2e67  = resp.headers.g
+0000d820: 6574 280a 2020 2020 2020 2020 2020 2020  et(.            
+0000d830: 2020 2020 2020 2020 2278 2d6d 6c72 756e          "x-mlrun
+0000d840: 2d65 7874 6572 6e61 6c2d 696e 766f 6361  -external-invoca
+0000d850: 7469 6f6e 2d75 726c 7322 2c20 2222 0a20  tion-urls", "". 
+0000d860: 2020 2020 2020 2020 2020 2020 2020 2029                 )
+0000d870: 2e73 706c 6974 2822 2c22 290a 2020 2020  .split(",").    
+0000d880: 2020 2020 2020 2020 2020 2020 6675 6e63              func
+0000d890: 2e73 7461 7475 732e 636f 6e74 6169 6e65  .status.containe
+0000d8a0: 725f 696d 6167 6520 3d20 7265 7370 2e68  r_image = resp.h
+0000d8b0: 6561 6465 7273 2e67 6574 280a 2020 2020  eaders.get(.    
+0000d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000d8d0: 2278 2d6d 6c72 756e 2d63 6f6e 7461 696e  "x-mlrun-contain
+0000d8e0: 6572 2d69 6d61 6765 222c 2022 220a 2020  er-image", "".  
+0000d8f0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+0000d900: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000d910: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000d920: 2020 6675 6e63 2e73 7461 7475 732e 6275    func.status.bu
+0000d930: 696c 645f 706f 6420 3d20 7265 7370 2e68  ild_pod = resp.h
+0000d940: 6561 6465 7273 2e67 6574 2822 6275 696c  eaders.get("buil
+0000d950: 6465 725f 706f 6422 2c20 2222 290a 2020  der_pod", "").  
+0000d960: 2020 2020 2020 2020 2020 2020 2020 6675                fu
+0000d970: 6e63 2e73 7065 632e 696d 6167 6520 3d20  nc.spec.image = 
+0000d980: 7265 7370 2e68 6561 6465 7273 2e67 6574  resp.headers.get
+0000d990: 2822 6675 6e63 7469 6f6e 5f69 6d61 6765  ("function_image
+0000d9a0: 222c 2022 2229 0a0a 2020 2020 2020 2020  ", "")..        
+0000d9b0: 7465 7874 203d 2022 220a 2020 2020 2020  text = "".      
+0000d9c0: 2020 6966 2072 6573 702e 636f 6e74 656e    if resp.conten
+0000d9d0: 743a 0a20 2020 2020 2020 2020 2020 2074  t:.            t
+0000d9e0: 6578 7420 3d20 7265 7370 2e63 6f6e 7465  ext = resp.conte
+0000d9f0: 6e74 2e64 6563 6f64 6528 290a 2020 2020  nt.decode().    
+0000da00: 2020 2020 7265 7475 726e 2074 6578 742c      return text,
+0000da10: 206c 6173 745f 6c6f 675f 7469 6d65 7374   last_log_timest
+0000da20: 616d 700a 0a20 2020 2064 6566 2072 656d  amp..    def rem
+0000da30: 6f74 655f 7374 6172 7428 7365 6c66 2c20  ote_start(self, 
+0000da40: 6675 6e63 5f75 726c 2920 2d3e 206d 6c72  func_url) -> mlr
+0000da50: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0000da60: 732e 4261 636b 6772 6f75 6e64 5461 736b  s.BackgroundTask
+0000da70: 3a0a 2020 2020 2020 2020 2222 2245 7865  :.        """Exe
+0000da80: 6375 7465 2061 2066 756e 6374 696f 6e20  cute a function 
+0000da90: 7265 6d6f 7465 6c79 2c20 5573 6564 2066  remotely, Used f
+0000daa0: 6f72 2060 6064 6173 6b60 6020 6675 6e63  or ``dask`` func
+0000dab0: 7469 6f6e 732e 0a0a 2020 2020 2020 2020  tions...        
+0000dac0: 3a70 6172 616d 2066 756e 635f 7572 6c3a  :param func_url:
+0000dad0: 2055 524c 2074 6f20 7468 6520 6675 6e63   URL to the func
+0000dae0: 7469 6f6e 2074 6f20 6265 2065 7865 6375  tion to be execu
+0000daf0: 7465 642e 0a20 2020 2020 2020 203a 7265  ted..        :re
+0000db00: 7475 726e 733a 2041 2042 6163 6b67 726f  turns: A Backgro
+0000db10: 756e 6454 6173 6b20 6f62 6a65 6374 2c20  undTask object, 
+0000db20: 7769 7468 2064 6574 6169 6c73 206f 6e20  with details on 
+0000db30: 6578 6563 7574 696f 6e20 7072 6f63 6573  execution proces
+0000db40: 7320 616e 6420 6974 7320 7374 6174 7573  s and its status
+0000db50: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+0000db60: 2020 2020 2020 2074 7279 3a0a 2020 2020         try:.    
+0000db70: 2020 2020 2020 2020 7265 7120 3d20 7b22          req = {"
+0000db80: 6675 6e63 7469 6f6e 5572 6c22 3a20 6675  functionUrl": fu
+0000db90: 6e63 5f75 726c 7d0a 2020 2020 2020 2020  nc_url}.        
+0000dba0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+0000dbb0: 6170 695f 6361 6c6c 280a 2020 2020 2020  api_call(.      
+0000dbc0: 2020 2020 2020 2020 2020 2250 4f53 5422            "POST"
+0000dbd0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0000dbe0: 2020 2273 7461 7274 2f66 756e 6374 696f    "start/functio
+0000dbf0: 6e22 2c0a 2020 2020 2020 2020 2020 2020  n",.            
+0000dc00: 2020 2020 6a73 6f6e 3d72 6571 2c0a 2020      json=req,.  
+0000dc10: 2020 2020 2020 2020 2020 2020 2020 7469                ti
+0000dc20: 6d65 6f75 743d 696e 7428 636f 6e66 6967  meout=int(config
+0000dc30: 2e73 7562 6d69 745f 7469 6d65 6f75 7429  .submit_timeout)
+0000dc40: 206f 7220 3630 2c0a 2020 2020 2020 2020   or 60,.        
+0000dc50: 2020 2020 290a 2020 2020 2020 2020 6578      ).        ex
+0000dc60: 6365 7074 204f 5345 7272 6f72 2061 7320  cept OSError as 
+0000dc70: 6572 723a 0a20 2020 2020 2020 2020 2020  err:.           
+0000dc80: 206c 6f67 6765 722e 6572 726f 7228 6622   logger.error(f"
+0000dc90: 6572 726f 7220 7374 6172 7469 6e67 2066  error starting f
+0000dca0: 756e 6374 696f 6e3a 207b 6572 725f 746f  unction: {err_to
+0000dcb0: 5f73 7472 2865 7272 297d 2229 0a20 2020  _str(err)}").   
+0000dcc0: 2020 2020 2020 2020 2072 6169 7365 204f           raise O
+0000dcd0: 5345 7272 6f72 2866 2265 7272 6f72 3a20  SError(f"error: 
+0000dce0: 6361 6e6e 6f74 2073 7461 7274 2066 756e  cannot start fun
+0000dcf0: 6374 696f 6e2c 207b 6572 725f 746f 5f73  ction, {err_to_s
+0000dd00: 7472 2865 7272 297d 2229 0a0a 2020 2020  tr(err)}")..    
+0000dd10: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
+0000dd20: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
+0000dd30: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
+0000dd40: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
+0000dd50: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
+0000dd60: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000dd70: 4572 726f 7228 2262 6164 2066 756e 6374  Error("bad funct
+0000dd80: 696f 6e20 7374 6172 7420 7265 7370 6f6e  ion start respon
+0000dd90: 7365 2229 0a0a 2020 2020 2020 2020 7265  se")..        re
+0000dda0: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
+0000ddb0: 6e2e 7363 6865 6d61 732e 4261 636b 6772  n.schemas.Backgr
+0000ddc0: 6f75 6e64 5461 736b 282a 2a72 6573 702e  oundTask(**resp.
+0000ddd0: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
+0000dde0: 2067 6574 5f70 726f 6a65 6374 5f62 6163   get_project_bac
+0000ddf0: 6b67 726f 756e 645f 7461 736b 280a 2020  kground_task(.  
+0000de00: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0000de10: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+0000de20: 2c0a 2020 2020 2020 2020 6e61 6d65 3a20  ,.        name: 
+0000de30: 7374 722c 0a20 2020 2029 202d 3e20 6d6c  str,.    ) -> ml
+0000de40: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000de50: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
+0000de60: 6b3a 0a20 2020 2020 2020 2022 2222 5265  k:.        """Re
+0000de70: 7472 6965 7665 2075 7064 6174 6564 2069  trieve updated i
+0000de80: 6e66 6f72 6d61 7469 6f6e 206f 6e20 6120  nformation on a 
+0000de90: 7072 6f6a 6563 7420 6261 636b 6772 6f75  project backgrou
+0000dea0: 6e64 2074 6173 6b20 6265 696e 6720 6578  nd task being ex
+0000deb0: 6563 7574 6564 2e22 2222 0a0a 2020 2020  ecuted."""..    
+0000dec0: 2020 2020 7072 6f6a 6563 7420 3d20 7072      project = pr
+0000ded0: 6f6a 6563 7420 6f72 2063 6f6e 6669 672e  oject or config.
+0000dee0: 6465 6661 756c 745f 7072 6f6a 6563 740a  default_project.
+0000def0: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+0000df00: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+0000df10: 6374 7d2f 6261 636b 6772 6f75 6e64 2d74  ct}/background-t
+0000df20: 6173 6b73 2f7b 6e61 6d65 7d22 0a20 2020  asks/{name}".   
+0000df30: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+0000df40: 6765 203d 2028 0a20 2020 2020 2020 2020  ge = (.         
+0000df50: 2020 2066 2246 6169 6c65 6420 6765 7474     f"Failed gett
+0000df60: 696e 6720 7072 6f6a 6563 7420 6261 636b  ing project back
+0000df70: 6772 6f75 6e64 2074 6173 6b2e 2070 726f  ground task. pro
+0000df80: 6a65 6374 3d7b 7072 6f6a 6563 747d 2c20  ject={project}, 
+0000df90: 6e61 6d65 3d7b 6e61 6d65 7d22 0a20 2020  name={name}".   
+0000dfa0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0000dfb0: 6573 706f 6e73 6520 3d20 7365 6c66 2e61  esponse = self.a
+0000dfc0: 7069 5f63 616c 6c28 2247 4554 222c 2070  pi_call("GET", p
+0000dfd0: 6174 682c 2065 7272 6f72 5f6d 6573 7361  ath, error_messa
+0000dfe0: 6765 290a 2020 2020 2020 2020 7265 7475  ge).        retu
+0000dff0: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
+0000e000: 7363 6865 6d61 732e 4261 636b 6772 6f75  schemas.Backgrou
+0000e010: 6e64 5461 736b 282a 2a72 6573 706f 6e73  ndTask(**respons
+0000e020: 652e 6a73 6f6e 2829 290a 0a20 2020 2064  e.json())..    d
+0000e030: 6566 2067 6574 5f62 6163 6b67 726f 756e  ef get_backgroun
+0000e040: 645f 7461 736b 2873 656c 662c 206e 616d  d_task(self, nam
+0000e050: 653a 2073 7472 2920 2d3e 206d 6c72 756e  e: str) -> mlrun
+0000e060: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0000e070: 4261 636b 6772 6f75 6e64 5461 736b 3a0a  BackgroundTask:.
+0000e080: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
+0000e090: 6576 6520 7570 6461 7465 6420 696e 666f  eve updated info
+0000e0a0: 726d 6174 696f 6e20 6f6e 2061 2062 6163  rmation on a bac
+0000e0b0: 6b67 726f 756e 6420 7461 736b 2062 6569  kground task bei
+0000e0c0: 6e67 2065 7865 6375 7465 642e 2222 220a  ng executed.""".
+0000e0d0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0000e0e0: 6622 6261 636b 6772 6f75 6e64 2d74 6173  f"background-tas
+0000e0f0: 6b73 2f7b 6e61 6d65 7d22 0a20 2020 2020  ks/{name}".     
+0000e100: 2020 2065 7272 6f72 5f6d 6573 7361 6765     error_message
+0000e110: 203d 2066 2246 6169 6c65 6420 6765 7474   = f"Failed gett
+0000e120: 696e 6720 6261 636b 6772 6f75 6e64 2074  ing background t
+0000e130: 6173 6b2e 206e 616d 653d 7b6e 616d 657d  ask. name={name}
+0000e140: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
+0000e150: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+0000e160: 6c6c 2822 4745 5422 2c20 7061 7468 2c20  ll("GET", path, 
+0000e170: 6572 726f 725f 6d65 7373 6167 6529 0a20  error_message). 
+0000e180: 2020 2020 2020 2072 6574 7572 6e20 6d6c         return ml
+0000e190: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000e1a0: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
+0000e1b0: 6b28 2a2a 7265 7370 6f6e 7365 2e6a 736f  k(**response.jso
+0000e1c0: 6e28 2929 0a0a 2020 2020 6465 6620 7265  n())..    def re
+0000e1d0: 6d6f 7465 5f73 7461 7475 7328 7365 6c66  mote_status(self
+0000e1e0: 2c20 7072 6f6a 6563 742c 206e 616d 652c  , project, name,
+0000e1f0: 206b 696e 642c 2073 656c 6563 746f 7229   kind, selector)
+0000e200: 3a0a 2020 2020 2020 2020 2222 2252 6574  :.        """Ret
+0000e210: 7269 6576 6520 7374 6174 7573 206f 6620  rieve status of 
+0000e220: 6120 6675 6e63 7469 6f6e 2062 6569 6e67  a function being
+0000e230: 2065 7865 6375 7465 6420 7265 6d6f 7465   executed remote
+0000e240: 6c79 2028 7265 6c65 7661 6e74 2074 6f20  ly (relevant to 
+0000e250: 6060 6461 736b 6060 2066 756e 6374 696f  ``dask`` functio
+0000e260: 6e73 292e 0a0a 2020 2020 2020 2020 3a70  ns)...        :p
+0000e270: 6172 616d 2070 726f 6a65 6374 3a20 5468  aram project: Th
+0000e280: 6520 7072 6f6a 6563 7420 6f66 2074 6865  e project of the
+0000e290: 2066 756e 6374 696f 6e0a 2020 2020 2020   function.      
+0000e2a0: 2020 3a70 6172 616d 206e 616d 653a 2054    :param name: T
+0000e2b0: 6865 206e 616d 6520 6f66 2074 6865 2066  he name of the f
+0000e2c0: 756e 6374 696f 6e0a 2020 2020 2020 2020  unction.        
+0000e2d0: 3a70 6172 616d 206b 696e 643a 2054 6865  :param kind: The
+0000e2e0: 206b 696e 6420 6f66 2074 6865 2066 756e   kind of the fun
+0000e2f0: 6374 696f 6e2c 2063 7572 7265 6e74 6c79  ction, currently
+0000e300: 2060 6064 6173 6b60 6020 6973 2073 7570   ``dask`` is sup
+0000e310: 706f 7274 6564 2e0a 2020 2020 2020 2020  ported..        
+0000e320: 3a70 6172 616d 2073 656c 6563 746f 723a  :param selector:
+0000e330: 2053 656c 6563 746f 7220 636c 6175 7365   Selector clause
+0000e340: 2074 6f20 6265 2061 7070 6c69 6564 2074   to be applied t
+0000e350: 6f20 7468 6520 4b75 6265 726e 6574 6573  o the Kubernetes
+0000e360: 2073 7461 7475 7320 7175 6572 7920 746f   status query to
+0000e370: 2066 696c 7465 7220 7468 6520 7265 7375   filter the resu
+0000e380: 6c74 732e 0a20 2020 2020 2020 2022 2222  lts..        """
+0000e390: 0a0a 2020 2020 2020 2020 7472 793a 0a20  ..        try:. 
+0000e3a0: 2020 2020 2020 2020 2020 2072 6571 203d             req =
+0000e3b0: 207b 226b 696e 6422 3a20 6b69 6e64 2c20   {"kind": kind, 
+0000e3c0: 2273 656c 6563 746f 7222 3a20 7365 6c65  "selector": sele
+0000e3d0: 6374 6f72 2c20 2270 726f 6a65 6374 223a  ctor, "project":
+0000e3e0: 2070 726f 6a65 6374 2c20 226e 616d 6522   project, "name"
+0000e3f0: 3a20 6e61 6d65 7d0a 2020 2020 2020 2020  : name}.        
+0000e400: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+0000e410: 6170 695f 6361 6c6c 2822 504f 5354 222c  api_call("POST",
+0000e420: 2022 7374 6174 7573 2f66 756e 6374 696f   "status/functio
+0000e430: 6e22 2c20 6a73 6f6e 3d72 6571 290a 2020  n", json=req).  
+0000e440: 2020 2020 2020 6578 6365 7074 204f 5345        except OSE
+0000e450: 7272 6f72 2061 7320 6572 723a 0a20 2020  rror as err:.   
+0000e460: 2020 2020 2020 2020 206c 6f67 6765 722e           logger.
+0000e470: 6572 726f 7228 6622 6572 726f 7220 7374  error(f"error st
+0000e480: 6172 7469 6e67 2066 756e 6374 696f 6e3a  arting function:
+0000e490: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
+0000e4a0: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
+0000e4b0: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
+0000e4c0: 2265 7272 6f72 3a20 6361 6e6e 6f74 2073  "error: cannot s
+0000e4d0: 7461 7274 2066 756e 6374 696f 6e2c 207b  tart function, {
+0000e4e0: 6572 725f 746f 5f73 7472 2865 7272 297d  err_to_str(err)}
+0000e4f0: 2229 0a0a 2020 2020 2020 2020 6966 206e  ")..        if n
+0000e500: 6f74 2072 6573 702e 6f6b 3a0a 2020 2020  ot resp.ok:.    
+0000e510: 2020 2020 2020 2020 6c6f 6767 6572 2e65          logger.e
+0000e520: 7272 6f72 2866 2262 6164 2072 6573 7021  rror(f"bad resp!
+0000e530: 215c 6e7b 7265 7370 2e74 6578 747d 2229  !\n{resp.text}")
+0000e540: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+0000e550: 7365 2056 616c 7565 4572 726f 7228 2262  se ValueError("b
+0000e560: 6164 2066 756e 6374 696f 6e20 7374 6174  ad function stat
+0000e570: 7573 2072 6573 706f 6e73 6522 290a 0a20  us response").. 
+0000e580: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+0000e590: 7370 2e6a 736f 6e28 295b 2264 6174 6122  sp.json()["data"
+0000e5a0: 5d0a 0a20 2020 2064 6566 2073 7562 6d69  ]..    def submi
+0000e5b0: 745f 6a6f 6228 0a20 2020 2020 2020 2073  t_job(.        s
+0000e5c0: 656c 662c 0a20 2020 2020 2020 2072 756e  elf,.        run
+0000e5d0: 7370 6563 2c0a 2020 2020 2020 2020 7363  spec,.        sc
+0000e5e0: 6865 6475 6c65 3a20 556e 696f 6e5b 7374  hedule: Union[st
+0000e5f0: 722c 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  r, mlrun.common.
+0000e600: 7363 6865 6d61 732e 5363 6865 6475 6c65  schemas.Schedule
+0000e610: 4372 6f6e 5472 6967 6765 725d 203d 204e  CronTrigger] = N
+0000e620: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
+0000e630: 2020 2020 2222 2253 7562 6d69 7420 6120      """Submit a 
+0000e640: 6a6f 6220 666f 7220 7265 6d6f 7465 2065  job for remote e
+0000e650: 7865 6375 7469 6f6e 2e0a 0a20 2020 2020  xecution...     
+0000e660: 2020 203a 7061 7261 6d20 7275 6e73 7065     :param runspe
+0000e670: 633a 2054 6865 2072 756e 7469 6d65 206f  c: The runtime o
+0000e680: 626a 6563 7420 7370 6563 2028 5461 736b  bject spec (Task
+0000e690: 2920 746f 2065 7865 6375 7465 2e0a 2020  ) to execute..  
+0000e6a0: 2020 2020 2020 3a70 6172 616d 2073 6368        :param sch
+0000e6b0: 6564 756c 653a 2057 6865 7468 6572 2074  edule: Whether t
+0000e6c0: 6f20 7363 6865 6475 6c65 2074 6869 7320  o schedule this 
+0000e6d0: 6a6f 6220 7573 696e 6720 6120 4372 6f6e  job using a Cron
+0000e6e0: 2074 7269 6767 6572 2e20 4966 206e 6f74   trigger. If not
+0000e6f0: 2073 7065 6369 6669 6564 2c20 7468 6520   specified, the 
+0000e700: 6a6f 6220 7769 6c6c 2062 6520 7375 626d  job will be subm
+0000e710: 6974 7465 640a 2020 2020 2020 2020 2020  itted.          
+0000e720: 2020 696d 6d65 6469 6174 656c 792e 0a20    immediately.. 
+0000e730: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000e740: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
+0000e750: 2020 2020 2072 6571 203d 207b 2274 6173       req = {"tas
+0000e760: 6b22 3a20 7275 6e73 7065 632e 746f 5f64  k": runspec.to_d
+0000e770: 6963 7428 297d 0a20 2020 2020 2020 2020  ict()}.         
+0000e780: 2020 2069 6620 7363 6865 6475 6c65 3a0a     if schedule:.
+0000e790: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000e7a0: 6966 2069 7369 6e73 7461 6e63 6528 7363  if isinstance(sc
+0000e7b0: 6865 6475 6c65 2c20 6d6c 7275 6e2e 636f  hedule, mlrun.co
+0000e7c0: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6368  mmon.schemas.Sch
+0000e7d0: 6564 756c 6543 726f 6e54 7269 6767 6572  eduleCronTrigger
+0000e7e0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0000e7f0: 2020 2020 2020 2073 6368 6564 756c 6520         schedule 
+0000e800: 3d20 7363 6865 6475 6c65 2e64 6963 7428  = schedule.dict(
+0000e810: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000e820: 2020 7265 715b 2273 6368 6564 756c 6522    req["schedule"
+0000e830: 5d20 3d20 7363 6865 6475 6c65 0a20 2020  ] = schedule.   
+0000e840: 2020 2020 2020 2020 2074 696d 656f 7574           timeout
+0000e850: 203d 2028 696e 7428 636f 6e66 6967 2e73   = (int(config.s
+0000e860: 7562 6d69 745f 7469 6d65 6f75 7429 206f  ubmit_timeout) o
+0000e870: 7220 3132 3029 202b 2032 300a 2020 2020  r 120) + 20.    
+0000e880: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+0000e890: 656c 662e 6170 695f 6361 6c6c 2822 504f  elf.api_call("PO
+0000e8a0: 5354 222c 2022 7375 626d 6974 5f6a 6f62  ST", "submit_job
+0000e8b0: 222c 206a 736f 6e3d 7265 712c 2074 696d  ", json=req, tim
+0000e8c0: 656f 7574 3d74 696d 656f 7574 290a 0a20  eout=timeout).. 
+0000e8d0: 2020 2020 2020 2065 7863 6570 7420 7265         except re
+0000e8e0: 7175 6573 7473 2e48 5454 5045 7272 6f72  quests.HTTPError
+0000e8f0: 2061 7320 6572 723a 0a20 2020 2020 2020   as err:.       
+0000e900: 2020 2020 206c 6f67 6765 722e 6572 726f       logger.erro
+0000e910: 7228 6622 6572 726f 7220 7375 626d 6974  r(f"error submit
+0000e920: 7469 6e67 2074 6173 6b3a 207b 6572 725f  ting task: {err_
+0000e930: 746f 5f73 7472 2865 7272 297d 2229 0a20  to_str(err)}"). 
+0000e940: 2020 2020 2020 2020 2020 2023 206e 6f74             # not
+0000e950: 2063 7265 6174 696e 6720 6120 6e65 7720   creating a new 
+0000e960: 6578 6365 7074 696f 6e20 6865 7265 2c20  exception here, 
+0000e970: 696e 206f 7264 6572 2074 6f20 6b65 6570  in order to keep
+0000e980: 2074 6865 2072 6573 706f 6e73 6520 616e   the response an
+0000e990: 6420 7374 6174 7573 2063 6f64 6520 696e  d status code in
+0000e9a0: 2074 6865 2065 7863 6570 7469 6f6e 0a20   the exception. 
+0000e9b0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000e9c0: 0a0a 2020 2020 2020 2020 6578 6365 7074  ..        except
+0000e9d0: 204f 5345 7272 6f72 2061 7320 6572 723a   OSError as err:
+0000e9e0: 0a20 2020 2020 2020 2020 2020 206c 6f67  .            log
+0000e9f0: 6765 722e 6572 726f 7228 6622 6572 726f  ger.error(f"erro
+0000ea00: 7220 7375 626d 6974 7469 6e67 2074 6173  r submitting tas
+0000ea10: 6b3a 207b 6572 725f 746f 5f73 7472 2865  k: {err_to_str(e
+0000ea20: 7272 297d 2229 0a20 2020 2020 2020 2020  rr)}").         
+0000ea30: 2020 2072 6169 7365 204f 5345 7272 6f72     raise OSError
+0000ea40: 2822 6572 726f 723a 2063 616e 6e6f 7420  ("error: cannot 
+0000ea50: 7375 626d 6974 2074 6173 6b22 2920 6672  submit task") fr
+0000ea60: 6f6d 2065 7272 0a0a 2020 2020 2020 2020  om err..        
+0000ea70: 6966 206e 6f74 2072 6573 702e 6f6b 3a0a  if not resp.ok:.
+0000ea80: 2020 2020 2020 2020 2020 2020 6c6f 6767              logg
+0000ea90: 6572 2e65 7272 6f72 2866 2262 6164 2072  er.error(f"bad r
+0000eaa0: 6573 7021 215c 6e7b 7265 7370 2e74 6578  esp!!\n{resp.tex
+0000eab0: 747d 2229 0a20 2020 2020 2020 2020 2020  t}").           
+0000eac0: 2072 6169 7365 2056 616c 7565 4572 726f   raise ValueErro
+0000ead0: 7228 6622 6261 6420 6675 6e63 7469 6f6e  r(f"bad function
+0000eae0: 2072 756e 2072 6573 706f 6e73 652c 207b   run response, {
+0000eaf0: 7265 7370 2e74 6578 747d 2229 0a0a 2020  resp.text}")..  
+0000eb00: 2020 2020 2020 7265 7370 203d 2072 6573        resp = res
+0000eb10: 702e 6a73 6f6e 2829 0a20 2020 2020 2020  p.json().       
+0000eb20: 2072 6574 7572 6e20 7265 7370 5b22 6461   return resp["da
+0000eb30: 7461 225d 0a0a 2020 2020 6465 6620 7375  ta"]..    def su
+0000eb40: 626d 6974 5f70 6970 656c 696e 6528 0a20  bmit_pipeline(. 
+0000eb50: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0000eb60: 2020 2020 2070 726f 6a65 6374 2c0a 2020       project,.  
+0000eb70: 2020 2020 2020 7069 7065 6c69 6e65 2c0a        pipeline,.
+0000eb80: 2020 2020 2020 2020 6172 6775 6d65 6e74          argument
+0000eb90: 733d 4e6f 6e65 2c0a 2020 2020 2020 2020  s=None,.        
+0000eba0: 6578 7065 7269 6d65 6e74 3d4e 6f6e 652c  experiment=None,
+0000ebb0: 0a20 2020 2020 2020 2072 756e 3d4e 6f6e  .        run=Non
+0000ebc0: 652c 0a20 2020 2020 2020 206e 616d 6573  e,.        names
+0000ebd0: 7061 6365 3d4e 6f6e 652c 0a20 2020 2020  pace=None,.     
+0000ebe0: 2020 2061 7274 6966 6163 745f 7061 7468     artifact_path
+0000ebf0: 3d4e 6f6e 652c 0a20 2020 2020 2020 206f  =None,.        o
+0000ec00: 7073 3d4e 6f6e 652c 0a20 2020 2020 2020  ps=None,.       
+0000ec10: 2023 2054 4f44 4f3a 2064 6570 7265 6361   # TODO: depreca
+0000ec20: 7465 642c 2072 656d 6f76 6520 696e 2031  ted, remove in 1
+0000ec30: 2e35 2e30 0a20 2020 2020 2020 2074 746c  .5.0.        ttl
+0000ec40: 3d4e 6f6e 652c 0a20 2020 2020 2020 2063  =None,.        c
+0000ec50: 6c65 616e 7570 5f74 746c 3d4e 6f6e 652c  leanup_ttl=None,
+0000ec60: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
+0000ec70: 2222 2253 7562 6d69 7420 6120 4b46 5020  """Submit a KFP 
+0000ec80: 7069 7065 6c69 6e65 2066 6f72 2065 7865  pipeline for exe
+0000ec90: 6375 7469 6f6e 2e0a 0a20 2020 2020 2020  cution...       
+0000eca0: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+0000ecb0: 2054 6865 2070 726f 6a65 6374 206f 6620   The project of 
+0000ecc0: 7468 6520 7069 7065 6c69 6e65 0a20 2020  the pipeline.   
+0000ecd0: 2020 2020 203a 7061 7261 6d20 7069 7065       :param pipe
+0000ece0: 6c69 6e65 3a20 5069 7065 6c69 6e65 2066  line: Pipeline f
+0000ecf0: 756e 6374 696f 6e20 6f72 2070 6174 6820  unction or path 
+0000ed00: 746f 202e 7961 6d6c 2f2e 7a69 7020 7069  to .yaml/.zip pi
+0000ed10: 7065 6c69 6e65 2066 696c 652e 0a20 2020  peline file..   
+0000ed20: 2020 2020 203a 7061 7261 6d20 6172 6775       :param argu
+0000ed30: 6d65 6e74 733a 2041 2064 6963 7469 6f6e  ments: A diction
+0000ed40: 6172 7920 6f66 2061 7267 756d 656e 7473  ary of arguments
+0000ed50: 2074 6f20 7061 7373 2074 6f20 7468 6520   to pass to the 
+0000ed60: 7069 7065 6c69 6e65 2e0a 2020 2020 2020  pipeline..      
+0000ed70: 2020 3a70 6172 616d 2065 7870 6572 696d    :param experim
+0000ed80: 656e 743a 2041 206e 616d 6520 746f 2061  ent: A name to a
+0000ed90: 7373 6967 6e20 666f 7220 7468 6520 7370  ssign for the sp
+0000eda0: 6563 6966 6963 2065 7870 6572 696d 656e  ecific experimen
+0000edb0: 742e 0a20 2020 2020 2020 203a 7061 7261  t..        :para
+0000edc0: 6d20 7275 6e3a 2041 206e 616d 6520 666f  m run: A name fo
+0000edd0: 7220 7468 6973 2073 7065 6369 6669 6320  r this specific 
+0000ede0: 7275 6e2e 0a20 2020 2020 2020 203a 7061  run..        :pa
+0000edf0: 7261 6d20 6e61 6d65 7370 6163 653a 204b  ram namespace: K
+0000ee00: 7562 6572 6e65 7465 7320 6e61 6d65 7370  ubernetes namesp
+0000ee10: 6163 6520 746f 2065 7865 6375 7465 2074  ace to execute t
+0000ee20: 6865 2070 6970 656c 696e 6520 696e 2e0a  he pipeline in..
+0000ee30: 2020 2020 2020 2020 3a70 6172 616d 2061          :param a
+0000ee40: 7274 6966 6163 745f 7061 7468 3a20 4120  rtifact_path: A 
+0000ee50: 7061 7468 2074 6f20 6172 7469 6661 6374  path to artifact
+0000ee60: 7320 7573 6564 2062 7920 7468 6973 2070  s used by this p
+0000ee70: 6970 656c 696e 652e 0a20 2020 2020 2020  ipeline..       
+0000ee80: 203a 7061 7261 6d20 6f70 733a 2054 7261   :param ops: Tra
+0000ee90: 6e73 666f 726d 6572 7320 746f 2061 7070  nsformers to app
+0000eea0: 6c79 206f 6e20 616c 6c20 6f70 7320 696e  ly on all ops in
+0000eeb0: 2074 6865 2070 6970 656c 696e 652e 0a20   the pipeline.. 
+0000eec0: 2020 2020 2020 203a 7061 7261 6d20 7474         :param tt
+0000eed0: 6c3a 2070 6970 656c 696e 6520 636c 6561  l: pipeline clea
+0000eee0: 6e75 7020 7474 6c20 696e 2073 6563 7320  nup ttl in secs 
+0000eef0: 2874 696d 6520 746f 2077 6169 7420 6166  (time to wait af
+0000ef00: 7465 7220 776f 726b 666c 6f77 2063 6f6d  ter workflow com
+0000ef10: 706c 6574 696f 6e2c 2061 7420 7768 6963  pletion, at whic
+0000ef20: 6820 706f 696e 7420 7468 6520 776f 726b  h point the work
+0000ef30: 666c 6f77 0a20 2020 2020 2020 2020 2020  flow.           
+0000ef40: 2020 2020 2020 2020 2061 6e64 2061 6c6c           and all
+0000ef50: 2069 7473 2072 6573 6f75 7263 6573 2061   its resources a
+0000ef60: 7265 2064 656c 6574 6564 2920 2864 6570  re deleted) (dep
+0000ef70: 7265 6361 7465 642c 2075 7365 2063 6c65  recated, use cle
+0000ef80: 616e 7570 5f74 746c 2069 6e73 7465 6164  anup_ttl instead
+0000ef90: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+0000efa0: 2063 6c65 616e 7570 5f74 746c 3a20 7069   cleanup_ttl: pi
+0000efb0: 7065 6c69 6e65 2063 6c65 616e 7570 2074  peline cleanup t
+0000efc0: 746c 2069 6e20 7365 6373 2028 7469 6d65  tl in secs (time
+0000efd0: 2074 6f20 7761 6974 2061 6674 6572 2077   to wait after w
+0000efe0: 6f72 6b66 6c6f 7720 636f 6d70 6c65 7469  orkflow completi
+0000eff0: 6f6e 2c20 6174 2077 6869 6368 2070 6f69  on, at which poi
+0000f000: 6e74 2074 6865 0a20 2020 2020 2020 2020  nt the.         
+0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f020: 2020 2077 6f72 6b66 6c6f 7720 616e 6420     workflow and 
+0000f030: 616c 6c20 6974 7320 7265 736f 7572 6365  all its resource
+0000f040: 7320 6172 6520 6465 6c65 7465 6429 0a20  s are deleted). 
+0000f050: 2020 2020 2020 2022 2222 0a0a 2020 2020         """..    
+0000f060: 2020 2020 6966 2074 746c 3a0a 2020 2020      if ttl:.    
+0000f070: 2020 2020 2020 2020 7761 726e 696e 6773          warnings
+0000f080: 2e77 6172 6e28 0a20 2020 2020 2020 2020  .warn(.         
+0000f090: 2020 2020 2020 2022 2774 746c 2720 6973         "'ttl' is
+0000f0a0: 2064 6570 7265 6361 7465 642c 2075 7365   deprecated, use
+0000f0b0: 2027 636c 6561 6e75 705f 7474 6c27 2069   'cleanup_ttl' i
+0000f0c0: 6e73 7465 6164 2e20 220a 2020 2020 2020  nstead. ".      
+0000f0d0: 2020 2020 2020 2020 2020 2254 6869 7320            "This 
+0000f0e0: 7769 6c6c 2062 6520 7265 6d6f 7665 6420  will be removed 
+0000f0f0: 696e 2031 2e35 2e30 222c 0a20 2020 2020  in 1.5.0",.     
+0000f100: 2020 2020 2020 2020 2020 2023 2054 4f44             # TOD
+0000f110: 4f3a 2052 656d 6f76 6520 7468 6973 2069  O: Remove this i
+0000f120: 6e20 312e 352e 300a 2020 2020 2020 2020  n 1.5.0.        
+0000f130: 2020 2020 2020 2020 4675 7475 7265 5761          FutureWa
+0000f140: 726e 696e 672c 0a20 2020 2020 2020 2020  rning,.         
+0000f150: 2020 2029 0a0a 2020 2020 2020 2020 6966     )..        if
+0000f160: 2069 7369 6e73 7461 6e63 6528 7069 7065   isinstance(pipe
+0000f170: 6c69 6e65 2c20 7374 7229 3a0a 2020 2020  line, str):.    
+0000f180: 2020 2020 2020 2020 7069 7065 5f66 696c          pipe_fil
+0000f190: 6520 3d20 7069 7065 6c69 6e65 0a20 2020  e = pipeline.   
+0000f1a0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0000f1b0: 2020 2020 2020 2070 6970 655f 6669 6c65         pipe_file
+0000f1c0: 203d 2074 656d 7066 696c 652e 4e61 6d65   = tempfile.Name
+0000f1d0: 6454 656d 706f 7261 7279 4669 6c65 2873  dTemporaryFile(s
+0000f1e0: 7566 6669 783d 222e 7961 6d6c 222c 2064  uffix=".yaml", d
+0000f1f0: 656c 6574 653d 4661 6c73 6529 2e6e 616d  elete=False).nam
+0000f200: 650a 2020 2020 2020 2020 2020 2020 636f  e.            co
+0000f210: 6e66 203d 206e 6577 5f70 6970 655f 6d65  nf = new_pipe_me
+0000f220: 7461 6461 7461 280a 2020 2020 2020 2020  tadata(.        
+0000f230: 2020 2020 2020 2020 6172 7469 6661 6374          artifact
+0000f240: 5f70 6174 683d 6172 7469 6661 6374 5f70  _path=artifact_p
+0000f250: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0000f260: 2020 2020 2063 6c65 616e 7570 5f74 746c       cleanup_ttl
+0000f270: 3d63 6c65 616e 7570 5f74 746c 206f 7220  =cleanup_ttl or 
+0000f280: 7474 6c2c 0a20 2020 2020 2020 2020 2020  ttl,.           
+0000f290: 2020 2020 206f 705f 7472 616e 7366 6f72       op_transfor
+0000f2a0: 6d65 7273 3d6f 7073 2c0a 2020 2020 2020  mers=ops,.      
+0000f2b0: 2020 2020 2020 290a 2020 2020 2020 2020        ).        
+0000f2c0: 2020 2020 6b66 702e 636f 6d70 696c 6572      kfp.compiler
+0000f2d0: 2e43 6f6d 7069 6c65 7228 292e 636f 6d70  .Compiler().comp
+0000f2e0: 696c 6528 0a20 2020 2020 2020 2020 2020  ile(.           
+0000f2f0: 2020 2020 2070 6970 656c 696e 652c 2070       pipeline, p
+0000f300: 6970 655f 6669 6c65 2c20 7479 7065 5f63  ipe_file, type_c
+0000f310: 6865 636b 3d46 616c 7365 2c20 7069 7065  heck=False, pipe
+0000f320: 6c69 6e65 5f63 6f6e 663d 636f 6e66 0a20  line_conf=conf. 
+0000f330: 2020 2020 2020 2020 2020 2029 0a0a 2020             )..  
+0000f340: 2020 2020 2020 6966 2070 6970 655f 6669        if pipe_fi
+0000f350: 6c65 2e65 6e64 7377 6974 6828 222e 7961  le.endswith(".ya
+0000f360: 6d6c 2229 3a0a 2020 2020 2020 2020 2020  ml"):.          
+0000f370: 2020 6865 6164 6572 7320 3d20 7b22 636f    headers = {"co
+0000f380: 6e74 656e 742d 7479 7065 223a 2022 6170  ntent-type": "ap
+0000f390: 706c 6963 6174 696f 6e2f 7961 6d6c 227d  plication/yaml"}
+0000f3a0: 0a20 2020 2020 2020 2065 6c69 6620 7069  .        elif pi
+0000f3b0: 7065 5f66 696c 652e 656e 6473 7769 7468  pe_file.endswith
+0000f3c0: 2822 2e7a 6970 2229 3a0a 2020 2020 2020  (".zip"):.      
+0000f3d0: 2020 2020 2020 6865 6164 6572 7320 3d20        headers = 
+0000f3e0: 7b22 636f 6e74 656e 742d 7479 7065 223a  {"content-type":
+0000f3f0: 2022 6170 706c 6963 6174 696f 6e2f 7a69   "application/zi
+0000f400: 7022 7d0a 2020 2020 2020 2020 656c 7365  p"}.        else
+0000f410: 3a0a 2020 2020 2020 2020 2020 2020 7261  :.            ra
+0000f420: 6973 6520 5661 6c75 6545 7272 6f72 2822  ise ValueError("
+0000f430: 7069 7065 6c69 6e65 2066 696c 6520 6d75  pipeline file mu
+0000f440: 7374 2062 6520 2e79 616d 6c20 6f72 202e  st be .yaml or .
+0000f450: 7a69 7022 290a 2020 2020 2020 2020 6966  zip").        if
+0000f460: 2061 7267 756d 656e 7473 3a0a 2020 2020   arguments:.    
+0000f470: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
+0000f480: 7369 6e73 7461 6e63 6528 6172 6775 6d65  sinstance(argume
+0000f490: 6e74 732c 2064 6963 7429 3a0a 2020 2020  nts, dict):.    
+0000f4a0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+0000f4b0: 6520 5661 6c75 6545 7272 6f72 2822 6172  e ValueError("ar
+0000f4c0: 6775 6d65 6e74 7320 6d75 7374 2062 6520  guments must be 
+0000f4d0: 6469 6374 2074 7970 6522 290a 2020 2020  dict type").    
+0000f4e0: 2020 2020 2020 2020 6865 6164 6572 735b          headers[
+0000f4f0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0000f500: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
+0000f510: 2e70 6970 656c 696e 655f 6172 6775 6d65  .pipeline_argume
+0000f520: 6e74 735d 203d 2073 7472 280a 2020 2020  nts] = str(.    
+0000f530: 2020 2020 2020 2020 2020 2020 6172 6775              argu
+0000f540: 6d65 6e74 730a 2020 2020 2020 2020 2020  ments.          
+0000f550: 2020 290a 0a20 2020 2020 2020 2069 6620    )..        if 
+0000f560: 6e6f 7420 7061 7468 2e69 7366 696c 6528  not path.isfile(
+0000f570: 7069 7065 5f66 696c 6529 3a0a 2020 2020  pipe_file):.    
+0000f580: 2020 2020 2020 2020 7261 6973 6520 4f53          raise OS
+0000f590: 4572 726f 7228 6622 6669 6c65 207b 7069  Error(f"file {pi
+0000f5a0: 7065 5f66 696c 657d 2064 6f65 736e 7420  pe_file} doesnt 
+0000f5b0: 6578 6973 7422 290a 2020 2020 2020 2020  exist").        
+0000f5c0: 7769 7468 206f 7065 6e28 7069 7065 5f66  with open(pipe_f
+0000f5d0: 696c 652c 2022 7262 2229 2061 7320 6670  ile, "rb") as fp
+0000f5e0: 3a0a 2020 2020 2020 2020 2020 2020 6461  :.            da
+0000f5f0: 7461 203d 2066 702e 7265 6164 2829 0a20  ta = fp.read(). 
+0000f600: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000f610: 696e 7374 616e 6365 2870 6970 656c 696e  instance(pipelin
+0000f620: 652c 2073 7472 293a 0a20 2020 2020 2020  e, str):.       
+0000f630: 2020 2020 2072 656d 6f76 6528 7069 7065       remove(pipe
+0000f640: 5f66 696c 6529 0a0a 2020 2020 2020 2020  _file)..        
+0000f650: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+0000f660: 2070 6172 616d 7320 3d20 7b22 6e61 6d65   params = {"name
+0000f670: 7370 6163 6522 3a20 6e61 6d65 7370 6163  space": namespac
+0000f680: 652c 2022 6578 7065 7269 6d65 6e74 223a  e, "experiment":
+0000f690: 2065 7870 6572 696d 656e 742c 2022 7275   experiment, "ru
+0000f6a0: 6e22 3a20 7275 6e7d 0a20 2020 2020 2020  n": run}.       
+0000f6b0: 2020 2020 2072 6573 7020 3d20 7365 6c66       resp = self
+0000f6c0: 2e61 7069 5f63 616c 6c28 0a20 2020 2020  .api_call(.     
+0000f6d0: 2020 2020 2020 2020 2020 2022 504f 5354             "POST
+0000f6e0: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0000f6f0: 2020 2066 2270 726f 6a65 6374 732f 7b70     f"projects/{p
+0000f700: 726f 6a65 6374 7d2f 7069 7065 6c69 6e65  roject}/pipeline
+0000f710: 7322 2c0a 2020 2020 2020 2020 2020 2020  s",.            
+0000f720: 2020 2020 7061 7261 6d73 3d70 6172 616d      params=param
+0000f730: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+0000f740: 2020 2074 696d 656f 7574 3d32 302c 0a20     timeout=20,. 
+0000f750: 2020 2020 2020 2020 2020 2020 2020 2062                 b
+0000f760: 6f64 793d 6461 7461 2c0a 2020 2020 2020  ody=data,.      
+0000f770: 2020 2020 2020 2020 2020 6865 6164 6572            header
+0000f780: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
+0000f790: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0000f7a0: 2065 7863 6570 7420 4f53 4572 726f 7220   except OSError 
+0000f7b0: 6173 2065 7272 3a0a 2020 2020 2020 2020  as err:.        
+0000f7c0: 2020 2020 6c6f 6767 6572 2e65 7272 6f72      logger.error
+0000f7d0: 2866 2265 7272 6f72 2063 616e 6e6f 7420  (f"error cannot 
+0000f7e0: 7375 626d 6974 2070 6970 656c 696e 653a  submit pipeline:
+0000f7f0: 207b 6572 725f 746f 5f73 7472 2865 7272   {err_to_str(err
+0000f800: 297d 2229 0a20 2020 2020 2020 2020 2020  )}").           
+0000f810: 2072 6169 7365 204f 5345 7272 6f72 2866   raise OSError(f
+0000f820: 2265 7272 6f72 3a20 6361 6e6e 6f74 2063  "error: cannot c
+0000f830: 616e 6e6f 7420 7375 626d 6974 2070 6970  annot submit pip
+0000f840: 656c 696e 652c 207b 6572 725f 746f 5f73  eline, {err_to_s
+0000f850: 7472 2865 7272 297d 2229 0a0a 2020 2020  tr(err)}")..    
+0000f860: 2020 2020 6966 206e 6f74 2072 6573 702e      if not resp.
+0000f870: 6f6b 3a0a 2020 2020 2020 2020 2020 2020  ok:.            
+0000f880: 6c6f 6767 6572 2e65 7272 6f72 2866 2262  logger.error(f"b
+0000f890: 6164 2072 6573 7021 215c 6e7b 7265 7370  ad resp!!\n{resp
+0000f8a0: 2e74 6578 747d 2229 0a20 2020 2020 2020  .text}").       
+0000f8b0: 2020 2020 2072 6169 7365 2056 616c 7565       raise Value
+0000f8c0: 4572 726f 7228 6622 6261 6420 7375 626d  Error(f"bad subm
+0000f8d0: 6974 2070 6970 656c 696e 6520 7265 7370  it pipeline resp
+0000f8e0: 6f6e 7365 2c20 7b72 6573 702e 7465 7874  onse, {resp.text
+0000f8f0: 7d22 290a 0a20 2020 2020 2020 2072 6573  }")..        res
+0000f900: 7020 3d20 7265 7370 2e6a 736f 6e28 290a  p = resp.json().
+0000f910: 2020 2020 2020 2020 6c6f 6767 6572 2e69          logger.i
+0000f920: 6e66 6f28 6622 7375 626d 6974 7465 6420  nfo(f"submitted 
+0000f930: 7069 7065 6c69 6e65 207b 7265 7370 5b27  pipeline {resp['
+0000f940: 6e61 6d65 275d 7d20 6964 3d7b 7265 7370  name']} id={resp
+0000f950: 5b27 6964 275d 7d22 290a 2020 2020 2020  ['id']}").      
+0000f960: 2020 7265 7475 726e 2072 6573 705b 2269    return resp["i
+0000f970: 6422 5d0a 0a20 2020 2064 6566 206c 6973  d"]..    def lis
+0000f980: 745f 7069 7065 6c69 6e65 7328 0a20 2020  t_pipelines(.   
+0000f990: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+0000f9a0: 2020 2070 726f 6a65 6374 3a20 7374 722c     project: str,
+0000f9b0: 0a20 2020 2020 2020 206e 616d 6573 7061  .        namespa
+0000f9c0: 6365 3a20 7374 7220 3d20 4e6f 6e65 2c0a  ce: str = None,.
+0000f9d0: 2020 2020 2020 2020 736f 7274 5f62 793a          sort_by:
+0000f9e0: 2073 7472 203d 2022 222c 0a20 2020 2020   str = "",.     
+0000f9f0: 2020 2070 6167 655f 746f 6b65 6e3a 2073     page_token: s
+0000fa00: 7472 203d 2022 222c 0a20 2020 2020 2020  tr = "",.       
+0000fa10: 2066 696c 7465 725f 3a20 7374 7220 3d20   filter_: str = 
+0000fa20: 2222 2c0a 2020 2020 2020 2020 666f 726d  "",.        form
+0000fa30: 6174 5f3a 2055 6e69 6f6e 5b0a 2020 2020  at_: Union[.    
+0000fa40: 2020 2020 2020 2020 7374 722c 206d 6c72          str, mlr
+0000fa50: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+0000fa60: 732e 5069 7065 6c69 6e65 7346 6f72 6d61  s.PipelinesForma
+0000fa70: 740a 2020 2020 2020 2020 5d20 3d20 6d6c  t.        ] = ml
+0000fa80: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0000fa90: 6173 2e50 6970 656c 696e 6573 466f 726d  as.PipelinesForm
+0000faa0: 6174 2e6d 6574 6164 6174 615f 6f6e 6c79  at.metadata_only
+0000fab0: 2c0a 2020 2020 2020 2020 7061 6765 5f73  ,.        page_s
+0000fac0: 697a 653a 2069 6e74 203d 204e 6f6e 652c  ize: int = None,
+0000fad0: 0a20 2020 2029 202d 3e20 6d6c 7275 6e2e  .    ) -> mlrun.
+0000fae0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
+0000faf0: 6970 656c 696e 6573 4f75 7470 7574 3a0a  ipelinesOutput:.
+0000fb00: 2020 2020 2020 2020 2222 2252 6574 7269          """Retri
+0000fb10: 6576 6520 6120 6c69 7374 206f 6620 4b46  eve a list of KF
+0000fb20: 5020 7069 7065 6c69 6e65 732e 2054 6869  P pipelines. Thi
+0000fb30: 7320 6675 6e63 7469 6f6e 2063 616e 2062  s function can b
+0000fb40: 6520 696e 766f 6b65 6420 746f 2067 6574  e invoked to get
+0000fb50: 2061 6c6c 2070 6970 656c 696e 6573 2066   all pipelines f
+0000fb60: 726f 6d20 616c 6c20 7072 6f6a 6563 7473  rom all projects
+0000fb70: 2c0a 2020 2020 2020 2020 6279 2073 7065  ,.        by spe
+0000fb80: 6369 6679 696e 6720 6060 7072 6f6a 6563  cifying ``projec
+0000fb90: 743d 2a60 602c 2069 6e20 7768 6963 6820  t=*``, in which 
+0000fba0: 6361 7365 2070 6167 696e 6174 696f 6e20  case pagination 
+0000fbb0: 6361 6e20 6265 2075 7365 6420 616e 6420  can be used and 
+0000fbc0: 7468 6520 7661 7269 6f75 7320 736f 7274  the various sort
+0000fbd0: 696e 6720 616e 6420 7061 6769 6e61 7469  ing and paginati
+0000fbe0: 6f6e 0a20 2020 2020 2020 2070 726f 7065  on.        prope
+0000fbf0: 7274 6965 7320 6361 6e20 6265 2061 7070  rties can be app
+0000fc00: 6c69 6564 2e20 4966 2061 2073 7065 6369  lied. If a speci
+0000fc10: 6669 6320 7072 6f6a 6563 7420 6973 2072  fic project is r
+0000fc20: 6571 7565 7374 6564 2c20 7468 656e 2074  equested, then t
+0000fc30: 6865 2070 6167 696e 6174 696f 6e20 6f70  he pagination op
+0000fc40: 7469 6f6e 7320 6361 6e6e 6f74 2062 650a  tions cannot be.
+0000fc50: 2020 2020 2020 2020 7573 6564 2061 6e64          used and
+0000fc60: 2070 6167 696e 6174 696f 6e20 6973 206e   pagination is n
+0000fc70: 6f74 2061 7070 6c69 6564 2e0a 0a20 2020  ot applied...   
+0000fc80: 2020 2020 203a 7061 7261 6d20 7072 6f6a       :param proj
+0000fc90: 6563 743a 2050 726f 6a65 6374 206e 616d  ect: Project nam
+0000fca0: 652e 2043 616e 2062 6520 6060 2a60 6020  e. Can be ``*`` 
+0000fcb0: 666f 7220 7175 6572 7920 6163 726f 7373  for query across
+0000fcc0: 2061 6c6c 2070 726f 6a65 6374 732e 0a20   all projects.. 
+0000fcd0: 2020 2020 2020 203a 7061 7261 6d20 6e61         :param na
+0000fce0: 6d65 7370 6163 653a 204b 7562 6572 6e65  mespace: Kuberne
+0000fcf0: 7465 7320 6e61 6d65 7370 6163 6520 696e  tes namespace in
+0000fd00: 2077 6869 6368 2074 6865 2070 6970 656c   which the pipel
+0000fd10: 696e 6573 2061 7265 2065 7865 6375 7469  ines are executi
+0000fd20: 6e67 2e0a 2020 2020 2020 2020 3a70 6172  ng..        :par
+0000fd30: 616d 2073 6f72 745f 6279 3a20 4669 656c  am sort_by: Fiel
+0000fd40: 6420 746f 2073 6f72 7420 7468 6520 7265  d to sort the re
+0000fd50: 7375 6c74 7320 6279 2e0a 2020 2020 2020  sults by..      
+0000fd60: 2020 3a70 6172 616d 2070 6167 655f 746f    :param page_to
+0000fd70: 6b65 6e3a 2055 7365 2066 6f72 2070 6167  ken: Use for pag
+0000fd80: 696e 6174 696f 6e2c 2074 6f20 7265 7472  ination, to retr
+0000fd90: 6965 7665 206e 6578 7420 7061 6765 2e0a  ieve next page..
+0000fda0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+0000fdb0: 696c 7465 725f 3a20 4b75 6265 726e 6574  ilter_: Kubernet
+0000fdc0: 6573 2066 696c 7465 7220 746f 2061 7070  es filter to app
+0000fdd0: 6c79 2074 6f20 7468 6520 7175 6572 792c  ly to the query,
+0000fde0: 2063 616e 2062 6520 7573 6564 2074 6f20   can be used to 
+0000fdf0: 6669 6c74 6572 206f 6e20 7370 6563 6966  filter on specif
+0000fe00: 6963 206f 626a 6563 7420 6669 656c 6473  ic object fields
+0000fe10: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0000fe20: 2066 6f72 6d61 745f 3a20 5265 7375 6c74   format_: Result
+0000fe30: 2066 6f72 6d61 742e 2043 616e 2062 6520   format. Can be 
+0000fe40: 6f6e 6520 6f66 3a0a 0a20 2020 2020 2020  one of:..       
+0000fe50: 2020 2020 202d 2060 6066 756c 6c60 6020       - ``full`` 
+0000fe60: 2d20 7265 7475 726e 2074 6865 2066 756c  - return the ful
+0000fe70: 6c20 6f62 6a65 6374 732e 0a20 2020 2020  l objects..     
+0000fe80: 2020 2020 2020 202d 2060 606d 6574 6164         - ``metad
+0000fe90: 6174 615f 6f6e 6c79 6060 2028 6465 6661  ata_only`` (defa
+0000fea0: 756c 7429 202d 2072 6574 7572 6e20 6a75  ult) - return ju
+0000feb0: 7374 206d 6574 6164 6174 6120 6f66 2074  st metadata of t
+0000fec0: 6865 2070 6970 656c 696e 6573 206f 626a  he pipelines obj
+0000fed0: 6563 7473 2e0a 2020 2020 2020 2020 2020  ects..          
+0000fee0: 2020 2d20 6060 6e61 6d65 5f6f 6e6c 7960    - ``name_only`
+0000fef0: 6020 2d20 7265 7475 726e 206a 7573 7420  ` - return just 
+0000ff00: 7468 6520 6e61 6d65 7320 6f66 2074 6865  the names of the
+0000ff10: 2070 6970 656c 696e 6520 6f62 6a65 6374   pipeline object
+0000ff20: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+0000ff30: 6d20 7061 6765 5f73 697a 653a 2053 697a  m page_size: Siz
+0000ff40: 6520 6f66 2061 2073 696e 676c 6520 7061  e of a single pa
+0000ff50: 6765 2077 6865 6e20 6170 706c 7969 6e67  ge when applying
+0000ff60: 2070 6167 696e 6174 696f 6e2e 0a20 2020   pagination..   
+0000ff70: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0000ff80: 2020 6966 2070 726f 6a65 6374 2021 3d20    if project != 
+0000ff90: 222a 2220 616e 6420 2870 6167 655f 746f  "*" and (page_to
+0000ffa0: 6b65 6e20 6f72 2070 6167 655f 7369 7a65  ken or page_size
+0000ffb0: 293a 0a20 2020 2020 2020 2020 2020 2072  ):.            r
+0000ffc0: 6169 7365 206d 6c72 756e 2e65 7272 6f72  aise mlrun.error
+0000ffd0: 732e 4d4c 5275 6e49 6e76 616c 6964 4172  s.MLRunInvalidAr
+0000ffe0: 6775 6d65 6e74 4572 726f 7228 0a20 2020  gumentError(.   
+0000fff0: 2020 2020 2020 2020 2020 2020 2022 4669               "Fi
+00010000: 6c74 6572 696e 6720 6279 2070 726f 6a65  ltering by proje
+00010010: 6374 2063 616e 206e 6f74 2062 6520 7573  ct can not be us
+00010020: 6564 2074 6f67 6574 6865 7220 7769 7468  ed together with
+00010030: 2070 6167 696e 6174 696f 6e22 0a20 2020   pagination".   
+00010040: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+00010050: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+00010060: 2020 2020 2020 2020 2020 226e 616d 6573            "names
+00010070: 7061 6365 223a 206e 616d 6573 7061 6365  pace": namespace
+00010080: 2c0a 2020 2020 2020 2020 2020 2020 2273  ,.            "s
+00010090: 6f72 745f 6279 223a 2073 6f72 745f 6279  ort_by": sort_by
+000100a0: 2c0a 2020 2020 2020 2020 2020 2020 2270  ,.            "p
+000100b0: 6167 655f 746f 6b65 6e22 3a20 7061 6765  age_token": page
+000100c0: 5f74 6f6b 656e 2c0a 2020 2020 2020 2020  _token,.        
+000100d0: 2020 2020 2266 696c 7465 7222 3a20 6669      "filter": fi
+000100e0: 6c74 6572 5f2c 0a20 2020 2020 2020 2020  lter_,.         
+000100f0: 2020 2022 666f 726d 6174 223a 2066 6f72     "format": for
+00010100: 6d61 745f 2c0a 2020 2020 2020 2020 2020  mat_,.          
+00010110: 2020 2270 6167 655f 7369 7a65 223a 2070    "page_size": p
+00010120: 6167 655f 7369 7a65 2c0a 2020 2020 2020  age_size,.      
+00010130: 2020 7d0a 0a20 2020 2020 2020 2065 7272    }..        err
+00010140: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+00010150: 6169 6c65 6420 6c69 7374 696e 6720 7069  ailed listing pi
+00010160: 7065 6c69 6e65 732c 2071 7565 7279 3a20  pelines, query: 
+00010170: 7b70 6172 616d 737d 220a 2020 2020 2020  {params}".      
+00010180: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+00010190: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+000101a0: 2020 2020 2020 2020 2247 4554 222c 2066          "GET", f
+000101b0: 2270 726f 6a65 6374 732f 7b70 726f 6a65  "projects/{proje
+000101c0: 6374 7d2f 7069 7065 6c69 6e65 7322 2c20  ct}/pipelines", 
+000101d0: 6572 726f 725f 6d65 7373 6167 652c 2070  error_message, p
+000101e0: 6172 616d 733d 7061 7261 6d73 0a20 2020  arams=params.   
+000101f0: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+00010200: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
+00010210: 6f6e 2e73 6368 656d 6173 2e50 6970 656c  on.schemas.Pipel
+00010220: 696e 6573 4f75 7470 7574 282a 2a72 6573  inesOutput(**res
+00010230: 706f 6e73 652e 6a73 6f6e 2829 290a 0a20  ponse.json()).. 
+00010240: 2020 2064 6566 2067 6574 5f70 6970 656c     def get_pipel
+00010250: 696e 6528 0a20 2020 2020 2020 2073 656c  ine(.        sel
+00010260: 662c 0a20 2020 2020 2020 2072 756e 5f69  f,.        run_i
+00010270: 643a 2073 7472 2c0a 2020 2020 2020 2020  d: str,.        
+00010280: 6e61 6d65 7370 6163 653a 2073 7472 203d  namespace: str =
+00010290: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
+000102a0: 696d 656f 7574 3a20 696e 7420 3d20 3130  imeout: int = 10
+000102b0: 2c0a 2020 2020 2020 2020 666f 726d 6174  ,.        format
+000102c0: 5f3a 2055 6e69 6f6e 5b0a 2020 2020 2020  _: Union[.      
+000102d0: 2020 2020 2020 7374 722c 206d 6c72 756e        str, mlrun
+000102e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000102f0: 5069 7065 6c69 6e65 7346 6f72 6d61 740a  PipelinesFormat.
+00010300: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
+00010310: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00010320: 2e50 6970 656c 696e 6573 466f 726d 6174  .PipelinesFormat
+00010330: 2e73 756d 6d61 7279 2c0a 2020 2020 2020  .summary,.      
+00010340: 2020 7072 6f6a 6563 743a 2073 7472 203d    project: str =
+00010350: 204e 6f6e 652c 0a20 2020 2029 3a0a 2020   None,.    ):.  
+00010360: 2020 2020 2020 2222 2252 6574 7269 6576        """Retriev
+00010370: 6520 6465 7461 696c 7320 6f66 2061 2073  e details of a s
+00010380: 7065 6369 6669 6320 7069 7065 6c69 6e65  pecific pipeline
+00010390: 2075 7369 6e67 2069 7473 2072 756e 2049   using its run I
+000103a0: 4420 2861 7320 7072 6f76 6964 6564 2077  D (as provided w
+000103b0: 6865 6e20 7468 6520 7069 7065 6c69 6e65  hen the pipeline
+000103c0: 2077 6173 2065 7865 6375 7465 6429 2e22   was executed)."
+000103d0: 2222 0a0a 2020 2020 2020 2020 7061 7261  ""..        para
+000103e0: 6d73 203d 207b 7d0a 2020 2020 2020 2020  ms = {}.        
+000103f0: 6966 206e 616d 6573 7061 6365 3a0a 2020  if namespace:.  
+00010400: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00010410: 5b22 6e61 6d65 7370 6163 6522 5d20 3d20  ["namespace"] = 
+00010420: 6e61 6d65 7370 6163 650a 2020 2020 2020  namespace.      
+00010430: 2020 7061 7261 6d73 5b22 666f 726d 6174    params["format
+00010440: 225d 203d 2066 6f72 6d61 745f 0a20 2020  "] = format_.   
+00010450: 2020 2020 2070 726f 6a65 6374 5f70 6174       project_pat
+00010460: 6820 3d20 7072 6f6a 6563 7420 6966 2070  h = project if p
+00010470: 726f 6a65 6374 2065 6c73 6520 222a 220a  roject else "*".
+00010480: 2020 2020 2020 2020 7265 7370 203d 2073          resp = s
+00010490: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
+000104a0: 2020 2020 2020 2020 2020 2247 4554 222c            "GET",
+000104b0: 0a20 2020 2020 2020 2020 2020 2066 2270  .            f"p
+000104c0: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+000104d0: 5f70 6174 687d 2f70 6970 656c 696e 6573  _path}/pipelines
+000104e0: 2f7b 7275 6e5f 6964 7d22 2c0a 2020 2020  /{run_id}",.    
+000104f0: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
+00010500: 6172 616d 732c 0a20 2020 2020 2020 2020  arams,.         
+00010510: 2020 2074 696d 656f 7574 3d74 696d 656f     timeout=timeo
+00010520: 7574 2c0a 2020 2020 2020 2020 290a 0a20  ut,.        ).. 
+00010530: 2020 2020 2020 2069 6620 6e6f 7420 7265         if not re
+00010540: 7370 2e6f 6b3a 0a20 2020 2020 2020 2020  sp.ok:.         
+00010550: 2020 206c 6f67 6765 722e 6572 726f 7228     logger.error(
+00010560: 6622 6261 6420 7265 7370 2121 5c6e 7b72  f"bad resp!!\n{r
+00010570: 6573 702e 7465 7874 7d22 290a 2020 2020  esp.text}").    
+00010580: 2020 2020 2020 2020 7261 6973 6520 5661          raise Va
+00010590: 6c75 6545 7272 6f72 2866 2262 6164 2067  lueError(f"bad g
+000105a0: 6574 2070 6970 656c 696e 6520 7265 7370  et pipeline resp
+000105b0: 6f6e 7365 2c20 7b72 6573 702e 7465 7874  onse, {resp.text
+000105c0: 7d22 290a 0a20 2020 2020 2020 2072 6574  }")..        ret
+000105d0: 7572 6e20 7265 7370 2e6a 736f 6e28 290a  urn resp.json().
+000105e0: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+000105f0: 6f64 0a20 2020 2064 6566 205f 7265 736f  od.    def _reso
+00010600: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
+00010610: 672c 2075 6964 293a 0a20 2020 2020 2020  g, uid):.       
+00010620: 2069 6620 7569 6420 616e 6420 7461 673a   if uid and tag:
+00010630: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
+00010640: 7365 204d 4c52 756e 496e 7661 6c69 6441  se MLRunInvalidA
+00010650: 7267 756d 656e 7445 7272 6f72 2822 626f  rgumentError("bo
+00010660: 7468 2075 6964 2061 6e64 2074 6167 2077  th uid and tag w
+00010670: 6572 6520 7072 6f76 6964 6564 2229 0a20  ere provided"). 
+00010680: 2020 2020 2020 2072 6574 7572 6e20 7569         return ui
+00010690: 6420 6f72 2074 6167 206f 7220 226c 6174  d or tag or "lat
+000106a0: 6573 7422 0a0a 2020 2020 6465 6620 6372  est"..    def cr
+000106b0: 6561 7465 5f66 6561 7475 7265 5f73 6574  eate_feature_set
+000106c0: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+000106d0: 2020 2020 2020 2020 6665 6174 7572 655f          feature_
+000106e0: 7365 743a 2055 6e69 6f6e 5b64 6963 742c  set: Union[dict,
+000106f0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+00010700: 6865 6d61 732e 4665 6174 7572 6553 6574  hemas.FeatureSet
+00010710: 2c20 4665 6174 7572 6553 6574 5d2c 0a20  , FeatureSet],. 
+00010720: 2020 2020 2020 2070 726f 6a65 6374 3d22         project="
+00010730: 222c 0a20 2020 2020 2020 2076 6572 7369  ",.        versi
+00010740: 6f6e 6564 3d54 7275 652c 0a20 2020 2029  oned=True,.    )
+00010750: 202d 3e20 6469 6374 3a0a 2020 2020 2020   -> dict:.      
+00010760: 2020 2222 2243 7265 6174 6520 6120 6e65    """Create a ne
+00010770: 7720 3a70 793a 636c 6173 733a 607e 6d6c  w :py:class:`~ml
+00010780: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
+00010790: 652e 4665 6174 7572 6553 6574 6020 616e  e.FeatureSet` an
+000107a0: 6420 7361 7665 2069 6e20 7468 6520 3a70  d save in the :p
+000107b0: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
+000107c0: 2e20 5468 650a 2020 2020 2020 2020 6665  . The.        fe
+000107d0: 6174 7572 652d 7365 7420 6d75 7374 206e  ature-set must n
+000107e0: 6f74 2070 7265 7669 6f75 736c 7920 6578  ot previously ex
+000107f0: 6973 7420 696e 2074 6865 2044 422e 0a0a  ist in the DB...
+00010800: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+00010810: 6561 7475 7265 5f73 6574 3a20 5468 6520  eature_set: The 
+00010820: 6e65 7720 3a70 793a 636c 6173 733a 607e  new :py:class:`~
+00010830: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+00010840: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
+00010850: 746f 2063 7265 6174 652e 0a20 2020 2020  to create..     
+00010860: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00010870: 743a 204e 616d 6520 6f66 2070 726f 6a65  t: Name of proje
+00010880: 6374 2074 6869 7320 6665 6174 7572 652d  ct this feature-
+00010890: 7365 7420 6265 6c6f 6e67 7320 746f 2e0a  set belongs to..
+000108a0: 2020 2020 2020 2020 3a70 6172 616d 2076          :param v
+000108b0: 6572 7369 6f6e 6564 3a20 5768 6574 6865  ersioned: Whethe
+000108c0: 7220 746f 206d 6169 6e74 6169 6e20 7665  r to maintain ve
+000108d0: 7273 696f 6e73 2066 6f72 2074 6869 7320  rsions for this 
+000108e0: 6665 6174 7572 652d 7365 742e 2041 6c6c  feature-set. All
+000108f0: 2076 6572 7369 6f6e 7320 6f66 2061 2076   versions of a v
+00010900: 6572 7369 6f6e 6564 206f 626a 6563 740a  ersioned object.
+00010910: 2020 2020 2020 2020 2020 2020 7769 6c6c              will
+00010920: 2062 6520 6b65 7074 2069 6e20 7468 6520   be kept in the 
+00010930: 4442 2061 6e64 2063 616e 2062 6520 7265  DB and can be re
+00010940: 7472 6965 7665 6420 756e 7469 6c20 6578  trieved until ex
+00010950: 706c 6963 6974 6c79 2064 656c 6574 6564  plicitly deleted
+00010960: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
+00010970: 6e73 3a20 5468 6520 3a70 793a 636c 6173  ns: The :py:clas
+00010980: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00010990: 655f 7374 6f72 652e 4665 6174 7572 6553  e_store.FeatureS
+000109a0: 6574 6020 6f62 6a65 6374 2028 6173 2064  et` object (as d
+000109b0: 6963 7429 2e0a 2020 2020 2020 2020 2222  ict)..        ""
+000109c0: 220a 2020 2020 2020 2020 6966 2069 7369  ".        if isi
+000109d0: 6e73 7461 6e63 6528 6665 6174 7572 655f  nstance(feature_
+000109e0: 7365 742c 206d 6c72 756e 2e63 6f6d 6d6f  set, mlrun.commo
+000109f0: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
+00010a00: 6553 6574 293a 0a20 2020 2020 2020 2020  eSet):.         
+00010a10: 2020 2066 6561 7475 7265 5f73 6574 203d     feature_set =
+00010a20: 2066 6561 7475 7265 5f73 6574 2e64 6963   feature_set.dic
+00010a30: 7428 290a 2020 2020 2020 2020 656c 6966  t().        elif
+00010a40: 2069 7369 6e73 7461 6e63 6528 6665 6174   isinstance(feat
+00010a50: 7572 655f 7365 742c 2046 6561 7475 7265  ure_set, Feature
+00010a60: 5365 7429 3a0a 2020 2020 2020 2020 2020  Set):.          
+00010a70: 2020 6665 6174 7572 655f 7365 7420 3d20    feature_set = 
+00010a80: 6665 6174 7572 655f 7365 742e 746f 5f64  feature_set.to_d
+00010a90: 6963 7428 290a 0a20 2020 2020 2020 2070  ict()..        p
+00010aa0: 726f 6a65 6374 203d 2028 0a20 2020 2020  roject = (.     
+00010ab0: 2020 2020 2020 2070 726f 6a65 6374 0a20         project. 
+00010ac0: 2020 2020 2020 2020 2020 206f 7220 6665             or fe
+00010ad0: 6174 7572 655f 7365 745b 226d 6574 6164  ature_set["metad
+00010ae0: 6174 6122 5d2e 6765 7428 2270 726f 6a65  ata"].get("proje
+00010af0: 6374 222c 204e 6f6e 6529 0a20 2020 2020  ct", None).     
+00010b00: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
+00010b10: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+00010b20: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+00010b30: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+00010b40: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
+00010b50: 6561 7475 7265 2d73 6574 7322 0a20 2020  eature-sets".   
+00010b60: 2020 2020 2070 6172 616d 7320 3d20 7b22       params = {"
+00010b70: 7665 7273 696f 6e65 6422 3a20 7665 7273  versioned": vers
+00010b80: 696f 6e65 647d 0a0a 2020 2020 2020 2020  ioned}..        
+00010b90: 6e61 6d65 203d 2066 6561 7475 7265 5f73  name = feature_s
+00010ba0: 6574 5b22 6d65 7461 6461 7461 225d 5b22  et["metadata"]["
+00010bb0: 6e61 6d65 225d 0a20 2020 2020 2020 2065  name"].        e
+00010bc0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+00010bd0: 2246 6169 6c65 6420 6372 6561 7469 6e67  "Failed creating
+00010be0: 2066 6561 7475 7265 2d73 6574 207b 7072   feature-set {pr
+00010bf0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
+00010c00: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00010c10: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+00010c20: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
+00010c30: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+00010c40: 682c 0a20 2020 2020 2020 2020 2020 2065  h,.            e
+00010c50: 7272 6f72 5f6d 6573 7361 6765 2c0a 2020  rror_message,.  
+00010c60: 2020 2020 2020 2020 2020 7061 7261 6d73            params
+00010c70: 3d70 6172 616d 732c 0a20 2020 2020 2020  =params,.       
+00010c80: 2020 2020 2062 6f64 793d 6469 6374 5f74       body=dict_t
+00010c90: 6f5f 6a73 6f6e 2866 6561 7475 7265 5f73  o_json(feature_s
+00010ca0: 6574 292c 0a20 2020 2020 2020 2029 0a20  et),.        ). 
+00010cb0: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00010cc0: 7370 2e6a 736f 6e28 290a 0a20 2020 2064  sp.json()..    d
+00010cd0: 6566 2067 6574 5f66 6561 7475 7265 5f73  ef get_feature_s
+00010ce0: 6574 280a 2020 2020 2020 2020 7365 6c66  et(.        self
+00010cf0: 2c20 6e61 6d65 3a20 7374 722c 2070 726f  , name: str, pro
+00010d00: 6a65 6374 3a20 7374 7220 3d20 2222 2c20  ject: str = "", 
+00010d10: 7461 673a 2073 7472 203d 204e 6f6e 652c  tag: str = None,
+00010d20: 2075 6964 3a20 7374 7220 3d20 4e6f 6e65   uid: str = None
+00010d30: 0a20 2020 2029 202d 3e20 4665 6174 7572  .    ) -> Featur
+00010d40: 6553 6574 3a0a 2020 2020 2020 2020 2222  eSet:.        ""
+00010d50: 2252 6574 7269 6576 6520 6120 7e6d 6c72  "Retrieve a ~mlr
+00010d60: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
+00010d70: 2e46 6561 7475 7265 5365 7460 206f 626a  .FeatureSet` obj
+00010d80: 6563 742e 2049 6620 626f 7468 2060 6074  ect. If both ``t
+00010d90: 6167 6060 2061 6e64 2060 6075 6964 6060  ag`` and ``uid``
+00010da0: 2061 7265 206e 6f74 2073 7065 6369 6669   are not specifi
+00010db0: 6564 2c20 7468 656e 0a20 2020 2020 2020  ed, then.       
+00010dc0: 2074 6865 206f 626a 6563 7420 7461 6767   the object tagg
+00010dd0: 6564 2060 606c 6174 6573 7460 6020 7769  ed ``latest`` wi
+00010de0: 6c6c 2062 6520 7265 7472 6965 7665 642e  ll be retrieved.
+00010df0: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00010e00: 206e 616d 653a 204e 616d 6520 6f66 206f   name: Name of o
+00010e10: 626a 6563 7420 746f 2072 6574 7269 6576  bject to retriev
+00010e20: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00010e30: 6d20 7072 6f6a 6563 743a 2050 726f 6a65  m project: Proje
+00010e40: 6374 2074 6865 2046 6561 7475 7265 5365  ct the FeatureSe
+00010e50: 7420 6265 6c6f 6e67 7320 746f 2e0a 2020  t belongs to..  
+00010e60: 2020 2020 2020 3a70 6172 616d 2074 6167        :param tag
+00010e70: 3a20 5461 6720 6f66 2074 6865 2073 7065  : Tag of the spe
+00010e80: 6369 6669 6320 6f62 6a65 6374 2076 6572  cific object ver
+00010e90: 7369 6f6e 2074 6f20 7265 7472 6965 7665  sion to retrieve
+00010ea0: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00010eb0: 2075 6964 3a20 7569 6420 6f66 2074 6865   uid: uid of the
+00010ec0: 206f 626a 6563 7420 746f 2072 6574 7269   object to retri
+00010ed0: 6576 6520 2863 616e 206f 6e6c 7920 6265  eve (can only be
+00010ee0: 2075 7365 6420 666f 7220 7665 7273 696f   used for versio
+00010ef0: 6e65 6420 6f62 6a65 6374 7329 2e0a 2020  ned objects)..  
+00010f00: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00010f10: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+00010f20: 6a65 6374 206f 7220 636f 6e66 6967 2e64  ject or config.d
+00010f30: 6566 6175 6c74 5f70 726f 6a65 6374 0a20  efault_project. 
+00010f40: 2020 2020 2020 2072 6566 6572 656e 6365         reference
+00010f50: 203d 2073 656c 662e 5f72 6573 6f6c 7665   = self._resolve
+00010f60: 5f72 6566 6572 656e 6365 2874 6167 2c20  _reference(tag, 
+00010f70: 7569 6429 0a20 2020 2020 2020 2070 6174  uid).        pat
+00010f80: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00010f90: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
+00010fa0: 2d73 6574 732f 7b6e 616d 657d 2f72 6566  -sets/{name}/ref
+00010fb0: 6572 656e 6365 732f 7b72 6566 6572 656e  erences/{referen
+00010fc0: 6365 7d22 0a20 2020 2020 2020 2065 7272  ce}".        err
+00010fd0: 6f72 5f6d 6573 7361 6765 203d 2066 2246  or_message = f"F
+00010fe0: 6169 6c65 6420 7265 7472 6965 7669 6e67  ailed retrieving
+00010ff0: 2066 6561 7475 7265 2d73 6574 207b 7072   feature-set {pr
+00011000: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
+00011010: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00011020: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
+00011030: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+00011040: 6573 7361 6765 290a 2020 2020 2020 2020  essage).        
+00011050: 7265 7475 726e 2046 6561 7475 7265 5365  return FeatureSe
+00011060: 742e 6672 6f6d 5f64 6963 7428 7265 7370  t.from_dict(resp
+00011070: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
+00011080: 6620 6c69 7374 5f66 6561 7475 7265 7328  f list_features(
+00011090: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+000110a0: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+000110b0: 7374 722c 0a20 2020 2020 2020 206e 616d  str,.        nam
+000110c0: 653a 2073 7472 203d 204e 6f6e 652c 0a20  e: str = None,. 
+000110d0: 2020 2020 2020 2074 6167 3a20 7374 7220         tag: str 
+000110e0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000110f0: 656e 7469 7469 6573 3a20 4c69 7374 5b73  entities: List[s
+00011100: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00011110: 2020 2020 6c61 6265 6c73 3a20 4c69 7374      labels: List
+00011120: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00011130: 2020 2920 2d3e 204c 6973 745b 6469 6374    ) -> List[dict
+00011140: 5d3a 0a20 2020 2020 2020 2022 2222 4c69  ]:.        """Li
+00011150: 7374 2066 6561 7475 7265 2d73 6574 7320  st feature-sets 
+00011160: 7768 6963 6820 636f 6e74 6169 6e20 7370  which contain sp
+00011170: 6563 6966 6963 2066 6561 7475 7265 732e  ecific features.
+00011180: 2054 6869 7320 6675 6e63 7469 6f6e 206d   This function m
+00011190: 6179 2072 6574 7572 6e20 6d75 6c74 6970  ay return multip
+000111a0: 6c65 2076 6572 7369 6f6e 7320 6f66 2074  le versions of t
+000111b0: 6865 2073 616d 650a 2020 2020 2020 2020  he same.        
+000111c0: 6665 6174 7572 652d 7365 7420 6966 2061  feature-set if a
+000111d0: 2073 7065 6369 6669 6320 7461 6720 6973   specific tag is
+000111e0: 206e 6f74 2072 6571 7565 7374 6564 2e20   not requested. 
+000111f0: 4e6f 7465 2074 6861 7420 7468 6520 7661  Note that the va
+00011200: 7269 6f75 7320 6669 6c74 6572 7320 6f66  rious filters of
+00011210: 2074 6869 7320 6675 6e63 7469 6f6e 2061   this function a
+00011220: 6374 7561 6c6c 790a 2020 2020 2020 2020  ctually.        
+00011230: 7265 6665 7220 746f 2074 6865 2066 6561  refer to the fea
+00011240: 7475 7265 2d73 6574 206f 626a 6563 7420  ture-set object 
+00011250: 636f 6e74 6169 6e69 6e67 2074 6865 2066  containing the f
+00011260: 6561 7475 7265 732c 206e 6f74 2074 6f20  eatures, not to 
+00011270: 7468 6520 6665 6174 7572 6573 2074 6865  the features the
+00011280: 6d73 656c 7665 732e 0a0a 2020 2020 2020  mselves...      
+00011290: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+000112a0: 3a20 5072 6f6a 6563 7420 7768 6963 6820  : Project which 
+000112b0: 636f 6e74 6169 6e73 2074 6865 7365 2066  contains these f
+000112c0: 6561 7475 7265 732e 0a20 2020 2020 2020  eatures..       
+000112d0: 203a 7061 7261 6d20 6e61 6d65 3a20 4e61   :param name: Na
+000112e0: 6d65 206f 6620 7468 6520 6665 6174 7572  me of the featur
+000112f0: 6520 746f 206c 6f6f 6b20 666f 722e 2054  e to look for. T
+00011300: 6865 206e 616d 6520 6973 2075 7365 6420  he name is used 
+00011310: 696e 2061 206c 696b 6520 7175 6572 792c  in a like query,
+00011320: 2061 6e64 2069 7320 6e6f 7420 6361 7365   and is not case
+00011330: 2d73 656e 7369 7469 7665 2e20 466f 720a  -sensitive. For.
+00011340: 2020 2020 2020 2020 2020 2020 6578 616d              exam
+00011350: 706c 652c 206c 6f6f 6b69 6e67 2066 6f72  ple, looking for
+00011360: 2060 6066 6561 7460 6020 7769 6c6c 2072   ``feat`` will r
+00011370: 6574 7572 6e20 6665 6174 7572 6573 2077  eturn features w
+00011380: 6869 6368 2061 7265 206e 616d 6564 2060  hich are named `
+00011390: 604d 7946 6561 7475 7265 6060 2061 7320  `MyFeature`` as 
+000113a0: 7765 6c6c 2061 7320 6060 6465 6665 6174  well as ``defeat
+000113b0: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
+000113c0: 616d 2074 6167 3a20 5265 7475 726e 2066  am tag: Return f
+000113d0: 6561 7475 7265 2d73 6574 7320 7768 6963  eature-sets whic
+000113e0: 6820 636f 6e74 6169 6e20 7468 6520 6665  h contain the fe
+000113f0: 6174 7572 6573 206c 6f6f 6b65 6420 666f  atures looked fo
+00011400: 722c 2061 6e64 2061 7265 2074 6167 6765  r, and are tagge
+00011410: 6420 7769 7468 2074 6865 2073 7065 6369  d with the speci
+00011420: 6669 6320 7461 672e 0a20 2020 2020 2020  fic tag..       
+00011430: 203a 7061 7261 6d20 656e 7469 7469 6573   :param entities
+00011440: 3a20 5265 7475 726e 206f 6e6c 7920 6665  : Return only fe
+00011450: 6174 7572 652d 7365 7473 2077 6869 6368  ature-sets which
+00011460: 2063 6f6e 7461 696e 2061 6e20 656e 7469   contain an enti
+00011470: 7479 2077 686f 7365 206e 616d 6520 6973  ty whose name is
+00011480: 2063 6f6e 7461 696e 6564 2069 6e20 7468   contained in th
+00011490: 6973 206c 6973 742e 0a20 2020 2020 2020  is list..       
+000114a0: 203a 7061 7261 6d20 6c61 6265 6c73 3a20   :param labels: 
+000114b0: 5265 7475 726e 206f 6e6c 7920 6665 6174  Return only feat
+000114c0: 7572 652d 7365 7473 2077 6869 6368 2061  ure-sets which a
+000114d0: 7265 206c 6162 656c 6564 2061 7320 7265  re labeled as re
+000114e0: 7175 6573 7465 642e 0a20 2020 2020 2020  quested..       
+000114f0: 203a 7265 7475 726e 733a 2041 206c 6973   :returns: A lis
+00011500: 7420 6f66 206d 6170 7069 6e67 2066 726f  t of mapping fro
+00011510: 6d20 6665 6174 7572 6520 746f 2061 2064  m feature to a d
+00011520: 6967 6573 7420 6f66 2074 6865 2066 6561  igest of the fea
+00011530: 7475 7265 2d73 6574 2c20 7768 6963 6820  ture-set, which 
+00011540: 636f 6e74 6169 6e73 2074 6865 2066 6561  contains the fea
+00011550: 7475 7265 2d73 6574 0a20 2020 2020 2020  ture-set.       
+00011560: 2020 2020 206d 6574 612d 6461 7461 2e20       meta-data. 
+00011570: 4d75 6c74 6970 6c65 2065 6e74 7269 6573  Multiple entries
+00011580: 206d 6179 2062 6520 7265 7475 726e 6564   may be returned
+00011590: 2066 6f72 2061 6e79 2073 7065 6369 6669   for any specifi
+000115a0: 6320 6665 6174 7572 6520 6475 6520 746f  c feature due to
+000115b0: 206d 756c 7469 706c 6520 7461 6773 206f   multiple tags o
+000115c0: 7220 7665 7273 696f 6e73 0a20 2020 2020  r versions.     
+000115d0: 2020 2020 2020 206f 6620 7468 6520 6665         of the fe
+000115e0: 6174 7572 652d 7365 742e 0a20 2020 2020  ature-set..     
+000115f0: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
+00011600: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+00011610: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+00011620: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+00011630: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
+00011640: 2020 2020 2020 2020 2020 2022 6e61 6d65             "name
+00011650: 223a 206e 616d 652c 0a20 2020 2020 2020  ": name,.       
+00011660: 2020 2020 2022 7461 6722 3a20 7461 672c       "tag": tag,
+00011670: 0a20 2020 2020 2020 2020 2020 2022 656e  .            "en
+00011680: 7469 7479 223a 2065 6e74 6974 6965 7320  tity": entities 
+00011690: 6f72 205b 5d2c 0a20 2020 2020 2020 2020  or [],.         
+000116a0: 2020 2022 6c61 6265 6c22 3a20 6c61 6265     "label": labe
+000116b0: 6c73 206f 7220 5b5d 2c0a 2020 2020 2020  ls or [],.      
+000116c0: 2020 7d0a 0a20 2020 2020 2020 2070 6174    }..        pat
+000116d0: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+000116e0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
+000116f0: 7322 0a0a 2020 2020 2020 2020 6572 726f  s"..        erro
+00011700: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
+00011710: 696c 6564 206c 6973 7469 6e67 2066 6561  iled listing fea
+00011720: 7475 7265 732c 2070 726f 6a65 6374 3a20  tures, project: 
+00011730: 7b70 726f 6a65 6374 7d2c 2071 7565 7279  {project}, query
+00011740: 3a20 7b70 6172 616d 737d 220a 2020 2020  : {params}".    
+00011750: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00011760: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+00011770: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
+00011780: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
+00011790: 6d73 290a 2020 2020 2020 2020 7265 7475  ms).        retu
+000117a0: 726e 2072 6573 702e 6a73 6f6e 2829 5b22  rn resp.json()["
+000117b0: 6665 6174 7572 6573 225d 0a0a 2020 2020  features"]..    
+000117c0: 6465 6620 6c69 7374 5f65 6e74 6974 6965  def list_entitie
+000117d0: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+000117e0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+000117f0: 3a20 7374 722c 0a20 2020 2020 2020 206e  : str,.        n
+00011800: 616d 653a 2073 7472 203d 204e 6f6e 652c  ame: str = None,
+00011810: 0a20 2020 2020 2020 2074 6167 3a20 7374  .        tag: st
+00011820: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00011830: 2020 6c61 6265 6c73 3a20 4c69 7374 5b73    labels: List[s
+00011840: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00011850: 2920 2d3e 204c 6973 745b 6469 6374 5d3a  ) -> List[dict]:
+00011860: 0a20 2020 2020 2020 2022 2222 5265 7472  .        """Retr
+00011870: 6965 7665 2061 206c 6973 7420 6f66 2065  ieve a list of e
+00011880: 6e74 6974 6965 7320 616e 6420 7468 6569  ntities and thei
+00011890: 7220 6d61 7070 696e 6720 746f 2074 6865  r mapping to the
+000118a0: 2063 6f6e 7461 696e 696e 6720 6665 6174   containing feat
+000118b0: 7572 652d 7365 7473 2e20 5468 6973 2066  ure-sets. This f
+000118c0: 756e 6374 696f 6e20 6973 2073 696d 696c  unction is simil
+000118d0: 6172 0a20 2020 2020 2020 2074 6f20 7468  ar.        to th
+000118e0: 6520 3a70 793a 6675 6e63 3a60 7e6c 6973  e :py:func:`~lis
+000118f0: 745f 6665 6174 7572 6573 6020 6675 6e63  t_features` func
+00011900: 7469 6f6e 2c20 616e 6420 7573 6573 2074  tion, and uses t
+00011910: 6865 2073 616d 6520 6c6f 6769 632e 2048  he same logic. H
+00011920: 6f77 6576 6572 2c20 7468 6520 656e 7469  owever, the enti
+00011930: 7469 6573 2061 7265 206d 6174 6368 6564  ties are matched
+00011940: 0a20 2020 2020 2020 2061 6761 696e 7374  .        against
+00011950: 2074 6865 206e 616d 6520 7261 7468 6572   the name rather
+00011960: 2074 6861 6e20 7468 6520 6665 6174 7572   than the featur
+00011970: 6573 2e0a 2020 2020 2020 2020 2222 220a  es..        """.
+00011980: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00011990: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+000119a0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+000119b0: 6a65 6374 0a20 2020 2020 2020 2070 6172  ject.        par
+000119c0: 616d 7320 3d20 7b0a 2020 2020 2020 2020  ams = {.        
+000119d0: 2020 2020 226e 616d 6522 3a20 6e61 6d65      "name": name
+000119e0: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+000119f0: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+00011a00: 2020 2020 2020 226c 6162 656c 223a 206c        "label": l
+00011a10: 6162 656c 7320 6f72 205b 5d2c 0a20 2020  abels or [],.   
+00011a20: 2020 2020 207d 0a0a 2020 2020 2020 2020       }..        
+00011a30: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+00011a40: 732f 7b70 726f 6a65 6374 7d2f 656e 7469  s/{project}/enti
+00011a50: 7469 6573 220a 0a20 2020 2020 2020 2065  ties"..        e
+00011a60: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+00011a70: 2246 6169 6c65 6420 6c69 7374 696e 6720  "Failed listing 
+00011a80: 656e 7469 7469 6573 2c20 7072 6f6a 6563  entities, projec
+00011a90: 743a 207b 7072 6f6a 6563 747d 2c20 7175  t: {project}, qu
+00011aa0: 6572 793a 207b 7061 7261 6d73 7d22 0a20  ery: {params}". 
+00011ab0: 2020 2020 2020 2072 6573 7020 3d20 7365         resp = se
+00011ac0: 6c66 2e61 7069 5f63 616c 6c28 2247 4554  lf.api_call("GET
+00011ad0: 222c 2070 6174 682c 2065 7272 6f72 5f6d  ", path, error_m
+00011ae0: 6573 7361 6765 2c20 7061 7261 6d73 3d70  essage, params=p
+00011af0: 6172 616d 7329 0a20 2020 2020 2020 2072  arams).        r
+00011b00: 6574 7572 6e20 7265 7370 2e6a 736f 6e28  eturn resp.json(
+00011b10: 295b 2265 6e74 6974 6965 7322 5d0a 0a20  )["entities"].. 
+00011b20: 2020 2040 7374 6174 6963 6d65 7468 6f64     @staticmethod
+00011b30: 0a20 2020 2064 6566 205f 6765 6e65 7261  .    def _genera
+00011b40: 7465 5f70 6172 7469 7469 6f6e 5f62 795f  te_partition_by_
+00011b50: 7061 7261 6d73 280a 2020 2020 2020 2020  params(.        
+00011b60: 7061 7274 6974 696f 6e5f 6279 5f63 6c73  partition_by_cls
+00011b70: 2c0a 2020 2020 2020 2020 7061 7274 6974  ,.        partit
+00011b80: 696f 6e5f 6279 2c0a 2020 2020 2020 2020  ion_by,.        
+00011b90: 726f 7773 5f70 6572 5f70 6172 7469 7469  rows_per_partiti
+00011ba0: 6f6e 2c0a 2020 2020 2020 2020 736f 7274  on,.        sort
+00011bb0: 5f62 792c 0a20 2020 2020 2020 206f 7264  _by,.        ord
+00011bc0: 6572 2c0a 2020 2020 2020 2020 6d61 785f  er,.        max_
+00011bd0: 7061 7274 6974 696f 6e73 3d4e 6f6e 652c  partitions=None,
+00011be0: 0a20 2020 2029 3a0a 0a20 2020 2020 2020  .    ):..       
+00011bf0: 2070 6172 7469 7469 6f6e 5f70 6172 616d   partition_param
+00011c00: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+00011c10: 2020 2270 6172 7469 7469 6f6e 2d62 7922    "partition-by"
+00011c20: 3a20 7061 7274 6974 696f 6e5f 6279 2c0a  : partition_by,.
+00011c30: 2020 2020 2020 2020 2020 2020 2272 6f77              "row
+00011c40: 732d 7065 722d 7061 7274 6974 696f 6e22  s-per-partition"
+00011c50: 3a20 726f 7773 5f70 6572 5f70 6172 7469  : rows_per_parti
+00011c60: 7469 6f6e 2c0a 2020 2020 2020 2020 2020  tion,.          
+00011c70: 2020 2270 6172 7469 7469 6f6e 2d73 6f72    "partition-sor
+00011c80: 742d 6279 223a 2073 6f72 745f 6279 2c0a  t-by": sort_by,.
+00011c90: 2020 2020 2020 2020 2020 2020 2270 6172              "par
+00011ca0: 7469 7469 6f6e 2d6f 7264 6572 223a 206f  tition-order": o
+00011cb0: 7264 6572 2c0a 2020 2020 2020 2020 7d0a  rder,.        }.
+00011cc0: 2020 2020 2020 2020 6966 206d 6178 5f70          if max_p
+00011cd0: 6172 7469 7469 6f6e 7320 6973 206e 6f74  artitions is not
+00011ce0: 204e 6f6e 653a 0a20 2020 2020 2020 2020   None:.         
+00011cf0: 2020 2070 6172 7469 7469 6f6e 5f70 6172     partition_par
+00011d00: 616d 735b 226d 6178 2d70 6172 7469 7469  ams["max-partiti
+00011d10: 6f6e 7322 5d20 3d20 6d61 785f 7061 7274  ons"] = max_part
+00011d20: 6974 696f 6e73 0a20 2020 2020 2020 2072  itions.        r
+00011d30: 6574 7572 6e20 7061 7274 6974 696f 6e5f  eturn partition_
+00011d40: 7061 7261 6d73 0a0a 2020 2020 6465 6620  params..    def 
+00011d50: 6c69 7374 5f66 6561 7475 7265 5f73 6574  list_feature_set
+00011d60: 7328 0a20 2020 2020 2020 2073 656c 662c  s(.        self,
+00011d70: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00011d80: 3a20 7374 7220 3d20 2222 2c0a 2020 2020  : str = "",.    
+00011d90: 2020 2020 6e61 6d65 3a20 7374 7220 3d20      name: str = 
+00011da0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
+00011db0: 673a 2073 7472 203d 204e 6f6e 652c 0a20  g: str = None,. 
+00011dc0: 2020 2020 2020 2073 7461 7465 3a20 7374         state: st
+00011dd0: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2020  r = None,.      
+00011de0: 2020 656e 7469 7469 6573 3a20 4c69 7374    entities: List
+00011df0: 5b73 7472 5d20 3d20 4e6f 6e65 2c0a 2020  [str] = None,.  
+00011e00: 2020 2020 2020 6665 6174 7572 6573 3a20        features: 
+00011e10: 4c69 7374 5b73 7472 5d20 3d20 4e6f 6e65  List[str] = None
+00011e20: 2c0a 2020 2020 2020 2020 6c61 6265 6c73  ,.        labels
+00011e30: 3a20 4c69 7374 5b73 7472 5d20 3d20 4e6f  : List[str] = No
+00011e40: 6e65 2c0a 2020 2020 2020 2020 7061 7274  ne,.        part
+00011e50: 6974 696f 6e5f 6279 3a20 556e 696f 6e5b  ition_by: Union[
+00011e60: 0a20 2020 2020 2020 2020 2020 206d 6c72  .            mlr
+00011e70: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00011e80: 732e 4665 6174 7572 6553 746f 7265 5061  s.FeatureStorePa
+00011e90: 7274 6974 696f 6e42 7946 6965 6c64 2c20  rtitionByField, 
+00011ea0: 7374 720a 2020 2020 2020 2020 5d20 3d20  str.        ] = 
+00011eb0: 4e6f 6e65 2c0a 2020 2020 2020 2020 726f  None,.        ro
+00011ec0: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
+00011ed0: 3a20 696e 7420 3d20 312c 0a20 2020 2020  : int = 1,.     
+00011ee0: 2020 2070 6172 7469 7469 6f6e 5f73 6f72     partition_sor
+00011ef0: 745f 6279 3a20 556e 696f 6e5b 6d6c 7275  t_by: Union[mlru
+00011f00: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00011f10: 2e53 6f72 7446 6965 6c64 2c20 7374 725d  .SortField, str]
+00011f20: 203d 204e 6f6e 652c 0a20 2020 2020 2020   = None,.       
+00011f30: 2070 6172 7469 7469 6f6e 5f6f 7264 6572   partition_order
+00011f40: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
+00011f50: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+00011f60: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
+00011f70: 7970 652c 2073 7472 0a20 2020 2020 2020  ype, str.       
+00011f80: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
+00011f90: 6e2e 7363 6865 6d61 732e 4f72 6465 7254  n.schemas.OrderT
+00011fa0: 7970 652e 6465 7363 2c0a 2020 2020 2920  ype.desc,.    ) 
+00011fb0: 2d3e 204c 6973 745b 4665 6174 7572 6553  -> List[FeatureS
+00011fc0: 6574 5d3a 0a20 2020 2020 2020 2022 2222  et]:.        """
+00011fd0: 5265 7472 6965 7665 2061 206c 6973 7420  Retrieve a list 
+00011fe0: 6f66 2066 6561 7475 7265 2d73 6574 7320  of feature-sets 
+00011ff0: 6d61 7463 6869 6e67 2074 6865 2063 7269  matching the cri
+00012000: 7465 7269 6120 7072 6f76 6964 6564 2e0a  teria provided..
+00012010: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00012020: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
+00012030: 206e 616d 652e 0a20 2020 2020 2020 203a   name..        :
+00012040: 7061 7261 6d20 6e61 6d65 3a20 4e61 6d65  param name: Name
+00012050: 206f 6620 6665 6174 7572 652d 7365 7420   of feature-set 
+00012060: 746f 206d 6174 6368 2e20 5468 6973 2069  to match. This i
+00012070: 7320 6120 6c69 6b65 2071 7565 7279 2c20  s a like query, 
+00012080: 616e 6420 6973 2063 6173 652d 696e 7365  and is case-inse
+00012090: 6e73 6974 6976 652e 0a20 2020 2020 2020  nsitive..       
+000120a0: 203a 7061 7261 6d20 7461 673a 204d 6174   :param tag: Mat
+000120b0: 6368 2066 6561 7475 7265 2d73 6574 7320  ch feature-sets 
+000120c0: 7769 7468 2073 7065 6369 6669 6320 7461  with specific ta
+000120d0: 672e 0a20 2020 2020 2020 203a 7061 7261  g..        :para
+000120e0: 6d20 7374 6174 653a 204d 6174 6368 2066  m state: Match f
+000120f0: 6561 7475 7265 2d73 6574 7320 7769 7468  eature-sets with
+00012100: 2061 2073 7065 6369 6669 6320 7374 6174   a specific stat
+00012110: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00012120: 6d20 656e 7469 7469 6573 3a20 4d61 7463  m entities: Matc
+00012130: 6820 6665 6174 7572 652d 7365 7473 2077  h feature-sets w
+00012140: 6869 6368 2063 6f6e 7461 696e 2065 6e74  hich contain ent
+00012150: 6974 6965 7320 7768 6f73 6520 6e61 6d65  ities whose name
+00012160: 2069 7320 696e 2074 6869 7320 6c69 7374   is in this list
+00012170: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00012180: 2066 6561 7475 7265 733a 204d 6174 6368   features: Match
+00012190: 2066 6561 7475 7265 2d73 6574 7320 7768   feature-sets wh
+000121a0: 6963 6820 636f 6e74 6169 6e20 6665 6174  ich contain feat
+000121b0: 7572 6573 2077 686f 7365 206e 616d 6520  ures whose name 
+000121c0: 6973 2069 6e20 7468 6973 206c 6973 742e  is in this list.
+000121d0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000121e0: 6c61 6265 6c73 3a20 4d61 7463 6820 6665  labels: Match fe
+000121f0: 6174 7572 652d 7365 7473 2077 6869 6368  ature-sets which
+00012200: 2068 6176 6520 7468 6573 6520 6c61 6265   have these labe
+00012210: 6c73 2e0a 2020 2020 2020 2020 3a70 6172  ls..        :par
+00012220: 616d 2070 6172 7469 7469 6f6e 5f62 793a  am partition_by:
+00012230: 2046 6965 6c64 2074 6f20 6772 6f75 7020   Field to group 
+00012240: 7265 7375 6c74 7320 6279 2e20 4f6e 6c79  results by. Only
+00012250: 2061 6c6c 6f77 6564 2076 616c 7565 2069   allowed value i
+00012260: 7320 606e 616d 6560 2e20 5768 656e 2060  s `name`. When `
+00012270: 7061 7274 6974 696f 6e5f 6279 6020 6973  partition_by` is
+00012280: 2073 7065 6369 6669 6564 2c0a 2020 2020   specified,.    
+00012290: 2020 2020 2020 2020 7468 6520 6070 6172          the `par
+000122a0: 7469 7469 6f6e 5f73 6f72 745f 6279 6020  tition_sort_by` 
+000122b0: 7061 7261 6d65 7465 7220 6d75 7374 2062  parameter must b
+000122c0: 6520 7072 6f76 6964 6564 2061 7320 7765  e provided as we
+000122d0: 6c6c 2e0a 2020 2020 2020 2020 3a70 6172  ll..        :par
+000122e0: 616d 2072 6f77 735f 7065 725f 7061 7274  am rows_per_part
+000122f0: 6974 696f 6e3a 2048 6f77 206d 616e 7920  ition: How many 
+00012300: 746f 7020 726f 7773 2028 7065 7220 736f  top rows (per so
+00012310: 7274 696e 6720 6465 6669 6e65 6420 6279  rting defined by
+00012320: 2060 7061 7274 6974 696f 6e5f 736f 7274   `partition_sort
+00012330: 5f62 7960 2061 6e64 2060 7061 7274 6974  _by` and `partit
+00012340: 696f 6e5f 6f72 6465 7260 290a 2020 2020  ion_order`).    
+00012350: 2020 2020 2020 2020 746f 2072 6574 7572          to retur
+00012360: 6e20 7065 7220 6772 6f75 702e 2044 6566  n per group. Def
+00012370: 6175 6c74 2076 616c 7565 2069 7320 312e  ault value is 1.
+00012380: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00012390: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
+000123a0: 793a 2057 6861 7420 6669 656c 6420 746f  y: What field to
+000123b0: 2073 6f72 7420 7468 6520 7265 7375 6c74   sort the result
+000123c0: 7320 6279 2c20 7769 7468 696e 2065 6163  s by, within eac
+000123d0: 6820 7061 7274 6974 696f 6e20 6465 6669  h partition defi
+000123e0: 6e65 6420 6279 2060 7061 7274 6974 696f  ned by `partitio
+000123f0: 6e5f 6279 602e 0a20 2020 2020 2020 2020  n_by`..         
+00012400: 2020 2043 7572 7265 6e74 6c79 2074 6865     Currently the
+00012410: 206f 6e6c 7920 616c 6c6f 7765 6420 7661   only allowed va
+00012420: 6c75 6520 6172 6520 6063 7265 6174 6564  lue are `created
+00012430: 6020 616e 6420 6075 7064 6174 6564 602e  ` and `updated`.
+00012440: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00012450: 7061 7274 6974 696f 6e5f 6f72 6465 723a  partition_order:
+00012460: 204f 7264 6572 206f 6620 736f 7274 696e   Order of sortin
+00012470: 6720 7769 7468 696e 2070 6172 7469 7469  g within partiti
+00012480: 6f6e 7320 2d20 6061 7363 6020 6f72 2060  ons - `asc` or `
+00012490: 6465 7363 602e 2044 6566 6175 6c74 2069  desc`. Default i
+000124a0: 7320 6064 6573 6360 2e0a 2020 2020 2020  s `desc`..      
+000124b0: 2020 3a72 6574 7572 6e73 3a20 4c69 7374    :returns: List
+000124c0: 206f 6620 6d61 7463 6869 6e67 203a 7079   of matching :py
+000124d0: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
+000124e0: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
+000124f0: 7475 7265 5365 7460 206f 626a 6563 7473  tureSet` objects
+00012500: 2e0a 2020 2020 2020 2020 2222 220a 0a20  ..        """.. 
+00012510: 2020 2020 2020 2070 726f 6a65 6374 203d         project =
+00012520: 2070 726f 6a65 6374 206f 7220 636f 6e66   project or conf
+00012530: 6967 2e64 6566 6175 6c74 5f70 726f 6a65  ig.default_proje
+00012540: 6374 0a0a 2020 2020 2020 2020 7061 7261  ct..        para
+00012550: 6d73 203d 207b 0a20 2020 2020 2020 2020  ms = {.         
+00012560: 2020 2022 6e61 6d65 223a 206e 616d 652c     "name": name,
+00012570: 0a20 2020 2020 2020 2020 2020 2022 7374  .            "st
+00012580: 6174 6522 3a20 7374 6174 652c 0a20 2020  ate": state,.   
+00012590: 2020 2020 2020 2020 2022 7461 6722 3a20           "tag": 
+000125a0: 7461 672c 0a20 2020 2020 2020 2020 2020  tag,.           
+000125b0: 2022 656e 7469 7479 223a 2065 6e74 6974   "entity": entit
+000125c0: 6965 7320 6f72 205b 5d2c 0a20 2020 2020  ies or [],.     
+000125d0: 2020 2020 2020 2022 6665 6174 7572 6522         "feature"
+000125e0: 3a20 6665 6174 7572 6573 206f 7220 5b5d  : features or []
+000125f0: 2c0a 2020 2020 2020 2020 2020 2020 226c  ,.            "l
+00012600: 6162 656c 223a 206c 6162 656c 7320 6f72  abel": labels or
+00012610: 205b 5d2c 0a20 2020 2020 2020 207d 0a20   [],.        }. 
+00012620: 2020 2020 2020 2069 6620 7061 7274 6974         if partit
+00012630: 696f 6e5f 6279 3a0a 2020 2020 2020 2020  ion_by:.        
+00012640: 2020 2020 7061 7261 6d73 2e75 7064 6174      params.updat
+00012650: 6528 0a20 2020 2020 2020 2020 2020 2020  e(.             
+00012660: 2020 2073 656c 662e 5f67 656e 6572 6174     self._generat
+00012670: 655f 7061 7274 6974 696f 6e5f 6279 5f70  e_partition_by_p
+00012680: 6172 616d 7328 0a20 2020 2020 2020 2020  arams(.         
+00012690: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
+000126a0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+000126b0: 4665 6174 7572 6553 746f 7265 5061 7274  FeatureStorePart
+000126c0: 6974 696f 6e42 7946 6965 6c64 2c0a 2020  itionByField,.  
+000126d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000126e0: 2020 7061 7274 6974 696f 6e5f 6279 2c0a    partition_by,.
+000126f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012700: 2020 2020 726f 7773 5f70 6572 5f70 6172      rows_per_par
+00012710: 7469 7469 6f6e 2c0a 2020 2020 2020 2020  tition,.        
+00012720: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00012730: 6974 696f 6e5f 736f 7274 5f62 792c 0a20  ition_sort_by,. 
+00012740: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012750: 2020 2070 6172 7469 7469 6f6e 5f6f 7264     partition_ord
+00012760: 6572 2c0a 2020 2020 2020 2020 2020 2020  er,.            
+00012770: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+00012780: 2020 290a 0a20 2020 2020 2020 2070 6174    )..        pat
+00012790: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+000127a0: 7072 6f6a 6563 747d 2f66 6561 7475 7265  project}/feature
+000127b0: 2d73 6574 7322 0a0a 2020 2020 2020 2020  -sets"..        
+000127c0: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+000127d0: 280a 2020 2020 2020 2020 2020 2020 6622  (.            f"
+000127e0: 4661 696c 6564 206c 6973 7469 6e67 2066  Failed listing f
+000127f0: 6561 7475 7265 2d73 6574 732c 2070 726f  eature-sets, pro
+00012800: 6a65 6374 3a20 7b70 726f 6a65 6374 7d2c  ject: {project},
+00012810: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
+00012820: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00012830: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00012840: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+00012850: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
+00012860: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
+00012870: 6d73 290a 2020 2020 2020 2020 6665 6174  ms).        feat
+00012880: 7572 655f 7365 7473 203d 2072 6573 702e  ure_sets = resp.
+00012890: 6a73 6f6e 2829 5b22 6665 6174 7572 655f  json()["feature_
+000128a0: 7365 7473 225d 0a20 2020 2020 2020 2069  sets"].        i
+000128b0: 6620 6665 6174 7572 655f 7365 7473 3a0a  f feature_sets:.
+000128c0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+000128d0: 726e 205b 4665 6174 7572 6553 6574 2e66  rn [FeatureSet.f
+000128e0: 726f 6d5f 6469 6374 286f 626a 2920 666f  rom_dict(obj) fo
+000128f0: 7220 6f62 6a20 696e 2066 6561 7475 7265  r obj in feature
+00012900: 5f73 6574 735d 0a0a 2020 2020 6465 6620  _sets]..    def 
+00012910: 7374 6f72 655f 6665 6174 7572 655f 7365  store_feature_se
+00012920: 7428 0a20 2020 2020 2020 2073 656c 662c  t(.        self,
+00012930: 0a20 2020 2020 2020 2066 6561 7475 7265  .        feature
+00012940: 5f73 6574 3a20 556e 696f 6e5b 6469 6374  _set: Union[dict
+00012950: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00012960: 6368 656d 6173 2e46 6561 7475 7265 5365  chemas.FeatureSe
+00012970: 742c 2046 6561 7475 7265 5365 745d 2c0a  t, FeatureSet],.
+00012980: 2020 2020 2020 2020 6e61 6d65 3d4e 6f6e          name=Non
+00012990: 652c 0a20 2020 2020 2020 2070 726f 6a65  e,.        proje
+000129a0: 6374 3d22 222c 0a20 2020 2020 2020 2074  ct="",.        t
+000129b0: 6167 3d4e 6f6e 652c 0a20 2020 2020 2020  ag=None,.       
+000129c0: 2075 6964 3d4e 6f6e 652c 0a20 2020 2020   uid=None,.     
+000129d0: 2020 2076 6572 7369 6f6e 6564 3d54 7275     versioned=Tru
+000129e0: 652c 0a20 2020 2029 202d 3e20 6469 6374  e,.    ) -> dict
+000129f0: 3a0a 2020 2020 2020 2020 2222 2253 6176  :.        """Sav
+00012a00: 6520 6120 3a70 793a 636c 6173 733a 607e  e a :py:class:`~
+00012a10: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+00012a20: 6f72 652e 4665 6174 7572 6553 6574 6020  ore.FeatureSet` 
+00012a30: 6f62 6a65 6374 2069 6e20 7468 6520 3a70  object in the :p
+00012a40: 793a 6d6f 643a 606d 6c72 756e 6020 4442  y:mod:`mlrun` DB
+00012a50: 2e20 5468 650a 2020 2020 2020 2020 6665  . The.        fe
+00012a60: 6174 7572 652d 7365 7420 6361 6e20 6265  ature-set can be
+00012a70: 2065 6974 6865 7220 6120 6e65 7720 6f62   either a new ob
+00012a80: 6a65 6374 206f 7220 6120 6d6f 6469 6669  ject or a modifi
+00012a90: 6361 7469 6f6e 2074 6f20 6578 6973 7469  cation to existi
+00012aa0: 6e67 206f 626a 6563 7420 7265 6665 7265  ng object refere
+00012ab0: 6e63 6564 2062 7920 7468 6520 7061 7261  nced by the para
+00012ac0: 6d73 206f 660a 2020 2020 2020 2020 7468  ms of.        th
+00012ad0: 6520 6675 6e63 7469 6f6e 2e0a 0a20 2020  e function...   
+00012ae0: 2020 2020 203a 7061 7261 6d20 6665 6174       :param feat
+00012af0: 7572 655f 7365 743a 2054 6865 203a 7079  ure_set: The :py
+00012b00: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
+00012b10: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
+00012b20: 7475 7265 5365 7460 2074 6f20 7374 6f72  tureSet` to stor
+00012b30: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+00012b40: 6d20 6e61 6d65 3a20 2020 204e 616d 6520  m name:    Name 
+00012b50: 6f66 2066 6561 7475 7265 2073 6574 2e0a  of feature set..
+00012b60: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00012b70: 726f 6a65 6374 3a20 4e61 6d65 206f 6620  roject: Name of 
+00012b80: 7072 6f6a 6563 7420 7468 6973 2066 6561  project this fea
+00012b90: 7475 7265 2d73 6574 2062 656c 6f6e 6773  ture-set belongs
+00012ba0: 2074 6f2e 0a20 2020 2020 2020 203a 7061   to..        :pa
+00012bb0: 7261 6d20 7461 673a 2054 6865 2060 6074  ram tag: The ``t
+00012bc0: 6167 6060 206f 6620 7468 6520 6f62 6a65  ag`` of the obje
+00012bd0: 6374 2074 6f20 7265 706c 6163 6520 696e  ct to replace in
+00012be0: 2074 6865 2044 422c 2066 6f72 2065 7861   the DB, for exa
+00012bf0: 6d70 6c65 2060 606c 6174 6573 7460 602e  mple ``latest``.
+00012c00: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00012c10: 7569 643a 2054 6865 2060 6075 6964 6060  uid: The ``uid``
+00012c20: 206f 6620 7468 6520 6f62 6a65 6374 2074   of the object t
+00012c30: 6f20 7265 706c 6163 6520 696e 2074 6865  o replace in the
+00012c40: 2044 422e 2049 6620 7573 696e 6720 7468   DB. If using th
+00012c50: 6973 2070 6172 616d 6574 6572 2c20 7468  is parameter, th
+00012c60: 6520 6d6f 6469 6669 6564 206f 626a 6563  e modified objec
+00012c70: 740a 2020 2020 2020 2020 2020 2020 6d75  t.            mu
+00012c80: 7374 2068 6176 6520 7468 6520 7361 6d65  st have the same
+00012c90: 2060 6075 6964 6060 206f 6620 7468 6520   ``uid`` of the 
+00012ca0: 7072 6576 696f 7573 6c79 2d65 7869 7374  previously-exist
+00012cb0: 696e 6720 6f62 6a65 6374 2e20 5468 6973  ing object. This
+00012cc0: 2063 616e 6e6f 7420 6265 2075 7365 6420   cannot be used 
+00012cd0: 666f 7220 6e6f 6e2d 7665 7273 696f 6e65  for non-versione
+00012ce0: 6420 6f62 6a65 6374 732e 0a20 2020 2020  d objects..     
+00012cf0: 2020 203a 7061 7261 6d20 7665 7273 696f     :param versio
+00012d00: 6e65 643a 2057 6865 7468 6572 2074 6f20  ned: Whether to 
+00012d10: 6d61 696e 7461 696e 2076 6572 7369 6f6e  maintain version
+00012d20: 7320 666f 7220 7468 6973 2066 6561 7475  s for this featu
+00012d30: 7265 2d73 6574 2e20 416c 6c20 7665 7273  re-set. All vers
+00012d40: 696f 6e73 206f 6620 6120 7665 7273 696f  ions of a versio
+00012d50: 6e65 6420 6f62 6a65 6374 0a20 2020 2020  ned object.     
+00012d60: 2020 2020 2020 2077 696c 6c20 6265 206b         will be k
+00012d70: 6570 7420 696e 2074 6865 2044 4220 616e  ept in the DB an
+00012d80: 6420 6361 6e20 6265 2072 6574 7269 6576  d can be retriev
+00012d90: 6564 2075 6e74 696c 2065 7870 6c69 6369  ed until explici
+00012da0: 746c 7920 6465 6c65 7465 642e 0a20 2020  tly deleted..   
+00012db0: 2020 2020 203a 7265 7475 726e 733a 2054       :returns: T
+00012dc0: 6865 203a 7079 3a63 6c61 7373 3a60 7e6d  he :py:class:`~m
+00012dd0: 6c72 756e 2e66 6561 7475 7265 5f73 746f  lrun.feature_sto
+00012de0: 7265 2e46 6561 7475 7265 5365 7460 206f  re.FeatureSet` o
+00012df0: 626a 6563 7420 2861 7320 6469 6374 292e  bject (as dict).
+00012e00: 0a20 2020 2020 2020 2022 2222 0a0a 2020  .        """..  
+00012e10: 2020 2020 2020 7265 6665 7265 6e63 6520        reference 
+00012e20: 3d20 7365 6c66 2e5f 7265 736f 6c76 655f  = self._resolve_
+00012e30: 7265 6665 7265 6e63 6528 7461 672c 2075  reference(tag, u
+00012e40: 6964 290a 2020 2020 2020 2020 7061 7261  id).        para
+00012e50: 6d73 203d 207b 2276 6572 7369 6f6e 6564  ms = {"versioned
+00012e60: 223a 2076 6572 7369 6f6e 6564 7d0a 0a20  ": versioned}.. 
+00012e70: 2020 2020 2020 2069 6620 6973 696e 7374         if isinst
+00012e80: 616e 6365 2866 6561 7475 7265 5f73 6574  ance(feature_set
+00012e90: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00012ea0: 6368 656d 6173 2e46 6561 7475 7265 5365  chemas.FeatureSe
+00012eb0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+00012ec0: 6665 6174 7572 655f 7365 7420 3d20 6665  feature_set = fe
+00012ed0: 6174 7572 655f 7365 742e 6469 6374 2829  ature_set.dict()
+00012ee0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+00012ef0: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
+00012f00: 5f73 6574 2c20 4665 6174 7572 6553 6574  _set, FeatureSet
+00012f10: 293a 0a20 2020 2020 2020 2020 2020 2066  ):.            f
+00012f20: 6561 7475 7265 5f73 6574 203d 2066 6561  eature_set = fea
+00012f30: 7475 7265 5f73 6574 2e74 6f5f 6469 6374  ture_set.to_dict
+00012f40: 2829 0a0a 2020 2020 2020 2020 6e61 6d65  ()..        name
+00012f50: 203d 206e 616d 6520 6f72 2066 6561 7475   = name or featu
+00012f60: 7265 5f73 6574 5b22 6d65 7461 6461 7461  re_set["metadata
+00012f70: 225d 5b22 6e61 6d65 225d 0a20 2020 2020  "]["name"].     
+00012f80: 2020 2070 726f 6a65 6374 203d 2028 0a20     project = (. 
+00012f90: 2020 2020 2020 2020 2020 2070 726f 6a65             proje
+00012fa0: 6374 206f 7220 6665 6174 7572 655f 7365  ct or feature_se
+00012fb0: 745b 226d 6574 6164 6174 6122 5d2e 6765  t["metadata"].ge
+00012fc0: 7428 2270 726f 6a65 6374 2229 206f 7220  t("project") or 
+00012fd0: 636f 6e66 6967 2e64 6566 6175 6c74 5f70  config.default_p
+00012fe0: 726f 6a65 6374 0a20 2020 2020 2020 2029  roject.        )
+00012ff0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00013000: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+00013010: 6563 747d 2f66 6561 7475 7265 2d73 6574  ect}/feature-set
+00013020: 732f 7b6e 616d 657d 2f72 6566 6572 656e  s/{name}/referen
+00013030: 6365 732f 7b72 6566 6572 656e 6365 7d22  ces/{reference}"
+00013040: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+00013050: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+00013060: 6420 7374 6f72 696e 6720 6665 6174 7572  d storing featur
+00013070: 652d 7365 7420 7b70 726f 6a65 6374 7d2f  e-set {project}/
+00013080: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+00013090: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
+000130a0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+000130b0: 2020 2250 5554 222c 2070 6174 682c 2065    "PUT", path, e
+000130c0: 7272 6f72 5f6d 6573 7361 6765 2c20 7061  rror_message, pa
+000130d0: 7261 6d73 3d70 6172 616d 732c 2062 6f64  rams=params, bod
+000130e0: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2866  y=dict_to_json(f
+000130f0: 6561 7475 7265 5f73 6574 290a 2020 2020  eature_set).    
+00013100: 2020 2020 290a 2020 2020 2020 2020 7265      ).        re
+00013110: 7475 726e 2072 6573 702e 6a73 6f6e 2829  turn resp.json()
+00013120: 0a0a 2020 2020 6465 6620 7061 7463 685f  ..    def patch_
+00013130: 6665 6174 7572 655f 7365 7428 0a20 2020  feature_set(.   
+00013140: 2020 2020 2073 656c 662c 0a20 2020 2020       self,.     
+00013150: 2020 206e 616d 652c 0a20 2020 2020 2020     name,.       
+00013160: 2066 6561 7475 7265 5f73 6574 5f75 7064   feature_set_upd
+00013170: 6174 653a 2064 6963 742c 0a20 2020 2020  ate: dict,.     
+00013180: 2020 2070 726f 6a65 6374 3d22 222c 0a20     project="",. 
+00013190: 2020 2020 2020 2074 6167 3d4e 6f6e 652c         tag=None,
+000131a0: 0a20 2020 2020 2020 2075 6964 3d4e 6f6e  .        uid=Non
+000131b0: 652c 0a20 2020 2020 2020 2070 6174 6368  e,.        patch
+000131c0: 5f6d 6f64 653a 2055 6e69 6f6e 5b0a 2020  _mode: Union[.  
+000131d0: 2020 2020 2020 2020 2020 7374 722c 206d            str, m
+000131e0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+000131f0: 6d61 732e 5061 7463 684d 6f64 650a 2020  mas.PatchMode.  
+00013200: 2020 2020 2020 5d20 3d20 6d6c 7275 6e2e        ] = mlrun.
+00013210: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
+00013220: 6174 6368 4d6f 6465 2e72 6570 6c61 6365  atchMode.replace
+00013230: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00013240: 2022 2222 4d6f 6469 6679 2028 7061 7463   """Modify (patc
+00013250: 6829 2061 6e20 6578 6973 7469 6e67 203a  h) an existing :
+00013260: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
+00013270: 2e66 6561 7475 7265 5f73 746f 7265 2e46  .feature_store.F
+00013280: 6561 7475 7265 5365 7460 206f 626a 6563  eatureSet` objec
+00013290: 742e 0a20 2020 2020 2020 2054 6865 206f  t..        The o
+000132a0: 626a 6563 7420 6973 2069 6465 6e74 6966  bject is identif
+000132b0: 6965 6420 6279 2069 7473 206e 616d 6520  ied by its name 
+000132c0: 2861 6e64 2070 726f 6a65 6374 2069 7420  (and project it 
+000132d0: 6265 6c6f 6e67 7320 746f 292c 2061 7320  belongs to), as 
+000132e0: 7765 6c6c 2061 7320 6f70 7469 6f6e 616c  well as optional
+000132f0: 6c79 2061 2060 6074 6167 6060 206f 7220  ly a ``tag`` or 
+00013300: 6974 730a 2020 2020 2020 2020 6060 7569  its.        ``ui
+00013310: 6460 6020 2866 6f72 2076 6572 7369 6f6e  d`` (for version
+00013320: 6564 206f 626a 6563 7429 2e20 4966 2062  ed object). If b
+00013330: 6f74 6820 6060 7461 6760 6020 616e 6420  oth ``tag`` and 
+00013340: 6060 7569 6460 6020 6172 6520 6f6d 6974  ``uid`` are omit
+00013350: 7465 6420 7468 656e 2074 6865 206f 626a  ted then the obj
+00013360: 6563 7420 7769 7468 2074 6167 2060 606c  ect with tag ``l
+00013370: 6174 6573 7460 600a 2020 2020 2020 2020  atest``.        
+00013380: 6973 206d 6f64 6966 6965 642e 0a0a 2020  is modified...  
+00013390: 2020 2020 2020 3a70 6172 616d 206e 616d        :param nam
+000133a0: 653a 204e 616d 6520 6f66 2074 6865 206f  e: Name of the o
+000133b0: 626a 6563 7420 746f 2070 6174 6368 2e0a  bject to patch..
+000133c0: 2020 2020 2020 2020 3a70 6172 616d 2066          :param f
+000133d0: 6561 7475 7265 5f73 6574 5f75 7064 6174  eature_set_updat
+000133e0: 653a 2054 6865 206d 6f64 6966 6963 6174  e: The modificat
+000133f0: 696f 6e73 206e 6565 6465 6420 696e 2074  ions needed in t
+00013400: 6865 206f 626a 6563 742e 2054 6869 7320  he object. This 
+00013410: 7061 7261 6d65 7465 7220 6f6e 6c79 2068  parameter only h
+00013420: 6173 2074 6865 2063 6861 6e67 6573 2069  as the changes i
+00013430: 6e20 6974 2c0a 2020 2020 2020 2020 2020  n it,.          
+00013440: 2020 6e6f 7420 6120 6675 6c6c 206f 626a    not a full obj
+00013450: 6563 742e 0a20 2020 2020 2020 2020 2020  ect..           
+00013460: 2045 7861 6d70 6c65 3a3a 0a0a 2020 2020   Example::..    
+00013470: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00013480: 7572 655f 7365 745f 7570 6461 7465 203d  ure_set_update =
+00013490: 207b 2273 7461 7475 7322 3a20 7b22 7072   {"status": {"pr
+000134a0: 6f63 6573 7365 6422 203a 2054 7275 657d  ocessed" : True}
+000134b0: 7d0a 0a20 2020 2020 2020 2020 2020 2057  }..            W
+000134c0: 696c 6c20 6170 706c 7920 7468 6520 6669  ill apply the fi
+000134d0: 656c 6420 6060 7374 6174 7573 2e70 726f  eld ``status.pro
+000134e0: 6365 7373 6564 6060 2074 6f20 7468 6520  cessed`` to the 
+000134f0: 6578 6973 7469 6e67 206f 626a 6563 742e  existing object.
+00013500: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00013510: 7072 6f6a 6563 743a 2050 726f 6a65 6374  project: Project
+00013520: 2077 6869 6368 2063 6f6e 7461 696e 7320   which contains 
+00013530: 7468 6520 6d6f 6469 6669 6564 206f 626a  the modified obj
+00013540: 6563 742e 0a20 2020 2020 2020 203a 7061  ect..        :pa
+00013550: 7261 6d20 7461 673a 2054 6865 2074 6167  ram tag: The tag
+00013560: 206f 6620 7468 6520 6f62 6a65 6374 2074   of the object t
+00013570: 6f20 6d6f 6469 6679 2e0a 2020 2020 2020  o modify..      
+00013580: 2020 3a70 6172 616d 2075 6964 3a20 7569    :param uid: ui
+00013590: 6420 6f66 2074 6865 206f 626a 6563 7420  d of the object 
+000135a0: 746f 206d 6f64 6966 792e 0a20 2020 2020  to modify..     
+000135b0: 2020 203a 7061 7261 6d20 7061 7463 685f     :param patch_
+000135c0: 6d6f 6465 3a20 5468 6520 7374 7261 7465  mode: The strate
+000135d0: 6779 2066 6f72 206d 6572 6769 6e67 2074  gy for merging t
+000135e0: 6865 2063 6861 6e67 6573 2077 6974 6820  he changes with 
+000135f0: 7468 6520 6578 6973 7469 6e67 206f 626a  the existing obj
+00013600: 6563 742e 2043 616e 2062 6520 6569 7468  ect. Can be eith
+00013610: 6572 2060 6072 6570 6c61 6365 6060 0a20  er ``replace``. 
+00013620: 2020 2020 2020 2020 2020 206f 7220 6060             or ``
+00013630: 6164 6469 7469 7665 6060 2e0a 2020 2020  additive``..    
+00013640: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+00013650: 7072 6f6a 6563 7420 3d20 7072 6f6a 6563  project = projec
+00013660: 7420 6f72 2063 6f6e 6669 672e 6465 6661  t or config.defa
+00013670: 756c 745f 7072 6f6a 6563 740a 2020 2020  ult_project.    
+00013680: 2020 2020 7265 6665 7265 6e63 6520 3d20      reference = 
+00013690: 7365 6c66 2e5f 7265 736f 6c76 655f 7265  self._resolve_re
+000136a0: 6665 7265 6e63 6528 7461 672c 2075 6964  ference(tag, uid
+000136b0: 290a 2020 2020 2020 2020 6865 6164 6572  ).        header
+000136c0: 7320 3d20 7b6d 6c72 756e 2e63 6f6d 6d6f  s = {mlrun.commo
+000136d0: 6e2e 7363 6865 6d61 732e 4865 6164 6572  n.schemas.Header
+000136e0: 4e61 6d65 732e 7061 7463 685f 6d6f 6465  Names.patch_mode
+000136f0: 3a20 7061 7463 685f 6d6f 6465 7d0a 2020  : patch_mode}.  
+00013700: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
+00013710: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00013720: 7d2f 6665 6174 7572 652d 7365 7473 2f7b  }/feature-sets/{
+00013730: 6e61 6d65 7d2f 7265 6665 7265 6e63 6573  name}/references
+00013740: 2f7b 7265 6665 7265 6e63 657d 220a 2020  /{reference}".  
+00013750: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00013760: 6167 6520 3d20 6622 4661 696c 6564 2075  age = f"Failed u
+00013770: 7064 6174 696e 6720 6665 6174 7572 652d  pdating feature-
+00013780: 7365 7420 7b70 726f 6a65 6374 7d2f 7b6e  set {project}/{n
+00013790: 616d 657d 220a 2020 2020 2020 2020 7365  ame}".        se
+000137a0: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+000137b0: 2020 2020 2020 2020 2022 5041 5443 4822           "PATCH"
+000137c0: 2c0a 2020 2020 2020 2020 2020 2020 7061  ,.            pa
+000137d0: 7468 2c0a 2020 2020 2020 2020 2020 2020  th,.            
+000137e0: 6572 726f 725f 6d65 7373 6167 652c 0a20  error_message,. 
+000137f0: 2020 2020 2020 2020 2020 2062 6f64 793d             body=
+00013800: 6469 6374 5f74 6f5f 6a73 6f6e 2866 6561  dict_to_json(fea
+00013810: 7475 7265 5f73 6574 5f75 7064 6174 6529  ture_set_update)
+00013820: 2c0a 2020 2020 2020 2020 2020 2020 6865  ,.            he
+00013830: 6164 6572 733d 6865 6164 6572 732c 0a20  aders=headers,. 
+00013840: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00013850: 6620 6465 6c65 7465 5f66 6561 7475 7265  f delete_feature
+00013860: 5f73 6574 2873 656c 662c 206e 616d 652c  _set(self, name,
+00013870: 2070 726f 6a65 6374 3d22 222c 2074 6167   project="", tag
+00013880: 3d4e 6f6e 652c 2075 6964 3d4e 6f6e 6529  =None, uid=None)
+00013890: 3a0a 2020 2020 2020 2020 2222 2244 656c  :.        """Del
+000138a0: 6574 6520 6120 3a70 793a 636c 6173 733a  ete a :py:class:
+000138b0: 607e 6d6c 7275 6e2e 6665 6174 7572 655f  `~mlrun.feature_
+000138c0: 7374 6f72 652e 4665 6174 7572 6553 6574  store.FeatureSet
+000138d0: 6020 6f62 6a65 6374 2066 726f 6d20 7468  ` object from th
+000138e0: 6520 4442 2e0a 2020 2020 2020 2020 4966  e DB..        If
+000138f0: 2060 6074 6167 6060 206f 7220 6060 7569   ``tag`` or ``ui
+00013900: 6460 6020 6172 6520 7370 6563 6966 6965  d`` are specifie
+00013910: 642c 2074 6865 6e20 6a75 7374 2074 6865  d, then just the
+00013920: 2076 6572 7369 6f6e 2072 6566 6572 656e   version referen
+00013930: 6365 6420 6279 2074 6865 6d20 7769 6c6c  ced by them will
+00013940: 2062 6520 6465 6c65 7465 642e 2055 7369   be deleted. Usi
+00013950: 6e67 2062 6f74 680a 2020 2020 2020 2020  ng both.        
+00013960: 6973 206e 6f74 2061 6c6c 6f77 6564 2e0a  is not allowed..
+00013970: 2020 2020 2020 2020 4966 206e 6f6e 6520          If none 
+00013980: 6172 6520 7370 6563 6966 6965 642c 2074  are specified, t
+00013990: 6865 6e20 616c 6c20 696e 7374 616e 6365  hen all instance
+000139a0: 7320 6f66 2074 6865 206f 626a 6563 7420  s of the object 
+000139b0: 7768 6f73 6520 6e61 6d65 2069 7320 6060  whose name is ``
+000139c0: 6e61 6d65 6060 2077 696c 6c20 6265 2064  name`` will be d
+000139d0: 656c 6574 6564 2e0a 2020 2020 2020 2020  eleted..        
+000139e0: 2222 220a 2020 2020 2020 2020 7072 6f6a  """.        proj
+000139f0: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+00013a00: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+00013a10: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+00013a20: 7061 7468 203d 2066 2270 726f 6a65 6374  path = f"project
+00013a30: 732f 7b70 726f 6a65 6374 7d2f 6665 6174  s/{project}/feat
+00013a40: 7572 652d 7365 7473 2f7b 6e61 6d65 7d22  ure-sets/{name}"
+00013a50: 0a0a 2020 2020 2020 2020 6966 2074 6167  ..        if tag
+00013a60: 206f 7220 7569 643a 0a20 2020 2020 2020   or uid:.       
+00013a70: 2020 2020 2072 6566 6572 656e 6365 203d       reference =
+00013a80: 2073 656c 662e 5f72 6573 6f6c 7665 5f72   self._resolve_r
+00013a90: 6566 6572 656e 6365 2874 6167 2c20 7569  eference(tag, ui
+00013aa0: 6429 0a20 2020 2020 2020 2020 2020 2070  d).            p
+00013ab0: 6174 6820 3d20 7061 7468 202b 2066 222f  ath = path + f"/
+00013ac0: 7265 6665 7265 6e63 6573 2f7b 7265 6665  references/{refe
+00013ad0: 7265 6e63 657d 220a 0a20 2020 2020 2020  rence}"..       
+00013ae0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00013af0: 2066 2246 6169 6c65 6420 6465 6c65 7469   f"Failed deleti
+00013b00: 6e67 2066 6561 7475 7265 2d73 6574 207b  ng feature-set {
+00013b10: 6e61 6d65 7d22 0a20 2020 2020 2020 2073  name}".        s
+00013b20: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
+00013b30: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
+00013b40: 6f72 5f6d 6573 7361 6765 290a 0a20 2020  or_message)..   
+00013b50: 2064 6566 2063 7265 6174 655f 6665 6174   def create_feat
+00013b60: 7572 655f 7665 6374 6f72 280a 2020 2020  ure_vector(.    
+00013b70: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+00013b80: 2020 6665 6174 7572 655f 7665 6374 6f72    feature_vector
+00013b90: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
+00013ba0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+00013bb0: 6173 2e46 6561 7475 7265 5665 6374 6f72  as.FeatureVector
+00013bc0: 2c20 4665 6174 7572 6556 6563 746f 725d  , FeatureVector]
+00013bd0: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+00013be0: 743d 2222 2c0a 2020 2020 2020 2020 7665  t="",.        ve
+00013bf0: 7273 696f 6e65 643d 5472 7565 2c0a 2020  rsioned=True,.  
+00013c00: 2020 2920 2d3e 2064 6963 743a 0a20 2020    ) -> dict:.   
+00013c10: 2020 2020 2022 2222 4372 6561 7465 2061       """Create a
+00013c20: 206e 6577 203a 7079 3a63 6c61 7373 3a60   new :py:class:`
+00013c30: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00013c40: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
+00013c50: 6f72 6020 616e 6420 7361 7665 2069 6e20  or` and save in 
+00013c60: 7468 6520 3a70 793a 6d6f 643a 606d 6c72  the :py:mod:`mlr
+00013c70: 756e 6020 4442 2e0a 0a20 2020 2020 2020  un` DB...       
+00013c80: 203a 7061 7261 6d20 6665 6174 7572 655f   :param feature_
+00013c90: 7665 6374 6f72 3a20 5468 6520 6e65 7720  vector: The new 
+00013ca0: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
+00013cb0: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
+00013cc0: 4665 6174 7572 6556 6563 746f 7260 2074  FeatureVector` t
+00013cd0: 6f20 6372 6561 7465 2e0a 2020 2020 2020  o create..      
+00013ce0: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+00013cf0: 3a20 4e61 6d65 206f 6620 7072 6f6a 6563  : Name of projec
+00013d00: 7420 7468 6973 2066 6561 7475 7265 2d76  t this feature-v
+00013d10: 6563 746f 7220 6265 6c6f 6e67 7320 746f  ector belongs to
+00013d20: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00013d30: 2076 6572 7369 6f6e 6564 3a20 5768 6574   versioned: Whet
+00013d40: 6865 7220 746f 206d 6169 6e74 6169 6e20  her to maintain 
+00013d50: 7665 7273 696f 6e73 2066 6f72 2074 6869  versions for thi
+00013d60: 7320 6665 6174 7572 652d 7665 6374 6f72  s feature-vector
+00013d70: 2e20 416c 6c20 7665 7273 696f 6e73 206f  . All versions o
+00013d80: 6620 6120 7665 7273 696f 6e65 6420 6f62  f a versioned ob
+00013d90: 6a65 6374 0a20 2020 2020 2020 2020 2020  ject.           
+00013da0: 2077 696c 6c20 6265 206b 6570 7420 696e   will be kept in
+00013db0: 2074 6865 2044 4220 616e 6420 6361 6e20   the DB and can 
+00013dc0: 6265 2072 6574 7269 6576 6564 2075 6e74  be retrieved unt
+00013dd0: 696c 2065 7870 6c69 6369 746c 7920 6465  il explicitly de
+00013de0: 6c65 7465 642e 0a20 2020 2020 2020 203a  leted..        :
+00013df0: 7265 7475 726e 733a 2054 6865 203a 7079  returns: The :py
+00013e00: 3a63 6c61 7373 3a60 7e6d 6c72 756e 2e66  :class:`~mlrun.f
+00013e10: 6561 7475 7265 5f73 746f 7265 2e46 6561  eature_store.Fea
+00013e20: 7475 7265 5665 6374 6f72 6020 6f62 6a65  tureVector` obje
+00013e30: 6374 2028 6173 2064 6963 7429 2e0a 2020  ct (as dict)..  
+00013e40: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00013e50: 2020 6966 2069 7369 6e73 7461 6e63 6528    if isinstance(
+00013e60: 6665 6174 7572 655f 7665 6374 6f72 2c20  feature_vector, 
+00013e70: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00013e80: 656d 6173 2e46 6561 7475 7265 5665 6374  emas.FeatureVect
+00013e90: 6f72 293a 0a20 2020 2020 2020 2020 2020  or):.           
+00013ea0: 2066 6561 7475 7265 5f76 6563 746f 7220   feature_vector 
+00013eb0: 3d20 6665 6174 7572 655f 7665 6374 6f72  = feature_vector
+00013ec0: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
+00013ed0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+00013ee0: 6665 6174 7572 655f 7665 6374 6f72 2c20  feature_vector, 
+00013ef0: 4665 6174 7572 6556 6563 746f 7229 3a0a  FeatureVector):.
+00013f00: 2020 2020 2020 2020 2020 2020 6665 6174              feat
+00013f10: 7572 655f 7665 6374 6f72 203d 2066 6561  ure_vector = fea
+00013f20: 7475 7265 5f76 6563 746f 722e 746f 5f64  ture_vector.to_d
+00013f30: 6963 7428 290a 0a20 2020 2020 2020 2070  ict()..        p
+00013f40: 726f 6a65 6374 203d 2028 0a20 2020 2020  roject = (.     
+00013f50: 2020 2020 2020 2070 726f 6a65 6374 0a20         project. 
+00013f60: 2020 2020 2020 2020 2020 206f 7220 6665             or fe
+00013f70: 6174 7572 655f 7665 6374 6f72 5b22 6d65  ature_vector["me
+00013f80: 7461 6461 7461 225d 2e67 6574 2822 7072  tadata"].get("pr
+00013f90: 6f6a 6563 7422 2c20 4e6f 6e65 290a 2020  oject", None).  
+00013fa0: 2020 2020 2020 2020 2020 6f72 2063 6f6e            or con
+00013fb0: 6669 672e 6465 6661 756c 745f 7072 6f6a  fig.default_proj
+00013fc0: 6563 740a 2020 2020 2020 2020 290a 2020  ect.        ).  
+00013fd0: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
+00013fe0: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00013ff0: 7d2f 6665 6174 7572 652d 7665 6374 6f72  }/feature-vector
+00014000: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
+00014010: 7320 3d20 7b22 7665 7273 696f 6e65 6422  s = {"versioned"
+00014020: 3a20 7665 7273 696f 6e65 647d 0a0a 2020  : versioned}..  
+00014030: 2020 2020 2020 6e61 6d65 203d 2066 6561        name = fea
+00014040: 7475 7265 5f76 6563 746f 725b 226d 6574  ture_vector["met
+00014050: 6164 6174 6122 5d5b 226e 616d 6522 5d0a  adata"]["name"].
+00014060: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
+00014070: 7373 6167 6520 3d20 6622 4661 696c 6564  ssage = f"Failed
+00014080: 2063 7265 6174 696e 6720 6665 6174 7572   creating featur
+00014090: 652d 7665 6374 6f72 207b 7072 6f6a 6563  e-vector {projec
+000140a0: 747d 2f7b 6e61 6d65 7d22 0a20 2020 2020  t}/{name}".     
+000140b0: 2020 2072 6573 7020 3d20 7365 6c66 2e61     resp = self.a
+000140c0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+000140d0: 2020 2020 2022 504f 5354 222c 0a20 2020       "POST",.   
+000140e0: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
+000140f0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+00014100: 5f6d 6573 7361 6765 2c0a 2020 2020 2020  _message,.      
+00014110: 2020 2020 2020 7061 7261 6d73 3d70 6172        params=par
+00014120: 616d 732c 0a20 2020 2020 2020 2020 2020  ams,.           
+00014130: 2062 6f64 793d 6469 6374 5f74 6f5f 6a73   body=dict_to_js
+00014140: 6f6e 2866 6561 7475 7265 5f76 6563 746f  on(feature_vecto
+00014150: 7229 2c0a 2020 2020 2020 2020 290a 2020  r),.        ).  
+00014160: 2020 2020 2020 7265 7475 726e 2072 6573        return res
+00014170: 702e 6a73 6f6e 2829 0a0a 2020 2020 6465  p.json()..    de
+00014180: 6620 6765 745f 6665 6174 7572 655f 7665  f get_feature_ve
+00014190: 6374 6f72 280a 2020 2020 2020 2020 7365  ctor(.        se
+000141a0: 6c66 2c20 6e61 6d65 3a20 7374 722c 2070  lf, name: str, p
+000141b0: 726f 6a65 6374 3a20 7374 7220 3d20 2222  roject: str = ""
+000141c0: 2c20 7461 673a 2073 7472 203d 204e 6f6e  , tag: str = Non
+000141d0: 652c 2075 6964 3a20 7374 7220 3d20 4e6f  e, uid: str = No
+000141e0: 6e65 0a20 2020 2029 202d 3e20 4665 6174  ne.    ) -> Feat
+000141f0: 7572 6556 6563 746f 723a 0a20 2020 2020  ureVector:.     
+00014200: 2020 2022 2222 5265 7475 726e 2061 2073     """Return a s
+00014210: 7065 6369 6669 6320 6665 6174 7572 652d  pecific feature-
+00014220: 7665 6374 6f72 2072 6566 6572 656e 6365  vector reference
+00014230: 6420 6279 2069 7473 2074 6167 206f 7220  d by its tag or 
+00014240: 7569 642e 2049 6620 6e6f 6e65 2061 7265  uid. If none are
+00014250: 2070 726f 7669 6465 642c 2060 606c 6174   provided, ``lat
+00014260: 6573 7460 6020 7461 6720 7769 6c6c 0a20  est`` tag will. 
+00014270: 2020 2020 2020 2062 6520 7573 6564 2e22         be used."
+00014280: 2222 0a0a 2020 2020 2020 2020 7072 6f6a  ""..        proj
+00014290: 6563 7420 3d20 7072 6f6a 6563 7420 6f72  ect = project or
+000142a0: 2063 6f6e 6669 672e 6465 6661 756c 745f   config.default_
+000142b0: 7072 6f6a 6563 740a 2020 2020 2020 2020  project.        
+000142c0: 7265 6665 7265 6e63 6520 3d20 7365 6c66  reference = self
+000142d0: 2e5f 7265 736f 6c76 655f 7265 6665 7265  ._resolve_refere
+000142e0: 6e63 6528 7461 672c 2075 6964 290a 2020  nce(tag, uid).  
+000142f0: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
+00014300: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+00014310: 7d2f 6665 6174 7572 652d 7665 6374 6f72  }/feature-vector
+00014320: 732f 7b6e 616d 657d 2f72 6566 6572 656e  s/{name}/referen
+00014330: 6365 732f 7b72 6566 6572 656e 6365 7d22  ces/{reference}"
+00014340: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
+00014350: 6573 7361 6765 203d 2066 2246 6169 6c65  essage = f"Faile
+00014360: 6420 7265 7472 6965 7669 6e67 2066 6561  d retrieving fea
+00014370: 7475 7265 2d76 6563 746f 7220 7b70 726f  ture-vector {pro
+00014380: 6a65 6374 7d2f 7b6e 616d 657d 220a 2020  ject}/{name}".  
+00014390: 2020 2020 2020 7265 7370 203d 2073 656c        resp = sel
+000143a0: 662e 6170 695f 6361 6c6c 2822 4745 5422  f.api_call("GET"
+000143b0: 2c20 7061 7468 2c20 6572 726f 725f 6d65  , path, error_me
+000143c0: 7373 6167 6529 0a20 2020 2020 2020 2072  ssage).        r
+000143d0: 6574 7572 6e20 4665 6174 7572 6556 6563  eturn FeatureVec
+000143e0: 746f 722e 6672 6f6d 5f64 6963 7428 7265  tor.from_dict(re
+000143f0: 7370 2e6a 736f 6e28 2929 0a0a 2020 2020  sp.json())..    
+00014400: 6465 6620 6c69 7374 5f66 6561 7475 7265  def list_feature
+00014410: 5f76 6563 746f 7273 280a 2020 2020 2020  _vectors(.      
+00014420: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00014430: 7072 6f6a 6563 743a 2073 7472 203d 2022  project: str = "
+00014440: 222c 0a20 2020 2020 2020 206e 616d 653a  ",.        name:
+00014450: 2073 7472 203d 204e 6f6e 652c 0a20 2020   str = None,.   
+00014460: 2020 2020 2074 6167 3a20 7374 7220 3d20       tag: str = 
+00014470: 4e6f 6e65 2c0a 2020 2020 2020 2020 7374  None,.        st
+00014480: 6174 653a 2073 7472 203d 204e 6f6e 652c  ate: str = None,
+00014490: 0a20 2020 2020 2020 206c 6162 656c 733a  .        labels:
+000144a0: 204c 6973 745b 7374 725d 203d 204e 6f6e   List[str] = Non
+000144b0: 652c 0a20 2020 2020 2020 2070 6172 7469  e,.        parti
+000144c0: 7469 6f6e 5f62 793a 2055 6e69 6f6e 5b0a  tion_by: Union[.
+000144d0: 2020 2020 2020 2020 2020 2020 6d6c 7275              mlru
+000144e0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+000144f0: 2e46 6561 7475 7265 5374 6f72 6550 6172  .FeatureStorePar
+00014500: 7469 7469 6f6e 4279 4669 656c 642c 2073  titionByField, s
+00014510: 7472 0a20 2020 2020 2020 205d 203d 204e  tr.        ] = N
+00014520: 6f6e 652c 0a20 2020 2020 2020 2072 6f77  one,.        row
+00014530: 735f 7065 725f 7061 7274 6974 696f 6e3a  s_per_partition:
+00014540: 2069 6e74 203d 2031 2c0a 2020 2020 2020   int = 1,.      
+00014550: 2020 7061 7274 6974 696f 6e5f 736f 7274    partition_sort
+00014560: 5f62 793a 2055 6e69 6f6e 5b6d 6c72 756e  _by: Union[mlrun
+00014570: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00014580: 536f 7274 4669 656c 642c 2073 7472 5d20  SortField, str] 
+00014590: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+000145a0: 7061 7274 6974 696f 6e5f 6f72 6465 723a  partition_order:
+000145b0: 2055 6e69 6f6e 5b0a 2020 2020 2020 2020   Union[.        
+000145c0: 2020 2020 6d6c 7275 6e2e 636f 6d6d 6f6e      mlrun.common
+000145d0: 2e73 6368 656d 6173 2e4f 7264 6572 5479  .schemas.OrderTy
+000145e0: 7065 2c20 7374 720a 2020 2020 2020 2020  pe, str.        
+000145f0: 5d20 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e  ] = mlrun.common
+00014600: 2e73 6368 656d 6173 2e4f 7264 6572 5479  .schemas.OrderTy
+00014610: 7065 2e64 6573 632c 0a20 2020 2029 202d  pe.desc,.    ) -
+00014620: 3e20 4c69 7374 5b46 6561 7475 7265 5665  > List[FeatureVe
+00014630: 6374 6f72 5d3a 0a20 2020 2020 2020 2022  ctor]:.        "
+00014640: 2222 5265 7472 6965 7665 2061 206c 6973  ""Retrieve a lis
+00014650: 7420 6f66 2066 6561 7475 7265 2d76 6563  t of feature-vec
+00014660: 746f 7273 206d 6174 6368 696e 6720 7468  tors matching th
+00014670: 6520 6372 6974 6572 6961 2070 726f 7669  e criteria provi
+00014680: 6465 642e 0a0a 2020 2020 2020 2020 3a70  ded...        :p
+00014690: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+000146a0: 6f6a 6563 7420 6e61 6d65 2e0a 2020 2020  oject name..    
+000146b0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
+000146c0: 204e 616d 6520 6f66 2066 6561 7475 7265   Name of feature
+000146d0: 2d76 6563 746f 7220 746f 206d 6174 6368  -vector to match
+000146e0: 2e20 5468 6973 2069 7320 6120 6c69 6b65  . This is a like
+000146f0: 2071 7565 7279 2c20 616e 6420 6973 2063   query, and is c
+00014700: 6173 652d 696e 7365 6e73 6974 6976 652e  ase-insensitive.
+00014710: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+00014720: 7461 673a 204d 6174 6368 2066 6561 7475  tag: Match featu
+00014730: 7265 2d76 6563 746f 7273 2077 6974 6820  re-vectors with 
+00014740: 7370 6563 6966 6963 2074 6167 2e0a 2020  specific tag..  
+00014750: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
+00014760: 7465 3a20 4d61 7463 6820 6665 6174 7572  te: Match featur
+00014770: 652d 7665 6374 6f72 7320 7769 7468 2061  e-vectors with a
+00014780: 2073 7065 6369 6669 6320 7374 6174 652e   specific state.
+00014790: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+000147a0: 6c61 6265 6c73 3a20 4d61 7463 6820 6665  labels: Match fe
+000147b0: 6174 7572 652d 7665 6374 6f72 7320 7768  ature-vectors wh
+000147c0: 6963 6820 6861 7665 2074 6865 7365 206c  ich have these l
+000147d0: 6162 656c 732e 0a20 2020 2020 2020 203a  abels..        :
+000147e0: 7061 7261 6d20 7061 7274 6974 696f 6e5f  param partition_
+000147f0: 6279 3a20 4669 656c 6420 746f 2067 726f  by: Field to gro
+00014800: 7570 2072 6573 756c 7473 2062 792e 204f  up results by. O
+00014810: 6e6c 7920 616c 6c6f 7765 6420 7661 6c75  nly allowed valu
+00014820: 6520 6973 2060 6e61 6d65 602e 2057 6865  e is `name`. Whe
+00014830: 6e20 6070 6172 7469 7469 6f6e 5f62 7960  n `partition_by`
+00014840: 2069 7320 7370 6563 6966 6965 642c 0a20   is specified,. 
+00014850: 2020 2020 2020 2020 2020 2074 6865 2060             the `
+00014860: 7061 7274 6974 696f 6e5f 736f 7274 5f62  partition_sort_b
+00014870: 7960 2070 6172 616d 6574 6572 206d 7573  y` parameter mus
+00014880: 7420 6265 2070 726f 7669 6465 6420 6173  t be provided as
+00014890: 2077 656c 6c2e 0a20 2020 2020 2020 203a   well..        :
+000148a0: 7061 7261 6d20 726f 7773 5f70 6572 5f70  param rows_per_p
+000148b0: 6172 7469 7469 6f6e 3a20 486f 7720 6d61  artition: How ma
+000148c0: 6e79 2074 6f70 2072 6f77 7320 2870 6572  ny top rows (per
+000148d0: 2073 6f72 7469 6e67 2064 6566 696e 6564   sorting defined
+000148e0: 2062 7920 6070 6172 7469 7469 6f6e 5f73   by `partition_s
+000148f0: 6f72 745f 6279 6020 616e 6420 6070 6172  ort_by` and `par
+00014900: 7469 7469 6f6e 5f6f 7264 6572 6029 0a20  tition_order`). 
+00014910: 2020 2020 2020 2020 2020 2074 6f20 7265             to re
+00014920: 7475 726e 2070 6572 2067 726f 7570 2e20  turn per group. 
+00014930: 4465 6661 756c 7420 7661 6c75 6520 6973  Default value is
+00014940: 2031 2e0a 2020 2020 2020 2020 3a70 6172   1..        :par
+00014950: 616d 2070 6172 7469 7469 6f6e 5f73 6f72  am partition_sor
+00014960: 745f 6279 3a20 5768 6174 2066 6965 6c64  t_by: What field
+00014970: 2074 6f20 736f 7274 2074 6865 2072 6573   to sort the res
+00014980: 756c 7473 2062 792c 2077 6974 6869 6e20  ults by, within 
+00014990: 6561 6368 2070 6172 7469 7469 6f6e 2064  each partition d
+000149a0: 6566 696e 6564 2062 7920 6070 6172 7469  efined by `parti
+000149b0: 7469 6f6e 5f62 7960 2e0a 2020 2020 2020  tion_by`..      
+000149c0: 2020 2020 2020 4375 7272 656e 746c 7920        Currently 
+000149d0: 7468 6520 6f6e 6c79 2061 6c6c 6f77 6564  the only allowed
+000149e0: 2076 616c 7565 7320 6172 6520 6063 7265   values are `cre
+000149f0: 6174 6564 6020 616e 6420 6075 7064 6174  ated` and `updat
+00014a00: 6564 602e 0a20 2020 2020 2020 203a 7061  ed`..        :pa
+00014a10: 7261 6d20 7061 7274 6974 696f 6e5f 6f72  ram partition_or
+00014a20: 6465 723a 204f 7264 6572 206f 6620 736f  der: Order of so
+00014a30: 7274 696e 6720 7769 7468 696e 2070 6172  rting within par
+00014a40: 7469 7469 6f6e 7320 2d20 6061 7363 6020  titions - `asc` 
+00014a50: 6f72 2060 6465 7363 602e 2044 6566 6175  or `desc`. Defau
+00014a60: 6c74 2069 7320 6064 6573 6360 2e0a 2020  lt is `desc`..  
+00014a70: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+00014a80: 4c69 7374 206f 6620 6d61 7463 6869 6e67  List of matching
+00014a90: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+00014aa0: 756e 2e66 6561 7475 7265 5f73 746f 7265  un.feature_store
+00014ab0: 2e46 6561 7475 7265 5665 6374 6f72 6020  .FeatureVector` 
+00014ac0: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
+00014ad0: 2022 2222 0a0a 2020 2020 2020 2020 7072   """..        pr
+00014ae0: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+00014af0: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+00014b00: 745f 7072 6f6a 6563 740a 0a20 2020 2020  t_project..     
+00014b10: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+00014b20: 2020 2020 2020 2020 2020 226e 616d 6522            "name"
+00014b30: 3a20 6e61 6d65 2c0a 2020 2020 2020 2020  : name,.        
+00014b40: 2020 2020 2273 7461 7465 223a 2073 7461      "state": sta
+00014b50: 7465 2c0a 2020 2020 2020 2020 2020 2020  te,.            
+00014b60: 2274 6167 223a 2074 6167 2c0a 2020 2020  "tag": tag,.    
+00014b70: 2020 2020 2020 2020 226c 6162 656c 223a          "label":
+00014b80: 206c 6162 656c 7320 6f72 205b 5d2c 0a20   labels or [],. 
+00014b90: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00014ba0: 2069 6620 7061 7274 6974 696f 6e5f 6279   if partition_by
+00014bb0: 3a0a 2020 2020 2020 2020 2020 2020 7061  :.            pa
+00014bc0: 7261 6d73 2e75 7064 6174 6528 0a20 2020  rams.update(.   
+00014bd0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+00014be0: 662e 5f67 656e 6572 6174 655f 7061 7274  f._generate_part
+00014bf0: 6974 696f 6e5f 6279 5f70 6172 616d 7328  ition_by_params(
+00014c00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c10: 2020 2020 206d 6c72 756e 2e63 6f6d 6d6f       mlrun.commo
+00014c20: 6e2e 7363 6865 6d61 732e 4665 6174 7572  n.schemas.Featur
+00014c30: 6553 746f 7265 5061 7274 6974 696f 6e42  eStorePartitionB
+00014c40: 7946 6965 6c64 2c0a 2020 2020 2020 2020  yField,.        
+00014c50: 2020 2020 2020 2020 2020 2020 7061 7274              part
+00014c60: 6974 696f 6e5f 6279 2c0a 2020 2020 2020  ition_by,.      
+00014c70: 2020 2020 2020 2020 2020 2020 2020 726f                ro
+00014c80: 7773 5f70 6572 5f70 6172 7469 7469 6f6e  ws_per_partition
+00014c90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+00014ca0: 2020 2020 2020 7061 7274 6974 696f 6e5f        partition_
+00014cb0: 736f 7274 5f62 792c 0a20 2020 2020 2020  sort_by,.       
+00014cc0: 2020 2020 2020 2020 2020 2020 2070 6172               par
+00014cd0: 7469 7469 6f6e 5f6f 7264 6572 2c0a 2020  tition_order,.  
+00014ce0: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00014cf0: 2020 2020 2020 2020 2020 2020 290a 0a20              ).. 
+00014d00: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+00014d10: 7072 6f6a 6563 7473 2f7b 7072 6f6a 6563  projects/{projec
+00014d20: 747d 2f66 6561 7475 7265 2d76 6563 746f  t}/feature-vecto
+00014d30: 7273 220a 0a20 2020 2020 2020 2065 7272  rs"..        err
+00014d40: 6f72 5f6d 6573 7361 6765 203d 2028 0a20  or_message = (. 
+00014d50: 2020 2020 2020 2020 2020 2066 2246 6169             f"Fai
+00014d60: 6c65 6420 6c69 7374 696e 6720 6665 6174  led listing feat
+00014d70: 7572 652d 7665 6374 6f72 732c 2070 726f  ure-vectors, pro
+00014d80: 6a65 6374 3a20 7b70 726f 6a65 6374 7d2c  ject: {project},
+00014d90: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
+00014da0: 220a 2020 2020 2020 2020 290a 2020 2020  ".        ).    
+00014db0: 2020 2020 7265 7370 203d 2073 656c 662e      resp = self.
+00014dc0: 6170 695f 6361 6c6c 2822 4745 5422 2c20  api_call("GET", 
+00014dd0: 7061 7468 2c20 6572 726f 725f 6d65 7373  path, error_mess
+00014de0: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
+00014df0: 6d73 290a 2020 2020 2020 2020 6665 6174  ms).        feat
+00014e00: 7572 655f 7665 6374 6f72 7320 3d20 7265  ure_vectors = re
+00014e10: 7370 2e6a 736f 6e28 295b 2266 6561 7475  sp.json()["featu
+00014e20: 7265 5f76 6563 746f 7273 225d 0a20 2020  re_vectors"].   
+00014e30: 2020 2020 2069 6620 6665 6174 7572 655f       if feature_
+00014e40: 7665 6374 6f72 733a 0a20 2020 2020 2020  vectors:.       
+00014e50: 2020 2020 2072 6574 7572 6e20 5b46 6561       return [Fea
+00014e60: 7475 7265 5665 6374 6f72 2e66 726f 6d5f  tureVector.from_
+00014e70: 6469 6374 286f 626a 2920 666f 7220 6f62  dict(obj) for ob
+00014e80: 6a20 696e 2066 6561 7475 7265 5f76 6563  j in feature_vec
+00014e90: 746f 7273 5d0a 0a20 2020 2064 6566 2073  tors]..    def s
+00014ea0: 746f 7265 5f66 6561 7475 7265 5f76 6563  tore_feature_vec
+00014eb0: 746f 7228 0a20 2020 2020 2020 2073 656c  tor(.        sel
+00014ec0: 662c 0a20 2020 2020 2020 2066 6561 7475  f,.        featu
+00014ed0: 7265 5f76 6563 746f 723a 2055 6e69 6f6e  re_vector: Union
+00014ee0: 5b64 6963 742c 206d 6c72 756e 2e63 6f6d  [dict, mlrun.com
+00014ef0: 6d6f 6e2e 7363 6865 6d61 732e 4665 6174  mon.schemas.Feat
+00014f00: 7572 6556 6563 746f 722c 2046 6561 7475  ureVector, Featu
+00014f10: 7265 5665 6374 6f72 5d2c 0a20 2020 2020  reVector],.     
+00014f20: 2020 206e 616d 653d 4e6f 6e65 2c0a 2020     name=None,.  
+00014f30: 2020 2020 2020 7072 6f6a 6563 743d 2222        project=""
+00014f40: 2c0a 2020 2020 2020 2020 7461 673d 4e6f  ,.        tag=No
+00014f50: 6e65 2c0a 2020 2020 2020 2020 7569 643d  ne,.        uid=
+00014f60: 4e6f 6e65 2c0a 2020 2020 2020 2020 7665  None,.        ve
+00014f70: 7273 696f 6e65 643d 5472 7565 2c0a 2020  rsioned=True,.  
+00014f80: 2020 2920 2d3e 2064 6963 743a 0a20 2020    ) -> dict:.   
+00014f90: 2020 2020 2022 2222 5374 6f72 6520 6120       """Store a 
+00014fa0: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
+00014fb0: 6e2e 6665 6174 7572 655f 7374 6f72 652e  n.feature_store.
+00014fc0: 4665 6174 7572 6556 6563 746f 7260 206f  FeatureVector` o
+00014fd0: 626a 6563 7420 696e 2074 6865 203a 7079  bject in the :py
+00014fe0: 3a6d 6f64 3a60 6d6c 7275 6e60 2044 422e  :mod:`mlrun` DB.
+00014ff0: 2054 6865 0a20 2020 2020 2020 2066 6561   The.        fea
+00015000: 7475 7265 2d76 6563 746f 7220 6361 6e20  ture-vector can 
+00015010: 6265 2065 6974 6865 7220 6120 6e65 7720  be either a new 
+00015020: 6f62 6a65 6374 206f 7220 6120 6d6f 6469  object or a modi
+00015030: 6669 6361 7469 6f6e 2074 6f20 6578 6973  fication to exis
+00015040: 7469 6e67 206f 626a 6563 7420 7265 6665  ting object refe
+00015050: 7265 6e63 6564 2062 7920 7468 6520 7061  renced by the pa
+00015060: 7261 6d73 0a20 2020 2020 2020 206f 6620  rams.        of 
+00015070: 7468 6520 6675 6e63 7469 6f6e 2e0a 0a20  the function... 
+00015080: 2020 2020 2020 203a 7061 7261 6d20 6665         :param fe
+00015090: 6174 7572 655f 7665 6374 6f72 3a20 5468  ature_vector: Th
+000150a0: 6520 3a70 793a 636c 6173 733a 607e 6d6c  e :py:class:`~ml
+000150b0: 7275 6e2e 6665 6174 7572 655f 7374 6f72  run.feature_stor
+000150c0: 652e 4665 6174 7572 6556 6563 746f 7260  e.FeatureVector`
+000150d0: 2074 6f20 7374 6f72 652e 0a20 2020 2020   to store..     
+000150e0: 2020 203a 7061 7261 6d20 6e61 6d65 3a20     :param name: 
+000150f0: 2020 204e 616d 6520 6f66 2066 6561 7475     Name of featu
+00015100: 7265 2076 6563 746f 722e 0a20 2020 2020  re vector..     
+00015110: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00015120: 743a 204e 616d 6520 6f66 2070 726f 6a65  t: Name of proje
+00015130: 6374 2074 6869 7320 6665 6174 7572 652d  ct this feature-
+00015140: 7665 6374 6f72 2062 656c 6f6e 6773 2074  vector belongs t
+00015150: 6f2e 0a20 2020 2020 2020 203a 7061 7261  o..        :para
+00015160: 6d20 7461 673a 2054 6865 2060 6074 6167  m tag: The ``tag
+00015170: 6060 206f 6620 7468 6520 6f62 6a65 6374  `` of the object
+00015180: 2074 6f20 7265 706c 6163 6520 696e 2074   to replace in t
+00015190: 6865 2044 422c 2066 6f72 2065 7861 6d70  he DB, for examp
+000151a0: 6c65 2060 606c 6174 6573 7460 602e 0a20  le ``latest``.. 
+000151b0: 2020 2020 2020 203a 7061 7261 6d20 7569         :param ui
+000151c0: 643a 2054 6865 2060 6075 6964 6060 206f  d: The ``uid`` o
+000151d0: 6620 7468 6520 6f62 6a65 6374 2074 6f20  f the object to 
+000151e0: 7265 706c 6163 6520 696e 2074 6865 2044  replace in the D
+000151f0: 422e 2049 6620 7573 696e 6720 7468 6973  B. If using this
+00015200: 2070 6172 616d 6574 6572 2c20 7468 6520   parameter, the 
+00015210: 6d6f 6469 6669 6564 206f 626a 6563 740a  modified object.
+00015220: 2020 2020 2020 2020 2020 2020 6d75 7374              must
+00015230: 2068 6176 6520 7468 6520 7361 6d65 2060   have the same `
+00015240: 6075 6964 6060 206f 6620 7468 6520 7072  `uid`` of the pr
+00015250: 6576 696f 7573 6c79 2d65 7869 7374 696e  eviously-existin
+00015260: 6720 6f62 6a65 6374 2e20 5468 6973 2063  g object. This c
+00015270: 616e 6e6f 7420 6265 2075 7365 6420 666f  annot be used fo
+00015280: 7220 6e6f 6e2d 7665 7273 696f 6e65 6420  r non-versioned 
+00015290: 6f62 6a65 6374 732e 0a20 2020 2020 2020  objects..       
+000152a0: 203a 7061 7261 6d20 7665 7273 696f 6e65   :param versione
+000152b0: 643a 2057 6865 7468 6572 2074 6f20 6d61  d: Whether to ma
+000152c0: 696e 7461 696e 2076 6572 7369 6f6e 7320  intain versions 
+000152d0: 666f 7220 7468 6973 2066 6561 7475 7265  for this feature
+000152e0: 2d76 6563 746f 722e 2041 6c6c 2076 6572  -vector. All ver
+000152f0: 7369 6f6e 7320 6f66 2061 2076 6572 7369  sions of a versi
+00015300: 6f6e 6564 206f 626a 6563 740a 2020 2020  oned object.    
+00015310: 2020 2020 2020 2020 7769 6c6c 2062 6520          will be 
+00015320: 6b65 7074 2069 6e20 7468 6520 4442 2061  kept in the DB a
+00015330: 6e64 2063 616e 2062 6520 7265 7472 6965  nd can be retrie
+00015340: 7665 6420 756e 7469 6c20 6578 706c 6963  ved until explic
+00015350: 6974 6c79 2064 656c 6574 6564 2e0a 2020  itly deleted..  
+00015360: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
+00015370: 5468 6520 3a70 793a 636c 6173 733a 607e  The :py:class:`~
+00015380: 6d6c 7275 6e2e 6665 6174 7572 655f 7374  mlrun.feature_st
+00015390: 6f72 652e 4665 6174 7572 6556 6563 746f  ore.FeatureVecto
+000153a0: 7260 206f 626a 6563 7420 2861 7320 6469  r` object (as di
+000153b0: 6374 292e 0a20 2020 2020 2020 2022 2222  ct)..        """
+000153c0: 0a0a 2020 2020 2020 2020 7265 6665 7265  ..        refere
+000153d0: 6e63 6520 3d20 7365 6c66 2e5f 7265 736f  nce = self._reso
+000153e0: 6c76 655f 7265 6665 7265 6e63 6528 7461  lve_reference(ta
+000153f0: 672c 2075 6964 290a 2020 2020 2020 2020  g, uid).        
+00015400: 7061 7261 6d73 203d 207b 2276 6572 7369  params = {"versi
+00015410: 6f6e 6564 223a 2076 6572 7369 6f6e 6564  oned": versioned
+00015420: 7d0a 0a20 2020 2020 2020 2069 6620 6973  }..        if is
+00015430: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
+00015440: 5f76 6563 746f 722c 206d 6c72 756e 2e63  _vector, mlrun.c
+00015450: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4665  ommon.schemas.Fe
+00015460: 6174 7572 6556 6563 746f 7229 3a0a 2020  atureVector):.  
+00015470: 2020 2020 2020 2020 2020 6665 6174 7572            featur
+00015480: 655f 7665 6374 6f72 203d 2066 6561 7475  e_vector = featu
+00015490: 7265 5f76 6563 746f 722e 6469 6374 2829  re_vector.dict()
+000154a0: 0a20 2020 2020 2020 2065 6c69 6620 6973  .        elif is
+000154b0: 696e 7374 616e 6365 2866 6561 7475 7265  instance(feature
+000154c0: 5f76 6563 746f 722c 2046 6561 7475 7265  _vector, Feature
+000154d0: 5665 6374 6f72 293a 0a20 2020 2020 2020  Vector):.       
+000154e0: 2020 2020 2066 6561 7475 7265 5f76 6563       feature_vec
+000154f0: 746f 7220 3d20 6665 6174 7572 655f 7665  tor = feature_ve
+00015500: 6374 6f72 2e74 6f5f 6469 6374 2829 0a0a  ctor.to_dict()..
+00015510: 2020 2020 2020 2020 6e61 6d65 203d 206e          name = n
+00015520: 616d 6520 6f72 2066 6561 7475 7265 5f76  ame or feature_v
+00015530: 6563 746f 725b 226d 6574 6164 6174 6122  ector["metadata"
+00015540: 5d5b 226e 616d 6522 5d0a 2020 2020 2020  ]["name"].      
+00015550: 2020 7072 6f6a 6563 7420 3d20 280a 2020    project = (.  
+00015560: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
+00015570: 740a 2020 2020 2020 2020 2020 2020 6f72  t.            or
+00015580: 2066 6561 7475 7265 5f76 6563 746f 725b   feature_vector[
+00015590: 226d 6574 6164 6174 6122 5d2e 6765 7428  "metadata"].get(
+000155a0: 2270 726f 6a65 6374 2229 0a20 2020 2020  "project").     
+000155b0: 2020 2020 2020 206f 7220 636f 6e66 6967         or config
+000155c0: 2e64 6566 6175 6c74 5f70 726f 6a65 6374  .default_project
+000155d0: 0a20 2020 2020 2020 2029 0a20 2020 2020  .        ).     
+000155e0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+000155f0: 6563 7473 2f7b 7072 6f6a 6563 747d 2f66  ects/{project}/f
+00015600: 6561 7475 7265 2d76 6563 746f 7273 2f7b  eature-vectors/{
+00015610: 6e61 6d65 7d2f 7265 6665 7265 6e63 6573  name}/references
+00015620: 2f7b 7265 6665 7265 6e63 657d 220a 2020  /{reference}".  
+00015630: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00015640: 6167 6520 3d20 6622 4661 696c 6564 2073  age = f"Failed s
+00015650: 746f 7269 6e67 2066 6561 7475 7265 2d76  toring feature-v
+00015660: 6563 746f 7220 7b70 726f 6a65 6374 7d2f  ector {project}/
+00015670: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+00015680: 7265 7370 203d 2073 656c 662e 6170 695f  resp = self.api_
+00015690: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+000156a0: 2020 2250 5554 222c 2070 6174 682c 2065    "PUT", path, e
+000156b0: 7272 6f72 5f6d 6573 7361 6765 2c20 7061  rror_message, pa
+000156c0: 7261 6d73 3d70 6172 616d 732c 2062 6f64  rams=params, bod
+000156d0: 793d 6469 6374 5f74 6f5f 6a73 6f6e 2866  y=dict_to_json(f
+000156e0: 6561 7475 7265 5f76 6563 746f 7229 0a20  eature_vector). 
+000156f0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00015700: 2072 6574 7572 6e20 7265 7370 2e6a 736f   return resp.jso
+00015710: 6e28 290a 0a20 2020 2064 6566 2070 6174  n()..    def pat
+00015720: 6368 5f66 6561 7475 7265 5f76 6563 746f  ch_feature_vecto
+00015730: 7228 0a20 2020 2020 2020 2073 656c 662c  r(.        self,
+00015740: 0a20 2020 2020 2020 206e 616d 652c 0a20  .        name,. 
+00015750: 2020 2020 2020 2066 6561 7475 7265 5f76         feature_v
+00015760: 6563 746f 725f 7570 6461 7465 3a20 6469  ector_update: di
+00015770: 6374 2c0a 2020 2020 2020 2020 7072 6f6a  ct,.        proj
+00015780: 6563 743d 2222 2c0a 2020 2020 2020 2020  ect="",.        
+00015790: 7461 673d 4e6f 6e65 2c0a 2020 2020 2020  tag=None,.      
+000157a0: 2020 7569 643d 4e6f 6e65 2c0a 2020 2020    uid=None,.    
+000157b0: 2020 2020 7061 7463 685f 6d6f 6465 3a20      patch_mode: 
+000157c0: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
+000157d0: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
+000157e0: 6d6d 6f6e 2e73 6368 656d 6173 2e50 6174  mmon.schemas.Pat
+000157f0: 6368 4d6f 6465 0a20 2020 2020 2020 205d  chMode.        ]
+00015800: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
+00015810: 7363 6865 6d61 732e 5061 7463 684d 6f64  schemas.PatchMod
+00015820: 652e 7265 706c 6163 652c 0a20 2020 2029  e.replace,.    )
+00015830: 3a0a 2020 2020 2020 2020 2222 224d 6f64  :.        """Mod
+00015840: 6966 7920 2870 6174 6368 2920 616e 2065  ify (patch) an e
+00015850: 7869 7374 696e 6720 3a70 793a 636c 6173  xisting :py:clas
+00015860: 733a 607e 6d6c 7275 6e2e 6665 6174 7572  s:`~mlrun.featur
+00015870: 655f 7374 6f72 652e 4665 6174 7572 6556  e_store.FeatureV
+00015880: 6563 746f 7260 206f 626a 6563 742e 0a20  ector` object.. 
+00015890: 2020 2020 2020 2054 6865 206f 626a 6563         The objec
+000158a0: 7420 6973 2069 6465 6e74 6966 6965 6420  t is identified 
+000158b0: 6279 2069 7473 206e 616d 6520 2861 6e64  by its name (and
+000158c0: 2070 726f 6a65 6374 2069 7420 6265 6c6f   project it belo
+000158d0: 6e67 7320 746f 292c 2061 7320 7765 6c6c  ngs to), as well
+000158e0: 2061 7320 6f70 7469 6f6e 616c 6c79 2061   as optionally a
+000158f0: 2060 6074 6167 6060 206f 7220 6974 730a   ``tag`` or its.
+00015900: 2020 2020 2020 2020 6060 7569 6460 6020          ``uid`` 
+00015910: 2866 6f72 2076 6572 7369 6f6e 6564 206f  (for versioned o
+00015920: 626a 6563 7429 2e20 4966 2062 6f74 6820  bject). If both 
+00015930: 6060 7461 6760 6020 616e 6420 6060 7569  ``tag`` and ``ui
+00015940: 6460 6020 6172 6520 6f6d 6974 7465 6420  d`` are omitted 
+00015950: 7468 656e 2074 6865 206f 626a 6563 7420  then the object 
+00015960: 7769 7468 2074 6167 2060 606c 6174 6573  with tag ``lates
+00015970: 7460 600a 2020 2020 2020 2020 6973 206d  t``.        is m
+00015980: 6f64 6966 6965 642e 0a0a 2020 2020 2020  odified...      
+00015990: 2020 3a70 6172 616d 206e 616d 653a 204e    :param name: N
+000159a0: 616d 6520 6f66 2074 6865 206f 626a 6563  ame of the objec
+000159b0: 7420 746f 2070 6174 6368 2e0a 2020 2020  t to patch..    
+000159c0: 2020 2020 3a70 6172 616d 2066 6561 7475      :param featu
+000159d0: 7265 5f76 6563 746f 725f 7570 6461 7465  re_vector_update
+000159e0: 3a20 5468 6520 6d6f 6469 6669 6361 7469  : The modificati
+000159f0: 6f6e 7320 6e65 6564 6564 2069 6e20 7468  ons needed in th
+00015a00: 6520 6f62 6a65 6374 2e20 5468 6973 2070  e object. This p
+00015a10: 6172 616d 6574 6572 206f 6e6c 7920 6861  arameter only ha
+00015a20: 7320 7468 6520 6368 616e 6765 7320 696e  s the changes in
+00015a30: 2069 742c 0a20 2020 2020 2020 2020 2020   it,.           
+00015a40: 206e 6f74 2061 2066 756c 6c20 6f62 6a65   not a full obje
+00015a50: 6374 2e0a 2020 2020 2020 2020 3a70 6172  ct..        :par
+00015a60: 616d 2070 726f 6a65 6374 3a20 5072 6f6a  am project: Proj
+00015a70: 6563 7420 7768 6963 6820 636f 6e74 6169  ect which contai
+00015a80: 6e73 2074 6865 206d 6f64 6966 6965 6420  ns the modified 
+00015a90: 6f62 6a65 6374 2e0a 2020 2020 2020 2020  object..        
+00015aa0: 3a70 6172 616d 2074 6167 3a20 5468 6520  :param tag: The 
+00015ab0: 7461 6720 6f66 2074 6865 206f 626a 6563  tag of the objec
+00015ac0: 7420 746f 206d 6f64 6966 792e 0a20 2020  t to modify..   
+00015ad0: 2020 2020 203a 7061 7261 6d20 7569 643a       :param uid:
+00015ae0: 2075 6964 206f 6620 7468 6520 6f62 6a65   uid of the obje
+00015af0: 6374 2074 6f20 6d6f 6469 6679 2e0a 2020  ct to modify..  
+00015b00: 2020 2020 2020 3a70 6172 616d 2070 6174        :param pat
+00015b10: 6368 5f6d 6f64 653a 2054 6865 2073 7472  ch_mode: The str
+00015b20: 6174 6567 7920 666f 7220 6d65 7267 696e  ategy for mergin
+00015b30: 6720 7468 6520 6368 616e 6765 7320 7769  g the changes wi
+00015b40: 7468 2074 6865 2065 7869 7374 696e 6720  th the existing 
+00015b50: 6f62 6a65 6374 2e20 4361 6e20 6265 2065  object. Can be e
+00015b60: 6974 6865 7220 6060 7265 706c 6163 6560  ither ``replace`
+00015b70: 600a 2020 2020 2020 2020 2020 2020 6f72  `.            or
+00015b80: 2060 6061 6464 6974 6976 6560 602e 0a20   ``additive``.. 
+00015b90: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+00015ba0: 2020 2072 6566 6572 656e 6365 203d 2073     reference = s
+00015bb0: 656c 662e 5f72 6573 6f6c 7665 5f72 6566  elf._resolve_ref
+00015bc0: 6572 656e 6365 2874 6167 2c20 7569 6429  erence(tag, uid)
+00015bd0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00015be0: 203d 2070 726f 6a65 6374 206f 7220 636f   = project or co
+00015bf0: 6e66 6967 2e64 6566 6175 6c74 5f70 726f  nfig.default_pro
+00015c00: 6a65 6374 0a20 2020 2020 2020 2068 6561  ject.        hea
+00015c10: 6465 7273 203d 207b 6d6c 7275 6e2e 636f  ders = {mlrun.co
+00015c20: 6d6d 6f6e 2e73 6368 656d 6173 2e48 6561  mmon.schemas.Hea
+00015c30: 6465 724e 616d 6573 2e70 6174 6368 5f6d  derNames.patch_m
+00015c40: 6f64 653a 2070 6174 6368 5f6d 6f64 657d  ode: patch_mode}
+00015c50: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+00015c60: 6622 7072 6f6a 6563 7473 2f7b 7072 6f6a  f"projects/{proj
+00015c70: 6563 747d 2f66 6561 7475 7265 2d76 6563  ect}/feature-vec
+00015c80: 746f 7273 2f7b 6e61 6d65 7d2f 7265 6665  tors/{name}/refe
+00015c90: 7265 6e63 6573 2f7b 7265 6665 7265 6e63  rences/{referenc
+00015ca0: 657d 220a 2020 2020 2020 2020 6572 726f  e}".        erro
+00015cb0: 725f 6d65 7373 6167 6520 3d20 6622 4661  r_message = f"Fa
+00015cc0: 696c 6564 2075 7064 6174 696e 6720 6665  iled updating fe
+00015cd0: 6174 7572 652d 7665 6374 6f72 207b 7072  ature-vector {pr
+00015ce0: 6f6a 6563 747d 2f7b 6e61 6d65 7d22 0a20  oject}/{name}". 
+00015cf0: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
+00015d00: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+00015d10: 2020 2250 4154 4348 222c 0a20 2020 2020    "PATCH",.     
+00015d20: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
+00015d30: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
+00015d40: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
+00015d50: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
+00015d60: 5f6a 736f 6e28 6665 6174 7572 655f 7665  _json(feature_ve
+00015d70: 6374 6f72 5f75 7064 6174 6529 2c0a 2020  ctor_update),.  
+00015d80: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00015d90: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
+00015da0: 2020 2029 0a0a 2020 2020 6465 6620 6465     )..    def de
+00015db0: 6c65 7465 5f66 6561 7475 7265 5f76 6563  lete_feature_vec
+00015dc0: 746f 7228 7365 6c66 2c20 6e61 6d65 2c20  tor(self, name, 
+00015dd0: 7072 6f6a 6563 743d 2222 2c20 7461 673d  project="", tag=
+00015de0: 4e6f 6e65 2c20 7569 643d 4e6f 6e65 293a  None, uid=None):
+00015df0: 0a20 2020 2020 2020 2022 2222 4465 6c65  .        """Dele
+00015e00: 7465 2061 203a 7079 3a63 6c61 7373 3a60  te a :py:class:`
+00015e10: 7e6d 6c72 756e 2e66 6561 7475 7265 5f73  ~mlrun.feature_s
+00015e20: 746f 7265 2e46 6561 7475 7265 5665 6374  tore.FeatureVect
+00015e30: 6f72 6020 6f62 6a65 6374 2066 726f 6d20  or` object from 
+00015e40: 7468 6520 4442 2e0a 2020 2020 2020 2020  the DB..        
+00015e50: 4966 2060 6074 6167 6060 206f 7220 6060  If ``tag`` or ``
+00015e60: 7569 6460 6020 6172 6520 7370 6563 6966  uid`` are specif
+00015e70: 6965 642c 2074 6865 6e20 6a75 7374 2074  ied, then just t
+00015e80: 6865 2076 6572 7369 6f6e 2072 6566 6572  he version refer
+00015e90: 656e 6365 6420 6279 2074 6865 6d20 7769  enced by them wi
+00015ea0: 6c6c 2062 6520 6465 6c65 7465 642e 2055  ll be deleted. U
+00015eb0: 7369 6e67 2062 6f74 680a 2020 2020 2020  sing both.      
+00015ec0: 2020 6973 206e 6f74 2061 6c6c 6f77 6564    is not allowed
+00015ed0: 2e0a 2020 2020 2020 2020 4966 206e 6f6e  ..        If non
+00015ee0: 6520 6172 6520 7370 6563 6966 6965 642c  e are specified,
+00015ef0: 2074 6865 6e20 616c 6c20 696e 7374 616e   then all instan
+00015f00: 6365 7320 6f66 2074 6865 206f 626a 6563  ces of the objec
+00015f10: 7420 7768 6f73 6520 6e61 6d65 2069 7320  t whose name is 
+00015f20: 6060 6e61 6d65 6060 2077 696c 6c20 6265  ``name`` will be
+00015f30: 2064 656c 6574 6564 2e0a 2020 2020 2020   deleted..      
+00015f40: 2020 2222 220a 2020 2020 2020 2020 7072    """.        pr
+00015f50: 6f6a 6563 7420 3d20 7072 6f6a 6563 7420  oject = project 
+00015f60: 6f72 2063 6f6e 6669 672e 6465 6661 756c  or config.defaul
+00015f70: 745f 7072 6f6a 6563 740a 2020 2020 2020  t_project.      
+00015f80: 2020 7061 7468 203d 2066 2270 726f 6a65    path = f"proje
+00015f90: 6374 732f 7b70 726f 6a65 6374 7d2f 6665  cts/{project}/fe
+00015fa0: 6174 7572 652d 7665 6374 6f72 732f 7b6e  ature-vectors/{n
+00015fb0: 616d 657d 220a 2020 2020 2020 2020 6966  ame}".        if
+00015fc0: 2074 6167 206f 7220 7569 643a 0a20 2020   tag or uid:.   
+00015fd0: 2020 2020 2020 2020 2072 6566 6572 656e           referen
+00015fe0: 6365 203d 2073 656c 662e 5f72 6573 6f6c  ce = self._resol
+00015ff0: 7665 5f72 6566 6572 656e 6365 2874 6167  ve_reference(tag
+00016000: 2c20 7569 6429 0a20 2020 2020 2020 2020  , uid).         
+00016010: 2020 2070 6174 6820 3d20 7061 7468 202b     path = path +
+00016020: 2066 222f 7265 6665 7265 6e63 6573 2f7b   f"/references/{
+00016030: 7265 6665 7265 6e63 657d 220a 0a20 2020  reference}"..   
+00016040: 2020 2020 2065 7272 6f72 5f6d 6573 7361       error_messa
+00016050: 6765 203d 2066 2246 6169 6c65 6420 6465  ge = f"Failed de
+00016060: 6c65 7469 6e67 2066 6561 7475 7265 2d76  leting feature-v
+00016070: 6563 746f 7220 7b6e 616d 657d 220a 2020  ector {name}".  
+00016080: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+00016090: 616c 6c28 2244 454c 4554 4522 2c20 7061  all("DELETE", pa
+000160a0: 7468 2c20 6572 726f 725f 6d65 7373 6167  th, error_messag
+000160b0: 6529 0a0a 2020 2020 6465 6620 7461 675f  e)..    def tag_
+000160c0: 6f62 6a65 6374 7328 0a20 2020 2020 2020  objects(.       
+000160d0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+000160e0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+000160f0: 2020 2020 2074 6167 5f6e 616d 653a 2073       tag_name: s
+00016100: 7472 2c0a 2020 2020 2020 2020 6f62 6a65  tr,.        obje
+00016110: 6374 733a 2055 6e69 6f6e 5b6d 6c72 756e  cts: Union[mlrun
+00016120: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00016130: 5461 674f 626a 6563 7473 2c20 6469 6374  TagObjects, dict
+00016140: 5d2c 0a20 2020 2020 2020 2072 6570 6c61  ],.        repla
+00016150: 6365 3a20 626f 6f6c 203d 2046 616c 7365  ce: bool = False
+00016160: 2c0a 2020 2020 293a 0a20 2020 2020 2020  ,.    ):.       
+00016170: 2022 2222 5461 6720 6120 6c69 7374 206f   """Tag a list o
+00016180: 6620 6f62 6a65 6374 732e 0a0a 2020 2020  f objects...    
+00016190: 2020 2020 3a70 6172 616d 2070 726f 6a65      :param proje
+000161a0: 6374 3a20 5072 6f6a 6563 7420 7768 6963  ct: Project whic
+000161b0: 6820 636f 6e74 6169 6e73 2074 6865 206f  h contains the o
+000161c0: 626a 6563 7473 2e0a 2020 2020 2020 2020  bjects..        
+000161d0: 3a70 6172 616d 2074 6167 5f6e 616d 653a  :param tag_name:
+000161e0: 2054 6865 2074 6167 2074 6f20 7365 7420   The tag to set 
+000161f0: 6f6e 2074 6865 206f 626a 6563 7473 2e0a  on the objects..
+00016200: 2020 2020 2020 2020 3a70 6172 616d 206f          :param o
+00016210: 626a 6563 7473 3a20 5468 6520 6f62 6a65  bjects: The obje
+00016220: 6374 7320 746f 2074 6167 2e0a 2020 2020  cts to tag..    
+00016230: 2020 2020 3a70 6172 616d 2072 6570 6c61      :param repla
+00016240: 6365 3a20 5768 6574 6865 7220 746f 2072  ce: Whether to r
+00016250: 6570 6c61 6365 2074 6865 2065 7869 7374  eplace the exist
+00016260: 696e 6720 7461 6773 206f 6620 7468 6520  ing tags of the 
+00016270: 6f62 6a65 6374 7320 6f72 2074 6f20 6164  objects or to ad
+00016280: 6420 7468 6520 6e65 7720 7461 6720 746f  d the new tag to
+00016290: 2074 6865 6d2e 0a20 2020 2020 2020 2022   them..        "
+000162a0: 2222 0a0a 2020 2020 2020 2020 7061 7468  ""..        path
+000162b0: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
+000162c0: 726f 6a65 6374 7d2f 7461 6773 2f7b 7461  roject}/tags/{ta
+000162d0: 675f 6e61 6d65 7d22 0a20 2020 2020 2020  g_name}".       
+000162e0: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+000162f0: 2066 2246 6169 6c65 6420 746f 2074 6167   f"Failed to tag
+00016300: 207b 7461 675f 6e61 6d65 7d20 6f6e 206f   {tag_name} on o
+00016310: 626a 6563 7473 207b 6f62 6a65 6374 737d  bjects {objects}
+00016320: 220a 2020 2020 2020 2020 6d65 7468 6f64  ".        method
+00016330: 203d 2022 504f 5354 2220 6966 2072 6570   = "POST" if rep
+00016340: 6c61 6365 2065 6c73 6520 2250 5554 220a  lace else "PUT".
+00016350: 2020 2020 2020 2020 7365 6c66 2e61 7069          self.api
+00016360: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
+00016370: 2020 206d 6574 686f 642c 0a20 2020 2020     method,.     
+00016380: 2020 2020 2020 2070 6174 682c 0a20 2020         path,.   
+00016390: 2020 2020 2020 2020 2065 7272 6f72 5f6d           error_m
+000163a0: 6573 7361 6765 2c0a 2020 2020 2020 2020  essage,.        
+000163b0: 2020 2020 626f 6479 3d64 6963 745f 746f      body=dict_to
+000163c0: 5f6a 736f 6e28 0a20 2020 2020 2020 2020  _json(.         
+000163d0: 2020 2020 2020 206f 626a 6563 7473 2e64         objects.d
+000163e0: 6963 7428 290a 2020 2020 2020 2020 2020  ict().          
+000163f0: 2020 2020 2020 6966 2069 7369 6e73 7461        if isinsta
+00016400: 6e63 6528 6f62 6a65 6374 732c 206d 6c72  nce(objects, mlr
+00016410: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00016420: 732e 5461 674f 626a 6563 7473 290a 2020  s.TagObjects).  
+00016430: 2020 2020 2020 2020 2020 2020 2020 656c                el
+00016440: 7365 206f 626a 6563 7473 0a20 2020 2020  se objects.     
+00016450: 2020 2020 2020 2029 2c0a 2020 2020 2020         ),.      
+00016460: 2020 290a 0a20 2020 2064 6566 2064 656c    )..    def del
+00016470: 6574 655f 6f62 6a65 6374 735f 7461 6728  ete_objects_tag(
+00016480: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00016490: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+000164a0: 7374 722c 0a20 2020 2020 2020 2074 6167  str,.        tag
+000164b0: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
+000164c0: 2020 2020 7461 675f 6f62 6a65 6374 733a      tag_objects:
+000164d0: 2055 6e69 6f6e 5b6d 6c72 756e 2e63 6f6d   Union[mlrun.com
+000164e0: 6d6f 6e2e 7363 6865 6d61 732e 5461 674f  mon.schemas.TagO
+000164f0: 626a 6563 7473 2c20 6469 6374 5d2c 0a20  bjects, dict],. 
+00016500: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00016510: 2244 656c 6574 6520 6120 7461 6720 6672  "Delete a tag fr
+00016520: 6f6d 2061 206c 6973 7420 6f66 206f 626a  om a list of obj
+00016530: 6563 7473 2e0a 0a20 2020 2020 2020 203a  ects...        :
+00016540: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+00016550: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
+00016560: 7461 696e 7320 7468 6520 6f62 6a65 6374  tains the object
+00016570: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00016580: 6d20 7461 675f 6e61 6d65 3a20 5468 6520  m tag_name: The 
+00016590: 7461 6720 746f 2064 656c 6574 6520 6672  tag to delete fr
+000165a0: 6f6d 2074 6865 206f 626a 6563 7473 2e0a  om the objects..
+000165b0: 2020 2020 2020 2020 3a70 6172 616d 2074          :param t
+000165c0: 6167 5f6f 626a 6563 7473 3a20 5468 6520  ag_objects: The 
+000165d0: 6f62 6a65 6374 7320 746f 2064 656c 6574  objects to delet
+000165e0: 6520 7468 6520 7461 6720 6672 6f6d 2e0a  e the tag from..
+000165f0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
+00016600: 2020 2020 2070 6174 6820 3d20 6622 7072       path = f"pr
+00016610: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+00016620: 2f74 6167 732f 7b74 6167 5f6e 616d 657d  /tags/{tag_name}
+00016630: 220a 2020 2020 2020 2020 6572 726f 725f  ".        error_
+00016640: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00016650: 6564 2064 656c 6574 696e 6720 7461 6720  ed deleting tag 
+00016660: 6672 6f6d 207b 7461 675f 6e61 6d65 7d22  from {tag_name}"
+00016670: 0a20 2020 2020 2020 2073 656c 662e 6170  .        self.ap
+00016680: 695f 6361 6c6c 280a 2020 2020 2020 2020  i_call(.        
+00016690: 2020 2020 2244 454c 4554 4522 2c0a 2020      "DELETE",.  
+000166a0: 2020 2020 2020 2020 2020 7061 7468 2c0a            path,.
+000166b0: 2020 2020 2020 2020 2020 2020 6572 726f              erro
+000166c0: 725f 6d65 7373 6167 652c 0a20 2020 2020  r_message,.     
+000166d0: 2020 2020 2020 2062 6f64 793d 6469 6374         body=dict
+000166e0: 5f74 6f5f 6a73 6f6e 280a 2020 2020 2020  _to_json(.      
+000166f0: 2020 2020 2020 2020 2020 7461 675f 6f62            tag_ob
+00016700: 6a65 6374 732e 6469 6374 2829 0a20 2020  jects.dict().   
+00016710: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00016720: 6973 696e 7374 616e 6365 2874 6167 5f6f  isinstance(tag_o
+00016730: 626a 6563 7473 2c20 6d6c 7275 6e2e 636f  bjects, mlrun.co
+00016740: 6d6d 6f6e 2e73 6368 656d 6173 2e54 6167  mmon.schemas.Tag
+00016750: 4f62 6a65 6374 7329 0a20 2020 2020 2020  Objects).       
+00016760: 2020 2020 2020 2020 2065 6c73 6520 7461           else ta
+00016770: 675f 6f62 6a65 6374 730a 2020 2020 2020  g_objects.      
+00016780: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
+00016790: 2029 0a0a 2020 2020 6465 6620 7461 675f   )..    def tag_
+000167a0: 6172 7469 6661 6374 7328 0a20 2020 2020  artifacts(.     
+000167b0: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
+000167c0: 2061 7274 6966 6163 7473 3a20 556e 696f   artifacts: Unio
+000167d0: 6e5b 4c69 7374 5b41 7274 6966 6163 745d  n[List[Artifact]
+000167e0: 2c20 4c69 7374 5b64 6963 745d 2c20 4172  , List[dict], Ar
+000167f0: 7469 6661 6374 2c20 6469 6374 5d2c 0a20  tifact, dict],. 
+00016800: 2020 2020 2020 2070 726f 6a65 6374 3a20         project: 
+00016810: 7374 722c 0a20 2020 2020 2020 2074 6167  str,.        tag
+00016820: 5f6e 616d 653a 2073 7472 2c0a 2020 2020  _name: str,.    
+00016830: 2020 2020 7265 706c 6163 653a 2062 6f6f      replace: boo
+00016840: 6c20 3d20 4661 6c73 652c 0a20 2020 2029  l = False,.    )
+00016850: 3a0a 2020 2020 2020 2020 2222 2254 6167  :.        """Tag
+00016860: 2061 206c 6973 7420 6f66 2061 7274 6966   a list of artif
+00016870: 6163 7473 2e0a 0a20 2020 2020 2020 203a  acts...        :
+00016880: 7061 7261 6d20 6172 7469 6661 6374 733a  param artifacts:
+00016890: 2054 6865 2061 7274 6966 6163 7473 2074   The artifacts t
+000168a0: 6f20 7461 672e 2043 616e 2062 6520 6120  o tag. Can be a 
+000168b0: 6c69 7374 206f 6620 3a70 793a 636c 6173  list of :py:clas
+000168c0: 733a 607e 6d6c 7275 6e2e 6172 7469 6661  s:`~mlrun.artifa
+000168d0: 6374 732e 4172 7469 6661 6374 6020 6f62  cts.Artifact` ob
+000168e0: 6a65 6374 7320 6f72 0a20 2020 2020 2020  jects or.       
+000168f0: 2020 2020 2064 6963 7469 6f6e 6172 6965       dictionarie
+00016900: 732c 206f 7220 6120 7369 6e67 6c65 206f  s, or a single o
+00016910: 626a 6563 742e 0a20 2020 2020 2020 203a  bject..        :
+00016920: 7061 7261 6d20 7072 6f6a 6563 743a 2050  param project: P
+00016930: 726f 6a65 6374 2077 6869 6368 2063 6f6e  roject which con
+00016940: 7461 696e 7320 7468 6520 6172 7469 6661  tains the artifa
+00016950: 6374 732e 0a20 2020 2020 2020 203a 7061  cts..        :pa
+00016960: 7261 6d20 7461 675f 6e61 6d65 3a20 5468  ram tag_name: Th
+00016970: 6520 7461 6720 746f 2073 6574 206f 6e20  e tag to set on 
+00016980: 7468 6520 6172 7469 6661 6374 732e 0a20  the artifacts.. 
+00016990: 2020 2020 2020 203a 7061 7261 6d20 7265         :param re
+000169a0: 706c 6163 653a 2049 6620 5472 7565 2c20  place: If True, 
+000169b0: 7265 706c 6163 6520 6578 6973 7469 6e67  replace existing
+000169c0: 2074 6167 732c 206f 7468 6572 7769 7365   tags, otherwise
+000169d0: 2061 7070 656e 6420 746f 2065 7869 7374   append to exist
+000169e0: 696e 6720 7461 6773 2e0a 2020 2020 2020  ing tags..      
+000169f0: 2020 2222 220a 2020 2020 2020 2020 7461    """.        ta
+00016a00: 675f 6f62 6a65 6374 7320 3d20 7365 6c66  g_objects = self
+00016a10: 2e5f 7265 736f 6c76 655f 6172 7469 6661  ._resolve_artifa
+00016a20: 6374 735f 746f 5f74 6167 5f6f 626a 6563  cts_to_tag_objec
+00016a30: 7473 2861 7274 6966 6163 7473 290a 2020  ts(artifacts).  
+00016a40: 2020 2020 2020 7365 6c66 2e74 6167 5f6f        self.tag_o
+00016a50: 626a 6563 7473 2870 726f 6a65 6374 2c20  bjects(project, 
+00016a60: 7461 675f 6e61 6d65 2c20 6f62 6a65 6374  tag_name, object
+00016a70: 733d 7461 675f 6f62 6a65 6374 732c 2072  s=tag_objects, r
+00016a80: 6570 6c61 6365 3d72 6570 6c61 6365 290a  eplace=replace).
+00016a90: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+00016aa0: 6172 7469 6661 6374 735f 7461 6773 280a  artifacts_tags(.
+00016ab0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00016ac0: 2020 2020 2020 6172 7469 6661 6374 732c        artifacts,
+00016ad0: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00016ae0: 3a20 7374 722c 0a20 2020 2020 2020 2074  : str,.        t
+00016af0: 6167 5f6e 616d 653a 2073 7472 2c0a 2020  ag_name: str,.  
+00016b00: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00016b10: 4465 6c65 7465 2074 6167 2066 726f 6d20  Delete tag from 
+00016b20: 6120 6c69 7374 206f 6620 6172 7469 6661  a list of artifa
+00016b30: 6374 732e 0a0a 2020 2020 2020 2020 3a70  cts...        :p
+00016b40: 6172 616d 2061 7274 6966 6163 7473 3a20  aram artifacts: 
+00016b50: 5468 6520 6172 7469 6661 6374 7320 746f  The artifacts to
+00016b60: 2064 656c 6574 6520 7468 6520 7461 6720   delete the tag 
+00016b70: 6672 6f6d 2e20 4361 6e20 6265 2061 206c  from. Can be a l
+00016b80: 6973 7420 6f66 203a 7079 3a63 6c61 7373  ist of :py:class
+00016b90: 3a60 7e6d 6c72 756e 2e61 7274 6966 6163  :`~mlrun.artifac
+00016ba0: 7473 2e41 7274 6966 6163 7460 0a20 2020  ts.Artifact`.   
+00016bb0: 2020 2020 2020 2020 206f 626a 6563 7473           objects
+00016bc0: 206f 7220 6469 6374 696f 6e61 7269 6573   or dictionaries
+00016bd0: 2c20 6f72 2061 2073 696e 676c 6520 6f62  , or a single ob
+00016be0: 6a65 6374 2e0a 2020 2020 2020 2020 3a70  ject..        :p
+00016bf0: 6172 616d 2070 726f 6a65 6374 3a20 5072  aram project: Pr
+00016c00: 6f6a 6563 7420 7768 6963 6820 636f 6e74  oject which cont
+00016c10: 6169 6e73 2074 6865 2061 7274 6966 6163  ains the artifac
+00016c20: 7473 2e0a 2020 2020 2020 2020 3a70 6172  ts..        :par
+00016c30: 616d 2074 6167 5f6e 616d 653a 2054 6865  am tag_name: The
+00016c40: 2074 6167 2074 6f20 7365 7420 6f6e 2074   tag to set on t
+00016c50: 6865 2061 7274 6966 6163 7473 2e0a 2020  he artifacts..  
+00016c60: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
+00016c70: 2020 7461 675f 6f62 6a65 6374 7320 3d20    tag_objects = 
+00016c80: 7365 6c66 2e5f 7265 736f 6c76 655f 6172  self._resolve_ar
+00016c90: 7469 6661 6374 735f 746f 5f74 6167 5f6f  tifacts_to_tag_o
+00016ca0: 626a 6563 7473 2861 7274 6966 6163 7473  bjects(artifacts
+00016cb0: 290a 2020 2020 2020 2020 7365 6c66 2e64  ).        self.d
+00016cc0: 656c 6574 655f 6f62 6a65 6374 735f 7461  elete_objects_ta
+00016cd0: 6728 7072 6f6a 6563 742c 2074 6167 5f6e  g(project, tag_n
+00016ce0: 616d 652c 2074 6167 5f6f 626a 6563 7473  ame, tag_objects
+00016cf0: 290a 0a20 2020 2064 6566 206c 6973 745f  )..    def list_
+00016d00: 7072 6f6a 6563 7473 280a 2020 2020 2020  projects(.      
+00016d10: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00016d20: 6f77 6e65 723a 2073 7472 203d 204e 6f6e  owner: str = Non
+00016d30: 652c 0a20 2020 2020 2020 2066 6f72 6d61  e,.        forma
+00016d40: 745f 3a20 556e 696f 6e5b 0a20 2020 2020  t_: Union[.     
+00016d50: 2020 2020 2020 2073 7472 2c20 6d6c 7275         str, mlru
+00016d60: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00016d70: 2e50 726f 6a65 6374 7346 6f72 6d61 740a  .ProjectsFormat.
+00016d80: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
+00016d90: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00016da0: 2e50 726f 6a65 6374 7346 6f72 6d61 742e  .ProjectsFormat.
+00016db0: 6675 6c6c 2c0a 2020 2020 2020 2020 6c61  full,.        la
+00016dc0: 6265 6c73 3a20 4c69 7374 5b73 7472 5d20  bels: List[str] 
+00016dd0: 3d20 4e6f 6e65 2c0a 2020 2020 2020 2020  = None,.        
+00016de0: 7374 6174 653a 2055 6e69 6f6e 5b73 7472  state: Union[str
+00016df0: 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  , mlrun.common.s
+00016e00: 6368 656d 6173 2e50 726f 6a65 6374 5374  chemas.ProjectSt
+00016e10: 6174 655d 203d 204e 6f6e 652c 0a20 2020  ate] = None,.   
+00016e20: 2029 202d 3e20 4c69 7374 5b55 6e69 6f6e   ) -> List[Union
+00016e30: 5b6d 6c72 756e 2e70 726f 6a65 6374 732e  [mlrun.projects.
+00016e40: 4d6c 7275 6e50 726f 6a65 6374 2c20 7374  MlrunProject, st
+00016e50: 725d 5d3a 0a20 2020 2020 2020 2022 2222  r]]:.        """
+00016e60: 5265 7475 726e 2061 206c 6973 7420 6f66  Return a list of
+00016e70: 2074 6865 2065 7869 7374 696e 6720 7072   the existing pr
+00016e80: 6f6a 6563 7473 2c20 706f 7465 6e74 6961  ojects, potentia
+00016e90: 6c6c 7920 6669 6c74 6572 6564 2062 7920  lly filtered by 
+00016ea0: 7370 6563 6966 6963 2063 7269 7465 7269  specific criteri
+00016eb0: 612e 0a0a 2020 2020 2020 2020 3a70 6172  a...        :par
+00016ec0: 616d 206f 776e 6572 3a20 4c69 7374 206f  am owner: List o
+00016ed0: 6e6c 7920 7072 6f6a 6563 7473 2062 656c  nly projects bel
+00016ee0: 6f6e 6769 6e67 2074 6f20 7468 6973 2073  onging to this s
+00016ef0: 7065 6369 6669 6320 6f77 6e65 722e 0a20  pecific owner.. 
+00016f00: 2020 2020 2020 203a 7061 7261 6d20 666f         :param fo
+00016f10: 726d 6174 5f3a 2046 6f72 6d61 7420 6f66  rmat_: Format of
+00016f20: 2074 6865 2072 6573 756c 7473 2e20 506f   the results. Po
+00016f30: 7373 6962 6c65 2076 616c 7565 7320 6172  ssible values ar
+00016f40: 653a 0a0a 2020 2020 2020 2020 2020 2020  e:..            
+00016f50: 2d20 6060 6675 6c6c 6060 2028 6465 6661  - ``full`` (defa
+00016f60: 756c 7420 7661 6c75 6529 202d 2052 6574  ult value) - Ret
+00016f70: 7572 6e20 6675 6c6c 2070 726f 6a65 6374  urn full project
+00016f80: 206f 626a 6563 7473 2e0a 2020 2020 2020   objects..      
+00016f90: 2020 2020 2020 2d20 6060 6d69 6e69 6d61        - ``minima
+00016fa0: 6c60 6020 2d20 5265 7475 726e 206d 696e  l`` - Return min
+00016fb0: 696d 616c 2070 726f 6a65 6374 206f 626a  imal project obj
+00016fc0: 6563 7473 2028 6d69 6e69 6d69 7a61 7469  ects (minimizati
+00016fd0: 6f6e 2068 6170 7065 6e73 2069 6e20 7468  on happens in th
+00016fe0: 6520 4245 292e 0a20 2020 2020 2020 2020  e BE)..         
+00016ff0: 2020 202d 2060 606e 616d 655f 6f6e 6c79     - ``name_only
+00017000: 6060 202d 2052 6574 7572 6e20 6a75 7374  `` - Return just
+00017010: 2074 6865 206e 616d 6573 206f 6620 7468   the names of th
+00017020: 6520 7072 6f6a 6563 7473 2e0a 0a20 2020  e projects...   
+00017030: 2020 2020 203a 7061 7261 6d20 6c61 6265       :param labe
+00017040: 6c73 3a20 4669 6c74 6572 2062 7920 6c61  ls: Filter by la
+00017050: 6265 6c73 2061 7474 6163 6865 6420 746f  bels attached to
+00017060: 2074 6865 2070 726f 6a65 6374 2e0a 2020   the project..  
+00017070: 2020 2020 2020 3a70 6172 616d 2073 7461        :param sta
+00017080: 7465 3a20 4669 6c74 6572 2062 7920 7072  te: Filter by pr
+00017090: 6f6a 6563 7427 7320 7374 6174 652e 2043  oject's state. C
+000170a0: 616e 2062 6520 6569 7468 6572 2060 606f  an be either ``o
+000170b0: 6e6c 696e 6560 6020 6f72 2060 6061 7263  nline`` or ``arc
+000170c0: 6869 7665 6460 602e 0a20 2020 2020 2020  hived``..       
+000170d0: 2022 2222 0a0a 2020 2020 2020 2020 7061   """..        pa
+000170e0: 7261 6d73 203d 207b 0a20 2020 2020 2020  rams = {.       
+000170f0: 2020 2020 2022 6f77 6e65 7222 3a20 6f77       "owner": ow
+00017100: 6e65 722c 0a20 2020 2020 2020 2020 2020  ner,.           
+00017110: 2022 7374 6174 6522 3a20 7374 6174 652c   "state": state,
+00017120: 0a20 2020 2020 2020 2020 2020 2022 666f  .            "fo
+00017130: 726d 6174 223a 2066 6f72 6d61 745f 2c0a  rmat": format_,.
+00017140: 2020 2020 2020 2020 2020 2020 226c 6162              "lab
+00017150: 656c 223a 206c 6162 656c 7320 6f72 205b  el": labels or [
+00017160: 5d2c 0a20 2020 2020 2020 207d 0a0a 2020  ],.        }..  
+00017170: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+00017180: 6167 6520 3d20 6622 4661 696c 6564 206c  age = f"Failed l
+00017190: 6973 7469 6e67 2070 726f 6a65 6374 732c  isting projects,
+000171a0: 2071 7565 7279 3a20 7b70 6172 616d 737d   query: {params}
+000171b0: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
+000171c0: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+000171d0: 6c6c 2822 4745 5422 2c20 2270 726f 6a65  ll("GET", "proje
+000171e0: 6374 7322 2c20 6572 726f 725f 6d65 7373  cts", error_mess
+000171f0: 6167 652c 2070 6172 616d 733d 7061 7261  age, params=para
+00017200: 6d73 290a 2020 2020 2020 2020 6966 2066  ms).        if f
+00017210: 6f72 6d61 745f 203d 3d20 6d6c 7275 6e2e  ormat_ == mlrun.
+00017220: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e50  common.schemas.P
+00017230: 726f 6a65 6374 7346 6f72 6d61 742e 6e61  rojectsFormat.na
+00017240: 6d65 5f6f 6e6c 793a 0a0a 2020 2020 2020  me_only:..      
+00017250: 2020 2020 2020 2320 7072 6f6a 6563 7473        # projects
+00017260: 2069 7320 6a75 7374 2061 206c 6973 7420   is just a list 
+00017270: 6f66 2073 7472 696e 6773 0a20 2020 2020  of strings.     
+00017280: 2020 2020 2020 2072 6574 7572 6e20 7265         return re
+00017290: 7370 6f6e 7365 2e6a 736f 6e28 295b 2270  sponse.json()["p
+000172a0: 726f 6a65 6374 7322 5d0a 0a20 2020 2020  rojects"]..     
+000172b0: 2020 2023 2066 6f72 7761 7264 7320 636f     # forwards co
+000172c0: 6d70 6174 6962 696c 6974 7920 2d20 7765  mpatibility - we
+000172d0: 2077 616e 7420 746f 2062 6520 6162 6c65   want to be able
+000172e0: 2074 6f20 6861 6e64 6c65 206e 6577 2066   to handle new f
+000172f0: 6f72 6d61 7473 2074 6861 7420 6d69 6768  ormats that migh
+00017300: 7420 6265 2061 6464 6564 2069 6e20 7468  t be added in th
+00017310: 6520 6675 7475 7265 0a20 2020 2020 2020  e future.       
+00017320: 2023 2069 6620 666f 726d 6174 2069 7320   # if format is 
+00017330: 6e6f 7420 6b6e 6f77 6e20 746f 2074 6865  not known to the
+00017340: 2061 7069 2c20 6974 2069 7320 7570 2074   api, it is up t
+00017350: 6f20 7468 6520 7365 7276 6572 2074 6f20  o the server to 
+00017360: 7265 7475 726e 2065 6974 6865 7220 616e  return either an
+00017370: 2065 7272 6f72 206f 7220 6120 6465 6661   error or a defa
+00017380: 756c 7420 666f 726d 6174 0a20 2020 2020  ult format.     
+00017390: 2020 2072 6574 7572 6e20 5b0a 2020 2020     return [.    
+000173a0: 2020 2020 2020 2020 6d6c 7275 6e2e 7072          mlrun.pr
+000173b0: 6f6a 6563 7473 2e4d 6c72 756e 5072 6f6a  ojects.MlrunProj
+000173c0: 6563 742e 6672 6f6d 5f64 6963 7428 7072  ect.from_dict(pr
+000173d0: 6f6a 6563 745f 6469 6374 290a 2020 2020  oject_dict).    
+000173e0: 2020 2020 2020 2020 666f 7220 7072 6f6a          for proj
+000173f0: 6563 745f 6469 6374 2069 6e20 7265 7370  ect_dict in resp
+00017400: 6f6e 7365 2e6a 736f 6e28 295b 2270 726f  onse.json()["pro
+00017410: 6a65 6374 7322 5d0a 2020 2020 2020 2020  jects"].        
+00017420: 5d0a 0a20 2020 2064 6566 2067 6574 5f70  ]..    def get_p
+00017430: 726f 6a65 6374 2873 656c 662c 206e 616d  roject(self, nam
+00017440: 653a 2073 7472 2920 2d3e 206d 6c72 756e  e: str) -> mlrun
+00017450: 2e70 726f 6a65 6374 732e 4d6c 7275 6e50  .projects.MlrunP
+00017460: 726f 6a65 6374 3a0a 2020 2020 2020 2020  roject:.        
+00017470: 2222 2247 6574 2064 6574 6169 6c73 2066  """Get details f
+00017480: 6f72 2061 2073 7065 6369 6669 6320 7072  or a specific pr
+00017490: 6f6a 6563 742e 2222 220a 0a20 2020 2020  oject."""..     
+000174a0: 2020 2069 6620 6e6f 7420 6e61 6d65 3a0a     if not name:.
+000174b0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+000174c0: 6520 4d4c 5275 6e49 6e76 616c 6964 4172  e MLRunInvalidAr
+000174d0: 6775 6d65 6e74 4572 726f 7228 224e 616d  gumentError("Nam
+000174e0: 6520 6d75 7374 2062 6520 7072 6f76 6964  e must be provid
+000174f0: 6564 2229 0a0a 2020 2020 2020 2020 7061  ed")..        pa
+00017500: 7468 203d 2066 2270 726f 6a65 6374 732f  th = f"projects/
+00017510: 7b6e 616d 657d 220a 2020 2020 2020 2020  {name}".        
+00017520: 6572 726f 725f 6d65 7373 6167 6520 3d20  error_message = 
+00017530: 6622 4661 696c 6564 2072 6574 7269 6576  f"Failed retriev
+00017540: 696e 6720 7072 6f6a 6563 7420 7b6e 616d  ing project {nam
+00017550: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
+00017560: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+00017570: 6361 6c6c 2822 4745 5422 2c20 7061 7468  call("GET", path
+00017580: 2c20 6572 726f 725f 6d65 7373 6167 6529  , error_message)
+00017590: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+000175a0: 6d6c 7275 6e2e 7072 6f6a 6563 7473 2e4d  mlrun.projects.M
+000175b0: 6c72 756e 5072 6f6a 6563 742e 6672 6f6d  lrunProject.from
+000175c0: 5f64 6963 7428 7265 7370 6f6e 7365 2e6a  _dict(response.j
+000175d0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
+000175e0: 6465 6c65 7465 5f70 726f 6a65 6374 280a  delete_project(.
+000175f0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00017600: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
+00017610: 0a20 2020 2020 2020 2064 656c 6574 696f  .        deletio
+00017620: 6e5f 7374 7261 7465 6779 3a20 556e 696f  n_strategy: Unio
+00017630: 6e5b 0a20 2020 2020 2020 2020 2020 2073  n[.            s
+00017640: 7472 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  tr, mlrun.common
+00017650: 2e73 6368 656d 6173 2e44 656c 6574 696f  .schemas.Deletio
+00017660: 6e53 7472 6174 6567 790a 2020 2020 2020  nStrategy.      
+00017670: 2020 5d20 3d20 6d6c 7275 6e2e 636f 6d6d    ] = mlrun.comm
+00017680: 6f6e 2e73 6368 656d 6173 2e44 656c 6574  on.schemas.Delet
+00017690: 696f 6e53 7472 6174 6567 792e 6465 6661  ionStrategy.defa
+000176a0: 756c 7428 292c 0a20 2020 2029 3a0a 2020  ult(),.    ):.  
+000176b0: 2020 2020 2020 2222 2244 656c 6574 6520        """Delete 
+000176c0: 6120 7072 6f6a 6563 742e 0a0a 2020 2020  a project...    
+000176d0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
+000176e0: 204e 616d 6520 6f66 2074 6865 2070 726f   Name of the pro
+000176f0: 6a65 6374 2074 6f20 6465 6c65 7465 2e0a  ject to delete..
+00017700: 2020 2020 2020 2020 3a70 6172 616d 2064          :param d
+00017710: 656c 6574 696f 6e5f 7374 7261 7465 6779  eletion_strategy
+00017720: 3a20 486f 7720 746f 2074 7265 6174 2063  : How to treat c
+00017730: 6869 6c64 206f 626a 6563 7473 206f 6620  hild objects of 
+00017740: 7468 6520 7072 6f6a 6563 742e 2050 6f73  the project. Pos
+00017750: 7369 626c 6520 7661 6c75 6573 2061 7265  sible values are
+00017760: 3a0a 0a20 2020 2020 2020 2020 2020 202d  :..            -
+00017770: 2060 6072 6573 7472 6963 7460 6020 2864   ``restrict`` (d
+00017780: 6566 6175 6c74 2920 2d20 5072 6f6a 6563  efault) - Projec
+00017790: 7420 6d75 7374 206e 6f74 2068 6176 6520  t must not have 
+000177a0: 616e 7920 6368 696c 6420 6f62 6a65 6374  any child object
+000177b0: 7320 7768 656e 2064 656c 6574 6564 2e20  s when deleted. 
+000177c0: 4966 2075 7369 6e67 2074 6869 7320 6d6f  If using this mo
+000177d0: 6465 2077 6869 6c65 0a20 2020 2020 2020  de while.       
+000177e0: 2020 2020 2020 2063 6869 6c64 206f 626a         child obj
+000177f0: 6563 7473 2065 7869 7374 2c20 7468 6520  ects exist, the 
+00017800: 6f70 6572 6174 696f 6e20 7769 6c6c 2066  operation will f
+00017810: 6169 6c2e 0a20 2020 2020 2020 2020 2020  ail..           
+00017820: 202d 2060 6063 6173 6361 6465 6060 202d   - ``cascade`` -
+00017830: 2041 7574 6f6d 6174 6963 616c 6c79 2064   Automatically d
+00017840: 656c 6574 6520 616c 6c20 6368 696c 6420  elete all child 
+00017850: 6f62 6a65 6374 7320 7768 656e 2064 656c  objects when del
+00017860: 6574 696e 6720 7468 6520 7072 6f6a 6563  eting the projec
+00017870: 742e 0a20 2020 2020 2020 2022 2222 0a0a  t..        """..
+00017880: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
+00017890: 2270 726f 6a65 6374 732f 7b6e 616d 657d  "projects/{name}
+000178a0: 220a 2020 2020 2020 2020 6865 6164 6572  ".        header
+000178b0: 7320 3d20 7b0a 2020 2020 2020 2020 2020  s = {.          
+000178c0: 2020 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73    mlrun.common.s
+000178d0: 6368 656d 6173 2e48 6561 6465 724e 616d  chemas.HeaderNam
+000178e0: 6573 2e64 656c 6574 696f 6e5f 7374 7261  es.deletion_stra
+000178f0: 7465 6779 3a20 6465 6c65 7469 6f6e 5f73  tegy: deletion_s
+00017900: 7472 6174 6567 790a 2020 2020 2020 2020  trategy.        
+00017910: 7d0a 2020 2020 2020 2020 6572 726f 725f  }.        error_
+00017920: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00017930: 6564 2064 656c 6574 696e 6720 7072 6f6a  ed deleting proj
+00017940: 6563 7420 7b6e 616d 657d 220a 2020 2020  ect {name}".    
+00017950: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+00017960: 656c 662e 6170 695f 6361 6c6c 2822 4445  elf.api_call("DE
+00017970: 4c45 5445 222c 2070 6174 682c 2065 7272  LETE", path, err
+00017980: 6f72 5f6d 6573 7361 6765 2c20 6865 6164  or_message, head
+00017990: 6572 733d 6865 6164 6572 7329 0a20 2020  ers=headers).   
+000179a0: 2020 2020 2069 6620 7265 7370 6f6e 7365       if response
+000179b0: 2e73 7461 7475 735f 636f 6465 203d 3d20  .status_code == 
+000179c0: 6874 7470 2e48 5454 5053 7461 7475 732e  http.HTTPStatus.
+000179d0: 4143 4345 5054 4544 3a0a 2020 2020 2020  ACCEPTED:.      
+000179e0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000179f0: 662e 5f77 6169 745f 666f 725f 7072 6f6a  f._wait_for_proj
+00017a00: 6563 745f 746f 5f62 655f 6465 6c65 7465  ect_to_be_delete
+00017a10: 6428 6e61 6d65 290a 0a20 2020 2064 6566  d(name)..    def
+00017a20: 2073 746f 7265 5f70 726f 6a65 6374 280a   store_project(.
+00017a30: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+00017a40: 2020 2020 2020 6e61 6d65 3a20 7374 722c        name: str,
+00017a50: 0a20 2020 2020 2020 2070 726f 6a65 6374  .        project
+00017a60: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
+00017a70: 7275 6e2e 7072 6f6a 6563 7473 2e4d 6c72  run.projects.Mlr
+00017a80: 756e 5072 6f6a 6563 742c 206d 6c72 756e  unProject, mlrun
+00017a90: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00017aa0: 5072 6f6a 6563 745d 2c0a 2020 2020 2920  Project],.    ) 
+00017ab0: 2d3e 206d 6c72 756e 2e70 726f 6a65 6374  -> mlrun.project
+00017ac0: 732e 4d6c 7275 6e50 726f 6a65 6374 3a0a  s.MlrunProject:.
+00017ad0: 2020 2020 2020 2020 2222 2253 746f 7265          """Store
+00017ae0: 2061 2070 726f 6a65 6374 2069 6e20 7468   a project in th
+00017af0: 6520 4442 2e20 5468 6973 206f 7065 7261  e DB. This opera
+00017b00: 7469 6f6e 2077 696c 6c20 6f76 6572 7772  tion will overwr
+00017b10: 6974 6520 6578 6973 7469 6e67 2070 726f  ite existing pro
+00017b20: 6a65 6374 206f 6620 7468 6520 7361 6d65  ject of the same
+00017b30: 206e 616d 6520 6966 2065 7869 7374 732e   name if exists.
+00017b40: 2222 220a 0a20 2020 2020 2020 2070 6174  """..        pat
+00017b50: 6820 3d20 6622 7072 6f6a 6563 7473 2f7b  h = f"projects/{
+00017b60: 6e61 6d65 7d22 0a20 2020 2020 2020 2065  name}".        e
+00017b70: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+00017b80: 2246 6169 6c65 6420 7374 6f72 696e 6720  "Failed storing 
+00017b90: 7072 6f6a 6563 7420 7b6e 616d 657d 220a  project {name}".
+00017ba0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00017bb0: 7461 6e63 6528 7072 6f6a 6563 742c 206d  tance(project, m
+00017bc0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00017bd0: 6d61 732e 5072 6f6a 6563 7429 3a0a 2020  mas.Project):.  
+00017be0: 2020 2020 2020 2020 2020 7072 6f6a 6563            projec
+00017bf0: 7420 3d20 7072 6f6a 6563 742e 6469 6374  t = project.dict
+00017c00: 2829 0a20 2020 2020 2020 2065 6c69 6620  ().        elif 
+00017c10: 6973 696e 7374 616e 6365 2870 726f 6a65  isinstance(proje
+00017c20: 6374 2c20 6d6c 7275 6e2e 7072 6f6a 6563  ct, mlrun.projec
+00017c30: 7473 2e4d 6c72 756e 5072 6f6a 6563 7429  ts.MlrunProject)
+00017c40: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+00017c50: 6f6a 6563 7420 3d20 7072 6f6a 6563 742e  oject = project.
+00017c60: 746f 5f64 6963 7428 290a 2020 2020 2020  to_dict().      
+00017c70: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+00017c80: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+00017c90: 2020 2020 2020 2020 2250 5554 222c 0a20          "PUT",. 
+00017ca0: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+00017cb0: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+00017cc0: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
+00017cd0: 2020 2020 2020 2020 626f 6479 3d64 6963          body=dic
+00017ce0: 745f 746f 5f6a 736f 6e28 7072 6f6a 6563  t_to_json(projec
+00017cf0: 7429 2c0a 2020 2020 2020 2020 290a 2020  t),.        ).  
+00017d00: 2020 2020 2020 6966 2072 6573 706f 6e73        if respons
+00017d10: 652e 7374 6174 7573 5f63 6f64 6520 3d3d  e.status_code ==
+00017d20: 2068 7474 702e 4854 5450 5374 6174 7573   http.HTTPStatus
+00017d30: 2e41 4343 4550 5445 443a 0a20 2020 2020  .ACCEPTED:.     
+00017d40: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+00017d50: 6c66 2e5f 7761 6974 5f66 6f72 5f70 726f  lf._wait_for_pro
+00017d60: 6a65 6374 5f74 6f5f 7265 6163 685f 7465  ject_to_reach_te
+00017d70: 726d 696e 616c 5f73 7461 7465 286e 616d  rminal_state(nam
+00017d80: 6529 0a20 2020 2020 2020 2072 6574 7572  e).        retur
+00017d90: 6e20 6d6c 7275 6e2e 7072 6f6a 6563 7473  n mlrun.projects
+00017da0: 2e4d 6c72 756e 5072 6f6a 6563 742e 6672  .MlrunProject.fr
+00017db0: 6f6d 5f64 6963 7428 7265 7370 6f6e 7365  om_dict(response
+00017dc0: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
+00017dd0: 6620 7061 7463 685f 7072 6f6a 6563 7428  f patch_project(
+00017de0: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
+00017df0: 2020 2020 2020 206e 616d 653a 2073 7472         name: str
+00017e00: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+00017e10: 743a 2064 6963 742c 0a20 2020 2020 2020  t: dict,.       
+00017e20: 2070 6174 6368 5f6d 6f64 653a 2055 6e69   patch_mode: Uni
+00017e30: 6f6e 5b0a 2020 2020 2020 2020 2020 2020  on[.            
+00017e40: 7374 722c 206d 6c72 756e 2e63 6f6d 6d6f  str, mlrun.commo
+00017e50: 6e2e 7363 6865 6d61 732e 5061 7463 684d  n.schemas.PatchM
+00017e60: 6f64 650a 2020 2020 2020 2020 5d20 3d20  ode.        ] = 
+00017e70: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00017e80: 656d 6173 2e50 6174 6368 4d6f 6465 2e72  emas.PatchMode.r
+00017e90: 6570 6c61 6365 2c0a 2020 2020 2920 2d3e  eplace,.    ) ->
+00017ea0: 206d 6c72 756e 2e70 726f 6a65 6374 732e   mlrun.projects.
+00017eb0: 4d6c 7275 6e50 726f 6a65 6374 3a0a 2020  MlrunProject:.  
+00017ec0: 2020 2020 2020 2222 2250 6174 6368 2061        """Patch a
+00017ed0: 6e20 6578 6973 7469 6e67 2070 726f 6a65  n existing proje
+00017ee0: 6374 206f 626a 6563 742e 0a0a 2020 2020  ct object...    
+00017ef0: 2020 2020 3a70 6172 616d 206e 616d 653a      :param name:
+00017f00: 204e 616d 6520 6f66 2070 726f 6a65 6374   Name of project
+00017f10: 2074 6f20 7061 7463 682e 0a20 2020 2020   to patch..     
+00017f20: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00017f30: 743a 2054 6865 2061 6374 7561 6c20 6368  t: The actual ch
+00017f40: 616e 6765 7320 746f 2074 6865 2070 726f  anges to the pro
+00017f50: 6a65 6374 206f 626a 6563 742e 0a20 2020  ject object..   
+00017f60: 2020 2020 203a 7061 7261 6d20 7061 7463       :param patc
+00017f70: 685f 6d6f 6465 3a20 5468 6520 7374 7261  h_mode: The stra
+00017f80: 7465 6779 2066 6f72 206d 6572 6769 6e67  tegy for merging
+00017f90: 2074 6865 2063 6861 6e67 6573 2077 6974   the changes wit
+00017fa0: 6820 7468 6520 6578 6973 7469 6e67 206f  h the existing o
+00017fb0: 626a 6563 742e 2043 616e 2062 6520 6569  bject. Can be ei
+00017fc0: 7468 6572 2060 6072 6570 6c61 6365 6060  ther ``replace``
+00017fd0: 0a20 2020 2020 2020 2020 2020 206f 7220  .            or 
+00017fe0: 6060 6164 6469 7469 7665 6060 2e0a 2020  ``additive``..  
+00017ff0: 2020 2020 2020 2222 220a 0a20 2020 2020        """..     
+00018000: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+00018010: 6563 7473 2f7b 6e61 6d65 7d22 0a20 2020  ects/{name}".   
+00018020: 2020 2020 2068 6561 6465 7273 203d 207b       headers = {
+00018030: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00018040: 656d 6173 2e48 6561 6465 724e 616d 6573  emas.HeaderNames
+00018050: 2e70 6174 6368 5f6d 6f64 653a 2070 6174  .patch_mode: pat
+00018060: 6368 5f6d 6f64 657d 0a20 2020 2020 2020  ch_mode}.       
+00018070: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00018080: 2066 2246 6169 6c65 6420 7061 7463 6869   f"Failed patchi
+00018090: 6e67 2070 726f 6a65 6374 207b 6e61 6d65  ng project {name
+000180a0: 7d22 0a20 2020 2020 2020 2072 6573 706f  }".        respo
+000180b0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+000180c0: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+000180d0: 2022 5041 5443 4822 2c20 7061 7468 2c20   "PATCH", path, 
+000180e0: 6572 726f 725f 6d65 7373 6167 652c 2062  error_message, b
+000180f0: 6f64 793d 6469 6374 5f74 6f5f 6a73 6f6e  ody=dict_to_json
+00018100: 2870 726f 6a65 6374 292c 2068 6561 6465  (project), heade
+00018110: 7273 3d68 6561 6465 7273 0a20 2020 2020  rs=headers.     
+00018120: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+00018130: 7572 6e20 6d6c 7275 6e2e 7072 6f6a 6563  urn mlrun.projec
+00018140: 7473 2e4d 6c72 756e 5072 6f6a 6563 742e  ts.MlrunProject.
+00018150: 6672 6f6d 5f64 6963 7428 7265 7370 6f6e  from_dict(respon
+00018160: 7365 2e6a 736f 6e28 2929 0a0a 2020 2020  se.json())..    
+00018170: 6465 6620 6372 6561 7465 5f70 726f 6a65  def create_proje
+00018180: 6374 280a 2020 2020 2020 2020 7365 6c66  ct(.        self
+00018190: 2c0a 2020 2020 2020 2020 7072 6f6a 6563  ,.        projec
+000181a0: 743a 2055 6e69 6f6e 5b64 6963 742c 206d  t: Union[dict, m
+000181b0: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
+000181c0: 7275 6e50 726f 6a65 6374 2c20 6d6c 7275  runProject, mlru
+000181d0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+000181e0: 2e50 726f 6a65 6374 5d2c 0a20 2020 2029  .Project],.    )
+000181f0: 202d 3e20 6d6c 7275 6e2e 7072 6f6a 6563   -> mlrun.projec
+00018200: 7473 2e4d 6c72 756e 5072 6f6a 6563 743a  ts.MlrunProject:
+00018210: 0a20 2020 2020 2020 2022 2222 4372 6561  .        """Crea
+00018220: 7465 2061 206e 6577 2070 726f 6a65 6374  te a new project
+00018230: 2e20 4120 7072 6f6a 6563 7420 7769 7468  . A project with
+00018240: 2074 6865 2073 616d 6520 6e61 6d65 206d   the same name m
+00018250: 7573 7420 6e6f 7420 6578 6973 7420 7072  ust not exist pr
+00018260: 696f 7220 746f 2063 7265 6174 696f 6e2e  ior to creation.
+00018270: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
+00018280: 6973 696e 7374 616e 6365 2870 726f 6a65  isinstance(proje
+00018290: 6374 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  ct, mlrun.common
+000182a0: 2e73 6368 656d 6173 2e50 726f 6a65 6374  .schemas.Project
+000182b0: 293a 0a20 2020 2020 2020 2020 2020 2070  ):.            p
+000182c0: 726f 6a65 6374 203d 2070 726f 6a65 6374  roject = project
+000182d0: 2e64 6963 7428 290a 2020 2020 2020 2020  .dict().        
+000182e0: 656c 6966 2069 7369 6e73 7461 6e63 6528  elif isinstance(
+000182f0: 7072 6f6a 6563 742c 206d 6c72 756e 2e70  project, mlrun.p
+00018300: 726f 6a65 6374 732e 4d6c 7275 6e50 726f  rojects.MlrunPro
+00018310: 6a65 6374 293a 0a20 2020 2020 2020 2020  ject):.         
+00018320: 2020 2070 726f 6a65 6374 203d 2070 726f     project = pro
+00018330: 6a65 6374 2e74 6f5f 6469 6374 2829 0a20  ject.to_dict(). 
+00018340: 2020 2020 2020 2070 726f 6a65 6374 5f6e         project_n
+00018350: 616d 6520 3d20 7072 6f6a 6563 745b 226d  ame = project["m
+00018360: 6574 6164 6174 6122 5d5b 226e 616d 6522  etadata"]["name"
+00018370: 5d0a 2020 2020 2020 2020 6572 726f 725f  ].        error_
+00018380: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00018390: 6564 2063 7265 6174 696e 6720 7072 6f6a  ed creating proj
+000183a0: 6563 7420 7b70 726f 6a65 6374 5f6e 616d  ect {project_nam
+000183b0: 657d 220a 2020 2020 2020 2020 7265 7370  e}".        resp
+000183c0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+000183d0: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+000183e0: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
+000183f0: 2020 2020 2020 2270 726f 6a65 6374 7322        "projects"
+00018400: 2c0a 2020 2020 2020 2020 2020 2020 6572  ,.            er
+00018410: 726f 725f 6d65 7373 6167 652c 0a20 2020  ror_message,.   
+00018420: 2020 2020 2020 2020 2062 6f64 793d 6469           body=di
+00018430: 6374 5f74 6f5f 6a73 6f6e 2870 726f 6a65  ct_to_json(proje
+00018440: 6374 292c 0a20 2020 2020 2020 2029 0a20  ct),.        ). 
+00018450: 2020 2020 2020 2069 6620 7265 7370 6f6e         if respon
+00018460: 7365 2e73 7461 7475 735f 636f 6465 203d  se.status_code =
+00018470: 3d20 6874 7470 2e48 5454 5053 7461 7475  = http.HTTPStatu
+00018480: 732e 4143 4345 5054 4544 3a0a 2020 2020  s.ACCEPTED:.    
+00018490: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+000184a0: 656c 662e 5f77 6169 745f 666f 725f 7072  elf._wait_for_pr
+000184b0: 6f6a 6563 745f 746f 5f72 6561 6368 5f74  oject_to_reach_t
+000184c0: 6572 6d69 6e61 6c5f 7374 6174 6528 7072  erminal_state(pr
+000184d0: 6f6a 6563 745f 6e61 6d65 290a 2020 2020  oject_name).    
+000184e0: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
+000184f0: 2e70 726f 6a65 6374 732e 4d6c 7275 6e50  .projects.MlrunP
+00018500: 726f 6a65 6374 2e66 726f 6d5f 6469 6374  roject.from_dict
+00018510: 2872 6573 706f 6e73 652e 6a73 6f6e 2829  (response.json()
+00018520: 290a 0a20 2020 2064 6566 205f 7761 6974  )..    def _wait
+00018530: 5f66 6f72 5f70 726f 6a65 6374 5f74 6f5f  _for_project_to_
+00018540: 7265 6163 685f 7465 726d 696e 616c 5f73  reach_terminal_s
+00018550: 7461 7465 280a 2020 2020 2020 2020 7365  tate(.        se
+00018560: 6c66 2c20 7072 6f6a 6563 745f 6e61 6d65  lf, project_name
+00018570: 3a20 7374 720a 2020 2020 2920 2d3e 206d  : str.    ) -> m
+00018580: 6c72 756e 2e70 726f 6a65 6374 732e 4d6c  lrun.projects.Ml
+00018590: 7275 6e50 726f 6a65 6374 3a0a 2020 2020  runProject:.    
+000185a0: 2020 2020 6465 6620 5f76 6572 6966 795f      def _verify_
+000185b0: 7072 6f6a 6563 745f 696e 5f74 6572 6d69  project_in_termi
+000185c0: 6e61 6c5f 7374 6174 6528 293a 0a20 2020  nal_state():.   
+000185d0: 2020 2020 2020 2020 2070 726f 6a65 6374           project
+000185e0: 203d 2073 656c 662e 6765 745f 7072 6f6a   = self.get_proj
+000185f0: 6563 7428 7072 6f6a 6563 745f 6e61 6d65  ect(project_name
+00018600: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00018610: 2028 0a20 2020 2020 2020 2020 2020 2020   (.             
+00018620: 2020 2070 726f 6a65 6374 2e73 7461 7475     project.statu
+00018630: 732e 7374 6174 650a 2020 2020 2020 2020  s.state.        
+00018640: 2020 2020 2020 2020 6e6f 7420 696e 206d          not in m
+00018650: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00018660: 6d61 732e 5072 6f6a 6563 7453 7461 7465  mas.ProjectState
+00018670: 2e74 6572 6d69 6e61 6c5f 7374 6174 6573  .terminal_states
+00018680: 2829 0a20 2020 2020 2020 2020 2020 2029  ().            )
+00018690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000186a0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
+000186b0: 6e28 0a20 2020 2020 2020 2020 2020 2020  n(.             
+000186c0: 2020 2020 2020 2066 2250 726f 6a65 6374         f"Project
+000186d0: 206e 6f74 2069 6e20 7465 726d 696e 616c   not in terminal
+000186e0: 2073 7461 7465 2e20 5374 6174 653a 207b   state. State: {
+000186f0: 7072 6f6a 6563 742e 7374 6174 7573 2e73  project.status.s
+00018700: 7461 7465 7d22 0a20 2020 2020 2020 2020  tate}".         
+00018710: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+00018720: 2020 2020 2072 6574 7572 6e20 7072 6f6a       return proj
+00018730: 6563 740a 0a20 2020 2020 2020 2072 6574  ect..        ret
+00018740: 7572 6e20 6d6c 7275 6e2e 7574 696c 732e  urn mlrun.utils.
+00018750: 6865 6c70 6572 732e 7265 7472 795f 756e  helpers.retry_un
+00018760: 7469 6c5f 7375 6363 6573 7366 756c 280a  til_successful(.
+00018770: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00018780: 2e5f 7761 6974 5f66 6f72 5f70 726f 6a65  ._wait_for_proje
+00018790: 6374 5f74 6572 6d69 6e61 6c5f 7374 6174  ct_terminal_stat
+000187a0: 655f 7265 7472 795f 696e 7465 7276 616c  e_retry_interval
+000187b0: 2c0a 2020 2020 2020 2020 2020 2020 3132  ,.            12
+000187c0: 302c 0a20 2020 2020 2020 2020 2020 206c  0,.            l
+000187d0: 6f67 6765 722c 0a20 2020 2020 2020 2020  ogger,.         
+000187e0: 2020 2046 616c 7365 2c0a 2020 2020 2020     False,.      
+000187f0: 2020 2020 2020 5f76 6572 6966 795f 7072        _verify_pr
+00018800: 6f6a 6563 745f 696e 5f74 6572 6d69 6e61  oject_in_termina
+00018810: 6c5f 7374 6174 652c 0a20 2020 2020 2020  l_state,.       
+00018820: 2029 0a0a 2020 2020 6465 6620 5f77 6169   )..    def _wai
+00018830: 745f 666f 725f 6261 636b 6772 6f75 6e64  t_for_background
+00018840: 5f74 6173 6b5f 746f 5f72 6561 6368 5f74  _task_to_reach_t
+00018850: 6572 6d69 6e61 6c5f 7374 6174 6528 0a20  erminal_state(. 
+00018860: 2020 2020 2020 2073 656c 662c 206e 616d         self, nam
+00018870: 653a 2073 7472 0a20 2020 2029 202d 3e20  e: str.    ) -> 
+00018880: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00018890: 656d 6173 2e42 6163 6b67 726f 756e 6454  emas.BackgroundT
+000188a0: 6173 6b3a 0a20 2020 2020 2020 2064 6566  ask:.        def
+000188b0: 205f 7665 7269 6679 5f62 6163 6b67 726f   _verify_backgro
+000188c0: 756e 645f 7461 736b 5f69 6e5f 7465 726d  und_task_in_term
+000188d0: 696e 616c 5f73 7461 7465 2829 3a0a 2020  inal_state():.  
+000188e0: 2020 2020 2020 2020 2020 6261 636b 6772            backgr
+000188f0: 6f75 6e64 5f74 6173 6b20 3d20 7365 6c66  ound_task = self
+00018900: 2e67 6574 5f62 6163 6b67 726f 756e 645f  .get_background_
+00018910: 7461 736b 286e 616d 6529 0a20 2020 2020  task(name).     
+00018920: 2020 2020 2020 2073 7461 7465 203d 2062         state = b
+00018930: 6163 6b67 726f 756e 645f 7461 736b 2e73  ackground_task.s
+00018940: 7461 7475 732e 7374 6174 650a 2020 2020  tatus.state.    
+00018950: 2020 2020 2020 2020 6966 2073 7461 7465          if state
+00018960: 206e 6f74 2069 6e20 6d6c 7275 6e2e 636f   not in mlrun.co
+00018970: 6d6d 6f6e 2e73 6368 656d 6173 2e42 6163  mmon.schemas.Bac
+00018980: 6b67 726f 756e 6454 6173 6b53 7461 7465  kgroundTaskState
+00018990: 2e74 6572 6d69 6e61 6c5f 7374 6174 6573  .terminal_states
+000189a0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+000189b0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+000189c0: 696f 6e28 0a20 2020 2020 2020 2020 2020  ion(.           
+000189d0: 2020 2020 2020 2020 2066 2242 6163 6b67           f"Backg
+000189e0: 726f 756e 6420 7461 736b 206e 6f74 2069  round task not i
+000189f0: 6e20 7465 726d 696e 616c 2073 7461 7465  n terminal state
+00018a00: 2e20 6e61 6d65 3d7b 6e61 6d65 7d2c 2073  . name={name}, s
+00018a10: 7461 7465 3d7b 7374 6174 657d 220a 2020  tate={state}".  
+00018a20: 2020 2020 2020 2020 2020 2020 2020 290a                ).
+00018a30: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00018a40: 726e 2062 6163 6b67 726f 756e 645f 7461  rn background_ta
+00018a50: 736b 0a0a 2020 2020 2020 2020 7265 7475  sk..        retu
+00018a60: 726e 206d 6c72 756e 2e75 7469 6c73 2e68  rn mlrun.utils.h
+00018a70: 656c 7065 7273 2e72 6574 7279 5f75 6e74  elpers.retry_unt
+00018a80: 696c 5f73 7563 6365 7373 6675 6c28 0a20  il_successful(. 
+00018a90: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00018aa0: 5f77 6169 745f 666f 725f 6261 636b 6772  _wait_for_backgr
+00018ab0: 6f75 6e64 5f74 6173 6b5f 7465 726d 696e  ound_task_termin
+00018ac0: 616c 5f73 7461 7465 5f72 6574 7279 5f69  al_state_retry_i
+00018ad0: 6e74 6572 7661 6c2c 0a20 2020 2020 2020  nterval,.       
+00018ae0: 2020 2020 2036 3020 2a20 3630 2c0a 2020       60 * 60,.  
+00018af0: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+00018b00: 2c0a 2020 2020 2020 2020 2020 2020 4661  ,.            Fa
+00018b10: 6c73 652c 0a20 2020 2020 2020 2020 2020  lse,.           
+00018b20: 205f 7665 7269 6679 5f62 6163 6b67 726f   _verify_backgro
+00018b30: 756e 645f 7461 736b 5f69 6e5f 7465 726d  und_task_in_term
+00018b40: 696e 616c 5f73 7461 7465 2c0a 2020 2020  inal_state,.    
+00018b50: 2020 2020 290a 0a20 2020 2064 6566 205f      )..    def _
+00018b60: 7761 6974 5f66 6f72 5f70 726f 6a65 6374  wait_for_project
+00018b70: 5f74 6f5f 6265 5f64 656c 6574 6564 2873  _to_be_deleted(s
+00018b80: 656c 662c 2070 726f 6a65 6374 5f6e 616d  elf, project_nam
+00018b90: 653a 2073 7472 293a 0a20 2020 2020 2020  e: str):.       
+00018ba0: 2064 6566 205f 7665 7269 6679 5f70 726f   def _verify_pro
+00018bb0: 6a65 6374 5f64 656c 6574 6564 2829 3a0a  ject_deleted():.
+00018bc0: 2020 2020 2020 2020 2020 2020 7072 6f6a              proj
+00018bd0: 6563 7473 203d 2073 656c 662e 6c69 7374  ects = self.list
+00018be0: 5f70 726f 6a65 6374 7328 0a20 2020 2020  _projects(.     
+00018bf0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+00018c00: 745f 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e  t_=mlrun.common.
+00018c10: 7363 6865 6d61 732e 5072 6f6a 6563 7473  schemas.Projects
+00018c20: 466f 726d 6174 2e6e 616d 655f 6f6e 6c79  Format.name_only
+00018c30: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+00018c40: 2020 2020 2020 2020 2020 2069 6620 7072             if pr
+00018c50: 6f6a 6563 745f 6e61 6d65 2069 6e20 7072  oject_name in pr
+00018c60: 6f6a 6563 7473 3a0a 2020 2020 2020 2020  ojects:.        
+00018c70: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+00018c80: 6365 7074 696f 6e28 6622 5072 6f6a 6563  ception(f"Projec
+00018c90: 7420 7b70 726f 6a65 6374 5f6e 616d 657d  t {project_name}
+00018ca0: 2073 7469 6c6c 2065 7869 7374 7322 290a   still exists").
+00018cb0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+00018cc0: 6d6c 7275 6e2e 7574 696c 732e 6865 6c70  mlrun.utils.help
+00018cd0: 6572 732e 7265 7472 795f 756e 7469 6c5f  ers.retry_until_
+00018ce0: 7375 6363 6573 7366 756c 280a 2020 2020  successful(.    
+00018cf0: 2020 2020 2020 2020 7365 6c66 2e5f 7761          self._wa
+00018d00: 6974 5f66 6f72 5f70 726f 6a65 6374 5f64  it_for_project_d
+00018d10: 656c 6574 696f 6e5f 696e 7465 7276 616c  eletion_interval
+00018d20: 2c0a 2020 2020 2020 2020 2020 2020 3132  ,.            12
+00018d30: 302c 0a20 2020 2020 2020 2020 2020 206c  0,.            l
+00018d40: 6f67 6765 722c 0a20 2020 2020 2020 2020  ogger,.         
+00018d50: 2020 2046 616c 7365 2c0a 2020 2020 2020     False,.      
+00018d60: 2020 2020 2020 5f76 6572 6966 795f 7072        _verify_pr
+00018d70: 6f6a 6563 745f 6465 6c65 7465 642c 0a20  oject_deleted,. 
+00018d80: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00018d90: 6620 6372 6561 7465 5f70 726f 6a65 6374  f create_project
+00018da0: 5f73 6563 7265 7473 280a 2020 2020 2020  _secrets(.      
+00018db0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+00018dc0: 7072 6f6a 6563 743a 2073 7472 2c0a 2020  project: str,.  
+00018dd0: 2020 2020 2020 7072 6f76 6964 6572 3a20        provider: 
+00018de0: 556e 696f 6e5b 0a20 2020 2020 2020 2020  Union[.         
+00018df0: 2020 2073 7472 2c20 6d6c 7275 6e2e 636f     str, mlrun.co
+00018e00: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
+00018e10: 7265 7450 726f 7669 6465 724e 616d 650a  retProviderName.
+00018e20: 2020 2020 2020 2020 5d20 3d20 6d6c 7275          ] = mlru
+00018e30: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+00018e40: 2e53 6563 7265 7450 726f 7669 6465 724e  .SecretProviderN
+00018e50: 616d 652e 6b75 6265 726e 6574 6573 2c0a  ame.kubernetes,.
+00018e60: 2020 2020 2020 2020 7365 6372 6574 733a          secrets:
+00018e70: 2064 6963 7420 3d20 4e6f 6e65 2c0a 2020   dict = None,.  
+00018e80: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+00018e90: 4372 6561 7465 2070 726f 6a65 6374 2d63  Create project-c
+00018ea0: 6f6e 7465 7874 2073 6563 7265 7473 2075  ontext secrets u
+00018eb0: 7369 6e67 2065 6974 6865 7220 6060 7661  sing either ``va
+00018ec0: 756c 7460 6020 6f72 2060 606b 7562 6572  ult`` or ``kuber
+00018ed0: 6e65 7465 7360 6020 7072 6f76 6964 6572  netes`` provider
+00018ee0: 2e0a 2020 2020 2020 2020 5768 656e 2075  ..        When u
+00018ef0: 7369 6e67 2077 6974 6820 5661 756c 742c  sing with Vault,
+00018f00: 2074 6869 7320 7769 6c6c 2063 7265 6174   this will creat
+00018f10: 6520 6e65 6564 6564 2056 6175 6c74 2073  e needed Vault s
+00018f20: 7472 7563 7475 7265 7320 666f 7220 7374  tructures for st
+00018f30: 6f72 696e 6720 7365 6372 6574 7320 696e  oring secrets in
+00018f40: 2070 726f 6a65 6374 2d63 6f6e 7465 7874   project-context
+00018f50: 2c20 616e 640a 2020 2020 2020 2020 7374  , and.        st
+00018f60: 6f72 6520 6120 7365 7420 6f66 2073 6563  ore a set of sec
+00018f70: 7265 7420 7661 6c75 6573 2e20 5468 6520  ret values. The 
+00018f80: 6d65 7468 6f64 2067 656e 6572 6174 6573  method generates
+00018f90: 204b 7562 6572 6e65 7465 7320 7365 7276   Kubernetes serv
+00018fa0: 6963 652d 6163 636f 756e 7420 616e 6420  ice-account and 
+00018fb0: 7468 6520 5661 756c 7420 6175 7468 656e  the Vault authen
+00018fc0: 7469 6361 7469 6f6e 0a20 2020 2020 2020  tication.       
+00018fd0: 2073 7472 7563 7475 7265 7320 7468 6174   structures that
+00018fe0: 2061 7265 2072 6571 7569 7265 6420 666f   are required fo
+00018ff0: 7220 6675 6e63 7469 6f6e 2050 6f64 7320  r function Pods 
+00019000: 746f 2061 7574 6865 6e74 6963 6174 6520  to authenticate 
+00019010: 7769 7468 2056 6175 6c74 2061 6e64 2062  with Vault and b
+00019020: 6520 6162 6c65 2074 6f20 6578 7472 6163  e able to extrac
+00019030: 7420 7365 6372 6574 2076 616c 7565 730a  t secret values.
+00019040: 2020 2020 2020 2020 7061 7373 6564 2061          passed a
+00019050: 7320 7061 7274 206f 6620 7468 6569 7220  s part of their 
+00019060: 636f 6e74 6578 742e 0a0a 2020 2020 2020  context...      
+00019070: 2020 4e6f 7465 3a0a 2020 2020 2020 2020    Note:.        
+00019080: 2020 2020 2020 2020 5468 6973 206d 6574          This met
+00019090: 686f 6420 7573 6564 2077 6974 6820 5661  hod used with Va
+000190a0: 756c 7420 6973 2063 7572 7265 6e74 6c79  ult is currently
+000190b0: 2069 6e20 7465 6368 6e69 6361 6c20 7072   in technical pr
+000190c0: 6576 6965 772c 2061 6e64 2072 6571 7569  eview, and requi
+000190d0: 7265 7320 6120 4861 7368 6943 6f72 7020  res a HashiCorp 
+000190e0: 5661 756c 740a 2020 2020 2020 2020 2020  Vault.          
+000190f0: 2020 2020 2020 696e 6672 6173 7472 7563        infrastruc
+00019100: 7475 7265 2070 726f 7065 726c 7920 7365  ture properly se
+00019110: 7420 7570 2061 6e64 2063 6f6e 6e65 6374  t up and connect
+00019120: 6564 2074 6f20 7468 6520 4d4c 5275 6e20  ed to the MLRun 
+00019130: 4150 4920 7365 7276 6572 2e0a 0a20 2020  API server...   
+00019140: 2020 2020 2057 6865 6e20 7573 6564 2077       When used w
+00019150: 6974 6820 4b75 6265 726e 6574 6573 2c20  ith Kubernetes, 
+00019160: 7468 6973 2077 696c 6c20 6d61 6b65 2073  this will make s
+00019170: 7572 6520 7468 6174 2074 6865 2070 726f  ure that the pro
+00019180: 6a65 6374 2d73 7065 6369 6669 6320 6b38  ject-specific k8
+00019190: 7320 7365 6372 6574 2069 7320 6372 6561  s secret is crea
+000191a0: 7465 642c 2061 6e64 2077 696c 6c0a 2020  ted, and will.  
+000191b0: 2020 2020 2020 706f 7075 6c61 7465 2069        populate i
+000191c0: 7420 7769 7468 2074 6865 2073 6563 7265  t with the secre
+000191d0: 7473 2070 726f 7669 6465 642c 2072 6570  ts provided, rep
+000191e0: 6c61 6369 6e67 2074 6865 6972 2076 616c  lacing their val
+000191f0: 7565 7320 6966 2074 6865 7920 6578 6973  ues if they exis
+00019200: 742e 0a0a 2020 2020 2020 2020 3a70 6172  t...        :par
+00019210: 616d 2070 726f 6a65 6374 3a20 5468 6520  am project: The 
+00019220: 7072 6f6a 6563 7420 636f 6e74 6578 7420  project context 
+00019230: 666f 7220 7768 6963 6820 746f 2067 656e  for which to gen
+00019240: 6572 6174 6520 7468 6520 696e 6672 6120  erate the infra 
+00019250: 616e 6420 7374 6f72 6520 7365 6372 6574  and store secret
+00019260: 732e 0a20 2020 2020 2020 203a 7061 7261  s..        :para
+00019270: 6d20 7072 6f76 6964 6572 3a20 5468 6520  m provider: The 
+00019280: 6e61 6d65 206f 6620 7468 6520 7365 6372  name of the secr
+00019290: 6574 732d 7072 6f76 6964 6572 2074 6f20  ets-provider to 
+000192a0: 776f 726b 2077 6974 682e 2041 6363 6570  work with. Accep
+000192b0: 7473 2061 0a20 2020 2020 2020 2020 2020  ts a.           
+000192c0: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
+000192d0: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+000192e0: 732e 7365 6372 6574 2e53 6563 7265 7450  s.secret.SecretP
+000192f0: 726f 7669 6465 724e 616d 6560 2065 6e75  roviderName` enu
+00019300: 6d2e 0a20 2020 2020 2020 203a 7061 7261  m..        :para
+00019310: 6d20 7365 6372 6574 733a 2041 2073 6574  m secrets: A set
+00019320: 206f 6620 7365 6372 6574 2076 616c 7565   of secret value
+00019330: 7320 746f 2073 746f 7265 2e0a 2020 2020  s to store..    
+00019340: 2020 2020 2020 2020 4578 616d 706c 653a          Example:
+00019350: 3a0a 0a20 2020 2020 2020 2020 2020 2020  :..             
+00019360: 2020 2073 6563 7265 7473 203d 207b 2770     secrets = {'p
+00019370: 6173 7377 6f72 6427 3a20 276d 7950 6173  assword': 'myPas
+00019380: 7377 3072 6427 2c20 2761 7773 5f6b 6579  sw0rd', 'aws_key
+00019390: 273a 2027 3131 3132 3232 3333 3327 7d0a  ': '111222333'}.
+000193a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193b0: 6462 2e63 7265 6174 655f 7072 6f6a 6563  db.create_projec
+000193c0: 745f 7365 6372 6574 7328 0a20 2020 2020  t_secrets(.     
+000193d0: 2020 2020 2020 2020 2020 2020 2020 2022                 "
+000193e0: 7072 6f6a 6563 7431 222c 0a20 2020 2020  project1",.     
+000193f0: 2020 2020 2020 2020 2020 2020 2020 2070                 p
+00019400: 726f 7669 6465 723d 6d6c 7275 6e2e 636f  rovider=mlrun.co
+00019410: 6d6d 6f6e 2e73 6368 656d 6173 2e53 6563  mmon.schemas.Sec
+00019420: 7265 7450 726f 7669 6465 724e 616d 652e  retProviderName.
+00019430: 6b75 6265 726e 6574 6573 2c0a 2020 2020  kubernetes,.    
+00019440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019450: 7365 6372 6574 733d 7365 6372 6574 730a  secrets=secrets.
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 290a 2020 2020 2020 2020 2222 220a 2020  ).        """.  
+00019480: 2020 2020 2020 7061 7468 203d 2066 2270        path = f"p
+00019490: 726f 6a65 6374 732f 7b70 726f 6a65 6374  rojects/{project
+000194a0: 7d2f 7365 6372 6574 7322 0a20 2020 2020  }/secrets".     
+000194b0: 2020 2073 6563 7265 7473 5f69 6e70 7574     secrets_input
+000194c0: 203d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e   = mlrun.common.
+000194d0: 7363 6865 6d61 732e 5365 6372 6574 7344  schemas.SecretsD
+000194e0: 6174 6128 0a20 2020 2020 2020 2020 2020  ata(.           
+000194f0: 2073 6563 7265 7473 3d73 6563 7265 7473   secrets=secrets
+00019500: 2c20 7072 6f76 6964 6572 3d70 726f 7669  , provider=provi
+00019510: 6465 720a 2020 2020 2020 2020 290a 2020  der.        ).  
+00019520: 2020 2020 2020 626f 6479 203d 2073 6563        body = sec
+00019530: 7265 7473 5f69 6e70 7574 2e64 6963 7428  rets_input.dict(
+00019540: 290a 2020 2020 2020 2020 6572 726f 725f  ).        error_
+00019550: 6d65 7373 6167 6520 3d20 6622 4661 696c  message = f"Fail
+00019560: 6564 2063 7265 6174 696e 6720 7365 6372  ed creating secr
+00019570: 6574 2070 726f 7669 6465 7220 7b70 726f  et provider {pro
+00019580: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
+00019590: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+000195a0: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+000195b0: 2020 2020 2022 504f 5354 222c 0a20 2020       "POST",.   
+000195c0: 2020 2020 2020 2020 2070 6174 682c 0a20           path,. 
+000195d0: 2020 2020 2020 2020 2020 2065 7272 6f72             error
+000195e0: 5f6d 6573 7361 6765 2c0a 2020 2020 2020  _message,.      
+000195f0: 2020 2020 2020 626f 6479 3d64 6963 745f        body=dict_
+00019600: 746f 5f6a 736f 6e28 626f 6479 292c 0a20  to_json(body),. 
+00019610: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+00019620: 6620 6c69 7374 5f70 726f 6a65 6374 5f73  f list_project_s
+00019630: 6563 7265 7473 280a 2020 2020 2020 2020  ecrets(.        
+00019640: 7365 6c66 2c0a 2020 2020 2020 2020 7072  self,.        pr
+00019650: 6f6a 6563 743a 2073 7472 2c0a 2020 2020  oject: str,.    
+00019660: 2020 2020 746f 6b65 6e3a 2073 7472 203d      token: str =
+00019670: 204e 6f6e 652c 0a20 2020 2020 2020 2070   None,.        p
+00019680: 726f 7669 6465 723a 2055 6e69 6f6e 5b0a  rovider: Union[.
+00019690: 2020 2020 2020 2020 2020 2020 7374 722c              str,
+000196a0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
+000196b0: 6865 6d61 732e 5365 6372 6574 5072 6f76  hemas.SecretProv
+000196c0: 6964 6572 4e61 6d65 0a20 2020 2020 2020  iderName.       
+000196d0: 205d 203d 206d 6c72 756e 2e63 6f6d 6d6f   ] = mlrun.commo
+000196e0: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
+000196f0: 5072 6f76 6964 6572 4e61 6d65 2e6b 7562  ProviderName.kub
+00019700: 6572 6e65 7465 732c 0a20 2020 2020 2020  ernetes,.       
+00019710: 2073 6563 7265 7473 3a20 4c69 7374 5b73   secrets: List[s
+00019720: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+00019730: 2920 2d3e 206d 6c72 756e 2e63 6f6d 6d6f  ) -> mlrun.commo
+00019740: 6e2e 7363 6865 6d61 732e 5365 6372 6574  n.schemas.Secret
+00019750: 7344 6174 613a 0a20 2020 2020 2020 2022  sData:.        "
+00019760: 2222 5265 7472 6965 7665 2070 726f 6a65  ""Retrieve proje
+00019770: 6374 2d63 6f6e 7465 7874 2073 6563 7265  ct-context secre
+00019780: 7473 2066 726f 6d20 5661 756c 742e 0a0a  ts from Vault...
+00019790: 2020 2020 2020 2020 4e6f 7465 3a0a 2020          Note:.  
+000197a0: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+000197b0: 6973 206d 6574 686f 6420 666f 7220 5661  is method for Va
+000197c0: 756c 7420 6675 6e63 7469 6f6e 616c 6974  ult functionalit
+000197d0: 7920 6973 2063 7572 7265 6e74 6c79 2069  y is currently i
+000197e0: 6e20 7465 6368 6e69 6361 6c20 7072 6576  n technical prev
+000197f0: 6965 772c 2061 6e64 2072 6571 7569 7265  iew, and require
+00019800: 7320 6120 4861 7368 6943 6f72 7020 5661  s a HashiCorp Va
+00019810: 756c 740a 2020 2020 2020 2020 2020 2020  ult.            
+00019820: 2020 2020 696e 6672 6173 7472 7563 7475      infrastructu
+00019830: 7265 2070 726f 7065 726c 7920 7365 7420  re properly set 
+00019840: 7570 2061 6e64 2063 6f6e 6e65 6374 6564  up and connected
+00019850: 2074 6f20 7468 6520 4d4c 5275 6e20 4150   to the MLRun AP
+00019860: 4920 7365 7276 6572 2e0a 0a20 2020 2020  I server...     
+00019870: 2020 203a 7061 7261 6d20 7072 6f6a 6563     :param projec
+00019880: 743a 2054 6865 2070 726f 6a65 6374 206e  t: The project n
+00019890: 616d 652e 0a20 2020 2020 2020 203a 7061  ame..        :pa
+000198a0: 7261 6d20 746f 6b65 6e3a 2056 6175 6c74  ram token: Vault
+000198b0: 2074 6f6b 656e 2074 6f20 7573 6520 666f   token to use fo
+000198c0: 7220 7265 7472 6965 7669 6e67 2073 6563  r retrieving sec
+000198d0: 7265 7473 2e0a 2020 2020 2020 2020 2020  rets..          
+000198e0: 2020 4d75 7374 2062 6520 6120 7661 6c69    Must be a vali
+000198f0: 6420 5661 756c 7420 746f 6b65 6e2c 2077  d Vault token, w
+00019900: 6974 6820 7065 726d 6973 7369 6f6e 7320  ith permissions 
+00019910: 746f 2072 6574 7269 6576 6520 7365 6372  to retrieve secr
+00019920: 6574 7320 6f66 2074 6865 2070 726f 6a65  ets of the proje
+00019930: 6374 2069 6e20 7175 6573 7469 6f6e 2e0a  ct in question..
+00019940: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00019950: 726f 7669 6465 723a 2054 6865 206e 616d  rovider: The nam
+00019960: 6520 6f66 2074 6865 2073 6563 7265 7473  e of the secrets
+00019970: 2d70 726f 7669 6465 7220 746f 2077 6f72  -provider to wor
+00019980: 6b20 7769 7468 2e20 4375 7272 656e 746c  k with. Currentl
+00019990: 7920 6f6e 6c79 2060 6076 6175 6c74 6060  y only ``vault``
+000199a0: 2069 7320 6163 6365 7074 6564 2e0a 2020   is accepted..  
+000199b0: 2020 2020 2020 3a70 6172 616d 2073 6563        :param sec
+000199c0: 7265 7473 3a20 4120 6c69 7374 206f 6620  rets: A list of 
+000199d0: 7365 6372 6574 206e 616d 6573 2074 6f20  secret names to 
+000199e0: 7265 7472 6965 7665 2e20 416e 2065 6d70  retrieve. An emp
+000199f0: 7479 206c 6973 7420 6060 5b5d 6060 2077  ty list ``[]`` w
+00019a00: 696c 6c20 7265 7472 6965 7665 2061 6c6c  ill retrieve all
+00019a10: 2073 6563 7265 7473 2061 7373 6967 6e65   secrets assigne
+00019a20: 640a 2020 2020 2020 2020 2020 2020 746f  d.            to
+00019a30: 2074 6869 7320 7370 6563 6966 6963 2070   this specific p
+00019a40: 726f 6a65 6374 2e20 6060 6b75 6265 726e  roject. ``kubern
+00019a50: 6574 6573 6060 2070 726f 7669 6465 7220  etes`` provider 
+00019a60: 6f6e 6c79 2073 7570 706f 7274 7320 616e  only supports an
+00019a70: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
+00019a80: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+00019a90: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+00019aa0: 2020 2070 726f 7669 6465 7220 3d3d 206d     provider == m
+00019ab0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+00019ac0: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
+00019ad0: 6572 4e61 6d65 2e76 6175 6c74 2e76 616c  erName.vault.val
+00019ae0: 7565 0a20 2020 2020 2020 2020 2020 2061  ue.            a
+00019af0: 6e64 206e 6f74 2074 6f6b 656e 0a20 2020  nd not token.   
+00019b00: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+00019b10: 2020 2020 7261 6973 6520 4d4c 5275 6e49      raise MLRunI
+00019b20: 6e76 616c 6964 4172 6775 6d65 6e74 4572  nvalidArgumentEr
+00019b30: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+00019b40: 2020 2020 2022 4120 7661 756c 7420 746f       "A vault to
+00019b50: 6b65 6e20 6d75 7374 2062 6520 7072 6f76  ken must be prov
+00019b60: 6964 6564 2077 6865 6e20 6163 6365 7373  ided when access
+00019b70: 696e 6720 7661 756c 7420 7365 6372 6574  ing vault secret
+00019b80: 7322 0a20 2020 2020 2020 2020 2020 2029  s".            )
+00019b90: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
+00019ba0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+00019bb0: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
+00019bc0: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+00019bd0: 7b22 7072 6f76 6964 6572 223a 2070 726f  {"provider": pro
+00019be0: 7669 6465 722c 2022 7365 6372 6574 223a  vider, "secret":
+00019bf0: 2073 6563 7265 7473 7d0a 2020 2020 2020   secrets}.      
+00019c00: 2020 6865 6164 6572 7320 3d20 7b6d 6c72    headers = {mlr
+00019c10: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
+00019c20: 732e 4865 6164 6572 4e61 6d65 732e 7365  s.HeaderNames.se
+00019c30: 6372 6574 5f73 746f 7265 5f74 6f6b 656e  cret_store_token
+00019c40: 3a20 746f 6b65 6e7d 0a20 2020 2020 2020  : token}.       
+00019c50: 2065 7272 6f72 5f6d 6573 7361 6765 203d   error_message =
+00019c60: 2066 2246 6169 6c65 6420 7265 7472 6965   f"Failed retrie
+00019c70: 7669 6e67 2073 6563 7265 7473 207b 7072  ving secrets {pr
+00019c80: 6f6a 6563 747d 2f7b 7072 6f76 6964 6572  oject}/{provider
+00019c90: 7d22 0a20 2020 2020 2020 2072 6573 756c  }".        resul
+00019ca0: 7420 3d20 7365 6c66 2e61 7069 5f63 616c  t = self.api_cal
+00019cb0: 6c28 0a20 2020 2020 2020 2020 2020 2022  l(.            "
+00019cc0: 4745 5422 2c0a 2020 2020 2020 2020 2020  GET",.          
+00019cd0: 2020 7061 7468 2c0a 2020 2020 2020 2020    path,.        
+00019ce0: 2020 2020 6572 726f 725f 6d65 7373 6167      error_messag
+00019cf0: 652c 0a20 2020 2020 2020 2020 2020 2070  e,.            p
+00019d00: 6172 616d 733d 7061 7261 6d73 2c0a 2020  arams=params,.  
+00019d10: 2020 2020 2020 2020 2020 6865 6164 6572            header
+00019d20: 733d 6865 6164 6572 732c 0a20 2020 2020  s=headers,.     
+00019d30: 2020 2029 0a20 2020 2020 2020 2072 6574     ).        ret
+00019d40: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
+00019d50: 2e73 6368 656d 6173 2e53 6563 7265 7473  .schemas.Secrets
+00019d60: 4461 7461 282a 2a72 6573 756c 742e 6a73  Data(**result.js
+00019d70: 6f6e 2829 290a 0a20 2020 2064 6566 206c  on())..    def l
+00019d80: 6973 745f 7072 6f6a 6563 745f 7365 6372  ist_project_secr
+00019d90: 6574 5f6b 6579 7328 0a20 2020 2020 2020  et_keys(.       
+00019da0: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+00019db0: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+00019dc0: 2020 2020 2070 726f 7669 6465 723a 2055       provider: U
+00019dd0: 6e69 6f6e 5b0a 2020 2020 2020 2020 2020  nion[.          
+00019de0: 2020 7374 722c 206d 6c72 756e 2e63 6f6d    str, mlrun.com
+00019df0: 6d6f 6e2e 7363 6865 6d61 732e 5365 6372  mon.schemas.Secr
+00019e00: 6574 5072 6f76 6964 6572 4e61 6d65 0a20  etProviderName. 
+00019e10: 2020 2020 2020 205d 203d 206d 6c72 756e         ] = mlrun
+00019e20: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+00019e30: 5365 6372 6574 5072 6f76 6964 6572 4e61  SecretProviderNa
+00019e40: 6d65 2e6b 7562 6572 6e65 7465 732c 0a20  me.kubernetes,. 
+00019e50: 2020 2020 2020 2074 6f6b 656e 3a20 7374         token: st
+00019e60: 7220 3d20 4e6f 6e65 2c0a 2020 2020 2920  r = None,.    ) 
+00019e70: 2d3e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  -> mlrun.common.
+00019e80: 7363 6865 6d61 732e 5365 6372 6574 4b65  schemas.SecretKe
+00019e90: 7973 4461 7461 3a0a 2020 2020 2020 2020  ysData:.        
+00019ea0: 2222 2252 6574 7269 6576 6520 7072 6f6a  """Retrieve proj
+00019eb0: 6563 742d 636f 6e74 6578 7420 7365 6372  ect-context secr
+00019ec0: 6574 206b 6579 7320 6672 6f6d 2056 6175  et keys from Vau
+00019ed0: 6c74 206f 7220 4b75 6265 726e 6574 6573  lt or Kubernetes
+00019ee0: 2e0a 0a20 2020 2020 2020 204e 6f74 653a  ...        Note:
+00019ef0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019f00: 2054 6869 7320 6d65 7468 6f64 2066 6f72   This method for
+00019f10: 2056 6175 6c74 2066 756e 6374 696f 6e61   Vault functiona
+00019f20: 6c69 7479 2069 7320 6375 7272 656e 746c  lity is currentl
+00019f30: 7920 696e 2074 6563 686e 6963 616c 2070  y in technical p
+00019f40: 7265 7669 6577 2c20 616e 6420 7265 7175  review, and requ
+00019f50: 6972 6573 2061 2048 6173 6869 436f 7270  ires a HashiCorp
+00019f60: 2056 6175 6c74 0a20 2020 2020 2020 2020   Vault.         
+00019f70: 2020 2020 2020 2069 6e66 7261 7374 7275         infrastru
+00019f80: 6374 7572 6520 7072 6f70 6572 6c79 2073  cture properly s
+00019f90: 6574 2075 7020 616e 6420 636f 6e6e 6563  et up and connec
+00019fa0: 7465 6420 746f 2074 6865 204d 4c52 756e  ted to the MLRun
+00019fb0: 2041 5049 2073 6572 7665 722e 0a0a 2020   API server...  
+00019fc0: 2020 2020 2020 3a70 6172 616d 2070 726f        :param pro
+00019fd0: 6a65 6374 3a20 5468 6520 7072 6f6a 6563  ject: The projec
+00019fe0: 7420 6e61 6d65 2e0a 2020 2020 2020 2020  t name..        
+00019ff0: 3a70 6172 616d 2070 726f 7669 6465 723a  :param provider:
+0001a000: 2054 6865 206e 616d 6520 6f66 2074 6865   The name of the
+0001a010: 2073 6563 7265 7473 2d70 726f 7669 6465   secrets-provide
+0001a020: 7220 746f 2077 6f72 6b20 7769 7468 2e20  r to work with. 
+0001a030: 4163 6365 7074 7320 610a 2020 2020 2020  Accepts a.      
+0001a040: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
+0001a050: 607e 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  `~mlrun.common.s
+0001a060: 6368 656d 6173 2e73 6563 7265 742e 5365  chemas.secret.Se
+0001a070: 6372 6574 5072 6f76 6964 6572 4e61 6d65  cretProviderName
+0001a080: 6020 656e 756d 2e0a 2020 2020 2020 2020  ` enum..        
+0001a090: 3a70 6172 616d 2074 6f6b 656e 3a20 5661  :param token: Va
+0001a0a0: 756c 7420 746f 6b65 6e20 746f 2075 7365  ult token to use
+0001a0b0: 2066 6f72 2072 6574 7269 6576 696e 6720   for retrieving 
+0001a0c0: 7365 6372 6574 732e 204f 6e6c 7920 696e  secrets. Only in
+0001a0d0: 2075 7365 2069 6620 6060 7072 6f76 6964   use if ``provid
+0001a0e0: 6572 6060 2069 7320 6060 7661 756c 7460  er`` is ``vault`
+0001a0f0: 602e 0a20 2020 2020 2020 2020 2020 204d  `..            M
+0001a100: 7573 7420 6265 2061 2076 616c 6964 2056  ust be a valid V
+0001a110: 6175 6c74 2074 6f6b 656e 2c20 7769 7468  ault token, with
+0001a120: 2070 6572 6d69 7373 696f 6e73 2074 6f20   permissions to 
+0001a130: 7265 7472 6965 7665 2073 6563 7265 7473  retrieve secrets
+0001a140: 206f 6620 7468 6520 7072 6f6a 6563 7420   of the project 
+0001a150: 696e 2071 7565 7374 696f 6e2e 0a20 2020  in question..   
+0001a160: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
+0001a170: 2020 6966 2028 0a20 2020 2020 2020 2020    if (.         
+0001a180: 2020 2070 726f 7669 6465 7220 3d3d 206d     provider == m
+0001a190: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001a1a0: 6d61 732e 5365 6372 6574 5072 6f76 6964  mas.SecretProvid
+0001a1b0: 6572 4e61 6d65 2e76 6175 6c74 2e76 616c  erName.vault.val
+0001a1c0: 7565 0a20 2020 2020 2020 2020 2020 2061  ue.            a
+0001a1d0: 6e64 206e 6f74 2074 6f6b 656e 0a20 2020  nd not token.   
+0001a1e0: 2020 2020 2029 3a0a 2020 2020 2020 2020       ):.        
+0001a1f0: 2020 2020 7261 6973 6520 4d4c 5275 6e49      raise MLRunI
+0001a200: 6e76 616c 6964 4172 6775 6d65 6e74 4572  nvalidArgumentEr
+0001a210: 726f 7228 0a20 2020 2020 2020 2020 2020  ror(.           
+0001a220: 2020 2020 2022 4120 7661 756c 7420 746f       "A vault to
+0001a230: 6b65 6e20 6d75 7374 2062 6520 7072 6f76  ken must be prov
+0001a240: 6964 6564 2077 6865 6e20 6163 6365 7373  ided when access
+0001a250: 696e 6720 7661 756c 7420 7365 6372 6574  ing vault secret
+0001a260: 7322 0a20 2020 2020 2020 2020 2020 2029  s".            )
+0001a270: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
+0001a280: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0001a290: 6a65 6374 7d2f 7365 6372 6574 2d6b 6579  ject}/secret-key
+0001a2a0: 7322 0a20 2020 2020 2020 2070 6172 616d  s".        param
+0001a2b0: 7320 3d20 7b22 7072 6f76 6964 6572 223a  s = {"provider":
+0001a2c0: 2070 726f 7669 6465 727d 0a20 2020 2020   provider}.     
+0001a2d0: 2020 2068 6561 6465 7273 203d 2028 0a20     headers = (. 
+0001a2e0: 2020 2020 2020 2020 2020 207b 6d6c 7275             {mlru
+0001a2f0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0001a300: 2e48 6561 6465 724e 616d 6573 2e73 6563  .HeaderNames.sec
+0001a310: 7265 745f 7374 6f72 655f 746f 6b65 6e3a  ret_store_token:
+0001a320: 2074 6f6b 656e 7d0a 2020 2020 2020 2020   token}.        
+0001a330: 2020 2020 6966 2070 726f 7669 6465 7220      if provider 
+0001a340: 3d3d 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  == mlrun.common.
+0001a350: 7363 6865 6d61 732e 5365 6372 6574 5072  schemas.SecretPr
+0001a360: 6f76 6964 6572 4e61 6d65 2e76 6175 6c74  oviderName.vault
+0001a370: 2e76 616c 7565 0a20 2020 2020 2020 2020  .value.         
+0001a380: 2020 2065 6c73 6520 4e6f 6e65 0a20 2020     else None.   
+0001a390: 2020 2020 2029 0a20 2020 2020 2020 2065       ).        e
+0001a3a0: 7272 6f72 5f6d 6573 7361 6765 203d 2066  rror_message = f
+0001a3b0: 2246 6169 6c65 6420 7265 7472 6965 7669  "Failed retrievi
+0001a3c0: 6e67 2073 6563 7265 7420 6b65 7973 207b  ng secret keys {
+0001a3d0: 7072 6f6a 6563 747d 2f7b 7072 6f76 6964  project}/{provid
+0001a3e0: 6572 7d22 0a20 2020 2020 2020 2072 6573  er}".        res
+0001a3f0: 756c 7420 3d20 7365 6c66 2e61 7069 5f63  ult = self.api_c
+0001a400: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+0001a410: 2022 4745 5422 2c0a 2020 2020 2020 2020   "GET",.        
+0001a420: 2020 2020 7061 7468 2c0a 2020 2020 2020      path,.      
+0001a430: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+0001a440: 6167 652c 0a20 2020 2020 2020 2020 2020  age,.           
+0001a450: 2070 6172 616d 733d 7061 7261 6d73 2c0a   params=params,.
+0001a460: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0001a470: 6572 733d 6865 6164 6572 732c 0a20 2020  ers=headers,.   
+0001a480: 2020 2020 2029 0a20 2020 2020 2020 2072       ).        r
+0001a490: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
+0001a4a0: 6f6e 2e73 6368 656d 6173 2e53 6563 7265  on.schemas.Secre
+0001a4b0: 744b 6579 7344 6174 6128 2a2a 7265 7375  tKeysData(**resu
+0001a4c0: 6c74 2e6a 736f 6e28 2929 0a0a 2020 2020  lt.json())..    
+0001a4d0: 6465 6620 6465 6c65 7465 5f70 726f 6a65  def delete_proje
+0001a4e0: 6374 5f73 6563 7265 7473 280a 2020 2020  ct_secrets(.    
+0001a4f0: 2020 2020 7365 6c66 2c0a 2020 2020 2020      self,.      
+0001a500: 2020 7072 6f6a 6563 743a 2073 7472 2c0a    project: str,.
+0001a510: 2020 2020 2020 2020 7072 6f76 6964 6572          provider
+0001a520: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
+0001a530: 2020 2020 2073 7472 2c20 6d6c 7275 6e2e       str, mlrun.
+0001a540: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+0001a550: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
+0001a560: 650a 2020 2020 2020 2020 5d20 3d20 6d6c  e.        ] = ml
+0001a570: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001a580: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+0001a590: 724e 616d 652e 6b75 6265 726e 6574 6573  rName.kubernetes
+0001a5a0: 2c0a 2020 2020 2020 2020 7365 6372 6574  ,.        secret
+0001a5b0: 733a 204c 6973 745b 7374 725d 203d 204e  s: List[str] = N
+0001a5c0: 6f6e 652c 0a20 2020 2029 3a0a 2020 2020  one,.    ):.    
+0001a5d0: 2020 2020 2222 2244 656c 6574 6520 7072      """Delete pr
+0001a5e0: 6f6a 6563 742d 636f 6e74 6578 7420 7365  oject-context se
+0001a5f0: 6372 6574 7320 6672 6f6d 204b 7562 6572  crets from Kuber
+0001a600: 6e65 7465 732e 0a0a 2020 2020 2020 2020  netes...        
+0001a610: 3a70 6172 616d 2070 726f 6a65 6374 3a20  :param project: 
+0001a620: 5468 6520 7072 6f6a 6563 7420 6e61 6d65  The project name
+0001a630: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001a640: 2070 726f 7669 6465 723a 2054 6865 206e   provider: The n
+0001a650: 616d 6520 6f66 2074 6865 2073 6563 7265  ame of the secre
+0001a660: 7473 2d70 726f 7669 6465 7220 746f 2077  ts-provider to w
+0001a670: 6f72 6b20 7769 7468 2e20 4375 7272 656e  ork with. Curren
+0001a680: 746c 7920 6f6e 6c79 2060 606b 7562 6572  tly only ``kuber
+0001a690: 6e65 7465 7360 6020 6973 2073 7570 706f  netes`` is suppo
+0001a6a0: 7274 6564 2e0a 2020 2020 2020 2020 3a70  rted..        :p
+0001a6b0: 6172 616d 2073 6563 7265 7473 3a20 4120  aram secrets: A 
+0001a6c0: 6c69 7374 206f 6620 7365 6372 6574 206e  list of secret n
+0001a6d0: 616d 6573 2074 6f20 6465 6c65 7465 2e20  ames to delete. 
+0001a6e0: 416e 2065 6d70 7479 206c 6973 7420 7769  An empty list wi
+0001a6f0: 6c6c 2064 656c 6574 6520 616c 6c20 7365  ll delete all se
+0001a700: 6372 6574 7320 6173 7369 676e 6564 0a20  crets assigned. 
+0001a710: 2020 2020 2020 2020 2020 2074 6f20 7468             to th
+0001a720: 6973 2073 7065 6369 6669 6320 7072 6f6a  is specific proj
+0001a730: 6563 742e 0a20 2020 2020 2020 2022 2222  ect..        """
+0001a740: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
+0001a750: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0001a760: 6a65 6374 7d2f 7365 6372 6574 7322 0a20  ject}/secrets". 
+0001a770: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0001a780: 7b22 7072 6f76 6964 6572 223a 2070 726f  {"provider": pro
+0001a790: 7669 6465 722c 2022 7365 6372 6574 223a  vider, "secret":
+0001a7a0: 2073 6563 7265 7473 7d0a 2020 2020 2020   secrets}.      
+0001a7b0: 2020 6572 726f 725f 6d65 7373 6167 6520    error_message 
+0001a7c0: 3d20 6622 4661 696c 6564 2064 656c 6574  = f"Failed delet
+0001a7d0: 696e 6720 7365 6372 6574 7320 7b70 726f  ing secrets {pro
+0001a7e0: 6a65 6374 7d2f 7b70 726f 7669 6465 727d  ject}/{provider}
+0001a7f0: 220a 2020 2020 2020 2020 7365 6c66 2e61  ".        self.a
+0001a800: 7069 5f63 616c 6c28 0a20 2020 2020 2020  pi_call(.       
+0001a810: 2020 2020 2022 4445 4c45 5445 222c 0a20       "DELETE",. 
+0001a820: 2020 2020 2020 2020 2020 2070 6174 682c             path,
+0001a830: 0a20 2020 2020 2020 2020 2020 2065 7272  .            err
+0001a840: 6f72 5f6d 6573 7361 6765 2c0a 2020 2020  or_message,.    
+0001a850: 2020 2020 2020 2020 7061 7261 6d73 3d70          params=p
+0001a860: 6172 616d 732c 0a20 2020 2020 2020 2029  arams,.        )
+0001a870: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+0001a880: 5f75 7365 725f 7365 6372 6574 7328 0a20  _user_secrets(. 
+0001a890: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
+0001a8a0: 2020 2020 2075 7365 723a 2073 7472 2c0a       user: str,.
+0001a8b0: 2020 2020 2020 2020 7072 6f76 6964 6572          provider
+0001a8c0: 3a20 556e 696f 6e5b 0a20 2020 2020 2020  : Union[.       
+0001a8d0: 2020 2020 2073 7472 2c20 6d6c 7275 6e2e       str, mlrun.
+0001a8e0: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e53  common.schemas.S
+0001a8f0: 6563 7265 7450 726f 7669 6465 724e 616d  ecretProviderNam
+0001a900: 650a 2020 2020 2020 2020 5d20 3d20 6d6c  e.        ] = ml
+0001a910: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001a920: 6173 2e53 6563 7265 7450 726f 7669 6465  as.SecretProvide
+0001a930: 724e 616d 652e 7661 756c 742c 0a20 2020  rName.vault,.   
+0001a940: 2020 2020 2073 6563 7265 7473 3a20 6469       secrets: di
+0001a950: 6374 203d 204e 6f6e 652c 0a20 2020 2029  ct = None,.    )
+0001a960: 3a0a 2020 2020 2020 2020 2222 2243 7265  :.        """Cre
+0001a970: 6174 6520 7573 6572 2d63 6f6e 7465 7874  ate user-context
+0001a980: 2073 6563 7265 7420 696e 2056 6175 6c74   secret in Vault
+0001a990: 2e20 506c 6561 7365 2072 6566 6572 2074  . Please refer t
+0001a9a0: 6f20 3a70 793a 6675 6e63 3a60 6372 6561  o :py:func:`crea
+0001a9b0: 7465 5f70 726f 6a65 6374 5f73 6563 7265  te_project_secre
+0001a9c0: 7473 6020 666f 7220 6d6f 7265 2064 6574  ts` for more det
+0001a9d0: 6169 6c73 0a20 2020 2020 2020 2061 6e64  ails.        and
+0001a9e0: 2073 7461 7475 7320 6f66 2074 6869 7320   status of this 
+0001a9f0: 6675 6e63 7469 6f6e 616c 6974 792e 0a0a  functionality...
+0001aa00: 2020 2020 2020 2020 4e6f 7465 3a0a 2020          Note:.  
+0001aa10: 2020 2020 2020 2020 2020 2020 2020 5468                Th
+0001aa20: 6973 206d 6574 686f 6420 6973 2063 7572  is method is cur
+0001aa30: 7265 6e74 6c79 2069 6e20 7465 6368 6e69  rently in techni
+0001aa40: 6361 6c20 7072 6576 6965 772c 2061 6e64  cal preview, and
+0001aa50: 2072 6571 7569 7265 7320 6120 4861 7368   requires a Hash
+0001aa60: 6943 6f72 7020 5661 756c 7420 696e 6672  iCorp Vault infr
+0001aa70: 6173 7472 7563 7475 7265 0a20 2020 2020  astructure.     
+0001aa80: 2020 2020 2020 2020 2020 2070 726f 7065             prope
+0001aa90: 726c 7920 7365 7420 7570 2061 6e64 2063  rly set up and c
+0001aaa0: 6f6e 6e65 6374 6564 2074 6f20 7468 6520  onnected to the 
+0001aab0: 4d4c 5275 6e20 4150 4920 7365 7276 6572  MLRun API server
+0001aac0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001aad0: 6d20 7573 6572 3a20 5468 6520 7573 6572  m user: The user
+0001aae0: 2063 6f6e 7465 7874 2066 6f72 2077 6869   context for whi
+0001aaf0: 6368 2074 6f20 6765 6e65 7261 7465 2074  ch to generate t
+0001ab00: 6865 2069 6e66 7261 2061 6e64 2073 746f  he infra and sto
+0001ab10: 7265 2073 6563 7265 7473 2e0a 2020 2020  re secrets..    
+0001ab20: 2020 2020 3a70 6172 616d 2070 726f 7669      :param provi
+0001ab30: 6465 723a 2054 6865 206e 616d 6520 6f66  der: The name of
+0001ab40: 2074 6865 2073 6563 7265 7473 2d70 726f   the secrets-pro
+0001ab50: 7669 6465 7220 746f 2077 6f72 6b20 7769  vider to work wi
+0001ab60: 7468 2e20 4375 7272 656e 746c 7920 6f6e  th. Currently on
+0001ab70: 6c79 2060 6076 6175 6c74 6060 2069 7320  ly ``vault`` is 
+0001ab80: 7375 7070 6f72 7465 642e 0a20 2020 2020  supported..     
+0001ab90: 2020 203a 7061 7261 6d20 7365 6372 6574     :param secret
+0001aba0: 733a 2041 2073 6574 206f 6620 7365 6372  s: A set of secr
+0001abb0: 6574 2076 616c 7565 7320 746f 2073 746f  et values to sto
+0001abc0: 7265 2077 6974 6869 6e20 7468 6520 5661  re within the Va
+0001abd0: 756c 742e 0a20 2020 2020 2020 2022 2222  ult..        """
+0001abe0: 0a20 2020 2020 2020 2070 6174 6820 3d20  .        path = 
+0001abf0: 2275 7365 722d 7365 6372 6574 7322 0a20  "user-secrets". 
+0001ac00: 2020 2020 2020 2073 6563 7265 7473 5f63         secrets_c
+0001ac10: 7265 6174 696f 6e5f 7265 7175 6573 7420  reation_request 
+0001ac20: 3d20 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  = mlrun.common.s
+0001ac30: 6368 656d 6173 2e55 7365 7253 6563 7265  chemas.UserSecre
+0001ac40: 7443 7265 6174 696f 6e52 6571 7565 7374  tCreationRequest
+0001ac50: 280a 2020 2020 2020 2020 2020 2020 7573  (.            us
+0001ac60: 6572 3d75 7365 722c 0a20 2020 2020 2020  er=user,.       
+0001ac70: 2020 2020 2070 726f 7669 6465 723d 7072       provider=pr
+0001ac80: 6f76 6964 6572 2c0a 2020 2020 2020 2020  ovider,.        
+0001ac90: 2020 2020 7365 6372 6574 733d 7365 6372      secrets=secr
+0001aca0: 6574 732c 0a20 2020 2020 2020 2029 0a20  ets,.        ). 
+0001acb0: 2020 2020 2020 2062 6f64 7920 3d20 7365         body = se
+0001acc0: 6372 6574 735f 6372 6561 7469 6f6e 5f72  crets_creation_r
+0001acd0: 6571 7565 7374 2e64 6963 7428 290a 2020  equest.dict().  
+0001ace0: 2020 2020 2020 6572 726f 725f 6d65 7373        error_mess
+0001acf0: 6167 6520 3d20 6622 4661 696c 6564 2063  age = f"Failed c
+0001ad00: 7265 6174 696e 6720 7573 6572 2073 6563  reating user sec
+0001ad10: 7265 7473 202d 207b 7573 6572 7d22 0a20  rets - {user}". 
+0001ad20: 2020 2020 2020 2073 656c 662e 6170 695f         self.api_
+0001ad30: 6361 6c6c 280a 2020 2020 2020 2020 2020  call(.          
+0001ad40: 2020 2250 4f53 5422 2c0a 2020 2020 2020    "POST",.      
+0001ad50: 2020 2020 2020 7061 7468 2c0a 2020 2020        path,.    
+0001ad60: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
+0001ad70: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
+0001ad80: 2020 2062 6f64 793d 6469 6374 5f74 6f5f     body=dict_to_
+0001ad90: 6a73 6f6e 2862 6f64 7929 2c0a 2020 2020  json(body),.    
+0001ada0: 2020 2020 290a 0a20 2020 2040 7374 6174      )..    @stat
+0001adb0: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0001adc0: 205f 7661 6c69 6461 7465 5f76 6572 7369   _validate_versi
+0001add0: 6f6e 5f63 6f6d 7061 7469 6269 6c69 7479  on_compatibility
+0001ade0: 2873 6572 7665 725f 7665 7273 696f 6e2c  (server_version,
+0001adf0: 2063 6c69 656e 745f 7665 7273 696f 6e29   client_version)
+0001ae00: 202d 3e20 626f 6f6c 3a0a 2020 2020 2020   -> bool:.      
+0001ae10: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001ae20: 2020 2070 6172 7365 645f 7365 7276 6572     parsed_server
+0001ae30: 5f76 6572 7369 6f6e 203d 2073 656d 7665  _version = semve
+0001ae40: 722e 5665 7273 696f 6e49 6e66 6f2e 7061  r.VersionInfo.pa
+0001ae50: 7273 6528 7365 7276 6572 5f76 6572 7369  rse(server_versi
+0001ae60: 6f6e 290a 2020 2020 2020 2020 2020 2020  on).            
+0001ae70: 7061 7273 6564 5f63 6c69 656e 745f 7665  parsed_client_ve
+0001ae80: 7273 696f 6e20 3d20 7365 6d76 6572 2e56  rsion = semver.V
+0001ae90: 6572 7369 6f6e 496e 666f 2e70 6172 7365  ersionInfo.parse
+0001aea0: 2863 6c69 656e 745f 7665 7273 696f 6e29  (client_version)
+0001aeb0: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
+0001aec0: 5661 6c75 6545 7272 6f72 3a0a 2020 2020  ValueError:.    
+0001aed0: 2020 2020 2020 2020 2320 5468 6973 2077          # This w
+0001aee0: 696c 6c20 6d6f 7374 6c79 2068 6170 7065  ill mostly happe
+0001aef0: 6e20 696e 2064 6576 2073 6365 6e61 7269  n in dev scenari
+0001af00: 6f73 2077 6865 6e20 7468 6520 7665 7273  os when the vers
+0001af10: 696f 6e20 6973 2075 6e73 7461 626c 6520  ion is unstable 
+0001af20: 616e 6420 7375 6368 202d 2074 6865 7265  and such - there
+0001af30: 666f 7265 2077 6527 7265 2069 676e 6f72  fore we're ignor
+0001af40: 696e 670a 2020 2020 2020 2020 2020 2020  ing.            
+0001af50: 6c6f 6767 6572 2e77 6172 6e69 6e67 280a  logger.warning(.
+0001af60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001af70: 2255 6e61 626c 6520 746f 2070 6172 7365  "Unable to parse
+0001af80: 2073 6572 7665 7220 6f72 2063 6c69 656e   server or clien
+0001af90: 7420 7665 7273 696f 6e2e 2041 7373 756d  t version. Assum
+0001afa0: 696e 6720 636f 6d70 6174 6962 6c65 222c  ing compatible",
+0001afb0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001afc0: 2073 6572 7665 725f 7665 7273 696f 6e3d   server_version=
+0001afd0: 7365 7276 6572 5f76 6572 7369 6f6e 2c0a  server_version,.
+0001afe0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aff0: 636c 6965 6e74 5f76 6572 7369 6f6e 3d63  client_version=c
+0001b000: 6c69 656e 745f 7665 7273 696f 6e2c 0a20  lient_version,. 
+0001b010: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
+0001b020: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001b030: 5472 7565 0a20 2020 2020 2020 2069 6620  True.        if 
+0001b040: 2870 6172 7365 645f 7365 7276 6572 5f76  (parsed_server_v
+0001b050: 6572 7369 6f6e 2e6d 616a 6f72 203d 3d20  ersion.major == 
+0001b060: 3020 616e 6420 7061 7273 6564 5f73 6572  0 and parsed_ser
+0001b070: 7665 725f 7665 7273 696f 6e2e 6d69 6e6f  ver_version.mino
+0001b080: 7220 3d3d 2030 2920 6f72 2028 0a20 2020  r == 0) or (.   
+0001b090: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
+0001b0a0: 636c 6965 6e74 5f76 6572 7369 6f6e 2e6d  client_version.m
+0001b0b0: 616a 6f72 203d 3d20 3020 616e 6420 7061  ajor == 0 and pa
+0001b0c0: 7273 6564 5f63 6c69 656e 745f 7665 7273  rsed_client_vers
+0001b0d0: 696f 6e2e 6d69 6e6f 7220 3d3d 2030 0a20  ion.minor == 0. 
+0001b0e0: 2020 2020 2020 2029 3a0a 2020 2020 2020         ):.      
+0001b0f0: 2020 2020 2020 6c6f 6767 6572 2e77 6172        logger.war
+0001b100: 6e69 6e67 280a 2020 2020 2020 2020 2020  ning(.          
+0001b110: 2020 2020 2020 2253 6572 7665 7220 6f72        "Server or
+0001b120: 2063 6c69 656e 7420 7665 7273 696f 6e20   client version 
+0001b130: 6973 2075 6e73 7461 626c 652e 2041 7373  is unstable. Ass
+0001b140: 756d 696e 6720 636f 6d70 6174 6962 6c65  uming compatible
+0001b150: 222c 0a20 2020 2020 2020 2020 2020 2020  ",.             
+0001b160: 2020 2073 6572 7665 725f 7665 7273 696f     server_versio
+0001b170: 6e3d 7365 7276 6572 5f76 6572 7369 6f6e  n=server_version
+0001b180: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001b190: 2020 636c 6965 6e74 5f76 6572 7369 6f6e    client_version
+0001b1a0: 3d63 6c69 656e 745f 7665 7273 696f 6e2c  =client_version,
+0001b1b0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001b1c0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b1d0: 6e20 5472 7565 0a20 2020 2020 2020 2069  n True.        i
+0001b1e0: 6620 7061 7273 6564 5f73 6572 7665 725f  f parsed_server_
+0001b1f0: 7665 7273 696f 6e2e 6d61 6a6f 7220 213d  version.major !=
+0001b200: 2070 6172 7365 645f 636c 6965 6e74 5f76   parsed_client_v
+0001b210: 6572 7369 6f6e 2e6d 616a 6f72 3a0a 2020  ersion.major:.  
+0001b220: 2020 2020 2020 2020 2020 6c6f 6767 6572            logger
+0001b230: 2e77 6172 6e69 6e67 280a 2020 2020 2020  .warning(.      
+0001b240: 2020 2020 2020 2020 2020 2253 6572 7665            "Serve
+0001b250: 7220 616e 6420 636c 6965 6e74 2076 6572  r and client ver
+0001b260: 7369 6f6e 7320 6172 6520 696e 636f 6d70  sions are incomp
+0001b270: 6174 6962 6c65 222c 0a20 2020 2020 2020  atible",.       
+0001b280: 2020 2020 2020 2020 2070 6172 7365 645f           parsed_
+0001b290: 7365 7276 6572 5f76 6572 7369 6f6e 3d70  server_version=p
+0001b2a0: 6172 7365 645f 7365 7276 6572 5f76 6572  arsed_server_ver
+0001b2b0: 7369 6f6e 2c0a 2020 2020 2020 2020 2020  sion,.          
+0001b2c0: 2020 2020 2020 7061 7273 6564 5f63 6c69        parsed_cli
+0001b2d0: 656e 745f 7665 7273 696f 6e3d 7061 7273  ent_version=pars
+0001b2e0: 6564 5f63 6c69 656e 745f 7665 7273 696f  ed_client_versio
+0001b2f0: 6e2c 0a20 2020 2020 2020 2020 2020 2029  n,.            )
+0001b300: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0001b310: 7572 6e20 4661 6c73 650a 2020 2020 2020  urn False.      
+0001b320: 2020 6966 2070 6172 7365 645f 7365 7276    if parsed_serv
+0001b330: 6572 5f76 6572 7369 6f6e 2e6d 696e 6f72  er_version.minor
+0001b340: 203e 2070 6172 7365 645f 636c 6965 6e74   > parsed_client
+0001b350: 5f76 6572 7369 6f6e 2e6d 696e 6f72 202b  _version.minor +
+0001b360: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+0001b370: 6c6f 6767 6572 2e69 6e66 6f28 0a20 2020  logger.info(.   
+0001b380: 2020 2020 2020 2020 2020 2020 2022 4261               "Ba
+0001b390: 636b 7761 7264 7320 636f 6d70 6174 6962  ckwards compatib
+0001b3a0: 696c 6974 7920 6d69 6768 7420 6e6f 7420  ility might not 
+0001b3b0: 6170 706c 7920 6265 7477 6565 6e20 7468  apply between th
+0001b3c0: 6520 7365 7276 6572 2061 6e64 2063 6c69  e server and cli
+0001b3d0: 656e 7420 7665 7273 696f 6e22 2c0a 2020  ent version",.  
+0001b3e0: 2020 2020 2020 2020 2020 2020 2020 7061                pa
+0001b3f0: 7273 6564 5f73 6572 7665 725f 7665 7273  rsed_server_vers
+0001b400: 696f 6e3d 7061 7273 6564 5f73 6572 7665  ion=parsed_serve
+0001b410: 725f 7665 7273 696f 6e2c 0a20 2020 2020  r_version,.     
+0001b420: 2020 2020 2020 2020 2020 2070 6172 7365             parse
+0001b430: 645f 636c 6965 6e74 5f76 6572 7369 6f6e  d_client_version
+0001b440: 3d70 6172 7365 645f 636c 6965 6e74 5f76  =parsed_client_v
+0001b450: 6572 7369 6f6e 2c0a 2020 2020 2020 2020  ersion,.        
+0001b460: 2020 2020 290a 2020 2020 2020 2020 2020      ).          
+0001b470: 2020 7265 7475 726e 2046 616c 7365 0a20    return False. 
+0001b480: 2020 2020 2020 2069 6620 7061 7273 6564         if parsed
+0001b490: 5f63 6c69 656e 745f 7665 7273 696f 6e2e  _client_version.
+0001b4a0: 6d69 6e6f 7220 3e20 7061 7273 6564 5f73  minor > parsed_s
+0001b4b0: 6572 7665 725f 7665 7273 696f 6e2e 6d69  erver_version.mi
+0001b4c0: 6e6f 723a 0a20 2020 2020 2020 2020 2020  nor:.           
+0001b4d0: 206c 6f67 6765 722e 7761 726e 696e 6728   logger.warning(
+0001b4e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b4f0: 2022 436c 6965 6e74 2076 6572 7369 6f6e   "Client version
+0001b500: 2077 6974 6820 6869 6768 6572 2076 6572   with higher ver
+0001b510: 7369 6f6e 2074 6861 6e20 7365 7276 6572  sion than server
+0001b520: 2076 6572 7369 6f6e 2069 736e 2774 2073   version isn't s
+0001b530: 7570 706f 7274 6564 2c22 0a20 2020 2020  upported,".     
+0001b540: 2020 2020 2020 2020 2020 2022 2061 6c69             " ali
+0001b550: 676e 2079 6f75 7220 636c 6965 6e74 2074  gn your client t
+0001b560: 6f20 7468 6520 7365 7276 6572 2076 6572  o the server ver
+0001b570: 7369 6f6e 222c 0a20 2020 2020 2020 2020  sion",.         
+0001b580: 2020 2020 2020 2070 6172 7365 645f 7365         parsed_se
+0001b590: 7276 6572 5f76 6572 7369 6f6e 3d70 6172  rver_version=par
+0001b5a0: 7365 645f 7365 7276 6572 5f76 6572 7369  sed_server_versi
+0001b5b0: 6f6e 2c0a 2020 2020 2020 2020 2020 2020  on,.            
+0001b5c0: 2020 2020 7061 7273 6564 5f63 6c69 656e      parsed_clien
+0001b5d0: 745f 7665 7273 696f 6e3d 7061 7273 6564  t_version=parsed
+0001b5e0: 5f63 6c69 656e 745f 7665 7273 696f 6e2c  _client_version,
+0001b5f0: 0a20 2020 2020 2020 2020 2020 2029 0a20  .            ). 
+0001b600: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+0001b610: 6e20 4661 6c73 650a 2020 2020 2020 2020  n False.        
+0001b620: 6966 2070 6172 7365 645f 7365 7276 6572  if parsed_server
+0001b630: 5f76 6572 7369 6f6e 2e6d 696e 6f72 2021  _version.minor !
+0001b640: 3d20 7061 7273 6564 5f63 6c69 656e 745f  = parsed_client_
+0001b650: 7665 7273 696f 6e2e 6d69 6e6f 723a 0a20  version.minor:. 
+0001b660: 2020 2020 2020 2020 2020 206c 6f67 6765             logge
+0001b670: 722e 696e 666f 280a 2020 2020 2020 2020  r.info(.        
+0001b680: 2020 2020 2020 2020 2253 6572 7665 7220          "Server 
+0001b690: 616e 6420 636c 6965 6e74 2076 6572 7369  and client versi
+0001b6a0: 6f6e 7320 6172 6520 6e6f 7420 7468 6520  ons are not the 
+0001b6b0: 7361 6d65 2062 7574 2063 6f6d 7061 7469  same but compati
+0001b6c0: 626c 6522 2c0a 2020 2020 2020 2020 2020  ble",.          
+0001b6d0: 2020 2020 2020 7061 7273 6564 5f73 6572        parsed_ser
+0001b6e0: 7665 725f 7665 7273 696f 6e3d 7061 7273  ver_version=pars
+0001b6f0: 6564 5f73 6572 7665 725f 7665 7273 696f  ed_server_versio
+0001b700: 6e2c 0a20 2020 2020 2020 2020 2020 2020  n,.             
+0001b710: 2020 2070 6172 7365 645f 636c 6965 6e74     parsed_client
+0001b720: 5f76 6572 7369 6f6e 3d70 6172 7365 645f  _version=parsed_
+0001b730: 636c 6965 6e74 5f76 6572 7369 6f6e 2c0a  client_version,.
+0001b740: 2020 2020 2020 2020 2020 2020 290a 2020              ).  
+0001b750: 2020 2020 2020 7265 7475 726e 2054 7275        return Tru
+0001b760: 650a 0a20 2020 2064 6566 2063 7265 6174  e..    def creat
+0001b770: 655f 6d6f 6465 6c5f 656e 6470 6f69 6e74  e_model_endpoint
+0001b780: 280a 2020 2020 2020 2020 7365 6c66 2c0a  (.        self,.
+0001b790: 2020 2020 2020 2020 7072 6f6a 6563 743a          project:
+0001b7a0: 2073 7472 2c0a 2020 2020 2020 2020 656e   str,.        en
+0001b7b0: 6470 6f69 6e74 5f69 643a 2073 7472 2c0a  dpoint_id: str,.
+0001b7c0: 2020 2020 2020 2020 6d6f 6465 6c5f 656e          model_en
+0001b7d0: 6470 6f69 6e74 3a20 556e 696f 6e5b 0a20  dpoint: Union[. 
+0001b7e0: 2020 2020 2020 2020 2020 206d 6c72 756e             mlrun
+0001b7f0: 2e6d 6f64 656c 5f6d 6f6e 6974 6f72 696e  .model_monitorin
+0001b800: 672e 6d6f 6465 6c5f 656e 6470 6f69 6e74  g.model_endpoint
+0001b810: 2e4d 6f64 656c 456e 6470 6f69 6e74 2c20  .ModelEndpoint, 
+0001b820: 6469 6374 0a20 2020 2020 2020 205d 2c0a  dict.        ],.
+0001b830: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0001b840: 2222 0a20 2020 2020 2020 2043 7265 6174  "".        Creat
+0001b850: 6573 2061 2044 4220 7265 636f 7264 2077  es a DB record w
+0001b860: 6974 6820 7468 6520 6769 7665 6e20 6d6f  ith the given mo
+0001b870: 6465 6c5f 656e 6470 6f69 6e74 2072 6563  del_endpoint rec
+0001b880: 6f72 642e 0a0a 2020 2020 2020 2020 3a70  ord...        :p
+0001b890: 6172 616d 2070 726f 6a65 6374 3a20 5468  aram project: Th
+0001b8a0: 6520 6e61 6d65 206f 6620 7468 6520 7072  e name of the pr
+0001b8b0: 6f6a 6563 742e 0a20 2020 2020 2020 203a  oject..        :
+0001b8c0: 7061 7261 6d20 656e 6470 6f69 6e74 5f69  param endpoint_i
+0001b8d0: 643a 2054 6865 2069 6420 6f66 2074 6865  d: The id of the
+0001b8e0: 2065 6e64 706f 696e 742e 0a20 2020 2020   endpoint..     
+0001b8f0: 2020 203a 7061 7261 6d20 6d6f 6465 6c5f     :param model_
+0001b900: 656e 6470 6f69 6e74 3a20 416e 206f 626a  endpoint: An obj
+0001b910: 6563 7420 7265 7072 6573 656e 7469 6e67  ect representing
+0001b920: 2074 6865 206d 6f64 656c 2065 6e64 706f   the model endpo
+0001b930: 696e 742e 0a20 2020 2020 2020 2022 2222  int..        """
+0001b940: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
+0001b950: 6e73 7461 6e63 6528 0a20 2020 2020 2020  nstance(.       
+0001b960: 2020 2020 206d 6f64 656c 5f65 6e64 706f       model_endpo
+0001b970: 696e 742c 206d 6c72 756e 2e6d 6f64 656c  int, mlrun.model
+0001b980: 5f6d 6f6e 6974 6f72 696e 672e 6d6f 6465  _monitoring.mode
+0001b990: 6c5f 656e 6470 6f69 6e74 2e4d 6f64 656c  l_endpoint.Model
+0001b9a0: 456e 6470 6f69 6e74 0a20 2020 2020 2020  Endpoint.       
+0001b9b0: 2029 3a0a 2020 2020 2020 2020 2020 2020   ):.            
+0001b9c0: 6d6f 6465 6c5f 656e 6470 6f69 6e74 203d  model_endpoint =
+0001b9d0: 206d 6f64 656c 5f65 6e64 706f 696e 742e   model_endpoint.
+0001b9e0: 746f 5f64 6963 7428 290a 0a20 2020 2020  to_dict()..     
+0001b9f0: 2020 2070 6174 6820 3d20 6622 7072 6f6a     path = f"proj
+0001ba00: 6563 7473 2f7b 7072 6f6a 6563 747d 2f6d  ects/{project}/m
+0001ba10: 6f64 656c 2d65 6e64 706f 696e 7473 2f7b  odel-endpoints/{
+0001ba20: 656e 6470 6f69 6e74 5f69 647d 220a 2020  endpoint_id}".  
+0001ba30: 2020 2020 2020 7365 6c66 2e61 7069 5f63        self.api_c
+0001ba40: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
+0001ba50: 206d 6574 686f 643d 2250 4f53 5422 2c0a   method="POST",.
+0001ba60: 2020 2020 2020 2020 2020 2020 7061 7468              path
+0001ba70: 3d70 6174 682c 0a20 2020 2020 2020 2020  =path,.         
+0001ba80: 2020 2062 6f64 793d 6469 6374 5f74 6f5f     body=dict_to_
+0001ba90: 6a73 6f6e 286d 6f64 656c 5f65 6e64 706f  json(model_endpo
+0001baa0: 696e 7429 2c0a 2020 2020 2020 2020 290a  int),.        ).
+0001bab0: 0a20 2020 2064 6566 2064 656c 6574 655f  .    def delete_
+0001bac0: 6d6f 6465 6c5f 656e 6470 6f69 6e74 280a  model_endpoint(.
+0001bad0: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001bae0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
+0001baf0: 7472 2c0a 2020 2020 2020 2020 656e 6470  tr,.        endp
+0001bb00: 6f69 6e74 5f69 643a 2073 7472 2c0a 2020  oint_id: str,.  
+0001bb10: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0001bb20: 0a20 2020 2020 2020 2044 656c 6574 6573  .        Deletes
+0001bb30: 2074 6865 2044 4220 7265 636f 7264 206f   the DB record o
+0001bb40: 6620 6120 6769 7665 6e20 6d6f 6465 6c20  f a given model 
+0001bb50: 656e 6470 6f69 6e74 2c20 7072 6f6a 6563  endpoint, projec
+0001bb60: 7420 616e 6420 656e 6470 6f69 6e74 5f69  t and endpoint_i
+0001bb70: 6420 6172 6520 7573 6564 2066 6f72 206c  d are used for l
+0001bb80: 6f6f 6b75 700a 0a20 2020 2020 2020 203a  ookup..        :
+0001bb90: 7061 7261 6d20 7072 6f6a 6563 743a 2054  param project: T
+0001bba0: 6865 206e 616d 6520 6f66 2074 6865 2070  he name of the p
+0001bbb0: 726f 6a65 6374 0a20 2020 2020 2020 203a  roject.        :
+0001bbc0: 7061 7261 6d20 656e 6470 6f69 6e74 5f69  param endpoint_i
+0001bbd0: 643a 2054 6865 2069 6420 6f66 2074 6865  d: The id of the
+0001bbe0: 2065 6e64 706f 696e 740a 2020 2020 2020   endpoint.      
+0001bbf0: 2020 2222 220a 0a20 2020 2020 2020 2070    """..        p
+0001bc00: 6174 6820 3d20 6622 7072 6f6a 6563 7473  ath = f"projects
+0001bc10: 2f7b 7072 6f6a 6563 747d 2f6d 6f64 656c  /{project}/model
+0001bc20: 2d65 6e64 706f 696e 7473 2f7b 656e 6470  -endpoints/{endp
+0001bc30: 6f69 6e74 5f69 647d 220a 2020 2020 2020  oint_id}".      
+0001bc40: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
+0001bc50: 0a20 2020 2020 2020 2020 2020 206d 6574  .            met
+0001bc60: 686f 643d 2244 454c 4554 4522 2c0a 2020  hod="DELETE",.  
+0001bc70: 2020 2020 2020 2020 2020 7061 7468 3d70            path=p
+0001bc80: 6174 682c 0a20 2020 2020 2020 2029 0a0a  ath,.        )..
+0001bc90: 2020 2020 6465 6620 6c69 7374 5f6d 6f64      def list_mod
+0001bca0: 656c 5f65 6e64 706f 696e 7473 280a 2020  el_endpoints(.  
+0001bcb0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001bcc0: 2020 2020 7072 6f6a 6563 743a 2073 7472      project: str
+0001bcd0: 2c0a 2020 2020 2020 2020 6d6f 6465 6c3a  ,.        model:
+0001bce0: 204f 7074 696f 6e61 6c5b 7374 725d 203d   Optional[str] =
+0001bcf0: 204e 6f6e 652c 0a20 2020 2020 2020 2066   None,.        f
+0001bd00: 756e 6374 696f 6e3a 204f 7074 696f 6e61  unction: Optiona
+0001bd10: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+0001bd20: 2020 2020 2020 206c 6162 656c 733a 204c         labels: L
+0001bd30: 6973 745b 7374 725d 203d 204e 6f6e 652c  ist[str] = None,
+0001bd40: 0a20 2020 2020 2020 2073 7461 7274 3a20  .        start: 
+0001bd50: 7374 7220 3d20 226e 6f77 2d31 6822 2c0a  str = "now-1h",.
+0001bd60: 2020 2020 2020 2020 656e 643a 2073 7472          end: str
+0001bd70: 203d 2022 6e6f 7722 2c0a 2020 2020 2020   = "now",.      
+0001bd80: 2020 6d65 7472 6963 733a 204f 7074 696f    metrics: Optio
+0001bd90: 6e61 6c5b 4c69 7374 5b73 7472 5d5d 203d  nal[List[str]] =
+0001bda0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
+0001bdb0: 6f70 5f6c 6576 656c 3a20 626f 6f6c 203d  op_level: bool =
+0001bdc0: 2046 616c 7365 2c0a 2020 2020 2020 2020   False,.        
+0001bdd0: 7569 6473 3a20 4f70 7469 6f6e 616c 5b4c  uids: Optional[L
+0001bde0: 6973 745b 7374 725d 5d20 3d20 4e6f 6e65  ist[str]] = None
+0001bdf0: 2c0a 2020 2020 2920 2d3e 204c 6973 745b  ,.    ) -> List[
+0001be00: 6d6c 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69  mlrun.model_moni
+0001be10: 746f 7269 6e67 2e6d 6f64 656c 5f65 6e64  toring.model_end
+0001be20: 706f 696e 742e 4d6f 6465 6c45 6e64 706f  point.ModelEndpo
+0001be30: 696e 745d 3a0a 2020 2020 2020 2020 2222  int]:.        ""
+0001be40: 220a 2020 2020 2020 2020 5265 7475 726e  ".        Return
+0001be50: 7320 6120 6c69 7374 206f 6620 604d 6f64  s a list of `Mod
+0001be60: 656c 456e 6470 6f69 6e74 6020 6f62 6a65  elEndpoint` obje
+0001be70: 6374 732e 2045 6163 6820 604d 6f64 656c  cts. Each `Model
+0001be80: 456e 6470 6f69 6e74 6020 6f62 6a65 6374  Endpoint` object
+0001be90: 2072 6570 7265 7365 6e74 7320 7468 6520   represents the 
+0001bea0: 6375 7272 656e 7420 7374 6174 6520 6f66  current state of
+0001beb0: 2061 0a20 2020 2020 2020 206d 6f64 656c   a.        model
+0001bec0: 2065 6e64 706f 696e 742e 2054 6869 7320   endpoint. This 
+0001bed0: 6675 6e63 7469 6f6e 7320 7375 7070 6f72  functions suppor
+0001bee0: 7473 2066 696c 7465 7269 6e67 2062 7920  ts filtering by 
+0001bef0: 7468 6520 666f 6c6c 6f77 696e 6720 7061  the following pa
+0001bf00: 7261 6d65 7465 7273 3a0a 2020 2020 2020  rameters:.      
+0001bf10: 2020 3129 206d 6f64 656c 0a20 2020 2020    1) model.     
+0001bf20: 2020 2032 2920 6675 6e63 7469 6f6e 0a20     2) function. 
+0001bf30: 2020 2020 2020 2033 2920 6c61 6265 6c73         3) labels
+0001bf40: 0a20 2020 2020 2020 2034 2920 746f 7020  .        4) top 
+0001bf50: 6c65 7665 6c0a 2020 2020 2020 2020 3529  level.        5)
+0001bf60: 2075 6964 730a 2020 2020 2020 2020 4279   uids.        By
+0001bf70: 2064 6566 6175 6c74 2c20 7768 656e 206e   default, when n
+0001bf80: 6f20 6669 6c74 6572 7320 6172 6520 6170  o filters are ap
+0001bf90: 706c 6965 642c 2061 6c6c 2061 7661 696c  plied, all avail
+0001bfa0: 6162 6c65 2065 6e64 706f 696e 7473 2066  able endpoints f
+0001bfb0: 6f72 2074 6865 2067 6976 656e 2070 726f  or the given pro
+0001bfc0: 6a65 6374 2077 696c 6c20 6265 206c 6973  ject will be lis
+0001bfd0: 7465 642e 0a0a 2020 2020 2020 2020 496e  ted...        In
+0001bfe0: 2061 6464 6974 696f 6e2c 2074 6869 7320   addition, this 
+0001bff0: 6675 6e63 7469 6f6e 7320 7072 6f76 6964  functions provid
+0001c000: 6573 2061 2066 6163 6164 6520 666f 7220  es a facade for 
+0001c010: 6c69 7374 696e 6720 656e 6470 6f69 6e74  listing endpoint
+0001c020: 2072 656c 6174 6564 206d 6574 7269 6373   related metrics
+0001c030: 2e20 5468 6973 2066 6163 6164 6520 6973  . This facade is
+0001c040: 2074 696d 652d 6261 7365 640a 2020 2020   time-based.    
+0001c050: 2020 2020 616e 6420 6465 7065 6e64 7320      and depends 
+0001c060: 6f6e 2074 6865 2027 7374 6172 7427 2061  on the 'start' a
+0001c070: 6e64 2027 656e 6427 2070 6172 616d 6574  nd 'end' paramet
+0001c080: 6572 732e 2042 7920 6465 6661 756c 742c  ers. By default,
+0001c090: 2077 6865 6e20 7468 6520 6d65 7472 6963   when the metric
+0001c0a0: 7320 7061 7261 6d65 7465 7220 6973 204e  s parameter is N
+0001c0b0: 6f6e 652c 206e 6f20 6d65 7472 6963 7320  one, no metrics 
+0001c0c0: 6172 650a 2020 2020 2020 2020 6164 6465  are.        adde
+0001c0d0: 6420 746f 2074 6865 206f 7574 7075 7420  d to the output 
+0001c0e0: 6f66 2074 6869 7320 6675 6e63 7469 6f6e  of this function
+0001c0f0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
+0001c100: 6d20 7072 6f6a 6563 743a 2054 6865 206e  m project: The n
+0001c110: 616d 6520 6f66 2074 6865 2070 726f 6a65  ame of the proje
+0001c120: 6374 0a20 2020 2020 2020 203a 7061 7261  ct.        :para
+0001c130: 6d20 6d6f 6465 6c3a 2054 6865 206e 616d  m model: The nam
+0001c140: 6520 6f66 2074 6865 206d 6f64 656c 2074  e of the model t
+0001c150: 6f20 6669 6c74 6572 2062 790a 2020 2020  o filter by.    
+0001c160: 2020 2020 3a70 6172 616d 2066 756e 6374      :param funct
+0001c170: 696f 6e3a 2054 6865 206e 616d 6520 6f66  ion: The name of
+0001c180: 2074 6865 2066 756e 6374 696f 6e20 746f   the function to
+0001c190: 2066 696c 7465 7220 6279 0a20 2020 2020   filter by.     
+0001c1a0: 2020 203a 7061 7261 6d20 6c61 6265 6c73     :param labels
+0001c1b0: 3a20 4120 6c69 7374 206f 6620 6c61 6265  : A list of labe
+0001c1c0: 6c73 2074 6f20 6669 6c74 6572 2062 792e  ls to filter by.
+0001c1d0: 204c 6162 656c 2066 696c 7465 7273 2077   Label filters w
+0001c1e0: 6f72 6b20 6279 2065 6974 6865 7220 6669  ork by either fi
+0001c1f0: 6c74 6572 696e 6720 6120 7370 6563 6966  ltering a specif
+0001c200: 6963 2076 616c 7565 206f 6620 610a 2020  ic value of a.  
+0001c210: 2020 2020 2020 206c 6162 656c 2028 692e         label (i.
+0001c220: 652e 206c 6973 7428 226b 6579 3d76 616c  e. list("key=val
+0001c230: 7565 2229 2920 6f72 2062 7920 6c6f 6f6b  ue")) or by look
+0001c240: 696e 6720 666f 7220 7468 6520 6578 6973  ing for the exis
+0001c250: 7465 6e63 6520 6f66 2061 2067 6976 656e  tence of a given
+0001c260: 206b 6579 2028 692e 652e 2022 6b65 7922   key (i.e. "key"
+0001c270: 290a 2020 2020 2020 2020 3a70 6172 616d  ).        :param
+0001c280: 206d 6574 7269 6373 3a20 4120 6c69 7374   metrics: A list
+0001c290: 206f 6620 6d65 7472 6963 7320 746f 2072   of metrics to r
+0001c2a0: 6574 7572 6e20 666f 7220 6561 6368 2065  eturn for each e
+0001c2b0: 6e64 706f 696e 742c 2072 6561 6420 6d6f  ndpoint, read mo
+0001c2c0: 7265 2069 6e20 2754 696d 654d 6574 7269  re in 'TimeMetri
+0001c2d0: 6327 0a20 2020 2020 2020 203a 7061 7261  c'.        :para
+0001c2e0: 6d20 7374 6172 743a 2054 6865 2073 7461  m start: The sta
+0001c2f0: 7274 2074 696d 6520 6f66 2074 6865 206d  rt time of the m
+0001c300: 6574 7269 6373 2e20 4361 6e20 6265 2072  etrics. Can be r
+0001c310: 6570 7265 7365 6e74 6564 2062 7920 6120  epresented by a 
+0001c320: 7374 7269 6e67 2063 6f6e 7461 696e 696e  string containin
+0001c330: 6720 616e 2052 4643 2033 3333 390a 2020  g an RFC 3339.  
+0001c340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c350: 2020 2020 2020 2020 2020 2020 2020 2074                 t
+0001c360: 696d 652c 2061 2055 6e69 7820 7469 6d65  ime, a Unix time
+0001c370: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+0001c380: 636f 6e64 732c 2061 2072 656c 6174 6976  conds, a relativ
+0001c390: 6520 7469 6d65 2028 6027 6e6f 7727 6020  e time (`'now'` 
+0001c3a0: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+0001c3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c3c0: 2020 2020 6027 6e6f 772d 5b30 2d39 5d2b      `'now-[0-9]+
+0001c3d0: 5b6d 6864 5d27 602c 2077 6865 7265 2060  [mhd]'`, where `
+0001c3e0: 6d60 203d 206d 696e 7574 6573 2c20 6068  m` = minutes, `h
+0001c3f0: 6020 3d20 686f 7572 732c 2061 6e64 2060  ` = hours, and `
+0001c400: 2764 2760 203d 0a20 2020 2020 2020 2020  'd'` =.         
+0001c410: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c420: 2020 2020 2020 2020 6461 7973 292c 206f          days), o
+0001c430: 7220 3020 666f 7220 7468 6520 6561 726c  r 0 for the earl
+0001c440: 6965 7374 2074 696d 652e 0a20 2020 2020  iest time..     
+0001c450: 2020 203a 7061 7261 6d20 656e 643a 2054     :param end: T
+0001c460: 6865 2065 6e64 2074 696d 6520 6f66 2074  he end time of t
+0001c470: 6865 206d 6574 7269 6373 2e20 4361 6e20  he metrics. Can 
+0001c480: 6265 2072 6570 7265 7365 6e74 6564 2062  be represented b
+0001c490: 7920 6120 7374 7269 6e67 2063 6f6e 7461  y a string conta
+0001c4a0: 696e 696e 6720 616e 2052 4643 2033 3333  ining an RFC 333
+0001c4b0: 390a 2020 2020 2020 2020 2020 2020 2020  9.              
+0001c4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4d0: 2020 2074 696d 652c 2061 2055 6e69 7820     time, a Unix 
+0001c4e0: 7469 6d65 7374 616d 7020 696e 206d 696c  timestamp in mil
+0001c4f0: 6c69 7365 636f 6e64 732c 2061 2072 656c  liseconds, a rel
+0001c500: 6174 6976 6520 7469 6d65 2028 6027 6e6f  ative time (`'no
+0001c510: 7727 6020 6f72 0a20 2020 2020 2020 2020  w'` or.         
+0001c520: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c530: 2020 2020 2020 2020 6027 6e6f 772d 5b30          `'now-[0
+0001c540: 2d39 5d2b 5b6d 6864 5d27 602c 2077 6865  -9]+[mhd]'`, whe
+0001c550: 7265 2060 6d60 203d 206d 696e 7574 6573  re `m` = minutes
+0001c560: 2c20 6068 6020 3d20 686f 7572 732c 2061  , `h` = hours, a
+0001c570: 6e64 2060 2764 2760 203d 0a20 2020 2020  nd `'d'` =.     
+0001c580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c590: 2020 2020 2020 2020 2020 2020 6461 7973              days
+0001c5a0: 292c 206f 7220 3020 666f 7220 7468 6520  ), or 0 for the 
+0001c5b0: 6561 726c 6965 7374 2074 696d 652e 0a20  earliest time.. 
+0001c5c0: 2020 2020 2020 203a 7061 7261 6d20 746f         :param to
+0001c5d0: 705f 6c65 7665 6c3a 2069 6620 7472 7565  p_level: if true
+0001c5e0: 2077 696c 6c20 7265 7475 726e 206f 6e6c   will return onl
+0001c5f0: 7920 726f 7574 6572 7320 616e 6420 656e  y routers and en
+0001c600: 6470 6f69 6e74 2074 6861 7420 6172 6520  dpoint that are 
+0001c610: 4e4f 5420 6368 696c 6472 656e 206f 6620  NOT children of 
+0001c620: 616e 7920 726f 7574 6572 0a20 2020 2020  any router.     
+0001c630: 2020 203a 7061 7261 6d20 7569 6473 3a20     :param uids: 
+0001c640: 6966 2070 6173 7365 6420 7769 6c6c 2072  if passed will r
+0001c650: 6574 7572 6e20 6120 6c69 7374 2060 4d6f  eturn a list `Mo
+0001c660: 6465 6c45 6e64 706f 696e 7460 206f 626a  delEndpoint` obj
+0001c670: 6563 7420 7769 7468 2075 6964 2069 6e20  ect with uid in 
+0001c680: 7569 6473 0a20 2020 2020 2020 2022 2222  uids.        """
+0001c690: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
+0001c6a0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0001c6b0: 6a65 6374 7d2f 6d6f 6465 6c2d 656e 6470  ject}/model-endp
+0001c6c0: 6f69 6e74 7322 0a0a 2020 2020 2020 2020  oints"..        
+0001c6d0: 6966 206c 6162 656c 7320 616e 6420 6973  if labels and is
+0001c6e0: 696e 7374 616e 6365 286c 6162 656c 732c  instance(labels,
+0001c6f0: 2064 6963 7429 3a0a 2020 2020 2020 2020   dict):.        
+0001c700: 2020 2020 6c61 6265 6c73 203d 205b 6622      labels = [f"
+0001c710: 7b6b 6579 7d3d 7b76 616c 7565 7d22 2066  {key}={value}" f
+0001c720: 6f72 206b 6579 2c20 7661 6c75 6520 696e  or key, value in
+0001c730: 206c 6162 656c 732e 6974 656d 7328 295d   labels.items()]
+0001c740: 0a0a 2020 2020 2020 2020 7265 7370 6f6e  ..        respon
+0001c750: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+0001c760: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+0001c770: 6d65 7468 6f64 3d22 4745 5422 2c0a 2020  method="GET",.  
+0001c780: 2020 2020 2020 2020 2020 7061 7468 3d70            path=p
+0001c790: 6174 682c 0a20 2020 2020 2020 2020 2020  ath,.           
+0001c7a0: 2070 6172 616d 733d 7b0a 2020 2020 2020   params={.      
+0001c7b0: 2020 2020 2020 2020 2020 226d 6f64 656c            "model
+0001c7c0: 223a 206d 6f64 656c 2c0a 2020 2020 2020  ": model,.      
+0001c7d0: 2020 2020 2020 2020 2020 2266 756e 6374            "funct
+0001c7e0: 696f 6e22 3a20 6675 6e63 7469 6f6e 2c0a  ion": function,.
+0001c7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c800: 226c 6162 656c 223a 206c 6162 656c 7320  "label": labels 
+0001c810: 6f72 205b 5d2c 0a20 2020 2020 2020 2020  or [],.         
+0001c820: 2020 2020 2020 2022 7374 6172 7422 3a20         "start": 
+0001c830: 7374 6172 742c 0a20 2020 2020 2020 2020  start,.         
+0001c840: 2020 2020 2020 2022 656e 6422 3a20 656e         "end": en
+0001c850: 642c 0a20 2020 2020 2020 2020 2020 2020  d,.             
+0001c860: 2020 2022 6d65 7472 6963 223a 206d 6574     "metric": met
+0001c870: 7269 6373 206f 7220 5b5d 2c0a 2020 2020  rics or [],.    
+0001c880: 2020 2020 2020 2020 2020 2020 2274 6f70              "top
+0001c890: 2d6c 6576 656c 223a 2074 6f70 5f6c 6576  -level": top_lev
+0001c8a0: 656c 2c0a 2020 2020 2020 2020 2020 2020  el,.            
+0001c8b0: 2020 2020 2275 6964 223a 2075 6964 732c      "uid": uids,
+0001c8c0: 0a20 2020 2020 2020 2020 2020 207d 2c0a  .            },.
+0001c8d0: 2020 2020 2020 2020 290a 0a20 2020 2020          )..     
+0001c8e0: 2020 2023 2047 656e 6572 6174 6520 6120     # Generate a 
+0001c8f0: 6c69 7374 206f 6620 6120 6d6f 6465 6c20  list of a model 
+0001c900: 656e 6470 6f69 6e74 2064 6963 7469 6f6e  endpoint diction
+0001c910: 6172 6965 730a 2020 2020 2020 2020 6d6f  aries.        mo
+0001c920: 6465 6c5f 656e 6470 6f69 6e74 7320 3d20  del_endpoints = 
+0001c930: 7265 7370 6f6e 7365 2e6a 736f 6e28 295b  response.json()[
+0001c940: 2265 6e64 706f 696e 7473 225d 0a20 2020  "endpoints"].   
+0001c950: 2020 2020 2069 6620 6d6f 6465 6c5f 656e       if model_en
+0001c960: 6470 6f69 6e74 733a 0a20 2020 2020 2020  dpoints:.       
+0001c970: 2020 2020 2072 6574 7572 6e20 5b0a 2020       return [.  
+0001c980: 2020 2020 2020 2020 2020 2020 2020 6d6c                ml
+0001c990: 7275 6e2e 6d6f 6465 6c5f 6d6f 6e69 746f  run.model_monito
+0001c9a0: 7269 6e67 2e6d 6f64 656c 5f65 6e64 706f  ring.model_endpo
+0001c9b0: 696e 742e 4d6f 6465 6c45 6e64 706f 696e  int.ModelEndpoin
+0001c9c0: 742e 6672 6f6d 5f64 6963 7428 6f62 6a29  t.from_dict(obj)
+0001c9d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c9e0: 2066 6f72 206f 626a 2069 6e20 6d6f 6465   for obj in mode
+0001c9f0: 6c5f 656e 6470 6f69 6e74 730a 2020 2020  l_endpoints.    
+0001ca00: 2020 2020 2020 2020 5d0a 2020 2020 2020          ].      
+0001ca10: 2020 7265 7475 726e 205b 5d0a 0a20 2020    return []..   
+0001ca20: 2064 6566 2067 6574 5f6d 6f64 656c 5f65   def get_model_e
+0001ca30: 6e64 706f 696e 7428 0a20 2020 2020 2020  ndpoint(.       
+0001ca40: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+0001ca50: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+0001ca60: 2020 2020 2065 6e64 706f 696e 745f 6964       endpoint_id
+0001ca70: 3a20 7374 722c 0a20 2020 2020 2020 2073  : str,.        s
+0001ca80: 7461 7274 3a20 4f70 7469 6f6e 616c 5b73  tart: Optional[s
+0001ca90: 7472 5d20 3d20 4e6f 6e65 2c0a 2020 2020  tr] = None,.    
+0001caa0: 2020 2020 656e 643a 204f 7074 696f 6e61      end: Optiona
+0001cab0: 6c5b 7374 725d 203d 204e 6f6e 652c 0a20  l[str] = None,. 
+0001cac0: 2020 2020 2020 206d 6574 7269 6373 3a20         metrics: 
+0001cad0: 4f70 7469 6f6e 616c 5b4c 6973 745b 7374  Optional[List[st
+0001cae0: 725d 5d20 3d20 4e6f 6e65 2c0a 2020 2020  r]] = None,.    
+0001caf0: 2020 2020 6665 6174 7572 655f 616e 616c      feature_anal
+0001cb00: 7973 6973 3a20 626f 6f6c 203d 2046 616c  ysis: bool = Fal
+0001cb10: 7365 2c0a 2020 2020 2920 2d3e 206d 6c72  se,.    ) -> mlr
+0001cb20: 756e 2e6d 6f64 656c 5f6d 6f6e 6974 6f72  un.model_monitor
+0001cb30: 696e 672e 6d6f 6465 6c5f 656e 6470 6f69  ing.model_endpoi
+0001cb40: 6e74 2e4d 6f64 656c 456e 6470 6f69 6e74  nt.ModelEndpoint
+0001cb50: 3a0a 2020 2020 2020 2020 2222 220a 2020  :.        """.  
+0001cb60: 2020 2020 2020 5265 7475 726e 7320 6120        Returns a 
+0001cb70: 7369 6e67 6c65 2060 4d6f 6465 6c45 6e64  single `ModelEnd
+0001cb80: 706f 696e 7460 206f 626a 6563 7420 7769  point` object wi
+0001cb90: 7468 2061 6464 6974 696f 6e61 6c20 6d65  th additional me
+0001cba0: 7472 6963 7320 616e 6420 6665 6174 7572  trics and featur
+0001cbb0: 6520 7265 6c61 7465 6420 6461 7461 2e0a  e related data..
+0001cbc0: 0a20 2020 2020 2020 203a 7061 7261 6d20  .        :param 
+0001cbd0: 7072 6f6a 6563 743a 2020 2020 2020 2020  project:        
+0001cbe0: 2020 2020 2020 2020 2020 2020 5468 6520              The 
+0001cbf0: 6e61 6d65 206f 6620 7468 6520 7072 6f6a  name of the proj
+0001cc00: 6563 740a 2020 2020 2020 2020 3a70 6172  ect.        :par
+0001cc10: 616d 2065 6e64 706f 696e 745f 6964 3a20  am endpoint_id: 
+0001cc20: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0001cc30: 6865 2075 6e69 7175 6520 6964 206f 6620  he unique id of 
+0001cc40: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
+0001cc50: 6e74 2e0a 2020 2020 2020 2020 3a70 6172  nt..        :par
+0001cc60: 616d 2073 7461 7274 3a20 2020 2020 2020  am start:       
+0001cc70: 2020 2020 2020 2020 2020 2020 2020 2054                 T
+0001cc80: 6865 2073 7461 7274 2074 696d 6520 6f66  he start time of
+0001cc90: 2074 6865 206d 6574 7269 6373 2e20 4361   the metrics. Ca
+0001cca0: 6e20 6265 2072 6570 7265 7365 6e74 6564  n be represented
+0001ccb0: 2062 7920 6120 7374 7269 6e67 2063 6f6e   by a string con
+0001ccc0: 7461 696e 696e 6720 616e 0a20 2020 2020  taining an.     
+0001ccd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ccf0: 2020 2020 2020 5246 4320 3333 3339 2074        RFC 3339 t
+0001cd00: 696d 652c 2061 2055 6e69 7820 7469 6d65  ime, a Unix time
+0001cd10: 7374 616d 7020 696e 206d 696c 6c69 7365  stamp in millise
+0001cd20: 636f 6e64 732c 2061 2072 656c 6174 6976  conds, a relativ
+0001cd30: 6520 7469 6d65 2028 6027 6e6f 7727 6020  e time (`'now'` 
+0001cd40: 6f72 0a20 2020 2020 2020 2020 2020 2020  or.             
+0001cd50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cd60: 2020 2020 2020 2020 2020 2020 2020 6027                `'
+0001cd70: 6e6f 772d 5b30 2d39 5d2b 5b6d 6864 5d27  now-[0-9]+[mhd]'
+0001cd80: 602c 2077 6865 7265 2060 6d60 203d 206d  `, where `m` = m
+0001cd90: 696e 7574 6573 2c20 6068 6020 3d20 686f  inutes, `h` = ho
+0001cda0: 7572 732c 2061 6e64 2060 2764 2760 203d  urs, and `'d'` =
+0001cdb0: 2064 6179 7329 2c20 6f72 0a20 2020 2020   days), or.     
+0001cdc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cdd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cde0: 2020 2020 2020 3020 666f 7220 7468 6520        0 for the 
+0001cdf0: 6561 726c 6965 7374 2074 696d 652e 0a20  earliest time.. 
+0001ce00: 2020 2020 2020 203a 7061 7261 6d20 656e         :param en
+0001ce10: 643a 2020 2020 2020 2020 2020 2020 2020  d:              
+0001ce20: 2020 2020 2020 2020 2020 5468 6520 656e            The en
+0001ce30: 6420 7469 6d65 206f 6620 7468 6520 6d65  d time of the me
+0001ce40: 7472 6963 732e 2043 616e 2062 6520 7265  trics. Can be re
+0001ce50: 7072 6573 656e 7465 6420 6279 2061 2073  presented by a s
+0001ce60: 7472 696e 6720 636f 6e74 6169 6e69 6e67  tring containing
+0001ce70: 2061 6e0a 2020 2020 2020 2020 2020 2020   an.            
+0001ce80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ce90: 2020 2020 2020 2020 2020 2020 2020 2052                 R
+0001cea0: 4643 2033 3333 3920 7469 6d65 2c20 6120  FC 3339 time, a 
+0001ceb0: 556e 6978 2074 696d 6573 7461 6d70 2069  Unix timestamp i
+0001cec0: 6e20 6d69 6c6c 6973 6563 6f6e 6473 2c20  n milliseconds, 
+0001ced0: 6120 7265 6c61 7469 7665 2074 696d 6520  a relative time 
+0001cee0: 2860 276e 6f77 2760 206f 720a 2020 2020  (`'now'` or.    
+0001cef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf10: 2020 2020 2020 2060 276e 6f77 2d5b 302d         `'now-[0-
+0001cf20: 395d 2b5b 6d68 645d 2760 2c20 7768 6572  9]+[mhd]'`, wher
+0001cf30: 6520 606d 6020 3d20 6d69 6e75 7465 732c  e `m` = minutes,
+0001cf40: 2060 6860 203d 2068 6f75 7273 2c20 616e   `h` = hours, an
+0001cf50: 6420 6027 6427 6020 3d20 6461 7973 292c  d `'d'` = days),
+0001cf60: 206f 720a 2020 2020 2020 2020 2020 2020   or.            
+0001cf70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cf80: 2020 2020 2020 2020 2020 2020 2020 2030                 0
+0001cf90: 2066 6f72 2074 6865 2065 6172 6c69 6573   for the earlies
+0001cfa0: 7420 7469 6d65 2e0a 2020 2020 2020 2020  t time..        
+0001cfb0: 3a70 6172 616d 206d 6574 7269 6373 3a20  :param metrics: 
+0001cfc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001cfd0: 2020 2041 206c 6973 7420 6f66 206d 6574     A list of met
+0001cfe0: 7269 6373 2074 6f20 7265 7475 726e 2066  rics to return f
+0001cff0: 6f72 2074 6865 206d 6f64 656c 2065 6e64  or the model end
+0001d000: 706f 696e 742e 2054 6865 7265 2061 7265  point. There are
+0001d010: 2070 7265 2d64 6566 696e 6564 0a20 2020   pre-defined.   
+0001d020: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d040: 2020 2020 2020 2020 6d65 7472 6963 7320          metrics 
+0001d050: 666f 7220 6d6f 6465 6c20 656e 6470 6f69  for model endpoi
+0001d060: 6e74 7320 7375 6368 2061 7320 7072 6564  nts such as pred
+0001d070: 6963 7469 6f6e 735f 7065 725f 7365 636f  ictions_per_seco
+0001d080: 6e64 2061 6e64 0a20 2020 2020 2020 2020  nd and.         
+0001d090: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d0b0: 2020 6c61 7465 6e63 795f 6176 675f 356d    latency_avg_5m
+0001d0c0: 2062 7574 2061 6c73 6f20 6375 7374 6f6d   but also custom
+0001d0d0: 206d 6574 7269 6373 2064 6566 696e 6564   metrics defined
+0001d0e0: 2062 7920 7468 6520 7573 6572 2e20 506c   by the user. Pl
+0001d0f0: 6561 7365 206e 6f74 6520 7468 6174 0a20  ease note that. 
+0001d100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d120: 2020 2020 2020 2020 2020 7468 6573 6520            these 
+0001d130: 6d65 7472 6963 7320 6172 6520 7374 6f72  metrics are stor
+0001d140: 6564 2069 6e20 7468 6520 7469 6d65 2073  ed in the time s
+0001d150: 6572 6965 7320 4442 2061 6e64 2074 6865  eries DB and the
+0001d160: 2072 6573 756c 7473 2077 696c 6c20 6265   results will be
+0001d170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d190: 2020 2020 2020 2020 2020 2020 6170 7065              appe
+0001d1a0: 6172 6564 2075 6e64 6572 206d 6f64 656c  ared under model
+0001d1b0: 5f65 6e64 706f 696e 742e 7370 6563 2e6d  _endpoint.spec.m
+0001d1c0: 6574 7269 6373 2e0a 2020 2020 2020 2020  etrics..        
+0001d1d0: 3a70 6172 616d 2066 6561 7475 7265 5f61  :param feature_a
+0001d1e0: 6e61 6c79 7369 733a 2020 2020 2020 2020  nalysis:        
+0001d1f0: 2020 2057 6865 6e20 5472 7565 2c20 7468     When True, th
+0001d200: 6520 6261 7365 2066 6561 7475 7265 2073  e base feature s
+0001d210: 7461 7469 7374 6963 7320 616e 6420 6375  tatistics and cu
+0001d220: 7272 656e 7420 6665 6174 7572 6520 7374  rrent feature st
+0001d230: 6174 6973 7469 6373 2077 696c 6c0a 2020  atistics will.  
 0001d240: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d250: 2020 2020 2020 2020 2020 4d6f 7265 2064            More d
-0001d260: 6574 6169 6c73 2061 626f 7574 2074 6865  etails about the
-0001d270: 206d 6f64 656c 2065 6e64 706f 696e 7420   model endpoint 
-0001d280: 6176 6169 6c61 626c 6520 6174 7472 6962  available attrib
-0001d290: 7574 6573 2063 616e 2062 6520 666f 756e  utes can be foun
-0001d2a0: 6420 756e 6465 720a 2020 2020 2020 2020  d under.        
-0001d2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d2c0: 2020 203a 7079 3a63 6c61 7373 3a60 7e6d     :py:class:`~m
-0001d2d0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001d2e0: 6d61 732e 4d6f 6465 6c45 6e64 706f 696e  mas.ModelEndpoin
-0001d2f0: 7460 2e0a 0a20 2020 2020 2020 2020 2020  t`...           
-0001d300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d310: 4578 616d 706c 653a 3a0a 0a20 2020 2020  Example::..     
-0001d320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d330: 2020 2020 2020 2020 2020 2023 2047 656e             # Gen
-0001d340: 6572 6174 6520 6375 7272 656e 7420 7374  erate current st
-0001d350: 6174 7320 666f 7220 7477 6f20 6665 6174  ats for two feat
-0001d360: 7572 6573 0a20 2020 2020 2020 2020 2020  ures.           
-0001d370: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d380: 2020 2020 2063 7572 7265 6e74 5f73 7461       current_sta
-0001d390: 7473 203d 207b 2774 7664 5f73 756d 273a  ts = {'tvd_sum':
-0001d3a0: 2032 2e32 2c0a 2020 2020 2020 2020 2020   2.2,.          
-0001d3b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d3d0: 2020 2020 2020 2027 7476 645f 6d65 616e         'tvd_mean
-0001d3e0: 273a 2030 2e35 2c0a 2020 2020 2020 2020  ': 0.5,.        
-0001d3f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d410: 2020 2020 2020 2020 2027 6865 6c6c 696e           'hellin
-0001d420: 6765 725f 7375 6d27 3a20 332e 362c 0a20  ger_sum': 3.6,. 
-0001d430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d460: 2768 656c 6c69 6e67 6572 5f6d 6561 6e27  'hellinger_mean'
-0001d470: 3a20 302e 392c 0a20 2020 2020 2020 2020  : 0.9,.         
-0001d480: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d490: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4a0: 2020 2020 2020 2020 276b 6c64 5f73 756d          'kld_sum
-0001d4b0: 273a 2032 342e 322c 0a20 2020 2020 2020  ': 24.2,.       
-0001d4c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d4e0: 2020 2020 2020 2020 2020 276b 6c64 5f6d            'kld_m
-0001d4f0: 6561 6e27 3a20 362e 302c 0a20 2020 2020  ean': 6.0,.     
-0001d500: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d510: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d520: 2020 2020 2020 2020 2020 2020 2766 3127              'f1'
-0001d530: 3a20 7b27 7476 6427 3a20 302e 352c 2027  : {'tvd': 0.5, '
-0001d540: 6865 6c6c 696e 6765 7227 3a20 312e 302c  hellinger': 1.0,
-0001d550: 2027 6b6c 6427 3a20 362e 347d 2c0a 2020   'kld': 6.4},.  
-0001d560: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d580: 2020 2020 2020 2020 2020 2020 2020 2027                 '
-0001d590: 6632 273a 207b 2774 7664 273a 2030 2e35  f2': {'tvd': 0.5
-0001d5a0: 2c20 2768 656c 6c69 6e67 6572 273a 2031  , 'hellinger': 1
-0001d5b0: 2e30 2c20 276b 6c64 273a 2036 2e35 7d7d  .0, 'kld': 6.5}}
-0001d5c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0001d5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d5e0: 2020 2320 4372 6561 7465 2061 7474 7269    # Create attri
-0001d5f0: 6275 7465 7320 6469 6374 696f 6e61 7279  butes dictionary
-0001d600: 2061 6363 6f72 6469 6e67 2074 6f20 7468   according to th
-0001d610: 6520 7265 7175 6972 6564 2066 6f72 6d61  e required forma
-0001d620: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001d630: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d640: 2020 6174 7472 6962 7574 6573 203d 207b    attributes = {
-0001d650: 6063 7572 7265 6e74 5f73 7461 7473 603a  `current_stats`:
-0001d660: 206a 736f 6e2e 6475 6d70 7328 6375 7272   json.dumps(curr
-0001d670: 656e 745f 7374 6174 7329 2c0a 2020 2020  ent_stats),.    
-0001d680: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d690: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001d6a0: 2020 2020 2020 2020 2020 6064 7269 6674            `drift
-0001d6b0: 5f73 7461 7475 7360 3a20 2244 5249 4654  _status`: "DRIFT
-0001d6c0: 5f44 4554 4543 5445 4422 7d0a 0a20 2020  _DETECTED"}..   
-0001d6d0: 2020 2020 2022 2222 0a0a 2020 2020 2020       """..      
-0001d6e0: 2020 6174 7472 6962 7574 6573 203d 207b    attributes = {
-0001d6f0: 2261 7474 7269 6275 7465 7322 3a20 5f61  "attributes": _a
-0001d700: 735f 6a73 6f6e 2861 7474 7269 6275 7465  s_json(attribute
-0001d710: 7329 7d0a 2020 2020 2020 2020 7061 7468  s)}.        path
-0001d720: 203d 2066 2270 726f 6a65 6374 732f 7b70   = f"projects/{p
-0001d730: 726f 6a65 6374 7d2f 6d6f 6465 6c2d 656e  roject}/model-en
-0001d740: 6470 6f69 6e74 732f 7b65 6e64 706f 696e  dpoints/{endpoin
-0001d750: 745f 6964 7d22 0a20 2020 2020 2020 2073  t_id}".        s
-0001d760: 656c 662e 6170 695f 6361 6c6c 280a 2020  elf.api_call(.  
-0001d770: 2020 2020 2020 2020 2020 6d65 7468 6f64            method
-0001d780: 3d22 5041 5443 4822 2c0a 2020 2020 2020  ="PATCH",.      
-0001d790: 2020 2020 2020 7061 7468 3d70 6174 682c        path=path,
-0001d7a0: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-0001d7b0: 616d 733d 6174 7472 6962 7574 6573 2c0a  ams=attributes,.
-0001d7c0: 2020 2020 2020 2020 290a 0a20 2020 2064          )..    d
-0001d7d0: 6566 2063 7265 6174 655f 6875 625f 736f  ef create_hub_so
-0001d7e0: 7572 6365 280a 2020 2020 2020 2020 7365  urce(.        se
-0001d7f0: 6c66 2c20 736f 7572 6365 3a20 556e 696f  lf, source: Unio
-0001d800: 6e5b 6469 6374 2c20 6d6c 7275 6e2e 636f  n[dict, mlrun.co
-0001d810: 6d6d 6f6e 2e73 6368 656d 6173 2e49 6e64  mmon.schemas.Ind
-0001d820: 6578 6564 4875 6253 6f75 7263 655d 0a20  exedHubSource]. 
-0001d830: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
-0001d840: 220a 2020 2020 2020 2020 4164 6420 6120  ".        Add a 
-0001d850: 6e65 7720 6875 6220 736f 7572 6365 2e0a  new hub source..
-0001d860: 0a20 2020 2020 2020 204d 4c52 756e 206d  .        MLRun m
-0001d870: 6169 6e74 6169 6e73 2061 6e20 6f72 6465  aintains an orde
-0001d880: 7265 6420 6c69 7374 206f 6620 6875 6220  red list of hub 
-0001d890: 736f 7572 6365 7320 28e2 809c 736f 7572  sources (...sour
-0001d8a0: 6365 73e2 809d 2920 4561 6368 2073 6f75  ces...) Each sou
-0001d8b0: 7263 6520 6861 730a 2020 2020 2020 2020  rce has.        
-0001d8c0: 6974 7320 6465 7461 696c 7320 7265 6769  its details regi
-0001d8d0: 7374 6572 6564 2061 6e64 2069 7473 206f  stered and its o
-0001d8e0: 7264 6572 2077 6974 6869 6e20 7468 6520  rder within the 
-0001d8f0: 6c69 7374 2e20 5768 656e 2063 7265 6174  list. When creat
-0001d900: 696e 6720 6120 6e65 7720 736f 7572 6365  ing a new source
-0001d910: 2c20 7468 6520 7370 6563 6961 6c20 6f72  , the special or
-0001d920: 6465 7220 6060 2d31 6060 0a20 2020 2020  der ``-1``.     
-0001d930: 2020 2063 616e 2062 6520 7573 6564 2074     can be used t
-0001d940: 6f20 6d61 726b 2074 6869 7320 736f 7572  o mark this sour
-0001d950: 6365 2061 7320 6c61 7374 2069 6e20 7468  ce as last in th
-0001d960: 6520 6c69 7374 2e20 486f 7765 7665 722c  e list. However,
-0001d970: 206f 6e63 6520 7468 6520 736f 7572 6365   once the source
-0001d980: 2069 7320 696e 2074 6865 204d 4c52 756e   is in the MLRun
-0001d990: 206c 6973 742c 0a20 2020 2020 2020 2069   list,.        i
-0001d9a0: 7473 206f 7264 6572 2077 696c 6c20 616c  ts order will al
-0001d9b0: 7761 7973 2062 6520 6060 3e30 6060 2e0a  ways be ``>0``..
-0001d9c0: 0a20 2020 2020 2020 2054 6865 2067 6c6f  .        The glo
-0001d9d0: 6261 6c20 6875 6220 736f 7572 6365 2061  bal hub source a
-0001d9e0: 6c77 6179 7320 6578 6973 7473 2069 6e20  lways exists in 
-0001d9f0: 7468 6520 6c69 7374 2c20 616e 6420 6973  the list, and is
-0001da00: 2061 6c77 6179 7320 7468 6520 6c61 7374   always the last
-0001da10: 2073 6f75 7263 650a 2020 2020 2020 2020   source.        
-0001da20: 2860 606f 7264 6572 203d 202d 3160 6029  (``order = -1``)
-0001da30: 2e20 4974 2063 616e 6e6f 7420 6265 206d  . It cannot be m
-0001da40: 6f64 6966 6965 6420 6e6f 7220 6361 6e20  odified nor can 
-0001da50: 6974 2062 6520 6d6f 7665 6420 746f 2061  it be moved to a
-0001da60: 6e6f 7468 6572 206f 7264 6572 2069 6e20  nother order in 
-0001da70: 7468 6520 6c69 7374 2e0a 0a20 2020 2020  the list...     
-0001da80: 2020 2054 6865 2073 6f75 7263 6520 6f62     The source ob
-0001da90: 6a65 6374 206d 6179 2063 6f6e 7461 696e  ject may contain
-0001daa0: 2063 7265 6465 6e74 6961 6c73 2077 6869   credentials whi
-0001dab0: 6368 2061 7265 206e 6565 6465 6420 746f  ch are needed to
-0001dac0: 2061 6363 6573 7320 7468 6520 6461 7461   access the data
-0001dad0: 7374 6f72 6520 7768 6572 6520 7468 6520  store where the 
-0001dae0: 736f 7572 6365 2069 7320 7374 6f72 6564  source is stored
-0001daf0: 2e0a 2020 2020 2020 2020 5468 6573 6520  ..        These 
-0001db00: 6372 6564 656e 7469 616c 7320 6172 6520  credentials are 
-0001db10: 6e6f 7420 6b65 7074 2069 6e20 7468 6520  not kept in the 
-0001db20: 4d4c 5275 6e20 4442 2c20 6275 7420 6172  MLRun DB, but ar
-0001db30: 6520 7374 6f72 6564 2069 6e73 6964 6520  e stored inside 
-0001db40: 6120 6b75 6265 726e 6574 6573 2073 6563  a kubernetes sec
-0001db50: 7265 7420 6f62 6a65 6374 206d 6169 6e74  ret object maint
-0001db60: 6169 6e65 6420 6279 0a20 2020 2020 2020  ained by.       
-0001db70: 204d 4c52 756e 2e20 5468 6579 2061 7265   MLRun. They are
-0001db80: 206e 6f74 2072 6574 7572 6e65 6420 7468   not returned th
-0001db90: 726f 7567 6820 616e 7920 4150 4920 6672  rough any API fr
-0001dba0: 6f6d 204d 4c52 756e 2e0a 0a20 2020 2020  om MLRun...     
-0001dbb0: 2020 2045 7861 6d70 6c65 3a3a 0a0a 2020     Example::..  
-0001dbc0: 2020 2020 2020 2020 2020 696d 706f 7274            import
-0001dbd0: 206d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363   mlrun.common.sc
-0001dbe0: 6865 6d61 730a 0a20 2020 2020 2020 2020  hemas..         
-0001dbf0: 2020 2023 2041 6464 2061 2070 7269 7661     # Add a priva
-0001dc00: 7465 2073 6f75 7263 6520 6173 2074 6865  te source as the
-0001dc10: 206c 6173 7420 6f6e 6520 2877 696c 6c20   last one (will 
-0001dc20: 6265 2023 3120 696e 2074 6865 206c 6973  be #1 in the lis
-0001dc30: 7429 0a20 2020 2020 2020 2020 2020 2070  t).            p
-0001dc40: 7269 7661 7465 5f73 6f75 7263 6520 3d20  rivate_source = 
-0001dc50: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0001dc60: 656d 6173 2e49 6e64 6578 6564 4875 6265  emas.IndexedHube
-0001dc70: 536f 7572 6365 280a 2020 2020 2020 2020  Source(.        
-0001dc80: 2020 2020 2020 2020 6f72 6465 723d 2d31          order=-1
-0001dc90: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-0001dca0: 2020 736f 7572 6365 3d6d 6c72 756e 2e63    source=mlrun.c
-0001dcb0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4875  ommon.schemas.Hu
-0001dcc0: 6253 6f75 7263 6528 0a20 2020 2020 2020  bSource(.       
-0001dcd0: 2020 2020 2020 2020 2020 2020 206d 6574               met
-0001dce0: 6164 6174 613d 6d6c 7275 6e2e 636f 6d6d  adata=mlrun.comm
-0001dcf0: 6f6e 2e73 6368 656d 6173 2e48 7562 4f62  on.schemas.HubOb
-0001dd00: 6a65 6374 4d65 7461 6461 7461 280a 2020  jectMetadata(.  
-0001dd10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dd20: 2020 2020 2020 6e61 6d65 3d22 7072 6976        name="priv
-0001dd30: 222c 2064 6573 6372 6970 7469 6f6e 3d22  ", description="
-0001dd40: 6120 7072 6976 6174 6520 736f 7572 6365  a private source
-0001dd50: 220a 2020 2020 2020 2020 2020 2020 2020  ".              
-0001dd60: 2020 2020 2020 292c 0a20 2020 2020 2020        ),.       
-0001dd70: 2020 2020 2020 2020 2020 2020 2073 7065               spe
-0001dd80: 633d 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  c=mlrun.common.s
-0001dd90: 6368 656d 6173 2e48 7562 536f 7572 6365  chemas.HubSource
-0001dda0: 5370 6563 2870 6174 683d 222f 6c6f 6361  Spec(path="/loca
-0001ddb0: 6c2f 7061 7468 2f74 6f2f 736f 7572 6365  l/path/to/source
-0001ddc0: 222c 2063 6861 6e6e 656c 3d22 6465 7665  ", channel="deve
-0001ddd0: 6c6f 706d 656e 7422 290a 2020 2020 2020  lopment").      
-0001dde0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001ddf0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001de00: 2020 2020 2020 6462 2e63 7265 6174 655f        db.create_
-0001de10: 6875 625f 736f 7572 6365 2870 7269 7661  hub_source(priva
-0001de20: 7465 5f73 6f75 7263 6529 0a0a 2020 2020  te_source)..    
-0001de30: 2020 2020 2020 2020 2320 4164 6420 616e          # Add an
-0001de40: 6f74 6865 7220 736f 7572 6365 2061 7320  other source as 
-0001de50: 3173 7420 696e 2074 6865 206c 6973 7420  1st in the list 
-0001de60: 2d20 7769 6c6c 2070 7573 6820 7072 6576  - will push prev
-0001de70: 696f 7573 206f 6e65 2074 6f20 6265 2023  ious one to be #
-0001de80: 320a 2020 2020 2020 2020 2020 2020 616e  2.            an
-0001de90: 6f74 6865 725f 736f 7572 6365 203d 206d  other_source = m
-0001dea0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001deb0: 6d61 732e 496e 6465 7865 6448 7562 536f  mas.IndexedHubSo
-0001dec0: 7572 6365 280a 2020 2020 2020 2020 2020  urce(.          
-0001ded0: 2020 2020 2020 6f72 6465 723d 312c 0a20        order=1,. 
-0001dee0: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0001def0: 6f75 7263 653d 6d6c 7275 6e2e 636f 6d6d  ource=mlrun.comm
-0001df00: 6f6e 2e73 6368 656d 6173 2e48 7562 536f  on.schemas.HubSo
-0001df10: 7572 6365 280a 2020 2020 2020 2020 2020  urce(.          
-0001df20: 2020 2020 2020 2020 2020 6d65 7461 6461            metada
-0001df30: 7461 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e  ta=mlrun.common.
-0001df40: 7363 6865 6d61 732e 4875 624f 626a 6563  schemas.HubObjec
-0001df50: 744d 6574 6164 6174 6128 0a20 2020 2020  tMetadata(.     
-0001df60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001df70: 2020 206e 616d 653d 2270 7269 762d 3222     name="priv-2"
-0001df80: 2c20 6465 7363 7269 7074 696f 6e3d 2261  , description="a
-0001df90: 6e6f 7468 6572 2073 6f75 7263 6522 0a20  nother source". 
-0001dfa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001dfb0: 2020 2029 2c0a 2020 2020 2020 2020 2020     ),.          
-0001dfc0: 2020 2020 2020 2020 2020 7370 6563 3d6d            spec=m
-0001dfd0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001dfe0: 6d61 732e 4875 6253 6f75 7263 6553 7065  mas.HubSourceSpe
-0001dff0: 6328 0a20 2020 2020 2020 2020 2020 2020  c(.             
-0001e000: 2020 2020 2020 2020 2020 2070 6174 683d             path=
-0001e010: 222f 6c6f 6361 6c2f 7061 7468 2f74 6f2f  "/local/path/to/
-0001e020: 736f 7572 6365 2f32 222c 0a20 2020 2020  source/2",.     
-0001e030: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e040: 2020 2063 6861 6e6e 656c 3d22 6465 7665     channel="deve
-0001e050: 6c6f 706d 656e 7422 2c0a 2020 2020 2020  lopment",.      
-0001e060: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001e070: 2020 6372 6564 656e 7469 616c 733d 7b2e    credentials={.
-0001e080: 2e2e 7d0a 2020 2020 2020 2020 2020 2020  ..}.            
-0001e090: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001e0a0: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
-0001e0b0: 2020 2020 2020 2020 290a 2020 2020 2020          ).      
-0001e0c0: 2020 2020 2020 6462 2e63 7265 6174 655f        db.create_
-0001e0d0: 6875 625f 736f 7572 6365 2861 6e6f 7468  hub_source(anoth
-0001e0e0: 6572 5f73 6f75 7263 6529 0a0a 2020 2020  er_source)..    
-0001e0f0: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
-0001e100: 653a 2054 6865 2073 6f75 7263 6520 616e  e: The source an
-0001e110: 6420 6974 7320 6f72 6465 722c 206f 6620  d its order, of 
-0001e120: 7479 7065 0a20 2020 2020 2020 2020 2020  type.           
-0001e130: 203a 7079 3a63 6c61 7373 3a60 7e6d 6c72   :py:class:`~mlr
-0001e140: 756e 2e63 6f6d 6d6f 6e2e 7363 6865 6d61  un.common.schema
-0001e150: 732e 6875 622e 496e 6465 7865 6448 7562  s.hub.IndexedHub
-0001e160: 536f 7572 6365 602c 206f 7220 696e 2064  Source`, or in d
-0001e170: 6963 7469 6f6e 6172 7920 666f 726d 2e0a  ictionary form..
-0001e180: 2020 2020 2020 2020 3a72 6574 7572 6e73          :returns
-0001e190: 3a20 5468 6520 736f 7572 6365 206f 626a  : The source obj
-0001e1a0: 6563 7420 6173 2069 6e73 6572 7465 6420  ect as inserted 
-0001e1b0: 696e 746f 2074 6865 2064 6174 6162 6173  into the databas
-0001e1c0: 652c 2077 6974 6820 6372 6564 656e 7469  e, with credenti
-0001e1d0: 616c 7320 7374 7269 7070 6564 2e0a 2020  als stripped..  
-0001e1e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e1f0: 2020 7061 7468 203d 2022 6875 622f 736f    path = "hub/so
-0001e200: 7572 6365 7322 0a20 2020 2020 2020 2069  urces".        i
-0001e210: 6620 6973 696e 7374 616e 6365 2873 6f75  f isinstance(sou
-0001e220: 7263 652c 206d 6c72 756e 2e63 6f6d 6d6f  rce, mlrun.commo
-0001e230: 6e2e 7363 6865 6d61 732e 496e 6465 7865  n.schemas.Indexe
-0001e240: 6448 7562 536f 7572 6365 293a 0a20 2020  dHubSource):.   
-0001e250: 2020 2020 2020 2020 2073 6f75 7263 6520           source 
-0001e260: 3d20 736f 7572 6365 2e64 6963 7428 290a  = source.dict().
-0001e270: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
-0001e280: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
-0001e290: 286d 6574 686f 643d 2250 4f53 5422 2c20  (method="POST", 
-0001e2a0: 7061 7468 3d70 6174 682c 206a 736f 6e3d  path=path, json=
-0001e2b0: 736f 7572 6365 290a 2020 2020 2020 2020  source).        
-0001e2c0: 7265 7475 726e 206d 6c72 756e 2e63 6f6d  return mlrun.com
-0001e2d0: 6d6f 6e2e 7363 6865 6d61 732e 496e 6465  mon.schemas.Inde
-0001e2e0: 7865 6448 7562 536f 7572 6365 282a 2a72  xedHubSource(**r
-0001e2f0: 6573 706f 6e73 652e 6a73 6f6e 2829 290a  esponse.json()).
-0001e300: 0a20 2020 2064 6566 2073 746f 7265 5f68  .    def store_h
-0001e310: 7562 5f73 6f75 7263 6528 0a20 2020 2020  ub_source(.     
-0001e320: 2020 2073 656c 662c 0a20 2020 2020 2020     self,.       
-0001e330: 2073 6f75 7263 655f 6e61 6d65 3a20 7374   source_name: st
-0001e340: 722c 0a20 2020 2020 2020 2073 6f75 7263  r,.        sourc
-0001e350: 653a 2055 6e69 6f6e 5b64 6963 742c 206d  e: Union[dict, m
-0001e360: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001e370: 6d61 732e 496e 6465 7865 6448 7562 536f  mas.IndexedHubSo
-0001e380: 7572 6365 5d2c 0a20 2020 2029 3a0a 2020  urce],.    ):.  
-0001e390: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001e3a0: 2020 4372 6561 7465 206f 7220 7265 706c    Create or repl
-0001e3b0: 6163 6520 6120 6875 6220 736f 7572 6365  ace a hub source
-0001e3c0: 2e0a 2020 2020 2020 2020 466f 7220 616e  ..        For an
-0001e3d0: 2065 7861 6d70 6c65 206f 6620 7468 6520   example of the 
-0001e3e0: 736f 7572 6365 2066 6f72 6d61 7420 616e  source format an
-0001e3f0: 6420 6578 706c 616e 6174 696f 6e20 6f66  d explanation of
-0001e400: 2074 6865 2073 6f75 7263 6520 6f72 6465   the source orde
-0001e410: 7220 6c6f 6769 632c 0a20 2020 2020 2020  r logic,.       
-0001e420: 2070 6c65 6173 6520 7365 6520 3a70 793a   please see :py:
-0001e430: 6675 6e63 3a60 7e63 7265 6174 655f 6875  func:`~create_hu
-0001e440: 625f 736f 7572 6365 602e 2054 6869 7320  b_source`. This 
-0001e450: 6d65 7468 6f64 2063 616e 2062 6520 7573  method can be us
-0001e460: 6564 2074 6f20 6d6f 6469 6679 2074 6865  ed to modify the
-0001e470: 2073 6f75 7263 6520 6974 7365 6c66 206f   source itself o
-0001e480: 7220 6974 730a 2020 2020 2020 2020 6f72  r its.        or
-0001e490: 6465 7220 696e 2074 6865 206c 6973 7420  der in the list 
-0001e4a0: 6f66 2073 6f75 7263 6573 2e0a 0a20 2020  of sources...   
-0001e4b0: 2020 2020 203a 7061 7261 6d20 736f 7572       :param sour
-0001e4c0: 6365 5f6e 616d 653a 204e 616d 6520 6f66  ce_name: Name of
-0001e4d0: 2074 6865 2073 6f75 7263 6520 6f62 6a65   the source obje
-0001e4e0: 6374 2074 6f20 6d6f 6469 6679 2f63 7265  ct to modify/cre
-0001e4f0: 6174 652e 2049 7420 6d75 7374 206d 6174  ate. It must mat
-0001e500: 6368 2074 6865 2060 6073 6f75 7263 652e  ch the ``source.
-0001e510: 6d65 7461 6461 7461 2e6e 616d 6560 600a  metadata.name``.
-0001e520: 2020 2020 2020 2020 2020 2020 7061 7261              para
-0001e530: 6d65 7465 7220 696e 2074 6865 2073 6f75  meter in the sou
-0001e540: 7263 6520 6974 7365 6c66 2e0a 2020 2020  rce itself..    
-0001e550: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
-0001e560: 653a 2053 6f75 7263 6520 6f62 6a65 6374  e: Source object
-0001e570: 2074 6f20 7374 6f72 6520 696e 2074 6865   to store in the
-0001e580: 2064 6174 6162 6173 652e 0a20 2020 2020   database..     
-0001e590: 2020 203a 7265 7475 726e 733a 2054 6865     :returns: The
-0001e5a0: 2073 6f75 7263 6520 6f62 6a65 6374 2061   source object a
-0001e5b0: 7320 7374 6f72 6564 2069 6e20 7468 6520  s stored in the 
-0001e5c0: 4442 2e0a 2020 2020 2020 2020 2222 220a  DB..        """.
-0001e5d0: 2020 2020 2020 2020 7061 7468 203d 2066          path = f
-0001e5e0: 2268 7562 2f73 6f75 7263 6573 2f7b 736f  "hub/sources/{so
-0001e5f0: 7572 6365 5f6e 616d 657d 220a 2020 2020  urce_name}".    
-0001e600: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0001e610: 6528 736f 7572 6365 2c20 6d6c 7275 6e2e  e(source, mlrun.
-0001e620: 636f 6d6d 6f6e 2e73 6368 656d 6173 2e49  common.schemas.I
-0001e630: 6e64 6578 6564 4875 6253 6f75 7263 6529  ndexedHubSource)
-0001e640: 3a0a 2020 2020 2020 2020 2020 2020 736f  :.            so
-0001e650: 7572 6365 203d 2073 6f75 7263 652e 6469  urce = source.di
-0001e660: 6374 2829 0a0a 2020 2020 2020 2020 7265  ct()..        re
-0001e670: 7370 6f6e 7365 203d 2073 656c 662e 6170  sponse = self.ap
-0001e680: 695f 6361 6c6c 286d 6574 686f 643d 2250  i_call(method="P
-0001e690: 5554 222c 2070 6174 683d 7061 7468 2c20  UT", path=path, 
-0001e6a0: 6a73 6f6e 3d73 6f75 7263 6529 0a20 2020  json=source).   
-0001e6b0: 2020 2020 2072 6574 7572 6e20 6d6c 7275       return mlru
-0001e6c0: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0001e6d0: 2e49 6e64 6578 6564 4875 6253 6f75 7263  .IndexedHubSourc
-0001e6e0: 6528 2a2a 7265 7370 6f6e 7365 2e6a 736f  e(**response.jso
-0001e6f0: 6e28 2929 0a0a 2020 2020 6465 6620 6c69  n())..    def li
-0001e700: 7374 5f68 7562 5f73 6f75 7263 6573 2873  st_hub_sources(s
-0001e710: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0001e720: 220a 2020 2020 2020 2020 4c69 7374 2068  ".        List h
-0001e730: 7562 2073 6f75 7263 6573 2069 6e20 7468  ub sources in th
-0001e740: 6520 4d4c 5275 6e20 4442 2e0a 2020 2020  e MLRun DB..    
-0001e750: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
-0001e760: 7061 7468 203d 2022 6875 622f 736f 7572  path = "hub/sour
-0001e770: 6365 7322 0a20 2020 2020 2020 2072 6573  ces".        res
-0001e780: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
-0001e790: 5f63 616c 6c28 6d65 7468 6f64 3d22 4745  _call(method="GE
-0001e7a0: 5422 2c20 7061 7468 3d70 6174 6829 2e6a  T", path=path).j
-0001e7b0: 736f 6e28 290a 2020 2020 2020 2020 7265  son().        re
-0001e7c0: 7375 6c74 7320 3d20 5b5d 0a20 2020 2020  sults = [].     
-0001e7d0: 2020 2066 6f72 2069 7465 6d20 696e 2072     for item in r
-0001e7e0: 6573 706f 6e73 653a 0a20 2020 2020 2020  esponse:.       
-0001e7f0: 2020 2020 2072 6573 756c 7473 2e61 7070       results.app
-0001e800: 656e 6428 6d6c 7275 6e2e 636f 6d6d 6f6e  end(mlrun.common
-0001e810: 2e73 6368 656d 6173 2e49 6e64 6578 6564  .schemas.Indexed
-0001e820: 4875 6253 6f75 7263 6528 2a2a 6974 656d  HubSource(**item
-0001e830: 2929 0a20 2020 2020 2020 2072 6574 7572  )).        retur
-0001e840: 6e20 7265 7375 6c74 730a 0a20 2020 2064  n results..    d
-0001e850: 6566 2067 6574 5f68 7562 5f73 6f75 7263  ef get_hub_sourc
-0001e860: 6528 7365 6c66 2c20 736f 7572 6365 5f6e  e(self, source_n
-0001e870: 616d 653a 2073 7472 293a 0a20 2020 2020  ame: str):.     
-0001e880: 2020 2022 2222 0a20 2020 2020 2020 2052     """.        R
-0001e890: 6574 7269 6576 6520 6120 6875 6220 736f  etrieve a hub so
-0001e8a0: 7572 6365 2066 726f 6d20 7468 6520 4442  urce from the DB
-0001e8b0: 2e0a 0a20 2020 2020 2020 203a 7061 7261  ...        :para
-0001e8c0: 6d20 736f 7572 6365 5f6e 616d 653a 204e  m source_name: N
-0001e8d0: 616d 6520 6f66 2074 6865 2068 7562 2073  ame of the hub s
-0001e8e0: 6f75 7263 6520 746f 2072 6574 7269 6576  ource to retriev
-0001e8f0: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-0001e900: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-0001e910: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
-0001e920: 7263 655f 6e61 6d65 7d22 0a20 2020 2020  rce_name}".     
-0001e930: 2020 2072 6573 706f 6e73 6520 3d20 7365     response = se
-0001e940: 6c66 2e61 7069 5f63 616c 6c28 6d65 7468  lf.api_call(meth
-0001e950: 6f64 3d22 4745 5422 2c20 7061 7468 3d70  od="GET", path=p
-0001e960: 6174 6829 0a20 2020 2020 2020 2072 6574  ath).        ret
-0001e970: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
-0001e980: 2e73 6368 656d 6173 2e49 6e64 6578 6564  .schemas.Indexed
-0001e990: 4875 6253 6f75 7263 6528 2a2a 7265 7370  HubSource(**resp
-0001e9a0: 6f6e 7365 2e6a 736f 6e28 2929 0a0a 2020  onse.json())..  
-0001e9b0: 2020 6465 6620 6465 6c65 7465 5f68 7562    def delete_hub
-0001e9c0: 5f73 6f75 7263 6528 7365 6c66 2c20 736f  _source(self, so
-0001e9d0: 7572 6365 5f6e 616d 653a 2073 7472 293a  urce_name: str):
-0001e9e0: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001e9f0: 2020 2020 2044 656c 6574 6520 6120 6875       Delete a hu
-0001ea00: 6220 736f 7572 6365 2066 726f 6d20 7468  b source from th
-0001ea10: 6520 4442 2e0a 2020 2020 2020 2020 5468  e DB..        Th
-0001ea20: 6520 736f 7572 6365 2077 696c 6c20 6265  e source will be
-0001ea30: 2064 656c 6574 6564 2066 726f 6d20 7468   deleted from th
-0001ea40: 6520 6c69 7374 2c20 616e 6420 616e 7920  e list, and any 
-0001ea50: 666f 6c6c 6f77 696e 6720 736f 7572 6365  following source
-0001ea60: 7320 7769 6c6c 2062 6520 7072 6f6d 6f74  s will be promot
-0001ea70: 6564 202d 2066 6f72 2065 7861 6d70 6c65  ed - for example
-0001ea80: 2c20 6966 2074 6865 0a20 2020 2020 2020  , if the.       
-0001ea90: 2031 7374 2073 6f75 7263 6520 6973 2064   1st source is d
-0001eaa0: 656c 6574 6564 2c20 7468 6520 326e 6420  eleted, the 2nd 
-0001eab0: 736f 7572 6365 2077 696c 6c20 6265 636f  source will beco
-0001eac0: 6d65 2023 3120 696e 2074 6865 206c 6973  me #1 in the lis
-0001ead0: 742e 0a20 2020 2020 2020 2054 6865 2067  t..        The g
-0001eae0: 6c6f 6261 6c20 6875 6220 736f 7572 6365  lobal hub source
-0001eaf0: 2063 616e 6e6f 7420 6265 2064 656c 6574   cannot be delet
-0001eb00: 6564 2e0a 0a20 2020 2020 2020 203a 7061  ed...        :pa
-0001eb10: 7261 6d20 736f 7572 6365 5f6e 616d 653a  ram source_name:
-0001eb20: 204e 616d 6520 6f66 2074 6865 2068 7562   Name of the hub
-0001eb30: 2073 6f75 7263 6520 746f 2064 656c 6574   source to delet
-0001eb40: 652e 0a20 2020 2020 2020 2022 2222 0a20  e..        """. 
-0001eb50: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
-0001eb60: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
-0001eb70: 7263 655f 6e61 6d65 7d22 0a20 2020 2020  rce_name}".     
-0001eb80: 2020 2073 656c 662e 6170 695f 6361 6c6c     self.api_call
-0001eb90: 286d 6574 686f 643d 2244 454c 4554 4522  (method="DELETE"
-0001eba0: 2c20 7061 7468 3d70 6174 6829 0a0a 2020  , path=path)..  
-0001ebb0: 2020 6465 6620 6765 745f 6875 625f 6361    def get_hub_ca
-0001ebc0: 7461 6c6f 6728 0a20 2020 2020 2020 2073  talog(.        s
-0001ebd0: 656c 662c 0a20 2020 2020 2020 2073 6f75  elf,.        sou
-0001ebe0: 7263 655f 6e61 6d65 3a20 7374 722c 0a20  rce_name: str,. 
-0001ebf0: 2020 2020 2020 2076 6572 7369 6f6e 3a20         version: 
-0001ec00: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
-0001ec10: 2020 2020 7461 673a 2073 7472 203d 204e      tag: str = N
-0001ec20: 6f6e 652c 0a20 2020 2020 2020 2066 6f72  one,.        for
-0001ec30: 6365 5f72 6566 7265 7368 3a20 626f 6f6c  ce_refresh: bool
-0001ec40: 203d 2046 616c 7365 2c0a 2020 2020 293a   = False,.    ):
-0001ec50: 0a20 2020 2020 2020 2022 2222 0a20 2020  .        """.   
-0001ec60: 2020 2020 2052 6574 7269 6576 6520 7468       Retrieve th
-0001ec70: 6520 6974 656d 2063 6174 616c 6f67 2066  e item catalog f
-0001ec80: 6f72 2061 2073 7065 6369 6669 6564 2068  or a specified h
-0001ec90: 7562 2073 6f75 7263 652e 0a20 2020 2020  ub source..     
-0001eca0: 2020 2054 6865 206c 6973 7420 6f66 2069     The list of i
-0001ecb0: 7465 6d73 2063 616e 2062 6520 6669 6c74  tems can be filt
-0001ecc0: 6572 6564 2061 6363 6f72 6469 6e67 2074  ered according t
-0001ecd0: 6f20 7661 7269 6f75 7320 6669 6c74 6572  o various filter
-0001ece0: 732c 2075 7369 6e67 2069 7465 6d27 7320  s, using item's 
-0001ecf0: 6d65 7461 6461 7461 2074 6f20 6669 6c74  metadata to filt
-0001ed00: 6572 2e0a 0a20 2020 2020 2020 203a 7061  er...        :pa
-0001ed10: 7261 6d20 736f 7572 6365 5f6e 616d 653a  ram source_name:
-0001ed20: 204e 616d 6520 6f66 2074 6865 2073 6f75   Name of the sou
-0001ed30: 7263 652e 0a20 2020 2020 2020 203a 7061  rce..        :pa
-0001ed40: 7261 6d20 7665 7273 696f 6e3a 2046 696c  ram version: Fil
-0001ed50: 7465 7220 6974 656d 7320 6163 636f 7264  ter items accord
-0001ed60: 696e 6720 746f 2074 6865 6972 2076 6572  ing to their ver
-0001ed70: 7369 6f6e 2e0a 2020 2020 2020 2020 3a70  sion..        :p
-0001ed80: 6172 616d 2074 6167 3a20 4669 6c74 6572  aram tag: Filter
-0001ed90: 2069 7465 6d73 2062 6173 6564 206f 6e20   items based on 
-0001eda0: 7461 672e 0a20 2020 2020 2020 203a 7061  tag..        :pa
-0001edb0: 7261 6d20 666f 7263 655f 7265 6672 6573  ram force_refres
-0001edc0: 683a 204d 616b 6520 7468 6520 7365 7276  h: Make the serv
-0001edd0: 6572 2066 6574 6368 2074 6865 2063 6174  er fetch the cat
-0001ede0: 616c 6f67 2066 726f 6d20 7468 6520 6163  alog from the ac
-0001edf0: 7475 616c 2068 7562 2073 6f75 7263 652c  tual hub source,
-0001ee00: 0a20 2020 2020 2020 2020 2020 2072 6174  .            rat
-0001ee10: 6865 7220 7468 616e 2072 656c 7920 6f6e  her than rely on
-0001ee20: 2063 6163 6865 6420 696e 666f 726d 6174   cached informat
-0001ee30: 696f 6e20 7768 6963 6820 6d61 7920 6578  ion which may ex
-0001ee40: 6973 7420 6672 6f6d 2070 7265 7669 6f75  ist from previou
-0001ee50: 7320 6765 7420 7265 7175 6573 7473 2e20  s get requests. 
-0001ee60: 466f 7220 6578 616d 706c 652c 0a20 2020  For example,.   
-0001ee70: 2020 2020 2020 2020 2069 6620 7468 6520           if the 
-0001ee80: 736f 7572 6365 2077 6173 2072 652d 6275  source was re-bu
-0001ee90: 696c 742c 0a20 2020 2020 2020 2020 2020  ilt,.           
-0001eea0: 2074 6869 7320 7769 6c6c 206d 616b 6520   this will make 
-0001eeb0: 7468 6520 7365 7276 6572 2067 6574 2074  the server get t
-0001eec0: 6865 2075 7064 6174 6564 2069 6e66 6f72  he updated infor
-0001eed0: 6d61 7469 6f6e 2e20 4465 6661 756c 7420  mation. Default 
-0001eee0: 6973 2060 6046 616c 7365 6060 2e0a 2020  is ``False``..  
-0001eef0: 2020 2020 2020 3a72 6574 7572 6e73 3a20        :returns: 
-0001ef00: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
-0001ef10: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0001ef20: 2e68 7562 2e48 7562 4361 7461 6c6f 6760  .hub.HubCatalog`
-0001ef30: 206f 626a 6563 742c 2077 6869 6368 2069   object, which i
-0001ef40: 7320 6573 7365 6e74 6961 6c6c 7920 6120  s essentially a 
-0001ef50: 6c69 7374 0a20 2020 2020 2020 2020 2020  list.           
-0001ef60: 206f 6620 3a70 793a 636c 6173 733a 607e   of :py:class:`~
-0001ef70: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0001ef80: 656d 6173 2e68 7562 2e48 7562 4974 656d  emas.hub.HubItem
-0001ef90: 6020 656e 7472 6965 732e 0a20 2020 2020  ` entries..     
-0001efa0: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
-0001efb0: 6174 6820 3d20 2866 2268 7562 2f73 6f75  ath = (f"hub/sou
-0001efc0: 7263 6573 2f7b 736f 7572 6365 5f6e 616d  rces/{source_nam
-0001efd0: 657d 2f69 7465 6d73 222c 290a 2020 2020  e}/items",).    
-0001efe0: 2020 2020 7061 7261 6d73 203d 207b 0a20      params = {. 
-0001eff0: 2020 2020 2020 2020 2020 2022 7665 7273             "vers
-0001f000: 696f 6e22 3a20 7665 7273 696f 6e2c 0a20  ion": version,. 
-0001f010: 2020 2020 2020 2020 2020 2022 7461 6722             "tag"
-0001f020: 3a20 7461 672c 0a20 2020 2020 2020 2020  : tag,.         
-0001f030: 2020 2022 666f 7263 652d 7265 6672 6573     "force-refres
-0001f040: 6822 3a20 666f 7263 655f 7265 6672 6573  h": force_refres
-0001f050: 682c 0a20 2020 2020 2020 207d 0a20 2020  h,.        }.   
-0001f060: 2020 2020 2072 6573 706f 6e73 6520 3d20       response = 
-0001f070: 7365 6c66 2e61 7069 5f63 616c 6c28 6d65  self.api_call(me
-0001f080: 7468 6f64 3d22 4745 5422 2c20 7061 7468  thod="GET", path
-0001f090: 3d70 6174 682c 2070 6172 616d 733d 7061  =path, params=pa
-0001f0a0: 7261 6d73 290a 2020 2020 2020 2020 7265  rams).        re
-0001f0b0: 7475 726e 206d 6c72 756e 2e63 6f6d 6d6f  turn mlrun.commo
-0001f0c0: 6e2e 7363 6865 6d61 732e 4875 6243 6174  n.schemas.HubCat
-0001f0d0: 616c 6f67 282a 2a72 6573 706f 6e73 652e  alog(**response.
-0001f0e0: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
-0001f0f0: 2067 6574 5f68 7562 5f69 7465 6d28 0a20   get_hub_item(. 
-0001f100: 2020 2020 2020 2073 656c 662c 0a20 2020         self,.   
-0001f110: 2020 2020 2073 6f75 7263 655f 6e61 6d65       source_name
-0001f120: 3a20 7374 722c 0a20 2020 2020 2020 2069  : str,.        i
-0001f130: 7465 6d5f 6e61 6d65 3a20 7374 722c 0a20  tem_name: str,. 
-0001f140: 2020 2020 2020 2076 6572 7369 6f6e 3a20         version: 
-0001f150: 7374 7220 3d20 4e6f 6e65 2c0a 2020 2020  str = None,.    
-0001f160: 2020 2020 7461 673a 2073 7472 203d 2022      tag: str = "
-0001f170: 6c61 7465 7374 222c 0a20 2020 2020 2020  latest",.       
-0001f180: 2066 6f72 6365 5f72 6566 7265 7368 3a20   force_refresh: 
-0001f190: 626f 6f6c 203d 2046 616c 7365 2c0a 2020  bool = False,.  
-0001f1a0: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
-0001f1b0: 0a20 2020 2020 2020 2052 6574 7269 6576  .        Retriev
-0001f1c0: 6520 6120 7370 6563 6966 6963 2068 7562  e a specific hub
-0001f1d0: 2069 7465 6d2e 0a0a 2020 2020 2020 2020   item...        
-0001f1e0: 3a70 6172 616d 2073 6f75 7263 655f 6e61  :param source_na
-0001f1f0: 6d65 3a20 4e61 6d65 206f 6620 736f 7572  me: Name of sour
+0001d250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d260: 2020 2020 2020 2020 2062 6520 6164 6465           be adde
+0001d270: 6420 746f 2074 6865 206f 7574 7075 7420  d to the output 
+0001d280: 6f66 2074 6865 2072 6573 756c 7469 6e67  of the resulting
+0001d290: 206f 626a 6563 742e 0a0a 2020 2020 2020   object...      
+0001d2a0: 2020 3a72 6574 7572 6e3a 2041 2060 4d6f    :return: A `Mo
+0001d2b0: 6465 6c45 6e64 706f 696e 7460 206f 626a  delEndpoint` obj
+0001d2c0: 6563 742e 0a20 2020 2020 2020 2022 2222  ect..        """
+0001d2d0: 0a0a 2020 2020 2020 2020 7061 7468 203d  ..        path =
+0001d2e0: 2066 2270 726f 6a65 6374 732f 7b70 726f   f"projects/{pro
+0001d2f0: 6a65 6374 7d2f 6d6f 6465 6c2d 656e 6470  ject}/model-endp
+0001d300: 6f69 6e74 732f 7b65 6e64 706f 696e 745f  oints/{endpoint_
+0001d310: 6964 7d22 0a20 2020 2020 2020 2072 6573  id}".        res
+0001d320: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
+0001d330: 5f63 616c 6c28 0a20 2020 2020 2020 2020  _call(.         
+0001d340: 2020 206d 6574 686f 643d 2247 4554 222c     method="GET",
+0001d350: 0a20 2020 2020 2020 2020 2020 2070 6174  .            pat
+0001d360: 683d 7061 7468 2c0a 2020 2020 2020 2020  h=path,.        
+0001d370: 2020 2020 7061 7261 6d73 3d7b 0a20 2020      params={.   
+0001d380: 2020 2020 2020 2020 2020 2020 2022 7374               "st
+0001d390: 6172 7422 3a20 7374 6172 742c 0a20 2020  art": start,.   
+0001d3a0: 2020 2020 2020 2020 2020 2020 2022 656e               "en
+0001d3b0: 6422 3a20 656e 642c 0a20 2020 2020 2020  d": end,.       
+0001d3c0: 2020 2020 2020 2020 2022 6d65 7472 6963           "metric
+0001d3d0: 223a 206d 6574 7269 6373 206f 7220 5b5d  ": metrics or []
+0001d3e0: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
+0001d3f0: 2020 2266 6561 7475 7265 5f61 6e61 6c79    "feature_analy
+0001d400: 7369 7322 3a20 6665 6174 7572 655f 616e  sis": feature_an
+0001d410: 616c 7973 6973 2c0a 2020 2020 2020 2020  alysis,.        
+0001d420: 2020 2020 7d2c 0a20 2020 2020 2020 2029      },.        )
+0001d430: 0a0a 2020 2020 2020 2020 7265 7475 726e  ..        return
+0001d440: 206d 6c72 756e 2e6d 6f64 656c 5f6d 6f6e   mlrun.model_mon
+0001d450: 6974 6f72 696e 672e 6d6f 6465 6c5f 656e  itoring.model_en
+0001d460: 6470 6f69 6e74 2e4d 6f64 656c 456e 6470  dpoint.ModelEndp
+0001d470: 6f69 6e74 2e66 726f 6d5f 6469 6374 280a  oint.from_dict(.
+0001d480: 2020 2020 2020 2020 2020 2020 7265 7370              resp
+0001d490: 6f6e 7365 2e6a 736f 6e28 290a 2020 2020  onse.json().    
+0001d4a0: 2020 2020 290a 0a20 2020 2064 6566 2070      )..    def p
+0001d4b0: 6174 6368 5f6d 6f64 656c 5f65 6e64 706f  atch_model_endpo
+0001d4c0: 696e 7428 0a20 2020 2020 2020 2073 656c  int(.        sel
+0001d4d0: 662c 0a20 2020 2020 2020 2070 726f 6a65  f,.        proje
+0001d4e0: 6374 3a20 7374 722c 0a20 2020 2020 2020  ct: str,.       
+0001d4f0: 2065 6e64 706f 696e 745f 6964 3a20 7374   endpoint_id: st
+0001d500: 722c 0a20 2020 2020 2020 2061 7474 7269  r,.        attri
+0001d510: 6275 7465 733a 2064 6963 742c 0a20 2020  butes: dict,.   
+0001d520: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0001d530: 2020 2020 2020 2020 5570 6461 7465 7320          Updates 
+0001d540: 6d6f 6465 6c20 656e 6470 6f69 6e74 2077  model endpoint w
+0001d550: 6974 6820 7072 6f76 6964 6564 2061 7474  ith provided att
+0001d560: 7269 6275 7465 732e 0a0a 2020 2020 2020  ributes...      
+0001d570: 2020 3a70 6172 616d 2070 726f 6a65 6374    :param project
+0001d580: 3a20 5468 6520 6e61 6d65 206f 6620 7468  : The name of th
+0001d590: 6520 7072 6f6a 6563 742e 0a20 2020 2020  e project..     
+0001d5a0: 2020 203a 7061 7261 6d20 656e 6470 6f69     :param endpoi
+0001d5b0: 6e74 5f69 643a 2054 6865 2069 6420 6f66  nt_id: The id of
+0001d5c0: 2074 6865 2065 6e64 706f 696e 742e 0a20   the endpoint.. 
+0001d5d0: 2020 2020 2020 203a 7061 7261 6d20 6174         :param at
+0001d5e0: 7472 6962 7574 6573 3a20 4469 6374 696f  tributes: Dictio
+0001d5f0: 6e61 7279 206f 6620 6174 7472 6962 7574  nary of attribut
+0001d600: 6573 2074 6861 7420 7769 6c6c 2062 6520  es that will be 
+0001d610: 7573 6564 2066 6f72 2075 7064 6174 6520  used for update 
+0001d620: 7468 6520 6d6f 6465 6c20 656e 6470 6f69  the model endpoi
+0001d630: 6e74 2e20 5468 6520 6b65 7973 0a20 2020  nt. The keys.   
+0001d640: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d650: 2020 2020 2020 2020 6f66 2074 6869 7320          of this 
+0001d660: 6469 6374 696f 6e61 7279 2073 686f 756c  dictionary shoul
+0001d670: 6420 6578 6973 7420 696e 2074 6865 2074  d exist in the t
+0001d680: 6172 6765 7420 7461 626c 652e 204e 6f74  arget table. Not
+0001d690: 6520 7468 6174 2074 6865 2076 616c 7565  e that the value
+0001d6a0: 7320 7368 6f75 6c64 2062 650a 2020 2020  s should be.    
+0001d6b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d6c0: 2020 2020 2020 2066 726f 6d20 7479 7065         from type
+0001d6d0: 2073 7472 696e 6720 6f72 2066 726f 6d20   string or from 
+0001d6e0: 6120 7661 6c69 6420 6e75 6d65 7269 6361  a valid numerica
+0001d6f0: 6c20 7479 7065 2073 7563 6820 6173 2069  l type such as i
+0001d700: 6e74 206f 7220 666c 6f61 742e 0a20 2020  nt or float..   
+0001d710: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d720: 2020 2020 2020 2020 204d 6f72 6520 6465           More de
+0001d730: 7461 696c 7320 6162 6f75 7420 7468 6520  tails about the 
+0001d740: 6d6f 6465 6c20 656e 6470 6f69 6e74 2061  model endpoint a
+0001d750: 7661 696c 6162 6c65 2061 7474 7269 6275  vailable attribu
+0001d760: 7465 7320 6361 6e20 6265 2066 6f75 6e64  tes can be found
+0001d770: 2075 6e64 6572 0a20 2020 2020 2020 2020   under.         
+0001d780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d790: 2020 3a70 793a 636c 6173 733a 607e 6d6c    :py:class:`~ml
+0001d7a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001d7b0: 6173 2e4d 6f64 656c 456e 6470 6f69 6e74  as.ModelEndpoint
+0001d7c0: 602e 0a0a 2020 2020 2020 2020 2020 2020  `...            
+0001d7d0: 2020 2020 2020 2020 2020 2020 2020 2045                 E
+0001d7e0: 7861 6d70 6c65 3a3a 0a0a 2020 2020 2020  xample::..      
+0001d7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d800: 2020 2020 2020 2020 2020 2320 4765 6e65            # Gene
+0001d810: 7261 7465 2063 7572 7265 6e74 2073 7461  rate current sta
+0001d820: 7473 2066 6f72 2074 776f 2066 6561 7475  ts for two featu
+0001d830: 7265 730a 2020 2020 2020 2020 2020 2020  res.            
+0001d840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d850: 2020 2020 6375 7272 656e 745f 7374 6174      current_stat
+0001d860: 7320 3d20 7b27 7476 645f 7375 6d27 3a20  s = {'tvd_sum': 
+0001d870: 322e 322c 0a20 2020 2020 2020 2020 2020  2.2,.           
+0001d880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d890: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8a0: 2020 2020 2020 2774 7664 5f6d 6561 6e27        'tvd_mean'
+0001d8b0: 3a20 302e 352c 0a20 2020 2020 2020 2020  : 0.5,.         
+0001d8c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d8e0: 2020 2020 2020 2020 2768 656c 6c69 6e67          'helling
+0001d8f0: 6572 5f73 756d 273a 2033 2e36 2c0a 2020  er_sum': 3.6,.  
+0001d900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d910: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d920: 2020 2020 2020 2020 2020 2020 2020 2027                 '
+0001d930: 6865 6c6c 696e 6765 725f 6d65 616e 273a  hellinger_mean':
+0001d940: 2030 2e39 2c0a 2020 2020 2020 2020 2020   0.9,.          
+0001d950: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d970: 2020 2020 2020 2027 6b6c 645f 7375 6d27         'kld_sum'
+0001d980: 3a20 3234 2e32 2c0a 2020 2020 2020 2020  : 24.2,.        
+0001d990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9b0: 2020 2020 2020 2020 2027 6b6c 645f 6d65           'kld_me
+0001d9c0: 616e 273a 2036 2e30 2c0a 2020 2020 2020  an': 6.0,.      
+0001d9d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001d9f0: 2020 2020 2020 2020 2020 2027 6631 273a             'f1':
+0001da00: 207b 2774 7664 273a 2030 2e35 2c20 2768   {'tvd': 0.5, 'h
+0001da10: 656c 6c69 6e67 6572 273a 2031 2e30 2c20  ellinger': 1.0, 
+0001da20: 276b 6c64 273a 2036 2e34 7d2c 0a20 2020  'kld': 6.4},.   
+0001da30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001da50: 2020 2020 2020 2020 2020 2020 2020 2766                'f
+0001da60: 3227 3a20 7b27 7476 6427 3a20 302e 352c  2': {'tvd': 0.5,
+0001da70: 2027 6865 6c6c 696e 6765 7227 3a20 312e   'hellinger': 1.
+0001da80: 302c 2027 6b6c 6427 3a20 362e 357d 7d0a  0, 'kld': 6.5}}.
+0001da90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001daa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001dab0: 2023 2043 7265 6174 6520 6174 7472 6962   # Create attrib
+0001dac0: 7574 6573 2064 6963 7469 6f6e 6172 7920  utes dictionary 
+0001dad0: 6163 636f 7264 696e 6720 746f 2074 6865  according to the
+0001dae0: 2072 6571 7569 7265 6420 666f 726d 6174   required format
+0001daf0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001db00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db10: 2061 7474 7269 6275 7465 7320 3d20 7b60   attributes = {`
+0001db20: 6375 7272 656e 745f 7374 6174 7360 3a20  current_stats`: 
+0001db30: 6a73 6f6e 2e64 756d 7073 2863 7572 7265  json.dumps(curre
+0001db40: 6e74 5f73 7461 7473 292c 0a20 2020 2020  nt_stats),.     
+0001db50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001db70: 2020 2020 2020 2020 2060 6472 6966 745f           `drift_
+0001db80: 7374 6174 7573 603a 2022 4452 4946 545f  status`: "DRIFT_
+0001db90: 4445 5445 4354 4544 227d 0a0a 2020 2020  DETECTED"}..    
+0001dba0: 2020 2020 2222 220a 0a20 2020 2020 2020      """..       
+0001dbb0: 2061 7474 7269 6275 7465 7320 3d20 7b22   attributes = {"
+0001dbc0: 6174 7472 6962 7574 6573 223a 205f 6173  attributes": _as
+0001dbd0: 5f6a 736f 6e28 6174 7472 6962 7574 6573  _json(attributes
+0001dbe0: 297d 0a20 2020 2020 2020 2070 6174 6820  )}.        path 
+0001dbf0: 3d20 6622 7072 6f6a 6563 7473 2f7b 7072  = f"projects/{pr
+0001dc00: 6f6a 6563 747d 2f6d 6f64 656c 2d65 6e64  oject}/model-end
+0001dc10: 706f 696e 7473 2f7b 656e 6470 6f69 6e74  points/{endpoint
+0001dc20: 5f69 647d 220a 2020 2020 2020 2020 7365  _id}".        se
+0001dc30: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+0001dc40: 2020 2020 2020 2020 206d 6574 686f 643d           method=
+0001dc50: 2250 4154 4348 222c 0a20 2020 2020 2020  "PATCH",.       
+0001dc60: 2020 2020 2070 6174 683d 7061 7468 2c0a       path=path,.
+0001dc70: 2020 2020 2020 2020 2020 2020 7061 7261              para
+0001dc80: 6d73 3d61 7474 7269 6275 7465 732c 0a20  ms=attributes,. 
+0001dc90: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
+0001dca0: 6620 6372 6561 7465 5f68 7562 5f73 6f75  f create_hub_sou
+0001dcb0: 7263 6528 0a20 2020 2020 2020 2073 656c  rce(.        sel
+0001dcc0: 662c 2073 6f75 7263 653a 2055 6e69 6f6e  f, source: Union
+0001dcd0: 5b64 6963 742c 206d 6c72 756e 2e63 6f6d  [dict, mlrun.com
+0001dce0: 6d6f 6e2e 7363 6865 6d61 732e 496e 6465  mon.schemas.Inde
+0001dcf0: 7865 6448 7562 536f 7572 6365 5d0a 2020  xedHubSource].  
+0001dd00: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+0001dd10: 0a20 2020 2020 2020 2041 6464 2061 206e  .        Add a n
+0001dd20: 6577 2068 7562 2073 6f75 7263 652e 0a0a  ew hub source...
+0001dd30: 2020 2020 2020 2020 4d4c 5275 6e20 6d61          MLRun ma
+0001dd40: 696e 7461 696e 7320 616e 206f 7264 6572  intains an order
+0001dd50: 6564 206c 6973 7420 6f66 2068 7562 2073  ed list of hub s
+0001dd60: 6f75 7263 6573 2028 e280 9c73 6f75 7263  ources (...sourc
+0001dd70: 6573 e280 9d29 2045 6163 6820 736f 7572  es...) Each sour
+0001dd80: 6365 2068 6173 0a20 2020 2020 2020 2069  ce has.        i
+0001dd90: 7473 2064 6574 6169 6c73 2072 6567 6973  ts details regis
+0001dda0: 7465 7265 6420 616e 6420 6974 7320 6f72  tered and its or
+0001ddb0: 6465 7220 7769 7468 696e 2074 6865 206c  der within the l
+0001ddc0: 6973 742e 2057 6865 6e20 6372 6561 7469  ist. When creati
+0001ddd0: 6e67 2061 206e 6577 2073 6f75 7263 652c  ng a new source,
+0001dde0: 2074 6865 2073 7065 6369 616c 206f 7264   the special ord
+0001ddf0: 6572 2060 602d 3160 600a 2020 2020 2020  er ``-1``.      
+0001de00: 2020 6361 6e20 6265 2075 7365 6420 746f    can be used to
+0001de10: 206d 6172 6b20 7468 6973 2073 6f75 7263   mark this sourc
+0001de20: 6520 6173 206c 6173 7420 696e 2074 6865  e as last in the
+0001de30: 206c 6973 742e 2048 6f77 6576 6572 2c20   list. However, 
+0001de40: 6f6e 6365 2074 6865 2073 6f75 7263 6520  once the source 
+0001de50: 6973 2069 6e20 7468 6520 4d4c 5275 6e20  is in the MLRun 
+0001de60: 6c69 7374 2c0a 2020 2020 2020 2020 6974  list,.        it
+0001de70: 7320 6f72 6465 7220 7769 6c6c 2061 6c77  s order will alw
+0001de80: 6179 7320 6265 2060 603e 3060 602e 0a0a  ays be ``>0``...
+0001de90: 2020 2020 2020 2020 5468 6520 676c 6f62          The glob
+0001dea0: 616c 2068 7562 2073 6f75 7263 6520 616c  al hub source al
+0001deb0: 7761 7973 2065 7869 7374 7320 696e 2074  ways exists in t
+0001dec0: 6865 206c 6973 742c 2061 6e64 2069 7320  he list, and is 
+0001ded0: 616c 7761 7973 2074 6865 206c 6173 7420  always the last 
+0001dee0: 736f 7572 6365 0a20 2020 2020 2020 2028  source.        (
+0001def0: 6060 6f72 6465 7220 3d20 2d31 6060 292e  ``order = -1``).
+0001df00: 2049 7420 6361 6e6e 6f74 2062 6520 6d6f   It cannot be mo
+0001df10: 6469 6669 6564 206e 6f72 2063 616e 2069  dified nor can i
+0001df20: 7420 6265 206d 6f76 6564 2074 6f20 616e  t be moved to an
+0001df30: 6f74 6865 7220 6f72 6465 7220 696e 2074  other order in t
+0001df40: 6865 206c 6973 742e 0a0a 2020 2020 2020  he list...      
+0001df50: 2020 5468 6520 736f 7572 6365 206f 626a    The source obj
+0001df60: 6563 7420 6d61 7920 636f 6e74 6169 6e20  ect may contain 
+0001df70: 6372 6564 656e 7469 616c 7320 7768 6963  credentials whic
+0001df80: 6820 6172 6520 6e65 6564 6564 2074 6f20  h are needed to 
+0001df90: 6163 6365 7373 2074 6865 2064 6174 6173  access the datas
+0001dfa0: 746f 7265 2077 6865 7265 2074 6865 2073  tore where the s
+0001dfb0: 6f75 7263 6520 6973 2073 746f 7265 642e  ource is stored.
+0001dfc0: 0a20 2020 2020 2020 2054 6865 7365 2063  .        These c
+0001dfd0: 7265 6465 6e74 6961 6c73 2061 7265 206e  redentials are n
+0001dfe0: 6f74 206b 6570 7420 696e 2074 6865 204d  ot kept in the M
+0001dff0: 4c52 756e 2044 422c 2062 7574 2061 7265  LRun DB, but are
+0001e000: 2073 746f 7265 6420 696e 7369 6465 2061   stored inside a
+0001e010: 206b 7562 6572 6e65 7465 7320 7365 6372   kubernetes secr
+0001e020: 6574 206f 626a 6563 7420 6d61 696e 7461  et object mainta
+0001e030: 696e 6564 2062 790a 2020 2020 2020 2020  ined by.        
+0001e040: 4d4c 5275 6e2e 2054 6865 7920 6172 6520  MLRun. They are 
+0001e050: 6e6f 7420 7265 7475 726e 6564 2074 6872  not returned thr
+0001e060: 6f75 6768 2061 6e79 2041 5049 2066 726f  ough any API fro
+0001e070: 6d20 4d4c 5275 6e2e 0a0a 2020 2020 2020  m MLRun...      
+0001e080: 2020 4578 616d 706c 653a 3a0a 0a20 2020    Example::..   
+0001e090: 2020 2020 2020 2020 2069 6d70 6f72 7420           import 
+0001e0a0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+0001e0b0: 656d 6173 0a0a 2020 2020 2020 2020 2020  emas..          
+0001e0c0: 2020 2320 4164 6420 6120 7072 6976 6174    # Add a privat
+0001e0d0: 6520 736f 7572 6365 2061 7320 7468 6520  e source as the 
+0001e0e0: 6c61 7374 206f 6e65 2028 7769 6c6c 2062  last one (will b
+0001e0f0: 6520 2331 2069 6e20 7468 6520 6c69 7374  e #1 in the list
+0001e100: 290a 2020 2020 2020 2020 2020 2020 7072  ).            pr
+0001e110: 6976 6174 655f 736f 7572 6365 203d 206d  ivate_source = m
+0001e120: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001e130: 6d61 732e 496e 6465 7865 6448 7562 6553  mas.IndexedHubeS
+0001e140: 6f75 7263 6528 0a20 2020 2020 2020 2020  ource(.         
+0001e150: 2020 2020 2020 206f 7264 6572 3d2d 312c         order=-1,
+0001e160: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e170: 2073 6f75 7263 653d 6d6c 7275 6e2e 636f   source=mlrun.co
+0001e180: 6d6d 6f6e 2e73 6368 656d 6173 2e48 7562  mmon.schemas.Hub
+0001e190: 536f 7572 6365 280a 2020 2020 2020 2020  Source(.        
+0001e1a0: 2020 2020 2020 2020 2020 2020 6d65 7461              meta
+0001e1b0: 6461 7461 3d6d 6c72 756e 2e63 6f6d 6d6f  data=mlrun.commo
+0001e1c0: 6e2e 7363 6865 6d61 732e 4875 624f 626a  n.schemas.HubObj
+0001e1d0: 6563 744d 6574 6164 6174 6128 0a20 2020  ectMetadata(.   
+0001e1e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e1f0: 2020 2020 206e 616d 653d 2270 7269 7622       name="priv"
+0001e200: 2c20 6465 7363 7269 7074 696f 6e3d 2261  , description="a
+0001e210: 2070 7269 7661 7465 2073 6f75 7263 6522   private source"
+0001e220: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001e230: 2020 2020 2029 2c0a 2020 2020 2020 2020       ),.        
+0001e240: 2020 2020 2020 2020 2020 2020 7370 6563              spec
+0001e250: 3d6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  =mlrun.common.sc
+0001e260: 6865 6d61 732e 4875 6253 6f75 7263 6553  hemas.HubSourceS
+0001e270: 7065 6328 7061 7468 3d22 2f6c 6f63 616c  pec(path="/local
+0001e280: 2f70 6174 682f 746f 2f73 6f75 7263 6522  /path/to/source"
+0001e290: 2c20 6368 616e 6e65 6c3d 2264 6576 656c  , channel="devel
+0001e2a0: 6f70 6d65 6e74 2229 0a20 2020 2020 2020  opment").       
+0001e2b0: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001e2c0: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e2d0: 2020 2020 2064 622e 6372 6561 7465 5f68       db.create_h
+0001e2e0: 7562 5f73 6f75 7263 6528 7072 6976 6174  ub_source(privat
+0001e2f0: 655f 736f 7572 6365 290a 0a20 2020 2020  e_source)..     
+0001e300: 2020 2020 2020 2023 2041 6464 2061 6e6f         # Add ano
+0001e310: 7468 6572 2073 6f75 7263 6520 6173 2031  ther source as 1
+0001e320: 7374 2069 6e20 7468 6520 6c69 7374 202d  st in the list -
+0001e330: 2077 696c 6c20 7075 7368 2070 7265 7669   will push previ
+0001e340: 6f75 7320 6f6e 6520 746f 2062 6520 2332  ous one to be #2
+0001e350: 0a20 2020 2020 2020 2020 2020 2061 6e6f  .            ano
+0001e360: 7468 6572 5f73 6f75 7263 6520 3d20 6d6c  ther_source = ml
+0001e370: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001e380: 6173 2e49 6e64 6578 6564 4875 6253 6f75  as.IndexedHubSou
+0001e390: 7263 6528 0a20 2020 2020 2020 2020 2020  rce(.           
+0001e3a0: 2020 2020 206f 7264 6572 3d31 2c0a 2020       order=1,.  
+0001e3b0: 2020 2020 2020 2020 2020 2020 2020 736f                so
+0001e3c0: 7572 6365 3d6d 6c72 756e 2e63 6f6d 6d6f  urce=mlrun.commo
+0001e3d0: 6e2e 7363 6865 6d61 732e 4875 6253 6f75  n.schemas.HubSou
+0001e3e0: 7263 6528 0a20 2020 2020 2020 2020 2020  rce(.           
+0001e3f0: 2020 2020 2020 2020 206d 6574 6164 6174           metadat
+0001e400: 613d 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  a=mlrun.common.s
+0001e410: 6368 656d 6173 2e48 7562 4f62 6a65 6374  chemas.HubObject
+0001e420: 4d65 7461 6461 7461 280a 2020 2020 2020  Metadata(.      
+0001e430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e440: 2020 6e61 6d65 3d22 7072 6976 2d32 222c    name="priv-2",
+0001e450: 2064 6573 6372 6970 7469 6f6e 3d22 616e   description="an
+0001e460: 6f74 6865 7220 736f 7572 6365 220a 2020  other source".  
+0001e470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e480: 2020 292c 0a20 2020 2020 2020 2020 2020    ),.           
+0001e490: 2020 2020 2020 2020 2073 7065 633d 6d6c           spec=ml
+0001e4a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001e4b0: 6173 2e48 7562 536f 7572 6365 5370 6563  as.HubSourceSpec
+0001e4c0: 280a 2020 2020 2020 2020 2020 2020 2020  (.              
+0001e4d0: 2020 2020 2020 2020 2020 7061 7468 3d22            path="
+0001e4e0: 2f6c 6f63 616c 2f70 6174 682f 746f 2f73  /local/path/to/s
+0001e4f0: 6f75 7263 652f 3222 2c0a 2020 2020 2020  ource/2",.      
+0001e500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e510: 2020 6368 616e 6e65 6c3d 2264 6576 656c    channel="devel
+0001e520: 6f70 6d65 6e74 222c 0a20 2020 2020 2020  opment",.       
+0001e530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001e540: 2063 7265 6465 6e74 6961 6c73 3d7b 2e2e   credentials={..
+0001e550: 2e7d 0a20 2020 2020 2020 2020 2020 2020  .}.             
+0001e560: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e570: 2020 2020 2020 2020 2029 0a20 2020 2020           ).     
+0001e580: 2020 2020 2020 2029 0a20 2020 2020 2020         ).       
+0001e590: 2020 2020 2064 622e 6372 6561 7465 5f68       db.create_h
+0001e5a0: 7562 5f73 6f75 7263 6528 616e 6f74 6865  ub_source(anothe
+0001e5b0: 725f 736f 7572 6365 290a 0a20 2020 2020  r_source)..     
+0001e5c0: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
+0001e5d0: 3a20 5468 6520 736f 7572 6365 2061 6e64  : The source and
+0001e5e0: 2069 7473 206f 7264 6572 2c20 6f66 2074   its order, of t
+0001e5f0: 7970 650a 2020 2020 2020 2020 2020 2020  ype.            
+0001e600: 3a70 793a 636c 6173 733a 607e 6d6c 7275  :py:class:`~mlru
+0001e610: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
+0001e620: 2e68 7562 2e49 6e64 6578 6564 4875 6253  .hub.IndexedHubS
+0001e630: 6f75 7263 6560 2c20 6f72 2069 6e20 6469  ource`, or in di
+0001e640: 6374 696f 6e61 7279 2066 6f72 6d2e 0a20  ctionary form.. 
+0001e650: 2020 2020 2020 203a 7265 7475 726e 733a         :returns:
+0001e660: 2054 6865 2073 6f75 7263 6520 6f62 6a65   The source obje
+0001e670: 6374 2061 7320 696e 7365 7274 6564 2069  ct as inserted i
+0001e680: 6e74 6f20 7468 6520 6461 7461 6261 7365  nto the database
+0001e690: 2c20 7769 7468 2063 7265 6465 6e74 6961  , with credentia
+0001e6a0: 6c73 2073 7472 6970 7065 642e 0a20 2020  ls stripped..   
+0001e6b0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e6c0: 2070 6174 6820 3d20 2268 7562 2f73 6f75   path = "hub/sou
+0001e6d0: 7263 6573 220a 2020 2020 2020 2020 6966  rces".        if
+0001e6e0: 2069 7369 6e73 7461 6e63 6528 736f 7572   isinstance(sour
+0001e6f0: 6365 2c20 6d6c 7275 6e2e 636f 6d6d 6f6e  ce, mlrun.common
+0001e700: 2e73 6368 656d 6173 2e49 6e64 6578 6564  .schemas.Indexed
+0001e710: 4875 6253 6f75 7263 6529 3a0a 2020 2020  HubSource):.    
+0001e720: 2020 2020 2020 2020 736f 7572 6365 203d          source =
+0001e730: 2073 6f75 7263 652e 6469 6374 2829 0a20   source.dict(). 
+0001e740: 2020 2020 2020 2072 6573 706f 6e73 6520         response 
+0001e750: 3d20 7365 6c66 2e61 7069 5f63 616c 6c28  = self.api_call(
+0001e760: 6d65 7468 6f64 3d22 504f 5354 222c 2070  method="POST", p
+0001e770: 6174 683d 7061 7468 2c20 6a73 6f6e 3d73  ath=path, json=s
+0001e780: 6f75 7263 6529 0a20 2020 2020 2020 2072  ource).        r
+0001e790: 6574 7572 6e20 6d6c 7275 6e2e 636f 6d6d  eturn mlrun.comm
+0001e7a0: 6f6e 2e73 6368 656d 6173 2e49 6e64 6578  on.schemas.Index
+0001e7b0: 6564 4875 6253 6f75 7263 6528 2a2a 7265  edHubSource(**re
+0001e7c0: 7370 6f6e 7365 2e6a 736f 6e28 2929 0a0a  sponse.json())..
+0001e7d0: 2020 2020 6465 6620 7374 6f72 655f 6875      def store_hu
+0001e7e0: 625f 736f 7572 6365 280a 2020 2020 2020  b_source(.      
+0001e7f0: 2020 7365 6c66 2c0a 2020 2020 2020 2020    self,.        
+0001e800: 736f 7572 6365 5f6e 616d 653a 2073 7472  source_name: str
+0001e810: 2c0a 2020 2020 2020 2020 736f 7572 6365  ,.        source
+0001e820: 3a20 556e 696f 6e5b 6469 6374 2c20 6d6c  : Union[dict, ml
+0001e830: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+0001e840: 6173 2e49 6e64 6578 6564 4875 6253 6f75  as.IndexedHubSou
+0001e850: 7263 655d 2c0a 2020 2020 293a 0a20 2020  rce],.    ):.   
+0001e860: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001e870: 2043 7265 6174 6520 6f72 2072 6570 6c61   Create or repla
+0001e880: 6365 2061 2068 7562 2073 6f75 7263 652e  ce a hub source.
+0001e890: 0a20 2020 2020 2020 2046 6f72 2061 6e20  .        For an 
+0001e8a0: 6578 616d 706c 6520 6f66 2074 6865 2073  example of the s
+0001e8b0: 6f75 7263 6520 666f 726d 6174 2061 6e64  ource format and
+0001e8c0: 2065 7870 6c61 6e61 7469 6f6e 206f 6620   explanation of 
+0001e8d0: 7468 6520 736f 7572 6365 206f 7264 6572  the source order
+0001e8e0: 206c 6f67 6963 2c0a 2020 2020 2020 2020   logic,.        
+0001e8f0: 706c 6561 7365 2073 6565 203a 7079 3a66  please see :py:f
+0001e900: 756e 633a 607e 6372 6561 7465 5f68 7562  unc:`~create_hub
+0001e910: 5f73 6f75 7263 6560 2e20 5468 6973 206d  _source`. This m
+0001e920: 6574 686f 6420 6361 6e20 6265 2075 7365  ethod can be use
+0001e930: 6420 746f 206d 6f64 6966 7920 7468 6520  d to modify the 
+0001e940: 736f 7572 6365 2069 7473 656c 6620 6f72  source itself or
+0001e950: 2069 7473 0a20 2020 2020 2020 206f 7264   its.        ord
+0001e960: 6572 2069 6e20 7468 6520 6c69 7374 206f  er in the list o
+0001e970: 6620 736f 7572 6365 732e 0a0a 2020 2020  f sources...    
+0001e980: 2020 2020 3a70 6172 616d 2073 6f75 7263      :param sourc
+0001e990: 655f 6e61 6d65 3a20 4e61 6d65 206f 6620  e_name: Name of 
+0001e9a0: 7468 6520 736f 7572 6365 206f 626a 6563  the source objec
+0001e9b0: 7420 746f 206d 6f64 6966 792f 6372 6561  t to modify/crea
+0001e9c0: 7465 2e20 4974 206d 7573 7420 6d61 7463  te. It must matc
+0001e9d0: 6820 7468 6520 6060 736f 7572 6365 2e6d  h the ``source.m
+0001e9e0: 6574 6164 6174 612e 6e61 6d65 6060 0a20  etadata.name``. 
+0001e9f0: 2020 2020 2020 2020 2020 2070 6172 616d             param
+0001ea00: 6574 6572 2069 6e20 7468 6520 736f 7572  eter in the sour
+0001ea10: 6365 2069 7473 656c 662e 0a20 2020 2020  ce itself..     
+0001ea20: 2020 203a 7061 7261 6d20 736f 7572 6365     :param source
+0001ea30: 3a20 536f 7572 6365 206f 626a 6563 7420  : Source object 
+0001ea40: 746f 2073 746f 7265 2069 6e20 7468 6520  to store in the 
+0001ea50: 6461 7461 6261 7365 2e0a 2020 2020 2020  database..      
+0001ea60: 2020 3a72 6574 7572 6e73 3a20 5468 6520    :returns: The 
+0001ea70: 736f 7572 6365 206f 626a 6563 7420 6173  source object as
+0001ea80: 2073 746f 7265 6420 696e 2074 6865 2044   stored in the D
+0001ea90: 422e 0a20 2020 2020 2020 2022 2222 0a20  B..        """. 
+0001eaa0: 2020 2020 2020 2070 6174 6820 3d20 6622         path = f"
+0001eab0: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
+0001eac0: 7263 655f 6e61 6d65 7d22 0a20 2020 2020  rce_name}".     
+0001ead0: 2020 2069 6620 6973 696e 7374 616e 6365     if isinstance
+0001eae0: 2873 6f75 7263 652c 206d 6c72 756e 2e63  (source, mlrun.c
+0001eaf0: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 496e  ommon.schemas.In
+0001eb00: 6465 7865 6448 7562 536f 7572 6365 293a  dexedHubSource):
+0001eb10: 0a20 2020 2020 2020 2020 2020 2073 6f75  .            sou
+0001eb20: 7263 6520 3d20 736f 7572 6365 2e64 6963  rce = source.dic
+0001eb30: 7428 290a 0a20 2020 2020 2020 2072 6573  t()..        res
+0001eb40: 706f 6e73 6520 3d20 7365 6c66 2e61 7069  ponse = self.api
+0001eb50: 5f63 616c 6c28 6d65 7468 6f64 3d22 5055  _call(method="PU
+0001eb60: 5422 2c20 7061 7468 3d70 6174 682c 206a  T", path=path, j
+0001eb70: 736f 6e3d 736f 7572 6365 290a 2020 2020  son=source).    
+0001eb80: 2020 2020 7265 7475 726e 206d 6c72 756e      return mlrun
+0001eb90: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0001eba0: 496e 6465 7865 6448 7562 536f 7572 6365  IndexedHubSource
+0001ebb0: 282a 2a72 6573 706f 6e73 652e 6a73 6f6e  (**response.json
+0001ebc0: 2829 290a 0a20 2020 2064 6566 206c 6973  ())..    def lis
+0001ebd0: 745f 6875 625f 736f 7572 6365 7328 7365  t_hub_sources(se
+0001ebe0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
+0001ebf0: 0a20 2020 2020 2020 204c 6973 7420 6875  .        List hu
+0001ec00: 6220 736f 7572 6365 7320 696e 2074 6865  b sources in the
+0001ec10: 204d 4c52 756e 2044 422e 0a20 2020 2020   MLRun DB..     
+0001ec20: 2020 2022 2222 0a20 2020 2020 2020 2070     """.        p
+0001ec30: 6174 6820 3d20 2268 7562 2f73 6f75 7263  ath = "hub/sourc
+0001ec40: 6573 220a 2020 2020 2020 2020 7265 7370  es".        resp
+0001ec50: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
+0001ec60: 6361 6c6c 286d 6574 686f 643d 2247 4554  call(method="GET
+0001ec70: 222c 2070 6174 683d 7061 7468 292e 6a73  ", path=path).js
+0001ec80: 6f6e 2829 0a20 2020 2020 2020 2072 6573  on().        res
+0001ec90: 756c 7473 203d 205b 5d0a 2020 2020 2020  ults = [].      
+0001eca0: 2020 666f 7220 6974 656d 2069 6e20 7265    for item in re
+0001ecb0: 7370 6f6e 7365 3a0a 2020 2020 2020 2020  sponse:.        
+0001ecc0: 2020 2020 7265 7375 6c74 732e 6170 7065      results.appe
+0001ecd0: 6e64 286d 6c72 756e 2e63 6f6d 6d6f 6e2e  nd(mlrun.common.
+0001ece0: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
+0001ecf0: 7562 536f 7572 6365 282a 2a69 7465 6d29  ubSource(**item)
+0001ed00: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+0001ed10: 2072 6573 756c 7473 0a0a 2020 2020 6465   results..    de
+0001ed20: 6620 6765 745f 6875 625f 736f 7572 6365  f get_hub_source
+0001ed30: 2873 656c 662c 2073 6f75 7263 655f 6e61  (self, source_na
+0001ed40: 6d65 3a20 7374 7229 3a0a 2020 2020 2020  me: str):.      
+0001ed50: 2020 2222 220a 2020 2020 2020 2020 5265    """.        Re
+0001ed60: 7472 6965 7665 2061 2068 7562 2073 6f75  trieve a hub sou
+0001ed70: 7263 6520 6672 6f6d 2074 6865 2044 422e  rce from the DB.
+0001ed80: 0a0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+0001ed90: 2073 6f75 7263 655f 6e61 6d65 3a20 4e61   source_name: Na
+0001eda0: 6d65 206f 6620 7468 6520 6875 6220 736f  me of the hub so
+0001edb0: 7572 6365 2074 6f20 7265 7472 6965 7665  urce to retrieve
+0001edc0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001edd0: 2020 2020 2020 7061 7468 203d 2066 2268        path = f"h
+0001ede0: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
+0001edf0: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
+0001ee00: 2020 7265 7370 6f6e 7365 203d 2073 656c    response = sel
+0001ee10: 662e 6170 695f 6361 6c6c 286d 6574 686f  f.api_call(metho
+0001ee20: 643d 2247 4554 222c 2070 6174 683d 7061  d="GET", path=pa
+0001ee30: 7468 290a 2020 2020 2020 2020 7265 7475  th).        retu
+0001ee40: 726e 206d 6c72 756e 2e63 6f6d 6d6f 6e2e  rn mlrun.common.
+0001ee50: 7363 6865 6d61 732e 496e 6465 7865 6448  schemas.IndexedH
+0001ee60: 7562 536f 7572 6365 282a 2a72 6573 706f  ubSource(**respo
+0001ee70: 6e73 652e 6a73 6f6e 2829 290a 0a20 2020  nse.json())..   
+0001ee80: 2064 6566 2064 656c 6574 655f 6875 625f   def delete_hub_
+0001ee90: 736f 7572 6365 2873 656c 662c 2073 6f75  source(self, sou
+0001eea0: 7263 655f 6e61 6d65 3a20 7374 7229 3a0a  rce_name: str):.
+0001eeb0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001eec0: 2020 2020 4465 6c65 7465 2061 2068 7562      Delete a hub
+0001eed0: 2073 6f75 7263 6520 6672 6f6d 2074 6865   source from the
+0001eee0: 2044 422e 0a20 2020 2020 2020 2054 6865   DB..        The
+0001eef0: 2073 6f75 7263 6520 7769 6c6c 2062 6520   source will be 
+0001ef00: 6465 6c65 7465 6420 6672 6f6d 2074 6865  deleted from the
+0001ef10: 206c 6973 742c 2061 6e64 2061 6e79 2066   list, and any f
+0001ef20: 6f6c 6c6f 7769 6e67 2073 6f75 7263 6573  ollowing sources
+0001ef30: 2077 696c 6c20 6265 2070 726f 6d6f 7465   will be promote
+0001ef40: 6420 2d20 666f 7220 6578 616d 706c 652c  d - for example,
+0001ef50: 2069 6620 7468 650a 2020 2020 2020 2020   if the.        
+0001ef60: 3173 7420 736f 7572 6365 2069 7320 6465  1st source is de
+0001ef70: 6c65 7465 642c 2074 6865 2032 6e64 2073  leted, the 2nd s
+0001ef80: 6f75 7263 6520 7769 6c6c 2062 6563 6f6d  ource will becom
+0001ef90: 6520 2331 2069 6e20 7468 6520 6c69 7374  e #1 in the list
+0001efa0: 2e0a 2020 2020 2020 2020 5468 6520 676c  ..        The gl
+0001efb0: 6f62 616c 2068 7562 2073 6f75 7263 6520  obal hub source 
+0001efc0: 6361 6e6e 6f74 2062 6520 6465 6c65 7465  cannot be delete
+0001efd0: 642e 0a0a 2020 2020 2020 2020 3a70 6172  d...        :par
+0001efe0: 616d 2073 6f75 7263 655f 6e61 6d65 3a20  am source_name: 
+0001eff0: 4e61 6d65 206f 6620 7468 6520 6875 6220  Name of the hub 
+0001f000: 736f 7572 6365 2074 6f20 6465 6c65 7465  source to delete
+0001f010: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001f020: 2020 2020 2020 7061 7468 203d 2066 2268        path = f"h
+0001f030: 7562 2f73 6f75 7263 6573 2f7b 736f 7572  ub/sources/{sour
+0001f040: 6365 5f6e 616d 657d 220a 2020 2020 2020  ce_name}".      
+0001f050: 2020 7365 6c66 2e61 7069 5f63 616c 6c28    self.api_call(
+0001f060: 6d65 7468 6f64 3d22 4445 4c45 5445 222c  method="DELETE",
+0001f070: 2070 6174 683d 7061 7468 290a 0a20 2020   path=path)..   
+0001f080: 2064 6566 2067 6574 5f68 7562 5f63 6174   def get_hub_cat
+0001f090: 616c 6f67 280a 2020 2020 2020 2020 7365  alog(.        se
+0001f0a0: 6c66 2c0a 2020 2020 2020 2020 736f 7572  lf,.        sour
+0001f0b0: 6365 5f6e 616d 653a 2073 7472 2c0a 2020  ce_name: str,.  
+0001f0c0: 2020 2020 2020 7665 7273 696f 6e3a 2073        version: s
+0001f0d0: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+0001f0e0: 2020 2074 6167 3a20 7374 7220 3d20 4e6f     tag: str = No
+0001f0f0: 6e65 2c0a 2020 2020 2020 2020 666f 7263  ne,.        forc
+0001f100: 655f 7265 6672 6573 683a 2062 6f6f 6c20  e_refresh: bool 
+0001f110: 3d20 4661 6c73 652c 0a20 2020 2029 3a0a  = False,.    ):.
+0001f120: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
+0001f130: 2020 2020 5265 7472 6965 7665 2074 6865      Retrieve the
+0001f140: 2069 7465 6d20 6361 7461 6c6f 6720 666f   item catalog fo
+0001f150: 7220 6120 7370 6563 6966 6965 6420 6875  r a specified hu
+0001f160: 6220 736f 7572 6365 2e0a 2020 2020 2020  b source..      
+0001f170: 2020 5468 6520 6c69 7374 206f 6620 6974    The list of it
+0001f180: 656d 7320 6361 6e20 6265 2066 696c 7465  ems can be filte
+0001f190: 7265 6420 6163 636f 7264 696e 6720 746f  red according to
+0001f1a0: 2076 6172 696f 7573 2066 696c 7465 7273   various filters
+0001f1b0: 2c20 7573 696e 6720 6974 656d 2773 206d  , using item's m
+0001f1c0: 6574 6164 6174 6120 746f 2066 696c 7465  etadata to filte
+0001f1d0: 722e 0a0a 2020 2020 2020 2020 3a70 6172  r...        :par
+0001f1e0: 616d 2073 6f75 7263 655f 6e61 6d65 3a20  am source_name: 
+0001f1f0: 4e61 6d65 206f 6620 7468 6520 736f 7572  Name of the sour
 0001f200: 6365 2e0a 2020 2020 2020 2020 3a70 6172  ce..        :par
-0001f210: 616d 2069 7465 6d5f 6e61 6d65 3a20 4e61  am item_name: Na
-0001f220: 6d65 206f 6620 7468 6520 6974 656d 2074  me of the item t
-0001f230: 6f20 7265 7472 6965 7665 2c20 6173 2069  o retrieve, as i
-0001f240: 7420 6170 7065 6172 7320 696e 2074 6865  t appears in the
-0001f250: 2063 6174 616c 6f67 2e0a 2020 2020 2020   catalog..      
-0001f260: 2020 3a70 6172 616d 2076 6572 7369 6f6e    :param version
-0001f270: 3a20 4765 7420 6120 7370 6563 6966 6963  : Get a specific
-0001f280: 2076 6572 7369 6f6e 206f 6620 7468 6520   version of the 
-0001f290: 6974 656d 2e20 4465 6661 756c 7420 6973  item. Default is
-0001f2a0: 2060 604e 6f6e 6560 602e 0a20 2020 2020   ``None``..     
-0001f2b0: 2020 203a 7061 7261 6d20 7461 673a 2047     :param tag: G
-0001f2c0: 6574 2061 2073 7065 6369 6669 6320 7665  et a specific ve
-0001f2d0: 7273 696f 6e20 6f66 2074 6865 2069 7465  rsion of the ite
-0001f2e0: 6d20 6964 656e 7469 6669 6564 2062 7920  m identified by 
-0001f2f0: 7461 672e 2044 6566 6175 6c74 2069 7320  tag. Default is 
-0001f300: 6060 6c61 7465 7374 6060 2e0a 2020 2020  ``latest``..    
-0001f310: 2020 2020 3a70 6172 616d 2066 6f72 6365      :param force
-0001f320: 5f72 6566 7265 7368 3a20 4d61 6b65 2074  _refresh: Make t
-0001f330: 6865 2073 6572 7665 7220 6665 7463 6820  he server fetch 
-0001f340: 7468 6520 696e 666f 726d 6174 696f 6e20  the information 
-0001f350: 6672 6f6d 2074 6865 2061 6374 7561 6c20  from the actual 
-0001f360: 6875 620a 2020 2020 2020 2020 2020 2020  hub.            
-0001f370: 736f 7572 6365 2c20 7261 7468 6572 2074  source, rather t
-0001f380: 6861 6e0a 2020 2020 2020 2020 2020 2020  han.            
-0001f390: 7265 6c79 206f 6e20 6361 6368 6564 2069  rely on cached i
-0001f3a0: 6e66 6f72 6d61 7469 6f6e 2e20 4465 6661  nformation. Defa
-0001f3b0: 756c 7420 6973 2060 6046 616c 7365 6060  ult is ``False``
-0001f3c0: 2e0a 2020 2020 2020 2020 3a72 6574 7572  ..        :retur
-0001f3d0: 6e73 3a20 3a70 793a 636c 6173 733a 607e  ns: :py:class:`~
-0001f3e0: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
-0001f3f0: 656d 6173 2e68 7562 2e48 7562 4974 656d  emas.hub.HubItem
-0001f400: 602e 0a20 2020 2020 2020 2022 2222 0a20  `..        """. 
-0001f410: 2020 2020 2020 2070 6174 6820 3d20 2866         path = (f
-0001f420: 2268 7562 2f73 6f75 7263 6573 2f7b 736f  "hub/sources/{so
-0001f430: 7572 6365 5f6e 616d 657d 2f69 7465 6d73  urce_name}/items
-0001f440: 2f7b 6974 656d 5f6e 616d 657d 222c 290a  /{item_name}",).
-0001f450: 2020 2020 2020 2020 7061 7261 6d73 203d          params =
-0001f460: 207b 0a20 2020 2020 2020 2020 2020 2022   {.            "
-0001f470: 7665 7273 696f 6e22 3a20 7665 7273 696f  version": versio
-0001f480: 6e2c 0a20 2020 2020 2020 2020 2020 2022  n,.            "
-0001f490: 7461 6722 3a20 7461 672c 0a20 2020 2020  tag": tag,.     
-0001f4a0: 2020 2020 2020 2022 666f 7263 652d 7265         "force-re
-0001f4b0: 6672 6573 6822 3a20 666f 7263 655f 7265  fresh": force_re
-0001f4c0: 6672 6573 682c 0a20 2020 2020 2020 207d  fresh,.        }
-0001f4d0: 0a20 2020 2020 2020 2072 6573 706f 6e73  .        respons
-0001f4e0: 6520 3d20 7365 6c66 2e61 7069 5f63 616c  e = self.api_cal
-0001f4f0: 6c28 6d65 7468 6f64 3d22 4745 5422 2c20  l(method="GET", 
-0001f500: 7061 7468 3d70 6174 682c 2070 6172 616d  path=path, param
-0001f510: 733d 7061 7261 6d73 290a 2020 2020 2020  s=params).      
-0001f520: 2020 7265 7475 726e 206d 6c72 756e 2e63    return mlrun.c
-0001f530: 6f6d 6d6f 6e2e 7363 6865 6d61 732e 4875  ommon.schemas.Hu
-0001f540: 6249 7465 6d28 2a2a 7265 7370 6f6e 7365  bItem(**response
-0001f550: 2e6a 736f 6e28 2929 0a0a 2020 2020 6465  .json())..    de
-0001f560: 6620 6765 745f 6875 625f 6173 7365 7428  f get_hub_asset(
-0001f570: 0a20 2020 2020 2020 2073 656c 662c 0a20  .        self,. 
-0001f580: 2020 2020 2020 2073 6f75 7263 655f 6e61         source_na
-0001f590: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
-0001f5a0: 2069 7465 6d5f 6e61 6d65 3a20 7374 722c   item_name: str,
-0001f5b0: 0a20 2020 2020 2020 2061 7373 6574 5f6e  .        asset_n
-0001f5c0: 616d 653a 2073 7472 2c0a 2020 2020 2020  ame: str,.      
-0001f5d0: 2020 7665 7273 696f 6e3a 2073 7472 203d    version: str =
-0001f5e0: 204e 6f6e 652c 0a20 2020 2020 2020 2074   None,.        t
-0001f5f0: 6167 3a20 7374 7220 3d20 226c 6174 6573  ag: str = "lates
-0001f600: 7422 2c0a 2020 2020 293a 0a20 2020 2020  t",.    ):.     
-0001f610: 2020 2022 2222 0a20 2020 2020 2020 2047     """.        G
-0001f620: 6574 2068 7562 2061 7373 6574 2066 726f  et hub asset fro
-0001f630: 6d20 6974 656d 2e0a 0a20 2020 2020 2020  m item...       
-0001f640: 203a 7061 7261 6d20 736f 7572 6365 5f6e   :param source_n
-0001f650: 616d 653a 204e 616d 6520 6f66 2073 6f75  ame: Name of sou
-0001f660: 7263 652e 0a20 2020 2020 2020 203a 7061  rce..        :pa
-0001f670: 7261 6d20 6974 656d 5f6e 616d 653a 2020  ram item_name:  
-0001f680: 204e 616d 6520 6f66 2074 6865 2069 7465   Name of the ite
-0001f690: 6d20 7768 6963 6820 686f 6c64 7320 7468  m which holds th
-0001f6a0: 6520 6173 7365 742e 0a20 2020 2020 2020  e asset..       
-0001f6b0: 203a 7061 7261 6d20 6173 7365 745f 6e61   :param asset_na
-0001f6c0: 6d65 3a20 204e 616d 6520 6f66 2074 6865  me:  Name of the
-0001f6d0: 2061 7373 6574 2074 6f20 7265 7472 6965   asset to retrie
-0001f6e0: 7665 2e0a 2020 2020 2020 2020 3a70 6172  ve..        :par
-0001f6f0: 616d 2076 6572 7369 6f6e 3a20 4765 7420  am version: Get 
-0001f700: 6120 7370 6563 6966 6963 2076 6572 7369  a specific versi
-0001f710: 6f6e 206f 6620 7468 6520 6974 656d 2e20  on of the item. 
-0001f720: 4465 6661 756c 7420 6973 2060 604e 6f6e  Default is ``Non
-0001f730: 6560 602e 0a20 2020 2020 2020 203a 7061  e``..        :pa
-0001f740: 7261 6d20 7461 673a 2047 6574 2061 2073  ram tag: Get a s
-0001f750: 7065 6369 6669 6320 7665 7273 696f 6e20  pecific version 
-0001f760: 6f66 2074 6865 2069 7465 6d20 6964 656e  of the item iden
-0001f770: 7469 6669 6564 2062 7920 7461 672e 2044  tified by tag. D
-0001f780: 6566 6175 6c74 2069 7320 6060 6c61 7465  efault is ``late
-0001f790: 7374 6060 2e0a 0a20 2020 2020 2020 203a  st``...        :
-0001f7a0: 7265 7475 726e 3a20 6874 7470 2072 6573  return: http res
-0001f7b0: 706f 6e73 6520 7769 7468 2074 6865 2061  ponse with the a
-0001f7c0: 7373 6574 2069 6e20 7468 6520 636f 6e74  sset in the cont
-0001f7d0: 656e 7420 6174 7472 6962 7574 650a 2020  ent attribute.  
-0001f7e0: 2020 2020 2020 2222 220a 2020 2020 2020        """.      
-0001f7f0: 2020 7061 7468 203d 2028 6622 6875 622f    path = (f"hub/
-0001f800: 736f 7572 6365 732f 7b73 6f75 7263 655f  sources/{source_
-0001f810: 6e61 6d65 7d2f 6974 656d 732f 7b69 7465  name}/items/{ite
-0001f820: 6d5f 6e61 6d65 7d2f 6173 7365 7473 2f7b  m_name}/assets/{
-0001f830: 6173 7365 745f 6e61 6d65 7d22 2c29 0a20  asset_name}",). 
-0001f840: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
-0001f850: 7b0a 2020 2020 2020 2020 2020 2020 2276  {.            "v
-0001f860: 6572 7369 6f6e 223a 2076 6572 7369 6f6e  ersion": version
-0001f870: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
-0001f880: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
-0001f890: 2020 7d0a 2020 2020 2020 2020 7265 7370    }.        resp
-0001f8a0: 6f6e 7365 203d 2073 656c 662e 6170 695f  onse = self.api_
-0001f8b0: 6361 6c6c 286d 6574 686f 643d 2247 4554  call(method="GET
-0001f8c0: 222c 2070 6174 683d 7061 7468 2c20 7061  ", path=path, pa
-0001f8d0: 7261 6d73 3d70 6172 616d 7329 0a20 2020  rams=params).   
-0001f8e0: 2020 2020 2072 6574 7572 6e20 7265 7370       return resp
-0001f8f0: 6f6e 7365 0a0a 2020 2020 6465 6620 7665  onse..    def ve
-0001f900: 7269 6679 5f61 7574 686f 7269 7a61 7469  rify_authorizati
-0001f910: 6f6e 280a 2020 2020 2020 2020 7365 6c66  on(.        self
-0001f920: 2c0a 2020 2020 2020 2020 6175 7468 6f72  ,.        author
-0001f930: 697a 6174 696f 6e5f 7665 7269 6669 6361  ization_verifica
-0001f940: 7469 6f6e 5f69 6e70 7574 3a20 6d6c 7275  tion_input: mlru
-0001f950: 6e2e 636f 6d6d 6f6e 2e73 6368 656d 6173  n.common.schemas
-0001f960: 2e41 7574 686f 7269 7a61 7469 6f6e 5665  .AuthorizationVe
-0001f970: 7269 6669 6361 7469 6f6e 496e 7075 742c  rificationInput,
-0001f980: 0a20 2020 2029 3a0a 2020 2020 2020 2020  .    ):.        
-0001f990: 2222 2256 6572 6966 6965 7320 6175 7468  """Verifies auth
-0001f9a0: 6f72 697a 6174 696f 6e20 666f 7220 7468  orization for th
-0001f9b0: 6520 7072 6f76 6964 6564 2061 6374 696f  e provided actio
-0001f9c0: 6e20 6f6e 2074 6865 2070 726f 7669 6465  n on the provide
-0001f9d0: 6420 7265 736f 7572 6365 2e0a 0a20 2020  d resource...   
-0001f9e0: 2020 2020 203a 7061 7261 6d20 6175 7468       :param auth
-0001f9f0: 6f72 697a 6174 696f 6e5f 7665 7269 6669  orization_verifi
-0001fa00: 6361 7469 6f6e 5f69 6e70 7574 3a20 496e  cation_input: In
-0001fa10: 7374 616e 6365 206f 660a 2020 2020 2020  stance of.      
-0001fa20: 2020 2020 2020 3a70 793a 636c 6173 733a        :py:class:
-0001fa30: 607e 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73  `~mlrun.common.s
-0001fa40: 6368 656d 6173 2e41 7574 686f 7269 7a61  chemas.Authoriza
-0001fa50: 7469 6f6e 5665 7269 6669 6361 7469 6f6e  tionVerification
-0001fa60: 496e 7075 7460 2074 6861 7420 696e 636c  Input` that incl
-0001fa70: 7564 6573 2061 6c6c 2074 6865 206e 6565  udes all the nee
-0001fa80: 6465 6420 7061 7261 6d65 7465 7273 2066  ded parameters f
-0001fa90: 6f72 0a20 2020 2020 2020 2020 2020 2074  or.            t
-0001faa0: 6865 2061 7574 6820 7665 7269 6669 6361  he auth verifica
-0001fab0: 7469 6f6e 0a20 2020 2020 2020 2022 2222  tion.        """
-0001fac0: 0a20 2020 2020 2020 2065 7272 6f72 5f6d  .        error_m
-0001fad0: 6573 7361 6765 203d 2022 4175 7468 6f72  essage = "Author
-0001fae0: 697a 6174 696f 6e20 6368 6563 6b20 6661  ization check fa
-0001faf0: 696c 6564 220a 2020 2020 2020 2020 7365  iled".        se
-0001fb00: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
-0001fb10: 2020 2020 2020 2020 2022 504f 5354 222c           "POST",
-0001fb20: 0a20 2020 2020 2020 2020 2020 2022 6175  .            "au
-0001fb30: 7468 6f72 697a 6174 696f 6e2f 7665 7269  thorization/veri
-0001fb40: 6669 6361 7469 6f6e 7322 2c0a 2020 2020  fications",.    
-0001fb50: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
-0001fb60: 7373 6167 652c 0a20 2020 2020 2020 2020  ssage,.         
-0001fb70: 2020 2062 6f64 793d 6469 6374 5f74 6f5f     body=dict_to_
-0001fb80: 6a73 6f6e 2861 7574 686f 7269 7a61 7469  json(authorizati
-0001fb90: 6f6e 5f76 6572 6966 6963 6174 696f 6e5f  on_verification_
-0001fba0: 696e 7075 742e 6469 6374 2829 292c 0a20  input.dict()),. 
-0001fbb0: 2020 2020 2020 2029 0a0a 2020 2020 6465         )..    de
-0001fbc0: 6620 7472 6967 6765 725f 6d69 6772 6174  f trigger_migrat
-0001fbd0: 696f 6e73 2873 656c 6629 202d 3e20 4f70  ions(self) -> Op
-0001fbe0: 7469 6f6e 616c 5b6d 6c72 756e 2e63 6f6d  tional[mlrun.com
-0001fbf0: 6d6f 6e2e 7363 6865 6d61 732e 4261 636b  mon.schemas.Back
-0001fc00: 6772 6f75 6e64 5461 736b 5d3a 0a20 2020  groundTask]:.   
-0001fc10: 2020 2020 2022 2222 5472 6967 6765 7220       """Trigger 
-0001fc20: 6d69 6772 6174 696f 6e73 2028 7769 6c6c  migrations (will
-0001fc30: 2064 6f20 6e6f 7468 696e 6720 6966 206e   do nothing if n
-0001fc40: 6f20 6d69 6772 6174 696f 6e73 2061 7265  o migrations are
-0001fc50: 206e 6565 6465 6429 2061 6e64 2077 6169   needed) and wai
-0001fc60: 7420 666f 7220 7468 656d 2074 6f20 6669  t for them to fi
-0001fc70: 6e69 7368 2069 6620 6163 7475 616c 6c79  nish if actually
-0001fc80: 0a20 2020 2020 2020 2074 7269 6767 6572  .        trigger
-0001fc90: 6564 0a20 2020 2020 2020 203a 7265 7475  ed.        :retu
-0001fca0: 726e 733a 203a 7079 3a63 6c61 7373 3a60  rns: :py:class:`
-0001fcb0: 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  ~mlrun.common.sc
-0001fcc0: 6865 6d61 732e 4261 636b 6772 6f75 6e64  hemas.Background
-0001fcd0: 5461 736b 602e 0a20 2020 2020 2020 2022  Task`..        "
-0001fce0: 2222 0a20 2020 2020 2020 2072 6573 706f  "".        respo
-0001fcf0: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
-0001fd00: 616c 6c28 0a20 2020 2020 2020 2020 2020  all(.           
-0001fd10: 2022 504f 5354 222c 0a20 2020 2020 2020   "POST",.       
-0001fd20: 2020 2020 2022 6f70 6572 6174 696f 6e73       "operations
-0001fd30: 2f6d 6967 7261 7469 6f6e 7322 2c0a 2020  /migrations",.  
-0001fd40: 2020 2020 2020 2020 2020 2246 6169 6c65            "Faile
-0001fd50: 6420 7472 6967 6765 7269 6e67 206d 6967  d triggering mig
-0001fd60: 7261 7469 6f6e 7322 2c0a 2020 2020 2020  rations",.      
-0001fd70: 2020 290a 2020 2020 2020 2020 6966 2072    ).        if r
-0001fd80: 6573 706f 6e73 652e 7374 6174 7573 5f63  esponse.status_c
-0001fd90: 6f64 6520 3d3d 2068 7474 702e 4854 5450  ode == http.HTTP
-0001fda0: 5374 6174 7573 2e41 4343 4550 5445 443a  Status.ACCEPTED:
-0001fdb0: 0a20 2020 2020 2020 2020 2020 2062 6163  .            bac
-0001fdc0: 6b67 726f 756e 645f 7461 736b 203d 206d  kground_task = m
-0001fdd0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
-0001fde0: 6d61 732e 4261 636b 6772 6f75 6e64 5461  mas.BackgroundTa
-0001fdf0: 736b 282a 2a72 6573 706f 6e73 652e 6a73  sk(**response.js
-0001fe00: 6f6e 2829 290a 2020 2020 2020 2020 2020  on()).          
-0001fe10: 2020 7265 7475 726e 2073 656c 662e 5f77    return self._w
-0001fe20: 6169 745f 666f 725f 6261 636b 6772 6f75  ait_for_backgrou
-0001fe30: 6e64 5f74 6173 6b5f 746f 5f72 6561 6368  nd_task_to_reach
-0001fe40: 5f74 6572 6d69 6e61 6c5f 7374 6174 6528  _terminal_state(
-0001fe50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001fe60: 2062 6163 6b67 726f 756e 645f 7461 736b   background_task
-0001fe70: 2e6d 6574 6164 6174 612e 6e61 6d65 0a20  .metadata.name. 
-0001fe80: 2020 2020 2020 2020 2020 2029 0a20 2020             ).   
-0001fe90: 2020 2020 2072 6574 7572 6e20 4e6f 6e65       return None
-0001fea0: 0a0a 0a64 6566 205f 6173 5f6a 736f 6e28  ...def _as_json(
-0001feb0: 6f62 6a29 3a0a 2020 2020 666e 203d 2067  obj):.    fn = g
-0001fec0: 6574 6174 7472 286f 626a 2c20 2274 6f5f  etattr(obj, "to_
-0001fed0: 6a73 6f6e 222c 204e 6f6e 6529 0a20 2020  json", None).   
-0001fee0: 2069 6620 666e 3a0a 2020 2020 2020 2020   if fn:.        
-0001fef0: 7265 7475 726e 2066 6e28 290a 2020 2020  return fn().    
-0001ff00: 7265 7475 726e 2064 6963 745f 746f 5f6a  return dict_to_j
-0001ff10: 736f 6e28 6f62 6a29 0a                   son(obj).
+0001f210: 616d 2076 6572 7369 6f6e 3a20 4669 6c74  am version: Filt
+0001f220: 6572 2069 7465 6d73 2061 6363 6f72 6469  er items accordi
+0001f230: 6e67 2074 6f20 7468 6569 7220 7665 7273  ng to their vers
+0001f240: 696f 6e2e 0a20 2020 2020 2020 203a 7061  ion..        :pa
+0001f250: 7261 6d20 7461 673a 2046 696c 7465 7220  ram tag: Filter 
+0001f260: 6974 656d 7320 6261 7365 6420 6f6e 2074  items based on t
+0001f270: 6167 2e0a 2020 2020 2020 2020 3a70 6172  ag..        :par
+0001f280: 616d 2066 6f72 6365 5f72 6566 7265 7368  am force_refresh
+0001f290: 3a20 4d61 6b65 2074 6865 2073 6572 7665  : Make the serve
+0001f2a0: 7220 6665 7463 6820 7468 6520 6361 7461  r fetch the cata
+0001f2b0: 6c6f 6720 6672 6f6d 2074 6865 2061 6374  log from the act
+0001f2c0: 7561 6c20 6875 6220 736f 7572 6365 2c0a  ual hub source,.
+0001f2d0: 2020 2020 2020 2020 2020 2020 7261 7468              rath
+0001f2e0: 6572 2074 6861 6e20 7265 6c79 206f 6e20  er than rely on 
+0001f2f0: 6361 6368 6564 2069 6e66 6f72 6d61 7469  cached informati
+0001f300: 6f6e 2077 6869 6368 206d 6179 2065 7869  on which may exi
+0001f310: 7374 2066 726f 6d20 7072 6576 696f 7573  st from previous
+0001f320: 2067 6574 2072 6571 7565 7374 732e 2046   get requests. F
+0001f330: 6f72 2065 7861 6d70 6c65 2c0a 2020 2020  or example,.    
+0001f340: 2020 2020 2020 2020 6966 2074 6865 2073          if the s
+0001f350: 6f75 7263 6520 7761 7320 7265 2d62 7569  ource was re-bui
+0001f360: 6c74 2c0a 2020 2020 2020 2020 2020 2020  lt,.            
+0001f370: 7468 6973 2077 696c 6c20 6d61 6b65 2074  this will make t
+0001f380: 6865 2073 6572 7665 7220 6765 7420 7468  he server get th
+0001f390: 6520 7570 6461 7465 6420 696e 666f 726d  e updated inform
+0001f3a0: 6174 696f 6e2e 2044 6566 6175 6c74 2069  ation. Default i
+0001f3b0: 7320 6060 4661 6c73 6560 602e 0a20 2020  s ``False``..   
+0001f3c0: 2020 2020 203a 7265 7475 726e 733a 203a       :returns: :
+0001f3d0: 7079 3a63 6c61 7373 3a60 7e6d 6c72 756e  py:class:`~mlrun
+0001f3e0: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0001f3f0: 6875 622e 4875 6243 6174 616c 6f67 6020  hub.HubCatalog` 
+0001f400: 6f62 6a65 6374 2c20 7768 6963 6820 6973  object, which is
+0001f410: 2065 7373 656e 7469 616c 6c79 2061 206c   essentially a l
+0001f420: 6973 740a 2020 2020 2020 2020 2020 2020  ist.            
+0001f430: 6f66 203a 7079 3a63 6c61 7373 3a60 7e6d  of :py:class:`~m
+0001f440: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001f450: 6d61 732e 6875 622e 4875 6249 7465 6d60  mas.hub.HubItem`
+0001f460: 2065 6e74 7269 6573 2e0a 2020 2020 2020   entries..      
+0001f470: 2020 2222 220a 2020 2020 2020 2020 7061    """.        pa
+0001f480: 7468 203d 2028 6622 6875 622f 736f 7572  th = (f"hub/sour
+0001f490: 6365 732f 7b73 6f75 7263 655f 6e61 6d65  ces/{source_name
+0001f4a0: 7d2f 6974 656d 7322 2c29 0a20 2020 2020  }/items",).     
+0001f4b0: 2020 2070 6172 616d 7320 3d20 7b0a 2020     params = {.  
+0001f4c0: 2020 2020 2020 2020 2020 2276 6572 7369            "versi
+0001f4d0: 6f6e 223a 2076 6572 7369 6f6e 2c0a 2020  on": version,.  
+0001f4e0: 2020 2020 2020 2020 2020 2274 6167 223a            "tag":
+0001f4f0: 2074 6167 2c0a 2020 2020 2020 2020 2020   tag,.          
+0001f500: 2020 2266 6f72 6365 2d72 6566 7265 7368    "force-refresh
+0001f510: 223a 2066 6f72 6365 5f72 6566 7265 7368  ": force_refresh
+0001f520: 2c0a 2020 2020 2020 2020 7d0a 2020 2020  ,.        }.    
+0001f530: 2020 2020 7265 7370 6f6e 7365 203d 2073      response = s
+0001f540: 656c 662e 6170 695f 6361 6c6c 286d 6574  elf.api_call(met
+0001f550: 686f 643d 2247 4554 222c 2070 6174 683d  hod="GET", path=
+0001f560: 7061 7468 2c20 7061 7261 6d73 3d70 6172  path, params=par
+0001f570: 616d 7329 0a20 2020 2020 2020 2072 6574  ams).        ret
+0001f580: 7572 6e20 6d6c 7275 6e2e 636f 6d6d 6f6e  urn mlrun.common
+0001f590: 2e73 6368 656d 6173 2e48 7562 4361 7461  .schemas.HubCata
+0001f5a0: 6c6f 6728 2a2a 7265 7370 6f6e 7365 2e6a  log(**response.j
+0001f5b0: 736f 6e28 2929 0a0a 2020 2020 6465 6620  son())..    def 
+0001f5c0: 6765 745f 6875 625f 6974 656d 280a 2020  get_hub_item(.  
+0001f5d0: 2020 2020 2020 7365 6c66 2c0a 2020 2020        self,.    
+0001f5e0: 2020 2020 736f 7572 6365 5f6e 616d 653a      source_name:
+0001f5f0: 2073 7472 2c0a 2020 2020 2020 2020 6974   str,.        it
+0001f600: 656d 5f6e 616d 653a 2073 7472 2c0a 2020  em_name: str,.  
+0001f610: 2020 2020 2020 7665 7273 696f 6e3a 2073        version: s
+0001f620: 7472 203d 204e 6f6e 652c 0a20 2020 2020  tr = None,.     
+0001f630: 2020 2074 6167 3a20 7374 7220 3d20 226c     tag: str = "l
+0001f640: 6174 6573 7422 2c0a 2020 2020 2020 2020  atest",.        
+0001f650: 666f 7263 655f 7265 6672 6573 683a 2062  force_refresh: b
+0001f660: 6f6f 6c20 3d20 4661 6c73 652c 0a20 2020  ool = False,.   
+0001f670: 2029 3a0a 2020 2020 2020 2020 2222 220a   ):.        """.
+0001f680: 2020 2020 2020 2020 5265 7472 6965 7665          Retrieve
+0001f690: 2061 2073 7065 6369 6669 6320 6875 6220   a specific hub 
+0001f6a0: 6974 656d 2e0a 0a20 2020 2020 2020 203a  item...        :
+0001f6b0: 7061 7261 6d20 736f 7572 6365 5f6e 616d  param source_nam
+0001f6c0: 653a 204e 616d 6520 6f66 2073 6f75 7263  e: Name of sourc
+0001f6d0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001f6e0: 6d20 6974 656d 5f6e 616d 653a 204e 616d  m item_name: Nam
+0001f6f0: 6520 6f66 2074 6865 2069 7465 6d20 746f  e of the item to
+0001f700: 2072 6574 7269 6576 652c 2061 7320 6974   retrieve, as it
+0001f710: 2061 7070 6561 7273 2069 6e20 7468 6520   appears in the 
+0001f720: 6361 7461 6c6f 672e 0a20 2020 2020 2020  catalog..       
+0001f730: 203a 7061 7261 6d20 7665 7273 696f 6e3a   :param version:
+0001f740: 2047 6574 2061 2073 7065 6369 6669 6320   Get a specific 
+0001f750: 7665 7273 696f 6e20 6f66 2074 6865 2069  version of the i
+0001f760: 7465 6d2e 2044 6566 6175 6c74 2069 7320  tem. Default is 
+0001f770: 6060 4e6f 6e65 6060 2e0a 2020 2020 2020  ``None``..      
+0001f780: 2020 3a70 6172 616d 2074 6167 3a20 4765    :param tag: Ge
+0001f790: 7420 6120 7370 6563 6966 6963 2076 6572  t a specific ver
+0001f7a0: 7369 6f6e 206f 6620 7468 6520 6974 656d  sion of the item
+0001f7b0: 2069 6465 6e74 6966 6965 6420 6279 2074   identified by t
+0001f7c0: 6167 2e20 4465 6661 756c 7420 6973 2060  ag. Default is `
+0001f7d0: 606c 6174 6573 7460 602e 0a20 2020 2020  `latest``..     
+0001f7e0: 2020 203a 7061 7261 6d20 666f 7263 655f     :param force_
+0001f7f0: 7265 6672 6573 683a 204d 616b 6520 7468  refresh: Make th
+0001f800: 6520 7365 7276 6572 2066 6574 6368 2074  e server fetch t
+0001f810: 6865 2069 6e66 6f72 6d61 7469 6f6e 2066  he information f
+0001f820: 726f 6d20 7468 6520 6163 7475 616c 2068  rom the actual h
+0001f830: 7562 0a20 2020 2020 2020 2020 2020 2073  ub.            s
+0001f840: 6f75 7263 652c 2072 6174 6865 7220 7468  ource, rather th
+0001f850: 616e 0a20 2020 2020 2020 2020 2020 2072  an.            r
+0001f860: 656c 7920 6f6e 2063 6163 6865 6420 696e  ely on cached in
+0001f870: 666f 726d 6174 696f 6e2e 2044 6566 6175  formation. Defau
+0001f880: 6c74 2069 7320 6060 4661 6c73 6560 602e  lt is ``False``.
+0001f890: 0a20 2020 2020 2020 203a 7265 7475 726e  .        :return
+0001f8a0: 733a 203a 7079 3a63 6c61 7373 3a60 7e6d  s: :py:class:`~m
+0001f8b0: 6c72 756e 2e63 6f6d 6d6f 6e2e 7363 6865  lrun.common.sche
+0001f8c0: 6d61 732e 6875 622e 4875 6249 7465 6d60  mas.hub.HubItem`
+0001f8d0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
+0001f8e0: 2020 2020 2020 7061 7468 203d 2028 6622        path = (f"
+0001f8f0: 6875 622f 736f 7572 6365 732f 7b73 6f75  hub/sources/{sou
+0001f900: 7263 655f 6e61 6d65 7d2f 6974 656d 732f  rce_name}/items/
+0001f910: 7b69 7465 6d5f 6e61 6d65 7d22 2c29 0a20  {item_name}",). 
+0001f920: 2020 2020 2020 2070 6172 616d 7320 3d20         params = 
+0001f930: 7b0a 2020 2020 2020 2020 2020 2020 2276  {.            "v
+0001f940: 6572 7369 6f6e 223a 2076 6572 7369 6f6e  ersion": version
+0001f950: 2c0a 2020 2020 2020 2020 2020 2020 2274  ,.            "t
+0001f960: 6167 223a 2074 6167 2c0a 2020 2020 2020  ag": tag,.      
+0001f970: 2020 2020 2020 2266 6f72 6365 2d72 6566        "force-ref
+0001f980: 7265 7368 223a 2066 6f72 6365 5f72 6566  resh": force_ref
+0001f990: 7265 7368 2c0a 2020 2020 2020 2020 7d0a  resh,.        }.
+0001f9a0: 2020 2020 2020 2020 7265 7370 6f6e 7365          response
+0001f9b0: 203d 2073 656c 662e 6170 695f 6361 6c6c   = self.api_call
+0001f9c0: 286d 6574 686f 643d 2247 4554 222c 2070  (method="GET", p
+0001f9d0: 6174 683d 7061 7468 2c20 7061 7261 6d73  ath=path, params
+0001f9e0: 3d70 6172 616d 7329 0a20 2020 2020 2020  =params).       
+0001f9f0: 2072 6574 7572 6e20 6d6c 7275 6e2e 636f   return mlrun.co
+0001fa00: 6d6d 6f6e 2e73 6368 656d 6173 2e48 7562  mmon.schemas.Hub
+0001fa10: 4974 656d 282a 2a72 6573 706f 6e73 652e  Item(**response.
+0001fa20: 6a73 6f6e 2829 290a 0a20 2020 2064 6566  json())..    def
+0001fa30: 2067 6574 5f68 7562 5f61 7373 6574 280a   get_hub_asset(.
+0001fa40: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+0001fa50: 2020 2020 2020 736f 7572 6365 5f6e 616d        source_nam
+0001fa60: 653a 2073 7472 2c0a 2020 2020 2020 2020  e: str,.        
+0001fa70: 6974 656d 5f6e 616d 653a 2073 7472 2c0a  item_name: str,.
+0001fa80: 2020 2020 2020 2020 6173 7365 745f 6e61          asset_na
+0001fa90: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+0001faa0: 2076 6572 7369 6f6e 3a20 7374 7220 3d20   version: str = 
+0001fab0: 4e6f 6e65 2c0a 2020 2020 2020 2020 7461  None,.        ta
+0001fac0: 673a 2073 7472 203d 2022 6c61 7465 7374  g: str = "latest
+0001fad0: 222c 0a20 2020 2029 3a0a 2020 2020 2020  ",.    ):.      
+0001fae0: 2020 2222 220a 2020 2020 2020 2020 4765    """.        Ge
+0001faf0: 7420 6875 6220 6173 7365 7420 6672 6f6d  t hub asset from
+0001fb00: 2069 7465 6d2e 0a0a 2020 2020 2020 2020   item...        
+0001fb10: 3a70 6172 616d 2073 6f75 7263 655f 6e61  :param source_na
+0001fb20: 6d65 3a20 4e61 6d65 206f 6620 736f 7572  me: Name of sour
+0001fb30: 6365 2e0a 2020 2020 2020 2020 3a70 6172  ce..        :par
+0001fb40: 616d 2069 7465 6d5f 6e61 6d65 3a20 2020  am item_name:   
+0001fb50: 4e61 6d65 206f 6620 7468 6520 6974 656d  Name of the item
+0001fb60: 2077 6869 6368 2068 6f6c 6473 2074 6865   which holds the
+0001fb70: 2061 7373 6574 2e0a 2020 2020 2020 2020   asset..        
+0001fb80: 3a70 6172 616d 2061 7373 6574 5f6e 616d  :param asset_nam
+0001fb90: 653a 2020 4e61 6d65 206f 6620 7468 6520  e:  Name of the 
+0001fba0: 6173 7365 7420 746f 2072 6574 7269 6576  asset to retriev
+0001fbb0: 652e 0a20 2020 2020 2020 203a 7061 7261  e..        :para
+0001fbc0: 6d20 7665 7273 696f 6e3a 2047 6574 2061  m version: Get a
+0001fbd0: 2073 7065 6369 6669 6320 7665 7273 696f   specific versio
+0001fbe0: 6e20 6f66 2074 6865 2069 7465 6d2e 2044  n of the item. D
+0001fbf0: 6566 6175 6c74 2069 7320 6060 4e6f 6e65  efault is ``None
+0001fc00: 6060 2e0a 2020 2020 2020 2020 3a70 6172  ``..        :par
+0001fc10: 616d 2074 6167 3a20 4765 7420 6120 7370  am tag: Get a sp
+0001fc20: 6563 6966 6963 2076 6572 7369 6f6e 206f  ecific version o
+0001fc30: 6620 7468 6520 6974 656d 2069 6465 6e74  f the item ident
+0001fc40: 6966 6965 6420 6279 2074 6167 2e20 4465  ified by tag. De
+0001fc50: 6661 756c 7420 6973 2060 606c 6174 6573  fault is ``lates
+0001fc60: 7460 602e 0a0a 2020 2020 2020 2020 3a72  t``...        :r
+0001fc70: 6574 7572 6e3a 2068 7474 7020 7265 7370  eturn: http resp
+0001fc80: 6f6e 7365 2077 6974 6820 7468 6520 6173  onse with the as
+0001fc90: 7365 7420 696e 2074 6865 2063 6f6e 7465  set in the conte
+0001fca0: 6e74 2061 7474 7269 6275 7465 0a20 2020  nt attribute.   
+0001fcb0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0001fcc0: 2070 6174 6820 3d20 2866 2268 7562 2f73   path = (f"hub/s
+0001fcd0: 6f75 7263 6573 2f7b 736f 7572 6365 5f6e  ources/{source_n
+0001fce0: 616d 657d 2f69 7465 6d73 2f7b 6974 656d  ame}/items/{item
+0001fcf0: 5f6e 616d 657d 2f61 7373 6574 732f 7b61  _name}/assets/{a
+0001fd00: 7373 6574 5f6e 616d 657d 222c 290a 2020  sset_name}",).  
+0001fd10: 2020 2020 2020 7061 7261 6d73 203d 207b        params = {
+0001fd20: 0a20 2020 2020 2020 2020 2020 2022 7665  .            "ve
+0001fd30: 7273 696f 6e22 3a20 7665 7273 696f 6e2c  rsion": version,
+0001fd40: 0a20 2020 2020 2020 2020 2020 2022 7461  .            "ta
+0001fd50: 6722 3a20 7461 672c 0a20 2020 2020 2020  g": tag,.       
+0001fd60: 207d 0a20 2020 2020 2020 2072 6573 706f   }.        respo
+0001fd70: 6e73 6520 3d20 7365 6c66 2e61 7069 5f63  nse = self.api_c
+0001fd80: 616c 6c28 6d65 7468 6f64 3d22 4745 5422  all(method="GET"
+0001fd90: 2c20 7061 7468 3d70 6174 682c 2070 6172  , path=path, par
+0001fda0: 616d 733d 7061 7261 6d73 290a 2020 2020  ams=params).    
+0001fdb0: 2020 2020 7265 7475 726e 2072 6573 706f      return respo
+0001fdc0: 6e73 650a 0a20 2020 2064 6566 2076 6572  nse..    def ver
+0001fdd0: 6966 795f 6175 7468 6f72 697a 6174 696f  ify_authorizatio
+0001fde0: 6e28 0a20 2020 2020 2020 2073 656c 662c  n(.        self,
+0001fdf0: 0a20 2020 2020 2020 2061 7574 686f 7269  .        authori
+0001fe00: 7a61 7469 6f6e 5f76 6572 6966 6963 6174  zation_verificat
+0001fe10: 696f 6e5f 696e 7075 743a 206d 6c72 756e  ion_input: mlrun
+0001fe20: 2e63 6f6d 6d6f 6e2e 7363 6865 6d61 732e  .common.schemas.
+0001fe30: 4175 7468 6f72 697a 6174 696f 6e56 6572  AuthorizationVer
+0001fe40: 6966 6963 6174 696f 6e49 6e70 7574 2c0a  ificationInput,.
+0001fe50: 2020 2020 293a 0a20 2020 2020 2020 2022      ):.        "
+0001fe60: 2222 5665 7269 6669 6573 2061 7574 686f  ""Verifies autho
+0001fe70: 7269 7a61 7469 6f6e 2066 6f72 2074 6865  rization for the
+0001fe80: 2070 726f 7669 6465 6420 6163 7469 6f6e   provided action
+0001fe90: 206f 6e20 7468 6520 7072 6f76 6964 6564   on the provided
+0001fea0: 2072 6573 6f75 7263 652e 0a0a 2020 2020   resource...    
+0001feb0: 2020 2020 3a70 6172 616d 2061 7574 686f      :param autho
+0001fec0: 7269 7a61 7469 6f6e 5f76 6572 6966 6963  rization_verific
+0001fed0: 6174 696f 6e5f 696e 7075 743a 2049 6e73  ation_input: Ins
+0001fee0: 7461 6e63 6520 6f66 0a20 2020 2020 2020  tance of.       
+0001fef0: 2020 2020 203a 7079 3a63 6c61 7373 3a60       :py:class:`
+0001ff00: 7e6d 6c72 756e 2e63 6f6d 6d6f 6e2e 7363  ~mlrun.common.sc
+0001ff10: 6865 6d61 732e 4175 7468 6f72 697a 6174  hemas.Authorizat
+0001ff20: 696f 6e56 6572 6966 6963 6174 696f 6e49  ionVerificationI
+0001ff30: 6e70 7574 6020 7468 6174 2069 6e63 6c75  nput` that inclu
+0001ff40: 6465 7320 616c 6c20 7468 6520 6e65 6564  des all the need
+0001ff50: 6564 2070 6172 616d 6574 6572 7320 666f  ed parameters fo
+0001ff60: 720a 2020 2020 2020 2020 2020 2020 7468  r.            th
+0001ff70: 6520 6175 7468 2076 6572 6966 6963 6174  e auth verificat
+0001ff80: 696f 6e0a 2020 2020 2020 2020 2222 220a  ion.        """.
+0001ff90: 2020 2020 2020 2020 6572 726f 725f 6d65          error_me
+0001ffa0: 7373 6167 6520 3d20 2241 7574 686f 7269  ssage = "Authori
+0001ffb0: 7a61 7469 6f6e 2063 6865 636b 2066 6169  zation check fai
+0001ffc0: 6c65 6422 0a20 2020 2020 2020 2073 656c  led".        sel
+0001ffd0: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+0001ffe0: 2020 2020 2020 2020 2250 4f53 5422 2c0a          "POST",.
+0001fff0: 2020 2020 2020 2020 2020 2020 2261 7574              "aut
+00020000: 686f 7269 7a61 7469 6f6e 2f76 6572 6966  horization/verif
+00020010: 6963 6174 696f 6e73 222c 0a20 2020 2020  ications",.     
+00020020: 2020 2020 2020 2065 7272 6f72 5f6d 6573         error_mes
+00020030: 7361 6765 2c0a 2020 2020 2020 2020 2020  sage,.          
+00020040: 2020 626f 6479 3d64 6963 745f 746f 5f6a    body=dict_to_j
+00020050: 736f 6e28 6175 7468 6f72 697a 6174 696f  son(authorizatio
+00020060: 6e5f 7665 7269 6669 6361 7469 6f6e 5f69  n_verification_i
+00020070: 6e70 7574 2e64 6963 7428 2929 2c0a 2020  nput.dict()),.  
+00020080: 2020 2020 2020 290a 0a20 2020 2064 6566        )..    def
+00020090: 2074 7269 6767 6572 5f6d 6967 7261 7469   trigger_migrati
+000200a0: 6f6e 7328 7365 6c66 2920 2d3e 204f 7074  ons(self) -> Opt
+000200b0: 696f 6e61 6c5b 6d6c 7275 6e2e 636f 6d6d  ional[mlrun.comm
+000200c0: 6f6e 2e73 6368 656d 6173 2e42 6163 6b67  on.schemas.Backg
+000200d0: 726f 756e 6454 6173 6b5d 3a0a 2020 2020  roundTask]:.    
+000200e0: 2020 2020 2222 2254 7269 6767 6572 206d      """Trigger m
+000200f0: 6967 7261 7469 6f6e 7320 2877 696c 6c20  igrations (will 
+00020100: 646f 206e 6f74 6869 6e67 2069 6620 6e6f  do nothing if no
+00020110: 206d 6967 7261 7469 6f6e 7320 6172 6520   migrations are 
+00020120: 6e65 6564 6564 2920 616e 6420 7761 6974  needed) and wait
+00020130: 2066 6f72 2074 6865 6d20 746f 2066 696e   for them to fin
+00020140: 6973 6820 6966 2061 6374 7561 6c6c 790a  ish if actually.
+00020150: 2020 2020 2020 2020 7472 6967 6765 7265          triggere
+00020160: 640a 2020 2020 2020 2020 3a72 6574 7572  d.        :retur
+00020170: 6e73 3a20 3a70 793a 636c 6173 733a 607e  ns: :py:class:`~
+00020180: 6d6c 7275 6e2e 636f 6d6d 6f6e 2e73 6368  mlrun.common.sch
+00020190: 656d 6173 2e42 6163 6b67 726f 756e 6454  emas.BackgroundT
+000201a0: 6173 6b60 2e0a 2020 2020 2020 2020 2222  ask`..        ""
+000201b0: 220a 2020 2020 2020 2020 7265 7370 6f6e  ".        respon
+000201c0: 7365 203d 2073 656c 662e 6170 695f 6361  se = self.api_ca
+000201d0: 6c6c 280a 2020 2020 2020 2020 2020 2020  ll(.            
+000201e0: 2250 4f53 5422 2c0a 2020 2020 2020 2020  "POST",.        
+000201f0: 2020 2020 226f 7065 7261 7469 6f6e 732f      "operations/
+00020200: 6d69 6772 6174 696f 6e73 222c 0a20 2020  migrations",.   
+00020210: 2020 2020 2020 2020 2022 4661 696c 6564           "Failed
+00020220: 2074 7269 6767 6572 696e 6720 6d69 6772   triggering migr
+00020230: 6174 696f 6e73 222c 0a20 2020 2020 2020  ations",.       
+00020240: 2029 0a20 2020 2020 2020 2069 6620 7265   ).        if re
+00020250: 7370 6f6e 7365 2e73 7461 7475 735f 636f  sponse.status_co
+00020260: 6465 203d 3d20 6874 7470 2e48 5454 5053  de == http.HTTPS
+00020270: 7461 7475 732e 4143 4345 5054 4544 3a0a  tatus.ACCEPTED:.
+00020280: 2020 2020 2020 2020 2020 2020 6261 636b              back
+00020290: 6772 6f75 6e64 5f74 6173 6b20 3d20 6d6c  ground_task = ml
+000202a0: 7275 6e2e 636f 6d6d 6f6e 2e73 6368 656d  run.common.schem
+000202b0: 6173 2e42 6163 6b67 726f 756e 6454 6173  as.BackgroundTas
+000202c0: 6b28 2a2a 7265 7370 6f6e 7365 2e6a 736f  k(**response.jso
+000202d0: 6e28 2929 0a20 2020 2020 2020 2020 2020  n()).           
+000202e0: 2072 6574 7572 6e20 7365 6c66 2e5f 7761   return self._wa
+000202f0: 6974 5f66 6f72 5f62 6163 6b67 726f 756e  it_for_backgroun
+00020300: 645f 7461 736b 5f74 6f5f 7265 6163 685f  d_task_to_reach_
+00020310: 7465 726d 696e 616c 5f73 7461 7465 280a  terminal_state(.
+00020320: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00020330: 6261 636b 6772 6f75 6e64 5f74 6173 6b2e  background_task.
+00020340: 6d65 7461 6461 7461 2e6e 616d 650a 2020  metadata.name.  
+00020350: 2020 2020 2020 2020 2020 290a 2020 2020            ).    
+00020360: 2020 2020 7265 7475 726e 204e 6f6e 650a      return None.
+00020370: 0a20 2020 2064 6566 2073 6574 5f72 756e  .    def set_run
+00020380: 5f6e 6f74 6966 6963 6174 696f 6e73 280a  _notifications(.
+00020390: 2020 2020 2020 2020 7365 6c66 2c0a 2020          self,.  
+000203a0: 2020 2020 2020 7072 6f6a 6563 743a 2073        project: s
+000203b0: 7472 2c0a 2020 2020 2020 2020 7275 6e5f  tr,.        run_
+000203c0: 7569 643a 2073 7472 2c0a 2020 2020 2020  uid: str,.      
+000203d0: 2020 6e6f 7469 6669 6361 7469 6f6e 733a    notifications:
+000203e0: 2074 7970 696e 672e 4c69 7374 5b6d 6c72   typing.List[mlr
+000203f0: 756e 2e6d 6f64 656c 2e4e 6f74 6966 6963  un.model.Notific
+00020400: 6174 696f 6e5d 203d 204e 6f6e 652c 0a20  ation] = None,. 
+00020410: 2020 2029 3a0a 2020 2020 2020 2020 2222     ):.        ""
+00020420: 220a 2020 2020 2020 2020 5365 7420 6e6f  ".        Set no
+00020430: 7469 6669 6361 7469 6f6e 7320 6f6e 2061  tifications on a
+00020440: 2072 756e 2e20 5468 6973 2077 696c 6c20   run. This will 
+00020450: 6f76 6572 7269 6465 2061 6e79 2065 7869  override any exi
+00020460: 7374 696e 6720 6e6f 7469 6669 6361 7469  sting notificati
+00020470: 6f6e 7320 6f6e 2074 6865 2072 756e 2e0a  ons on the run..
+00020480: 2020 2020 2020 2020 3a70 6172 616d 2070          :param p
+00020490: 726f 6a65 6374 3a20 5072 6f6a 6563 7420  roject: Project 
+000204a0: 636f 6e74 6169 6e69 6e67 2074 6865 2072  containing the r
+000204b0: 756e 2e0a 2020 2020 2020 2020 3a70 6172  un..        :par
+000204c0: 616d 2072 756e 5f75 6964 3a20 5549 4420  am run_uid: UID 
+000204d0: 6f66 2074 6865 2072 756e 2e0a 2020 2020  of the run..    
+000204e0: 2020 2020 3a70 6172 616d 206e 6f74 6966      :param notif
+000204f0: 6963 6174 696f 6e73 3a20 4c69 7374 206f  ications: List o
+00020500: 6620 6e6f 7469 6669 6361 7469 6f6e 7320  f notifications 
+00020510: 746f 2073 6574 206f 6e20 7468 6520 7275  to set on the ru
+00020520: 6e2e 2044 6566 6175 6c74 2069 7320 616e  n. Default is an
+00020530: 2065 6d70 7479 206c 6973 742e 0a20 2020   empty list..   
+00020540: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+00020550: 206e 6f74 6966 6963 6174 696f 6e73 203d   notifications =
+00020560: 206e 6f74 6966 6963 6174 696f 6e73 206f   notifications o
+00020570: 7220 5b5d 0a0a 2020 2020 2020 2020 7365  r []..        se
+00020580: 6c66 2e61 7069 5f63 616c 6c28 0a20 2020  lf.api_call(.   
+00020590: 2020 2020 2020 2020 2022 5055 5422 2c0a           "PUT",.
+000205a0: 2020 2020 2020 2020 2020 2020 6622 7072              f"pr
+000205b0: 6f6a 6563 7473 2f7b 7072 6f6a 6563 747d  ojects/{project}
+000205c0: 2f72 756e 732f 7b72 756e 5f75 6964 7d2f  /runs/{run_uid}/
+000205d0: 6e6f 7469 6669 6361 7469 6f6e 7322 2c0a  notifications",.
+000205e0: 2020 2020 2020 2020 2020 2020 6622 4661              f"Fa
+000205f0: 696c 6564 2074 6f20 7365 7420 6e6f 7469  iled to set noti
+00020600: 6669 6361 7469 6f6e 7320 6f6e 2072 756e  fications on run
+00020610: 2e20 7569 643d 7b72 756e 5f75 6964 7d2c  . uid={run_uid},
+00020620: 2070 726f 6a65 6374 3d7b 7072 6f6a 6563   project={projec
+00020630: 747d 222c 0a20 2020 2020 2020 2020 2020  t}",.           
+00020640: 206a 736f 6e3d 7b0a 2020 2020 2020 2020   json={.        
+00020650: 2020 2020 2020 2020 226e 6f74 6966 6963          "notific
+00020660: 6174 696f 6e73 223a 205b 0a20 2020 2020  ations": [.     
+00020670: 2020 2020 2020 2020 2020 2020 2020 206e                 n
+00020680: 6f74 6966 6963 6174 696f 6e2e 746f 5f64  otification.to_d
+00020690: 6963 7428 2920 666f 7220 6e6f 7469 6669  ict() for notifi
+000206a0: 6361 7469 6f6e 2069 6e20 6e6f 7469 6669  cation in notifi
+000206b0: 6361 7469 6f6e 730a 2020 2020 2020 2020  cations.        
+000206c0: 2020 2020 2020 2020 5d2c 0a20 2020 2020          ],.     
+000206d0: 2020 2020 2020 207d 2c0a 2020 2020 2020         },.      
+000206e0: 2020 290a 0a20 2020 2064 6566 2073 6574    )..    def set
+000206f0: 5f73 6368 6564 756c 655f 6e6f 7469 6669  _schedule_notifi
+00020700: 6361 7469 6f6e 7328 0a20 2020 2020 2020  cations(.       
+00020710: 2073 656c 662c 0a20 2020 2020 2020 2070   self,.        p
+00020720: 726f 6a65 6374 3a20 7374 722c 0a20 2020  roject: str,.   
+00020730: 2020 2020 2073 6368 6564 756c 655f 6e61       schedule_na
+00020740: 6d65 3a20 7374 722c 0a20 2020 2020 2020  me: str,.       
+00020750: 206e 6f74 6966 6963 6174 696f 6e73 3a20   notifications: 
+00020760: 7479 7069 6e67 2e4c 6973 745b 6d6c 7275  typing.List[mlru
+00020770: 6e2e 6d6f 6465 6c2e 4e6f 7469 6669 6361  n.model.Notifica
+00020780: 7469 6f6e 5d20 3d20 4e6f 6e65 2c0a 2020  tion] = None,.  
+00020790: 2020 293a 0a20 2020 2020 2020 2022 2222    ):.        """
+000207a0: 0a20 2020 2020 2020 2053 6574 206e 6f74  .        Set not
+000207b0: 6966 6963 6174 696f 6e73 206f 6e20 6120  ifications on a 
+000207c0: 7363 6865 6475 6c65 2e20 5468 6973 2077  schedule. This w
+000207d0: 696c 6c20 6f76 6572 7269 6465 2061 6e79  ill override any
+000207e0: 2065 7869 7374 696e 6720 6e6f 7469 6669   existing notifi
+000207f0: 6361 7469 6f6e 7320 6f6e 2074 6865 2073  cations on the s
+00020800: 6368 6564 756c 652e 0a20 2020 2020 2020  chedule..       
+00020810: 203a 7061 7261 6d20 7072 6f6a 6563 743a   :param project:
+00020820: 2050 726f 6a65 6374 2063 6f6e 7461 696e   Project contain
+00020830: 696e 6720 7468 6520 7363 6865 6475 6c65  ing the schedule
+00020840: 2e0a 2020 2020 2020 2020 3a70 6172 616d  ..        :param
+00020850: 2073 6368 6564 756c 655f 6e61 6d65 3a20   schedule_name: 
+00020860: 4e61 6d65 206f 6620 7468 6520 7363 6865  Name of the sche
+00020870: 6475 6c65 2e0a 2020 2020 2020 2020 3a70  dule..        :p
+00020880: 6172 616d 206e 6f74 6966 6963 6174 696f  aram notificatio
+00020890: 6e73 3a20 4c69 7374 206f 6620 6e6f 7469  ns: List of noti
+000208a0: 6669 6361 7469 6f6e 7320 746f 2073 6574  fications to set
+000208b0: 206f 6e20 7468 6520 7363 6865 6475 6c65   on the schedule
+000208c0: 2e20 4465 6661 756c 7420 6973 2061 6e20  . Default is an 
+000208d0: 656d 7074 7920 6c69 7374 2e0a 2020 2020  empty list..    
+000208e0: 2020 2020 2222 220a 2020 2020 2020 2020      """.        
+000208f0: 6e6f 7469 6669 6361 7469 6f6e 7320 3d20  notifications = 
+00020900: 6e6f 7469 6669 6361 7469 6f6e 7320 6f72  notifications or
+00020910: 205b 5d0a 0a20 2020 2020 2020 2073 656c   []..        sel
+00020920: 662e 6170 695f 6361 6c6c 280a 2020 2020  f.api_call(.    
+00020930: 2020 2020 2020 2020 2250 5554 222c 0a20          "PUT",. 
+00020940: 2020 2020 2020 2020 2020 2066 2270 726f             f"pro
+00020950: 6a65 6374 732f 7b70 726f 6a65 6374 7d2f  jects/{project}/
+00020960: 7363 6865 6475 6c65 732f 7b73 6368 6564  schedules/{sched
+00020970: 756c 655f 6e61 6d65 7d2f 6e6f 7469 6669  ule_name}/notifi
+00020980: 6361 7469 6f6e 7322 2c0a 2020 2020 2020  cations",.      
+00020990: 2020 2020 2020 6622 4661 696c 6564 2074        f"Failed t
+000209a0: 6f20 7365 7420 6e6f 7469 6669 6361 7469  o set notificati
+000209b0: 6f6e 7320 6f6e 2073 6368 6564 756c 652e  ons on schedule.
+000209c0: 2073 6368 6564 756c 653d 7b73 6368 6564   schedule={sched
+000209d0: 756c 655f 6e61 6d65 7d2c 2070 726f 6a65  ule_name}, proje
+000209e0: 6374 3d7b 7072 6f6a 6563 747d 222c 0a20  ct={project}",. 
+000209f0: 2020 2020 2020 2020 2020 206a 736f 6e3d             json=
+00020a00: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
+00020a10: 2020 226e 6f74 6966 6963 6174 696f 6e73    "notifications
+00020a20: 223a 205b 0a20 2020 2020 2020 2020 2020  ": [.           
+00020a30: 2020 2020 2020 2020 206e 6f74 6966 6963           notific
+00020a40: 6174 696f 6e2e 746f 5f64 6963 7428 2920  ation.to_dict() 
+00020a50: 666f 7220 6e6f 7469 6669 6361 7469 6f6e  for notification
+00020a60: 2069 6e20 6e6f 7469 6669 6361 7469 6f6e   in notification
+00020a70: 730a 2020 2020 2020 2020 2020 2020 2020  s.              
+00020a80: 2020 5d2c 0a20 2020 2020 2020 2020 2020    ],.           
+00020a90: 207d 2c0a 2020 2020 2020 2020 290a 0a0a   },.        )...
+00020aa0: 6465 6620 5f61 735f 6a73 6f6e 286f 626a  def _as_json(obj
+00020ab0: 293a 0a20 2020 2066 6e20 3d20 6765 7461  ):.    fn = geta
+00020ac0: 7474 7228 6f62 6a2c 2022 746f 5f6a 736f  ttr(obj, "to_jso
+00020ad0: 6e22 2c20 4e6f 6e65 290a 2020 2020 6966  n", None).    if
+00020ae0: 2066 6e3a 0a20 2020 2020 2020 2072 6574   fn:.        ret
+00020af0: 7572 6e20 666e 2829 0a20 2020 2072 6574  urn fn().    ret
+00020b00: 7572 6e20 6469 6374 5f74 6f5f 6a73 6f6e  urn dict_to_json
+00020b10: 286f 626a 290a                           (obj).
```

## mlrun/db/nopdb.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2022 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -62,15 +62,15 @@
 
     def store_run(self, struct, uid, project="", iter=0):
         pass
 
     def update_run(self, updates: dict, uid, project="", iter=0):
         pass
 
-    def abort_run(self, uid, project="", iter=0):
+    def abort_run(self, uid, project="", iter=0, timeout=45):
         pass
 
     def read_run(self, uid, project="", iter=0):
         pass
 
     def list_runs(
         self,
```

## mlrun/db/sqldb.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2019 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -15,15 +15,15 @@
 import datetime
 from typing import List, Optional, Union
 
 import mlrun.common.schemas
 import mlrun.model_monitoring.model_endpoint
 from mlrun.api.db.base import DBError
 from mlrun.api.db.sqldb.db import SQLDB as SQLAPIDB
-from mlrun.api.db.sqldb.session import create_session
+from mlrun.common.db.sql_session import create_session
 
 # This class is a proxy for the real implementation that sits under mlrun.api.db.sqldb
 # The runtime objects (which manages the resources that do the real logic, like Nuclio functions, Dask jobs, etc...)
 # require a RunDB to manage their state, when a user run them locally this db will either be the
 # local filedb or the remote httpdb (we decided that we don't want to support SQLDB as an optional RunDB).
 # When the user submits something to run (task, function etc...) this runtime managers actually runs inside the api
 # service, in order to prevent the api from calling itself several times for each submission request (since the runDB
@@ -90,15 +90,15 @@
             self.session,
             project,
             uid,
             iter,
             updates,
         )
 
-    def abort_run(self, uid, project="", iter=0):
+    def abort_run(self, uid, project="", iter=0, timeout=45):
         raise NotImplementedError()
 
     def read_run(self, uid, project=None, iter=None):
         import mlrun.api.crud
 
         return self._transform_db_error(
             mlrun.api.crud.Runs().get_run,
```

## mlrun/feature_store/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/feature_store/api.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -36,15 +36,15 @@
     validate_target_paths_for_engine,
 )
 from ..db import RunDBError
 from ..model import DataSource, DataTargetBase
 from ..runtimes import RuntimeKinds
 from ..runtimes.function_reference import FunctionReference
 from ..serving.server import Response
-from ..utils import get_caller_globals, logger, normalize_name, str_to_timestamp
+from ..utils import get_caller_globals, logger, normalize_name
 from .common import (
     RunConfig,
     get_feature_set_by_uri,
     get_feature_vector_by_uri,
     verify_feature_set_exists,
     verify_feature_set_permissions,
     verify_feature_vector_permissions,
@@ -58,15 +58,15 @@
 )
 from .ingestion import (
     context_to_ingestion_params,
     init_featureset_graph,
     run_ingestion_job,
     run_spark_graph,
 )
-from .retrieval import get_merger, init_feature_vector_graph, run_merge_job
+from .retrieval import get_merger, run_merge_job
 
 _v3iofs = None
 spark_transform_handler = "transform"
 
 
 def _features_to_vector_and_check_permissions(features, update_stats):
     if isinstance(features, str):
@@ -99,17 +99,17 @@
     start_time: Union[str, datetime] = None,
     end_time: Union[str, datetime] = None,
     with_indexes: bool = False,
     update_stats: bool = False,
     engine: str = None,
     engine_args: dict = None,
     query: str = None,
-    join_type: str = "inner",
     order_by: Union[str, List[str]] = None,
     spark_service: str = None,
+    timestamp_for_filtering: Union[str, Dict[str, str]] = None,
 ) -> OfflineVectorResponse:
     """retrieve offline feature vector results
 
     specify a feature vector object/uri and retrieve the desired features, their metadata
     and statistics. returns :py:class:`~mlrun.feature_store.OfflineVectorResponse`,
     results can be returned as a dataframe or written to a target
 
@@ -131,45 +131,52 @@
         resp = get_offline_features(
             vector, entity_rows=trades, entity_timestamp_column="time", query="ticker in ['GOOG'] and bid>100"
         )
         print(resp.to_dataframe())
         print(vector.get_stats_table())
         resp.to_parquet("./out.parquet")
 
-    :param feature_vector: feature vector uri or FeatureVector object. passing feature vector obj requires update
-                            permissions
-    :param entity_rows:    dataframe with entity rows to join with
-    :param target:         where to write the results to
-    :param drop_columns:   list of columns to drop from the final result
-    :param entity_timestamp_column: timestamp column name in the entity rows dataframe
-    :param run_config:     function and/or run configuration
-                           see :py:class:`~mlrun.feature_store.RunConfig`
-    :param start_time:      datetime, low limit of time needed to be filtered. Optional.
-        entity_timestamp_column must be passed when using time filtering.
-    :param end_time:        datetime, high limit of time needed to be filtered. Optional.
-        entity_timestamp_column must be passed when using time filtering.
-    :param with_indexes:    return vector with index columns and timestamp_key from the feature sets (default False)
-    :param update_stats:    update features statistics from the requested feature sets on the vector. Default is False.
-    :param engine:          processing engine kind ("local", "dask", or "spark")
-    :param engine_args:     kwargs for the processing engine
-    :param query:           The query string used to filter rows
-    :param spark_service:   Name of the spark service to be used (when using a remote-spark runtime)
-    :param join_type:               {'left', 'right', 'outer', 'inner'}, default 'inner'
-                                    Supported retrieval engines: "dask", "local"
-                                    This parameter is in use when entity_timestamp_column and
-                                    feature_vector.spec.timestamp_field are None, if one of them
-                                    isn't none we're preforming as_of join.
-                                    Possible values :
-                                    * left: use only keys from left frame (SQL: left outer join)
-                                    * right: use only keys from right frame (SQL: right outer join)
-                                    * outer: use union of keys from both frames (SQL: full outer join)
-                                    * inner: use intersection of keys from both frames (SQL: inner join).
-    :param order_by:        Name or list of names to order by. The name or the names in the list can be the feature name
-                            or the alias of the feature you pass in the feature list.
+    :param feature_vector:          feature vector uri or FeatureVector object. passing feature vector obj requires
+                                    update permissions
+    :param entity_rows:             dataframe with entity rows to join with
+    :param target:                  where to write the results to
+    :param drop_columns:            list of columns to drop from the final result
+    :param entity_timestamp_column: timestamp column name in the entity rows dataframe. can be specified
+                                    only if param entity_rows was specified.
+    :param run_config:              function and/or run configuration
+                                    see :py:class:`~mlrun.feature_store.RunConfig`
+    :param start_time:              datetime, low limit of time needed to be filtered. Optional.
+    :param end_time:                datetime, high limit of time needed to be filtered. Optional.
+    :param with_indexes:            Return vector with/without the entities and the timestamp_key of the feature sets
+                                    and with/without entity_timestamp_column and timestamp_for_filtering columns.
+                                    This property can be specified also in the feature vector spec
+                                    (feature_vector.spec.with_indexes)
+                                    (default False)
+    :param update_stats:            update features statistics from the requested feature sets on the vector.
+                                    (default False).
+    :param engine:                  processing engine kind ("local", "dask", or "spark")
+    :param engine_args:             kwargs for the processing engine
+    :param query:                   The query string used to filter rows on the output
+    :param spark_service:           Name of the spark service to be used (when using a remote-spark runtime)
+    :param order_by:                Name or list of names to order by. The name or the names in the list can be the
+                                    feature name or the alias of the feature you pass in the feature list.
+    :param timestamp_for_filtering: name of the column to filter by, can be str for all the feature sets or a
+                                    dictionary ({<feature set name>: <timestamp column name>, ...})
+                                    that indicates the timestamp column name for each feature set. Optional.
+                                    By default, the filter executes on the timestamp_key of each feature set.
+                                    Note: the time filtering is performed on each feature set before the
+                                    merge process using start_time and end_time params.
+
     """
+    if entity_rows is None and entity_timestamp_column is not None:
+        raise mlrun.errors.MLRunInvalidArgumentError(
+            "entity_timestamp_column param "
+            "can not be specified without entity_rows param"
+        )
+
     if isinstance(feature_vector, FeatureVector):
         update_stats = True
 
     feature_vector = _features_to_vector_and_check_permissions(
         feature_vector, update_stats
     )
 
@@ -184,54 +191,48 @@
             feature_vector,
             target,
             merger_engine,
             engine,
             engine_args,
             spark_service,
             entity_rows,
-            timestamp_column=entity_timestamp_column,
+            entity_timestamp_column=entity_timestamp_column,
             run_config=run_config,
             drop_columns=drop_columns,
             with_indexes=with_indexes,
             query=query,
-            join_type=join_type,
             order_by=order_by,
+            start_time=start_time,
+            end_time=end_time,
+            timestamp_for_filtering=timestamp_for_filtering,
         )
 
-    start_time = str_to_timestamp(start_time)
-    end_time = str_to_timestamp(end_time)
-    if (start_time or end_time) and not entity_timestamp_column:
-        raise TypeError(
-            "entity_timestamp_column or feature_vector.spec.timestamp_field is required when passing start/end time"
-        )
-    if start_time and not end_time:
-        # if end_time is not specified set it to now()
-        end_time = pd.Timestamp.now()
     merger = merger_engine(feature_vector, **(engine_args or {}))
     return merger.start(
         entity_rows,
         entity_timestamp_column,
         target=target,
         drop_columns=drop_columns,
         start_time=start_time,
         end_time=end_time,
+        timestamp_for_filtering=timestamp_for_filtering,
         with_indexes=with_indexes,
         update_stats=update_stats,
         query=query,
-        join_type=join_type,
         order_by=order_by,
     )
 
 
 def get_online_feature_service(
     feature_vector: Union[str, FeatureVector],
     run_config: RunConfig = None,
     fixed_window_type: FixedWindowType = FixedWindowType.LastClosedWindow,
     impute_policy: dict = None,
     update_stats: bool = False,
+    entity_keys: List[str] = None,
 ) -> OnlineVectorService:
     """initialize and return online feature vector service api,
     returns :py:class:`~mlrun.feature_store.OnlineVectorService`
 
     :**usage**:
         There are two ways to use the function:
 
@@ -243,72 +244,78 @@
                     resp = svc.get([{"ticker": "GOOG"}, {"ticker": "MSFT"}])
                     print(resp)
                     resp = svc.get([{"ticker": "AAPL"}], as_list=True)
                     print(resp)
 
             Example with imputing::
 
-                with get_online_feature_service(vector_uri, impute_policy={"*": "$mean", "amount": 0)) as svc:
+                with get_online_feature_service(vector_uri, entity_keys=['id'],
+                                                impute_policy={"*": "$mean", "amount": 0)) as svc:
                     resp = svc.get([{"id": "C123487"}])
 
         2. as simple function, note that in that option you need to close the session.
 
             Example::
 
-                svc = get_online_feature_service(vector_uri)
+                svc = get_online_feature_service(vector_uri, entity_keys=['ticker'])
                 try:
                     resp = svc.get([{"ticker": "GOOG"}, {"ticker": "MSFT"}])
                     print(resp)
                     resp = svc.get([{"ticker": "AAPL"}], as_list=True)
                     print(resp)
 
                 finally:
                     svc.close()
 
             Example with imputing::
 
-                svc = get_online_feature_service(vector_uri, impute_policy={"*": "$mean", "amount": 0))
+                svc = get_online_feature_service(vector_uri, entity_keys=['id'],
+                                                 impute_policy={"*": "$mean", "amount": 0))
                 try:
                     resp = svc.get([{"id": "C123487"}])
                 except Exception as e:
                     handling exception...
                 finally:
                     svc.close()
 
-    :param feature_vector:    feature vector uri or FeatureVector object. passing feature vector obj requires update
-                            permissions
-    :param run_config:        function and/or run configuration for remote jobs/services
-    :param impute_policy:     a dict with `impute_policy` per feature, the dict key is the feature name and the dict
-                            value indicate which value will be used in case the feature is NaN/empty, the replaced
-                            value can be fixed number for constants or $mean, $max, $min, $std, $count for statistical
-                            values. "*" is used to specify the default for all features, example: `{"*": "$mean"}`
-    :param fixed_window_type: determines how to query the fixed window values which were previously inserted by ingest
-    :param update_stats:      update features statistics from the requested feature sets on the vector. Default: False.
+    :param feature_vector:      feature vector uri or FeatureVector object. passing feature vector obj requires update
+                                permissions.
+    :param run_config:          function and/or run configuration for remote jobs/services
+    :param impute_policy:       a dict with `impute_policy` per feature, the dict key is the feature name and the dict
+                                value indicate which value will be used in case the feature is NaN/empty, the replaced
+                                value can be fixed number for constants or $mean, $max, $min, $std, $count
+                                for statistical
+                                values. "*" is used to specify the default for all features, example: `{"*": "$mean"}`
+    :param fixed_window_type:   determines how to query the fixed window values which were previously inserted by ingest
+    :param update_stats:        update features statistics from the requested feature sets on the vector.
+                                Default: False.
+    :param entity_keys:         Entity list of the first feature_set in the vector.
+                                The indexes that are used to query the online service.
+    :return:                    Initialize the `OnlineVectorService`.
+                                Will be used in subclasses where `support_online=True`.
     """
     if isinstance(feature_vector, FeatureVector):
         update_stats = True
     feature_vector = _features_to_vector_and_check_permissions(
         feature_vector, update_stats
     )
 
     # Impute policies rely on statistics in many cases, so verifying that the fvec has stats in it
     if impute_policy and not feature_vector.status.stats:
         update_stats = True
 
-    graph, index_columns = init_feature_vector_graph(
-        feature_vector, fixed_window_type, update_stats=update_stats
-    )
-    service = OnlineVectorService(
-        feature_vector, graph, index_columns, impute_policy=impute_policy
-    )
-    service.initialize()
-
+    engine_args = {"impute_policy": impute_policy}
+    merger_engine = get_merger("storey")
     # todo: support remote service (using remote nuclio/mlrun function if run_config)
 
-    return service
+    merger = merger_engine(feature_vector, **engine_args)
+
+    return merger.init_online_vector_service(
+        entity_keys, fixed_window_type, update_stats=update_stats
+    )
 
 
 def _rename_source_dataframe_columns(df):
     rename_mapping = {}
     column_set = set(df.columns)
     for column in df.columns:
         if isinstance(column, str):
@@ -384,15 +391,16 @@
                           call `.save()` if it's not)
     :param source:        source dataframe or other sources (e.g. parquet source see:
                           :py:class:`~mlrun.datastore.ParquetSource` and other classes in mlrun.datastore with suffix
                           Source)
     :param targets:       optional list of data target objects
     :param namespace:     namespace or module containing graph classes
     :param return_df:     indicate if to return a dataframe with the graph results
-    :param infer_options: schema and stats infer options (:py:class:`~mlrun.feature_store.InferOptions`)
+    :param infer_options: schema (for discovery of entities, features in featureset), index, stats,
+                          histogram and preview infer options (:py:class:`~mlrun.feature_store.InferOptions`)
     :param run_config:    function and/or run configuration for remote jobs,
                           see :py:class:`~mlrun.feature_store.RunConfig`
     :param mlrun_context: mlrun context (when running as a job), for internal use !
     :param spark_context: local spark session for spark ingestion, example for creating the spark context:
                           `spark = SparkSession.builder.appName("Spark function").getOrCreate()`
                           For remote spark ingestion, this should contain the remote spark service name
     :param overwrite:     delete the targets' data prior to ingestion
@@ -661,18 +669,22 @@
         )
 
     :param featureset:     feature set object or uri
     :param source:         source dataframe or csv/parquet file path
     :param entity_columns: list of entity (index) column names
     :param timestamp_key:  DEPRECATED. Use FeatureSet parameter.
     :param namespace:      namespace or module containing graph classes
-    :param options:        schema and stats infer options (:py:class:`~mlrun.feature_store.InferOptions`)
+    :param options:        schema (for discovery of entities, features in featureset), index, stats,
+                           histogram and preview infer options (:py:class:`~mlrun.feature_store.InferOptions`)
     :param verbose:        verbose log
     :param sample_size:    num of rows to sample from the dataset (for large datasets)
     """
+    if isinstance(source, pd.DataFrame):
+        source = _rename_source_dataframe_columns(source)
+
     # preview reads the source as a pandas df, which is not fully compatible with spark
     if featureset.spec.engine == "spark":
         raise mlrun.errors.MLRunInvalidArgumentError(
             "preview with spark engine is not supported"
         )
 
     options = options if options is not None else InferOptions.default()
@@ -877,20 +889,22 @@
 
         if isinstance(source, pd.DataFrame):
             df = spark.createDataFrame(source)
         elif isinstance(source, pyspark.sql.DataFrame):
             df = source
         else:
             df = source.to_spark_df(spark, time_field=timestamp_key)
-            df = source.filter_df_start_end_time(df, timestamp_key)
         if featureset.spec.graph and featureset.spec.graph.steps:
             df = run_spark_graph(df, featureset, namespace, spark)
 
         if isinstance(df, Response) and df.status_code != 0:
             mlrun.errors.raise_for_status_code(df.status_code, df.body.split(": ")[1])
+
+        df.persist()
+
         _infer_from_static_df(df, featureset, options=infer_options)
 
         key_columns = list(featureset.spec.entities.keys())
         targets = targets or featureset.spec.targets
 
         targets_to_ingest = copy.deepcopy(targets)
         featureset.update_targets_for_ingest(targets_to_ingest, overwrite=overwrite)
@@ -983,19 +997,23 @@
     featureset,
     entity_columns=None,
     options: InferOptions = InferOptions.default(),
     sample_size=None,
 ):
     """infer feature-set schema & stats from static dataframe (without pipeline)"""
     if hasattr(df, "to_dataframe"):
+        if hasattr(df, "time_field"):
+            time_field = df.time_field or featureset.spec.timestamp_key
+        else:
+            time_field = featureset.spec.timestamp_key
         if df.is_iterator():
             # todo: describe over multiple chunks
-            df = next(df.to_dataframe())
+            df = next(df.to_dataframe(time_field=time_field))
         else:
-            df = df.to_dataframe()
+            df = df.to_dataframe(time_field=time_field)
     inferer = get_infer_interface(df)
     if InferOptions.get_common_options(options, InferOptions.schema()):
         featureset.spec.timestamp_key = inferer.infer_schema(
             df,
             featureset.spec.features,
             featureset.spec.entities,
             featureset.spec.timestamp_key,
```

## mlrun/feature_store/common.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,16 +16,17 @@
 
 import mlrun
 import mlrun.errors
 from mlrun.common.schemas import AuthorizationVerificationInput
 from mlrun.runtimes import BaseRuntime
 from mlrun.runtimes.function_reference import FunctionReference
 from mlrun.runtimes.utils import enrich_function_from_dict
-from mlrun.utils import StorePrefix, logger, parse_versioned_object_uri
+from mlrun.utils import StorePrefix, logger
 
+from ..common.helpers import parse_versioned_object_uri
 from ..config import config
 
 project_separator = "/"
 feature_separator = "."
 expected_message = f"in the form feature-set{feature_separator}feature[ as alias]"
```

## mlrun/feature_store/feature_set.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -182,15 +182,16 @@
     def engine(self) -> str:
         """feature set processing engine (storey, pandas, spark)"""
         return self._engine
 
     @engine.setter
     def engine(self, engine: str):
         engine_list = ["pandas", "spark", "storey"]
-        if engine and engine not in engine_list:
+        engine = engine if engine else "storey"
+        if engine not in engine_list:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 f"engine must be one of {','.join(engine_list)}"
             )
         self.graph.engine = "sync" if engine and engine in ["pandas", "spark"] else None
         self._engine = engine
 
     @property
@@ -268,15 +269,15 @@
         :param targets: list of the data targets used in the last ingestion operation
         :param stats: feature statistics calculated in the last ingestion (if stats calculation was requested)
         :param preview: preview of the feature-set contents (if preview generation was requested)
         :param function_uri: function used to execute the feature-set graph
         :param run_uri: last run used for ingestion
         """
 
-        self.state = state or "created"
+        self.state = state or mlrun.common.schemas.object.ObjectStatusState.CREATED
         self._targets: ObjectList = None
         self.targets = targets or []
         self.stats = stats or {}
         self.preview = preview or []
         self.function_uri = function_uri
         self.run_uri = run_uri
 
@@ -472,15 +473,15 @@
         if targets is not None and not isinstance(targets, list):
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "targets can only be None or a list of kinds or DataTargetBase derivatives"
             )
         targets = targets or []
         if with_defaults:
             self.spec.with_default_targets = True
-            targets.extend(get_default_targets())
+            targets.extend(get_default_targets(offline_only=self.spec.passthrough))
         else:
             self.spec.with_default_targets = False
 
         self.spec.targets = []
         self.__set_targets_add_targets_helper(targets)
 
         if default_final_step:
@@ -937,15 +938,22 @@
             columns = entities + columns
 
         if self.spec.passthrough:
             if not self.spec.source:
                 raise mlrun.errors.MLRunNotFoundError(
                     "passthrough feature set {self.metadata.name} with no source"
                 )
-            df = self.spec.source.to_dataframe()
+            df = self.spec.source.to_dataframe(
+                columns=columns,
+                start_time=start_time
+                or pd.Timestamp.min,  # overwrite `source.start_time` when the source is schedule.
+                end_time=end_time or pd.Timestamp.max,
+                time_field=time_column,
+                **kwargs,
+            )
             # to_dataframe() can sometimes return an iterator of dataframes instead of one dataframe
             if not isinstance(df, pd.DataFrame):
                 df = pd.concat(df)
             return df
 
         target = get_offline_target(self, name=target_name)
         if not target:
```

## mlrun/feature_store/feature_vector.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -380,21 +380,31 @@
         self.status.index_keys = index_keys
         return feature_set_objects, feature_set_fields
 
 
 class OnlineVectorService:
     """get_online_feature_service response object"""
 
-    def __init__(self, vector, graph, index_columns, impute_policy: dict = None):
+    def __init__(
+        self,
+        vector,
+        graph,
+        index_columns,
+        all_fs_entities: List[str] = None,
+        impute_policy: dict = None,
+        requested_columns: List[str] = None,
+    ):
         self.vector = vector
         self.impute_policy = impute_policy or {}
 
         self._controller = graph.controller
         self._index_columns = index_columns
+        self._all_fs_entities = all_fs_entities
         self._impute_values = {}
+        self._requested_columns = requested_columns
 
     def __enter__(self):
         return self
 
     def __exit__(self, exc_type, exc_val, exc_tb):
         self.close()
 
@@ -489,48 +499,47 @@
                 {self._index_columns[i]: item[i] for i in index_range}
                 for item in entity_rows
             ]
 
         for row in entity_rows:
             futures.append(self._controller.emit(row, return_awaitable_result=True))
 
-        requested_columns = list(self.vector.status.features.keys())
-        aliases = self.vector.get_feature_aliases()
-        for i, column in enumerate(requested_columns):
-            requested_columns[i] = aliases.get(column, column)
-
         for future in futures:
             result = future.await_result()
             data = result.body
-            for key in self._index_columns:
-                if data and key in data:
-                    del data[key]
-            if not data:
-                data = None
-            else:
+            if data:
                 actual_columns = data.keys()
-                for column in requested_columns:
+                if all([col in self._index_columns for col in actual_columns]):
+                    # didn't get any data from the graph
+                    results.append(None)
+                    continue
+                for column in self._requested_columns:
                     if (
                         column not in actual_columns
                         and column != self.vector.status.label_column
                     ):
                         data[column] = None
 
-            if self._impute_values and data:
-                for name in data.keys():
-                    v = data[name]
-                    if v is None or (type(v) == float and (np.isinf(v) or np.isnan(v))):
-                        data[name] = self._impute_values.get(name, v)
-            for name in list(self.vector.spec.entity_fields.keys()):
-                data.pop(name, None)
+                if self._impute_values:
+                    for name in data.keys():
+                        v = data[name]
+                        if v is None or (
+                            type(v) == float and (np.isinf(v) or np.isnan(v))
+                        ):
+                            data[name] = self._impute_values.get(name, v)
+                if not self.vector.spec.with_indexes:
+                    for name in self._all_fs_entities:
+                        data.pop(name, None)
+                if not any(data.values()):
+                    data = None
 
             if as_list and data:
                 data = [
                     data.get(key, None)
-                    for key in requested_columns
+                    for key in self._requested_columns
                     if key != self.vector.status.label_column
                 ]
             results.append(data)
 
         return results
 
     def close(self):
```

## mlrun/feature_store/ingestion.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/feature_store/steps.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/feature_store/retrieval/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,21 +12,22 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import mlrun.errors
 
 from .dask_merger import DaskFeatureMerger
 from .job import run_merge_job  # noqa
 from .local_merger import LocalFeatureMerger
-from .online import init_feature_vector_graph  # noqa
 from .spark_merger import SparkFeatureMerger
+from .storey_merger import StoreyFeatureMerger
 
 mergers = {
     "local": LocalFeatureMerger,
     "dask": DaskFeatureMerger,
     "spark": SparkFeatureMerger,
+    "storey": StoreyFeatureMerger,
 }
 
 
 def get_merger(kind):
     if not kind:
         return LocalFeatureMerger
     merger = mergers.get(kind)
```

## mlrun/feature_store/retrieval/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,40 +12,50 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 import abc
 import typing
 from datetime import datetime
 
+import dask.dataframe as dd
+import pandas as pd
+
 import mlrun
 from mlrun.datastore.targets import CSVTarget, ParquetTarget
 from mlrun.feature_store.feature_set import FeatureSet
 from mlrun.feature_store.feature_vector import Feature
 
-from ...utils import logger
+from ...utils import logger, str_to_timestamp
 from ..feature_vector import OfflineVectorResponse
 
 
 class BaseMerger(abc.ABC):
     """abstract feature merger class"""
 
+    # In order to be an online merger, the merger should implement `init_online_vector_service` function.
+    support_online = False
+
+    # In order to be an offline merger, the merger should implement
+    # `_order_by`, `_filter`, `_drop_columns_from_result`, `_rename_columns_and_select`, `_get_engine_df` functions.
+    support_offline = False
     engine = None
 
     def __init__(self, vector, **engine_args):
         self._relation = dict()
         self._join_type = "inner"
         self.vector = vector
 
         self._result_df = None
         self._drop_columns = []
         self._index_columns = []
         self._drop_indexes = True
         self._target = None
         self._alias = dict()
         self._origin_alias = dict()
+        self._entity_rows_node_name = "__mlrun__$entity_rows$"
 
     def _append_drop_column(self, key):
         if key and key not in self._drop_columns:
             self._drop_columns.append(key)
 
     def _append_index(self, key):
         if key:
@@ -69,76 +79,81 @@
         self,
         entity_rows=None,
         entity_timestamp_column=None,
         target=None,
         drop_columns=None,
         start_time=None,
         end_time=None,
+        timestamp_for_filtering=None,
         with_indexes=None,
         update_stats=None,
         query=None,
-        join_type="inner",
         order_by=None,
     ):
         self._target = target
-        self._join_type = join_type
 
         # calculate the index columns and columns we need to drop
         self._drop_columns = drop_columns or self._drop_columns
         if self.vector.spec.with_indexes or with_indexes:
             self._drop_indexes = False
 
-        if entity_timestamp_column and self._drop_indexes:
-            self._append_drop_column(entity_timestamp_column)
-
         # retrieve the feature set objects/fields needed for the vector
         feature_set_objects, feature_set_fields = self.vector.parse_features(
             update_stats=update_stats
         )
         if len(feature_set_fields) == 0:
             raise mlrun.errors.MLRunInvalidArgumentError(
                 "No features in vector. Make sure to infer the schema on all the feature sets first"
             )
 
         if update_stats:
             # update the feature vector objects with refreshed stats
             self.vector.save()
 
+        if self._drop_indexes and entity_timestamp_column:
+            self._append_drop_column(entity_timestamp_column)
+
         for feature_set in feature_set_objects.values():
-            if not entity_timestamp_column and self._drop_indexes:
+            if self._drop_indexes:
                 self._append_drop_column(feature_set.spec.timestamp_key)
             for key in feature_set.spec.entities.keys():
                 self._append_index(key)
 
-        return self._generate_vector(
+        start_time = str_to_timestamp(start_time)
+        end_time = str_to_timestamp(end_time)
+        if start_time and not end_time:
+            # if end_time is not specified set it to now()
+            end_time = pd.Timestamp.now()
+
+        return self._generate_offline_vector(
             entity_rows,
             entity_timestamp_column,
             feature_set_objects=feature_set_objects,
             feature_set_fields=feature_set_fields,
             start_time=start_time,
             end_time=end_time,
+            timestamp_for_filtering=timestamp_for_filtering,
             query=query,
             order_by=order_by,
         )
 
-    def _write_to_target(self):
-        self.vector.spec.with_indexes = not self._drop_indexes
+    def _write_to_offline_target(self):
         if self._target:
             is_persistent_vector = self.vector.metadata.name is not None
             if not self._target.path and not is_persistent_vector:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "target path was not specified"
                 )
             self._target.set_resource(self.vector)
             size = self._target.write_dataframe(self._result_df)
             if is_persistent_vector:
                 target_status = self._target.update_resource_status("ready", size=size)
                 logger.info(f"wrote target: {target_status}")
                 self.vector.save()
-        if self.vector.spec.with_indexes:
+        if not self._drop_indexes:
             self.vector.spec.entity_fields = [
                 Feature(name=feature, value_type=self._result_df[feature].dtype)
                 if self._result_df[feature].dtype.name != "object"
                 else Feature(name=feature, value_type="str")
                 for feature in self._index_columns
             ]
             self.vector.save()
@@ -156,22 +171,23 @@
                     logger.warn(
                         f"Can't set index, not all index columns found: {index_columns_missing}. "
                         f"It is possible that column was already indexed."
                     )
         else:
             df.reset_index(drop=True, inplace=True)
 
-    def _generate_vector(
+    def _generate_offline_vector(
         self,
         entity_rows,
         entity_timestamp_column,
         feature_set_objects,
         feature_set_fields,
         start_time=None,
         end_time=None,
+        timestamp_for_filtering=None,
         query=None,
         order_by=None,
     ):
         self._create_engine_env()
 
         feature_sets = []
         dfs = []
@@ -181,100 +197,137 @@
         # featureset is connected to the previous one, and within each record the left keys are indicated in index 0
         # and the right keys in index 1, this keys will be the keys that will be used in this join
 
         fs_link_list = self._create_linked_relation_list(
             feature_set_objects, feature_set_fields
         )
 
+        filtered = False
         for node in fs_link_list:
             name = node.name
             feature_set = feature_set_objects[name]
             feature_sets.append(feature_set)
             columns = feature_set_fields[name]
             self._origin_alias.update({name: alias for name, alias in columns})
             column_names = [name for name, _ in columns]
 
             for column in node.data["save_cols"]:
                 if column not in column_names:
-                    self._append_drop_column(column)
                     column_names.append(column)
+                    if column not in self._index_columns:
+                        self._append_drop_column(column)
+
+            if isinstance(timestamp_for_filtering, dict):
+                time_column = timestamp_for_filtering.get(
+                    name, feature_set.spec.timestamp_key
+                )
+            elif isinstance(timestamp_for_filtering, str):
+                time_column = timestamp_for_filtering
+            else:
+                time_column = feature_set.spec.timestamp_key
+
+            if time_column != feature_set.spec.timestamp_key and time_column not in [
+                feature.name for feature in feature_set.spec.features
+            ]:
+                raise mlrun.errors.MLRunInvalidArgumentError(
+                    f"Feature set `{name}` "
+                    f"does not have a column named `{time_column}` to filter on."
+                )
+
+            if self._drop_indexes:
+                self._append_drop_column(time_column)
+            if (start_time or end_time) and time_column:
+                filtered = True
 
             df = self._get_engine_df(
                 feature_set,
                 name,
                 column_names,
-                start_time,
-                end_time,
-                entity_timestamp_column,
+                start_time if time_column else None,
+                end_time if time_column else None,
+                time_column,
             )
 
             column_names += node.data["save_index"]
             node.data["save_cols"] += node.data["save_index"]
+            fs_entities_and_timestamp = list(feature_set.spec.entities.keys())
             if feature_set.spec.timestamp_key:
-                entity_timestamp_column_list = [feature_set.spec.timestamp_key]
-                column_names += entity_timestamp_column_list
-                node.data["save_cols"] += entity_timestamp_column_list
-                if not entity_timestamp_column:
-                    # if not entity_timestamp_column the firs `FeatureSet` will define it
-                    entity_timestamp_column = feature_set.spec.timestamp_key
+                column_names.append(feature_set.spec.timestamp_key)
+                node.data["save_cols"].append(feature_set.spec.timestamp_key)
+                fs_entities_and_timestamp.append(feature_set.spec.timestamp_key)
 
             # rename columns to be unique for each feature set and select if needed
             rename_col_dict = {
                 column: f"{column}_{name}"
                 for column in column_names
                 if column not in node.data["save_cols"]
             }
-            fs_entities = list(feature_set.spec.entities.keys())
             df_temp = self._rename_columns_and_select(
-                df, rename_col_dict, columns=list(set(column_names + fs_entities))
+                df,
+                rename_col_dict,
+                columns=list(set(column_names + fs_entities_and_timestamp)),
             )
 
             if df_temp is not None:
                 df = df_temp
                 del df_temp
 
             dfs.append(df)
             del df
 
             keys.append([node.data["left_keys"], node.data["right_keys"]])
 
             # update alias according to the unique column name
             new_columns = []
             if not self._drop_indexes:
-                new_columns.extend([(ind, ind) for ind in fs_entities])
+                new_columns.extend([(ind, ind) for ind in fs_entities_and_timestamp])
             for column, alias in columns:
                 if column in rename_col_dict:
                     new_columns.append((rename_col_dict[column], alias or column))
                 else:
                     new_columns.append((column, alias))
             self._update_alias(dictionary={name: alias for name, alias in new_columns})
 
-        # convert pandas entity_rows to spark DF if needed
+        # None of the feature sets was filtered as required
+        if not filtered and (start_time or end_time):
+            raise mlrun.errors.MLRunRuntimeError(
+                "start_time and end_time can only be provided in conjunction with "
+                "a timestamp column, or when the at least one feature_set has a timestamp key"
+            )
+        # convert pandas entity_rows to spark\dask DF if needed
         if (
             entity_rows is not None
             and not hasattr(entity_rows, "rdd")
             and self.engine == "spark"
         ):
             entity_rows = self.spark.createDataFrame(entity_rows)
+        elif (
+            entity_rows is not None
+            and not hasattr(entity_rows, "dask")
+            and self.engine == "dask"
+        ):
+            entity_rows = dd.from_pandas(
+                entity_rows, npartitions=len(entity_rows.columns)
+            )
 
         # join the feature data frames
-        self.merge(
+        result_timestamp = self.merge(
             entity_df=entity_rows,
-            entity_timestamp_column=entity_timestamp_column,
+            entity_timestamp_column=entity_timestamp_column
+            if entity_rows is not None
+            else None,
             featuresets=feature_sets,
             featureset_dfs=dfs,
             keys=keys,
         )
 
         all_columns = None
-        if not self._drop_indexes and entity_timestamp_column:
-            if entity_timestamp_column not in self._alias.values():
-                self._update_alias(
-                    key=entity_timestamp_column, val=entity_timestamp_column
-                )
+        if not self._drop_indexes and result_timestamp:
+            if result_timestamp not in self._alias.values():
+                self._update_alias(key=result_timestamp, val=result_timestamp)
             all_columns = list(self._alias.keys())
 
         df_temp = self._rename_columns_and_select(
             self._result_df, self._alias, columns=all_columns
         )
         if df_temp is not None:
             self._result_df = df_temp
@@ -305,17 +358,33 @@
             if None in order_by_active:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     f"Result dataframe contains {self._result_df.columns} "
                     f"columns and can't order by {order_by}"
                 )
             self._order_by(order_by_active)
 
-        self._write_to_target()
+        self._write_to_offline_target()
         return OfflineVectorResponse(self)
 
+    def init_online_vector_service(
+        self, entity_keys, fixed_window_type, update_stats=False
+    ):
+        """
+        initialize the `OnlineVectorService`
+
+        :param entity_keys:         list of the feature_vector indexes.
+        :param fixed_window_type:   determines how to query the fixed window values which were previously
+                                    inserted by ingest
+        :param update_stats:        update features statistics from the requested feature sets on the vector.
+                                    Default: False.
+
+        :return:                    `OnlineVectorService`
+        """
+        raise NotImplementedError
+
     def _unpersist_df(self, df):
         pass
 
     def merge(
         self,
         entity_df,
         entity_timestamp_column: str,
@@ -339,53 +408,50 @@
         elif entity_df is not None and featureset_dfs:
             # when `entity_rows` passed to `get_offline_features`
             # keys[0] mention the way that `entity_rows`  joins to the first `featureset`
             # and it can join only by the entities of the first `featureset`
             keys[0][0] = keys[0][1] = list(featuresets[0].spec.entities.keys())
 
         for featureset, featureset_df, lr_key in zip(featuresets, featureset_dfs, keys):
-            if featureset.spec.timestamp_key:
+            if featureset.spec.timestamp_key and entity_timestamp_column:
                 merge_func = self._asof_join
-                if self._join_type != "inner":
-                    logger.warn(
-                        "Merge all the features with as_of_join and don't "
-                        "take into account the join_type that was given"
-                    )
             else:
                 merge_func = self._join
 
             merged_df = merge_func(
                 merged_df,
                 entity_timestamp_column,
                 featureset,
                 featureset_df,
                 lr_key[0],
                 lr_key[1],
             )
+            entity_timestamp_column = (
+                entity_timestamp_column or featureset.spec.timestamp_key
+            )
 
             # unpersist as required by the implementation (e.g. spark) and delete references
             # to dataframe to allow for GC to free up the memory (local, dask)
             self._unpersist_df(featureset_df)
             del featureset_df
 
         self._result_df = merged_df
+        return entity_timestamp_column
 
-    @abc.abstractmethod
     def _asof_join(
         self,
         entity_df,
         entity_timestamp_column: str,
         featureset,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
         raise NotImplementedError("_asof_join() operation not implemented in class")
 
-    @abc.abstractmethod
     def _join(
         self,
         entity_df,
         entity_timestamp_column: str,
         featureset,
         featureset_df,
         left_keys: list,
@@ -508,18 +574,19 @@
                         node = node.next
                     if node:
                         self.add_after(node, other_node)
                     else:
                         self.add_last(other_node)
                     node = other_node
 
-    @staticmethod
-    def _create_linked_relation_list(feature_set_objects, feature_set_fields):
+    def _create_linked_relation_list(
+        self, feature_set_objects, feature_set_fields, entity_rows_keys=None
+    ):
         feature_set_names = list(feature_set_fields.keys())
-        if len(feature_set_names) == 1:
+        if len(feature_set_names) == 1 and not entity_rows_keys:
             return BaseMerger._LinkedList(
                 head=BaseMerger._Node(
                     name=feature_set_names[0],
                     order=0,
                     data={
                         "left_keys": [],
                         "right_keys": [],
@@ -610,70 +677,100 @@
                         },
                         order=name_in_order,
                     )
                 )
                 linked_list_relation.head.data["save_index"] = keys
             return linked_list_relation
 
+        def _build_entity_rows_relation(entity_rows_relation, fs_name, fs_order):
+            feature_set_entity_list = feature_set_entity_list_dict[fs_name]
+            feature_set_entity_list_names = list(feature_set_entity_list.keys())
+
+            if all([ent in entity_rows_keys for ent in feature_set_entity_list_names]):
+                # add to the link list feature set according to indexes match,
+                # only if all entities in the feature set exist in the entity rows
+                keys = feature_set_entity_list_names
+                entity_rows_relation.add_last(
+                    BaseMerger._Node(
+                        fs_name,
+                        data={
+                            "left_keys": keys,
+                            "right_keys": keys,
+                            "save_cols": [],
+                            "save_index": keys,
+                        },
+                        order=fs_order,
+                    )
+                )
+                entity_rows_relation.head.data["save_index"] = keys
+
+        if entity_rows_keys is not None:
+            entity_rows_linked_relation = _create_relation(
+                self._entity_rows_node_name, -1
+            )
+            relation_linked_lists.append(entity_rows_linked_relation)
+            linked_list_len_goal = len(feature_set_objects) + 1
+        else:
+            entity_rows_linked_relation = None
+            linked_list_len_goal = len(feature_set_objects)
+
         for i, name in enumerate(feature_set_names):
             linked_relation = _create_relation(name, i)
+            if entity_rows_linked_relation is not None:
+                _build_entity_rows_relation(entity_rows_linked_relation, name, i)
             for j, name_in in enumerate(feature_set_names):
                 if name != name_in:
                     linked_relation = _build_relation(name_in, j, linked_relation, i)
             relation_linked_lists.append(linked_relation)
 
         # concat all the link lists to one, for the merging process
         for i in range(len(relation_linked_lists)):
             return_relation = relation_linked_lists[i].__copy__()
             for relation_list in relation_linked_lists:
                 return_relation.concat(relation_list)
-            if return_relation.len == len(feature_set_objects):
+            if return_relation.len == linked_list_len_goal:
                 return return_relation
 
         raise mlrun.errors.MLRunRuntimeError("Failed to merge")
 
-    @classmethod
     def get_default_image(cls, kind):
         return mlrun.mlconf.feature_store.default_job_image
 
     def _reset_index(self, _result_df):
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _create_engine_env(self):
         """
         initialize engine env if needed
         """
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _get_engine_df(
         self,
         feature_set: FeatureSet,
         feature_set_name: typing.List[str],
         column_names: typing.List[str] = None,
         start_time: typing.Union[str, datetime] = None,
         end_time: typing.Union[str, datetime] = None,
-        entity_timestamp_column: str = None,
+        time_column: typing.Optional[str] = None,
     ):
         """
         Return the feature_set data frame according to the args
 
         :param feature_set:             current feature_set to extract from the data frame
         :param feature_set_name:        the name of the current feature_set
         :param column_names:            list of columns to select (if not all)
         :param start_time:              filter by start time
         :param end_time:                filter by end time
-        :param entity_timestamp_column: specify the time column name in the file
+        :param time_column:             specify the time column name to filter on
 
         :return: Data frame of the current engine
         """
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _rename_columns_and_select(
         self,
         df,
         rename_col_dict: typing.Dict[str, str],
         columns: typing.List[str] = None,
     ):
         """
@@ -683,31 +780,28 @@
         :param rename_col_dict: the renaming dictionary - {<current_column_name>: <new_column_name>, ...}
         :param columns:         list of columns to select (if not all)
 
         :return: the data frame after the transformation or None if the transformation were preformed inplace
         """
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _drop_columns_from_result(self):
         """
         drop `self._drop_columns` from `self._result_df`
         """
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _filter(self, query: str):
         """
         filter `self._result_df` by `query`
 
         :param query: The query string used to filter rows
         """
         raise NotImplementedError
 
-    @abc.abstractmethod
     def _order_by(self, order_by_active: typing.List[str]):
         """
         Order by `order_by_active` along all axis.
 
         :param order_by_active: list of names to sort by.
         """
         raise NotImplementedError
```

## mlrun/feature_store/retrieval/dask_merger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -21,14 +21,15 @@
 import mlrun
 
 from .base import BaseMerger
 
 
 class DaskFeatureMerger(BaseMerger):
     engine = "dask"
+    support_offline = True
 
     def __init__(self, vector, **engine_args):
         super().__init__(vector, **engine_args)
         self.client = engine_args.get("dask_client")
         self._dask_cluster_uri = engine_args.get("dask_cluster_uri")
 
     def _reset_index(self, df):
@@ -41,20 +42,29 @@
         entity_df,
         entity_timestamp_column: str,
         featureset,
         featureset_df,
         left_keys: list,
         right_keys: list,
     ):
+        def sort_partition(partition, timestamp):
+            return partition.sort_values(timestamp)
+
+        entity_df = entity_df.map_partitions(
+            sort_partition, timestamp=entity_timestamp_column
+        )
+        featureset_df = featureset_df.map_partitions(
+            sort_partition, timestamp=featureset.spec.timestamp_key
+        )
 
         merged_df = merge_asof(
             entity_df,
             featureset_df,
             left_on=entity_timestamp_column,
-            right_on=entity_timestamp_column,
+            right_on=featureset.spec.timestamp_key,
             left_by=left_keys or None,
             right_by=right_keys or None,
             suffixes=("", f"_{featureset.metadata.name}_"),
         )
         for col in merged_df.columns:
             if re.findall(f"_{featureset.metadata.name}_$", col):
                 self._append_drop_column(col)
@@ -113,22 +123,22 @@
     def _get_engine_df(
         self,
         feature_set,
         feature_set_name,
         column_names=None,
         start_time=None,
         end_time=None,
-        entity_timestamp_column=None,
+        time_column=None,
     ):
         df = feature_set.to_dataframe(
             columns=column_names,
             df_module=dd,
             start_time=start_time,
             end_time=end_time,
-            time_column=entity_timestamp_column,
+            time_column=time_column,
             index=False,
         )
 
         return self._reset_index(df).persist()
 
     def _rename_columns_and_select(self, df, rename_col_dict, columns=None):
         return df.rename(
```

## mlrun/feature_store/retrieval/job.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -29,21 +29,23 @@
     vector,
     target: DataTargetBase,
     merger: BaseMerger,
     engine: str,
     engine_args: dict,
     spark_service: str = None,
     entity_rows=None,
-    timestamp_column=None,
+    entity_timestamp_column=None,
     run_config=None,
     drop_columns=None,
     with_indexes=None,
     query=None,
-    join_type="inner",
     order_by=None,
+    start_time=None,
+    end_time=None,
+    timestamp_for_filtering=None,
 ):
     name = vector.metadata.name
     if not target or not hasattr(target, "to_dict"):
         raise mlrun.errors.MLRunInvalidArgumentError("target object must be specified")
     name = f"{name}-merger"
     run_config = run_config or RunConfig()
     kind = run_config.kind or ("spark" if engine == "spark" else "job")
@@ -89,26 +91,32 @@
 
         set_default_resources(
             function.spec.driver_resources, function.with_driver_requests
         )
         set_default_resources(
             function.spec.executor_resources, function.with_executor_requests
         )
+    if start_time and not isinstance(start_time, str):
+        start_time = start_time.isoformat()
+    if end_time and not isinstance(end_time, str):
+        end_time = end_time.isoformat()
 
     task = new_task(
         name=name,
         params={
             "vector_uri": vector.uri,
             "target": target.to_dict(),
-            "timestamp_column": timestamp_column,
+            "entity_timestamp_column": entity_timestamp_column,
             "drop_columns": drop_columns,
             "with_indexes": with_indexes,
             "query": query,
-            "join_type": join_type,
             "order_by": order_by,
+            "start_time": start_time,
+            "end_time": end_time,
+            "timestamp_for_filtering": timestamp_for_filtering,
             "engine_args": engine_args,
         },
         inputs={"entity_rows": entity_rows} if entity_rows is not None else {},
     )
     task.spec.secret_sources = run_config.secret_sources
     task.set_label("job-type", "feature-merge").set_label("feature-vector", vector.uri)
     task.metadata.uid = uuid.uuid4().hex
@@ -118,23 +126,24 @@
     run = function.run(
         task,
         handler=run_config.handler or "merge_handler",
         local=run_config.local,
         watch=run_config.watch,
     )
     logger.info(f"feature vector merge job started, run id = {run.uid()}")
-    return RemoteVectorResponse(vector, run)
+    return RemoteVectorResponse(vector, run, with_indexes)
 
 
 class RemoteVectorResponse:
     """get_offline_features response object"""
 
-    def __init__(self, vector, run):
+    def __init__(self, vector, run, with_indexes=False):
         self.run = run
         self.vector = vector
+        self.with_indexes = with_indexes or self.vector.spec.with_indexes
 
     @property
     def status(self):
         """vector prep job status (ready, running, error)"""
         return self.run.state()
 
     def _is_ready(self):
@@ -152,15 +161,15 @@
 
         file_format = kwargs.get("format")
         if not file_format:
             file_format = self.run.status.results["target"]["kind"]
         df = mlrun.get_dataitem(self.target_uri).as_df(
             columns=columns, df_module=df_module, format=file_format, **kwargs
         )
-        if self.vector.spec.with_indexes:
+        if self.with_indexes:
             df.set_index(
                 list(self.vector.spec.entity_fields.keys()), inplace=True, drop=True
             )
         return df
 
     @property
     def target_uri(self):
@@ -170,24 +179,24 @@
 
 
 _default_merger_handler = """
 import mlrun
 import mlrun.feature_store.retrieval
 from mlrun.datastore.targets import get_target_driver
 def merge_handler(context, vector_uri, target, entity_rows=None, 
-                  timestamp_column=None, drop_columns=None, with_indexes=None, query=None, join_type='inner', 
-                  engine_args=None, order_by=None):
+                  entity_timestamp_column=None, drop_columns=None, with_indexes=None, query=None,
+                  engine_args=None, order_by=None, start_time=None, end_time=None, timestamp_for_filtering=None):
     vector = context.get_store_resource(vector_uri)
     store_target = get_target_driver(target, vector)
-    entity_timestamp_column = timestamp_column or vector.spec.timestamp_field
     if entity_rows:
         entity_rows = entity_rows.as_df()
 
     context.logger.info(f"starting vector merge task to {vector.uri}")
     merger = mlrun.feature_store.retrieval.{{{engine}}}(vector, **(engine_args or {}))
     merger.start(entity_rows, entity_timestamp_column, store_target, drop_columns, with_indexes=with_indexes, 
-                 query=query, join_type=join_type, order_by=order_by)
+                 query=query, order_by=order_by, start_time=start_time, end_time=end_time,
+                 timestamp_for_filtering=timestamp_for_filtering)
 
     target = vector.status.targets[store_target.name].to_dict()
     context.log_result('feature_vector', vector.uri)
     context.log_result('target', target)
 """  # noqa
```

## mlrun/feature_store/retrieval/local_merger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -17,14 +17,15 @@
 import pandas as pd
 
 from .base import BaseMerger
 
 
 class LocalFeatureMerger(BaseMerger):
     engine = "local"
+    support_offline = True
 
     def __init__(self, vector, **engine_args):
         super().__init__(vector, **engine_args)
 
     def _asof_join(
         self,
         entity_df,
@@ -43,30 +44,29 @@
         entity_df[entity_timestamp_column] = pd.to_datetime(
             entity_df[entity_timestamp_column]
         )
         featureset_df[featureset.spec.timestamp_key] = pd.to_datetime(
             featureset_df[featureset.spec.timestamp_key]
         )
         entity_df.sort_values(by=entity_timestamp_column, inplace=True)
-        featureset_df.sort_values(by=entity_timestamp_column, inplace=True)
+        featureset_df.sort_values(by=featureset.spec.timestamp_key, inplace=True)
 
         merged_df = pd.merge_asof(
             entity_df,
             featureset_df,
             left_on=entity_timestamp_column,
             right_on=featureset.spec.timestamp_key,
             by=indexes,
             left_by=left_keys or None,
             right_by=right_keys or None,
             suffixes=("", f"_{featureset.metadata.name}_"),
         )
         for col in merged_df.columns:
             if re.findall(f"_{featureset.metadata.name}_$", col):
                 self._append_drop_column(col)
-
         # Undo indexing tricks for asof merge
         # to return the correct indexes and not
         # overload `index` columns
         if (
             indexes
             and "index" not in indexes
             and index_col_not_in_entity
@@ -105,33 +105,22 @@
     def _get_engine_df(
         self,
         feature_set,
         feature_set_name,
         column_names=None,
         start_time=None,
         end_time=None,
-        entity_timestamp_column=None,
+        time_column=None,
     ):
-        # handling case where there are multiple feature sets and user creates vector where entity_timestamp_
-        # column is from a specific feature set (can't be entity timestamp)
-        if (
-            entity_timestamp_column in column_names
-            or feature_set.spec.timestamp_key == entity_timestamp_column
-        ):
-            df = feature_set.to_dataframe(
-                columns=column_names,
-                start_time=start_time,
-                end_time=end_time,
-                time_column=entity_timestamp_column,
-            )
-        else:
-            df = feature_set.to_dataframe(
-                columns=column_names,
-                time_column=entity_timestamp_column,
-            )
+        df = feature_set.to_dataframe(
+            columns=column_names,
+            start_time=start_time,
+            end_time=end_time,
+            time_column=time_column,
+        )
         if df.index.names[0]:
             df.reset_index(inplace=True)
         return df
 
     def _rename_columns_and_select(self, df, rename_col_dict, columns=None):
         df.rename(
             columns=rename_col_dict,
```

## mlrun/feature_store/retrieval/spark_merger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,14 +19,15 @@
 from ...runtimes import RemoteSparkRuntime
 from ...runtimes.sparkjob.abstract import AbstractSparkRuntime
 from .base import BaseMerger
 
 
 class SparkFeatureMerger(BaseMerger):
     engine = "spark"
+    support_offline = True
 
     def __init__(self, vector, **engine_args):
         super().__init__(vector, **engine_args)
         self.spark = engine_args.get("spark", None)
         self.named_view = engine_args.get("named_view", False)
         self._pandas_df = None
 
@@ -63,52 +64,53 @@
         """
 
         from pyspark.sql import Window
         from pyspark.sql.functions import col, monotonically_increasing_id, row_number
 
         entity_with_id = entity_df.withColumn("_row_nr", monotonically_increasing_id())
         rename_right_keys = {}
-        for key in right_keys + [entity_timestamp_column]:
+        for key in right_keys + [featureset.spec.timestamp_key]:
             if key in entity_df.columns:
                 rename_right_keys[key] = f"ft__{key}"
         # get columns for projection
         projection = [
             col(col_name).alias(rename_right_keys.get(col_name, col_name))
             for col_name in featureset_df.columns
         ]
 
         aliased_featureset_df = featureset_df.select(projection)
+        right_timestamp = rename_right_keys.get(
+            featureset.spec.timestamp_key, featureset.spec.timestamp_key
+        )
 
         # set join conditions
         join_cond = (
             entity_with_id[entity_timestamp_column]
-            >= aliased_featureset_df[
-                rename_right_keys.get(entity_timestamp_column, entity_timestamp_column)
-            ]
+            >= aliased_featureset_df[right_timestamp]
         )
 
         # join based on entities
         for key_l, key_r in zip(left_keys, right_keys):
             join_cond = join_cond & (
                 entity_with_id[key_l]
                 == aliased_featureset_df[rename_right_keys.get(key_r, key_r)]
             )
 
         conditional_join = entity_with_id.join(
             aliased_featureset_df, join_cond, "leftOuter"
         )
 
         window = Window.partitionBy("_row_nr").orderBy(
-            col(f"ft__{entity_timestamp_column}").desc(),
+            col(right_timestamp).desc(),
         )
         filter_most_recent_feature_timestamp = conditional_join.withColumn(
             "_rank", row_number().over(window)
         ).filter(col("_rank") == 1)
 
-        for key in right_keys + [entity_timestamp_column]:
+        for key in right_keys + [featureset.spec.timestamp_key]:
             if key in entity_df.columns + [entity_timestamp_column]:
                 filter_most_recent_feature_timestamp = (
                     filter_most_recent_feature_timestamp.drop(
                         aliased_featureset_df[f"ft__{key}"]
                     )
                 )
         return filter_most_recent_feature_timestamp.drop("_row_nr", "_rank").orderBy(
@@ -190,60 +192,59 @@
     def _get_engine_df(
         self,
         feature_set,
         feature_set_name,
         column_names=None,
         start_time=None,
         end_time=None,
-        entity_timestamp_column=None,
+        time_column=None,
     ):
+        source_kwargs = {}
         if feature_set.spec.passthrough:
             if not feature_set.spec.source:
                 raise mlrun.errors.MLRunNotFoundError(
                     f"passthrough feature set {feature_set_name} with no source"
                 )
             source_kind = feature_set.spec.source.kind
             source_path = feature_set.spec.source.path
+            source_kwargs.update(feature_set.spec.source.attributes)
         else:
             target = get_offline_target(feature_set)
             if not target:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     f"feature set {feature_set_name} does not have offline targets"
                 )
             source_kind = target.kind
             source_path = target.get_target_path()
 
         # handling case where there are multiple feature sets and user creates vector where
         # entity_timestamp_column is from a specific feature set (can't be entity timestamp)
         source_driver = mlrun.datastore.sources.source_kind_to_driver[source_kind]
+
+        source = source_driver(
+            name=self.vector.metadata.name,
+            path=source_path,
+            time_field=time_column,
+            start_time=start_time,
+            end_time=end_time,
+            **source_kwargs,
+        )
+
+        columns = column_names + [ent.name for ent in feature_set.spec.entities]
         if (
-            entity_timestamp_column in column_names
-            or feature_set.spec.timestamp_key == entity_timestamp_column
+            feature_set.spec.timestamp_key
+            and feature_set.spec.timestamp_key not in columns
         ):
-            source = source_driver(
-                name=self.vector.metadata.name,
-                path=source_path,
-                time_field=entity_timestamp_column,
-                start_time=start_time,
-                end_time=end_time,
-            )
-        else:
-            source = source_driver(
-                name=self.vector.metadata.name,
-                path=source_path,
-                time_field=entity_timestamp_column,
-            )
-
-        if not entity_timestamp_column:
-            entity_timestamp_column = feature_set.spec.timestamp_key
-        # add the index/key to selected columns
-        timestamp_key = feature_set.spec.timestamp_key
+            columns.append(feature_set.spec.timestamp_key)
 
         return source.to_spark_df(
-            self.spark, named_view=self.named_view, time_field=timestamp_key
+            self.spark,
+            named_view=self.named_view,
+            time_field=time_column,
+            columns=columns,
         )
 
     def _rename_columns_and_select(
         self,
         df,
         rename_col_dict,
         columns=None,
```

## mlrun/frameworks/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/parallel_coordinates.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/artifacts_library.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/producer.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_common/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/loggers/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/loggers/logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/loggers/mlrun_logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/artifacts_library.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/pkl_model_server.py

```diff
@@ -1,21 +1,23 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
+from typing import Any, Dict
+
 import numpy as np
 import pandas as pd
 from cloudpickle import load
 
 from mlrun.serving.v2_serving import V2ModelServer
 
 
@@ -52,7 +54,17 @@
             x = pd.DataFrame(inputs[0])
         else:
             x = np.asarray(inputs)
 
         y_pred: np.ndarray = self.model.predict(x)
 
         return y_pred.tolist()
+
+    def explain(self, request: Dict[str, Any]) -> str:
+        """
+        Returns a string listing the model that is being served in this serving function and the function name.
+
+        :param request: A given request.
+
+        :return: Explanation string.
+        """
+        return f"A model server named '{self.name}'"
```

## mlrun/frameworks/_ml_common/plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/producer.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/loggers/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/loggers/logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/loggers/mlrun_logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/plans/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -29,32 +29,28 @@
     method assumes the inputs come from a binary classifier, and discretize the [0, 1] interval into bins.
     """
 
     _ARTIFACT_NAME = "calibration-curve"
 
     def __init__(
         self,
-        normalize: bool = False,
         n_bins: int = 5,
         strategy: str = "uniform",
     ):
         """
         Initialize a calibration curve plan with the given configuration.
 
         To read more about the parameters, head to the SciKit-Learn docs at:
         https://scikit-learn.org/stable/modules/generated/sklearn.calibration.calibration_curve.html
 
-        :param normalize: Whether the probabilities needs to be normalized into the [0, 1] interval, i.e. is not a
-                          proper probability.
         :param n_bins:    Number of bins to discretize the [0, 1] interval.
         :param strategy:  Strategy used to define the widths of the bins. Can be on of {uniform, quantile}.
                           Default: "uniform".
         """
         # Store the parameters:
-        self._normalize = normalize
         self._n_bins = n_bins
         self._strategy = strategy
 
         # Continue the initialization for the MLPlan:
         super(CalibrationCurvePlan, self).__init__(need_probabilities=True)
 
     def is_ready(self, stage: MLPlanStages, is_probabilities: bool) -> bool:
@@ -90,15 +86,14 @@
         :return: The produced calibration curve artifact in an artifacts dictionary.
         """
         # Calculate the calibration curve:
         prob_true, prob_pred = calibration_curve(
             y,
             y_pred[:, -1],  # Take only the second class probabilities (1, not 0).
             n_bins=self._n_bins,
-            normalize=self._normalize,
             strategy=self._strategy,
         )
 
         # Create the figure:
         fig = go.Figure(
             data=[go.Scatter(x=prob_true, y=prob_pred)],
             layout={"title": {"text": "Calibration Curve"}},
```

## mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/plans/dataset_plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/plans/feature_importance_plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/_ml_common/plans/roc_curve_plan.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/auto_mlrun/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/auto_mlrun/auto_mlrun.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/huggingface/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/huggingface/model_server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/model_server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/callbacks/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/callbacks/callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/callbacks/logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/onnx/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/onnx/dataset.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/onnx/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/onnx/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/onnx/model_server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/model_server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks/callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks/logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/estimator.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/metric.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/metrics_library.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/sklearn/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/model_server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/callbacks/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/callbacks/logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/xgboost/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/xgboost/mlrun_interface.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/xgboost/model_handler.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/frameworks/xgboost/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/launcher/base.py

```diff
@@ -21,27 +21,78 @@
 import mlrun.common.schemas
 import mlrun.config
 import mlrun.errors
 import mlrun.kfpops
 import mlrun.lists
 import mlrun.model
 import mlrun.runtimes
+import mlrun.utils.regex
 from mlrun.utils import logger
 
 run_modes = ["pass"]
 
 
 class BaseLauncher(abc.ABC):
     """
     Abstract class for managing and running functions in different contexts
     This class is designed to encapsulate the logic of running a function in different contexts
     i.e. running a function locally, remotely or in a server
     Each context will have its own implementation of the abstract methods while the common logic resides in this class
     """
 
+    def __init__(self, **kwargs):
+        pass
+
+    @abc.abstractmethod
+    def launch(
+        self,
+        runtime: "mlrun.runtimes.BaseRuntime",
+        task: Optional[
+            Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
+        ] = None,
+        handler: Optional[Union[str, Callable]] = None,
+        name: Optional[str] = "",
+        project: Optional[str] = "",
+        params: Optional[dict] = None,
+        inputs: Optional[Dict[str, str]] = None,
+        out_path: Optional[str] = "",
+        workdir: Optional[str] = "",
+        artifact_path: Optional[str] = "",
+        watch: Optional[bool] = True,
+        schedule: Optional[
+            Union[str, mlrun.common.schemas.schedule.ScheduleCronTrigger]
+        ] = None,
+        hyperparams: Dict[str, list] = None,
+        hyper_param_options: Optional[mlrun.model.HyperParamOptions] = None,
+        verbose: Optional[bool] = None,
+        scrape_metrics: Optional[bool] = None,
+        local_code_path: Optional[str] = None,
+        auto_build: Optional[bool] = None,
+        param_file_secrets: Optional[Dict[str, str]] = None,
+        notifications: Optional[List[mlrun.model.Notification]] = None,
+        returns: Optional[List[Union[str, Dict[str, str]]]] = None,
+    ) -> "mlrun.run.RunObject":
+        """run the function from the server/client[local/remote]"""
+        pass
+
+    @staticmethod
+    @abc.abstractmethod
+    def enrich_runtime(
+        runtime: "mlrun.runtimes.base.BaseRuntime",
+        project_name: Optional[str] = "",
+    ):
+        pass
+
+    @staticmethod
+    @abc.abstractmethod
+    def _store_function(
+        runtime: "mlrun.runtimes.BaseRuntime", run: "mlrun.run.RunObject"
+    ):
+        pass
+
     def save_function(
         self,
         runtime: "mlrun.runtimes.BaseRuntime",
         tag: str = "",
         versioned: bool = False,
         refresh: bool = False,
     ) -> str:
@@ -69,44 +120,17 @@
         logger.debug("Saving function", runtime_name=runtime.metadata.name, tag=tag)
         hash_key = db.store_function(
             obj, runtime.metadata.name, runtime.metadata.project, tag, versioned
         )
         hash_key = hash_key if versioned else None
         return "db://" + runtime._function_uri(hash_key=hash_key, tag=tag)
 
-    @abc.abstractmethod
-    def launch(
-        self,
-        runtime: "mlrun.runtimes.BaseRuntime",
-        task: Optional[
-            Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
-        ] = None,
-        handler: Optional[Union[str, Callable]] = None,
-        name: Optional[str] = "",
-        project: Optional[str] = "",
-        params: Optional[dict] = None,
-        inputs: Optional[Dict[str, str]] = None,
-        out_path: Optional[str] = "",
-        workdir: Optional[str] = "",
-        artifact_path: Optional[str] = "",
-        watch: Optional[bool] = True,
-        schedule: Optional[
-            Union[str, mlrun.common.schemas.schedule.ScheduleCronTrigger]
-        ] = None,
-        hyperparams: Dict[str, list] = None,
-        hyper_param_options: Optional[mlrun.model.HyperParamOptions] = None,
-        verbose: Optional[bool] = None,
-        scrape_metrics: Optional[bool] = None,
-        local_code_path: Optional[str] = None,
-        auto_build: Optional[bool] = None,
-        param_file_secrets: Optional[Dict[str, str]] = None,
-        notifications: Optional[List[mlrun.model.Notification]] = None,
-        returns: Optional[List[Union[str, Dict[str, str]]]] = None,
-    ) -> "mlrun.run.RunObject":
-        """run the function from the server/client[local/remote]"""
+    @staticmethod
+    def prepare_image_for_deploy(runtime: "mlrun.runtimes.BaseRuntime"):
+        """Check if the runtime requires to build the image and updates the spec accordingly"""
         pass
 
     def _validate_runtime(
         self,
         runtime: "mlrun.runtimes.BaseRuntime",
         run: "mlrun.run.RunObject",
     ):
@@ -186,16 +210,16 @@
             return mlrun.run.RunObject.from_template(task)
         elif isinstance(task, dict):
             return mlrun.run.RunObject.from_dict(task)
 
         # task is already a RunObject
         return task
 
+    @staticmethod
     def _enrich_run(
-        self,
         runtime,
         run,
         handler=None,
         project_name=None,
         name=None,
         params=None,
         inputs=None,
@@ -305,15 +329,21 @@
 
         if run.spec.output_path:
             run.spec.output_path = run.spec.output_path.replace("{{run.uid}}", meta.uid)
             run.spec.output_path = mlrun.utils.helpers.fill_artifact_path_template(
                 run.spec.output_path, run.metadata.project
             )
 
-        run.spec.notifications = notifications or run.spec.notifications or []
+        notifications = notifications or run.spec.notifications or []
+        mlrun.model.Notification.validate_notification_uniqueness(notifications)
+        for notification in notifications:
+            notification.validate_notification()
+
+        run.spec.notifications = notifications
+
         return run
 
     @staticmethod
     def _run_has_valid_notifications(runobj) -> bool:
         if not runobj.spec.notifications:
             logger.debug(
                 "No notifications to push for run", run_uid=runobj.metadata.uid
@@ -346,46 +376,35 @@
             mlrun.kfpops.write_kfpmeta(result)
 
         self._log_track_results(runtime, result, run)
 
         if result:
             run = mlrun.run.RunObject.from_dict(result)
             logger.info(
-                f"run executed, status={run.status.state}", name=run.metadata.name
+                "Run execution finished",
+                status=run.status.state,
+                name=run.metadata.name,
             )
-            if run.status.state == "error":
+            if run.status.state in [
+                mlrun.runtimes.base.RunStates.error,
+                mlrun.runtimes.base.RunStates.aborted,
+            ]:
                 if runtime._is_remote and not runtime.is_child:
-                    logger.error(f"runtime error: {run.status.error}")
-                raise mlrun.runtimes.utils.RunError(run.status.error)
+                    logger.error(
+                        "Run did not finish successfully",
+                        state=run.status.state,
+                        status=run.status.to_dict(),
+                    )
+                raise mlrun.runtimes.utils.RunError(run.error)
             return run
 
         return None
 
     @staticmethod
     def _refresh_function_metadata(runtime: "mlrun.runtimes.BaseRuntime"):
         pass
 
     @staticmethod
-    def prepare_image_for_deploy(runtime: "mlrun.runtimes.BaseRuntime"):
-        """Check if the runtime requires to build the image and updates the spec accordingly"""
-        pass
-
-    @staticmethod
-    @abc.abstractmethod
-    def enrich_runtime(
-        runtime: "mlrun.runtimes.base.BaseRuntime",
-        project: Optional[str] = "",
-    ):
-        pass
-
-    @staticmethod
-    @abc.abstractmethod
-    def _store_function(
-        runtime: "mlrun.runtimes.BaseRuntime", run: "mlrun.run.RunObject"
-    ):
-        pass
-
-    @staticmethod
     def _log_track_results(
         runtime: "mlrun.runtimes.BaseRuntime", result: dict, run: "mlrun.run.RunObject"
     ):
         pass
```

## mlrun/launcher/client.py

```diff
@@ -15,29 +15,29 @@
 import getpass
 import os
 from typing import Optional
 
 import IPython
 
 import mlrun.errors
-import mlrun.launcher.base
+import mlrun.launcher.base as launcher
 import mlrun.lists
 import mlrun.model
 import mlrun.runtimes
 from mlrun.utils import logger
 
 
-class ClientBaseLauncher(mlrun.launcher.base.BaseLauncher, abc.ABC):
+class ClientBaseLauncher(launcher.BaseLauncher, abc.ABC):
     """
     Abstract class for common code between client launchers
     """
 
     @staticmethod
     def enrich_runtime(
-        runtime: "mlrun.runtimes.base.BaseRuntime", project: Optional[str] = ""
+        runtime: "mlrun.runtimes.base.BaseRuntime", project_name: Optional[str] = ""
     ):
         runtime.try_auto_mount_based_on_config()
         runtime._fill_credentials()
 
     @staticmethod
     def prepare_image_for_deploy(runtime: "mlrun.runtimes.BaseRuntime"):
         """
```

## mlrun/launcher/factory.py

```diff
@@ -7,44 +7,52 @@
 #     http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
+from typing import Optional, Type
+
 import mlrun.config
 import mlrun.errors
 import mlrun.launcher.base
 import mlrun.launcher.local
 import mlrun.launcher.remote
+import mlrun.utils.singleton
+
 
+class LauncherFactory(
+    metaclass=mlrun.utils.singleton.AbstractSingleton,
+):
+    def __init__(self):
+        self._launcher_cls: Optional[Type[mlrun.launcher.base.BaseLauncher]] = None
 
-class LauncherFactory(object):
-    @staticmethod
     def create_launcher(
-        is_remote: bool, local: bool = False
+        self, is_remote: bool, **kwargs
     ) -> mlrun.launcher.base.BaseLauncher:
         """
         Creates the appropriate launcher for the specified run.
         ServerSideLauncher - if running as API.
         ClientRemoteLauncher - if the run is remote and local was not specified.
         ClientLocalLauncher - if the run is not remote or local was specified.
 
         :param is_remote:   Whether the runtime requires remote execution.
-        :param local:       Run the function locally vs on the Runtime/Cluster
 
         :return:            The appropriate launcher for the specified run.
         """
-        if mlrun.config.is_running_as_api():
-            if local:
-                raise mlrun.errors.MLRunInternalServerError(
-                    "Launch of local run inside the server is not allowed"
-                )
-
-            from mlrun.api.launcher import ServerSideLauncher
-
-            return ServerSideLauncher()
+        if self._launcher_cls:
+            return self._launcher_cls(**kwargs)
 
+        local = kwargs.get("local", False)
         if is_remote and not local:
-            return mlrun.launcher.remote.ClientRemoteLauncher()
+            return mlrun.launcher.remote.ClientRemoteLauncher(**kwargs)
 
-        return mlrun.launcher.local.ClientLocalLauncher(local)
+        return mlrun.launcher.local.ClientLocalLauncher(**kwargs)
+
+    def set_launcher(self, launcher_cls: Type[mlrun.launcher.base.BaseLauncher]):
+        """
+        Launcher setter for injection of a custom launcher.
+        This allows us to override the launcher from external packages without having to import them.
+        :param launcher_cls:    The launcher class to use.
+        """
+        self._launcher_cls = launcher_cls
```

## mlrun/launcher/local.py

```diff
@@ -13,35 +13,35 @@
 # limitations under the License.
 import os
 import pathlib
 from typing import Callable, Dict, List, Optional, Union
 
 import mlrun.common.schemas.schedule
 import mlrun.errors
-import mlrun.launcher.client
+import mlrun.launcher.client as launcher
 import mlrun.run
 import mlrun.runtimes.generators
 import mlrun.utils.clones
 import mlrun.utils.notifications
 from mlrun.utils import logger
 
 
-class ClientLocalLauncher(mlrun.launcher.client.ClientBaseLauncher):
+class ClientLocalLauncher(launcher.ClientBaseLauncher):
     """
     ClientLocalLauncher is a launcher that runs the job locally.
     Either on the user's machine (_is_run_local is True) or on a remote machine (_is_run_local is False).
     """
 
-    def __init__(self, local: bool):
+    def __init__(self, local: bool = False, **kwargs):
         """
         Initialize a ClientLocalLauncher.
         :param local:   True if the job runs on the user's local machine,
                         False if it runs on a remote machine (e.g. a dedicated k8s pod).
         """
-        super().__init__()
+        super().__init__(**kwargs)
         self._is_run_local = local
 
     def launch(
         self,
         runtime: "mlrun.runtimes.BaseRuntime",
         task: Optional[
             Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
@@ -115,22 +115,22 @@
             scrape_metrics=scrape_metrics,
             out_path=out_path,
             artifact_path=artifact_path,
             workdir=workdir,
             notifications=notifications,
         )
         self._validate_runtime(runtime, run)
-        result = self.execute(
+        result = self._execute(
             runtime=runtime,
             run=run,
         )
 
         return result
 
-    def execute(
+    def _execute(
         self,
         runtime: "mlrun.runtimes.BaseRuntime",
         run: Optional[Union["mlrun.run.RunTemplate", "mlrun.run.RunObject"]] = None,
     ):
 
         if "V3IO_USERNAME" in os.environ and "v3io_user" not in run.metadata.labels:
             run.metadata.labels["v3io_user"] = os.environ.get("V3IO_USERNAME")
@@ -186,15 +186,15 @@
             try:
                 resp = runtime._run(run, execution)
                 result = runtime._update_run_state(resp, task=run)
             except mlrun.runtimes.base.RunError as err:
                 last_err = err
                 result = runtime._update_run_state(task=run, err=err)
 
-        self._push_notifications(run)
+        self._push_notifications(run, runtime)
 
         # run post run hooks
         runtime._post_run(result, execution)  # hook for runtime specific cleanup
 
         return self._wrap_run_result(runtime, result, run, err=last_err)
 
     def _create_local_function_for_execution(
@@ -257,17 +257,20 @@
                 sp = command.split()
                 # split command and args
                 command = sp[0]
                 if len(sp) > 1:
                     args = sp[1:]
         return command, args
 
-    def _push_notifications(self, runobj):
+    def _push_notifications(
+        self, runobj: "mlrun.run.RunObject", runtime: "mlrun.runtimes.BaseRuntime"
+    ):
         if not self._run_has_valid_notifications(runobj):
             return
         # TODO: add store_notifications API endpoint so we can store notifications pushed from the
         #       SDK for documentation purposes.
         # The run is local, so we can assume that watch=True, therefore this code runs
         # once the run is completed, and we can just push the notifications.
         # Only push from jupyter, not from the CLI.
-        if self._is_run_local:
+        # "handler" and "dask" kinds are special cases of local runs which don't set local=True
+        if self._is_run_local or runtime.kind in ["handler", "dask"]:
             mlrun.utils.notifications.NotificationPusher([runobj]).push()
```

## mlrun/launcher/remote.py

```diff
@@ -15,24 +15,24 @@
 from typing import Dict, List, Optional, Union
 
 import requests
 
 import mlrun.common.schemas.schedule
 import mlrun.db
 import mlrun.errors
-import mlrun.launcher.client
+import mlrun.launcher.client as launcher
 import mlrun.run
 import mlrun.runtimes
 import mlrun.runtimes.generators
 import mlrun.utils.clones
 import mlrun.utils.notifications
 from mlrun.utils import logger
 
 
-class ClientRemoteLauncher(mlrun.launcher.client.ClientBaseLauncher):
+class ClientRemoteLauncher(launcher.ClientBaseLauncher):
     def launch(
         self,
         runtime: "mlrun.runtimes.KubejobRuntime",
         task: Optional[
             Union["mlrun.run.RunTemplate", "mlrun.run.RunObject", dict]
         ] = None,
         handler: Optional[str] = None,
@@ -102,17 +102,17 @@
             "Storing function",
             name=run.metadata.name,
             uid=run.metadata.uid,
             db=runtime.spec.rundb,
         )
         self._store_function(runtime, run)
 
-        return self.submit_job(runtime, run, schedule, watch)
+        return self._submit_job(runtime, run, schedule, watch)
 
-    def submit_job(
+    def _submit_job(
         self,
         runtime: "mlrun.runtimes.KubejobRuntime",
         run: "mlrun.run.RunObject",
         schedule: Optional[mlrun.common.schemas.ScheduleCronTrigger] = None,
         watch: Optional[bool] = None,
     ):
         if runtime._secrets:
@@ -142,14 +142,15 @@
                 runtime, result, run, schedule=schedule, err=err
             )
 
         if resp:
             txt = mlrun.runtimes.utils.helpers.get_in(resp, "status.status_text")
             if txt:
                 logger.info(txt)
+
         # watch is None only in scenario where we run from pipeline step, in this case we don't want to watch the run
         # logs too frequently but rather just pull the state of the run from the DB and pull the logs every x seconds
         # which ideally greater than the pull state interval, this reduces unnecessary load on the API server, as
         # running a pipeline is mostly not an interactive process which means the logs pulling doesn't need to be pulled
         # in real time
         if (
             watch is None
@@ -158,15 +159,14 @@
         ):
             state_interval = int(
                 mlrun.mlconf.httpdb.logs.pipelines.pull_state.pull_state_interval
             )
             logs_interval = int(
                 mlrun.mlconf.httpdb.logs.pipelines.pull_state.pull_logs_interval
             )
-
             run.wait_for_completion(
                 show_logs=True,
                 sleep=state_interval,
                 logs_interval=logs_interval,
                 raise_on_failure=False,
             )
             resp = runtime._get_db_run(run)
```

## mlrun/mlutils/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/mlutils/data.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/mlutils/models.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/mlutils/plots.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/model_monitoring/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,31 +11,11 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 # for backwards compatibility
 
-__all__ = [
-    "ModelEndpoint",
-    "EventFieldType",
-    "EventLiveStats",
-    "EventKeyMetrics",
-    "TimeSeriesTarget",
-    "ModelEndpointTarget",
-    "FileTargetKind",
-    "ProjectSecretKeys",
-    "ModelMonitoringStoreKinds",
-]
-
-from mlrun.common.model_monitoring import (
-    EventFieldType,
-    EventKeyMetrics,
-    EventLiveStats,
-    FileTargetKind,
-    ModelEndpointTarget,
-    ModelMonitoringStoreKinds,
-    ProjectSecretKeys,
-    TimeSeriesTarget,
-)
 
+from .helpers import get_stream_path
 from .model_endpoint import ModelEndpoint
+from .stores import ModelEndpointStore, ModelEndpointStoreType, get_model_endpoint_store
```

## mlrun/model_monitoring/features_drift_table.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -14,15 +14,15 @@
 #
 from typing import Dict, List, Tuple, Union
 
 import numpy as np
 import plotly.graph_objects as go
 from plotly.subplots import make_subplots
 
-from .model_monitoring_batch import DriftResultType, DriftStatus
+from mlrun.model_monitoring.model_monitoring_batch import DriftResultType, DriftStatus
 
 
 class FeaturesDriftTablePlot:
     """
     Class for producing a features drift table. The plot is a table with columns of all the statistics and metrics
     provided with two additional plot columns of the histograms and drift notification. The rows content will be drawn
     per feature.
```

## mlrun/model_monitoring/helpers.py

```diff
@@ -1,243 +1,65 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-import pathlib
-import typing
 
-import sqlalchemy.orm
-from fastapi import Depends
 
-import mlrun
-import mlrun.api.api.utils
-import mlrun.api.crud.secrets
-import mlrun.api.utils.singletons.db
-import mlrun.api.utils.singletons.k8s
-import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.model_monitoring.helpers
 import mlrun.common.schemas
-import mlrun.config
-import mlrun.feature_store as fstore
-import mlrun.model_monitoring.stream_processing_fs
-import mlrun.runtimes
-import mlrun.utils.helpers
-import mlrun.utils.model_monitoring
-from mlrun.api.api import deps
-
-_CURRENT_FILE_PATH = pathlib.Path(__file__)
-_STREAM_PROCESSING_FUNCTION_PATH = _CURRENT_FILE_PATH.parent / "stream_processing_fs.py"
-_MONIOTINRG_BATCH_FUNCTION_PATH = (
-    _CURRENT_FILE_PATH.parent / "model_monitoring_batch.py"
-)
-
-
-def initial_model_monitoring_stream_processing_function(
-    project: str,
-    model_monitoring_access_key: str,
-    tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
-    auth_info: mlrun.common.schemas.AuthInfo,
-    parquet_target: str,
-):
-    """
-    Initialize model monitoring stream processing function.
-
-    :param project:                     Project name.
-    :param model_monitoring_access_key: Access key to apply the model monitoring process. Please note that in CE
-                                        deployments this parameter will be None.
-    :param tracking_policy:             Model monitoring configurations.
-    :param auth_info:                   The auth info of the request.
-    :parquet_target:                    Path to model monitoring parquet file that will be generated by the monitoring
-                                        stream nuclio function.
+from mlrun.config import is_running_as_api
 
-    :return:                            A function object from a mlrun runtime class
 
-    """
+def get_stream_path(project: str = None):
+    """Get stream path from the project secret. If wasn't set, take it from the system configurations"""
 
-    # Initialize Stream Processor object
-    stream_processor = mlrun.model_monitoring.stream_processing_fs.EventStreamProcessor(
+    stream_uri = mlrun.get_secret_or_env(
+        mlrun.common.schemas.model_monitoring.ProjectSecretKeys.STREAM_PATH
+    ) or mlrun.mlconf.get_model_monitoring_file_target_path(
         project=project,
-        parquet_batching_max_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
-        parquet_target=parquet_target,
-        model_monitoring_access_key=model_monitoring_access_key,
+        kind=mlrun.common.schemas.model_monitoring.FileTargetKind.STREAM,
+        target="online",
     )
 
-    # Create a new serving function for the streaming process
-    function = mlrun.code_to_function(
-        name="model-monitoring-stream",
-        project=project,
-        filename=str(_STREAM_PROCESSING_FUNCTION_PATH),
-        kind="serving",
-        image=tracking_policy.stream_image,
-    )
-
-    # Create monitoring serving graph
-    stream_processor.apply_monitoring_serving_graph(function)
-
-    # Set the project to the serving function
-    function.metadata.project = project
-
-    # Add stream triggers
-    function = _apply_stream_trigger(
-        project=project,
-        function=function,
-        model_monitoring_access_key=model_monitoring_access_key,
-        auth_info=auth_info,
+    return mlrun.common.model_monitoring.helpers.parse_monitoring_stream_path(
+        stream_uri=stream_uri, project=project
     )
 
-    # Apply feature store run configurations on the serving function
-    run_config = fstore.RunConfig(function=function, local=False)
-    function.spec.parameters = run_config.parameters
-
-    return function
-
-
-def get_model_monitoring_batch_function(
-    project: str,
-    model_monitoring_access_key: str,
-    db_session: sqlalchemy.orm.Session,
-    auth_info: mlrun.common.schemas.AuthInfo,
-    tracking_policy: mlrun.utils.model_monitoring.TrackingPolicy,
-):
-    """
-    Initialize model monitoring batch function.
-
-    :param project:                     project name.
-    :param model_monitoring_access_key: access key to apply the model monitoring process. Please note that in CE
-                                        deployments this parameter will be None.
-    :param db_session:                  A session that manages the current dialog with the database.
-    :param auth_info:                   The auth info of the request.
-    :param tracking_policy:             Model monitoring configurations.
-
-    :return:                            A function object from a mlrun runtime class
-
-    """
-
-    # Create job function runtime for the model monitoring batch
-    function: mlrun.runtimes.KubejobRuntime = mlrun.code_to_function(
-        name="model-monitoring-batch",
-        project=project,
-        filename=str(_MONIOTINRG_BATCH_FUNCTION_PATH),
-        kind="job",
-        image=tracking_policy.default_batch_image,
-        handler="handler",
-    )
-    function.set_db_connection(mlrun.api.api.utils.get_run_db_instance(db_session))
-
-    # Set the project to the job function
-    function.metadata.project = project
-
-    if not mlrun.mlconf.is_ce_mode():
-        function = _apply_access_key_and_mount_function(
-            project=project,
-            function=function,
-            model_monitoring_access_key=model_monitoring_access_key,
-            auth_info=auth_info,
-        )
 
-    # Enrich runtime with the required configurations
-    mlrun.api.api.utils.apply_enrichment_and_validation_on_function(function, auth_info)
-
-    return function
-
-
-def _apply_stream_trigger(
-    project: str,
-    function: mlrun.runtimes.ServingRuntime,
-    model_monitoring_access_key: str = None,
-    auth_info: mlrun.common.schemas.AuthInfo = Depends(deps.authenticate_request),
-) -> mlrun.runtimes.ServingRuntime:
-    """Adding stream source for the nuclio serving function. By default, the function has HTTP stream trigger along
-    with another supported stream source that can be either Kafka or V3IO, depends on the stream path schema that is
-    defined under mlrun.mlconf.model_endpoint_monitoring.store_prefixes. Note that if no valid stream path has been
-    provided then the function will have a single HTTP stream source.
-
-    :param project:                     Project name.
-    :param function:                    The serving function object that will be applied with the stream trigger.
-    :param model_monitoring_access_key: Access key to apply the model monitoring stream function when the stream is
-                                        schema is V3IO.
-    :param auth_info:                   The auth info of the request.
-
-    :return: ServingRuntime object with stream trigger.
-    """
-
-    # Get the stream path from the configuration
-    # stream_path = mlrun.mlconf.get_file_target_path(project=project, kind="stream", target="stream")
-    stream_path = mlrun.utils.model_monitoring.get_stream_path(project=project)
-
-    if stream_path.startswith("kafka://"):
-
-        topic, brokers = mlrun.datastore.utils.parse_kafka_url(url=stream_path)
-        # Generate Kafka stream source
-        stream_source = mlrun.datastore.sources.KafkaSource(
-            brokers=brokers,
-            topics=[topic],
-        )
-        function = stream_source.add_nuclio_trigger(function)
-
-    if not mlrun.mlconf.is_ce_mode():
-        function = _apply_access_key_and_mount_function(
-            project=project,
-            function=function,
-            model_monitoring_access_key=model_monitoring_access_key,
-            auth_info=auth_info,
+def get_connection_string(project: str = None):
+    """Get endpoint store connection string from the project secret.
+    If wasn't set, take it from the system configurations"""
+
+    if is_running_as_api():
+        # Running on API server side
+        import mlrun.api.crud.secrets
+        import mlrun.common.schemas
+
+        return (
+            mlrun.api.crud.secrets.Secrets().get_project_secret(
+                project=project,
+                provider=mlrun.common.schemas.secret.SecretProviderName.kubernetes,
+                allow_secrets_from_k8s=True,
+                secret_key=mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION,
+            )
+            or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
         )
-        if stream_path.startswith("v3io://"):
-            # Generate V3IO stream trigger
-            function.add_v3io_stream_trigger(
-                stream_path=stream_path, name="monitoring_stream_trigger"
+    else:
+        # Running on stream server side
+        import mlrun
+
+        return (
+            mlrun.get_secret_or_env(
+                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
             )
-    # Add the default HTTP source
-    http_source = mlrun.datastore.sources.HttpSource()
-    function = http_source.add_nuclio_trigger(function)
-
-    return function
-
-
-def _apply_access_key_and_mount_function(
-    project: str,
-    function: typing.Union[
-        mlrun.runtimes.KubejobRuntime, mlrun.runtimes.ServingRuntime
-    ],
-    model_monitoring_access_key: str,
-    auth_info: mlrun.common.schemas.AuthInfo,
-) -> typing.Union[mlrun.runtimes.KubejobRuntime, mlrun.runtimes.ServingRuntime]:
-    """Applying model monitoring access key on the provided function when using V3IO path. In addition, this method
-    mount the V3IO path for the provided function to configure the access to the system files.
-
-    :param project:                     Project name.
-    :param function:                    Model monitoring function object that will be filled with the access key and
-                                        the access to the system files.
-    :param model_monitoring_access_key: Access key to apply the model monitoring stream function when the stream is
-                                        schema is V3IO.
-    :param auth_info:                   The auth info of the request.
-
-    :return: function runtime object with access key and access to system files.
-    """
-
-    # Set model monitoring access key for managing permissions
-    function.set_env_from_secret(
-        model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
-        mlrun.api.utils.singletons.k8s.get_k8s_helper().get_project_secret_name(
-            project
-        ),
-        mlrun.api.crud.secrets.Secrets().generate_client_project_secret_key(
-            mlrun.api.crud.secrets.SecretsClientType.model_monitoring,
-            model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY,
-        ),
-    )
-    function.metadata.credentials.access_key = model_monitoring_access_key
-    function.apply(mlrun.mount_v3io())
-
-    # Ensure that the auth env vars are set
-    mlrun.api.api.utils.ensure_function_has_auth_set(function, auth_info)
-
-    return function
+            or mlrun.mlconf.model_endpoint_monitoring.endpoint_store_connection
+        )
```

## mlrun/model_monitoring/model_endpoint.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,15 +12,15 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 from typing import Any, Dict, List, Optional
 
 import mlrun.model
-from mlrun.common.model_monitoring import (
+from mlrun.common.schemas.model_monitoring.constants import (
     EndpointType,
     EventKeyMetrics,
     EventLiveStats,
     ModelMonitoringMode,
 )
```

## mlrun/model_monitoring/model_monitoring_batch.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,28 +19,22 @@
 import os
 import re
 from enum import Enum
 from typing import Any, ClassVar, Dict, List, Optional, Tuple, Union
 
 import numpy as np
 import pandas as pd
-import v3io
 import v3io.dataplane
 import v3io_frames
 
-import mlrun
-import mlrun.common.model_monitoring
-import mlrun.common.schemas
+import mlrun.common.helpers
+import mlrun.common.model_monitoring.helpers
+import mlrun.common.schemas.model_monitoring
 import mlrun.data_types.infer
 import mlrun.feature_store as fstore
-import mlrun.model_monitoring
-import mlrun.model_monitoring.stores
-import mlrun.run
-import mlrun.utils.helpers
-import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
 from mlrun.utils import logger
 
 
 class DriftStatus(Enum):
     """
     Enum for the drift status values.
@@ -493,15 +487,14 @@
     """
 
     def __init__(
         self,
         context: mlrun.run.MLClientCtx,
         project: str,
     ):
-
         """
         Initialize Batch Processor object.
 
         :param context:                     An MLRun context.
         :param project:                     Project name.
         """
         self.context = context
@@ -521,29 +514,27 @@
         )
         self.default_drift_detected_threshold = (
             mlrun.mlconf.model_endpoint_monitoring.drift_thresholds.default.drift_detected
         )
 
         # Get a runtime database
 
-        self.db = mlrun.model_monitoring.stores.get_model_endpoint_store(
-            project=project
-        )
+        self.db = mlrun.model_monitoring.get_model_endpoint_store(project=project)
 
         if not mlrun.mlconf.is_ce_mode():
             # TODO: Once there is a time series DB alternative in a non-CE deployment, we need to update this if
             #  statement to be applied only for V3IO TSDB
             self._initialize_v3io_configurations()
 
         # If an error occurs, it will be raised using the following argument
         self.exception = None
 
         # Get the batch interval range
         self.batch_dict = context.parameters[
-            mlrun.common.model_monitoring.EventFieldType.BATCH_INTERVALS_DICT
+            mlrun.common.schemas.model_monitoring.EventFieldType.BATCH_INTERVALS_DICT
         ]
 
         # TODO: This will be removed in 1.5.0 once the job params can be parsed with different types
         # Convert batch dict string into a dictionary
         if isinstance(self.batch_dict, str):
             self._parse_batch_dict_str()
 
@@ -552,31 +543,35 @@
         self.model_monitoring_access_key = (
             os.environ.get("MODEL_MONITORING_ACCESS_KEY") or self.v3io_access_key
         )
 
         # Define the required paths for the project objects
         tsdb_path = mlrun.mlconf.get_model_monitoring_file_target_path(
             project=self.project,
-            kind=mlrun.common.model_monitoring.FileTargetKind.EVENTS,
+            kind=mlrun.common.schemas.model_monitoring.FileTargetKind.EVENTS,
         )
         (
             _,
             self.tsdb_container,
             self.tsdb_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(tsdb_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            tsdb_path
+        )
         # stream_path = template.format(project=self.project, kind="log_stream")
         stream_path = mlrun.mlconf.get_model_monitoring_file_target_path(
             project=self.project,
-            kind=mlrun.common.model_monitoring.FileTargetKind.LOG_STREAM,
+            kind=mlrun.common.schemas.model_monitoring.FileTargetKind.LOG_STREAM,
         )
         (
             _,
             self.stream_container,
             self.stream_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(stream_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            stream_path
+        )
 
         # Get the frames clients based on the v3io configuration
         # it will be used later for writing the results into the tsdb
         self.v3io = mlrun.utils.v3io_clients.get_v3io_client(
             access_key=self.v3io_access_key
         )
         self.frames = mlrun.utils.v3io_clients.get_frames_client(
@@ -615,72 +610,74 @@
             endpoints = self.db.list_model_endpoints()
         except Exception as e:
             logger.error("Failed to list endpoints", exc=e)
             return
 
         for endpoint in endpoints:
             if (
-                endpoint[mlrun.common.model_monitoring.EventFieldType.ACTIVE]
+                endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.ACTIVE]
                 and endpoint[
-                    mlrun.common.model_monitoring.EventFieldType.MONITORING_MODE
+                    mlrun.common.schemas.model_monitoring.EventFieldType.MONITORING_MODE
                 ]
-                == mlrun.common.model_monitoring.ModelMonitoringMode.enabled.value
+                == mlrun.common.schemas.model_monitoring.ModelMonitoringMode.enabled.value
             ):
                 # Skip router endpoint:
                 if (
                     int(
                         endpoint[
-                            mlrun.common.model_monitoring.EventFieldType.ENDPOINT_TYPE
+                            mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_TYPE
                         ]
                     )
-                    == mlrun.common.model_monitoring.EndpointType.ROUTER
+                    == mlrun.common.schemas.model_monitoring.EndpointType.ROUTER
                 ):
                     # Router endpoint has no feature stats
                     logger.info(
-                        f"{endpoint[mlrun.common.model_monitoring.EventFieldType.UID]} is router skipping"
+                        f"{endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.UID]} is router skipping"
                     )
                     continue
                 self.update_drift_metrics(endpoint=endpoint)
 
     def update_drift_metrics(self, endpoint: dict):
         try:
             # Convert feature set into dataframe and get the latest dataset
             (
                 _,
                 serving_function_name,
                 _,
                 _,
-            ) = mlrun.utils.helpers.parse_versioned_object_uri(
-                endpoint[mlrun.common.model_monitoring.EventFieldType.FUNCTION_URI]
+            ) = mlrun.common.helpers.parse_versioned_object_uri(
+                endpoint[
+                    mlrun.common.schemas.model_monitoring.EventFieldType.FUNCTION_URI
+                ]
             )
 
             model_name = endpoint[
-                mlrun.common.model_monitoring.EventFieldType.MODEL
+                mlrun.common.schemas.model_monitoring.EventFieldType.MODEL
             ].replace(":", "-")
 
             m_fs = fstore.get_feature_set(
                 f"store://feature-sets/{self.project}/monitoring-{serving_function_name}-{model_name}"
             )
 
             # Getting batch interval start time and end time
             start_time, end_time = self._get_interval_range()
 
             try:
                 df = m_fs.to_dataframe(
                     start_time=start_time,
                     end_time=end_time,
-                    time_column=mlrun.common.model_monitoring.EventFieldType.TIMESTAMP,
+                    time_column=mlrun.common.schemas.model_monitoring.EventFieldType.TIMESTAMP,
                 )
 
                 if len(df) == 0:
                     logger.warn(
                         "Not enough model events since the beginning of the batch interval",
                         parquet_target=m_fs.status.targets[0].path,
                         endpoint=endpoint[
-                            mlrun.common.model_monitoring.EventFieldType.UID
+                            mlrun.common.schemas.model_monitoring.EventFieldType.UID
                         ],
                         min_rqeuired_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
                         start_time=str(
                             datetime.datetime.now() - datetime.timedelta(hours=1)
                         ),
                         end_time=str(datetime.datetime.now()),
                     )
@@ -690,34 +687,38 @@
             #       as expected. In that case, the existence of the file will be checked before trying to get
             #       the offline data from the feature set.
             # Continue if not enough events provided since the deployment of the model endpoint
             except FileNotFoundError:
                 logger.warn(
                     "Parquet not found, probably due to not enough model events",
                     parquet_target=m_fs.status.targets[0].path,
-                    endpoint=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
+                    endpoint=endpoint[
+                        mlrun.common.schemas.model_monitoring.EventFieldType.UID
+                    ],
                     min_rqeuired_events=mlrun.mlconf.model_endpoint_monitoring.parquet_batching_max_events,
                 )
                 return
 
             # Get feature names from monitoring feature set
             feature_names = [
                 feature_name["name"] for feature_name in m_fs.spec.features.to_dict()
             ]
 
             # Create DataFrame based on the input features
             stats_columns = [
-                mlrun.common.model_monitoring.EventFieldType.TIMESTAMP,
+                mlrun.common.schemas.model_monitoring.EventFieldType.TIMESTAMP,
                 *feature_names,
             ]
 
             # Add label names if provided
-            if endpoint[mlrun.common.model_monitoring.EventFieldType.LABEL_NAMES]:
+            if endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.LABEL_NAMES
+            ]:
                 labels = endpoint[
-                    mlrun.common.model_monitoring.EventFieldType.LABEL_NAMES
+                    mlrun.common.schemas.model_monitoring.EventFieldType.LABEL_NAMES
                 ]
                 if isinstance(labels, str):
                     labels = json.loads(labels)
                 stats_columns.extend(labels)
             named_features_df = df[stats_columns].copy()
 
             # Infer feature set stats and schema
@@ -727,21 +728,23 @@
                 options=mlrun.data_types.infer.InferOptions.all_stats(),
             )
 
             # Save feature set to apply changes
             m_fs.save()
 
             # Get the timestamp of the latest request:
-            timestamp = df[mlrun.common.model_monitoring.EventFieldType.TIMESTAMP].iloc[
-                -1
-            ]
+            timestamp = df[
+                mlrun.common.schemas.model_monitoring.EventFieldType.TIMESTAMP
+            ].iloc[-1]
 
             # Get the feature stats from the model endpoint for reference data
             feature_stats = json.loads(
-                endpoint[mlrun.common.model_monitoring.EventFieldType.FEATURE_STATS]
+                endpoint[
+                    mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_STATS
+                ]
             )
 
             # Get the current stats:
             current_stats = calculate_inputs_statistics(
                 sample_set_statistics=feature_stats,
                 inputs=named_features_df,
             )
@@ -754,15 +757,15 @@
             )
             logger.info("Drift result", drift_result=drift_result)
 
             # Get drift thresholds from the model configuration:
             monitor_configuration = (
                 json.loads(
                     endpoint[
-                        mlrun.common.model_monitoring.EventFieldType.MONITOR_CONFIGURATION
+                        mlrun.common.schemas.model_monitoring.EventFieldType.MONITOR_CONFIGURATION
                     ]
                 )
                 or {}
             )
             possible_drift = monitor_configuration.get(
                 "possible_drift", self.default_possible_drift_threshold
             )
@@ -774,60 +777,66 @@
             drift_status, drift_measure = self.virtual_drift.check_for_drift(
                 metrics_results_dictionary=drift_result,
                 possible_drift_threshold=possible_drift,
                 drift_detected_threshold=drift_detected,
             )
             logger.info(
                 "Drift status",
-                endpoint_id=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
+                endpoint_id=endpoint[
+                    mlrun.common.schemas.model_monitoring.EventFieldType.UID
+                ],
                 drift_status=drift_status.value,
                 drift_measure=drift_measure,
             )
 
             attributes = {
                 "current_stats": json.dumps(current_stats),
                 "drift_measures": json.dumps(drift_result),
                 "drift_status": drift_status.value,
             }
 
             self.db.update_model_endpoint(
-                endpoint_id=endpoint[mlrun.common.model_monitoring.EventFieldType.UID],
+                endpoint_id=endpoint[
+                    mlrun.common.schemas.model_monitoring.EventFieldType.UID
+                ],
                 attributes=attributes,
             )
 
             if not mlrun.mlconf.is_ce_mode():
                 # Update drift results in TSDB
                 self._update_drift_in_input_stream(
                     endpoint_id=endpoint[
-                        mlrun.common.model_monitoring.EventFieldType.UID
+                        mlrun.common.schemas.model_monitoring.EventFieldType.UID
                     ],
                     drift_status=drift_status,
                     drift_measure=drift_measure,
                     drift_result=drift_result,
                     timestamp=timestamp,
                 )
                 logger.info(
                     "Done updating drift measures",
                     endpoint_id=endpoint[
-                        mlrun.common.model_monitoring.EventFieldType.UID
+                        mlrun.common.schemas.model_monitoring.EventFieldType.UID
                     ],
                 )
 
         except Exception as e:
             logger.error(
-                f"Exception for endpoint {endpoint[mlrun.common.model_monitoring.EventFieldType.UID]}"
+                f"Exception for endpoint {endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.UID]}"
             )
             self.exception = e
 
     def _get_interval_range(self) -> Tuple[datetime.datetime, datetime.datetime]:
         """Getting batch interval time range"""
         minutes, hours, days = (
-            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.MINUTES],
-            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.HOURS],
-            self.batch_dict[mlrun.common.model_monitoring.EventFieldType.DAYS],
+            self.batch_dict[
+                mlrun.common.schemas.model_monitoring.EventFieldType.MINUTES
+            ],
+            self.batch_dict[mlrun.common.schemas.model_monitoring.EventFieldType.HOURS],
+            self.batch_dict[mlrun.common.schemas.model_monitoring.EventFieldType.DAYS],
         )
         start_time = datetime.datetime.now() - datetime.timedelta(
             minutes=minutes, hours=hours, days=days
         )
         end_time = datetime.datetime.now()
         return start_time, end_time
 
@@ -884,15 +893,15 @@
             )
 
         # Update the results in tsdb:
         tsdb_drift_measures = {
             "endpoint_id": endpoint_id,
             "timestamp": pd.to_datetime(
                 timestamp,
-                format=mlrun.common.model_monitoring.EventFieldType.TIME_FORMAT,
+                format=mlrun.common.schemas.model_monitoring.EventFieldType.TIME_FORMAT,
             ),
             "record_type": "drift_measures",
             "tvd_mean": drift_result["tvd_mean"],
             "kld_mean": drift_result["kld_mean"],
             "hellinger_mean": drift_result["hellinger_mean"],
         }
```

## mlrun/model_monitoring/stores/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,15 +13,15 @@
 # limitations under the License.
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
 
 import enum
 import typing
 
-import mlrun
+import mlrun.errors
 
 from .model_endpoint_store import ModelEndpointStore
 
 
 class ModelEndpointStoreType(enum.Enum):
     """Enum class to handle the different store type values for saving a model endpoint record."""
 
@@ -48,25 +48,24 @@
                                           'mysql+pymysql://root:1234@localhost:3306/mlrun'.
 
         :return: `ModelEndpointStore` object.
 
         """
 
         if self.value == ModelEndpointStoreType.v3io_nosql.value:
-
             from .kv_model_endpoint_store import KVModelEndpointStore
 
             # Get V3IO access key from env
             access_key = access_key or mlrun.mlconf.get_v3io_access_key()
 
             return KVModelEndpointStore(project=project, access_key=access_key)
 
         # Assuming SQL store target if store type is not KV.
         # Update these lines once there are more than two store target types.
-        from mlrun.utils.model_monitoring import get_connection_string
+        from mlrun.model_monitoring.helpers import get_connection_string
 
         sql_connection_string = endpoint_store_connection or get_connection_string(
             project=project
         )
         from .sql_model_endpoint_store import SQLModelEndpointStore
 
         return SQLModelEndpointStore(
```

## mlrun/model_monitoring/stores/kv_model_endpoint_store.py

```diff
@@ -1,31 +1,32 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
+import json
 import os
 import typing
+import warnings
 
 import v3io.dataplane
 import v3io_frames
 
-import mlrun
-import mlrun.common.model_monitoring as model_monitoring_constants
-import mlrun.utils.model_monitoring
+import mlrun.common.model_monitoring.helpers
+import mlrun.common.schemas.model_monitoring
 import mlrun.utils.v3io_clients
 from mlrun.utils import logger
 
 from .model_endpoint_store import ModelEndpointStore
 
 
 class KVModelEndpointStore(ModelEndpointStore):
@@ -50,15 +51,15 @@
 
         :param endpoint: model endpoint dictionary that will be written into the DB.
         """
 
         self.client.kv.put(
             container=self.container,
             table_path=self.path,
-            key=endpoint[model_monitoring_constants.EventFieldType.UID],
+            key=endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.UID],
             attributes=endpoint,
         )
 
     def update_model_endpoint(
         self, endpoint_id: str, attributes: typing.Dict[str, typing.Any]
     ):
         """
@@ -117,29 +118,31 @@
         )
         endpoint = endpoint.output.item
 
         if not endpoint:
             raise mlrun.errors.MLRunNotFoundError(f"Endpoint {endpoint_id} not found")
 
         # For backwards compatability: replace null values for `error_count` and `metrics`
-        mlrun.utils.model_monitoring.validate_old_schema_fields(endpoint=endpoint)
+        self.validate_old_schema_fields(endpoint=endpoint)
 
         return endpoint
 
     def _get_path_and_container(self):
         """Getting path and container based on the model monitoring configurations"""
         path = mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default.format(
             project=self.project,
-            kind=model_monitoring_constants.ModelMonitoringStoreKinds.ENDPOINTS,
+            kind=mlrun.common.schemas.ModelMonitoringStoreKinds.ENDPOINTS,
         )
         (
             _,
             container,
             path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            path
+        )
         return path, container
 
     def list_model_endpoints(
         self,
         model: str = None,
         function: str = None,
         labels: typing.List[str] = None,
@@ -186,21 +189,25 @@
             logger.warning("Failed retrieving raw data from kv table", exc=exc)
             return endpoint_list
 
         # Create a list of model endpoints unique ids
         if uids is None:
             uids = []
             for item in items:
-                if model_monitoring_constants.EventFieldType.UID not in item:
+                if mlrun.common.schemas.model_monitoring.EventFieldType.UID not in item:
                     # This is kept for backwards compatibility - in old versions the key column named endpoint_id
                     uids.append(
-                        item[model_monitoring_constants.EventFieldType.ENDPOINT_ID]
+                        item[
+                            mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID
+                        ]
                     )
                 else:
-                    uids.append(item[model_monitoring_constants.EventFieldType.UID])
+                    uids.append(
+                        item[mlrun.common.schemas.model_monitoring.EventFieldType.UID]
+                    )
 
         # Add each relevant model endpoint to the model endpoints list
         for endpoint_id in uids:
             endpoint = self.get_model_endpoint(
                 endpoint_id=endpoint_id,
             )
             endpoint_list.append(endpoint)
@@ -214,22 +221,25 @@
         Delete all model endpoints resources in both KV and the time series DB.
 
         :param endpoints: A list of model endpoints flattened dictionaries.
         """
 
         # Delete model endpoint record from KV table
         for endpoint_dict in endpoints:
-            if model_monitoring_constants.EventFieldType.UID not in endpoint_dict:
+            if (
+                mlrun.common.schemas.model_monitoring.EventFieldType.UID
+                not in endpoint_dict
+            ):
                 # This is kept for backwards compatibility - in old versions the key column named endpoint_id
                 endpoint_id = endpoint_dict[
-                    model_monitoring_constants.EventFieldType.ENDPOINT_ID
+                    mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID
                 ]
             else:
                 endpoint_id = endpoint_dict[
-                    model_monitoring_constants.EventFieldType.UID
+                    mlrun.common.schemas.model_monitoring.EventFieldType.UID
                 ]
             self.delete_model_endpoint(
                 endpoint_id,
             )
 
         # Delete remain records in the KV
         all_records = self.client.kv.new_cursor(
@@ -258,15 +268,15 @@
 
         # Generate the required tsdb paths
         tsdb_path, filtered_path = self._generate_tsdb_paths()
 
         # Delete time series DB resources
         try:
             frames.delete(
-                backend=model_monitoring_constants.TimeSeriesTarget.TSDB,
+                backend=mlrun.common.schemas.model_monitoring.TimeSeriesTarget.TSDB,
                 table=filtered_path,
             )
         except (v3io_frames.errors.DeleteError, v3io_frames.errors.CreateError) as e:
             # Frames might raise an exception if schema file does not exist.
             logger.warning("Failed to delete TSDB schema file:", err=e)
             pass
 
@@ -315,33 +325,35 @@
         # Initialize metrics mapping dictionary
         metrics_mapping = {}
 
         # Getting the path for the time series DB
         events_path = (
             mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default.format(
                 project=self.project,
-                kind=model_monitoring_constants.ModelMonitoringStoreKinds.EVENTS,
+                kind=mlrun.common.schemas.ModelMonitoringStoreKinds.EVENTS,
             )
         )
         (
             _,
             container,
             events_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(events_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            events_path
+        )
 
         # Retrieve the raw data from the time series DB based on the provided metrics and time ranges
         frames_client = mlrun.utils.v3io_clients.get_frames_client(
             token=access_key,
             address=mlrun.mlconf.v3io_framesd,
             container=container,
         )
 
         try:
             data = frames_client.read(
-                backend=model_monitoring_constants.TimeSeriesTarget.TSDB,
+                backend=mlrun.common.schemas.model_monitoring.TimeSeriesTarget.TSDB,
                 table=events_path,
                 columns=["endpoint_id", *metrics],
                 filter=f"endpoint_id=='{endpoint_id}'",
                 start=start,
                 end=end,
             )
 
@@ -368,29 +380,33 @@
              [0] = Short path to the TSDB resources
              [1] = Filtered path to TSDB events without schema and container
         """
         # Full path for the time series DB events
         full_path = (
             mlrun.mlconf.model_endpoint_monitoring.store_prefixes.default.format(
                 project=self.project,
-                kind=model_monitoring_constants.ModelMonitoringStoreKinds.EVENTS,
+                kind=mlrun.common.schemas.ModelMonitoringStoreKinds.EVENTS,
             )
         )
 
         # Generate the main directory with the TSDB resources
-        tsdb_path = mlrun.utils.model_monitoring.parse_model_endpoint_project_prefix(
-            full_path, self.project
+        tsdb_path = (
+            mlrun.common.model_monitoring.helpers.parse_model_endpoint_project_prefix(
+                full_path, self.project
+            )
         )
 
         # Generate filtered path without schema and container as required by the frames object
         (
             _,
             _,
             filtered_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(full_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            full_path
+        )
         return tsdb_path, filtered_path
 
     @staticmethod
     def _build_kv_cursor_filter_expression(
         project: str,
         function: str = None,
         model: str = None,
@@ -437,12 +453,68 @@
                     filter_expression.append(f"{lbl}=='{value}'")
                 else:
                     filter_expression.append(f"exists({label})")
 
         # Apply top_level filter (remove endpoints that considered a child of a router)
         if top_level:
             filter_expression.append(
-                f"(endpoint_type=='{str(model_monitoring_constants.EndpointType.NODE_EP.value)}' "
-                f"OR  endpoint_type=='{str(model_monitoring_constants.EndpointType.ROUTER.value)}')"
+                f"(endpoint_type=='{str(mlrun.common.schemas.model_monitoring.EndpointType.NODE_EP.value)}' "
+                f"OR  endpoint_type=='{str(mlrun.common.schemas.model_monitoring.EndpointType.ROUTER.value)}')"
             )
 
         return " AND ".join(filter_expression)
+
+    @staticmethod
+    def validate_old_schema_fields(endpoint: dict):
+        """
+        Replace default null values for `error_count` and `metrics` for users that logged a model endpoint before 1.3.0.
+        In addition, this function also validates that the key name of the endpoint unique id is `uid` and not
+         `endpoint_id` that has been used before 1.3.0.
+
+        Leaving here for backwards compatibility which related to the model endpoint schema.
+
+        :param endpoint: An endpoint flattened dictionary.
+        """
+        warnings.warn(
+            "This will be deprecated in 1.3.0, and will be removed in 1.5.0",
+            # TODO: In 1.3.0 do changes in examples & demos In 1.5.0 remove
+            FutureWarning,
+        )
+
+        # Validate default value for `error_count`
+        # For backwards compatibility reasons, we validate that the model endpoint includes the `error_count` key
+        if (
+            mlrun.common.schemas.model_monitoring.EventFieldType.ERROR_COUNT in endpoint
+            and endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.ERROR_COUNT
+            ]
+            == "null"
+        ):
+            endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.ERROR_COUNT
+            ] = "0"
+
+        # Validate default value for `metrics`
+        # For backwards compatibility reasons, we validate that the model endpoint includes the `metrics` key
+        if (
+            mlrun.common.schemas.model_monitoring.EventFieldType.METRICS in endpoint
+            and endpoint[mlrun.common.schemas.model_monitoring.EventFieldType.METRICS]
+            == "null"
+        ):
+            endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.METRICS
+            ] = json.dumps(
+                {
+                    mlrun.common.schemas.model_monitoring.EventKeyMetrics.GENERIC: {
+                        mlrun.common.schemas.model_monitoring.EventLiveStats.LATENCY_AVG_1H: 0,
+                        mlrun.common.schemas.model_monitoring.EventLiveStats.PREDICTIONS_PER_SECOND: 0,
+                    }
+                }
+            )
+        # Validate key `uid` instead of `endpoint_id`
+        # For backwards compatibility reasons, we replace the `endpoint_id` with `uid` which is the updated key name
+        if mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID in endpoint:
+            endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.UID
+            ] = endpoint[
+                mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID
+            ]
```

## mlrun/model_monitoring/stores/model_endpoint_store.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/model_monitoring/stores/sql_model_endpoint_store.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -16,20 +16,18 @@
 import json
 import typing
 from datetime import datetime, timezone
 
 import pandas as pd
 import sqlalchemy as db
 
-import mlrun
-import mlrun.common.model_monitoring as model_monitoring_constants
-import mlrun.model_monitoring.model_endpoint
-import mlrun.utils.model_monitoring
-import mlrun.utils.v3io_clients
-from mlrun.api.db.sqldb.session import create_session, get_engine
+import mlrun.common.model_monitoring.helpers
+import mlrun.common.schemas.model_monitoring
+import mlrun.model_monitoring.helpers
+from mlrun.common.db.sql_session import create_session, get_engine
 from mlrun.utils import logger
 
 from .model_endpoint_store import ModelEndpointStore
 from .models import get_ModelEndpointsTable
 from .models.base import Base
 
 
@@ -55,18 +53,22 @@
         :param sql_connection_string: Valid connection string or a path to SQL database with model endpoints table.
         """
 
         super().__init__(project=project)
 
         self.sql_connection_string = (
             sql_connection_string
-            or mlrun.utils.model_monitoring.get_connection_string(project=self.project)
+            or mlrun.model_monitoring.helpers.get_connection_string(
+                project=self.project
+            )
         )
 
-        self.table_name = model_monitoring_constants.EventFieldType.MODEL_ENDPOINTS
+        self.table_name = (
+            mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_ENDPOINTS
+        )
 
         self._engine = get_engine(dsn=self.sql_connection_string)
         self.ModelEndpointsTable = get_ModelEndpointsTable(
             connection_string=self.sql_connection_string
         )
         # Create table if not exist. The `metadata` contains the `ModelEndpointsTable`
         if not self._engine.has_table(self.table_name):
@@ -80,18 +82,18 @@
 
         :param endpoint: model endpoint dictionary that will be written into the DB.
         """
 
         with self._engine.connect() as connection:
             # Adjust timestamps fields
             endpoint[
-                model_monitoring_constants.EventFieldType.FIRST_REQUEST
+                mlrun.common.schemas.model_monitoring.EventFieldType.FIRST_REQUEST
             ] = datetime.now(timezone.utc)
             endpoint[
-                model_monitoring_constants.EventFieldType.LAST_REQUEST
+                mlrun.common.schemas.model_monitoring.EventFieldType.LAST_REQUEST
             ] = datetime.now(timezone.utc)
 
             # Convert the result into a pandas Dataframe and write it into the database
             endpoint_df = pd.DataFrame([endpoint])
 
             endpoint_df.to_sql(
                 self.table_name, con=connection, index=False, if_exists="append"
@@ -108,15 +110,17 @@
                            of the attributes dictionary should exist in the SQL table.
 
         """
 
         # Update the model endpoint record using sqlalchemy ORM
         with create_session(dsn=self.sql_connection_string) as session:
             # Remove endpoint id (foreign key) from the update query
-            attributes.pop(model_monitoring_constants.EventFieldType.ENDPOINT_ID, None)
+            attributes.pop(
+                mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_ID, None
+            )
 
             # Generate and commit the update session query
             session.query(self.ModelEndpointsTable).filter(
                 self.ModelEndpointsTable.uid == endpoint_id
             ).update(attributes)
             session.commit()
 
@@ -197,40 +201,44 @@
             )
 
             # Apply filters
             if model:
                 query = self._filter_values(
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
-                    key_filter=model_monitoring_constants.EventFieldType.MODEL,
+                    key_filter=mlrun.common.schemas.model_monitoring.EventFieldType.MODEL,
                     filtered_values=[model],
                 )
             if function:
                 query = self._filter_values(
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
-                    key_filter=model_monitoring_constants.EventFieldType.FUNCTION,
+                    key_filter=mlrun.common.schemas.model_monitoring.EventFieldType.FUNCTION,
                     filtered_values=[function],
                 )
             if uids:
                 query = self._filter_values(
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
-                    key_filter=model_monitoring_constants.EventFieldType.UID,
+                    key_filter=mlrun.common.schemas.model_monitoring.EventFieldType.UID,
                     filtered_values=uids,
                     combined=False,
                 )
             if top_level:
-                node_ep = str(mlrun.common.model_monitoring.EndpointType.NODE_EP.value)
-                router_ep = str(mlrun.common.model_monitoring.EndpointType.ROUTER.value)
+                node_ep = str(
+                    mlrun.common.schemas.model_monitoring.EndpointType.NODE_EP.value
+                )
+                router_ep = str(
+                    mlrun.common.schemas.model_monitoring.EndpointType.ROUTER.value
+                )
                 endpoint_types = [node_ep, router_ep]
                 query = self._filter_values(
                     query=query,
                     model_endpoints_table=self.model_endpoints_table,
-                    key_filter=model_monitoring_constants.EventFieldType.ENDPOINT_TYPE,
+                    key_filter=mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_TYPE,
                     filtered_values=endpoint_types,
                     combined=False,
                 )
             # Convert the results from the DB into a ModelEndpoint object and append it to the model endpoints list
             for endpoint_record in query.all():
                 endpoint_dict = endpoint_record.to_dict()
 
@@ -299,15 +307,17 @@
         :param labels:        List of dictionary of required labels.
 
         :return: True if the labels exist in the endpoint labels dictionary, otherwise False.
         """
 
         # Convert endpoint labels into dictionary
         endpoint_labels = json.loads(
-            endpoint_dict.get(model_monitoring_constants.EventFieldType.LABELS)
+            endpoint_dict.get(
+                mlrun.common.schemas.model_monitoring.EventFieldType.LABELS
+            )
         )
 
         for label in labels:
             # Case 1 - label is a key=value pair
             if "=" in label:
                 lbl, value = list(map(lambda x: x.strip(), label.split("=")))
                 if lbl not in endpoint_labels or str(endpoint_labels[lbl]) != value:
@@ -327,15 +337,15 @@
 
         :param endpoints: A list of model endpoints flattened dictionaries.
         """
 
         for endpoint_dict in endpoints:
             # Delete model endpoint record from SQL table
             self.delete_model_endpoint(
-                endpoint_dict[model_monitoring_constants.EventFieldType.UID],
+                endpoint_dict[mlrun.common.schemas.model_monitoring.EventFieldType.UID],
             )
 
     def get_endpoint_real_time_metrics(
         self,
         endpoint_id: str,
         metrics: typing.List[str],
         start: str = "now-1h",
```

## mlrun/model_monitoring/stores/models/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/model_monitoring/stores/models/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/model_monitoring/stores/models/mysql.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,88 +13,106 @@
 # limitations under the License.
 #
 
 
 import sqlalchemy.dialects
 from sqlalchemy import Boolean, Column, Integer, String, Text
 
-import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.schemas.model_monitoring
 from mlrun.utils.db import BaseModel
 
 from .base import Base
 
 
 class ModelEndpointsTable(Base, BaseModel):
-    __tablename__ = model_monitoring_constants.EventFieldType.MODEL_ENDPOINTS
+    __tablename__ = mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_ENDPOINTS
 
     uid = Column(
-        model_monitoring_constants.EventFieldType.UID,
+        mlrun.common.schemas.model_monitoring.EventFieldType.UID,
         String(40),
         primary_key=True,
     )
-    state = Column(model_monitoring_constants.EventFieldType.STATE, String(10))
-    project = Column(model_monitoring_constants.EventFieldType.PROJECT, String(40))
+    state = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.STATE, String(10)
+    )
+    project = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.PROJECT, String(40)
+    )
     function_uri = Column(
-        model_monitoring_constants.EventFieldType.FUNCTION_URI,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FUNCTION_URI,
         String(255),
     )
-    model = Column(model_monitoring_constants.EventFieldType.MODEL, String(255))
+    model = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL, String(255)
+    )
     model_class = Column(
-        model_monitoring_constants.EventFieldType.MODEL_CLASS,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_CLASS,
         String(255),
     )
-    labels = Column(model_monitoring_constants.EventFieldType.LABELS, Text)
-    model_uri = Column(model_monitoring_constants.EventFieldType.MODEL_URI, String(255))
-    stream_path = Column(model_monitoring_constants.EventFieldType.STREAM_PATH, Text)
+    labels = Column(mlrun.common.schemas.model_monitoring.EventFieldType.LABELS, Text)
+    model_uri = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_URI, String(255)
+    )
+    stream_path = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.STREAM_PATH, Text
+    )
     algorithm = Column(
-        model_monitoring_constants.EventFieldType.ALGORITHM,
+        mlrun.common.schemas.model_monitoring.EventFieldType.ALGORITHM,
         String(255),
     )
-    active = Column(model_monitoring_constants.EventFieldType.ACTIVE, Boolean)
+    active = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.ACTIVE, Boolean
+    )
     monitoring_mode = Column(
-        model_monitoring_constants.EventFieldType.MONITORING_MODE,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MONITORING_MODE,
         String(10),
     )
     feature_stats = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_STATS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_STATS, Text
     )
     current_stats = Column(
-        model_monitoring_constants.EventFieldType.CURRENT_STATS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.CURRENT_STATS, Text
     )
     feature_names = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_NAMES, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_NAMES, Text
+    )
+    children = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.CHILDREN, Text
+    )
+    label_names = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.LABEL_NAMES, Text
     )
-    children = Column(model_monitoring_constants.EventFieldType.CHILDREN, Text)
-    label_names = Column(model_monitoring_constants.EventFieldType.LABEL_NAMES, Text)
 
     endpoint_type = Column(
-        model_monitoring_constants.EventFieldType.ENDPOINT_TYPE,
+        mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_TYPE,
         String(10),
     )
     children_uids = Column(
-        model_monitoring_constants.EventFieldType.CHILDREN_UIDS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.CHILDREN_UIDS, Text
     )
     drift_measures = Column(
-        model_monitoring_constants.EventFieldType.DRIFT_MEASURES, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_MEASURES, Text
     )
     drift_status = Column(
-        model_monitoring_constants.EventFieldType.DRIFT_STATUS,
+        mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_STATUS,
         String(40),
     )
     monitor_configuration = Column(
-        model_monitoring_constants.EventFieldType.MONITOR_CONFIGURATION,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MONITOR_CONFIGURATION,
         Text,
     )
     monitoring_feature_set_uri = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_SET_URI,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_SET_URI,
         String(255),
     )
     first_request = Column(
-        model_monitoring_constants.EventFieldType.FIRST_REQUEST,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FIRST_REQUEST,
         sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3),
     )
     last_request = Column(
-        model_monitoring_constants.EventFieldType.LAST_REQUEST,
+        mlrun.common.schemas.model_monitoring.EventFieldType.LAST_REQUEST,
         sqlalchemy.dialects.mysql.TIMESTAMP(fsp=3),
     )
-    error_count = Column(model_monitoring_constants.EventFieldType.ERROR_COUNT, Integer)
-    metrics = Column(model_monitoring_constants.EventFieldType.METRICS, Text)
+    error_count = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.ERROR_COUNT, Integer
+    )
+    metrics = Column(mlrun.common.schemas.model_monitoring.EventFieldType.METRICS, Text)
```

## mlrun/model_monitoring/stores/models/sqlite.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -12,87 +12,105 @@
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 
 from sqlalchemy import TIMESTAMP, Boolean, Column, Integer, String, Text
 
-import mlrun.common.model_monitoring as model_monitoring_constants
+import mlrun.common.schemas.model_monitoring
 from mlrun.utils.db import BaseModel
 
 from .base import Base
 
 
 class ModelEndpointsTable(Base, BaseModel):
-    __tablename__ = model_monitoring_constants.EventFieldType.MODEL_ENDPOINTS
+    __tablename__ = mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_ENDPOINTS
 
     uid = Column(
-        model_monitoring_constants.EventFieldType.UID,
+        mlrun.common.schemas.model_monitoring.EventFieldType.UID,
         String(40),
         primary_key=True,
     )
-    state = Column(model_monitoring_constants.EventFieldType.STATE, String(10))
-    project = Column(model_monitoring_constants.EventFieldType.PROJECT, String(40))
+    state = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.STATE, String(10)
+    )
+    project = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.PROJECT, String(40)
+    )
     function_uri = Column(
-        model_monitoring_constants.EventFieldType.FUNCTION_URI,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FUNCTION_URI,
         String(255),
     )
-    model = Column(model_monitoring_constants.EventFieldType.MODEL, String(255))
+    model = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL, String(255)
+    )
     model_class = Column(
-        model_monitoring_constants.EventFieldType.MODEL_CLASS,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_CLASS,
         String(255),
     )
-    labels = Column(model_monitoring_constants.EventFieldType.LABELS, Text)
-    model_uri = Column(model_monitoring_constants.EventFieldType.MODEL_URI, String(255))
-    stream_path = Column(model_monitoring_constants.EventFieldType.STREAM_PATH, Text)
+    labels = Column(mlrun.common.schemas.model_monitoring.EventFieldType.LABELS, Text)
+    model_uri = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.MODEL_URI, String(255)
+    )
+    stream_path = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.STREAM_PATH, Text
+    )
     algorithm = Column(
-        model_monitoring_constants.EventFieldType.ALGORITHM,
+        mlrun.common.schemas.model_monitoring.EventFieldType.ALGORITHM,
         String(255),
     )
-    active = Column(model_monitoring_constants.EventFieldType.ACTIVE, Boolean)
+    active = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.ACTIVE, Boolean
+    )
     monitoring_mode = Column(
-        model_monitoring_constants.EventFieldType.MONITORING_MODE,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MONITORING_MODE,
         String(10),
     )
     feature_stats = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_STATS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_STATS, Text
     )
     current_stats = Column(
-        model_monitoring_constants.EventFieldType.CURRENT_STATS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.CURRENT_STATS, Text
     )
     feature_names = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_NAMES, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_NAMES, Text
+    )
+    children = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.CHILDREN, Text
+    )
+    label_names = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.LABEL_NAMES, Text
     )
-    children = Column(model_monitoring_constants.EventFieldType.CHILDREN, Text)
-    label_names = Column(model_monitoring_constants.EventFieldType.LABEL_NAMES, Text)
     endpoint_type = Column(
-        model_monitoring_constants.EventFieldType.ENDPOINT_TYPE,
+        mlrun.common.schemas.model_monitoring.EventFieldType.ENDPOINT_TYPE,
         String(10),
     )
     children_uids = Column(
-        model_monitoring_constants.EventFieldType.CHILDREN_UIDS, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.CHILDREN_UIDS, Text
     )
     drift_measures = Column(
-        model_monitoring_constants.EventFieldType.DRIFT_MEASURES, Text
+        mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_MEASURES, Text
     )
     drift_status = Column(
-        model_monitoring_constants.EventFieldType.DRIFT_STATUS,
+        mlrun.common.schemas.model_monitoring.EventFieldType.DRIFT_STATUS,
         String(40),
     )
     monitor_configuration = Column(
-        model_monitoring_constants.EventFieldType.MONITOR_CONFIGURATION,
+        mlrun.common.schemas.model_monitoring.EventFieldType.MONITOR_CONFIGURATION,
         Text,
     )
     monitoring_feature_set_uri = Column(
-        model_monitoring_constants.EventFieldType.FEATURE_SET_URI,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FEATURE_SET_URI,
         String(255),
     )
     first_request = Column(
-        model_monitoring_constants.EventFieldType.FIRST_REQUEST,
+        mlrun.common.schemas.model_monitoring.EventFieldType.FIRST_REQUEST,
         TIMESTAMP,
     )
     last_request = Column(
-        model_monitoring_constants.EventFieldType.LAST_REQUEST,
+        mlrun.common.schemas.model_monitoring.EventFieldType.LAST_REQUEST,
         TIMESTAMP,
     )
-    error_count = Column(model_monitoring_constants.EventFieldType.ERROR_COUNT, Integer)
-    metrics = Column(model_monitoring_constants.EventFieldType.METRICS, Text)
+    error_count = Column(
+        mlrun.common.schemas.model_monitoring.EventFieldType.ERROR_COUNT, Integer
+    )
+    metrics = Column(mlrun.common.schemas.model_monitoring.EventFieldType.METRICS, Text)
```

## mlrun/platforms/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/platforms/iguazio.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/platforms/other.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/projects/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/projects/operations.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -108,15 +108,15 @@
         run2 = run_function("train", params={"label_columns": LABELS, "model_class": MODEL_CLASS},
                                      inputs={"dataset": run1.outputs["data"]})
 
     example (use in pipeline)::
 
         @dsl.pipeline(name="test pipeline", description="test")
         def my_pipe(url=""):
-            run1 = run_function("loaddata", params={"url": url})
+            run1 = run_function("loaddata", params={"url": url}, outputs=["data"])
             run2 = run_function("train", params={"label_columns": LABELS, "model_class": MODEL_CLASS},
                                          inputs={"dataset": run1.outputs["data"]})
 
         project.run(workflow_handler=my_pipe, arguments={"param1": 7})
 
     :param function:        name of the function (in the project) or function object
     :param handler:         name of the function handler
@@ -134,15 +134,15 @@
     :param labels:          labels to tag the job/run with ({key:val, ..})
     :param base_task:       task object to use as base
     :param watch:           watch/follow run log, True by default
     :param local:           run the function locally vs on the runtime/cluster
     :param verbose:         add verbose prints/logs
     :param project_object:  override the project object to use, will default to the project set in the runtime context.
     :param auto_build:      when set to True and the function require build it will be built on the first
-                            function run, use only if you dont plan on changing the build config between runs
+                            function run, use only if you do not plan on changing the build config between runs
     :param schedule:        ScheduleCronTrigger class instance or a standard crontab expression string
                             (which will be converted to the class using its `from_crontab` constructor),
                             see this link for help:
                             https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
     :param artifact_path:   path to store artifacts, when running in a workflow this will be set automatically
     :param notifications:   list of notifications to push when the run is completed
     :param returns:         List of log hints - configurations for how to log the returning values from the handler's
```

## mlrun/projects/pipelines.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -26,21 +26,17 @@
 from kfp import dsl
 from kfp.compiler import compiler
 
 import mlrun
 import mlrun.common.schemas
 import mlrun.utils.notifications
 from mlrun.errors import err_to_str
-from mlrun.utils import (
-    get_ui_url,
-    logger,
-    new_pipe_metadata,
-    parse_versioned_object_uri,
-)
+from mlrun.utils import get_ui_url, logger, new_pipe_metadata
 
+from ..common.helpers import parse_versioned_object_uri
 from ..config import config
 from ..run import _run_pipeline, wait_for_pipeline_completion
 from ..runtimes.pod import AutoMountType
 
 
 def get_workflow_engine(engine_kind, local=False):
     if pipeline_context.is_run_local(local):
@@ -831,16 +827,19 @@
         # If the user provided a source we want to load the project from the source
         # (like from a specific commit/branch from git repo) without changing the source of the project (save=False).
         save, current_source = (
             (False, source) if source else (True, project.spec.source)
         )
         if "://" not in current_source:
             raise mlrun.errors.MLRunInvalidArgumentError(
-                f"remote workflows can only be performed by a project with remote source,"
-                f" the given source '{current_source}' is not remote"
+                f"Remote workflows can only be performed by a project with remote source (e.g git:// or http://),"
+                f" but the specified source '{current_source}' is not remote. "
+                f"Either put your code in Git, or archive it and then set a source to it."
+                f" For more details, read"
+                f" https://docs.mlrun.org/en/latest/concepts/scheduled-jobs.html#scheduling-a-workflow"
             )
 
         # Creating the load project and workflow running function:
         load_and_run_fn, runspec = cls._prepare_load_and_run_function(
             source=current_source,
             project_name=project.name,
             save=save,
@@ -917,15 +916,14 @@
     spec.loader.exec_module(mod)
 
     setattr(mod, "funcs", functions)  # should be replaced with "functions" in future
     setattr(mod, "functions", functions)
     setattr(mod, "this_project", project)
 
     if hasattr(mod, "init_functions"):
-
         # TODO: remove in 1.5.0
         warnings.warn(
             "'init_functions' is deprecated in 1.3.0 and will be removed in 1.5.0. "
             "Place function initialization in the pipeline code.",
             FutureWarning,
         )
         getattr(mod, "init_functions")(functions, project, secrets)
@@ -935,15 +933,19 @@
         f.metadata.project = project.metadata.name
 
     if not handler and hasattr(mod, "kfpipeline"):
         handler = "kfpipeline"
     if not handler and hasattr(mod, "pipeline"):
         handler = "pipeline"
     if not handler or not hasattr(mod, handler):
-        raise ValueError(f"pipeline function ({handler or 'pipeline'}) not found")
+        raise ValueError(
+            f"'workflow_handler' is not defined. "
+            f"Either provide it as set_workflow argument, or include a function named"
+            f" '{handler or 'pipeline'}' in your workflow .py file."
+        )
 
     return getattr(mod, handler)
 
 
 def github_webhook(request):
     signature = request.headers.get("X-Hub-Signature")
     data = request.data
```

## mlrun/projects/project.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,14 +11,15 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import datetime
 import getpass
 import glob
 import http
+import importlib.util as imputil
 import json
 import os.path
 import pathlib
 import shutil
 import tempfile
 import typing
 import uuid
@@ -33,16 +34,15 @@
 import inflection
 import kfp
 import nuclio
 import requests
 import yaml
 from deprecated import deprecated
 
-import mlrun.common.model_monitoring as model_monitoring_constants
-import mlrun.common.schemas
+import mlrun.common.schemas.model_monitoring
 import mlrun.db
 import mlrun.errors
 import mlrun.runtimes
 import mlrun.runtimes.pod
 import mlrun.runtimes.utils
 import mlrun.utils.regex
 
@@ -110,17 +110,22 @@
     remote: str = None,
     from_template: str = None,
     secrets: dict = None,
     description: str = None,
     subpath: str = None,
     save: bool = True,
     overwrite: bool = False,
+    parameters: dict = None,
 ) -> "MlrunProject":
     """Create a new MLRun project, optionally load it from a yaml/zip/git template
 
+    A new project is created and returned, you can customize the project by placing a project_setup.py file
+    in the project root dir, it will be executed upon project creation or loading.
+
+
     example::
 
         # create a project with local and hub functions, a workflow, and an artifact
         project = mlrun.new_project("myproj", "./", init_git=True, description="my new project")
         project.set_function('prep_data.py', 'prep-data', image='mlrun/mlrun', handler='prep_data')
         project.set_function('hub://auto-trainer', 'train')
         project.set_artifact('data', Artifact(target_path=data_url))
@@ -136,33 +141,48 @@
         # initialize a local git, and register the git remote path
         project = mlrun.new_project("myproj", "./", init_git=True,
                                     remote="git://github.com/mlrun/project-demo.git",
                                     from_template="http://mysite/proj.zip")
         project.run("main", watch=True)
 
 
+    example using project_setup.py to init the project objects::
+
+            def setup(project):
+                project.set_function('prep_data.py', 'prep-data', image='mlrun/mlrun', handler='prep_data')
+                project.set_function('hub://auto-trainer', 'train')
+                project.set_artifact('data', Artifact(target_path=data_url))
+                project.set_workflow('main', "./myflow.py")
+                return project
+
+
     :param name:         project name
     :param context:      project local directory path (default value = "./")
     :param init_git:     if True, will git init the context dir
     :param user_project: add the current user name to the provided project name (making it unique per user)
     :param remote:       remote Git url
     :param from_template:     path to project YAML/zip file that will be used as a template
     :param secrets:      key:secret dict or SecretsStore used to download sources
     :param description:  text describing the project
     :param subpath:      project subpath (relative to the context dir)
     :param save:         whether to save the created project in the DB
     :param overwrite:    overwrite project using 'cascade' deletion strategy (deletes project resources)
                          if project with name exists
+    :param parameters:   key/value pairs to add to the project.spec.params
 
     :returns: project object
     """
     context = context or "./"
     name = _add_username_to_project_name_if_needed(name, user_project)
 
     if from_template:
+        if subpath:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "Unsupported option, cannot use subpath argument with project templates"
+            )
         if from_template.endswith(".yaml"):
             project = _load_project_file(from_template, name, secrets)
         elif from_template.startswith("git://"):
             clone_git(from_template, context, secrets, clone=True)
             shutil.rmtree(path.join(context, ".git"))
             project = _load_project_dir(context, name)
         elif from_template.endswith(".zip"):
@@ -189,63 +209,94 @@
     if remote and url != remote:
         project.create_remote(remote)
     elif url:
         project.spec._source = url
         project.spec.origin_url = url
     if description:
         project.spec.description = description
+    if parameters:
+        # Enable setting project parameters at load time, can be used to customize the project_setup
+        for key, val in parameters.items():
+            project.spec.params[key] = val
 
     _set_as_current_default_project(project)
 
     if save and mlrun.mlconf.dbpath:
         if overwrite:
-            logger.info(f"Deleting project {name} from MLRun DB due to overwrite")
+            logger.info(
+                "Overwriting project (by deleting and then creating)", name=name
+            )
             _delete_project_from_db(
                 name, secrets, mlrun.common.schemas.DeletionStrategy.cascade
             )
 
         try:
             project.save(store=False)
         except mlrun.errors.MLRunConflictError as exc:
             raise mlrun.errors.MLRunConflictError(
                 f"Project with name {name} already exists. "
                 "Use overwrite=True to overwrite the existing project."
             ) from exc
         logger.info(
-            f"Created and saved project {name}",
+            "Created and saved project",
+            name=name,
             from_template=from_template,
             overwrite=overwrite,
             context=context,
             save=save,
         )
+
+    # Hook for initializing the project using a project_setup script
+    project = project.setup(save and mlrun.mlconf.dbpath)
+
     return project
 
 
 def load_project(
     context: str = "./",
     url: str = None,
     name: str = None,
     secrets: dict = None,
     init_git: bool = False,
     subpath: str = None,
     clone: bool = False,
     user_project: bool = False,
     save: bool = True,
     sync_functions: bool = False,
+    parameters: dict = None,
 ) -> "MlrunProject":
     """Load an MLRun project from git or tar or dir
 
-    example::
+    MLRun looks for a project.yaml file with project definition and objects in the project root path
+    and use it to initialize the project, in addition it runs the project_setup.py file (if it exists)
+    for further customization.
+
+    Usage example::
 
         # Load the project and run the 'main' workflow.
         # When using git as the url source the context directory must be an empty or
         # non-existent folder as the git repo will be cloned there
         project = load_project("./demo_proj", "git://github.com/mlrun/project-demo.git")
         project.run("main", arguments={'data': data_url})
 
+
+    project_setup.py example::
+
+        def setup(project):
+            train_function = project.set_function(
+                "src/trainer.py",
+                name="mpi-training",
+                kind="mpijob",
+                image="mlrun/ml-models",
+            )
+            # Set the number of replicas for the training from the project parameter
+            train_function.spec.replicas = project.spec.params.get("num_replicas", 1)
+            return project
+
+
     :param context:         project local directory path (default value = "./")
     :param url:             name (in DB) or git or tar.gz or .zip sources archive path e.g.:
                             git://github.com/mlrun/demo-xgb-project.git
                             http://mysite/archived-project.zip
                             <project-name>
                             The git project should include the project yaml file.
                             If the project yaml file is in a sub-directory, must specify the sub-directory.
@@ -253,14 +304,15 @@
     :param secrets:         key:secret dict or SecretsStore used to download sources
     :param init_git:        if True, will git init the context dir
     :param subpath:         project subpath (within the archive)
     :param clone:           if True, always clone (delete any existing content)
     :param user_project:    add the current user name to the project name (for db:// prefixes)
     :param save:            whether to save the created project and artifact in the DB
     :param sync_functions:  sync the project's functions into the project object (will be saved to the DB if save=True)
+    :param parameters:      key/value pairs to add to the project.spec.params
 
     :returns: project object
     """
     if not context:
         raise ValueError("valid context (local dir path) must be provided")
 
     secrets = secrets or {}
@@ -278,52 +330,67 @@
             url, repo = clone_git(url, context, secrets, clone)
             # Validate that git source includes branch and refs
             url = ensure_git_branch(url=url, repo=repo)
         elif url.endswith(".tar.gz"):
             clone_tgz(url, context, secrets, clone)
         elif url.endswith(".zip"):
             clone_zip(url, context, secrets, clone)
-        else:
+        elif url.startswith("db://") or "://" not in url:
             project = _load_project_from_db(url, secrets, user_project)
             project.spec.context = context
             if not path.isdir(context):
                 makedirs(context)
             project.spec.subpath = subpath or project.spec.subpath
             from_db = True
+        else:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                "Unsupported url scheme, supported schemes are: git://, db:// or "
+                ".zip/.tar.gz/.yaml file path (could be local or remote) or project name which will be loaded from DB"
+            )
 
     if not repo:
         repo, url = init_repo(context, url, init_git)
 
     if not project:
         project = _load_project_dir(context, name, subpath)
 
     if not project.metadata.name:
         raise ValueError("project name must be specified")
+
+    if parameters:
+        # Enable setting project parameters at load time, can be used to customize the project_setup
+        for key, val in parameters.items():
+            project.spec.params[key] = val
+
     if not from_db:
         project.spec.source = url or project.spec.source
         project.spec.origin_url = url or project.spec.origin_url
         # Remove original owner name for avoiding possible conflicts when loading project from remote
         project.spec.owner = None
 
     project.spec.repo = repo
     if repo:
         try:
             # handle cases where active_branch is not set (e.g. in Gitlab CI)
             project.spec.branch = repo.active_branch.name
         except Exception:
             pass
 
-    if save and mlrun.mlconf.dbpath:
+    to_save = save and mlrun.mlconf.dbpath
+    if to_save:
         project.save()
+
+    # Hook for initializing the project using a project_setup script
+    project = project.setup(to_save)
+
+    if to_save:
         project.register_artifacts()
-        if sync_functions:
-            project.sync_functions(names=project.get_function_names(), save=True)
 
-    elif sync_functions:
-        project.sync_functions(names=project.get_function_names(), save=False)
+    if sync_functions:
+        project.sync_functions(save=to_save)
 
     _set_as_current_default_project(project)
 
     return project
 
 
 def get_or_create_project(
@@ -333,98 +400,178 @@
     secrets: dict = None,
     init_git=False,
     subpath: str = None,
     clone: bool = False,
     user_project: bool = False,
     from_template: str = None,
     save: bool = True,
+    parameters: dict = None,
 ) -> "MlrunProject":
     """Load a project from MLRun DB, or create/import if doesnt exist
 
-    example::
+    MLRun looks for a project.yaml file with project definition and objects in the project root path
+    and use it to initialize the project, in addition it runs the project_setup.py file (if it exists)
+    for further customization.
+
+    Usage example::
 
         # load project from the DB (if exist) or the source repo
         project = get_or_create_project("myproj", "./", "git://github.com/mlrun/demo-xgb-project.git")
         project.pull("development")  # pull the latest code from git
         project.run("main", arguments={'data': data_url})  # run the workflow "main"
 
+
+    project_setup.py example::
+
+        def setup(project):
+            train_function = project.set_function(
+                "src/trainer.py",
+                name="mpi-training",
+                kind="mpijob",
+                image="mlrun/ml-models",
+            )
+            # Set the number of replicas for the training from the project parameter
+            train_function.spec.replicas = project.spec.params.get("num_replicas", 1)
+            return project
+
+
     :param name:         project name
     :param context:      project local directory path (default value = "./")
     :param url:          name (in DB) or git or tar.gz or .zip sources archive path e.g.:
                          git://github.com/mlrun/demo-xgb-project.git
                          http://mysite/archived-project.zip
     :param secrets:      key:secret dict or SecretsStore used to download sources
-    :param init_git:     if True, will excute `git init` on the context dir
+    :param init_git:     if True, will execute `git init` on the context dir
     :param subpath:      project subpath (within the archive/context)
     :param clone:        if True, always clone (delete any existing content)
     :param user_project: add the current username to the project name (for db:// prefixes)
     :param from_template:     path to project YAML file that will be used as from_template (for new projects)
     :param save:         whether to save the created project in the DB
+    :param parameters:   key/value pairs to add to the project.spec.params
+
     :returns: project object
     """
     context = context or "./"
+    spec_path = path.join(context, subpath or "", "project.yaml")
+    load_from_path = url or path.isfile(spec_path)
     try:
         # load project from the DB.
         # use `name` as `url` as we load the project from the DB
         project = load_project(
             context,
             name,
             name,
             secrets=secrets,
             init_git=init_git,
             subpath=subpath,
             clone=clone,
             user_project=user_project,
             # only loading project from db so no need to save it
             save=False,
+            parameters=parameters,
         )
-        logger.info(f"loaded project {name} from MLRun DB")
+        logger.info("Project loaded successfully", project_name=name)
         return project
 
     except mlrun.errors.MLRunNotFoundError:
-        spec_path = path.join(context, subpath or "", "project.yaml")
-        if url or path.isfile(spec_path):
-            # load project from archive or local project.yaml
-            project = load_project(
-                context,
-                url,
-                name,
-                secrets=secrets,
-                init_git=init_git,
-                subpath=subpath,
-                clone=clone,
-                user_project=user_project,
-                save=save,
-            )
-            message = f"loaded project {name} from {url or context}"
-            if save:
-                message = f"{message} and saved in MLRun DB"
-            logger.info(message)
-        else:
-            # create a new project
-            project = new_project(
-                name,
-                context,
-                init_git=init_git,
-                user_project=user_project,
-                from_template=from_template,
-                secrets=secrets,
-                subpath=subpath,
-                save=save,
-            )
-            message = f"created project {name}"
-            if save:
-                message = f"{message} and saved in MLRun DB"
-            logger.info(message)
+        logger.debug("Project not found in db", project_name=name)
+
+    # do not nest under "try" or else the exceptions raised below will be logged along with the "not found" message
+    if load_from_path:
+        # loads a project from archive or local project.yaml
+        logger.info("Loading project from path", project_name=name, path=url or context)
+        project = load_project(
+            context,
+            url,
+            name,
+            secrets=secrets,
+            init_git=init_git,
+            subpath=subpath,
+            clone=clone,
+            user_project=user_project,
+            save=save,
+            parameters=parameters,
+        )
+
+        logger.info(
+            "Project loaded successfully",
+            project_name=name,
+            path=url or context,
+            stored_in_db=save,
+        )
         return project
 
+    # create a new project
+    project = new_project(
+        name,
+        context,
+        init_git=init_git,
+        user_project=user_project,
+        from_template=from_template,
+        secrets=secrets,
+        subpath=subpath,
+        save=save,
+        parameters=parameters,
+    )
+    logger.info("Project created successfully", project_name=name, stored_in_db=save)
+    return project
+
+
+def _run_project_setup(
+    project: "MlrunProject", setup_file_path: str, save: bool = False
+):
+    """Run the project setup file if found
+
+    When loading a project MLRun will look for a project_setup.py file, if it is found
+    it will execute the setup(project) handler, which can enrich the project with additional
+    objects, functions, artifacts, etc.
+
+    Example::
+
+        def setup(project):
+            train_function = project.set_function(
+                "src/trainer.py",
+                name="mpi-training",
+                kind="mpijob",
+                image="mlrun/ml-models",
+            )
+            # Set the number of replicas for the training from the project parameter
+            train_function.spec.replicas = project.spec.params.get("num_replicas", 1)
+            return project
+
+    """
+    if not path.exists(setup_file_path):
+        return project
+    spec = imputil.spec_from_file_location("workflow", setup_file_path)
+    if spec is None:
+        raise ImportError(f"cannot import project setup file in {setup_file_path}")
+    mod = imputil.module_from_spec(spec)
+    spec.loader.exec_module(mod)
+
+    if hasattr(mod, "setup"):
+        try:
+            project = getattr(mod, "setup")(project)
+        except Exception as exc:
+            logger.error(
+                "Failed to run project_setup script",
+                setup_file_path=setup_file_path,
+                exc=mlrun.errors.err_to_str(exc),
+            )
+            raise exc
+        if save:
+            project.save()
+    else:
+        logger.warn("skipping setup, setup() handler was not found in project_setup.py")
+    return project
+
 
 def _load_project_dir(context, name="", subpath=""):
     subpath_str = subpath or ""
     fpath = path.join(context, subpath_str, "project.yaml")
+    setup_file_path = path.join(context, subpath_str, "project_setup.py")
     if path.isfile(fpath):
         with open(fpath) as fp:
             data = fp.read()
             struct = yaml.load(data, Loader=yaml.FullLoader)
             project = _project_instance_from_struct(struct, name)
             project.spec.context = context
 
@@ -436,14 +583,17 @@
                     "name": func.metadata.project,
                 },
                 "spec": {
                     "functions": [{"url": "function.yaml", "name": func.metadata.name}],
                 },
             }
         )
+    elif path.exists(setup_file_path):
+        # If there is a setup script do not force having project.yaml file
+        project = MlrunProject()
     else:
         raise mlrun.errors.MLRunNotFoundError(
             "project or function YAML not found in path"
         )
 
     project.spec.context = context
     project.metadata.name = name or project.metadata.name
@@ -545,14 +695,15 @@
         default_requirements: typing.Union[str, typing.List[str]] = None,
         desired_state=mlrun.common.schemas.ProjectState.online.value,
         owner=None,
         disable_auto_mount=None,
         workdir=None,
         default_image=None,
         build=None,
+        custom_packagers: typing.List[typing.Tuple[str, bool]] = None,
     ):
         self.repo = None
 
         self.description = description
         self.context = ""
         self._mountdir = None
         self._source = None
@@ -580,14 +731,19 @@
         self._function_definitions = {}
         self.functions = functions or []
         self.disable_auto_mount = disable_auto_mount
         self.default_image = default_image
 
         self.build = build
 
+        # A list of custom packagers to include when running the functions of the project. A custom packager is stored
+        # in a tuple where the first index is the packager module's path (str) and the second is a flag (bool) for
+        # whether it is mandatory for a run (raise exception on collection error) or not.
+        self.custom_packagers = custom_packagers or []
+
     @property
     def source(self) -> str:
         """source url or git repo"""
         if not self._source:
             if self.repo:
                 url = get_repo_url(self.repo)
                 if url:
@@ -744,34 +900,74 @@
             artifact["metadata"]["key"] = key
         self._artifacts[key] = artifact
 
     def remove_artifact(self, key):
         if key in self._artifacts:
             del self._artifacts[key]
 
+    @property
+    def build(self) -> ImageBuilder:
+        return self._build
+
+    @build.setter
+    def build(self, build):
+        self._build = self._verify_dict(build, "build", ImageBuilder)
+
+    def add_custom_packager(self, packager: str, is_mandatory: bool):
+        """
+        Add a custom packager from the custom packagers list.
+
+        :param packager:     The packager module path to add. For example, if a packager `MyPackager` is in the
+                             project's source at my_module.py, then the module path is: "my_module.MyPackager".
+        :param is_mandatory: Whether this packager must be collected during a run. If False, failing to collect it won't
+                             raise an error during the packagers collection phase.
+        """
+        # TODO: enable importing packagers from the hub.
+        if packager in [
+            custom_packager[0] for custom_packager in self.custom_packagers
+        ]:
+            logger.warn(
+                f"The packager's module path '{packager}' is already registered in the project."
+            )
+            return
+        self.custom_packagers.append((packager, is_mandatory))
+
+    def remove_custom_packager(self, packager: str):
+        """
+        Remove a custom packager from the custom packagers list.
+
+        :param packager: The packager module path to remove.
+
+        :raise MLRunInvalidArgumentError: In case the packager was not in the list.
+        """
+        # Look for the packager tuple in the list to remove it:
+        packager_tuple: typing.Tuple[str, bool] = None
+        for custom_packager in self.custom_packagers:
+            if custom_packager[0] == packager:
+                packager_tuple = custom_packager
+
+        # If not found, raise an error, otherwise remove:
+        if packager_tuple is None:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                f"The packager module path '{packager}' is not registered in the project, hence it cannot be removed."
+            )
+        self.custom_packagers.remove(packager_tuple)
+
     def _source_repo(self):
         src = self.source
         if src:
             return src.split("#")[0]
         return ""
 
     def _need_repo(self):
         for f in self._function_objects.values():
             if f.spec.build.source in [".", "./"]:
                 return True
         return False
 
-    @property
-    def build(self) -> ImageBuilder:
-        return self._build
-
-    @build.setter
-    def build(self, build):
-        self._build = self._verify_dict(build, "build", ImageBuilder)
-
     def get_code_path(self):
         """Get the path to the code root/workdir"""
         return path.join(self.context, self.workdir or self.subpath or "")
 
     def _replace_default_image_in_enriched_functions(self, previous_image, new_image):
         """
         Set a new project-default-image in functions that were already enriched.
@@ -943,28 +1139,31 @@
                 )
 
         self.spec.workdir = workdir or self.spec.workdir
         # reset function objects (to recalculate build attributes)
         self.sync_functions()
 
     def get_artifact_uri(
-        self, key: str, category: str = "artifact", tag: str = None
+        self, key: str, category: str = "artifact", tag: str = None, iter: int = None
     ) -> str:
         """return the project artifact uri (store://..) from the artifact key
 
         example::
 
-            uri = project.get_artifact_uri("my_model", category="model", tag="prod")
+            uri = project.get_artifact_uri("my_model", category="model", tag="prod", iter=0)
 
         :param key:  artifact key/name
         :param category:  artifact category (artifact, model, feature-vector, ..)
         :param tag:  artifact version tag, default to latest version
+        :param iter:  iteration number, default to no iteration
         """
         uri = f"store://{category}s/{self.metadata.name}/{key}"
-        if tag:
+        if iter is not None:
+            uri = f"{uri}#{iter}"
+        if tag is not None:
             uri = f"{uri}:{tag}"
         return uri
 
     def get_store_resource(self, uri):
         """get store resource object by uri"""
         return mlrun.datastore.get_store_resource(
             uri, secrets=self._secrets, project=self.metadata.name
@@ -1059,16 +1258,23 @@
         :param schedule:      ScheduleCronTrigger class instance or a standard crontab expression string
                               (which will be converted to the class using its `from_crontab` constructor),
                               see this link for help:
                               https://apscheduler.readthedocs.io/en/3.x/modules/triggers/cron.html#module-apscheduler.triggers.cron
         :param ttl:           pipeline ttl in secs (after that the pods will be removed)
         :param args:          argument values (key=value, ..)
         """
-        if not workflow_path:
-            raise ValueError("valid workflow_path must be specified")
+
+        # validate the provided workflow_path
+        if mlrun.utils.helpers.is_file_path_invalid(
+            self.spec.get_code_path(), workflow_path
+        ):
+            raise ValueError(
+                f"Invalid 'workflow_path': '{workflow_path}'. Please provide a valid URL/path to a file."
+            )
+
         if embed:
             if (
                 self.context
                 and not workflow_path.startswith("/")
                 # since the user may provide a path the includes the context,
                 # we need to make sure we don't add it twice
                 and not workflow_path.startswith(self.context)
@@ -1144,19 +1350,21 @@
 
     def register_artifacts(self):
         """register the artifacts in the MLRun DB (under this project)"""
         artifact_manager = self._get_artifact_manager()
         artifact_path = mlrun.utils.helpers.fill_artifact_path_template(
             self.spec.artifact_path or mlrun.mlconf.artifact_path, self.metadata.name
         )
+        # TODO: To correctly maintain the list of artifacts from an exported project,
+        #  we need to maintain the different trees that generated them
         producer = ArtifactProducer(
             "project",
             self.metadata.name,
             self.metadata.name,
-            tag=self._get_hexsha() or "latest",
+            tag=self._get_hexsha() or str(uuid.uuid4()),
         )
         for artifact_dict in self.spec.artifacts:
             if _is_imported_artifact(artifact_dict):
                 import_from = artifact_dict["import_from"]
                 if is_relative_path(import_from):
                     # source path should be relative to the project context
                     import_from = path.join(self.spec.get_code_path(), import_from)
@@ -1531,24 +1739,40 @@
         project.spec.branch = self.spec.branch
         project.spec.origin_url = self.spec.origin_url
         if sync:
             project.sync_functions()
         self.__dict__.update(project.__dict__)
         return project
 
+    def setup(self, save: bool = True) -> "MlrunProject":
+        """Run the project setup file if found
+
+        When loading a project MLRun will look for a project_setup.py file, if it is found
+        it will execute the setup(project) handler, which can enrich the project with additional
+        objects, functions, artifacts, etc.
+
+        :param save: save the project after the setup
+        """
+        # Hook for initializing the project using a project_setup script
+        setup_file_path = path.join(
+            self.context, self.spec.subpath or "", "project_setup.py"
+        )
+        return _run_project_setup(self, setup_file_path, save)
+
     def set_function(
         self,
         func: typing.Union[str, mlrun.runtimes.BaseRuntime] = None,
         name: str = "",
         kind: str = "",
         image: str = None,
         handler=None,
         with_repo: bool = None,
         tag: str = None,
         requirements: typing.Union[str, typing.List[str]] = None,
+        requirements_file: str = "",
     ) -> mlrun.runtimes.BaseRuntime:
         """update or add a function object to the project
 
         function can be provided as an object (func) or a .py/.ipynb/.yaml url
         support url prefixes::
 
             object (s3://, v3io://, ..)
@@ -1568,24 +1792,28 @@
 
             # by providing a list of packages
             proj.set_function('my.py', requirements=["requests", "pandas"])
 
             # by providing a path to a pip requirements file
             proj.set_function('my.py', requirements="requirements.txt")
 
-        :param func:      function object or spec/code url, None refers to current Notebook
-        :param name:      name of the function (under the project)
-        :param kind:      runtime kind e.g. job, nuclio, spark, dask, mpijob
-                          default: job
-        :param image:     docker image to be used, can also be specified in
-                          the function object/yaml
-        :param handler:   default function handler to invoke (can only be set with .py/.ipynb files)
-        :param with_repo: add (clone) the current repo to the build source
-        :param tag:       function version tag (none for 'latest', can only be set with .py/.ipynb files)
-        :param requirements:    list of python packages or pip requirements file path
+        :param func:                function object or spec/code url, None refers to current Notebook
+        :param name:                name of the function (under the project), can be specified with a tag to support
+                                    versions (e.g. myfunc:v1)
+        :param kind:                runtime kind e.g. job, nuclio, spark, dask, mpijob
+                                    default: job
+        :param image:               docker image to be used, can also be specified in
+                                    the function object/yaml
+        :param handler:             default function handler to invoke (can only be set with .py/.ipynb files)
+        :param with_repo:           add (clone) the current repo to the build source
+        :param tag:                 function version tag (none for 'latest', can only be set with .py/.ipynb files)
+                                    if tag is specified and name is empty, the function key (under the project)
+                                    will be enriched with the tag value. (i.e. 'function-name:tag')
+        :param requirements:        a list of python packages
+        :param requirements_file:   path to a python requirements file
 
         :returns: project object
         """
         if func is None and not _has_module(handler, kind):
             # if function path is not provided and it is not a module (no ".")
             # use the current notebook as default
             if not is_ipython:
@@ -1612,35 +1840,46 @@
                 "image": image,
                 "handler": handler,
                 "with_repo": with_repo,
                 "tag": tag,
                 "requirements": requirements,
             }
             func = {k: v for k, v in function_dict.items() if v}
-            name, function_object = _init_function_from_dict(func, self)
-            func["name"] = name
+            resolved_function_name, function_object = _init_function_from_dict(
+                func, self
+            )
+            func["name"] = resolved_function_name
         elif hasattr(func, "to_dict"):
-            name, function_object = _init_function_from_obj(func, self, name=name)
+            resolved_function_name, function_object = _init_function_from_obj(
+                func, self, name=name
+            )
             if handler:
                 raise ValueError(
                     "default handler cannot be set for existing function object"
                 )
             if image:
                 function_object.spec.image = image
             if with_repo:
                 # mark source to be enriched before run with project source (enrich_function_object)
                 function_object.spec.build.source = "./"
             if requirements:
-                function_object.with_requirements(requirements)
-            if not name:
+                function_object.with_requirements(
+                    requirements, requirements_file=requirements_file
+                )
+            if not resolved_function_name:
                 raise ValueError("function name must be specified")
         else:
             raise ValueError("func must be a function url or object")
 
-        self.spec.set_function(name, function_object, func)
+        # if function name was not explicitly provided,
+        # we use the resolved name (from the function object) and add the tag
+        if tag and not name and ":" not in resolved_function_name:
+            resolved_function_name = f"{resolved_function_name}:{tag}"
+
+        self.spec.set_function(resolved_function_name, function_object, func)
         return function_object
 
     def remove_function(self, name):
         """remove a function from a project
 
         :param name:    name of the function (under the project)
         """
@@ -1649,25 +1888,30 @@
     def get_function(
         self,
         key,
         sync=False,
         enrich=False,
         ignore_cache=False,
         copy_function=True,
+        tag: str = "",
     ) -> mlrun.runtimes.BaseRuntime:
         """get function object by name
 
-        :param key:   name of key for search
-        :param sync:  will reload/reinit the function from the project spec
-        :param enrich: add project info/config/source info to the function object
-        :param ignore_cache: read the function object from the DB (ignore the local cache)
-        :param copy_function: return a copy of the function object
+        :param key:             name of key for search
+        :param sync:            will reload/reinit the function from the project spec
+        :param enrich:          add project info/config/source info to the function object
+        :param ignore_cache:    read the function object from the DB (ignore the local cache)
+        :param copy_function:   return a copy of the function object
+        :param tag:             provide if the function key is tagged under the project (function was set with a tag)
 
         :returns: function object
         """
+        if tag and ":" not in key:
+            key = f"{key}:{tag}"
+
         function, err = self._get_function(
             mlrun.utils.normalize_name(key), sync, ignore_cache
         )
         if not function and "_" in key:
             function, err = self._get_function(key, sync, ignore_cache)
 
         if not function:
@@ -1702,15 +1946,15 @@
             except requests.HTTPError as exc:
                 if exc.response.status_code != http.HTTPStatus.NOT_FOUND.value:
                     raise exc
                 return None, exc
 
         return function, None
 
-    def get_function_objects(self) -> typing.Dict[str, mlrun.runtimes.BaseRuntime]:
+    def get_function_objects(self) -> FunctionsDict:
         """ "get a virtual dict with all the project functions ready for use in a pipeline"""
         self.sync_functions()
         return FunctionsDict(self)
 
     def get_function_names(self) -> typing.List[str]:
         """get a list of all the project function names"""
         return [func["name"] for func in self.spec.functions]
@@ -2032,15 +2276,18 @@
         if need_repo and self.spec.repo and not self.spec.source:
             raise ProjectError(
                 "remote repo is not defined, use .create_remote() + push()"
             )
 
         self.sync_functions(always=sync)
         if not self.spec._function_objects:
-            raise ValueError("no functions in the project")
+            raise ValueError(
+                "There are no functions in the project."
+                " Make sure you've set your functions with project.set_function()."
+            )
 
         if not name and not workflow_path and not workflow_handler:
             if self.spec.workflows:
                 name = list(self.spec._workflows.keys())[0]
             else:
                 raise ValueError("workflow name or path must be specified")
 
@@ -2245,29 +2492,29 @@
         :param endpoint_store_connection: Endpoint store connection string
         :param stream_path:               Path to the model monitoring stream
         """
 
         secrets_dict = {}
         if access_key:
             secrets_dict[
-                model_monitoring_constants.ProjectSecretKeys.ACCESS_KEY
+                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ACCESS_KEY
             ] = access_key
 
         if endpoint_store_connection:
             secrets_dict[
-                model_monitoring_constants.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
+                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.ENDPOINT_STORE_CONNECTION
             ] = endpoint_store_connection
 
         if stream_path:
             if stream_path.startswith("kafka://") and "?topic" in stream_path:
                 raise mlrun.errors.MLRunInvalidArgumentError(
                     "Custom kafka topic is not allowed"
                 )
             secrets_dict[
-                model_monitoring_constants.ProjectSecretKeys.STREAM_PATH
+                mlrun.common.schemas.model_monitoring.ProjectSecretKeys.STREAM_PATH
             ] = stream_path
 
         self.set_secrets(
             secrets=secrets_dict,
             provider=mlrun.common.schemas.SecretProviderName.kubernetes,
         )
 
@@ -2614,16 +2861,17 @@
         Examples::
 
             # Get latest version of all artifacts in project
             latest_artifacts = project.list_artifacts('', tag='latest')
             # check different artifact versions for a specific artifact, return as objects list
             result_versions = project.list_artifacts('results', tag='*').to_objects()
 
-        :param name: Name of artifacts to retrieve. Name is used as a like query, and is not case-sensitive. This means
-            that querying for ``name`` may return artifacts named ``my_Name_1`` or ``surname``.
+        :param name: Name of artifacts to retrieve. Name with '~' prefix is used as a like query, and is not
+            case-sensitive. This means that querying for ``~name`` may return artifacts named
+            ``my_Name_1`` or ``surname``.
         :param tag: Return artifacts assigned this tag.
         :param labels: Return artifacts that have these labels. Labels can either be a dictionary {"label": "value"} or
             a list of "label=value" (match label key and value) or "label" (match just label key) strings.
         :param since: Not in use in :py:class:`HTTPRunDB`.
         :param until: Not in use in :py:class:`HTTPRunDB`.
         :param iter: Return artifacts from a specific iteration (where ``iter=0`` means the root iteration). If
             ``None`` (default) return artifacts from all iterations.
@@ -2661,16 +2909,17 @@
 
         Examples::
 
             # Get latest version of all models in project
             latest_models = project.list_models('', tag='latest')
 
 
-        :param name: Name of artifacts to retrieve. Name is used as a like query, and is not case-sensitive. This means
-            that querying for ``name`` may return artifacts named ``my_Name_1`` or ``surname``.
+        :param name: Name of artifacts to retrieve. Name with '~' prefix is used as a like query, and is not
+            case-sensitive. This means that querying for ``~name`` may return artifacts named
+            ``my_Name_1`` or ``surname``.
         :param tag: Return artifacts assigned this tag.
         :param labels: Return artifacts that have these labels. Labels can either be a dictionary {"label": "value"} or
             a list of "label=value" (match label key and value) or "label" (match just label key) strings.
         :param since: Not in use in :py:class:`HTTPRunDB`.
         :param until: Not in use in :py:class:`HTTPRunDB`.
         :param iter: Return artifacts from a specific iteration (where ``iter=0`` means the root iteration). If
             ``None`` (default) return artifacts from all iterations.
@@ -2708,47 +2957,51 @@
         functions = db.list_functions(name, self.metadata.name, tag=tag, labels=labels)
         if functions:
             # convert dict to function objects
             return [mlrun.new_function(runtime=func) for func in functions]
 
     def list_runs(
         self,
-        name=None,
-        uid=None,
-        labels=None,
-        state=None,
-        sort=True,
-        last=0,
-        iter=False,
-        start_time_from: datetime.datetime = None,
-        start_time_to: datetime.datetime = None,
-        last_update_time_from: datetime.datetime = None,
-        last_update_time_to: datetime.datetime = None,
+        name: Optional[str] = None,
+        uid: Optional[Union[str, List[str]]] = None,
+        labels: Optional[Union[str, List[str]]] = None,
+        state: Optional[str] = None,
+        sort: bool = True,
+        last: int = 0,
+        iter: bool = False,
+        start_time_from: Optional[datetime.datetime] = None,
+        start_time_to: Optional[datetime.datetime] = None,
+        last_update_time_from: Optional[datetime.datetime] = None,
+        last_update_time_to: Optional[datetime.datetime] = None,
         **kwargs,
     ) -> mlrun.lists.RunList:
         """Retrieve a list of runs, filtered by various options.
 
         The returned result is a `` (list of dict), use `.to_objects()` to convert it to a list of RunObjects,
         `.show()` to view graphically in Jupyter, `.to_df()` to convert to a DataFrame, and `compare()` to
         generate comparison table and PCP plot.
 
         Example::
 
             # return a list of runs matching the name and label and compare
             runs = project.list_runs(name='download', labels='owner=admin')
             runs.compare()
+
+            # multi-label filter can also be provided
+            runs = project.list_runs(name='download', labels=["kind=job", "owner=admin"])
+
             # If running in Jupyter, can use the .show() function to display the results
             project.list_runs(name='').show()
 
 
         :param name: Name of the run to retrieve.
         :param uid: Unique ID of the run.
         :param project: Project that the runs belongs to.
-        :param labels: List runs that have a specific label assigned. Currently only a single label filter can be
-            applied, otherwise result will be empty.
+        :param labels: List runs that have specific labels assigned. a single or multi label filter can be
+            applied.
         :param state: List only runs whose state is specified.
         :param sort: Whether to sort the result according to their start time. Otherwise, results will be
             returned by their internal order in the DB (order will not be guaranteed).
         :param last: Deprecated - currently not used.
         :param iter: If ``True`` return runs from all iterations. Otherwise, return only runs whose ``iter`` is 0.
         :param start_time_from: Filter by run start time in ``[start_time_from, start_time_to]``.
         :param start_time_to: Filter by run start time in ``[start_time_from, start_time_to]``.
@@ -2769,21 +3022,61 @@
             start_time_from=start_time_from,
             start_time_to=start_time_to,
             last_update_time_from=last_update_time_from,
             last_update_time_to=last_update_time_to,
             **kwargs,
         )
 
+    def get_custom_packagers(self) -> typing.List[typing.Tuple[str, bool]]:
+        """
+        Get the custom packagers registered in the project.
+
+        :return: A list of the custom packagers module paths.
+        """
+        # Return a copy so the user won't be able to edit the list by the reference returned (no need for deep copy as
+        # tuples do not support item assignment):
+        return self.spec.custom_packagers.copy()
+
+    def add_custom_packager(self, packager: str, is_mandatory: bool):
+        """
+        Add a custom packager from the custom packagers list. All project's custom packagers are added to each project
+        function.
+
+        **Notice** that in order to run a function with the custom packagers included, you must set a source for the
+        project (using the `project.set_source` method) with the parameter `pull_at_runtime=True` so the source code of
+        the packagers will be able to be imported.
+
+        :param packager:     The packager module path to add. For example, if a packager `MyPackager` is in the
+                             project's source at my_module.py, then the module path is: "my_module.MyPackager".
+        :param is_mandatory: Whether this packager must be collected during a run. If False, failing to collect it won't
+                             raise an error during the packagers collection phase.
+        """
+        self.spec.add_custom_packager(packager=packager, is_mandatory=is_mandatory)
+
+    def remove_custom_packager(self, packager: str):
+        """
+        Remove a custom packager from the custom packagers list.
+
+        :param packager: The packager module path to remove.
+
+        :raise MLRunInvalidArgumentError: In case the packager was not in the list.
+        """
+        self.spec.remove_custom_packager(packager=packager)
+
 
 def _set_as_current_default_project(project: MlrunProject):
     mlrun.mlconf.default_project = project.metadata.name
     pipeline_context.set(project)
 
 
-def _init_function_from_dict(f, project, name=None):
+def _init_function_from_dict(
+    f: dict,
+    project: MlrunProject,
+    name: typing.Optional[str] = None,
+) -> typing.Tuple[str, mlrun.runtimes.BaseRuntime]:
     name = name or f.get("name", "")
     url = f.get("url", "")
     kind = f.get("kind", "")
     image = f.get("image", None)
     handler = f.get("handler", None)
     with_repo = f.get("with_repo", False)
     requirements = f.get("requirements", None)
@@ -2849,15 +3142,19 @@
         func.spec.build.source = "./"
     if requirements:
         func.with_requirements(requirements)
 
     return _init_function_from_obj(func, project, name)
 
 
-def _init_function_from_obj(func, project, name=None):
+def _init_function_from_obj(
+    func: mlrun.runtimes.BaseRuntime,
+    project: MlrunProject,
+    name: typing.Optional[str] = None,
+) -> typing.Tuple[str, mlrun.runtimes.BaseRuntime]:
     build = func.spec.build
     if project.spec.origin_url:
         origin = project.spec.origin_url
         try:
             if project.spec.repo:
                 origin += "#" + project.spec.repo.head.commit.hexsha
         except Exception:
```

## mlrun/runtimes/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -21,16 +21,14 @@
     "HandlerRuntime",
     "RemoteRuntime",
     "ServingRuntime",
     "DaskCluster",
     "RemoteSparkRuntime",
 ]
 
-
-from mlrun.runtimes.package.context_handler import ArtifactType, ContextHandler
 from mlrun.runtimes.utils import (
     resolve_mpijob_crd_version,
     resolve_spark_operator_version,
 )
 
 from .base import BaseRuntime, BaseRuntimeHandler, RunError, RuntimeClassMode  # noqa
 from .constants import MPIJobCRDVersions
```

## mlrun/runtimes/base.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,30 +10,29 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 import enum
 import getpass
 import http
+import re
 import traceback
 import warnings
 from abc import ABC, abstractmethod
 from base64 import b64encode
 from datetime import datetime, timedelta, timezone
 from os import environ
 from typing import Callable, Dict, List, Optional, Tuple, Union
 
 import requests.exceptions
 from deprecated import deprecated
 from kubernetes.client.rest import ApiException
 from nuclio.build import mlrun_footer
 from sqlalchemy.orm import Session
 
-import mlrun.api.db.sqldb.session
-import mlrun.api.utils.singletons.db
 import mlrun.common.schemas
 import mlrun.errors
 import mlrun.launcher.factory
 import mlrun.utils.helpers
 import mlrun.utils.notifications
 import mlrun.utils.regex
 from mlrun.api.constants import LogSources
@@ -113,15 +112,14 @@
         description=None,
         workdir=None,
         default_handler=None,
         pythonpath=None,
         disable_auto_mount=False,
         clone_target_dir=None,
     ):
-
         self.command = command or ""
         self.image = image or ""
         self.mode = mode
         self.args = args or []
         self.rundb = None
         self.description = description or ""
         self.workdir = workdir
@@ -337,16 +335,16 @@
                           "<key> : <type>". Available artifact types can be seen in `mlrun.ArtifactType`. If no
                           artifact type is specified, the object's default artifact type will be used.
                         * A dictionary of configurations to use when logging. Further info per object type and artifact
                           type can be given there. The artifact key must appear in the dictionary as "key": "the_key".
 
         :return: Run context object (RunObject) with run metadata, results and status
         """
-        launcher = mlrun.launcher.factory.LauncherFactory.create_launcher(
-            self._is_remote, local
+        launcher = mlrun.launcher.factory.LauncherFactory().create_launcher(
+            self._is_remote, local=local
         )
         return launcher.launch(
             runtime=self,
             task=runspec,
             handler=handler,
             name=name,
             project=project,
@@ -595,14 +593,20 @@
 
         return resp
 
     def _force_handler(self, handler):
         if not handler:
             raise RunError(f"handler must be provided for {self.kind} runtime")
 
+    def _has_pipeline_param(self) -> bool:
+        # check if the runtime has pipeline parameters
+        # https://www.kubeflow.org/docs/components/pipelines/v1/sdk/parameters/
+        matches = re.findall(mlrun.utils.regex.pipeline_param[0], self.to_json())
+        return bool(matches)
+
     def full_image_path(
         self, image=None, client_version: str = None, client_python_version: str = None
     ):
         image = image or self.spec.image or ""
 
         image = enrich_image_url(image, client_version, client_python_version)
         if not image.startswith("."):
@@ -674,18 +678,17 @@
                                   artifact type can be given there. The artifact key must appear in the dictionary as
                                   "key": "the_key".
         :param auto_build:      when set to True and the function require build it will be built on the first
                                 function run, use only if you dont plan on changing the build config between runs
         :return: KubeFlow containerOp
         """
 
-        # if self.spec.image and not image:
-        #     image = self.full_image_path()
-
-        if use_db:
+        # if the function contain KFP PipelineParams (futures) pass the full spec to the
+        # ContainerOp this way KFP will substitute the params with previous step outputs
+        if use_db and not self._has_pipeline_param():
             # if the same function is built as part of the pipeline we do not use the versioned function
             # rather the latest function w the same tag so we can pick up the updated image/status
             versioned = False if hasattr(self, "_build_in_pipeline") else True
             url = self.save(versioned=versioned, refresh=True)
         else:
             url = None
 
@@ -836,15 +839,15 @@
 
     def prepare_image_for_deploy(self):
         """
         if a function has a 'spec.image' it is considered to be deployed,
         but because we allow the user to set 'spec.image' for usability purposes,
         we need to check whether this is a built image or it requires to be built on top.
         """
-        launcher = mlrun.launcher.factory.LauncherFactory.create_launcher(
+        launcher = mlrun.launcher.factory.LauncherFactory().create_launcher(
             is_remote=self._is_remote
         )
         launcher.prepare_image_for_deploy(self)
 
     def export(self, target="", format=".yaml", secrets=None, strip=True):
         """save function spec to a local/remote path (default to./function.yaml)
 
@@ -870,15 +873,15 @@
         target = target or "function.yaml"
         datastore, subpath = stores.get_or_create_store(target)
         datastore.put(subpath, data)
         logger.info(f"function spec saved to path: {target}")
         return self
 
     def save(self, tag="", versioned=False, refresh=False) -> str:
-        launcher = mlrun.launcher.factory.LauncherFactory.create_launcher(
+        launcher = mlrun.launcher.factory.LauncherFactory().create_launcher(
             is_remote=self._is_remote
         )
         return launcher.save_function(
             self, tag=tag, versioned=versioned, refresh=refresh
         )
 
     def to_dict(self, fields=None, exclude=None, strip=False):
@@ -1666,15 +1669,14 @@
                             > now
                         ):
                             continue
 
                     # if resources are tightly coupled to the run object - we want to perform some actions on the run
                     # object before deleting them
                     if self._are_resources_coupled_to_run_object():
-
                         try:
                             self._pre_deletion_runtime_resource_run_actions(
                                 db,
                                 db_session,
                                 crd_object,
                                 desired_run_state,
                             )
@@ -2046,15 +2048,14 @@
             run = {"metadata": {"project": project, "name": name, "uid": uid}}
         db_run_state = run.get("status", {}).get("state")
         if db_run_state:
             if db_run_state == run_state:
                 return False, run_state
             # if the current run state is terminal and different than the desired - log
             if db_run_state in RunStates.terminal_states():
-
                 # This can happen when the SDK running in the user's Run updates the Run's state to terminal, but
                 # before it exits, when the runtime resource is still running, the API monitoring (here) is executed
                 if run_state not in RunStates.terminal_states():
                     now = datetime.now(timezone.utc)
                     last_update_str = run.get("status", {}).get("last_update")
                     if last_update_str is not None:
                         last_update = datetime.fromisoformat(last_update_str)
```

## mlrun/runtimes/constants.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/daskjob.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/funcdoc.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -206,42 +206,54 @@
         "doc": "",
         "default": "",
     }
 
 
 def ann_type(ann):
     if hasattr(ann, "slice"):
-        name = ann.value.id
+        if isinstance(ann.value, ast.Attribute):
+            # value is an attribute, e.g. b of a.b - get the full path
+            name = get_attr_path(ann.value)
+        else:
+            name = ann.value.id
         inner = ", ".join(ann_type(e) for e in iter_elems(ann.slice))
         return f"{name}[{inner}]"
 
     if isinstance(ann, ast.Attribute):
+        if isinstance(ann.value, ast.Attribute):
+            # value is an attribute, e.g. b of a.b - get the full path
+            return get_attr_path(ann)
+
         return ann.attr
 
     return getattr(ann, "id", "")
 
 
+def get_attr_path(ann: ast.Attribute):
+    if isinstance(ann.value, ast.Attribute):
+        # value is an attribute, e.g. b of a.b - get the full path
+        return f"{get_attr_path(ann.value)}.{ann.attr}"
+
+    # value can be a subscript or name - get its annotation type and append the attribute
+    return f"{ann_type(ann.value)}.{ann.attr}"
+
+
 def iter_elems(ann):
     """
     Gets the elements of an ast.Subscript.slice, e.g. Union[int, str] -> [int, str]
     """
     if hasattr(ann, "elts"):
         return ann.elts
     if hasattr(ann, "id"):
         return [ann]
     if hasattr(ann.value, "elts"):
         return ann.value.elts
     if not hasattr(ann, "slice"):
         return [ann.value]
 
-    # From python 3.9, slice is an expr and we should evaluate it recursively. Left this for backward compatibility.
-    elif hasattr(ann.slice, "elts"):
-        return ann.slice.elts
-    elif hasattr(ann.slice, "value"):
-        return [ann.slice.value]
     return [ann]
 
 
 class ASTVisitor(ast.NodeVisitor):
     def __init__(self):
         self.funcs = []
         self.exprs = []
```

## mlrun/runtimes/function.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -82,34 +82,14 @@
             return False
 
         if parsed_current_version >= parsed_min_version:
             return True
     return False
 
 
-def is_nuclio_version_in_range(min_version: str, max_version: str) -> bool:
-    """
-    Return whether the Nuclio version is in the range, inclusive for min, exclusive for max - [min, max)
-    """
-    try:
-        parsed_min_version = semver.VersionInfo.parse(min_version)
-        parsed_max_version = semver.VersionInfo.parse(max_version)
-        nuclio_version = mlrun.runtimes.utils.resolve_nuclio_version()
-        parsed_current_version = semver.VersionInfo.parse(nuclio_version)
-    except ValueError:
-        logger.warning(
-            "Unable to parse nuclio version, assuming in range",
-            nuclio_version=nuclio_version,
-            min_version=min_version,
-            max_version=max_version,
-        )
-        return True
-    return parsed_min_version <= parsed_current_version < parsed_max_version
-
-
 def min_nuclio_versions(*versions):
     def decorator(function):
         def wrapper(*args, **kwargs):
             if validate_nuclio_version_compatibility(*versions):
                 return function(*args, **kwargs)
 
             message = (
@@ -129,14 +109,15 @@
         "max_replicas",
         "config",
         "base_spec",
         "no_cache",
         "source",
         "function_kind",
         "readiness_timeout",
+        "readiness_timeout_before_failure",
         "function_handler",
         "nuclio_runtime",
         "base_image_pull",
         "service_type",
         "add_templated_ingress_host_mode",
     ]
 
@@ -160,14 +141,15 @@
         no_cache=None,
         source=None,
         image_pull_policy=None,
         function_kind=None,
         build=None,
         service_account=None,
         readiness_timeout=None,
+        readiness_timeout_before_failure=None,
         default_handler=None,
         node_name=None,
         node_selector=None,
         affinity=None,
         disable_auto_mount=False,
         priority_class_name=None,
         pythonpath=None,
@@ -215,14 +197,15 @@
         self.function_kind = function_kind
         self.source = source or ""
         self.config = config or {}
         self.function_handler = None
         self.nuclio_runtime = None
         self.no_cache = no_cache
         self.readiness_timeout = readiness_timeout
+        self.readiness_timeout_before_failure = readiness_timeout_before_failure
         self.service_type = service_type
         self.add_templated_ingress_host_mode = add_templated_ingress_host_mode
 
         self.min_replicas = min_replicas or 1
         self.max_replicas = max_replicas or 4
 
         # When True it will set Nuclio spec.noBaseImagesPull to False (negative logic)
@@ -804,21 +787,20 @@
         project = project or self.metadata.project
         if models and isinstance(models, dict):
             models = [{"key": k, "model_path": v} for k, v in models.items()]
 
         # verify auto mount is applied (with the client credentials)
         self.try_auto_mount_based_on_config()
 
-        # if the function spec contain KFP PipelineParams (futures) pass the full spec to the
-        # ContainerOp this way KFP will substitute the params with previous step outputs
-        func_has_pipeline_params = self.to_json().find("{{pipelineparam:op") > 0
         if (
             use_function_from_db
             or use_function_from_db is None
-            and not func_has_pipeline_params
+            # if the function contain KFP PipelineParams (futures) pass the full spec to the
+            # ContainerOp this way KFP will substitute the params with previous step outputs
+            and not self._has_pipeline_param()
         ):
             url = self.save(versioned=True, refresh=True)
         else:
             url = None
 
         return deploy_op(
             name,
@@ -838,14 +820,15 @@
         body: typing.Union[str, bytes, dict] = None,
         method: str = None,
         headers: dict = None,
         dashboard: str = "",
         force_external_address: bool = False,
         auth_info: AuthInfo = None,
         mock: bool = None,
+        **http_client_kwargs,
     ):
         """Invoke the remote (live) function and return the results
 
         example::
 
             function.invoke("/api", body={"inputs": x})
 
@@ -853,14 +836,17 @@
         :param body:     request body (str, bytes or a dict for json requests)
         :param method:   HTTP method (GET, PUT, ..)
         :param headers:  key/value dict with http headers
         :param dashboard: nuclio dashboard address
         :param force_external_address:   use the external ingress URL
         :param auth_info: service AuthInfo
         :param mock:     use mock server vs a real Nuclio function (for local simulations)
+        :param http_client_kwargs:   allow the user to pass any parameter supported in requests.request method
+                                     see this link for more information:
+                                     https://requests.readthedocs.io/en/latest/api/#requests.request
         """
         if not method:
             method = "POST" if body else "GET"
 
         if (self._mock_server and mock is None) or mlconf.use_nuclio_mock(mock):
             # if we deployed mock server or in simulated nuclio environment use mock
             if not self._mock_server:
@@ -884,23 +870,24 @@
             headers = {}
 
         # if function is scaled to zero, let the DLX know we want to wake it up
         full_function_name = get_fullname(
             self.metadata.name, self.metadata.project, self.metadata.tag
         )
         headers.setdefault("x-nuclio-target", full_function_name)
-        kwargs = {}
+        if not http_client_kwargs:
+            http_client_kwargs = {}
         if body:
             if isinstance(body, (str, bytes)):
-                kwargs["data"] = body
+                http_client_kwargs["data"] = body
             else:
-                kwargs["json"] = body
+                http_client_kwargs["json"] = body
         try:
             logger.info("invoking function", method=method, path=path)
-            resp = requests.request(method, path, headers=headers, **kwargs)
+            resp = requests.request(method, path, headers=headers, **http_client_kwargs)
         except OSError as err:
             raise OSError(
                 f"error: cannot run function at url {path}, {err_to_str(err)}"
             )
         if not resp.ok:
             raise RuntimeError(f"bad function response {resp.status_code}: {resp.text}")
```

## mlrun/runtimes/function_reference.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/generators.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/kubejob.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -135,14 +135,15 @@
              commands)
            * True: the existing params are replaced by the new ones
         :param verify_base_image:           verify that the base image is configured
                                             (deprecated, use prepare_image_for_deploy)
         :param prepare_image_for_deploy:    prepare the image/base_image spec for deployment
         """
 
+        image = mlrun.utils.helpers.remove_image_protocol_prefix(image)
         self.spec.build.build_config(
             image,
             base_image,
             commands,
             secret,
             source,
             extra,
```

## mlrun/runtimes/local.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -416,43 +416,46 @@
 
 
 def exec_from_params(handler, runobj: RunObject, context: MLClientCtx, cwd=None):
     old_level = logger.level
     if runobj.spec.verbose:
         logger.set_logger_level("DEBUG")
 
-    # Prepare the inputs type hints (user may pass type hints as part of the inputs keys):
+    # Prepare the inputs type hints (user may pass type hints as part of the input keys):
     runobj.spec.extract_type_hints_from_inputs()
     # Read the keyword arguments to pass to the function (combining params and inputs from the run spec):
     kwargs = get_func_arg(handler, runobj, context)
 
     stdout = _DupStdout()
     err = ""
     val = None
     old_dir = os.getcwd()
     with redirect_stdout(stdout):
         context.set_logger_stream(stdout)
         try:
             if cwd:
                 os.chdir(cwd)
             # Apply the MLRun handler decorator for parsing inputs using type hints and logging outputs using log hints
-            # (Expected behavior: inputs are being parsed when they have type hints in code or given by user.
-            # outputs are logged only if log hints are provided by the user):
-            val = mlrun.handler(
-                inputs=(
-                    runobj.spec.inputs_type_hints
-                    if runobj.spec.inputs_type_hints
-                    else True  # True will use type hints if provided in user's code.
-                ),
-                outputs=(
-                    runobj.spec.returns
-                    if runobj.spec.returns
-                    else None  # None will turn off outputs logging.
-                ),
-            )(handler)(**kwargs)
+            # (Expected behavior: inputs are being parsed when they have type hints in code or given by user. Outputs
+            # are logged only if log hints are provided by the user):
+            if mlrun.mlconf.packagers.enabled:
+                val = mlrun.handler(
+                    inputs=(
+                        runobj.spec.inputs_type_hints
+                        if runobj.spec.inputs_type_hints
+                        else True  # True will use type hints if provided in user's code.
+                    ),
+                    outputs=(
+                        runobj.spec.returns
+                        if runobj.spec.returns
+                        else None  # None will turn off outputs logging.
+                    ),
+                )(handler)(**kwargs)
+            else:
+                val = handler(**kwargs)
             context.set_state("completed", commit=False)
         except Exception as exc:
             err = err_to_str(exc)
             logger.error(f"execution error, {traceback.format_exc()}")
             context.set_state(error=err, commit=False)
             logger.set_logger_level(old_level)
 
@@ -473,15 +476,20 @@
     params = runobj.spec.parameters or {}
     inputs = runobj.spec.inputs or {}
     kwargs = {}
     args = inspect.signature(handler).parameters
 
     def _get_input_value(input_key: str):
         input_obj = context.get_input(input_key, inputs[input_key])
-        if type(args[input_key].default) is str or args[input_key].annotation == str:
+        # If there is no type hint annotation but there is a default value and its type is string, point the data
+        # item to local downloaded file path (`local()` returns the downloaded temp path string):
+        if (
+            args[input_key].annotation is inspect.Parameter.empty
+            and type(args[input_key].default) is str
+        ):
             return input_obj.local()
         else:
             return input_obj
 
     for key in args.keys():
         if key == "context":
             kwargs[key] = context
```

## mlrun/runtimes/nuclio.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/pod.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -356,23 +356,33 @@
         mem: str = None,
         cpu: str = None,
         gpus: int = None,
         gpu_type: str = "nvidia.com/gpu",
         patch: bool = False,
     ):
         """
-        set pod cpu/memory/gpu limits
-        by default it overrides the whole limits section, if you wish to patch specific resources use `patch=True`.
+        Set pod cpu/memory/gpu limits (max values)
+
+        :param mem:     set limit for memory e.g. '500M', '2G', etc.
+        :param cpu:     set limit for cpu e.g. '0.5', '2', etc.
+        :param gpus:    set limit for gpu
+        :param gpu_type:    set gpu type e.g. "nvidia.com/gpu"
+        :param patch:    by default it overrides the whole limits section,
+                        if you wish to patch specific resources use `patch=True`
         """
         self._verify_and_set_limits("resources", mem, cpu, gpus, gpu_type, patch=patch)
 
     def with_requests(self, mem: str = None, cpu: str = None, patch: bool = False):
         """
-        set requested (desired) pod cpu/memory resources
-        by default it overrides the whole requests section, if you wish to patch specific resources use `patch=True`.
+        Set requested (desired) pod cpu/memory resources
+
+        :param mem:     set request for memory e.g. '200M', '1G', etc.
+        :param cpu:     set request for cpu e.g. '0.1', '1', etc.
+        :param patch:   by default it overrides the whole requests section,
+                        if you wish to patch specific resources use `patch=True`
         """
         self._verify_and_set_requests("resources", mem, cpu, patch)
 
     def enrich_resources_with_default_pod_resources(
         self, resources_field_name: str, resources: dict
     ):
         resources_types = ["cpu", "memory"]
@@ -1037,23 +1047,33 @@
         mem: str = None,
         cpu: str = None,
         gpus: int = None,
         gpu_type: str = "nvidia.com/gpu",
         patch: bool = False,
     ):
         """
-        set pod cpu/memory/gpu limits
-        by default it overrides the whole limits section, if you wish to patch specific resources use `patch=True`.
+        Set pod cpu/memory/gpu limits (max values)
+
+        :param mem:     set limit for memory e.g. '500M', '2G', etc.
+        :param cpu:     set limit for cpu e.g. '0.5', '2', etc.
+        :param gpus:    set limit for gpu
+        :param gpu_type:    set gpu type e.g. "nvidia.com/gpu"
+        :param patch:    by default it overrides the whole limits section,
+                        if you wish to patch specific resources use `patch=True`
         """
         self.spec.with_limits(mem, cpu, gpus, gpu_type, patch=patch)
 
     def with_requests(self, mem: str = None, cpu: str = None, patch: bool = False):
         """
-        set requested (desired) pod cpu/memory resources
-        by default it overrides the whole requests section, if you wish to patch specific resources use `patch=True`.
+        Set requested (desired) pod cpu/memory resources
+
+        :param mem:     set request for memory e.g. '200M', '1G', etc.
+        :param cpu:     set request for cpu e.g. '0.1', '1', etc.
+        :param patch:   by default it overrides the whole requests section,
+                        if you wish to patch specific resources use `patch=True`
         """
         self.spec.with_requests(mem, cpu, patch=patch)
 
     def with_node_selection(
         self,
         node_name: typing.Optional[str] = None,
         node_selector: typing.Optional[typing.Dict[str, str]] = None,
@@ -1454,25 +1474,25 @@
     if not attribute:
         return attribute_config["not_sanitized_class"]()
 
     # check if attribute of type dict, and then check if type is sanitized
     if isinstance(attribute, dict):
         if attribute_config["not_sanitized_class"] != dict:
             raise mlrun.errors.MLRunInvalidArgumentTypeError(
-                f"expected to to be of type {attribute_config.get('not_sanitized_class')} but got dict"
+                f"expected to be of type {attribute_config.get('not_sanitized_class')} but got dict"
             )
         if _resolve_if_type_sanitized(attribute_name, attribute):
             return attribute
 
     elif isinstance(attribute, list) and not isinstance(
         attribute[0], attribute_config["sub_attribute_type"]
     ):
         if attribute_config["not_sanitized_class"] != list:
             raise mlrun.errors.MLRunInvalidArgumentTypeError(
-                f"expected to to be of type {attribute_config.get('not_sanitized_class')} but got list"
+                f"expected to be of type {attribute_config.get('not_sanitized_class')} but got list"
             )
         if _resolve_if_type_sanitized(attribute_name, attribute[0]):
             return attribute
 
     api = k8s_client.ApiClient()
     return api.sanitize_for_serialization(attribute)
```

## mlrun/runtimes/remotesparkjob.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2021 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/serving.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -18,29 +18,30 @@
 from typing import List, Union
 
 import nuclio
 from nuclio import KafkaTrigger
 
 import mlrun
 import mlrun.common.schemas
+from mlrun.model_monitoring.tracking_policy import TrackingPolicy
 
 from ..datastore import parse_kafka_url
 from ..model import ObjectList
 from ..secrets import SecretsStore
 from ..serving.server import GraphServer, create_graph_server
 from ..serving.states import (
     RootFlowStep,
     RouterStep,
     StepKinds,
     TaskStep,
     graph_root_setter,
     new_remote_endpoint,
     params_to_step,
 )
-from ..utils import get_caller_globals, logger, model_monitoring, set_paths
+from ..utils import get_caller_globals, logger, set_paths
 from .function import NuclioSpec, RemoteRuntime
 from .function_reference import FunctionReference
 
 serving_subkind = "serving_v2"
 
 
 def new_v2_model_server(
@@ -112,14 +113,15 @@
         base_spec=None,
         no_cache=None,
         source=None,
         image_pull_policy=None,
         function_kind=None,
         service_account=None,
         readiness_timeout=None,
+        readiness_timeout_before_failure=None,
         models=None,
         graph=None,
         parameters=None,
         default_class=None,
         load_mode=None,
         build=None,
         function_refs=None,
@@ -141,15 +143,14 @@
         tolerations=None,
         preemption_mode=None,
         security_context=None,
         service_type=None,
         add_templated_ingress_host_mode=None,
         clone_target_dir=None,
     ):
-
         super().__init__(
             command=command,
             args=args,
             image=image,
             mode=mode,
             entry_points=entry_points,
             description=description,
@@ -164,14 +165,15 @@
             base_spec=base_spec,
             no_cache=no_cache,
             source=source,
             image_pull_policy=image_pull_policy,
             function_kind=serving_subkind,
             service_account=service_account,
             readiness_timeout=readiness_timeout,
+            readiness_timeout_before_failure=readiness_timeout_before_failure,
             build=build,
             node_name=node_name,
             node_selector=node_selector,
             affinity=affinity,
             disable_auto_mount=disable_auto_mount,
             priority_class_name=priority_class_name,
             default_handler=default_handler,
@@ -298,15 +300,15 @@
 
     def set_tracking(
         self,
         stream_path: str = None,
         batch: int = None,
         sample: int = None,
         stream_args: dict = None,
-        tracking_policy: Union[model_monitoring.TrackingPolicy, dict] = None,
+        tracking_policy: Union[TrackingPolicy, dict] = None,
     ):
         """set tracking parameters:
 
         :param stream_path:     Path/url of the tracking stream e.g. v3io:///users/mike/mystream
                                 you can use the "dummy://" path for test/simulation.
         :param batch:           Micro batch size (send micro batches of N records at a time).
         :param sample:          Sample size (send only one of N records).
@@ -328,17 +330,15 @@
 
         # Applying model monitoring configurations
         self.spec.track_models = True
         self.spec.tracking_policy = None
         if tracking_policy:
             if isinstance(tracking_policy, dict):
                 # Convert tracking policy dictionary into `model_monitoring.TrackingPolicy` object
-                self.spec.tracking_policy = model_monitoring.TrackingPolicy.from_dict(
-                    tracking_policy
-                )
+                self.spec.tracking_policy = TrackingPolicy.from_dict(tracking_policy)
             else:
                 # Tracking_policy is already a `model_monitoring.TrackingPolicy` object
                 self.spec.tracking_policy = tracking_policy
 
         if stream_path:
             self.spec.parameters["log_stream"] = stream_path
         if batch:
@@ -470,14 +470,24 @@
                 if function_name not in self._spec.function_refs.keys():
                     raise ValueError(f"function reference {function_name} not present")
                 group = stream.options.get("group", f"{function_name}-consumer-group")
 
                 child_function = self._spec.function_refs[function_name]
                 trigger_args = stream.trigger_args or {}
 
+                if mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled":
+                    trigger_args["explicit_ack_mode"] = trigger_args.get(
+                        "explicit_ack_mode", "explicitOnly"
+                    )
+                    extra_attributes = trigger_args.get("extra_attributes", {})
+                    trigger_args["extra_attributes"] = extra_attributes
+                    extra_attributes["workerAllocationMode"] = extra_attributes.get(
+                        "workerAllocationMode", "static"
+                    )
+
                 if (
                     stream.path.startswith("kafka://")
                     or "kafka_bootstrap_servers" in stream.options
                 ):
                     brokers = stream.options.get("kafka_bootstrap_servers")
                     if brokers:
                         brokers = brokers.split(",")
```

## mlrun/runtimes/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -20,18 +20,17 @@
 from io import StringIO
 from sys import stderr
 
 import pandas as pd
 from kubernetes import client
 
 import mlrun
-import mlrun.api.utils.builder
 import mlrun.common.constants
+import mlrun.common.schemas
 import mlrun.utils.regex
-from mlrun.api.utils.clients import nuclio
 from mlrun.errors import err_to_str
 from mlrun.frameworks.parallel_coordinates import gen_pcp_plot
 from mlrun.runtimes.constants import MPIJobCRDVersions
 
 from ..artifacts import TableArtifact
 from ..config import config, is_running_as_api
 from ..k8s_utils import is_running_inside_kubernetes_cluster
@@ -57,15 +56,14 @@
         self._context = context
 
 
 global_context = _ContextStore()
 
 
 cached_mpijob_crd_version = None
-cached_nuclio_version = None
 
 
 # resolve mpijob runtime according to the mpi-operator's supported crd-version
 # if specified on mlrun config set it likewise,
 # if not specified, try resolving it according to the mpi-operator, otherwise set to default
 # since this is a heavy operation (sending requests to k8s/API), and it's unlikely that the crd version
 # will change in any context - cache it
@@ -114,37 +112,14 @@
     try:
         regex = re.compile("spark-([23])")
         return int(regex.findall(config.spark_operator_version)[0])
     except Exception:
         raise ValueError("Failed to resolve spark operator's version")
 
 
-# if nuclio version specified on mlrun config set it likewise,
-# if not specified, get it from nuclio api client
-# since this is a heavy operation (sending requests to API), and it's unlikely that the version
-# will change - cache it (this means if we upgrade nuclio, we need to restart mlrun to re-fetch the new version)
-def resolve_nuclio_version():
-    global cached_nuclio_version
-
-    if not cached_nuclio_version:
-
-        # config override everything
-        nuclio_version = config.nuclio_version
-        if not nuclio_version and config.nuclio_dashboard_url:
-            try:
-                nuclio_client = nuclio.Client()
-                nuclio_version = nuclio_client.get_dashboard_version()
-            except Exception as exc:
-                logger.warning("Failed to resolve nuclio version", exc=err_to_str(exc))
-
-        cached_nuclio_version = nuclio_version
-
-    return cached_nuclio_version
-
-
 def calc_hash(func, tag=""):
     # remove tag, hash, date from calculation
     tag = tag or func.metadata.tag
     status = func.status
     func.metadata.tag = ""
     func.metadata.hash = ""
     func.status = None
@@ -204,16 +179,26 @@
             for remote in repo.remotes
             # some stale remotes might be missing urls
             # there is not a nicer way to check for this.
             if repo.config_reader().has_option(f'remote "{remote}"', "url")
         ]
         if len(remotes) > 0:
             return f"{remotes[0]}#{repo.head.commit.hexsha}"
-    except (GitCommandNotFound, InvalidGitRepositoryError, NoSuchPathError, ValueError):
-        pass
+
+    except (
+        GitCommandNotFound,
+        InvalidGitRepositoryError,
+        NoSuchPathError,
+        ValueError,
+    ) as exc:
+        logger.warning(
+            "Failed to add git metadata, ignore if path is not part of a git repo.",
+            path=path,
+            error=err_to_str(exc),
+        )
     return None
 
 
 def get_k8s():
     """
     Get the k8s helper object
     :return: k8s helper object or None if not running as API
@@ -470,48 +455,58 @@
     gpus=None,
     gpu_type="nvidia.com/gpu",
 ):
     if mem:
         verify_field_regex(
             f"function.spec.{resources_field_name}.limits.memory",
             mem,
-            mlrun.utils.regex.k8s_resource_quantity_regex,
+            mlrun.utils.regex.k8s_resource_quantity_regex
+            + mlrun.utils.regex.pipeline_param,
+            mode=mlrun.common.schemas.RegexMatchModes.any,
         )
     if cpu:
         verify_field_regex(
             f"function.spec.{resources_field_name}.limits.cpu",
             cpu,
-            mlrun.utils.regex.k8s_resource_quantity_regex,
+            mlrun.utils.regex.k8s_resource_quantity_regex
+            + mlrun.utils.regex.pipeline_param,
+            mode=mlrun.common.schemas.RegexMatchModes.any,
         )
     # https://kubernetes.io/docs/tasks/manage-gpus/scheduling-gpus/
     if gpus:
         verify_field_regex(
             f"function.spec.{resources_field_name}.limits.gpus",
             gpus,
-            mlrun.utils.regex.k8s_resource_quantity_regex,
+            mlrun.utils.regex.k8s_resource_quantity_regex
+            + mlrun.utils.regex.pipeline_param,
+            mode=mlrun.common.schemas.RegexMatchModes.any,
         )
     return generate_resources(mem=mem, cpu=cpu, gpus=gpus, gpu_type=gpu_type)
 
 
 def verify_requests(
     resources_field_name,
     mem=None,
     cpu=None,
 ):
     if mem:
         verify_field_regex(
             f"function.spec.{resources_field_name}.requests.memory",
             mem,
-            mlrun.utils.regex.k8s_resource_quantity_regex,
+            mlrun.utils.regex.k8s_resource_quantity_regex
+            + mlrun.utils.regex.pipeline_param,
+            mode=mlrun.common.schemas.RegexMatchModes.any,
         )
     if cpu:
         verify_field_regex(
             f"function.spec.{resources_field_name}.requests.cpu",
             cpu,
-            mlrun.utils.regex.k8s_resource_quantity_regex,
+            mlrun.utils.regex.k8s_resource_quantity_regex
+            + mlrun.utils.regex.pipeline_param,
+            mode=mlrun.common.schemas.RegexMatchModes.any,
         )
     return generate_resources(mem=mem, cpu=cpu)
 
 
 def get_gpu_from_resource_requirement(requirement: dict):
     """
     Because there could be different types of gpu types, and we don't know all the gpu types possible,
```

## mlrun/runtimes/mpijob/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/mpijob/abstract.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/mpijob/v1.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/mpijob/v1alpha1.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/sparkjob/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/sparkjob/abstract.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/runtimes/sparkjob/spark3job.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/merger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/remote.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/routers.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -21,18 +21,18 @@
 from typing import Dict, List, Union
 
 import numpy
 import numpy as np
 
 import mlrun
 import mlrun.common.model_monitoring
-import mlrun.common.schemas
-import mlrun.utils.model_monitoring
-from mlrun.utils import logger, now_date, parse_versioned_object_uri
+import mlrun.common.schemas.model_monitoring
+from mlrun.utils import logger, now_date
 
+from ..common.helpers import parse_versioned_object_uri
 from ..config import config
 from .server import GraphServer
 from .utils import RouterToDict, _extract_input_data, _update_result_body
 from .v2_serving import _ModelLogPusher
 
 # Used by `ParallelRun` in process mode, so it can be accessed from different processes.
 local_routes = {}
@@ -1062,21 +1062,21 @@
                     function_uri=graph_server.function_uri,
                     model=versioned_model_name,
                     model_class=voting_ensemble.__class__.__name__,
                     stream_path=config.model_endpoint_monitoring.store_prefixes.default.format(
                         project=project, kind="stream"
                     ),
                     active=True,
-                    monitoring_mode=mlrun.common.model_monitoring.ModelMonitoringMode.enabled
+                    monitoring_mode=mlrun.common.schemas.model_monitoring.ModelMonitoringMode.enabled
                     if voting_ensemble.context.server.track_models
-                    else mlrun.common.model_monitoring.ModelMonitoringMode.disabled,
+                    else mlrun.common.schemas.model_monitoring.ModelMonitoringMode.disabled,
                 ),
                 status=mlrun.common.schemas.ModelEndpointStatus(
                     children=list(voting_ensemble.routes.keys()),
-                    endpoint_type=mlrun.common.model_monitoring.EndpointType.ROUTER,
+                    endpoint_type=mlrun.common.schemas.model_monitoring.EndpointType.ROUTER,
                     children_uids=children_uids,
                 ),
             )
 
             db = mlrun.get_run_db()
 
             db.create_model_endpoint(
@@ -1087,15 +1087,15 @@
 
             # Update model endpoint children type
             for model_endpoint in children_uids:
                 current_endpoint = db.get_model_endpoint(
                     project=project, endpoint_id=model_endpoint
                 )
                 current_endpoint.status.endpoint_type = (
-                    mlrun.common.model_monitoring.EndpointType.LEAF_EP
+                    mlrun.common.schemas.model_monitoring.EndpointType.LEAF_EP
                 )
                 db.create_model_endpoint(
                     project=project,
                     endpoint_id=model_endpoint,
                     model_endpoint=current_endpoint,
                 )
```

## mlrun/serving/server.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -19,40 +19,41 @@
 import os
 import socket
 import traceback
 import uuid
 from typing import Optional, Union
 
 import mlrun
-import mlrun.utils.model_monitoring
-from mlrun.common.model_monitoring import FileTargetKind
+import mlrun.common.helpers
+import mlrun.model_monitoring
 from mlrun.config import config
 from mlrun.errors import err_to_str
 from mlrun.secrets import SecretsStore
 
+from ..common.helpers import parse_versioned_object_uri
+from ..common.schemas.model_monitoring.constants import FileTargetKind
 from ..datastore import get_stream_pusher
 from ..datastore.store_resources import ResourceCache
 from ..errors import MLRunInvalidArgumentError
 from ..model import ModelObj
-from ..utils import get_caller_globals, parse_versioned_object_uri
+from ..utils import get_caller_globals
 from .states import RootFlowStep, RouterStep, get_function, graph_root_setter
 from .utils import (
     event_id_key,
     event_path_key,
     legacy_event_id_key,
     legacy_event_path_key,
 )
 
 
 class _StreamContext:
     """Handles the stream context for the events stream process. Includes the configuration for the output stream
     that will be used for pushing the events from the nuclio model serving function"""
 
     def __init__(self, enabled: bool, parameters: dict, function_uri: str):
-
         """
         Initialize _StreamContext object.
         :param enabled:      A boolean indication for applying the stream context
         :param parameters:   Dictionary of optional parameters, such as `log_stream` and `stream_args`. Note that these
                              parameters might be relevant to the output source such as `kafka_bootstrap_servers` if
                              the output source is from type Kafka.
         :param function_uri: Full value of the function uri, usually it's <project-name>/<function-name>
@@ -67,15 +68,15 @@
 
         if (enabled or log_stream) and function_uri:
             self.enabled = True
             project, _, _, _ = parse_versioned_object_uri(
                 function_uri, config.default_project
             )
 
-            stream_uri = mlrun.utils.model_monitoring.get_stream_path(project=project)
+            stream_uri = mlrun.model_monitoring.get_stream_path(project=project)
 
             if log_stream:
                 # Update the stream path to the log stream value
                 stream_uri = log_stream.format(project=project)
 
             stream_args = parameters.get("stream_args", {})
 
@@ -463,14 +464,16 @@
         self.stream = None
         self.root = None
 
         if nuclio_context:
             self.logger = nuclio_context.logger
             self.Response = nuclio_context.Response
             self.worker_id = nuclio_context.worker_id
+            if hasattr(nuclio_context, "platform"):
+                self.platform = nuclio_context.platform
         elif not logger:
             self.logger = mlrun.utils.helpers.logger
 
         self._server = server
         self.current_function = None
         self.get_store_resource = None
         self.get_table = None
@@ -479,15 +482,15 @@
     @property
     def server(self):
         return self._server
 
     @property
     def project(self):
         """current project name (for the current function)"""
-        project, _, _, _ = mlrun.utils.parse_versioned_object_uri(
+        project, _, _, _ = mlrun.common.helpers.parse_versioned_object_uri(
             self._server.function_uri
         )
         return project
 
     def push_error(self, event, message, source=None, **kwargs):
         if self.verbose:
             self.logger.error(
@@ -517,21 +520,21 @@
         """return the remote nuclio/serving function http(s) endpoint given its name
 
         :param name: the function name/uri in the form [project/]function-name[:tag]
         :param external: return the external url (returns the external url by default)
         """
         if "://" in name:
             return name
-        project, uri, tag, _ = mlrun.utils.parse_versioned_object_uri(
+        project, uri, tag, _ = mlrun.common.helpers.parse_versioned_object_uri(
             self._server.function_uri
         )
         if name.startswith("."):
             name = f"{uri}-{name[1:]}"
         else:
-            project, name, tag, _ = mlrun.utils.parse_versioned_object_uri(
+            project, name, tag, _ = mlrun.common.helpers.parse_versioned_object_uri(
                 name, project
             )
         (
             state,
             fullname,
             _,
             _,
```

## mlrun/serving/serving_wrapper.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/states.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -17,14 +17,16 @@
 import os
 import pathlib
 import traceback
 from copy import copy, deepcopy
 from inspect import getfullargspec, signature
 from typing import Union
 
+import mlrun
+
 from ..config import config
 from ..datastore import get_stream_pusher
 from ..datastore.utils import parse_kafka_url
 from ..errors import MLRunInvalidArgumentError, err_to_str
 from ..model import ModelObj, ObjectDict
 from ..platforms.iguazio import parse_path
 from ..utils import get_class, get_function
@@ -287,30 +289,31 @@
         full_event: bool = None,
         input_path: str = None,
         result_path: str = None,
         **class_args,
     ):
         """add a step right after this step and return the new step
 
-        example, a 4 step pipeline ending with a stream:
-        graph.to('URLDownloader')\
-             .to('ToParagraphs')\
-             .to(name='to_json', handler='json.dumps')\
-             .to('>>', 'to_v3io', path=stream_path)\
+        example:
+            a 4-step pipeline ending with a stream:
+            graph.to('URLDownloader')\
+                 .to('ToParagraphs')\
+                 .to(name='to_json', handler='json.dumps')\
+                 .to('>>', 'to_v3io', path=stream_path)\
 
         :param class_name:  class name or step object to build the step from
                             for router steps the class name should start with '*'
                             for queue/stream step the class should be '>>' or '$queue'
         :param name:        unique name (and path) for the child step, default is class name
         :param handler:     class/function handler to invoke on run/event
         :param graph_shape: graphviz shape name
         :param function:    function this step should run in
         :param full_event:  this step accepts the full event (not just body)
         :param input_path:  selects the key/path in the event to use as input to the step
-                            this require that the event body will behave like a dict, example:
+                            this requires that the event body will behave like a dict, example:
                             event: {"data": {"a": 5, "b": 7}}, input_path="data.b" means the step will
                             receive 7 as input
         :param result_path: selects the key/path in the event to write the results to
                             this require that the event body will behave like a dict, example:
                             event: {"x": 5} , result_path="y" means the output of the step will be written
                             to event["y"] resulting in {"x": 5, "y": <result>}
         :param class_args:  class init arguments
@@ -1507,9 +1510,13 @@
                 )
             if not step.next and hasattr(step, "responder") and step.responder:
                 # if responder step (return result), add Complete()
                 step.async_object.to(storey.Complete(full_event=True))
                 wait_for_result = True
 
     source_args = context.get_param("source_args", {})
-    default_source = storey.SyncEmitSource(context=context, **source_args)
+    default_source = storey.SyncEmitSource(
+        context=context,
+        explicit_ack=mlrun.mlconf.httpdb.nuclio.explicit_ack == "enabled",
+        **source_args,
+    )
     return default_source, wait_for_result
```

## mlrun/serving/utils.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/v1_serving.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/serving/v2_serving.py

```diff
@@ -1,32 +1,33 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
+
 import threading
 import time
 import traceback
 from typing import Dict, Union
 
-import mlrun
 import mlrun.common.model_monitoring
-import mlrun.common.schemas
+import mlrun.common.schemas.model_monitoring
 from mlrun.artifacts import ModelArtifact  # noqa: F401
 from mlrun.config import config
-from mlrun.utils import logger, now_date, parse_versioned_object_uri
+from mlrun.utils import logger, now_date
 
+from ..common.helpers import parse_versioned_object_uri
 from .server import GraphServer
 from .utils import StepToDict, _extract_input_data, _update_result_body
 
 
 class V2ModelServer(StepToDict):
     """base model serving class (v2), using similar API to KFServing v2 and Triton"""
 
@@ -255,19 +256,28 @@
             if self.version:
                 response["model_version"] = self.version
 
         elif op == "ready" and event.method == "GET":
             # get model health operation
             setattr(event, "terminated", True)
             if self.ready:
-                event.body = self.context.Response()
+                # Generate a response, confirming that the model is ready
+                event.body = self.context.Response(
+                    status_code=200,
+                    body=bytes(
+                        f"Model {self.name} is ready (event_id = {event_id})",
+                        encoding="utf-8",
+                    ),
+                )
+
             else:
                 event.body = self.context.Response(
                     status_code=408, body=b"model not ready"
                 )
+
             return event
 
         elif op == "" and event.method == "GET":
             # get model metadata operation
             setattr(event, "terminated", True)
             event_body = {
                 "name": self.name,
@@ -502,20 +512,20 @@
                     model=versioned_model_name,
                     model_class=model.__class__.__name__,
                     model_uri=model.model_path,
                     stream_path=config.model_endpoint_monitoring.store_prefixes.default.format(
                         project=project, kind="stream"
                     ),
                     active=True,
-                    monitoring_mode=mlrun.common.model_monitoring.ModelMonitoringMode.enabled
+                    monitoring_mode=mlrun.common.schemas.model_monitoring.ModelMonitoringMode.enabled
                     if model.context.server.track_models
-                    else mlrun.common.model_monitoring.ModelMonitoringMode.disabled,
+                    else mlrun.common.schemas.model_monitoring.ModelMonitoringMode.disabled,
                 ),
                 status=mlrun.common.schemas.ModelEndpointStatus(
-                    endpoint_type=mlrun.common.model_monitoring.EndpointType.NODE_EP
+                    endpoint_type=mlrun.common.schemas.model_monitoring.EndpointType.NODE_EP
                 ),
             )
 
             db = mlrun.get_run_db()
 
             db.create_model_endpoint(
                 project=project,
```

## mlrun/utils/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/async_http.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -130,14 +130,21 @@
             try:
                 try:
                     params = self._params_list[current_attempt - 1]
                 except IndexError:
                     params = self._params_list[-1]
 
                 headers = {k: v for k, v in params.headers.items() if v is not None}
+
+                # enrich user agent
+                # will help traceability and debugging
+                headers[
+                    aiohttp.hdrs.USER_AGENT
+                ] = f"{aiohttp.http.SERVER_SOFTWARE} mlrun/{config.version}"
+
                 response: typing.Optional[
                     aiohttp.ClientResponse
                 ] = await self._request_func(
                     params.method,
                     params.url,
                     headers=headers,
                     trace_request_ctx={
```

## mlrun/utils/azure_vault.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2021 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/clones.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/db.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,16 @@
 # limitations under the License.
 #
 import pickle
 from datetime import datetime
 
 from sqlalchemy.orm import class_mapper
 
+run_time_fmt = "%Y-%m-%dT%H:%M:%S.%fZ"
+
 
 class BaseModel:
     def to_dict(self, exclude=None):
         """
         NOTE - this function (currently) does not handle serializing relationships
         """
         exclude = exclude or []
```

## mlrun/utils/helpers.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -13,14 +13,15 @@
 # limitations under the License.
 
 import enum
 import hashlib
 import inspect
 import json
 import os
+import pathlib
 import re
 import sys
 import time
 import typing
 import warnings
 from datetime import datetime, timezone
 from importlib import import_module
@@ -35,14 +36,15 @@
 import yaml
 from dateutil import parser
 from deprecated import deprecated
 from pandas._libs.tslibs.timestamps import Timedelta, Timestamp
 from yaml.representer import RepresenterError
 
 import mlrun
+import mlrun.common.schemas
 import mlrun.errors
 import mlrun.utils.version.version
 from mlrun.errors import err_to_str
 
 from ..config import config
 from .logger import create_logger
 
@@ -93,16 +95,19 @@
         tree = item.get("tree")
     else:
         db_key = item["spec"].get("db_key")
         project_str = project or item["metadata"].get("project")
         tree = item["metadata"].get("tree")
 
     kind = item.get("kind")
-    if kind in ["dataset", "model"] and db_key:
-        return f"{DB_SCHEMA}://{StorePrefix.Artifact}/{project_str}/{db_key}:{tree}"
+    if kind in ["dataset", "model", "artifact"] and db_key:
+        target = f"{DB_SCHEMA}://{StorePrefix.Artifact}/{project_str}/{db_key}"
+        if tree:
+            target = f"{target}:{tree}"
+        return target
 
     return (
         item.get("target_path")
         if is_legacy_artifact(item)
         else item["spec"].get("target_path")
     )
 
@@ -141,53 +146,65 @@
 
 def verify_field_regex(
     field_name,
     field_value,
     patterns,
     raise_on_failure: bool = True,
     log_message: str = "Field is malformed. Does not match required pattern",
+    mode: mlrun.common.schemas.RegexMatchModes = mlrun.common.schemas.RegexMatchModes.all,
 ) -> bool:
     for pattern in patterns:
         if not re.match(pattern, str(field_value)):
             log_func = logger.warn if raise_on_failure else logger.debug
             log_func(
                 log_message,
                 field_name=field_name,
                 field_value=field_value,
                 pattern=pattern,
             )
-            if raise_on_failure:
-                raise mlrun.errors.MLRunInvalidArgumentError(
-                    f"Field '{field_name}' is malformed. Does not match required pattern: {pattern}"
-                )
-            else:
+            if mode == mlrun.common.schemas.RegexMatchModes.all:
+                if raise_on_failure:
+                    raise mlrun.errors.MLRunInvalidArgumentError(
+                        f"Field '{field_name}' is malformed. {field_value} does not match required pattern: {pattern}"
+                    )
                 return False
-    return True
+        elif mode == mlrun.common.schemas.RegexMatchModes.any:
+            return True
+    if mode == mlrun.common.schemas.RegexMatchModes.all:
+        return True
+    elif mode == mlrun.common.schemas.RegexMatchModes.any:
+        if raise_on_failure:
+            raise mlrun.errors.MLRunInvalidArgumentError(
+                f"Field '{field_name}' is malformed. {field_value} does not match any of the"
+                f" required patterns: {patterns}"
+            )
+        return False
 
 
 def validate_builder_source(
     source: str, pull_at_runtime: bool = False, workdir: str = None
 ):
     if pull_at_runtime or not source:
         return
 
     if "://" not in source:
         if not path.isabs(source):
             raise mlrun.errors.MLRunInvalidArgumentError(
-                f"Source '{source}' must be a valid URL or absolute path when 'pull_at_runtime' is False"
+                f"Source '{source}' must be a valid URL or absolute path when 'pull_at_runtime' is False "
                 "set 'source' to a remote URL to clone/copy the source to the base image, "
                 "or set 'pull_at_runtime' to True to pull the source at runtime."
             )
-    else:
-        logger.warn(
-            "Loading local source at build time requires the source to be on the base image, "
-            "in which case it is recommended to use 'workdir' instead",
-            source=source,
-            workdir=workdir,
-        )
+
+        else:
+            logger.warn(
+                "Loading local source at build time requires the source to be on the base image, "
+                "in which case it is recommended to use 'workdir' instead",
+                source=source,
+                workdir=workdir,
+            )
 
     if source.endswith(".zip"):
         logger.warn(
             "zip files are not natively extracted by docker, use tar.gz for faster loading during build",
             source=source,
         )
 
@@ -225,22 +242,67 @@
     """
     This function is used to combine a list of regex strings into a single regex,
     with and condition between them.
     """
     return "".join(["(?={regex})".format(regex=regex) for regex in regex_list]) + ".*$"
 
 
+def is_file_path_invalid(code_path: str, file_path: str) -> bool:
+    """
+    The function checks if the given file_path is a valid path.
+    If the file_path is a relative path, it is completed by joining it with the code_path.
+    Otherwise, the file_path is used as is.
+    Additionally, it checks if the resulting path exists as a file, unless the file_path is a remote URL.
+    If the file_path has no suffix, it is considered invalid.
+
+    :param code_path: The base directory or code path to search for the file in case of relative file_path
+    :param file_path: The file path to be validated
+    :return: True if the file path is invalid, False otherwise
+    """
+    if not file_path:
+        return True
+
+    if file_path.startswith("./") or (
+        "://" not in file_path and os.path.basename(file_path) == file_path
+    ):
+        abs_path = os.path.join(code_path, file_path.lstrip("./"))
+    else:
+        abs_path = file_path
+
+    return (
+        not (os.path.isfile(abs_path) or "://" in file_path)
+        or not pathlib.Path(file_path).suffix
+    )
+
+
 def tag_name_regex_as_string() -> str:
     return get_regex_list_as_string(mlrun.utils.regex.tag_name)
 
 
 def is_yaml_path(url):
     return url.endswith(".yaml") or url.endswith(".yml")
 
 
+def remove_image_protocol_prefix(image: str) -> str:
+    if not image:
+        return image
+
+    prefixes = ["https://", "https://"]
+    if any(prefix in image for prefix in prefixes):
+        image = image.removeprefix("https://").removeprefix("http://")
+        logger.warning(
+            "The image has an unexpected protocol prefix ('http://' or 'https://'). "
+            "If you wish to use the default configured registry, no protocol prefix is required "
+            "(note that you can also use '.<image-name>' instead of the full URL where <image-name> is a placeholder). "
+            "Removing protocol prefix from image.",
+            image=image,
+        )
+    return image
+
+
 # Verifying that a field input is of the expected type. If not the method raises a detailed MLRunInvalidArgumentError
 def verify_field_of_type(field_name: str, field_value, expected_type: type):
     if not isinstance(field_value, expected_type):
         raise mlrun.errors.MLRunInvalidArgumentError(
             f"Field '{field_name}' should be of type {expected_type.__name__} "
             f"(got: {type(field_value).__name__} with value: {field_value})."
         )
@@ -559,34 +621,14 @@
             return str(obj)
 
 
 def dict_to_json(struct):
     return json.dumps(struct, cls=MyEncoder)
 
 
-def parse_versioned_object_uri(uri, default_project=""):
-    project = default_project
-    tag = ""
-    hash_key = ""
-    if "/" in uri:
-        loc = uri.find("/")
-        project = uri[:loc]
-        uri = uri[loc + 1 :]
-    if ":" in uri:
-        loc = uri.find(":")
-        tag = uri[loc + 1 :]
-        uri = uri[:loc]
-    if "@" in uri:
-        loc = uri.find("@")
-        hash_key = uri[loc + 1 :]
-        uri = uri[:loc]
-
-    return project, uri, tag, hash_key
-
-
 def parse_artifact_uri(uri, default_project=""):
     uri_pattern = r"^((?P<project>.*)/)?(?P<key>.*?)(\#(?P<iteration>.*?))?(:(?P<tag>.*?))?(@(?P<uid>.*))?$"
     match = re.match(uri_pattern, uri)
     if not match:
         raise ValueError(
             "Uri not in supported format [<project>/]<key>[#<iteration>][:<tag>][@<uid>]"
         )
@@ -782,22 +824,22 @@
     # mlrun version is higher than 1.3.0, but we can check the python version and if python version was passed it
     # means it 1.3.0-rc or higher, so we can add the suffix of the python version.
     if mlrun_version.startswith("0.0.0-") or "unstable" in mlrun_version:
         if python_version.startswith("3.7"):
             return "-py37"
         return ""
 
-    # For mlrun 1.3.0, we decided to support mlrun runtimes images with both python 3.7 and 3.9 images.
+    # For mlrun 1.3.x and 1.4.x, we support mlrun runtimes images with both python 3.7 and 3.9 images.
     # While the python 3.9 images will continue to have no suffix, the python 3.7 images will have a '-py37' suffix.
     # Python 3.8 images will not be supported for mlrun 1.3.0, meaning that if the user has client with python 3.8
     # and mlrun 1.3.x then the image will be pulled without a suffix (which is the python 3.9 image).
     # using semver (x.y.z-X) to include rc versions as well
-    if semver.VersionInfo.parse(mlrun_version) >= semver.VersionInfo.parse(
-        "1.3.0-X"
-    ) and python_version.startswith("3.7"):
+    if semver.VersionInfo.parse("1.5.0-X") > semver.VersionInfo.parse(
+        mlrun_version
+    ) >= semver.VersionInfo.parse("1.3.0-X") and python_version.startswith("3.7"):
         return "-py37"
     return ""
 
 
 def get_docker_repository_or_default(repository: str) -> str:
     if not repository:
         repository = "mlrun"
@@ -879,38 +921,34 @@
     steps = iter(steps)
 
     # Get first step
     step = next(steps)
     while True:
         current_step_value, current_step_remain = step
         if current_step_remain == 0:
-
             # No more in this step, moving on
             step = next(steps)
         elif current_step_remain is None:
-
             # We are in the last step, staying here forever
             yield current_step_value
         elif current_step_remain > 0:
-
             # Still more remains in this step, just reduce the remaining number
             step[1] -= 1
             yield current_step_value
 
 
 def create_exponential_backoff(base=2, max_value=120, scale_factor=1):
     """
     Create a generator of exponential backoff. Check out usage example in test_helpers.py
     :param base: exponent base
     :param max_value: max limit on the result
     :param scale_factor: factor to be used as linear scaling coefficient
     """
     exponent = 1
     while True:
-
         # This "complex" implementation (unlike the one in linear backoff) is to avoid exponent growing too fast and
         # risking going behind max_int
         next_value = scale_factor * (base**exponent)
         if next_value < max_value:
             exponent += 1
             yield next_value
         else:
@@ -1241,14 +1279,51 @@
 def is_legacy_artifact(artifact):
     if isinstance(artifact, dict):
         return "metadata" not in artifact
     else:
         return not hasattr(artifact, "metadata")
 
 
+def format_run(run: dict, with_project=False) -> dict:
+    fields = [
+        "id",
+        "name",
+        "status",
+        "error",
+        "created_at",
+        "scheduled_at",
+        "finished_at",
+        "description",
+    ]
+
+    if with_project:
+        fields.append("project")
+
+    # create a run object that contains all fields,
+    run = {
+        key: str(value) if value is not None else value
+        for key, value in run.items()
+        if key in fields
+    }
+
+    # if the time_keys values is from 1970, this indicates that the field has not yet been specified yet,
+    # and we want to return a None value instead
+    time_keys = ["scheduled_at", "finished_at", "created_at"]
+
+    for key, value in run.items():
+        if (
+            key in time_keys
+            and isinstance(value, (str, datetime))
+            and parser.parse(str(value)).year == 1970
+        ):
+            run[key] = None
+
+    return run
+
+
 def get_in_artifact(artifact: dict, key, default=None, raise_on_missing=False):
     """artifact can be dict or Artifact object"""
     if is_legacy_artifact(artifact):
         return artifact.get(key, default)
     elif key == "kind":
         return artifact.get(key, default)
     else:
@@ -1277,24 +1352,35 @@
 
 def is_relative_path(path):
     if not path:
         return False
     return not (path.startswith("/") or ":\\" in path or "://" in path)
 
 
+def is_running_in_jupyter_notebook() -> bool:
+    """
+    Check if the code is running inside a Jupyter Notebook.
+    :return: True if running inside a Jupyter Notebook, False otherwise.
+    """
+    import IPython
+
+    ipy = IPython.get_ipython()
+    # if its IPython terminal, it isn't a Jupyter ipython
+    return ipy and "Terminal" not in str(type(ipy))
+
+
 def as_number(field_name, field_value):
     if isinstance(field_value, str) and not field_value.isnumeric():
         raise ValueError(f"{field_name} must be numeric (str/int types)")
     return int(field_value)
 
 
 def filter_warnings(action, category):
     def decorator(function):
         def wrapper(*args, **kwargs):
-
             # context manager that copies and, upon exit, restores the warnings filter and the showwarning() function.
             with warnings.catch_warnings():
                 warnings.simplefilter(action, category)
                 return function(*args, **kwargs)
 
         return wrapper
```

## mlrun/utils/http.py

```diff
@@ -1,25 +1,28 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
+
 import time
+import typing
 
 import requests
 import requests.adapters
+import requests.utils
 import urllib3.exceptions
 import urllib3.util.retry
 
 from ..config import config
 from ..errors import err_to_str
 from . import logger
 
@@ -62,112 +65,144 @@
         retry_on_exception=True,
         retry_on_status=True,
         retry_on_post=False,
         verbose=False,
     ):
         """
         Initialize a new HTTP session with retry logic.
-        :param max_retries: Maximum number of retries to attempt.
-        :param retry_backoff_factor: Wait interval retries in seconds.
-        :param retry_on_exception: Retry on the HTTP_RETRYABLE_EXCEPTIONS. defaults to True.
-        :param retry_on_status: Retry on error status codes. defaults to True.
-        :param retry_on_post: Retry on POST requests. defaults to False.
-        :param verbose: Print debug messages.
+        :param max_retries:             Maximum number of retries to attempt.
+        :param retry_backoff_factor:    Wait interval retries in seconds.
+        :param retry_on_exception:      Retry on the HTTP_RETRYABLE_EXCEPTIONS. defaults to True.
+        :param retry_on_status:         Retry on error status codes. defaults to True.
+        :param retry_on_post:           Retry on POST requests. defaults to False.
+        :param verbose:                 Print debug messages.
         """
         super().__init__()
 
         self.max_retries = max_retries
         self.retry_backoff_factor = retry_backoff_factor
         self.retry_on_exception = retry_on_exception
         self.verbose = verbose
+        self._logger = logger.get_child("http-client")
+        self._retry_methods = self._resolve_retry_methods(retry_on_post)
 
         if retry_on_status:
-            http_adapter = requests.adapters.HTTPAdapter(
+            self._http_adapter = requests.adapters.HTTPAdapter(
                 max_retries=urllib3.util.retry.Retry(
                     total=self.max_retries,
                     backoff_factor=self.retry_backoff_factor,
                     status_forcelist=config.http_retry_defaults.status_codes,
-                    method_whitelist=self._get_retry_methods(retry_on_post),
+                    method_whitelist=self._retry_methods,
                     # we want to retry but not to raise since we do want that last response (to parse details on the
                     # error from response body) we'll handle raising ourselves
                     raise_on_status=False,
                 ),
                 pool_maxsize=int(config.httpdb.max_workers),
             )
 
-            self.mount("http://", http_adapter)
-            self.mount("https://", http_adapter)
+            self.mount("http://", self._http_adapter)
+            self.mount("https://", self._http_adapter)
 
     def request(self, method, url, **kwargs):
         retry_count = 0
+        kwargs.setdefault("headers", {})
+        kwargs["headers"][
+            "User-Agent"
+        ] = f"{requests.utils.default_user_agent()} mlrun/{config.version}"
         while True:
             try:
                 response = super().request(method, url, **kwargs)
                 return response
             except Exception as exc:
-                if not self.retry_on_exception:
-                    self._log_exception(
-                        "warning",
-                        exc,
-                        f"{method} {url} request failed, http retries disabled,"
-                        f" raising exception: {err_to_str(exc)}",
-                        retry_count,
-                    )
-                    raise exc
-
-                if retry_count >= self.max_retries:
-                    self._log_exception(
-                        "warning",
-                        exc,
-                        f"{method} {url} request failed, max retries reached,"
-                        f" raising exception: {err_to_str(exc)}",
-                        retry_count,
-                    )
+                if not self._error_is_retryable(url, method, exc, retry_count):
                     raise exc
 
-                # only retryable exceptions
-                exception_is_retryable = any(
-                    msg in str(exc) for msg in self.HTTP_RETRYABLE_EXCEPTION_STRINGS
-                ) or any(
-                    isinstance(exc, retryable_exc)
-                    for retryable_exc in self.HTTP_RETRYABLE_EXCEPTIONS
+                self._logger.warning(
+                    "Error during request handling, retrying",
+                    exc=str(exc),
+                    retry_count=retry_count,
+                    url=url,
+                    method=method,
                 )
-
-                if not exception_is_retryable:
-                    self._log_exception(
-                        "warning",
-                        exc,
-                        f"{method} {url} request failed on non-retryable exception,"
-                        f" raising exception: {err_to_str(exc)}",
-                        retry_count,
-                    )
-                    raise exc
-
                 if self.verbose:
                     self._log_exception(
                         "debug",
                         exc,
                         f"{method} {url} request failed on retryable exception, "
                         f"retrying in {self.retry_backoff_factor} seconds",
                         retry_count,
                     )
                 retry_count += 1
                 time.sleep(self.retry_backoff_factor)
 
-    @staticmethod
-    def _get_retry_methods(retry_on_post=False):
-        return (
-            # setting to False in order to retry on all methods, otherwise every method except POST.
-            False
-            if retry_on_post
-            else urllib3.util.retry.Retry.DEFAULT_METHOD_WHITELIST
+    def _error_is_retryable(self, url, method, exc, retry_count):
+        if not self.retry_on_exception:
+            self._log_exception(
+                "warning",
+                exc,
+                f"{method} {url} request failed, http retries disabled,"
+                f" raising exception: {err_to_str(exc)}",
+                retry_count,
+            )
+            return False
+
+        # if the response is not retryable, stop retrying
+        # this is done to prevent the retry logic from running on non-idempotent methods (such as POST).
+        if not self._method_retryable(method):
+            self._log_exception(
+                "warning",
+                exc,
+                f"{method} {url} request failed, http retries disabled for {method} method.",
+                retry_count,
+            )
+            return False
+
+        if retry_count >= self.max_retries:
+            self._log_exception(
+                "warning",
+                exc,
+                f"{method} {url} request failed, max retries reached,"
+                f" raising exception: {err_to_str(exc)}",
+                retry_count,
+            )
+            return False
+
+        # only retryable exceptions
+        exception_is_retryable = any(
+            msg in str(exc) for msg in self.HTTP_RETRYABLE_EXCEPTION_STRINGS
+        ) or any(
+            isinstance(exc, retryable_exc)
+            for retryable_exc in self.HTTP_RETRYABLE_EXCEPTIONS
         )
 
+        if not exception_is_retryable:
+            self._log_exception(
+                "warning",
+                exc,
+                f"{method} {url} request failed on non-retryable exception,"
+                f" raising exception: {err_to_str(exc)}",
+                retry_count,
+            )
+            return False
+        return True
+
+    def _method_retryable(self, method: str):
+        return method in self._retry_methods
+
+    def _resolve_retry_methods(
+        self, retry_on_post: bool = False
+    ) -> typing.FrozenSet[str]:
+        methods = urllib3.util.retry.Retry.DEFAULT_ALLOWED_METHODS
+        methods = methods.union({"PATCH"})
+        if retry_on_post:
+            methods = methods.union({"POST"})
+        return frozenset(methods)
+
     def _log_exception(self, level, exc, message, retry_count):
-        getattr(logger, level)(
+        getattr(self._logger, level)(
             message,
             exception_type=type(exc),
             exception_message=err_to_str(exc),
             retry_interval=self.retry_backoff_factor,
             retry_count=retry_count,
             max_retries=self.max_retries,
         )
```

## mlrun/utils/logger.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/regex.py

```diff
@@ -1,22 +1,27 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
+# pipeline param format which is passed when running a pipeline (e.g. {{pipelineparam:op=;name=mem}})
+# https://github.com/kubeflow/pipelines/blob/16edebf4eaf84cd7478e2601ef4878ab339a7854/sdk/python/kfp/dsl/_pipeline_param.py#L213
+# this is expected to be resolved at runtime
+pipeline_param = [r"{{pipelineparam:op=([\w\s_-]*);name=([\w\s_-]+)}}"]
+
 # k8s character limit is for 63 characters
 k8s_character_limit = [r"^.{0,63}$"]
 
 # k8s label value format
 # https://github.com/kubernetes/kubernetes/blob/v1.20.0/staging/src/k8s.io/apimachinery/pkg/util/validation/validation.go#L161
 label_value = k8s_character_limit + [r"^(([A-Za-z0-9][-A-Za-z0-9_.]*)?[A-Za-z0-9])?$"]
```

## mlrun/utils/singleton.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/v3io_clients.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/vault.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2020 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/notifications/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/notifications/notification_pusher.py

```diff
@@ -1,290 +1,417 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
-import ast
 import asyncio
 import datetime
 import os
 import typing
+from concurrent.futures import ThreadPoolExecutor
 
 from fastapi.concurrency import run_in_threadpool
 
 import mlrun.api.db.base
 import mlrun.api.db.session
 import mlrun.common.schemas
 import mlrun.config
 import mlrun.lists
 import mlrun.model
 import mlrun.utils.helpers
 from mlrun.utils import logger
+from mlrun.utils.condition_evaluator import evaluate_condition_in_separate_process
 
 from .notification import NotificationBase, NotificationTypes
 
 
 class NotificationPusher(object):
 
     messages = {
         "completed": "Run completed",
         "error": "Run failed",
+        "aborted": "Run aborted",
     }
 
     def __init__(self, runs: typing.Union[mlrun.lists.RunList, list]):
         self._runs = runs
-        self._notification_data = []
-        self._notifications = {}
+        self._sync_notifications = []
+        self._async_notifications = []
 
         for run in self._runs:
             if isinstance(run, dict):
                 run = mlrun.model.RunObject.from_dict(run)
 
             for notification in run.spec.notifications:
-                notification.status = run.status.notifications.get(
-                    notification.name
-                ).get("status", mlrun.common.schemas.NotificationStatus.PENDING)
+                try:
+                    notification.status = run.status.notifications.get(
+                        notification.name
+                    ).get("status", mlrun.common.schemas.NotificationStatus.PENDING)
+                except (AttributeError, KeyError):
+                    notification.status = (
+                        mlrun.common.schemas.NotificationStatus.PENDING
+                    )
+
                 if self._should_notify(run, notification):
-                    self._notification_data.append((run, notification))
+                    self._load_notification(run, notification)
 
     def push(
         self,
         db: mlrun.api.db.base.DBInterface = None,
     ):
         """
         Asynchronously push notifications for all runs in the initialized runs list (if they should be pushed).
         When running from a sync environment, the notifications will be pushed asynchronously however the function will
         wait for all notifications to be pushed before returning.
         """
 
-        if not len(self._notification_data):
+        if not len(self._sync_notifications) and not len(self._async_notifications):
             return
 
-        async def _push():
+        def _sync_push():
+            for notification_data in self._sync_notifications:
+                self._push_notification_sync(
+                    notification_data[0],
+                    notification_data[1],
+                    notification_data[2],
+                    db,
+                )
+
+        async def _async_push():
             tasks = []
-            for notification_data in self._notification_data:
+            for notification_data in self._async_notifications:
                 tasks.append(
-                    self._push_notification(
-                        self._load_notification(*notification_data),
+                    self._push_notification_async(
                         notification_data[0],
                         notification_data[1],
+                        notification_data[2],
                         db,
                     )
                 )
-            await asyncio.gather(*tasks)
+
+            # return exceptions to "best-effort" fire all notifications
+            await asyncio.gather(*tasks, return_exceptions=True)
 
         logger.debug(
-            "Pushing notifications", notifications_amount=len(self._notification_data)
+            "Pushing notifications",
+            notifications_amount=len(self._sync_notifications)
+            + len(self._async_notifications),
         )
-        main_event_loop = asyncio.get_event_loop()
-        if main_event_loop.is_running():
-
-            # If running from the api or from jupyter notebook, we are already in an event loop.
-            # We add the async push function to the loop and run it.
-            asyncio.run_coroutine_threadsafe(_push(), main_event_loop)
-        else:
 
+        # first push async notifications
+        main_event_loop = asyncio.get_event_loop()
+        if not main_event_loop.is_running():
             # If running mlrun SDK locally (not from jupyter), there isn't necessarily an event loop.
             # We create a new event loop and run the async push function in it.
-            main_event_loop.run_until_complete(_push())
+            main_event_loop.run_until_complete(_async_push())
+        elif mlrun.utils.helpers.is_running_in_jupyter_notebook():
+            # Running in Jupyter notebook.
+            # In this case, we need to create a new thread, run a separate event loop in
+            # that thread, and use it instead of the main_event_loop.
+            # This is necessary because Jupyter Notebook has its own event loop,
+            # but it runs in the main thread. As long as a cell is running,
+            # the event loop will not execute properly
+            _run_coroutine_in_jupyter_notebook(coroutine_method=_async_push)
+        else:
+            # Running in mlrun api, we are in a separate thread from the one in which
+            # the main event loop, so we can just send the notifications to that loop
+            asyncio.run_coroutine_threadsafe(_async_push(), main_event_loop)
+
+        # then push sync notifications
+        if not mlrun.config.is_running_as_api():
+            _sync_push()
 
     @staticmethod
     def _should_notify(
         run: mlrun.model.RunObject,
         notification: mlrun.model.Notification,
     ) -> bool:
         when_states = notification.when
-        condition = notification.condition
         run_state = run.state()
 
         # if the notification isn't pending, don't push it
         if (
             notification.status
             and notification.status != mlrun.common.schemas.NotificationStatus.PENDING
         ):
             return False
 
         # if at least one condition is met, notify
         for when_state in when_states:
-            if (
-                when_state == run_state == "completed"
-                and (not condition or ast.literal_eval(condition))
-            ) or when_state == run_state == "error":
-                return True
+            if when_state == run_state:
+                if (
+                    run_state == "completed"
+                    and evaluate_condition_in_separate_process(
+                        notification.condition,
+                        context={
+                            "run": run.to_dict(),
+                            "notification": notification.to_dict(),
+                        },
+                    )
+                ) or run_state in ["error", "aborted"]:
+                    return True
 
         return False
 
     def _load_notification(
-        self, run: mlrun.model.RunObject, notification: mlrun.model.Notification
+        self, run: mlrun.model.RunObject, notification_object: mlrun.model.Notification
     ) -> NotificationBase:
-        name = notification.name
+        name = notification_object.name
         notification_type = NotificationTypes(
-            notification.kind or NotificationTypes.console
+            notification_object.kind or NotificationTypes.console
+        )
+        notification = notification_type.get_notification()(
+            name, notification_object.params
         )
-        notification_key = f"{run.metadata.uid}-{name or notification_type}"
-        if notification_key not in self._notifications:
-            self._notifications[
-                notification_key
-            ] = notification_type.get_notification()(name, notification.params)
+        if notification.is_async:
+            self._async_notifications.append((notification, run, notification_object))
         else:
-            self._notifications[notification_key].load_notification(notification.params)
+            self._sync_notifications.append((notification, run, notification_object))
 
         logger.debug(
-            "Loaded notification", notification=self._notifications[notification_key]
+            "Loaded notification", notification=name, type=notification_type.value
+        )
+        return notification
+
+    def _prepare_notification_args(
+        self, run: mlrun.model.RunObject, notification_object: mlrun.model.Notification
+    ):
+        custom_message = (
+            f": {notification_object.message}" if notification_object.message else ""
         )
-        return self._notifications[notification_key]
+        message = self.messages.get(run.state(), "") + custom_message
 
-    async def _push_notification(
+        severity = (
+            notification_object.severity
+            or mlrun.common.schemas.NotificationSeverity.INFO
+        )
+        return message, severity, [run.to_dict()]
+
+    def _push_notification_sync(
         self,
         notification: NotificationBase,
         run: mlrun.model.RunObject,
         notification_object: mlrun.model.Notification,
         db: mlrun.api.db.base.DBInterface,
     ):
-        message = self.messages.get(run.state(), "")
-        severity = (
-            notification_object.severity
-            or mlrun.common.schemas.NotificationSeverity.INFO
+        message, severity, runs = self._prepare_notification_args(
+            run, notification_object
         )
         logger.debug(
-            "Pushing notification",
+            "Pushing sync notification",
             notification=_sanitize_notification(notification_object),
             run_uid=run.metadata.uid,
         )
         try:
-            if asyncio.iscoroutinefunction(notification.push):
-                await notification.push(message, severity, [run.to_dict()])
-            else:
-                notification.push(message, severity, [run.to_dict()])
+            notification.push(message, severity, runs)
+            self._update_notification_status(
+                db,
+                run.metadata.uid,
+                run.metadata.project,
+                notification_object,
+                status=mlrun.common.schemas.NotificationStatus.SENT,
+                sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
+            )
+        except Exception as exc:
+            self._update_notification_status(
+                db,
+                run.metadata.uid,
+                run.metadata.project,
+                notification_object,
+                status=mlrun.common.schemas.NotificationStatus.ERROR,
+            )
+            raise exc
 
-            if mlrun.config.is_running_as_api():
-                await self._update_notification_status(
-                    db,
-                    run.metadata.uid,
-                    run.metadata.project,
-                    notification_object,
-                    status=mlrun.common.schemas.NotificationStatus.SENT,
-                    sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
-                )
+    async def _push_notification_async(
+        self,
+        notification: NotificationBase,
+        run: mlrun.model.RunObject,
+        notification_object: mlrun.model.Notification,
+        db: mlrun.api.db.base.DBInterface,
+    ):
+        message, severity, runs = self._prepare_notification_args(
+            run, notification_object
+        )
+        logger.debug(
+            "Pushing async notification",
+            notification=_sanitize_notification(notification_object),
+            run_uid=run.metadata.uid,
+        )
+        try:
+            await notification.push(message, severity, runs)
+
+            await run_in_threadpool(
+                self._update_notification_status,
+                db,
+                run.metadata.uid,
+                run.metadata.project,
+                notification_object,
+                status=mlrun.common.schemas.NotificationStatus.SENT,
+                sent_time=datetime.datetime.now(tz=datetime.timezone.utc),
+            )
         except Exception as exc:
-            if mlrun.config.is_running_as_api():
-                await self._update_notification_status(
-                    db,
-                    run.metadata.uid,
-                    run.metadata.project,
-                    notification_object,
-                    status=mlrun.common.schemas.NotificationStatus.ERROR,
-                )
+            await run_in_threadpool(
+                self._update_notification_status,
+                db,
+                run.metadata.uid,
+                run.metadata.project,
+                notification_object,
+                status=mlrun.common.schemas.NotificationStatus.ERROR,
+            )
             raise exc
 
     @staticmethod
-    async def _update_notification_status(
+    def _update_notification_status(
         db: mlrun.api.db.base.DBInterface,
         run_uid: str,
         project: str,
         notification: mlrun.model.Notification,
         status: str = None,
-        sent_time: datetime.datetime = None,
+        sent_time: typing.Optional[datetime.datetime] = None,
     ):
+
+        # nothing to update if not running as api
+        # note, the notification mechanism may run "locally" for certain runtimes
+        if not mlrun.config.is_running_as_api():
+            return
+
         # TODO: move to api side
         db_session = mlrun.api.db.session.create_session()
         notification.status = status or notification.status
         notification.sent_time = sent_time or notification.sent_time
 
         # store directly in db, no need to use crud as the secrets are already loaded
-        await run_in_threadpool(
-            db.store_run_notifications,
+        db.store_run_notifications(
             db_session,
             [notification],
             run_uid,
             project,
         )
 
 
 class CustomNotificationPusher(object):
     def __init__(self, notification_types: typing.List[str] = None):
-        self._notifications = {
+        notifications = {
             notification_type: NotificationTypes(notification_type).get_notification()()
             for notification_type in notification_types
         }
+        self._sync_notifications = {
+            notification_type: notification
+            for notification_type, notification in notifications.items()
+            if not notification.is_async
+        }
+        self._async_notifications = {
+            notification_type: notification
+            for notification_type, notification in notifications.items()
+            if notification.is_async
+        }
 
     def push(
         self,
         message: str,
         severity: typing.Union[
             mlrun.common.schemas.NotificationSeverity, str
         ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
-        async def _push():
+        def _sync_push():
+            for notification_type, notification in self._sync_notifications.items():
+                if self.should_push_notification(notification_type):
+                    notification.push(message, severity, runs, custom_html)
+
+        async def _async_push():
             tasks = []
-            for notification_type, notification in self._notifications.items():
+            for notification_type, notification in self._async_notifications.items():
                 if self.should_push_notification(notification_type):
                     tasks.append(
-                        self._push_notification(
-                            notification, message, severity, runs, custom_html
-                        )
+                        notification.push(message, severity, runs, custom_html)
                     )
-            await asyncio.gather(*tasks)
+            # return exceptions to "best-effort" fire all notifications
+            await asyncio.gather(*tasks, return_exceptions=True)
 
+        # first push async notifications
         main_event_loop = asyncio.get_event_loop()
-        if main_event_loop.is_running():
-            asyncio.run_coroutine_threadsafe(_push(), main_event_loop)
+        if not main_event_loop.is_running():
+            # If running mlrun SDK locally (not from jupyter), there isn't necessarily an event loop.
+            # We create a new event loop and run the async push function in it.
+            main_event_loop.run_until_complete(_async_push())
+        elif mlrun.utils.helpers.is_running_in_jupyter_notebook():
+            # Running in Jupyter notebook.
+            # In this case, we need to create a new thread, run a separate event loop in
+            # that thread, and use it instead of the main_event_loop.
+            # This is necessary because Jupyter Notebook has its own event loop,
+            # but it runs in the main thread. As long as a cell is running,
+            # the event loop will not execute properly
+            _run_coroutine_in_jupyter_notebook(coroutine_method=_async_push)
         else:
-            main_event_loop.run_until_complete(_push())
+            # Running in mlrun api, we are in a separate thread from the one in which
+            # the main event loop, so we can just send the notifications to that loop
+            asyncio.run_coroutine_threadsafe(_async_push(), main_event_loop)
+
+        # then push sync notifications
+        if not mlrun.config.is_running_as_api():
+            _sync_push()
 
-    @staticmethod
-    async def _push_notification(
-        notification: NotificationBase,
-        message: str,
-        severity: typing.Union[
-            mlrun.common.schemas.NotificationSeverity, str
-        ] = mlrun.common.schemas.NotificationSeverity.INFO,
-        runs: typing.Union[mlrun.lists.RunList, list] = None,
-        custom_html: str = None,
+    def add_notification(
+        self, notification_type: str, params: typing.Dict[str, str] = None
     ):
-        if asyncio.iscoroutinefunction(notification.push):
-            await notification.push(message, severity, runs, custom_html)
+        if notification_type in self._async_notifications:
+            self._async_notifications[notification_type].load_notification(params)
+        elif notification_type in self._sync_notifications:
+            self._sync_notifications[notification_type].load_notification(params)
         else:
-            notification.push(message, severity, runs, custom_html)
+            notification = NotificationTypes(notification_type).get_notification()(
+                params=params,
+            )
+            if notification.is_async:
+                self._async_notifications[notification_type] = notification
+            else:
+                self._sync_notifications[notification_type] = notification
 
-    def add_notification(
+    def remove_notification(self, notification_type: str):
+        if notification_type in self._async_notifications:
+            del self._async_notifications[notification_type]
+
+        elif notification_type in self._sync_notifications:
+            del self._sync_notifications[notification_type]
+
+        else:
+            logger.warning(f"No notification of type {notification_type} in project")
+
+    def edit_notification(
         self, notification_type: str, params: typing.Dict[str, str] = None
     ):
-        if notification_type in self._notifications:
-            self._notifications[notification_type].load_notification(params)
-        else:
-            self._notifications[notification_type] = NotificationTypes(
-                notification_type
-            ).get_notification()(params)
+        self.remove_notification(notification_type)
+        self.add_notification(notification_type, params)
 
     def should_push_notification(self, notification_type):
-        notification = self._notifications.get(notification_type)
+        notifications = {}
+        notifications.update(self._sync_notifications)
+        notifications.update(self._async_notifications)
+        notification = notifications.get(notification_type)
         if not notification or not notification.active:
             return False
 
         # get notification's inverse dependencies, and only push the notification if
         # none of its inverse dependencies are being sent
         inverse_dependencies = NotificationTypes(
             notification_type
         ).inverse_dependencies()
         for inverse_dependency in inverse_dependencies:
-            inverse_dependency_notification = self._notifications.get(
-                inverse_dependency
-            )
+            inverse_dependency_notification = notifications.get(inverse_dependency)
             if (
                 inverse_dependency_notification
                 and inverse_dependency_notification.active
             ):
                 return False
 
         return True
@@ -292,15 +419,15 @@
     def push_pipeline_start_message(
         self,
         project: str,
         commit_id: str = None,
         pipeline_id: str = None,
         has_workflow_url: bool = False,
     ):
-        message = f"Pipeline started in project {project}"
+        message = f"Workflow started in project {project}"
         if pipeline_id:
             message += f" id={pipeline_id}"
         commit_id = (
             commit_id or os.environ.get("GITHUB_SHA") or os.environ.get("CI_COMMIT_SHA")
         )
         if commit_id:
             message += f", commit={commit_id}"
@@ -348,7 +475,43 @@
         self.push(text, "info", runs=runs_list)
 
 
 def _sanitize_notification(notification: mlrun.model.Notification):
     notification_dict = notification.to_dict()
     notification_dict.pop("params", None)
     return notification_dict
+
+
+def _separate_sync_notifications(
+    notifications: typing.List[NotificationBase],
+) -> typing.Tuple[typing.List[NotificationBase], typing.List[NotificationBase]]:
+    sync_notifications = []
+    async_notifications = []
+    for notification in notifications:
+        if notification.is_async:
+            async_notifications.append(notification)
+        else:
+            sync_notifications.append(notification)
+    return sync_notifications, async_notifications
+
+
+def _run_coroutine_in_jupyter_notebook(coroutine_method):
+    """
+    Execute a coroutine in a Jupyter Notebook environment.
+
+    This function creates a new thread pool executor with a single thread and a new event loop.
+    It sets the created event loop as the current event loop.
+    Then, it submits the coroutine to the event loop and waits for its completion.
+
+    This approach is used in Jupyter Notebook to ensure the proper execution of the event loop in a separate thread,
+    allowing for the asynchronous push operation to be executed while the notebook is running.
+
+    :param coroutine_method: The coroutine method to be executed.
+    :return: The result of the executed coroutine.
+    """
+    thread_pool_executer = ThreadPoolExecutor(1)
+    async_event_loop = asyncio.new_event_loop()
+    thread_pool_executer.submit(asyncio.set_event_loop, async_event_loop).result()
+    result = thread_pool_executer.submit(
+        async_event_loop.run_until_complete, coroutine_method()
+    ).result()
+    return result
```

## mlrun/utils/notifications/notification/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -11,33 +11,38 @@
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
 import enum
 import typing
 
+from mlrun.common.schemas.notification import NotificationKind
+
 from .base import NotificationBase
 from .console import ConsoleNotification
 from .git import GitNotification
 from .ipython import IPythonNotification
 from .slack import SlackNotification
+from .webhook import WebhookNotification
 
 
 class NotificationTypes(str, enum.Enum):
-    console = "console"
-    git = "git"
-    ipython = "ipython"
-    slack = "slack"
+    console = NotificationKind.console.value
+    git = NotificationKind.git.value
+    ipython = NotificationKind.ipython.value
+    slack = NotificationKind.slack.value
+    webhook = NotificationKind.webhook.value
 
     def get_notification(self) -> typing.Type[NotificationBase]:
         return {
             self.console: ConsoleNotification,
             self.git: GitNotification,
             self.ipython: IPythonNotification,
             self.slack: SlackNotification,
+            self.webhook: WebhookNotification,
         }.get(self)
 
     def inverse_dependencies(self) -> typing.List[str]:
         """
         Some notifications should only run if another notification type didn't run.
         Per given notification type, return a list of notification types that should not run in order for this
         notification to run.
@@ -50,9 +55,10 @@
     def all(cls) -> typing.List[str]:
         return list(
             [
                 cls.console,
                 cls.git,
                 cls.ipython,
                 cls.slack,
+                cls.webhook,
             ]
         )
```

## mlrun/utils/notifications/notification/base.py

```diff
@@ -1,21 +1,22 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 
+import asyncio
 import typing
 
 import mlrun.common.schemas
 import mlrun.lists
 
 
 class NotificationBase:
@@ -27,14 +28,18 @@
         self.name = name
         self.params = params or {}
 
     @property
     def active(self) -> bool:
         return True
 
+    @property
+    def is_async(self) -> bool:
+        return asyncio.iscoroutinefunction(self.push)
+
     def push(
         self,
         message: str,
         severity: typing.Union[
             mlrun.common.schemas.NotificationSeverity, str
         ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
```

## mlrun/utils/notifications/notification/console.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/notifications/notification/git.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -37,35 +37,38 @@
             mlrun.common.schemas.NotificationSeverity, str
         ] = mlrun.common.schemas.NotificationSeverity.INFO,
         runs: typing.Union[mlrun.lists.RunList, list] = None,
         custom_html: str = None,
     ):
         git_repo = self.params.get("repo", None)
         git_issue = self.params.get("issue", None)
+        git_merge_request = self.params.get("merge_request", None)
         token = (
             self.params.get("token", None)
             or self.params.get("GIT_TOKEN", None)
             or self.params.get("GITHUB_TOKEN", None)
         )
         server = self.params.get("server", None)
         gitlab = self.params.get("gitlab", False)
         await self._pr_comment(
             self._get_html(message, severity, runs, custom_html),
             git_repo,
             git_issue,
+            merge_request=git_merge_request,
             token=token,
             server=server,
             gitlab=gitlab,
         )
 
     @staticmethod
     async def _pr_comment(
         message: str,
         repo: str = None,
         issue: int = None,
+        merge_request: int = None,
         token: str = None,
         server: str = None,
         gitlab: bool = False,
     ) -> str:
         """push comment message to Git system PR/issue
 
         :param message:  test message
@@ -85,34 +88,41 @@
         )
 
         if gitlab:
             server = server or "gitlab.com"
             headers = {"PRIVATE-TOKEN": token}
             repo = repo or os.environ.get("CI_PROJECT_ID")
             # auto detect GitLab pr id from the environment
-            issue = issue or os.environ.get("CI_MERGE_REQUEST_IID")
+            issue = issue or os.environ.get("CI_ISSUE_IID")
+            merge_request = merge_request or os.environ.get("CI_MERGE_REQUEST_IID")
             # replace slash with url encoded slash for GitLab to accept a repo name with slash
             repo = repo.replace("/", "%2F")
-            url = (
-                f"https://{server}/api/v4/projects/{repo}/merge_requests/{issue}/notes"
-            )
+
+            if merge_request:
+                url = f"https://{server}/api/v4/projects/{repo}/merge_requests/{merge_request}/notes"
+            elif issue:
+                url = f"https://{server}/api/v4/projects/{repo}/issues/{issue}/notes"
+            else:
+                raise mlrun.errors.MLRunInvalidArgumentError(
+                    "GitLab issue or merge request id not specified"
+                )
         else:
             server = server or "api.github.com"
             repo = repo or os.environ.get("GITHUB_REPOSITORY")
             # auto detect pr number if not specified, in github the pr id is identified as an issue id
             # we try and read the pr (issue) id from the github actions event file/object
             if not issue and "GITHUB_EVENT_PATH" in os.environ:
                 with open(os.environ["GITHUB_EVENT_PATH"]) as fp:
                     data = fp.read()
                     event = json.loads(data)
-                    if "issue" not in event:
+                    if "number" not in event:
                         raise mlrun.errors.MLRunInvalidArgumentError(
                             f"issue not found in github actions event\ndata={data}"
                         )
-                    issue = event["issue"].get("number")
+                    issue = event["number"]
             headers = {
                 "Accept": "application/vnd.github.v3+json",
                 "Authorization": f"token {token}",
             }
             url = f"https://{server}/repos/{repo}/issues/{issue}/comments"
 
         async with aiohttp.ClientSession() as session:
```

## mlrun/utils/notifications/notification/ipython.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -24,24 +24,23 @@
 class IPythonNotification(NotificationBase):
     """
     Client only notification for printing rich run statuses in IPython/Jupyter notebooks
     """
 
     def __init__(
         self,
+        name: str = None,
         params: typing.Dict[str, str] = None,
     ):
-        super().__init__(params)
+        super().__init__(name, params)
         self._ipython = None
         try:
             import IPython
 
-            ipy = IPython.get_ipython()
-            # if its IPython terminal ignore (can't show html)
-            if ipy and "Terminal" not in str(type(ipy)):
+            if mlrun.utils.helpers.is_running_in_jupyter_notebook():
                 self._ipython = IPython
         except ImportError:
             pass
 
     @property
     def active(self) -> bool:
         return self._ipython is not None
```

## mlrun/utils/notifications/notification/slack.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -71,14 +71,18 @@
             "blocks": [
                 {
                     "type": "section",
                     "text": self._get_slack_row(f"[{severity}] {message}"),
                 },
             ]
         }
+        if self.name:
+            data["blocks"].append(
+                {"type": "section", "text": self._get_slack_row(self.name)}
+            )
 
         if not runs:
             return data
 
         if isinstance(runs, list):
             runs = mlrun.lists.RunList(runs)
```

## mlrun/utils/version/__init__.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## mlrun/utils/version/version.json

### Pretty-printed

 * *Similarity: 0.5%*

 * *Differences: {"'git_commit'": "'8657600387e10ed5be7da503d356e86e92c07c35'", "'version'": "'1.5.0-rc1'"}*

```diff
@@ -1,4 +1,4 @@
 {
-    "git_commit": "0765b928dc0f4ccb278e334638999ed245594419",
-    "version": "1.4.0-rc9"
+    "git_commit": "8657600387e10ed5be7da503d356e86e92c07c35",
+    "version": "1.5.0-rc1"
 }
```

## mlrun/utils/version/version.py

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## Comparing `mlrun/api/db/sqldb/session.py` & `mlrun/common/db/sql_session.py`

 * *Files 1% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
```

## Comparing `mlrun/common/model_monitoring.py` & `mlrun/common/schemas/model_monitoring/constants.py`

 * *Files 24% similar despite different names*

```diff
@@ -1,27 +1,27 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
 # Unless required by applicable law or agreed to in writing, software
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
-
 import enum
 import hashlib
 from dataclasses import dataclass
 from typing import Optional
 
+import mlrun.common.helpers
 import mlrun.utils
 
 
 class EventFieldType:
     FUNCTION_URI = "function_uri"
     FUNCTION = "function"
     MODEL_URI = "model_uri"
@@ -125,47 +125,24 @@
 
 class EndpointType(enum.IntEnum):
     NODE_EP = 1  # end point that is not a child of a router
     ROUTER = 2  # endpoint that is router
     LEAF_EP = 3  # end point that is a child of a router
 
 
-def create_model_endpoint_uid(function_uri: str, versioned_model: str):
-    function_uri = FunctionURI.from_string(function_uri)
-    versioned_model = VersionedModel.from_string(versioned_model)
-
-    if (
-        not function_uri.project
-        or not function_uri.function
-        or not versioned_model.model
-    ):
-        raise ValueError("Both function_uri and versioned_model have to be initialized")
-
-    uid = EndpointUID(
-        function_uri.project,
-        function_uri.function,
-        function_uri.tag,
-        function_uri.hash_key,
-        versioned_model.model,
-        versioned_model.version,
-    )
-
-    return uid
-
-
 @dataclass
 class FunctionURI:
     project: str
     function: str
     tag: Optional[str] = None
     hash_key: Optional[str] = None
 
     @classmethod
     def from_string(cls, function_uri):
-        project, uri, tag, hash_key = mlrun.utils.parse_versioned_object_uri(
+        project, uri, tag, hash_key = mlrun.common.helpers.parse_versioned_object_uri(
             function_uri
         )
         return cls(
             project=project,
             function=uri,
             tag=tag or None,
             hash_key=hash_key or None,
```

## Comparing `mlrun/model_monitoring/stream_processing_fs.py` & `mlrun/model_monitoring/stream_processing.py`

 * *Files 4% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -17,56 +17,46 @@
 import json
 import os
 import typing
 
 import pandas as pd
 import storey
 
-import mlrun
-import mlrun.common.model_monitoring
-import mlrun.config
-import mlrun.datastore.targets
+import mlrun.common.model_monitoring.helpers
 import mlrun.feature_store.steps
-import mlrun.utils
-import mlrun.utils.model_monitoring
 import mlrun.utils.v3io_clients
-from mlrun.common.model_monitoring import (
+from mlrun.common.schemas.model_monitoring.constants import (
     EventFieldType,
     EventKeyMetrics,
     EventLiveStats,
     FileTargetKind,
     ModelEndpointTarget,
     ProjectSecretKeys,
 )
-from mlrun.model_monitoring.stores import get_model_endpoint_store
 from mlrun.utils import logger
 
 
 # Stream processing code
 class EventStreamProcessor:
     def __init__(
         self,
         project: str,
         parquet_batching_max_events: int,
         parquet_target: str,
         sample_window: int = 10,
         parquet_batching_timeout_secs: int = 30 * 60,  # Default 30 minutes
-        aggregate_count_windows: typing.Optional[typing.List[str]] = None,
-        aggregate_count_period: str = "30s",
-        aggregate_avg_windows: typing.Optional[typing.List[str]] = None,
-        aggregate_avg_period: str = "30s",
+        aggregate_windows: typing.Optional[typing.List[str]] = None,
+        aggregate_period: str = "30s",
         model_monitoring_access_key: str = None,
     ):
         # General configurations, mainly used for the storey steps in the future serving graph
         self.project = project
         self.sample_window = sample_window
-        self.aggregate_count_windows = aggregate_count_windows or ["5m", "1h"]
-        self.aggregate_count_period = aggregate_count_period
-        self.aggregate_avg_windows = aggregate_avg_windows or ["5m", "1h"]
-        self.aggregate_avg_period = aggregate_avg_period
+        self.aggregate_windows = aggregate_windows or ["5m", "1h"]
+        self.aggregate_period = aggregate_period
 
         # Parquet path and configurations
         self.parquet_path = parquet_target
         self.parquet_batching_max_events = parquet_batching_max_events
         self.parquet_batching_timeout_secs = parquet_batching_timeout_secs
 
         self.model_endpoint_store_target = (
@@ -112,25 +102,29 @@
         kv_path = mlrun.mlconf.get_model_monitoring_file_target_path(
             project=self.project, kind=FileTargetKind.ENDPOINTS
         )
         (
             _,
             self.kv_container,
             self.kv_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(kv_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            kv_path
+        )
 
         # TSDB path and configurations
         tsdb_path = mlrun.mlconf.get_model_monitoring_file_target_path(
             project=self.project, kind=FileTargetKind.EVENTS
         )
         (
             _,
             self.tsdb_container,
             self.tsdb_path,
-        ) = mlrun.utils.model_monitoring.parse_model_endpoint_store_prefix(tsdb_path)
+        ) = mlrun.common.model_monitoring.helpers.parse_model_endpoint_store_prefix(
+            tsdb_path
+        )
 
         self.tsdb_path = f"{self.tsdb_container}/{self.tsdb_path}"
         self.tsdb_batching_max_events = tsdb_batching_max_events
         self.tsdb_batching_timeout_secs = tsdb_batching_timeout_secs
 
     def apply_monitoring_serving_graph(self, fn):
         """
@@ -198,56 +192,52 @@
                 after="flatten_events",
             )
 
         apply_map_feature_names()
 
         # Step 5 - Calculate number of predictions and average latency
         def apply_storey_aggregations():
-            # Step 5.1 - Calculate number of predictions for each window (5 min and 1 hour by default)
+            # Step 5.1 - Calculate number of predictions and average latency for each window (5 min and 1 hour)
             graph.add_step(
                 class_name="storey.AggregateByKey",
                 aggregates=[
                     {
-                        "name": EventFieldType.PREDICTIONS,
-                        "column": EventFieldType.ENDPOINT_ID,
-                        "operations": ["count"],
-                        "windows": self.aggregate_count_windows,
-                        "period": self.aggregate_count_period,
+                        "name": EventFieldType.LATENCY,
+                        "column": EventFieldType.LATENCY,
+                        "operations": ["count", "avg"],
+                        "windows": self.aggregate_windows,
+                        "period": self.aggregate_period,
                     }
                 ],
-                name=EventFieldType.PREDICTIONS,
+                name=EventFieldType.LATENCY,
                 after="MapFeatureNames",
                 step_name="Aggregates",
                 table=".",
+                key_field=EventFieldType.ENDPOINT_ID,
             )
-            # Step 5.2 - Calculate average latency time for each window (5 min and 1 hour by default)
+
+            # Step 5.2 - Rename the latency counter field to prediction counter
             graph.add_step(
-                class_name="storey.AggregateByKey",
-                aggregates=[
-                    {
-                        "name": EventFieldType.LATENCY,
-                        "column": EventFieldType.LATENCY,
-                        "operations": ["avg"],
-                        "windows": self.aggregate_avg_windows,
-                        "period": self.aggregate_avg_period,
-                    }
-                ],
-                name=EventFieldType.LATENCY,
-                after=EventFieldType.PREDICTIONS,
-                table=".",
+                class_name="storey.Rename",
+                mapping={
+                    "latency_count_5m": EventLiveStats.PREDICTIONS_COUNT_5M,
+                    "latency_count_1h": EventLiveStats.PREDICTIONS_COUNT_1H,
+                },
+                name="Rename",
+                after=EventFieldType.LATENCY,
             )
 
         apply_storey_aggregations()
 
         # Step 6 - Emits the event in window size of events based on sample_window size (10 by default)
         def apply_storey_sample_window():
             graph.add_step(
                 "storey.steps.SampleWindow",
                 name="sample",
-                after=EventFieldType.LATENCY,
+                after="Rename",
                 window_size=self.sample_window,
                 key=EventFieldType.ENDPOINT_ID,
             )
 
         apply_storey_sample_window()
 
         # Steps 7-9 - KV/SQL branch
@@ -321,14 +311,15 @@
                     container=self.tsdb_container,
                     access_key=self.v3io_access_key,
                     v3io_frames=self.v3io_framesd,
                     infer_columns_from_data=True,
                     index_cols=[
                         EventFieldType.ENDPOINT_ID,
                         EventFieldType.RECORD_TYPE,
+                        EventFieldType.ENDPOINT_TYPE,
                     ],
                     max_events=self.tsdb_batching_max_events,
                     flush_after_seconds=self.tsdb_batching_timeout_secs,
                     key=EventFieldType.ENDPOINT_ID,
                 )
 
             # Steps 12-13 - unpacked base_metrics dictionary
@@ -467,14 +458,15 @@
         # Compute prediction per second
         event[EventLiveStats.PREDICTIONS_PER_SECOND] = (
             float(event[EventLiveStats.PREDICTIONS_COUNT_5M]) / 300
         )
         base_fields = [
             EventFieldType.TIMESTAMP,
             EventFieldType.ENDPOINT_ID,
+            EventFieldType.ENDPOINT_TYPE,
         ]
 
         # Getting event timestamp and endpoint_id
         base_event = {k: event[k] for k in base_fields}
         base_event[EventFieldType.TIMESTAMP] = pd.to_datetime(
             base_event[EventFieldType.TIMESTAMP],
             format=EventFieldType.TIME_FORMAT,
@@ -869,14 +861,17 @@
         self.project = project
 
         # Dictionaries that will be used in case features names
         # and labels columns were not found in the current event
         self.feature_names = {}
         self.label_columns = {}
 
+        # Dictionary to manage the model endpoint types - important for the V3IO TSDB
+        self.endpoint_type = {}
+
     def _infer_feature_names_from_data(self, event):
         for endpoint_id in self.feature_names:
             if len(self.feature_names[endpoint_id]) >= len(
                 event[EventFieldType.FEATURES]
             ):
                 return self.feature_names[endpoint_id]
         return None
@@ -900,15 +895,15 @@
             )
             feature_names = endpoint_record.get(EventFieldType.FEATURE_NAMES)
             feature_names = json.loads(feature_names) if feature_names else None
 
             label_columns = endpoint_record.get(EventFieldType.LABEL_NAMES)
             label_columns = json.loads(label_columns) if label_columns else None
 
-            # Ff feature names were not found,
+            # If feature names were not found,
             # try to retrieve them from the previous events of the current process
             if not feature_names and self._infer_columns_from_data:
                 feature_names = self._infer_feature_names_from_data(event)
 
             if not feature_names:
                 logger.warn(
                     "Feature names are not initialized, they will be automatically generated",
@@ -952,14 +947,18 @@
             logger.info(
                 "Label columns", endpoint_id=endpoint_id, label_columns=label_columns
             )
             logger.info(
                 "Feature names", endpoint_id=endpoint_id, feature_names=feature_names
             )
 
+            # Update the endpoint type within the endpoint types dictionary
+            endpoint_type = int(endpoint_record.get(EventFieldType.ENDPOINT_TYPE))
+            self.endpoint_type[endpoint_id] = endpoint_type
+
         # Add feature_name:value pairs along with a mapping dictionary of all of these pairs
         feature_names = self.feature_names[endpoint_id]
         feature_values = event[EventFieldType.FEATURES]
         self._map_dictionary_values(
             event=event,
             named_iters=feature_names,
             values_iters=feature_values,
@@ -972,14 +971,17 @@
         self._map_dictionary_values(
             event=event,
             named_iters=label_names,
             values_iters=label_values,
             mapping_dictionary=EventFieldType.NAMED_PREDICTIONS,
         )
 
+        # Add endpoint type to the event
+        event[EventFieldType.ENDPOINT_TYPE] = self.endpoint_type[endpoint_id]
+
         logger.info("Mapped event", event=event)
         return event
 
     @staticmethod
     def _map_dictionary_values(
         event: typing.Dict,
         named_iters: typing.List,
@@ -1067,21 +1069,21 @@
 
 
 def update_endpoint_record(
     project: str,
     endpoint_id: str,
     attributes: dict,
 ):
-    model_endpoint_store = get_model_endpoint_store(
+    model_endpoint_store = mlrun.model_monitoring.get_model_endpoint_store(
         project=project,
     )
 
     model_endpoint_store.update_model_endpoint(
         endpoint_id=endpoint_id, attributes=attributes
     )
 
 
 def get_endpoint_record(project: str, endpoint_id: str):
-    model_endpoint_store = get_model_endpoint_store(
+    model_endpoint_store = mlrun.model_monitoring.get_model_endpoint_store(
         project=project,
     )
     return model_endpoint_store.get_model_endpoint(endpoint_id=endpoint_id)
```

## Comparing `mlrun/runtimes/package/__init__.py` & `mlrun/common/model_monitoring/__init__.py`

 * *Files 12% similar despite different names*

```diff
@@ -1,8 +1,8 @@
-# Copyright 2018 Iguazio
+# Copyright 2023 Iguazio
 #
 # Licensed under the Apache License, Version 2.0 (the "License");
 # you may not use this file except in compliance with the License.
 # You may obtain a copy of the License at
 #
 #   http://www.apache.org/licenses/LICENSE-2.0
 #
@@ -10,7 +10,9 @@
 # distributed under the License is distributed on an "AS IS" BASIS,
 # WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied.
 # See the License for the specific language governing permissions and
 # limitations under the License.
 #
 
 # flake8: noqa  - this is until we take care of the F401 violations with respect to __all__ & sphinx
+
+from .helpers import create_model_endpoint_uid
```

## Comparing `mlrun-1.4.0rc9.dist-info/LICENSE` & `mlrun-1.5.0rc1.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mlrun-1.4.0rc9.dist-info/METADATA` & `mlrun-1.5.0rc1.dist-info/METADATA`

 * *Files 0% similar despite different names*

```diff
@@ -1,68 +1,69 @@
 Metadata-Version: 2.1
 Name: mlrun
-Version: 1.4.0rc9
+Version: 1.5.0rc1
 Summary: Tracking and config of machine learning runs
 Home-page: https://github.com/mlrun/mlrun
 Author: Yaron Haviv
 Author-email: yaronh@iguazio.com
 License: MIT
 Platform: UNKNOWN
 Classifier: Development Status :: 4 - Beta
 Classifier: Intended Audience :: Developers
 Classifier: License :: OSI Approved :: Apache Software License
 Classifier: Operating System :: POSIX :: Linux
 Classifier: Operating System :: Microsoft :: Windows
 Classifier: Operating System :: MacOS
 Classifier: Programming Language :: Python :: 3
-Classifier: Programming Language :: Python :: 3.7
 Classifier: Programming Language :: Python :: 3.8
+Classifier: Programming Language :: Python :: 3.9
 Classifier: Programming Language :: Python
 Classifier: Topic :: Software Development :: Libraries :: Python Modules
 Classifier: Topic :: Software Development :: Libraries
 Description-Content-Type: text/markdown
 License-File: LICENSE
-Requires-Dist: urllib3 (<1.27,>=1.25.4)
+Requires-Dist: urllib3 (<1.27,>=1.26.9)
 Requires-Dist: chardet (<4.0,>=3.0.2)
 Requires-Dist: GitPython (>=3.1.30,~=3.1)
 Requires-Dist: aiohttp (~=3.8)
 Requires-Dist: aiohttp-retry (~=2.8)
 Requires-Dist: click (~=8.0.0)
 Requires-Dist: kfp (<1.8.14,~=1.8.0)
 Requires-Dist: nest-asyncio (~=1.0)
 Requires-Dist: ipython (<9.0,>=7.0)
-Requires-Dist: nuclio-jupyter (~=0.9.10)
+Requires-Dist: nuclio-jupyter (~=0.9.11)
 Requires-Dist: numpy (<1.23.0,>=1.16.5)
 Requires-Dist: pandas (<1.5.0,~=1.2)
 Requires-Dist: pyarrow (<12,>=10.0)
 Requires-Dist: pyyaml (~=5.1)
 Requires-Dist: requests (~=2.22)
 Requires-Dist: sqlalchemy (~=1.4)
 Requires-Dist: tabulate (~=0.8.6)
-Requires-Dist: v3io (~=0.5.20)
-Requires-Dist: pydantic (~=1.5)
+Requires-Dist: v3io (~=0.5.21)
+Requires-Dist: pydantic (>=1.10.8,~=1.10)
 Requires-Dist: orjson (<3.8.12,~=3.3)
 Requires-Dist: alembic (~=1.9)
 Requires-Dist: mergedeep (~=1.3)
 Requires-Dist: v3io-frames (~=0.10.4)
 Requires-Dist: semver (~=2.13)
 Requires-Dist: dask (~=2021.11.2)
 Requires-Dist: distributed (~=2021.11.2)
 Requires-Dist: kubernetes (~=12.0)
-Requires-Dist: humanfriendly (~=8.2)
-Requires-Dist: fastapi (~=0.92.0)
+Requires-Dist: humanfriendly (~=9.2)
+Requires-Dist: fastapi (~=0.95.2)
 Requires-Dist: fsspec (~=2023.1.0)
 Requires-Dist: v3iofs (~=0.1.15)
-Requires-Dist: storey (~=1.4.0)
+Requires-Dist: storey (~=1.5.0)
 Requires-Dist: deepdiff (~=5.0)
 Requires-Dist: pymysql (~=1.0)
 Requires-Dist: inflection (~=0.5.0)
 Requires-Dist: python-dotenv (~=0.17.0)
 Requires-Dist: setuptools (~=65.5)
 Requires-Dist: deprecated (~=1.2)
+Requires-Dist: jinja2 (~=3.1)
 Provides-Extra: all
 Requires-Dist: adlfs (~=2022.2.0) ; extra == 'all'
 Requires-Dist: aiobotocore (~=2.4.2) ; extra == 'all'
 Requires-Dist: avro (~=1.11) ; extra == 'all'
 Requires-Dist: azure-core (~=1.24) ; extra == 'all'
 Requires-Dist: azure-identity (~=1.5) ; extra == 'all'
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'all'
@@ -82,14 +83,15 @@
 Requires-Dist: s3fs (~=2023.1.0) ; extra == 'all'
 Provides-Extra: api
 Requires-Dist: uvicorn (~=0.20.0) ; extra == 'api'
 Requires-Dist: dask-kubernetes (~=0.11.0) ; extra == 'api'
 Requires-Dist: apscheduler (~=3.6) ; extra == 'api'
 Requires-Dist: sqlite3-to-mysql (~=1.4) ; extra == 'api'
 Requires-Dist: objgraph (~=3.5) ; extra == 'api'
+Requires-Dist: igz-mgmt (~=0.0.10) ; extra == 'api'
 Provides-Extra: azure-blob-storage
 Requires-Dist: msrest (~=0.6.21) ; extra == 'azure-blob-storage'
 Requires-Dist: azure-core (~=1.24) ; extra == 'azure-blob-storage'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'azure-blob-storage'
 Requires-Dist: adlfs (~=2022.2.0) ; extra == 'azure-blob-storage'
 Requires-Dist: pyopenssl (>=23) ; extra == 'azure-blob-storage'
 Provides-Extra: azure-key-vault
@@ -126,14 +128,15 @@
 Requires-Dist: azure-keyvault-secrets (~=4.2) ; extra == 'complete-api'
 Requires-Dist: azure-storage-blob (~=12.13) ; extra == 'complete-api'
 Requires-Dist: boto3 (~=1.24.59) ; extra == 'complete-api'
 Requires-Dist: dask-kubernetes (~=0.11.0) ; extra == 'complete-api'
 Requires-Dist: gcsfs (~=2023.1.0) ; extra == 'complete-api'
 Requires-Dist: google-cloud-bigquery[bqstorage,pandas] (~=3.2) ; extra == 'complete-api'
 Requires-Dist: graphviz (~=0.20.0) ; extra == 'complete-api'
+Requires-Dist: igz-mgmt (~=0.0.10) ; extra == 'complete-api'
 Requires-Dist: kafka-python (~=2.0) ; extra == 'complete-api'
 Requires-Dist: msrest (~=0.6.21) ; extra == 'complete-api'
 Requires-Dist: objgraph (~=3.5) ; extra == 'complete-api'
 Requires-Dist: plotly (<5.12.0,~=5.4) ; extra == 'complete-api'
 Requires-Dist: pyopenssl (>=23) ; extra == 'complete-api'
 Requires-Dist: redis (~=4.3) ; extra == 'complete-api'
 Requires-Dist: s3fs (~=2023.1.0) ; extra == 'complete-api'
@@ -165,15 +168,15 @@
 [![Build Status](https://github.com/mlrun/mlrun/workflows/CI/badge.svg)](https://github.com/mlrun/mlrun/actions)
 [![License](https://img.shields.io/badge/License-Apache%202.0-blue.svg)](https://opensource.org/licenses/Apache-2.0)
 [![PyPI version fury.io](https://badge.fury.io/py/mlrun.svg)](https://pypi.python.org/pypi/mlrun/)
 [![Documentation](https://readthedocs.org/projects/mlrun/badge/?version=latest)](https://mlrun.readthedocs.io/en/latest/?badge=latest)
 [![Code style: black](https://img.shields.io/badge/code%20style-black-000000.svg)](https://github.com/psf/black)
 ![GitHub commit activity](https://img.shields.io/github/commit-activity/w/mlrun/mlrun)
 ![GitHub release (latest SemVer)](https://img.shields.io/github/v/release/mlrun/mlrun?sort=semver)
-[![Join MLOps Live](https://img.shields.io/badge/slack-join_chat-white.svg?logo=slack&style=social)](mlopslive.slack.com)
+[![Join MLOps Live](https://img.shields.io/badge/slack-join_chat-white.svg?logo=slack&style=social)](https://mlopslive.slack.com)
 
 <p align="left"><img src="docs/_static/images/MLRun-logo.png" alt="MLRun logo" width="150"/></p>
 
 # Using MLRun 
 
 MLRun is an open MLOps platform for quickly building and managing continuous ML applications across their lifecycle. MLRun integrates into your development and CI/CD environment and automates the delivery of production data, ML pipelines, and online applications, significantly reducing engineering efforts, time to production, and computation resources.
 With MLRun, you can choose any IDE on your local machine or on the cloud. MLRun breaks the silos between data, ML, software, and DevOps/MLOps teams, enabling collaboration and fast continuous improvements.
```

## Comparing `mlrun-1.4.0rc9.dist-info/RECORD` & `mlrun-1.5.0rc1.dist-info/RECORD`

 * *Files 6% similar despite different names*

```diff
@@ -1,410 +1,447 @@
-mlrun/__init__.py,sha256=cCTbgyTFsXvEdaq1Cvwz8s8FE75YGIJKX58um-fnfFs,8727
-mlrun/__main__.py,sha256=seoOeUtUyks_qBRFOAnbt0Ze8DsrdRkJALQVBC3j9Hc,49342
-mlrun/config.py,sha256=5PPsvyOm_5wE16UXBUC9VoEBW0uRpp3Ybfey6MBqBUk,55437
-mlrun/errors.py,sha256=XEb1pxwy5Lzr9q0VT4z_SjP74jy37HFSmdd2hddWgvY,6780
-mlrun/execution.py,sha256=r8XzkmoOMs0UvuTZx4DDusGsLJlEakOvCrzsty19_UY,39296
-mlrun/features.py,sha256=pDUvV6HlkxZnUwW3lg7oq3vBwdcJQBprvdyGPNv57X8,15624
-mlrun/k8s_utils.py,sha256=bU5bIrk7YfrX0nEBTogpSZtTG7pVwD0X1rBZmcDlDX0,4876
-mlrun/kfpops.py,sha256=CGVXW22wmYJ_2Dl-eReFMw77mKVhtOgBnIiqRitX8WM,29646
-mlrun/lists.py,sha256=yOKwpS71Fua08sV825Anth8aaR9H5bHZyV544YbnXj4,8360
-mlrun/model.py,sha256=ddzP_ziCd_mSFEd-_9868Udg1fOaZPJLvc8b9dTm4F0,58708
-mlrun/render.py,sha256=983QAYawKTFlwXLpUwGC1gWEjUQUFxl1lo8bPQuXIA0,11828
-mlrun/run.py,sha256=CRAHgxViLV7fc7pYAG9CTlXu4gmr4j_lLkzW1G3kezo,64686
-mlrun/secrets.py,sha256=xr-Omz0j5qjLGPCG_Gn2vsCP0CbqJldAAKpy5N1KAiM,7783
-mlrun/api/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
+mlrun/__init__.py,sha256=2lyTZ4KP8Qo-7Vbyln6QAyN_4cZGxB0dTa0-Ih3GAPo,8770
+mlrun/__main__.py,sha256=BIVMSZwO-AGL6HRFML7XsROQgIRFqtbnIldN4QzTWu0,49544
+mlrun/config.py,sha256=xkoTxYY5UquOg8DnlWQ7IKrOPeEz4GGbef2DvyLPoHk,56719
+mlrun/errors.py,sha256=pYZZtJsMqkFktG6T8iTyfyESrrhOLfKvB3U_jUDHMo8,6780
+mlrun/execution.py,sha256=HC8VWHfzjekjFoIO7YrWqOKfNimAEkw-GRJWoKJrwWA,39600
+mlrun/features.py,sha256=UQQ2uh5Xh9XsMGiYBqh3bKgDhOHANjv1gQgWyId9qQE,15624
+mlrun/k8s_utils.py,sha256=DhaLjX9Y4n6MZ-Gie2puEQ7LNQ9N6yUmnu6W_Y5ifMU,4876
+mlrun/kfpops.py,sha256=4yCeLqqkO0-vXeFE2AVjnH8k-KRh-6ObQoo6f6cNfnQ,29701
+mlrun/lists.py,sha256=zgJR-dqK0Q2VzLsj9fR1NwQSelKlqbOoyV22g8F62iw,8779
+mlrun/model.py,sha256=6iOLabmsn9dZPdJVUBJcD-CPBL2DLVAPYW0S69kBjdY,60635
+mlrun/render.py,sha256=p-I_a1wYFtipZm6REQYEL2RsZv8DyX-ZC_uDRG9EH9k,13016
+mlrun/run.py,sha256=XKCL-MUme0z9OnurQ9o7vizslXiG80ncQVF-Vr1kdik,51474
+mlrun/secrets.py,sha256=hr2Ia9kLkoMM3KoxijXqO6AIJOUrrLxvz4Q7Xk39d4Y,7783
+mlrun/api/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
 mlrun/api/alembic.ini,sha256=oeSJRHwBbF3c3-N_RJilcZD-diq3F-oPv21gDIkrZGs,2105
-mlrun/api/constants.py,sha256=fyTQXJe4sx4GK8vZxklivgJgaSyOftk_NezGKA1J-mo,685
-mlrun/api/initial_data.py,sha256=cr9mBSuVSO3zv6RbGXKvtewzqDJQoV_zu572050qkJ4,25653
-mlrun/api/launcher.py,sha256=Gp75DnemithhYR1jwQelgMrzfFv0dBtLg24hleDcvjU,7573
-mlrun/api/main.py,sha256=r-Xpj96nzB43l164uRltqvDfwgPJ48o-sMlnPkExz4g,26457
-mlrun/api/middlewares.py,sha256=D9d-3XudnhyK_J1EGdWexCCswiS4QuSWvhDvCH1LEEU,5247
-mlrun/api/api/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/api/api.py,sha256=N5QgIWwnm-wgeW_8bUqVTtnRqgOUJGKDUGpScHHs78Y,4243
-mlrun/api/api/deps.py,sha256=OZt6UxT9Yg0O6egcB7a_YbZkKYkk5Vh9tTMKQKxW8nI,3197
-mlrun/api/api/utils.py,sha256=K2uQgCrXu8vaKklfNaFjKhsuoaP1Td7eARQhY9IwaMA,37347
-mlrun/api/api/endpoints/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/api/endpoints/artifacts.py,sha256=Dwz4G9FVRYZVf-q0XcPUgvLa6sxm_aMPCuVxzi9ymzA,10452
-mlrun/api/api/endpoints/auth.py,sha256=YmcYs5pl8Il4jKDVjUGH_S5VXzam06kweO_xXpdSyeg,1199
-mlrun/api/api/endpoints/background_tasks.py,sha256=EQ5zvps1mXaVoNeoyOwMmRTAp0_nwpXtFAItvTA6uo4,3618
-mlrun/api/api/endpoints/client_spec.py,sha256=2hzm_Sq9JyPTfWgaKIjN_vGQX3xLnCScUpuoQjm3NU4,1214
-mlrun/api/api/endpoints/clusterization_spec.py,sha256=eBQya6jeYYBEe7WoCMNmXbkDxgmeDP5DCISGCZ4eAio,1175
-mlrun/api/api/endpoints/feature_store.py,sha256=fK_e9Yl_22-tdIGIR0gi3v-24Wnqx01wKcgLuoTUWRg,29192
-mlrun/api/api/endpoints/files.py,sha256=v_FwFb-29mqDlx2tI8D9VUHthyjnmUpGsWTnfVZR7cE,6104
-mlrun/api/api/endpoints/frontend_spec.py,sha256=UadfOBPWnD0TM5nA6Su-TOP-ImsYP7z7M1hMq1pGGYE,5896
-mlrun/api/api/endpoints/functions.py,sha256=cpBUXY49OEPppl7EapeXwRlSeXa0LV_x3H9HUDsW_q4,36777
-mlrun/api/api/endpoints/grafana_proxy.py,sha256=CVh8dwHj0RtU4q_PeA-klfVUkCEP3MVgIDnPv4iLbWk,5935
-mlrun/api/api/endpoints/healthz.py,sha256=rp_esZLesf92tiaFM_E50LR0m_EbsdZxuudYNMG9VVU,1344
-mlrun/api/api/endpoints/hub.py,sha256=ozOtTM339AAVBZf1Q9pZ7-oESlWmsVR-uRyps92WmOo,10312
-mlrun/api/api/endpoints/logs.py,sha256=UvAUiycHZ7Mh7gczPd8QD2RipelAzCueiI_bFxNOkxM,2445
-mlrun/api/api/endpoints/model_endpoints.py,sha256=c5OqJaz2CZqy265BACaxLUWBYH2v2bJBXvvl0f8IFds,15651
-mlrun/api/api/endpoints/operations.py,sha256=lnfvQmZIcj1z6TgxCy5Tx5x7PiNls3DgE3Yzddvo-9Q,3756
-mlrun/api/api/endpoints/pipelines.py,sha256=9RVZR_7st3Om9IKNdo2tiqn_H87xZu69eQKdmqWQsWE,9165
-mlrun/api/api/endpoints/projects.py,sha256=sI1dYHBnBWjxqJqOVgRjs2bXML2SKfu8k6yE-2sHBPs,11494
-mlrun/api/api/endpoints/runs.py,sha256=S2kSYQnIliMMjDpo1-iyEGIZ46PWAwpzwUi7nY-IUTo,9078
-mlrun/api/api/endpoints/runtime_resources.py,sha256=1WHjBYuVEMSHtnKnj-W80-ZsIuApsaf8E8EiNlzDGak,9035
-mlrun/api/api/endpoints/schedules.py,sha256=ndEaQiwzGunHcEUTnbi5Yy81kzeWvsggKI5nhn-z2aE,10554
-mlrun/api/api/endpoints/secrets.py,sha256=GHxl-w4TUq28kHp8HR9jHbgjnp4LtDpiKwfQufTJ800,6061
-mlrun/api/api/endpoints/submit.py,sha256=loLzF5p5L7Wu5R2TnuPNNtwxTN1WIg_ei0ZdoCoMRDI,5298
-mlrun/api/api/endpoints/tags.py,sha256=xz4PW25Ymuk0RGNCJTLxtxDAIbNOawXeKiZVpX-jKEY,4849
-mlrun/api/api/endpoints/internal/__init__.py,sha256=Lq7QbwU5hFGCq6hzU28fA5t1soMesi7DVo99T21blU8,1203
-mlrun/api/api/endpoints/internal/config.py,sha256=kXnraXbXv029QZMMEjwvhsUWof69wTvFBLcRyB32JFc,1043
-mlrun/api/api/endpoints/internal/memory_reports.py,sha256=8Jg15M_X-SxDs2_ZB2rIKnTHUwjeageFMmynGrzZ9Eg,1718
-mlrun/api/crud/__init__.py,sha256=uIwvg_fG3qljOheF5QeY2yLt3601YWaabhb0-eb_hQw,1209
-mlrun/api/crud/artifacts.py,sha256=aoOmrXCGqNCA9b39cQbPojmRXK6qKAaX9WlZjdduaaA,5610
-mlrun/api/crud/client_spec.py,sha256=3Xif0Od3-zqb3Ptd3BInjg6rKhNLlJyIU38CF3efZ58,7331
-mlrun/api/crud/clusterization_spec.py,sha256=GBvK-rCVTJFBfstvFp2wJAOQWKc370ysuPFGm1rqwJg,1055
-mlrun/api/crud/feature_store.py,sha256=0XGBGuPiG8IStGmQroIOC18KtrpRXnnOyo3MqrHuLGY,18628
-mlrun/api/crud/functions.py,sha256=HHCpT9Rbn-kl5o2m12JOSEXovq23Vx_gBjjpbim7g8c,3556
-mlrun/api/crud/hub.py,sha256=rcTgrmV5-iqRLvBzjjNEolEiw7anoWizhx6neEL5eco,12025
-mlrun/api/crud/logs.py,sha256=zzDHSQ_VmG48JlpoCfznzMjjdmA5wdt7kTnyc-4ACCk,9409
-mlrun/api/crud/notifications.py,sha256=aEIx2ByVQzHxdmjePiYXxzUpZA1yZ8YXhR-nvIbet3o,2751
-mlrun/api/crud/pipelines.py,sha256=0JQWYvN9IevOyMuUi_BPZQGYthc1vTt7VS4a2kybGnA,14090
-mlrun/api/crud/projects.py,sha256=h9695fNAmZ9MnhDdbOhS0ljG1cgm8XiGMiq1K-Cl7tg,14269
-mlrun/api/crud/runs.py,sha256=xpsN6z_JhBZpptoGUvva173biMfDCsZaBmfaYNSofnM,5963
-mlrun/api/crud/runtime_resources.py,sha256=aJoWA1aInheitsLw02Fi7ohYPKTrk4pWXck7NwZF1yA,5575
-mlrun/api/crud/secrets.py,sha256=5eTyi3b8p398Y1yzX7NbbFJbXScEEDagA0tmbRGX9fY,20145
-mlrun/api/crud/tags.py,sha256=FEu6E0Srp7886ICAQfccf4h0ssHyvYP7-kSpB_oa9yE,3277
-mlrun/api/crud/model_monitoring/__init__.py,sha256=CAW_Xhm94IVid0yos0tLQUd_UdCRYz-_2s_rAloZEZw,722
-mlrun/api/crud/model_monitoring/grafana.py,sha256=peEPjIsu0xvGPEdRis4c16n5m3-jxa8lbqgwCiGNu2s,15692
-mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=8W77_N0h-Uq130W7tlLtTkh4fMH9-ofOBcQiZTFXTpM,43000
-mlrun/api/crud/runtimes/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/crud/runtimes/nuclio/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/crud/runtimes/nuclio/function.py,sha256=B-fZPc0AGyBseMs4qgVw3eU0c8fHBZ4oIID7CWTyObw,18551
-mlrun/api/crud/runtimes/nuclio/helpers.py,sha256=E3ThgKBZyPa-VVWv3rTRtQAdR9lIVLkYz8_hfyntocA,11398
-mlrun/api/db/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/db/base.py,sha256=ETSlJ24N0s63dLpDS5yVo7vFg3ap-ySwhaKyCOcqUZo,15056
-mlrun/api/db/init_db.py,sha256=bx7urn0e9VweQwtbsldK_mn63aTZhqHRHpyhwbM-W_4,816
-mlrun/api/db/session.py,sha256=_5DVL4YyGGFG9sbtHx_Bq2C1aHrZC5V8MS7TJfNeWIk,993
-mlrun/api/db/sqldb/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/db/sqldb/db.py,sha256=gvpd-mVLt1gZQLD7MRd5xNLc0uNcC1Vdsyzai0yDtLY,145804
-mlrun/api/db/sqldb/helpers.py,sha256=j8VK-l_qZ5vLUjGkFK3D3fBgDgPmi-U8hU1MkMIAhC0,2340
-mlrun/api/db/sqldb/session.py,sha256=97QcZc7EOhypk3ZMl0F5k1ogsgK834S3SxCj3UNry-s,2542
-mlrun/api/db/sqldb/models/__init__.py,sha256=o6TyijVXHxxiQ9i45Z4G6LYss5vFZyU_hHC89TRpUwc,1105
-mlrun/api/db/sqldb/models/models_mysql.py,sha256=jbWithtvR4Rief7J-g0LKU8ueY7A9A2Cz25BoeeH-I4,20909
-mlrun/api/db/sqldb/models/models_sqlite.py,sha256=J9MlwVdEhucy2NaSm1wcA7rOGxRxs-3JzocBGiQ98T8,18571
-mlrun/api/migrations_mysql/env.py,sha256=U5Fu1WLV5vggRYy4sa7d1ItJr1H3-T71BnkOw4ZjWIs,2906
-mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py,sha256=kcdNEMQHbTRGpzh4CfLlUJtClG_eHo-X0QNPOQEFBuI,1203
-mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py,sha256=MF0DwcRcbyRXdWNeWieEWIu5zMpxZ5IQPmF__werbkU,4614
-mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py,sha256=BthqApYJLuzuHZEJfrOaERD8M-2FRGsZ3e5tRFvMk78,1936
-mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py,sha256=AuFHglUWD_ibU301xio--zcodAJ9yeGqbc8XFQ3zGGw,1909
-mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py,sha256=jlQ40Yqcasyqu4qaetGxoY-DCn-GfWpU-K_Tb9zJVxo,1415
-mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py,sha256=1U5dpO6k_SLNZ0MAd5AukDddcxp8eCUTEx-2o3b_U9k,1504
-mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py,sha256=lppZKpOBbGoyzP855Q8Y5hWfcqCzCjOlz-FefAqenUQ,1649
-mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py,sha256=CGh1ihmMJ4GNpDXNoiB9ksSe1P7PyrV3NqWTiq6GTIg,24057
-mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py,sha256=LulYIM8xAubhMT4CAZ60Jv984rFl-vfV9m40lQ2xaUg,2662
-mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py,sha256=18_SGHfgvNE6TcjsP2_bmqAjL3YI70B0J5-NojmxRr4,1351
-mlrun/api/migrations_sqlite/env.py,sha256=U5Fu1WLV5vggRYy4sa7d1ItJr1H3-T71BnkOw4ZjWIs,2906
-mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py,sha256=Kp1VTDMqS72UMODn1GboBo-IwUEZ8IWuflxrBTbATj0,11473
-mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py,sha256=w_l46X5Sl53fkku0t4lqmHtEkU_t9A8-lniMM9USknI,1348
-mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py,sha256=7PxARbyyFR1SlNHwTT5D41GpDGjd8b0zSSkYI4TtYmg,5180
-mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py,sha256=Qrbj5JA3pTfEDHgIoyCjMX5yMlXVkuWUcvQ9FIMrc8U,2595
-mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py,sha256=r0svJ5DsE633B2ss1yWwv50lPMjtSIMsKYOPvfCPBfo,1388
-mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py,sha256=pJqfbcEjG7I8yacspyFnbBZvVVpJ4mPLXc4VcJ8X1oQ,1767
-mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py,sha256=3Q_PnbBjaD-04YfjH2MW4IUocOWVUfa-a1_Y-snzBHA,1360
-mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py,sha256=cNFtnxsL4tTnfZiEo3uhATcqmgU6aqh2jEf521G0jH8,1259
-mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py,sha256=9spYXylp8u2TIuWajWrRmvZWrD7SyiikVMYIJ3uuBBU,2352
-mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py,sha256=Q7KfNsbnnPWhXUnLMmbGFZIaItOS_Hvr2bY_td-K3vw,1482
-mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py,sha256=1indyv5TlsDK4haAC9xxNznRjXgqjNIjgfFOakgBpNo,1892
-mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py,sha256=JyUhI_H02D0fkBDZr3Hv4-KAiHEOL62z4-YE25ik5Rs,1882
-mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py,sha256=A5aBWsOuCzs5cZrPiWO9ha26-N3JvzwsaI6wgOarHjY,1420
-mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py,sha256=icsKlQUC9lJkpdu0RbDpl3L1MMk3Bwb8pzCXZKO9xcw,2034
-mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py,sha256=po2-IqIvS4pSY8Bw02q6ZEucjEnkXdH5UDudGVC-5S8,1828
-mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py,sha256=9oGlxz4o7BlZbykO3zzedHqzOEoPnvPPeWMLxyRCBnY,1380
-mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py,sha256=lQ0lPq6xZD59iupkbAo0wCV-otE0G9lmjEpqIBZEguA,1831
-mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py,sha256=AWkrtG6jWOMJHyLqR8jrmbp95Fk9qB6qhjjYLb1mezo,3936
-mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py,sha256=KrIm5pHwHlJr5e3DdtMcBiEjgbopOniWzDi9T1XTSHQ,2588
-mlrun/api/schemas/__init__.py,sha256=JEimO9A93JbrxJQkJRDUNw4kAKyShmaD5McKulw3ykY,13338
-mlrun/api/utils/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/asyncio.py,sha256=E80efqnDt-rRLVqbdjlzHjfe5SNwB4Krn1Y9D0C0JMg,1092
-mlrun/api/utils/background_tasks.py,sha256=4FIdUB2rDJDb7bndMZIr1kQeWPDi9_loHHsjaVMq5Ys,7371
-mlrun/api/utils/builder.py,sha256=8MDNff3vJFbmVQaPROMcc93f_bXRz_GRgG6srwg5RQU,25911
-mlrun/api/utils/helpers.py,sha256=kQglUe_oaTFll4LhHNg1pwkAkiynzFWowiQlWXc4_7U,2431
-mlrun/api/utils/memory_reports.py,sha256=Diraa4EbJJ28NGrfSuOuGroVsE2sNeRkjUp7Dl4qDlI,3728
-mlrun/api/utils/periodic.py,sha256=Vc8jz2WIsItkb7rcmdtxUfD4-Pohlg_XVbLEUw0S394,2599
-mlrun/api/utils/scheduler.py,sha256=5reTxTtKdQE4wJymnTemQmM8AJ3lvL8fEMeVWtcg0FY,39305
-mlrun/api/utils/auth/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/auth/verifier.py,sha256=-JjXEX0tqqBymuR7P-f5mgsJF9FvwZGmb5k2SnTiekE,12383
-mlrun/api/utils/auth/providers/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/auth/providers/base.py,sha256=VUvHxeh7HvyJRzo-xRj7ESjlwJ10ilt_-e9U53rui44,1381
-mlrun/api/utils/auth/providers/nop.py,sha256=Y1vv1aH7NDCXY3vnt3HHzZeDappHZx79Jp-C9or8t94,1460
-mlrun/api/utils/auth/providers/opa.py,sha256=xPjubPC29yIglhgBhKB5zVp7JqJC-x71xKwo2YKv9Jo,10883
-mlrun/api/utils/clients/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/clients/chief.py,sha256=gI6-LgsZyPVIi8VnjmX1ILgGG-jLYvtYSZVC1QLP3Bg,13271
-mlrun/api/utils/clients/iguazio.py,sha256=VZun1-HGB1NBVGxMweVp8SzEa0lA38Oj00DcuM9ziHI,31249
-mlrun/api/utils/clients/log_collector.py,sha256=5jgixIbzX4GFkOGUrIaTBHDyzlzT_DfHjnAbx6qp82A,12281
-mlrun/api/utils/clients/nuclio.py,sha256=yT8atthDWpvlDU4rQiyHXo1tCFDrx3-s1iLJadhJ3nk,9916
+mlrun/api/constants.py,sha256=8xjdBYxt3-5_osRk_rII1nabyL3zMVOxnCJ6YrEhdFQ,685
+mlrun/api/initial_data.py,sha256=Ow2nWkgGc3AoJqZMaVnMpgLspJlREpBYfOquW9aV4eA,25653
+mlrun/api/launcher.py,sha256=mEzliYHvDO7X6hF5l5CV6n47DSznX7PItoOlFb_Xm4Y,8068
+mlrun/api/main.py,sha256=VXcEhpcXJusdYOieEDDQq-ejuzK6oFolrbeiOD31wzY,27304
+mlrun/api/middlewares.py,sha256=JXI4HOR-2w9Cf30my4vMK-pC1zgAFHK65NzFYgRcOuI,5289
+mlrun/api/api/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/api/api.py,sha256=xlWyl79-XpiLp1fAIeFJ5jYvMmHYUm661Zi3rLq2e8U,4243
+mlrun/api/api/deps.py,sha256=4jSegE1XNWvy93LKnI-NGvR-yhJdNqueVGHFJLKldpg,3197
+mlrun/api/api/utils.py,sha256=8DW0zJ--IhqSUVFRFsevXZsAxmHdbTFfOjGslCcUnms,40172
+mlrun/api/api/endpoints/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/api/endpoints/artifacts.py,sha256=-MPAuhzyepyd6Fxa5ZFidcDksNGP_Vmd2DRnFND7ug0,10452
+mlrun/api/api/endpoints/auth.py,sha256=hoqYSELX_6Zi3Cvep2nGLJgBo4YbMJoCt3WwbEZrnDU,1199
+mlrun/api/api/endpoints/background_tasks.py,sha256=5SV4iDF-dZR878kp77VpANRb86BJYgffrHnGsM4gQ3o,3618
+mlrun/api/api/endpoints/client_spec.py,sha256=lN2By-KGzHuzNTGiJk0RK3SM6ZUr3VLgsudsymrtZE8,1214
+mlrun/api/api/endpoints/clusterization_spec.py,sha256=0eSG7TSt647V7-A-uI5CLRItkVOBqIBM9ep_fiMFqPI,1175
+mlrun/api/api/endpoints/feature_store.py,sha256=pFvKtnFcv3pw9hHxMBfdqZ-txl9tXKKpd6Ds9EMsQs4,29192
+mlrun/api/api/endpoints/files.py,sha256=Ivq6UO0GrVjXD_QhUEKCILH9qHXMJkQfml7WHlWNPXI,6370
+mlrun/api/api/endpoints/frontend_spec.py,sha256=ppmYdRS6_JqEDBcArTnT0EOXidVtiDoA1zYJwa_4A70,5946
+mlrun/api/api/endpoints/functions.py,sha256=_uVKRfs9TmqBpV2KlzPnryEPo0nIbMvtBdHKkfggavY,38107
+mlrun/api/api/endpoints/grafana_proxy.py,sha256=5PvWjqTeb88kNtuTtZub9eFgr6I0ORlmPXGHk6G1QfM,6086
+mlrun/api/api/endpoints/healthz.py,sha256=DVNb94DLQhmQWxxo5d3AZbd82AL_PGuzU6NJ3IT5pkA,1344
+mlrun/api/api/endpoints/hub.py,sha256=3v9SQKUdZt2LNpGpegbQXaRsjGty4fujA9DBCVwGKUk,10312
+mlrun/api/api/endpoints/logs.py,sha256=SBhmnDybiA9GWp-93Ct_e57AtpeGvIG4s2k9NwXTeL0,2445
+mlrun/api/api/endpoints/model_endpoints.py,sha256=nSqZZcSKl_mGb13Sa-CXCfIBBZwZvxkvFoGnb3VdX0M,15734
+mlrun/api/api/endpoints/operations.py,sha256=tLqaRsyVP8CxCv8H_IDg3GtJW040xY5F_D5exLF7bGg,3756
+mlrun/api/api/endpoints/pipelines.py,sha256=hKPzWOQXdhOdwZUt4Ik0jCFc_TbB6bTeGOhWuJhiegM,9231
+mlrun/api/api/endpoints/projects.py,sha256=NGpJzBRFDUTuNDz6PYtyJP72wV07_ZfFA5BPTQYPK7k,11494
+mlrun/api/api/endpoints/runs.py,sha256=ft4Gkup7L-nug_LY8q8NXX0hr7L-8q7RvOVpiqxa6TA,10372
+mlrun/api/api/endpoints/runtime_resources.py,sha256=_Nv7CJTRI4gimlDbwufEWRJQhZFK9UNqIcJjDYwOkg0,9035
+mlrun/api/api/endpoints/schedules.py,sha256=Ko2dtaNKb3dHzjWR_LeoVFbhxCxkDDhaQ-ERRKmBC38,12544
+mlrun/api/api/endpoints/secrets.py,sha256=jPOQiTXMRUYcR9K0NT74ScNQaZpI1o-DMUnjtt6RsvE,6061
+mlrun/api/api/endpoints/submit.py,sha256=xKUX-9q6Zh0s9XOZueorn-Dc6knK4eSz3SS73Q0fXKc,5327
+mlrun/api/api/endpoints/tags.py,sha256=KIZziSd6XF2TR94b_4_UDsptXHecDXgOIwQYFRApGmA,4849
+mlrun/api/api/endpoints/internal/__init__.py,sha256=IVXgIyUv8lVStgCjFm3fZDDMIqEzmMAvkbbbOKwNJgo,1203
+mlrun/api/api/endpoints/internal/config.py,sha256=IVqf6YWokNXY3LC5o1BWqlEDVQ-AJdRrbWRwTFFAwfY,1043
+mlrun/api/api/endpoints/internal/memory_reports.py,sha256=PRVaj8i_WAbIqjP37xBlYfPunkZHTCXMprka0Qoxhxw,1718
+mlrun/api/crud/__init__.py,sha256=db07-1MAR-TrUI3NUUqvHV4ApGm0sYu1sCeDoxuJ5Mo,1209
+mlrun/api/crud/artifacts.py,sha256=Z0CzdgywxS352DD0MumACDfGg92VqZlOcBSw8FCRao8,5610
+mlrun/api/crud/client_spec.py,sha256=EUXRRpsonRjcFjYeCZrzOHcgcShrGperEAnq56Ly_2E,7378
+mlrun/api/crud/clusterization_spec.py,sha256=6riIRpWf1dGTRUSi1lLeydO-3KCcnpQ-Y_AuUCm5i7k,1055
+mlrun/api/crud/feature_store.py,sha256=Wizxaq6MXmj77Q4lR0-VawoSR3lmEDFQuaylmLtUTBM,18971
+mlrun/api/crud/functions.py,sha256=zub_q2QJ617kmokLMwdIHF5Mf7-o15amNXfFgOhg7n4,3556
+mlrun/api/crud/hub.py,sha256=qg1rkRPdLF5qDpaUKNSACmaEEHGhY1vThfOoiPiAfXw,12025
+mlrun/api/crud/logs.py,sha256=vFi9hynLqRT81erkGU2lhGmo394huYV3hoIkiInhspQ,9409
+mlrun/api/crud/notifications.py,sha256=8rMI5jLs4uI5v-kmIHUMLjps0QcUHOAZtcPWtaQpOck,5498
+mlrun/api/crud/pipelines.py,sha256=N_JIDhVnuIWnzOKEa_Or8eUcF-dl_HRjT-_R5CRmiQk,14999
+mlrun/api/crud/projects.py,sha256=yUeQDqNYeVJLoPKZNRNMBMwBaYU_g9dBpkUHy4ow-tA,15240
+mlrun/api/crud/runs.py,sha256=W_ahD8aFZCqJBfiLmxVkcjvLpJYaeHHF729vmEHLH4o,5963
+mlrun/api/crud/runtime_resources.py,sha256=trqxzAXPBZ6T27wJ1MQjH8lmYf32BRSMqpwQmVP9pWQ,5575
+mlrun/api/crud/secrets.py,sha256=EAgteRRYXCLzO5Rq7e-CfoQ_j-I4tZo65H-FOSmJAio,21560
+mlrun/api/crud/tags.py,sha256=pcXXrmlfgCBCtw5uBX6hAHdqO96XIg0ov5vn-u6r5Q4,3277
+mlrun/api/crud/model_monitoring/__init__.py,sha256=_rZmfvis_Qkhephv_SEgzqUVuC4bY-D84mCyyztWRs0,759
+mlrun/api/crud/model_monitoring/deployment.py,sha256=XD3tBT6ECHhNt1l970xFRwoMlykHEOqJ7Q8SO7kW1Qs,19956
+mlrun/api/crud/model_monitoring/grafana.py,sha256=WUn6Gk_W3vl6On4NuRT0E9ht-Nkz3CoqBkzxocDahV4,17486
+mlrun/api/crud/model_monitoring/helpers.py,sha256=0TR8u7TjHMR5n5ZA6uDr55Frm_Jmj04HKT-HqdvcwVc,4613
+mlrun/api/crud/model_monitoring/model_endpoints.py,sha256=loxq2ZFuoYU-ffa5duHDTUXqQqCZhiL2qaE1SxOyB4E,30723
+mlrun/api/crud/runtimes/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/crud/runtimes/nuclio/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/crud/runtimes/nuclio/function.py,sha256=Tgca7uACPlyeoGiLkIHsX0d9SePy_a6pEW03ryGMdPc,18762
+mlrun/api/crud/runtimes/nuclio/helpers.py,sha256=lx1apUFTUvKC9Itq1jEF0xPL4IhcaKf0G_qTNyOO6jM,11510
+mlrun/api/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/db/base.py,sha256=2fLNvPoswwWorbq85OgTHxX6hqu584JPZdq-J6QJUiU,15311
+mlrun/api/db/init_db.py,sha256=WTHphTsHl-ZKszZsQk3V-lFTzIEbWYJADolleugQ8eg,739
+mlrun/api/db/session.py,sha256=VXNLPqYpLOVUqaWdkzgve2nzYxVCF991Wv98GALJGas,994
+mlrun/api/db/sqldb/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/db/sqldb/db.py,sha256=uX986AXcpitUtx61__1cjSgFuYctLvLG4rXmKd4FhP4,148913
+mlrun/api/db/sqldb/helpers.py,sha256=Asc_cDFE2e7gbQ3SVriYyyK4yu94wfOemYPYCMpNLws,2340
+mlrun/api/db/sqldb/models/__init__.py,sha256=oD0qix1voOtUiP-fG04QK5VHOPageoclcSjw0PIoBQY,1105
+mlrun/api/db/sqldb/models/models_mysql.py,sha256=uMqx79fm5msRVJVfa1qvhWKW3tJAvziaHWptkmQi_XY,21345
+mlrun/api/db/sqldb/models/models_sqlite.py,sha256=y73PcQQgN8WtLAHYHGrquBE-5cho4ANiIYlnXV65zxY,19014
+mlrun/api/migrations_mysql/env.py,sha256=DYsmYYPMvbXxrkuEPzWUJcq9tzJrHIZkpJ0rrKdjmdw,2906
+mlrun/api/migrations_mysql/versions/28383af526f3_market_place_to_hub.py,sha256=JhNw92kyWYT80zhvUN4x2zyvme_O1-i-vRFuYH3DM18,1203
+mlrun/api/migrations_mysql/versions/32bae1b0e29c_increase_timestamp_fields_precision.py,sha256=mFG4HN_xHf13bf_Ow6L0AHwyl3lQK0wIvEYuwQgKBoY,4614
+mlrun/api/migrations_mysql/versions/4903aef6a91d_tag_foreign_key_and_cascades.py,sha256=lbeGcZOH_9tMl343Ztlfg5PvnoHUK0PlagBSzgYvOn8,1936
+mlrun/api/migrations_mysql/versions/5f1351c88a19_adding_background_tasks_table.py,sha256=7iB4cZkt3zCN8yiY0MW__T0JGKFitNlUizDAE1L3TB8,1909
+mlrun/api/migrations_mysql/versions/88e656800d6a_add_requested_logs_column_and_index_to_.py,sha256=aw8c4NCzrtqCjYq-orRnG0Ho9KNJzOsiFDLz-Ge21oY,1415
+mlrun/api/migrations_mysql/versions/9d16de5f03a7_adding_data_versions_table.py,sha256=--o7J4b5fdmTDjNy-pGof5tpwOmxah8ChCljOjclpd0,1504
+mlrun/api/migrations_mysql/versions/b86f5b53f3d7_adding_name_and_updated_to_runs_table.py,sha256=TWVhHM-8OjnZBJjYhMHW4OBDnERezAggaWNjt2X-6iU,1649
+mlrun/api/migrations_mysql/versions/c4af40b0bf61_init.py,sha256=3Tl8QNQfcsAbbNmELAvtmgwxO8GSk_3HFgHCQ-xaJHs,24057
+mlrun/api/migrations_mysql/versions/c905d15bd91d_notifications.py,sha256=-h1VQRi3oVF0kBScmrBRyW2hOP4HxCh-IkgEHl82Pew,2662
+mlrun/api/migrations_mysql/versions/ee041e8fdaa0_adding_next_run_time_column_to_schedule_.py,sha256=mEf-7xV0rRXuodYiZWJ6Bum9X9QvVX2wLx24J71sAes,1351
+mlrun/api/migrations_sqlite/env.py,sha256=DYsmYYPMvbXxrkuEPzWUJcq9tzJrHIZkpJ0rrKdjmdw,2906
+mlrun/api/migrations_sqlite/versions/11f8dd2dc9fe_init.py,sha256=o92us6ZftBrNIriEOcz8G4JpdvjyAglyF4L2-MhJxFs,11473
+mlrun/api/migrations_sqlite/versions/1c954f8cb32d_schedule_last_run_uri.py,sha256=Js8qSLlrviH6UlFxSjr_KprR2Nc6pAeSQod01bchNbo,1348
+mlrun/api/migrations_sqlite/versions/2b6d23c715aa_adding_feature_sets.py,sha256=pj0yGhP4amDK5WOHvkzMMSqAIehkaHIcawNtbzSpHOQ,5180
+mlrun/api/migrations_sqlite/versions/4acd9430b093_market_place_to_hub.py,sha256=ZTV_X1IiOYmBSeOmTCWOvx8yIg0wbQ-Fmf1If4UNOAU,2595
+mlrun/api/migrations_sqlite/versions/6401142f2d7c_adding_next_run_time_column_to_schedule_.py,sha256=YEj9tENBqWVbvKaVKSrTKxXrjACtwFKeVUm7qi_ripI,1388
+mlrun/api/migrations_sqlite/versions/64d90a1a69bc_adding_background_tasks_table.py,sha256=CSAzzTotUp8v7ShI0w0pyMGEX-pSmd6LJ10F7Wclup8,1767
+mlrun/api/migrations_sqlite/versions/803438ecd005_add_requested_logs_column_to_runs.py,sha256=05ENsKt4ofb4xrdBiEweiArHo_XnTHbKkMLIqL0CzsM,1360
+mlrun/api/migrations_sqlite/versions/863114f0c659_refactoring_feature_set.py,sha256=sU1qwPgqWnv50mGtpTlucQdEGq46HrUQGXIG1XO60B4,1259
+mlrun/api/migrations_sqlite/versions/959ae00528ad_notifications.py,sha256=vznKCMmNSggrBVoE6vf7hiuWBU1Xk9T-N82lUCBvzlc,2352
+mlrun/api/migrations_sqlite/versions/accf9fc83d38_adding_data_versions_table.py,sha256=Tsq7qinfLaO80o-9Vi3CvcTbpHeogiHgpnFv5aVZgH8,1482
+mlrun/api/migrations_sqlite/versions/b68e8e897a28_schedule_labels.py,sha256=NcOjSnpsJf5ybTB8bo41ZoatM-hbT-P6OLy-ItEdUs4,1892
+mlrun/api/migrations_sqlite/versions/bcd0c1f9720c_adding_project_labels.py,sha256=orr_27CXy7Nwkxhy2wXkEu-_YeZu232YNyuJzbux3FI,1882
+mlrun/api/migrations_sqlite/versions/cf21882f938e_schedule_id.py,sha256=6uIiHz_MlT1hs8JjxiKRA_JEizH1wzU7VprO-vzEJIY,1420
+mlrun/api/migrations_sqlite/versions/d781f58f607f_tag_object_name_string.py,sha256=0s4JdFH6fICbdJDJMTgjWjtqX0gjbHf-3IMVtogxabU,2034
+mlrun/api/migrations_sqlite/versions/deac06871ace_adding_marketplace_sources_table.py,sha256=HfjkoI0J8cFOuzHYlVhtjT49K7KCjrkYOdu7pNLXj5Y,1828
+mlrun/api/migrations_sqlite/versions/e1dd5983c06b_schedule_concurrency_limit.py,sha256=XxndhUXxVFypeFdOrudpWpV2kFcjEXb4ESoe95PLHb4,1380
+mlrun/api/migrations_sqlite/versions/e5594ed3ab53_adding_name_and_updated_to_runs_table.py,sha256=tIMEPe8YONGqDerbhjTyBk71krmqEKXAqaTNcK_OuBM,1831
+mlrun/api/migrations_sqlite/versions/f4249b4ba6fa_adding_feature_vectors.py,sha256=bjjjtMy5IgM-kWefKmql4B-xiS49bvSF5aYSR8mXzUE,3936
+mlrun/api/migrations_sqlite/versions/f7b5a1a03629_adding_feature_labels.py,sha256=9YQL4ikdN4URenEiAGWNdFwNkTpuF-Uccr5Eo8RENrk,2588
+mlrun/api/schemas/__init__.py,sha256=ckAFziB1YgJTsIoY-Dd1iUh8nZMKLsLT_W40dCAixg8,13571
+mlrun/api/utils/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/asyncio.py,sha256=Uaekrr2Gw55ivhqmxdXIDBgFmcH48p94XfEdhqq7ot8,1092
+mlrun/api/utils/background_tasks.py,sha256=ZlNkk-4I37s_efqg521AudbN52NRIOdbvbRpoWL_S54,7371
+mlrun/api/utils/builder.py,sha256=NHxboNTKnVUImlDtX3HylAGlNpf3ebGX_qTruNeFkhg,26977
+mlrun/api/utils/helpers.py,sha256=WltrGj7UOURvHzdz99wo-Aixqh06Lqyrt31c1EQw7AE,2512
+mlrun/api/utils/memory_reports.py,sha256=l-texuripca1J5tfBmwzSc3l0t6dAMNO8JFjt9kptd8,3728
+mlrun/api/utils/periodic.py,sha256=0dyKI1bEYRJGwH1Ciqt52Brqys8MAesq84hli6ENZbg,2760
+mlrun/api/utils/scheduler.py,sha256=umhbdhl4OoKiWZ1lxHDLYl6hH1j5IZY_x05irDS0aJo,42624
+mlrun/api/utils/auth/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/auth/verifier.py,sha256=21iHy2O77H_CNVSXdXr6O6uG6prJ3C9hvXQ1U9wXB4s,12383
+mlrun/api/utils/auth/providers/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/auth/providers/base.py,sha256=WMVk7tgT_bZoQhyFcMt_FMQRr7NRrk4NnqDXerKgeH8,1381
+mlrun/api/utils/auth/providers/nop.py,sha256=FdThFkA2_Bgyg36bpPFcNOdRjdtO2WV3ZJjDUDad8PY,1460
+mlrun/api/utils/auth/providers/opa.py,sha256=JJXqh0nSlp7jCfpDvGCemyy893cUO9gZH6_myYN-oo8,10883
+mlrun/api/utils/clients/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/clients/chief.py,sha256=6UrqH1tEug5HN3Y-QDEXlPzdv-CKqK1HUBKBmi2vbQE,13688
+mlrun/api/utils/clients/iguazio.py,sha256=cVawmI28pSTathUktAJ5XHNF8oDZr2EWCfRN0fSeu0o,32674
+mlrun/api/utils/clients/log_collector.py,sha256=pkCJ6_5rYYfdKn4Oz5uNk7c2UyIaPTgdl_axG-cwfQI,12281
+mlrun/api/utils/clients/nuclio.py,sha256=rZOu_wbA1LHdqk_ZHMevmEG0WoO2QfXqpkaIwwx4TPc,9911
 mlrun/api/utils/clients/protocols/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
-mlrun/api/utils/clients/protocols/grpc.py,sha256=P_He0oRyRvsCpTz7Pl2bZkqwA1W04Wl3BJMusM30pkY,2567
-mlrun/api/utils/db/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/db/alembic.py,sha256=sUVnWHXRzA_Yhn2GWiSqeQ8dcfpC4IPQpTFBjTta_iU,3305
-mlrun/api/utils/db/backup.py,sha256=LL4qL3YaLAbehS-KHn-Ieys333ZReEnmFIOoYV7BKzc,8214
-mlrun/api/utils/db/mysql.py,sha256=9FeqQpvOQjyuoxsRp8W1sv9mxUD43vJ4KAUitSX8gwk,3787
-mlrun/api/utils/db/sql_collation.py,sha256=t1pYJNPDwSP0PZwtlTqMAUgYhGZLRv0awbnEYy3Geis,992
-mlrun/api/utils/db/sqlite_migration.py,sha256=Vg39fAox122MDEKCVAE7d87iW70_Y8g3bc08iUxYEDA,3861
-mlrun/api/utils/projects/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/projects/follower.py,sha256=htcIXP2BRtm3MUEfw5IFC-WHUwidCfHZArS-pfSfFyM,17423
-mlrun/api/utils/projects/leader.py,sha256=V636xbrvoTs5Bg-wtsNTWCAeB4I6hqMc5i43Hlgiizc,19372
-mlrun/api/utils/projects/member.py,sha256=hokfxVFnvWtQHeVQYSZTlv1GyOoRHUUoVRVG4MFxfhE,7133
-mlrun/api/utils/projects/remotes/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/projects/remotes/follower.py,sha256=4bjZRHWrY8CKB_y7Juj-aQZn0YnbLCqVsJ93Aj_MniQ,2659
-mlrun/api/utils/projects/remotes/leader.py,sha256=uRC_WbKe1UfghVfCXD0ZomsJztk2HydBdz9Y_XjTfkY,2094
-mlrun/api/utils/projects/remotes/nop_follower.py,sha256=sP8BDve6471PEHomEJYAYEUsAlHwpy1frEfKbU9nAlc,5000
-mlrun/api/utils/projects/remotes/nop_leader.py,sha256=hslYEvKbQ4TdMzYnvqvU_oGfCvfQ2lxAglQqEn12AQ0,3861
-mlrun/api/utils/singletons/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/api/utils/singletons/db.py,sha256=y-v3JdLIHb_GtPvdzKH137jsflTav5TY9CafsSXfkN8,1202
-mlrun/api/utils/singletons/k8s.py,sha256=XmUXwaSHzed8AmDf25d0rKJ4XVcs9NN4k5efgzPxBhU,22651
-mlrun/api/utils/singletons/logs_dir.py,sha256=zCALZ1N8IylkfvATfsbWfBtEPvWKl2AEQ2-QF-J0VWs,840
-mlrun/api/utils/singletons/project_member.py,sha256=1xlvJjbY-HvQuUV5rsQg9rMt-Y9MKU77Az5f98v-D28,1279
-mlrun/api/utils/singletons/scheduler.py,sha256=LmauJTsB69P_gkx4xTMzQrW1kaaN050txZzrrl08i_k,1063
-mlrun/artifacts/__init__.py,sha256=b86JkwaOMjN9gPzeL-RlkAtiITaVmGS9viNlvGG1lrs,1091
-mlrun/artifacts/base.py,sha256=l-dRIaK89NOIiBqiSbo1vbPks8CeRv83wSKndybJt0U,30849
-mlrun/artifacts/dataset.py,sha256=d4ZrxECaJ-CJSbFvcWYrAK34IAOD0UPxLY0xrPc-04w,20432
-mlrun/artifacts/manager.py,sha256=P5y92csdyr9VgXlqitaKWWldg93KaCjGRAWLeZHIYHI,12594
-mlrun/artifacts/model.py,sha256=SmzieOo7d78CPhVyyHMmI6WltkCSVn-d72jAxhHKd7E,23673
-mlrun/artifacts/plots.py,sha256=0Jq5OgDB1srtUlcISF696E_q3S_D-mqeMe6Wyn1S6ZQ,15383
-mlrun/common/__init__.py,sha256=B-yvMk7vTs3QqtlPkM4pnZk_B4QKTGnfNhYr2n4Z30M,571
-mlrun/common/constants.py,sha256=aAMfWLUO_W49XVi2Aj_seNuKJZ0uPyCwu5nX3Iy5xB8,660
-mlrun/common/model_monitoring.py,sha256=6woOZSKb308qfBc5Io4z8coOBwqMB0H6vRUxhkUHeCc,5670
-mlrun/common/types.py,sha256=pUKq8f0L4sjKoik5bCAl2ir3_dmmCZ6eKyurSV10u6I,790
-mlrun/common/schemas/__init__.py,sha256=sxDYvhoYVmLuc4sB1rDf7x_8T0sErGkZV2h4i-hohak,3973
-mlrun/common/schemas/artifact.py,sha256=5ZiL-PSjkjkYrcD6uDrvS-Tjrguyqh-XQ55GBcWm4Ho,1923
-mlrun/common/schemas/auth.py,sha256=s5YeIELOxITr25_hhUfyMRpoRv6aURk4kDJBtw4L180,5251
-mlrun/common/schemas/background_task.py,sha256=tQNOhYXfCr72iCwOjuWulIPy0NcZFQ6x-vI59FVmffM,1553
-mlrun/common/schemas/client_spec.py,sha256=bQhGYtkcJg27yo82y3FNiiNZbYuwWce8SQxcXtVKJpg,2751
-mlrun/common/schemas/clusterization_spec.py,sha256=apyd1SinU_uwmuQlRiM9qD6SEgiy8WN_br3vqEekdKo,888
-mlrun/common/schemas/constants.py,sha256=z1_XckQGLfEH-WIKTcWixvRk76iBJbf88_BILB_zAGc,6243
-mlrun/common/schemas/feature_store.py,sha256=kX3Wd107ZfyGrDOcNmLEcgdVrFgtHTswzVhmH6VVWX4,3671
-mlrun/common/schemas/frontend_spec.py,sha256=EI5WjRlhvE1sFPECk-GICmFnYHsko1lM6sfLQyRR48E,2546
-mlrun/common/schemas/function.py,sha256=tuaD2M4RhiIJmL3p78FrbE6gG5nXRj_J-k6POUWzYx8,3971
-mlrun/common/schemas/http.py,sha256=2hKkmPqhZai5w_YgpjRMp8ZqlRjnUULwaUx5QF4SUmI,705
-mlrun/common/schemas/hub.py,sha256=bufhIim-G8NryGA26orpEvKfUEeTJ7601pCtVDz6bCU,4245
-mlrun/common/schemas/k8s.py,sha256=4ZHOZv2IrDquG5rRi41eWkJmHGdmjn-pV4gH6AF-tcI,1395
-mlrun/common/schemas/memory_reports.py,sha256=SlNJ-uya5RywEysm_IZMwF1t4j-zYsjOj8oPYwLRO08,920
-mlrun/common/schemas/model_endpoints.py,sha256=QC64kHZXb_Z3InvxUJWh1PbzcoztLjZFDiQzZkUmVG4,12593
-mlrun/common/schemas/notification.py,sha256=Bov6DqX2nmkn7daFnuFgTWHExuPwIbsGoz-pmsb6ohA,879
-mlrun/common/schemas/object.py,sha256=G4jqG8oO_r4T5gtvz_m39VNpdvCBTZ6didnccCWI0D0,1907
-mlrun/common/schemas/pipeline.py,sha256=u-WQjN3JQxDs1kG_r_tQ-mklj_pfPWXaMEXKHFSerO0,1184
-mlrun/common/schemas/project.py,sha256=EDlhuxRCBgwcUD6XLu2uFe7LBF8nzwB9oSFzbB7krHo,4094
-mlrun/common/schemas/runtime_resource.py,sha256=TqivuenSskqcXxBXJuFwung50oqFg-IdL_PBHg3YBpY,1636
-mlrun/common/schemas/schedule.py,sha256=bmCUXDa26dN8mncIE9GgPU4PlfXAyn84JRsD_ztA384,4188
-mlrun/common/schemas/secret.py,sha256=6Uk85-icEW6MWK1Euj-EhzJSyaQpkTMjmD0DBa0jIfw,1484
-mlrun/common/schemas/tag.py,sha256=gWWw5PsjPzbOogS66n_setW-Kc-_ZTH-p_mg2ZmSz-0,905
-mlrun/data_types/__init__.py,sha256=hBd2-QsTqesw3HUDoIUaUtCR1mWEcRc4V7Z1V8lNP0s,1087
-mlrun/data_types/data_types.py,sha256=xjsnUw144Lbkg4JqYLYym8qQpucYQUjphxay_BIc7VA,4647
-mlrun/data_types/infer.py,sha256=ErGpXigp8bG6hkPJfbJt8cJZxsZvj-bK0dLSiTlUYzk,5813
-mlrun/data_types/spark.py,sha256=BVM_FeWh1mKYLu6QILYfZRCOGefQzRJ2t0LeHo-pqwA,9426
-mlrun/datastore/__init__.py,sha256=ScHRywI8M5BDdLfEFDZ57Gk1_Bnj22bj8TLK7Ea1juU,3443
-mlrun/datastore/azure_blob.py,sha256=XFBpXZfwMKvv0rrYVP2J6RDqziNPHW6KqCbsY-VLzto,6946
-mlrun/datastore/base.py,sha256=HVh5RGOKb5KD-dACPaGBt_50xBhtdB8x3bPoIutmoEA,18450
-mlrun/datastore/datastore.py,sha256=l6CfmIYn7rdPQyRZ8kZu45cfyDZcDXDH5CwLKvsFlI8,7995
-mlrun/datastore/filestore.py,sha256=v9-BTJMgamGN_neoXNkIbNNr56UpgOewMEX70P8MTbc,3791
-mlrun/datastore/google_cloud_storage.py,sha256=9dtZt7Opytrra45urj6ObYa1fxf7UIOHXSoog4G9l7I,5114
-mlrun/datastore/inmem.py,sha256=o6Svv12k5PxJNT24nMgV9FBYEPCzD3OQzuuvU6OeCYY,2627
-mlrun/datastore/redis.py,sha256=pywWgjGJ51pmvKuwX1MI3ILWqh6WtgDs9igOQAhmIhc,4873
-mlrun/datastore/s3.py,sha256=fn1Yg5Rs33ugHlwTKvBfu_jMKqkSZWgHNw0ocQ5nO7A,7035
-mlrun/datastore/sources.py,sha256=ek6ID69jGexnuPHicTC4-IKd5Utk9ZN_dQ0GQz3w0s8,34376
-mlrun/datastore/spark_udf.py,sha256=xYw2EYO-jd7hKOlXXfJYH8dvRll4GktFM581K9m6ToE,1410
-mlrun/datastore/store_resources.py,sha256=Elvo33AVoDfOIFbTF_5NSf1VMzlgJTv5uzMgPkGTShw,6895
-mlrun/datastore/targets.py,sha256=3hCqWnEBFytvihUL8VYDSIWDmMtS3clXHEF-puxDfFg,62102
-mlrun/datastore/utils.py,sha256=nnHcC_XgUWZi70-aZ2y61aJcJttDQYiCDDTGqI_Y6V4,2900
-mlrun/datastore/v3io.py,sha256=ArEYq78irv5bwlRwcLeVfFJvcwtXEamGsZ2I0sVt7Qg,8097
-mlrun/datastore/wasbfs/__init__.py,sha256=4CK7vZeJmC4Ak9cJjG07cGnk7jlkBlpCxw-ANfbBmzk,1343
-mlrun/datastore/wasbfs/fs.py,sha256=DEZgwrmQSPeR93MNlC9OCwuU9wvTSmIM534p5ccQzAE,6152
-mlrun/db/__init__.py,sha256=HA6ahbEFrRd5I81eJQ1xrHmUch6JOy3JeEKMf7KrOTM,2816
-mlrun/db/base.py,sha256=7he8xfP09ZKLHjdWI2sZdgbfzV8Lw14kjYO-BJcp4VM,15968
-mlrun/db/httpdb.py,sha256=lmQdoDHAsrf591HblohzU7opJPmgUoJcmSzBLMXv-1E,130841
-mlrun/db/nopdb.py,sha256=mAEmOlxhnlk3DU8xTf2uWt_5QbDvo8YA9Jj-BKR_VtA,13197
-mlrun/db/sqldb.py,sha256=7scsyukK7k6AhU2z9pB0cHrq-mzmhdFgJmfnkn_dO2o,25577
-mlrun/feature_store/__init__.py,sha256=guoak0hQTMoE4YsWwyoyso0CYE9NSPoP0eUal4crfVA,1501
-mlrun/feature_store/api.py,sha256=yPmbQ7J353juaFEa4kCOsABYLn_h8R5_x_CfzOPCucc,43719
-mlrun/feature_store/common.py,sha256=WR01cTgrJ88qRLKRz0U4VDOTg2vNzhYdch-jylkyoJ8,12781
-mlrun/feature_store/feature_set.py,sha256=lScyviJOVowwzNvasJ-gwHwF7Ltqk2nZghU39atN2sk,47683
-mlrun/feature_store/feature_vector.py,sha256=31kHErOGU_OhVauMK5svW50TKIDwKgdcDzst87JyB2c,21940
-mlrun/feature_store/ingestion.py,sha256=YQafLdoQmoWsEHLE8lMBBhhPe974TNJ6Tnq_Q0Xhpus,11681
-mlrun/feature_store/steps.py,sha256=PXpu7rGj_kYs3010vLYjCJqcJaKUCXPlMnWHAylh3YU,29357
-mlrun/feature_store/retrieval/__init__.py,sha256=2b2WoPmH4TqcSSJ2OQYSjsDIcUe1KA5DnG7-wkrIayM,1232
-mlrun/feature_store/retrieval/base.py,sha256=38n5qY60V-wvn5vAVSd4qQlfkMMTMchX0c2TdZ8XqqE,25911
-mlrun/feature_store/retrieval/dask_merger.py,sha256=-xRgRPWUblu3KtVhEoL0YXEAcgkZrSUykDe31xnEzRI,4261
-mlrun/feature_store/retrieval/job.py,sha256=-b4AgG3D0jFduzBPmKrb6MjSRez-8-ocmbj9eWCPXaY,7141
-mlrun/feature_store/retrieval/local_merger.py,sha256=h6FE11EZxxqVe2EhVnQtwl5cxOBsOCXQCbTLOJk3op8,4765
-mlrun/feature_store/retrieval/online.py,sha256=tnpHqcbaA16lKTuvlU6WoXwnb_SLmbWBLzyJSvhss28,3352
-mlrun/feature_store/retrieval/spark_merger.py,sha256=R-xHI2ubdx8y_bvgnxYfLtOTOWCy5q6Bjd2AZD1fh1w,9661
-mlrun/frameworks/__init__.py,sha256=H1bU7R7Ua6e52HLpP-MivDJh-L47564uJNTsmgJ0LH4,743
-mlrun/frameworks/parallel_coordinates.py,sha256=83AvqW9z666XDWd29WopLeOdEFAA2HpRZS6d08z1Nbs,11466
-mlrun/frameworks/_common/__init__.py,sha256=5C5C4nQkaGHnv4WuCLjcjtb9nfhRK-7g7O6bbuJVkSY,962
-mlrun/frameworks/_common/artifacts_library.py,sha256=RVh-uIinpH1do5UE6C6iIT44S5VaRvvZONLOp7jCPyA,8515
-mlrun/frameworks/_common/mlrun_interface.py,sha256=WD-CmVirLUx62pzcNLK8OYZpfrfP561rkU9g4o5d1ko,21018
-mlrun/frameworks/_common/model_handler.py,sha256=n89sZZXdUyeYVzPjmWGuRCO8EVX9PI9pjK44CTl8mbk,55376
-mlrun/frameworks/_common/plan.py,sha256=NgO7TEWBCLj1SPZL01zgRmVD-KYdwcZNCDiDi_ucuqE,3469
-mlrun/frameworks/_common/producer.py,sha256=if5LJarHi0PtBoJquEtEpWDdZ1uezgeyI6lmjEDS-us,5757
-mlrun/frameworks/_common/utils.py,sha256=AP54RnKfTZEJtMeiYkl8OWHIc-LAwA9Js-nrSlFvxXA,9209
-mlrun/frameworks/_dl_common/__init__.py,sha256=adGwgnQnN2j6QH9acPfUPITVAdSiTtz-wQGpZnAdxKA,750
-mlrun/frameworks/_dl_common/model_handler.py,sha256=jOIk01x0HRR5FkVBsB528ino69fRIiEvx6GWUoj9swE,1151
-mlrun/frameworks/_dl_common/utils.py,sha256=OsFlJKJbomoPbGVBV4dKHI_ezC3mRhqw2S24XTSFW0E,996
-mlrun/frameworks/_dl_common/loggers/__init__.py,sha256=DZ4HwyoeHy_Y1mPsRyOcra3yCXhcR8lloYHEhXToxCk,787
-mlrun/frameworks/_dl_common/loggers/logger.py,sha256=AdlofLPJLVMZbVqUmeZvSyExxaCLwQroonW_WeaXAQk,11531
-mlrun/frameworks/_dl_common/loggers/mlrun_logger.py,sha256=T7FoOVxKc6ontfJBJpfnfc7ecxRiJm0JlBLunx1FtUM,14777
-mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py,sha256=RY-hSYHWb81l6ftm3GEggUnbad9jvcGy92dqB9AOGeA,28414
-mlrun/frameworks/_ml_common/__init__.py,sha256=kO3SZHMaHcqZMU8l3Wz-Pcuys6gBNuKDj4nqUNkLtOs,956
-mlrun/frameworks/_ml_common/artifacts_library.py,sha256=Q0mD-8IDFh0hqVjaCUxj3TINSne36l4feCkzCnm1hFU,3169
-mlrun/frameworks/_ml_common/model_handler.py,sha256=z5s5_uLOM37kvGf4NklmHrhIdu3GKU_vSgHJdooC6mU,16957
-mlrun/frameworks/_ml_common/pkl_model_server.py,sha256=1mw-vbDtESlQ6NPxjLHfQqjOKP48vJjcJAOPsPh5pyw,2368
-mlrun/frameworks/_ml_common/plan.py,sha256=U9a3O9SIgoYtqOnquK87nbOeiLyC95nQ8UJ7KqhArAg,4881
-mlrun/frameworks/_ml_common/producer.py,sha256=E0b8oJRR5Vh9SXsn1UYatXwGOp0rB6Qq8ah-y8lamBU,4061
-mlrun/frameworks/_ml_common/utils.py,sha256=9Zq28eI9HSdfpyxT7aPmoim56riaX2DUFu_4KeFvFGk,10490
-mlrun/frameworks/_ml_common/loggers/__init__.py,sha256=KVgp9xsbVEiMV562iPkmr7eYn_rWwNGq4_9jc8ZC0JU,737
-mlrun/frameworks/_ml_common/loggers/logger.py,sha256=gpC-g2cBbfjA8qLnAfUZD9y2if2mMHyOeFFRLlH5DY0,5684
-mlrun/frameworks/_ml_common/loggers/mlrun_logger.py,sha256=mRfIALjGq7ZlQODOzLvqijYL7UZzQq8nJknuhaNG_wo,6453
-mlrun/frameworks/_ml_common/plans/__init__.py,sha256=h9yzfzK0NxDfb4TcyrgC38BWjSvucifD28i2GMa5Wgw,922
-mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py,sha256=X1D3qpw1VNtxDprgzKRNXu-HVi9QK_Dsx8htwdJxzkk,5212
-mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py,sha256=4U6676pcXpACBgfW8sqFWPWaBxHK3YLVyVwxMvqTVHk,6078
-mlrun/frameworks/_ml_common/plans/dataset_plan.py,sha256=-zoamN8bTeiLbd-OB_LWWYNle85c1jcg2MVveAWxUJg,6658
-mlrun/frameworks/_ml_common/plans/feature_importance_plan.py,sha256=0uzXsbDA1-e-eAhm8TXQl7NM8W6OBoiB5-TEi4Znw78,5318
-mlrun/frameworks/_ml_common/plans/roc_curve_plan.py,sha256=S3nS0DZT40LppWpfBy_YaEyElfDnl0K1MDgNCDU6g60,6993
-mlrun/frameworks/auto_mlrun/__init__.py,sha256=svETEvDzdxATSFvOxP-K7nhBmLKHcA1lmHcrfaae7eA,706
-mlrun/frameworks/auto_mlrun/auto_mlrun.py,sha256=QKcruqR8oFeaobLvNi_xNHL0eiSJlgEP9RelCrV3sO4,23796
-mlrun/frameworks/huggingface/__init__.py,sha256=4EKzInujhWzAii6VDSszXaL-tNVec7ypZx2K86xCiIg,721
-mlrun/frameworks/huggingface/model_server.py,sha256=ttBktGW7ksSx6c4aRH9jeXSL1-vFIK83wAFn6FXzb90,6083
-mlrun/frameworks/lgbm/__init__.py,sha256=aqxOh6PTEpK1M4uw3v_Xg2V2R5ZezDPNbvPYNydftiM,15883
-mlrun/frameworks/lgbm/model_handler.py,sha256=GcNsLrkBL7A-nC8MFULQyAJ9o2NRl6jCC13HpF_yg_E,13891
-mlrun/frameworks/lgbm/model_server.py,sha256=tBjW2C4jx0VRA-D_2is8Q8eCw3c2Gih7zJcqrSyKX04,9189
-mlrun/frameworks/lgbm/utils.py,sha256=48avdT3o9X9NsIvx3dxRZ9cDIS0R9-usrqGChDEuZCs,8278
-mlrun/frameworks/lgbm/callbacks/__init__.py,sha256=IMrIqryuP-HQ4CbWlvdB5lEppoG84EQTWsoQJ3cZopQ,857
-mlrun/frameworks/lgbm/callbacks/callback.py,sha256=xYW4vW02kbbgK9TYbWwZ7YuUgT6NiDWnZVfC9YzcqWM,4081
-mlrun/frameworks/lgbm/callbacks/logging_callback.py,sha256=FXKxA7dOfpxptOWHZ5tzRMInaAibRgPPyqK5sO4pO3Y,5156
-mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py,sha256=yt-24xQqVVrkRXXO71qjcptGraerT4dgxYgoc5sYw2k,4137
-mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py,sha256=L1lSIsqk3ZZ3d9h7hHv-hMcmqbbCGUopOMs6e_sCpzY,842
-mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py,sha256=KR3DKwKeXYHDSarlqpxPdUflQZKEXHjrgYOdm4Tk3ko,1624
-mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py,sha256=-jqcM3-53y_Rmk-UWMfw5ac77HXPVAFnZbKq3kjYqJA,14256
-mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py,sha256=LrPLVduyTagD-QB81ktpJYxhZ1sOiMecgmVBmvB2nuI,1333
-mlrun/frameworks/onnx/__init__.py,sha256=APwk3ZpJxY1EjBPV35_-LBzb1xEV8F-3bQrG8x6bANE,791
-mlrun/frameworks/onnx/dataset.py,sha256=xkgdDHKOQZ2qe7A5a5Q0_E9RYCDnqVl7Ogpj98Izcuc,6098
-mlrun/frameworks/onnx/mlrun_interface.py,sha256=5mNIFjTCpRBQglyDyScL7GTt1907FhI2zIZsyD9aTOs,2405
-mlrun/frameworks/onnx/model_handler.py,sha256=x6bVC7bcb37p1VeauYTG_BOQg-FX3V47GSFAxdDNhiI,6203
-mlrun/frameworks/onnx/model_server.py,sha256=uVV5JE5HMRHsOjYJBu4FKRRkCU7A78rjNtvB2I-QVY0,7061
-mlrun/frameworks/pytorch/__init__.py,sha256=-u1MUIPxdQu1qJA7EBfaWI_x3KeGHgIM76dCACRWLvs,22056
-mlrun/frameworks/pytorch/callbacks_handler.py,sha256=4XcfCCvxdfppRgfXsLxtbGSxcWT3uHUZHTBnN1TjHig,27904
-mlrun/frameworks/pytorch/mlrun_interface.py,sha256=ZxZKXFsM9VLxfhs2sMrl8p4Bc8Nam4xM4nmPxoB08Lg,44639
-mlrun/frameworks/pytorch/model_handler.py,sha256=rNv8X0YC1b7aQL3IFtSGB_rgoyIXbincP_Ebx-slF7w,22465
-mlrun/frameworks/pytorch/model_server.py,sha256=bp79k7tOK6CiH8i82a_oP71vG_8z-Jpyr1kIsa9OJOo,10136
-mlrun/frameworks/pytorch/utils.py,sha256=Oq66xJpXcm-f3PztIm7TfGZTNY18aXG4Ikw_s9OD5x8,4515
-mlrun/frameworks/pytorch/callbacks/__init__.py,sha256=13WM9gPhfVTWzGG3nlmJYxNFUhpUBc5-fpjIFRDxBGM,896
-mlrun/frameworks/pytorch/callbacks/callback.py,sha256=sgCK8wqmQvaxc65sWutaUZgrIoQN3w3V2_x3li2VPhw,11524
-mlrun/frameworks/pytorch/callbacks/logging_callback.py,sha256=m5X-BpRdfq-Om_yR9R38u9PtZhqtw1C7PuOpajgGOf4,23166
-mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py,sha256=ipiqVQsIwbTNxSB_OoccXY6Ju29zFms-adVq-Vhe32c,9310
-mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py,sha256=sr_XzE9xjstoJ4UwXPbN9hLMWsgCbUVkCwUuITqWgu8,26661
-mlrun/frameworks/sklearn/__init__.py,sha256=AqOSAPp1OGIHr2qZ4gGOX2PEqbpmQGo6cIpC3yB70zk,10892
-mlrun/frameworks/sklearn/estimator.py,sha256=wz-bQVQA3ZDCJrVhbKeAlq20Gur87hezS-ZUIMdwGMs,5852
-mlrun/frameworks/sklearn/metric.py,sha256=P6fwzFd0JfCBXpdUoqZdiUWggEG2aIy9RtOiDDEiNm0,7117
-mlrun/frameworks/sklearn/metrics_library.py,sha256=acnHwpW-rBTHxKXl2iL4Xa-M_b-AMHrvT7DaYiIVoDQ,12215
-mlrun/frameworks/sklearn/mlrun_interface.py,sha256=97UyVfcsgbDwU0IhTb_xTrfNOcMhKI4CPX6VZ057QYs,14126
-mlrun/frameworks/sklearn/model_handler.py,sha256=EXgFajawu9qHtz4rIR7GsGWcFoIAC9eOsMCOS7tM28I,4745
-mlrun/frameworks/sklearn/utils.py,sha256=yYsUq-rZZkil9O2nj5FSndz6ZZcwsaKFG0MKxBZs7-4,1209
-mlrun/frameworks/tf_keras/__init__.py,sha256=qDT6pdAloTVAbMF-h04IKGNW9h1cO3L-erTsiHLVsv4,10455
-mlrun/frameworks/tf_keras/mlrun_interface.py,sha256=rKDbANa915IclJj-uTEasdFfwojnUwET8_kHMYTpWmQ,16627
-mlrun/frameworks/tf_keras/model_handler.py,sha256=oK02EraPBK4vt6tTcKn_gyIYl9DdSC7gUUbiPkS2OD8,28247
-mlrun/frameworks/tf_keras/model_server.py,sha256=FaTSomamDRh0qezUHOduNEQunhgvrwY-9QgPcrR2lU0,9565
-mlrun/frameworks/tf_keras/utils.py,sha256=QqkV6GR6vwkb95_6_uNrtd0moO3awFpni4j2ETglKnw,4284
-mlrun/frameworks/tf_keras/callbacks/__init__.py,sha256=ucXr2Y9ev4AJ8CyHqjEz2v7adw4M3d7BdZaPGTY5-io,844
-mlrun/frameworks/tf_keras/callbacks/logging_callback.py,sha256=Yv0pHsiQey5cfxdjBIaxpd3znnEzVK9PshV05SnT5IM,21886
-mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py,sha256=N1_lNXSig6FwSUt1P8ZNKf1Hie-9pMo2feFjV7AoJzg,8791
-mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py,sha256=YM7gNuryhioDrvVPBhpIUo9lH-bhE5JdE-xSo-kriP4,28728
-mlrun/frameworks/xgboost/__init__.py,sha256=2-q_HGIgwzZUoBpxMC5OBYpn29qh84HHwZpHRcOke_I,10287
-mlrun/frameworks/xgboost/mlrun_interface.py,sha256=JwbFkYz97gmkjLN1V_zu8nTG9zSey1RtUmUO6XfaZ54,878
-mlrun/frameworks/xgboost/model_handler.py,sha256=3KSLoL_uBBhRPkGEgRxJz1MPxQbcbvuIxJawQConfrQ,11617
-mlrun/frameworks/xgboost/utils.py,sha256=Yz7vIfnFMqa2A0k2GweXL912-tt7JnQdYsNX-pFs45I,1069
+mlrun/api/utils/clients/protocols/grpc.py,sha256=jV05P3uzU1KkNZCNbS7e1PXQa9E7gxzZSDMEP38aN-0,2567
+mlrun/api/utils/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/db/alembic.py,sha256=lfIF2YSSe8hpZ8414e8qzKzwcTWWY9t-io-YwLoh0bA,3305
+mlrun/api/utils/db/backup.py,sha256=2XKIJFuqwW1M0oaJiAdjNFqPWQzSnc-zfX888LCR1AU,8214
+mlrun/api/utils/db/mysql.py,sha256=Mgb9Y-3Q3d0plZxcffnJaN8kqtfmE-Qo7rgdP2gM3T8,3787
+mlrun/api/utils/db/sql_collation.py,sha256=RUf4Z2m18vvZ7AGqFvzJUXHEpdiEewF8V17EiEtkSDM,992
+mlrun/api/utils/db/sqlite_migration.py,sha256=CnrG2Gl68tTGuQ8rSONVLXLwQD4pR1dcvV_Wp6psKV0,3861
+mlrun/api/utils/events/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/events/base.py,sha256=w0qyqp6Gzl7fk2HSZuMPovk5i3lbi_sDhnaKw15nYQ4,1721
+mlrun/api/utils/events/events_factory.py,sha256=jtEn8y0ssxB9sML8zIqZTHQa29KkCG4AzsH3lOGIrsE,1630
+mlrun/api/utils/events/iguazio.py,sha256=krzyxNv405V7aqkrs4ZlaByxzZkKEJWvZksvQUaZgDg,8798
+mlrun/api/utils/events/nop.py,sha256=qjbrS2Mszl87GxrQZpX0TKiRl7RL9cDJd_G5RAut2FQ,1739
+mlrun/api/utils/projects/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/projects/follower.py,sha256=S7YWVyOB6OaKp1VD3KCV_i2IL3c68Frgw92QZMpsTk4,17760
+mlrun/api/utils/projects/leader.py,sha256=LfOx99_SnUKghzZJ37JM0MywazNqFWW7ujreETS19KU,19412
+mlrun/api/utils/projects/member.py,sha256=LPhV_hFnsaoeZxUAhZ1LNWPcL14fPuBna7Zww0hBMA8,7133
+mlrun/api/utils/projects/remotes/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/projects/remotes/follower.py,sha256=hMEdSY58RIO40J68p3WhjKzqYw5ZgQU-5SBos-z9ZWw,2659
+mlrun/api/utils/projects/remotes/leader.py,sha256=yxOaVygWexYES2zkGf2BkqBbuXdlLzDs7guKhMpHMcM,2094
+mlrun/api/utils/projects/remotes/nop_follower.py,sha256=LBYFqVIO4nuzTAckPFAHU07Y8HdeFswcn9kkZrvZ0dY,4995
+mlrun/api/utils/projects/remotes/nop_leader.py,sha256=IJbuMrfxQhCY9EuSKo_RAHc4JhvdfXpFDLHgQBk3Iu4,3854
+mlrun/api/utils/runtimes/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/runtimes/nuclio.py,sha256=xQtcQTItMo_cMrYBUpppVhaDKHG9tSV1nkeuYnuQrZo,1675
+mlrun/api/utils/singletons/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/api/utils/singletons/db.py,sha256=BozkPyTJPjmK5qh9YMAIlFb7XhAPxyxYg_tvJYkq4Vo,1203
+mlrun/api/utils/singletons/k8s.py,sha256=k5ERoQPUrj0hGc0TzhA-66DzNE4sPSX8jqtzd0STeOk,24570
+mlrun/api/utils/singletons/logs_dir.py,sha256=DUHIa-A87yUFqAGjPHFpMlvMiFMXGPZXjthzZCwiNKo,840
+mlrun/api/utils/singletons/project_member.py,sha256=11b_FmTC9kWvAVXuWwLOYpJT5TXT2I13sbzFjjtFMuI,1312
+mlrun/api/utils/singletons/scheduler.py,sha256=tlT826tOXQqaTgbQ8fcC4sx02JOliM_obUcSdtXtUa4,1064
+mlrun/artifacts/__init__.py,sha256=gLuGdv-6oSl_ePf3LT7hiaNNGTFSbI6X4_FJiOE8Y1Q,1123
+mlrun/artifacts/base.py,sha256=OKEJxlKZ58JLEOGmeP1W8IBPtb9O8-qaHaohRJc1vWA,31144
+mlrun/artifacts/dataset.py,sha256=7HnzOYtEQoHo4i5mJZggdQcNRbjzeBDhB6zTUc0g3ZI,20485
+mlrun/artifacts/manager.py,sha256=o7R232Xwal-XyhplMa3LJob0ZSWynD_JBAs-fst3PI0,12594
+mlrun/artifacts/model.py,sha256=5yu2lACWaMaU5RD-8l94c5Jnmr4-XNkTjjjGAypP8Eo,24241
+mlrun/artifacts/plots.py,sha256=DeII7_XDJecyaVpxZRmWFnO4MD3cULn7MJ6h6MPjHEQ,15383
+mlrun/common/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/common/constants.py,sha256=NpBgZV-ReSvPeMKPFp3DKzNWgiVebjGZrZ19pG_ZfRE,660
+mlrun/common/helpers.py,sha256=FqlMfRiZeGS6HZCOHaAJae2wDL1aRoijFBS5aZoPiIM,1108
+mlrun/common/types.py,sha256=V_jCEFCJZcycFVsPzEToCRQja5bqW0zRAAVaGN_QYxQ,790
+mlrun/common/db/__init__.py,sha256=xY3wHC4TEJgez7qtnn1pQvHosi8-5UJOCtyGBS7FcGE,571
+mlrun/common/db/sql_session.py,sha256=iWR8DWyziN2DSDiBgc5Wj3O7iVWDwfd0nJklAKwjoRM,2542
+mlrun/common/model_monitoring/__init__.py,sha256=x0EMEvxVjHsm858J1t6IEA9dtKTdFpJ9sKhss10ld8A,721
+mlrun/common/model_monitoring/helpers.py,sha256=5iszLVcUtWiDRnidYpPAR6kZWD76TVlWsFL4x7QOKaE,2312
+mlrun/common/schemas/__init__.py,sha256=MOh7nepRwoWNht8m12atUflaU2FhGVFJFSGp2cxTeKw,4384
+mlrun/common/schemas/artifact.py,sha256=vbXaY8eHxKt7YHKksD_PYEC-47eguxVb6wRAtMAW7Bk,1923
+mlrun/common/schemas/auth.py,sha256=vkv3cFQjFUsocraqo9smmDdkuWqZJVCsJ-vNc9FrlUU,5490
+mlrun/common/schemas/background_task.py,sha256=1_nTVLDvTyYzsrzXQSfCwz_OlrcvrBlIwxy1ghDLyt8,1553
+mlrun/common/schemas/client_spec.py,sha256=ijEzcztL-8P4yxLmoLRWLu6dSb1AlahrOoOFpFqEI6Y,2751
+mlrun/common/schemas/clusterization_spec.py,sha256=aeaFJZms7r7h2HDv6ML_GDAT6gboW-PxBbc3GKPalGk,888
+mlrun/common/schemas/constants.py,sha256=WpREVl6QW7sDJJO6LquRnCFi1cKEI-zI3AxkONEihts,6243
+mlrun/common/schemas/events.py,sha256=ROHJLo_fqYjc96pek7yhAUPpPRIuAR76lwxvNz8LIr8,1026
+mlrun/common/schemas/feature_store.py,sha256=LrJJ55TxpCF4RkmorB-i1IUTbixlP-jwLhdn19LLF-Q,3723
+mlrun/common/schemas/frontend_spec.py,sha256=bFjFic5hAWquaibR8fUaoDV8SRKrzdp9kTCjbeqT2Qc,2546
+mlrun/common/schemas/function.py,sha256=6eslF1HMlKqfIpryPCJLqYJkpkWUelQ72lE9_oAc5HU,4432
+mlrun/common/schemas/http.py,sha256=1PtYFhF6sqLSBRcuPMtYcUGmroBhaleqLmYidSdL9LM,705
+mlrun/common/schemas/hub.py,sha256=CZ38rx0CWX7wyGRkdzAcZp505k8w0M7z8hoiiEQ13Lw,4245
+mlrun/common/schemas/k8s.py,sha256=nmMnhgjVMLem5jyumoG2eQKioGK9eUVhQnOSb3hG7yw,1395
+mlrun/common/schemas/memory_reports.py,sha256=O5ajjqSimTPl9nzlZg2ewRbddDXWgqUr-zoadv_slZc,920
+mlrun/common/schemas/notification.py,sha256=yi5y14NGByWMvQflx9_cv1JbjyDYQT1_alv7YnmlUoY,1518
+mlrun/common/schemas/object.py,sha256=W735Gmu5D_x6LxNp1qsHMkhldjY5b_1H9QvAiiITRRc,1986
+mlrun/common/schemas/pipeline.py,sha256=tvpSHmXDR20uxWIHQ5KXf1zGKi1jaT5pDUIS26zJhLI,1184
+mlrun/common/schemas/project.py,sha256=yvP1fBhcCkkK4VhM2P0yLeRYpK3qBY4faKxC9L6ySa8,4177
+mlrun/common/schemas/regex.py,sha256=8_vbDeAE0SODJDj7yUFg1FbaB9CNydYQTJ29JxE74Kc,776
+mlrun/common/schemas/runs.py,sha256=tgq6PCYFVC1h94n_Iy8a6EkjRa12go1drWDUvfnjcEA,1010
+mlrun/common/schemas/runtime_resource.py,sha256=GyeqRwbBoLMq-0zWCkocvKl2nz9a62dAfguaPdqUzYw,1636
+mlrun/common/schemas/schedule.py,sha256=OCZkHvTRPU-A6tHJYgPZsVF17JWwKBu5atDxOy2J41I,4556
+mlrun/common/schemas/secret.py,sha256=51tCN1F8DFTq4y_XdHIMDy3I1TnMEBX8kO8BHKavYF4,1484
+mlrun/common/schemas/tag.py,sha256=2sm2Z5qM0jyakHuT_lxb-EQ2M5Unpodz4lj6MNkDEzo,905
+mlrun/common/schemas/model_monitoring/__init__.py,sha256=_Z0tUeQ5MlWL-LL-7Iicef7QY5dkTNUlBI9ygA2_poY,1300
+mlrun/common/schemas/model_monitoring/constants.py,sha256=TpxRiwVpEe6LzjCSzunin5SBJhxYt6_W1YDw9TYYFKk,5068
+mlrun/common/schemas/model_monitoring/grafana.py,sha256=W6TcNc7mqPj040lfQrEadEQ37csdxLDgdU3QRLlELMQ,1444
+mlrun/common/schemas/model_monitoring/model_endpoints.py,sha256=4asvVsqhusAsBKXSvZ4_88oSBN9Kom7Ac8VQAbqqUI8,11152
+mlrun/data_types/__init__.py,sha256=EkxfkFoHb91zz3Aymq-KZfCHlPMzEc3bBqgzPUwmHWY,1087
+mlrun/data_types/data_types.py,sha256=qgRIdlSl9X-rAnwOW-F0hwPbDKOZI05JlSzV1O8ReaU,4647
+mlrun/data_types/infer.py,sha256=iEEQKZ6l-6PhHJWPwVyBJTEANNoP9xkrkYtryOH3O60,5813
+mlrun/data_types/spark.py,sha256=iNcpPsChTmDndqRp92eWN0ZoAszqWXvRR86rupx2ThQ,9426
+mlrun/datastore/__init__.py,sha256=ZHspikZYGqiCKqH5H3EA5txuckayC0BwXh9jONCSHzw,4089
+mlrun/datastore/azure_blob.py,sha256=8j3cZuQ8pqnPx48JAJvjtqSqufyNlqXROGrMGD8h3wM,6946
+mlrun/datastore/base.py,sha256=9riD7d__cegdvegsgDebo2G7fxOejXKk8c7xq3yH8qo,22471
+mlrun/datastore/datastore.py,sha256=_F_lz5QXBo8FNdek5yPW9WIqjprkrg0v-nULEqDrYvM,8377
+mlrun/datastore/dbfs_store.py,sha256=Zlr1SjU5pCZT3Uqa2xn0sCXtGc8i5bSCCGXtLoNojC8,6302
+mlrun/datastore/filestore.py,sha256=o4ex777XyxyV1CQBP7M2JyyssCVVAc4H3JrvNC9eryM,3791
+mlrun/datastore/google_cloud_storage.py,sha256=Y_X4ODhvvBeknE_Aqaky_Fdi0-EY5waZAglmAttgFgY,5114
+mlrun/datastore/helpers.py,sha256=-bKveE9rteLd0hJd6OSMuMbfz09W_OXyu1G5O2ihZjs,622
+mlrun/datastore/inmem.py,sha256=6PAltUk7uyYlDgnsaJPOkg_P98iku1ys2e2wpAmPRkc,2779
+mlrun/datastore/redis.py,sha256=bcUpBK_HzHxEyjtSHjxmcD2C6wYe_AI7kaLKeiwHH5w,4873
+mlrun/datastore/s3.py,sha256=Zd3Bmd9IMA3WEG4fWQnhJqyAjwW2PouHPpk4uDnMttg,7035
+mlrun/datastore/sources.py,sha256=QtNOQMgbKBf2yGx-j5MZhKH8prHjVwFhq6EczRzyzEI,37671
+mlrun/datastore/spark_udf.py,sha256=NnnB3DZxZb-rqpRy7b-NC7QWXuuqFn3XkBDc86tU4mQ,1498
+mlrun/datastore/store_resources.py,sha256=SUY9oJieq3r8PEq8G661XxmXem_e-CxDoy2AJ7dpXBk,6906
+mlrun/datastore/targets.py,sha256=YAlwvuKbYTDeN3n5sujqWktV56K_Y4_c9lF8gvFdcKQ,63310
+mlrun/datastore/utils.py,sha256=tEuLkrb66l5rISjlhzZ6_aDZiZdhT1ZRQv4-sj_-YXc,5438
+mlrun/datastore/v3io.py,sha256=ywd-rrB5Uicdk7KGMk-nJ4mKPjvg2z5w6TVx5Bo5jIo,8099
+mlrun/datastore/wasbfs/__init__.py,sha256=s5Ul-0kAhYqFjKDR2X0O2vDGDbLQQduElb32Ev56Te4,1343
+mlrun/datastore/wasbfs/fs.py,sha256=FfKli7rBwres1pg8AxDlyyg1D5WukBEKb8Mi1SF5HqY,6152
+mlrun/db/__init__.py,sha256=v0oqIVmpH1gBrat8ElHxulot1He5BC-8I0FbVceXD84,2816
+mlrun/db/base.py,sha256=xFoxsTmNIoyv_5RHk0giA8aXeUb-HpEtl5udy4xiGik,16194
+mlrun/db/httpdb.py,sha256=Vsf1364lFPnIehViCy9Fp3YXvCZAArq__CwvzHhKBdg,133910
+mlrun/db/nopdb.py,sha256=0Fot6rj8UkD-kZ6pzZq8TFi3DKw5W063v5H5DQxHbWA,13209
+mlrun/db/sqldb.py,sha256=33tViPlLJ6r1j6brQR_vHD_yR4ecsiTlLb1k1whyDhg,25590
+mlrun/feature_store/__init__.py,sha256=uxmSztZwsMoqT3jYFhFqNMQE6zYqPjYbhI-SJJTf4Lw,1501
+mlrun/feature_store/api.py,sha256=HmmPPDkePYo_CPU6BJcbpWvfKPzd-JSGXiydzkIxG0Q,44918
+mlrun/feature_store/common.py,sha256=sl2pmkuv5w4KtTMjt0ky34Qps0iuoXNWbyYGuBkCxjc,12809
+mlrun/feature_store/feature_set.py,sha256=YceJb0NSRCdTF5J6kk1qBrr-qNsEA5nKoXuIweRj0JM,48102
+mlrun/feature_store/feature_vector.py,sha256=UkdOBH9Xl73VmwGUN-3T3gi_w4PVR8-8wetmLM-20yE,22173
+mlrun/feature_store/ingestion.py,sha256=Assf4Ozi-BBBp63fKIInbTRNMEOIwQY649VrHhOjbAQ,11681
+mlrun/feature_store/steps.py,sha256=EcZBJvSO-7UMUnzf-nv728cHRxGxHschzfXrmji7e5U,29357
+mlrun/feature_store/retrieval/__init__.py,sha256=6qtZFx8-vtsHv8ZGJuTv3UDe9m7XIlOq4ryEYC58Eww,1260
+mlrun/feature_store/retrieval/base.py,sha256=EsPBvBFzZ4dB0pbkgae4onzsDKRLjUFZNcjPNBMHvtw,30286
+mlrun/feature_store/retrieval/dask_merger.py,sha256=QUiCDbyCCFCRGC5Tpun8Ao4Dt9cCH8D6F7eQhcvfAGU,4623
+mlrun/feature_store/retrieval/job.py,sha256=K1WSoSjuSUSjO3dE_BQricZTmIlHfrPJH7vtKzg7VdA,7657
+mlrun/feature_store/retrieval/local_merger.py,sha256=irE-m-P7ZZlG2lXk2pOhvCKCg4Gd457jeB-NKWkYZc8,4252
+mlrun/feature_store/retrieval/spark_merger.py,sha256=bWStsJjxWGU51-JvCzKI3jQto7N6EAcD2NK94Av2T0A,9565
+mlrun/feature_store/retrieval/storey_merger.py,sha256=SMnG1SMiR0gO1Sp7UPthRf1HciKg4YR6BZUP2aH_dK4,6296
+mlrun/frameworks/__init__.py,sha256=qRHe_nUfxpoLaSASAkIxcW6IyunMtxq5LXhjzZMO_1E,743
+mlrun/frameworks/parallel_coordinates.py,sha256=8buVHWA-mD1R5R9jm71XN5fvDyz9Bkp7D1xD4vFYHTE,11466
+mlrun/frameworks/_common/__init__.py,sha256=7afutDCDVp999gyWSWQZMJRKGuW3VP3MFil8cobRsyg,962
+mlrun/frameworks/_common/artifacts_library.py,sha256=se6gpxwidTIjPo3lY2LmmX16AUg3qUPnTYOkllnqPxQ,8515
+mlrun/frameworks/_common/mlrun_interface.py,sha256=_5nUwKid4I6WrzgncoIL0U38uaKDIrI59JPYQ1Abh-g,21018
+mlrun/frameworks/_common/model_handler.py,sha256=BmdABncjj2o4bNDSyxltGDlOW44cMXJ5_qn5f1Bx_fQ,55376
+mlrun/frameworks/_common/plan.py,sha256=NxRlH6bNCtK_qOu75c6fNsFrRP5GlFxOwbLC_focuyk,3469
+mlrun/frameworks/_common/producer.py,sha256=nwTSIEn5VyO-glr3OeeKWbAzkXGABhz187y5F2W_OcQ,5757
+mlrun/frameworks/_common/utils.py,sha256=k2nI06Y6XK2mLZwq8PAq_j1_V36XmaG66L36oy2r-7U,9209
+mlrun/frameworks/_dl_common/__init__.py,sha256=t4GWqonje9xSOPKTxFBjiOaK57l06ALmIXi4EJsG9LM,750
+mlrun/frameworks/_dl_common/model_handler.py,sha256=GUAcDklhAxxH9e9xZPnqjjUGQGeXIHvSdw_SH-r9ACs,1151
+mlrun/frameworks/_dl_common/utils.py,sha256=eVjqSHJh2OSKq7s1BMyCVrZ9VIrkAKaD1Y0wcTA-QXU,996
+mlrun/frameworks/_dl_common/loggers/__init__.py,sha256=0mh4CZKKjlwsE4Boaldb0TfSyaUltwQshGLBNpwQsYA,787
+mlrun/frameworks/_dl_common/loggers/logger.py,sha256=molkm5eJNRxwUeFmupNCnhUD_SASwh1he5OGYlWFjDM,11531
+mlrun/frameworks/_dl_common/loggers/mlrun_logger.py,sha256=POzNufOnji0-LPASM7aZ_zaRtJ4OPD1yb0KXNOO4xcU,14777
+mlrun/frameworks/_dl_common/loggers/tensorboard_logger.py,sha256=r6TjiMR0-LagGpQ3EK7BYuuq14Hj5sCn6RlVRuWPFb4,28414
+mlrun/frameworks/_ml_common/__init__.py,sha256=0Tf6dl15IuJ41aokIpDmcGbV_aczHniZ1m3VVXJFcjY,956
+mlrun/frameworks/_ml_common/artifacts_library.py,sha256=0z73w0ju3EcmjAy_t3z7_DZNfmgpSNvCKhiWjgL6Ua8,3169
+mlrun/frameworks/_ml_common/model_handler.py,sha256=RJ3po14IaCvQeEVQ98_VlbHUp0X0nIwxvHtFMj4p5IQ,16957
+mlrun/frameworks/_ml_common/pkl_model_server.py,sha256=GMByhOTUM2sUg2XB8BjRJSQXlhfkWkU1gG2PVX8IsFU,2723
+mlrun/frameworks/_ml_common/plan.py,sha256=cJXPkVqzb-mWr11tiWdkMDNVHu98Z23OS8sFhoyNJIw,4881
+mlrun/frameworks/_ml_common/producer.py,sha256=5sCFmr38zg_ZTZUvukVti0-z2VP6d-vBhQbIOEPwJf0,4061
+mlrun/frameworks/_ml_common/utils.py,sha256=c6-r0RhJGHa4sCmFjeX7Xp254Mqxr2yolw0cydTJ6nM,10490
+mlrun/frameworks/_ml_common/loggers/__init__.py,sha256=AWw6H8xG4237XGzqNKIhO-wbzBRREHaY_AXF-NRLBNo,737
+mlrun/frameworks/_ml_common/loggers/logger.py,sha256=Ef8vhty5MlObRwkvxJFyO4tCprZRpR1XL3WQD8hrcg0,5684
+mlrun/frameworks/_ml_common/loggers/mlrun_logger.py,sha256=4bjEnkhGqH7pyv_2Rwv_szIwkfV-t6BItrwXwy0CsPU,6453
+mlrun/frameworks/_ml_common/plans/__init__.py,sha256=v1RhdMoa2iEIKpnnFzysR3yqOVWZOTv8q8AmwpqAbUQ,922
+mlrun/frameworks/_ml_common/plans/calibration_curve_plan.py,sha256=EQbCrCBl7iRfJRSI4Hmuqz6jGzIADjic28xxRsKtVgM,4943
+mlrun/frameworks/_ml_common/plans/confusion_matrix_plan.py,sha256=zV7buSJnCKGXQ9Mf4hRwrh_MIuwaFIQ8Pli7v87-EiY,6078
+mlrun/frameworks/_ml_common/plans/dataset_plan.py,sha256=j6AM2QThlOkze6lKKh8zpUP8OFCvisAGwlnHSq2ERbA,6658
+mlrun/frameworks/_ml_common/plans/feature_importance_plan.py,sha256=KoRt88iJ1DPuVdgdHBfhsfEioPMfY0d7xJKYh7TbGD4,5318
+mlrun/frameworks/_ml_common/plans/roc_curve_plan.py,sha256=5lDagE5D6ICOTmeaR37WtgqPbL7Z8tY9qN_8Whekwt0,6993
+mlrun/frameworks/auto_mlrun/__init__.py,sha256=vvaF4qWRVcpeb2zlo0qZFAZ9Ddji4SNRx78auLwnPnI,706
+mlrun/frameworks/auto_mlrun/auto_mlrun.py,sha256=J_akMQUPPq_4AEV8XK97uy9w9OZwKO-RMg-o_UCzSrs,23796
+mlrun/frameworks/huggingface/__init__.py,sha256=hXgVSsCXYPuAi7zHIY9I7VqgnPevkf9lf4zi2jHZ_f0,721
+mlrun/frameworks/huggingface/model_server.py,sha256=sCc7BZ6slDWSBFXsheJOUq_U2FnF-Gx_p4ku086FS64,6083
+mlrun/frameworks/lgbm/__init__.py,sha256=-YW6bl7CyHlDmY6bUBeO5Ou4e1YJbohPle0BY13yn_c,15883
+mlrun/frameworks/lgbm/model_handler.py,sha256=TSdvOKRc6KYPV7il_ZgGyp2PRPHCoDbPFoOJR88wEHs,13891
+mlrun/frameworks/lgbm/model_server.py,sha256=p1DNzmMzRFkTYGS-s1P48XUmdjotRPMACgAK_DW2eZ8,9189
+mlrun/frameworks/lgbm/utils.py,sha256=NouPIxVQLxsl5zDYQXfriSCjV0o0oxvmbGA4uXYB_UY,8278
+mlrun/frameworks/lgbm/callbacks/__init__.py,sha256=yFVBxi96SBgdBngSDsapzYo89yn_2seDJjEXO_0qfmM,857
+mlrun/frameworks/lgbm/callbacks/callback.py,sha256=BWwpTug8p8s0kYF4v1NxZthTrLioat_cwGkU2In0JbE,4081
+mlrun/frameworks/lgbm/callbacks/logging_callback.py,sha256=zjhpC8-HeYcxPQI7c-MbV4-_UW4p5GRyLraVYVxy39c,5156
+mlrun/frameworks/lgbm/callbacks/mlrun_logging_callback.py,sha256=4DWjCqyZlqsCGrmfPm0_XGaKGs3VmQIu2UVU86LWJZk,4137
+mlrun/frameworks/lgbm/mlrun_interfaces/__init__.py,sha256=5xZZJnYaRAQi53WzKnvYZgs8UgNbBvCnIkx7a2_dCi4,842
+mlrun/frameworks/lgbm/mlrun_interfaces/booster_mlrun_interface.py,sha256=TL14PfD2UK_EJ5RnTQ8l4v1ycnEJxC4T60ii-ILnejk,1624
+mlrun/frameworks/lgbm/mlrun_interfaces/mlrun_interface.py,sha256=NvEwOotPE2V2WP3XgOJH87CJOuAmy7_dlnSGwX86vwY,14256
+mlrun/frameworks/lgbm/mlrun_interfaces/model_mlrun_interface.py,sha256=xZbzQSgHZ6GhlpgaW543wE3c-GAw0BAinrfXa106AVo,1333
+mlrun/frameworks/onnx/__init__.py,sha256=BouzKRGKM4UJYTmDEJkPtEn1EslusX8Q2DMkjcbDmuc,791
+mlrun/frameworks/onnx/dataset.py,sha256=9KeEluZJA8nLYeT9NyOiBRxCi803BGI6k6ejYZ9PUZI,6098
+mlrun/frameworks/onnx/mlrun_interface.py,sha256=orKulF-8t6WE_yG05vlySP-eG98ELa9KqbWz0f-70YQ,2405
+mlrun/frameworks/onnx/model_handler.py,sha256=sGTDVtv5CdFY8Z3bBb3Dvde3Zl6nw9TUp1p9ecZV4-I,6203
+mlrun/frameworks/onnx/model_server.py,sha256=7GlHyzLTAkPNnCNW4YXQR1Ias0N6eoLYJdyZ8JgYrJI,7061
+mlrun/frameworks/pytorch/__init__.py,sha256=3bQNCzl1Ql7i2BUsHF2n1-Ic6mX5FDfEZeDHr7Z6_OM,22056
+mlrun/frameworks/pytorch/callbacks_handler.py,sha256=7p9nt8xE-3G61epxpSemO7VBHHVChvkAh7eYyr9QCTs,27904
+mlrun/frameworks/pytorch/mlrun_interface.py,sha256=1L_qszV-noaX3EI84kEZYsa4pBgg2SMEAuRG7JWfHdQ,44639
+mlrun/frameworks/pytorch/model_handler.py,sha256=vJnHRfy5wu2Pam99t-rgRpQs27dRGZYQiHQ4r9HCRXU,22465
+mlrun/frameworks/pytorch/model_server.py,sha256=ApAl1u733-ns-YaveXieNXvwQw3uyVy6zvcVg5-ZKDk,10136
+mlrun/frameworks/pytorch/utils.py,sha256=kjkLNgzX9lLyEnZlUiBFfoKy_E1_OWj0g-sVYJT_kPQ,4515
+mlrun/frameworks/pytorch/callbacks/__init__.py,sha256=HcQaboA3T62ngrexy78Erc9q5AM0xJztj4Y_qgiqjpw,896
+mlrun/frameworks/pytorch/callbacks/callback.py,sha256=2kNQHtWzoBC9EeoU3IWrKRNcfeiJmIIe192WQYiSv1Y,11524
+mlrun/frameworks/pytorch/callbacks/logging_callback.py,sha256=knZMbNTRCrYEQ-K-e36UCdBF1HYyE_l3Eu8aXy-o3Mg,23166
+mlrun/frameworks/pytorch/callbacks/mlrun_logging_callback.py,sha256=M2ZTVLuSKQfxFALKyQuUsehVTFnr6G6PdBH4HCliX-M,9310
+mlrun/frameworks/pytorch/callbacks/tensorboard_logging_callback.py,sha256=LnRcDbZIWBlIkFRT3u_sVL3o-ACK23uBzyUhAWcDyII,26661
+mlrun/frameworks/sklearn/__init__.py,sha256=u3KcQR84QkVttnWO-yQlA749QOu78WCREVLb3a0cw3E,10892
+mlrun/frameworks/sklearn/estimator.py,sha256=wLsGshFTOLdaGDziyiL03JdaVCoI8DKZ64UdXJskV5o,5852
+mlrun/frameworks/sklearn/metric.py,sha256=8Zcs5EYRxccaxHoR-ZhsIsHWoUboN6yhRgvUrMZOq00,7117
+mlrun/frameworks/sklearn/metrics_library.py,sha256=rbxt37AaAfUXmcP1fx_0VrTrU_CiX7UOjUtGNbgW8UM,12215
+mlrun/frameworks/sklearn/mlrun_interface.py,sha256=2NSV8gUYL9eNmwR3q8gLZKAsOza2JPoWxRQmrOHFzQ4,14126
+mlrun/frameworks/sklearn/model_handler.py,sha256=uV-SaCU15PW_S79syfrGxlpT9ZPjoKccPNax53sG4O0,4745
+mlrun/frameworks/sklearn/utils.py,sha256=Cg_pSxUMvKe8vBSLQor6JM8u9_ccKJg4Rk5EPDzTsVo,1209
+mlrun/frameworks/tf_keras/__init__.py,sha256=P2H2qJp5UmdDR8TXOM6Df9NbkvTEsw3egxldrRZVPS4,10455
+mlrun/frameworks/tf_keras/mlrun_interface.py,sha256=NpHUPjvakqNzMuZ4gnw0EJF5yQdv8FggPrp01I6h1tA,16627
+mlrun/frameworks/tf_keras/model_handler.py,sha256=OazNSoAVjvja6yrfx9VL8FYfQjEurJExNYqEHvVaqIQ,28247
+mlrun/frameworks/tf_keras/model_server.py,sha256=JTOq5W1-g32VTAmAYTcJ_7nocReVI7pcU9PmFrTHD8A,9565
+mlrun/frameworks/tf_keras/utils.py,sha256=_QWk1YmdRybbUB54vsQFE2_WMuAK0g7eR1ozVbMk0Go,4284
+mlrun/frameworks/tf_keras/callbacks/__init__.py,sha256=ufH33gxHF4erP9RCiM8O2YaXLG6btLIU98gCS_MGFjI,844
+mlrun/frameworks/tf_keras/callbacks/logging_callback.py,sha256=dh6M9TiyeHnxHgBaU6-0tg0wa7E3plUJOm0yskanWK4,21886
+mlrun/frameworks/tf_keras/callbacks/mlrun_logging_callback.py,sha256=_9tF4KrSA2LKqE_uqwWMSHiRvNXPERwi8ABS96XqzNU,8791
+mlrun/frameworks/tf_keras/callbacks/tensorboard_logging_callback.py,sha256=Ql-NLPbELuROju3boCidU8RVmPWZ7EqbvwBLTTOOrS0,28728
+mlrun/frameworks/xgboost/__init__.py,sha256=wPDaQcqb5tWgT8nxDWsLX4Ema7qieKm1ttQvplX13JY,10287
+mlrun/frameworks/xgboost/mlrun_interface.py,sha256=QcP_mTKBjxvRyWcNnju0BlvXBDOqNH9B1XBoxvEojAk,878
+mlrun/frameworks/xgboost/model_handler.py,sha256=XV8xndGhQsPkOX9djqiNVYFB0xiZPujhC0m4DUOU2zI,11617
+mlrun/frameworks/xgboost/utils.py,sha256=5zLzHoeI3n2FuA_rdGzi404QCTLfQx1TYEyUWhZogs8,1069
 mlrun/launcher/__init__.py,sha256=pZgS6ZN126aJme4z5spCX-RmdchShxMnQeCPya8AsQI,577
-mlrun/launcher/base.py,sha256=xoQtzJ7l5YBhbt1uS1hjFbGpiRr3V7feWflu1WTVUVI,15203
-mlrun/launcher/client.py,sha256=wyFkYodepNxvdeF6ktGUzeQctYBGp9frNX_PJBjn1Pg,6163
-mlrun/launcher/factory.py,sha256=Co7Y9WI9_CCbr5slKTVDbTV0uO4XQZ9ysC8d2YlTG94,1883
-mlrun/launcher/local.py,sha256=cw32RjICv7iPhsTb39mpDEflI4CBt6ILmb_QVX3QnJE,10568
-mlrun/launcher/remote.py,sha256=5isL4jaPzrYnEY_C-V4N8GtuU9-G05e3GyAy_nGnfmU,6769
-mlrun/mlutils/__init__.py,sha256=enRhuXMjuev4xr-0l1zLxtoDp79FHc-HXbUoagYomvk,760
-mlrun/mlutils/data.py,sha256=uQ45eaKYx3Jy93l2TqosFW68Kj_ZtVI06ilxGxydaUY,5325
-mlrun/mlutils/models.py,sha256=_CijiNJkLnWdz0HU3DAU6P8TbobY7R2QVpuCOHTJD-4,2598
-mlrun/mlutils/plots.py,sha256=0-Rih6th9WkgzZRPIPZwz08lv4bVSX7YbyGNgA02xdA,30120
-mlrun/model_monitoring/__init__.py,sha256=YIUIQs1hwX-PWBu23dH-IY9gQYXW8HA0oFX3izaG9d0,1208
-mlrun/model_monitoring/features_drift_table.py,sha256=DlMkc-GwRhIALXB0OdCQkvOZQUVNI69RpJ1PAwLqK9Y,23948
-mlrun/model_monitoring/helpers.py,sha256=6e7yA4a3tErirdSCuC-BIH8OqISzkFcx-h9-5K38STU,9756
-mlrun/model_monitoring/model_endpoint.py,sha256=enXHLZ72Sd-lQ7lMeBQNnQaf4xX-TLZbTgEMuNw9UYQ,5196
-mlrun/model_monitoring/model_monitoring_batch.py,sha256=kmlD3q6rBT7X2fwugBeV9tKcLmrAFsX3uxa59VS8Yxs,36885
-mlrun/model_monitoring/stream_processing_fs.py,sha256=NAPRpD9lj6SOzPbAT-cT2NrUw-Fn0-wOel42eMINzHk,43134
-mlrun/model_monitoring/stores/__init__.py,sha256=0FlHSjq2etDBnlzzj930LEF0p6bO7G5i_INTUtT-lLE,4240
-mlrun/model_monitoring/stores/kv_model_endpoint_store.py,sha256=EopJGFVmV0bS0kbq17A1OJ91XHIellIqtV5Cu4tm3hI,17356
-mlrun/model_monitoring/stores/model_endpoint_store.py,sha256=-Brbv-jMx47rIFUPP0Ykb92o1KPyic9FgGBy4TA3ejs,5695
-mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=wlu4OL0uydJVEeuZz1_C_flIRrrBGEjWzGjzjfoF_9Q,15706
-mlrun/model_monitoring/stores/models/__init__.py,sha256=ea5Sca62LlYpjsTDMlaxRyIjRCpwOPxRwFJ5sABur-k,884
-mlrun/model_monitoring/stores/models/base.py,sha256=Az7Q2JZKCTqZJ2hqYaOLr2owVMagClFp2KwuriKMx24,655
-mlrun/model_monitoring/stores/models/mysql.py,sha256=vVVSIssH_ZHMG-BbqwbFlaiPcN8DQtU3mM2vTySAPdY,3741
-mlrun/model_monitoring/stores/models/sqlite.py,sha256=jLWkY8srgal7_aCL2eDPZIoceNGsi4Dec1T2rHNd0BI,3658
-mlrun/platforms/__init__.py,sha256=NNh9MSxgjdi7QftO3DHp4axQnBeO5IjxD8oR13_jp3A,2400
-mlrun/platforms/iguazio.py,sha256=3lp40GjKu4YM2ITSUaSw8M9tDFh-jsJ88nWr5vBbIiw,23997
-mlrun/platforms/other.py,sha256=DwqbdbMNlkC2nEl1yJ0jF9WZJzjVu2IVPTC3bQ_W9Y0,11852
-mlrun/projects/__init__.py,sha256=dsXSDyqBhLi8OOfpdjLJpYOwC2fy_Q_Ki95Bk6gVSwc,1153
-mlrun/projects/operations.py,sha256=-a_wikYQjMY2Le30CEdsxLw8Waf3-I8JfUz4qbqkqEM,17582
-mlrun/projects/pipelines.py,sha256=YLdLNirIp_p9Mm3BoU-tjRLtygzeJtd-cnfTQFVd2Ng,38343
-mlrun/projects/project.py,sha256=2WynLKeUEfsZJAktQvoC0sCrQa2PW8hiebtgKR0xIzE,114938
-mlrun/runtimes/__init__.py,sha256=NpPeD7XxDNxmeOqLSEmb7tUN59cYZlvw-DnJxla_peE,8773
-mlrun/runtimes/base.py,sha256=h10BuVTDRkq4Pgu1tw85ED5uqO0vajIUfQrdlvfXk5o,86181
-mlrun/runtimes/constants.py,sha256=Os_6YpWE8WMhigm1h3RKvn9Uo4LXNaEbA2xNSEDDEao,6689
-mlrun/runtimes/daskjob.py,sha256=d7MRUptiR7fCTc-ClbGHzlWxqOw6xXLqyyXm0C42Fio,30353
-mlrun/runtimes/funcdoc.py,sha256=PAvbUFXLei7vFYPwlntJhnUgBqn38kMlaSbp_Y2Ice4,9561
-mlrun/runtimes/function.py,sha256=GH6XUVOAvnhARg_oV3BUyLEG5xaYZHtiwrBbZ2FwniE,45205
-mlrun/runtimes/function_reference.py,sha256=ikxeXeFPAn7PpfYR1DPBRFc9MSXXFM34uH5z6iRTz9M,4911
-mlrun/runtimes/generators.py,sha256=WvXzsfZZWqxLV1ncZ-lzFHZH2ITK6ICROgDv2vfQUs4,6530
-mlrun/runtimes/kubejob.py,sha256=6Q3jYEPrZlOv-yoDJaF4sQSbvL39iN56Ux4nyS4GIAk,15410
-mlrun/runtimes/local.py,sha256=5lgXISWJUhu24lmiZzP6n4Y9HQ6ie0tiB-p5qLDU_0w,19158
-mlrun/runtimes/nuclio.py,sha256=ih2iwrJieeEom3iW0yU99QG4_u_Bdv7VWgs1CK4Q1P8,2885
-mlrun/runtimes/pod.py,sha256=foeea0tUMSWbH4_SS_biOIgEmUL3RP3NlQwNb62QGYk,60808
-mlrun/runtimes/remotesparkjob.py,sha256=Lp2EN32GQ1rY_34MEepdUzRTg-AP-OKyUM7xcy0Npb8,7695
-mlrun/runtimes/serving.py,sha256=jruUAxwi9PVHY-mlZkljMD7P5WGyfbSS8pJmzDqQI9E,29858
-mlrun/runtimes/utils.py,sha256=4ufkD4i38EZnFMgTsMykDZpiEJ87I3ZeWxbZDNyWs6c,21048
-mlrun/runtimes/mpijob/__init__.py,sha256=E0oiOsSYsRBBR0HV6e_EGaL_j2_dYEJwAcICnF8mOYU,790
-mlrun/runtimes/mpijob/abstract.py,sha256=0BbIziHG5ITg3gNClLuBwL6-J4IXXPxjifppQciQwNU,14713
-mlrun/runtimes/mpijob/v1.py,sha256=o-ZDw3O0HOzTMZ3lI3gMjGG0NYY0Ux3RqL0Kz9K3eV4,13845
-mlrun/runtimes/mpijob/v1alpha1.py,sha256=4rMpJk1C_gL6QtOmEFcgcmaCkHcor9mdKvIL46fEKFw,8460
-mlrun/runtimes/package/__init__.py,sha256=EHFvxDWnRkXqjmdv9Mj3O-nCYAFLbRsNgX5zR0ElwAk,673
-mlrun/runtimes/package/context_handler.py,sha256=Z33-nbg4h545n1gGgCSrb-0LiFbRsisST6w44oba22I,27068
-mlrun/runtimes/sparkjob/__init__.py,sha256=7damn-nBbM0unppemEuVwZxCAGwXq7EzXECMJ9AaRPY,751
-mlrun/runtimes/sparkjob/abstract.py,sha256=FFT4FGxUH67NQQlRApZtfWJSW9A3OCGjqlGTgmAaLnU,35028
-mlrun/runtimes/sparkjob/spark3job.py,sha256=mxHWVtT7hZeQsFklaFE5PeI9sSeGb3Pvr7mGfaPYgos,28746
-mlrun/serving/__init__.py,sha256=FOIyvEwEOH6QuJovcDrrP5VSdLeKoqummSlfhNMvFXg,1078
-mlrun/serving/merger.py,sha256=oRX6gJ3LUVeCJcTpJ1nwh4d1tk5FrSZshkXcH-y-dd4,6116
-mlrun/serving/remote.py,sha256=HJS9bz5_mUuaKGsNbqRKpo-eVHKbc1fIEOEsECPmnko,18038
-mlrun/serving/routers.py,sha256=Erod_gU6qnUk5ipNUsSZLrcPN_VHESN3W2dH5wwjQVY,55277
-mlrun/serving/server.py,sha256=5sR-XBEealOcFehQKZtIK4Gr7HJ63mPU7BtjcoUA3qw,20247
-mlrun/serving/serving_wrapper.py,sha256=ivoSlFNuC92plPHRfMzHr-hdN-jGqxneGiufJdgoxVc,836
-mlrun/serving/states.py,sha256=2SpSOwCMXvJwk_3wYf_i3seD4nO9aJnQXlZTfL0iiAI,54169
-mlrun/serving/utils.py,sha256=HVePCgBKiQrIoBE8qcG0Qb57FRpZ_3CrUSBv2pPFlVk,3902
-mlrun/serving/v1_serving.py,sha256=UF6Ydgyo-DuHZ4DkrEdNMQl5oopVaZqm4EfBMBSvhDY,11814
-mlrun/serving/v2_serving.py,sha256=7g-FBPqyc8zgCY6Xi8SoS23VldDnOoL2G81m8qGbDOU,21460
-mlrun/utils/__init__.py,sha256=YnW6IErGUxc1mdd7a3eNvoYO_fy-mv4Uvu5Go8uT-kM,826
-mlrun/utils/async_http.py,sha256=AvI4a9D0frI6XxHvqnQ4AzEXopezo90zZHvsOAJJt6g,10397
-mlrun/utils/azure_vault.py,sha256=atz9fIu1vfgWAND1g6flRQDhrX-xBxZ_6MOWm34Onh0,3456
-mlrun/utils/clones.py,sha256=lKgQeibQ3xQ9LH5bZTZCoYCXoOx_2mYNGD5A-OOxwAQ,6245
-mlrun/utils/db.py,sha256=SqDrvIpGX_qHs0MNx_PWQNRcUhHaKLngoHFKLW3m5j0,1662
-mlrun/utils/helpers.py,sha256=PaqRwL7K62do6gRr4iW6MxKYS68ogjB9NVugA6jZ3i4,43736
-mlrun/utils/http.py,sha256=FVgdYV8Np3TKbqszEtXrlgwqNyjScTMLAjJhlsWLifo,7093
-mlrun/utils/logger.py,sha256=yg3m2TAs4zgc0qJRtE6zvqkSHTr_rJSRfDqqEeHrh8c,7035
-mlrun/utils/model_monitoring.py,sha256=nGqRA7AJ8FjQcHaxc2HP-BaynxvIp7CEp7ZaaNUJQuY,10516
-mlrun/utils/regex.py,sha256=3hSOVEU5128xio_3BLBEmvvRGLipmGP2Sh7XgVAYs8w,3954
-mlrun/utils/singleton.py,sha256=kV9HhbzdmXo8gGKBPdbHWspRDutlkKX1ZEn96xs_LRs,883
-mlrun/utils/v3io_clients.py,sha256=ekxhjfcUnjV8cejQYTQUHnhYOKHA4KekIdSaywydTdM,1319
-mlrun/utils/vault.py,sha256=EgxGAfn-mxRCj8cKEzSrrZQ9SV7BFP8mIuSnbhJpNUQ,10447
-mlrun/utils/notifications/__init__.py,sha256=CgWLxslSqhTH-tExi_UR4AT-ipjkGUF4gwf9mKcNua8,990
-mlrun/utils/notifications/notification_pusher.py,sha256=0BKroemaYDjOHWRx6Ei7a7I1MRwGnnGVAfu0Eca2_TY,12720
-mlrun/utils/notifications/notification/__init__.py,sha256=iNF31hiEkenkp1VmJ4keyjixS17-gZ0oGuWNO7tlnm4,1803
-mlrun/utils/notifications/notification/base.py,sha256=ddlf70Cd59bMvvWi2EFqzJQTXSRHw19E4r-oX2Tk8rk,2177
-mlrun/utils/notifications/notification/console.py,sha256=JggUV_Ql8lluvlONtkmQWk6SeSPY7gEhICAbkg0jYas,1971
-mlrun/utils/notifications/notification/git.py,sha256=mJGIuQbL_sECQ846mzcG_jMfIvzQVuZoHYDk9bvmr8g,4722
-mlrun/utils/notifications/notification/ipython.py,sha256=bYIUpzb2QnLPhacL8l20NU4suRjE0-lxeYYXpHuqiTw,2021
-mlrun/utils/notifications/notification/slack.py,sha256=hONSD43eLSxQ5n3x8HHqI-zhHc4ZxThR8lLcfkKoHfw,3751
-mlrun/utils/version/__init__.py,sha256=hwfJgGWYGWFpepVGI1GbuCPqqEFGRbgguJg5sC0v4TU,614
-mlrun/utils/version/version.json,sha256=QXnhN0ZUN7Q-lQMis_wmzvecGTBquO3mCrhhV46GX8A,88
-mlrun/utils/version/version.py,sha256=O4Q4kwtKlI73oK7oBPuz4SVkUI8BC11E9DJIKHT91kU,1970
-mlrun-1.4.0rc9.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
-mlrun-1.4.0rc9.dist-info/METADATA,sha256=xWBhWvDVOBlp5eeZuYtJHxMz5DOYYAjAOQdtGJOEfOw,16853
-mlrun-1.4.0rc9.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
-mlrun-1.4.0rc9.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
-mlrun-1.4.0rc9.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
-mlrun-1.4.0rc9.dist-info/RECORD,,
+mlrun/launcher/base.py,sha256=5Ika123_bh2yMy4hMb4DhBO3aPtu1aiB0ONn6Ir2pZI,15792
+mlrun/launcher/client.py,sha256=disDV9FkIBGguETGBgZqs2WtSjx6C9G_mMBnO_jT5s0,6169
+mlrun/launcher/factory.py,sha256=kjHvWyr0sw1VsawuvXHrHUDZwg-mfRaHmwF66ozGB_w,2182
+mlrun/launcher/local.py,sha256=cWsXKfW-VOgAQOO795rh1YWalR-epRb0z0AbkYwL1x8,10815
+mlrun/launcher/remote.py,sha256=9vmM36ofsBqZrOQ5V7DntstdBwEElR2jM3u_ZSWtGkQ,6770
+mlrun/mlutils/__init__.py,sha256=c0Tc0aCRPDU0Jpk3kQy3s2Bc_0h1bnwmgQSN8oWbeUc,760
+mlrun/mlutils/data.py,sha256=4c5o3Tm4mrlVbYvmyDZpr9tAzMlrkmzE2damlLllNBY,5325
+mlrun/mlutils/models.py,sha256=fr_CdatlMVsiwf3RXwhZfLG2FWJBFz1Ku6TR9HdDNSI,2598
+mlrun/mlutils/plots.py,sha256=KmkKp9TFkHw4_WrgNbUwLMG-h0q7GjSO_Og0G8-iqTI,30120
+mlrun/model_monitoring/__init__.py,sha256=bC0NzTgk0lbMqZRvRsIPRRuGYX2ure5ENnTWNXzrmCw,872
+mlrun/model_monitoring/features_drift_table.py,sha256=tVWTOjU7q5oopKbu-dRfgGrrjJlLilQAavn9dVp01RI,23970
+mlrun/model_monitoring/helpers.py,sha256=YGvUC5Nvxojtpy9KPD80s6cmBq8n3b0-hVdAK0J7JrE,2388
+mlrun/model_monitoring/model_endpoint.py,sha256=yuKvIa5vJxsPk4dXPK6cKgfmZqsD_W2cdeNCWKEO6Tc,5214
+mlrun/model_monitoring/model_monitoring_batch.py,sha256=BHwc6OHuCuWoDIghIKNIWbqRU8f9i0ck0RMr4Vy25bE,37289
+mlrun/model_monitoring/stream_processing.py,sha256=c75mOBPcoOt080Sjfblpblznf3T7G5pLI5nzpQHJztU,43133
+mlrun/model_monitoring/tracking_policy.py,sha256=HFlANGEFobdG8kHXFsSwK9Vuxs8D3WKFrYIDH-5hExA,4475
+mlrun/model_monitoring/stores/__init__.py,sha256=VeMMBKGKiHwXtH6rbmb9kyoXgNdm9TJeAOqLzTJ2T0E,4248
+mlrun/model_monitoring/stores/kv_model_endpoint_store.py,sha256=cdsdlI6U7VInET2L6j9zQDYx0QG6bUdp7ePd-i6DXA4,20351
+mlrun/model_monitoring/stores/model_endpoint_store.py,sha256=zqGVidq9Clym1l15ZltIZMCTdFuZ1QUwXxEAma9-4Hs,5695
+mlrun/model_monitoring/stores/sql_model_endpoint_store.py,sha256=bfRW27MQWWPR4sWXenvqZgDvzbaO6nyOKv13FCIR-9s,15960
+mlrun/model_monitoring/stores/models/__init__.py,sha256=rod--mpxH03wuyfbsp1Y-4vSx-vpvufohfBdrXR-4o0,884
+mlrun/model_monitoring/stores/models/base.py,sha256=IXPIE8iLAXmg8gfxA9iNMfToMpZ9BrIZf0VoZ1bd_Jc,655
+mlrun/model_monitoring/stores/models/mysql.py,sha256=0s6TC783RLrEXnbPahYpJrYuWIWHVhNvj2lrwQdi7fw,4153
+mlrun/model_monitoring/stores/models/sqlite.py,sha256=lZZgkhce_209T6QKXzoO98gtJQxk9M1nOQR38y-JWk0,4070
+mlrun/package/__init__.py,sha256=4A1houoObsq46gc4eSeaEanoJKTpund00KZomyciN2I,7101
+mlrun/package/context_handler.py,sha256=Tb8I9iX03SdKp1ZKrhbEmE_sgEYrvlPV9Q2cfyKUrbg,13974
+mlrun/package/errors.py,sha256=LKF8SSaRIdbkB7JQz6b9U4mZV42Ebnf6ZHu4wKuWqK4,1204
+mlrun/package/packager.py,sha256=wa9c9AbbxnZThU1vjiFBKlxOYrHuIg3jzLUTD_yGfI8,12606
+mlrun/package/packagers_manager.py,sha256=ilmV_0_cW-CIAiLVLoS0FINDdBzXFbCPccZBBlLxOCI,37275
+mlrun/package/packagers/__init__.py,sha256=rpxpuATMoxCMgHDaVamm0uwocy71e0CSXm85Q5X9tkU,769
+mlrun/package/packagers/default_packager.py,sha256=SaKUTv7hRWq8XuyeO87cYOebGixkZABgPAqwsHJvCZs,20060
+mlrun/package/packagers/numpy_packagers.py,sha256=ACG0cctrjvRCrYPiffEPV3K0XZiXG78zU_zn14uu8OI,20618
+mlrun/package/packagers/pandas_packagers.py,sha256=shWlNIeWGcrkDS-2oBxukNrBQ9XrSoeY5Mtvc8zAMIg,35951
+mlrun/package/packagers/python_standard_library_packagers.py,sha256=8yjqBN634Yaht3LsO-YclqmVZDD9pJxCKEC2vm5adb0,21528
+mlrun/package/utils/__init__.py,sha256=RXkhPH-zFLFFvOjMRJUVgVT33rusK5J4eTVLJ7bjN6k,1722
+mlrun/package/utils/_archiver.py,sha256=EF9r6BBwrFq7o8ig5nFlOnXJ-JsBnvSFTQphYuoGGAM,7567
+mlrun/package/utils/_formatter.py,sha256=EgdSMrJMgt-35myGuwfIOOKAe4jBi6QU7ssw1G0cacY,6393
+mlrun/package/utils/_pickler.py,sha256=S8UcTZ3XD68yqfY6ebD-loNC-C5goKfBR4cS5GOGbBI,10926
+mlrun/package/utils/_supported_format.py,sha256=fvwD1icALyV0wJUcRori6voH10j6KR3NN8n5o8HVw2E,2379
+mlrun/package/utils/log_hint_utils.py,sha256=ie7opnHlhVdh1mBkvYDFyWyFIjHn8Lm2FcxkiCmL9Z8,3709
+mlrun/package/utils/type_hint_utils.py,sha256=f-1AeFv2vwljH0ymXA4JmcIkH1lEf7HfsJ2A62H-X4A,14825
+mlrun/platforms/__init__.py,sha256=nGcTe4lvhh2opWBts2xhrxgGVDlD4EsF5PJ18dm5kEA,2400
+mlrun/platforms/iguazio.py,sha256=ya8-OXq4JSGC7_oNO1K9rmyrPt5zAI5NO2ZD3FM2xfc,23997
+mlrun/platforms/other.py,sha256=z4pWqxXkVVuMLk-MbNb0Y_ZR5pmIsUm0R8vHnqpEnew,11852
+mlrun/projects/__init__.py,sha256=Lv5rfxyXJrw6WGOWJKhBz66M6t3_zsNMCfUD6waPwx4,1153
+mlrun/projects/operations.py,sha256=A3JzRNZnYE1_VXN5JSGrZHIFO7ngLt8Vzau7XoPhAjs,17602
+mlrun/projects/pipelines.py,sha256=FSLJLgj_KceidykiCkz21uLhLMdXeEbjSZHt5j4WzKA,38781
+mlrun/projects/project.py,sha256=WIDDyxvnvKwormv6uCikrdqiOYKtYX9YO0e_dsYRPJU,127746
+mlrun/runtimes/__init__.py,sha256=JcOEzlpwPsOr6vghC6ohfgGtIUY9oRUd7hhnYlr9sIw,8692
+mlrun/runtimes/base.py,sha256=5My0H-ypIHelidVoFA0N1NU5W_CvGHYs7bWkH7N0Fss,86542
+mlrun/runtimes/constants.py,sha256=TnkD0nQ7pcFq1aJvbweoM4BgbkhaA6fHhg9rnAkxDBE,6689
+mlrun/runtimes/daskjob.py,sha256=fudZeRpd28rLVpm7rv-loBWZ9iXzGRAv9Z2s-oJ6Oas,30353
+mlrun/runtimes/funcdoc.py,sha256=HRD-mQkSyRBPExNWEhTCX3Cj01MXyeuQqc6jKwg5aZ4,9994
+mlrun/runtimes/function.py,sha256=8YVXPsA0OX9kIxV7GZN7vdg1Iiwno9RZBaRTLTWPI0o,44880
+mlrun/runtimes/function_reference.py,sha256=SJ0J-4ww0FQdijmdnUwGUKhMb-h5wtzqCPItTWKIL40,4911
+mlrun/runtimes/generators.py,sha256=_vuJVL4lDdyts0xK_R1Bw9zoblV-NsvSWr-bj-uXKB0,6530
+mlrun/runtimes/kubejob.py,sha256=9CUnSDsam06UJCsmqCwUK8G0QmNRQyHiKFwFMPQ8Gyk,15482
+mlrun/runtimes/local.py,sha256=zRekoW7H6ve8awBCnhkkCXK1CVLUhpRWCkUiuW7lYO0,19579
+mlrun/runtimes/nuclio.py,sha256=dv3Cgx4Ym46Bvrfb_JjwPfwGBVwwrsI2hpo4x3gSC3I,2885
+mlrun/runtimes/pod.py,sha256=RQqxfq23NnfNra6Mw4t8S3IFrAC9OnrrFqNVBgPkWwQ,61740
+mlrun/runtimes/remotesparkjob.py,sha256=owddZlsc0wPJhgVsG-4rLsa7sqk4zxgVjh_8Sg7cKQI,7695
+mlrun/runtimes/serving.py,sha256=Gp9nF67dcdxql9lWY6lVX1oxyDOfEgjfDNhKNmzt_eA,30505
+mlrun/runtimes/utils.py,sha256=wxX1K8vwcygizduqEhSnEh6DswPL2K-xWg568NTr2O8,20801
+mlrun/runtimes/mpijob/__init__.py,sha256=0fI7juivfMdSn_bfqdhHP5OoJl7WDfV6aB-AAkEyL_A,790
+mlrun/runtimes/mpijob/abstract.py,sha256=7fsHp9R-Dl5LsZ2vNPs_E9pjm9y6AD5iVmdGgYV1cVs,14713
+mlrun/runtimes/mpijob/v1.py,sha256=JEq4gWwII1vY91RO3eFGXDhfJdjbOGZGkIMSQkFOEEI,13845
+mlrun/runtimes/mpijob/v1alpha1.py,sha256=k4iYUvv7iM8F_66mXQST7K3yVETJYvYctaEIaVGMlX4,8460
+mlrun/runtimes/sparkjob/__init__.py,sha256=p8geeoPy2jQcE9xFxKsmDyUm9apqiIp23YBnjIokMt0,751
+mlrun/runtimes/sparkjob/abstract.py,sha256=uk9W1hCP9FLKxNt4xBn6TJLjy04vH6wN2THuAaO8nGM,35028
+mlrun/runtimes/sparkjob/spark3job.py,sha256=6oDQISBnfiCJ9M0NHJCANu2p2AwS6i6htEOUy4TgUNs,28746
+mlrun/serving/__init__.py,sha256=_6HRAOuS2Ehjo3vwx5h1aI_-JppxEAsl4VfEERAbGFE,1078
+mlrun/serving/merger.py,sha256=PXLn3A21FiLteJHaDSLm5xKNT-80eTTjfHUJnBX1gKY,6116
+mlrun/serving/remote.py,sha256=XtCgEY-azxcP0VUG1TupZXQ_dttPkAKIAtszW-GfGpQ,18038
+mlrun/serving/routers.py,sha256=b_HlsS84vvRc0U1521qN50aqtVm2kdP7QH5KKal4LOM,55318
+mlrun/serving/server.py,sha256=QAJuhBOJiDh2OVIeuu8aVCyP5y9iactT-bQE3l43aD0,20439
+mlrun/serving/serving_wrapper.py,sha256=R670-S6PX_d5ER6jiHtRvacuPyFzQH0mEf2K0sBIIOM,836
+mlrun/serving/states.py,sha256=qqOSSdujPAlk3ILh29JUslt1FkIZK-Wqw3zTlU7nCoM,54310
+mlrun/serving/utils.py,sha256=MHu3RljqtuEu3KxYcbECOzfgQZbfvYK09Tg5IAdvFgg,3902
+mlrun/serving/v1_serving.py,sha256=m_W8ylcASCvdP66lZSD6yQjamYCUJ3VZdOEQY4F8ozk,11814
+mlrun/serving/v2_serving.py,sha256=fAMA52lBvpLFpUa8LKHjRAwBZp_sR0wUmmtrN1ChJC4,21823
+mlrun/utils/__init__.py,sha256=g2pbT3loDw0GWELOC_rBq1NojSMCFnWrD-TYcDgAZiI,826
+mlrun/utils/async_http.py,sha256=Rjnulj27T7PxgyD_bZlBCdjOV8APC9_YP68jBONlt7s,10636
+mlrun/utils/azure_vault.py,sha256=VNs2fz0XlFrV5Ggz3T0mR7mOWHefEcC14wM7QpsbY44,3456
+mlrun/utils/clones.py,sha256=Q1b1BA4-slooth0gEXoX-x8mhr1m6BgFBA72DXfCqJ8,6245
+mlrun/utils/condition_evaluator.py,sha256=oR-GjryAg76D4G79G-DzVkx631D6Gd4jJgbr_d3Btnw,1920
+mlrun/utils/db.py,sha256=p3mME60akvgqZiDLPTtsCL9SeAxA43IEK6fyYX8IsQ0,1702
+mlrun/utils/helpers.py,sha256=K58Xup5sP9ww3pT-N0sgw7LK2Z0ygcHpOBL5podI0wA,47157
+mlrun/utils/http.py,sha256=i32dQYH35pt4gQjPdQugIaCtEOuKxPikRQyKBiHp1ew,8241
+mlrun/utils/logger.py,sha256=d5qUNJ-J_tNASi7A7-cRBOOXA0jJrEDEWFft8AAukLc,7035
+mlrun/utils/regex.py,sha256=MBNnPNEAitNBKYYt1WWXbv0Pz-tRkw3pUozE3GKmkF0,4303
+mlrun/utils/singleton.py,sha256=UUTQiBTXyzmjeYzsvTUsSxqyLJHOtesqif9GNfZO9rc,883
+mlrun/utils/v3io_clients.py,sha256=HL7Hma-pxaQBXMKcEnWqGLCpFgykwnszlabzeOHC9-E,1319
+mlrun/utils/vault.py,sha256=xUiKL17dCXjwQJ33YRzQj0oadUXATlFWPzKKYAESoQk,10447
+mlrun/utils/notifications/__init__.py,sha256=eUzQDBxSQmMZASRY-YAnYS6tL5801P0wEjycp3Dvoe0,990
+mlrun/utils/notifications/notification_pusher.py,sha256=Dmgdgsg1dA88h450yJlnm2QhHkMPO_2ayCdUHW4DYV8,19870
+mlrun/utils/notifications/notification/__init__.py,sha256=v2ULfsoGLlgBKS90ezou9wooBX7fo0NJgDsNdr51YEk,2113
+mlrun/utils/notifications/notification/base.py,sha256=t1sxExL2i2tJr3UuiQ9NTDONrpXcGBsrnxtAdemog2s,2293
+mlrun/utils/notifications/notification/console.py,sha256=3xNMf-PFANx6h6I6qpf-xRnI5S0001fHI4caYguNBgg,1971
+mlrun/utils/notifications/notification/git.py,sha256=5pJs3LFzuz2h3JO9vAGo3BL00-WZFdUcCaO2XaZh-1I,5221
+mlrun/utils/notifications/notification/ipython.py,sha256=qrBmtECiRG6sZpCIVMg7RZcWi5WqbgWl9Ktgg-oi2EY,1962
+mlrun/utils/notifications/notification/slack.py,sha256=5JysqIpUYUZKXPSeeZtbl7qb2L9dj7p2NvnEBcEsZkA,3898
+mlrun/utils/notifications/notification/webhook.py,sha256=iD4DhpJjfjaYj4o8NLQEY842-hNSnqj7SqKzSvnlmGE,1865
+mlrun/utils/version/__init__.py,sha256=7kkrB7hEZ3cLXoWj1kPoDwo4MaswsI2JVOBpbKgPAgc,614
+mlrun/utils/version/version.json,sha256=0geMQV6vBmcxX-h-1WjerHB6XCH3JpLbh9iS-je7zts,88
+mlrun/utils/version/version.py,sha256=HMwseV8xjTQ__6T6yUWojx_z6yUj7Io7O4NcCCH_sz8,1970
+mlrun-1.5.0rc1.dist-info/LICENSE,sha256=xx0jnfkXJvxRnG63LTGOxlggYnIysveWIZ6H3PNdCrQ,11357
+mlrun-1.5.0rc1.dist-info/METADATA,sha256=UMuONJKI3FHrTS_pTFmSTv_7lWVdypSP3ze3iyoO2us,17014
+mlrun-1.5.0rc1.dist-info/WHEEL,sha256=pkctZYzUS4AYVn6dJ-7367OJZivF2e8RA9b_ZBjif18,92
+mlrun-1.5.0rc1.dist-info/entry_points.txt,sha256=ZbXmb36B9JmK7EaleP8MIAbZSOQXQV0iwKR6si0HUWk,47
+mlrun-1.5.0rc1.dist-info/top_level.txt,sha256=NObLzw3maSF9wVrgSeYBv-fgnHkAJ1kEkh12DLdd5KM,6
+mlrun-1.5.0rc1.dist-info/RECORD,,
```

