# Comparing `tmp/mariqt-0.5.5-py2.py3-none-any.whl.zip` & `tmp/mariqt-0.5.6-py2.py3-none-any.whl.zip`

## zipinfo {}

```diff
@@ -1,33 +1,33 @@
-Zip file size: 214436 bytes, number of entries: 31
--rw-r--r--  2.0 unx     5876 b- defN 23-Jul-18 09:18 mariqt/converters.py
--rw-r--r--  2.0 unx    14710 b- defN 23-Jul-18 09:18 mariqt/core.py
--rw-r--r--  2.0 unx     8485 b- defN 23-Jul-18 09:18 mariqt/directories.py
--rw-r--r--  2.0 unx      465 b- defN 23-Jul-18 09:18 mariqt/equipment.py
--rw-r--r--  2.0 unx    16621 b- defN 23-Jul-18 09:18 mariqt/files.py
--rw-r--r--  2.0 unx    28565 b- defN 23-Jul-18 14:49 mariqt/geo.py
--rw-r--r--  2.0 unx    23207 b- defN 23-Jul-18 09:18 mariqt/image.py
--rw-r--r--  2.0 unx     3090 b- defN 23-Jul-18 09:18 mariqt/misc.py
--rw-r--r--  2.0 unx    40159 b- defN 23-Jul-18 14:49 mariqt/navigation.py
--rw-r--r--  2.0 unx     7345 b- defN 23-Jul-18 09:18 mariqt/provenance.py
--rw-r--r--  2.0 unx    22316 b- defN 23-Jul-18 09:18 mariqt/reports.py
--rw-r--r--  2.0 unx     4376 b- defN 23-Jul-18 09:18 mariqt/settings.py
--rw-r--r--  2.0 unx     8323 b- defN 23-Jul-18 09:18 mariqt/tests.py
--rw-r--r--  2.0 unx     9613 b- defN 23-Jul-18 09:18 mariqt/variables.py
--rw-r--r--  2.0 unx       21 b- defN 23-Jul-18 15:08 mariqt/version.py
--rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
--rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
--rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-18 09:18 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
--rw-r--r--  2.0 unx    12135 b- defN 23-Jul-18 09:18 mariqt/sources/dship.py
--rw-r--r--  2.0 unx     4684 b- defN 23-Jul-18 09:18 mariqt/sources/dship_settings.py
--rw-r--r--  2.0 unx     2177 b- defN 23-Jul-18 09:18 mariqt/sources/elements.py
--rw-r--r--  2.0 unx   117195 b- defN 23-Jul-18 14:59 mariqt/sources/ifdo.py
--rw-r--r--  2.0 unx     5533 b- defN 23-Jul-18 09:18 mariqt/sources/ofop.py
--rw-r--r--  2.0 unx   650149 b- defN 23-Jul-18 09:18 mariqt/sources/svgs.py
--rw-r--r--  2.0 unx     3728 b- defN 23-Jul-18 09:18 mariqt/sources/underway.py
--rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/AUTHORS.md
--rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/LICENSE
--rw-r--r--  2.0 unx     1133 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/METADATA
--rw-r--r--  2.0 unx      110 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/WHEEL
--rw-r--r--  2.0 unx        7 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/top_level.txt
--rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-18 15:10 mariqt-0.5.5.dist-info/RECORD
-31 files, 1079721 bytes uncompressed, 210410 bytes compressed:  80.5%
+Zip file size: 214551 bytes, number of entries: 31
+-rw-r--r--  2.0 unx     5876 b- defN 23-Jul-21 08:26 mariqt/converters.py
+-rw-r--r--  2.0 unx    14710 b- defN 23-Jul-21 08:26 mariqt/core.py
+-rw-r--r--  2.0 unx     8485 b- defN 23-Jul-21 08:26 mariqt/directories.py
+-rw-r--r--  2.0 unx      465 b- defN 23-Jul-21 08:26 mariqt/equipment.py
+-rw-r--r--  2.0 unx    16621 b- defN 23-Jul-21 08:26 mariqt/files.py
+-rw-r--r--  2.0 unx    28565 b- defN 23-Jul-21 08:26 mariqt/geo.py
+-rw-r--r--  2.0 unx    23207 b- defN 23-Jul-21 08:26 mariqt/image.py
+-rw-r--r--  2.0 unx     3090 b- defN 23-Jul-21 08:26 mariqt/misc.py
+-rw-r--r--  2.0 unx    40325 b- defN 23-Jul-21 08:26 mariqt/navigation.py
+-rw-r--r--  2.0 unx     7345 b- defN 23-Jul-21 08:26 mariqt/provenance.py
+-rw-r--r--  2.0 unx    22316 b- defN 23-Jul-21 08:26 mariqt/reports.py
+-rw-r--r--  2.0 unx     4376 b- defN 23-Jul-21 08:26 mariqt/settings.py
+-rw-r--r--  2.0 unx     8323 b- defN 23-Jul-21 08:26 mariqt/tests.py
+-rw-r--r--  2.0 unx     9613 b- defN 23-Jul-21 08:26 mariqt/variables.py
+-rw-r--r--  2.0 unx       21 b- defN 23-Jul-21 08:26 mariqt/version.py
+-rw-rw-rw-  2.0 unx     6175 b- defN 23-Jul-21 08:26 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json
+-rw-rw-rw-  2.0 unx    42461 b- defN 23-Jul-21 08:26 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json
+-rw-rw-rw-  2.0 unx     3218 b- defN 23-Jul-21 08:26 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json
+-rw-r--r--  2.0 unx    12135 b- defN 23-Jul-21 08:26 mariqt/sources/dship.py
+-rw-r--r--  2.0 unx     4684 b- defN 23-Jul-21 08:26 mariqt/sources/dship_settings.py
+-rw-r--r--  2.0 unx     2177 b- defN 23-Jul-21 08:26 mariqt/sources/elements.py
+-rw-r--r--  2.0 unx   117609 b- defN 23-Jul-21 08:26 mariqt/sources/ifdo.py
+-rw-r--r--  2.0 unx     5533 b- defN 23-Jul-21 08:26 mariqt/sources/ofop.py
+-rw-r--r--  2.0 unx   650149 b- defN 23-Jul-21 08:26 mariqt/sources/svgs.py
+-rw-r--r--  2.0 unx     3728 b- defN 23-Jul-21 08:26 mariqt/sources/underway.py
+-rw-rw-rw-  2.0 unx      162 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/AUTHORS.md
+-rw-rw-rw-  2.0 unx    35140 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/LICENSE
+-rw-r--r--  2.0 unx     1133 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/METADATA
+-rw-r--r--  2.0 unx      110 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/WHEEL
+-rw-r--r--  2.0 unx        7 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/top_level.txt
+-rw-rw-r--  2.0 unx     2542 b- defN 23-Jul-21 08:27 mariqt-0.5.6.dist-info/RECORD
+31 files, 1080301 bytes uncompressed, 210525 bytes compressed:  80.5%
```

## zipnote {}

```diff
@@ -69,26 +69,26 @@
 
 Filename: mariqt/sources/svgs.py
 Comment: 
 
 Filename: mariqt/sources/underway.py
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/AUTHORS.md
+Filename: mariqt-0.5.6.dist-info/AUTHORS.md
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/LICENSE
+Filename: mariqt-0.5.6.dist-info/LICENSE
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/METADATA
+Filename: mariqt-0.5.6.dist-info/METADATA
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/WHEEL
+Filename: mariqt-0.5.6.dist-info/WHEEL
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/top_level.txt
+Filename: mariqt-0.5.6.dist-info/top_level.txt
 Comment: 
 
-Filename: mariqt-0.5.5.dist-info/RECORD
+Filename: mariqt-0.5.6.dist-info/RECORD
 Comment: 
 
 Zip file comment:
```

## mariqt/navigation.py

```diff
@@ -307,28 +307,32 @@
 	pre_utc = -1
 	num_duplicates = 0
 
 	constStart = True
 	i = 0
 	for utc in time_points:
 		i += 1
-		if not (attitudes[utc].yaw == pre_yaw and attitudes[utc].pitch == pre_pitch and attitudes[utc].roll == pre_roll):
+		if not (
+				(attitudes[utc].yaw == pre_yaw 	   or None in [attitudes[utc].yaw, pre_yaw]) and 
+	  			(attitudes[utc].pitch == pre_pitch or None in [attitudes[utc].pitch, pre_pitch]) and 
+				(attitudes[utc].roll == pre_roll   or None in [attitudes[utc].roll, pre_roll])
+			   ):
 			if i != 1 and utc <= time_points[0] + maxIdenticalSecs * 1000:
 				constStart = False
 		else:
 			if (utc - pre_utc) / 1000.0 > maxIdenticalSecs:
 				attitudes.remUTC(utc) 
 				num_duplicates += 1
 			continue
 
 		pre_utc = utc
 		pre_yaw = attitudes[utc].yaw
 		pre_pitch = attitudes[utc].pitch
 		pre_roll = attitudes[utc].roll
-
+	
 	# if records starts already with const values remove also the first bit of the constant section
 	if constStart:
 		for utc in time_points:
 			if utc in attitudes.keys():
 				attitudes.remUTC(utc)
 				num_duplicates += 1
 			if utc > time_points[0] + maxIdenticalSecs * 1000:
```

## mariqt/version.py

```diff
@@ -1 +1 @@
-__version__ = '0.5.5'
+__version__ = '0.5.6'
```

## mariqt/sources/ifdo.py

```diff
@@ -2020,5306 +2020,5332 @@
 00007e30: 6549 7465 6d73 4c69 7374 4672 6f6d 496d  eItemsListFromIm
 00007e40: 6167 6549 7465 6d73 4469 6374 2873 656c  ageItemsDict(sel
 00007e50: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
 00007e60: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
 00007e70: 5d29 2c68 6561 6465 725f 6f6e 6c79 3d73  ]),header_only=s
 00007e80: 656c 662e 6967 6e6f 7265 5f69 6d61 6765  elf.ignore_image
 00007e90: 5f66 696c 6573 290a 2020 2020 2020 2020  _files).        
-00007ea0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00007eb0: 2061 7320 6578 3a0a 2020 2020 2020 2020   as ex:.        
-00007ec0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-00007ed0: 6728 224c 6f61 6465 6420 6946 444f 2066  g("Loaded iFDO f
-00007ee0: 696c 6520 6e6f 7420 7661 6c69 6420 7965  ile not valid ye
-00007ef0: 743a 2022 202b 2073 7472 2865 7829 290a  t: " + str(ex)).
-00007f00: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-00007f10: 5472 7565 0a0a 0a20 2020 2064 6566 2077  True...    def w
-00007f20: 7269 7465 5f69 6664 6f5f 6669 6c65 2873  rite_ifdo_file(s
-00007f30: 656c 662c 616c 6c6f 775f 6d69 7373 696e  elf,allow_missin
-00007f40: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
-00007f50: 293a 0a20 2020 2020 2020 2022 2222 2057  ):.        """ W
-00007f60: 7269 7465 7320 616e 2069 4644 4f20 6669  rites an iFDO fi
-00007f70: 6c65 2074 6f20 6469 736b 2e20 4f76 6572  le to disk. Over
-00007f80: 7772 6974 6573 2070 6f74 656e 7469 616c  writes potential
-00007f90: 6c79 2065 7869 7374 696e 6720 6669 6c65  ly existing file
-00007fa0: 2e22 2222 0a0a 2020 2020 2020 2020 7320  ."""..        s 
-00007fb0: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-00007fc0: 6469 6e67 4d73 6728 2257 7269 7469 6e67  dingMsg("Writing
-00007fd0: 2069 4644 4f20 6669 6c65 2229 0a0a 2020   iFDO file")..  
-00007fe0: 2020 2020 2020 2320 6368 6563 6b20 6669        # check fi
-00007ff0: 656c 6473 2061 6761 696e 2069 6620 6368  elds again if ch
-00008000: 616e 6765 6420 7369 6e63 6520 6c61 7374  anged since last
-00008010: 2063 6865 636b 2028 6372 6561 7465 6946   check (createiF
-00008020: 444f 290a 2020 2020 2020 2020 6966 2073  DO).        if s
-00008030: 656c 662e 6966 646f 5f74 6d70 2021 3d20  elf.ifdo_tmp != 
-00008040: 7365 6c66 2e69 6664 6f5f 6368 6563 6b65  self.ifdo_checke
-00008050: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
-00008060: 656c 662e 6372 6561 7465 6946 444f 2873  elf.createiFDO(s
-00008070: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-00008080: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-00008090: 4b65 795d 2c20 6d69 7174 692e 6372 6561  Key], miqti.crea
-000080a0: 7465 496d 6167 6549 7465 6d73 4c69 7374  teImageItemsList
-000080b0: 4672 6f6d 496d 6167 6549 7465 6d73 4469  FromImageItemsDi
-000080c0: 6374 2873 656c 662e 6966 646f 5f74 6d70  ct(self.ifdo_tmp
-000080d0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
-000080e0: 656d 734b 6579 5d29 2c0a 2020 2020 2020  emsKey]),.      
-000080f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008100: 2020 2020 2020 616c 6c6f 775f 6d69 7373        allow_miss
-00008110: 696e 675f 7265 7175 6972 6564 3d61 6c6c  ing_required=all
-00008120: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
-00008130: 7265 6429 0a20 2020 2020 2020 200a 2020  red).        .  
-00008140: 2020 2020 2020 2320 6164 6420 2224 7363        # add "$sc
-00008150: 6865 6d61 220a 2020 2020 2020 2020 7365  hema".        se
-00008160: 6c66 2e69 6664 6f5f 6368 6563 6b65 645b  lf.ifdo_checked[
-00008170: 2224 7363 6865 6d61 225d 203d 206d 6971  "$schema"] = miq
-00008180: 7476 2e69 6664 6f5f 7363 6865 6d61 5b27  tv.ifdo_schema['
-00008190: 2469 6427 5d0a 2020 2020 2020 2020 0a20  $id'].        . 
-000081a0: 2020 2020 2020 2069 4644 4f5f 7061 7468         iFDO_path
-000081b0: 203d 2073 656c 662e 6765 7469 4644 4f46   = self.getiFDOF
-000081c0: 696c 654e 616d 6528 6f76 6572 7772 6974  ileName(overwrit
-000081d0: 653d 5472 7565 290a 0a20 2020 2020 2020  e=True)..       
-000081e0: 2023 2070 7574 7320 6576 6572 7974 6869   # puts everythi
-000081f0: 6e67 2069 6e20 6f6e 6520 6c69 6e65 0a20  ng in one line. 
-00008200: 2020 2020 2020 2023 7769 7468 206f 7065         #with ope
-00008210: 6e28 6946 444f 5f70 6174 682e 7265 706c  n(iFDO_path.repl
-00008220: 6163 6528 2279 616d 6c22 2c22 6a73 6f6e  ace("yaml","json
-00008230: 2229 2c20 2777 2729 2061 7320 6670 3a0a  "), 'w') as fp:.
-00008240: 2020 2020 2020 2020 2320 2020 206a 736f          #    jso
-00008250: 6e2e 6475 6d70 2873 656c 662e 6966 646f  n.dump(self.ifdo
-00008260: 5f63 6865 636b 6564 2c20 6670 290a 0a20  _checked, fp).. 
-00008270: 2020 2020 2020 2023 2063 6f6e 7665 7274         # convert
-00008280: 2064 6963 7469 6f6e 6172 7920 746f 204a   dictionary to J
-00008290: 534f 4e20 7374 7269 6e67 0a20 2020 2020  SON string.     
-000082a0: 2020 206a 736f 6e5f 6461 7461 203d 206a     json_data = j
-000082b0: 736f 6e2e 6475 6d70 7328 7365 6c66 2e69  son.dumps(self.i
-000082c0: 6664 6f5f 6368 6563 6b65 642c 2069 6e64  fdo_checked, ind
-000082d0: 656e 7420 3d20 342c 2073 6f72 745f 6b65  ent = 4, sort_ke
-000082e0: 7973 3d54 7275 6529 0a0a 2020 2020 2020  ys=True)..      
-000082f0: 2020 2320 7772 6974 6520 7468 6520 4a53    # write the JS
-00008300: 4f4e 2073 7472 696e 6720 746f 2061 2066  ON string to a f
-00008310: 696c 650a 2020 2020 2020 2020 7769 7468  ile.        with
-00008320: 206f 7065 6e28 6946 444f 5f70 6174 682c   open(iFDO_path,
-00008330: 2027 7727 2920 6173 2066 3a0a 2020 2020   'w') as f:.    
-00008340: 2020 2020 2020 2020 662e 7772 6974 6528          f.write(
-00008350: 6a73 6f6e 5f64 6174 6129 0a20 2020 2020  json_data).     
-00008360: 2020 200a 2020 2020 2020 2020 2320 6c6f     .        # lo
-00008370: 6720 6368 616e 6765 730a 2020 2020 2020  g changes.      
-00008380: 2020 6966 206e 6f74 2073 656c 662e 6966    if not self.if
-00008390: 646f 5f70 6172 7365 6420 6973 204e 6f6e  do_parsed is Non
-000083a0: 653a 0a20 2020 2020 2020 2020 2020 2069  e:.            i
-000083b0: 6664 6f5f 7570 6461 7465 203d 2044 6565  fdo_update = Dee
-000083c0: 7044 6966 6628 7365 6c66 2e69 6664 6f5f  pDiff(self.ifdo_
-000083d0: 7061 7273 6564 2c73 656c 662e 6966 646f  parsed,self.ifdo
-000083e0: 5f63 6865 636b 6564 290a 2020 2020 2020  _checked).      
-000083f0: 2020 2020 2020 2370 7072 696e 7428 6966        #pprint(if
-00008400: 646f 5f75 7064 6174 6529 0a20 2020 2020  do_update).     
-00008410: 2020 2020 2020 2069 6620 6966 646f 5f75         if ifdo_u
-00008420: 7064 6174 6520 213d 207b 7d3a 0a20 2020  pdate != {}:.   
-00008430: 2020 2020 2020 2020 2020 2020 2073 656c               sel
-00008440: 662e 7072 6f76 2e6c 6f67 2822 6946 444f  f.prov.log("iFDO
-00008450: 2075 7064 6174 6564 2229 0a20 2020 2020   updated").     
-00008460: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00008470: 7072 6f76 2e6c 6f67 2873 7472 2869 6664  prov.log(str(ifd
-00008480: 6f5f 7570 6461 7465 292c 646f 6e74 5368  o_update),dontSh
-00008490: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-000084a0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000084b0: 5772 6f74 6520 6946 444f 2074 6f20 6669  Wrote iFDO to fi
-000084c0: 6c65 2022 202b 2069 4644 4f5f 7061 7468  le " + iFDO_path
-000084d0: 290a 2020 2020 2020 2020 7365 6c66 2e70  ).        self.p
-000084e0: 726f 762e 7772 6974 6528 7365 6c66 2e64  rov.write(self.d
-000084f0: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
-00008500: 742e 7072 6f74 6f63 6f6c 2929 0a20 2020  t.protocol)).   
-00008510: 2020 2020 2073 2e73 746f 7028 290a 0a20       s.stop().. 
-00008520: 2020 2064 6566 2077 7269 7465 6946 444f     def writeiFDO
-00008530: 6669 6c65 2873 656c 662c 616c 6c6f 775f  file(self,allow_
-00008540: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
-00008550: 3d46 616c 7365 293a 0a20 2020 2020 2020  =False):.       
-00008560: 2022 2222 2044 6570 7265 6361 7465 6420   """ Deprecated 
-00008570: 2d20 7573 6520 7772 6974 655f 6966 646f  - use write_ifdo
-00008580: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
-00008590: 2020 7365 6c66 2e77 7269 7465 5f69 6664    self.write_ifd
-000085a0: 6f5f 6669 6c65 2861 6c6c 6f77 5f6d 6973  o_file(allow_mis
-000085b0: 7369 6e67 5f72 6571 7569 7265 6429 0a0a  sing_required)..
-000085c0: 0a20 2020 2064 6566 2073 6574 6946 444f  .    def setiFDO
-000085d0: 4669 6c65 4e61 6d65 2873 656c 662c 6946  FileName(self,iF
-000085e0: 444f 6669 6c65 3a73 7472 293a 0a20 2020  DOfile:str):.   
-000085f0: 2020 2020 2022 2222 2053 6574 2074 6865       """ Set the
-00008600: 2063 7572 7265 6e74 2069 4644 4f20 6669   current iFDO fi
-00008610: 6c65 206e 616d 6520 7769 7468 2070 6174  le name with pat
-00008620: 682e 2053 6574 2074 6f20 2222 2069 6e20  h. Set to "" in 
-00008630: 6f72 6465 7220 746f 2067 6574 2064 6566  order to get def
-00008640: 6175 6c74 206e 616d 6520 616e 6420 6c6f  ault name and lo
-00008650: 6361 7469 6f6e 2e20 2222 220a 2020 2020  cation. """.    
-00008660: 2020 2020 7365 6c66 2e69 4644 4f66 696c      self.iFDOfil
-00008670: 655f 203d 2069 4644 4f66 696c 650a 2020  e_ = iFDOfile.  
-00008680: 2020 2020 2020 7365 6c66 2e69 4644 4f66        self.iFDOf
-00008690: 696c 655f 203d 2073 656c 662e 6765 7469  ile_ = self.geti
-000086a0: 4644 4f46 696c 654e 616d 6528 2920 2320  FDOFileName() # 
-000086b0: 636f 6e73 7472 7563 7420 6465 6661 756c  construct defaul
-000086c0: 7420 6e61 6d65 2069 6620 656d 7074 790a  t name if empty.
-000086d0: 2020 2020 2020 2020 6966 206d 6971 7463          if miqtc
-000086e0: 2e61 7373 6572 7453 6c61 7368 286f 732e  .assertSlash(os.
-000086f0: 7061 7468 2e64 6972 6e61 6d65 2873 656c  path.dirname(sel
-00008700: 662e 6946 444f 6669 6c65 5f29 2920 213d  f.iFDOfile_)) !=
-00008710: 206d 6971 7463 2e61 7373 6572 7453 6c61   miqtc.assertSla
-00008720: 7368 2873 656c 662e 6469 722e 746f 2873  sh(self.dir.to(s
-00008730: 656c 662e 6469 722e 6474 2e70 726f 6475  elf.dir.dt.produ
-00008740: 6374 7329 293a 0a20 2020 2020 2020 2020  cts)):.         
-00008750: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00008760: 2822 4361 7574 696f 6e21 2069 4644 4f20  ("Caution! iFDO 
-00008770: 6669 6c65 2070 6174 6820 6973 206e 6f74  file path is not
-00008780: 2069 6e20 2770 726f 6475 6374 7327 2073   in 'products' s
-00008790: 7562 2066 6f6c 6465 7220 6173 2072 6563  ub folder as rec
-000087a0: 6f6d 6d65 6e64 6564 2e20 436f 6e73 6964  ommended. Consid
-000087b0: 6572 2072 6573 6574 7469 6e67 2077 6974  er resetting wit
-000087c0: 6820 7365 7469 4644 4f46 696c 654e 616d  h setiFDOFileNam
-000087d0: 6528 292e 2022 202b 2069 4644 4f66 696c  e(). " + iFDOfil
-000087e0: 6529 0a20 2020 2020 2020 2074 7279 3a0a  e).        try:.
-000087f0: 2020 2020 2020 2020 2020 2020 6576 656e              even
-00008800: 7420 3d20 7365 6c66 2e66 696e 6454 6d70  t = self.findTmp
-00008810: 4669 656c 6428 2769 6d61 6765 2d65 7665  Field('image-eve
-00008820: 6e74 2729 5b27 6e61 6d65 275d 0a20 2020  nt')['name'].   
-00008830: 2020 2020 2020 2020 2073 656e 736f 7220           sensor 
-00008840: 3d20 7365 6c66 2e66 696e 6454 6d70 4669  = self.findTmpFi
-00008850: 656c 6428 2769 6d61 6765 2d73 656e 736f  eld('image-senso
-00008860: 7227 295b 276e 616d 6527 5d0a 2020 2020  r')['name'].    
-00008870: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
-00008880: 2e49 6664 6f45 7863 6570 7469 6f6e 3a0a  .IfdoException:.
-00008890: 2020 2020 2020 2020 2020 2020 6576 656e              even
-000088a0: 7420 3d20 7365 6c66 2e64 6972 2e65 7665  t = self.dir.eve
-000088b0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
-000088c0: 2073 656e 736f 7220 3d20 7365 6c66 2e64   sensor = self.d
-000088d0: 6972 2e73 656e 736f 7228 290a 0a20 2020  ir.sensor()..   
-000088e0: 2020 2020 2069 4644 4f66 696c 654e 616d       iFDOfileNam
-000088f0: 6520 3d20 6f73 2e70 6174 682e 6261 7365  e = os.path.base
-00008900: 6e61 6d65 2873 656c 662e 6946 444f 6669  name(self.iFDOfi
-00008910: 6c65 5f29 0a20 2020 2020 2020 2069 6620  le_).        if 
-00008920: 6e6f 7420 6576 656e 7420 696e 2069 4644  not event in iFD
-00008930: 4f66 696c 654e 616d 6520 6f72 206e 6f74  OfileName or not
-00008940: 2069 4644 4f2e 6765 7453 686f 7274 4571   iFDO.getShortEq
-00008950: 7569 706d 656e 7449 4428 7365 6e73 6f72  uipmentID(sensor
-00008960: 2920 696e 2069 4644 4f66 696c 654e 616d  ) in iFDOfileNam
-00008970: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
-00008980: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-00008990: 7574 696f 6e21 2069 4644 4f20 6669 6c65  ution! iFDO file
-000089a0: 206e 616d 6520 646f 6573 206e 6f74 2063   name does not c
-000089b0: 6f6e 7461 696e 2070 726f 6a65 6374 2c20  ontain project, 
-000089c0: 6576 656e 7420 616e 6420 7365 6e73 6f72  event and sensor
-000089d0: 206e 616d 6520 6173 2072 6563 6f6d 6d65   name as recomme
-000089e0: 6e64 6564 2e20 436f 6e73 6964 6572 2072  nded. Consider r
-000089f0: 6573 6574 7469 6e67 2077 6974 6820 7365  esetting with se
-00008a00: 7469 4644 4f46 696c 654e 616d 6528 292e  tiFDOFileName().
-00008a10: 2022 202b 2069 4644 4f66 696c 6529 0a0a   " + iFDOfile)..
-00008a20: 0a20 2020 2064 6566 2067 6574 6946 444f  .    def getiFDO
-00008a30: 4669 6c65 4e61 6d65 2873 656c 662c 6f76  FileName(self,ov
-00008a40: 6572 7772 6974 653d 4661 6c73 6529 3a0a  erwrite=False):.
-00008a50: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
-00008a60: 726e 7320 7468 6520 6375 7272 656e 7420  rns the current 
-00008a70: 6946 444f 2066 696c 6527 7320 6e61 6d65  iFDO file's name
-00008a80: 2077 6974 6820 7061 7468 2e20 4966 206e   with path. If n
-00008a90: 6f74 2073 6574 2079 6574 206f 7220 6f76  ot set yet or ov
-00008aa0: 6572 7772 6974 653d 3d54 7275 6520 6974  erwrite==True it
-00008ab0: 2072 6574 7572 6e73 2074 6865 206f 6e65   returns the one
-00008ac0: 206d 6174 6368 696e 6720 696d 6167 652d   matching image-
-00008ad0: 7365 742d 6e61 6d65 2e20 2222 220a 2020  set-name. """.  
-00008ae0: 2020 2020 2020 6966 2073 656c 662e 6946        if self.iF
-00008af0: 444f 6669 6c65 5f20 3d3d 2022 2220 6f72  DOfile_ == "" or
-00008b00: 206f 7665 7277 7269 7465 3a0a 2020 2020   overwrite:.    
-00008b10: 2020 2020 2020 2020 6669 6c65 5f6e 616d          file_nam
-00008b20: 6520 3d20 7365 6c66 2e66 696e 6454 6d70  e = self.findTmp
-00008b30: 4669 656c 6428 2769 6d61 6765 2d73 6574  Field('image-set
-00008b40: 2d6e 616d 6527 2920 2b20 275f 6946 444f  -name') + '_iFDO
-00008b50: 2e6a 736f 6e27 0a20 2020 2020 2020 2020  .json'.         
-00008b60: 2020 2069 6620 7365 6c66 2e69 4644 4f66     if self.iFDOf
-00008b70: 696c 655f 2021 3d20 2222 3a0a 2020 2020  ile_ != "":.    
-00008b80: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-00008b90: 6e61 6d65 2066 696c 6520 6275 7420 6b65  name file but ke
-00008ba0: 6570 206c 6f63 6174 696f 6e0a 2020 2020  ep location.    
-00008bb0: 2020 2020 2020 2020 2020 2020 6966 2066              if f
-00008bc0: 696c 655f 6e61 6d65 2021 3d20 6f73 2e70  ile_name != os.p
-00008bd0: 6174 682e 6261 7365 6e61 6d65 2873 656c  ath.basename(sel
-00008be0: 662e 6946 444f 6669 6c65 5f29 2061 6e64  f.iFDOfile_) and
-00008bf0: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00008c00: 7365 6c66 2e69 4644 4f66 696c 655f 293a  self.iFDOfile_):
-00008c10: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c20: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-00008c30: 6f67 2822 4361 7574 696f 6e21 2069 6664  og("Caution! ifd
-00008c40: 6f20 6669 6c65 2072 656e 616d 6564 2074  o file renamed t
-00008c50: 6f20 2220 2b20 6669 6c65 5f6e 616d 6529  o " + file_name)
-00008c60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00008c70: 2073 656c 662e 6946 444f 6669 6c65 5f20   self.iFDOfile_ 
-00008c80: 3d20 6f73 2e70 6174 682e 6a6f 696e 286f  = os.path.join(o
-00008c90: 732e 7061 7468 2e64 6972 6e61 6d65 2873  s.path.dirname(s
-00008ca0: 656c 662e 6946 444f 6669 6c65 5f29 2c66  elf.iFDOfile_),f
-00008cb0: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-00008cc0: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00008cd0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00008ce0: 2e69 4644 4f66 696c 655f 203d 206f 732e  .iFDOfile_ = os.
-00008cf0: 7061 7468 2e6a 6f69 6e28 7365 6c66 2e64  path.join(self.d
-00008d00: 6972 2e74 6f28 7365 6c66 2e64 6972 2e64  ir.to(self.dir.d
-00008d10: 742e 7072 6f64 7563 7473 292c 2066 696c  t.products), fil
-00008d20: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
-00008d30: 7265 7475 726e 2073 656c 662e 6946 444f  return self.iFDO
-00008d40: 6669 6c65 5f0a 0a0a 2020 2020 6465 6620  file_...    def 
-00008d50: 7365 745f 696d 6167 655f 7365 745f 6e61  set_image_set_na
-00008d60: 6d65 5f66 6965 6c64 5f66 726f 6d5f 7072  me_field_from_pr
-00008d70: 6f6a 6563 745f 6576 656e 745f 7365 6e73  oject_event_sens
-00008d80: 6f72 2873 656c 6629 3a0a 2020 2020 2020  or(self):.      
-00008d90: 2020 2222 2220 5365 7473 2066 6965 6c64    """ Sets field
-00008da0: 2069 6d61 6765 2d73 6574 2d6e 616d 6520   image-set-name 
-00008db0: 6672 6f6d 2063 7572 7265 6e74 2074 6d70  from current tmp
-00008dc0: 2066 6965 6c64 7320 666f 7220 7072 6f6a   fields for proj
-00008dd0: 6563 742c 2065 7665 6e74 2061 6e64 2073  ect, event and s
-00008de0: 656e 736f 722e 200a 2020 2020 2020 2020  ensor. .        
-00008df0: 5265 7475 726e 7320 696d 6167 652d 7365  Returns image-se
-00008e00: 742d 6e61 6d65 2076 616c 7565 2e20 2222  t-name value. ""
-00008e10: 220a 2020 2020 2020 2020 6e65 775f 696d  ".        new_im
-00008e20: 6167 655f 7365 745f 6e61 6d65 203d 2073  age_set_name = s
-00008e30: 656c 662e 636f 6e73 7472 7563 7449 6d61  elf.constructIma
-00008e40: 6765 5365 744e 616d 6528 7365 6c66 2e69  geSetName(self.i
-00008e50: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00008e60: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
-00008e70: 2769 6d61 6765 2d70 726f 6a65 6374 275d  'image-project']
-00008e80: 5b27 6e61 6d65 275d 2c0a 2020 2020 2020  ['name'],.      
-00008e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00007ea0: 6578 6365 7074 206d 6971 7463 2e49 6664  except miqtc.Ifd
+00007eb0: 6f45 7863 6570 7469 6f6e 2061 7320 6578  oException as ex
+00007ec0: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+00007ed0: 6c66 2e70 726f 762e 6c6f 6728 224c 6f61  lf.prov.log("Loa
+00007ee0: 6465 6420 6946 444f 2066 696c 6520 6e6f  ded iFDO file no
+00007ef0: 7420 7661 6c69 6420 7965 743a 2022 202b  t valid yet: " +
+00007f00: 2073 7472 2865 7829 290a 0a20 2020 2020   str(ex))..     
+00007f10: 2020 2072 6574 7572 6e20 5472 7565 0a0a     return True..
+00007f20: 0a20 2020 2064 6566 2077 7269 7465 5f69  .    def write_i
+00007f30: 6664 6f5f 6669 6c65 2873 656c 662c 616c  fdo_file(self,al
+00007f40: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
+00007f50: 6972 6564 3d46 616c 7365 293a 0a20 2020  ired=False):.   
+00007f60: 2020 2020 2022 2222 2057 7269 7465 7320       """ Writes 
+00007f70: 616e 2069 4644 4f20 6669 6c65 2074 6f20  an iFDO file to 
+00007f80: 6469 736b 2e20 4f76 6572 7772 6974 6573  disk. Overwrites
+00007f90: 2070 6f74 656e 7469 616c 6c79 2065 7869   potentially exi
+00007fa0: 7374 696e 6720 6669 6c65 2e22 2222 0a0a  sting file."""..
+00007fb0: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
+00007fc0: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
+00007fd0: 6728 2257 7269 7469 6e67 2069 4644 4f20  g("Writing iFDO 
+00007fe0: 6669 6c65 2229 0a0a 2020 2020 2020 2020  file")..        
+00007ff0: 2320 6368 6563 6b20 6669 656c 6473 2061  # check fields a
+00008000: 6761 696e 2069 6620 6368 616e 6765 6420  gain if changed 
+00008010: 7369 6e63 6520 6c61 7374 2063 6865 636b  since last check
+00008020: 2028 6372 6561 7465 6946 444f 290a 2020   (createiFDO).  
+00008030: 2020 2020 2020 6966 2073 656c 662e 6966        if self.if
+00008040: 646f 5f74 6d70 2021 3d20 7365 6c66 2e69  do_tmp != self.i
+00008050: 6664 6f5f 6368 6563 6b65 643a 0a20 2020  fdo_checked:.   
+00008060: 2020 2020 2020 2020 2073 656c 662e 6372           self.cr
+00008070: 6561 7465 6946 444f 2873 656c 662e 6966  eateiFDO(self.if
+00008080: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+00008090: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
+000080a0: 6d69 7174 692e 6372 6561 7465 496d 6167  miqti.createImag
+000080b0: 6549 7465 6d73 4c69 7374 4672 6f6d 496d  eItemsListFromIm
+000080c0: 6167 6549 7465 6d73 4469 6374 2873 656c  ageItemsDict(sel
+000080d0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
+000080e0: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
+000080f0: 5d29 2c0a 2020 2020 2020 2020 2020 2020  ]),.            
+00008100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008110: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
+00008120: 7175 6972 6564 3d61 6c6c 6f77 5f6d 6973  quired=allow_mis
+00008130: 7369 6e67 5f72 6571 7569 7265 6429 0a20  sing_required). 
+00008140: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00008150: 2320 6164 6420 2224 7363 6865 6d61 220a  # add "$schema".
+00008160: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00008170: 6f5f 6368 6563 6b65 645b 2224 7363 6865  o_checked["$sche
+00008180: 6d61 225d 203d 206d 6971 7476 2e69 6664  ma"] = miqtv.ifd
+00008190: 6f5f 7363 6865 6d61 5b27 2469 6427 5d0a  o_schema['$id'].
+000081a0: 2020 2020 2020 2020 0a20 2020 2020 2020          .       
+000081b0: 2069 4644 4f5f 7061 7468 203d 2073 656c   iFDO_path = sel
+000081c0: 662e 6765 7469 4644 4f46 696c 654e 616d  f.getiFDOFileNam
+000081d0: 6528 6f76 6572 7772 6974 653d 5472 7565  e(overwrite=True
+000081e0: 290a 0a20 2020 2020 2020 2023 2070 7574  )..        # put
+000081f0: 7320 6576 6572 7974 6869 6e67 2069 6e20  s everything in 
+00008200: 6f6e 6520 6c69 6e65 0a20 2020 2020 2020  one line.       
+00008210: 2023 7769 7468 206f 7065 6e28 6946 444f   #with open(iFDO
+00008220: 5f70 6174 682e 7265 706c 6163 6528 2279  _path.replace("y
+00008230: 616d 6c22 2c22 6a73 6f6e 2229 2c20 2777  aml","json"), 'w
+00008240: 2729 2061 7320 6670 3a0a 2020 2020 2020  ') as fp:.      
+00008250: 2020 2320 2020 206a 736f 6e2e 6475 6d70    #    json.dump
+00008260: 2873 656c 662e 6966 646f 5f63 6865 636b  (self.ifdo_check
+00008270: 6564 2c20 6670 290a 0a20 2020 2020 2020  ed, fp)..       
+00008280: 2023 2063 6f6e 7665 7274 2064 6963 7469   # convert dicti
+00008290: 6f6e 6172 7920 746f 204a 534f 4e20 7374  onary to JSON st
+000082a0: 7269 6e67 0a20 2020 2020 2020 206a 736f  ring.        jso
+000082b0: 6e5f 6461 7461 203d 206a 736f 6e2e 6475  n_data = json.du
+000082c0: 6d70 7328 7365 6c66 2e69 6664 6f5f 6368  mps(self.ifdo_ch
+000082d0: 6563 6b65 642c 2069 6e64 656e 7420 3d20  ecked, indent = 
+000082e0: 342c 2073 6f72 745f 6b65 7973 3d54 7275  4, sort_keys=Tru
+000082f0: 6529 0a0a 2020 2020 2020 2020 2320 7772  e)..        # wr
+00008300: 6974 6520 7468 6520 4a53 4f4e 2073 7472  ite the JSON str
+00008310: 696e 6720 746f 2061 2066 696c 650a 2020  ing to a file.  
+00008320: 2020 2020 2020 7769 7468 206f 7065 6e28        with open(
+00008330: 6946 444f 5f70 6174 682c 2027 7727 2920  iFDO_path, 'w') 
+00008340: 6173 2066 3a0a 2020 2020 2020 2020 2020  as f:.          
+00008350: 2020 662e 7772 6974 6528 6a73 6f6e 5f64    f.write(json_d
+00008360: 6174 6129 0a20 2020 2020 2020 200a 2020  ata).        .  
+00008370: 2020 2020 2020 2320 6c6f 6720 6368 616e        # log chan
+00008380: 6765 730a 2020 2020 2020 2020 6966 206e  ges.        if n
+00008390: 6f74 2073 656c 662e 6966 646f 5f70 6172  ot self.ifdo_par
+000083a0: 7365 6420 6973 204e 6f6e 653a 0a20 2020  sed is None:.   
+000083b0: 2020 2020 2020 2020 2069 6664 6f5f 7570           ifdo_up
+000083c0: 6461 7465 203d 2044 6565 7044 6966 6628  date = DeepDiff(
+000083d0: 7365 6c66 2e69 6664 6f5f 7061 7273 6564  self.ifdo_parsed
+000083e0: 2c73 656c 662e 6966 646f 5f63 6865 636b  ,self.ifdo_check
+000083f0: 6564 290a 2020 2020 2020 2020 2020 2020  ed).            
+00008400: 2370 7072 696e 7428 6966 646f 5f75 7064  #pprint(ifdo_upd
+00008410: 6174 6529 0a20 2020 2020 2020 2020 2020  ate).           
+00008420: 2069 6620 6966 646f 5f75 7064 6174 6520   if ifdo_update 
+00008430: 213d 207b 7d3a 0a20 2020 2020 2020 2020  != {}:.         
+00008440: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00008450: 2e6c 6f67 2822 6946 444f 2075 7064 6174  .log("iFDO updat
+00008460: 6564 2229 0a20 2020 2020 2020 2020 2020  ed").           
+00008470: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00008480: 6f67 2873 7472 2869 6664 6f5f 7570 6461  og(str(ifdo_upda
+00008490: 7465 292c 646f 6e74 5368 6f77 3d54 7275  te),dontShow=Tru
+000084a0: 6529 0a20 2020 2020 2020 2073 656c 662e  e).        self.
+000084b0: 7072 6f76 2e6c 6f67 2822 5772 6f74 6520  prov.log("Wrote 
+000084c0: 6946 444f 2074 6f20 6669 6c65 2022 202b  iFDO to file " +
+000084d0: 2069 4644 4f5f 7061 7468 290a 2020 2020   iFDO_path).    
+000084e0: 2020 2020 7365 6c66 2e70 726f 762e 7772      self.prov.wr
+000084f0: 6974 6528 7365 6c66 2e64 6972 2e74 6f28  ite(self.dir.to(
+00008500: 7365 6c66 2e64 6972 2e64 742e 7072 6f74  self.dir.dt.prot
+00008510: 6f63 6f6c 2929 0a20 2020 2020 2020 2073  ocol)).        s
+00008520: 2e73 746f 7028 290a 0a20 2020 2064 6566  .stop()..    def
+00008530: 2077 7269 7465 6946 444f 6669 6c65 2873   writeiFDOfile(s
+00008540: 656c 662c 616c 6c6f 775f 6d69 7373 696e  elf,allow_missin
+00008550: 675f 7265 7175 6972 6564 3d46 616c 7365  g_required=False
+00008560: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
+00008570: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
+00008580: 7772 6974 655f 6966 646f 5f66 696c 6520  write_ifdo_file 
+00008590: 2222 220a 2020 2020 2020 2020 7365 6c66  """.        self
+000085a0: 2e77 7269 7465 5f69 6664 6f5f 6669 6c65  .write_ifdo_file
+000085b0: 2861 6c6c 6f77 5f6d 6973 7369 6e67 5f72  (allow_missing_r
+000085c0: 6571 7569 7265 6429 0a0a 0a20 2020 2064  equired)...    d
+000085d0: 6566 2073 6574 6946 444f 4669 6c65 4e61  ef setiFDOFileNa
+000085e0: 6d65 2873 656c 662c 6946 444f 6669 6c65  me(self,iFDOfile
+000085f0: 3a73 7472 293a 0a20 2020 2020 2020 2022  :str):.        "
+00008600: 2222 2053 6574 2074 6865 2063 7572 7265  "" Set the curre
+00008610: 6e74 2069 4644 4f20 6669 6c65 206e 616d  nt iFDO file nam
+00008620: 6520 7769 7468 2070 6174 682e 2053 6574  e with path. Set
+00008630: 2074 6f20 2222 2069 6e20 6f72 6465 7220   to "" in order 
+00008640: 746f 2067 6574 2064 6566 6175 6c74 206e  to get default n
+00008650: 616d 6520 616e 6420 6c6f 6361 7469 6f6e  ame and location
+00008660: 2e20 2222 220a 2020 2020 2020 2020 7365  . """.        se
+00008670: 6c66 2e69 4644 4f66 696c 655f 203d 2069  lf.iFDOfile_ = i
+00008680: 4644 4f66 696c 650a 2020 2020 2020 2020  FDOfile.        
+00008690: 7365 6c66 2e69 4644 4f66 696c 655f 203d  self.iFDOfile_ =
+000086a0: 2073 656c 662e 6765 7469 4644 4f46 696c   self.getiFDOFil
+000086b0: 654e 616d 6528 2920 2320 636f 6e73 7472  eName() # constr
+000086c0: 7563 7420 6465 6661 756c 7420 6e61 6d65  uct default name
+000086d0: 2069 6620 656d 7074 790a 2020 2020 2020   if empty.      
+000086e0: 2020 6966 206d 6971 7463 2e61 7373 6572    if miqtc.asser
+000086f0: 7453 6c61 7368 286f 732e 7061 7468 2e64  tSlash(os.path.d
+00008700: 6972 6e61 6d65 2873 656c 662e 6946 444f  irname(self.iFDO
+00008710: 6669 6c65 5f29 2920 213d 206d 6971 7463  file_)) != miqtc
+00008720: 2e61 7373 6572 7453 6c61 7368 2873 656c  .assertSlash(sel
+00008730: 662e 6469 722e 746f 2873 656c 662e 6469  f.dir.to(self.di
+00008740: 722e 6474 2e70 726f 6475 6374 7329 293a  r.dt.products)):
+00008750: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00008760: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
+00008770: 696f 6e21 2069 4644 4f20 6669 6c65 2070  ion! iFDO file p
+00008780: 6174 6820 6973 206e 6f74 2069 6e20 2770  ath is not in 'p
+00008790: 726f 6475 6374 7327 2073 7562 2066 6f6c  roducts' sub fol
+000087a0: 6465 7220 6173 2072 6563 6f6d 6d65 6e64  der as recommend
+000087b0: 6564 2e20 436f 6e73 6964 6572 2072 6573  ed. Consider res
+000087c0: 6574 7469 6e67 2077 6974 6820 7365 7469  etting with seti
+000087d0: 4644 4f46 696c 654e 616d 6528 292e 2022  FDOFileName(). "
+000087e0: 202b 2069 4644 4f66 696c 6529 0a20 2020   + iFDOfile).   
+000087f0: 2020 2020 2074 7279 3a0a 2020 2020 2020       try:.      
+00008800: 2020 2020 2020 6576 656e 7420 3d20 7365        event = se
+00008810: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+00008820: 2769 6d61 6765 2d65 7665 6e74 2729 5b27  'image-event')['
+00008830: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
+00008840: 2020 2073 656e 736f 7220 3d20 7365 6c66     sensor = self
+00008850: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
+00008860: 6d61 6765 2d73 656e 736f 7227 295b 276e  mage-sensor')['n
+00008870: 616d 6527 5d0a 2020 2020 2020 2020 6578  ame'].        ex
+00008880: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+00008890: 7863 6570 7469 6f6e 3a0a 2020 2020 2020  xception:.      
+000088a0: 2020 2020 2020 6576 656e 7420 3d20 7365        event = se
+000088b0: 6c66 2e64 6972 2e65 7665 6e74 2829 0a20  lf.dir.event(). 
+000088c0: 2020 2020 2020 2020 2020 2073 656e 736f             senso
+000088d0: 7220 3d20 7365 6c66 2e64 6972 2e73 656e  r = self.dir.sen
+000088e0: 736f 7228 290a 0a20 2020 2020 2020 2069  sor()..        i
+000088f0: 4644 4f66 696c 654e 616d 6520 3d20 6f73  FDOfileName = os
+00008900: 2e70 6174 682e 6261 7365 6e61 6d65 2873  .path.basename(s
+00008910: 656c 662e 6946 444f 6669 6c65 5f29 0a20  elf.iFDOfile_). 
+00008920: 2020 2020 2020 2069 6620 6e6f 7420 6576         if not ev
+00008930: 656e 7420 696e 2069 4644 4f66 696c 654e  ent in iFDOfileN
+00008940: 616d 6520 6f72 206e 6f74 2069 4644 4f2e  ame or not iFDO.
+00008950: 6765 7453 686f 7274 4571 7569 706d 656e  getShortEquipmen
+00008960: 7449 4428 7365 6e73 6f72 2920 696e 2069  tID(sensor) in i
+00008970: 4644 4f66 696c 654e 616d 653a 0a20 2020  FDOfileName:.   
+00008980: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00008990: 6f76 2e6c 6f67 2822 4361 7574 696f 6e21  ov.log("Caution!
+000089a0: 2069 4644 4f20 6669 6c65 206e 616d 6520   iFDO file name 
+000089b0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+000089c0: 2070 726f 6a65 6374 2c20 6576 656e 7420   project, event 
+000089d0: 616e 6420 7365 6e73 6f72 206e 616d 6520  and sensor name 
+000089e0: 6173 2072 6563 6f6d 6d65 6e64 6564 2e20  as recommended. 
+000089f0: 436f 6e73 6964 6572 2072 6573 6574 7469  Consider resetti
+00008a00: 6e67 2077 6974 6820 7365 7469 4644 4f46  ng with setiFDOF
+00008a10: 696c 654e 616d 6528 292e 2022 202b 2069  ileName(). " + i
+00008a20: 4644 4f66 696c 6529 0a0a 0a20 2020 2064  FDOfile)...    d
+00008a30: 6566 2067 6574 6946 444f 4669 6c65 4e61  ef getiFDOFileNa
+00008a40: 6d65 2873 656c 662c 6f76 6572 7772 6974  me(self,overwrit
+00008a50: 653d 4661 6c73 6529 3a0a 2020 2020 2020  e=False):.      
+00008a60: 2020 2222 2220 5265 7475 726e 7320 7468    """ Returns th
+00008a70: 6520 6375 7272 656e 7420 6946 444f 2066  e current iFDO f
+00008a80: 696c 6527 7320 6e61 6d65 2077 6974 6820  ile's name with 
+00008a90: 7061 7468 2e20 4966 206e 6f74 2073 6574  path. If not set
+00008aa0: 2079 6574 206f 7220 6f76 6572 7772 6974   yet or overwrit
+00008ab0: 653d 3d54 7275 6520 6974 2072 6574 7572  e==True it retur
+00008ac0: 6e73 2074 6865 206f 6e65 206d 6174 6368  ns the one match
+00008ad0: 696e 6720 696d 6167 652d 7365 742d 6e61  ing image-set-na
+00008ae0: 6d65 2e20 2222 220a 2020 2020 2020 2020  me. """.        
+00008af0: 6966 2073 656c 662e 6946 444f 6669 6c65  if self.iFDOfile
+00008b00: 5f20 3d3d 2022 2220 6f72 206f 7665 7277  _ == "" or overw
+00008b10: 7269 7465 3a0a 2020 2020 2020 2020 2020  rite:.          
+00008b20: 2020 6669 6c65 5f6e 616d 6520 3d20 7365    file_name = se
+00008b30: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+00008b40: 2769 6d61 6765 2d73 6574 2d6e 616d 6527  'image-set-name'
+00008b50: 2920 2b20 275f 6946 444f 2e6a 736f 6e27  ) + '_iFDO.json'
+00008b60: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00008b70: 7365 6c66 2e69 4644 4f66 696c 655f 2021  self.iFDOfile_ !
+00008b80: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+00008b90: 2020 2020 2020 2320 7265 6e61 6d65 2066        # rename f
+00008ba0: 696c 6520 6275 7420 6b65 6570 206c 6f63  ile but keep loc
+00008bb0: 6174 696f 6e0a 2020 2020 2020 2020 2020  ation.          
+00008bc0: 2020 2020 2020 6966 2066 696c 655f 6e61        if file_na
+00008bd0: 6d65 2021 3d20 6f73 2e70 6174 682e 6261  me != os.path.ba
+00008be0: 7365 6e61 6d65 2873 656c 662e 6946 444f  sename(self.iFDO
+00008bf0: 6669 6c65 5f29 2061 6e64 206f 732e 7061  file_) and os.pa
+00008c00: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
+00008c10: 4644 4f66 696c 655f 293a 0a20 2020 2020  FDOfile_):.     
+00008c20: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+00008c30: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+00008c40: 7574 696f 6e21 2069 6664 6f20 6669 6c65  ution! ifdo file
+00008c50: 2072 656e 616d 6564 2074 6f20 2220 2b20   renamed to " + 
+00008c60: 6669 6c65 5f6e 616d 6529 0a20 2020 2020  file_name).     
+00008c70: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00008c80: 6946 444f 6669 6c65 5f20 3d20 6f73 2e70  iFDOfile_ = os.p
+00008c90: 6174 682e 6a6f 696e 286f 732e 7061 7468  ath.join(os.path
+00008ca0: 2e64 6972 6e61 6d65 2873 656c 662e 6946  .dirname(self.iF
+00008cb0: 444f 6669 6c65 5f29 2c66 696c 655f 6e61  DOfile_),file_na
+00008cc0: 6d65 290a 2020 2020 2020 2020 2020 2020  me).            
+00008cd0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00008ce0: 2020 2020 2020 7365 6c66 2e69 4644 4f66        self.iFDOf
+00008cf0: 696c 655f 203d 206f 732e 7061 7468 2e6a  ile_ = os.path.j
+00008d00: 6f69 6e28 7365 6c66 2e64 6972 2e74 6f28  oin(self.dir.to(
+00008d10: 7365 6c66 2e64 6972 2e64 742e 7072 6f64  self.dir.dt.prod
+00008d20: 7563 7473 292c 2066 696c 655f 6e61 6d65  ucts), file_name
+00008d30: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+00008d40: 2073 656c 662e 6946 444f 6669 6c65 5f0a   self.iFDOfile_.
+00008d50: 0a0a 2020 2020 6465 6620 7365 745f 696d  ..    def set_im
+00008d60: 6167 655f 7365 745f 6e61 6d65 5f66 6965  age_set_name_fie
+00008d70: 6c64 5f66 726f 6d5f 7072 6f6a 6563 745f  ld_from_project_
+00008d80: 6576 656e 745f 7365 6e73 6f72 2873 656c  event_sensor(sel
+00008d90: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+00008da0: 5365 7473 2066 6965 6c64 2069 6d61 6765  Sets field image
+00008db0: 2d73 6574 2d6e 616d 6520 6672 6f6d 2063  -set-name from c
+00008dc0: 7572 7265 6e74 2074 6d70 2066 6965 6c64  urrent tmp field
+00008dd0: 7320 666f 7220 7072 6f6a 6563 742c 2065  s for project, e
+00008de0: 7665 6e74 2061 6e64 2073 656e 736f 722e  vent and sensor.
+00008df0: 200a 2020 2020 2020 2020 5265 7475 726e   .        Return
+00008e00: 7320 696d 6167 652d 7365 742d 6e61 6d65  s image-set-name
+00008e10: 2076 616c 7565 2e20 2222 220a 2020 2020   value. """.    
+00008e20: 2020 2020 6e65 775f 696d 6167 655f 7365      new_image_se
+00008e30: 745f 6e61 6d65 203d 2073 656c 662e 636f  t_name = self.co
+00008e40: 6e73 7472 7563 7449 6d61 6765 5365 744e  nstructImageSetN
+00008e50: 616d 6528 7365 6c66 2e69 6664 6f5f 746d  ame(self.ifdo_tm
+00008e60: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+00008e70: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
+00008e80: 2d70 726f 6a65 6374 275d 5b27 6e61 6d65  -project']['name
+00008e90: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
 00008ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008eb0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-00008ec0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00008ed0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-00008ee0: 6579 5d5b 2769 6d61 6765 2d65 7665 6e74  ey]['image-event
-00008ef0: 275d 5b27 6e61 6d65 275d 2c0a 2020 2020  ']['name'],.    
-00008f00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008eb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00008ec0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+00008ed0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00008ee0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+00008ef0: 6d61 6765 2d65 7665 6e74 275d 5b27 6e61  mage-event']['na
+00008f00: 6d65 275d 2c0a 2020 2020 2020 2020 2020  me'],.          
 00008f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00008f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00008f30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00008f40: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-00008f50: 724b 6579 5d5b 2769 6d61 6765 2d73 656e  rKey]['image-sen
-00008f60: 736f 7227 5d5b 276e 616d 6527 5d29 0a20  sor']['name']). 
-00008f70: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-00008f80: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-00008f90: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
-00008fa0: 6167 652d 7365 742d 6e61 6d65 275d 203d  age-set-name'] =
-00008fb0: 206e 6577 5f69 6d61 6765 5f73 6574 5f6e   new_image_set_n
-00008fc0: 616d 650a 2020 2020 2020 2020 7265 7475  ame.        retu
-00008fd0: 726e 206e 6577 5f69 6d61 6765 5f73 6574  rn new_image_set
-00008fe0: 5f6e 616d 650a 2020 2020 2020 2020 0a0a  _name.        ..
-00008ff0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-00009000: 640a 2020 2020 6465 6620 636f 6e73 7472  d.    def constr
-00009010: 7563 7449 6d61 6765 5365 744e 616d 6528  uctImageSetName(
-00009020: 7072 6f6a 6563 743a 7374 722c 6576 656e  project:str,even
-00009030: 743a 7374 722c 7365 6e73 6f72 3a73 7472  t:str,sensor:str
-00009040: 293a 0a20 2020 2020 2020 2022 2222 2072  ):.        """ r
-00009050: 6574 7572 6e73 203c 7072 6f6a 6563 743e  eturns <project>
-00009060: 5f3c 6576 656e 743e 5f3c 7365 6e73 6f72  _<event>_<sensor
-00009070: 3e2c 2077 6974 6820 7368 6f72 7420 7665  >, with short ve
-00009080: 7273 696f 6e20 6f66 203c 7365 6e73 6f72  rsion of <sensor
-00009090: 3e20 286f 6e6c 7920 6964 292c 2070 7265  > (only id), pre
-000090a0: 7665 6e74 696e 6720 706f 7465 6e74 6961  venting potentia
-000090b0: 6c20 646f 7562 6c69 6e67 206f 6620 3c70  l doubling of <p
-000090c0: 726f 6a65 6374 3e20 2022 2222 0a20 2020  roject>  """.   
-000090d0: 2020 2020 2073 656e 736f 725f 7368 6f72       sensor_shor
-000090e0: 7420 3d20 6946 444f 2e67 6574 5368 6f72  t = iFDO.getShor
-000090f0: 7445 7175 6970 6d65 6e74 4944 2873 656e  tEquipmentID(sen
-00009100: 736f 7229 0a20 2020 2020 2020 2069 6620  sor).        if 
-00009110: 6c65 6e28 6576 656e 7429 203e 206c 656e  len(event) > len
-00009120: 2870 726f 6a65 6374 2920 616e 6420 6576  (project) and ev
-00009130: 656e 745b 303a 6c65 6e28 7072 6f6a 6563  ent[0:len(projec
-00009140: 7429 5d20 3d3d 2070 726f 6a65 6374 3a0a  t)] == project:.
-00009150: 2020 2020 2020 2020 2020 2020 696d 6167              imag
-00009160: 655f 7365 745f 6e61 6d65 5f20 3d20 6576  e_set_name_ = ev
-00009170: 656e 7420 2b20 225f 2220 2b20 7365 6e73  ent + "_" + sens
-00009180: 6f72 5f73 686f 7274 0a20 2020 2020 2020  or_short.       
-00009190: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-000091a0: 2020 2069 6d61 6765 5f73 6574 5f6e 616d     image_set_nam
-000091b0: 655f 203d 2070 726f 6a65 6374 202b 2022  e_ = project + "
-000091c0: 5f22 202b 2065 7665 6e74 202b 2022 5f22  _" + event + "_"
-000091d0: 202b 2073 656e 736f 725f 7368 6f72 740a   + sensor_short.
-000091e0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
-000091f0: 6d61 6765 5f73 6574 5f6e 616d 655f 2023  mage_set_name_ #
-00009200: 2054 4f44 4f20 696e 636c 7564 6520 6461   TODO include da
-00009210: 7461 5479 7065 3f0a 0a0a 2020 2020 4073  taType?...    @s
-00009220: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
-00009230: 6465 6620 6765 7453 686f 7274 4571 7569  def getShortEqui
-00009240: 706d 656e 7449 4428 6571 7569 706d 656e  pmentID(equipmen
-00009250: 7449 443a 7374 7229 3a0a 2020 2020 2020  tID:str):.      
-00009260: 2020 2222 2220 7265 7475 726e 7320 6571    """ returns eq
-00009270: 7569 706d 656e 7420 6964 2077 6974 686f  uipment id witho
-00009280: 7574 2070 6f74 656e 7469 616c 6c20 6c6f  ut potentiall lo
-00009290: 6e67 203c 6e61 6d65 3e20 7061 7274 2c20  ng <name> part, 
-000092a0: 692e 652e 3a20 3c6f 776e 6572 3e5f 3c74  i.e.: <owner>_<t
-000092b0: 7970 653e 2d3c 7479 7065 2069 6e64 6578  ype>-<type index
-000092c0: 5b5f 3c73 7562 7479 7065 3e5d 2022 2222  [_<subtype>] """
-000092d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-000092e0: 275f 272e 6a6f 696e 2865 7175 6970 6d65  '_'.join(equipme
-000092f0: 6e74 4944 2e73 706c 6974 2827 5f27 295b  ntID.split('_')[
-00009300: 303a 335d 290a 0a20 2020 2040 7374 6174  0:3])..    @stat
-00009310: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
-00009320: 2063 6f6e 7374 7275 6374 6946 444f 6669   constructiFDOfi
-00009330: 6c65 4e61 6d65 2870 726f 6a65 6374 3a73  leName(project:s
-00009340: 7472 2c65 7665 6e74 3a73 7472 2c73 656e  tr,event:str,sen
-00009350: 736f 723a 7374 7229 3a0a 2020 2020 2020  sor:str):.      
-00009360: 2020 2222 2220 7265 7475 726e 7320 3c63    """ returns <c
-00009370: 6f6e 7374 7275 6374 496d 6167 6553 6574  onstructImageSet
-00009380: 4e61 6d65 2829 3e5f 6946 444f 2e6a 736f  Name()>_iFDO.jso
-00009390: 6e20 2222 220a 2020 2020 2020 2020 7265  n """.        re
-000093a0: 7475 726e 2069 4644 4f2e 636f 6e73 7472  turn iFDO.constr
-000093b0: 7563 7449 6d61 6765 5365 744e 616d 6528  uctImageSetName(
-000093c0: 7072 6f6a 6563 742c 6576 656e 742c 7365  project,event,se
-000093d0: 6e73 6f72 2920 2b20 275f 6946 444f 2e6a  nsor) + '_iFDO.j
-000093e0: 736f 6e27 200a 0a20 2020 200a 2020 2020  son' ..    .    
-000093f0: 4073 7461 7469 636d 6574 686f 640a 2020  @staticmethod.  
-00009400: 2020 6465 6620 5f5f 6765 7446 6965 6c64    def __getField
-00009410: 5661 6c75 6528 6966 646f 3a64 6963 742c  Value(ifdo:dict,
-00009420: 6b65 7973 3a6c 6973 742c 6465 6661 756c  keys:list,defaul
-00009430: 745f 6f6e 6c79 203d 2046 616c 7365 293a  t_only = False):
-00009440: 0a20 2020 2020 2020 2022 2222 2072 6574  .        """ ret
-00009450: 7572 6e73 2063 6f70 7920 6f66 2073 6574  urns copy of set
-00009460: 206f 7220 6974 656d 2066 6965 6c64 2076   or item field v
-00009470: 616c 7565 2c20 616c 736f 2063 6f6e 7369  alue, also consi
-00009480: 6465 726e 6720 6465 6661 756c 7420 7661  derng default va
-00009490: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
-000094a0: 2e0a 2020 2020 2020 2020 2020 2020 5573  ..            Us
-000094b0: 6520 6b65 7973 2061 7320 652e 672e 205b  e keys as e.g. [
-000094c0: 3c69 7465 6d3e 2c3c 6b65 793e 2c2e 2e5d  <item>,<key>,..]
-000094d0: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
-000094e0: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
-000094f0: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
-00009500: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
-00009510: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
-00009520: 616e 2062 6520 6e65 676c 6563 7465 642c  an be neglected,
-00009530: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
-00009540: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
-00009550: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
-00009560: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
-00009570: 6e65 640a 2020 2020 2020 2020 2020 2020  ned.            
-00009580: 756e 6c65 7373 2064 6566 6175 6c74 5f6f  unless default_o
-00009590: 6e6c 7920 3d20 4661 6c73 652c 2074 6865  nly = False, the
-000095a0: 6e20 6465 6661 756c 7420 7661 6c75 6573  n default values
-000095b0: 2061 7420 696e 6465 7820 3020 6973 2072   at index 0 is r
-000095c0: 6574 7572 6e65 642e 0a20 2020 2020 2020  eturned..       
-000095d0: 2020 2020 2052 6169 7365 7320 4966 646f       Raises Ifdo
-000095e0: 4578 6365 7074 696f 6e20 6966 206b 6579  Exception if key
-000095f0: 7320 646f 206e 6f74 2065 7869 7374 2e20  s do not exist. 
-00009600: 2222 220a 0a20 2020 2020 2020 2069 6620  """..        if 
-00009610: 6e6f 7420 6d69 7174 762e 696d 6167 655f  not miqtv.image_
-00009620: 7365 745f 6974 656d 735f 6b65 7920 696e  set_items_key in
-00009630: 2069 6664 6f20 6f72 206e 6f74 206d 6971   ifdo or not miq
-00009640: 7476 2e69 6d61 6765 5f73 6574 5f68 6561  tv.image_set_hea
-00009650: 6465 725f 6b65 7920 696e 2069 6664 6f3a  der_key in ifdo:
-00009660: 0a20 2020 2020 2020 2020 2020 2072 6169  .            rai
-00009670: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-00009680: 6570 7469 6f6e 2822 496e 7661 6c69 6420  eption("Invalid 
-00009690: 6966 646f 2064 6963 742c 206d 6973 7369  ifdo dict, missi
-000096a0: 6e67 2069 7465 6d73 206f 7220 6865 6164  ng items or head
-000096b0: 6572 206b 6579 3a20 2220 2b20 7374 7228  er key: " + str(
-000096c0: 6966 646f 2929 0a20 2020 2020 2020 200a  ifdo)).        .
-000096d0: 2020 2020 2020 2020 6966 206e 6f74 2069          if not i
-000096e0: 7369 6e73 7461 6e63 6528 6b65 7973 2c6c  sinstance(keys,l
-000096f0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-00009700: 2020 6b65 7973 203d 205b 6b65 7973 5d0a    keys = [keys].
-00009710: 0a20 2020 2020 2020 2023 2072 656d 6f76  .        # remov
-00009720: 6520 6865 6164 6572 206f 7220 6974 656d  e header or item
-00009730: 2070 7265 6669 7865 7320 6966 2074 6865   prefixes if the
-00009740: 7265 0a20 2020 2020 2020 2069 6620 6b65  re.        if ke
-00009750: 7973 5b30 5d20 3d3d 206d 6971 7476 2e69  ys[0] == miqtv.i
-00009760: 6d61 6765 5f73 6574 5f69 7465 6d73 5f6b  mage_set_items_k
-00009770: 6579 206f 7220 6b65 7973 5b30 5d20 3d3d  ey or keys[0] ==
-00009780: 206d 6971 7476 2e69 6d61 6765 5f73 6574   miqtv.image_set
-00009790: 5f68 6561 6465 725f 6b65 793a 0a20 2020  _header_key:.   
-000097a0: 2020 2020 2020 2020 206b 6579 7320 3d20           keys = 
-000097b0: 6b65 7973 5b31 3a3a 5d0a 0a20 2020 2020  keys[1::]..     
-000097c0: 2020 2068 6561 6465 7220 3d20 6966 646f     header = ifdo
-000097d0: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-000097e0: 5f68 6561 6465 725f 6b65 795d 0a20 2020  _header_key].   
-000097f0: 2020 2020 2069 7465 6d73 203d 2069 6664       items = ifd
-00009800: 6f5b 6d69 7174 762e 696d 6167 655f 7365  o[miqtv.image_se
-00009810: 745f 6974 656d 735f 6b65 795d 0a20 2020  t_items_key].   
-00009820: 2020 2020 2023 206c 6f6f 6b20 666f 7220       # look for 
-00009830: 6465 6661 756c 7420 7661 6c75 650a 2020  default value.  
-00009840: 2020 2020 2020 666f 7220 736b 6970 7065        for skippe
-00009850: 6449 6e48 6561 6465 7220 696e 2072 616e  dInHeader in ran
-00009860: 6765 286c 656e 286b 6579 7329 293a 0a20  ge(len(keys)):. 
-00009870: 2020 2020 2020 2020 2020 2064 6566 6175             defau
-00009880: 6c74 5661 6c20 3d20 6669 6e64 4669 656c  ltVal = findFiel
-00009890: 6428 6865 6164 6572 2c6b 6579 735b 736b  d(header,keys[sk
-000098a0: 6970 7065 6449 6e48 6561 6465 723a 3a5d  ippedInHeader::]
-000098b0: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
-000098c0: 2064 6566 6175 6c74 5661 6c20 213d 2022   defaultVal != "
-000098d0: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
-000098e0: 2020 2062 7265 616b 0a0a 2020 2020 2020     break..      
-000098f0: 2020 2323 206c 6f6f 6b20 666f 7220 6974    ## look for it
-00009900: 656d 2076 616c 7565 0a20 2020 2020 2020  em value.       
-00009910: 2023 2068 6561 6465 7220 6f6e 6c79 2076   # header only v
-00009920: 616c 7565 2c20 646f 6e27 7420 6368 6563  alue, don't chec
-00009930: 6b20 696e 2069 7465 6d73 0a20 2020 2020  k in items.     
-00009940: 2020 2069 6620 6669 6e64 4669 656c 6428     if findField(
-00009950: 6974 656d 732c 6b65 7973 5b30 3a31 5d29  items,keys[0:1])
-00009960: 203d 3d20 2222 2061 6e64 2073 6b69 7070   == "" and skipp
-00009970: 6564 496e 4865 6164 6572 203d 3d20 303a  edInHeader == 0:
-00009980: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00009990: 203d 2064 6566 6175 6c74 5661 6c0a 2020   = defaultVal.  
-000099a0: 2020 2020 2020 2020 2020 6966 2072 6574            if ret
-000099b0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-000099c0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-000099d0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-000099e0: 6e28 226b 6579 2064 6f65 7320 6e6f 7420  n("key does not 
-000099f0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
-00009a00: 7973 2929 0a20 2020 2020 2020 2065 6c73  ys)).        els
-00009a10: 653a 0a20 2020 2020 2020 2020 2020 2023  e:.            #
-00009a20: 2069 6620 6669 7273 7420 6b65 7920 6e6f   if first key no
-00009a30: 7420 666f 756e 6420 696e 2069 7465 6d73  t found in items
-00009a40: 2c20 692e 652e 2069 7320 6e6f 7420 6120  , i.e. is not a 
-00009a50: 696d 6167 6520 6e61 6d65 2c20 616e 6420  image name, and 
-00009a60: 6669 7273 7420 6b65 7920 6973 206e 6f74  first key is not
-00009a70: 2061 2068 6561 6465 7220 6b65 793a 0a20   a header key:. 
-00009a80: 2020 2020 2020 2020 2020 2069 6620 6669             if fi
-00009a90: 6e64 4669 656c 6428 6974 656d 732c 6b65  ndField(items,ke
-00009aa0: 7973 5b30 3a31 5d29 203d 3d20 2222 2061  ys[0:1]) == "" a
-00009ab0: 6e64 2073 6b69 7070 6564 496e 4865 6164  nd skippedInHead
-00009ac0: 6572 2021 3d20 303a 0a20 2020 2020 2020  er != 0:.       
-00009ad0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00009ae0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00009af0: 6f6e 2822 6974 656d 2064 6f65 7320 6e6f  on("item does no
-00009b00: 7420 6578 6973 743a 2220 2b20 7374 7228  t exist:" + str(
-00009b10: 6b65 7973 5b30 3a31 5d29 290a 0a20 2020  keys[0:1]))..   
-00009b20: 2020 2020 2020 2020 2023 2063 6865 636b           # check
-00009b30: 2069 6620 696e 6465 7820 7072 6f76 6964   if index provid
-00009b40: 6564 0a20 2020 2020 2020 2020 2020 2069  ed.            i
-00009b50: 6e64 6578 5072 6f76 6964 6564 203d 2054  ndexProvided = T
-00009b60: 7275 650a 2020 2020 2020 2020 2020 2020  rue.            
-00009b70: 6966 206c 656e 286b 6579 7329 203e 2031  if len(keys) > 1
-00009b80: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009b90: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00009ba0: 2020 2020 2020 2020 2020 2069 6e64 6578             index
-00009bb0: 203d 2069 6e74 286b 6579 735b 315d 290a   = int(keys[1]).
-00009bc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009bd0: 6578 6365 7074 2045 7863 6570 7469 6f6e  except Exception
-00009be0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00009bf0: 2020 2020 2020 696e 6465 7850 726f 7669        indexProvi
-00009c00: 6465 6420 3d20 4661 6c73 650a 2020 2020  ded = False.    
-00009c10: 2020 2020 2020 2020 656c 6966 206c 656e          elif len
-00009c20: 286b 6579 7329 203d 3d20 313a 0a20 2020  (keys) == 1:.   
-00009c30: 2020 2020 2020 2020 2020 2020 2069 6e64               ind
-00009c40: 6578 5072 6f76 6964 6564 203d 2046 616c  exProvided = Fal
-00009c50: 7365 0a20 2020 2020 2020 2020 2020 2020  se.             
-00009c60: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00009c70: 696d 6167 6549 7465 6d54 696d 6550 6f69  imageItemTimePoi
-00009c80: 6e74 7320 3d20 6974 656d 735b 6b65 7973  nts = items[keys
-00009c90: 5b30 5d5d 0a0a 2020 2020 2020 2020 2020  [0]]..          
-00009ca0: 2020 6966 2069 6e64 6578 5072 6f76 6964    if indexProvid
-00009cb0: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00009cc0: 2020 2020 2320 6966 206b 6579 2069 7320      # if key is 
-00009cd0: 7768 6f6c 6520 696d 6167 6520 6164 6420  whole image add 
-00009ce0: 616c 6c20 7661 6c75 6573 2066 726f 6d20  all values from 
-00009cf0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-00009d00: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
-00009d10: 7973 2920 3d3d 2032 3a0a 2020 2020 2020  ys) == 2:.      
-00009d20: 2020 2020 2020 2020 2020 2020 2020 6465                de
-00009d30: 6661 756c 7456 616c 203d 2068 6561 6465  faultVal = heade
-00009d40: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
-00009d50: 2020 2320 6164 6420 6465 6661 756c 7420    # add default 
-00009d60: 6672 6f6d 2069 6e64 6578 2030 0a20 2020  from index 0.   
-00009d70: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00009d80: 6c65 6e28 6b65 7973 2920 3e20 3120 616e  len(keys) > 1 an
-00009d90: 6420 696e 6465 7820 213d 2030 3a0a 2020  d index != 0:.  
-00009da0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009db0: 2020 6b65 7973 5f30 203d 2063 6f70 792e    keys_0 = copy.
-00009dc0: 6465 6570 636f 7079 286b 6579 7329 0a20  deepcopy(keys). 
-00009dd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009de0: 2020 206b 6579 735f 305b 315d 203d 2030     keys_0[1] = 0
-00009df0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00009e00: 2020 2020 2072 6574 5f30 203d 2069 4644       ret_0 = iFD
-00009e10: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
-00009e20: 2869 7465 6d73 2c6b 6579 735f 302c 736b  (items,keys_0,sk
-00009e30: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
-00009e40: 6661 756c 7456 616c 290a 2020 2020 2020  faultVal).      
-00009e50: 2020 2020 2020 2020 2020 2020 2020 6966                if
-00009e60: 2069 7369 6e73 7461 6e63 6528 7265 745f   isinstance(ret_
-00009e70: 302c 6469 6374 293a 0a20 2020 2020 2020  0,dict):.       
-00009e80: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00009e90: 2064 6566 6175 6c74 5661 6c20 3d20 7b2a   defaultVal = {*
-00009ea0: 2a64 6566 6175 6c74 5661 6c2c 2a2a 7265  *defaultVal,**re
-00009eb0: 745f 307d 0a20 2020 2020 2020 2020 2020  t_0}.           
-00009ec0: 2020 2020 2072 6574 203d 2069 4644 4f2e       ret = iFDO.
-00009ed0: 5f5f 6765 7449 7465 6d56 616c 7565 2869  __getItemValue(i
-00009ee0: 7465 6d73 2c6b 6579 732c 736b 6970 7065  tems,keys,skippe
-00009ef0: 6449 6e48 6561 6465 722c 6465 6661 756c  dInHeader,defaul
-00009f00: 7456 616c 290a 2020 2020 2020 2020 2020  tVal).          
-00009f10: 2020 0a20 2020 2020 2020 2020 2020 2065    .            e
-00009f20: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00009f30: 2020 2020 2023 2069 6620 6b65 7920 6973       # if key is
-00009f40: 2077 686f 6c65 2069 6d61 6765 2061 6464   whole image add
-00009f50: 2061 6c6c 2076 616c 7565 7320 6672 6f6d   all values from
-00009f60: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
-00009f70: 2020 2020 2020 2020 6966 206c 656e 286b          if len(k
-00009f80: 6579 7329 203d 3d20 313a 0a20 2020 2020  eys) == 1:.     
-00009f90: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00009fa0: 6566 6175 6c74 5661 6c20 3d20 6865 6164  efaultVal = head
-00009fb0: 6572 0a0a 2020 2020 2020 2020 2020 2020  er..            
-00009fc0: 2020 2020 2320 7069 6374 7572 6520 2d3e      # picture ->
-00009fd0: 206a 7573 7420 6f6e 6520 656e 7472 792c   just one entry,
-00009fe0: 2069 6e73 6572 7420 696e 6465 7820 300a   insert index 0.
-00009ff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a000: 6966 206c 656e 2869 6d61 6765 4974 656d  if len(imageItem
-0000a010: 5469 6d65 506f 696e 7473 2920 3d3d 2031  TimePoints) == 1
-0000a020: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000a030: 2020 2020 2020 6b65 7973 203d 206b 6579        keys = key
-0000a040: 735b 303a 315d 202b 205b 305d 202b 206b  s[0:1] + [0] + k
-0000a050: 6579 735b 313a 3a5d 0a20 2020 2020 2020  eys[1::].       
-0000a060: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-0000a070: 203d 2069 4644 4f2e 5f5f 6765 7449 7465   = iFDO.__getIte
-0000a080: 6d56 616c 7565 2869 7465 6d73 2c6b 6579  mValue(items,key
-0000a090: 732c 736b 6970 7065 6449 6e48 6561 6465  s,skippedInHeade
-0000a0a0: 722c 6465 6661 756c 7456 616c 290a 2020  r,defaultVal).  
-0000a0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a0c0: 2020 0a20 2020 2020 2020 2020 2020 2020    .             
-0000a0d0: 2020 2023 2076 6964 656f 202d 3e20 7265     # video -> re
-0000a0e0: 7475 726e 2076 616c 7565 7320 666f 7220  turn values for 
-0000a0f0: 6561 6368 2074 696d 6520 7374 616d 700a  each time stamp.
-0000a100: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a110: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-0000a120: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0000a130: 7b7d 0a20 2020 2020 2020 2020 2020 2020  {}.             
-0000a140: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
-0000a150: 7261 6e67 6528 6c65 6e28 696d 6167 6549  range(len(imageI
-0000a160: 7465 6d54 696d 6550 6f69 6e74 7329 293a  temTimePoints)):
-0000a170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a180: 2020 2020 2020 2020 2074 696d 6550 6f69           timePoi
-0000a190: 6e74 4461 7461 203d 2069 6d61 6765 4974  ntData = imageIt
-0000a1a0: 656d 5469 6d65 506f 696e 7473 5b69 5d0a  emTimePoints[i].
-0000a1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a1c0: 2020 2020 2020 2020 6b65 7973 5f69 203d          keys_i =
-0000a1d0: 206b 6579 735b 303a 315d 202b 205b 695d   keys[0:1] + [i]
-0000a1e0: 202b 206b 6579 735b 313a 3a5d 0a20 2020   + keys[1::].   
-0000a1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a200: 2020 2020 2076 616c 5f69 203d 2069 4644       val_i = iFD
-0000a210: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
-0000a220: 2869 7465 6d73 2c6b 6579 735f 692c 736b  (items,keys_i,sk
-0000a230: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
-0000a240: 6661 756c 7456 616c 290a 2020 2020 2020  faultVal).      
-0000a250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a260: 2020 2320 6465 6661 756c 7420 6f6e 6c79    # default only
-0000a270: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a280: 2020 2020 2020 2020 2069 6620 6465 6661           if defa
-0000a290: 756c 745f 6f6e 6c79 3a0a 2020 2020 2020  ult_only:.      
-0000a2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a2b0: 2020 2020 2020 7265 7420 3d20 7661 6c5f        ret = val_
-0000a2c0: 690a 2020 2020 2020 2020 2020 2020 2020  i.              
-0000a2d0: 2020 2020 2020 2020 2020 2020 2020 6272                br
-0000a2e0: 6561 6b0a 2020 2020 2020 2020 2020 2020  eak.            
-0000a2f0: 2020 2020 2020 2020 2020 2020 7265 745b              ret[
-0000a300: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
-0000a310: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
-0000a320: 203d 2076 616c 5f69 0a20 2020 2020 2020   = val_i.       
-0000a330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a340: 2023 2072 656d 6f76 6520 696d 6167 652d   # remove image-
-0000a350: 6461 7465 7469 6d65 2069 6620 7468 6572  datetime if ther
-0000a360: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0000a370: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0000a380: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
-0000a390: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
-0000a3a0: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
-0000a3b0: 7429 2061 6e64 2027 696d 6167 652d 6461  t) and 'image-da
-0000a3c0: 7465 7469 6d65 2720 696e 2072 6574 5b74  tetime' in ret[t
-0000a3d0: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
-0000a3e0: 6167 652d 6461 7465 7469 6d65 275d 5d3a  age-datetime']]:
-0000a3f0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a400: 2020 2020 2020 2020 2020 2020 2064 656c               del
-0000a410: 2072 6574 5b74 696d 6550 6f69 6e74 4461   ret[timePointDa
-0000a420: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
-0000a430: 6d65 275d 5d5b 2769 6d61 6765 2d64 6174  me']]['image-dat
-0000a440: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
-0000a450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a460: 2320 7669 6465 6f20 6465 6661 756c 7473  # video defaults
-0000a470: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a480: 2020 2020 2020 2020 2069 6620 6920 3d3d           if i ==
-0000a490: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+00008f30: 2020 2020 2020 2020 2020 7365 6c66 2e69            self.i
+00008f40: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+00008f50: 6765 5365 7448 6561 6465 724b 6579 5d5b  geSetHeaderKey][
+00008f60: 2769 6d61 6765 2d73 656e 736f 7227 5d5b  'image-sensor'][
+00008f70: 276e 616d 6527 5d29 0a20 2020 2020 2020  'name']).       
+00008f80: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+00008f90: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00008fa0: 6572 4b65 795d 5b27 696d 6167 652d 7365  erKey]['image-se
+00008fb0: 742d 6e61 6d65 275d 203d 206e 6577 5f69  t-name'] = new_i
+00008fc0: 6d61 6765 5f73 6574 5f6e 616d 650a 2020  mage_set_name.  
+00008fd0: 2020 2020 2020 7265 7475 726e 206e 6577        return new
+00008fe0: 5f69 6d61 6765 5f73 6574 5f6e 616d 650a  _image_set_name.
+00008ff0: 2020 2020 2020 2020 0a0a 2020 2020 4073          ..    @s
+00009000: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+00009010: 6465 6620 636f 6e73 7472 7563 7449 6d61  def constructIma
+00009020: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
+00009030: 743a 7374 722c 6576 656e 743a 7374 722c  t:str,event:str,
+00009040: 7365 6e73 6f72 3a73 7472 293a 0a20 2020  sensor:str):.   
+00009050: 2020 2020 2022 2222 2072 6574 7572 6e73       """ returns
+00009060: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
+00009070: 743e 5f3c 7365 6e73 6f72 3e2c 2077 6974  t>_<sensor>, wit
+00009080: 6820 7368 6f72 7420 7665 7273 696f 6e20  h short version 
+00009090: 6f66 203c 7365 6e73 6f72 3e20 286f 6e6c  of <sensor> (onl
+000090a0: 7920 6964 292c 2070 7265 7665 6e74 696e  y id), preventin
+000090b0: 6720 706f 7465 6e74 6961 6c20 646f 7562  g potential doub
+000090c0: 6c69 6e67 206f 6620 3c70 726f 6a65 6374  ling of <project
+000090d0: 3e20 2022 2222 0a20 2020 2020 2020 2073  >  """.        s
+000090e0: 656e 736f 725f 7368 6f72 7420 3d20 6946  ensor_short = iF
+000090f0: 444f 2e67 6574 5368 6f72 7445 7175 6970  DO.getShortEquip
+00009100: 6d65 6e74 4944 2873 656e 736f 7229 0a20  mentID(sensor). 
+00009110: 2020 2020 2020 2069 6620 6c65 6e28 6576         if len(ev
+00009120: 656e 7429 203e 206c 656e 2870 726f 6a65  ent) > len(proje
+00009130: 6374 2920 616e 6420 6576 656e 745b 303a  ct) and event[0:
+00009140: 6c65 6e28 7072 6f6a 6563 7429 5d20 3d3d  len(project)] ==
+00009150: 2070 726f 6a65 6374 3a0a 2020 2020 2020   project:.      
+00009160: 2020 2020 2020 696d 6167 655f 7365 745f        image_set_
+00009170: 6e61 6d65 5f20 3d20 6576 656e 7420 2b20  name_ = event + 
+00009180: 225f 2220 2b20 7365 6e73 6f72 5f73 686f  "_" + sensor_sho
+00009190: 7274 0a20 2020 2020 2020 2065 6c73 653a  rt.        else:
+000091a0: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+000091b0: 6765 5f73 6574 5f6e 616d 655f 203d 2070  ge_set_name_ = p
+000091c0: 726f 6a65 6374 202b 2022 5f22 202b 2065  roject + "_" + e
+000091d0: 7665 6e74 202b 2022 5f22 202b 2073 656e  vent + "_" + sen
+000091e0: 736f 725f 7368 6f72 740a 2020 2020 2020  sor_short.      
+000091f0: 2020 7265 7475 726e 2069 6d61 6765 5f73    return image_s
+00009200: 6574 5f6e 616d 655f 2023 2054 4f44 4f20  et_name_ # TODO 
+00009210: 696e 636c 7564 6520 6461 7461 5479 7065  include dataType
+00009220: 3f0a 0a0a 2020 2020 4073 7461 7469 636d  ?...    @staticm
+00009230: 6574 686f 640a 2020 2020 6465 6620 6765  ethod.    def ge
+00009240: 7453 686f 7274 4571 7569 706d 656e 7449  tShortEquipmentI
+00009250: 4428 6571 7569 706d 656e 7449 443a 7374  D(equipmentID:st
+00009260: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00009270: 7265 7475 726e 7320 6571 7569 706d 656e  returns equipmen
+00009280: 7420 6964 2077 6974 686f 7574 2070 6f74  t id without pot
+00009290: 656e 7469 616c 6c20 6c6f 6e67 203c 6e61  entiall long <na
+000092a0: 6d65 3e20 7061 7274 2c20 692e 652e 3a20  me> part, i.e.: 
+000092b0: 3c6f 776e 6572 3e5f 3c74 7970 653e 2d3c  <owner>_<type>-<
+000092c0: 7479 7065 2069 6e64 6578 5b5f 3c73 7562  type index[_<sub
+000092d0: 7479 7065 3e5d 2022 2222 0a20 2020 2020  type>] """.     
+000092e0: 2020 2072 6574 7572 6e20 275f 272e 6a6f     return '_'.jo
+000092f0: 696e 2865 7175 6970 6d65 6e74 4944 2e73  in(equipmentID.s
+00009300: 706c 6974 2827 5f27 295b 303a 335d 290a  plit('_')[0:3]).
+00009310: 0a20 2020 2040 7374 6174 6963 6d65 7468  .    @staticmeth
+00009320: 6f64 0a20 2020 2064 6566 2063 6f6e 7374  od.    def const
+00009330: 7275 6374 6946 444f 6669 6c65 4e61 6d65  ructiFDOfileName
+00009340: 2870 726f 6a65 6374 3a73 7472 2c65 7665  (project:str,eve
+00009350: 6e74 3a73 7472 2c73 656e 736f 723a 7374  nt:str,sensor:st
+00009360: 7229 3a0a 2020 2020 2020 2020 2222 2220  r):.        """ 
+00009370: 7265 7475 726e 7320 3c63 6f6e 7374 7275  returns <constru
+00009380: 6374 496d 6167 6553 6574 4e61 6d65 2829  ctImageSetName()
+00009390: 3e5f 6946 444f 2e6a 736f 6e20 2222 220a  >_iFDO.json """.
+000093a0: 2020 2020 2020 2020 7265 7475 726e 2069          return i
+000093b0: 4644 4f2e 636f 6e73 7472 7563 7449 6d61  FDO.constructIma
+000093c0: 6765 5365 744e 616d 6528 7072 6f6a 6563  geSetName(projec
+000093d0: 742c 6576 656e 742c 7365 6e73 6f72 2920  t,event,sensor) 
+000093e0: 2b20 275f 6946 444f 2e6a 736f 6e27 200a  + '_iFDO.json' .
+000093f0: 0a20 2020 200a 2020 2020 4073 7461 7469  .    .    @stati
+00009400: 636d 6574 686f 640a 2020 2020 6465 6620  cmethod.    def 
+00009410: 5f5f 6765 7446 6965 6c64 5661 6c75 6528  __getFieldValue(
+00009420: 6966 646f 3a64 6963 742c 6b65 7973 3a6c  ifdo:dict,keys:l
+00009430: 6973 742c 6465 6661 756c 745f 6f6e 6c79  ist,default_only
+00009440: 203d 2046 616c 7365 293a 0a20 2020 2020   = False):.     
+00009450: 2020 2022 2222 2072 6574 7572 6e73 2063     """ returns c
+00009460: 6f70 7920 6f66 2073 6574 206f 7220 6974  opy of set or it
+00009470: 656d 2066 6965 6c64 2076 616c 7565 2c20  em field value, 
+00009480: 616c 736f 2063 6f6e 7369 6465 726e 6720  also considerng 
+00009490: 6465 6661 756c 7420 7661 6c75 6573 2066  default values f
+000094a0: 726f 6d20 6865 6164 6572 2e0a 2020 2020  rom header..    
+000094b0: 2020 2020 2020 2020 5573 6520 6b65 7973          Use keys
+000094c0: 2061 7320 652e 672e 205b 3c69 7465 6d3e   as e.g. [<item>
+000094d0: 2c3c 6b65 793e 2c2e 2e5d 2e20 4361 6e20  ,<key>,..]. Can 
+000094e0: 6265 2075 7365 6420 666f 7220 6865 6164  be used for head
+000094f0: 6572 2066 6965 6c64 7320 6173 2077 656c  er fields as wel
+00009500: 6c20 6173 2069 7465 6d20 6669 656c 6473  l as item fields
+00009510: 2e0a 2020 2020 2020 2020 2020 2020 4974  ..            It
+00009520: 656d 2069 6e64 6578 2063 616e 2062 6520  em index can be 
+00009530: 6e65 676c 6563 7465 642c 2069 6e20 6361  neglected, in ca
+00009540: 7365 206f 6620 7669 6465 6f20 6120 6469  se of video a di
+00009550: 6374 207b 3c69 6d61 6765 2d64 6174 6174  ct {<image-datat
+00009560: 696d 653e 3a3c 7661 6c75 653e 2c2e 2e2e  ime>:<value>,...
+00009570: 7d20 6973 2072 6574 7572 6e65 640a 2020  } is returned.  
+00009580: 2020 2020 2020 2020 2020 756e 6c65 7373            unless
+00009590: 2064 6566 6175 6c74 5f6f 6e6c 7920 3d20   default_only = 
+000095a0: 4661 6c73 652c 2074 6865 6e20 6465 6661  False, then defa
+000095b0: 756c 7420 7661 6c75 6573 2061 7420 696e  ult values at in
+000095c0: 6465 7820 3020 6973 2072 6574 7572 6e65  dex 0 is returne
+000095d0: 642e 0a20 2020 2020 2020 2020 2020 2052  d..            R
+000095e0: 6169 7365 7320 4966 646f 4578 6365 7074  aises IfdoExcept
+000095f0: 696f 6e20 6966 206b 6579 7320 646f 206e  ion if keys do n
+00009600: 6f74 2065 7869 7374 2e20 2222 220a 0a20  ot exist. """.. 
+00009610: 2020 2020 2020 2069 6620 6e6f 7420 6d69         if not mi
+00009620: 7174 762e 696d 6167 655f 7365 745f 6974  qtv.image_set_it
+00009630: 656d 735f 6b65 7920 696e 2069 6664 6f20  ems_key in ifdo 
+00009640: 6f72 206e 6f74 206d 6971 7476 2e69 6d61  or not miqtv.ima
+00009650: 6765 5f73 6574 5f68 6561 6465 725f 6b65  ge_set_header_ke
+00009660: 7920 696e 2069 6664 6f3a 0a20 2020 2020  y in ifdo:.     
+00009670: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00009680: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00009690: 2822 496e 7661 6c69 6420 6966 646f 2064  ("Invalid ifdo d
+000096a0: 6963 742c 206d 6973 7369 6e67 2069 7465  ict, missing ite
+000096b0: 6d73 206f 7220 6865 6164 6572 206b 6579  ms or header key
+000096c0: 3a20 2220 2b20 7374 7228 6966 646f 2929  : " + str(ifdo))
+000096d0: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
+000096e0: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
+000096f0: 6e63 6528 6b65 7973 2c6c 6973 7429 3a0a  nce(keys,list):.
+00009700: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
+00009710: 203d 205b 6b65 7973 5d0a 0a20 2020 2020   = [keys]..     
+00009720: 2020 2023 2072 656d 6f76 6520 6865 6164     # remove head
+00009730: 6572 206f 7220 6974 656d 2070 7265 6669  er or item prefi
+00009740: 7865 7320 6966 2074 6865 7265 0a20 2020  xes if there.   
+00009750: 2020 2020 2069 6620 6b65 7973 5b30 5d20       if keys[0] 
+00009760: 3d3d 206d 6971 7476 2e69 6d61 6765 5f73  == miqtv.image_s
+00009770: 6574 5f69 7465 6d73 5f6b 6579 206f 7220  et_items_key or 
+00009780: 6b65 7973 5b30 5d20 3d3d 206d 6971 7476  keys[0] == miqtv
+00009790: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
+000097a0: 725f 6b65 793a 0a20 2020 2020 2020 2020  r_key:.         
+000097b0: 2020 206b 6579 7320 3d20 6b65 7973 5b31     keys = keys[1
+000097c0: 3a3a 5d0a 0a20 2020 2020 2020 2068 6561  ::]..        hea
+000097d0: 6465 7220 3d20 6966 646f 5b6d 6971 7476  der = ifdo[miqtv
+000097e0: 2e69 6d61 6765 5f73 6574 5f68 6561 6465  .image_set_heade
+000097f0: 725f 6b65 795d 0a20 2020 2020 2020 2069  r_key].        i
+00009800: 7465 6d73 203d 2069 6664 6f5b 6d69 7174  tems = ifdo[miqt
+00009810: 762e 696d 6167 655f 7365 745f 6974 656d  v.image_set_item
+00009820: 735f 6b65 795d 0a20 2020 2020 2020 2023  s_key].        #
+00009830: 206c 6f6f 6b20 666f 7220 6465 6661 756c   look for defaul
+00009840: 7420 7661 6c75 650a 2020 2020 2020 2020  t value.        
+00009850: 666f 7220 736b 6970 7065 6449 6e48 6561  for skippedInHea
+00009860: 6465 7220 696e 2072 616e 6765 286c 656e  der in range(len
+00009870: 286b 6579 7329 293a 0a20 2020 2020 2020  (keys)):.       
+00009880: 2020 2020 2064 6566 6175 6c74 5661 6c20       defaultVal 
+00009890: 3d20 6669 6e64 4669 656c 6428 6865 6164  = findField(head
+000098a0: 6572 2c6b 6579 735b 736b 6970 7065 6449  er,keys[skippedI
+000098b0: 6e48 6561 6465 723a 3a5d 290a 2020 2020  nHeader::]).    
+000098c0: 2020 2020 2020 2020 6966 2064 6566 6175          if defau
+000098d0: 6c74 5661 6c20 213d 2022 223a 0a20 2020  ltVal != "":.   
+000098e0: 2020 2020 2020 2020 2020 2020 2062 7265               bre
+000098f0: 616b 0a0a 2020 2020 2020 2020 2323 206c  ak..        ## l
+00009900: 6f6f 6b20 666f 7220 6974 656d 2076 616c  ook for item val
+00009910: 7565 0a20 2020 2020 2020 2023 2068 6561  ue.        # hea
+00009920: 6465 7220 6f6e 6c79 2076 616c 7565 2c20  der only value, 
+00009930: 646f 6e27 7420 6368 6563 6b20 696e 2069  don't check in i
+00009940: 7465 6d73 0a20 2020 2020 2020 2069 6620  tems.        if 
+00009950: 6669 6e64 4669 656c 6428 6974 656d 732c  findField(items,
+00009960: 6b65 7973 5b30 3a31 5d29 203d 3d20 2222  keys[0:1]) == ""
+00009970: 2061 6e64 2073 6b69 7070 6564 496e 4865   and skippedInHe
+00009980: 6164 6572 203d 3d20 303a 0a20 2020 2020  ader == 0:.     
+00009990: 2020 2020 2020 2072 6574 203d 2064 6566         ret = def
+000099a0: 6175 6c74 5661 6c0a 2020 2020 2020 2020  aultVal.        
+000099b0: 2020 2020 6966 2072 6574 203d 3d20 2222      if ret == ""
+000099c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000099d0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+000099e0: 646f 4578 6365 7074 696f 6e28 226b 6579  doException("key
+000099f0: 2064 6f65 7320 6e6f 7420 6578 6973 743a   does not exist:
+00009a00: 2220 2b20 7374 7228 6b65 7973 2929 0a20  " + str(keys)). 
+00009a10: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00009a20: 2020 2020 2020 2020 2023 2069 6620 6669           # if fi
+00009a30: 7273 7420 6b65 7920 6e6f 7420 666f 756e  rst key not foun
+00009a40: 6420 696e 2069 7465 6d73 2c20 692e 652e  d in items, i.e.
+00009a50: 2069 7320 6e6f 7420 6120 696d 6167 6520   is not a image 
+00009a60: 6e61 6d65 2c20 616e 6420 6669 7273 7420  name, and first 
+00009a70: 6b65 7920 6973 206e 6f74 2061 2068 6561  key is not a hea
+00009a80: 6465 7220 6b65 793a 0a20 2020 2020 2020  der key:.       
+00009a90: 2020 2020 2069 6620 6669 6e64 4669 656c       if findFiel
+00009aa0: 6428 6974 656d 732c 6b65 7973 5b30 3a31  d(items,keys[0:1
+00009ab0: 5d29 203d 3d20 2222 2061 6e64 2073 6b69  ]) == "" and ski
+00009ac0: 7070 6564 496e 4865 6164 6572 2021 3d20  ppedInHeader != 
+00009ad0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
+00009ae0: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
+00009af0: 6664 6f45 7863 6570 7469 6f6e 2822 6974  fdoException("it
+00009b00: 656d 2064 6f65 7320 6e6f 7420 6578 6973  em does not exis
+00009b10: 743a 2220 2b20 7374 7228 6b65 7973 5b30  t:" + str(keys[0
+00009b20: 3a31 5d29 290a 0a20 2020 2020 2020 2020  :1]))..         
+00009b30: 2020 2023 2063 6865 636b 2069 6620 696e     # check if in
+00009b40: 6465 7820 7072 6f76 6964 6564 0a20 2020  dex provided.   
+00009b50: 2020 2020 2020 2020 2069 6e64 6578 5072           indexPr
+00009b60: 6f76 6964 6564 203d 2054 7275 650a 2020  ovided = True.  
+00009b70: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+00009b80: 286b 6579 7329 203e 2031 3a0a 2020 2020  (keys) > 1:.    
+00009b90: 2020 2020 2020 2020 2020 2020 7472 793a              try:
+00009ba0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009bb0: 2020 2020 2069 6e64 6578 203d 2069 6e74       index = int
+00009bc0: 286b 6579 735b 315d 290a 2020 2020 2020  (keys[1]).      
+00009bd0: 2020 2020 2020 2020 2020 6578 6365 7074            except
+00009be0: 2045 7863 6570 7469 6f6e 3a0a 2020 2020   Exception:.    
+00009bf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00009c00: 696e 6465 7850 726f 7669 6465 6420 3d20  indexProvided = 
+00009c10: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
+00009c20: 2020 656c 6966 206c 656e 286b 6579 7329    elif len(keys)
+00009c30: 203d 3d20 313a 0a20 2020 2020 2020 2020   == 1:.         
+00009c40: 2020 2020 2020 2069 6e64 6578 5072 6f76         indexProv
+00009c50: 6964 6564 203d 2046 616c 7365 0a20 2020  ided = False.   
+00009c60: 2020 2020 2020 2020 2020 2020 200a 2020               .  
+00009c70: 2020 2020 2020 2020 2020 696d 6167 6549            imageI
+00009c80: 7465 6d54 696d 6550 6f69 6e74 7320 3d20  temTimePoints = 
+00009c90: 6974 656d 735b 6b65 7973 5b30 5d5d 0a0a  items[keys[0]]..
+00009ca0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
+00009cb0: 6e64 6578 5072 6f76 6964 6564 3a0a 2020  ndexProvided:.  
+00009cc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009cd0: 6966 206b 6579 2069 7320 7768 6f6c 6520  if key is whole 
+00009ce0: 696d 6167 6520 6164 6420 616c 6c20 7661  image add all va
+00009cf0: 6c75 6573 2066 726f 6d20 6865 6164 6572  lues from header
+00009d00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00009d10: 2069 6620 6c65 6e28 6b65 7973 2920 3d3d   if len(keys) ==
+00009d20: 2032 3a0a 2020 2020 2020 2020 2020 2020   2:.            
+00009d30: 2020 2020 2020 2020 6465 6661 756c 7456          defaultV
+00009d40: 616c 203d 2068 6561 6465 720a 2020 2020  al = header.    
+00009d50: 2020 2020 2020 2020 2020 2020 2320 6164              # ad
+00009d60: 6420 6465 6661 756c 7420 6672 6f6d 2069  d default from i
+00009d70: 6e64 6578 2030 0a20 2020 2020 2020 2020  ndex 0.         
+00009d80: 2020 2020 2020 2069 6620 6c65 6e28 6b65         if len(ke
+00009d90: 7973 2920 3e20 3120 616e 6420 696e 6465  ys) > 1 and inde
+00009da0: 7820 213d 2030 3a0a 2020 2020 2020 2020  x != 0:.        
+00009db0: 2020 2020 2020 2020 2020 2020 6b65 7973              keys
+00009dc0: 5f30 203d 2063 6f70 792e 6465 6570 636f  _0 = copy.deepco
+00009dd0: 7079 286b 6579 7329 0a20 2020 2020 2020  py(keys).       
+00009de0: 2020 2020 2020 2020 2020 2020 206b 6579               key
+00009df0: 735f 305b 315d 203d 2030 0a20 2020 2020  s_0[1] = 0.     
+00009e00: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009e10: 6574 5f30 203d 2069 4644 4f2e 5f5f 6765  et_0 = iFDO.__ge
+00009e20: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
+00009e30: 2c6b 6579 735f 302c 736b 6970 7065 6449  ,keys_0,skippedI
+00009e40: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
+00009e50: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+00009e60: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+00009e70: 7461 6e63 6528 7265 745f 302c 6469 6374  tance(ret_0,dict
+00009e80: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00009e90: 2020 2020 2020 2020 2020 2064 6566 6175             defau
+00009ea0: 6c74 5661 6c20 3d20 7b2a 2a64 6566 6175  ltVal = {**defau
+00009eb0: 6c74 5661 6c2c 2a2a 7265 745f 307d 0a20  ltVal,**ret_0}. 
+00009ec0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+00009ed0: 6574 203d 2069 4644 4f2e 5f5f 6765 7449  et = iFDO.__getI
+00009ee0: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
+00009ef0: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
+00009f00: 6465 722c 6465 6661 756c 7456 616c 290a  der,defaultVal).
+00009f10: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+00009f20: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
+00009f30: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+00009f40: 2069 6620 6b65 7920 6973 2077 686f 6c65   if key is whole
+00009f50: 2069 6d61 6765 2061 6464 2061 6c6c 2076   image add all v
+00009f60: 616c 7565 7320 6672 6f6d 2068 6561 6465  alues from heade
+00009f70: 720a 2020 2020 2020 2020 2020 2020 2020  r.              
+00009f80: 2020 6966 206c 656e 286b 6579 7329 203d    if len(keys) =
+00009f90: 3d20 313a 0a20 2020 2020 2020 2020 2020  = 1:.           
+00009fa0: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+00009fb0: 5661 6c20 3d20 6865 6164 6572 0a0a 2020  Val = header..  
+00009fc0: 2020 2020 2020 2020 2020 2020 2020 2320                # 
+00009fd0: 7069 6374 7572 6520 2d3e 206a 7573 7420  picture -> just 
+00009fe0: 6f6e 6520 656e 7472 792c 2069 6e73 6572  one entry, inser
+00009ff0: 7420 696e 6465 7820 300a 2020 2020 2020  t index 0.      
+0000a000: 2020 2020 2020 2020 2020 6966 206c 656e            if len
+0000a010: 2869 6d61 6765 4974 656d 5469 6d65 506f  (imageItemTimePo
+0000a020: 696e 7473 2920 3d3d 2031 3a0a 2020 2020  ints) == 1:.    
+0000a030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a040: 6b65 7973 203d 206b 6579 735b 303a 315d  keys = keys[0:1]
+0000a050: 202b 205b 305d 202b 206b 6579 735b 313a   + [0] + keys[1:
+0000a060: 3a5d 0a20 2020 2020 2020 2020 2020 2020  :].             
+0000a070: 2020 2020 2020 2072 6574 203d 2069 4644         ret = iFD
+0000a080: 4f2e 5f5f 6765 7449 7465 6d56 616c 7565  O.__getItemValue
+0000a090: 2869 7465 6d73 2c6b 6579 732c 736b 6970  (items,keys,skip
+0000a0a0: 7065 6449 6e48 6561 6465 722c 6465 6661  pedInHeader,defa
+0000a0b0: 756c 7456 616c 290a 2020 2020 2020 2020  ultVal).        
+0000a0c0: 2020 2020 2020 2020 2020 2020 0a20 2020              .   
+0000a0d0: 2020 2020 2020 2020 2020 2020 2023 2076               # v
+0000a0e0: 6964 656f 202d 3e20 7265 7475 726e 2076  ideo -> return v
+0000a0f0: 616c 7565 7320 666f 7220 6561 6368 2074  alues for each t
+0000a100: 696d 6520 7374 616d 700a 2020 2020 2020  ime stamp.      
+0000a110: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+0000a120: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a130: 2020 2020 7265 7420 3d20 7b7d 0a20 2020      ret = {}.   
+0000a140: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a150: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+0000a160: 6c65 6e28 696d 6167 6549 7465 6d54 696d  len(imageItemTim
+0000a170: 6550 6f69 6e74 7329 293a 0a20 2020 2020  ePoints)):.     
+0000a180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a190: 2020 2074 696d 6550 6f69 6e74 4461 7461     timePointData
+0000a1a0: 203d 2069 6d61 6765 4974 656d 5469 6d65   = imageItemTime
+0000a1b0: 506f 696e 7473 5b69 5d0a 2020 2020 2020  Points[i].      
+0000a1c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a1d0: 2020 6b65 7973 5f69 203d 206b 6579 735b    keys_i = keys[
+0000a1e0: 303a 315d 202b 205b 695d 202b 206b 6579  0:1] + [i] + key
+0000a1f0: 735b 313a 3a5d 0a20 2020 2020 2020 2020  s[1::].         
+0000a200: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+0000a210: 616c 5f69 203d 2069 4644 4f2e 5f5f 6765  al_i = iFDO.__ge
+0000a220: 7449 7465 6d56 616c 7565 2869 7465 6d73  tItemValue(items
+0000a230: 2c6b 6579 735f 692c 736b 6970 7065 6449  ,keys_i,skippedI
+0000a240: 6e48 6561 6465 722c 6465 6661 756c 7456  nHeader,defaultV
+0000a250: 616c 290a 2020 2020 2020 2020 2020 2020  al).            
+0000a260: 2020 2020 2020 2020 2020 2020 2320 6465              # de
+0000a270: 6661 756c 7420 6f6e 6c79 0a20 2020 2020  fault only.     
+0000a280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a290: 2020 2069 6620 6465 6661 756c 745f 6f6e     if default_on
+0000a2a0: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
+0000a2b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2c0: 7265 7420 3d20 7661 6c5f 690a 2020 2020  ret = val_i.    
+0000a2d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a2e0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
+0000a2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a300: 2020 2020 2020 7265 745b 7469 6d65 506f        ret[timePo
+0000a310: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+0000a320: 6174 6574 696d 6527 5d5d 203d 2076 616c  atetime']] = val
+0000a330: 5f69 0a20 2020 2020 2020 2020 2020 2020  _i.             
+0000a340: 2020 2020 2020 2020 2020 2023 2072 656d             # rem
+0000a350: 6f76 6520 696d 6167 652d 6461 7465 7469  ove image-dateti
+0000a360: 6d65 2069 6620 7468 6572 650a 2020 2020  me if there.    
+0000a370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a380: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000a390: 6528 7265 745b 7469 6d65 506f 696e 7444  e(ret[timePointD
+0000a3a0: 6174 615b 2769 6d61 6765 2d64 6174 6574  ata['image-datet
+0000a3b0: 696d 6527 5d5d 2c64 6963 7429 2061 6e64  ime']],dict) and
+0000a3c0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
+0000a3d0: 2720 696e 2072 6574 5b74 696d 6550 6f69  ' in ret[timePoi
+0000a3e0: 6e74 4461 7461 5b27 696d 6167 652d 6461  ntData['image-da
+0000a3f0: 7465 7469 6d65 275d 5d3a 0a20 2020 2020  tetime']]:.     
+0000a400: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a410: 2020 2020 2020 2064 656c 2072 6574 5b74         del ret[t
+0000a420: 696d 6550 6f69 6e74 4461 7461 5b27 696d  imePointData['im
+0000a430: 6167 652d 6461 7465 7469 6d65 275d 5d5b  age-datetime']][
+0000a440: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000a450: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000a460: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
+0000a470: 6f20 6465 6661 756c 7473 0a20 2020 2020  o defaults.     
+0000a480: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a490: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
 0000a4a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a4b0: 6966 2069 7369 6e73 7461 6e63 6528 7265  if isinstance(re
-0000a4c0: 745b 7469 6d65 506f 696e 7444 6174 615b  t[timePointData[
-0000a4d0: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000a4e0: 5d5d 2c64 6963 7429 3a0a 2020 2020 2020  ]],dict):.      
-0000a4f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a500: 2020 2020 2020 2020 2020 6465 6661 756c            defaul
-0000a510: 7456 616c 203d 207b 2a2a 6465 6661 756c  tVal = {**defaul
-0000a520: 7456 616c 2c2a 2a72 6574 5b74 696d 6550  tVal,**ret[timeP
-0000a530: 6f69 6e74 4461 7461 5b27 696d 6167 652d  ointData['image-
-0000a540: 6461 7465 7469 6d65 275d 5d7d 0a20 2020  datetime']]}.   
-0000a550: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a560: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-0000a570: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000a580: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-0000a590: 6566 6175 6c74 5661 6c20 3d20 7265 745b  efaultVal = ret[
-0000a5a0: 7469 6d65 506f 696e 7444 6174 615b 2769  timePointData['i
-0000a5b0: 6d61 6765 2d64 6174 6574 696d 6527 5d5d  mage-datetime']]
-0000a5c0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-0000a5d0: 2020 2020 2020 2020 2020 6920 2b3d 2031            i += 1
-0000a5e0: 0a0a 2020 2020 2020 2020 6966 2069 7369  ..        if isi
-0000a5f0: 6e73 7461 6e63 6528 7265 742c 6469 6374  nstance(ret,dict
-0000a600: 2920 6f72 2069 7369 6e73 7461 6e63 6528  ) or isinstance(
-0000a610: 7265 742c 6c69 7374 293a 0a20 2020 2020  ret,list):.     
-0000a620: 2020 2020 2020 2072 6574 203d 2063 6f70         ret = cop
-0000a630: 792e 6465 6570 636f 7079 2872 6574 290a  y.deepcopy(ret).
-0000a640: 2020 2020 2020 2020 6966 2072 6574 203d          if ret =
-0000a650: 3d20 2222 206f 7220 7265 7420 3d3d 207b  = "" or ret == {
-0000a660: 7d3a 0a20 2020 2020 2020 2020 2020 2072  }:.            r
-0000a670: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-0000a680: 7863 6570 7469 6f6e 2822 6b65 7973 2064  xception("keys d
-0000a690: 6f20 6e6f 7420 6578 6973 743a 2220 2b20  o not exist:" + 
-0000a6a0: 7374 7228 6b65 7973 2929 0a20 2020 2020  str(keys)).     
-0000a6b0: 2020 2072 6574 7572 6e20 7265 740a 0a0a     return ret...
-0000a6c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-0000a6d0: 640a 2020 2020 6465 6620 5f5f 6765 7449  d.    def __getI
-0000a6e0: 7465 6d56 616c 7565 2869 7465 6d73 2c6b  temValue(items,k
-0000a6f0: 6579 732c 736b 6970 7065 6449 6e48 6561  eys,skippedInHea
-0000a700: 6465 722c 6465 6661 756c 7456 616c 293a  der,defaultVal):
-0000a710: 0a20 2020 2020 2020 200a 2020 2020 2020  .        .      
-0000a720: 2020 2320 696e 2063 6173 6520 6974 656d    # in case item
-0000a730: 2069 7320 6e6f 7420 6120 6c69 7374 2028   is not a list (
-0000a740: 7368 6f75 6c64 206e 6f74 2062 6520 706f  should not be po
-0000a750: 7373 6962 6c65 290a 2020 2020 2020 2020  ssible).        
-0000a760: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-0000a770: 6528 6974 656d 735b 6b65 7973 5b30 5d5d  e(items[keys[0]]
-0000a780: 2c6c 6973 7429 3a0a 2020 2020 2020 2020  ,list):.        
-0000a790: 2020 2020 6974 656d 735b 6b65 7973 5b30      items[keys[0
-0000a7a0: 5d5d 203d 205b 6974 656d 735b 6b65 7973  ]] = [items[keys
-0000a7b0: 5b30 5d5d 5d0a 0a20 2020 2020 2020 2069  [0]]]..        i
-0000a7c0: 7465 6d56 616c 7565 203d 2066 696e 6446  temValue = findF
-0000a7d0: 6965 6c64 2869 7465 6d73 2c6b 6579 7329  ield(items,keys)
-0000a7e0: 0a0a 2020 2020 2020 2020 6966 2069 7465  ..        if ite
-0000a7f0: 6d56 616c 7565 203d 3d20 2222 3a0a 2020  mValue == "":.  
-0000a800: 2020 2020 2020 2020 2020 7265 7420 3d20            ret = 
-0000a810: 6465 6661 756c 7456 616c 0a20 2020 2020  defaultVal.     
-0000a820: 2020 2023 2069 6e20 6361 7365 206f 6620     # in case of 
-0000a830: 6469 6374 7320 6a6f 696e 7420 6865 6164  dicts joint head
-0000a840: 6572 2061 6e64 2069 7465 6d20 6669 656c  er and item fiel
-0000a850: 6473 0a20 2020 2020 2020 2065 6c69 6620  ds.        elif 
-0000a860: 6973 696e 7374 616e 6365 2869 7465 6d56  isinstance(itemV
-0000a870: 616c 7565 2c64 6963 7429 2061 6e64 2064  alue,dict) and d
-0000a880: 6566 6175 6c74 5661 6c20 213d 2022 223a  efaultVal != "":
-0000a890: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0000a8a0: 6e6f 7420 6973 696e 7374 616e 6365 2864  not isinstance(d
-0000a8b0: 6566 6175 6c74 5661 6c2c 6469 6374 293a  efaultVal,dict):
-0000a8c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000a8d0: 2072 6169 7365 206d 6971 7463 2e49 6664   raise miqtc.Ifd
-0000a8e0: 6f45 7863 6570 7469 6f6e 2822 4974 656d  oException("Item
-0000a8f0: 2066 6965 6c64 2069 7320 6469 6374 2062   field is dict b
-0000a900: 7574 2064 6566 6175 6c74 2076 616c 7565  ut default value
-0000a910: 2069 6e20 6865 6164 6572 2069 7320 6e6f   in header is no
-0000a920: 743a 2022 202b 2073 7472 286b 6579 7329  t: " + str(keys)
-0000a930: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-0000a940: 7420 3d20 7b2a 2a64 6566 6175 6c74 5661  t = {**defaultVa
-0000a950: 6c2c 2a2a 6974 656d 5661 6c75 657d 0a20  l,**itemValue}. 
-0000a960: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0000a970: 2020 2020 2020 2020 2072 6574 203d 2069           ret = i
-0000a980: 7465 6d56 616c 7565 0a20 2020 2020 2020  temValue.       
-0000a990: 2072 6574 7572 6e20 7265 740a 0a0a 2020   return ret...  
-0000a9a0: 2020 6465 6620 5f5f 7374 725f 5f28 7365    def __str__(se
-0000a9b0: 6c66 2920 2d3e 2073 7472 3a0a 2020 2020  lf) -> str:.    
-0000a9c0: 2020 2020 2222 2220 5072 696e 7473 2063      """ Prints c
-0000a9d0: 7572 7265 6e74 2069 4644 4f20 6669 6c65  urrent iFDO file
-0000a9e0: 2022 2222 0a20 2020 2020 2020 2072 6574   """.        ret
-0000a9f0: 7572 6e20 7961 6d6c 2e64 756d 7028 7365  urn yaml.dump(se
-0000aa00: 6c66 2e69 6664 6f5f 6368 6563 6b65 642c  lf.ifdo_checked,
-0000aa10: 2064 6566 6175 6c74 5f73 7479 6c65 3d4e   default_style=N
-0000aa20: 6f6e 652c 2064 6566 6175 6c74 5f66 6c6f  one, default_flo
-0000aa30: 775f 7374 796c 653d 4e6f 6e65 2c20 616c  w_style=None, al
-0000aa40: 6c6f 775f 756e 6963 6f64 653d 5472 7565  low_unicode=True
-0000aa50: 2c20 7769 6474 683d 666c 6f61 7428 2269  , width=float("i
-0000aa60: 6e66 2229 290a 0a0a 2020 2020 6465 6620  nf"))...    def 
-0000aa70: 5f5f 6765 7469 7465 6d5f 5f28 7365 6c66  __getitem__(self
-0000aa80: 2c20 6b65 7973 293a 0a20 2020 2020 2020  , keys):.       
-0000aa90: 2022 2222 2052 6574 7572 6e73 2063 6f70   """ Returns cop
-0000aaa0: 7920 6f66 2063 6865 636b 6564 2069 6664  y of checked ifd
-0000aab0: 6f20 7365 7420 6f72 2069 7465 6d20 6669  o set or item fi
-0000aac0: 656c 6420 7661 6c75 652c 2061 6c73 6f20  eld value, also 
-0000aad0: 636f 6e73 6964 6572 6e67 2064 6566 6175  considerng defau
-0000aae0: 6c74 2076 616c 7565 7320 6672 6f6d 2068  lt values from h
-0000aaf0: 6561 6465 722e 0a20 2020 2020 2020 2020  eader..         
-0000ab00: 2020 2055 7365 206b 6579 7320 6173 2065     Use keys as e
-0000ab10: 2e67 2e20 273c 6974 656d 3e3a 3c6b 6579  .g. '<item>:<key
-0000ab20: 3e3a 2e2e 2e27 2e20 4361 6e20 6265 2075  >:...'. Can be u
-0000ab30: 7365 6420 666f 7220 6865 6164 6572 2066  sed for header f
-0000ab40: 6965 6c64 7320 6173 2077 656c 6c20 6173  ields as well as
-0000ab50: 2069 7465 6d20 6669 656c 6473 2e0a 2020   item fields..  
-0000ab60: 2020 2020 2020 2020 2020 4974 656d 2069            Item i
-0000ab70: 6e64 6578 2063 616e 2062 6520 6c65 676c  ndex can be legl
-0000ab80: 6563 7465 642c 2069 6e20 6361 7365 206f  ected, in case o
-0000ab90: 6620 7669 6465 6f20 6120 6469 6374 207b  f video a dict {
-0000aba0: 3c69 6d61 6765 2d64 6174 6174 696d 653e  <image-datatime>
-0000abb0: 3a3c 7661 6c75 653e 2c2e 2e2e 7d20 6973  :<value>,...} is
-0000abc0: 2072 6574 7572 6e65 642e 0a20 2020 2020   returned..     
-0000abd0: 2020 2020 2020 2052 6169 7365 7320 4966         Raises If
-0000abe0: 646f 4578 6365 7074 696f 6e20 6966 2069  doException if i
-0000abf0: 7465 6d20 646f 6573 206e 6f74 2065 7869  tem does not exi
-0000ac00: 7374 2e20 2222 220a 2020 2020 2020 2020  st. """.        
-0000ac10: 6b65 7973 203d 206b 6579 732e 7370 6c69  keys = keys.spli
-0000ac20: 7428 273a 2729 0a20 2020 2020 2020 2072  t(':').        r
-0000ac30: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
-0000ac40: 4669 656c 6456 616c 7565 2873 656c 662e  FieldValue(self.
-0000ac50: 6966 646f 5f63 6865 636b 6564 2c6b 6579  ifdo_checked,key
-0000ac60: 7329 0a0a 0a20 2020 2064 6566 2066 696e  s)...    def fin
-0000ac70: 6454 6d70 4669 656c 6428 7365 6c66 2c6b  dTmpField(self,k
-0000ac80: 6579 7329 3a0a 2020 2020 2020 2020 2222  eys):.        ""
-0000ac90: 2220 5265 7475 726e 7320 636f 7079 206f  " Returns copy o
-0000aca0: 6620 7465 6d70 6f72 6172 7920 756e 6368  f temporary unch
-0000acb0: 6563 6b65 6420 6966 646f 2073 6574 206f  ecked ifdo set o
-0000acc0: 7220 6974 656d 2066 6965 6c64 2076 616c  r item field val
-0000acd0: 7565 2c20 616c 736f 2063 6f6e 7369 6465  ue, also conside
-0000ace0: 726e 6720 6465 6661 756c 7420 7661 6c75  rng default valu
-0000acf0: 6573 2066 726f 6d20 6865 6164 6572 2e0a  es from header..
-0000ad00: 2020 2020 2020 2020 2020 2020 5573 6520              Use 
-0000ad10: 6b65 7973 2061 7320 652e 672e 2027 3c69  keys as e.g. '<i
-0000ad20: 7465 6d3e 3a3c 6b65 793e 3a2e 2e2e 272e  tem>:<key>:...'.
-0000ad30: 2043 616e 2062 6520 7573 6564 2066 6f72   Can be used for
-0000ad40: 2068 6561 6465 7220 6669 656c 6473 2061   header fields a
-0000ad50: 7320 7765 6c6c 2061 7320 6974 656d 2066  s well as item f
-0000ad60: 6965 6c64 732e 0a20 2020 2020 2020 2020  ields..         
-0000ad70: 2020 2049 7465 6d20 696e 6465 7820 6361     Item index ca
-0000ad80: 6e20 6265 206c 6567 6c65 6374 6564 2c20  n be leglected, 
-0000ad90: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
-0000ada0: 2061 2064 6963 7420 7b3c 696d 6167 652d   a dict {<image-
-0000adb0: 6461 7461 7469 6d65 3e3a 3c76 616c 7565  datatime>:<value
-0000adc0: 3e2c 2e2e 2e7d 2069 7320 7265 7475 726e  >,...} is return
-0000add0: 6564 2e0a 2020 2020 2020 2020 2020 2020  ed..            
-0000ade0: 5261 6973 6573 2049 6664 6f45 7863 6570  Raises IfdoExcep
-0000adf0: 7469 6f6e 2069 6620 6974 656d 2064 6f65  tion if item doe
-0000ae00: 7320 6e6f 7420 6578 6973 742e 2022 2222  s not exist. """
-0000ae10: 0a20 2020 2020 2020 206b 6579 7320 3d20  .        keys = 
-0000ae20: 6b65 7973 2e73 706c 6974 2827 3a27 290a  keys.split(':').
-0000ae30: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000ae40: 656c 662e 5f5f 6765 7446 6965 6c64 5661  elf.__getFieldVa
-0000ae50: 6c75 6528 7365 6c66 2e69 6664 6f5f 746d  lue(self.ifdo_tm
-0000ae60: 702c 6b65 7973 290a 2020 2020 0a0a 2020  p,keys).    ..  
-0000ae70: 2020 6465 6620 6669 6e64 546d 7046 6965    def findTmpFie
-0000ae80: 6c64 3228 7365 6c66 2c6b 6579 7329 3a0a  ld2(self,keys):.
-0000ae90: 2020 2020 2020 2020 2222 2220 5361 6d65          """ Same
-0000aea0: 2061 7320 6669 6e64 546d 7046 6965 6c64   as findTmpField
-0000aeb0: 2069 6e73 7465 6164 206f 6620 7261 6973   instead of rais
-0000aec0: 696e 6720 6578 6365 7074 696f 6e20 6974  ing exception it
-0000aed0: 2072 6574 7572 6e20 656d 7074 7920 7374   return empty st
-0000aee0: 7269 6e67 2e20 2222 220a 2020 2020 2020  ring. """.      
-0000aef0: 2020 6b65 7973 203d 206b 6579 732e 7370    keys = keys.sp
-0000af00: 6c69 7428 273a 2729 0a20 2020 2020 2020  lit(':').       
-0000af10: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
-0000af20: 2020 7265 7420 3d20 7365 6c66 2e5f 5f67    ret = self.__g
-0000af30: 6574 4669 656c 6456 616c 7565 2873 656c  etFieldValue(sel
-0000af40: 662e 6966 646f 5f74 6d70 2c6b 6579 7329  f.ifdo_tmp,keys)
-0000af50: 0a20 2020 2020 2020 2065 7863 6570 7420  .        except 
-0000af60: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
-0000af70: 696f 6e3a 0a20 2020 2020 2020 2020 2020  ion:.           
-0000af80: 2072 6574 203d 2022 220a 2020 2020 2020   ret = "".      
-0000af90: 2020 7265 7475 726e 2072 6574 0a0a 0a20    return ret... 
-0000afa0: 2020 2064 6566 2073 6574 6946 444f 4865     def setiFDOHe
-0000afb0: 6164 6572 4669 656c 6473 2873 656c 662c  aderFields(self,
-0000afc0: 2068 6561 6465 723a 2064 6963 7429 3a0a   header: dict):.
-0000afd0: 2020 2020 2020 2020 2222 2220 436c 6561          """ Clea
-0000afe0: 7273 2063 7572 7265 6e74 2068 6561 6465  rs current heade
-0000aff0: 7220 6669 656c 6473 2075 6e64 2073 6574  r fields und set
-0000b000: 7320 7072 6f76 6964 6564 2066 6965 6c64  s provided field
-0000b010: 2076 616c 7565 732e 2046 6f72 2075 7064   values. For upd
-0000b020: 6174 696e 6720 6578 6973 7469 6e67 206f  ating existing o
-0000b030: 6e65 7320 7573 6520 7570 6461 7465 5f69  nes use update_i
-0000b040: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
-0000b050: 7328 2920 2222 220a 2020 2020 2020 2020  s() """.        
-0000b060: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000b070: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000b080: 724b 6579 5d20 3d20 7b7d 0a20 2020 2020  rKey] = {}.     
-0000b090: 2020 2069 6620 7365 6c66 2e69 6d61 6765     if self.image
-0000b0a0: 5365 7448 6561 6465 724b 6579 2069 6e20  SetHeaderKey in 
-0000b0b0: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
-0000b0c0: 2020 2020 6865 6164 6572 203d 2068 6561      header = hea
-0000b0d0: 6465 725b 7365 6c66 2e69 6d61 6765 5365  der[self.imageSe
-0000b0e0: 7448 6561 6465 724b 6579 5d0a 2020 2020  tHeaderKey].    
-0000b0f0: 2020 2020 666f 7220 6669 656c 6420 696e      for field in
-0000b100: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
-0000b110: 2020 2020 2023 6966 2066 6965 6c64 206e       #if field n
-0000b120: 6f74 2069 6e20 6d69 7174 762e 6966 646f  ot in miqtv.ifdo
-0000b130: 5f68 6561 6465 725f 636f 7265 5f66 6965  _header_core_fie
-0000b140: 6c64 733a 0a20 2020 2020 2020 2020 2020  lds:.           
-0000b150: 2023 2020 2020 7365 6c66 2e70 726f 762e   #    self.prov.
-0000b160: 6c6f 6728 2243 6175 7469 6f6e 2120 556e  log("Caution! Un
-0000b170: 6b6e 6f77 6e20 6865 6164 6572 2066 6965  known header fie
-0000b180: 6c64 205c 2222 202b 2066 6965 6c64 202b  ld \"" + field +
-0000b190: 2022 5c22 2e20 4d61 7962 6520 6120 7479   "\". Maybe a ty
-0000b1a0: 706f 3f20 4f74 6865 7277 6973 6520 6967  po? Otherwise ig
-0000b1b0: 6e6f 7265 206d 652e 2229 0a20 2020 2020  nore me.").     
-0000b1c0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
-0000b1d0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000b1e0: 6574 4865 6164 6572 4b65 795d 5b66 6965  etHeaderKey][fie
-0000b1f0: 6c64 5d20 3d20 6865 6164 6572 5b66 6965  ld] = header[fie
-0000b200: 6c64 5d0a 0a0a 2020 2020 6465 6620 7570  ld]...    def up
-0000b210: 6461 7465 5f69 6664 6f5f 6865 6164 6572  date_ifdo_header
-0000b220: 5f66 6965 6c64 7328 7365 6c66 2c20 6865  _fields(self, he
-0000b230: 6164 6572 3a20 6469 6374 293a 0a20 2020  ader: dict):.   
-0000b240: 2020 2020 2022 2222 2055 7064 6174 6573       """ Updates
-0000b250: 2065 7869 7374 696e 6720 6865 6164 6572   existing header
-0000b260: 2066 6965 6c64 7320 2222 220a 2020 2020   fields """.    
-0000b270: 2020 2020 6966 2073 656c 662e 696d 6167      if self.imag
-0000b280: 6553 6574 4865 6164 6572 4b65 7920 696e  eSetHeaderKey in
-0000b290: 2068 6561 6465 723a 0a20 2020 2020 2020   header:.       
-0000b2a0: 2020 2020 2068 6561 6465 7220 3d20 6865       header = he
-0000b2b0: 6164 6572 5b73 656c 662e 696d 6167 6553  ader[self.imageS
-0000b2c0: 6574 4865 6164 6572 4b65 795d 0a20 2020  etHeaderKey].   
-0000b2d0: 2020 2020 206c 6f67 203d 206d 6971 7463       log = miqtc
-0000b2e0: 2e72 6563 7572 7369 7665 6c79 5570 6461  .recursivelyUpda
-0000b2f0: 7465 4469 6374 7328 7365 6c66 2e69 6664  teDicts(self.ifd
-0000b300: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000b310: 5365 7448 6561 6465 724b 6579 5d2c 2068  SetHeaderKey], h
-0000b320: 6561 6465 7229 0a20 2020 2020 2020 2073  eader).        s
-0000b330: 656c 662e 7072 6f76 2e6c 6f67 286c 6f67  elf.prov.log(log
-0000b340: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
-0000b350: 0a20 2020 2064 6566 2075 7064 6174 6569  .    def updatei
-0000b360: 4644 4f48 6561 6465 7246 6965 6c64 7328  FDOHeaderFields(
-0000b370: 7365 6c66 2c20 6865 6164 6572 3a20 6469  self, header: di
-0000b380: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
-0000b390: 2044 6570 7265 6361 7465 6420 2d20 7573   Deprecated - us
-0000b3a0: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
-0000b3b0: 6164 6572 5f66 6965 6c64 7320 2222 220a  ader_fields """.
-0000b3c0: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
-0000b3d0: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
-0000b3e0: 6669 656c 6473 2868 6561 6465 7229 0a0a  fields(header)..
-0000b3f0: 0a20 2020 2064 6566 205f 7472 795f 7570  .    def _try_up
-0000b400: 6772 6164 655f 746f 5f69 6664 6f5f 7665  grade_to_ifdo_ve
-0000b410: 7273 696f 6e5f 3278 2873 656c 6629 3a0a  rsion_2x(self):.
-0000b420: 2020 2020 2020 2020 2222 2220 5472 7920          """ Try 
-0000b430: 746f 2063 6f6e 7665 7274 2066 6965 6c64  to convert field
-0000b440: 7320 6672 6f6d 2069 4644 4f20 7665 7273  s from iFDO vers
-0000b450: 696f 6e20 3c20 322e 302e 3020 746f 2032  ion < 2.0.0 to 2
-0000b460: 2e78 2022 2222 0a20 2020 2020 2020 2072  .x """.        r
-0000b470: 6561 645f 7665 7273 696f 6e5f 7374 7220  ead_version_str 
-0000b480: 3d20 2276 312e 302e 3022 2023 2064 6964  = "v1.0.0" # did
-0000b490: 206e 6f74 2068 6176 6520 7468 6520 2769   not have the 'i
-0000b4a0: 6d61 6765 2d73 6574 2d69 6664 6f2d 7665  mage-set-ifdo-ve
-0000b4b0: 7273 696f 6e27 2066 6965 6c64 2079 6574  rsion' field yet
-0000b4c0: 0a20 2020 2020 2020 2074 7279 3a20 0a20  .        try: . 
-0000b4d0: 2020 2020 2020 2020 2020 2072 6561 645f             read_
-0000b4e0: 7665 7273 696f 6e5f 7374 7220 3d20 7365  version_str = se
-0000b4f0: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
-0000b500: 2769 6d61 6765 2d73 6574 2d69 6664 6f2d  'image-set-ifdo-
-0000b510: 7665 7273 696f 6e27 290a 2020 2020 2020  version').      
-0000b520: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-0000b530: 6664 6f45 7863 6570 7469 6f6e 3a0a 2020  fdoException:.  
-0000b540: 2020 2020 2020 2020 2020 7061 7373 0a20            pass. 
-0000b550: 2020 2020 2020 2072 6561 645f 7665 7273         read_vers
-0000b560: 696f 6e20 3d20 5665 7273 696f 6e28 7265  ion = Version(re
-0000b570: 6164 5f76 6572 7369 6f6e 5f73 7472 290a  ad_version_str).
-0000b580: 0a20 2020 2020 2020 2069 6620 7265 6164  .        if read
-0000b590: 5f76 6572 7369 6f6e 203c 2056 6572 7369  _version < Versi
-0000b5a0: 6f6e 2822 322e 302e 3022 293a 0a20 2020  on("2.0.0"):.   
-0000b5b0: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-0000b5c0: 2020 2020 2020 2320 6e65 7720 5552 4920        # new URI 
-0000b5d0: 6f62 6a65 6374 2066 6965 6c64 730a 2020  object fields.  
-0000b5e0: 2020 2020 2020 2020 2020 6e65 775f 7572            new_ur
-0000b5f0: 695f 6669 656c 6473 203d 205b 2769 6d61  i_fields = ['ima
-0000b600: 6765 2d73 656e 736f 7227 2c27 696d 6167  ge-sensor','imag
-0000b610: 652d 6576 656e 7427 2c27 696d 6167 652d  e-event','image-
-0000b620: 7072 6f6a 6563 7427 2c27 696d 6167 652d  project','image-
-0000b630: 636f 6e74 6578 7427 2c27 696d 6167 652d  context','image-
-0000b640: 6c69 6365 6e73 6527 2c27 696d 6167 652d  license','image-
-0000b650: 706c 6174 666f 726d 275d 0a20 2020 2020  platform'].     
-0000b660: 2020 2020 2020 2066 6f72 2075 7269 5f66         for uri_f
-0000b670: 6965 6c64 2069 6e20 6e65 775f 7572 695f  ield in new_uri_
-0000b680: 6669 656c 6473 3a0a 2020 2020 2020 2020  fields:.        
-0000b690: 2020 2020 2020 2020 6f6c 645f 7374 725f          old_str_
-0000b6a0: 7661 6c20 3d20 7365 6c66 2e66 696e 6454  val = self.findT
-0000b6b0: 6d70 4669 656c 6432 2875 7269 5f66 6965  mpField2(uri_fie
-0000b6c0: 6c64 290a 2020 2020 2020 2020 2020 2020  ld).            
-0000b6d0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
-0000b6e0: 6528 6f6c 645f 7374 725f 7661 6c2c 7374  e(old_str_val,st
-0000b6f0: 7229 2061 6e64 206f 6c64 5f73 7472 5f76  r) and old_str_v
-0000b700: 616c 2021 3d20 2222 3a20 2020 2020 2020  al != "":       
-0000b710: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-0000b720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b730: 2020 6e65 775f 6f62 6a5f 7661 6c20 3d20    new_obj_val = 
-0000b740: 7b27 6e61 6d65 273a 206f 6c64 5f73 7472  {'name': old_str
-0000b750: 5f76 616c 7d0a 2020 2020 2020 2020 2020  _val}.          
-0000b760: 2020 2020 2020 2020 2020 6973 5f75 7269            is_uri
-0000b770: 2c20 6d73 6720 3d20 6d69 7174 742e 7661  , msg = miqtt.va
-0000b780: 6c69 6461 7465 5f61 6761 696e 7374 5f73  lidate_against_s
-0000b790: 6368 656d 6128 6f6c 645f 7374 725f 7661  chema(old_str_va
-0000b7a0: 6c2c 7b22 7479 7065 223a 2022 7374 7269  l,{"type": "stri
-0000b7b0: 6e67 222c 2266 6f72 6d61 7422 3a20 2275  ng","format": "u
-0000b7c0: 7269 227d 290a 2020 2020 2020 2020 2020  ri"}).          
-0000b7d0: 2020 2020 2020 2020 2020 6966 2069 735f            if is_
-0000b7e0: 7572 693a 0a20 2020 2020 2020 2020 2020  uri:.           
-0000b7f0: 2020 2020 2020 2020 2020 2020 206e 6577               new
-0000b800: 5f6f 626a 5f76 616c 5b27 7572 6927 5d20  _obj_val['uri'] 
-0000b810: 3d20 6f6c 645f 7374 725f 7661 6c0a 2020  = old_str_val.  
-0000b820: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000b830: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000b840: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000b850: 6465 724b 6579 5d5b 7572 695f 6669 656c  derKey][uri_fiel
-0000b860: 645d 203d 206e 6577 5f6f 626a 5f76 616c  d] = new_obj_val
-0000b870: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000b880: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000b890: 6f67 2822 4175 746f 2d75 7067 7261 6465  og("Auto-upgrade
-0000b8a0: 6420 2220 2b20 7572 695f 6669 656c 6420  d " + uri_field 
-0000b8b0: 2b20 2220 6672 6f6d 2022 202b 206f 6c64  + " from " + old
-0000b8c0: 5f73 7472 5f76 616c 202b 2022 2074 6f20  _str_val + " to 
-0000b8d0: 2220 2b20 7374 7228 6e65 775f 6f62 6a5f  " + str(new_obj_
-0000b8e0: 7661 6c29 290a 0a0a 0a20 2020 2064 6566  val))....    def
-0000b8f0: 2074 7279 4175 746f 5365 7448 6561 6465   tryAutoSetHeade
-0000b900: 7246 6965 6c64 7328 7365 6c66 293a 0a20  rFields(self):. 
-0000b910: 2020 2020 2020 2022 2222 2053 6574 7320         """ Sets 
-0000b920: 6365 7274 6169 6e20 6865 6164 6572 2066  certain header f
-0000b930: 6965 6c64 7320 652e 672e 2066 726f 6d20  ields e.g. from 
-0000b940: 6469 7265 6374 6f72 7920 6966 2074 6865  directory if the
-0000b950: 7920 6172 6520 6e6f 7420 7365 7420 7965  y are not set ye
-0000b960: 7420 2222 220a 0a20 2020 2020 2020 2069  t """..        i
-0000b970: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
-0000b980: 656c 6432 2827 696d 6167 652d 7365 6e73  eld2('image-sens
-0000b990: 6f72 2729 203d 3d20 2222 3a0a 2020 2020  or') == "":.    
-0000b9a0: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
-0000b9b0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
-0000b9c0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
-0000b9d0: 6d61 6765 2d73 656e 736f 7227 5d20 3d20  mage-sensor'] = 
-0000b9e0: 7b27 6e61 6d65 273a 2073 656c 662e 6469  {'name': self.di
-0000b9f0: 722e 7365 6e73 6f72 2829 7d0a 2020 2020  r.sensor()}.    
-0000ba00: 2020 2020 656c 6966 2073 656c 662e 6669      elif self.fi
-0000ba10: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
-0000ba20: 652d 7365 6e73 6f72 2729 5b27 6e61 6d65  e-sensor')['name
-0000ba30: 275d 2021 3d20 7365 6c66 2e64 6972 2e73  '] != self.dir.s
-0000ba40: 656e 736f 7228 293a 0a20 2020 2020 2020  ensor():.       
-0000ba50: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000ba60: 6f67 2822 4361 7574 696f 6e21 2027 696d  og("Caution! 'im
-0000ba70: 6167 652d 7365 6e73 6f72 2720 222b 2073  age-sensor' "+ s
-0000ba80: 7472 2873 656c 662e 6669 6e64 546d 7046  tr(self.findTmpF
-0000ba90: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
-0000baa0: 6f72 2729 2920 2b20 2220 6469 6666 6572  or')) + " differ
-0000bab0: 7320 6672 6f6d 2073 656e 736f 7220 7061  s from sensor pa
-0000bac0: 7273 6564 2066 726f 6d20 6469 7265 6374  rsed from direct
-0000bad0: 6f72 793a 2022 202b 2073 656c 662e 6469  ory: " + self.di
-0000bae0: 722e 7365 6e73 6f72 2829 290a 0a20 2020  r.sensor())..   
-0000baf0: 2020 2020 2069 6620 7365 6c66 2e66 696e       if self.fin
-0000bb00: 6454 6d70 4669 656c 6432 2827 696d 6167  dTmpField2('imag
-0000bb10: 652d 6576 656e 7427 2920 3d3d 2022 223a  e-event') == "":
-0000bb20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000bb30: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000bb40: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000bb50: 795d 5b27 696d 6167 652d 6576 656e 7427  y]['image-event'
-0000bb60: 5d20 3d20 7b27 6e61 6d65 273a 2073 656c  ] = {'name': sel
-0000bb70: 662e 6469 722e 6576 656e 7428 297d 0a20  f.dir.event()}. 
-0000bb80: 2020 2020 2020 2065 6c69 6620 7365 6c66         elif self
-0000bb90: 2e66 696e 6454 6d70 4669 656c 6428 2769  .findTmpField('i
-0000bba0: 6d61 6765 2d65 7665 6e74 2729 5b27 6e61  mage-event')['na
-0000bbb0: 6d65 275d 2021 3d20 7365 6c66 2e64 6972  me'] != self.dir
-0000bbc0: 2e65 7665 6e74 2829 3a0a 2020 2020 2020  .event():.      
-0000bbd0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000bbe0: 6c6f 6728 2243 6175 7469 6f6e 2120 2769  log("Caution! 'i
-0000bbf0: 6d61 6765 2d65 7665 6e74 2720 2220 2b20  mage-event' " + 
-0000bc00: 7374 7228 7365 6c66 2e66 696e 6454 6d70  str(self.findTmp
-0000bc10: 4669 656c 6428 2769 6d61 6765 2d65 7665  Field('image-eve
-0000bc20: 6e74 2729 2920 2b20 2220 6469 6666 6572  nt')) + " differ
-0000bc30: 7320 6672 6f6d 2065 7665 6e74 2070 6172  s from event par
-0000bc40: 7365 6420 6672 6f6d 2064 6972 6563 746f  sed from directo
-0000bc50: 7279 3a20 2220 2b20 7365 6c66 2e64 6972  ry: " + self.dir
-0000bc60: 2e65 7665 6e74 2829 290a 0a20 2020 2020  .event())..     
-0000bc70: 2020 2069 6620 7365 6c66 2e66 696e 6454     if self.findT
-0000bc80: 6d70 4669 656c 6432 2827 696d 6167 652d  mpField2('image-
-0000bc90: 7072 6f6a 6563 7427 2920 3d3d 2022 223a  project') == "":
-0000bca0: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
-0000bcb0: 662e 6966 646f 5f74 6d70 5b73 656c 662e  f.ifdo_tmp[self.
-0000bcc0: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-0000bcd0: 795d 5b27 696d 6167 652d 7072 6f6a 6563  y]['image-projec
-0000bce0: 7427 5d20 3d20 207b 276e 616d 6527 3a20  t'] =  {'name': 
-0000bcf0: 7365 6c66 2e64 6972 2e70 726f 6a65 6374  self.dir.project
-0000bd00: 2829 7d0a 2020 2020 2020 2020 656c 6966  ()}.        elif
-0000bd10: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000bd20: 6c64 2827 696d 6167 652d 7072 6f6a 6563  ld('image-projec
-0000bd30: 7427 295b 276e 616d 6527 5d20 213d 2073  t')['name'] != s
-0000bd40: 656c 662e 6469 722e 7072 6f6a 6563 7428  elf.dir.project(
-0000bd50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
-0000bd60: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
-0000bd70: 7574 696f 6e21 2027 696d 6167 652d 7072  ution! 'image-pr
-0000bd80: 6f6a 6563 7427 2022 202b 2073 7472 2873  oject' " + str(s
-0000bd90: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0000bda0: 2827 696d 6167 652d 7072 6f6a 6563 7427  ('image-project'
-0000bdb0: 2929 202b 2022 2064 6966 6665 7273 2066  )) + " differs f
-0000bdc0: 726f 6d20 7072 6f6a 6563 7420 7061 7273  rom project pars
-0000bdd0: 6564 2066 726f 6d20 6469 7265 6374 6f72  ed from director
-0000bde0: 793a 2022 202b 2073 656c 662e 6469 722e  y: " + self.dir.
-0000bdf0: 7072 6f6a 6563 7428 2929 0a0a 2020 2020  project())..    
-0000be00: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
-0000be10: 546d 7046 6965 6c64 3228 2769 6d61 6765  TmpField2('image
-0000be20: 2d70 6c61 7466 6f72 6d27 2920 3d3d 2022  -platform') == "
-0000be30: 2220 616e 6420 7365 6c66 2e64 6972 2e67  " and self.dir.g
-0000be40: 6561 7228 2920 213d 2022 223a 0a20 2020  ear() != "":.   
-0000be50: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
-0000be60: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000be70: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0000be80: 696d 6167 652d 706c 6174 666f 726d 275d  image-platform']
-0000be90: 203d 207b 276e 616d 6527 3a20 7365 6c66   = {'name': self
-0000bea0: 2e64 6972 2e67 6561 7228 297d 0a0a 2020  .dir.gear()}..  
-0000beb0: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
-0000bec0: 6167 652d 7365 742d 7575 6964 2720 696e  age-set-uuid' in
-0000bed0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-0000bee0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-0000bef0: 6572 4b65 795d 3a0a 2020 2020 2020 2020  erKey]:.        
-0000bf00: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
-0000bf10: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
-0000bf20: 6561 6465 724b 6579 5d5b 2769 6d61 6765  eaderKey]['image
-0000bf30: 2d73 6574 2d75 7569 6427 5d20 3d20 7374  -set-uuid'] = st
-0000bf40: 7228 6d69 7174 632e 7575 6964 3428 2929  r(miqtc.uuid4())
-0000bf50: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000bf60: 2769 6d61 6765 2d73 6574 2d68 616e 646c  'image-set-handl
-0000bf70: 6527 2069 6e20 7365 6c66 2e69 6664 6f5f  e' in self.ifdo_
-0000bf80: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000bf90: 7448 6561 6465 724b 6579 5d3a 0a20 2020  tHeaderKey]:.   
-0000bfa0: 2020 2020 2020 2020 2073 656c 662e 6966           self.if
-0000bfb0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000bfc0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
-0000bfd0: 696d 6167 652d 7365 742d 6861 6e64 6c65  image-set-handle
-0000bfe0: 275d 203d 2073 656c 662e 6861 6e64 6c65  '] = self.handle
-0000bff0: 5f70 7265 6669 7820 2b20 222f 2220 2b20  _prefix + "/" + 
-0000c000: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000c010: 6428 2769 6d61 6765 2d73 6574 2d75 7569  d('image-set-uui
-0000c020: 6427 290a 2020 2020 2020 2020 6966 206e  d').        if n
-0000c030: 6f74 2027 696d 6167 652d 7365 742d 6e61  ot 'image-set-na
-0000c040: 6d65 2720 696e 2073 656c 662e 6966 646f  me' in self.ifdo
-0000c050: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000c060: 6574 4865 6164 6572 4b65 795d 206f 7220  etHeaderKey] or 
-0000c070: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
-0000c080: 6432 2827 696d 6167 652d 7365 742d 6e61  d2('image-set-na
-0000c090: 6d65 2729 203d 3d20 2222 3a0a 2020 2020  me') == "":.    
-0000c0a0: 2020 2020 2020 2020 2320 636f 6e73 7472          # constr
-0000c0b0: 7563 7420 6173 203c 7072 6f6a 6563 743e  uct as <project>
-0000c0c0: 5f3c 6576 656e 743e 5f3c 7365 6e73 6f72  _<event>_<sensor
-0000c0d0: 3e0a 2020 2020 2020 2020 2020 2020 7072  >.            pr
-0000c0e0: 6f6a 6563 745f 203d 2073 656c 662e 6669  oject_ = self.fi
-0000c0f0: 6e64 546d 7046 6965 6c64 3228 2269 6d61  ndTmpField2("ima
-0000c100: 6765 2d70 726f 6a65 6374 2229 5b27 6e61  ge-project")['na
-0000c110: 6d65 275d 0a20 2020 2020 2020 2020 2020  me'].           
-0000c120: 2065 7665 6e74 5f20 3d20 7365 6c66 2e66   event_ = self.f
-0000c130: 696e 6454 6d70 4669 656c 6432 2822 696d  indTmpField2("im
-0000c140: 6167 652d 6576 656e 7422 295b 276e 616d  age-event")['nam
-0000c150: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
-0000c160: 6966 2065 7665 6e74 5f20 3d3d 2022 223a  if event_ == "":
-0000c170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000c180: 2065 7665 6e74 5f20 3d20 7365 6c66 2e64   event_ = self.d
-0000c190: 6972 2e65 7665 6e74 2829 0a20 2020 2020  ir.event().     
-0000c1a0: 2020 2020 2020 2073 656e 736f 725f 203d         sensor_ =
-0000c1b0: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
-0000c1c0: 6c64 3228 2269 6d61 6765 2d73 656e 736f  ld2("image-senso
-0000c1d0: 7222 295b 276e 616d 6527 5d0a 2020 2020  r")['name'].    
-0000c1e0: 2020 2020 2020 2020 6966 2073 656e 736f          if senso
-0000c1f0: 725f 203d 3d20 2222 3a0a 2020 2020 2020  r_ == "":.      
-0000c200: 2020 2020 2020 2020 2020 7365 6e73 6f72            sensor
-0000c210: 5f20 3d20 7365 6c66 2e64 6972 2e73 656e  _ = self.dir.sen
-0000c220: 736f 7228 290a 2020 2020 2020 2020 2020  sor().          
-0000c230: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
-0000c240: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000c250: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
-0000c260: 6574 2d6e 616d 6527 5d20 3d20 6946 444f  et-name'] = iFDO
-0000c270: 2e63 6f6e 7374 7275 6374 496d 6167 6553  .constructImageS
-0000c280: 6574 4e61 6d65 2870 726f 6a65 6374 5f2c  etName(project_,
-0000c290: 6576 656e 745f 2c73 656e 736f 725f 290a  event_,sensor_).
-0000c2a0: 0a20 2020 2020 2020 2023 2073 6574 2076  .        # set v
-0000c2b0: 6572 7369 6f6e 0a20 2020 2020 2020 2073  ersion.        s
-0000c2c0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000c2d0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000c2e0: 4b65 795d 5b27 696d 6167 652d 7365 742d  Key]['image-set-
-0000c2f0: 6966 646f 2d76 6572 7369 6f6e 275d 203d  ifdo-version'] =
-0000c300: 206d 6971 7476 2e69 4644 4f5f 7665 7273   miqtv.iFDO_vers
-0000c310: 696f 6e0a 0a0a 2020 2020 6465 6620 7365  ion...    def se
-0000c320: 7448 6561 6465 7249 6d61 6765 4c6f 6361  tHeaderImageLoca
-0000c330: 6c50 6174 6846 6965 6c64 2873 656c 6629  lPathField(self)
-0000c340: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
-0000c350: 7473 2068 6561 6465 7220 6669 656c 6420  ts header field 
-0000c360: 2769 6d61 6765 2d6c 6f63 616c 2d70 6174  'image-local-pat
-0000c370: 6827 2066 726f 6d20 696d 6167 6520 6469  h' from image di
-0000c380: 7220 2222 220a 2020 2020 2020 2020 7365  r """.        se
-0000c390: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-0000c3a0: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000c3b0: 6579 5d5b 2769 6d61 6765 2d6c 6f63 616c  ey]['image-local
-0000c3c0: 2d70 6174 6827 5d20 3d20 6f73 2e70 6174  -path'] = os.pat
-0000c3d0: 682e 7265 6c70 6174 6828 7365 6c66 2e69  h.relpath(self.i
-0000c3e0: 6d61 6765 7344 6972 2c20 6f73 2e70 6174  magesDir, os.pat
-0000c3f0: 682e 6469 726e 616d 6528 7365 6c66 2e67  h.dirname(self.g
-0000c400: 6574 6946 444f 4669 6c65 4e61 6d65 2829  etiFDOFileName()
-0000c410: 2929 0a0a 0a20 2020 2064 6566 2063 7265  ))...    def cre
-0000c420: 6174 655f 6669 656c 6473 2873 656c 662c  ate_fields(self,
-0000c430: 2061 6c6c 6f77 5f6d 6973 7369 6e67 5f72   allow_missing_r
-0000c440: 6571 7569 7265 643d 4661 6c73 6529 3a0a  equired=False):.
-0000c450: 2020 2020 2020 2020 2222 2220 4372 6561          """ Crea
-0000c460: 7465 2061 6e64 2076 616c 6964 6174 6520  te and validate 
-0000c470: 6375 7272 656e 7420 6865 6164 6572 2066  current header f
-0000c480: 6965 6c64 7320 616e 6420 6974 656d 2066  ields and item f
-0000c490: 6965 6c64 7320 6672 6f6d 2069 6e74 6572  ields from inter
-0000c4a0: 6d65 6469 6174 6520 6669 6c65 732e 204f  mediate files. O
-0000c4b0: 7665 7277 7269 7465 7320 6578 6973 7469  verwrites existi
-0000c4c0: 6e67 2066 6965 6c64 732e 2022 2222 0a20  ng fields. """. 
-0000c4d0: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
-0000c4e0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
-0000c4f0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
-0000c500: 726d 6564 6961 7465 5f66 696c 6573 2829  rmediate_files()
-0000c510: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c520: 7365 6c66 2e63 7265 6174 6569 4644 4f28  self.createiFDO(
-0000c530: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000c540: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000c550: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
-0000c560: 2e76 616c 7565 7328 292c 2061 6c6c 6f77  .values(), allow
-0000c570: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
-0000c580: 643d 616c 6c6f 775f 6d69 7373 696e 675f  d=allow_missing_
-0000c590: 7265 7175 6972 6564 290a 0a0a 2020 2020  required)...    
-0000c5a0: 6465 6620 7570 6461 7465 5f66 6965 6c64  def update_field
-0000c5b0: 7328 7365 6c66 2c20 6865 6164 6572 5f6f  s(self, header_o
-0000c5c0: 6e6c 793a 626f 6f6c 3d4e 6f6e 6529 3a0a  nly:bool=None):.
-0000c5d0: 2020 2020 2020 2020 2222 2220 5570 6461          """ Upda
-0000c5e0: 7465 2061 6e64 2076 616c 6964 6174 6520  te and validate 
-0000c5f0: 6375 7272 656e 7420 6865 6164 6572 2066  current header f
-0000c600: 6965 6c64 7320 616e 6420 6974 656d 2066  ields and item f
-0000c610: 6965 6c64 7320 6672 6f6d 2069 6e74 6572  ields from inter
-0000c620: 6d65 6469 6174 6520 6669 6c65 732e 2022  mediate files. "
-0000c630: 2222 0a20 2020 2020 2020 2069 6620 6865  "".        if he
-0000c640: 6164 6572 5f6f 6e6c 7920 6973 204e 6f6e  ader_only is Non
-0000c650: 653a 0a20 2020 2020 2020 2020 2020 2068  e:.            h
-0000c660: 6561 6465 725f 6f6e 6c79 203d 2073 656c  eader_only = sel
-0000c670: 662e 6967 6e6f 7265 5f69 6d61 6765 5f66  f.ignore_image_f
-0000c680: 696c 6573 0a20 2020 2020 2020 2069 6620  iles.        if 
-0000c690: 6e6f 7420 6865 6164 6572 5f6f 6e6c 793a  not header_only:
-0000c6a0: 0a20 2020 2020 2020 2020 2020 2069 7465  .            ite
-0000c6b0: 6d5f 6461 7461 203d 2073 656c 662e 5f67  m_data = self._g
-0000c6c0: 6574 5f69 7465 6d5f 6461 7461 5f66 726f  et_item_data_fro
-0000c6d0: 6d5f 696e 7465 726d 6564 6961 7465 5f66  m_intermediate_f
-0000c6e0: 696c 6573 2829 0a20 2020 2020 2020 2020  iles().         
-0000c6f0: 2020 2072 6574 7572 6e20 7365 6c66 2e75     return self.u
-0000c700: 7064 6174 6569 4644 4f28 7365 6c66 2e69  pdateiFDO(self.i
-0000c710: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-0000c720: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
-0000c730: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
-0000c740: 7328 2929 0a20 2020 2020 2020 2065 6c73  s()).        els
-0000c750: 653a 0a20 2020 2020 2020 2020 2020 2072  e:.            r
-0000c760: 6574 7572 6e20 7365 6c66 2e75 7064 6174  eturn self.updat
-0000c770: 6569 4644 4f28 7365 6c66 2e69 6664 6f5f  eiFDO(self.ifdo_
-0000c780: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000c790: 7448 6561 6465 724b 6579 5d2c 205b 5d2c  tHeaderKey], [],
-0000c7a0: 2068 6561 6465 725f 6f6e 6c79 3d54 7275   header_only=Tru
-0000c7b0: 6529 0a0a 0a20 2020 2064 6566 2063 7265  e)...    def cre
-0000c7c0: 6174 6543 6f72 6546 6965 6c64 7328 7365  ateCoreFields(se
-0000c7d0: 6c66 293a 0a20 2020 2020 2020 2022 2222  lf):.        """
-0000c7e0: 2044 4550 5245 4341 4445 542c 2075 7365   DEPRECADET, use
-0000c7f0: 2063 7265 6174 655f 6669 656c 6473 2829   create_fields()
-0000c800: 206f 7220 7570 6461 7465 5f66 6965 6c64   or update_field
-0000c810: 7328 2920 696e 7374 6564 2e0a 2020 2020  s() insted..    
-0000c820: 2020 2020 4669 6c6c 7320 7468 6520 6946      Fills the iF
-0000c830: 444f 2063 6f72 6520 6669 656c 6473 2066  DO core fields f
-0000c840: 726f 6d20 696e 7465 726d 6564 6961 7465  rom intermediate
-0000c850: 2066 696c 6573 2e20 5769 7468 6f75 7420   files. Without 
-0000c860: 7468 656d 206e 6f20 7661 6c69 6420 6946  them no valid iF
-0000c870: 444f 2063 616e 2062 6520 6372 6561 7465  DO can be create
-0000c880: 642e 0a20 2020 2020 2020 2022 2222 0a20  d..        """. 
-0000c890: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
-0000c8a0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
-0000c8b0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
-0000c8c0: 726d 6564 6961 7465 5f66 696c 6573 5f63  rmediate_files_c
-0000c8d0: 6f72 6528 290a 2020 2020 2020 2020 2320  ore().        # 
-0000c8e0: 6368 6563 6b20 6669 656c 6473 2066 6f72  check fields for
-0000c8f0: 2076 616c 6964 6974 790a 2020 2020 2020   validity.      
-0000c900: 2020 2320 6974 656d 5f64 6174 6120 636f    # item_data co
-0000c910: 6e74 6169 6e73 2066 6965 6c64 2069 6d61  ntains field ima
-0000c920: 6765 2d66 696c 656e 616d 652c 2077 6869  ge-filename, whi
-0000c930: 6368 2077 6869 6368 2077 696c 6c20 6e6f  ch which will no
-0000c940: 7420 6265 2073 746f 7265 6420 6173 2061  t be stored as a
-0000c950: 6e20 6974 656d 2066 6965 6c64 2069 6e20  n item field in 
-0000c960: 6946 4f44 2062 7574 2061 7320 7468 6520  iFOD but as the 
-0000c970: 6974 656d 206e 616d 6520 6974 7365 6c66  item name itself
-0000c980: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0000c990: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
-0000c9a0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-0000c9b0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-0000c9c0: 724b 6579 5d2c 2069 7465 6d5f 6461 7461  rKey], item_data
-0000c9d0: 2e76 616c 7565 7328 2929 0a0a 0a20 2020  .values())...   
-0000c9e0: 2064 6566 2063 7265 6174 6543 6170 7475   def createCaptu
-0000c9f0: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
-0000ca00: 6473 2873 656c 6629 3a0a 2020 2020 2020  ds(self):.      
-0000ca10: 2020 2222 2220 4445 5052 4543 4144 4554    """ DEPRECADET
-0000ca20: 2c20 7573 6520 6372 6561 7465 5f66 6965  , use create_fie
-0000ca30: 6c64 7328 2920 6f72 2075 7064 6174 655f  lds() or update_
-0000ca40: 6669 656c 6473 2829 2069 6e73 7465 642e  fields() insted.
-0000ca50: 0a20 2020 2020 2020 2046 696c 6c73 2074  .        Fills t
-0000ca60: 6865 2069 4644 4f20 6361 7075 7472 6520  he iFDO caputre 
-0000ca70: 616e 6420 636f 6e74 656e 7420 6669 6564  and content fied
-0000ca80: 7320 6672 6f6d 2070 726f 7669 6465 6420  s from provided 
-0000ca90: 6461 7461 2066 6965 6c64 7320 0a20 2020  data fields .   
-0000caa0: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
-0000cab0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
-0000cac0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
-0000cad0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
-0000cae0: 7465 5f66 696c 6573 5f6e 6f6e 655f 636f  te_files_none_co
-0000caf0: 7265 2829 0a20 2020 2020 2020 2023 2063  re().        # c
-0000cb00: 6865 636b 2066 6965 6c64 7320 666f 7220  heck fields for 
-0000cb10: 7661 6c69 6469 7479 0a20 2020 2020 2020  validity.       
-0000cb20: 2023 2069 7465 6d5f 6461 7461 2063 6f6e   # item_data con
-0000cb30: 7461 696e 7320 6669 656c 6420 696d 6167  tains field imag
-0000cb40: 652d 6669 6c65 6e61 6d65 2c20 7768 6963  e-filename, whic
-0000cb50: 6820 7768 6963 6820 7769 6c6c 206e 6f74  h which will not
-0000cb60: 2062 6520 7374 6f72 6564 2061 7320 616e   be stored as an
-0000cb70: 2069 7465 6d20 6669 656c 6420 696e 2069   item field in i
-0000cb80: 464f 4420 6275 7420 6173 2074 6865 2069  FOD but as the i
-0000cb90: 7465 6d20 6e61 6d65 2069 7473 656c 660a  tem name itself.
-0000cba0: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-0000cbb0: 656c 662e 7570 6461 7465 6946 444f 2873  elf.updateiFDO(s
-0000cbc0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
-0000cbd0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000cbe0: 4b65 795d 2c20 6974 656d 5f64 6174 612e  Key], item_data.
-0000cbf0: 7661 6c75 6573 2829 290a 0a20 2020 200a  values())..    .
-0000cc00: 2020 2020 6465 6620 5f67 6574 5f69 7465      def _get_ite
-0000cc10: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
-0000cc20: 726d 6564 6961 7465 5f66 696c 6573 2873  rmediate_files(s
-0000cc30: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-0000cc40: 2220 5265 6164 2064 6174 6120 6672 6f6d  " Read data from
-0000cc50: 2063 6f72 6520 616e 6420 6e6f 6e65 2d63   core and none-c
-0000cc60: 6f72 6520 696e 7465 726d 6465 6174 6520  ore intermdeate 
-0000cc70: 6669 6c65 732c 2063 6865 636b 2066 696c  files, check fil
-0000cc80: 6573 2065 7869 7374 2c20 6164 6420 2769  es exist, add 'i
-0000cc90: 6d61 6765 2d68 616e 646c 6527 2e0a 2020  mage-handle'..  
-0000cca0: 2020 2020 2020 5265 7475 726e 7320 6469        Returns di
-0000ccb0: 6374 206f 6620 666f 726d 207b 696d 6167  ct of form {imag
-0000ccc0: 652d 6669 6c65 2d6e 616d 653a 7b66 6965  e-file-name:{fie
-0000ccd0: 6c64 3a76 616c 7565 7d2c 2e2e 2e7d 200a  ld:value},...} .
-0000cce0: 2020 2020 2020 2020 2222 220a 2020 2020          """.    
-0000ccf0: 2020 2020 6974 656d 5f64 6174 615f 636f      item_data_co
-0000cd00: 7265 203d 2073 656c 662e 5f67 6574 5f69  re = self._get_i
-0000cd10: 7465 6d5f 6461 7461 5f66 726f 6d5f 696e  tem_data_from_in
-0000cd20: 7465 726d 6564 6961 7465 5f66 696c 6573  termediate_files
-0000cd30: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
-0000cd40: 6974 656d 5f64 6174 615f 6e6f 6e65 5f63  item_data_none_c
-0000cd50: 6f72 6520 3d20 7365 6c66 2e5f 6765 745f  ore = self._get_
-0000cd60: 6974 656d 5f64 6174 615f 6672 6f6d 5f69  item_data_from_i
-0000cd70: 6e74 6572 6d65 6469 6174 655f 6669 6c65  ntermediate_file
-0000cd80: 735f 6e6f 6e65 5f63 6f72 6528 290a 2020  s_none_core().  
-0000cd90: 2020 2020 2020 2370 7072 696e 7428 6974        #pprint(it
-0000cda0: 656d 5f64 6174 615f 6e6f 6e65 5f63 6f72  em_data_none_cor
-0000cdb0: 6529 0a20 2020 2020 2020 2023 7070 7269  e).        #ppri
-0000cdc0: 6e74 2869 7465 6d5f 6461 7461 5f63 6f72  nt(item_data_cor
-0000cdd0: 6529 0a20 2020 2020 2020 2069 7465 6d5f  e).        item_
-0000cde0: 6461 7461 203d 2069 7465 6d5f 6461 7461  data = item_data
-0000cdf0: 5f63 6f72 650a 2020 2020 2020 2020 6c6f  _core.        lo
-0000ce00: 6720 3d20 6d69 7174 632e 7265 6375 7273  g = miqtc.recurs
-0000ce10: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
-0000ce20: 2869 7465 6d5f 6461 7461 2c20 6974 656d  (item_data, item
-0000ce30: 5f64 6174 615f 6e6f 6e65 5f63 6f72 6529  _data_none_core)
-0000ce40: 0a20 2020 2020 2020 2023 7070 7269 6e74  .        #pprint
-0000ce50: 2869 7465 6d5f 6461 7461 290a 2020 2020  (item_data).    
-0000ce60: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000ce70: 6728 6c6f 672c 646f 6e74 5368 6f77 3d54  g(log,dontShow=T
-0000ce80: 7275 6529 0a20 2020 2020 2020 2072 6574  rue).        ret
-0000ce90: 7572 6e20 6974 656d 5f64 6174 610a 0a20  urn item_data.. 
-0000cea0: 2020 2064 6566 205f 6765 745f 6974 656d     def _get_item
-0000ceb0: 5f64 6174 615f 6672 6f6d 5f69 6e74 6572  _data_from_inter
-0000cec0: 6d65 6469 6174 655f 6669 6c65 735f 6e6f  mediate_files_no
-0000ced0: 6e65 5f63 6f72 6528 7365 6c66 293a 0a20  ne_core(self):. 
-0000cee0: 2020 2020 2020 2022 2222 2052 6561 6420         """ Read 
-0000cef0: 6461 7461 2066 726f 6d20 6e6f 6e2d 636f  data from non-co
-0000cf00: 7265 2069 6e74 6572 6d64 6561 7465 2066  re intermdeate f
-0000cf10: 696c 6573 2e0a 2020 2020 2020 2020 5265  iles..        Re
-0000cf20: 7475 726e 7320 6469 6374 206f 6620 666f  turns dict of fo
-0000cf30: 726d 207b 696d 6167 652d 6669 6c65 2d6e  rm {image-file-n
-0000cf40: 616d 653a 7b66 6965 6c64 3a76 616c 7565  ame:{field:value
-0000cf50: 7d2c 2e2e 2e7d 200a 2020 2020 2020 2020  },...} .        
-0000cf60: 2222 220a 2020 2020 2020 2020 7265 7120  """.        req 
-0000cf70: 3d20 7365 6c66 2e6e 6f6e 436f 7265 4669  = self.nonCoreFi
-0000cf80: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
-0000cf90: 7465 6d49 6e66 6f46 696c 6573 0a0a 2020  temInfoFiles..  
-0000cfa0: 2020 2020 2020 6974 656d 5f64 6174 6120        item_data 
-0000cfb0: 3d20 7b7d 0a20 2020 2020 2020 2066 6f72  = {}.        for
-0000cfc0: 2072 2069 6e20 7265 713a 0a20 2020 2020   r in req:.     
-0000cfd0: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-0000cfe0: 682e 6578 6973 7473 2872 2e66 696c 654e  h.exists(r.fileN
-0000cff0: 616d 6529 3a0a 2020 2020 2020 2020 2020  ame):.          
-0000d000: 2020 2020 2020 7365 6c66 2e70 7261 7365        self.prase
-0000d010: 4974 656d 4461 7461 4672 6f6d 4669 6c65  ItemDataFromFile
-0000d020: 2869 7465 6d5f 6461 7461 2c72 2e66 696c  (item_data,r.fil
-0000d030: 654e 616d 652c 722e 7365 7061 7261 746f  eName,r.separato
-0000d040: 722c 722e 6865 6164 6572 2c20 722e 6461  r,r.header, r.da
-0000d050: 7465 7469 6d65 5f66 6f72 6d61 7429 0a20  tetime_format). 
-0000d060: 2020 2020 2020 2020 2020 2020 2020 2073                 s
-0000d070: 656c 662e 7072 6f76 2e6c 6f67 2822 5061  elf.prov.log("Pa
-0000d080: 7273 6564 2069 7465 6d20 6461 7461 2066  rsed item data f
-0000d090: 726f 6d3a 2022 202b 2072 2e66 696c 654e  rom: " + r.fileN
-0000d0a0: 616d 6529 0a20 2020 2020 2020 2020 2020  ame).           
-0000d0b0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-0000d0c0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000d0d0: 2e6c 6f67 2822 4669 6c65 2064 6f65 7320  .log("File does 
-0000d0e0: 6e6f 7420 6578 6973 7473 3a20 2220 2b20  not exists: " + 
-0000d0f0: 722e 6669 6c65 4e61 6d65 290a 0a20 2020  r.fileName)..   
-0000d100: 2020 2020 2023 2063 6865 636b 2066 696c       # check fil
-0000d110: 6573 2065 7869 7374 0a20 2020 2020 2020  es exist.       
-0000d120: 2072 656d 6f76 6520 3d20 5b5d 0a20 2020   remove = [].   
-0000d130: 2020 2020 2066 6f72 2069 6d67 2069 6e20       for img in 
-0000d140: 6974 656d 5f64 6174 613a 0a20 2020 2020  item_data:.     
-0000d150: 2020 2020 2020 2069 6620 6e6f 7420 696d         if not im
-0000d160: 6720 696e 2073 656c 662e 5f69 6d61 6765  g in self._image
-0000d170: 4e61 6d65 7349 6d61 6765 7344 6972 3a0a  NamesImagesDir:.
-0000d180: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000d190: 7265 6d6f 7665 2e61 7070 656e 6428 696d  remove.append(im
-0000d1a0: 6729 0a20 2020 2020 2020 2066 6f72 2069  g).        for i
-0000d1b0: 6d67 2069 6e20 7265 6d6f 7665 3a0a 2020  mg in remove:.  
-0000d1c0: 2020 2020 2020 2020 2020 6465 6c20 6974            del it
-0000d1d0: 656d 5f64 6174 615b 696d 675d 0a0a 2020  em_data[img]..  
-0000d1e0: 2020 2020 2020 7265 7475 726e 2069 7465        return ite
-0000d1f0: 6d5f 6461 7461 0a0a 0a20 2020 2064 6566  m_data...    def
-0000d200: 205f 6765 745f 6974 656d 5f64 6174 615f   _get_item_data_
-0000d210: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
-0000d220: 655f 6669 6c65 735f 636f 7265 2873 656c  e_files_core(sel
-0000d230: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
-0000d240: 5265 6164 2064 6174 6120 6672 6f6d 2063  Read data from c
-0000d250: 6f72 6520 696e 7465 726d 6465 6174 6520  ore intermdeate 
-0000d260: 6669 6c65 732c 2063 6865 636b 2066 696c  files, check fil
-0000d270: 6573 2065 7869 7374 2c20 6164 6420 2769  es exist, add 'i
-0000d280: 6d61 6765 2d68 616e 646c 6527 2e0a 2020  mage-handle'..  
-0000d290: 2020 2020 2020 5265 7475 726e 7320 6469        Returns di
-0000d2a0: 6374 206f 6620 666f 726d 207b 696d 6167  ct of form {imag
-0000d2b0: 652d 6669 6c65 2d6e 616d 653a 7b66 6965  e-file-name:{fie
-0000d2c0: 6c64 3a76 616c 7565 7d2c 2e2e 2e7d 200a  ld:value},...} .
-0000d2d0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
-0000d2e0: 2020 2020 2023 2057 6869 6368 2066 696c       # Which fil
-0000d2f0: 6573 2063 6f6e 7461 696e 2074 6865 2069  es contain the i
-0000d300: 6e66 6f72 6d61 7469 6f6e 206e 6565 6465  nformation neede
-0000d310: 6420 746f 2063 7265 6174 6520 7468 6520  d to create the 
-0000d320: 6946 444f 2069 7465 6d73 2063 6f72 6520  iFDO items core 
-0000d330: 696e 666f 726d 6174 696f 6e20 616e 6420  information and 
-0000d340: 7768 6963 6820 636f 6c75 6d6e 7320 7368  which columns sh
-0000d350: 616c 6c20 6265 2075 7365 640a 2020 2020  all be used.    
-0000d360: 2020 2020 7265 7120 3d20 7365 6c66 2e69      req = self.i
-0000d370: 6e74 6572 6d65 6469 6174 6546 696c 6573  ntermediateFiles
-0000d380: 4465 665f 636f 7265 0a0a 2020 2020 2020  Def_core..      
-0000d390: 2020 6974 656d 5f64 6174 6120 3d20 7b7d    item_data = {}
-0000d3a0: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
-0000d3b0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
-0000d3c0: 5072 6f67 7265 7373 4d73 6728 2250 6172  ProgressMsg("Par
-0000d3d0: 7369 6e67 2069 6e74 6572 6d65 6469 6174  sing intermediat
-0000d3e0: 6520 6461 7461 222c 206c 656e 2872 6571  e data", len(req
-0000d3f0: 2929 0a20 2020 2020 2020 2066 6f72 2072  )).        for r
-0000d400: 2069 6e20 7265 713a 0a20 2020 2020 2020   in req:.       
-0000d410: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
-0000d420: 7373 2829 0a20 2020 2020 2020 2020 2020  ss().           
-0000d430: 2066 696c 6520 3d20 7365 6c66 2e5f 5f67   file = self.__g
-0000d440: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-0000d450: 6978 2829 202b 2072 6571 5b72 5d5b 2773  ix() + req[r]['s
-0000d460: 7566 6669 7827 5d0a 2020 2020 2020 2020  uffix'].        
-0000d470: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-0000d480: 7468 2e65 7869 7374 7328 6669 6c65 293a  th.exists(file):
-0000d490: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d4a0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000d4b0: 5741 524e 494e 4721 2046 6f72 2061 6368  WARNING! For ach
-0000d4c0: 6965 7669 6e67 2046 4149 526e 6573 7320  ieving FAIRness 
-0000d4d0: 616e 2069 6e74 6572 6d65 6469 6174 6520  an intermediate 
-0000d4e0: 696d 6167 6520 696e 666f 2066 696c 6520  image info file 
-0000d4f0: 6973 206d 6973 7369 6e67 3a20 222b 2073  is missing: "+ s
-0000d500: 656c 662e 5f5f 6765 745f 696e 745f 6669  elf.__get_int_fi
-0000d510: 6c65 5f70 7265 6669 7828 2920 2b20 7265  le_prefix() + re
-0000d520: 715b 725d 5b27 7375 6666 6978 275d 2b20  q[r]['suffix']+ 
-0000d530: 2220 7275 6e20 6669 7273 743a 2022 202b  " run first: " +
-0000d540: 2072 6571 5b72 5d5b 2763 7265 6174 696f   req[r]['creatio
-0000d550: 6e46 6374 275d 290a 2020 2020 2020 2020  nFct']).        
-0000d560: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
-0000d570: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000d580: 6172 7365 4974 656d 4461 7461 6672 6f6d  arseItemDatafrom
-0000d590: 5461 6246 696c 6544 6174 6128 6974 656d  TabFileData(item
-0000d5a0: 5f64 6174 612c 2066 696c 652c 2072 6571  _data, file, req
-0000d5b0: 5b72 5d5b 2763 6f6c 7327 5d2c 2072 6571  [r]['cols'], req
-0000d5c0: 5b72 5d5b 276f 7074 696f 6e61 6c27 5d29  [r]['optional'])
-0000d5d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d5e0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-0000d5f0: 5061 7273 6564 2069 7465 6d20 6461 7461  Parsed item data
-0000d600: 2066 726f 6d3a 2022 202b 2066 696c 6529   from: " + file)
-0000d610: 0a0a 2020 2020 2020 2020 7072 6f67 2e63  ..        prog.c
-0000d620: 6c65 6172 2829 0a20 2020 2020 2020 2069  lear().        i
-0000d630: 6620 6c65 6e28 6974 656d 5f64 6174 6129  f len(item_data)
-0000d640: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
-0000d650: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-0000d660: 6f6e 2822 4e6f 2069 4644 4f20 6974 656d  on("No iFDO item
-0000d670: 7322 290a 0a20 2020 2020 2020 2023 2063  s")..        # c
-0000d680: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
-0000d690: 0a20 2020 2020 2020 2072 656d 6f76 6520  .        remove 
-0000d6a0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
-0000d6b0: 2069 6d67 2069 6e20 6974 656d 5f64 6174   img in item_dat
-0000d6c0: 613a 0a20 2020 2020 2020 2020 2020 2069  a:.            i
-0000d6d0: 6620 6e6f 7420 696d 6720 696e 2073 656c  f not img in sel
-0000d6e0: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
-0000d6f0: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
-0000d700: 2020 2020 2020 2020 7265 6d6f 7665 2e61          remove.a
-0000d710: 7070 656e 6428 696d 6729 0a20 2020 2020  ppend(img).     
-0000d720: 2020 2066 6f72 2069 6d67 2069 6e20 7265     for img in re
-0000d730: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
-0000d740: 2020 6465 6c20 6974 656d 5f64 6174 615b    del item_data[
-0000d750: 696d 675d 0a0a 2020 2020 2020 2020 2320  img]..        # 
-0000d760: 6164 6420 696d 6167 652d 7572 6c0a 2020  add image-url.  
-0000d770: 2020 2020 2020 666f 7220 696d 6720 696e        for img in
-0000d780: 2069 7465 6d5f 6461 7461 3a0a 2020 2020   item_data:.    
-0000d790: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
-0000d7a0: 7461 6e63 6528 6974 656d 5f64 6174 615b  tance(item_data[
-0000d7b0: 696d 675d 2c6c 6973 7429 3a20 2320 6974  img],list): # it
-0000d7c0: 656d 2069 7320 616c 7265 6164 7920 6120  em is already a 
-0000d7d0: 6c69 7374 2028 7669 6465 6f29 2062 7574  list (video) but
-0000d7e0: 2070 6172 7365 6420 6461 7461 2069 7320   parsed data is 
-0000d7f0: 6e6f 742c 2069 2e65 2e20 7061 7273 6564  not, i.e. parsed
-0000d800: 2064 6174 6120 7265 6665 7273 2074 6f20   data refers to 
-0000d810: 7768 6f6c 6520 7669 6465 6f20 2874 696d  whole video (tim
-0000d820: 6520 696e 6465 7065 6e64 656e 7429 2c20  e independent), 
-0000d830: 692e 652e 2077 7269 7465 2074 6f20 6669  i.e. write to fi
-0000d840: 7273 7420 656e 7472 790a 2020 2020 2020  rst entry.      
-0000d850: 2020 2020 2020 2020 2020 7575 6964 203d            uuid =
-0000d860: 2066 696e 6446 6965 6c64 2869 7465 6d5f   findField(item_
-0000d870: 6461 7461 5b69 6d67 5d5b 305d 2c27 696d  data[img][0],'im
-0000d880: 6167 652d 7575 6964 2729 0a20 2020 2020  age-uuid').     
-0000d890: 2020 2020 2020 2020 2020 2069 6620 7575             if uu
-0000d8a0: 6964 203d 3d20 2222 3a0a 2020 2020 2020  id == "":.      
-0000d8b0: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-0000d8c0: 696e 7428 6974 656d 5f64 6174 615b 696d  int(item_data[im
-0000d8d0: 675d 290a 2020 2020 2020 2020 2020 2020  g]).            
-0000d8e0: 2020 2020 2020 2020 7261 6973 6520 6d69          raise mi
-0000d8f0: 7174 632e 4966 646f 4578 6365 7074 696f  qtc.IfdoExceptio
-0000d900: 6e28 2275 7569 6420 6e6f 7420 666f 756e  n("uuid not foun
-0000d910: 6420 2861 2922 290a 2020 2020 2020 2020  d (a)").        
-0000d920: 2020 2020 2020 2020 6974 656d 5f64 6174          item_dat
-0000d930: 615b 696d 675d 5b30 5d5b 2769 6d61 6765  a[img][0]['image
-0000d940: 2d68 616e 646c 6527 5d20 3d20 7365 6c66  -handle'] = self
-0000d950: 2e69 6d61 6765 5f68 616e 646c 655f 7072  .image_handle_pr
-0000d960: 6566 6978 202b 2027 4027 202b 2075 7569  efix + '@' + uui
-0000d970: 640a 2020 2020 2020 2020 2020 2020 656c  d.            el
-0000d980: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-0000d990: 2020 2020 7575 6964 203d 2066 696e 6446      uuid = findF
-0000d9a0: 6965 6c64 2869 7465 6d5f 6461 7461 5b69  ield(item_data[i
-0000d9b0: 6d67 5d2c 2769 6d61 6765 2d75 7569 6427  mg],'image-uuid'
-0000d9c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-0000d9d0: 2020 6966 2075 7569 6420 3d3d 2022 223a    if uuid == "":
-0000d9e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0000d9f0: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
-0000da00: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
-0000da10: 7575 6964 206e 6f74 2066 6f75 6e64 2028  uuid not found (
-0000da20: 6229 2229 0a20 2020 2020 2020 2020 2020  b)").           
-0000da30: 2020 2020 2069 7465 6d5f 6461 7461 5b69       item_data[i
-0000da40: 6d67 5d5b 2769 6d61 6765 2d68 616e 646c  mg]['image-handl
-0000da50: 6527 5d20 3d20 7365 6c66 2e69 6d61 6765  e'] = self.image
-0000da60: 5f68 616e 646c 655f 7072 6566 6978 202b  _handle_prefix +
-0000da70: 2027 4027 202b 2075 7569 640a 0a20 2020   '@' + uuid..   
-0000da80: 2020 2020 2072 6574 7572 6e20 6974 656d       return item
-0000da90: 5f64 6174 610a 0a0a 2020 2020 6465 6620  _data...    def 
-0000daa0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-0000dab0: 625f 6669 6c65 2873 656c 662c 2066 696c  b_file(self, fil
-0000dac0: 654e 616d 653a 2073 7472 2c20 7365 7061  eName: str, sepa
-0000dad0: 7261 746f 723a 7374 722c 2068 6561 6465  rator:str, heade
-0000dae0: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
-0000daf0: 5f66 6f72 6d61 7420 3d20 6d69 7174 762e  _format = miqtv.
-0000db00: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0000db10: 7269 7174 275d 293a 0a20 2020 2020 2020  riqt']):.       
-0000db20: 2022 2222 2041 6464 2061 2063 6f6c 756d   """ Add a colum
-0000db30: 6e20 7365 7065 7261 7465 6420 7465 7874  n seperated text
-0000db40: 2066 696c 6520 746f 2070 6172 7365 2069   file to parse i
-0000db50: 7465 6d20 6461 7461 2066 726f 6d20 6279  tem data from by
-0000db60: 2063 7265 6174 6543 6170 7475 7265 416e   createCaptureAn
-0000db70: 6443 6f6e 7465 6e74 4669 656c 6473 2829  dContentFields()
-0000db80: 2e20 0a20 2020 2020 2020 2043 6f6c 756d  . .        Colum
-0000db90: 6e73 2068 6561 6465 7273 2077 696c 6c20  ns headers will 
-0000dba0: 6265 2073 6574 2061 7320 6974 656d 2066  be set as item f
-0000dbb0: 6965 6c64 206e 616d 6573 2e20 4d75 7374  ield names. Must
-0000dbc0: 2063 6f6e 7461 696e 2063 6f6c 756d 6e20   contain column 
-0000dbd0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
-0000dbe0: 2e0a 2020 2020 2020 2020 2222 220a 2020  ..        """.  
-0000dbf0: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
-0000dc00: 6520 3d3d 204e 6f6e 6520 6f72 206e 6f74  e == None or not
-0000dc10: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-0000dc20: 6669 6c65 4e61 6d65 293a 0a20 2020 2020  fileName):.     
-0000dc30: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000dc40: 6570 7469 6f6e 2822 4669 6c65 222c 6669  eption("File",fi
-0000dc50: 6c65 4e61 6d65 2c22 6e6f 7420 666f 756e  leName,"not foun
-0000dc60: 6422 290a 0a20 2020 2020 2020 2066 6f72  d")..        for
-0000dc70: 2066 6965 6c64 2069 6e20 6865 6164 6572   field in header
-0000dc80: 3a0a 2020 2020 2020 2020 2020 2020 6966  :.            if
-0000dc90: 2068 6561 6465 725b 6669 656c 645d 206e   header[field] n
-0000dca0: 6f74 2069 6e20 6d69 7174 662e 7461 6246  ot in miqtf.tabF
-0000dcb0: 696c 6543 6f6c 756d 6e4e 616d 6573 2866  ileColumnNames(f
-0000dcc0: 696c 654e 616d 652c 636f 6c5f 7365 7061  ileName,col_sepa
-0000dcd0: 7261 746f 723d 7365 7061 7261 746f 7229  rator=separator)
-0000dce0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0000dcf0: 2020 7261 6973 6520 4578 6365 7074 696f    raise Exceptio
-0000dd00: 6e28 2243 6f6c 756d 6e22 2c20 6865 6164  n("Column", head
-0000dd10: 6572 5b66 6965 6c64 5d2c 2022 6e6f 7420  er[field], "not 
-0000dd20: 696e 2066 696c 6522 2c20 6669 6c65 4e61  in file", fileNa
-0000dd30: 6d65 290a 0a20 2020 2020 2020 2069 6620  me)..        if 
-0000dd40: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
-0000dd50: 6828 6f73 2e70 6174 682e 6469 726e 616d  h(os.path.dirnam
-0000dd60: 6528 6669 6c65 4e61 6d65 2929 2021 3d20  e(fileName)) != 
-0000dd70: 6d69 7174 632e 6173 7365 7274 536c 6173  miqtc.assertSlas
-0000dd80: 6828 7365 6c66 2e64 6972 2e74 6f28 7365  h(self.dir.to(se
-0000dd90: 6c66 2e64 6972 2e64 742e 696e 7465 726d  lf.dir.dt.interm
-0000dda0: 6564 6961 7465 2929 3a0a 2020 2020 2020  ediate)):.      
-0000ddb0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-0000ddc0: 6c6f 6728 2022 4361 7574 696f 6e21 2049  log( "Caution! I
-0000ddd0: 7420 6973 2072 6563 6f6d 6d65 6e64 6564  t is recommended
-0000dde0: 2074 6f20 7075 7420 6669 6c65 2069 6e20   to put file in 
-0000ddf0: 7468 6520 6469 7265 6374 6f72 7927 7320  the directory's 
-0000de00: 2769 6e74 6572 6d65 6469 6174 6527 2066  'intermediate' f
-0000de10: 6f6c 6465 723a 2022 202b 2066 696c 654e  older: " + fileN
-0000de20: 616d 6529 0a20 2020 2020 2020 206e 6366  ame).        ncf
-0000de30: 6969 6620 3d20 6e6f 6e43 6f72 6546 6965  iif = nonCoreFie
-0000de40: 6c64 496e 7465 726d 6564 6961 7465 4974  ldIntermediateIt
-0000de50: 656d 496e 666f 4669 6c65 2866 696c 654e  emInfoFile(fileN
-0000de60: 616d 652c 2073 6570 6172 6174 6f72 2c20  ame, separator, 
-0000de70: 6865 6164 6572 2c20 6461 7465 7469 6d65  header, datetime
-0000de80: 5f66 6f72 6d61 7429 0a20 2020 2020 2020  _format).       
-0000de90: 2069 6620 6e63 6669 6966 206e 6f74 2069   if ncfiif not i
-0000dea0: 6e20 7365 6c66 2e6e 6f6e 436f 7265 4669  n self.nonCoreFi
-0000deb0: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
-0000dec0: 7465 6d49 6e66 6f46 696c 6573 3a20 0a20  temInfoFiles: . 
-0000ded0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000dee0: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-0000def0: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-0000df00: 4669 6c65 732e 6170 7065 6e64 286e 6366  Files.append(ncf
-0000df10: 6969 6629 0a0a 2020 2020 6465 6620 6164  iif)..    def ad
-0000df20: 6449 7465 6d49 6e66 6f54 6162 4669 6c65  dItemInfoTabFile
-0000df30: 2873 656c 662c 2066 696c 654e 616d 653a  (self, fileName:
-0000df40: 2073 7472 2c20 7365 7061 7261 746f 723a   str, separator:
-0000df50: 7374 722c 2068 6561 6465 723a 6469 6374  str, header:dict
-0000df60: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0000df70: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
-0000df80: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
-0000df90: 293a 0a20 2020 2020 2020 2022 2222 2044  ):.        """ D
-0000dfa0: 6570 7265 6361 7465 6420 2d20 7573 6520  eprecated - use 
-0000dfb0: 6164 645f 6974 656d 5f69 6e66 6f5f 7461  add_item_info_ta
-0000dfc0: 625f 6669 6c65 2022 2222 0a20 2020 2020  b_file """.     
-0000dfd0: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
-0000dfe0: 5f69 6e66 6f5f 7461 625f 6669 6c65 2866  _info_tab_file(f
-0000dff0: 696c 654e 616d 652c 7365 7061 7261 746f  ileName,separato
-0000e000: 722c 6865 6164 6572 2c64 6174 6574 696d  r,header,datetim
-0000e010: 655f 666f 726d 6174 290a 0a20 2020 2020  e_format)..     
-0000e020: 2020 200a 2020 2020 6465 6620 7265 6d6f     .    def remo
-0000e030: 7665 4974 656d 496e 666f 5461 6246 696c  veItemInfoTabFil
-0000e040: 6528 7365 6c66 2c20 6669 6c65 4e61 6d65  e(self, fileName
-0000e050: 3a20 7374 722c 2073 6570 6172 6174 6f72  : str, separator
-0000e060: 3a73 7472 2c20 6865 6164 6572 3a64 6963  :str, header:dic
-0000e070: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
-0000e080: 6174 3a73 7472 293a 0a20 2020 2020 2020  at:str):.       
-0000e090: 2022 2222 2072 656d 6f76 6573 2066 696c   """ removes fil
-0000e0a0: 6520 6974 656d 2066 726f 6d20 6c69 7374  e item from list
-0000e0b0: 206f 6620 6669 6c65 7320 746f 2070 6172   of files to par
-0000e0c0: 7365 2069 7465 6d20 6461 7461 2066 726f  se item data fro
-0000e0d0: 6d20 6279 2063 7265 6174 6543 6170 7475  m by createCaptu
-0000e0e0: 7265 416e 6443 6f6e 7465 6e74 4669 656c  reAndContentFiel
-0000e0f0: 6473 2829 2022 2222 0a20 2020 2020 2020  ds() """.       
-0000e100: 206e 6366 6969 6620 3d20 6e6f 6e43 6f72   ncfiif = nonCor
-0000e110: 6546 6965 6c64 496e 7465 726d 6564 6961  eFieldIntermedia
-0000e120: 7465 4974 656d 496e 666f 4669 6c65 2866  teItemInfoFile(f
-0000e130: 696c 654e 616d 652c 2073 6570 6172 6174  ileName, separat
-0000e140: 6f72 2c20 6865 6164 6572 2c20 6461 7465  or, header, date
-0000e150: 7469 6d65 5f66 6f72 6d61 7429 0a20 2020  time_format).   
-0000e160: 2020 2020 2069 6620 6e63 6669 6966 2069       if ncfiif i
-0000e170: 6e20 7365 6c66 2e6e 6f6e 436f 7265 4669  n self.nonCoreFi
-0000e180: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
-0000e190: 7465 6d49 6e66 6f46 696c 6573 3a20 0a20  temInfoFiles: . 
-0000e1a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0000e1b0: 6e6f 6e43 6f72 6546 6965 6c64 496e 7465  nonCoreFieldInte
-0000e1c0: 726d 6564 6961 7465 4974 656d 496e 666f  rmediateItemInfo
-0000e1d0: 4669 6c65 732e 7265 6d6f 7665 286e 6366  Files.remove(ncf
-0000e1e0: 6969 6629 0a0a 0a20 2020 2064 6566 2075  iif)...    def u
-0000e1f0: 7064 6174 6569 4644 4f28 7365 6c66 2c20  pdateiFDO(self, 
-0000e200: 6865 6164 6572 3a20 6469 6374 2c20 6974  header: dict, it
-0000e210: 656d 733a 206c 6973 742c 2068 6561 6465  ems: list, heade
-0000e220: 725f 6f6e 6c79 3d46 616c 7365 293a 0a20  r_only=False):. 
-0000e230: 2020 2020 2020 2022 2222 2055 7064 6174         """ Updat
-0000e240: 6573 2074 6865 2063 7572 7265 6e74 2076  es the current v
-0000e250: 616c 7565 7320 6946 444f 2077 6974 6820  alues iFDO with 
-0000e260: 7468 6520 7072 6f76 6964 6564 206e 6577  the provided new
-0000e270: 2076 616c 7565 7320 2222 220a 2020 2020   values """.    
-0000e280: 2020 2020 7265 7475 726e 2073 656c 662e      return self.
-0000e290: 6372 6561 7465 6946 444f 2868 6561 6465  createiFDO(heade
-0000e2a0: 722c 2069 7465 6d73 2c20 7570 6461 7465  r, items, update
-0000e2b0: 4578 6973 7469 6e67 3d54 7275 652c 2068  Existing=True, h
-0000e2c0: 6561 6465 724f 6e6c 793d 6865 6164 6572  eaderOnly=header
-0000e2d0: 5f6f 6e6c 7929 0a0a 0a20 2020 2064 6566  _only)...    def
-0000e2e0: 2063 7265 6174 6569 4644 4f28 7365 6c66   createiFDO(self
-0000e2f0: 2c20 6865 6164 6572 3a20 6469 6374 2c20  , header: dict, 
-0000e300: 6974 656d 733a 206c 6973 742c 2075 7064  items: list, upd
-0000e310: 6174 6545 7869 7374 696e 673d 4661 6c73  ateExisting=Fals
-0000e320: 652c 6865 6164 6572 4f6e 6c79 3d46 616c  e,headerOnly=Fal
-0000e330: 7365 2c61 6c6c 6f77 5f6d 6973 7369 6e67  se,allow_missing
-0000e340: 5f72 6571 7569 7265 643d 4661 6c73 652c  _required=False,
-0000e350: 7661 6c69 6461 7465 5f73 696e 676c 655f  validate_single_
-0000e360: 6974 656d 733d 4661 6c73 6529 3a0a 2020  items=False):.  
-0000e370: 2020 2020 2020 2222 2220 4372 6561 7465        """ Create
-0000e380: 7320 4641 4952 2064 6967 6974 616c 206f  s FAIR digital o
-0000e390: 626a 6563 7420 666f 7220 7468 6520 696d  bject for the im
-0000e3a0: 6167 6520 6461 7461 2069 7473 656c 662e  age data itself.
-0000e3b0: 2054 6869 7320 636f 6e73 6973 7473 206f   This consists o
-0000e3c0: 6620 6865 6164 6572 2069 6e66 6f72 6d61  f header informa
-0000e3d0: 7469 6f6e 2061 6e64 2069 7465 6d20 696e  tion and item in
-0000e3e0: 666f 726d 6174 696f 6e2e 0a20 2020 2020  formation..     
-0000e3f0: 2020 2075 7064 6174 6545 7869 7374 696e     updateExistin
-0000e400: 673a 2069 6620 4661 6c73 6520 6f6c 6420  g: if False old 
-0000e410: 7661 6c75 6573 2061 7265 2072 656d 6f76  values are remov
-0000e420: 6564 2c20 6f74 6865 7277 6973 6520 7468  ed, otherwise th
-0000e430: 6579 2061 7265 2075 7064 6174 6564 2e0a  ey are updated..
-0000e440: 2020 2020 2020 2020 6865 6164 6572 4f6e          headerOn
-0000e450: 6c79 3a20 6966 2054 7275 6520 6974 656d  ly: if True item
-0000e460: 7320 6d61 7920 6265 2065 6d70 7479 206c  s may be empty l
-0000e470: 6973 742e 0a20 2020 2020 2020 2061 6c6c  ist..        all
-0000e480: 6f77 5f6d 6973 7369 6e67 5f72 6571 7569  ow_missing_requi
-0000e490: 7265 643a 2069 6620 5472 7565 2c20 6e6f  red: if True, no
-0000e4a0: 2065 7863 6570 7469 6f6e 2072 6973 656e   exception risen
-0000e4b0: 2069 6620 6120 7265 7175 6972 6564 2066   if a required f
-0000e4c0: 6965 6c64 2069 7320 6d69 7373 696e 672e  ield is missing.
-0000e4d0: 2020 2222 220a 0a20 2020 2020 2020 2069    """..        i
-0000e4e0: 6620 6e6f 7420 7570 6461 7465 4578 6973  f not updateExis
-0000e4f0: 7469 6e67 2061 6e64 206c 656e 2869 7465  ting and len(ite
-0000e500: 6d73 2920 3d3d 2030 2061 6e64 206e 6f74  ms) == 0 and not
-0000e510: 2068 6561 6465 724f 6e6c 793a 0a20 2020   headerOnly:.   
-0000e520: 2020 2020 2020 2020 2072 6169 7365 2045           raise E
-0000e530: 7863 6570 7469 6f6e 2827 4e6f 2069 7465  xception('No ite
-0000e540: 6d20 696e 666f 726d 6174 696f 6e20 6769  m information gi
-0000e550: 7665 6e27 290a 0a20 2020 2020 2020 2069  ven')..        i
-0000e560: 6620 7570 6461 7465 4578 6973 7469 6e67  f updateExisting
-0000e570: 3a0a 2020 2020 2020 2020 2020 2020 2320  :.            # 
-0000e580: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
-0000e590: 2020 2073 656c 662e 7570 6461 7465 5f69     self.update_i
-0000e5a0: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
-0000e5b0: 7328 6865 6164 6572 290a 2020 2020 2020  s(header).      
-0000e5c0: 2020 2020 2020 2320 6974 656d 730a 2020        # items.  
-0000e5d0: 2020 2020 2020 2020 2020 2320 7570 6461            # upda
-0000e5e0: 7465 2063 6f70 7920 6f66 2063 7572 7265  te copy of curre
-0000e5f0: 6e74 2069 7465 6d73 2077 6974 6820 6e65  nt items with ne
-0000e600: 7720 6974 656d 7320 6669 656c 6473 0a20  w items fields. 
-0000e610: 2020 2020 2020 2020 2020 2069 7465 6d73             items
-0000e620: 4469 6374 203d 206d 6971 7469 2e63 7265  Dict = miqti.cre
-0000e630: 6174 6549 6d61 6765 4974 656d 7344 6963  ateImageItemsDic
-0000e640: 7446 726f 6d49 6d61 6765 4974 656d 734c  tFromImageItemsL
-0000e650: 6973 7428 6974 656d 7329 0a20 2020 2020  ist(items).     
-0000e660: 2020 2020 2020 2075 7064 6174 6564 4974         updatedIt
-0000e670: 656d 735f 636f 7079 203d 2063 6f70 792e  ems_copy = copy.
-0000e680: 6465 6570 636f 7079 2873 656c 662e 6966  deepcopy(self.if
-0000e690: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
-0000e6a0: 6553 6574 4974 656d 734b 6579 5d29 0a20  eSetItemsKey]). 
-0000e6b0: 2020 2020 2020 2020 2020 206c 6f67 203d             log =
-0000e6c0: 206d 6971 7463 2e72 6563 7572 7369 7665   miqtc.recursive
-0000e6d0: 6c79 5570 6461 7465 4469 6374 7328 7570  lyUpdateDicts(up
-0000e6e0: 6461 7465 6449 7465 6d73 5f63 6f70 792c  datedItems_copy,
-0000e6f0: 2069 7465 6d73 4469 6374 290a 2020 2020   itemsDict).    
-0000e700: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
-0000e710: 762e 6c6f 6728 6c6f 672c 646f 6e74 5368  v.log(log,dontSh
-0000e720: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
-0000e730: 2020 2020 2069 7465 6d73 203d 206d 6971       items = miq
-0000e740: 7469 2e63 7265 6174 6549 6d61 6765 4974  ti.createImageIt
-0000e750: 656d 734c 6973 7446 726f 6d49 6d61 6765  emsListFromImage
-0000e760: 4974 656d 7344 6963 7428 7570 6461 7465  ItemsDict(update
-0000e770: 6449 7465 6d73 5f63 6f70 7929 0a0a 2020  dItems_copy)..  
-0000e780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-0000e790: 2020 2020 2020 2020 2320 6f76 6572 7772          # overwr
-0000e7a0: 6974 6520 6865 6164 6572 0a20 2020 2020  ite header.     
-0000e7b0: 2020 2020 2020 2073 656c 662e 7365 7469         self.seti
-0000e7c0: 4644 4f48 6561 6465 7246 6965 6c64 7328  FDOHeaderFields(
-0000e7d0: 6865 6164 6572 290a 2020 2020 2020 2020  header).        
-0000e7e0: 2020 2020 2320 636c 6561 7220 6974 656d      # clear item
-0000e7f0: 7320 7365 6374 696f 6e0a 2020 2020 2020  s section.      
-0000e800: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000e810: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000e820: 7449 7465 6d73 4b65 795d 203d 207b 7d0a  tItemsKey] = {}.
-0000e830: 0a0a 2020 2020 2020 2020 2320 5061 7273  ..        # Pars
-0000e840: 6520 696d 6167 652d 6162 7374 7261 6374  e image-abstract
-0000e850: 2061 6e64 2066 696c 6c20 6974 7320 706c   and fill its pl
-0000e860: 6163 6568 6f6c 6465 7273 2077 6974 6820  aceholders with 
-0000e870: 696e 666f 726d 6174 696f 6e0a 2020 2020  information.    
-0000e880: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0000e890: 2020 2020 2073 656c 662e 6966 646f 5f74       self.ifdo_t
-0000e8a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000e8b0: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-0000e8c0: 652d 6162 7374 7261 6374 275d 203d 206d  e-abstract'] = m
-0000e8d0: 6971 7473 2e70 6172 7365 5265 706c 6163  iqts.parseReplac
-0000e8e0: 6556 616c 2873 656c 662e 6966 646f 5f74  eVal(self.ifdo_t
-0000e8f0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-0000e900: 4865 6164 6572 4b65 795d 2c20 2769 6d61  HeaderKey], 'ima
-0000e910: 6765 2d61 6273 7472 6163 7427 290a 2020  ge-abstract').  
-0000e920: 2020 2020 2020 6578 6365 7074 2045 7863        except Exc
-0000e930: 6570 7469 6f6e 2061 7320 6578 3a0a 2020  eption as ex:.  
-0000e940: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-0000e950: 726f 762e 6c6f 6728 2243 6f75 6c64 206e  rov.log("Could n
-0000e960: 6f74 2072 6570 6c61 6365 206b 6579 7320  ot replace keys 
-0000e970: 696e 205c 2769 6d61 6765 2d61 6273 7472  in \'image-abstr
-0000e980: 6163 745c 273a 2022 202b 2073 7472 2865  act\': " + str(e
-0000e990: 7829 290a 0a0a 2020 2020 2020 2020 2320  x))...        # 
-0000e9a0: 7365 7420 7665 7273 696f 6e20 2873 6f20  set version (so 
-0000e9b0: 6974 2063 616e 6e6f 7420 6265 2063 6861  it cannot be cha
-0000e9c0: 6e67 6564 2062 7920 7573 6572 290a 2020  nged by user).  
-0000e9d0: 2020 2020 2020 7365 6c66 2e69 6664 6f5f        self.ifdo_
-0000e9e0: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
-0000e9f0: 7448 6561 6465 724b 6579 5d5b 2769 6d61  tHeaderKey]['ima
-0000ea00: 6765 2d73 6574 2d69 6664 6f2d 7665 7273  ge-set-ifdo-vers
-0000ea10: 696f 6e27 5d20 3d20 6d69 7174 762e 6946  ion'] = miqtv.iF
-0000ea20: 444f 5f76 6572 7369 6f6e 0a0a 2020 2020  DO_version..    
-0000ea30: 2020 2020 2320 5661 6c69 6461 7465 2069      # Validate i
-0000ea40: 7465 6d20 696e 666f 726d 6174 696f 6e0a  tem information.
-0000ea50: 2020 2020 2020 2020 696d 6167 655f 7365          image_se
-0000ea60: 745f 6974 656d 7320 3d20 7b7d 0a20 2020  t_items = {}.   
-0000ea70: 2020 2020 2069 6620 6865 6164 6572 4f6e       if headerOn
-0000ea80: 6c79 3a0a 2020 2020 2020 2020 2020 2020  ly:.            
-0000ea90: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
-0000eaa0: 6175 7469 6f6e 2120 6946 444f 2063 7265  aution! iFDO cre
-0000eab0: 6174 6564 2069 6e20 6865 6164 6572 5f6f  ated in header_o
-0000eac0: 6e6c 792f 6967 6e6f 7265 5f69 6d61 6765  nly/ignore_image
-0000ead0: 5f66 696c 6520 6d6f 6465 2e20 496d 6167  _file mode. Imag
-0000eae0: 6520 6974 656d 7320 6172 6520 6e65 6974  e items are neit
-0000eaf0: 6865 7220 7570 6461 7465 6420 6e6f 7220  her updated nor 
-0000eb00: 6368 6563 6b65 642e 2229 0a20 2020 2020  checked.").     
-0000eb10: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
-0000eb20: 2020 2020 2069 6e76 616c 6964 5f69 7465       invalid_ite
-0000eb30: 6d73 203d 2030 0a0a 2020 2020 2020 2020  ms = 0..        
-0000eb40: 2020 2020 7072 6f67 203d 206d 6971 7463      prog = miqtc
-0000eb50: 2e50 7269 6e74 4b6e 6f77 6e50 726f 6772  .PrintKnownProgr
-0000eb60: 6573 734d 7367 2822 4368 6563 6b69 6e67  essMsg("Checking
-0000eb70: 2069 7465 6d73 222c 206c 656e 2869 7465   items", len(ite
-0000eb80: 6d73 292c 6d6f 6475 6c6f 3d35 290a 2020  ms),modulo=5).  
-0000eb90: 2020 2020 2020 2020 2020 666f 7220 6974            for it
-0000eba0: 656d 2069 6e20 6974 656d 733a 0a20 2020  em in items:.   
-0000ebb0: 2020 2020 2020 2020 2020 2020 2070 726f               pro
-0000ebc0: 672e 7072 6f67 7265 7373 2829 0a20 2020  g.progress().   
-0000ebd0: 2020 2020 2020 2020 2020 2020 2023 2063               # c
-0000ebe0: 6865 636b 2069 6620 616c 6c20 636f 7265  heck if all core
-0000ebf0: 2066 6965 6c64 7320 6172 6520 6669 6c6c   fields are fill
-0000ec00: 6564 2061 6e64 2061 7265 2066 696c 6c65  ed and are fille
-0000ec10: 6420 7661 6c69 646c 790a 2020 2020 2020  d validly.      
-0000ec20: 2020 2020 2020 2020 2020 7472 793a 0a0a            try:..
-0000ec30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec40: 2020 2020 2320 6368 6563 6b20 6974 656d      # check item
-0000ec50: 2069 6d61 6765 2065 7869 7374 730a 2020   image exists.  
-0000ec60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ec70: 2020 2320 6966 2069 7465 6d20 6973 2061    # if item is a
-0000ec80: 206c 6973 7420 2876 6964 656f 292c 206f   list (video), o
-0000ec90: 6e65 2077 6f75 6c64 2068 6176 6520 746f  ne would have to
-0000eca0: 2063 6865 636b 2069 6620 6561 6368 2065   check if each e
-0000ecb0: 6e74 7279 2069 7320 7661 6c69 6420 6769  ntry is valid gi
-0000ecc0: 7665 6e20 7468 6520 6465 6661 756c 7420  ven the default 
-0000ecd0: 7661 6c75 6573 2069 6e20 6669 7273 7420  values in first 
-0000ece0: 656e 7472 7920 706c 7573 2067 6976 656e  entry plus given
-0000ecf0: 2064 6566 6175 6c74 2076 616c 7565 7320   default values 
-0000ed00: 696e 2068 6561 6465 720a 2020 2020 2020  in header.      
-0000ed10: 2020 2020 2020 2020 2020 2020 2020 6966                if
-0000ed20: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
-0000ed30: 6974 656d 2c6c 6973 7429 3a0a 2020 2020  item,list):.    
-0000ed40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ed50: 2020 2020 6974 656d 203d 205b 6974 656d      item = [item
-0000ed60: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-0000ed70: 2020 2020 2020 7375 6249 7465 6d44 6566        subItemDef
-0000ed80: 6175 6c74 203d 2069 7465 6d5b 305d 200a  ault = item[0] .
-0000ed90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000eda0: 2020 2020 666f 7220 7375 6249 7465 6d20      for subItem 
-0000edb0: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
-0000edc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000edd0: 2066 696c 655f 6e61 6d65 203d 2073 7562   file_name = sub
-0000ede0: 4974 656d 5b27 696d 6167 652d 6669 6c65  Item['image-file
-0000edf0: 6e61 6d65 275d 0a20 2020 2020 2020 2020  name'].         
-0000ee00: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0000ee10: 6620 6e6f 7420 7365 6c66 2e69 676e 6f72  f not self.ignor
-0000ee20: 655f 696d 6167 655f 6669 6c65 7320 616e  e_image_files an
-0000ee30: 6420 6669 6c65 5f6e 616d 6520 6e6f 7420  d file_name not 
-0000ee40: 696e 2073 656c 662e 5f69 6d61 6765 4e61  in self._imageNa
-0000ee50: 6d65 7349 6d61 6765 7344 6972 3a0a 2020  mesImagesDir:.  
-0000ee60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ee70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0000ee80: 4578 6365 7074 696f 6e28 2249 7465 6d20  Exception("Item 
-0000ee90: 2722 202b 2066 696c 655f 6e61 6d65 202b  '" + file_name +
-0000eea0: 2022 2720 6e6f 7420 666f 756e 6420 696e   "' not found in
-0000eeb0: 202f 7261 7720 6469 7265 6374 6f72 792e   /raw directory.
-0000eec0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-0000eed0: 2020 2020 2020 2020 2020 2020 6966 2076              if v
-0000eee0: 616c 6964 6174 655f 7369 6e67 6c65 5f69  alidate_single_i
-0000eef0: 7465 6d73 3a0a 2020 2020 2020 2020 2020  tems:.          
+0000a4b0: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
+0000a4c0: 6e73 7461 6e63 6528 7265 745b 7469 6d65  nstance(ret[time
+0000a4d0: 506f 696e 7444 6174 615b 2769 6d61 6765  PointData['image
+0000a4e0: 2d64 6174 6574 696d 6527 5d5d 2c64 6963  -datetime']],dic
+0000a4f0: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0000a500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a510: 2020 2020 6465 6661 756c 7456 616c 203d      defaultVal =
+0000a520: 207b 2a2a 6465 6661 756c 7456 616c 2c2a   {**defaultVal,*
+0000a530: 2a72 6574 5b74 696d 6550 6f69 6e74 4461  *ret[timePointDa
+0000a540: 7461 5b27 696d 6167 652d 6461 7465 7469  ta['image-dateti
+0000a550: 6d65 275d 5d7d 0a20 2020 2020 2020 2020  me']]}.         
+0000a560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a570: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000a580: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a590: 2020 2020 2020 2020 2064 6566 6175 6c74           default
+0000a5a0: 5661 6c20 3d20 7265 745b 7469 6d65 506f  Val = ret[timePo
+0000a5b0: 696e 7444 6174 615b 2769 6d61 6765 2d64  intData['image-d
+0000a5c0: 6174 6574 696d 6527 5d5d 0a0a 2020 2020  atetime']]..    
+0000a5d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000a5e0: 2020 2020 6920 2b3d 2031 0a0a 2020 2020      i += 1..    
+0000a5f0: 2020 2020 6966 2069 7369 6e73 7461 6e63      if isinstanc
+0000a600: 6528 7265 742c 6469 6374 2920 6f72 2069  e(ret,dict) or i
+0000a610: 7369 6e73 7461 6e63 6528 7265 742c 6c69  sinstance(ret,li
+0000a620: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
+0000a630: 2072 6574 203d 2063 6f70 792e 6465 6570   ret = copy.deep
+0000a640: 636f 7079 2872 6574 290a 2020 2020 2020  copy(ret).      
+0000a650: 2020 6966 2072 6574 203d 3d20 2222 206f    if ret == "" o
+0000a660: 7220 7265 7420 3d3d 207b 7d3a 0a20 2020  r ret == {}:.   
+0000a670: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
+0000a680: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
+0000a690: 6f6e 2822 6b65 7973 2064 6f20 6e6f 7420  on("keys do not 
+0000a6a0: 6578 6973 743a 2220 2b20 7374 7228 6b65  exist:" + str(ke
+0000a6b0: 7973 2929 0a20 2020 2020 2020 2072 6574  ys)).        ret
+0000a6c0: 7572 6e20 7265 740a 0a0a 2020 2020 4073  urn ret...    @s
+0000a6d0: 7461 7469 636d 6574 686f 640a 2020 2020  taticmethod.    
+0000a6e0: 6465 6620 5f5f 6765 7449 7465 6d56 616c  def __getItemVal
+0000a6f0: 7565 2869 7465 6d73 2c6b 6579 732c 736b  ue(items,keys,sk
+0000a700: 6970 7065 6449 6e48 6561 6465 722c 6465  ippedInHeader,de
+0000a710: 6661 756c 7456 616c 293a 0a20 2020 2020  faultVal):.     
+0000a720: 2020 200a 2020 2020 2020 2020 2320 696e     .        # in
+0000a730: 2063 6173 6520 6974 656d 2069 7320 6e6f   case item is no
+0000a740: 7420 6120 6c69 7374 2028 7368 6f75 6c64  t a list (should
+0000a750: 206e 6f74 2062 6520 706f 7373 6962 6c65   not be possible
+0000a760: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
+0000a770: 2069 7369 6e73 7461 6e63 6528 6974 656d   isinstance(item
+0000a780: 735b 6b65 7973 5b30 5d5d 2c6c 6973 7429  s[keys[0]],list)
+0000a790: 3a0a 2020 2020 2020 2020 2020 2020 6974  :.            it
+0000a7a0: 656d 735b 6b65 7973 5b30 5d5d 203d 205b  ems[keys[0]] = [
+0000a7b0: 6974 656d 735b 6b65 7973 5b30 5d5d 5d0a  items[keys[0]]].
+0000a7c0: 0a20 2020 2020 2020 2069 7465 6d56 616c  .        itemVal
+0000a7d0: 7565 203d 2066 696e 6446 6965 6c64 2869  ue = findField(i
+0000a7e0: 7465 6d73 2c6b 6579 7329 0a0a 2020 2020  tems,keys)..    
+0000a7f0: 2020 2020 6966 2069 7465 6d56 616c 7565      if itemValue
+0000a800: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+0000a810: 2020 2020 7265 7420 3d20 6465 6661 756c      ret = defaul
+0000a820: 7456 616c 0a20 2020 2020 2020 2023 2069  tVal.        # i
+0000a830: 6e20 6361 7365 206f 6620 6469 6374 7320  n case of dicts 
+0000a840: 6a6f 696e 7420 6865 6164 6572 2061 6e64  joint header and
+0000a850: 2069 7465 6d20 6669 656c 6473 0a20 2020   item fields.   
+0000a860: 2020 2020 2065 6c69 6620 6973 696e 7374       elif isinst
+0000a870: 616e 6365 2869 7465 6d56 616c 7565 2c64  ance(itemValue,d
+0000a880: 6963 7429 2061 6e64 2064 6566 6175 6c74  ict) and default
+0000a890: 5661 6c20 213d 2022 223a 0a20 2020 2020  Val != "":.     
+0000a8a0: 2020 2020 2020 2069 6620 6e6f 7420 6973         if not is
+0000a8b0: 696e 7374 616e 6365 2864 6566 6175 6c74  instance(default
+0000a8c0: 5661 6c2c 6469 6374 293a 0a20 2020 2020  Val,dict):.     
+0000a8d0: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0000a8e0: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+0000a8f0: 7469 6f6e 2822 4974 656d 2066 6965 6c64  tion("Item field
+0000a900: 2069 7320 6469 6374 2062 7574 2064 6566   is dict but def
+0000a910: 6175 6c74 2076 616c 7565 2069 6e20 6865  ault value in he
+0000a920: 6164 6572 2069 7320 6e6f 743a 2022 202b  ader is not: " +
+0000a930: 2073 7472 286b 6579 7329 290a 2020 2020   str(keys)).    
+0000a940: 2020 2020 2020 2020 7265 7420 3d20 7b2a          ret = {*
+0000a950: 2a64 6566 6175 6c74 5661 6c2c 2a2a 6974  *defaultVal,**it
+0000a960: 656d 5661 6c75 657d 0a20 2020 2020 2020  emValue}.       
+0000a970: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000a980: 2020 2072 6574 203d 2069 7465 6d56 616c     ret = itemVal
+0000a990: 7565 0a20 2020 2020 2020 2072 6574 7572  ue.        retur
+0000a9a0: 6e20 7265 740a 0a0a 2020 2020 6465 6620  n ret...    def 
+0000a9b0: 5f5f 7374 725f 5f28 7365 6c66 2920 2d3e  __str__(self) ->
+0000a9c0: 2073 7472 3a0a 2020 2020 2020 2020 2222   str:.        ""
+0000a9d0: 2220 5072 696e 7473 2063 7572 7265 6e74  " Prints current
+0000a9e0: 2069 4644 4f20 6669 6c65 2022 2222 0a20   iFDO file """. 
+0000a9f0: 2020 2020 2020 2072 6574 7572 6e20 7961         return ya
+0000aa00: 6d6c 2e64 756d 7028 7365 6c66 2e69 6664  ml.dump(self.ifd
+0000aa10: 6f5f 6368 6563 6b65 642c 2064 6566 6175  o_checked, defau
+0000aa20: 6c74 5f73 7479 6c65 3d4e 6f6e 652c 2064  lt_style=None, d
+0000aa30: 6566 6175 6c74 5f66 6c6f 775f 7374 796c  efault_flow_styl
+0000aa40: 653d 4e6f 6e65 2c20 616c 6c6f 775f 756e  e=None, allow_un
+0000aa50: 6963 6f64 653d 5472 7565 2c20 7769 6474  icode=True, widt
+0000aa60: 683d 666c 6f61 7428 2269 6e66 2229 290a  h=float("inf")).
+0000aa70: 0a0a 2020 2020 6465 6620 5f5f 6765 7469  ..    def __geti
+0000aa80: 7465 6d5f 5f28 7365 6c66 2c20 6b65 7973  tem__(self, keys
+0000aa90: 293a 0a20 2020 2020 2020 2022 2222 2052  ):.        """ R
+0000aaa0: 6574 7572 6e73 2063 6f70 7920 6f66 2063  eturns copy of c
+0000aab0: 6865 636b 6564 2069 6664 6f20 7365 7420  hecked ifdo set 
+0000aac0: 6f72 2069 7465 6d20 6669 656c 6420 7661  or item field va
+0000aad0: 6c75 652c 2061 6c73 6f20 636f 6e73 6964  lue, also consid
+0000aae0: 6572 6e67 2064 6566 6175 6c74 2076 616c  erng default val
+0000aaf0: 7565 7320 6672 6f6d 2068 6561 6465 722e  ues from header.
+0000ab00: 0a20 2020 2020 2020 2020 2020 2055 7365  .            Use
+0000ab10: 206b 6579 7320 6173 2065 2e67 2e20 273c   keys as e.g. '<
+0000ab20: 6974 656d 3e3a 3c6b 6579 3e3a 2e2e 2e27  item>:<key>:...'
+0000ab30: 2e20 4361 6e20 6265 2075 7365 6420 666f  . Can be used fo
+0000ab40: 7220 6865 6164 6572 2066 6965 6c64 7320  r header fields 
+0000ab50: 6173 2077 656c 6c20 6173 2069 7465 6d20  as well as item 
+0000ab60: 6669 656c 6473 2e0a 2020 2020 2020 2020  fields..        
+0000ab70: 2020 2020 4974 656d 2069 6e64 6578 2063      Item index c
+0000ab80: 616e 2062 6520 6c65 676c 6563 7465 642c  an be leglected,
+0000ab90: 2069 6e20 6361 7365 206f 6620 7669 6465   in case of vide
+0000aba0: 6f20 6120 6469 6374 207b 3c69 6d61 6765  o a dict {<image
+0000abb0: 2d64 6174 6174 696d 653e 3a3c 7661 6c75  -datatime>:<valu
+0000abc0: 653e 2c2e 2e2e 7d20 6973 2072 6574 7572  e>,...} is retur
+0000abd0: 6e65 642e 0a20 2020 2020 2020 2020 2020  ned..           
+0000abe0: 2052 6169 7365 7320 4966 646f 4578 6365   Raises IfdoExce
+0000abf0: 7074 696f 6e20 6966 2069 7465 6d20 646f  ption if item do
+0000ac00: 6573 206e 6f74 2065 7869 7374 2e20 2222  es not exist. ""
+0000ac10: 220a 2020 2020 2020 2020 6b65 7973 203d  ".        keys =
+0000ac20: 206b 6579 732e 7370 6c69 7428 273a 2729   keys.split(':')
+0000ac30: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0000ac40: 7365 6c66 2e5f 5f67 6574 4669 656c 6456  self.__getFieldV
+0000ac50: 616c 7565 2873 656c 662e 6966 646f 5f63  alue(self.ifdo_c
+0000ac60: 6865 636b 6564 2c6b 6579 7329 0a0a 0a20  hecked,keys)... 
+0000ac70: 2020 2064 6566 2066 696e 6454 6d70 4669     def findTmpFi
+0000ac80: 656c 6428 7365 6c66 2c6b 6579 7329 3a0a  eld(self,keys):.
+0000ac90: 2020 2020 2020 2020 2222 2220 5265 7475          """ Retu
+0000aca0: 726e 7320 636f 7079 206f 6620 7465 6d70  rns copy of temp
+0000acb0: 6f72 6172 7920 756e 6368 6563 6b65 6420  orary unchecked 
+0000acc0: 6966 646f 2073 6574 206f 7220 6974 656d  ifdo set or item
+0000acd0: 2066 6965 6c64 2076 616c 7565 2c20 616c   field value, al
+0000ace0: 736f 2063 6f6e 7369 6465 726e 6720 6465  so considerng de
+0000acf0: 6661 756c 7420 7661 6c75 6573 2066 726f  fault values fro
+0000ad00: 6d20 6865 6164 6572 2e0a 2020 2020 2020  m header..      
+0000ad10: 2020 2020 2020 5573 6520 6b65 7973 2061        Use keys a
+0000ad20: 7320 652e 672e 2027 3c69 7465 6d3e 3a3c  s e.g. '<item>:<
+0000ad30: 6b65 793e 3a2e 2e2e 272e 2043 616e 2062  key>:...'. Can b
+0000ad40: 6520 7573 6564 2066 6f72 2068 6561 6465  e used for heade
+0000ad50: 7220 6669 656c 6473 2061 7320 7765 6c6c  r fields as well
+0000ad60: 2061 7320 6974 656d 2066 6965 6c64 732e   as item fields.
+0000ad70: 0a20 2020 2020 2020 2020 2020 2049 7465  .            Ite
+0000ad80: 6d20 696e 6465 7820 6361 6e20 6265 206c  m index can be l
+0000ad90: 6567 6c65 6374 6564 2c20 696e 2063 6173  eglected, in cas
+0000ada0: 6520 6f66 2076 6964 656f 2061 2064 6963  e of video a dic
+0000adb0: 7420 7b3c 696d 6167 652d 6461 7461 7469  t {<image-datati
+0000adc0: 6d65 3e3a 3c76 616c 7565 3e2c 2e2e 2e7d  me>:<value>,...}
+0000add0: 2069 7320 7265 7475 726e 6564 2e0a 2020   is returned..  
+0000ade0: 2020 2020 2020 2020 2020 5261 6973 6573            Raises
+0000adf0: 2049 6664 6f45 7863 6570 7469 6f6e 2069   IfdoException i
+0000ae00: 6620 6974 656d 2064 6f65 7320 6e6f 7420  f item does not 
+0000ae10: 6578 6973 742e 2022 2222 0a20 2020 2020  exist. """.     
+0000ae20: 2020 206b 6579 7320 3d20 6b65 7973 2e73     keys = keys.s
+0000ae30: 706c 6974 2827 3a27 290a 2020 2020 2020  plit(':').      
+0000ae40: 2020 7265 7475 726e 2073 656c 662e 5f5f    return self.__
+0000ae50: 6765 7446 6965 6c64 5661 6c75 6528 7365  getFieldValue(se
+0000ae60: 6c66 2e69 6664 6f5f 746d 702c 6b65 7973  lf.ifdo_tmp,keys
+0000ae70: 290a 2020 2020 0a0a 2020 2020 6465 6620  ).    ..    def 
+0000ae80: 6669 6e64 546d 7046 6965 6c64 3228 7365  findTmpField2(se
+0000ae90: 6c66 2c6b 6579 7329 3a0a 2020 2020 2020  lf,keys):.      
+0000aea0: 2020 2222 2220 5361 6d65 2061 7320 6669    """ Same as fi
+0000aeb0: 6e64 546d 7046 6965 6c64 2069 6e73 7465  ndTmpField inste
+0000aec0: 6164 206f 6620 7261 6973 696e 6720 6578  ad of raising ex
+0000aed0: 6365 7074 696f 6e20 6974 2072 6574 7572  ception it retur
+0000aee0: 6e20 656d 7074 7920 7374 7269 6e67 2e20  n empty string. 
+0000aef0: 2222 220a 2020 2020 2020 2020 6b65 7973  """.        keys
+0000af00: 203d 206b 6579 732e 7370 6c69 7428 273a   = keys.split(':
+0000af10: 2729 0a20 2020 2020 2020 2074 7279 3a0a  ').        try:.
+0000af20: 2020 2020 2020 2020 2020 2020 7265 7420              ret 
+0000af30: 3d20 7365 6c66 2e5f 5f67 6574 4669 656c  = self.__getFiel
+0000af40: 6456 616c 7565 2873 656c 662e 6966 646f  dValue(self.ifdo
+0000af50: 5f74 6d70 2c6b 6579 7329 0a20 2020 2020  _tmp,keys).     
+0000af60: 2020 2065 7863 6570 7420 6d69 7174 632e     except miqtc.
+0000af70: 4966 646f 4578 6365 7074 696f 6e3a 0a20  IfdoException:. 
+0000af80: 2020 2020 2020 2020 2020 2072 6574 203d             ret =
+0000af90: 2022 220a 2020 2020 2020 2020 7265 7475   "".        retu
+0000afa0: 726e 2072 6574 0a0a 0a20 2020 2064 6566  rn ret...    def
+0000afb0: 2073 6574 6946 444f 4865 6164 6572 4669   setiFDOHeaderFi
+0000afc0: 656c 6473 2873 656c 662c 2068 6561 6465  elds(self, heade
+0000afd0: 723a 2064 6963 7429 3a0a 2020 2020 2020  r: dict):.      
+0000afe0: 2020 2222 2220 436c 6561 7273 2063 7572    """ Clears cur
+0000aff0: 7265 6e74 2068 6561 6465 7220 6669 656c  rent header fiel
+0000b000: 6473 2075 6e64 2073 6574 7320 7072 6f76  ds und sets prov
+0000b010: 6964 6564 2066 6965 6c64 2076 616c 7565  ided field value
+0000b020: 732e 2046 6f72 2075 7064 6174 696e 6720  s. For updating 
+0000b030: 6578 6973 7469 6e67 206f 6e65 7320 7573  existing ones us
+0000b040: 6520 7570 6461 7465 5f69 6664 6f5f 6865  e update_ifdo_he
+0000b050: 6164 6572 5f66 6965 6c64 7328 2920 2222  ader_fields() ""
+0000b060: 220a 2020 2020 2020 2020 7365 6c66 2e69  ".        self.i
+0000b070: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000b080: 6765 5365 7448 6561 6465 724b 6579 5d20  geSetHeaderKey] 
+0000b090: 3d20 7b7d 0a20 2020 2020 2020 2069 6620  = {}.        if 
+0000b0a0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b0b0: 6465 724b 6579 2069 6e20 6865 6164 6572  derKey in header
+0000b0c0: 3a0a 2020 2020 2020 2020 2020 2020 6865  :.            he
+0000b0d0: 6164 6572 203d 2068 6561 6465 725b 7365  ader = header[se
+0000b0e0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000b0f0: 724b 6579 5d0a 2020 2020 2020 2020 666f  rKey].        fo
+0000b100: 7220 6669 656c 6420 696e 2068 6561 6465  r field in heade
+0000b110: 723a 0a20 2020 2020 2020 2020 2020 2023  r:.            #
+0000b120: 6966 2066 6965 6c64 206e 6f74 2069 6e20  if field not in 
+0000b130: 6d69 7174 762e 6966 646f 5f68 6561 6465  miqtv.ifdo_heade
+0000b140: 725f 636f 7265 5f66 6965 6c64 733a 0a20  r_core_fields:. 
+0000b150: 2020 2020 2020 2020 2020 2023 2020 2020             #    
+0000b160: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000b170: 6175 7469 6f6e 2120 556e 6b6e 6f77 6e20  aution! Unknown 
+0000b180: 6865 6164 6572 2066 6965 6c64 205c 2222  header field \""
+0000b190: 202b 2066 6965 6c64 202b 2022 5c22 2e20   + field + "\". 
+0000b1a0: 4d61 7962 6520 6120 7479 706f 3f20 4f74  Maybe a typo? Ot
+0000b1b0: 6865 7277 6973 6520 6967 6e6f 7265 206d  herwise ignore m
+0000b1c0: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
+0000b1d0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000b1e0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000b1f0: 6572 4b65 795d 5b66 6965 6c64 5d20 3d20  erKey][field] = 
+0000b200: 6865 6164 6572 5b66 6965 6c64 5d0a 0a0a  header[field]...
+0000b210: 2020 2020 6465 6620 7570 6461 7465 5f69      def update_i
+0000b220: 6664 6f5f 6865 6164 6572 5f66 6965 6c64  fdo_header_field
+0000b230: 7328 7365 6c66 2c20 6865 6164 6572 3a20  s(self, header: 
+0000b240: 6469 6374 293a 0a20 2020 2020 2020 2022  dict):.        "
+0000b250: 2222 2055 7064 6174 6573 2065 7869 7374  "" Updates exist
+0000b260: 696e 6720 6865 6164 6572 2066 6965 6c64  ing header field
+0000b270: 7320 2222 220a 2020 2020 2020 2020 6966  s """.        if
+0000b280: 2073 656c 662e 696d 6167 6553 6574 4865   self.imageSetHe
+0000b290: 6164 6572 4b65 7920 696e 2068 6561 6465  aderKey in heade
+0000b2a0: 723a 0a20 2020 2020 2020 2020 2020 2068  r:.            h
+0000b2b0: 6561 6465 7220 3d20 6865 6164 6572 5b73  eader = header[s
+0000b2c0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000b2d0: 6572 4b65 795d 0a20 2020 2020 2020 206c  erKey].        l
+0000b2e0: 6f67 203d 206d 6971 7463 2e72 6563 7572  og = miqtc.recur
+0000b2f0: 7369 7665 6c79 5570 6461 7465 4469 6374  sivelyUpdateDict
+0000b300: 7328 7365 6c66 2e69 6664 6f5f 746d 705b  s(self.ifdo_tmp[
+0000b310: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b320: 6465 724b 6579 5d2c 2068 6561 6465 7229  derKey], header)
+0000b330: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
+0000b340: 6f76 2e6c 6f67 286c 6f67 2c64 6f6e 7453  ov.log(log,dontS
+0000b350: 686f 773d 5472 7565 290a 0a20 2020 2064  how=True)..    d
+0000b360: 6566 2075 7064 6174 6569 4644 4f48 6561  ef updateiFDOHea
+0000b370: 6465 7246 6965 6c64 7328 7365 6c66 2c20  derFields(self, 
+0000b380: 6865 6164 6572 3a20 6469 6374 293a 0a20  header: dict):. 
+0000b390: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+0000b3a0: 6361 7465 6420 2d20 7573 6520 7570 6461  cated - use upda
+0000b3b0: 7465 5f69 6664 6f5f 6865 6164 6572 5f66  te_ifdo_header_f
+0000b3c0: 6965 6c64 7320 2222 220a 2020 2020 2020  ields """.      
+0000b3d0: 2020 7365 6c66 2e75 7064 6174 655f 6966    self.update_if
+0000b3e0: 646f 5f68 6561 6465 725f 6669 656c 6473  do_header_fields
+0000b3f0: 2868 6561 6465 7229 0a0a 0a20 2020 2064  (header)...    d
+0000b400: 6566 205f 7472 795f 7570 6772 6164 655f  ef _try_upgrade_
+0000b410: 746f 5f69 6664 6f5f 7665 7273 696f 6e5f  to_ifdo_version_
+0000b420: 3278 2873 656c 6629 3a0a 2020 2020 2020  2x(self):.      
+0000b430: 2020 2222 2220 5472 7920 746f 2063 6f6e    """ Try to con
+0000b440: 7665 7274 2066 6965 6c64 7320 6672 6f6d  vert fields from
+0000b450: 2069 4644 4f20 7665 7273 696f 6e20 3c20   iFDO version < 
+0000b460: 322e 302e 3020 746f 2032 2e78 2022 2222  2.0.0 to 2.x """
+0000b470: 0a20 2020 2020 2020 2072 6561 645f 7665  .        read_ve
+0000b480: 7273 696f 6e5f 7374 7220 3d20 2276 312e  rsion_str = "v1.
+0000b490: 302e 3022 2023 2064 6964 206e 6f74 2068  0.0" # did not h
+0000b4a0: 6176 6520 7468 6520 2769 6d61 6765 2d73  ave the 'image-s
+0000b4b0: 6574 2d69 6664 6f2d 7665 7273 696f 6e27  et-ifdo-version'
+0000b4c0: 2066 6965 6c64 2079 6574 0a20 2020 2020   field yet.     
+0000b4d0: 2020 2074 7279 3a20 0a20 2020 2020 2020     try: .       
+0000b4e0: 2020 2020 2072 6561 645f 7665 7273 696f       read_versio
+0000b4f0: 6e5f 7374 7220 3d20 7365 6c66 2e66 696e  n_str = self.fin
+0000b500: 6454 6d70 4669 656c 6428 2769 6d61 6765  dTmpField('image
+0000b510: 2d73 6574 2d69 6664 6f2d 7665 7273 696f  -set-ifdo-versio
+0000b520: 6e27 290a 2020 2020 2020 2020 6578 6365  n').        exce
+0000b530: 7074 206d 6971 7463 2e49 6664 6f45 7863  pt miqtc.IfdoExc
+0000b540: 6570 7469 6f6e 3a0a 2020 2020 2020 2020  eption:.        
+0000b550: 2020 2020 7061 7373 0a20 2020 2020 2020      pass.       
+0000b560: 2072 6561 645f 7665 7273 696f 6e20 3d20   read_version = 
+0000b570: 5665 7273 696f 6e28 7265 6164 5f76 6572  Version(read_ver
+0000b580: 7369 6f6e 5f73 7472 290a 0a20 2020 2020  sion_str)..     
+0000b590: 2020 2069 6620 7265 6164 5f76 6572 7369     if read_versi
+0000b5a0: 6f6e 203c 2056 6572 7369 6f6e 2822 322e  on < Version("2.
+0000b5b0: 302e 3022 293a 0a20 2020 2020 2020 2020  0.0"):.         
+0000b5c0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0000b5d0: 2320 6e65 7720 5552 4920 6f62 6a65 6374  # new URI object
+0000b5e0: 2066 6965 6c64 730a 2020 2020 2020 2020   fields.        
+0000b5f0: 2020 2020 6e65 775f 7572 695f 6669 656c      new_uri_fiel
+0000b600: 6473 203d 205b 2769 6d61 6765 2d73 656e  ds = ['image-sen
+0000b610: 736f 7227 2c27 696d 6167 652d 6576 656e  sor','image-even
+0000b620: 7427 2c27 696d 6167 652d 7072 6f6a 6563  t','image-projec
+0000b630: 7427 2c27 696d 6167 652d 636f 6e74 6578  t','image-contex
+0000b640: 7427 2c27 696d 6167 652d 6c69 6365 6e73  t','image-licens
+0000b650: 6527 2c27 696d 6167 652d 706c 6174 666f  e','image-platfo
+0000b660: 726d 275d 0a20 2020 2020 2020 2020 2020  rm'].           
+0000b670: 2066 6f72 2075 7269 5f66 6965 6c64 2069   for uri_field i
+0000b680: 6e20 6e65 775f 7572 695f 6669 656c 6473  n new_uri_fields
+0000b690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000b6a0: 2020 6f6c 645f 7374 725f 7661 6c20 3d20    old_str_val = 
+0000b6b0: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000b6c0: 6432 2875 7269 5f66 6965 6c64 290a 2020  d2(uri_field).  
+0000b6d0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+0000b6e0: 2069 7369 6e73 7461 6e63 6528 6f6c 645f   isinstance(old_
+0000b6f0: 7374 725f 7661 6c2c 7374 7229 2061 6e64  str_val,str) and
+0000b700: 206f 6c64 5f73 7472 5f76 616c 2021 3d20   old_str_val != 
+0000b710: 2222 3a20 2020 2020 2020 2020 2020 2020  "":             
+0000b720: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+0000b730: 2020 2020 2020 2020 2020 2020 6e65 775f              new_
+0000b740: 6f62 6a5f 7661 6c20 3d20 7b27 6e61 6d65  obj_val = {'name
+0000b750: 273a 206f 6c64 5f73 7472 5f76 616c 7d0a  ': old_str_val}.
+0000b760: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b770: 2020 2020 6973 5f75 7269 2c20 6d73 6720      is_uri, msg 
+0000b780: 3d20 6d69 7174 742e 7661 6c69 6461 7465  = miqtt.validate
+0000b790: 5f61 6761 696e 7374 5f73 6368 656d 6128  _against_schema(
+0000b7a0: 6f6c 645f 7374 725f 7661 6c2c 7b22 7479  old_str_val,{"ty
+0000b7b0: 7065 223a 2022 7374 7269 6e67 222c 2266  pe": "string","f
+0000b7c0: 6f72 6d61 7422 3a20 2275 7269 227d 290a  ormat": "uri"}).
+0000b7d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b7e0: 2020 2020 6966 2069 735f 7572 693a 0a20      if is_uri:. 
+0000b7f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000b800: 2020 2020 2020 206e 6577 5f6f 626a 5f76         new_obj_v
+0000b810: 616c 5b27 7572 6927 5d20 3d20 6f6c 645f  al['uri'] = old_
+0000b820: 7374 725f 7661 6c0a 2020 2020 2020 2020  str_val.        
+0000b830: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000b840: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000b850: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000b860: 5d5b 7572 695f 6669 656c 645d 203d 206e  ][uri_field] = n
+0000b870: 6577 5f6f 626a 5f76 616c 0a20 2020 2020  ew_obj_val.     
+0000b880: 2020 2020 2020 2020 2020 2020 2020 2073                 s
+0000b890: 656c 662e 7072 6f76 2e6c 6f67 2822 4175  elf.prov.log("Au
+0000b8a0: 746f 2d75 7067 7261 6465 6420 2220 2b20  to-upgraded " + 
+0000b8b0: 7572 695f 6669 656c 6420 2b20 2220 6672  uri_field + " fr
+0000b8c0: 6f6d 2022 202b 206f 6c64 5f73 7472 5f76  om " + old_str_v
+0000b8d0: 616c 202b 2022 2074 6f20 2220 2b20 7374  al + " to " + st
+0000b8e0: 7228 6e65 775f 6f62 6a5f 7661 6c29 290a  r(new_obj_val)).
+0000b8f0: 0a0a 0a20 2020 2064 6566 2074 7279 4175  ...    def tryAu
+0000b900: 746f 5365 7448 6561 6465 7246 6965 6c64  toSetHeaderField
+0000b910: 7328 7365 6c66 293a 0a20 2020 2020 2020  s(self):.       
+0000b920: 2022 2222 2053 6574 7320 6365 7274 6169   """ Sets certai
+0000b930: 6e20 6865 6164 6572 2066 6965 6c64 7320  n header fields 
+0000b940: 652e 672e 2066 726f 6d20 6469 7265 6374  e.g. from direct
+0000b950: 6f72 7920 6966 2074 6865 7920 6172 6520  ory if they are 
+0000b960: 6e6f 7420 7365 7420 7965 7420 2222 220a  not set yet """.
+0000b970: 0a20 2020 2020 2020 2069 6620 7365 6c66  .        if self
+0000b980: 2e66 696e 6454 6d70 4669 656c 6432 2827  .findTmpField2('
+0000b990: 696d 6167 652d 7365 6e73 6f72 2729 203d  image-sensor') =
+0000b9a0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000b9b0: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000b9c0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000b9d0: 6465 724b 6579 5d5b 2769 6d61 6765 2d73  derKey]['image-s
+0000b9e0: 656e 736f 7227 5d20 3d20 7b27 6e61 6d65  ensor'] = {'name
+0000b9f0: 273a 2073 656c 662e 6469 722e 7365 6e73  ': self.dir.sens
+0000ba00: 6f72 2829 7d0a 2020 2020 2020 2020 656c  or()}.        el
+0000ba10: 6966 2073 656c 662e 6669 6e64 546d 7046  if self.findTmpF
+0000ba20: 6965 6c64 2827 696d 6167 652d 7365 6e73  ield('image-sens
+0000ba30: 6f72 2729 5b27 6e61 6d65 275d 2021 3d20  or')['name'] != 
+0000ba40: 7365 6c66 2e64 6972 2e73 656e 736f 7228  self.dir.sensor(
+0000ba50: 293a 0a20 2020 2020 2020 2020 2020 2073  ):.            s
+0000ba60: 656c 662e 7072 6f76 2e6c 6f67 2822 4361  elf.prov.log("Ca
+0000ba70: 7574 696f 6e21 2027 696d 6167 652d 7365  ution! 'image-se
+0000ba80: 6e73 6f72 2720 222b 2073 7472 2873 656c  nsor' "+ str(sel
+0000ba90: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0000baa0: 696d 6167 652d 7365 6e73 6f72 2729 2920  image-sensor')) 
+0000bab0: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
+0000bac0: 2073 656e 736f 7220 7061 7273 6564 2066   sensor parsed f
+0000bad0: 726f 6d20 6469 7265 6374 6f72 793a 2022  rom directory: "
+0000bae0: 202b 2073 656c 662e 6469 722e 7365 6e73   + self.dir.sens
+0000baf0: 6f72 2829 290a 0a20 2020 2020 2020 2069  or())..        i
+0000bb00: 6620 7365 6c66 2e66 696e 6454 6d70 4669  f self.findTmpFi
+0000bb10: 656c 6432 2827 696d 6167 652d 6576 656e  eld2('image-even
+0000bb20: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
+0000bb30: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000bb40: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000bb50: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000bb60: 6167 652d 6576 656e 7427 5d20 3d20 7b27  age-event'] = {'
+0000bb70: 6e61 6d65 273a 2073 656c 662e 6469 722e  name': self.dir.
+0000bb80: 6576 656e 7428 297d 0a20 2020 2020 2020  event()}.       
+0000bb90: 2065 6c69 6620 7365 6c66 2e66 696e 6454   elif self.findT
+0000bba0: 6d70 4669 656c 6428 2769 6d61 6765 2d65  mpField('image-e
+0000bbb0: 7665 6e74 2729 5b27 6e61 6d65 275d 2021  vent')['name'] !
+0000bbc0: 3d20 7365 6c66 2e64 6972 2e65 7665 6e74  = self.dir.event
+0000bbd0: 2829 3a0a 2020 2020 2020 2020 2020 2020  ():.            
+0000bbe0: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+0000bbf0: 6175 7469 6f6e 2120 2769 6d61 6765 2d65  aution! 'image-e
+0000bc00: 7665 6e74 2720 2220 2b20 7374 7228 7365  vent' " + str(se
+0000bc10: 6c66 2e66 696e 6454 6d70 4669 656c 6428  lf.findTmpField(
+0000bc20: 2769 6d61 6765 2d65 7665 6e74 2729 2920  'image-event')) 
+0000bc30: 2b20 2220 6469 6666 6572 7320 6672 6f6d  + " differs from
+0000bc40: 2065 7665 6e74 2070 6172 7365 6420 6672   event parsed fr
+0000bc50: 6f6d 2064 6972 6563 746f 7279 3a20 2220  om directory: " 
+0000bc60: 2b20 7365 6c66 2e64 6972 2e65 7665 6e74  + self.dir.event
+0000bc70: 2829 290a 0a20 2020 2020 2020 2069 6620  ())..        if 
+0000bc80: 7365 6c66 2e66 696e 6454 6d70 4669 656c  self.findTmpFiel
+0000bc90: 6432 2827 696d 6167 652d 7072 6f6a 6563  d2('image-projec
+0000bca0: 7427 2920 3d3d 2022 223a 0a20 2020 2020  t') == "":.     
+0000bcb0: 2020 2020 2020 2073 656c 662e 6966 646f         self.ifdo
+0000bcc0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
+0000bcd0: 6574 4865 6164 6572 4b65 795d 5b27 696d  etHeaderKey]['im
+0000bce0: 6167 652d 7072 6f6a 6563 7427 5d20 3d20  age-project'] = 
+0000bcf0: 207b 276e 616d 6527 3a20 7365 6c66 2e64   {'name': self.d
+0000bd00: 6972 2e70 726f 6a65 6374 2829 7d0a 2020  ir.project()}.  
+0000bd10: 2020 2020 2020 656c 6966 2073 656c 662e        elif self.
+0000bd20: 6669 6e64 546d 7046 6965 6c64 2827 696d  findTmpField('im
+0000bd30: 6167 652d 7072 6f6a 6563 7427 295b 276e  age-project')['n
+0000bd40: 616d 6527 5d20 213d 2073 656c 662e 6469  ame'] != self.di
+0000bd50: 722e 7072 6f6a 6563 7428 293a 0a20 2020  r.project():.   
+0000bd60: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000bd70: 6f76 2e6c 6f67 2822 4361 7574 696f 6e21  ov.log("Caution!
+0000bd80: 2027 696d 6167 652d 7072 6f6a 6563 7427   'image-project'
+0000bd90: 2022 202b 2073 7472 2873 656c 662e 6669   " + str(self.fi
+0000bda0: 6e64 546d 7046 6965 6c64 2827 696d 6167  ndTmpField('imag
+0000bdb0: 652d 7072 6f6a 6563 7427 2929 202b 2022  e-project')) + "
+0000bdc0: 2064 6966 6665 7273 2066 726f 6d20 7072   differs from pr
+0000bdd0: 6f6a 6563 7420 7061 7273 6564 2066 726f  oject parsed fro
+0000bde0: 6d20 6469 7265 6374 6f72 793a 2022 202b  m directory: " +
+0000bdf0: 2073 656c 662e 6469 722e 7072 6f6a 6563   self.dir.projec
+0000be00: 7428 2929 0a0a 2020 2020 2020 2020 6966  t())..        if
+0000be10: 2073 656c 662e 6669 6e64 546d 7046 6965   self.findTmpFie
+0000be20: 6c64 3228 2769 6d61 6765 2d70 6c61 7466  ld2('image-platf
+0000be30: 6f72 6d27 2920 3d3d 2022 2220 616e 6420  orm') == "" and 
+0000be40: 7365 6c66 2e64 6972 2e67 6561 7228 2920  self.dir.gear() 
+0000be50: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
+0000be60: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000be70: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000be80: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000be90: 706c 6174 666f 726d 275d 203d 207b 276e  platform'] = {'n
+0000bea0: 616d 6527 3a20 7365 6c66 2e64 6972 2e67  ame': self.dir.g
+0000beb0: 6561 7228 297d 0a0a 2020 2020 2020 2020  ear()}..        
+0000bec0: 6966 206e 6f74 2027 696d 6167 652d 7365  if not 'image-se
+0000bed0: 742d 7575 6964 2720 696e 2073 656c 662e  t-uuid' in self.
+0000bee0: 6966 646f 5f74 6d70 5b73 656c 662e 696d  ifdo_tmp[self.im
+0000bef0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000bf00: 3a0a 2020 2020 2020 2020 2020 2020 7365  :.            se
+0000bf10: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+0000bf20: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+0000bf30: 6579 5d5b 2769 6d61 6765 2d73 6574 2d75  ey]['image-set-u
+0000bf40: 7569 6427 5d20 3d20 7374 7228 6d69 7174  uid'] = str(miqt
+0000bf50: 632e 7575 6964 3428 2929 0a20 2020 2020  c.uuid4()).     
+0000bf60: 2020 2069 6620 6e6f 7420 2769 6d61 6765     if not 'image
+0000bf70: 2d73 6574 2d68 616e 646c 6527 2069 6e20  -set-handle' in 
+0000bf80: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000bf90: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000bfa0: 724b 6579 5d3a 0a20 2020 2020 2020 2020  rKey]:.         
+0000bfb0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000bfc0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000bfd0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000bfe0: 7365 742d 6861 6e64 6c65 275d 203d 2073  set-handle'] = s
+0000bff0: 656c 662e 6861 6e64 6c65 5f70 7265 6669  elf.handle_prefi
+0000c000: 7820 2b20 222f 2220 2b20 7365 6c66 2e66  x + "/" + self.f
+0000c010: 696e 6454 6d70 4669 656c 6428 2769 6d61  indTmpField('ima
+0000c020: 6765 2d73 6574 2d75 7569 6427 290a 2020  ge-set-uuid').  
+0000c030: 2020 2020 2020 6966 206e 6f74 2027 696d        if not 'im
+0000c040: 6167 652d 7365 742d 6e61 6d65 2720 696e  age-set-name' in
+0000c050: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000c060: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0000c070: 6572 4b65 795d 206f 7220 7365 6c66 2e66  erKey] or self.f
+0000c080: 696e 6454 6d70 4669 656c 6432 2827 696d  indTmpField2('im
+0000c090: 6167 652d 7365 742d 6e61 6d65 2729 203d  age-set-name') =
+0000c0a0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
+0000c0b0: 2020 2320 636f 6e73 7472 7563 7420 6173    # construct as
+0000c0c0: 203c 7072 6f6a 6563 743e 5f3c 6576 656e   <project>_<even
+0000c0d0: 743e 5f3c 7365 6e73 6f72 3e0a 2020 2020  t>_<sensor>.    
+0000c0e0: 2020 2020 2020 2020 7072 6f6a 6563 745f          project_
+0000c0f0: 203d 2073 656c 662e 6669 6e64 546d 7046   = self.findTmpF
+0000c100: 6965 6c64 3228 2269 6d61 6765 2d70 726f  ield2("image-pro
+0000c110: 6a65 6374 2229 5b27 6e61 6d65 275d 0a20  ject")['name']. 
+0000c120: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+0000c130: 5f20 3d20 7365 6c66 2e66 696e 6454 6d70  _ = self.findTmp
+0000c140: 4669 656c 6432 2822 696d 6167 652d 6576  Field2("image-ev
+0000c150: 656e 7422 295b 276e 616d 6527 5d0a 2020  ent")['name'].  
+0000c160: 2020 2020 2020 2020 2020 6966 2065 7665            if eve
+0000c170: 6e74 5f20 3d3d 2022 223a 0a20 2020 2020  nt_ == "":.     
+0000c180: 2020 2020 2020 2020 2020 2065 7665 6e74             event
+0000c190: 5f20 3d20 7365 6c66 2e64 6972 2e65 7665  _ = self.dir.eve
+0000c1a0: 6e74 2829 0a20 2020 2020 2020 2020 2020  nt().           
+0000c1b0: 2073 656e 736f 725f 203d 2073 656c 662e   sensor_ = self.
+0000c1c0: 6669 6e64 546d 7046 6965 6c64 3228 2269  findTmpField2("i
+0000c1d0: 6d61 6765 2d73 656e 736f 7222 295b 276e  mage-sensor")['n
+0000c1e0: 616d 6527 5d0a 2020 2020 2020 2020 2020  ame'].          
+0000c1f0: 2020 6966 2073 656e 736f 725f 203d 3d20    if sensor_ == 
+0000c200: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+0000c210: 2020 2020 7365 6e73 6f72 5f20 3d20 7365      sensor_ = se
+0000c220: 6c66 2e64 6972 2e73 656e 736f 7228 290a  lf.dir.sensor().
+0000c230: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000c240: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+0000c250: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000c260: 5d5b 2769 6d61 6765 2d73 6574 2d6e 616d  ]['image-set-nam
+0000c270: 6527 5d20 3d20 6946 444f 2e63 6f6e 7374  e'] = iFDO.const
+0000c280: 7275 6374 496d 6167 6553 6574 4e61 6d65  ructImageSetName
+0000c290: 2870 726f 6a65 6374 5f2c 6576 656e 745f  (project_,event_
+0000c2a0: 2c73 656e 736f 725f 290a 0a20 2020 2020  ,sensor_)..     
+0000c2b0: 2020 2023 2073 6574 2076 6572 7369 6f6e     # set version
+0000c2c0: 0a20 2020 2020 2020 2073 656c 662e 6966  .        self.if
+0000c2d0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000c2e0: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+0000c2f0: 696d 6167 652d 7365 742d 6966 646f 2d76  image-set-ifdo-v
+0000c300: 6572 7369 6f6e 275d 203d 206d 6971 7476  ersion'] = miqtv
+0000c310: 2e69 4644 4f5f 7665 7273 696f 6e0a 0a0a  .iFDO_version...
+0000c320: 2020 2020 6465 6620 7365 7448 6561 6465      def setHeade
+0000c330: 7249 6d61 6765 4c6f 6361 6c50 6174 6846  rImageLocalPathF
+0000c340: 6965 6c64 2873 656c 6629 3a0a 2020 2020  ield(self):.    
+0000c350: 2020 2020 2222 2220 5365 7473 2068 6561      """ Sets hea
+0000c360: 6465 7220 6669 656c 6420 2769 6d61 6765  der field 'image
+0000c370: 2d6c 6f63 616c 2d70 6174 6827 2066 726f  -local-path' fro
+0000c380: 6d20 696d 6167 6520 6469 7220 2222 220a  m image dir """.
+0000c390: 2020 2020 2020 2020 7365 6c66 2e69 6664          self.ifd
+0000c3a0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+0000c3b0: 5365 7448 6561 6465 724b 6579 5d5b 2769  SetHeaderKey]['i
+0000c3c0: 6d61 6765 2d6c 6f63 616c 2d70 6174 6827  mage-local-path'
+0000c3d0: 5d20 3d20 6f73 2e70 6174 682e 7265 6c70  ] = os.path.relp
+0000c3e0: 6174 6828 7365 6c66 2e69 6d61 6765 7344  ath(self.imagesD
+0000c3f0: 6972 2c20 6f73 2e70 6174 682e 6469 726e  ir, os.path.dirn
+0000c400: 616d 6528 7365 6c66 2e67 6574 6946 444f  ame(self.getiFDO
+0000c410: 4669 6c65 4e61 6d65 2829 2929 0a0a 0a20  FileName()))... 
+0000c420: 2020 2064 6566 2063 7265 6174 655f 6669     def create_fi
+0000c430: 656c 6473 2873 656c 662c 2061 6c6c 6f77  elds(self, allow
+0000c440: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
+0000c450: 643d 4661 6c73 6529 3a0a 2020 2020 2020  d=False):.      
+0000c460: 2020 2222 2220 4372 6561 7465 2061 6e64    """ Create and
+0000c470: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
+0000c480: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
+0000c490: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
+0000c4a0: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
+0000c4b0: 6520 6669 6c65 732e 204f 7665 7277 7269  e files. Overwri
+0000c4c0: 7465 7320 6578 6973 7469 6e67 2066 6965  tes existing fie
+0000c4d0: 6c64 732e 2022 2222 0a20 2020 2020 2020  lds. """.       
+0000c4e0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
+0000c4f0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
+0000c500: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000c510: 7465 5f66 696c 6573 2829 0a20 2020 2020  te_files().     
+0000c520: 2020 2072 6574 7572 6e20 7365 6c66 2e63     return self.c
+0000c530: 7265 6174 6569 4644 4f28 7365 6c66 2e69  reateiFDO(self.i
+0000c540: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000c550: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0000c560: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
+0000c570: 7328 292c 2061 6c6c 6f77 5f6d 6973 7369  s(), allow_missi
+0000c580: 6e67 5f72 6571 7569 7265 643d 616c 6c6f  ng_required=allo
+0000c590: 775f 6d69 7373 696e 675f 7265 7175 6972  w_missing_requir
+0000c5a0: 6564 290a 0a0a 2020 2020 6465 6620 7570  ed)...    def up
+0000c5b0: 6461 7465 5f66 6965 6c64 7328 7365 6c66  date_fields(self
+0000c5c0: 2c20 6865 6164 6572 5f6f 6e6c 793a 626f  , header_only:bo
+0000c5d0: 6f6c 3d4e 6f6e 6529 3a0a 2020 2020 2020  ol=None):.      
+0000c5e0: 2020 2222 2220 5570 6461 7465 2061 6e64    """ Update and
+0000c5f0: 2076 616c 6964 6174 6520 6375 7272 656e   validate curren
+0000c600: 7420 6865 6164 6572 2066 6965 6c64 7320  t header fields 
+0000c610: 616e 6420 6974 656d 2066 6965 6c64 7320  and item fields 
+0000c620: 6672 6f6d 2069 6e74 6572 6d65 6469 6174  from intermediat
+0000c630: 6520 6669 6c65 732e 2022 2222 0a20 2020  e files. """.   
+0000c640: 2020 2020 2069 6620 6865 6164 6572 5f6f       if header_o
+0000c650: 6e6c 7920 6973 204e 6f6e 653a 0a20 2020  nly is None:.   
+0000c660: 2020 2020 2020 2020 2068 6561 6465 725f           header_
+0000c670: 6f6e 6c79 203d 2073 656c 662e 6967 6e6f  only = self.igno
+0000c680: 7265 5f69 6d61 6765 5f66 696c 6573 0a20  re_image_files. 
+0000c690: 2020 2020 2020 2069 6620 6e6f 7420 6865         if not he
+0000c6a0: 6164 6572 5f6f 6e6c 793a 0a20 2020 2020  ader_only:.     
+0000c6b0: 2020 2020 2020 2069 7465 6d5f 6461 7461         item_data
+0000c6c0: 203d 2073 656c 662e 5f67 6574 5f69 7465   = self._get_ite
+0000c6d0: 6d5f 6461 7461 5f66 726f 6d5f 696e 7465  m_data_from_inte
+0000c6e0: 726d 6564 6961 7465 5f66 696c 6573 2829  rmediate_files()
+0000c6f0: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
+0000c700: 7572 6e20 7365 6c66 2e75 7064 6174 6569  urn self.updatei
+0000c710: 4644 4f28 7365 6c66 2e69 6664 6f5f 746d  FDO(self.ifdo_tm
+0000c720: 705b 7365 6c66 2e69 6d61 6765 5365 7448  p[self.imageSetH
+0000c730: 6561 6465 724b 6579 5d2c 2069 7465 6d5f  eaderKey], item_
+0000c740: 6461 7461 2e76 616c 7565 7328 2929 0a20  data.values()). 
+0000c750: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0000c760: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0000c770: 7365 6c66 2e75 7064 6174 6569 4644 4f28  self.updateiFDO(
+0000c780: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000c790: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000c7a0: 724b 6579 5d2c 205b 5d2c 2068 6561 6465  rKey], [], heade
+0000c7b0: 725f 6f6e 6c79 3d54 7275 6529 0a0a 0a20  r_only=True)... 
+0000c7c0: 2020 2064 6566 2063 7265 6174 6543 6f72     def createCor
+0000c7d0: 6546 6965 6c64 7328 7365 6c66 293a 0a20  eFields(self):. 
+0000c7e0: 2020 2020 2020 2022 2222 2044 4550 5245         """ DEPRE
+0000c7f0: 4341 4445 542c 2075 7365 2063 7265 6174  CADET, use creat
+0000c800: 655f 6669 656c 6473 2829 206f 7220 7570  e_fields() or up
+0000c810: 6461 7465 5f66 6965 6c64 7328 2920 696e  date_fields() in
+0000c820: 7374 6564 2e0a 2020 2020 2020 2020 4669  sted..        Fi
+0000c830: 6c6c 7320 7468 6520 6946 444f 2063 6f72  lls the iFDO cor
+0000c840: 6520 6669 656c 6473 2066 726f 6d20 696e  e fields from in
+0000c850: 7465 726d 6564 6961 7465 2066 696c 6573  termediate files
+0000c860: 2e20 5769 7468 6f75 7420 7468 656d 206e  . Without them n
+0000c870: 6f20 7661 6c69 6420 6946 444f 2063 616e  o valid iFDO can
+0000c880: 2062 6520 6372 6561 7465 642e 0a20 2020   be created..   
+0000c890: 2020 2020 2022 2222 0a20 2020 2020 2020       """.       
+0000c8a0: 2069 7465 6d5f 6461 7461 203d 2073 656c   item_data = sel
+0000c8b0: 662e 5f67 6574 5f69 7465 6d5f 6461 7461  f._get_item_data
+0000c8c0: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000c8d0: 7465 5f66 696c 6573 5f63 6f72 6528 290a  te_files_core().
+0000c8e0: 2020 2020 2020 2020 2320 6368 6563 6b20          # check 
+0000c8f0: 6669 656c 6473 2066 6f72 2076 616c 6964  fields for valid
+0000c900: 6974 790a 2020 2020 2020 2020 2320 6974  ity.        # it
+0000c910: 656d 5f64 6174 6120 636f 6e74 6169 6e73  em_data contains
+0000c920: 2066 6965 6c64 2069 6d61 6765 2d66 696c   field image-fil
+0000c930: 656e 616d 652c 2077 6869 6368 2077 6869  ename, which whi
+0000c940: 6368 2077 696c 6c20 6e6f 7420 6265 2073  ch will not be s
+0000c950: 746f 7265 6420 6173 2061 6e20 6974 656d  tored as an item
+0000c960: 2066 6965 6c64 2069 6e20 6946 4f44 2062   field in iFOD b
+0000c970: 7574 2061 7320 7468 6520 6974 656d 206e  ut as the item n
+0000c980: 616d 6520 6974 7365 6c66 0a20 2020 2020  ame itself.     
+0000c990: 2020 2072 6574 7572 6e20 7365 6c66 2e75     return self.u
+0000c9a0: 7064 6174 6569 4644 4f28 7365 6c66 2e69  pdateiFDO(self.i
+0000c9b0: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
+0000c9c0: 6765 5365 7448 6561 6465 724b 6579 5d2c  geSetHeaderKey],
+0000c9d0: 2069 7465 6d5f 6461 7461 2e76 616c 7565   item_data.value
+0000c9e0: 7328 2929 0a0a 0a20 2020 2064 6566 2063  s())...    def c
+0000c9f0: 7265 6174 6543 6170 7475 7265 416e 6443  reateCaptureAndC
+0000ca00: 6f6e 7465 6e74 4669 656c 6473 2873 656c  ontentFields(sel
+0000ca10: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+0000ca20: 4445 5052 4543 4144 4554 2c20 7573 6520  DEPRECADET, use 
+0000ca30: 6372 6561 7465 5f66 6965 6c64 7328 2920  create_fields() 
+0000ca40: 6f72 2075 7064 6174 655f 6669 656c 6473  or update_fields
+0000ca50: 2829 2069 6e73 7465 642e 0a20 2020 2020  () insted..     
+0000ca60: 2020 2046 696c 6c73 2074 6865 2069 4644     Fills the iFD
+0000ca70: 4f20 6361 7075 7472 6520 616e 6420 636f  O caputre and co
+0000ca80: 6e74 656e 7420 6669 6564 7320 6672 6f6d  ntent fieds from
+0000ca90: 2070 726f 7669 6465 6420 6461 7461 2066   provided data f
+0000caa0: 6965 6c64 7320 0a20 2020 2020 2020 2022  ields .        "
+0000cab0: 2222 0a20 2020 2020 2020 2069 7465 6d5f  "".        item_
+0000cac0: 6461 7461 203d 2073 656c 662e 5f67 6574  data = self._get
+0000cad0: 5f69 7465 6d5f 6461 7461 5f66 726f 6d5f  _item_data_from_
+0000cae0: 696e 7465 726d 6564 6961 7465 5f66 696c  intermediate_fil
+0000caf0: 6573 5f6e 6f6e 655f 636f 7265 2829 0a20  es_none_core(). 
+0000cb00: 2020 2020 2020 2023 2063 6865 636b 2066         # check f
+0000cb10: 6965 6c64 7320 666f 7220 7661 6c69 6469  ields for validi
+0000cb20: 7479 0a20 2020 2020 2020 2023 2069 7465  ty.        # ite
+0000cb30: 6d5f 6461 7461 2063 6f6e 7461 696e 7320  m_data contains 
+0000cb40: 6669 656c 6420 696d 6167 652d 6669 6c65  field image-file
+0000cb50: 6e61 6d65 2c20 7768 6963 6820 7768 6963  name, which whic
+0000cb60: 6820 7769 6c6c 206e 6f74 2062 6520 7374  h will not be st
+0000cb70: 6f72 6564 2061 7320 616e 2069 7465 6d20  ored as an item 
+0000cb80: 6669 656c 6420 696e 2069 464f 4420 6275  field in iFOD bu
+0000cb90: 7420 6173 2074 6865 2069 7465 6d20 6e61  t as the item na
+0000cba0: 6d65 2069 7473 656c 660a 2020 2020 2020  me itself.      
+0000cbb0: 2020 7265 7475 726e 2073 656c 662e 7570    return self.up
+0000cbc0: 6461 7465 6946 444f 2873 656c 662e 6966  dateiFDO(self.if
+0000cbd0: 646f 5f74 6d70 5b73 656c 662e 696d 6167  do_tmp[self.imag
+0000cbe0: 6553 6574 4865 6164 6572 4b65 795d 2c20  eSetHeaderKey], 
+0000cbf0: 6974 656d 5f64 6174 612e 7661 6c75 6573  item_data.values
+0000cc00: 2829 290a 0a20 2020 200a 2020 2020 6465  ())..    .    de
+0000cc10: 6620 5f67 6574 5f69 7465 6d5f 6461 7461  f _get_item_data
+0000cc20: 5f66 726f 6d5f 696e 7465 726d 6564 6961  _from_intermedia
+0000cc30: 7465 5f66 696c 6573 2873 656c 6629 3a0a  te_files(self):.
+0000cc40: 2020 2020 2020 2020 2222 2220 5265 6164          """ Read
+0000cc50: 2064 6174 6120 6672 6f6d 2063 6f72 6520   data from core 
+0000cc60: 616e 6420 6e6f 6e65 2d63 6f72 6520 696e  and none-core in
+0000cc70: 7465 726d 6465 6174 6520 6669 6c65 732c  termdeate files,
+0000cc80: 2063 6865 636b 2066 696c 6573 2065 7869   check files exi
+0000cc90: 7374 2c20 6164 6420 2769 6d61 6765 2d68  st, add 'image-h
+0000cca0: 616e 646c 6527 2e0a 2020 2020 2020 2020  andle'..        
+0000ccb0: 5265 7475 726e 7320 6469 6374 206f 6620  Returns dict of 
+0000ccc0: 666f 726d 207b 696d 6167 652d 6669 6c65  form {image-file
+0000ccd0: 2d6e 616d 653a 7b66 6965 6c64 3a76 616c  -name:{field:val
+0000cce0: 7565 7d2c 2e2e 2e7d 200a 2020 2020 2020  ue},...} .      
+0000ccf0: 2020 2222 220a 2020 2020 2020 2020 6974    """.        it
+0000cd00: 656d 5f64 6174 615f 636f 7265 203d 2073  em_data_core = s
+0000cd10: 656c 662e 5f67 6574 5f69 7465 6d5f 6461  elf._get_item_da
+0000cd20: 7461 5f66 726f 6d5f 696e 7465 726d 6564  ta_from_intermed
+0000cd30: 6961 7465 5f66 696c 6573 5f63 6f72 6528  iate_files_core(
+0000cd40: 290a 2020 2020 2020 2020 6974 656d 5f64  ).        item_d
+0000cd50: 6174 615f 6e6f 6e65 5f63 6f72 6520 3d20  ata_none_core = 
+0000cd60: 7365 6c66 2e5f 6765 745f 6974 656d 5f64  self._get_item_d
+0000cd70: 6174 615f 6672 6f6d 5f69 6e74 6572 6d65  ata_from_interme
+0000cd80: 6469 6174 655f 6669 6c65 735f 6e6f 6e65  diate_files_none
+0000cd90: 5f63 6f72 6528 290a 2020 2020 2020 2020  _core().        
+0000cda0: 2370 7072 696e 7428 6974 656d 5f64 6174  #pprint(item_dat
+0000cdb0: 615f 6e6f 6e65 5f63 6f72 6529 0a20 2020  a_none_core).   
+0000cdc0: 2020 2020 2023 7070 7269 6e74 2869 7465       #pprint(ite
+0000cdd0: 6d5f 6461 7461 5f63 6f72 6529 0a20 2020  m_data_core).   
+0000cde0: 2020 2020 2069 7465 6d5f 6461 7461 203d       item_data =
+0000cdf0: 2069 7465 6d5f 6461 7461 5f63 6f72 650a   item_data_core.
+0000ce00: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
+0000ce10: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
+0000ce20: 7064 6174 6544 6963 7473 2869 7465 6d5f  pdateDicts(item_
+0000ce30: 6461 7461 2c20 6974 656d 5f64 6174 615f  data, item_data_
+0000ce40: 6e6f 6e65 5f63 6f72 6529 0a20 2020 2020  none_core).     
+0000ce50: 2020 2023 7070 7269 6e74 2869 7465 6d5f     #pprint(item_
+0000ce60: 6461 7461 290a 2020 2020 2020 2020 7365  data).        se
+0000ce70: 6c66 2e70 726f 762e 6c6f 6728 6c6f 672c  lf.prov.log(log,
+0000ce80: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+0000ce90: 2020 2020 2020 2072 6574 7572 6e20 6974         return it
+0000cea0: 656d 5f64 6174 610a 0a20 2020 2064 6566  em_data..    def
+0000ceb0: 205f 6765 745f 6974 656d 5f64 6174 615f   _get_item_data_
+0000cec0: 6672 6f6d 5f69 6e74 6572 6d65 6469 6174  from_intermediat
+0000ced0: 655f 6669 6c65 735f 6e6f 6e65 5f63 6f72  e_files_none_cor
+0000cee0: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
+0000cef0: 2022 2222 2052 6561 6420 6461 7461 2066   """ Read data f
+0000cf00: 726f 6d20 6e6f 6e2d 636f 7265 2069 6e74  rom non-core int
+0000cf10: 6572 6d64 6561 7465 2066 696c 6573 2e0a  ermdeate files..
+0000cf20: 2020 2020 2020 2020 5265 7475 726e 7320          Returns 
+0000cf30: 6469 6374 206f 6620 666f 726d 207b 696d  dict of form {im
+0000cf40: 6167 652d 6669 6c65 2d6e 616d 653a 7b66  age-file-name:{f
+0000cf50: 6965 6c64 3a76 616c 7565 7d2c 2e2e 2e7d  ield:value},...}
+0000cf60: 200a 2020 2020 2020 2020 2222 220a 2020   .        """.  
+0000cf70: 2020 2020 2020 7265 7120 3d20 7365 6c66        req = self
+0000cf80: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
+0000cf90: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
+0000cfa0: 6f46 696c 6573 0a0a 2020 2020 2020 2020  oFiles..        
+0000cfb0: 6974 656d 5f64 6174 6120 3d20 7b7d 0a20  item_data = {}. 
+0000cfc0: 2020 2020 2020 2070 726f 6720 3d20 6d69         prog = mi
+0000cfd0: 7174 632e 5072 696e 744b 6e6f 776e 5072  qtc.PrintKnownPr
+0000cfe0: 6f67 7265 7373 4d73 6728 2250 6172 7369  ogressMsg("Parsi
+0000cff0: 6e67 2069 6e74 6572 6d65 6469 6174 6520  ng intermediate 
+0000d000: 6164 6469 7469 6f6e 616c 2064 6174 6122  additional data"
+0000d010: 2c20 6c65 6e28 7265 7129 290a 2020 2020  , len(req)).    
+0000d020: 2020 2020 666f 7220 7220 696e 2072 6571      for r in req
+0000d030: 3a0a 2020 2020 2020 2020 2020 2020 7072  :.            pr
+0000d040: 6f67 2e70 726f 6772 6573 7328 290a 2020  og.progress().  
+0000d050: 2020 2020 2020 2020 2020 6966 206f 732e            if os.
+0000d060: 7061 7468 2e65 7869 7374 7328 722e 6669  path.exists(r.fi
+0000d070: 6c65 4e61 6d65 293a 0a20 2020 2020 2020  leName):.       
+0000d080: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0000d090: 6173 6549 7465 6d44 6174 6146 726f 6d46  aseItemDataFromF
+0000d0a0: 696c 6528 6974 656d 5f64 6174 612c 722e  ile(item_data,r.
+0000d0b0: 6669 6c65 4e61 6d65 2c72 2e73 6570 6172  fileName,r.separ
+0000d0c0: 6174 6f72 2c72 2e68 6561 6465 722c 2072  ator,r.header, r
+0000d0d0: 2e64 6174 6574 696d 655f 666f 726d 6174  .datetime_format
+0000d0e0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000d0f0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000d100: 2250 6172 7365 6420 6974 656d 2064 6174  "Parsed item dat
+0000d110: 6120 6672 6f6d 3a20 2220 2b20 722e 6669  a from: " + r.fi
+0000d120: 6c65 4e61 6d65 290a 2020 2020 2020 2020  leName).        
+0000d130: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+0000d140: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+0000d150: 726f 762e 6c6f 6728 2246 696c 6520 646f  rov.log("File do
+0000d160: 6573 206e 6f74 2065 7869 7374 733a 2022  es not exists: "
+0000d170: 202b 2072 2e66 696c 654e 616d 6529 0a20   + r.fileName). 
+0000d180: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0000d190: 7228 290a 0a20 2020 2020 2020 2023 2063  r()..        # c
+0000d1a0: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
+0000d1b0: 0a20 2020 2020 2020 2072 656d 6f76 6520  .        remove 
+0000d1c0: 3d20 5b5d 0a20 2020 2020 2020 2066 6f72  = [].        for
+0000d1d0: 2069 6d67 2069 6e20 6974 656d 5f64 6174   img in item_dat
+0000d1e0: 613a 0a20 2020 2020 2020 2020 2020 2069  a:.            i
+0000d1f0: 6620 6e6f 7420 696d 6720 696e 2073 656c  f not img in sel
+0000d200: 662e 5f69 6d61 6765 4e61 6d65 7349 6d61  f._imageNamesIma
+0000d210: 6765 7344 6972 3a0a 2020 2020 2020 2020  gesDir:.        
+0000d220: 2020 2020 2020 2020 7265 6d6f 7665 2e61          remove.a
+0000d230: 7070 656e 6428 696d 6729 0a20 2020 2020  ppend(img).     
+0000d240: 2020 2066 6f72 2069 6d67 2069 6e20 7265     for img in re
+0000d250: 6d6f 7665 3a0a 2020 2020 2020 2020 2020  move:.          
+0000d260: 2020 6465 6c20 6974 656d 5f64 6174 615b    del item_data[
+0000d270: 696d 675d 0a0a 2020 2020 2020 2020 7265  img]..        re
+0000d280: 7475 726e 2069 7465 6d5f 6461 7461 0a0a  turn item_data..
+0000d290: 0a20 2020 2064 6566 205f 6765 745f 6974  .    def _get_it
+0000d2a0: 656d 5f64 6174 615f 6672 6f6d 5f69 6e74  em_data_from_int
+0000d2b0: 6572 6d65 6469 6174 655f 6669 6c65 735f  ermediate_files_
+0000d2c0: 636f 7265 2873 656c 6629 3a0a 2020 2020  core(self):.    
+0000d2d0: 2020 2020 2222 2220 5265 6164 2064 6174      """ Read dat
+0000d2e0: 6120 6672 6f6d 2063 6f72 6520 696e 7465  a from core inte
+0000d2f0: 726d 6465 6174 6520 6669 6c65 732c 2063  rmdeate files, c
+0000d300: 6865 636b 2066 696c 6573 2065 7869 7374  heck files exist
+0000d310: 2c20 6164 6420 2769 6d61 6765 2d68 616e  , add 'image-han
+0000d320: 646c 6527 2e0a 2020 2020 2020 2020 5265  dle'..        Re
+0000d330: 7475 726e 7320 6469 6374 206f 6620 666f  turns dict of fo
+0000d340: 726d 207b 696d 6167 652d 6669 6c65 2d6e  rm {image-file-n
+0000d350: 616d 653a 7b66 6965 6c64 3a76 616c 7565  ame:{field:value
+0000d360: 7d2c 2e2e 2e7d 200a 2020 2020 2020 2020  },...} .        
+0000d370: 2222 220a 0a20 2020 2020 2020 2023 2057  """..        # W
+0000d380: 6869 6368 2066 696c 6573 2063 6f6e 7461  hich files conta
+0000d390: 696e 2074 6865 2069 6e66 6f72 6d61 7469  in the informati
+0000d3a0: 6f6e 206e 6565 6465 6420 746f 2063 7265  on needed to cre
+0000d3b0: 6174 6520 7468 6520 6946 444f 2069 7465  ate the iFDO ite
+0000d3c0: 6d73 2063 6f72 6520 696e 666f 726d 6174  ms core informat
+0000d3d0: 696f 6e20 616e 6420 7768 6963 6820 636f  ion and which co
+0000d3e0: 6c75 6d6e 7320 7368 616c 6c20 6265 2075  lumns shall be u
+0000d3f0: 7365 640a 2020 2020 2020 2020 7265 7120  sed.        req 
+0000d400: 3d20 7365 6c66 2e69 6e74 6572 6d65 6469  = self.intermedi
+0000d410: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
+0000d420: 0a0a 2020 2020 2020 2020 6974 656d 5f64  ..        item_d
+0000d430: 6174 6120 3d20 7b7d 0a20 2020 2020 2020  ata = {}.       
+0000d440: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
+0000d450: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
+0000d460: 4d73 6728 2250 6172 7369 6e67 2069 6e74  Msg("Parsing int
+0000d470: 6572 6d65 6469 6174 6520 636f 7265 2064  ermediate core d
+0000d480: 6174 6122 2c20 6c65 6e28 7265 7129 290a  ata", len(req)).
+0000d490: 2020 2020 2020 2020 666f 7220 7220 696e          for r in
+0000d4a0: 2072 6571 3a0a 2020 2020 2020 2020 2020   req:.          
+0000d4b0: 2020 7072 6f67 2e70 726f 6772 6573 7328    prog.progress(
+0000d4c0: 290a 2020 2020 2020 2020 2020 2020 6669  ).            fi
+0000d4d0: 6c65 203d 2073 656c 662e 5f5f 6765 745f  le = self.__get_
+0000d4e0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
+0000d4f0: 2920 2b20 7265 715b 725d 5b27 7375 6666  ) + req[r]['suff
+0000d500: 6978 275d 0a20 2020 2020 2020 2020 2020  ix'].           
+0000d510: 2069 6620 6e6f 7420 6f73 2e70 6174 682e   if not os.path.
+0000d520: 6578 6973 7473 2866 696c 6529 3a0a 2020  exists(file):.  
+0000d530: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d540: 6c66 2e70 726f 762e 6c6f 6728 2257 4152  lf.prov.log("WAR
+0000d550: 4e49 4e47 2120 466f 7220 6163 6869 6576  NING! For achiev
+0000d560: 696e 6720 4641 4952 6e65 7373 2061 6e20  ing FAIRness an 
+0000d570: 696e 7465 726d 6564 6961 7465 2069 6d61  intermediate ima
+0000d580: 6765 2069 6e66 6f20 6669 6c65 2069 7320  ge info file is 
+0000d590: 6d69 7373 696e 673a 2022 2b20 7365 6c66  missing: "+ self
+0000d5a0: 2e5f 5f67 6574 5f69 6e74 5f66 696c 655f  .__get_int_file_
+0000d5b0: 7072 6566 6978 2829 202b 2072 6571 5b72  prefix() + req[r
+0000d5c0: 5d5b 2773 7566 6669 7827 5d2b 2022 2072  ]['suffix']+ " r
+0000d5d0: 756e 2066 6972 7374 3a20 2220 2b20 7265  un first: " + re
+0000d5e0: 715b 725d 5b27 6372 6561 7469 6f6e 4663  q[r]['creationFc
+0000d5f0: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0000d600: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+0000d610: 2020 2020 2020 2073 656c 662e 7061 7273         self.pars
+0000d620: 6549 7465 6d44 6174 6166 726f 6d54 6162  eItemDatafromTab
+0000d630: 4669 6c65 4461 7461 2869 7465 6d5f 6461  FileData(item_da
+0000d640: 7461 2c20 6669 6c65 2c20 7265 715b 725d  ta, file, req[r]
+0000d650: 5b27 636f 6c73 275d 2c20 7265 715b 725d  ['cols'], req[r]
+0000d660: 5b27 6f70 7469 6f6e 616c 275d 290a 2020  ['optional']).  
+0000d670: 2020 2020 2020 2020 2020 2020 2020 7365                se
+0000d680: 6c66 2e70 726f 762e 6c6f 6728 2250 6172  lf.prov.log("Par
+0000d690: 7365 6420 6974 656d 2064 6174 6120 6672  sed item data fr
+0000d6a0: 6f6d 3a20 2220 2b20 6669 6c65 290a 0a20  om: " + file).. 
+0000d6b0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
+0000d6c0: 7228 290a 2020 2020 2020 2020 6966 206c  r().        if l
+0000d6d0: 656e 2869 7465 6d5f 6461 7461 2920 3d3d  en(item_data) ==
+0000d6e0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+0000d6f0: 7261 6973 6520 4578 6365 7074 696f 6e28  raise Exception(
+0000d700: 224e 6f20 6946 444f 2069 7465 6d73 2229  "No iFDO items")
+0000d710: 0a0a 2020 2020 2020 2020 2320 6368 6563  ..        # chec
+0000d720: 6b20 6669 6c65 7320 6578 6973 740a 2020  k files exist.  
+0000d730: 2020 2020 2020 7265 6d6f 7665 203d 205b        remove = [
+0000d740: 5d0a 2020 2020 2020 2020 666f 7220 696d  ].        for im
+0000d750: 6720 696e 2069 7465 6d5f 6461 7461 3a0a  g in item_data:.
+0000d760: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000d770: 6f74 2069 6d67 2069 6e20 7365 6c66 2e5f  ot img in self._
+0000d780: 696d 6167 654e 616d 6573 496d 6167 6573  imageNamesImages
+0000d790: 4469 723a 0a20 2020 2020 2020 2020 2020  Dir:.           
+0000d7a0: 2020 2020 2072 656d 6f76 652e 6170 7065       remove.appe
+0000d7b0: 6e64 2869 6d67 290a 2020 2020 2020 2020  nd(img).        
+0000d7c0: 666f 7220 696d 6720 696e 2072 656d 6f76  for img in remov
+0000d7d0: 653a 0a20 2020 2020 2020 2020 2020 2064  e:.            d
+0000d7e0: 656c 2069 7465 6d5f 6461 7461 5b69 6d67  el item_data[img
+0000d7f0: 5d0a 0a20 2020 2020 2020 2023 2061 6464  ]..        # add
+0000d800: 2069 6d61 6765 2d75 726c 0a20 2020 2020   image-url.     
+0000d810: 2020 2066 6f72 2069 6d67 2069 6e20 6974     for img in it
+0000d820: 656d 5f64 6174 613a 0a20 2020 2020 2020  em_data:.       
+0000d830: 2020 2020 2069 6620 6973 696e 7374 616e       if isinstan
+0000d840: 6365 2869 7465 6d5f 6461 7461 5b69 6d67  ce(item_data[img
+0000d850: 5d2c 6c69 7374 293a 2023 2069 7465 6d20  ],list): # item 
+0000d860: 6973 2061 6c72 6561 6479 2061 206c 6973  is already a lis
+0000d870: 7420 2876 6964 656f 2920 6275 7420 7061  t (video) but pa
+0000d880: 7273 6564 2064 6174 6120 6973 206e 6f74  rsed data is not
+0000d890: 2c20 692e 652e 2070 6172 7365 6420 6461  , i.e. parsed da
+0000d8a0: 7461 2072 6566 6572 7320 746f 2077 686f  ta refers to who
+0000d8b0: 6c65 2076 6964 656f 2028 7469 6d65 2069  le video (time i
+0000d8c0: 6e64 6570 656e 6465 6e74 292c 2069 2e65  ndependent), i.e
+0000d8d0: 2e20 7772 6974 6520 746f 2066 6972 7374  . write to first
+0000d8e0: 2065 6e74 7279 0a20 2020 2020 2020 2020   entry.         
+0000d8f0: 2020 2020 2020 2075 7569 6420 3d20 6669         uuid = fi
+0000d900: 6e64 4669 656c 6428 6974 656d 5f64 6174  ndField(item_dat
+0000d910: 615b 696d 675d 5b30 5d2c 2769 6d61 6765  a[img][0],'image
+0000d920: 2d75 7569 6427 290a 2020 2020 2020 2020  -uuid').        
+0000d930: 2020 2020 2020 2020 6966 2075 7569 6420          if uuid 
+0000d940: 3d3d 2022 223a 0a20 2020 2020 2020 2020  == "":.         
+0000d950: 2020 2020 2020 2020 2020 2070 7269 6e74             print
+0000d960: 2869 7465 6d5f 6461 7461 5b69 6d67 5d29  (item_data[img])
+0000d970: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000d980: 2020 2020 2072 6169 7365 206d 6971 7463       raise miqtc
+0000d990: 2e49 6664 6f45 7863 6570 7469 6f6e 2822  .IfdoException("
+0000d9a0: 7575 6964 206e 6f74 2066 6f75 6e64 2028  uuid not found (
+0000d9b0: 6129 2229 0a20 2020 2020 2020 2020 2020  a)").           
+0000d9c0: 2020 2020 2069 7465 6d5f 6461 7461 5b69       item_data[i
+0000d9d0: 6d67 5d5b 305d 5b27 696d 6167 652d 6861  mg][0]['image-ha
+0000d9e0: 6e64 6c65 275d 203d 2073 656c 662e 696d  ndle'] = self.im
+0000d9f0: 6167 655f 6861 6e64 6c65 5f70 7265 6669  age_handle_prefi
+0000da00: 7820 2b20 2740 2720 2b20 7575 6964 0a20  x + '@' + uuid. 
+0000da10: 2020 2020 2020 2020 2020 2065 6c73 653a             else:
+0000da20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000da30: 2075 7569 6420 3d20 6669 6e64 4669 656c   uuid = findFiel
+0000da40: 6428 6974 656d 5f64 6174 615b 696d 675d  d(item_data[img]
+0000da50: 2c27 696d 6167 652d 7575 6964 2729 0a20  ,'image-uuid'). 
+0000da60: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+0000da70: 6620 7575 6964 203d 3d20 2222 3a0a 2020  f uuid == "":.  
+0000da80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000da90: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
+0000daa0: 646f 4578 6365 7074 696f 6e28 2275 7569  doException("uui
+0000dab0: 6420 6e6f 7420 666f 756e 6420 2862 2922  d not found (b)"
+0000dac0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0000dad0: 2020 6974 656d 5f64 6174 615b 696d 675d    item_data[img]
+0000dae0: 5b27 696d 6167 652d 6861 6e64 6c65 275d  ['image-handle']
+0000daf0: 203d 2073 656c 662e 696d 6167 655f 6861   = self.image_ha
+0000db00: 6e64 6c65 5f70 7265 6669 7820 2b20 2740  ndle_prefix + '@
+0000db10: 2720 2b20 7575 6964 0a0a 2020 2020 2020  ' + uuid..      
+0000db20: 2020 7265 7475 726e 2069 7465 6d5f 6461    return item_da
+0000db30: 7461 0a0a 0a20 2020 2064 6566 2061 6464  ta...    def add
+0000db40: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
+0000db50: 696c 6528 7365 6c66 2c20 6669 6c65 4e61  ile(self, fileNa
+0000db60: 6d65 3a20 7374 722c 2073 6570 6172 6174  me: str, separat
+0000db70: 6f72 3a73 7472 2c20 6865 6164 6572 3a64  or:str, header:d
+0000db80: 6963 742c 2064 6174 6574 696d 655f 666f  ict, datetime_fo
+0000db90: 726d 6174 203d 206d 6971 7476 2e64 6174  rmat = miqtv.dat
+0000dba0: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0000dbb0: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
+0000dbc0: 2220 4164 6420 6120 636f 6c75 6d6e 2073  " Add a column s
+0000dbd0: 6570 6572 6174 6564 2074 6578 7420 6669  eperated text fi
+0000dbe0: 6c65 2074 6f20 7061 7273 6520 6974 656d  le to parse item
+0000dbf0: 2064 6174 6120 6672 6f6d 2062 7920 6372   data from by cr
+0000dc00: 6561 7465 4361 7074 7572 6541 6e64 436f  eateCaptureAndCo
+0000dc10: 6e74 656e 7446 6965 6c64 7328 292e 200a  ntentFields(). .
+0000dc20: 2020 2020 2020 2020 436f 6c75 6d6e 7320          Columns 
+0000dc30: 6865 6164 6572 7320 7769 6c6c 2062 6520  headers will be 
+0000dc40: 7365 7420 6173 2069 7465 6d20 6669 656c  set as item fiel
+0000dc50: 6420 6e61 6d65 732e 204d 7573 7420 636f  d names. Must co
+0000dc60: 6e74 6169 6e20 636f 6c75 6d6e 2027 696d  ntain column 'im
+0000dc70: 6167 652d 6669 6c65 6e61 6d65 272e 0a20  age-filename'.. 
+0000dc80: 2020 2020 2020 2022 2222 0a20 2020 2020         """.     
+0000dc90: 2020 2069 6620 6669 6c65 4e61 6d65 203d     if fileName =
+0000dca0: 3d20 4e6f 6e65 206f 7220 6e6f 7420 6f73  = None or not os
+0000dcb0: 2e70 6174 682e 6578 6973 7473 2866 696c  .path.exists(fil
+0000dcc0: 654e 616d 6529 3a0a 2020 2020 2020 2020  eName):.        
+0000dcd0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000dce0: 696f 6e28 2246 696c 6522 2c66 696c 654e  ion("File",fileN
+0000dcf0: 616d 652c 226e 6f74 2066 6f75 6e64 2229  ame,"not found")
+0000dd00: 0a0a 2020 2020 2020 2020 666f 7220 6669  ..        for fi
+0000dd10: 656c 6420 696e 2068 6561 6465 723a 0a20  eld in header:. 
+0000dd20: 2020 2020 2020 2020 2020 2069 6620 6865             if he
+0000dd30: 6164 6572 5b66 6965 6c64 5d20 6e6f 7420  ader[field] not 
+0000dd40: 696e 206d 6971 7466 2e74 6162 4669 6c65  in miqtf.tabFile
+0000dd50: 436f 6c75 6d6e 4e61 6d65 7328 6669 6c65  ColumnNames(file
+0000dd60: 4e61 6d65 2c63 6f6c 5f73 6570 6172 6174  Name,col_separat
+0000dd70: 6f72 3d73 6570 6172 6174 6f72 293a 0a20  or=separator):. 
+0000dd80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+0000dd90: 6169 7365 2045 7863 6570 7469 6f6e 2822  aise Exception("
+0000dda0: 436f 6c75 6d6e 222c 2068 6561 6465 725b  Column", header[
+0000ddb0: 6669 656c 645d 2c20 226e 6f74 2069 6e20  field], "not in 
+0000ddc0: 6669 6c65 222c 2066 696c 654e 616d 6529  file", fileName)
+0000ddd0: 0a0a 2020 2020 2020 2020 6966 206d 6971  ..        if miq
+0000dde0: 7463 2e61 7373 6572 7453 6c61 7368 286f  tc.assertSlash(o
+0000ddf0: 732e 7061 7468 2e64 6972 6e61 6d65 2866  s.path.dirname(f
+0000de00: 696c 654e 616d 6529 2920 213d 206d 6971  ileName)) != miq
+0000de10: 7463 2e61 7373 6572 7453 6c61 7368 2873  tc.assertSlash(s
+0000de20: 656c 662e 6469 722e 746f 2873 656c 662e  elf.dir.to(self.
+0000de30: 6469 722e 6474 2e69 6e74 6572 6d65 6469  dir.dt.intermedi
+0000de40: 6174 6529 293a 0a20 2020 2020 2020 2020  ate)):.         
+0000de50: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
+0000de60: 2820 2243 6175 7469 6f6e 2120 4974 2069  ( "Caution! It i
+0000de70: 7320 7265 636f 6d6d 656e 6465 6420 746f  s recommended to
+0000de80: 2070 7574 2066 696c 6520 696e 2074 6865   put file in the
+0000de90: 2064 6972 6563 746f 7279 2773 2027 696e   directory's 'in
+0000dea0: 7465 726d 6564 6961 7465 2720 666f 6c64  termediate' fold
+0000deb0: 6572 3a20 2220 2b20 6669 6c65 4e61 6d65  er: " + fileName
+0000dec0: 290a 2020 2020 2020 2020 6e63 6669 6966  ).        ncfiif
+0000ded0: 203d 206e 6f6e 436f 7265 4669 656c 6449   = nonCoreFieldI
+0000dee0: 6e74 6572 6d65 6469 6174 6549 7465 6d49  ntermediateItemI
+0000def0: 6e66 6f46 696c 6528 6669 6c65 4e61 6d65  nfoFile(fileName
+0000df00: 2c20 7365 7061 7261 746f 722c 2068 6561  , separator, hea
+0000df10: 6465 722c 2064 6174 6574 696d 655f 666f  der, datetime_fo
+0000df20: 726d 6174 290a 2020 2020 2020 2020 6966  rmat).        if
+0000df30: 206e 6366 6969 6620 6e6f 7420 696e 2073   ncfiif not in s
+0000df40: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000df50: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000df60: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
+0000df70: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
+0000df80: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
+0000df90: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
+0000dfa0: 6573 2e61 7070 656e 6428 6e63 6669 6966  es.append(ncfiif
+0000dfb0: 290a 0a20 2020 2064 6566 2061 6464 4974  )..    def addIt
+0000dfc0: 656d 496e 666f 5461 6246 696c 6528 7365  emInfoTabFile(se
+0000dfd0: 6c66 2c20 6669 6c65 4e61 6d65 3a20 7374  lf, fileName: st
+0000dfe0: 722c 2073 6570 6172 6174 6f72 3a73 7472  r, separator:str
+0000dff0: 2c20 6865 6164 6572 3a64 6963 742c 2064  , header:dict, d
+0000e000: 6174 6574 696d 655f 666f 726d 6174 203d  atetime_format =
+0000e010: 206d 6971 7476 2e64 6174 655f 666f 726d   miqtv.date_form
+0000e020: 6174 735b 276d 6172 6971 7427 5d29 3a0a  ats['mariqt']):.
+0000e030: 2020 2020 2020 2020 2222 2220 4465 7072          """ Depr
+0000e040: 6563 6174 6564 202d 2075 7365 2061 6464  ecated - use add
+0000e050: 5f69 7465 6d5f 696e 666f 5f74 6162 5f66  _item_info_tab_f
+0000e060: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+0000e070: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+0000e080: 666f 5f74 6162 5f66 696c 6528 6669 6c65  fo_tab_file(file
+0000e090: 4e61 6d65 2c73 6570 6172 6174 6f72 2c68  Name,separator,h
+0000e0a0: 6561 6465 722c 6461 7465 7469 6d65 5f66  eader,datetime_f
+0000e0b0: 6f72 6d61 7429 0a0a 2020 2020 2020 2020  ormat)..        
+0000e0c0: 0a20 2020 2064 6566 2072 656d 6f76 6549  .    def removeI
+0000e0d0: 7465 6d49 6e66 6f54 6162 4669 6c65 2873  temInfoTabFile(s
+0000e0e0: 656c 662c 2066 696c 654e 616d 653a 2073  elf, fileName: s
+0000e0f0: 7472 2c20 7365 7061 7261 746f 723a 7374  tr, separator:st
+0000e100: 722c 2068 6561 6465 723a 6469 6374 2c20  r, header:dict, 
+0000e110: 6461 7465 7469 6d65 5f66 6f72 6d61 743a  datetime_format:
+0000e120: 7374 7229 3a0a 2020 2020 2020 2020 2222  str):.        ""
+0000e130: 2220 7265 6d6f 7665 7320 6669 6c65 2069  " removes file i
+0000e140: 7465 6d20 6672 6f6d 206c 6973 7420 6f66  tem from list of
+0000e150: 2066 696c 6573 2074 6f20 7061 7273 6520   files to parse 
+0000e160: 6974 656d 2064 6174 6120 6672 6f6d 2062  item data from b
+0000e170: 7920 6372 6561 7465 4361 7074 7572 6541  y createCaptureA
+0000e180: 6e64 436f 6e74 656e 7446 6965 6c64 7328  ndContentFields(
+0000e190: 2920 2222 220a 2020 2020 2020 2020 6e63  ) """.        nc
+0000e1a0: 6669 6966 203d 206e 6f6e 436f 7265 4669  fiif = nonCoreFi
+0000e1b0: 656c 6449 6e74 6572 6d65 6469 6174 6549  eldIntermediateI
+0000e1c0: 7465 6d49 6e66 6f46 696c 6528 6669 6c65  temInfoFile(file
+0000e1d0: 4e61 6d65 2c20 7365 7061 7261 746f 722c  Name, separator,
+0000e1e0: 2068 6561 6465 722c 2064 6174 6574 696d   header, datetim
+0000e1f0: 655f 666f 726d 6174 290a 2020 2020 2020  e_format).      
+0000e200: 2020 6966 206e 6366 6969 6620 696e 2073    if ncfiif in s
+0000e210: 656c 662e 6e6f 6e43 6f72 6546 6965 6c64  elf.nonCoreField
+0000e220: 496e 7465 726d 6564 6961 7465 4974 656d  IntermediateItem
+0000e230: 496e 666f 4669 6c65 733a 200a 2020 2020  InfoFiles: .    
+0000e240: 2020 2020 2020 2020 7365 6c66 2e6e 6f6e          self.non
+0000e250: 436f 7265 4669 656c 6449 6e74 6572 6d65  CoreFieldInterme
+0000e260: 6469 6174 6549 7465 6d49 6e66 6f46 696c  diateItemInfoFil
+0000e270: 6573 2e72 656d 6f76 6528 6e63 6669 6966  es.remove(ncfiif
+0000e280: 290a 0a0a 2020 2020 6465 6620 7570 6461  )...    def upda
+0000e290: 7465 6946 444f 2873 656c 662c 2068 6561  teiFDO(self, hea
+0000e2a0: 6465 723a 2064 6963 742c 2069 7465 6d73  der: dict, items
+0000e2b0: 3a20 6c69 7374 2c20 6865 6164 6572 5f6f  : list, header_o
+0000e2c0: 6e6c 793d 4661 6c73 6529 3a0a 2020 2020  nly=False):.    
+0000e2d0: 2020 2020 2222 2220 5570 6461 7465 7320      """ Updates 
+0000e2e0: 7468 6520 6375 7272 656e 7420 7661 6c75  the current valu
+0000e2f0: 6573 2069 4644 4f20 7769 7468 2074 6865  es iFDO with the
+0000e300: 2070 726f 7669 6465 6420 6e65 7720 7661   provided new va
+0000e310: 6c75 6573 2022 2222 0a20 2020 2020 2020  lues """.       
+0000e320: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
+0000e330: 6174 6569 4644 4f28 6865 6164 6572 2c20  ateiFDO(header, 
+0000e340: 6974 656d 732c 2075 7064 6174 6545 7869  items, updateExi
+0000e350: 7374 696e 673d 5472 7565 2c20 6865 6164  sting=True, head
+0000e360: 6572 4f6e 6c79 3d68 6561 6465 725f 6f6e  erOnly=header_on
+0000e370: 6c79 290a 0a0a 2020 2020 6465 6620 6372  ly)...    def cr
+0000e380: 6561 7465 6946 444f 2873 656c 662c 2068  eateiFDO(self, h
+0000e390: 6561 6465 723a 2064 6963 742c 2069 7465  eader: dict, ite
+0000e3a0: 6d73 3a20 6c69 7374 2c20 7570 6461 7465  ms: list, update
+0000e3b0: 4578 6973 7469 6e67 3d46 616c 7365 2c68  Existing=False,h
+0000e3c0: 6561 6465 724f 6e6c 793d 4661 6c73 652c  eaderOnly=False,
+0000e3d0: 616c 6c6f 775f 6d69 7373 696e 675f 7265  allow_missing_re
+0000e3e0: 7175 6972 6564 3d46 616c 7365 2c76 616c  quired=False,val
+0000e3f0: 6964 6174 655f 7369 6e67 6c65 5f69 7465  idate_single_ite
+0000e400: 6d73 3d46 616c 7365 293a 0a20 2020 2020  ms=False):.     
+0000e410: 2020 2022 2222 2043 7265 6174 6573 2046     """ Creates F
+0000e420: 4149 5220 6469 6769 7461 6c20 6f62 6a65  AIR digital obje
+0000e430: 6374 2066 6f72 2074 6865 2069 6d61 6765  ct for the image
+0000e440: 2064 6174 6120 6974 7365 6c66 2e20 5468   data itself. Th
+0000e450: 6973 2063 6f6e 7369 7374 7320 6f66 2068  is consists of h
+0000e460: 6561 6465 7220 696e 666f 726d 6174 696f  eader informatio
+0000e470: 6e20 616e 6420 6974 656d 2069 6e66 6f72  n and item infor
+0000e480: 6d61 7469 6f6e 2e0a 2020 2020 2020 2020  mation..        
+0000e490: 7570 6461 7465 4578 6973 7469 6e67 3a20  updateExisting: 
+0000e4a0: 6966 2046 616c 7365 206f 6c64 2076 616c  if False old val
+0000e4b0: 7565 7320 6172 6520 7265 6d6f 7665 642c  ues are removed,
+0000e4c0: 206f 7468 6572 7769 7365 2074 6865 7920   otherwise they 
+0000e4d0: 6172 6520 7570 6461 7465 642e 0a20 2020  are updated..   
+0000e4e0: 2020 2020 2068 6561 6465 724f 6e6c 793a       headerOnly:
+0000e4f0: 2069 6620 5472 7565 2069 7465 6d73 206d   if True items m
+0000e500: 6179 2062 6520 656d 7074 7920 6c69 7374  ay be empty list
+0000e510: 2e0a 2020 2020 2020 2020 616c 6c6f 775f  ..        allow_
+0000e520: 6d69 7373 696e 675f 7265 7175 6972 6564  missing_required
+0000e530: 3a20 6966 2054 7275 652c 206e 6f20 6578  : if True, no ex
+0000e540: 6365 7074 696f 6e20 7269 7365 6e20 6966  ception risen if
+0000e550: 2061 2072 6571 7569 7265 6420 6669 656c   a required fiel
+0000e560: 6420 6973 206d 6973 7369 6e67 2e20 2022  d is missing.  "
+0000e570: 2222 0a0a 2020 2020 2020 2020 6966 206e  ""..        if n
+0000e580: 6f74 2075 7064 6174 6545 7869 7374 696e  ot updateExistin
+0000e590: 6720 616e 6420 6c65 6e28 6974 656d 7329  g and len(items)
+0000e5a0: 203d 3d20 3020 616e 6420 6e6f 7420 6865   == 0 and not he
+0000e5b0: 6164 6572 4f6e 6c79 3a0a 2020 2020 2020  aderOnly:.      
+0000e5c0: 2020 2020 2020 7261 6973 6520 4578 6365        raise Exce
+0000e5d0: 7074 696f 6e28 274e 6f20 6974 656d 2069  ption('No item i
+0000e5e0: 6e66 6f72 6d61 7469 6f6e 2067 6976 656e  nformation given
+0000e5f0: 2729 0a0a 2020 2020 2020 2020 6966 2075  ')..        if u
+0000e600: 7064 6174 6545 7869 7374 696e 673a 0a20  pdateExisting:. 
+0000e610: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
+0000e620: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
+0000e630: 7365 6c66 2e75 7064 6174 655f 6966 646f  self.update_ifdo
+0000e640: 5f68 6561 6465 725f 6669 656c 6473 2868  _header_fields(h
+0000e650: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
+0000e660: 2020 2023 2069 7465 6d73 0a20 2020 2020     # items.     
+0000e670: 2020 2020 2020 2023 2075 7064 6174 6520         # update 
+0000e680: 636f 7079 206f 6620 6375 7272 656e 7420  copy of current 
+0000e690: 6974 656d 7320 7769 7468 206e 6577 2069  items with new i
+0000e6a0: 7465 6d73 2066 6965 6c64 730a 2020 2020  tems fields.    
+0000e6b0: 2020 2020 2020 2020 6974 656d 7344 6963          itemsDic
+0000e6c0: 7420 3d20 6d69 7174 692e 6372 6561 7465  t = miqti.create
+0000e6d0: 496d 6167 6549 7465 6d73 4469 6374 4672  ImageItemsDictFr
+0000e6e0: 6f6d 496d 6167 6549 7465 6d73 4c69 7374  omImageItemsList
+0000e6f0: 2869 7465 6d73 290a 2020 2020 2020 2020  (items).        
+0000e700: 2020 2020 7570 6461 7465 6449 7465 6d73      updatedItems
+0000e710: 5f63 6f70 7920 3d20 636f 7079 2e64 6565  _copy = copy.dee
+0000e720: 7063 6f70 7928 7365 6c66 2e69 6664 6f5f  pcopy(self.ifdo_
+0000e730: 746d 705b 7365 6c66 2e69 6d61 6765 5365  tmp[self.imageSe
+0000e740: 7449 7465 6d73 4b65 795d 290a 2020 2020  tItemsKey]).    
+0000e750: 2020 2020 2020 2020 6c6f 6720 3d20 6d69          log = mi
+0000e760: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
+0000e770: 7064 6174 6544 6963 7473 2875 7064 6174  pdateDicts(updat
+0000e780: 6564 4974 656d 735f 636f 7079 2c20 6974  edItems_copy, it
+0000e790: 656d 7344 6963 7429 0a20 2020 2020 2020  emsDict).       
+0000e7a0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+0000e7b0: 6f67 286c 6f67 2c64 6f6e 7453 686f 773d  og(log,dontShow=
+0000e7c0: 5472 7565 290a 2020 2020 2020 2020 2020  True).          
+0000e7d0: 2020 6974 656d 7320 3d20 6d69 7174 692e    items = miqti.
+0000e7e0: 6372 6561 7465 496d 6167 6549 7465 6d73  createImageItems
+0000e7f0: 4c69 7374 4672 6f6d 496d 6167 6549 7465  ListFromImageIte
+0000e800: 6d73 4469 6374 2875 7064 6174 6564 4974  msDict(updatedIt
+0000e810: 656d 735f 636f 7079 290a 0a20 2020 2020  ems_copy)..     
+0000e820: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+0000e830: 2020 2020 2023 206f 7665 7277 7269 7465       # overwrite
+0000e840: 2068 6561 6465 720a 2020 2020 2020 2020   header.        
+0000e850: 2020 2020 7365 6c66 2e73 6574 6946 444f      self.setiFDO
+0000e860: 4865 6164 6572 4669 656c 6473 2868 6561  HeaderFields(hea
+0000e870: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0000e880: 2023 2063 6c65 6172 2069 7465 6d73 2073   # clear items s
+0000e890: 6563 7469 6f6e 0a20 2020 2020 2020 2020  ection.         
+0000e8a0: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000e8b0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+0000e8c0: 656d 734b 6579 5d20 3d20 7b7d 0a0a 0a20  emsKey] = {}... 
+0000e8d0: 2020 2020 2020 2023 2050 6172 7365 2069         # Parse i
+0000e8e0: 6d61 6765 2d61 6273 7472 6163 7420 616e  mage-abstract an
+0000e8f0: 6420 6669 6c6c 2069 7473 2070 6c61 6365  d fill its place
+0000e900: 686f 6c64 6572 7320 7769 7468 2069 6e66  holders with inf
+0000e910: 6f72 6d61 7469 6f6e 0a20 2020 2020 2020  ormation.       
+0000e920: 2074 7279 3a0a 2020 2020 2020 2020 2020   try:.          
+0000e930: 2020 7365 6c66 2e69 6664 6f5f 746d 705b    self.ifdo_tmp[
+0000e940: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000e950: 6465 724b 6579 5d5b 2769 6d61 6765 2d61  derKey]['image-a
+0000e960: 6273 7472 6163 7427 5d20 3d20 6d69 7174  bstract'] = miqt
+0000e970: 732e 7061 7273 6552 6570 6c61 6365 5661  s.parseReplaceVa
+0000e980: 6c28 7365 6c66 2e69 6664 6f5f 746d 705b  l(self.ifdo_tmp[
+0000e990: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
+0000e9a0: 6465 724b 6579 5d2c 2027 696d 6167 652d  derKey], 'image-
+0000e9b0: 6162 7374 7261 6374 2729 0a20 2020 2020  abstract').     
+0000e9c0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+0000e9d0: 696f 6e20 6173 2065 783a 0a20 2020 2020  ion as ex:.     
+0000e9e0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+0000e9f0: 2e6c 6f67 2822 436f 756c 6420 6e6f 7420  .log("Could not 
+0000ea00: 7265 706c 6163 6520 6b65 7973 2069 6e20  replace keys in 
+0000ea10: 5c27 696d 6167 652d 6162 7374 7261 6374  \'image-abstract
+0000ea20: 5c27 3a20 2220 2b20 7374 7228 6578 2929  \': " + str(ex))
+0000ea30: 0a0a 0a20 2020 2020 2020 2023 2073 6574  ...        # set
+0000ea40: 2076 6572 7369 6f6e 2028 736f 2069 7420   version (so it 
+0000ea50: 6361 6e6e 6f74 2062 6520 6368 616e 6765  cannot be change
+0000ea60: 6420 6279 2075 7365 7229 0a20 2020 2020  d by user).     
+0000ea70: 2020 2073 656c 662e 6966 646f 5f74 6d70     self.ifdo_tmp
+0000ea80: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+0000ea90: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+0000eaa0: 7365 742d 6966 646f 2d76 6572 7369 6f6e  set-ifdo-version
+0000eab0: 275d 203d 206d 6971 7476 2e69 4644 4f5f  '] = miqtv.iFDO_
+0000eac0: 7665 7273 696f 6e0a 0a20 2020 2020 2020  version..       
+0000ead0: 2023 2056 616c 6964 6174 6520 6974 656d   # Validate item
+0000eae0: 2069 6e66 6f72 6d61 7469 6f6e 0a20 2020   information.   
+0000eaf0: 2020 2020 2069 6d61 6765 5f73 6574 5f69       image_set_i
+0000eb00: 7465 6d73 203d 207b 7d0a 2020 2020 2020  tems = {}.      
+0000eb10: 2020 6966 2068 6561 6465 724f 6e6c 793a    if headerOnly:
+0000eb20: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0000eb30: 662e 7072 6f76 2e6c 6f67 2822 4361 7574  f.prov.log("Caut
+0000eb40: 696f 6e21 2069 4644 4f20 6372 6561 7465  ion! iFDO create
+0000eb50: 6420 696e 2068 6561 6465 725f 6f6e 6c79  d in header_only
+0000eb60: 2f69 676e 6f72 655f 696d 6167 655f 6669  /ignore_image_fi
+0000eb70: 6c65 206d 6f64 652e 2049 6d61 6765 2069  le mode. Image i
+0000eb80: 7465 6d73 2061 7265 206e 6569 7468 6572  tems are neither
+0000eb90: 2075 7064 6174 6564 206e 6f72 2063 6865   updated nor che
+0000eba0: 636b 6564 2e22 290a 2020 2020 2020 2020  cked.").        
+0000ebb0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0000ebc0: 2020 696e 7661 6c69 645f 6974 656d 7320    invalid_items 
+0000ebd0: 3d20 300a 0a20 2020 2020 2020 2020 2020  = 0..           
+0000ebe0: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
+0000ebf0: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
+0000ec00: 4d73 6728 2243 6865 636b 696e 6720 6974  Msg("Checking it
+0000ec10: 656d 7322 2c20 6c65 6e28 6974 656d 7329  ems", len(items)
+0000ec20: 2c6d 6f64 756c 6f3d 3529 0a20 2020 2020  ,modulo=5).     
+0000ec30: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
+0000ec40: 696e 2069 7465 6d73 3a0a 2020 2020 2020  in items:.      
+0000ec50: 2020 2020 2020 2020 2020 7072 6f67 2e70            prog.p
+0000ec60: 726f 6772 6573 7328 290a 2020 2020 2020  rogress().      
+0000ec70: 2020 2020 2020 2020 2020 2320 6368 6563            # chec
+0000ec80: 6b20 6966 2061 6c6c 2063 6f72 6520 6669  k if all core fi
+0000ec90: 656c 6473 2061 7265 2066 696c 6c65 6420  elds are filled 
+0000eca0: 616e 6420 6172 6520 6669 6c6c 6564 2076  and are filled v
+0000ecb0: 616c 6964 6c79 0a20 2020 2020 2020 2020  alidly.         
+0000ecc0: 2020 2020 2020 2074 7279 3a0a 0a20 2020         try:..   
+0000ecd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ece0: 2023 2063 6865 636b 2069 7465 6d20 696d   # check item im
+0000ecf0: 6167 6520 6578 6973 7473 0a20 2020 2020  age exists.     
+0000ed00: 2020 2020 2020 2020 2020 2020 2020 2023                 #
+0000ed10: 2069 6620 6974 656d 2069 7320 6120 6c69   if item is a li
+0000ed20: 7374 2028 7669 6465 6f29 2c20 6f6e 6520  st (video), one 
+0000ed30: 776f 756c 6420 6861 7665 2074 6f20 6368  would have to ch
+0000ed40: 6563 6b20 6966 2065 6163 6820 656e 7472  eck if each entr
+0000ed50: 7920 6973 2076 616c 6964 2067 6976 656e  y is valid given
+0000ed60: 2074 6865 2064 6566 6175 6c74 2076 616c   the default val
+0000ed70: 7565 7320 696e 2066 6972 7374 2065 6e74  ues in first ent
+0000ed80: 7279 2070 6c75 7320 6769 7665 6e20 6465  ry plus given de
+0000ed90: 6661 756c 7420 7661 6c75 6573 2069 6e20  fault values in 
+0000eda0: 6865 6164 6572 0a20 2020 2020 2020 2020  header.         
+0000edb0: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0000edc0: 7420 6973 696e 7374 616e 6365 2869 7465  t isinstance(ite
+0000edd0: 6d2c 6c69 7374 293a 0a20 2020 2020 2020  m,list):.       
+0000ede0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000edf0: 2069 7465 6d20 3d20 5b69 7465 6d5d 0a20   item = [item]. 
+0000ee00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee10: 2020 2073 7562 4974 656d 4465 6661 756c     subItemDefaul
+0000ee20: 7420 3d20 6974 656d 5b30 5d20 0a20 2020  t = item[0] .   
+0000ee30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000ee40: 2066 6f72 2073 7562 4974 656d 2069 6e20   for subItem in 
+0000ee50: 6974 656d 3a0a 2020 2020 2020 2020 2020  item:.          
+0000ee60: 2020 2020 2020 2020 2020 2020 2020 6669                fi
+0000ee70: 6c65 5f6e 616d 6520 3d20 7375 6249 7465  le_name = subIte
+0000ee80: 6d5b 2769 6d61 6765 2d66 696c 656e 616d  m['image-filenam
+0000ee90: 6527 5d0a 2020 2020 2020 2020 2020 2020  e'].            
+0000eea0: 2020 2020 2020 2020 2020 2020 6966 206e              if n
+0000eeb0: 6f74 2073 656c 662e 6967 6e6f 7265 5f69  ot self.ignore_i
+0000eec0: 6d61 6765 5f66 696c 6573 2061 6e64 2066  mage_files and f
+0000eed0: 696c 655f 6e61 6d65 206e 6f74 2069 6e20  ile_name not in 
+0000eee0: 7365 6c66 2e5f 696d 6167 654e 616d 6573  self._imageNames
+0000eef0: 496d 6167 6573 4469 723a 0a20 2020 2020  ImagesDir:.     
 0000ef00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef10: 2020 6d69 7174 742e 6172 655f 7661 6c69    miqtt.are_vali
-0000ef20: 645f 6966 646f 5f66 6965 6c64 7328 7375  d_ifdo_fields(su
-0000ef30: 6249 7465 6d29 0a20 2020 2020 2020 2020  bItem).         
-0000ef40: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0000ef50: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0000ef60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000ef70: 2066 6f72 2066 6965 6c64 5f6e 616d 652c   for field_name,
-0000ef80: 6669 656c 645f 7661 6c20 696e 2073 7562  field_val in sub
-0000ef90: 4974 656d 2e69 7465 6d73 2829 3a0a 2020  Item.items():.  
-0000efa0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000efb0: 2020 2020 2020 2020 2020 2020 2020 6d69                mi
-0000efc0: 7174 742e 6966 646f 5f66 6965 6c64 5f61  qtt.ifdo_field_a
-0000efd0: 6464 6974 696f 6e61 6c5f 6368 6563 6b73  dditional_checks
-0000efe0: 2866 6965 6c64 5f6e 616d 652c 6669 656c  (field_name,fiel
-0000eff0: 645f 7661 6c29 2020 2020 2020 2020 2020  d_val)          
-0000f000: 2020 2020 2020 2020 2020 2020 2020 0a0a                ..
-0000f010: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f020: 2020 2020 696d 6167 655f 7365 745f 6974      image_set_it
-0000f030: 656d 735b 7375 6249 7465 6d44 6566 6175  ems[subItemDefau
-0000f040: 6c74 5b27 696d 6167 652d 6669 6c65 6e61  lt['image-filena
-0000f050: 6d65 275d 5d20 3d20 5b5d 2023 2063 6f75  me']] = [] # cou
-0000f060: 6c64 206d 616b 6520 616e 2065 7874 7261  ld make an extra
-0000f070: 2063 6173 6520 666f 7220 696d 6167 6573   case for images
-0000f080: 206f 6d69 7474 696e 6720 7468 6520 6c69   omitting the li
-0000f090: 7374 0a20 2020 2020 2020 2020 2020 2020  st.             
-0000f0a0: 2020 2020 2020 2066 6f72 2073 7562 4974         for subIt
-0000f0b0: 656d 2069 6e20 6974 656d 3a0a 2020 2020  em in item:.    
-0000f0c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f0d0: 2020 2020 7375 6249 7465 6d44 6963 7420      subItemDict 
-0000f0e0: 3d20 7b7d 0a20 2020 2020 2020 2020 2020  = {}.           
-0000f0f0: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0000f100: 2069 7420 696e 2073 7562 4974 656d 3a0a   it in subItem:.
-0000f110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f120: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-0000f130: 7420 213d 2027 696d 6167 652d 6669 6c65  t != 'image-file
-0000f140: 6e61 6d65 273a 0a20 2020 2020 2020 2020  name':.         
-0000f150: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f160: 2020 2020 2020 2073 7562 4974 656d 4469         subItemDi
-0000f170: 6374 5b69 745d 203d 2073 7562 4974 656d  ct[it] = subItem
-0000f180: 5b69 745d 0a20 2020 2020 2020 2020 2020  [it].           
-0000f190: 2020 2020 2020 2020 2020 2020 2069 6d61               ima
-0000f1a0: 6765 5f73 6574 5f69 7465 6d73 5b73 7562  ge_set_items[sub
-0000f1b0: 4974 656d 4465 6661 756c 745b 2769 6d61  ItemDefault['ima
-0000f1c0: 6765 2d66 696c 656e 616d 6527 5d5d 2e61  ge-filename']].a
-0000f1d0: 7070 656e 6428 7375 6249 7465 6d44 6963  ppend(subItemDic
-0000f1e0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0000f1f0: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-0000f200: 2020 2020 6578 6365 7074 206d 6971 7463      except miqtc
-0000f210: 2e49 6664 6f45 7863 6570 7469 6f6e 2061  .IfdoException a
-0000f220: 7320 653a 0a20 2020 2020 2020 2020 2020  s e:.           
-0000f230: 2020 2020 2020 2020 2069 6e76 616c 6964           invalid
-0000f240: 5f69 7465 6d73 202b 3d20 310a 2020 2020  _items += 1.    
-0000f250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f260: 7365 6c66 2e70 726f 762e 6c6f 6728 2249  self.prov.log("I
-0000f270: 6e76 616c 6964 2069 6d61 6765 2069 7465  nvalid image ite
-0000f280: 6d3a 2022 2b20 7374 7228 6974 656d 292c  m: "+ str(item),
-0000f290: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
-0000f2a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f2b0: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-0000f2c0: 2822 4578 6365 7074 696f 6e3a 5c6e 222b  ("Exception:\n"+
-0000f2d0: 2073 7472 2865 2e61 7267 7329 2c64 6f6e   str(e.args),don
-0000f2e0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-0000f2f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0000f300: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-0000f310: 4578 6365 7074 696f 6e28 2249 6e76 616c  Exception("Inval
-0000f320: 6964 2069 6d61 6765 2069 7465 6d20 222b  id image item "+
-0000f330: 2066 696c 655f 6e61 6d65 202b 2022 3a5c   file_name + ":\
-0000f340: 6e45 7863 6570 7469 6f6e 3a5c 6e22 2b20  nException:\n"+ 
-0000f350: 7374 7228 652e 6172 6773 2929 2023 206f  str(e.args)) # o
-0000f360: 7468 6572 7769 7365 2c20 696e 2063 6173  therwise, in cas
-0000f370: 6520 6f66 206d 616e 7920 696d 6167 6573  e of many images
-0000f380: 2c20 6974 206d 6179 206b 6565 7020 7275  , it may keep ru
-0000f390: 6e6e 696e 6720 616e 6420 7468 726f 7769  nning and throwi
-0000f3a0: 6e67 2065 7272 6f72 7320 666f 7220 7175  ng errors for qu
-0000f3b0: 6974 2073 6f6d 6520 7469 6d65 0a20 2020  it some time.   
-0000f3c0: 2020 2020 2020 2020 2070 726f 672e 636c           prog.cl
-0000f3d0: 6561 7228 290a 0a20 2020 2020 2020 2020  ear()..         
-0000f3e0: 2020 2069 6620 6c65 6e28 6974 656d 7329     if len(items)
-0000f3f0: 2021 3d20 3020 616e 6420 696e 7661 6c69   != 0 and invali
-0000f400: 645f 6974 656d 7320 3d3d 206c 656e 2869  d_items == len(i
-0000f410: 7465 6d73 293a 0a20 2020 2020 2020 2020  tems):.         
-0000f420: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
-0000f430: 6570 7469 6f6e 2822 416c 6c20 6974 656d  eption("All item
-0000f440: 7320 6172 6520 696e 7661 6c69 6422 290a  s are invalid").
-0000f450: 2020 2020 2020 2020 2020 2020 656c 6966              elif
-0000f460: 2069 6e76 616c 6964 5f69 7465 6d73 203e   invalid_items >
-0000f470: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
-0000f480: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
-0000f490: 6728 2241 7420 6c65 6173 7420 2220 2b20  g("At least " + 
-0000f4a0: 7374 7228 696e 7661 6c69 645f 6974 656d  str(invalid_item
-0000f4b0: 7329 202b 2022 2069 7465 6d73 2077 6572  s) + " items wer
-0000f4c0: 6520 696e 7661 6c69 6420 286f 6622 202b  e invalid (of" +
-0000f4d0: 2073 7472 286c 656e 2869 7465 6d73 2929   str(len(items))
-0000f4e0: 2b20 2229 2229 0a0a 2020 2020 2020 2020  + ")")..        
-0000f4f0: 2320 5661 6c69 6461 7465 2068 6561 6465  # Validate heade
-0000f500: 7220 696e 666f 726d 6174 696f 6e0a 2020  r information.  
-0000f510: 2020 2020 2020 7472 793a 0a20 2020 2020        try:.     
-0000f520: 2020 2020 2020 206d 6971 7474 2e61 7265         miqtt.are
-0000f530: 5f76 616c 6964 5f69 6664 6f5f 6669 656c  _valid_ifdo_fiel
-0000f540: 6473 2873 656c 662e 6966 646f 5f74 6d70  ds(self.ifdo_tmp
-0000f550: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000f560: 6164 6572 4b65 795d 290a 2020 2020 2020  aderKey]).      
-0000f570: 2020 6578 6365 7074 206d 6971 7463 2e49    except miqtc.I
-0000f580: 6664 6f45 7863 6570 7469 6f6e 2061 7320  fdoException as 
-0000f590: 6578 3a0a 2020 2020 2020 2020 2020 2020  ex:.            
-0000f5a0: 6d73 6720 3d20 2249 6e76 616c 6964 2068  msg = "Invalid h
-0000f5b0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
-0000f5c0: 2073 7472 2865 7829 0a20 2020 2020 2020   str(ex).       
-0000f5d0: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
-0000f5e0: 6f67 2822 4578 6365 7074 696f 6e3a 2022  og("Exception: "
-0000f5f0: 202b 206d 7367 2c20 646f 6e74 5368 6f77   + msg, dontShow
-0000f600: 3d54 7275 6529 0a20 2020 2020 2020 2020  =True).         
-0000f610: 2020 2072 6169 7365 206d 6971 7463 2e49     raise miqtc.I
-0000f620: 6664 6f45 7863 6570 7469 6f6e 286d 7367  fdoException(msg
-0000f630: 290a 0a20 2020 2020 2020 2023 2070 7574  )..        # put
-0000f640: 2069 7465 6d20 696e 666f 2069 6e74 6f20   item info into 
-0000f650: 7365 6c66 2e69 6664 6f5f 746d 700a 2020  self.ifdo_tmp.  
-0000f660: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
-0000f670: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
-0000f680: 2255 7064 6174 696e 6722 290a 2020 2020  "Updating").    
-0000f690: 2020 2020 6c6f 6720 3d20 6d69 7174 632e      log = miqtc.
-0000f6a0: 7265 6375 7273 6976 656c 7955 7064 6174  recursivelyUpdat
-0000f6b0: 6544 6963 7473 2873 656c 662e 6966 646f  eDicts(self.ifdo
-0000f6c0: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-0000f6d0: 6574 4974 656d 734b 6579 5d2c 2069 6d61  etItemsKey], ima
-0000f6e0: 6765 5f73 6574 5f69 7465 6d73 290a 2020  ge_set_items).  
-0000f6f0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-0000f700: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-0000f710: 2e6c 6f67 286c 6f67 290a 0a20 2020 2020  .log(log)..     
-0000f720: 2020 2023 2073 6574 206c 6174 206c 6f6e     # set lat lon
-0000f730: 2062 6f75 6e64 696e 6720 626f 780a 2020   bounding box.  
-0000f740: 2020 2020 2020 7365 6c66 2e5f 7365 745f        self._set_
-0000f750: 6c61 745f 6c6f 6e5f 626f 756e 6469 6e67  lat_lon_bounding
-0000f760: 5f62 6f78 2873 656c 662e 6966 646f 5f74  _box(self.ifdo_t
-0000f770: 6d70 290a 0a20 2020 2020 2020 2023 2073  mp)..        # s
-0000f780: 6574 2072 6570 7265 7365 6e74 6174 6976  et representativ
-0000f790: 6520 6865 6164 6572 2066 6965 6c64 7320  e header fields 
-0000f7a0: 6461 7465 7469 6d65 2c20 6c61 742c 206c  datetime, lat, l
-0000f7b0: 6f6e 2c20 616c 740a 2020 2020 2020 2020  on, alt.        
-0000f7c0: 7365 6c66 2e5f 7365 745f 7265 705f 6865  self._set_rep_he
-0000f7d0: 6164 6572 5f66 6965 6c64 735f 6474 5f6c  ader_fields_dt_l
-0000f7e0: 6174 5f6c 6f6e 5f61 6c74 2873 656c 662e  at_lon_alt(self.
-0000f7f0: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
-0000f800: 2020 2073 656c 662e 5f73 6574 5f69 6d61     self._set_ima
-0000f810: 6765 5f69 7465 6d5f 6964 656e 7469 6669  ge_item_identifi
-0000f820: 6361 7469 6f6e 5f73 6368 656d 6528 7365  cation_scheme(se
-0000f830: 6c66 2e69 6664 6f5f 746d 7029 0a0a 2020  lf.ifdo_tmp)..  
-0000f840: 2020 2020 2020 2320 7265 6d6f 7665 2065        # remove e
-0000f850: 6d74 7079 2066 6965 6c64 730a 2020 2020  mtpy fields.    
-0000f860: 2020 2020 7320 3d20 6d69 7174 632e 5072      s = miqtc.Pr
-0000f870: 696e 744c 6f61 6469 6e67 4d73 6728 2252  intLoadingMsg("R
-0000f880: 656d 6f76 696e 6720 656d 7074 7920 6669  emoving empty fi
-0000f890: 656c 6473 2229 0a20 2020 2020 2020 2073  elds").        s
-0000f8a0: 656c 662e 6966 646f 5f74 6d70 203d 206d  elf.ifdo_tmp = m
-0000f8b0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
-0000f8c0: 5265 6d6f 7665 456d 7074 7946 6965 6c64  RemoveEmptyField
-0000f8d0: 7328 7365 6c66 2e69 6664 6f5f 746d 7029  s(self.ifdo_tmp)
-0000f8e0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000f8f0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
-0000f900: 6d73 4b65 7920 696e 2073 656c 662e 6966  msKey in self.if
-0000f910: 646f 5f74 6d70 3a0a 2020 2020 2020 2020  do_tmp:.        
-0000f920: 2020 2020 7365 6c66 2e69 6664 6f5f 746d      self.ifdo_tm
-0000f930: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-0000f940: 7465 6d73 4b65 795d 203d 205b 5d0a 2020  temsKey] = [].  
-0000f950: 2020 2020 2020 2320 7265 6d6f 7665 2066        # remove f
-0000f960: 6965 6c64 7320 7468 6174 2063 6f6e 7461  ields that conta
-0000f970: 696e 2027 696d 6167 652d 6461 7465 7469  in 'image-dateti
-0000f980: 6d65 2720 6f6e 6c79 0a20 2020 2020 2020  me' only.       
-0000f990: 2073 656c 662e 7265 6d6f 7665 4974 656d   self.removeItem
-0000f9a0: 4669 656c 6473 5769 7468 4f6e 6c79 4461  FieldsWithOnlyDa
-0000f9b0: 7465 5469 6d65 2829 0a20 2020 2020 2020  teTime().       
-0000f9c0: 2073 2e73 746f 7028 290a 0a20 2020 2020   s.stop()..     
-0000f9d0: 2020 2069 6620 6e6f 7420 7365 6c66 2e69     if not self.i
-0000f9e0: 676e 6f72 655f 696d 6167 655f 6669 6c65  gnore_image_file
-0000f9f0: 733a 0a20 2020 2020 2020 2020 2020 2073  s:.            s
-0000fa00: 656c 662e 6368 6563 6b41 6c6c 4974 656d  elf.checkAllItem
-0000fa10: 4861 7368 6573 2829 0a0a 2020 2020 2020  Hashes()..      
-0000fa20: 2020 2320 6368 6563 6b20 6167 6169 6e73    # check agains
-0000fa30: 7420 7363 6865 6d61 0a20 2020 2020 2020  t schema.       
-0000fa40: 2076 616c 6964 2c20 6d73 6720 3d20 6d69   valid, msg = mi
-0000fa50: 7174 742e 7661 6c69 6461 7465 5f69 6664  qtt.validate_ifd
-0000fa60: 6f28 7365 6c66 2e69 6664 6f5f 746d 7029  o(self.ifdo_tmp)
-0000fa70: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-0000fa80: 7661 6c69 6420 616e 6420 6e6f 7420 616c  valid and not al
-0000fa90: 6c6f 775f 6d69 7373 696e 675f 7265 7175  low_missing_requ
-0000faa0: 6972 6564 3a0a 2020 2020 2020 2020 2020  ired:.          
-0000fab0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-0000fac0: 2257 6172 6e69 6e67 2120 6946 444f 206e  "Warning! iFDO n
-0000fad0: 6f20 7661 6c69 6420 7965 743a 2022 202b  o valid yet: " +
-0000fae0: 206d 7367 290a 2020 2020 2020 2020 2020   msg).          
-0000faf0: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-0000fb00: 646f 4578 6365 7074 696f 6e28 6d73 6729  doException(msg)
-0000fb10: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
-0000fb20: 6669 6e61 6c20 6f6e 650a 2020 2020 2020  final one.      
-0000fb30: 2020 7365 6c66 2e69 6664 6f5f 6368 6563    self.ifdo_chec
-0000fb40: 6b65 6420 3d20 636f 7079 2e64 6565 7063  ked = copy.deepc
-0000fb50: 6f70 7928 7365 6c66 2e69 6664 6f5f 746d  opy(self.ifdo_tm
-0000fb60: 7029 0a20 2020 2020 2020 2072 6574 7572  p).        retur
-0000fb70: 6e20 7365 6c66 2e69 6664 6f5f 6368 6563  n self.ifdo_chec
-0000fb80: 6b65 640a 0a0a 2020 2020 6465 6620 5f73  ked...    def _s
-0000fb90: 6574 5f69 6d61 6765 5f69 7465 6d5f 6964  et_image_item_id
-0000fba0: 656e 7469 6669 6361 7469 6f6e 5f73 6368  entification_sch
-0000fbb0: 656d 6528 7365 6c66 2c69 6664 6f3a 6469  eme(self,ifdo:di
-0000fbc0: 6374 293a 0a20 2020 2020 2020 2022 2222  ct):.        """
-0000fbd0: 2053 6574 2069 6d61 6765 2d69 7465 6d2d   Set image-item-
-0000fbe0: 6964 656e 7469 6669 6361 7469 6f6e 2d73  identification-s
-0000fbf0: 6368 656d 6520 746f 2060 696d 6167 652d  cheme to `image-
-0000fc00: 7072 6f6a 6563 745f 696d 6167 652d 6576  project_image-ev
-0000fc10: 656e 745f 696d 6167 652d 7365 6e73 6f72  ent_image-sensor
-0000fc20: 5f69 6d61 6765 2d64 6174 6574 696d 652e  _image-datetime.
-0000fc30: 6578 7460 2069 6620 656d 7074 792e 2022  ext` if empty. "
-0000fc40: 2222 0a20 2020 2020 2020 2069 6620 6669  "".        if fi
-0000fc50: 6e64 4669 656c 6428 6966 646f 5b73 656c  ndField(ifdo[sel
-0000fc60: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-0000fc70: 4b65 795d 2c27 696d 6167 652d 6974 656d  Key],'image-item
-0000fc80: 2d69 6465 6e74 6966 6963 6174 696f 6e2d  -identification-
-0000fc90: 7363 6865 6d65 2729 203d 3d20 2222 3a0a  scheme') == "":.
-0000fca0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
-0000fcb0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0000fcc0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
-0000fcd0: 6974 656d 2d69 6465 6e74 6966 6963 6174  item-identificat
-0000fce0: 696f 6e2d 7363 6865 6d65 275d 203d 2020  ion-scheme'] =  
-0000fcf0: 2769 6d61 6765 2d70 726f 6a65 6374 5f69  'image-project_i
-0000fd00: 6d61 6765 2d65 7665 6e74 5f69 6d61 6765  mage-event_image
-0000fd10: 2d73 656e 736f 725f 696d 6167 652d 6461  -sensor_image-da
-0000fd20: 7465 7469 6d65 2e65 7874 270a 0a0a 2020  tetime.ext'...  
-0000fd30: 2020 6465 6620 5f73 6574 5f72 6570 5f68    def _set_rep_h
-0000fd40: 6561 6465 725f 6669 656c 6473 5f64 745f  eader_fields_dt_
-0000fd50: 6c61 745f 6c6f 6e5f 616c 7428 7365 6c66  lat_lon_alt(self
-0000fd60: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
-0000fd70: 2020 2020 2022 2222 2046 696c 6c20 6865       """ Fill he
-0000fd80: 6164 6572 2066 6965 6c64 7320 696d 6167  ader fields imag
-0000fd90: 652d 6461 7465 7469 6d65 2061 6e64 202d  e-datetime and -
-0000fda0: 6c61 7469 7475 6465 2c20 2d6c 6f6e 6769  latitude, -longi
-0000fdb0: 7475 6564 652c 202d 616c 7469 7475 6465  tuede, -altitude
-0000fdc0: 2d6d 6574 6572 732c 202d 636f 6f72 6469  -meters, -coordi
-0000fdd0: 6e61 7465 2d75 6e63 6572 7461 696e 7479  nate-uncertainty
-0000fde0: 2d6d 6574 6572 732c 2069 6620 656d 7074  -meters, if empt
-0000fdf0: 792c 0a20 2020 2020 2020 2072 6570 7265  y,.        repre
-0000fe00: 7365 6e74 6174 6976 656c 7920 7769 7468  sentatively with
-0000fe10: 2066 6972 7374 2069 7465 6d73 2065 6e74   first items ent
-0000fe20: 7279 2061 6e64 206d 6564 6961 6e20 6f66  ry and median of
-0000fe30: 2061 6c6c 2069 7465 6d73 2076 616c 7565   all items value
-0000fe40: 732c 2072 6573 7065 6374 6976 656c 792e  s, respectively.
-0000fe50: 2022 2222 0a0a 2020 2020 2020 2020 2320   """..        # 
-0000fe60: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
-0000fe70: 0a20 2020 2020 2020 2066 6972 7374 5f69  .        first_i
-0000fe80: 6d61 6765 203d 2073 6f72 7465 6428 6966  mage = sorted(if
-0000fe90: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-0000fea0: 4974 656d 734b 6579 5d2e 6b65 7973 2829  ItemsKey].keys()
-0000feb0: 295b 305d 0a20 2020 2020 2020 2066 6965  )[0].        fie
-0000fec0: 6c64 203d 2027 696d 6167 652d 6461 7465  ld = 'image-date
-0000fed0: 7469 6d65 270a 2020 2020 2020 2020 6966  time'.        if
-0000fee0: 2066 696e 6446 6965 6c64 2869 6664 6f5b   findField(ifdo[
-0000fef0: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0000ff00: 6465 724b 6579 5d2c 6669 656c 6429 203d  derKey],field) =
-0000ff10: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-0000ff20: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-0000ff30: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
-0000ff40: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
-0000ff50: 6579 5d5b 6669 656c 645d 203d 2073 656c  ey][field] = sel
-0000ff60: 662e 5f5f 6765 7446 6965 6c64 5661 6c75  f.__getFieldValu
-0000ff70: 6528 6966 646f 2c5b 6669 7273 745f 696d  e(ifdo,[first_im
-0000ff80: 6167 652c 6669 656c 645d 2c64 6566 6175  age,field],defau
-0000ff90: 6c74 5f6f 6e6c 793d 5472 7565 290a 2020  lt_only=True).  
-0000ffa0: 2020 2020 2020 2020 2020 2020 2020 7365                se
-0000ffb0: 6c66 2e70 726f 762e 6c6f 6728 2253 6574  lf.prov.log("Set
-0000ffc0: 2072 6570 7265 7365 6e74 6174 6976 6520   representative 
-0000ffd0: 6865 6164 6572 2066 6965 6c64 2027 2220  header field '" 
-0000ffe0: 2b20 6669 656c 6420 2b20 2227 2074 6f20  + field + "' to 
-0000fff0: 2220 2b20 7374 7228 6966 646f 5b73 656c  " + str(ifdo[sel
-00010000: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
-00010010: 4b65 795d 5b66 6965 6c64 5d29 202b 2022  Key][field]) + "
-00010020: 2066 726f 6d20 6669 7273 7420 696d 6167   from first imag
-00010030: 652e 2229 0a20 2020 2020 2020 2020 2020  e.").           
-00010040: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
-00010050: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
-00010060: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
-00010070: 2020 2073 656c 662e 7072 6f76 2e6c 6f67     self.prov.log
-00010080: 2822 436f 756c 6420 6e6f 7420 7365 7420  ("Could not set 
-00010090: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
-000100a0: 6561 6465 7220 6669 656c 643a 2022 202b  eader field: " +
-000100b0: 2073 7472 2865 7829 290a 2020 2020 2020   str(ex)).      
-000100c0: 2020 2020 2020 2020 2020 7061 7373 0a0a            pass..
-000100d0: 2020 2020 2020 2020 2320 7265 7374 0a20          # rest. 
-000100e0: 2020 2020 2020 2072 6570 5f68 6561 6465         rep_heade
-000100f0: 725f 6669 656c 6473 5f6d 6564 6961 6e20  r_fields_median 
-00010100: 3d20 5b27 696d 6167 652d 6c61 7469 7475  = ['image-latitu
-00010110: 6465 272c 2769 6d61 6765 2d6c 6f6e 6769  de','image-longi
-00010120: 7475 6465 272c 2769 6d61 6765 2d61 6c74  tude','image-alt
-00010130: 6974 7564 652d 6d65 7465 7273 272c 2769  itude-meters','i
-00010140: 6d61 6765 2d63 6f6f 7264 696e 6174 652d  mage-coordinate-
-00010150: 756e 6365 7274 6169 6e74 792d 6d65 7465  uncertainty-mete
-00010160: 7273 275d 0a20 2020 2020 2020 2066 6f72  rs'].        for
-00010170: 2066 6965 6c64 2069 6e20 7265 705f 6865   field in rep_he
-00010180: 6164 6572 5f66 6965 6c64 735f 6d65 6469  ader_fields_medi
-00010190: 616e 3a0a 2020 2020 2020 2020 2020 2020  an:.            
-000101a0: 6966 2066 696e 6446 6965 6c64 2869 6664  if findField(ifd
-000101b0: 6f5b 7365 6c66 2e69 6d61 6765 5365 7448  o[self.imageSetH
-000101c0: 6561 6465 724b 6579 5d2c 6669 656c 6429  eaderKey],field)
-000101d0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
-000101e0: 2020 2020 2020 2020 7661 6c75 6573 203d          values =
-000101f0: 205b 5d0a 2020 2020 2020 2020 2020 2020   [].            
-00010200: 2020 2020 666f 7220 696d 6167 655f 6e61      for image_na
-00010210: 6d65 2069 6e20 6966 646f 5b73 656c 662e  me in ifdo[self.
-00010220: 696d 6167 6553 6574 4974 656d 734b 6579  imageSetItemsKey
-00010230: 5d2e 6b65 7973 2829 3a0a 2020 2020 2020  ].keys():.      
-00010240: 2020 2020 2020 2020 2020 2020 2020 7472                tr
-00010250: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
-00010260: 2020 2020 2020 2020 2020 2069 7465 6d5f             item_
-00010270: 7661 6c20 3d20 7365 6c66 2e5f 5f67 6574  val = self.__get
-00010280: 4669 656c 6456 616c 7565 2869 6664 6f2c  FieldValue(ifdo,
-00010290: 5b69 6d61 6765 5f6e 616d 652c 6669 656c  [image_name,fiel
-000102a0: 645d 290a 2020 2020 2020 2020 2020 2020  d]).            
-000102b0: 2020 2020 2020 2020 2020 2020 6966 2069              if i
-000102c0: 7369 6e73 7461 6e63 6528 6974 656d 5f76  sinstance(item_v
-000102d0: 616c 2c64 6963 7429 3a0a 2020 2020 2020  al,dict):.      
-000102e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000102f0: 2020 2020 2020 7661 6c75 6573 202b 3d20        values += 
-00010300: 6c69 7374 2869 7465 6d5f 7661 6c2e 7661  list(item_val.va
-00010310: 6c75 6573 2829 290a 2020 2020 2020 2020  lues()).        
-00010320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010330: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00010340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010350: 2020 7661 6c75 6573 2e61 7070 656e 6428    values.append(
-00010360: 6974 656d 5f76 616c 290a 2020 2020 2020  item_val).      
-00010370: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00010380: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
-00010390: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
-000103a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000103b0: 2020 2020 2020 2020 7061 7373 0a20 2020          pass.   
-000103c0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000103d0: 6c65 6e28 7661 6c75 6573 2920 3d3d 2030  len(values) == 0
-000103e0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000103f0: 2020 2020 2020 7365 6c66 2e70 726f 762e        self.prov.
-00010400: 6c6f 6728 2243 6f75 6c64 206e 6f74 2073  log("Could not s
-00010410: 6574 2072 6570 7265 7365 6e74 6174 6976  et representativ
-00010420: 6520 6865 6164 6572 2066 6965 6c64 2c20  e header field, 
-00010430: 6e6f 2076 616c 7565 7320 666f 756e 643a  no values found:
-00010440: 2022 202b 2066 6965 6c64 290a 2020 2020   " + field).    
-00010450: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00010460: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010470: 2020 2020 2020 6966 646f 5b73 656c 662e        ifdo[self.
-00010480: 696d 6167 6553 6574 4865 6164 6572 4b65  imageSetHeaderKe
-00010490: 795d 5b66 6965 6c64 5d20 3d20 7374 6174  y][field] = stat
-000104a0: 6973 7469 6373 2e6d 6564 6961 6e28 7661  istics.median(va
-000104b0: 6c75 6573 290a 2020 2020 2020 2020 2020  lues).          
-000104c0: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
-000104d0: 726f 762e 6c6f 6728 2253 6574 2072 6570  rov.log("Set rep
-000104e0: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
-000104f0: 6572 2066 6965 6c64 2027 2220 2b20 6669  er field '" + fi
-00010500: 656c 6420 2b20 2227 2074 6f20 6d65 6469  eld + "' to medi
-00010510: 616e 3a20 2220 2b20 7374 7228 6966 646f  an: " + str(ifdo
-00010520: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-00010530: 6164 6572 4b65 795d 5b66 6965 6c64 5d29  aderKey][field])
-00010540: 202b 2022 2e22 290a 0a0a 2020 2020 6465   + ".")...    de
-00010550: 6620 5f73 6574 5f6c 6174 5f6c 6f6e 5f62  f _set_lat_lon_b
-00010560: 6f75 6e64 696e 675f 626f 7828 7365 6c66  ounding_box(self
-00010570: 2c69 6664 6f3a 6469 6374 293a 0a20 2020  ,ifdo:dict):.   
-00010580: 2020 2020 2022 2222 2053 6574 2069 6d61       """ Set ima
-00010590: 6765 2d73 6574 2d5b 6d69 6e2c 6d61 785d  ge-set-[min,max]
-000105a0: 2d5b 6c61 7469 7475 6465 2c6c 6f6e 6769  -[latitude,longi
-000105b0: 7475 6465 5d2d 6465 6772 6565 7320 2222  tude]-degrees ""
-000105c0: 220a 2020 2020 2020 2020 6c61 745f 6d69  ".        lat_mi
-000105d0: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
-000105e0: 6d69 6e2c 206c 6f6e 5f6d 6178 203d 2073  min, lon_max = s
-000105f0: 656c 662e 5f67 6574 5f6c 6174 5f6c 6f6e  elf._get_lat_lon
-00010600: 5f62 6f75 6e64 696e 675f 626f 7828 6966  _bounding_box(if
-00010610: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010620: 4974 656d 734b 6579 5d29 0a20 2020 2020  ItemsKey]).     
-00010630: 2020 2069 6620 6e6f 7420 4e6f 6e65 2069     if not None i
-00010640: 6e20 5b6c 6174 5f6d 696e 2c20 6c61 745f  n [lat_min, lat_
-00010650: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
-00010660: 6e5f 6d61 785d 3a0a 2020 2020 2020 2020  n_max]:.        
-00010670: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00010680: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00010690: 5b27 696d 6167 652d 7365 742d 6d69 6e2d  ['image-set-min-
-000106a0: 6c61 7469 7475 6465 2d64 6567 7265 6573  latitude-degrees
-000106b0: 275d 203d 206c 6174 5f6d 696e 0a20 2020  '] = lat_min.   
-000106c0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
-000106d0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
-000106e0: 724b 6579 5d5b 2769 6d61 6765 2d73 6574  rKey]['image-set
-000106f0: 2d6d 6178 2d6c 6174 6974 7564 652d 6465  -max-latitude-de
-00010700: 6772 6565 7327 5d20 3d20 6c61 745f 6d61  grees'] = lat_ma
-00010710: 780a 2020 2020 2020 2020 2020 2020 6966  x.            if
-00010720: 646f 5b73 656c 662e 696d 6167 6553 6574  do[self.imageSet
-00010730: 4865 6164 6572 4b65 795d 5b27 696d 6167  HeaderKey]['imag
-00010740: 652d 7365 742d 6d69 6e2d 6c6f 6e67 6974  e-set-min-longit
-00010750: 7564 652d 6465 6772 6565 7327 5d20 3d20  ude-degrees'] = 
-00010760: 6c6f 6e5f 6d69 6e0a 2020 2020 2020 2020  lon_min.        
-00010770: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
-00010780: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
-00010790: 5b27 696d 6167 652d 7365 742d 6d61 782d  ['image-set-max-
-000107a0: 6c6f 6e67 6974 7564 652d 6465 6772 6565  longitude-degree
-000107b0: 7327 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a  s'] = lon_max...
-000107c0: 2020 2020 4073 7461 7469 636d 6574 686f      @staticmetho
-000107d0: 640a 2020 2020 6465 6620 5f67 6574 5f6c  d.    def _get_l
-000107e0: 6174 5f6c 6f6e 5f62 6f75 6e64 696e 675f  at_lon_bounding_
-000107f0: 626f 7828 6974 656d 733a 6469 6374 293a  box(items:dict):
-00010800: 0a20 2020 2020 2020 2022 2222 2052 6574  .        """ Ret
-00010810: 7572 6e73 206c 6174 5f6d 696e 2c20 6c61  urns lat_min, la
-00010820: 745f 6d61 782c 206c 6f6e 5f6d 696e 2c20  t_max, lon_min, 
-00010830: 6c6f 6e5f 6d61 7820 2222 220a 2020 2020  lon_max """.    
-00010840: 2020 2020 6c61 745f 6d69 6e2c 206c 6174      lat_min, lat
-00010850: 5f6d 6178 2c20 6c6f 6e5f 6d69 6e2c 206c  _max, lon_min, l
-00010860: 6f6e 5f6d 6178 203d 204e 6f6e 652c 204e  on_max = None, N
-00010870: 6f6e 652c 204e 6f6e 652c 204e 6f6e 650a  one, None, None.
-00010880: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
-00010890: 2020 2020 2020 666f 7220 696d 6167 652c        for image,
-000108a0: 2064 6174 6120 696e 2069 7465 6d73 2e69   data in items.i
-000108b0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
-000108c0: 2020 2020 2320 6d61 6b65 2069 6d61 6765      # make image
-000108d0: 2065 6e74 7279 206c 6973 7420 2861 6c73   entry list (als
-000108e0: 6f20 6966 2069 7473 2061 2070 6963 7475  o if its a pictu
-000108f0: 7265 290a 2020 2020 2020 2020 2020 2020  re).            
-00010900: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
-00010910: 6528 6461 7461 2c20 6c69 7374 293a 0a20  e(data, list):. 
-00010920: 2020 2020 2020 2020 2020 2020 2020 2064                 d
-00010930: 6174 6120 3d20 5b64 6174 615d 0a20 2020  ata = [data].   
-00010940: 2020 2020 2020 2020 200a 2020 2020 2020           .      
-00010950: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00010960: 696e 745f 6461 7461 2069 6e20 6461 7461  int_data in data
-00010970: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010980: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
-00010990: 2020 2020 2020 2020 2020 206c 6174 203d             lat =
-000109a0: 2074 696d 6570 6f69 6e74 5f64 6174 615b   timepoint_data[
-000109b0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
-000109c0: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
-000109d0: 2020 2020 2020 6c6f 6e20 3d20 7469 6d65        lon = time
-000109e0: 706f 696e 745f 6461 7461 5b27 696d 6167  point_data['imag
-000109f0: 652d 6c6f 6e67 6974 7564 6527 5d0a 2020  e-longitude'].  
-00010a00: 2020 2020 2020 2020 2020 2020 2020 6578                ex
-00010a10: 6365 7074 204b 6579 4572 726f 7220 6173  cept KeyError as
-00010a20: 2065 783a 0a20 2020 2020 2020 2020 2020   ex:.           
-00010a30: 2020 2020 2020 2020 2063 6f6e 7469 6e75           continu
-00010a40: 650a 0a20 2020 2020 2020 2020 2020 2020  e..             
-00010a50: 2020 2069 6620 6920 3d3d 2030 3a0a 2020     if i == 0:.  
-00010a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010a70: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
-00010a80: 6178 203d 206c 6174 2c20 6c61 740a 2020  ax = lat, lat.  
-00010a90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010aa0: 2020 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d    lon_min, lon_m
-00010ab0: 6178 203d 206c 6f6e 2c20 6c6f 6e0a 2020  ax = lon, lon.  
-00010ac0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-00010ad0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00010ae0: 2020 2020 2020 2020 6966 206c 6174 203c          if lat <
-00010af0: 206c 6174 5f6d 696e 3a0a 2020 2020 2020   lat_min:.      
-00010b00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b10: 2020 6c61 745f 6d69 6e20 3d20 6c61 740a    lat_min = lat.
-00010b20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b30: 2020 2020 6966 206c 6174 203e 206c 6174      if lat > lat
-00010b40: 5f6d 6178 3a0a 2020 2020 2020 2020 2020  _max:.          
-00010b50: 2020 2020 2020 2020 2020 2020 2020 6c61                la
-00010b60: 745f 6d61 7820 3d20 6c61 740a 2020 2020  t_max = lat.    
-00010b70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010b80: 6966 206c 6f6e 203c 206c 6f6e 5f6d 696e  if lon < lon_min
-00010b90: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00010ba0: 2020 2020 2020 2020 2020 6c6f 6e5f 6d69            lon_mi
-00010bb0: 6e20 3d20 6c6f 6e0a 2020 2020 2020 2020  n = lon.        
-00010bc0: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00010bd0: 6f6e 203e 206c 6f6e 5f6d 6178 3a0a 2020  on > lon_max:.  
-00010be0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010bf0: 2020 2020 2020 6c6f 6e5f 6d61 7820 3d20        lon_max = 
-00010c00: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
-00010c10: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
-00010c20: 2020 2072 6574 7572 6e20 6c61 745f 6d69     return lat_mi
-00010c30: 6e2c 206c 6174 5f6d 6178 2c20 6c6f 6e5f  n, lat_max, lon_
-00010c40: 6d69 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20  min, lon_max... 
-00010c50: 2020 2064 6566 2072 656d 6f76 6549 7465     def removeIte
-00010c60: 6d46 6965 6c64 7357 6974 684f 6e6c 7944  mFieldsWithOnlyD
-00010c70: 6174 6554 696d 6528 7365 6c66 293a 0a20  ateTime(self):. 
-00010c80: 2020 2020 2020 2022 2222 2069 7420 6361         """ it ca
-00010c90: 6e20 6861 7070 656e 2074 6861 7420 616e  n happen that an
-00010ca0: 2069 6d61 6765 2074 696d 6573 7461 6d70   image timestamp
-00010cb0: 2064 6f65 7320 6e6f 7420 636f 6e74 6169   does not contai
-00010cc0: 6e20 616e 7920 6669 656c 6473 2062 7574  n any fields but
-00010cd0: 2074 6865 2074 696d 6573 7461 6d70 2061   the timestamp a
-00010ce0: 6e79 206d 6f72 652e 2054 686f 7365 2061  ny more. Those a
-00010cf0: 7265 2072 656d 6f76 6564 2068 6572 652e  re removed here.
-00010d00: 2022 2222 200a 2020 2020 2020 2020 666f   """ .        fo
-00010d10: 7220 6974 656d 2069 6e20 7365 6c66 2e69  r item in self.i
-00010d20: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00010d30: 6765 5365 7449 7465 6d73 4b65 795d 3a0a  geSetItemsKey]:.
-00010d40: 2020 2020 2020 2020 2020 2020 6966 206e              if n
-00010d50: 6f74 2069 7369 6e73 7461 6e63 6528 7365  ot isinstance(se
-00010d60: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00010d70: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00010d80: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a0a  y][item],list):.
-00010d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010da0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00010db0: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00010dc0: 4b65 795d 5b69 7465 6d5d 203d 205b 7365  Key][item] = [se
-00010dd0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-00010de0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-00010df0: 795d 5b69 7465 6d5d 5d0a 2020 2020 2020  y][item]].      
-00010e00: 2020 2020 2020 746f 4265 5265 6d6f 7665        toBeRemove
-00010e10: 6420 3d20 5b5d 0a20 2020 2020 2020 2020  d = [].         
-00010e20: 2020 2066 6f72 2065 6e74 7279 2069 6e20     for entry in 
-00010e30: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00010e40: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00010e50: 4b65 795d 5b69 7465 6d5d 3a0a 2020 2020  Key][item]:.    
-00010e60: 2020 2020 2020 2020 2020 2020 2370 7269              #pri
-00010e70: 6e74 2865 6e74 7279 290a 2020 2020 2020  nt(entry).      
-00010e80: 2020 2020 2020 2020 2020 6966 206c 656e            if len
-00010e90: 2865 6e74 7279 2920 3d3d 2031 2061 6e64  (entry) == 1 and
-00010ea0: 2027 696d 6167 652d 6461 7465 7469 6d65   'image-datetime
-00010eb0: 2720 696e 2065 6e74 7279 3a0a 2020 2020  ' in entry:.    
-00010ec0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010ed0: 746f 4265 5265 6d6f 7665 642e 6170 7065  toBeRemoved.appe
-00010ee0: 6e64 2865 6e74 7279 290a 2020 2020 2020  nd(entry).      
-00010ef0: 2020 2020 2020 666f 7220 656e 7472 7920        for entry 
-00010f00: 696e 2074 6f42 6552 656d 6f76 6564 3a0a  in toBeRemoved:.
-00010f10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00010f20: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
-00010f30: 6c66 2e69 6d61 6765 5365 7449 7465 6d73  lf.imageSetItems
-00010f40: 4b65 795d 5b69 7465 6d5d 2e72 656d 6f76  Key][item].remov
-00010f50: 6528 656e 7472 7929 200a 0a0a 2020 2020  e(entry) ...    
-00010f60: 6465 6620 6368 6563 6b41 6c6c 4974 656d  def checkAllItem
-00010f70: 4861 7368 6573 2873 656c 662c 2068 6172  Hashes(self, har
-00010f80: 643d 4661 6c73 652c 2072 6169 7365 4578  d=False, raiseEx
-00010f90: 6365 7074 696f 6e20 3d20 5472 7565 293a  ception = True):
-00010fa0: 0a20 2020 2020 2020 2022 2222 200a 2020  .        """ .  
-00010fb0: 2020 2020 2020 4368 6563 6b73 2069 6620        Checks if 
-00010fc0: 6861 7368 6573 2069 6e20 6946 444f 206d  hashes in iFDO m
-00010fd0: 6174 6368 2068 6173 6865 7320 696e 2069  atch hashes in i
-00010fe0: 6e74 6572 6d65 6964 6174 6520 6861 7368  ntermeidate hash
-00010ff0: 2066 696c 6520 6966 2074 6865 206c 6174   file if the lat
-00011000: 7465 7220 7761 7320 6368 616e 6765 6420  ter was changed 
-00011010: 6c61 7374 2061 6674 6572 2074 6865 2069  last after the i
-00011020: 6d61 6765 7320 6861 7320 6368 616e 6765  mages has change
-00011030: 642e 0a20 2020 2020 2020 204f 7468 6572  d..        Other
-00011040: 7769 7365 206f 7220 6966 2068 6172 643d  wise or if hard=
-00011050: 3d54 7275 6520 6974 2072 6564 6574 6572  =True it redeter
-00011060: 6d69 6e65 7320 7468 6520 6163 7475 616c  mines the actual
-00011070: 6c20 6669 6c65 2773 2068 6173 6820 616e  l file's hash an
-00011080: 6420 636f 6d70 6172 6573 2074 6865 2069  d compares the i
-00011090: 4644 4f20 6974 656d 2773 2068 6173 6820  FDO item's hash 
-000110a0: 7769 7468 2074 6861 742e 0a20 2020 2020  with that..     
-000110b0: 2020 2049 6620 6861 7368 6573 2064 6f20     If hashes do 
-000110c0: 6e6f 7420 6d61 7463 6820 6120 6d61 7269  not match a mari
-000110d0: 7174 2e63 6f72 652e 4966 646f 4578 6365  qt.core.IfdoExce
-000110e0: 7074 696f 6e20 6973 2072 6973 656e 2075  ption is risen u
-000110f0: 6e73 6c65 7373 2072 6169 7365 4578 6365  nsless raiseExce
-00011100: 7074 696f 6e20 3d3d 2046 616c 7365 2c20  ption == False, 
-00011110: 7468 656e 2061 206c 6973 7420 6f66 206c  then a list of l
-00011120: 6973 7473 205b 3c66 696c 653e 2c3c 6578  ists [<file>,<ex
-00011130: 6365 7074 696f 6e3e 5d20 6973 2072 6574  ception>] is ret
-00011140: 7572 6e65 642e 0a20 2020 2020 2020 2022  urned..        "
-00011150: 2222 0a20 2020 2020 2020 2068 6173 6865  "".        hashe
-00011160: 7320 3d20 7b7d 0a20 2020 2020 2020 2068  s = {}.        h
-00011170: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
-00011180: 2031 3065 2b31 3030 0a20 2020 2020 2020   10e+100.       
-00011190: 2069 6620 6f73 2e70 6174 682e 6578 6973   if os.path.exis
-000111a0: 7473 2873 656c 662e 6765 745f 696e 745f  ts(self.get_int_
-000111b0: 6861 7368 5f66 696c 6528 2929 3a0a 2020  hash_file()):.  
-000111c0: 2020 2020 2020 2020 2020 6861 7368 6573            hashes
-000111d0: 203d 206d 6971 7466 2e74 6162 4669 6c65   = miqtf.tabFile
-000111e0: 4461 7461 2873 656c 662e 6765 745f 696e  Data(self.get_in
-000111f0: 745f 6861 7368 5f66 696c 6528 292c 205b  t_hash_file(), [
-00011200: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011210: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00011220: 5d2c 206d 6971 7476 2e63 6f6c 5f68 6561  ], miqtv.col_hea
-00011230: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
-00011240: 6173 6827 5d5d 2c20 6b65 795f 636f 6c3d  ash']], key_col=
-00011250: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00011260: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00011270: 5d29 0a20 2020 2020 2020 2020 2020 2068  ]).            h
-00011280: 6173 6846 696c 654d 6f64 5469 6d65 203d  ashFileModTime =
-00011290: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
-000112a0: 6528 7365 6c66 2e67 6574 5f69 6e74 5f68  e(self.get_int_h
-000112b0: 6173 685f 6669 6c65 2829 290a 0a20 2020  ash_file())..   
-000112c0: 2020 2020 2065 7863 6570 7469 6f6e 4c69       exceptionLi
-000112d0: 7374 203d 205b 5d0a 0a20 2020 2020 2020  st = []..       
-000112e0: 2068 6173 6855 6e63 6865 636b 496d 6167   hashUncheckImag
-000112f0: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
-00011300: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
-00011310: 2829 0a20 2020 2020 2020 2070 726f 6720  ().        prog 
-00011320: 3d20 6d69 7174 632e 5072 696e 744b 6e6f  = miqtc.PrintKno
-00011330: 776e 5072 6f67 7265 7373 4d73 6728 2243  wnProgressMsg("C
-00011340: 6865 636b 696e 6720 6974 656d 2068 6173  hecking item has
-00011350: 6865 7322 2c20 6c65 6e28 7365 6c66 2e69  hes", len(self.i
-00011360: 6664 6f5f 746d 705b 7365 6c66 2e69 6d61  fdo_tmp[self.ima
-00011370: 6765 5365 7449 7465 6d73 4b65 795d 2929  geSetItemsKey]))
-00011380: 0a20 2020 2020 2020 2066 6f72 2069 7465  .        for ite
-00011390: 6d20 696e 2073 656c 662e 6966 646f 5f74  m in self.ifdo_t
-000113a0: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
-000113b0: 4974 656d 734b 6579 5d3a 0a20 2020 2020  ItemsKey]:.     
-000113c0: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
-000113d0: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
-000113e0: 2020 2020 666f 756e 6420 3d20 4661 6c73      found = Fals
-000113f0: 650a 2020 2020 2020 2020 2020 2020 666f  e.            fo
-00011400: 7220 696d 6167 6520 696e 2068 6173 6855  r image in hashU
-00011410: 6e63 6865 636b 496d 6167 6573 496e 5261  ncheckImagesInRa
-00011420: 773a 0a20 2020 2020 2020 2020 2020 2020  w:.             
-00011430: 2020 2066 696c 654e 616d 6520 3d20 6f73     fileName = os
-00011440: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
-00011450: 6d61 6765 290a 2020 2020 2020 2020 2020  mage).          
-00011460: 2020 2020 2020 6966 2066 696c 654e 616d        if fileNam
-00011470: 6520 3d3d 2069 7465 6d3a 0a20 2020 2020  e == item:.     
-00011480: 2020 2020 2020 2020 2020 2020 2020 2066                 f
-00011490: 6f75 6e64 203d 2054 7275 650a 2020 2020  ound = True.    
-000114a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000114b0: 6966 2069 7369 6e73 7461 6e63 6528 7365  if isinstance(se
-000114c0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
-000114d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
-000114e0: 795d 5b69 7465 6d5d 2c6c 6973 7429 3a20  y][item],list): 
-000114f0: 2320 696e 2063 6173 6520 6f66 2076 6964  # in case of vid
-00011500: 656f 2077 6974 6820 6974 656d 2061 7320  eo with item as 
-00011510: 6c69 7374 2074 6865 2066 6972 7374 2065  list the first e
-00011520: 6e74 7279 2068 6f6c 6473 2074 6865 2064  ntry holds the d
-00011530: 6566 6175 6c74 2061 6e64 2074 6865 2068  efault and the h
-00011540: 6173 6820 6361 6e6e 6f74 2076 6172 7920  ash cannot vary 
-00011550: 666f 7220 7468 6520 7361 6d65 2069 6d61  for the same ima
-00011560: 6765 0a20 2020 2020 2020 2020 2020 2020  ge.             
-00011570: 2020 2020 2020 2020 2020 2069 7465 6d45             itemE
-00011580: 6e74 7279 203d 2073 656c 662e 6966 646f  ntry = self.ifdo
-00011590: 5f74 6d70 5b73 656c 662e 696d 6167 6553  _tmp[self.imageS
-000115a0: 6574 4974 656d 734b 6579 5d5b 6974 656d  etItemsKey][item
-000115b0: 5d5b 305d 200a 2020 2020 2020 2020 2020  ][0] .          
-000115c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000115d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000115e0: 2020 2020 2020 2020 6974 656d 456e 7472          itemEntr
-000115f0: 7920 3d20 7365 6c66 2e69 6664 6f5f 746d  y = self.ifdo_tm
-00011600: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
-00011610: 7465 6d73 4b65 795d 5b69 7465 6d5d 0a0a  temsKey][item]..
-00011620: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011630: 2020 2020 696d 6167 654d 6f64 5469 6d65      imageModTime
-00011640: 203d 206f 732e 7061 7468 2e67 6574 6d74   = os.path.getmt
-00011650: 696d 6528 696d 6167 6529 0a20 2020 2020  ime(image).     
-00011660: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00011670: 6620 6e6f 7420 6861 7264 2061 6e64 2069  f not hard and i
-00011680: 6d61 6765 4d6f 6454 696d 6520 3c20 6861  mageModTime < ha
-00011690: 7368 4669 6c65 4d6f 6454 696d 653a 0a20  shFileModTime:. 
-000116a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000116b0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
-000116c0: 2e70 6174 682e 6261 7365 6e61 6d65 2869  .path.basename(i
-000116d0: 6d61 6765 2920 696e 2068 6173 6865 733a  mage) in hashes:
-000116e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000116f0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011700: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
-00011710: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011720: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011730: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
-00011740: 4578 6365 7074 696f 6e28 6974 656d 2c20  Exception(item, 
-00011750: 226e 6f74 2066 6f75 6e64 2069 6e20 696e  "not found in in
-00011760: 7465 726d 6569 6461 7465 2068 6173 6820  termeidate hash 
-00011770: 6669 6c65 222c 7365 6c66 2e67 6574 5f69  file",self.get_i
-00011780: 6e74 5f68 6173 685f 6669 6c65 2829 2c22  nt_hash_file(),"
-00011790: 2072 756e 2063 7265 6174 655f 696d 6167   run create_imag
-000117a0: 655f 7368 6132 3536 5f66 696c 6528 2920  e_sha256_file() 
-000117b0: 6669 7273 7422 2920 0a20 2020 2020 2020  first") .       
+0000ef10: 2020 2020 2020 2072 6169 7365 2045 7863         raise Exc
+0000ef20: 6570 7469 6f6e 2822 4974 656d 2027 2220  eption("Item '" 
+0000ef30: 2b20 6669 6c65 5f6e 616d 6520 2b20 2227  + file_name + "'
+0000ef40: 206e 6f74 2066 6f75 6e64 2069 6e20 2f72   not found in /r
+0000ef50: 6177 2064 6972 6563 746f 7279 2e22 290a  aw directory.").
+0000ef60: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000ef70: 2020 2020 2020 2020 2069 6620 7661 6c69           if vali
+0000ef80: 6461 7465 5f73 696e 676c 655f 6974 656d  date_single_item
+0000ef90: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+0000efa0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+0000efb0: 6971 7474 2e61 7265 5f76 616c 6964 5f69  iqtt.are_valid_i
+0000efc0: 6664 6f5f 6669 656c 6473 2873 7562 4974  fdo_fields(subIt
+0000efd0: 656d 290a 2020 2020 2020 2020 2020 2020  em).            
+0000efe0: 2020 2020 2020 2020 2020 2020 656c 7365              else
+0000eff0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f000: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0000f010: 7220 6669 656c 645f 6e61 6d65 2c66 6965  r field_name,fie
+0000f020: 6c64 5f76 616c 2069 6e20 7375 6249 7465  ld_val in subIte
+0000f030: 6d2e 6974 656d 7328 293a 0a20 2020 2020  m.items():.     
+0000f040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f050: 2020 2020 2020 2020 2020 206d 6971 7474             miqtt
+0000f060: 2e69 6664 6f5f 6669 656c 645f 6164 6469  .ifdo_field_addi
+0000f070: 7469 6f6e 616c 5f63 6865 636b 7328 6669  tional_checks(fi
+0000f080: 656c 645f 6e61 6d65 2c66 6965 6c64 5f76  eld_name,field_v
+0000f090: 616c 2920 2020 2020 2020 2020 2020 2020  al)             
+0000f0a0: 2020 2020 2020 2020 2020 200a 0a20 2020             ..   
+0000f0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f0c0: 2069 6d61 6765 5f73 6574 5f69 7465 6d73   image_set_items
+0000f0d0: 5b73 7562 4974 656d 4465 6661 756c 745b  [subItemDefault[
+0000f0e0: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0000f0f0: 5d5d 203d 205b 5d20 2320 636f 756c 6420  ]] = [] # could 
+0000f100: 6d61 6b65 2061 6e20 6578 7472 6120 6361  make an extra ca
+0000f110: 7365 2066 6f72 2069 6d61 6765 7320 6f6d  se for images om
+0000f120: 6974 7469 6e67 2074 6865 206c 6973 740a  itting the list.
+0000f130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f140: 2020 2020 666f 7220 7375 6249 7465 6d20      for subItem 
+0000f150: 696e 2069 7465 6d3a 0a20 2020 2020 2020  in item:.       
+0000f160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f170: 2073 7562 4974 656d 4469 6374 203d 207b   subItemDict = {
+0000f180: 7d0a 2020 2020 2020 2020 2020 2020 2020  }.              
+0000f190: 2020 2020 2020 2020 2020 666f 7220 6974            for it
+0000f1a0: 2069 6e20 7375 6249 7465 6d3a 0a20 2020   in subItem:.   
+0000f1b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f1c0: 2020 2020 2020 2020 2069 6620 6974 2021           if it !
+0000f1d0: 3d20 2769 6d61 6765 2d66 696c 656e 616d  = 'image-filenam
+0000f1e0: 6527 3a0a 2020 2020 2020 2020 2020 2020  e':.            
+0000f1f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f200: 2020 2020 7375 6249 7465 6d44 6963 745b      subItemDict[
+0000f210: 6974 5d20 3d20 7375 6249 7465 6d5b 6974  it] = subItem[it
+0000f220: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+0000f230: 2020 2020 2020 2020 2020 696d 6167 655f            image_
+0000f240: 7365 745f 6974 656d 735b 7375 6249 7465  set_items[subIte
+0000f250: 6d44 6566 6175 6c74 5b27 696d 6167 652d  mDefault['image-
+0000f260: 6669 6c65 6e61 6d65 275d 5d2e 6170 7065  filename']].appe
+0000f270: 6e64 2873 7562 4974 656d 4469 6374 290a  nd(subItemDict).
+0000f280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f2a0: 2065 7863 6570 7420 6d69 7174 632e 4966   except miqtc.If
+0000f2b0: 646f 4578 6365 7074 696f 6e20 6173 2065  doException as e
+0000f2c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0000f2d0: 2020 2020 2020 696e 7661 6c69 645f 6974        invalid_it
+0000f2e0: 656d 7320 2b3d 2031 0a20 2020 2020 2020  ems += 1.       
+0000f2f0: 2020 2020 2020 2020 2020 2020 2073 656c               sel
+0000f300: 662e 7072 6f76 2e6c 6f67 2822 496e 7661  f.prov.log("Inva
+0000f310: 6c69 6420 696d 6167 6520 6974 656d 3a20  lid image item: 
+0000f320: 222b 2073 7472 2869 7465 6d29 2c64 6f6e  "+ str(item),don
+0000f330: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
+0000f340: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0000f350: 7365 6c66 2e70 726f 762e 6c6f 6728 2245  self.prov.log("E
+0000f360: 7863 6570 7469 6f6e 3a5c 6e22 2b20 7374  xception:\n"+ st
+0000f370: 7228 652e 6172 6773 292c 646f 6e74 5368  r(e.args),dontSh
+0000f380: 6f77 3d54 7275 6529 0a20 2020 2020 2020  ow=True).       
+0000f390: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+0000f3a0: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+0000f3b0: 6570 7469 6f6e 2822 496e 7661 6c69 6420  eption("Invalid 
+0000f3c0: 696d 6167 6520 6974 656d 2022 2b20 6669  image item "+ fi
+0000f3d0: 6c65 5f6e 616d 6520 2b20 223a 5c6e 4578  le_name + ":\nEx
+0000f3e0: 6365 7074 696f 6e3a 5c6e 222b 2073 7472  ception:\n"+ str
+0000f3f0: 2865 2e61 7267 7329 2920 2320 6f74 6865  (e.args)) # othe
+0000f400: 7277 6973 652c 2069 6e20 6361 7365 206f  rwise, in case o
+0000f410: 6620 6d61 6e79 2069 6d61 6765 732c 2069  f many images, i
+0000f420: 7420 6d61 7920 6b65 6570 2072 756e 6e69  t may keep runni
+0000f430: 6e67 2061 6e64 2074 6872 6f77 696e 6720  ng and throwing 
+0000f440: 6572 726f 7273 2066 6f72 2071 7569 7420  errors for quit 
+0000f450: 736f 6d65 2074 696d 650a 2020 2020 2020  some time.      
+0000f460: 2020 2020 2020 7072 6f67 2e63 6c65 6172        prog.clear
+0000f470: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
+0000f480: 6966 206c 656e 2869 7465 6d73 2920 213d  if len(items) !=
+0000f490: 2030 2061 6e64 2069 6e76 616c 6964 5f69   0 and invalid_i
+0000f4a0: 7465 6d73 203d 3d20 6c65 6e28 6974 656d  tems == len(item
+0000f4b0: 7329 3a0a 2020 2020 2020 2020 2020 2020  s):.            
+0000f4c0: 2020 2020 7261 6973 6520 4578 6365 7074      raise Except
+0000f4d0: 696f 6e28 2241 6c6c 2069 7465 6d73 2061  ion("All items a
+0000f4e0: 7265 2069 6e76 616c 6964 2229 0a20 2020  re invalid").   
+0000f4f0: 2020 2020 2020 2020 2065 6c69 6620 696e           elif in
+0000f500: 7661 6c69 645f 6974 656d 7320 3e20 303a  valid_items > 0:
+0000f510: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0000f520: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
+0000f530: 4174 206c 6561 7374 2022 202b 2073 7472  At least " + str
+0000f540: 2869 6e76 616c 6964 5f69 7465 6d73 2920  (invalid_items) 
+0000f550: 2b20 2220 6974 656d 7320 7765 7265 2069  + " items were i
+0000f560: 6e76 616c 6964 2028 6f66 2220 2b20 7374  nvalid (of" + st
+0000f570: 7228 6c65 6e28 6974 656d 7329 292b 2022  r(len(items))+ "
+0000f580: 2922 290a 0a20 2020 2020 2020 2023 2056  )")..        # V
+0000f590: 616c 6964 6174 6520 6865 6164 6572 2069  alidate header i
+0000f5a0: 6e66 6f72 6d61 7469 6f6e 0a20 2020 2020  nformation.     
+0000f5b0: 2020 2074 7279 3a0a 2020 2020 2020 2020     try:.        
+0000f5c0: 2020 2020 6d69 7174 742e 6172 655f 7661      miqtt.are_va
+0000f5d0: 6c69 645f 6966 646f 5f66 6965 6c64 7328  lid_ifdo_fields(
+0000f5e0: 7365 6c66 2e69 6664 6f5f 746d 705b 7365  self.ifdo_tmp[se
+0000f5f0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000f600: 724b 6579 5d29 0a20 2020 2020 2020 2065  rKey]).        e
+0000f610: 7863 6570 7420 6d69 7174 632e 4966 646f  xcept miqtc.Ifdo
+0000f620: 4578 6365 7074 696f 6e20 6173 2065 783a  Exception as ex:
+0000f630: 0a20 2020 2020 2020 2020 2020 206d 7367  .            msg
+0000f640: 203d 2022 496e 7661 6c69 6420 6865 6164   = "Invalid head
+0000f650: 6572 2066 6965 6c64 3a20 2220 2b20 7374  er field: " + st
+0000f660: 7228 6578 290a 2020 2020 2020 2020 2020  r(ex).          
+0000f670: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
+0000f680: 2245 7863 6570 7469 6f6e 3a20 2220 2b20  "Exception: " + 
+0000f690: 6d73 672c 2064 6f6e 7453 686f 773d 5472  msg, dontShow=Tr
+0000f6a0: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
+0000f6b0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+0000f6c0: 4578 6365 7074 696f 6e28 6d73 6729 0a0a  Exception(msg)..
+0000f6d0: 2020 2020 2020 2020 2320 7075 7420 6974          # put it
+0000f6e0: 656d 2069 6e66 6f20 696e 746f 2073 656c  em info into sel
+0000f6f0: 662e 6966 646f 5f74 6d70 0a20 2020 2020  f.ifdo_tmp.     
+0000f700: 2020 2073 203d 206d 6971 7463 2e50 7269     s = miqtc.Pri
+0000f710: 6e74 4c6f 6164 696e 674d 7367 2822 5570  ntLoadingMsg("Up
+0000f720: 6461 7469 6e67 2229 0a20 2020 2020 2020  dating").       
+0000f730: 206c 6f67 203d 206d 6971 7463 2e72 6563   log = miqtc.rec
+0000f740: 7572 7369 7665 6c79 5570 6461 7465 4469  ursivelyUpdateDi
+0000f750: 6374 7328 7365 6c66 2e69 6664 6f5f 746d  cts(self.ifdo_tm
+0000f760: 705b 7365 6c66 2e69 6d61 6765 5365 7449  p[self.imageSetI
+0000f770: 7465 6d73 4b65 795d 2c20 696d 6167 655f  temsKey], image_
+0000f780: 7365 745f 6974 656d 7329 0a20 2020 2020  set_items).     
+0000f790: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
+0000f7a0: 2020 2020 7365 6c66 2e70 726f 762e 6c6f      self.prov.lo
+0000f7b0: 6728 6c6f 6729 0a0a 2020 2020 2020 2020  g(log)..        
+0000f7c0: 2320 7365 7420 6c61 7420 6c6f 6e20 626f  # set lat lon bo
+0000f7d0: 756e 6469 6e67 2062 6f78 0a20 2020 2020  unding box.     
+0000f7e0: 2020 2073 656c 662e 5f73 6574 5f6c 6174     self._set_lat
+0000f7f0: 5f6c 6f6e 5f62 6f75 6e64 696e 675f 626f  _lon_bounding_bo
+0000f800: 7828 7365 6c66 2e69 6664 6f5f 746d 7029  x(self.ifdo_tmp)
+0000f810: 0a0a 2020 2020 2020 2020 2320 7365 7420  ..        # set 
+0000f820: 7265 7072 6573 656e 7461 7469 7665 2068  representative h
+0000f830: 6561 6465 7220 6669 656c 6473 2064 6174  eader fields dat
+0000f840: 6574 696d 652c 206c 6174 2c20 6c6f 6e2c  etime, lat, lon,
+0000f850: 2061 6c74 0a20 2020 2020 2020 2073 656c   alt.        sel
+0000f860: 662e 5f73 6574 5f72 6570 5f68 6561 6465  f._set_rep_heade
+0000f870: 725f 6669 656c 6473 5f64 745f 6c61 745f  r_fields_dt_lat_
+0000f880: 6c6f 6e5f 616c 7428 7365 6c66 2e69 6664  lon_alt(self.ifd
+0000f890: 6f5f 746d 7029 0a0a 2020 2020 2020 2020  o_tmp)..        
+0000f8a0: 7365 6c66 2e5f 7365 745f 696d 6167 655f  self._set_image_
+0000f8b0: 6974 656d 5f69 6465 6e74 6966 6963 6174  item_identificat
+0000f8c0: 696f 6e5f 7363 6865 6d65 2873 656c 662e  ion_scheme(self.
+0000f8d0: 6966 646f 5f74 6d70 290a 0a20 2020 2020  ifdo_tmp)..     
+0000f8e0: 2020 2023 2072 656d 6f76 6520 656d 7470     # remove emtp
+0000f8f0: 7920 6669 656c 6473 0a20 2020 2020 2020  y fields.       
+0000f900: 2073 203d 206d 6971 7463 2e50 7269 6e74   s = miqtc.Print
+0000f910: 4c6f 6164 696e 674d 7367 2822 5265 6d6f  LoadingMsg("Remo
+0000f920: 7669 6e67 2065 6d70 7479 2066 6965 6c64  ving empty field
+0000f930: 7322 290a 2020 2020 2020 2020 7365 6c66  s").        self
+0000f940: 2e69 6664 6f5f 746d 7020 3d20 6d69 7174  .ifdo_tmp = miqt
+0000f950: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
+0000f960: 6f76 6545 6d70 7479 4669 656c 6473 2873  oveEmptyFields(s
+0000f970: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
+0000f980: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+0000f990: 662e 696d 6167 6553 6574 4974 656d 734b  f.imageSetItemsK
+0000f9a0: 6579 2069 6e20 7365 6c66 2e69 6664 6f5f  ey in self.ifdo_
+0000f9b0: 746d 703a 0a20 2020 2020 2020 2020 2020  tmp:.           
+0000f9c0: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
+0000f9d0: 656c 662e 696d 6167 6553 6574 4974 656d  elf.imageSetItem
+0000f9e0: 734b 6579 5d20 3d20 5b5d 0a20 2020 2020  sKey] = [].     
+0000f9f0: 2020 2023 2072 656d 6f76 6520 6669 656c     # remove fiel
+0000fa00: 6473 2074 6861 7420 636f 6e74 6169 6e20  ds that contain 
+0000fa10: 2769 6d61 6765 2d64 6174 6574 696d 6527  'image-datetime'
+0000fa20: 206f 6e6c 790a 2020 2020 2020 2020 7365   only.        se
+0000fa30: 6c66 2e72 656d 6f76 6549 7465 6d46 6965  lf.removeItemFie
+0000fa40: 6c64 7357 6974 684f 6e6c 7944 6174 6554  ldsWithOnlyDateT
+0000fa50: 696d 6528 290a 2020 2020 2020 2020 732e  ime().        s.
+0000fa60: 7374 6f70 2829 0a0a 2020 2020 2020 2020  stop()..        
+0000fa70: 6966 206e 6f74 2073 656c 662e 6967 6e6f  if not self.igno
+0000fa80: 7265 5f69 6d61 6765 5f66 696c 6573 3a0a  re_image_files:.
+0000fa90: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+0000faa0: 2e63 6865 636b 416c 6c49 7465 6d48 6173  .checkAllItemHas
+0000fab0: 6865 7328 290a 0a20 2020 2020 2020 2023  hes()..        #
+0000fac0: 2063 6865 636b 2061 6761 696e 7374 2073   check against s
+0000fad0: 6368 656d 610a 2020 2020 2020 2020 7661  chema.        va
+0000fae0: 6c69 642c 206d 7367 203d 206d 6971 7474  lid, msg = miqtt
+0000faf0: 2e76 616c 6964 6174 655f 6966 646f 2873  .validate_ifdo(s
+0000fb00: 656c 662e 6966 646f 5f74 6d70 290a 2020  elf.ifdo_tmp).  
+0000fb10: 2020 2020 2020 6966 206e 6f74 2076 616c        if not val
+0000fb20: 6964 2061 6e64 206e 6f74 2061 6c6c 6f77  id and not allow
+0000fb30: 5f6d 6973 7369 6e67 5f72 6571 7569 7265  _missing_require
+0000fb40: 643a 0a20 2020 2020 2020 2020 2020 2073  d:.            s
+0000fb50: 656c 662e 7072 6f76 2e6c 6f67 2822 5761  elf.prov.log("Wa
+0000fb60: 726e 696e 6721 2069 4644 4f20 6e6f 2076  rning! iFDO no v
+0000fb70: 616c 6964 2079 6574 3a20 2220 2b20 6d73  alid yet: " + ms
+0000fb80: 6729 0a20 2020 2020 2020 2020 2020 2072  g).            r
+0000fb90: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
+0000fba0: 7863 6570 7469 6f6e 286d 7367 290a 0a20  xception(msg).. 
+0000fbb0: 2020 2020 2020 2023 2073 6574 2066 696e         # set fin
+0000fbc0: 616c 206f 6e65 0a20 2020 2020 2020 2073  al one.        s
+0000fbd0: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
+0000fbe0: 203d 2063 6f70 792e 6465 6570 636f 7079   = copy.deepcopy
+0000fbf0: 2873 656c 662e 6966 646f 5f74 6d70 290a  (self.ifdo_tmp).
+0000fc00: 2020 2020 2020 2020 7265 7475 726e 2073          return s
+0000fc10: 656c 662e 6966 646f 5f63 6865 636b 6564  elf.ifdo_checked
+0000fc20: 0a0a 0a20 2020 2064 6566 205f 7365 745f  ...    def _set_
+0000fc30: 696d 6167 655f 6974 656d 5f69 6465 6e74  image_item_ident
+0000fc40: 6966 6963 6174 696f 6e5f 7363 6865 6d65  ification_scheme
+0000fc50: 2873 656c 662c 6966 646f 3a64 6963 7429  (self,ifdo:dict)
+0000fc60: 3a0a 2020 2020 2020 2020 2222 2220 5365  :.        """ Se
+0000fc70: 7420 696d 6167 652d 6974 656d 2d69 6465  t image-item-ide
+0000fc80: 6e74 6966 6963 6174 696f 6e2d 7363 6865  ntification-sche
+0000fc90: 6d65 2074 6f20 6069 6d61 6765 2d70 726f  me to `image-pro
+0000fca0: 6a65 6374 5f69 6d61 6765 2d65 7665 6e74  ject_image-event
+0000fcb0: 5f69 6d61 6765 2d73 656e 736f 725f 696d  _image-sensor_im
+0000fcc0: 6167 652d 6461 7465 7469 6d65 2e65 7874  age-datetime.ext
+0000fcd0: 6020 6966 2065 6d70 7479 2e20 2222 220a  ` if empty. """.
+0000fce0: 2020 2020 2020 2020 6966 2066 696e 6446          if findF
+0000fcf0: 6965 6c64 2869 6664 6f5b 7365 6c66 2e69  ield(ifdo[self.i
+0000fd00: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+0000fd10: 5d2c 2769 6d61 6765 2d69 7465 6d2d 6964  ],'image-item-id
+0000fd20: 656e 7469 6669 6361 7469 6f6e 2d73 6368  entification-sch
+0000fd30: 656d 6527 2920 3d3d 2022 223a 0a20 2020  eme') == "":.   
+0000fd40: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+0000fd50: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0000fd60: 724b 6579 5d5b 2769 6d61 6765 2d69 7465  rKey]['image-ite
+0000fd70: 6d2d 6964 656e 7469 6669 6361 7469 6f6e  m-identification
+0000fd80: 2d73 6368 656d 6527 5d20 3d20 2027 696d  -scheme'] =  'im
+0000fd90: 6167 652d 7072 6f6a 6563 745f 696d 6167  age-project_imag
+0000fda0: 652d 6576 656e 745f 696d 6167 652d 7365  e-event_image-se
+0000fdb0: 6e73 6f72 5f69 6d61 6765 2d64 6174 6574  nsor_image-datet
+0000fdc0: 696d 652e 6578 7427 0a0a 0a20 2020 2064  ime.ext'...    d
+0000fdd0: 6566 205f 7365 745f 7265 705f 6865 6164  ef _set_rep_head
+0000fde0: 6572 5f66 6965 6c64 735f 6474 5f6c 6174  er_fields_dt_lat
+0000fdf0: 5f6c 6f6e 5f61 6c74 2873 656c 662c 6966  _lon_alt(self,if
+0000fe00: 646f 3a64 6963 7429 3a0a 2020 2020 2020  do:dict):.      
+0000fe10: 2020 2222 2220 4669 6c6c 2068 6561 6465    """ Fill heade
+0000fe20: 7220 6669 656c 6473 2069 6d61 6765 2d64  r fields image-d
+0000fe30: 6174 6574 696d 6520 616e 6420 2d6c 6174  atetime and -lat
+0000fe40: 6974 7564 652c 202d 6c6f 6e67 6974 7565  itude, -longitue
+0000fe50: 6465 2c20 2d61 6c74 6974 7564 652d 6d65  de, -altitude-me
+0000fe60: 7465 7273 2c20 2d63 6f6f 7264 696e 6174  ters, -coordinat
+0000fe70: 652d 756e 6365 7274 6169 6e74 792d 6d65  e-uncertainty-me
+0000fe80: 7465 7273 2c20 6966 2065 6d70 7479 2c0a  ters, if empty,.
+0000fe90: 2020 2020 2020 2020 7265 7072 6573 656e          represen
+0000fea0: 7461 7469 7665 6c79 2077 6974 6820 6669  tatively with fi
+0000feb0: 7273 7420 6974 656d 7320 656e 7472 7920  rst items entry 
+0000fec0: 616e 6420 6d65 6469 616e 206f 6620 616c  and median of al
+0000fed0: 6c20 6974 656d 7320 7661 6c75 6573 2c20  l items values, 
+0000fee0: 7265 7370 6563 7469 7665 6c79 2e20 2222  respectively. ""
+0000fef0: 220a 0a20 2020 2020 2020 2023 2027 696d  "..        # 'im
+0000ff00: 6167 652d 6461 7465 7469 6d65 270a 2020  age-datetime'.  
+0000ff10: 2020 2020 2020 6669 7273 745f 696d 6167        first_imag
+0000ff20: 6520 3d20 736f 7274 6564 2869 6664 6f5b  e = sorted(ifdo[
+0000ff30: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+0000ff40: 6d73 4b65 795d 2e6b 6579 7328 2929 5b30  msKey].keys())[0
+0000ff50: 5d0a 2020 2020 2020 2020 6669 656c 6420  ].        field 
+0000ff60: 3d20 2769 6d61 6765 2d64 6174 6574 696d  = 'image-datetim
+0000ff70: 6527 0a20 2020 2020 2020 2069 6620 6669  e'.        if fi
+0000ff80: 6e64 4669 656c 6428 6966 646f 5b73 656c  ndField(ifdo[sel
+0000ff90: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+0000ffa0: 4b65 795d 2c66 6965 6c64 2920 3d3d 2022  Key],field) == "
+0000ffb0: 223a 0a20 2020 2020 2020 2020 2020 2074  ":.            t
+0000ffc0: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
+0000ffd0: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+0000ffe0: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+0000fff0: 5b66 6965 6c64 5d20 3d20 7365 6c66 2e5f  [field] = self._
+00010000: 5f67 6574 4669 656c 6456 616c 7565 2869  _getFieldValue(i
+00010010: 6664 6f2c 5b66 6972 7374 5f69 6d61 6765  fdo,[first_image
+00010020: 2c66 6965 6c64 5d2c 6465 6661 756c 745f  ,field],default_
+00010030: 6f6e 6c79 3d54 7275 6529 0a20 2020 2020  only=True).     
+00010040: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+00010050: 7072 6f76 2e6c 6f67 2822 5365 7420 7265  prov.log("Set re
+00010060: 7072 6573 656e 7461 7469 7665 2068 6561  presentative hea
+00010070: 6465 7220 6669 656c 6420 2722 202b 2066  der field '" + f
+00010080: 6965 6c64 202b 2022 2720 746f 2022 202b  ield + "' to " +
+00010090: 2073 7472 2869 6664 6f5b 7365 6c66 2e69   str(ifdo[self.i
+000100a0: 6d61 6765 5365 7448 6561 6465 724b 6579  mageSetHeaderKey
+000100b0: 5d5b 6669 656c 645d 2920 2b20 2220 6672  ][field]) + " fr
+000100c0: 6f6d 2066 6972 7374 2069 6d61 6765 2e22  om first image."
+000100d0: 290a 2020 2020 2020 2020 2020 2020 6578  ).            ex
+000100e0: 6365 7074 206d 6971 7463 2e49 6664 6f45  cept miqtc.IfdoE
+000100f0: 7863 6570 7469 6f6e 2061 7320 6578 3a0a  xception as ex:.
+00010100: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010110: 7365 6c66 2e70 726f 762e 6c6f 6728 2243  self.prov.log("C
+00010120: 6f75 6c64 206e 6f74 2073 6574 2072 6570  ould not set rep
+00010130: 7265 7365 6e74 6174 6976 6520 6865 6164  resentative head
+00010140: 6572 2066 6965 6c64 3a20 2220 2b20 7374  er field: " + st
+00010150: 7228 6578 2929 0a20 2020 2020 2020 2020  r(ex)).         
+00010160: 2020 2020 2020 2070 6173 730a 0a20 2020         pass..   
+00010170: 2020 2020 2023 2072 6573 740a 2020 2020       # rest.    
+00010180: 2020 2020 7265 705f 6865 6164 6572 5f66      rep_header_f
+00010190: 6965 6c64 735f 6d65 6469 616e 203d 205b  ields_median = [
+000101a0: 2769 6d61 6765 2d6c 6174 6974 7564 6527  'image-latitude'
+000101b0: 2c27 696d 6167 652d 6c6f 6e67 6974 7564  ,'image-longitud
+000101c0: 6527 2c27 696d 6167 652d 616c 7469 7475  e','image-altitu
+000101d0: 6465 2d6d 6574 6572 7327 2c27 696d 6167  de-meters','imag
+000101e0: 652d 636f 6f72 6469 6e61 7465 2d75 6e63  e-coordinate-unc
+000101f0: 6572 7461 696e 7479 2d6d 6574 6572 7327  ertainty-meters'
+00010200: 5d0a 2020 2020 2020 2020 666f 7220 6669  ].        for fi
+00010210: 656c 6420 696e 2072 6570 5f68 6561 6465  eld in rep_heade
+00010220: 725f 6669 656c 6473 5f6d 6564 6961 6e3a  r_fields_median:
+00010230: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
+00010240: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
+00010250: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+00010260: 6572 4b65 795d 2c66 6965 6c64 2920 3d3d  erKey],field) ==
+00010270: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00010280: 2020 2020 2076 616c 7565 7320 3d20 5b5d       values = []
+00010290: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000102a0: 2066 6f72 2069 6d61 6765 5f6e 616d 6520   for image_name 
+000102b0: 696e 2069 6664 6f5b 7365 6c66 2e69 6d61  in ifdo[self.ima
+000102c0: 6765 5365 7449 7465 6d73 4b65 795d 2e6b  geSetItemsKey].k
+000102d0: 6579 7328 293a 0a20 2020 2020 2020 2020  eys():.         
+000102e0: 2020 2020 2020 2020 2020 2074 7279 3a0a             try:.
+000102f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010300: 2020 2020 2020 2020 6974 656d 5f76 616c          item_val
+00010310: 203d 2073 656c 662e 5f5f 6765 7446 6965   = self.__getFie
+00010320: 6c64 5661 6c75 6528 6966 646f 2c5b 696d  ldValue(ifdo,[im
+00010330: 6167 655f 6e61 6d65 2c66 6965 6c64 5d29  age_name,field])
+00010340: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010350: 2020 2020 2020 2020 2069 6620 6973 696e           if isin
+00010360: 7374 616e 6365 2869 7465 6d5f 7661 6c2c  stance(item_val,
+00010370: 6469 6374 293a 0a20 2020 2020 2020 2020  dict):.         
+00010380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010390: 2020 2076 616c 7565 7320 2b3d 206c 6973     values += lis
+000103a0: 7428 6974 656d 5f76 616c 2e76 616c 7565  t(item_val.value
+000103b0: 7328 2929 0a20 2020 2020 2020 2020 2020  s()).           
+000103c0: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+000103d0: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+000103e0: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+000103f0: 616c 7565 732e 6170 7065 6e64 2869 7465  alues.append(ite
+00010400: 6d5f 7661 6c29 0a20 2020 2020 2020 2020  m_val).         
+00010410: 2020 2020 2020 2020 2020 2065 7863 6570             excep
+00010420: 7420 6d69 7174 632e 4966 646f 4578 6365  t miqtc.IfdoExce
+00010430: 7074 696f 6e20 6173 2065 783a 0a20 2020  ption as ex:.   
+00010440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010450: 2020 2020 2070 6173 730a 2020 2020 2020       pass.      
+00010460: 2020 2020 2020 2020 2020 7661 6c75 6573            values
+00010470: 203d 205b 6920 666f 7220 6920 696e 2076   = [i for i in v
+00010480: 616c 7565 7320 6966 2069 2021 3d20 2727  alues if i != ''
+00010490: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+000104a0: 2020 6966 206c 656e 2876 616c 7565 7329    if len(values)
+000104b0: 203d 3d20 303a 0a20 2020 2020 2020 2020   == 0:.         
+000104c0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
+000104d0: 7072 6f76 2e6c 6f67 2822 436f 756c 6420  prov.log("Could 
+000104e0: 6e6f 7420 7365 7420 7265 7072 6573 656e  not set represen
+000104f0: 7461 7469 7665 2068 6561 6465 7220 6669  tative header fi
+00010500: 656c 642c 206e 6f20 7661 6c75 6573 2066  eld, no values f
+00010510: 6f75 6e64 3a20 2220 2b20 6669 656c 6429  ound: " + field)
+00010520: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010530: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
+00010540: 2020 2020 2020 2020 2020 2023 2069 676e             # ign
+00010550: 6f72 6520 756e 6b6e 6f6e 772c 2069 2e65  ore unknonw, i.e
+00010560: 2e20 302e 302c 2076 616c 7565 730a 2020  . 0.0, values.  
+00010570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010580: 2020 7661 6c75 6573 203d 205b 6920 666f    values = [i fo
+00010590: 7220 6920 696e 2076 616c 7565 7320 6966  r i in values if
+000105a0: 2069 2021 3d20 302e 305d 0a20 2020 2020   i != 0.0].     
+000105b0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000105c0: 6620 6c65 6e28 7661 6c75 6573 2920 3d3d  f len(values) ==
+000105d0: 2030 3a0a 2020 2020 2020 2020 2020 2020   0:.            
+000105e0: 2020 2020 2020 2020 2020 2020 7661 6c75              valu
+000105f0: 6573 2e61 7070 656e 6428 302e 3029 200a  es.append(0.0) .
+00010600: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010610: 2020 2020 6966 646f 5b73 656c 662e 696d      ifdo[self.im
+00010620: 6167 6553 6574 4865 6164 6572 4b65 795d  ageSetHeaderKey]
+00010630: 5b66 6965 6c64 5d20 3d20 7374 6174 6973  [field] = statis
+00010640: 7469 6373 2e6d 6564 6961 6e28 7661 6c75  tics.median(valu
+00010650: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00010660: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00010670: 762e 6c6f 6728 2253 6574 2072 6570 7265  v.log("Set repre
+00010680: 7365 6e74 6174 6976 6520 6865 6164 6572  sentative header
+00010690: 2066 6965 6c64 2027 2220 2b20 6669 656c   field '" + fiel
+000106a0: 6420 2b20 2227 2074 6f20 6d65 6469 616e  d + "' to median
+000106b0: 3a20 2220 2b20 7374 7228 6966 646f 5b73  : " + str(ifdo[s
+000106c0: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+000106d0: 6572 4b65 795d 5b66 6965 6c64 5d29 202b  erKey][field]) +
+000106e0: 2022 2e22 290a 0a0a 2020 2020 6465 6620   ".")...    def 
+000106f0: 5f73 6574 5f6c 6174 5f6c 6f6e 5f62 6f75  _set_lat_lon_bou
+00010700: 6e64 696e 675f 626f 7828 7365 6c66 2c69  nding_box(self,i
+00010710: 6664 6f3a 6469 6374 293a 0a20 2020 2020  fdo:dict):.     
+00010720: 2020 2022 2222 2053 6574 2069 6d61 6765     """ Set image
+00010730: 2d73 6574 2d5b 6d69 6e2c 6d61 785d 2d5b  -set-[min,max]-[
+00010740: 6c61 7469 7475 6465 2c6c 6f6e 6769 7475  latitude,longitu
+00010750: 6465 5d2d 6465 6772 6565 7320 2222 220a  de]-degrees """.
+00010760: 2020 2020 2020 2020 6c61 745f 6d69 6e2c          lat_min,
+00010770: 206c 6174 5f6d 6178 2c20 6c6f 6e5f 6d69   lat_max, lon_mi
+00010780: 6e2c 206c 6f6e 5f6d 6178 203d 2073 656c  n, lon_max = sel
+00010790: 662e 5f67 6574 5f6c 6174 5f6c 6f6e 5f62  f._get_lat_lon_b
+000107a0: 6f75 6e64 696e 675f 626f 7828 6966 646f  ounding_box(ifdo
+000107b0: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+000107c0: 656d 734b 6579 5d29 0a20 2020 2020 2020  emsKey]).       
+000107d0: 2069 6620 6e6f 7420 4e6f 6e65 2069 6e20   if not None in 
+000107e0: 5b6c 6174 5f6d 696e 2c20 6c61 745f 6d61  [lat_min, lat_ma
+000107f0: 782c 206c 6f6e 5f6d 696e 2c20 6c6f 6e5f  x, lon_min, lon_
+00010800: 6d61 785d 3a0a 2020 2020 2020 2020 2020  max]:.          
+00010810: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
+00010820: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+00010830: 696d 6167 652d 7365 742d 6d69 6e2d 6c61  image-set-min-la
+00010840: 7469 7475 6465 2d64 6567 7265 6573 275d  titude-degrees']
+00010850: 203d 206c 6174 5f6d 696e 0a20 2020 2020   = lat_min.     
+00010860: 2020 2020 2020 2069 6664 6f5b 7365 6c66         ifdo[self
+00010870: 2e69 6d61 6765 5365 7448 6561 6465 724b  .imageSetHeaderK
+00010880: 6579 5d5b 2769 6d61 6765 2d73 6574 2d6d  ey]['image-set-m
+00010890: 6178 2d6c 6174 6974 7564 652d 6465 6772  ax-latitude-degr
+000108a0: 6565 7327 5d20 3d20 6c61 745f 6d61 780a  ees'] = lat_max.
+000108b0: 2020 2020 2020 2020 2020 2020 6966 646f              ifdo
+000108c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
+000108d0: 6164 6572 4b65 795d 5b27 696d 6167 652d  aderKey]['image-
+000108e0: 7365 742d 6d69 6e2d 6c6f 6e67 6974 7564  set-min-longitud
+000108f0: 652d 6465 6772 6565 7327 5d20 3d20 6c6f  e-degrees'] = lo
+00010900: 6e5f 6d69 6e0a 2020 2020 2020 2020 2020  n_min.          
+00010910: 2020 6966 646f 5b73 656c 662e 696d 6167    ifdo[self.imag
+00010920: 6553 6574 4865 6164 6572 4b65 795d 5b27  eSetHeaderKey]['
+00010930: 696d 6167 652d 7365 742d 6d61 782d 6c6f  image-set-max-lo
+00010940: 6e67 6974 7564 652d 6465 6772 6565 7327  ngitude-degrees'
+00010950: 5d20 3d20 6c6f 6e5f 6d61 780a 0a0a 2020  ] = lon_max...  
+00010960: 2020 4073 7461 7469 636d 6574 686f 640a    @staticmethod.
+00010970: 2020 2020 6465 6620 5f67 6574 5f6c 6174      def _get_lat
+00010980: 5f6c 6f6e 5f62 6f75 6e64 696e 675f 626f  _lon_bounding_bo
+00010990: 7828 6974 656d 733a 6469 6374 293a 0a20  x(items:dict):. 
+000109a0: 2020 2020 2020 2022 2222 2052 6574 7572         """ Retur
+000109b0: 6e73 206c 6174 5f6d 696e 2c20 6c61 745f  ns lat_min, lat_
+000109c0: 6d61 782c 206c 6f6e 5f6d 696e 2c20 6c6f  max, lon_min, lo
+000109d0: 6e5f 6d61 7820 2222 220a 2020 2020 2020  n_max """.      
+000109e0: 2020 6c61 745f 6d69 6e2c 206c 6174 5f6d    lat_min, lat_m
+000109f0: 6178 2c20 6c6f 6e5f 6d69 6e2c 206c 6f6e  ax, lon_min, lon
+00010a00: 5f6d 6178 203d 204e 6f6e 652c 204e 6f6e  _max = None, Non
+00010a10: 652c 204e 6f6e 652c 204e 6f6e 650a 2020  e, None, None.  
+00010a20: 2020 2020 2020 6920 3d20 300a 2020 2020        i = 0.    
+00010a30: 2020 2020 666f 7220 696d 6167 652c 2064      for image, d
+00010a40: 6174 6120 696e 2069 7465 6d73 2e69 7465  ata in items.ite
+00010a50: 6d73 2829 3a0a 2020 2020 2020 2020 2020  ms():.          
+00010a60: 2020 2320 6d61 6b65 2069 6d61 6765 2065    # make image e
+00010a70: 6e74 7279 206c 6973 7420 2861 6c73 6f20  ntry list (also 
+00010a80: 6966 2069 7473 2061 2070 6963 7475 7265  if its a picture
+00010a90: 290a 2020 2020 2020 2020 2020 2020 6966  ).            if
+00010aa0: 206e 6f74 2069 7369 6e73 7461 6e63 6528   not isinstance(
+00010ab0: 6461 7461 2c20 6c69 7374 293a 0a20 2020  data, list):.   
+00010ac0: 2020 2020 2020 2020 2020 2020 2064 6174               dat
+00010ad0: 6120 3d20 5b64 6174 615d 0a20 2020 2020  a = [data].     
+00010ae0: 2020 2020 2020 200a 2020 2020 2020 2020         .        
+00010af0: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
+00010b00: 745f 6461 7461 2069 6e20 6461 7461 3a0a  t_data in data:.
+00010b10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b20: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
+00010b30: 2020 2020 2020 2020 206c 6174 203d 2074           lat = t
+00010b40: 696d 6570 6f69 6e74 5f64 6174 615b 2769  imepoint_data['i
+00010b50: 6d61 6765 2d6c 6174 6974 7564 6527 5d0a  mage-latitude'].
+00010b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010b70: 2020 2020 6c6f 6e20 3d20 7469 6d65 706f      lon = timepo
+00010b80: 696e 745f 6461 7461 5b27 696d 6167 652d  int_data['image-
+00010b90: 6c6f 6e67 6974 7564 6527 5d0a 2020 2020  longitude'].    
+00010ba0: 2020 2020 2020 2020 2020 2020 6578 6365              exce
+00010bb0: 7074 204b 6579 4572 726f 7220 6173 2065  pt KeyError as e
+00010bc0: 783a 0a20 2020 2020 2020 2020 2020 2020  x:.             
+00010bd0: 2020 2020 2020 2063 6f6e 7469 6e75 650a         continue.
+00010be0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00010bf0: 2069 6620 6920 3d3d 2030 3a0a 2020 2020   if i == 0:.    
+00010c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c10: 6c61 745f 6d69 6e2c 206c 6174 5f6d 6178  lat_min, lat_max
+00010c20: 203d 206c 6174 2c20 6c61 740a 2020 2020   = lat, lat.    
+00010c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010c40: 6c6f 6e5f 6d69 6e2c 206c 6f6e 5f6d 6178  lon_min, lon_max
+00010c50: 203d 206c 6f6e 2c20 6c6f 6e0a 2020 2020   = lon, lon.    
+00010c60: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00010c70: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00010c80: 2020 2020 2020 6966 206c 6174 203c 206c        if lat < l
+00010c90: 6174 5f6d 696e 3a0a 2020 2020 2020 2020  at_min:.        
+00010ca0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cb0: 6c61 745f 6d69 6e20 3d20 6c61 740a 2020  lat_min = lat.  
+00010cc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010cd0: 2020 6966 206c 6174 203e 206c 6174 5f6d    if lat > lat_m
+00010ce0: 6178 3a0a 2020 2020 2020 2020 2020 2020  ax:.            
+00010cf0: 2020 2020 2020 2020 2020 2020 6c61 745f              lat_
+00010d00: 6d61 7820 3d20 6c61 740a 2020 2020 2020  max = lat.      
+00010d10: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00010d20: 206c 6f6e 203c 206c 6f6e 5f6d 696e 3a0a   lon < lon_min:.
+00010d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d40: 2020 2020 2020 2020 6c6f 6e5f 6d69 6e20          lon_min 
+00010d50: 3d20 6c6f 6e0a 2020 2020 2020 2020 2020  = lon.          
+00010d60: 2020 2020 2020 2020 2020 6966 206c 6f6e            if lon
+00010d70: 203e 206c 6f6e 5f6d 6178 3a0a 2020 2020   > lon_max:.    
+00010d80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00010d90: 2020 2020 6c6f 6e5f 6d61 7820 3d20 6c6f      lon_max = lo
+00010da0: 6e0a 2020 2020 2020 2020 2020 2020 2020  n.              
+00010db0: 2020 6920 2b3d 2031 0a20 2020 2020 2020    i += 1.       
+00010dc0: 2072 6574 7572 6e20 6c61 745f 6d69 6e2c   return lat_min,
+00010dd0: 206c 6174 5f6d 6178 2c20 6c6f 6e5f 6d69   lat_max, lon_mi
+00010de0: 6e2c 206c 6f6e 5f6d 6178 0a0a 0a20 2020  n, lon_max...   
+00010df0: 2064 6566 2072 656d 6f76 6549 7465 6d46   def removeItemF
+00010e00: 6965 6c64 7357 6974 684f 6e6c 7944 6174  ieldsWithOnlyDat
+00010e10: 6554 696d 6528 7365 6c66 293a 0a20 2020  eTime(self):.   
+00010e20: 2020 2020 2022 2222 2069 7420 6361 6e20       """ it can 
+00010e30: 6861 7070 656e 2074 6861 7420 616e 2069  happen that an i
+00010e40: 6d61 6765 2074 696d 6573 7461 6d70 2064  mage timestamp d
+00010e50: 6f65 7320 6e6f 7420 636f 6e74 6169 6e20  oes not contain 
+00010e60: 616e 7920 6669 656c 6473 2062 7574 2074  any fields but t
+00010e70: 6865 2074 696d 6573 7461 6d70 2061 6e79  he timestamp any
+00010e80: 206d 6f72 652e 2054 686f 7365 2061 7265   more. Those are
+00010e90: 2072 656d 6f76 6564 2068 6572 652e 2022   removed here. "
+00010ea0: 2222 200a 2020 2020 2020 2020 666f 7220  "" .        for 
+00010eb0: 6974 656d 2069 6e20 7365 6c66 2e69 6664  item in self.ifd
+00010ec0: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00010ed0: 5365 7449 7465 6d73 4b65 795d 3a0a 2020  SetItemsKey]:.  
+00010ee0: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
+00010ef0: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00010f00: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00010f10: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00010f20: 5b69 7465 6d5d 2c6c 6973 7429 3a0a 2020  [item],list):.  
+00010f30: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00010f40: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00010f50: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00010f60: 795d 5b69 7465 6d5d 203d 205b 7365 6c66  y][item] = [self
+00010f70: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00010f80: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00010f90: 5b69 7465 6d5d 5d0a 2020 2020 2020 2020  [item]].        
+00010fa0: 2020 2020 746f 4265 5265 6d6f 7665 6420      toBeRemoved 
+00010fb0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
+00010fc0: 2066 6f72 2065 6e74 7279 2069 6e20 7365   for entry in se
+00010fd0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+00010fe0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+00010ff0: 795d 5b69 7465 6d5d 3a0a 2020 2020 2020  y][item]:.      
+00011000: 2020 2020 2020 2020 2020 2370 7269 6e74            #print
+00011010: 2865 6e74 7279 290a 2020 2020 2020 2020  (entry).        
+00011020: 2020 2020 2020 2020 6966 206c 656e 2865          if len(e
+00011030: 6e74 7279 2920 3d3d 2031 2061 6e64 2027  ntry) == 1 and '
+00011040: 696d 6167 652d 6461 7465 7469 6d65 2720  image-datetime' 
+00011050: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
+00011060: 2020 2020 2020 2020 2020 2020 2020 746f                to
+00011070: 4265 5265 6d6f 7665 642e 6170 7065 6e64  BeRemoved.append
+00011080: 2865 6e74 7279 290a 2020 2020 2020 2020  (entry).        
+00011090: 2020 2020 666f 7220 656e 7472 7920 696e      for entry in
+000110a0: 2074 6f42 6552 656d 6f76 6564 3a0a 2020   toBeRemoved:.  
+000110b0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+000110c0: 6c66 2e69 6664 6f5f 746d 705b 7365 6c66  lf.ifdo_tmp[self
+000110d0: 2e69 6d61 6765 5365 7449 7465 6d73 4b65  .imageSetItemsKe
+000110e0: 795d 5b69 7465 6d5d 2e72 656d 6f76 6528  y][item].remove(
+000110f0: 656e 7472 7929 200a 0a0a 2020 2020 6465  entry) ...    de
+00011100: 6620 6368 6563 6b41 6c6c 4974 656d 4861  f checkAllItemHa
+00011110: 7368 6573 2873 656c 662c 2068 6172 643d  shes(self, hard=
+00011120: 4661 6c73 652c 2072 6169 7365 4578 6365  False, raiseExce
+00011130: 7074 696f 6e20 3d20 5472 7565 293a 0a20  ption = True):. 
+00011140: 2020 2020 2020 2022 2222 200a 2020 2020         """ .    
+00011150: 2020 2020 4368 6563 6b73 2069 6620 6861      Checks if ha
+00011160: 7368 6573 2069 6e20 6946 444f 206d 6174  shes in iFDO mat
+00011170: 6368 2068 6173 6865 7320 696e 2069 6e74  ch hashes in int
+00011180: 6572 6d65 6964 6174 6520 6861 7368 2066  ermeidate hash f
+00011190: 696c 6520 6966 2074 6865 206c 6174 7465  ile if the latte
+000111a0: 7220 7761 7320 6368 616e 6765 6420 6c61  r was changed la
+000111b0: 7374 2061 6674 6572 2074 6865 2069 6d61  st after the ima
+000111c0: 6765 7320 6861 7320 6368 616e 6765 642e  ges has changed.
+000111d0: 0a20 2020 2020 2020 204f 7468 6572 7769  .        Otherwi
+000111e0: 7365 206f 7220 6966 2068 6172 643d 3d54  se or if hard==T
+000111f0: 7275 6520 6974 2072 6564 6574 6572 6d69  rue it redetermi
+00011200: 6e65 7320 7468 6520 6163 7475 616c 6c20  nes the actuall 
+00011210: 6669 6c65 2773 2068 6173 6820 616e 6420  file's hash and 
+00011220: 636f 6d70 6172 6573 2074 6865 2069 4644  compares the iFD
+00011230: 4f20 6974 656d 2773 2068 6173 6820 7769  O item's hash wi
+00011240: 7468 2074 6861 742e 0a20 2020 2020 2020  th that..       
+00011250: 2049 6620 6861 7368 6573 2064 6f20 6e6f   If hashes do no
+00011260: 7420 6d61 7463 6820 6120 6d61 7269 7174  t match a mariqt
+00011270: 2e63 6f72 652e 4966 646f 4578 6365 7074  .core.IfdoExcept
+00011280: 696f 6e20 6973 2072 6973 656e 2075 6e73  ion is risen uns
+00011290: 6c65 7373 2072 6169 7365 4578 6365 7074  less raiseExcept
+000112a0: 696f 6e20 3d3d 2046 616c 7365 2c20 7468  ion == False, th
+000112b0: 656e 2061 206c 6973 7420 6f66 206c 6973  en a list of lis
+000112c0: 7473 205b 3c66 696c 653e 2c3c 6578 6365  ts [<file>,<exce
+000112d0: 7074 696f 6e3e 5d20 6973 2072 6574 7572  ption>] is retur
+000112e0: 6e65 642e 0a20 2020 2020 2020 2022 2222  ned..        """
+000112f0: 0a20 2020 2020 2020 2068 6173 6865 7320  .        hashes 
+00011300: 3d20 7b7d 0a20 2020 2020 2020 2068 6173  = {}.        has
+00011310: 6846 696c 654d 6f64 5469 6d65 203d 2031  hFileModTime = 1
+00011320: 3065 2b31 3030 0a20 2020 2020 2020 2069  0e+100.        i
+00011330: 6620 6f73 2e70 6174 682e 6578 6973 7473  f os.path.exists
+00011340: 2873 656c 662e 6765 745f 696e 745f 6861  (self.get_int_ha
+00011350: 7368 5f66 696c 6528 2929 3a0a 2020 2020  sh_file()):.    
+00011360: 2020 2020 2020 2020 6861 7368 6573 203d          hashes =
+00011370: 206d 6971 7466 2e74 6162 4669 6c65 4461   miqtf.tabFileDa
+00011380: 7461 2873 656c 662e 6765 745f 696e 745f  ta(self.get_int_
+00011390: 6861 7368 5f66 696c 6528 292c 205b 6d69  hash_file(), [mi
+000113a0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+000113b0: 6d61 7269 7174 275d 5b27 696d 6727 5d2c  mariqt']['img'],
+000113c0: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
+000113d0: 725b 276d 6172 6971 7427 5d5b 2768 6173  r['mariqt']['has
+000113e0: 6827 5d5d 2c20 6b65 795f 636f 6c3d 6d69  h']], key_col=mi
+000113f0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00011400: 6d61 7269 7174 275d 5b27 696d 6727 5d29  mariqt']['img'])
+00011410: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
+00011420: 6846 696c 654d 6f64 5469 6d65 203d 206f  hFileModTime = o
+00011430: 732e 7061 7468 2e67 6574 6d74 696d 6528  s.path.getmtime(
+00011440: 7365 6c66 2e67 6574 5f69 6e74 5f68 6173  self.get_int_has
+00011450: 685f 6669 6c65 2829 290a 0a20 2020 2020  h_file())..     
+00011460: 2020 2065 7863 6570 7469 6f6e 4c69 7374     exceptionList
+00011470: 203d 205b 5d0a 0a20 2020 2020 2020 2068   = []..        h
+00011480: 6173 6855 6e63 6865 636b 496d 6167 6573  ashUncheckImages
+00011490: 496e 5261 7720 3d20 7365 6c66 2e69 6d61  InRaw = self.ima
+000114a0: 6765 7349 6e49 6d61 6765 7344 6972 2829  gesInImagesDir()
+000114b0: 0a20 2020 2020 2020 2070 726f 6720 3d20  .        prog = 
+000114c0: 6d69 7174 632e 5072 696e 744b 6e6f 776e  miqtc.PrintKnown
+000114d0: 5072 6f67 7265 7373 4d73 6728 2243 6865  ProgressMsg("Che
+000114e0: 636b 696e 6720 6974 656d 2068 6173 6865  cking item hashe
+000114f0: 7322 2c20 6c65 6e28 7365 6c66 2e69 6664  s", len(self.ifd
+00011500: 6f5f 746d 705b 7365 6c66 2e69 6d61 6765  o_tmp[self.image
+00011510: 5365 7449 7465 6d73 4b65 795d 2929 0a20  SetItemsKey])). 
+00011520: 2020 2020 2020 2066 6f72 2069 7465 6d20         for item 
+00011530: 696e 2073 656c 662e 6966 646f 5f74 6d70  in self.ifdo_tmp
+00011540: 5b73 656c 662e 696d 6167 6553 6574 4974  [self.imageSetIt
+00011550: 656d 734b 6579 5d3a 0a20 2020 2020 2020  emsKey]:.       
+00011560: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
+00011570: 7373 2829 0a0a 2020 2020 2020 2020 2020  ss()..          
+00011580: 2020 666f 756e 6420 3d20 4661 6c73 650a    found = False.
+00011590: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000115a0: 696d 6167 6520 696e 2068 6173 6855 6e63  image in hashUnc
+000115b0: 6865 636b 496d 6167 6573 496e 5261 773a  heckImagesInRaw:
+000115c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000115d0: 2066 696c 654e 616d 6520 3d20 6f73 2e70   fileName = os.p
+000115e0: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
+000115f0: 6765 290a 2020 2020 2020 2020 2020 2020  ge).            
+00011600: 2020 2020 6966 2066 696c 654e 616d 6520      if fileName 
+00011610: 3d3d 2069 7465 6d3a 0a20 2020 2020 2020  == item:.       
+00011620: 2020 2020 2020 2020 2020 2020 2066 6f75               fou
+00011630: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
+00011640: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00011650: 2069 7369 6e73 7461 6e63 6528 7365 6c66   isinstance(self
+00011660: 2e69 6664 6f5f 746d 705b 7365 6c66 2e69  .ifdo_tmp[self.i
+00011670: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
+00011680: 5b69 7465 6d5d 2c6c 6973 7429 3a20 2320  [item],list): # 
+00011690: 696e 2063 6173 6520 6f66 2076 6964 656f  in case of video
+000116a0: 2077 6974 6820 6974 656d 2061 7320 6c69   with item as li
+000116b0: 7374 2074 6865 2066 6972 7374 2065 6e74  st the first ent
+000116c0: 7279 2068 6f6c 6473 2074 6865 2064 6566  ry holds the def
+000116d0: 6175 6c74 2061 6e64 2074 6865 2068 6173  ault and the has
+000116e0: 6820 6361 6e6e 6f74 2076 6172 7920 666f  h cannot vary fo
+000116f0: 7220 7468 6520 7361 6d65 2069 6d61 6765  r the same image
+00011700: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011710: 2020 2020 2020 2020 2069 7465 6d45 6e74           itemEnt
+00011720: 7279 203d 2073 656c 662e 6966 646f 5f74  ry = self.ifdo_t
+00011730: 6d70 5b73 656c 662e 696d 6167 6553 6574  mp[self.imageSet
+00011740: 4974 656d 734b 6579 5d5b 6974 656d 5d5b  ItemsKey][item][
+00011750: 305d 200a 2020 2020 2020 2020 2020 2020  0] .            
+00011760: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011770: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011780: 2020 2020 2020 6974 656d 456e 7472 7920        itemEntry 
+00011790: 3d20 7365 6c66 2e69 6664 6f5f 746d 705b  = self.ifdo_tmp[
+000117a0: 7365 6c66 2e69 6d61 6765 5365 7449 7465  self.imageSetIte
+000117b0: 6d73 4b65 795d 5b69 7465 6d5d 0a0a 2020  msKey][item]..  
 000117c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117d0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000117e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000117f0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00011800: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00011810: 5b66 696c 654e 616d 652c 226e 6f74 2066  [fileName,"not f
-00011820: 6f75 6e64 2069 6e20 696e 7465 726d 6569  ound in intermei
-00011830: 6461 7465 2068 6173 6820 6669 6c65 2022  date hash file "
-00011840: 202b 2073 7472 2873 656c 662e 6765 745f   + str(self.get_
-00011850: 696e 745f 6861 7368 5f66 696c 6528 2929  int_hash_file())
-00011860: 5d29 0a20 2020 2020 2020 2020 2020 2020  ]).             
-00011870: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
-00011880: 7420 6974 656d 456e 7472 795b 2769 6d61  t itemEntry['ima
-00011890: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-000118a0: 203d 3d20 6861 7368 6573 5b6f 732e 7061   == hashes[os.pa
-000118b0: 7468 2e62 6173 656e 616d 6528 696d 6167  th.basename(imag
-000118c0: 6529 5d5b 2769 6d61 6765 2d68 6173 682d  e)]['image-hash-
-000118d0: 7368 6132 3536 275d 3a0a 2020 2020 2020  sha256']:.      
-000118e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000118f0: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
-00011900: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
-00011910: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011920: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-00011930: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-00011940: 6f6e 2869 7465 6d2c 2022 696e 636f 7272  on(item, "incorr
-00011950: 6563 7420 7368 6132 3536 2068 6173 6822  ect sha256 hash"
-00011960: 2c20 6974 656d 456e 7472 795b 2769 6d61  , itemEntry['ima
-00011970: 6765 2d68 6173 682d 7368 6132 3536 275d  ge-hash-sha256']
-00011980: 2c22 666f 7220 6669 6c65 222c 6669 6c65  ,"for file",file
-00011990: 4e61 6d65 2c22 2072 756e 2063 7265 6174  Name," run creat
-000119a0: 655f 696d 6167 655f 7368 6132 3536 5f66  e_image_sha256_f
-000119b0: 696c 6528 2920 6669 7273 7422 290a 2020  ile() first").  
-000119c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119d0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
-000119e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000119f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011a00: 6578 6365 7074 696f 6e4c 6973 742e 6170  exceptionList.ap
-00011a10: 7065 6e64 285b 6669 6c65 4e61 6d65 2c22  pend([fileName,"
-00011a20: 696e 636f 7272 6563 7420 7368 6132 3536  incorrect sha256
-00011a30: 2068 6173 6822 5d29 0a20 2020 2020 2020   hash"]).       
-00011a40: 2020 2020 2020 2020 2020 2020 2065 6c69               eli
-00011a50: 6620 6e6f 7420 6974 656d 456e 7472 795b  f not itemEntry[
-00011a60: 2769 6d61 6765 2d68 6173 682d 7368 6132  'image-hash-sha2
-00011a70: 3536 275d 203d 3d20 6d69 7174 632e 7368  56'] == miqtc.sh
-00011a80: 6132 3536 4861 7368 4669 6c65 2869 6d61  a256HashFile(ima
-00011a90: 6765 293a 0a20 2020 2020 2020 2020 2020  ge):.           
-00011aa0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00011ab0: 7261 6973 6545 7863 6570 7469 6f6e 3a0a  raiseException:.
-00011ac0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ad0: 2020 2020 2020 2020 2020 2020 7261 6973              rais
-00011ae0: 6520 6d69 7174 632e 4966 646f 4578 6365  e miqtc.IfdoExce
-00011af0: 7074 696f 6e28 6974 656d 2c20 2269 6e63  ption(item, "inc
-00011b00: 6f72 7265 6374 2073 6861 3235 3620 6861  orrect sha256 ha
-00011b10: 7368 222c 2069 7465 6d45 6e74 7279 5b27  sh", itemEntry['
-00011b20: 696d 6167 652d 6861 7368 2d73 6861 3235  image-hash-sha25
-00011b30: 3627 5d2c 2266 6f72 2066 696c 6522 2c66  6'],"for file",f
-00011b40: 696c 654e 616d 652c 2220 7275 6e20 6372  ileName," run cr
-00011b50: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
-00011b60: 365f 6669 6c65 2829 2066 6972 7374 2229  6_file() first")
-00011b70: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011b80: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-00011b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00011ba0: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00011bb0: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00011bc0: 5b66 696c 654e 616d 652c 2269 6e63 6f72  [fileName,"incor
-00011bd0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
-00011be0: 225d 290a 2020 2020 2020 2020 2020 2020  "]).            
-00011bf0: 2020 2020 2020 2020 6272 6561 6b0a 2020          break.  
-00011c00: 2020 2020 2020 2020 2020 6966 2066 6f75            if fou
-00011c10: 6e64 3a0a 2020 2020 2020 2020 2020 2020  nd:.            
-00011c20: 2020 2020 6465 6c20 6861 7368 556e 6368      del hashUnch
-00011c30: 6563 6b49 6d61 6765 7349 6e52 6177 5b69  eckImagesInRaw[i
-00011c40: 6d61 6765 5d0a 2020 2020 2020 2020 2020  mage].          
-00011c50: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00011c60: 2020 2020 2020 2020 6966 2072 6169 7365          if raise
-00011c70: 4578 6365 7074 696f 6e3a 0a20 2020 2020  Exception:.     
-00011c80: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00011c90: 6169 7365 206d 6971 7463 2e49 6664 6f45  aise miqtc.IfdoE
-00011ca0: 7863 6570 7469 6f6e 2820 2269 6d61 6765  xception( "image
-00011cb0: 222c 2069 7465 6d2c 2022 6e6f 7420 666f  ", item, "not fo
-00011cc0: 756e 6420 696e 2064 6972 6563 746f 7279  und in directory
-00011cd0: 2773 2072 6177 2066 6f6c 6465 7221 2229  's raw folder!")
-00011ce0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00011cf0: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00011d00: 2020 2020 2020 2020 2020 2065 7863 6570             excep
-00011d10: 7469 6f6e 4c69 7374 2e61 7070 656e 6428  tionList.append(
-00011d20: 5b66 696c 654e 616d 652c 2266 696c 6520  [fileName,"file 
-00011d30: 6e6f 7420 666f 756e 6422 5d29 0a20 2020  not found"]).   
-00011d40: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
-00011d50: 290a 2020 2020 2020 2020 6966 206e 6f74  ).        if not
-00011d60: 2072 6169 7365 4578 6365 7074 696f 6e3a   raiseException:
-00011d70: 0a20 2020 2020 2020 2020 2020 2072 6574  .            ret
-00011d80: 7572 6e20 6578 6365 7074 696f 6e4c 6973  urn exceptionLis
-00011d90: 740a 0a0a 2020 2020 6465 6620 6372 6561  t...    def crea
-00011da0: 7465 5f75 7569 645f 6669 6c65 2873 656c  te_uuid_file(sel
-00011db0: 662c 636c 6561 6e3d 5472 7565 293a 0a20  f,clean=True):. 
-00011dc0: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
-00011dd0: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
-00011de0: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
-00011df0: 636f 6e74 6169 6e69 6e67 2070 6572 2069  containing per i
-00011e00: 6d61 6765 2061 2063 7265 6174 6564 2075  mage a created u
-00011e10: 7569 6420 2876 6572 7369 6f6e 2034 292e  uid (version 4).
-00011e20: 0a0a 2020 2020 2020 2020 5468 6520 5555  ..        The UU
-00011e30: 4944 2069 7320 6f6e 6c79 202a 7461 6b65  ID is only *take
-00011e40: 6e2a 2066 726f 6d20 7468 6520 6d65 7461  n* from the meta
-00011e50: 6461 7461 206f 6620 7468 6520 696d 6167  data of the imag
-00011e60: 6573 2e20 4974 2064 6f65 7320 6e6f 7420  es. It does not 
-00011e70: 7772 6974 6520 5555 4944 7320 746f 2074  write UUIDs to t
-00011e80: 6865 206d 6574 6164 6174 6120 696e 2063  he metadata in c
-00011e90: 6173 6520 736f 6d65 2066 696c 6573 2061  ase some files a
-00011ea0: 7265 206d 6973 7369 6e67 2069 742e 0a20  re missing it.. 
-00011eb0: 2020 2020 2020 2042 7574 2c20 6974 2063         But, it c
-00011ec0: 7265 6174 6573 2061 2043 5356 2066 696c  reates a CSV fil
-00011ed0: 6520 696e 2074 6861 7420 6361 7365 2074  e in that case t
-00011ee0: 6861 7420 796f 7520 6361 6e20 7573 6520  hat you can use 
-00011ef0: 746f 6765 7468 6572 2077 6974 6820 6578  together with ex
-00011f00: 6966 746f 6f6c 2074 6f20 6164 6420 7468  iftool to add th
-00011f10: 6520 5555 4944 2074 6f20 796f 7572 2064  e UUID to your d
-00011f20: 6174 612e 2042 6577 6172 6521 2074 6869  ata. Beware! thi
-00011f30: 7320 6361 6e20 6465 7374 726f 7920 796f  s can destroy yo
-00011f40: 7572 2069 6d61 6765 730a 2020 2020 2020  ur images.      
-00011f50: 2020 6966 206e 6f74 2064 6f6e 6520 7072    if not done pr
-00011f60: 6f70 6572 6c79 2120 4e6f 2067 7561 7261  operly! No guara
-00011f70: 6e74 6565 2069 7320 6769 7665 6e20 6974  ntee is given it
-00011f80: 2077 696c 6c20 776f 726b 2e20 4265 2063   will work. Be c
-00011f90: 6172 6566 756c 210a 0a20 2020 2020 2020  areful!..       
-00011fa0: 2055 7365 2063 6c65 616e 3d46 616c 7365   Use clean=False
-00011fb0: 2074 6f20 6e6f 7420 6368 6563 6b20 7468   to not check th
-00011fc0: 6f73 6520 6669 6c65 7320 6167 6169 6e20  ose files again 
-00011fd0: 7768 6963 6820 6172 6520 616c 7265 6164  which are alread
-00011fe0: 7920 666f 756e 6420 696e 2069 6e74 6572  y found in inter
-00011ff0: 6d65 6469 6174 6520 7575 6964 2066 696c  mediate uuid fil
-00012000: 650a 2020 2020 2020 2020 2222 220a 0a20  e.        """.. 
-00012010: 2020 2020 2020 2075 7569 6473 203d 207b         uuids = {
-00012020: 7d0a 2020 2020 2020 2020 2320 4368 6563  }.        # Chec
-00012030: 6b20 7768 6574 6865 7220 6120 6669 6c65  k whether a file
-00012040: 2077 6974 6820 5555 4944 7320 6578 6973   with UUIDs exis
-00012050: 7473 2c20 7468 656e 2072 6561 6420 6974  ts, then read it
-00012060: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00012070: 636c 6561 6e20 616e 6420 6f73 2e70 6174  clean and os.pat
-00012080: 682e 6578 6973 7473 2873 656c 662e 6765  h.exists(self.ge
-00012090: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-000120a0: 2929 3a0a 2020 2020 2020 2020 2020 2020  )):.            
-000120b0: 7575 6964 7320 3d20 6d69 7174 662e 7461  uuids = miqtf.ta
-000120c0: 6246 696c 6544 6174 6128 7365 6c66 2e67  bFileData(self.g
-000120d0: 6574 5f69 6e74 5f75 7569 645f 6669 6c65  et_int_uuid_file
-000120e0: 2829 2c20 5b6d 6971 7476 2e63 6f6c 5f68  (), [miqtv.col_h
-000120f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012100: 2769 6d67 275d 2c20 6d69 7174 762e 636f  'img'], miqtv.co
-00012110: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00012120: 275d 5b27 7575 6964 275d 5d2c 206b 6579  ']['uuid']], key
-00012130: 5f63 6f6c 3d6d 6971 7476 2e63 6f6c 5f68  _col=miqtv.col_h
-00012140: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00012150: 2769 6d67 275d 290a 2020 2020 2020 2020  'img']).        
-00012160: 2020 2020 0a20 2020 2020 2020 2069 6620      .        if 
-00012170: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00012180: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
-00012190: 0a20 2020 2020 2020 2020 2020 206d 6973  .            mis
-000121a0: 7369 6e67 5f75 7569 6473 203d 207b 7d0a  sing_uuids = {}.
-000121b0: 2020 2020 2020 2020 2020 2020 6164 6465              adde
-000121c0: 645f 7575 6964 7320 3d20 300a 0a20 2020  d_uuids = 0..   
-000121d0: 2020 2020 2020 2020 2075 6e6b 6e6f 776e           unknown
-000121e0: 4669 6c65 7320 3d20 5b5d 0a20 2020 2020  Files = [].     
-000121f0: 2020 2020 2020 2066 6f72 2066 696c 6520         for file 
-00012200: 696e 2073 656c 662e 696d 6167 6573 496e  in self.imagesIn
-00012210: 496d 6167 6573 4469 7228 293a 0a20 2020  ImagesDir():.   
-00012220: 2020 2020 2020 2020 2020 2020 2066 696c               fil
-00012230: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
-00012240: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
-00012250: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012260: 6966 2066 696c 655f 6e61 6d65 206e 6f74  if file_name not
-00012270: 2069 6e20 7575 6964 733a 0a20 2020 2020   in uuids:.     
-00012280: 2020 2020 2020 2020 2020 2020 2020 2075                 u
-00012290: 6e6b 6e6f 776e 4669 6c65 732e 6170 7065  nknownFiles.appe
-000122a0: 6e64 2866 696c 6529 0a20 2020 2020 2020  nd(file).       
-000122b0: 2020 2020 2020 2020 2065 6c73 653a 0a20           else:. 
-000122c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000122d0: 2020 2075 7569 6473 5b66 696c 655f 6e61     uuids[file_na
-000122e0: 6d65 5d20 3d20 7575 6964 735b 6669 6c65  me] = uuids[file
-000122f0: 5f6e 616d 655d 5b6d 6971 7476 2e63 6f6c  _name][miqtv.col
-00012300: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00012310: 5d5b 2775 7569 6427 5d5d 0a0a 2020 2020  ]['uuid']]..    
-00012320: 2020 2020 2020 2020 756e 6b6e 6f77 6e46          unknownF
-00012330: 696c 6573 5555 4944 7320 3d20 6d69 7174  ilesUUIDs = miqt
-00012340: 692e 696d 6167 6573 436f 6e74 6169 6e56  i.imagesContainV
-00012350: 616c 6964 5555 4944 2875 6e6b 6e6f 776e  alidUUID(unknown
-00012360: 4669 6c65 7329 0a20 2020 2020 2020 2020  Files).         
-00012370: 2020 2066 6f72 2066 696c 6520 696e 2075     for file in u
-00012380: 6e6b 6e6f 776e 4669 6c65 7355 5549 4473  nknownFilesUUIDs
-00012390: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000123a0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
-000123b0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
-000123c0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-000123d0: 2020 2020 2069 6620 6e6f 7420 756e 6b6e       if not unkn
-000123e0: 6f77 6e46 696c 6573 5555 4944 735b 6669  ownFilesUUIDs[fi
-000123f0: 6c65 5d5b 2776 616c 6964 275d 3a0a 2020  le]['valid']:.  
-00012400: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012410: 2020 7575 6964 203d 206d 6971 7463 2e75    uuid = miqtc.u
-00012420: 7569 6434 2829 0a20 2020 2020 2020 2020  uid4().         
-00012430: 2020 2020 2020 2020 2020 206d 6973 7369             missi
-00012440: 6e67 5f75 7569 6473 5b66 696c 655d 203d  ng_uuids[file] =
-00012450: 2075 7569 640a 2020 2020 2020 2020 2020   uuid.          
-00012460: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00012470: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012480: 7575 6964 735b 6669 6c65 5f6e 616d 655d  uuids[file_name]
-00012490: 203d 2075 6e6b 6e6f 776e 4669 6c65 7355   = unknownFilesU
-000124a0: 5549 4473 5b66 696c 655d 5b27 7575 6964  UIDs[file]['uuid
-000124b0: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-000124c0: 2020 2020 2020 2061 6464 6564 5f75 7569         added_uui
-000124d0: 6473 202b 3d20 310a 0a20 2020 2020 2020  ds += 1..       
-000124e0: 2020 2020 2023 2049 6620 7072 6576 696f       # If previo
-000124f0: 7573 6c79 2075 6e6b 6e6f 776e 2055 5549  usly unknown UUI
-00012500: 4473 2077 6572 6520 666f 756e 6420 696e  Ds were found in
-00012510: 2074 6865 2066 696c 6520 6865 6164 6572   the file header
-00012520: 732c 2061 6464 2074 6865 6d20 746f 2074  s, add them to t
-00012530: 6865 2055 5549 4420 6669 6c65 0a20 2020  he UUID file.   
-00012540: 2020 2020 2020 2020 2069 6620 6164 6465           if adde
-00012550: 645f 7575 6964 7320 3e20 303a 0a20 2020  d_uuids > 0:.   
-00012560: 2020 2020 2020 2020 2020 2020 2072 6573               res
-00012570: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-00012580: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
-00012590: 2c20 2277 2229 0a20 2020 2020 2020 2020  , "w").         
-000125a0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-000125b0: 286d 6971 7476 2e63 6f6c 5f68 6561 6465  (miqtv.col_heade
-000125c0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
-000125d0: 275d 202b 225c 7422 2b6d 6971 7476 2e63  '] +"\t"+miqtv.c
-000125e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000125f0: 7427 5d5b 2775 7569 6427 5d2b 225c 6e22  t']['uuid']+"\n"
-00012600: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00012610: 2020 666f 7220 6669 6c65 2069 6e20 7575    for file in uu
-00012620: 6964 733a 0a20 2020 2020 2020 2020 2020  ids:.           
-00012630: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00012640: 7465 2866 696c 652b 225c 7422 2b73 7472  te(file+"\t"+str
-00012650: 2875 7569 6473 5b66 696c 655d 292b 225c  (uuids[file])+"\
-00012660: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-00012670: 2020 2020 7265 732e 636c 6f73 6528 290a      res.close().
-00012680: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00012690: 6c65 6e28 6d69 7373 696e 675f 7575 6964  len(missing_uuid
-000126a0: 7329 203e 2030 3a0a 2020 2020 2020 2020  s) > 0:.        
-000126b0: 2020 2020 2020 2020 6563 7376 5f70 6174          ecsv_pat
-000126c0: 6820 3d20 7365 6c66 2e5f 5f67 6574 5f69  h = self.__get_i
-000126d0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
-000126e0: 202b 2022 5f65 7869 662d 6164 642d 7575   + "_exif-add-uu
-000126f0: 6964 2e63 7376 220a 2020 2020 2020 2020  id.csv".        
-00012700: 2020 2020 2020 2020 6373 7620 3d20 6f70          csv = op
-00012710: 656e 2865 6373 765f 7061 7468 2c20 2277  en(ecsv_path, "w
-00012720: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00012730: 2020 2063 7376 2e77 7269 7465 286d 6971     csv.write(miq
-00012740: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
-00012750: 7869 6627 5d5b 2769 6d67 275d 202b 0a20  xif']['img'] +. 
-00012760: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012770: 2020 2020 2020 2020 2022 2c22 2b6d 6971           ","+miq
-00012780: 7476 2e63 6f6c 5f68 6561 6465 725b 2765  tv.col_header['e
-00012790: 7869 6627 5d5b 2775 7569 6427 5d2b 225c  xif']['uuid']+"\
-000127a0: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-000127b0: 2020 2020 6469 6666 6572 656e 745f 7061      different_pa
-000127c0: 7468 7320 3d20 5b5d 0a20 2020 2020 2020  ths = [].       
-000127d0: 2020 2020 2020 2020 2066 6f72 2069 6d67           for img
-000127e0: 2069 6e20 6d69 7373 696e 675f 7575 6964   in missing_uuid
-000127f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00012800: 2020 2020 2020 2069 6620 6f73 2e70 6174         if os.pat
-00012810: 682e 6261 7365 6e61 6d65 2869 6d67 2920  h.basename(img) 
-00012820: 6e6f 7420 696e 2064 6966 6665 7265 6e74  not in different
-00012830: 5f70 6174 6873 3a0a 2020 2020 2020 2020  _paths:.        
-00012840: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012850: 6469 6666 6572 656e 745f 7061 7468 732e  different_paths.
-00012860: 6170 7065 6e64 286f 732e 7061 7468 2e62  append(os.path.b
-00012870: 6173 656e 616d 6528 696d 6729 290a 2020  asename(img)).  
-00012880: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00012890: 2020 6373 762e 7772 6974 6528 696d 672b    csv.write(img+
-000128a0: 222c 222b 7374 7228 6d69 7373 696e 675f  ","+str(missing_
-000128b0: 7575 6964 735b 696d 675d 292b 225c 6e22  uuids[img])+"\n"
-000128c0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-000128d0: 2020 2372 6574 7572 6e20 4661 6c73 652c    #return False,
-000128e0: 2022 6578 6966 746f 6f6c 202d 6373 763d   "exiftool -csv=
-000128f0: 222b 6563 7376 5f70 6174 682b 2220 222b  "+ecsv_path+" "+
-00012900: 2220 222e 6a6f 696e 2864 6966 6665 7265  " ".join(differe
-00012910: 6e74 5f70 6174 6873 290a 2020 2020 2020  nt_paths).      
-00012920: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00012930: 2046 616c 7365 2c20 224e 6f74 2061 6c6c   False, "Not all
-00012940: 2069 6d61 6765 7320 6861 7665 2076 616c   images have val
-00012950: 6964 2055 5549 4473 2e20 4d69 7373 696e  id UUIDs. Missin
-00012960: 6720 666f 7220 666f 6c6c 6f77 696e 6720  g for following 
-00012970: 6669 6c65 733a 5c6e 222b 225c c586 222e  files:\n"+"\..".
-00012980: 6a6f 696e 2864 6966 6665 7265 6e74 5f70  join(different_p
-00012990: 6174 6873 290a 2020 2020 2020 2020 2020  aths).          
-000129a0: 2020 0a20 2020 2020 2020 2020 2020 2073    .            s
-000129b0: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
-000129c0: 6563 6b65 6420 3d20 5472 7565 0a20 2020  ecked = True.   
-000129d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000129e0: 5472 7565 2c20 2241 6c6c 2069 6d61 6765  True, "All image
-000129f0: 7320 6861 7665 2061 2055 5549 4422 0a20  s have a UUID". 
-00012a00: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00012a10: 6c73 652c 2022 5061 7468 2022 2b73 656c  lse, "Path "+sel
-00012a20: 662e 696d 6167 6573 4469 7220 2b20 2220  f.imagesDir + " 
-00012a30: 6e6f 7420 666f 756e 642e 220a 0a20 2020  not found."..   
-00012a40: 2064 6566 2063 7265 6174 6555 5549 4446   def createUUIDF
-00012a50: 696c 6528 7365 6c66 2c63 6c65 616e 3d54  ile(self,clean=T
-00012a60: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-00012a70: 2220 4465 7072 6563 6174 6564 202d 2075  " Deprecated - u
-00012a80: 7365 2063 7265 6174 655f 7575 6964 5f66  se create_uuid_f
-00012a90: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
-00012aa0: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
-00012ab0: 7465 5f75 7569 645f 6669 6c65 2863 6c65  te_uuid_file(cle
-00012ac0: 616e 290a 0a0a 2020 2020 6465 6620 7365  an)...    def se
-00012ad0: 745f 696d 6167 655f 7365 745f 6174 7469  t_image_set_atti
-00012ae0: 7475 6465 2873 656c 662c 7961 775f 6672  tude(self,yaw_fr
-00012af0: 616d 653a 666c 6f61 742c 7069 7463 685f  ame:float,pitch_
-00012b00: 6672 616d 653a 666c 6f61 742c 726f 6c6c  frame:float,roll
-00012b10: 5f66 7261 6d65 3a66 6c6f 6174 2c79 6177  _frame:float,yaw
-00012b20: 5f63 616d 3266 7261 6d65 3a66 6c6f 6174  _cam2frame:float
-00012b30: 2c70 6974 6368 5f63 616d 3266 7261 6d65  ,pitch_cam2frame
-00012b40: 3a66 6c6f 6174 2c72 6f6c 6c5f 6361 6d32  :float,roll_cam2
-00012b50: 6672 616d 653a 666c 6f61 7429 3a0a 2020  frame:float):.  
-00012b60: 2020 2020 2020 2222 2220 6361 6c63 756c        """ calcul
-00012b70: 6174 6573 2074 6865 2074 6865 2063 616d  ates the the cam
-00012b80: 6572 6173 2061 6273 6f6c 7574 6520 6174  eras absolute at
-00012b90: 7469 7475 6465 2061 6e64 2073 6574 7320  titude and sets 
-00012ba0: 6974 2074 6f20 696d 6167 6520 7365 7420  it to image set 
-00012bb0: 6865 6164 6572 2e20 416c 6c20 616e 676c  header. All angl
-00012bc0: 6573 2061 7265 2065 7870 6563 7465 6420  es are expected 
-00012bd0: 696e 2064 6567 7265 6573 2e20 0a20 2020  in degrees. .   
-00012be0: 2020 2020 2063 616d 6572 6132 6672 616d       camera2fram
-00012bf0: 6520 616e 676c 6573 3a20 726f 7461 7469  e angles: rotati
-00012c00: 6f6e 206f 6620 6361 6d65 7261 2063 6f6f  on of camera coo
-00012c10: 7264 696e 6174 6573 2028 782c 792c 7a20  rdinates (x,y,z 
-00012c20: 3d20 746f 702c 2072 6967 6874 2c20 6c69  = top, right, li
-00012c30: 6e65 206f 6620 7369 6768 7429 2077 6974  ne of sight) wit
-00012c40: 6820 7265 7370 6563 7420 746f 2076 6568  h respect to veh
-00012c50: 6963 6c65 2063 6f6f 7264 696e 6174 6573  icle coordinates
-00012c60: 2028 782c 792c 7a20 3d20 666f 7277 6172   (x,y,z = forwar
-00012c70: 642c 7269 6768 742c 646f 776e 2920 0a20  d,right,down) . 
-00012c80: 2020 2020 2020 2069 6e20 6163 636f 7264         in accord
-00012c90: 616e 6365 2077 6974 6820 7468 6520 7961  ance with the ya
-00012ca0: 772c 7069 7463 682c 726f 6c6c 2072 6f74  w,pitch,roll rot
-00012cb0: 6174 696f 6e20 6f72 6465 7220 636f 6e76  ation order conv
-00012cc0: 656e 7469 6f6e 3a0a 0a20 2020 2020 2020  ention:..       
-00012cd0: 2031 2e20 7961 7720 6172 6f75 6e64 207a   1. yaw around z
-00012ce0: 2c0a 2020 2020 2020 2020 322e 2070 6974  ,.        2. pit
-00012cf0: 6368 2061 726f 756e 6420 726f 7461 7465  ch around rotate
-00012d00: 6420 792c 0a20 2020 2020 2020 2033 2e20  d y,.        3. 
-00012d10: 726f 6c6c 2061 726f 756e 6420 726f 7461  roll around rota
-00012d20: 7465 6420 780a 0a20 2020 2020 2020 2052  ted x..        R
-00012d30: 6f74 6174 696f 6e20 6469 7265 6374 696f  otation directio
-00012d40: 6e73 2061 6363 6f72 6469 6e67 2074 6f20  ns according to 
-00012d50: 5c27 7269 6768 742d 6861 6e64 2072 756c  \'right-hand rul
-00012d60: 655c 272e 0a0a 2020 2020 2020 2020 492e  e\'...        I.
-00012d70: 652e 2063 616d 6572 6132 4672 616d 6520  e. camera2Frame 
-00012d80: 616e 676c 6573 203d 2030 2c30 2c30 2063  angles = 0,0,0 c
-00012d90: 616d 6572 6120 6973 2066 6163 696e 6720  amera is facing 
-00012da0: 646f 776e 7761 7264 2077 6974 6820 746f  downward with to
-00012db0: 7020 7369 6465 2074 6f77 6172 6473 2076  p side towards v
-00012dc0: 6568 6963 6c65 2773 2066 6f72 7761 7264  ehicle's forward
-00012dd0: 2064 6972 6563 7469 6f6e 2720 2222 220a   direction' """.
-00012de0: 0a20 2020 2020 2020 2052 5f66 7261 6d65  .        R_frame
-00012df0: 326e 6564 203d 206d 6971 7467 2e52 5f59  2ned = miqtg.R_Y
-00012e00: 6177 5069 7463 6852 6f6c 6c28 7961 775f  awPitchRoll(yaw_
-00012e10: 6672 616d 652c 7069 7463 685f 6672 616d  frame,pitch_fram
-00012e20: 652c 726f 6c6c 5f66 7261 6d65 290a 2020  e,roll_frame).  
-00012e30: 2020 2020 2020 525f 6361 6d32 6672 616d        R_cam2fram
-00012e40: 6520 3d20 6d69 7174 672e 525f 5961 7750  e = miqtg.R_YawP
-00012e50: 6974 6368 526f 6c6c 2879 6177 5f63 616d  itchRoll(yaw_cam
-00012e60: 3266 7261 6d65 2c70 6974 6368 5f63 616d  2frame,pitch_cam
-00012e70: 3266 7261 6d65 2c72 6f6c 6c5f 6361 6d32  2frame,roll_cam2
-00012e80: 6672 616d 6529 0a20 2020 2020 2020 2052  frame).        R
-00012e90: 5f63 616d 326e 6564 203d 2052 5f66 7261  _cam2ned = R_fra
-00012ea0: 6d65 326e 6564 2e64 6f74 2852 5f63 616d  me2ned.dot(R_cam
-00012eb0: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-00012ec0: 7961 772c 7069 7463 682c 726f 6c6c 203d  yaw,pitch,roll =
-00012ed0: 206d 6971 7467 2e79 6177 5069 7463 6852   miqtg.yawPitchR
-00012ee0: 6f6c 6c28 525f 6361 6d32 6e65 6429 0a0a  oll(R_cam2ned)..
-00012ef0: 2020 2020 2020 2020 2320 706f 7365 206d          # pose m
-00012f00: 6174 7269 7820 6361 6d32 7574 6d0a 2020  atrix cam2utm.  
-00012f10: 2020 2020 2020 525f 6361 6d53 7464 3275        R_camStd2u
-00012f20: 746d 203d 2073 656c 662e 6765 745f 525f  tm = self.get_R_
-00012f30: 6361 6d53 7464 3275 746d 2852 5f63 616d  camStd2utm(R_cam
-00012f40: 3266 7261 6d65 2c52 5f66 7261 6d65 326e  2frame,R_frame2n
-00012f50: 6564 290a 0a20 2020 2020 2020 2022 2222  ed)..        """
-00012f60: 0a20 2020 2020 2020 2078 203d 206e 702e  .        x = np.
-00012f70: 6172 7261 7928 5b31 2c30 2c30 5d29 0a20  array([1,0,0]). 
-00012f80: 2020 2020 2020 2079 203d 206e 702e 6172         y = np.ar
-00012f90: 7261 7928 5b30 2c31 2c30 5d29 0a20 2020  ray([0,1,0]).   
-00012fa0: 2020 2020 207a 203d 206e 702e 6172 7261       z = np.arra
-00012fb0: 7928 5b30 2c30 2c31 5d29 0a20 2020 2020  y([0,0,1]).     
-00012fc0: 2020 2070 7269 6e74 2827 7827 2c52 5f63     print('x',R_c
-00012fd0: 616d 5374 6432 7574 6d2e 646f 7428 7829  amStd2utm.dot(x)
-00012fe0: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
-00012ff0: 2020 2070 7269 6e74 2827 7927 2c52 5f63     print('y',R_c
-00013000: 616d 5374 6432 7574 6d2e 646f 7428 7929  amStd2utm.dot(y)
-00013010: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
-00013020: 2020 2070 7269 6e74 2827 7a27 2c52 5f63     print('z',R_c
-00013030: 616d 5374 6432 7574 6d2e 646f 7428 7a29  amStd2utm.dot(z)
-00013040: 2e72 6f75 6e64 2835 2929 0a20 2020 2020  .round(5)).     
-00013050: 2020 2022 2222 0a0a 2020 2020 2020 2020     """..        
-00013060: 6865 6164 6572 5570 6461 7465 203d 207b  headerUpdate = {
-00013070: 0a20 2020 2020 2020 2020 2020 206d 6971  .            miq
-00013080: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00013090: 6172 6971 7427 5d5b 2779 6177 275d 3a79  ariqt']['yaw']:y
-000130a0: 6177 2c0a 2020 2020 2020 2020 2020 2020  aw,.            
-000130b0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000130c0: 5b27 6d61 7269 7174 275d 5b27 7069 7463  ['mariqt']['pitc
-000130d0: 6827 5d3a 7069 7463 682c 0a20 2020 2020  h']:pitch,.     
-000130e0: 2020 2020 2020 206d 6971 7476 2e63 6f6c         miqtv.col
-000130f0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013100: 5d5b 2772 6f6c 6c27 5d3a 726f 6c6c 2c0a  ]['roll']:roll,.
-00013110: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-00013120: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00013130: 7269 7174 275d 5b27 706f 7365 275d 3a7b  riqt']['pose']:{
-00013140: 2770 6f73 652d 6162 736f 6c75 7465 2d6f  'pose-absolute-o
-00013150: 7269 656e 7461 7469 6f6e 2d75 746d 2d6d  rientation-utm-m
-00013160: 6174 7269 7827 3a52 5f63 616d 5374 6432  atrix':R_camStd2
-00013170: 7574 6d2e 666c 6174 7465 6e28 292e 746f  utm.flatten().to
-00013180: 6c69 7374 2829 7d0a 2020 2020 2020 2020  list()}.        
-00013190: 7d0a 2020 2020 2020 2020 7365 6c66 2e75  }.        self.u
-000131a0: 7064 6174 655f 6966 646f 5f68 6561 6465  pdate_ifdo_heade
-000131b0: 725f 6669 656c 6473 2868 6561 6465 7255  r_fields(headerU
-000131c0: 7064 6174 6529 0a0a 2020 2020 6465 6620  pdate)..    def 
-000131d0: 7365 7449 6d61 6765 5365 7441 7474 6974  setImageSetAttit
-000131e0: 7564 6528 7365 6c66 2c79 6177 5f66 7261  ude(self,yaw_fra
-000131f0: 6d65 3a66 6c6f 6174 2c70 6974 6368 5f66  me:float,pitch_f
-00013200: 7261 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f  rame:float,roll_
-00013210: 6672 616d 653a 666c 6f61 742c 7961 775f  frame:float,yaw_
-00013220: 6361 6d32 6672 616d 653a 666c 6f61 742c  cam2frame:float,
-00013230: 7069 7463 685f 6361 6d32 6672 616d 653a  pitch_cam2frame:
-00013240: 666c 6f61 742c 726f 6c6c 5f63 616d 3266  float,roll_cam2f
-00013250: 7261 6d65 3a66 6c6f 6174 293a 0a20 2020  rame:float):.   
-00013260: 2020 2020 2022 2222 2044 6570 7265 6361       """ Depreca
-00013270: 7465 6420 2d20 7573 6520 7365 745f 696d  ted - use set_im
-00013280: 6167 655f 7365 745f 6174 7469 7475 6465  age_set_attitude
-00013290: 2022 2222 0a20 2020 2020 2020 2073 656c   """.        sel
-000132a0: 662e 7365 745f 696d 6167 655f 7365 745f  f.set_image_set_
-000132b0: 6174 7469 7475 6465 2879 6177 5f66 7261  attitude(yaw_fra
-000132c0: 6d65 2c20 7069 7463 685f 6672 616d 652c  me, pitch_frame,
-000132d0: 2072 6f6c 6c5f 6672 616d 652c 2079 6177   roll_frame, yaw
-000132e0: 5f63 616d 3266 7261 6d65 2c20 7069 7463  _cam2frame, pitc
-000132f0: 685f 6361 6d32 6672 616d 652c 2072 6f6c  h_cam2frame, rol
-00013300: 6c5f 6361 6d32 6672 616d 6529 0a0a 0a20  l_cam2frame)... 
-00013310: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
-00013320: 6167 655f 6174 7469 7475 6465 5f66 696c  age_attitude_fil
-00013330: 6528 7365 6c66 2c20 6174 745f 7061 7468  e(self, att_path
-00013340: 3a73 7472 2c20 6672 616d 655f 6174 745f  :str, frame_att_
-00013350: 6865 6164 6572 3a64 6963 742c 2063 616d  header:dict, cam
-00013360: 6572 6132 4672 616d 655f 7961 773a 666c  era2Frame_yaw:fl
-00013370: 6f61 742c 6361 6d65 7261 3246 7261 6d65  oat,camera2Frame
-00013380: 5f70 6974 6368 3a66 6c6f 6174 2c63 616d  _pitch:float,cam
-00013390: 6572 6132 4672 616d 655f 726f 6c6c 3a66  era2Frame_roll:f
-000133a0: 6c6f 6174 2c0a 2020 2020 2020 2020 2020  loat,.          
-000133b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000133c0: 2020 2020 2020 6461 7465 5f66 6f72 6d61        date_forma
-000133d0: 743d 6d69 7174 762e 6461 7465 5f66 6f72  t=miqtv.date_for
-000133e0: 6d61 7473 5b27 7061 6e67 6165 6127 5d2c  mats['pangaea'],
-000133f0: 2063 6f6e 7374 5f76 616c 7565 7320 3d20   const_values = 
-00013400: 7b7d 2c20 6f76 6572 7772 6974 653d 4661  {}, overwrite=Fa
-00013410: 6c73 652c 2063 6f6c 5f73 6570 6172 6174  lse, col_separat
-00013420: 6f72 203d 2022 5c74 222c 0a20 2020 2020  or = "\t",.     
-00013430: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013440: 2020 2020 2020 2020 2020 2061 7474 5f70             att_p
-00013450: 6174 685f 616e 676c 6573 5f69 6e5f 7261  ath_angles_in_ra
-00013460: 6420 3d20 4661 6c73 652c 2076 6964 656f  d = False, video
-00013470: 5361 6d70 6c65 5365 636f 6e64 733d 312c  SampleSeconds=1,
-00013480: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00013490: 6564 3d5b 5d29 3a0a 2020 2020 2020 2020  ed=[]):.        
-000134a0: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
-000134b0: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
-000134c0: 6578 7420 6669 6c65 2077 6974 6820 6361  ext file with ca
-000134d0: 6d65 7261 2061 7474 6974 7564 6520 6461  mera attitude da
-000134e0: 7461 2066 6f72 2065 6163 6820 696d 6167  ta for each imag
-000134f0: 652e 2041 6c6c 2061 6e67 6c65 7320 6172  e. All angles ar
-00013500: 6520 6578 7065 6374 6564 2069 6e20 6465  e expected in de
-00013510: 6772 6565 732e 2055 7365 2061 7474 5f70  grees. Use att_p
-00013520: 6174 685f 616e 676c 6573 5f69 6e5f 7261  ath_angles_in_ra
-00013530: 6420 6966 206e 6563 6573 7361 7279 2e20  d if necessary. 
-00013540: 0a20 2020 2020 2020 2063 616d 6572 6132  .        camera2
-00013550: 4672 616d 6520 616e 676c 6573 3a20 726f  Frame angles: ro
-00013560: 7461 7469 6f6e 206f 6620 6361 6d65 7261  tation of camera
-00013570: 2063 6f6f 7264 696e 6174 6573 2028 782c   coordinates (x,
-00013580: 792c 7a20 3d20 746f 702c 2072 6967 6874  y,z = top, right
-00013590: 2c20 6c69 6e65 206f 6620 7369 6768 7429  , line of sight)
-000135a0: 2077 6974 6820 7265 7370 6563 7420 746f   with respect to
-000135b0: 2076 6568 6963 6c65 2063 6f6f 7264 696e   vehicle coordin
-000135c0: 6174 6573 2028 782c 792c 7a20 3d20 666f  ates (x,y,z = fo
-000135d0: 7277 6172 642c 7269 6768 742c 646f 776e  rward,right,down
-000135e0: 2920 0a20 2020 2020 2020 2069 6e20 6163  ) .        in ac
-000135f0: 636f 7264 616e 6365 2077 6974 6820 7468  cordance with th
-00013600: 6520 7961 772c 7069 7463 682c 726f 6c6c  e yaw,pitch,roll
-00013610: 2072 6f74 6174 696f 6e20 6f72 6465 7220   rotation order 
-00013620: 636f 6e76 656e 7469 6f6e 3a0a 2020 2020  convention:.    
-00013630: 2020 2020 312e 2079 6177 2061 726f 756e      1. yaw aroun
-00013640: 6420 7a2c 0a20 2020 2020 2020 2032 2e20  d z,.        2. 
-00013650: 7069 7463 6820 6172 6f75 6e64 2072 6f74  pitch around rot
-00013660: 6174 6564 2079 2c0a 2020 2020 2020 2020  ated y,.        
-00013670: 332e 2072 6f6c 6c20 6172 6f75 6e64 2072  3. roll around r
-00013680: 6f74 6174 6564 2078 0a0a 2020 2020 2020  otated x..      
-00013690: 2020 526f 7461 7469 6f6e 2064 6972 6563    Rotation direc
-000136a0: 7469 6f6e 7320 6163 636f 7264 696e 6720  tions according 
-000136b0: 746f 205c 2772 6967 6874 2d68 616e 6420  to \'right-hand 
-000136c0: 7275 6c65 5c27 2e0a 0a20 2020 2020 2020  rule\'...       
-000136d0: 2049 2e65 2e20 6361 6d65 7261 3246 7261   I.e. camera2Fra
-000136e0: 6d65 2061 6e67 6c65 7320 3d20 302c 302c  me angles = 0,0,
-000136f0: 3020 6361 6d65 7261 2069 7320 6661 6369  0 camera is faci
-00013700: 6e67 2064 6f77 6e77 6172 6420 7769 7468  ng downward with
-00013710: 2074 6f70 2073 6964 6520 746f 7761 7264   top side toward
-00013720: 7320 7665 6869 636c 6527 7320 666f 7277  s vehicle's forw
-00013730: 6172 6420 6469 7265 6374 696f 6e27 2022  ard direction' "
-00013740: 2222 0a0a 2020 2020 2020 2020 696e 745f  ""..        int_
-00013750: 6174 7475 7475 6465 5f66 696c 6520 3d20  attutude_file = 
-00013760: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
-00013770: 696c 655f 7072 6566 6978 2829 202b 2027  ile_prefix() + '
-00013780: 5f69 6d61 6765 2d61 7474 6974 7564 652e  _image-attitude.
-00013790: 7478 7427 0a20 2020 2020 2020 206f 7574  txt'.        out
-000137a0: 7075 745f 6865 6164 6572 5f61 7474 203d  put_header_att =
-000137b0: 207b 2020 206d 6971 7476 2e63 6f6c 5f68   {   miqtv.col_h
-000137c0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-000137d0: 2769 6d67 275d 3a20 206d 6971 7476 2e63  'img']:  miqtv.c
-000137e0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000137f0: 7427 5d5b 2769 6d67 275d 2c0a 2020 2020  t']['img'],.    
-00013800: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013810: 2020 2020 2020 2020 2020 2020 6d69 7174              miqt
-00013820: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00013830: 7269 7174 275d 5b27 7574 6327 5d3a 6d69  riqt']['utc']:mi
-00013840: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00013850: 6d61 7269 7174 275d 5b27 7574 6327 5d2c  mariqt']['utc'],
-00013860: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00013870: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013880: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-00013890: 725b 276d 6172 6971 7427 5d5b 2779 6177  r['mariqt']['yaw
-000138a0: 275d 3a6d 6971 7476 2e63 6f6c 5f68 6561  ']:miqtv.col_hea
-000138b0: 6465 725b 276d 6172 6971 7427 5d5b 2779  der['mariqt']['y
-000138c0: 6177 275d 2c0a 2020 2020 2020 2020 2020  aw'],.          
-000138d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000138e0: 2020 2020 2020 6d69 7174 762e 636f 6c5f        miqtv.col_
-000138f0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00013900: 5b27 7069 7463 6827 5d3a 6d69 7174 762e  ['pitch']:miqtv.
-00013910: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013920: 7174 275d 5b27 7069 7463 6827 5d2c 0a20  qt']['pitch'],. 
-00013930: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013940: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00013950: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013960: 276d 6172 6971 7427 5d5b 2772 6f6c 6c27  'mariqt']['roll'
-00013970: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
-00013980: 6572 5b27 6d61 7269 7174 275d 5b27 726f  er['mariqt']['ro
-00013990: 6c6c 275d 2c0a 2020 2020 2020 2020 2020  ll'],.          
+000117d0: 2020 696d 6167 654d 6f64 5469 6d65 203d    imageModTime =
+000117e0: 206f 732e 7061 7468 2e67 6574 6d74 696d   os.path.getmtim
+000117f0: 6528 696d 6167 6529 0a20 2020 2020 2020  e(image).       
+00011800: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00011810: 6e6f 7420 6861 7264 2061 6e64 2069 6d61  not hard and ima
+00011820: 6765 4d6f 6454 696d 6520 3c20 6861 7368  geModTime < hash
+00011830: 4669 6c65 4d6f 6454 696d 653a 0a20 2020  FileModTime:.   
+00011840: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011850: 2020 2020 2069 6620 6e6f 7420 6f73 2e70       if not os.p
+00011860: 6174 682e 6261 7365 6e61 6d65 2869 6d61  ath.basename(ima
+00011870: 6765 2920 696e 2068 6173 6865 733a 0a20  ge) in hashes:. 
+00011880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011890: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
+000118a0: 6973 6545 7863 6570 7469 6f6e 3a0a 2020  iseException:.  
+000118b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000118c0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
+000118d0: 6973 6520 6d69 7174 632e 4966 646f 4578  ise miqtc.IfdoEx
+000118e0: 6365 7074 696f 6e28 6974 656d 2c20 226e  ception(item, "n
+000118f0: 6f74 2066 6f75 6e64 2069 6e20 696e 7465  ot found in inte
+00011900: 726d 6569 6461 7465 2068 6173 6820 6669  rmeidate hash fi
+00011910: 6c65 222c 7365 6c66 2e67 6574 5f69 6e74  le",self.get_int
+00011920: 5f68 6173 685f 6669 6c65 2829 2c22 2072  _hash_file()," r
+00011930: 756e 2063 7265 6174 655f 696d 6167 655f  un create_image_
+00011940: 7368 6132 3536 5f66 696c 6528 2920 6669  sha256_file() fi
+00011950: 7273 7422 2920 0a20 2020 2020 2020 2020  rst") .         
+00011960: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011970: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00011980: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011990: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
+000119a0: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
+000119b0: 696c 654e 616d 652c 226e 6f74 2066 6f75  ileName,"not fou
+000119c0: 6e64 2069 6e20 696e 7465 726d 6569 6461  nd in intermeida
+000119d0: 7465 2068 6173 6820 6669 6c65 2022 202b  te hash file " +
+000119e0: 2073 7472 2873 656c 662e 6765 745f 696e   str(self.get_in
+000119f0: 745f 6861 7368 5f66 696c 6528 2929 5d29  t_hash_file())])
+00011a00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00011a10: 2020 2020 2020 2020 2069 6620 6e6f 7420           if not 
+00011a20: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
+00011a30: 2d68 6173 682d 7368 6132 3536 275d 203d  -hash-sha256'] =
+00011a40: 3d20 6861 7368 6573 5b6f 732e 7061 7468  = hashes[os.path
+00011a50: 2e62 6173 656e 616d 6528 696d 6167 6529  .basename(image)
+00011a60: 5d5b 2769 6d61 6765 2d68 6173 682d 7368  ]['image-hash-sh
+00011a70: 6132 3536 275d 3a0a 2020 2020 2020 2020  a256']:.        
+00011a80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011a90: 2020 2020 6966 2072 6169 7365 4578 6365      if raiseExce
+00011aa0: 7074 696f 6e3a 0a20 2020 2020 2020 2020  ption:.         
+00011ab0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011ac0: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+00011ad0: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+00011ae0: 2869 7465 6d2c 2022 696e 636f 7272 6563  (item, "incorrec
+00011af0: 7420 7368 6132 3536 2068 6173 6822 2c20  t sha256 hash", 
+00011b00: 6974 656d 456e 7472 795b 2769 6d61 6765  itemEntry['image
+00011b10: 2d68 6173 682d 7368 6132 3536 275d 2c22  -hash-sha256'],"
+00011b20: 666f 7220 6669 6c65 222c 6669 6c65 4e61  for file",fileNa
+00011b30: 6d65 2c22 2072 756e 2063 7265 6174 655f  me," run create_
+00011b40: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
+00011b50: 6528 2920 6669 7273 7422 290a 2020 2020  e() first").    
+00011b60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b70: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00011b80: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011b90: 2020 2020 2020 2020 2020 2020 2020 6578                ex
+00011ba0: 6365 7074 696f 6e4c 6973 742e 6170 7065  ceptionList.appe
+00011bb0: 6e64 285b 6669 6c65 4e61 6d65 2c22 696e  nd([fileName,"in
+00011bc0: 636f 7272 6563 7420 7368 6132 3536 2068  correct sha256 h
+00011bd0: 6173 6822 5d29 0a20 2020 2020 2020 2020  ash"]).         
+00011be0: 2020 2020 2020 2020 2020 2065 6c69 6620             elif 
+00011bf0: 6e6f 7420 6974 656d 456e 7472 795b 2769  not itemEntry['i
+00011c00: 6d61 6765 2d68 6173 682d 7368 6132 3536  mage-hash-sha256
+00011c10: 275d 203d 3d20 6d69 7174 632e 7368 6132  '] == miqtc.sha2
+00011c20: 3536 4861 7368 4669 6c65 2869 6d61 6765  56HashFile(image
+00011c30: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+00011c40: 2020 2020 2020 2020 2020 2069 6620 7261             if ra
+00011c50: 6973 6545 7863 6570 7469 6f6e 3a0a 2020  iseException:.  
+00011c60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011c70: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
+00011c80: 6d69 7174 632e 4966 646f 4578 6365 7074  miqtc.IfdoExcept
+00011c90: 696f 6e28 6974 656d 2c20 2269 6e63 6f72  ion(item, "incor
+00011ca0: 7265 6374 2073 6861 3235 3620 6861 7368  rect sha256 hash
+00011cb0: 222c 2069 7465 6d45 6e74 7279 5b27 696d  ", itemEntry['im
+00011cc0: 6167 652d 6861 7368 2d73 6861 3235 3627  age-hash-sha256'
+00011cd0: 5d2c 2266 6f72 2066 696c 6522 2c66 696c  ],"for file",fil
+00011ce0: 654e 616d 652c 2220 7275 6e20 6372 6561  eName," run crea
+00011cf0: 7465 5f69 6d61 6765 5f73 6861 3235 365f  te_image_sha256_
+00011d00: 6669 6c65 2829 2066 6972 7374 2229 0a20  file() first"). 
+00011d10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d20: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00011d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00011d40: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
+00011d50: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
+00011d60: 696c 654e 616d 652c 2269 6e63 6f72 7265  ileName,"incorre
+00011d70: 6374 2073 6861 3235 3620 6861 7368 225d  ct sha256 hash"]
+00011d80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00011d90: 2020 2020 2020 6272 6561 6b0a 2020 2020        break.    
+00011da0: 2020 2020 2020 2020 6966 2066 6f75 6e64          if found
+00011db0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+00011dc0: 2020 6465 6c20 6861 7368 556e 6368 6563    del hashUnchec
+00011dd0: 6b49 6d61 6765 7349 6e52 6177 5b69 6d61  kImagesInRaw[ima
+00011de0: 6765 5d0a 2020 2020 2020 2020 2020 2020  ge].            
+00011df0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00011e00: 2020 2020 2020 6966 2072 6169 7365 4578        if raiseEx
+00011e10: 6365 7074 696f 6e3a 0a20 2020 2020 2020  ception:.       
+00011e20: 2020 2020 2020 2020 2020 2020 2072 6169               rai
+00011e30: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
+00011e40: 6570 7469 6f6e 2820 2269 6d61 6765 222c  eption( "image",
+00011e50: 2069 7465 6d2c 2022 6e6f 7420 666f 756e   item, "not foun
+00011e60: 6420 696e 2064 6972 6563 746f 7279 2773  d in directory's
+00011e70: 2072 6177 2066 6f6c 6465 7221 2229 0a20   raw folder!"). 
+00011e80: 2020 2020 2020 2020 2020 2020 2020 2065                 e
+00011e90: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+00011ea0: 2020 2020 2020 2020 2065 7863 6570 7469           excepti
+00011eb0: 6f6e 4c69 7374 2e61 7070 656e 6428 5b66  onList.append([f
+00011ec0: 696c 654e 616d 652c 2266 696c 6520 6e6f  ileName,"file no
+00011ed0: 7420 666f 756e 6422 5d29 0a20 2020 2020  t found"]).     
+00011ee0: 2020 2070 726f 672e 636c 6561 7228 290a     prog.clear().
+00011ef0: 2020 2020 2020 2020 6966 206e 6f74 2072          if not r
+00011f00: 6169 7365 4578 6365 7074 696f 6e3a 0a20  aiseException:. 
+00011f10: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00011f20: 6e20 6578 6365 7074 696f 6e4c 6973 740a  n exceptionList.
+00011f30: 0a0a 2020 2020 6465 6620 6372 6561 7465  ..    def create
+00011f40: 5f75 7569 645f 6669 6c65 2873 656c 662c  _uuid_file(self,
+00011f50: 636c 6561 6e3d 5472 7565 293a 0a20 2020  clean=True):.   
+00011f60: 2020 2020 2022 2222 2043 7265 6174 6573       """ Creates
+00011f70: 2069 6e20 2f69 6e74 6572 6d65 6469 6174   in /intermediat
+00011f80: 6520 6120 7465 7874 2066 696c 6520 636f  e a text file co
+00011f90: 6e74 6169 6e69 6e67 2070 6572 2069 6d61  ntaining per ima
+00011fa0: 6765 2061 2063 7265 6174 6564 2075 7569  ge a created uui
+00011fb0: 6420 2876 6572 7369 6f6e 2034 292e 0a0a  d (version 4)...
+00011fc0: 2020 2020 2020 2020 5468 6520 5555 4944          The UUID
+00011fd0: 2069 7320 6f6e 6c79 202a 7461 6b65 6e2a   is only *taken*
+00011fe0: 2066 726f 6d20 7468 6520 6d65 7461 6461   from the metada
+00011ff0: 7461 206f 6620 7468 6520 696d 6167 6573  ta of the images
+00012000: 2e20 4974 2064 6f65 7320 6e6f 7420 7772  . It does not wr
+00012010: 6974 6520 5555 4944 7320 746f 2074 6865  ite UUIDs to the
+00012020: 206d 6574 6164 6174 6120 696e 2063 6173   metadata in cas
+00012030: 6520 736f 6d65 2066 696c 6573 2061 7265  e some files are
+00012040: 206d 6973 7369 6e67 2069 742e 0a20 2020   missing it..   
+00012050: 2020 2020 2042 7574 2c20 6974 2063 7265       But, it cre
+00012060: 6174 6573 2061 2043 5356 2066 696c 6520  ates a CSV file 
+00012070: 696e 2074 6861 7420 6361 7365 2074 6861  in that case tha
+00012080: 7420 796f 7520 6361 6e20 7573 6520 746f  t you can use to
+00012090: 6765 7468 6572 2077 6974 6820 6578 6966  gether with exif
+000120a0: 746f 6f6c 2074 6f20 6164 6420 7468 6520  tool to add the 
+000120b0: 5555 4944 2074 6f20 796f 7572 2064 6174  UUID to your dat
+000120c0: 612e 2042 6577 6172 6521 2074 6869 7320  a. Beware! this 
+000120d0: 6361 6e20 6465 7374 726f 7920 796f 7572  can destroy your
+000120e0: 2069 6d61 6765 730a 2020 2020 2020 2020   images.        
+000120f0: 6966 206e 6f74 2064 6f6e 6520 7072 6f70  if not done prop
+00012100: 6572 6c79 2120 4e6f 2067 7561 7261 6e74  erly! No guarant
+00012110: 6565 2069 7320 6769 7665 6e20 6974 2077  ee is given it w
+00012120: 696c 6c20 776f 726b 2e20 4265 2063 6172  ill work. Be car
+00012130: 6566 756c 210a 0a20 2020 2020 2020 2055  eful!..        U
+00012140: 7365 2063 6c65 616e 3d46 616c 7365 2074  se clean=False t
+00012150: 6f20 6e6f 7420 6368 6563 6b20 7468 6f73  o not check thos
+00012160: 6520 6669 6c65 7320 6167 6169 6e20 7768  e files again wh
+00012170: 6963 6820 6172 6520 616c 7265 6164 7920  ich are already 
+00012180: 666f 756e 6420 696e 2069 6e74 6572 6d65  found in interme
+00012190: 6469 6174 6520 7575 6964 2066 696c 650a  diate uuid file.
+000121a0: 2020 2020 2020 2020 2222 220a 0a20 2020          """..   
+000121b0: 2020 2020 2075 7569 6473 203d 207b 7d0a       uuids = {}.
+000121c0: 2020 2020 2020 2020 2320 4368 6563 6b20          # Check 
+000121d0: 7768 6574 6865 7220 6120 6669 6c65 2077  whether a file w
+000121e0: 6974 6820 5555 4944 7320 6578 6973 7473  ith UUIDs exists
+000121f0: 2c20 7468 656e 2072 6561 6420 6974 0a20  , then read it. 
+00012200: 2020 2020 2020 2069 6620 6e6f 7420 636c         if not cl
+00012210: 6561 6e20 616e 6420 6f73 2e70 6174 682e  ean and os.path.
+00012220: 6578 6973 7473 2873 656c 662e 6765 745f  exists(self.get_
+00012230: 696e 745f 7575 6964 5f66 696c 6528 2929  int_uuid_file())
+00012240: 3a0a 2020 2020 2020 2020 2020 2020 7575  :.            uu
+00012250: 6964 7320 3d20 6d69 7174 662e 7461 6246  ids = miqtf.tabF
+00012260: 696c 6544 6174 6128 7365 6c66 2e67 6574  ileData(self.get
+00012270: 5f69 6e74 5f75 7569 645f 6669 6c65 2829  _int_uuid_file()
+00012280: 2c20 5b6d 6971 7476 2e63 6f6c 5f68 6561  , [miqtv.col_hea
+00012290: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+000122a0: 6d67 275d 2c20 6d69 7174 762e 636f 6c5f  mg'], miqtv.col_
+000122b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000122c0: 5b27 7575 6964 275d 5d2c 206b 6579 5f63  ['uuid']], key_c
+000122d0: 6f6c 3d6d 6971 7476 2e63 6f6c 5f68 6561  ol=miqtv.col_hea
+000122e0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+000122f0: 6d67 275d 290a 2020 2020 2020 2020 2020  mg']).          
+00012300: 2020 0a20 2020 2020 2020 2069 6620 6f73    .        if os
+00012310: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
+00012320: 662e 696d 6167 6573 4469 7229 3a0a 0a20  f.imagesDir):.. 
+00012330: 2020 2020 2020 2020 2020 206d 6973 7369             missi
+00012340: 6e67 5f75 7569 6473 203d 207b 7d0a 2020  ng_uuids = {}.  
+00012350: 2020 2020 2020 2020 2020 6164 6465 645f            added_
+00012360: 7575 6964 7320 3d20 300a 0a20 2020 2020  uuids = 0..     
+00012370: 2020 2020 2020 2075 6e6b 6e6f 776e 4669         unknownFi
+00012380: 6c65 7320 3d20 5b5d 0a20 2020 2020 2020  les = [].       
+00012390: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
+000123a0: 2073 656c 662e 696d 6167 6573 496e 496d   self.imagesInIm
+000123b0: 6167 6573 4469 7228 293a 0a20 2020 2020  agesDir():.     
+000123c0: 2020 2020 2020 2020 2020 2066 696c 655f             file_
+000123d0: 6e61 6d65 203d 206f 732e 7061 7468 2e62  name = os.path.b
+000123e0: 6173 656e 616d 6528 6669 6c65 290a 2020  asename(file).  
+000123f0: 2020 2020 2020 2020 2020 2020 2020 6966                if
+00012400: 2066 696c 655f 6e61 6d65 206e 6f74 2069   file_name not i
+00012410: 6e20 7575 6964 733a 0a20 2020 2020 2020  n uuids:.       
+00012420: 2020 2020 2020 2020 2020 2020 2075 6e6b               unk
+00012430: 6e6f 776e 4669 6c65 732e 6170 7065 6e64  nownFiles.append
+00012440: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
+00012450: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+00012460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012470: 2075 7569 6473 5b66 696c 655f 6e61 6d65   uuids[file_name
+00012480: 5d20 3d20 7575 6964 735b 6669 6c65 5f6e  ] = uuids[file_n
+00012490: 616d 655d 5b6d 6971 7476 2e63 6f6c 5f68  ame][miqtv.col_h
+000124a0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000124b0: 2775 7569 6427 5d5d 0a0a 2020 2020 2020  'uuid']]..      
+000124c0: 2020 2020 2020 756e 6b6e 6f77 6e46 696c        unknownFil
+000124d0: 6573 5555 4944 7320 3d20 6d69 7174 692e  esUUIDs = miqti.
+000124e0: 696d 6167 6573 436f 6e74 6169 6e56 616c  imagesContainVal
+000124f0: 6964 5555 4944 2875 6e6b 6e6f 776e 4669  idUUID(unknownFi
+00012500: 6c65 7329 0a20 2020 2020 2020 2020 2020  les).           
+00012510: 2066 6f72 2066 696c 6520 696e 2075 6e6b   for file in unk
+00012520: 6e6f 776e 4669 6c65 7355 5549 4473 3a0a  nownFilesUUIDs:.
+00012530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012540: 6669 6c65 5f6e 616d 6520 3d20 6f73 2e70  file_name = os.p
+00012550: 6174 682e 6261 7365 6e61 6d65 2866 696c  ath.basename(fil
+00012560: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00012570: 2020 2069 6620 6e6f 7420 756e 6b6e 6f77     if not unknow
+00012580: 6e46 696c 6573 5555 4944 735b 6669 6c65  nFilesUUIDs[file
+00012590: 5d5b 2776 616c 6964 275d 3a0a 2020 2020  ]['valid']:.    
+000125a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000125b0: 7575 6964 203d 206d 6971 7463 2e75 7569  uuid = miqtc.uui
+000125c0: 6434 2829 0a20 2020 2020 2020 2020 2020  d4().           
+000125d0: 2020 2020 2020 2020 206d 6973 7369 6e67           missing
+000125e0: 5f75 7569 6473 5b66 696c 655d 203d 2075  _uuids[file] = u
+000125f0: 7569 640a 2020 2020 2020 2020 2020 2020  uid.            
+00012600: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00012610: 2020 2020 2020 2020 2020 2020 2020 7575                uu
+00012620: 6964 735b 6669 6c65 5f6e 616d 655d 203d  ids[file_name] =
+00012630: 2075 6e6b 6e6f 776e 4669 6c65 7355 5549   unknownFilesUUI
+00012640: 4473 5b66 696c 655d 5b27 7575 6964 275d  Ds[file]['uuid']
+00012650: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00012660: 2020 2020 2061 6464 6564 5f75 7569 6473       added_uuids
+00012670: 202b 3d20 310a 0a20 2020 2020 2020 2020   += 1..         
+00012680: 2020 2023 2049 6620 7072 6576 696f 7573     # If previous
+00012690: 6c79 2075 6e6b 6e6f 776e 2055 5549 4473  ly unknown UUIDs
+000126a0: 2077 6572 6520 666f 756e 6420 696e 2074   were found in t
+000126b0: 6865 2066 696c 6520 6865 6164 6572 732c  he file headers,
+000126c0: 2061 6464 2074 6865 6d20 746f 2074 6865   add them to the
+000126d0: 2055 5549 4420 6669 6c65 0a20 2020 2020   UUID file.     
+000126e0: 2020 2020 2020 2069 6620 6164 6465 645f         if added_
+000126f0: 7575 6964 7320 3e20 303a 0a20 2020 2020  uuids > 0:.     
+00012700: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00012710: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
+00012720: 6e74 5f75 7569 645f 6669 6c65 2829 2c20  nt_uuid_file(), 
+00012730: 2277 2229 0a20 2020 2020 2020 2020 2020  "w").           
+00012740: 2020 2020 2072 6573 2e77 7269 7465 286d       res.write(m
+00012750: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00012760: 276d 6172 6971 7427 5d5b 2769 6d67 275d  'mariqt']['img']
+00012770: 202b 225c 7422 2b6d 6971 7476 2e63 6f6c   +"\t"+miqtv.col
+00012780: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00012790: 5d5b 2775 7569 6427 5d2b 225c 6e22 290a  ]['uuid']+"\n").
+000127a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000127b0: 666f 7220 6669 6c65 2069 6e20 7575 6964  for file in uuid
+000127c0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+000127d0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+000127e0: 2866 696c 652b 225c 7422 2b73 7472 2875  (file+"\t"+str(u
+000127f0: 7569 6473 5b66 696c 655d 292b 225c 6e22  uids[file])+"\n"
+00012800: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012810: 2020 7265 732e 636c 6f73 6528 290a 0a20    res.close().. 
+00012820: 2020 2020 2020 2020 2020 2069 6620 6c65             if le
+00012830: 6e28 6d69 7373 696e 675f 7575 6964 7329  n(missing_uuids)
+00012840: 203e 2030 3a0a 2020 2020 2020 2020 2020   > 0:.          
+00012850: 2020 2020 2020 6563 7376 5f70 6174 6820        ecsv_path 
+00012860: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
+00012870: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+00012880: 2022 5f65 7869 662d 6164 642d 7575 6964   "_exif-add-uuid
+00012890: 2e63 7376 220a 2020 2020 2020 2020 2020  .csv".          
+000128a0: 2020 2020 2020 6373 7620 3d20 6f70 656e        csv = open
+000128b0: 2865 6373 765f 7061 7468 2c20 2277 2229  (ecsv_path, "w")
+000128c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000128d0: 2063 7376 2e77 7269 7465 286d 6971 7476   csv.write(miqtv
+000128e0: 2e63 6f6c 5f68 6561 6465 725b 2765 7869  .col_header['exi
+000128f0: 6627 5d5b 2769 6d67 275d 202b 0a20 2020  f']['img'] +.   
+00012900: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012910: 2020 2020 2020 2022 2c22 2b6d 6971 7476         ","+miqtv
+00012920: 2e63 6f6c 5f68 6561 6465 725b 2765 7869  .col_header['exi
+00012930: 6627 5d5b 2775 7569 6427 5d2b 225c 6e22  f']['uuid']+"\n"
+00012940: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00012950: 2020 6469 6666 6572 656e 745f 7061 7468    different_path
+00012960: 7320 3d20 5b5d 0a20 2020 2020 2020 2020  s = [].         
+00012970: 2020 2020 2020 2066 6f72 2069 6d67 2069         for img i
+00012980: 6e20 6d69 7373 696e 675f 7575 6964 733a  n missing_uuids:
+00012990: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000129a0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
+000129b0: 6261 7365 6e61 6d65 2869 6d67 2920 6e6f  basename(img) no
+000129c0: 7420 696e 2064 6966 6665 7265 6e74 5f70  t in different_p
+000129d0: 6174 6873 3a0a 2020 2020 2020 2020 2020  aths:.          
+000129e0: 2020 2020 2020 2020 2020 2020 2020 6469                di
+000129f0: 6666 6572 656e 745f 7061 7468 732e 6170  fferent_paths.ap
+00012a00: 7065 6e64 286f 732e 7061 7468 2e62 6173  pend(os.path.bas
+00012a10: 656e 616d 6528 696d 6729 290a 2020 2020  ename(img)).    
+00012a20: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a30: 6373 762e 7772 6974 6528 696d 672b 222c  csv.write(img+",
+00012a40: 222b 7374 7228 6d69 7373 696e 675f 7575  "+str(missing_uu
+00012a50: 6964 735b 696d 675d 292b 225c 6e22 290a  ids[img])+"\n").
+00012a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00012a70: 2372 6574 7572 6e20 4661 6c73 652c 2022  #return False, "
+00012a80: 6578 6966 746f 6f6c 202d 6373 763d 222b  exiftool -csv="+
+00012a90: 6563 7376 5f70 6174 682b 2220 222b 2220  ecsv_path+" "+" 
+00012aa0: 222e 6a6f 696e 2864 6966 6665 7265 6e74  ".join(different
+00012ab0: 5f70 6174 6873 290a 2020 2020 2020 2020  _paths).        
+00012ac0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+00012ad0: 616c 7365 2c20 224e 6f74 2061 6c6c 2069  alse, "Not all i
+00012ae0: 6d61 6765 7320 6861 7665 2076 616c 6964  mages have valid
+00012af0: 2055 5549 4473 2e20 4d69 7373 696e 6720   UUIDs. Missing 
+00012b00: 666f 7220 666f 6c6c 6f77 696e 6720 6669  for following fi
+00012b10: 6c65 733a 5c6e 222b 225c c586 222e 6a6f  les:\n"+"\..".jo
+00012b20: 696e 2864 6966 6665 7265 6e74 5f70 6174  in(different_pat
+00012b30: 6873 290a 2020 2020 2020 2020 2020 2020  hs).            
+00012b40: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+00012b50: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
+00012b60: 6b65 6420 3d20 5472 7565 0a20 2020 2020  ked = True.     
+00012b70: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00012b80: 7565 2c20 2241 6c6c 2069 6d61 6765 7320  ue, "All images 
+00012b90: 6861 7665 2061 2055 5549 4422 0a20 2020  have a UUID".   
+00012ba0: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00012bb0: 652c 2022 5061 7468 2022 2b73 656c 662e  e, "Path "+self.
+00012bc0: 696d 6167 6573 4469 7220 2b20 2220 6e6f  imagesDir + " no
+00012bd0: 7420 666f 756e 642e 220a 0a20 2020 2064  t found."..    d
+00012be0: 6566 2063 7265 6174 6555 5549 4446 696c  ef createUUIDFil
+00012bf0: 6528 7365 6c66 2c63 6c65 616e 3d54 7275  e(self,clean=Tru
+00012c00: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+00012c10: 4465 7072 6563 6174 6564 202d 2075 7365  Deprecated - use
+00012c20: 2063 7265 6174 655f 7575 6964 5f66 696c   create_uuid_fil
+00012c30: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
+00012c40: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
+00012c50: 5f75 7569 645f 6669 6c65 2863 6c65 616e  _uuid_file(clean
+00012c60: 290a 0a0a 2020 2020 6465 6620 7365 745f  )...    def set_
+00012c70: 696d 6167 655f 7365 745f 6174 7469 7475  image_set_attitu
+00012c80: 6465 2873 656c 662c 7961 775f 6672 616d  de(self,yaw_fram
+00012c90: 653a 666c 6f61 742c 7069 7463 685f 6672  e:float,pitch_fr
+00012ca0: 616d 653a 666c 6f61 742c 726f 6c6c 5f66  ame:float,roll_f
+00012cb0: 7261 6d65 3a66 6c6f 6174 2c79 6177 5f63  rame:float,yaw_c
+00012cc0: 616d 3266 7261 6d65 3a66 6c6f 6174 2c70  am2frame:float,p
+00012cd0: 6974 6368 5f63 616d 3266 7261 6d65 3a66  itch_cam2frame:f
+00012ce0: 6c6f 6174 2c72 6f6c 6c5f 6361 6d32 6672  loat,roll_cam2fr
+00012cf0: 616d 653a 666c 6f61 7429 3a0a 2020 2020  ame:float):.    
+00012d00: 2020 2020 2222 2220 6361 6c63 756c 6174      """ calculat
+00012d10: 6573 2074 6865 2074 6865 2063 616d 6572  es the the camer
+00012d20: 6173 2061 6273 6f6c 7574 6520 6174 7469  as absolute atti
+00012d30: 7475 6465 2061 6e64 2073 6574 7320 6974  tude and sets it
+00012d40: 2074 6f20 696d 6167 6520 7365 7420 6865   to image set he
+00012d50: 6164 6572 2e20 416c 6c20 616e 676c 6573  ader. All angles
+00012d60: 2061 7265 2065 7870 6563 7465 6420 696e   are expected in
+00012d70: 2064 6567 7265 6573 2e20 0a20 2020 2020   degrees. .     
+00012d80: 2020 2063 616d 6572 6132 6672 616d 6520     camera2frame 
+00012d90: 616e 676c 6573 3a20 726f 7461 7469 6f6e  angles: rotation
+00012da0: 206f 6620 6361 6d65 7261 2063 6f6f 7264   of camera coord
+00012db0: 696e 6174 6573 2028 782c 792c 7a20 3d20  inates (x,y,z = 
+00012dc0: 746f 702c 2072 6967 6874 2c20 6c69 6e65  top, right, line
+00012dd0: 206f 6620 7369 6768 7429 2077 6974 6820   of sight) with 
+00012de0: 7265 7370 6563 7420 746f 2076 6568 6963  respect to vehic
+00012df0: 6c65 2063 6f6f 7264 696e 6174 6573 2028  le coordinates (
+00012e00: 782c 792c 7a20 3d20 666f 7277 6172 642c  x,y,z = forward,
+00012e10: 7269 6768 742c 646f 776e 2920 0a20 2020  right,down) .   
+00012e20: 2020 2020 2069 6e20 6163 636f 7264 616e       in accordan
+00012e30: 6365 2077 6974 6820 7468 6520 7961 772c  ce with the yaw,
+00012e40: 7069 7463 682c 726f 6c6c 2072 6f74 6174  pitch,roll rotat
+00012e50: 696f 6e20 6f72 6465 7220 636f 6e76 656e  ion order conven
+00012e60: 7469 6f6e 3a0a 0a20 2020 2020 2020 2031  tion:..        1
+00012e70: 2e20 7961 7720 6172 6f75 6e64 207a 2c0a  . yaw around z,.
+00012e80: 2020 2020 2020 2020 322e 2070 6974 6368          2. pitch
+00012e90: 2061 726f 756e 6420 726f 7461 7465 6420   around rotated 
+00012ea0: 792c 0a20 2020 2020 2020 2033 2e20 726f  y,.        3. ro
+00012eb0: 6c6c 2061 726f 756e 6420 726f 7461 7465  ll around rotate
+00012ec0: 6420 780a 0a20 2020 2020 2020 2052 6f74  d x..        Rot
+00012ed0: 6174 696f 6e20 6469 7265 6374 696f 6e73  ation directions
+00012ee0: 2061 6363 6f72 6469 6e67 2074 6f20 5c27   according to \'
+00012ef0: 7269 6768 742d 6861 6e64 2072 756c 655c  right-hand rule\
+00012f00: 272e 0a0a 2020 2020 2020 2020 492e 652e  '...        I.e.
+00012f10: 2063 616d 6572 6132 4672 616d 6520 616e   camera2Frame an
+00012f20: 676c 6573 203d 2030 2c30 2c30 2063 616d  gles = 0,0,0 cam
+00012f30: 6572 6120 6973 2066 6163 696e 6720 646f  era is facing do
+00012f40: 776e 7761 7264 2077 6974 6820 746f 7020  wnward with top 
+00012f50: 7369 6465 2074 6f77 6172 6473 2076 6568  side towards veh
+00012f60: 6963 6c65 2773 2066 6f72 7761 7264 2064  icle's forward d
+00012f70: 6972 6563 7469 6f6e 2720 2222 220a 0a20  irection' """.. 
+00012f80: 2020 2020 2020 2052 5f66 7261 6d65 326e         R_frame2n
+00012f90: 6564 203d 206d 6971 7467 2e52 5f59 6177  ed = miqtg.R_Yaw
+00012fa0: 5069 7463 6852 6f6c 6c28 7961 775f 6672  PitchRoll(yaw_fr
+00012fb0: 616d 652c 7069 7463 685f 6672 616d 652c  ame,pitch_frame,
+00012fc0: 726f 6c6c 5f66 7261 6d65 290a 2020 2020  roll_frame).    
+00012fd0: 2020 2020 525f 6361 6d32 6672 616d 6520      R_cam2frame 
+00012fe0: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
+00012ff0: 6368 526f 6c6c 2879 6177 5f63 616d 3266  chRoll(yaw_cam2f
+00013000: 7261 6d65 2c70 6974 6368 5f63 616d 3266  rame,pitch_cam2f
+00013010: 7261 6d65 2c72 6f6c 6c5f 6361 6d32 6672  rame,roll_cam2fr
+00013020: 616d 6529 0a20 2020 2020 2020 2052 5f63  ame).        R_c
+00013030: 616d 326e 6564 203d 2052 5f66 7261 6d65  am2ned = R_frame
+00013040: 326e 6564 2e64 6f74 2852 5f63 616d 3266  2ned.dot(R_cam2f
+00013050: 7261 6d65 290a 2020 2020 2020 2020 7961  rame).        ya
+00013060: 772c 7069 7463 682c 726f 6c6c 203d 206d  w,pitch,roll = m
+00013070: 6971 7467 2e79 6177 5069 7463 6852 6f6c  iqtg.yawPitchRol
+00013080: 6c28 525f 6361 6d32 6e65 6429 0a0a 2020  l(R_cam2ned)..  
+00013090: 2020 2020 2020 2320 706f 7365 206d 6174        # pose mat
+000130a0: 7269 7820 6361 6d32 7574 6d0a 2020 2020  rix cam2utm.    
+000130b0: 2020 2020 525f 6361 6d53 7464 3275 746d      R_camStd2utm
+000130c0: 203d 2073 656c 662e 6765 745f 525f 6361   = self.get_R_ca
+000130d0: 6d53 7464 3275 746d 2852 5f63 616d 3266  mStd2utm(R_cam2f
+000130e0: 7261 6d65 2c52 5f66 7261 6d65 326e 6564  rame,R_frame2ned
+000130f0: 290a 0a20 2020 2020 2020 2022 2222 0a20  )..        """. 
+00013100: 2020 2020 2020 2078 203d 206e 702e 6172         x = np.ar
+00013110: 7261 7928 5b31 2c30 2c30 5d29 0a20 2020  ray([1,0,0]).   
+00013120: 2020 2020 2079 203d 206e 702e 6172 7261       y = np.arra
+00013130: 7928 5b30 2c31 2c30 5d29 0a20 2020 2020  y([0,1,0]).     
+00013140: 2020 207a 203d 206e 702e 6172 7261 7928     z = np.array(
+00013150: 5b30 2c30 2c31 5d29 0a20 2020 2020 2020  [0,0,1]).       
+00013160: 2070 7269 6e74 2827 7827 2c52 5f63 616d   print('x',R_cam
+00013170: 5374 6432 7574 6d2e 646f 7428 7829 2e72  Std2utm.dot(x).r
+00013180: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
+00013190: 2070 7269 6e74 2827 7927 2c52 5f63 616d   print('y',R_cam
+000131a0: 5374 6432 7574 6d2e 646f 7428 7929 2e72  Std2utm.dot(y).r
+000131b0: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
+000131c0: 2070 7269 6e74 2827 7a27 2c52 5f63 616d   print('z',R_cam
+000131d0: 5374 6432 7574 6d2e 646f 7428 7a29 2e72  Std2utm.dot(z).r
+000131e0: 6f75 6e64 2835 2929 0a20 2020 2020 2020  ound(5)).       
+000131f0: 2022 2222 0a0a 2020 2020 2020 2020 6865   """..        he
+00013200: 6164 6572 5570 6461 7465 203d 207b 0a20  aderUpdate = {. 
+00013210: 2020 2020 2020 2020 2020 206d 6971 7476             miqtv
+00013220: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+00013230: 6971 7427 5d5b 2779 6177 275d 3a79 6177  iqt']['yaw']:yaw
+00013240: 2c0a 2020 2020 2020 2020 2020 2020 6d69  ,.            mi
+00013250: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00013260: 6d61 7269 7174 275d 5b27 7069 7463 6827  mariqt']['pitch'
+00013270: 5d3a 7069 7463 682c 0a20 2020 2020 2020  ]:pitch,.       
+00013280: 2020 2020 206d 6971 7476 2e63 6f6c 5f68       miqtv.col_h
+00013290: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+000132a0: 2772 6f6c 6c27 5d3a 726f 6c6c 2c0a 2020  'roll']:roll,.  
+000132b0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+000132c0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+000132d0: 7174 275d 5b27 706f 7365 275d 3a7b 2770  qt']['pose']:{'p
+000132e0: 6f73 652d 6162 736f 6c75 7465 2d6f 7269  ose-absolute-ori
+000132f0: 656e 7461 7469 6f6e 2d75 746d 2d6d 6174  entation-utm-mat
+00013300: 7269 7827 3a52 5f63 616d 5374 6432 7574  rix':R_camStd2ut
+00013310: 6d2e 666c 6174 7465 6e28 292e 746f 6c69  m.flatten().toli
+00013320: 7374 2829 7d0a 2020 2020 2020 2020 7d0a  st()}.        }.
+00013330: 2020 2020 2020 2020 7365 6c66 2e75 7064          self.upd
+00013340: 6174 655f 6966 646f 5f68 6561 6465 725f  ate_ifdo_header_
+00013350: 6669 656c 6473 2868 6561 6465 7255 7064  fields(headerUpd
+00013360: 6174 6529 0a0a 2020 2020 6465 6620 7365  ate)..    def se
+00013370: 7449 6d61 6765 5365 7441 7474 6974 7564  tImageSetAttitud
+00013380: 6528 7365 6c66 2c79 6177 5f66 7261 6d65  e(self,yaw_frame
+00013390: 3a66 6c6f 6174 2c70 6974 6368 5f66 7261  :float,pitch_fra
+000133a0: 6d65 3a66 6c6f 6174 2c72 6f6c 6c5f 6672  me:float,roll_fr
+000133b0: 616d 653a 666c 6f61 742c 7961 775f 6361  ame:float,yaw_ca
+000133c0: 6d32 6672 616d 653a 666c 6f61 742c 7069  m2frame:float,pi
+000133d0: 7463 685f 6361 6d32 6672 616d 653a 666c  tch_cam2frame:fl
+000133e0: 6f61 742c 726f 6c6c 5f63 616d 3266 7261  oat,roll_cam2fra
+000133f0: 6d65 3a66 6c6f 6174 293a 0a20 2020 2020  me:float):.     
+00013400: 2020 2022 2222 2044 6570 7265 6361 7465     """ Deprecate
+00013410: 6420 2d20 7573 6520 7365 745f 696d 6167  d - use set_imag
+00013420: 655f 7365 745f 6174 7469 7475 6465 2022  e_set_attitude "
+00013430: 2222 0a20 2020 2020 2020 2073 656c 662e  "".        self.
+00013440: 7365 745f 696d 6167 655f 7365 745f 6174  set_image_set_at
+00013450: 7469 7475 6465 2879 6177 5f66 7261 6d65  titude(yaw_frame
+00013460: 2c20 7069 7463 685f 6672 616d 652c 2072  , pitch_frame, r
+00013470: 6f6c 6c5f 6672 616d 652c 2079 6177 5f63  oll_frame, yaw_c
+00013480: 616d 3266 7261 6d65 2c20 7069 7463 685f  am2frame, pitch_
+00013490: 6361 6d32 6672 616d 652c 2072 6f6c 6c5f  cam2frame, roll_
+000134a0: 6361 6d32 6672 616d 6529 0a0a 0a20 2020  cam2frame)...   
+000134b0: 2064 6566 2063 7265 6174 655f 696d 6167   def create_imag
+000134c0: 655f 6174 7469 7475 6465 5f66 696c 6528  e_attitude_file(
+000134d0: 7365 6c66 2c20 6174 745f 7061 7468 3a73  self, att_path:s
+000134e0: 7472 2c20 6672 616d 655f 6174 745f 6865  tr, frame_att_he
+000134f0: 6164 6572 3a64 6963 742c 2063 616d 6572  ader:dict, camer
+00013500: 6132 4672 616d 655f 7961 773a 666c 6f61  a2Frame_yaw:floa
+00013510: 742c 6361 6d65 7261 3246 7261 6d65 5f70  t,camera2Frame_p
+00013520: 6974 6368 3a66 6c6f 6174 2c63 616d 6572  itch:float,camer
+00013530: 6132 4672 616d 655f 726f 6c6c 3a66 6c6f  a2Frame_roll:flo
+00013540: 6174 2c0a 2020 2020 2020 2020 2020 2020  at,.            
+00013550: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013560: 2020 2020 6461 7465 5f66 6f72 6d61 743d      date_format=
+00013570: 6d69 7174 762e 6461 7465 5f66 6f72 6d61  miqtv.date_forma
+00013580: 7473 5b27 7061 6e67 6165 6127 5d2c 2063  ts['pangaea'], c
+00013590: 6f6e 7374 5f76 616c 7565 7320 3d20 7b7d  onst_values = {}
+000135a0: 2c20 6f76 6572 7772 6974 653d 4661 6c73  , overwrite=Fals
+000135b0: 652c 2063 6f6c 5f73 6570 6172 6174 6f72  e, col_separator
+000135c0: 203d 2022 5c74 222c 0a20 2020 2020 2020   = "\t",.       
+000135d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000135e0: 2020 2020 2020 2020 2061 7474 5f70 6174           att_pat
+000135f0: 685f 616e 676c 6573 5f69 6e5f 7261 6420  h_angles_in_rad 
+00013600: 3d20 4661 6c73 652c 2076 6964 656f 5361  = False, videoSa
+00013610: 6d70 6c65 5365 636f 6e64 733d 312c 7265  mpleSeconds=1,re
+00013620: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+00013630: 3d5b 5d29 3a0a 2020 2020 2020 2020 2222  =[]):.        ""
+00013640: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+00013650: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00013660: 7420 6669 6c65 2077 6974 6820 6361 6d65  t file with came
+00013670: 7261 2061 7474 6974 7564 6520 6461 7461  ra attitude data
+00013680: 2066 6f72 2065 6163 6820 696d 6167 652e   for each image.
+00013690: 2041 6c6c 2061 6e67 6c65 7320 6172 6520   All angles are 
+000136a0: 6578 7065 6374 6564 2069 6e20 6465 6772  expected in degr
+000136b0: 6565 732e 2055 7365 2061 7474 5f70 6174  ees. Use att_pat
+000136c0: 685f 616e 676c 6573 5f69 6e5f 7261 6420  h_angles_in_rad 
+000136d0: 6966 206e 6563 6573 7361 7279 2e20 0a20  if necessary. . 
+000136e0: 2020 2020 2020 2063 616d 6572 6132 4672         camera2Fr
+000136f0: 616d 6520 616e 676c 6573 3a20 726f 7461  ame angles: rota
+00013700: 7469 6f6e 206f 6620 6361 6d65 7261 2063  tion of camera c
+00013710: 6f6f 7264 696e 6174 6573 2028 782c 792c  oordinates (x,y,
+00013720: 7a20 3d20 746f 702c 2072 6967 6874 2c20  z = top, right, 
+00013730: 6c69 6e65 206f 6620 7369 6768 7429 2077  line of sight) w
+00013740: 6974 6820 7265 7370 6563 7420 746f 2076  ith respect to v
+00013750: 6568 6963 6c65 2063 6f6f 7264 696e 6174  ehicle coordinat
+00013760: 6573 2028 782c 792c 7a20 3d20 666f 7277  es (x,y,z = forw
+00013770: 6172 642c 7269 6768 742c 646f 776e 2920  ard,right,down) 
+00013780: 0a20 2020 2020 2020 2069 6e20 6163 636f  .        in acco
+00013790: 7264 616e 6365 2077 6974 6820 7468 6520  rdance with the 
+000137a0: 7961 772c 7069 7463 682c 726f 6c6c 2072  yaw,pitch,roll r
+000137b0: 6f74 6174 696f 6e20 6f72 6465 7220 636f  otation order co
+000137c0: 6e76 656e 7469 6f6e 3a0a 2020 2020 2020  nvention:.      
+000137d0: 2020 312e 2079 6177 2061 726f 756e 6420    1. yaw around 
+000137e0: 7a2c 0a20 2020 2020 2020 2032 2e20 7069  z,.        2. pi
+000137f0: 7463 6820 6172 6f75 6e64 2072 6f74 6174  tch around rotat
+00013800: 6564 2079 2c0a 2020 2020 2020 2020 332e  ed y,.        3.
+00013810: 2072 6f6c 6c20 6172 6f75 6e64 2072 6f74   roll around rot
+00013820: 6174 6564 2078 0a0a 2020 2020 2020 2020  ated x..        
+00013830: 526f 7461 7469 6f6e 2064 6972 6563 7469  Rotation directi
+00013840: 6f6e 7320 6163 636f 7264 696e 6720 746f  ons according to
+00013850: 205c 2772 6967 6874 2d68 616e 6420 7275   \'right-hand ru
+00013860: 6c65 5c27 2e0a 0a20 2020 2020 2020 2049  le\'...        I
+00013870: 2e65 2e20 6361 6d65 7261 3246 7261 6d65  .e. camera2Frame
+00013880: 2061 6e67 6c65 7320 3d20 302c 302c 3020   angles = 0,0,0 
+00013890: 6361 6d65 7261 2069 7320 6661 6369 6e67  camera is facing
+000138a0: 2064 6f77 6e77 6172 6420 7769 7468 2074   downward with t
+000138b0: 6f70 2073 6964 6520 746f 7761 7264 7320  op side towards 
+000138c0: 7665 6869 636c 6527 7320 666f 7277 6172  vehicle's forwar
+000138d0: 6420 6469 7265 6374 696f 6e27 2022 2222  d direction' """
+000138e0: 0a0a 2020 2020 2020 2020 696e 745f 6174  ..        int_at
+000138f0: 7475 7475 6465 5f66 696c 6520 3d20 7365  tutude_file = se
+00013900: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
+00013910: 655f 7072 6566 6978 2829 202b 2027 5f69  e_prefix() + '_i
+00013920: 6d61 6765 2d61 7474 6974 7564 652e 7478  mage-attitude.tx
+00013930: 7427 0a20 2020 2020 2020 206f 7574 7075  t'.        outpu
+00013940: 745f 6865 6164 6572 5f61 7474 203d 207b  t_header_att = {
+00013950: 2020 206d 6971 7476 2e63 6f6c 5f68 6561     miqtv.col_hea
+00013960: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+00013970: 6d67 275d 3a20 206d 6971 7476 2e63 6f6c  mg']:  miqtv.col
+00013980: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00013990: 5d5b 2769 6d67 275d 2c0a 2020 2020 2020  ]['img'],.      
 000139a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000139b0: 2020 7d0a 0a20 2020 2020 2020 2069 6e74    }..        int
-000139c0: 5f70 6f73 655f 6669 6c65 203d 2073 656c  _pose_file = sel
-000139d0: 662e 5f5f 6765 745f 696e 745f 6669 6c65  f.__get_int_file
-000139e0: 5f70 7265 6669 7828 2920 2b20 275f 696d  _prefix() + '_im
-000139f0: 6167 652d 6361 6d65 7261 2d70 6f73 652e  age-camera-pose.
-00013a00: 7478 7427 0a20 2020 2020 2020 206f 7574  txt'.        out
-00013a10: 7075 745f 6865 6164 6572 5f70 6f73 6520  put_header_pose 
-00013a20: 3d20 7b20 206d 6971 7476 2e63 6f6c 5f68  = {  miqtv.col_h
-00013a30: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00013a40: 2769 6d67 275d 3a6d 6971 7476 2e63 6f6c  'img']:miqtv.col
-00013a50: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00013a60: 5d5b 2769 6d67 275d 2c0a 2020 2020 2020  ]['img'],.      
+000139b0: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
+000139c0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+000139d0: 7174 275d 5b27 7574 6327 5d3a 6d69 7174  qt']['utc']:miqt
+000139e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000139f0: 7269 7174 275d 5b27 7574 6327 5d2c 0a20  riqt']['utc'],. 
+00013a00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013a10: 2020 2020 2020 2020 2020 2020 2020 206d                 m
+00013a20: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+00013a30: 276d 6172 6971 7427 5d5b 2779 6177 275d  'mariqt']['yaw']
+00013a40: 3a6d 6971 7476 2e63 6f6c 5f68 6561 6465  :miqtv.col_heade
+00013a50: 725b 276d 6172 6971 7427 5d5b 2779 6177  r['mariqt']['yaw
+00013a60: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
 00013a70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013a80: 2020 2020 2020 2020 2020 6d69 7174 762e            miqtv.
-00013a90: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00013aa0: 7174 275d 5b27 7574 6327 5d3a 6d69 7174  qt']['utc']:miqt
-00013ab0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00013ac0: 7269 7174 275d 5b27 7574 6327 5d2c 0a20  riqt']['utc'],. 
+00013a80: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
+00013a90: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+00013aa0: 7069 7463 6827 5d3a 6d69 7174 762e 636f  pitch']:miqtv.co
+00013ab0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00013ac0: 275d 5b27 7069 7463 6827 5d2c 0a20 2020  ']['pitch'],.   
 00013ad0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013ae0: 2020 2020 2020 2020 2020 2020 2020 206d                 m
-00013af0: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
-00013b00: 276d 6172 6971 7427 5d5b 2770 6f73 6527  'mariqt']['pose'
-00013b10: 5d3a 6d69 7174 762e 636f 6c5f 6865 6164  ]:miqtv.col_head
-00013b20: 6572 5b27 6d61 7269 7174 275d 5b27 706f  er['mariqt']['po
-00013b30: 7365 275d 2c0a 2020 2020 2020 2020 2020  se'],.          
+00013ae0: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+00013af0: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013b00: 6172 6971 7427 5d5b 2772 6f6c 6c27 5d3a  ariqt']['roll']:
+00013b10: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013b20: 5b27 6d61 7269 7174 275d 5b27 726f 6c6c  ['mariqt']['roll
+00013b30: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
 00013b40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013b50: 2020 7d0a 0a20 2020 2020 2020 2069 6620    }..        if 
-00013b60: 6f73 2e70 6174 682e 6578 6973 7473 2869  os.path.exists(i
-00013b70: 6e74 5f61 7474 7574 7564 655f 6669 6c65  nt_attutude_file
-00013b80: 2920 616e 6420 6e6f 7420 6f76 6572 7772  ) and not overwr
-00013b90: 6974 653a 0a20 2020 2020 2020 2020 2020  ite:.           
-00013ba0: 2073 656c 662e 6164 645f 6974 656d 5f69   self.add_item_i
-00013bb0: 6e66 6f5f 7461 625f 6669 6c65 2869 6e74  nfo_tab_file(int
-00013bc0: 5f61 7474 7574 7564 655f 6669 6c65 2c22  _attutude_file,"
-00013bd0: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
-00013be0: 725f 6174 7429 0a20 2020 2020 2020 2020  r_att).         
-00013bf0: 2020 2065 7874 7261 5f6d 7367 203d 2022     extra_msg = "
-00013c00: 220a 2020 2020 2020 2020 2020 2020 6966  ".            if
-00013c10: 206f 732e 7061 7468 2e65 7869 7374 7328   os.path.exists(
-00013c20: 696e 745f 706f 7365 5f66 696c 6529 3a0a  int_pose_file):.
-00013c30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00013c40: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
-00013c50: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
-00013c60: 706f 7365 5f66 696c 652c 225c 7422 2c6f  pose_file,"\t",o
-00013c70: 7574 7075 745f 6865 6164 6572 5f70 6f73  utput_header_pos
-00013c80: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
-00013c90: 2020 2065 7874 7261 5f6d 7367 203d 2022     extra_msg = "
-00013ca0: 2c20 2220 2b20 696e 745f 706f 7365 5f66  , " + int_pose_f
-00013cb0: 696c 650a 2020 2020 2020 2020 2020 2020  ile.            
-00013cc0: 7265 7475 726e 2054 7275 652c 2022 4f75  return True, "Ou
-00013cd0: 7470 7574 2066 696c 6520 6578 6973 7473  tput file exists
-00013ce0: 3a20 222b 696e 745f 6174 7475 7475 6465  : "+int_attutude
-00013cf0: 5f66 696c 6520 2b20 6578 7472 615f 6d73  _file + extra_ms
-00013d00: 670a 0a20 2020 2020 2020 2069 6620 6e6f  g..        if no
-00013d10: 7420 6f73 2e70 6174 682e 6578 6973 7473  t os.path.exists
-00013d20: 2861 7474 5f70 6174 6829 3a0a 2020 2020  (att_path):.    
-00013d30: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00013d40: 616c 7365 2c20 2241 7474 6974 7564 6520  alse, "Attitude 
-00013d50: 6669 6c65 206e 6f74 2066 6f75 6e64 3a20  file not found: 
-00013d60: 222b 6174 745f 7061 7468 0a0a 2020 2020  "+att_path..    
-00013d70: 2020 2020 6966 206e 6f74 206f 732e 7061      if not os.pa
-00013d80: 7468 2e65 7869 7374 7328 7365 6c66 2e69  th.exists(self.i
-00013d90: 6d61 6765 7344 6972 293a 0a20 2020 2020  magesDir):.     
-00013da0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00013db0: 6c73 652c 2022 496d 6167 6520 666f 6c64  lse, "Image fold
-00013dc0: 6572 206e 6f74 2066 6f75 6e64 3a20 222b  er not found: "+
-00013dd0: 2073 656c 662e 696d 6167 6573 4469 720a   self.imagesDir.
-00013de0: 0a20 2020 2020 2020 2073 203d 206d 6971  .        s = miq
-00013df0: 7463 2e50 7269 6e74 4c6f 6164 696e 674d  tc.PrintLoadingM
-00013e00: 7367 2822 4372 6561 7469 6e67 2069 7465  sg("Creating ite
-00013e10: 6d73 2720 6174 7469 7475 6465 2064 6174  ms' attitude dat
-00013e20: 6122 290a 0a20 2020 2020 2020 2023 206c  a")..        # l
-00013e30: 6f61 6420 6672 616d 6520 6174 7469 7475  oad frame attitu
-00013e40: 6465 2064 6174 6120 6672 6f6d 2066 696c  de data from fil
-00013e50: 650a 2020 2020 2020 2020 6174 745f 6461  e.        att_da
-00013e60: 7461 2c20 7061 7273 654d 7367 203d 206d  ta, parseMsg = m
-00013e70: 6971 746e 2e72 6561 6441 6c6c 4174 7469  iqtn.readAllAtti
-00013e80: 7475 6465 7346 726f 6d46 696c 6550 6174  tudesFromFilePat
-00013e90: 6828 6174 745f 7061 7468 2c20 6672 616d  h(att_path, fram
-00013ea0: 655f 6174 745f 6865 6164 6572 2c20 6461  e_att_header, da
-00013eb0: 7465 5f66 6f72 6d61 742c 636f 6c5f 7365  te_format,col_se
-00013ec0: 7061 7261 746f 723d 636f 6c5f 7365 7061  parator=col_sepa
-00013ed0: 7261 746f 722c 636f 6e73 745f 7661 6c75  rator,const_valu
-00013ee0: 6573 3d63 6f6e 7374 5f76 616c 7565 732c  es=const_values,
-00013ef0: 616e 676c 6573 496e 5261 643d 6174 745f  anglesInRad=att_
-00013f00: 7061 7468 5f61 6e67 6c65 735f 696e 5f72  path_angles_in_r
-00013f10: 6164 290a 2020 2020 2020 2020 6966 2070  ad).        if p
-00013f20: 6172 7365 4d73 6720 213d 2022 223a 0a20  arseMsg != "":. 
-00013f30: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00013f40: 7072 6f76 2e6c 6f67 2870 6172 7365 4d73  prov.log(parseMs
-00013f50: 672c 646f 6e74 5368 6f77 3d54 7275 6529  g,dontShow=True)
-00013f60: 0a20 2020 2020 2020 2020 2020 2070 6172  .            par
-00013f70: 7365 4d73 6720 3d20 225c 6e22 202b 2070  seMsg = "\n" + p
-00013f80: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
-00013f90: 2023 2066 696e 6420 666f 7220 6561 6368   # find for each
-00013fa0: 2069 6d61 6765 2074 6865 2072 6573 7065   image the respe
-00013fb0: 6374 6976 6520 6e61 7669 6761 7469 6f6e  ctive navigation
-00013fc0: 2064 6174 610a 2020 2020 2020 2020 732e   data.        s.
-00013fd0: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
-00013fe0: 7563 6365 7373 2c20 696d 6167 655f 6474  uccess, image_dt
-00013ff0: 732c 206d 7367 203d 2073 656c 662e 6669  s, msg = self.fi
-00014000: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
-00014010: 6528 6174 745f 6461 7461 2c76 6964 656f  e(att_data,video
-00014020: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
-00014030: 2020 2020 2020 2069 6620 6e6f 7420 7375         if not su
-00014040: 6363 6573 733a 0a20 2020 2020 2020 2020  ccess:.         
-00014050: 2020 2072 6574 7572 6e20 4661 6c73 652c     return False,
-00014060: 206d 7367 202b 2070 6172 7365 4d73 670a   msg + parseMsg.
-00014070: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
-00014080: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
-00014090: 6728 2243 7265 6174 696e 6720 6974 656d  g("Creating item
-000140a0: 7327 2061 7474 6974 7564 6520 6461 7461  s' attitude data
-000140b0: 2229 0a0a 2020 2020 2020 2020 2320 696e  ")..        # in
-000140c0: 7665 7274 2076 616c 7565 7320 2869 6620  vert values (if 
-000140d0: 6e65 6564 6564 2920 6265 666f 7265 206c  needed) before l
-000140e0: 6576 6572 6172 6d20 636f 6d70 656e 7361  everarm compensa
-000140f0: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
-00014100: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00014110: 6564 2021 3d20 5b5d 3a0a 2020 2020 2020  ed != []:.      
-00014120: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00014130: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
-00014140: 2020 2020 2020 2020 2020 2020 2061 7474               att
-00014150: 6974 7564 6573 203d 2069 6d61 6765 5f64  itudes = image_d
-00014160: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
-00014170: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
-00014180: 6e20 7261 6e67 6528 6c65 6e28 6174 7469  n range(len(atti
-00014190: 7475 6465 7329 293a 0a20 2020 2020 2020  tudes)):.       
-000141a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-000141b0: 2779 6177 2720 696e 2020 7265 636f 7264  'yaw' in  record
-000141c0: 7332 6265 496e 7665 7274 6564 3a0a 2020  s2beInverted:.  
-000141d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000141e0: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
-000141f0: 695d 2e79 6177 202a 3d20 2d31 0a20 2020  i].yaw *= -1.   
-00014200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014210: 2069 6620 2770 6974 6368 2720 696e 2020   if 'pitch' in  
-00014220: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
-00014230: 6564 3a0a 2020 2020 2020 2020 2020 2020  ed:.            
-00014240: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-00014250: 7475 6465 735b 695d 2e70 6974 6368 202a  tudes[i].pitch *
-00014260: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
-00014270: 2020 2020 2020 2020 2069 6620 2772 6f6c           if 'rol
-00014280: 6c27 2069 6e20 2072 6563 6f72 6473 3262  l' in  records2b
-00014290: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
-000142a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000142b0: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
-000142c0: 726f 6c6c 202a 3d20 2d31 0a0a 0a20 2020  roll *= -1...   
-000142d0: 2020 2020 2023 2061 6464 2063 616d 6572       # add camer
-000142e0: 6132 4672 616d 6520 616e 676c 6573 0a20  a2Frame angles. 
-000142f0: 2020 2020 2020 2052 5f63 616d 3266 7261         R_cam2fra
-00014300: 6d65 203d 206d 6971 7467 2e52 5f59 6177  me = miqtg.R_Yaw
-00014310: 5069 7463 6852 6f6c 6c28 6361 6d65 7261  PitchRoll(camera
-00014320: 3246 7261 6d65 5f79 6177 2c63 616d 6572  2Frame_yaw,camer
-00014330: 6132 4672 616d 655f 7069 7463 682c 6361  a2Frame_pitch,ca
-00014340: 6d65 7261 3246 7261 6d65 5f72 6f6c 6c29  mera2Frame_roll)
-00014350: 0a20 2020 2020 2020 2052 5f63 616d 3275  .        R_cam2u
-00014360: 746d 5f6c 6973 7420 3d20 5b5d 0a20 2020  tm_list = [].   
-00014370: 2020 2020 2066 6f72 2066 696c 6520 696e       for file in
-00014380: 2069 6d61 6765 5f64 7473 3a0a 2020 2020   image_dts:.    
-00014390: 2020 2020 2020 2020 666f 7220 7469 6d65          for time
-000143a0: 706f 696e 7420 696e 2069 6d61 6765 5f64  point in image_d
-000143b0: 7473 5b66 696c 655d 3a0a 2020 2020 2020  ts[file]:.      
-000143c0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
-000143d0: 6465 203d 2074 696d 6570 6f69 6e74 0a20  de = timepoint. 
-000143e0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-000143f0: 6620 6174 7469 7475 6465 2e79 6177 2069  f attitude.yaw i
-00014400: 7320 4e6f 6e65 206f 7220 6174 7469 7475  s None or attitu
-00014410: 6465 2e70 6974 6368 2069 7320 4e6f 6e65  de.pitch is None
-00014420: 206f 7220 6174 7469 7475 6465 2e72 6f6c   or attitude.rol
-00014430: 6c20 6973 204e 6f6e 653a 0a20 2020 2020  l is None:.     
-00014440: 2020 2020 2020 2020 2020 2020 2020 2052                 R
-00014450: 5f63 616d 3275 746d 5f6c 6973 742e 6170  _cam2utm_list.ap
-00014460: 7065 6e64 2822 2229 0a20 2020 2020 2020  pend("").       
-00014470: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-00014480: 7469 6e75 650a 2020 2020 2020 2020 2020  tinue.          
-00014490: 2020 2020 2020 525f 6672 616d 6532 6e65        R_frame2ne
-000144a0: 6420 3d20 6d69 7174 672e 525f 5961 7750  d = miqtg.R_YawP
-000144b0: 6974 6368 526f 6c6c 2861 7474 6974 7564  itchRoll(attitud
-000144c0: 652e 7961 772c 6174 7469 7475 6465 2e70  e.yaw,attitude.p
-000144d0: 6974 6368 2c61 7474 6974 7564 652e 726f  itch,attitude.ro
-000144e0: 6c6c 290a 2020 2020 2020 2020 2020 2020  ll).            
-000144f0: 2020 2020 525f 6361 6d32 6e65 6420 3d20      R_cam2ned = 
-00014500: 525f 6672 616d 6532 6e65 642e 646f 7428  R_frame2ned.dot(
-00014510: 525f 6361 6d32 6672 616d 6529 0a20 2020  R_cam2frame).   
-00014520: 2020 2020 2020 2020 2020 2020 2079 6177               yaw
-00014530: 2c70 6974 6368 2c72 6f6c 6c20 3d20 6d69  ,pitch,roll = mi
-00014540: 7174 672e 7961 7750 6974 6368 526f 6c6c  qtg.yawPitchRoll
-00014550: 2852 5f63 616d 326e 6564 290a 2020 2020  (R_cam2ned).    
-00014560: 2020 2020 2020 2020 2020 2020 6174 7469              atti
-00014570: 7475 6465 2e79 6177 203d 2079 6177 0a20  tude.yaw = yaw. 
-00014580: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00014590: 7474 6974 7564 652e 7069 7463 6820 3d20  ttitude.pitch = 
-000145a0: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
-000145b0: 2020 2020 2020 6174 7469 7475 6465 2e72        attitude.r
-000145c0: 6f6c 6c20 3d20 726f 6c6c 0a0a 2020 2020  oll = roll..    
-000145d0: 2020 2020 2020 2020 2020 2020 525f 6361              R_ca
-000145e0: 6d53 7464 3275 746d 203d 2073 656c 662e  mStd2utm = self.
-000145f0: 6765 745f 525f 6361 6d53 7464 3275 746d  get_R_camStd2utm
-00014600: 2852 5f63 616d 3266 7261 6d65 2c52 5f66  (R_cam2frame,R_f
-00014610: 7261 6d65 326e 6564 290a 2020 2020 2020  rame2ned).      
-00014620: 2020 2020 2020 2020 2020 525f 6361 6d32            R_cam2
-00014630: 7574 6d5f 6c69 7374 2e61 7070 656e 6428  utm_list.append(
-00014640: 525f 6361 6d53 7464 3275 746d 2e66 6c61  R_camStd2utm.fla
-00014650: 7474 656e 2829 2e74 6f6c 6973 7428 2929  tten().tolist())
-00014660: 0a0a 2020 2020 2020 2020 7365 6c66 2e70  ..        self.p
-00014670: 726f 762e 6c6f 6728 2261 7070 6c69 6564  rov.log("applied
-00014680: 2066 7261 6d65 2074 6f20 6361 6d65 7261   frame to camera
-00014690: 2072 6f74 6174 696f 6e20 7961 772c 7069   rotation yaw,pi
-000146a0: 7463 682c 726f 6c6c 203d 2022 202b 2073  tch,roll = " + s
-000146b0: 7472 2863 616d 6572 6132 4672 616d 655f  tr(camera2Frame_
-000146c0: 7961 7729 202b 2022 2c22 202b 2073 7472  yaw) + "," + str
-000146d0: 2863 616d 6572 6132 4672 616d 655f 7069  (camera2Frame_pi
-000146e0: 7463 6829 202b 2022 2c22 202b 2073 7472  tch) + "," + str
-000146f0: 2863 616d 6572 6132 4672 616d 655f 726f  (camera2Frame_ro
-00014700: 6c6c 292c 646f 6e74 5368 6f77 3d54 7275  ll),dontShow=Tru
-00014710: 6529 0a0a 2020 2020 2020 2020 6966 206c  e)..        if l
-00014720: 656e 2869 6d61 6765 5f64 7473 2920 3e20  en(image_dts) > 
-00014730: 303a 0a0a 2020 2020 2020 2020 2020 2020  0:..            
-00014740: 2320 5772 6974 6520 746f 206e 6176 6967  # Write to navig
-00014750: 6174 696f 6e20 7478 7420 6669 6c65 0a20  ation txt file. 
-00014760: 2020 2020 2020 2020 2020 2023 2068 6561             # hea
-00014770: 6465 720a 2020 2020 2020 2020 2020 2020  der.            
-00014780: 7265 7320 3d20 6f70 656e 2869 6e74 5f61  res = open(int_a
-00014790: 7474 7574 7564 655f 6669 6c65 2c20 2277  ttutude_file, "w
-000147a0: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
-000147b0: 6573 2e77 7269 7465 286d 6971 7476 2e63  es.write(miqtv.c
-000147c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-000147d0: 7427 5d5b 2769 6d67 275d 2b22 5c74 222b  t']['img']+"\t"+
-000147e0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-000147f0: 5b27 6d61 7269 7174 275d 5b27 7574 6327  ['mariqt']['utc'
-00014800: 5d29 0a20 2020 2020 2020 2020 2020 2072  ]).            r
-00014810: 6573 2e77 7269 7465 2822 5c74 222b 6d69  es.write("\t"+mi
-00014820: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00014830: 6d61 7269 7174 275d 5b27 7961 7727 5d29  mariqt']['yaw'])
-00014840: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014850: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-00014860: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00014870: 7269 7174 275d 5b27 7069 7463 6827 5d29  riqt']['pitch'])
-00014880: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014890: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
-000148a0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-000148b0: 7269 7174 275d 5b27 726f 6c6c 275d 290a  riqt']['roll']).
-000148c0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-000148d0: 2e77 7269 7465 2822 5c6e 2229 0a20 2020  .write("\n").   
-000148e0: 2020 2020 2020 2020 2023 2064 6174 6120           # data 
-000148f0: 6c69 6e65 730a 2020 2020 2020 2020 2020  lines.          
-00014900: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
-00014910: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
-00014920: 2020 2020 2020 2020 2066 6f72 2074 696d           for tim
-00014930: 6570 6f69 6e74 2069 6e20 696d 6167 655f  epoint in image_
-00014940: 6474 735b 6669 6c65 5d3a 0a20 2020 2020  dts[file]:.     
-00014950: 2020 2020 2020 2020 2020 2020 2020 2072                 r
-00014960: 6573 2e77 7269 7465 2866 696c 652b 225c  es.write(file+"\
-00014970: 7422 2b74 696d 6570 6f69 6e74 2e64 6174  t"+timepoint.dat
-00014980: 6554 696d 6528 292e 7374 7266 7469 6d65  eTime().strftime
-00014990: 286d 6971 7476 2e64 6174 655f 666f 726d  (miqtv.date_form
-000149a0: 6174 735b 276d 6172 6971 7427 5d29 2920  ats['mariqt'])) 
-000149b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000149c0: 2020 2020 2076 616c 203d 2074 696d 6570       val = timep
-000149d0: 6f69 6e74 2e79 6177 0a20 2020 2020 2020  oint.yaw.       
-000149e0: 2020 2020 2020 2020 2020 2020 2072 6573               res
-000149f0: 2e77 7269 7465 2822 5c74 222b 7374 7228  .write("\t"+str(
-00014a00: 7661 6c29 290a 2020 2020 2020 2020 2020  val)).          
-00014a10: 2020 2020 2020 2020 2020 7661 6c20 3d20            val = 
-00014a20: 7469 6d65 706f 696e 742e 7069 7463 680a  timepoint.pitch.
-00014a30: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a40: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
-00014a50: 7422 2b73 7472 2876 616c 2929 0a20 2020  t"+str(val)).   
-00014a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014a70: 2076 616c 203d 2074 696d 6570 6f69 6e74   val = timepoint
-00014a80: 2e72 6f6c 6c0a 2020 2020 2020 2020 2020  .roll.          
-00014a90: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00014aa0: 6974 6528 225c 7422 2b73 7472 2876 616c  ite("\t"+str(val
-00014ab0: 2929 0a20 2020 2020 2020 2020 2020 2020  )).             
-00014ac0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00014ad0: 2822 5c6e 2229 0a20 2020 2020 2020 2020  ("\n").         
-00014ae0: 2020 2072 6573 2e63 6c6f 7365 2829 0a0a     res.close()..
-00014af0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00014b00: 2e70 726f 762e 6164 6441 7267 756d 656e  .prov.addArgumen
-00014b10: 7428 2269 6e70 7574 4174 7469 7475 6465  t("inputAttitude
-00014b20: 4669 6c65 222c 6174 745f 7061 7468 2c6f  File",att_path,o
-00014b30: 7665 7277 7269 7465 3d54 7275 6529 0a20  verwrite=True). 
-00014b40: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-00014b50: 7072 6f76 2e6c 6f67 2822 7061 7273 6564  prov.log("parsed
-00014b60: 2066 726f 6d20 696e 7075 7441 7474 6974   from inputAttit
-00014b70: 7564 6546 696c 653a 2022 202b 2073 7472  udeFile: " + str
-00014b80: 2866 7261 6d65 5f61 7474 5f68 6561 6465  (frame_att_heade
-00014b90: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
-00014ba0: 290a 2020 2020 2020 2020 2020 2020 7365  ).            se
-00014bb0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
-00014bc0: 5f74 6162 5f66 696c 6528 696e 745f 6174  _tab_file(int_at
-00014bd0: 7475 7475 6465 5f66 696c 652c 225c 7422  tutude_file,"\t"
-00014be0: 2c6f 7574 7075 745f 6865 6164 6572 5f61  ,output_header_a
-00014bf0: 7474 290a 0a20 2020 2020 2020 2020 2020  tt)..           
-00014c00: 2023 2057 7269 7465 2074 6f20 706f 7365   # Write to pose
-00014c10: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
-00014c20: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
-00014c30: 2020 2020 2020 2020 2020 2072 6573 203d             res =
-00014c40: 206f 7065 6e28 696e 745f 706f 7365 5f66   open(int_pose_f
-00014c50: 696c 652c 2022 7722 290a 2020 2020 2020  ile, "w").      
-00014c60: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00014c70: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
-00014c80: 5b27 6d61 7269 7174 275d 5b27 696d 6727  ['mariqt']['img'
-00014c90: 5d2b 225c 7422 2b6d 6971 7476 2e63 6f6c  ]+"\t"+miqtv.col
-00014ca0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
-00014cb0: 5d5b 2775 7463 275d 290a 2020 2020 2020  ]['utc']).      
-00014cc0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
-00014cd0: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-00014ce0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-00014cf0: 2770 6f73 6527 5d29 0a20 2020 2020 2020  'pose']).       
-00014d00: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00014d10: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-00014d20: 2023 2064 6174 6120 6c69 6e65 730a 2020   # data lines.  
-00014d30: 2020 2020 2020 2020 2020 6920 3d20 300a            i = 0.
-00014d40: 2020 2020 2020 2020 2020 2020 666f 7220              for 
-00014d50: 6669 6c65 2069 6e20 696d 6167 655f 6474  file in image_dt
-00014d60: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
-00014d70: 2020 2066 6f72 2074 696d 6570 6f69 6e74     for timepoint
-00014d80: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00014d90: 6c65 5d3a 0a20 2020 2020 2020 2020 2020  le]:.           
-00014da0: 2020 2020 2020 2020 2069 6620 525f 6361           if R_ca
-00014db0: 6d32 7574 6d5f 6c69 7374 5b69 5d20 3d3d  m2utm_list[i] ==
-00014dc0: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
-00014dd0: 2020 2020 2020 2020 2020 2020 2069 202b               i +
-00014de0: 3d20 310a 2020 2020 2020 2020 2020 2020  = 1.            
-00014df0: 2020 2020 2020 2020 2020 2020 636f 6e74              cont
-00014e00: 696e 7565 0a20 2020 2020 2020 2020 2020  inue.           
-00014e10: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00014e20: 7465 2866 696c 652b 225c 7422 2b74 696d  te(file+"\t"+tim
-00014e30: 6570 6f69 6e74 2e64 6174 6554 696d 6528  epoint.dateTime(
-00014e40: 292e 7374 7266 7469 6d65 286d 6971 7476  ).strftime(miqtv
-00014e50: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
-00014e60: 6172 6971 7427 5d29 2920 0a20 2020 2020  ariqt'])) .     
-00014e70: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00014e80: 6e74 7279 203d 2073 7472 287b 2770 6f73  ntry = str({'pos
-00014e90: 652d 6162 736f 6c75 7465 2d6f 7269 656e  e-absolute-orien
-00014ea0: 7461 7469 6f6e 2d75 746d 2d6d 6174 7269  tation-utm-matri
-00014eb0: 7827 3a52 5f63 616d 3275 746d 5f6c 6973  x':R_cam2utm_lis
-00014ec0: 745b 695d 7d29 2e72 6570 6c61 6365 2827  t[i]}).replace('
-00014ed0: 5c6e 272c 2727 290a 2020 2020 2020 2020  \n','').        
-00014ee0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00014ef0: 7772 6974 6528 225c 7422 2b65 6e74 7279  write("\t"+entry
-00014f00: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
-00014f10: 2020 2020 2020 6920 2b3d 2031 0a20 2020        i += 1.   
-00014f20: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00014f30: 2072 6573 2e77 7269 7465 2822 5c6e 2229   res.write("\n")
-00014f40: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00014f50: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
-00014f60: 2020 2020 2073 656c 662e 6164 645f 6974       self.add_it
-00014f70: 656d 5f69 6e66 6f5f 7461 625f 6669 6c65  em_info_tab_file
-00014f80: 2869 6e74 5f70 6f73 655f 6669 6c65 2c22  (int_pose_file,"
-00014f90: 5c74 222c 6f75 7470 7574 5f68 6561 6465  \t",output_heade
-00014fa0: 725f 706f 7365 290a 2020 2020 2020 2020  r_pose).        
-00014fb0: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
-00014fc0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-00014fd0: 5472 7565 2c20 2241 7474 6974 7564 6520  True, "Attitude 
-00014fe0: 6461 7461 2063 7265 6174 6564 2220 2b20  data created" + 
-00014ff0: 7061 7273 654d 7367 0a20 2020 2020 2020  parseMsg.       
-00015000: 2065 6c73 653a 0a20 2020 2020 2020 2020   else:.         
-00015010: 2020 2073 2e73 746f 7028 290a 2020 2020     s.stop().    
-00015020: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00015030: 616c 7365 2c20 224e 6f20 696d 6167 6520  alse, "No image 
-00015040: 6174 7469 7475 6465 7320 666f 756e 6422  attitudes found"
-00015050: 202b 2070 6172 7365 4d73 670a 2020 2020   + parseMsg.    
-00015060: 2020 2020 0a20 2020 2020 2020 200a 2020      .        .  
-00015070: 2020 6465 6620 6372 6561 7465 496d 6167    def createImag
-00015080: 6541 7474 6974 7564 6546 696c 6528 7365  eAttitudeFile(se
-00015090: 6c66 2c20 6174 745f 7061 7468 3a73 7472  lf, att_path:str
-000150a0: 2c20 6672 616d 655f 6174 745f 6865 6164  , frame_att_head
-000150b0: 6572 3a64 6963 742c 2063 616d 6572 6132  er:dict, camera2
-000150c0: 4672 616d 655f 7961 773a 666c 6f61 742c  Frame_yaw:float,
-000150d0: 6361 6d65 7261 3246 7261 6d65 5f70 6974  camera2Frame_pit
-000150e0: 6368 3a66 6c6f 6174 2c63 616d 6572 6132  ch:float,camera2
-000150f0: 4672 616d 655f 726f 6c6c 3a66 6c6f 6174  Frame_roll:float
-00015100: 2c0a 2020 2020 2020 2020 2020 2020 2020  ,.              
-00015110: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015120: 2020 6461 7465 5f66 6f72 6d61 743d 6d69    date_format=mi
-00015130: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-00015140: 5b27 7061 6e67 6165 6127 5d2c 2063 6f6e  ['pangaea'], con
-00015150: 7374 5f76 616c 7565 7320 3d20 7b7d 2c20  st_values = {}, 
-00015160: 6f76 6572 7772 6974 653d 4661 6c73 652c  overwrite=False,
-00015170: 2063 6f6c 5f73 6570 6172 6174 6f72 203d   col_separator =
-00015180: 2022 5c74 222c 0a20 2020 2020 2020 2020   "\t",.         
-00015190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000151a0: 2020 2020 2020 2061 7474 5f70 6174 685f         att_path_
-000151b0: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
-000151c0: 4661 6c73 652c 2076 6964 656f 5361 6d70  False, videoSamp
-000151d0: 6c65 5365 636f 6e64 733d 312c 7265 636f  leSeconds=1,reco
-000151e0: 7264 7332 6265 496e 7665 7274 6564 3d5b  rds2beInverted=[
-000151f0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
-00015200: 4465 7072 6563 6174 6465 202d 2075 7365  Deprecatde - use
-00015210: 2063 7265 6174 655f 696d 6167 655f 6174   create_image_at
-00015220: 7469 7475 6465 5f66 696c 6520 2222 220a  titude_file """.
-00015230: 2020 2020 2020 2020 7265 7475 726e 2073          return s
-00015240: 656c 662e 6372 6561 7465 5f69 6d61 6765  elf.create_image
-00015250: 5f61 7474 6974 7564 655f 6669 6c65 2861  _attitude_file(a
-00015260: 7474 5f70 6174 682c 2066 7261 6d65 5f61  tt_path, frame_a
-00015270: 7474 5f68 6561 6465 722c 2063 616d 6572  tt_header, camer
-00015280: 6132 4672 616d 655f 7961 772c 2063 616d  a2Frame_yaw, cam
-00015290: 6572 6132 4672 616d 655f 7069 7463 682c  era2Frame_pitch,
-000152a0: 2063 616d 6572 6132 4672 616d 655f 726f   camera2Frame_ro
-000152b0: 6c6c 2c20 0a20 2020 2020 2020 2020 2020  ll, .           
-000152c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000152e0: 2020 2020 6461 7465 5f66 6f72 6d61 742c      date_format,
-000152f0: 2063 6f6e 7374 5f76 616c 7565 732c 206f   const_values, o
-00015300: 7665 7277 7269 7465 2c20 636f 6c5f 7365  verwrite, col_se
-00015310: 7061 7261 746f 722c 2061 7474 5f70 6174  parator, att_pat
-00015320: 685f 616e 676c 6573 5f69 6e5f 7261 642c  h_angles_in_rad,
-00015330: 2076 6964 656f 5361 6d70 6c65 5365 636f   videoSampleSeco
-00015340: 6e64 732c 0a20 2020 2020 2020 2020 2020  nds,.           
-00015350: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015370: 2020 2020 7265 636f 7264 7332 6265 496e      records2beIn
-00015380: 7665 7274 6564 290a 2020 2020 2020 2020  verted).        
-00015390: 0a0a 2020 2020 6465 6620 6765 745f 525f  ..    def get_R_
-000153a0: 6361 6d53 7464 3275 746d 2873 656c 662c  camStd2utm(self,
-000153b0: 525f 6361 6d32 6672 616d 653a 6e70 2e61  R_cam2frame:np.a
-000153c0: 7272 6179 2c52 5f66 7261 6d65 326e 6564  rray,R_frame2ned
-000153d0: 3a6e 702e 6172 7261 7929 3a0a 2020 2020  :np.array):.    
-000153e0: 2020 2020 2222 2220 7265 7472 756e 2072      """ retrun r
-000153f0: 6f74 6174 696f 6e20 6d61 7472 6978 2052  otation matrix R
-00015400: 2074 7261 6e66 6f72 6d69 6e67 2066 726f   tranforming fro
-00015410: 6d20 6361 6d53 7464 3a20 2878 2c79 2c7a  m camStd: (x,y,z
-00015420: 203d 2072 6967 6874 2c62 7574 746f 6d2c   = right,buttom,
-00015430: 6c69 6e65 206f 6620 7369 6768 7429 2074  line of sight) t
-00015440: 6f20 7574 6d20 2878 2c79 2c7a 203d 2065  o utm (x,y,z = e
-00015450: 6173 7469 6e67 2c6e 6f72 7468 696e 672c  asting,northing,
-00015460: 7570 2920 2222 220a 2020 2020 2020 2020  up) """.        
-00015470: 525f 6361 6d69 4644 4f32 6361 6d53 7464  R_camiFDO2camStd
-00015480: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
-00015490: 7463 6852 6f6c 6c28 3930 2c30 2c30 2920  tchRoll(90,0,0) 
-000154a0: 2320 696e 2069 4644 4f20 6361 6d3a 2028  # in iFDO cam: (
-000154b0: 782c 792c 7a20 3d20 746f 702c 7269 6768  x,y,z = top,righ
-000154c0: 742c 6c69 6e65 206f 6620 7369 6768 7429  t,line of sight)
-000154d0: 2062 7574 2066 6f72 2070 6f73 6520 7468   but for pose th
-000154e0: 6520 2773 7461 6e64 6172 6427 2063 616d  e 'standard' cam
-000154f0: 5374 643a 2028 782c 792c 7a20 3d20 7269  Std: (x,y,z = ri
-00015500: 6768 742c 6275 7474 6f6d 2c6c 696e 6520  ght,buttom,line 
-00015510: 6f66 2073 6967 6874 2920 6973 2065 7870  of sight) is exp
-00015520: 6563 7465 640a 2020 2020 2020 2020 525f  ected.        R_
-00015530: 6361 6d53 7464 3266 7261 6d65 203d 2052  camStd2frame = R
-00015540: 5f63 616d 3266 7261 6d65 2e64 6f74 2852  _cam2frame.dot(R
-00015550: 5f63 616d 6946 444f 3263 616d 5374 6429  _camiFDO2camStd)
-00015560: 0a20 2020 2020 2020 2052 5f63 616d 5374  .        R_camSt
-00015570: 6432 6e65 6420 3d20 525f 6672 616d 6532  d2ned = R_frame2
-00015580: 6e65 642e 646f 7428 525f 6361 6d53 7464  ned.dot(R_camStd
-00015590: 3266 7261 6d65 290a 2020 2020 2020 2020  2frame).        
-000155a0: 525f 6e65 6432 7574 6d20 3d20 6d69 7174  R_ned2utm = miqt
-000155b0: 672e 525f 5859 5a28 3138 302c 302c 3930  g.R_XYZ(180,0,90
-000155c0: 2920 2320 7769 7468 2075 746d 2078 2c79  ) # with utm x,y
-000155d0: 2c7a 203d 2065 6173 7469 6e67 2c6e 6f72  ,z = easting,nor
-000155e0: 7468 696e 672c 7570 0a20 2020 2020 2020  thing,up.       
-000155f0: 2052 5f63 616d 5374 6432 7574 6d20 3d20   R_camStd2utm = 
-00015600: 525f 6e65 6432 7574 6d2e 646f 7428 525f  R_ned2utm.dot(R_
-00015610: 6361 6d53 7464 326e 6564 292e 726f 756e  camStd2ned).roun
-00015620: 6428 3529 0a20 2020 2020 2020 2072 6574  d(5).        ret
-00015630: 7572 6e20 525f 6361 6d53 7464 3275 746d  urn R_camStd2utm
-00015640: 0a0a 0a20 2020 2064 6566 2066 696e 644e  ...    def findN
-00015650: 6176 4461 7461 466f 7249 6d61 6765 2873  avDataForImage(s
-00015660: 656c 662c 6461 7461 3a6d 6971 7467 2e4e  elf,data:miqtg.N
-00015670: 756d 4461 7461 5469 6d65 5374 616d 7065  umDataTimeStampe
-00015680: 642c 7669 6465 6f53 616d 706c 6553 6563  d,videoSampleSec
-00015690: 6f6e 6473 3d31 293a 0a20 2020 2020 2020  onds=1):.       
-000156a0: 2022 2222 2063 7265 6174 6573 2061 2064   """ creates a d
-000156b0: 6963 7420 2869 6d61 6765 5f64 7473 2920  ict (image_dts) 
-000156c0: 7769 7468 2066 696c 6520 6e61 6d65 2061  with file name a
-000156d0: 7320 6b65 7920 616e 6420 6120 6c69 7374  s key and a list
-000156e0: 206f 6620 6461 7461 2065 6c65 6d65 6e74   of data element
-000156f0: 7320 6173 2076 616c 7565 2e20 0a20 2020  s as value. .   
-00015700: 2020 2020 2020 2020 2049 6e20 6361 7365           In case
-00015710: 206f 6620 7068 6f74 6f73 2074 6865 206c   of photos the l
-00015720: 6973 7420 6861 7320 6f6e 6c79 2061 2073  ist has only a s
-00015730: 696e 676c 6520 656e 7472 792c 2066 6f72  ingle entry, for
-00015740: 2076 6964 656f 7320 6974 2068 6173 2076   videos it has v
-00015750: 6964 656f 2064 7572 6174 696f 6e20 5b73  ideo duration [s
-00015760: 6563 5d20 2f20 7669 6465 6f53 616d 706c  ec] / videoSampl
-00015770: 6553 6563 6f6e 6473 2065 6e74 7269 6573  eSeconds entries
-00015780: 2e0a 2020 2020 2020 2020 2020 2020 5265  ..            Re
-00015790: 7475 726e 7320 7375 6363 6573 732c 2069  turns success, i
-000157a0: 6d61 6765 5f64 7473 2c20 6d73 6720 2222  mage_dts, msg ""
-000157b0: 220a 0a20 2020 2020 2020 2069 6620 7669  "..        if vi
-000157c0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
-000157d0: 203c 3d20 303a 0a20 2020 2020 2020 2020   <= 0:.         
-000157e0: 2020 2072 6169 7365 2045 7863 6570 7469     raise Excepti
-000157f0: 6f6e 2822 6669 6e64 4e61 7644 6174 6146  on("findNavDataF
-00015800: 6f72 496d 6167 653a 2076 6964 656f 5361  orImage: videoSa
-00015810: 6d70 6c65 5365 636f 6e64 7320 6d75 7374  mpleSeconds must
-00015820: 2062 6520 6772 6561 7465 7220 3022 290a   be greater 0").
-00015830: 0a20 2020 2020 2020 2023 2063 7265 6174  .        # creat
-00015840: 6520 736f 7274 6564 2074 696d 6520 706f  e sorted time po
-00015850: 696e 7473 0a20 2020 2020 2020 2074 696d  ints.        tim
-00015860: 655f 706f 696e 7473 203d 206c 6973 7428  e_points = list(
-00015870: 6461 7461 2e6b 6579 7328 2929 0a20 2020  data.keys()).   
-00015880: 2020 2020 2074 696d 655f 706f 696e 7473       time_points
-00015890: 2e73 6f72 7428 290a 2020 2020 2020 2020  .sort().        
-000158a0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-000158b0: 6e74 7320 3d20 5b5d 0a20 2020 2020 2020  nts = [].       
-000158c0: 2069 6d61 6765 5f64 7473 203d 207b 7d0a   image_dts = {}.
-000158d0: 2020 2020 2020 2020 7374 6172 7453 6561          startSea
-000158e0: 7263 6849 6e64 6578 203d 2030 0a20 2020  rchIndex = 0.   
-000158f0: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-00015900: 203d 2020 7365 6c66 2e69 6d61 6765 7349   =  self.imagesI
-00015910: 6e49 6d61 6765 7344 6972 2829 0a20 2020  nImagesDir().   
-00015920: 2020 2020 2069 6d61 6765 7349 6e52 6177       imagesInRaw
-00015930: 536f 7274 6564 4c69 7374 203d 2073 656c  SortedList = sel
-00015940: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-00015950: 4469 7253 6f72 7465 644c 6973 7428 290a  DirSortedList().
-00015960: 2020 2020 2020 2020 7072 6f67 203d 206d          prog = m
-00015970: 6971 7463 2e50 7269 6e74 4b6e 6f77 6e50  iqtc.PrintKnownP
-00015980: 726f 6772 6573 734d 7367 2822 496e 7465  rogressMsg("Inte
-00015990: 7270 6f6c 6174 696e 6720 6e61 7669 6761  rpolating naviga
-000159a0: 7469 6f6e 2066 6f72 2069 6d61 6765 222c  tion for image",
-000159b0: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-000159c0: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
-000159d0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-000159e0: 696d 6167 6573 496e 5261 7753 6f72 7465  imagesInRawSorte
-000159f0: 644c 6973 743a 0a20 2020 2020 2020 2020  dList:.         
-00015a00: 2020 2070 726f 672e 7072 6f67 7265 7373     prog.progress
-00015a10: 2829 0a20 2020 2020 2020 2020 2020 2066  ().            f
-00015a20: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
-00015a30: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
-00015a40: 290a 0a20 2020 2020 2020 2020 2020 2064  )..            d
-00015a50: 745f 696d 6167 6520 3d20 6d69 7174 632e  t_image = miqtc.
-00015a60: 7061 7273 6546 696c 6544 6174 6554 696d  parseFileDateTim
-00015a70: 6541 7355 5443 2866 696c 655f 6e61 6d65  eAsUTC(file_name
-00015a80: 290a 2020 2020 2020 2020 2020 2020 6474  ).            dt
-00015a90: 5f69 6d61 6765 5f74 7320 3d20 696e 7428  _image_ts = int(
-00015aa0: 6474 5f69 6d61 6765 2e74 696d 6573 7461  dt_image.timesta
-00015ab0: 6d70 2829 202a 2031 3030 3029 0a0a 2020  mp() * 1000)..  
-00015ac0: 2020 2020 2020 2020 2020 7275 6e54 696d            runTim
-00015ad0: 6520 3d20 696d 6167 6573 496e 5261 775b  e = imagesInRaw[
-00015ae0: 6669 6c65 5d5b 315d 2023 202d 3120 666f  file][1] # -1 fo
-00015af0: 7220 7068 6f74 6f73 0a20 2020 2020 2020  r photos.       
-00015b00: 2020 2020 2023 2076 6964 656f 0a20 2020       # video.   
-00015b10: 2020 2020 2020 2020 2069 6620 696d 6167           if imag
-00015b20: 6573 496e 5261 775b 6669 6c65 5d5b 325d  esInRaw[file][2]
-00015b30: 2069 6e20 6d69 7174 762e 7669 6465 6f5f   in miqtv.video_
-00015b40: 7479 7065 7320 616e 6420 7275 6e54 696d  types and runTim
-00015b50: 6520 3c3d 2030 3a20 2320 6578 740a 2020  e <= 0: # ext.  
-00015b60: 2020 2020 2020 2020 2020 2020 2020 7072                pr
-00015b70: 696e 7428 2243 6175 7469 6f6e 2120 436f  int("Caution! Co
-00015b80: 756c 6420 6e6f 7420 7265 6164 2076 6964  uld not read vid
-00015b90: 656f 2072 756e 2074 696d 6520 6672 6f6d  eo run time from
-00015ba0: 2066 696c 6522 2c66 696c 6529 2023 2054   file",file) # T
-00015bb0: 4f44 4f20 646f 6573 2074 6869 7320 6861  ODO does this ha
-00015bc0: 7070 656e 3f20 4861 6e64 6c65 2062 6574  ppen? Handle bet
-00015bd0: 7465 723f 0a0a 2020 2020 2020 2020 2020  ter?..          
-00015be0: 2020 7361 6d70 6c65 5469 6d65 5365 6373    sampleTimeSecs
-00015bf0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00015c00: 2070 6f73 5f6c 6973 7420 3d20 5b5d 0a20   pos_list = []. 
-00015c10: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-00015c20: 5472 7565 0a20 2020 2020 2020 2020 2020  True.           
-00015c30: 2077 6869 6c65 2067 6f3a 0a20 2020 2020   while go:.     
-00015c40: 2020 2020 2020 2020 2020 2074 7279 3a20             try: 
-00015c50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015c60: 2020 200a 2020 2020 2020 2020 2020 2020     .            
-00015c70: 2020 2020 2020 2020 706f 732c 2073 7461          pos, sta
-00015c80: 7274 5365 6172 6368 496e 6465 7820 3d20  rtSearchIndex = 
-00015c90: 6461 7461 2e69 6e74 6572 706f 6c61 7465  data.interpolate
-00015ca0: 4174 5469 6d65 2864 745f 696d 6167 655f  AtTime(dt_image_
-00015cb0: 7473 202b 2073 616d 706c 6554 696d 6553  ts + sampleTimeS
-00015cc0: 6563 7320 2a20 3130 3030 2c74 696d 655f  ecs * 1000,time_
-00015cd0: 706f 696e 7473 2c73 7461 7274 5365 6172  points,startSear
-00015ce0: 6368 496e 6465 7829 0a20 2020 2020 2020  chIndex).       
-00015cf0: 2020 2020 2020 2020 2020 2020 200a 2020               .  
-00015d00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d10: 2020 2320 696e 7465 7270 6f6c 6174 6541    # interpolateA
-00015d20: 7454 696d 6520 7265 7475 726e 7320 4e6f  tTime returns No
-00015d30: 6e65 2076 616c 7565 7320 6966 2074 696d  ne values if tim
-00015d40: 6520 6f75 7420 6f66 2072 616e 6765 0a20  e out of range. 
-00015d50: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015d60: 2020 2069 6620 706f 732e 636f 7461 696e     if pos.cotain
-00015d70: 734e 6f6e 6556 616c 7565 7349 6e52 6571  sNoneValuesInReq
-00015d80: 7569 7265 6446 6965 6c64 7328 293a 0a20  uiredFields():. 
-00015d90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015da0: 2020 2020 2020 2075 6e6d 6174 6368 6564         unmatched
-00015db0: 5469 6d65 506f 696e 7473 2e61 7070 656e  TimePoints.appen
-00015dc0: 6428 2864 745f 696d 6167 655f 7473 202b  d((dt_image_ts +
-00015dd0: 2073 616d 706c 6554 696d 6553 6563 7320   sampleTimeSecs 
-00015de0: 2a20 3130 3030 292f 3130 3030 290a 2020  * 1000)/1000).  
+00013b50: 7d0a 0a20 2020 2020 2020 2069 6e74 5f70  }..        int_p
+00013b60: 6f73 655f 6669 6c65 203d 2073 656c 662e  ose_file = self.
+00013b70: 5f5f 6765 745f 696e 745f 6669 6c65 5f70  __get_int_file_p
+00013b80: 7265 6669 7828 2920 2b20 275f 696d 6167  refix() + '_imag
+00013b90: 652d 6361 6d65 7261 2d70 6f73 652e 7478  e-camera-pose.tx
+00013ba0: 7427 0a20 2020 2020 2020 206f 7574 7075  t'.        outpu
+00013bb0: 745f 6865 6164 6572 5f70 6f73 6520 3d20  t_header_pose = 
+00013bc0: 7b20 206d 6971 7476 2e63 6f6c 5f68 6561  {  miqtv.col_hea
+00013bd0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
+00013be0: 6d67 275d 3a6d 6971 7476 2e63 6f6c 5f68  mg']:miqtv.col_h
+00013bf0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00013c00: 2769 6d67 275d 2c0a 2020 2020 2020 2020  'img'],.        
+00013c10: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c20: 2020 2020 2020 2020 6d69 7174 762e 636f          miqtv.co
+00013c30: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00013c40: 275d 5b27 7574 6327 5d3a 6d69 7174 762e  ']['utc']:miqtv.
+00013c50: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00013c60: 7174 275d 5b27 7574 6327 5d2c 0a20 2020  qt']['utc'],.   
+00013c70: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013c80: 2020 2020 2020 2020 2020 2020 206d 6971               miq
+00013c90: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
+00013ca0: 6172 6971 7427 5d5b 2770 6f73 6527 5d3a  ariqt']['pose']:
+00013cb0: 6d69 7174 762e 636f 6c5f 6865 6164 6572  miqtv.col_header
+00013cc0: 5b27 6d61 7269 7174 275d 5b27 706f 7365  ['mariqt']['pose
+00013cd0: 275d 2c0a 2020 2020 2020 2020 2020 2020  '],.            
+00013ce0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00013cf0: 7d0a 0a20 2020 2020 2020 2069 6620 6f73  }..        if os
+00013d00: 2e70 6174 682e 6578 6973 7473 2869 6e74  .path.exists(int
+00013d10: 5f61 7474 7574 7564 655f 6669 6c65 2920  _attutude_file) 
+00013d20: 616e 6420 6e6f 7420 6f76 6572 7772 6974  and not overwrit
+00013d30: 653a 0a20 2020 2020 2020 2020 2020 2073  e:.            s
+00013d40: 656c 662e 6164 645f 6974 656d 5f69 6e66  elf.add_item_inf
+00013d50: 6f5f 7461 625f 6669 6c65 2869 6e74 5f61  o_tab_file(int_a
+00013d60: 7474 7574 7564 655f 6669 6c65 2c22 5c74  ttutude_file,"\t
+00013d70: 222c 6f75 7470 7574 5f68 6561 6465 725f  ",output_header_
+00013d80: 6174 7429 0a20 2020 2020 2020 2020 2020  att).           
+00013d90: 2065 7874 7261 5f6d 7367 203d 2022 220a   extra_msg = "".
+00013da0: 2020 2020 2020 2020 2020 2020 6966 206f              if o
+00013db0: 732e 7061 7468 2e65 7869 7374 7328 696e  s.path.exists(in
+00013dc0: 745f 706f 7365 5f66 696c 6529 3a0a 2020  t_pose_file):.  
+00013dd0: 2020 2020 2020 2020 2020 2020 2020 7365                se
+00013de0: 6c66 2e61 6464 5f69 7465 6d5f 696e 666f  lf.add_item_info
+00013df0: 5f74 6162 5f66 696c 6528 696e 745f 706f  _tab_file(int_po
+00013e00: 7365 5f66 696c 652c 225c 7422 2c6f 7574  se_file,"\t",out
+00013e10: 7075 745f 6865 6164 6572 5f70 6f73 6529  put_header_pose)
+00013e20: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00013e30: 2065 7874 7261 5f6d 7367 203d 2022 2c20   extra_msg = ", 
+00013e40: 2220 2b20 696e 745f 706f 7365 5f66 696c  " + int_pose_fil
+00013e50: 650a 2020 2020 2020 2020 2020 2020 7265  e.            re
+00013e60: 7475 726e 2054 7275 652c 2022 4f75 7470  turn True, "Outp
+00013e70: 7574 2066 696c 6520 6578 6973 7473 3a20  ut file exists: 
+00013e80: 222b 696e 745f 6174 7475 7475 6465 5f66  "+int_attutude_f
+00013e90: 696c 6520 2b20 6578 7472 615f 6d73 670a  ile + extra_msg.
+00013ea0: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+00013eb0: 6f73 2e70 6174 682e 6578 6973 7473 2861  os.path.exists(a
+00013ec0: 7474 5f70 6174 6829 3a0a 2020 2020 2020  tt_path):.      
+00013ed0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00013ee0: 7365 2c20 2241 7474 6974 7564 6520 6669  se, "Attitude fi
+00013ef0: 6c65 206e 6f74 2066 6f75 6e64 3a20 222b  le not found: "+
+00013f00: 6174 745f 7061 7468 0a0a 2020 2020 2020  att_path..      
+00013f10: 2020 6966 206e 6f74 206f 732e 7061 7468    if not os.path
+00013f20: 2e65 7869 7374 7328 7365 6c66 2e69 6d61  .exists(self.ima
+00013f30: 6765 7344 6972 293a 0a20 2020 2020 2020  gesDir):.       
+00013f40: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00013f50: 652c 2022 496d 6167 6520 666f 6c64 6572  e, "Image folder
+00013f60: 206e 6f74 2066 6f75 6e64 3a20 222b 2073   not found: "+ s
+00013f70: 656c 662e 696d 6167 6573 4469 720a 0a20  elf.imagesDir.. 
+00013f80: 2020 2020 2020 2073 203d 206d 6971 7463         s = miqtc
+00013f90: 2e50 7269 6e74 4c6f 6164 696e 674d 7367  .PrintLoadingMsg
+00013fa0: 2822 4372 6561 7469 6e67 2069 7465 6d73  ("Creating items
+00013fb0: 2720 6174 7469 7475 6465 2064 6174 6122  ' attitude data"
+00013fc0: 290a 0a20 2020 2020 2020 2023 206c 6f61  )..        # loa
+00013fd0: 6420 6672 616d 6520 6174 7469 7475 6465  d frame attitude
+00013fe0: 2064 6174 6120 6672 6f6d 2066 696c 650a   data from file.
+00013ff0: 2020 2020 2020 2020 6174 745f 6461 7461          att_data
+00014000: 2c20 7061 7273 654d 7367 203d 206d 6971  , parseMsg = miq
+00014010: 746e 2e72 6561 6441 6c6c 4174 7469 7475  tn.readAllAttitu
+00014020: 6465 7346 726f 6d46 696c 6550 6174 6828  desFromFilePath(
+00014030: 6174 745f 7061 7468 2c20 6672 616d 655f  att_path, frame_
+00014040: 6174 745f 6865 6164 6572 2c20 6461 7465  att_header, date
+00014050: 5f66 6f72 6d61 742c 636f 6c5f 7365 7061  _format,col_sepa
+00014060: 7261 746f 723d 636f 6c5f 7365 7061 7261  rator=col_separa
+00014070: 746f 722c 636f 6e73 745f 7661 6c75 6573  tor,const_values
+00014080: 3d63 6f6e 7374 5f76 616c 7565 732c 616e  =const_values,an
+00014090: 676c 6573 496e 5261 643d 6174 745f 7061  glesInRad=att_pa
+000140a0: 7468 5f61 6e67 6c65 735f 696e 5f72 6164  th_angles_in_rad
+000140b0: 290a 2020 2020 2020 2020 6966 2070 6172  ).        if par
+000140c0: 7365 4d73 6720 213d 2022 223a 0a20 2020  seMsg != "":.   
+000140d0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+000140e0: 6f76 2e6c 6f67 2870 6172 7365 4d73 672c  ov.log(parseMsg,
+000140f0: 646f 6e74 5368 6f77 3d54 7275 6529 0a20  dontShow=True). 
+00014100: 2020 2020 2020 2020 2020 2070 6172 7365             parse
+00014110: 4d73 6720 3d20 225c 6e22 202b 2070 6172  Msg = "\n" + par
+00014120: 7365 4d73 670a 0a20 2020 2020 2020 2023  seMsg..        #
+00014130: 2066 696e 6420 666f 7220 6561 6368 2069   find for each i
+00014140: 6d61 6765 2074 6865 2072 6573 7065 6374  mage the respect
+00014150: 6976 6520 6e61 7669 6761 7469 6f6e 2064  ive navigation d
+00014160: 6174 610a 2020 2020 2020 2020 732e 7374  ata.        s.st
+00014170: 6f70 2829 0a20 2020 2020 2020 2073 7563  op().        suc
+00014180: 6365 7373 2c20 696d 6167 655f 6474 732c  cess, image_dts,
+00014190: 206d 7367 203d 2073 656c 662e 6669 6e64   msg = self.find
+000141a0: 4e61 7644 6174 6146 6f72 496d 6167 6528  NavDataForImage(
+000141b0: 6174 745f 6461 7461 2c76 6964 656f 5361  att_data,videoSa
+000141c0: 6d70 6c65 5365 636f 6e64 7329 0a20 2020  mpleSeconds).   
+000141d0: 2020 2020 2069 6620 6e6f 7420 7375 6363       if not succ
+000141e0: 6573 733a 0a20 2020 2020 2020 2020 2020  ess:.           
+000141f0: 2072 6574 7572 6e20 4661 6c73 652c 206d   return False, m
+00014200: 7367 202b 2070 6172 7365 4d73 670a 2020  sg + parseMsg.  
+00014210: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+00014220: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+00014230: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
+00014240: 2061 7474 6974 7564 6520 6461 7461 2229   attitude data")
+00014250: 0a0a 2020 2020 2020 2020 2320 696e 7665  ..        # inve
+00014260: 7274 2076 616c 7565 7320 2869 6620 6e65  rt values (if ne
+00014270: 6564 6564 2920 6265 666f 7265 206c 6576  eded) before lev
+00014280: 6572 6172 6d20 636f 6d70 656e 7361 7469  erarm compensati
+00014290: 6f6e 0a20 2020 2020 2020 2069 6620 7265  on.        if re
+000142a0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+000142b0: 2021 3d20 5b5d 3a0a 2020 2020 2020 2020   != []:.        
+000142c0: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+000142d0: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+000142e0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
+000142f0: 7564 6573 203d 2069 6d61 6765 5f64 7473  udes = image_dts
+00014300: 5b66 696c 655d 0a20 2020 2020 2020 2020  [file].         
+00014310: 2020 2020 2020 2066 6f72 2069 2069 6e20         for i in 
+00014320: 7261 6e67 6528 6c65 6e28 6174 7469 7475  range(len(attitu
+00014330: 6465 7329 293a 0a20 2020 2020 2020 2020  des)):.         
+00014340: 2020 2020 2020 2020 2020 2069 6620 2779             if 'y
+00014350: 6177 2720 696e 2020 7265 636f 7264 7332  aw' in  records2
+00014360: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
+00014370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014380: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
+00014390: 2e79 6177 202a 3d20 2d31 0a20 2020 2020  .yaw *= -1.     
+000143a0: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+000143b0: 6620 2770 6974 6368 2720 696e 2020 7265  f 'pitch' in  re
+000143c0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
+000143d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000143e0: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+000143f0: 6465 735b 695d 2e70 6974 6368 202a 3d20  des[i].pitch *= 
+00014400: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
+00014410: 2020 2020 2020 2069 6620 2772 6f6c 6c27         if 'roll'
+00014420: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
+00014430: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+00014440: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014450: 2061 7474 6974 7564 6573 5b69 5d2e 726f   attitudes[i].ro
+00014460: 6c6c 202a 3d20 2d31 0a0a 0a20 2020 2020  ll *= -1...     
+00014470: 2020 2023 2061 6464 2063 616d 6572 6132     # add camera2
+00014480: 4672 616d 6520 616e 676c 6573 0a20 2020  Frame angles.   
+00014490: 2020 2020 2052 5f63 616d 3266 7261 6d65       R_cam2frame
+000144a0: 203d 206d 6971 7467 2e52 5f59 6177 5069   = miqtg.R_YawPi
+000144b0: 7463 6852 6f6c 6c28 6361 6d65 7261 3246  tchRoll(camera2F
+000144c0: 7261 6d65 5f79 6177 2c63 616d 6572 6132  rame_yaw,camera2
+000144d0: 4672 616d 655f 7069 7463 682c 6361 6d65  Frame_pitch,came
+000144e0: 7261 3246 7261 6d65 5f72 6f6c 6c29 0a20  ra2Frame_roll). 
+000144f0: 2020 2020 2020 2052 5f63 616d 3275 746d         R_cam2utm
+00014500: 5f6c 6973 7420 3d20 5b5d 0a20 2020 2020  _list = [].     
+00014510: 2020 2066 6f72 2066 696c 6520 696e 2069     for file in i
+00014520: 6d61 6765 5f64 7473 3a0a 2020 2020 2020  mage_dts:.      
+00014530: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
+00014540: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
+00014550: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
+00014560: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
+00014570: 203d 2074 696d 6570 6f69 6e74 0a20 2020   = timepoint.   
+00014580: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00014590: 6174 7469 7475 6465 2e79 6177 2069 7320  attitude.yaw is 
+000145a0: 4e6f 6e65 206f 7220 6174 7469 7475 6465  None or attitude
+000145b0: 2e70 6974 6368 2069 7320 4e6f 6e65 206f  .pitch is None o
+000145c0: 7220 6174 7469 7475 6465 2e72 6f6c 6c20  r attitude.roll 
+000145d0: 6973 204e 6f6e 653a 0a20 2020 2020 2020  is None:.       
+000145e0: 2020 2020 2020 2020 2020 2020 2052 5f63               R_c
+000145f0: 616d 3275 746d 5f6c 6973 742e 6170 7065  am2utm_list.appe
+00014600: 6e64 2822 2229 0a20 2020 2020 2020 2020  nd("").         
+00014610: 2020 2020 2020 2020 2020 2063 6f6e 7469             conti
+00014620: 6e75 650a 2020 2020 2020 2020 2020 2020  nue.            
+00014630: 2020 2020 525f 6672 616d 6532 6e65 6420      R_frame2ned 
+00014640: 3d20 6d69 7174 672e 525f 5961 7750 6974  = miqtg.R_YawPit
+00014650: 6368 526f 6c6c 2861 7474 6974 7564 652e  chRoll(attitude.
+00014660: 7961 772c 6174 7469 7475 6465 2e70 6974  yaw,attitude.pit
+00014670: 6368 2c61 7474 6974 7564 652e 726f 6c6c  ch,attitude.roll
+00014680: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00014690: 2020 525f 6361 6d32 6e65 6420 3d20 525f    R_cam2ned = R_
+000146a0: 6672 616d 6532 6e65 642e 646f 7428 525f  frame2ned.dot(R_
+000146b0: 6361 6d32 6672 616d 6529 0a20 2020 2020  cam2frame).     
+000146c0: 2020 2020 2020 2020 2020 2079 6177 2c70             yaw,p
+000146d0: 6974 6368 2c72 6f6c 6c20 3d20 6d69 7174  itch,roll = miqt
+000146e0: 672e 7961 7750 6974 6368 526f 6c6c 2852  g.yawPitchRoll(R
+000146f0: 5f63 616d 326e 6564 290a 2020 2020 2020  _cam2ned).      
+00014700: 2020 2020 2020 2020 2020 6174 7469 7475            attitu
+00014710: 6465 2e79 6177 203d 2079 6177 0a20 2020  de.yaw = yaw.   
+00014720: 2020 2020 2020 2020 2020 2020 2061 7474               att
+00014730: 6974 7564 652e 7069 7463 6820 3d20 7069  itude.pitch = pi
+00014740: 7463 680a 2020 2020 2020 2020 2020 2020  tch.            
+00014750: 2020 2020 6174 7469 7475 6465 2e72 6f6c      attitude.rol
+00014760: 6c20 3d20 726f 6c6c 0a0a 2020 2020 2020  l = roll..      
+00014770: 2020 2020 2020 2020 2020 525f 6361 6d53            R_camS
+00014780: 7464 3275 746d 203d 2073 656c 662e 6765  td2utm = self.ge
+00014790: 745f 525f 6361 6d53 7464 3275 746d 2852  t_R_camStd2utm(R
+000147a0: 5f63 616d 3266 7261 6d65 2c52 5f66 7261  _cam2frame,R_fra
+000147b0: 6d65 326e 6564 290a 2020 2020 2020 2020  me2ned).        
+000147c0: 2020 2020 2020 2020 525f 6361 6d32 7574          R_cam2ut
+000147d0: 6d5f 6c69 7374 2e61 7070 656e 6428 525f  m_list.append(R_
+000147e0: 6361 6d53 7464 3275 746d 2e66 6c61 7474  camStd2utm.flatt
+000147f0: 656e 2829 2e74 6f6c 6973 7428 2929 0a0a  en().tolist())..
+00014800: 2020 2020 2020 2020 7365 6c66 2e70 726f          self.pro
+00014810: 762e 6c6f 6728 2261 7070 6c69 6564 2066  v.log("applied f
+00014820: 7261 6d65 2074 6f20 6361 6d65 7261 2072  rame to camera r
+00014830: 6f74 6174 696f 6e20 7961 772c 7069 7463  otation yaw,pitc
+00014840: 682c 726f 6c6c 203d 2022 202b 2073 7472  h,roll = " + str
+00014850: 2863 616d 6572 6132 4672 616d 655f 7961  (camera2Frame_ya
+00014860: 7729 202b 2022 2c22 202b 2073 7472 2863  w) + "," + str(c
+00014870: 616d 6572 6132 4672 616d 655f 7069 7463  amera2Frame_pitc
+00014880: 6829 202b 2022 2c22 202b 2073 7472 2863  h) + "," + str(c
+00014890: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
+000148a0: 292c 646f 6e74 5368 6f77 3d54 7275 6529  ),dontShow=True)
+000148b0: 0a0a 2020 2020 2020 2020 6966 206c 656e  ..        if len
+000148c0: 2869 6d61 6765 5f64 7473 2920 3e20 303a  (image_dts) > 0:
+000148d0: 0a0a 2020 2020 2020 2020 2020 2020 2320  ..            # 
+000148e0: 5772 6974 6520 746f 206e 6176 6967 6174  Write to navigat
+000148f0: 696f 6e20 7478 7420 6669 6c65 0a20 2020  ion txt file.   
+00014900: 2020 2020 2020 2020 2023 2068 6561 6465           # heade
+00014910: 720a 2020 2020 2020 2020 2020 2020 7265  r.            re
+00014920: 7320 3d20 6f70 656e 2869 6e74 5f61 7474  s = open(int_att
+00014930: 7574 7564 655f 6669 6c65 2c20 2277 2229  utude_file, "w")
+00014940: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+00014950: 2e77 7269 7465 286d 6971 7476 2e63 6f6c  .write(miqtv.col
+00014960: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00014970: 5d5b 2769 6d67 275d 2b22 5c74 222b 6d69  ]['img']+"\t"+mi
+00014980: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00014990: 6d61 7269 7174 275d 5b27 7574 6327 5d29  mariqt']['utc'])
+000149a0: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
+000149b0: 2e77 7269 7465 2822 5c74 222b 6d69 7174  .write("\t"+miqt
+000149c0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+000149d0: 7269 7174 275d 5b27 7961 7727 5d29 0a20  riqt']['yaw']). 
+000149e0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+000149f0: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
+00014a00: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00014a10: 7174 275d 5b27 7069 7463 6827 5d29 0a20  qt']['pitch']). 
+00014a20: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00014a30: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
+00014a40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00014a50: 7174 275d 5b27 726f 6c6c 275d 290a 0a20  qt']['roll']).. 
+00014a60: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00014a70: 7269 7465 2822 5c6e 2229 0a20 2020 2020  rite("\n").     
+00014a80: 2020 2020 2020 2023 2064 6174 6120 6c69         # data li
+00014a90: 6e65 730a 2020 2020 2020 2020 2020 2020  nes.            
+00014aa0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
+00014ab0: 655f 6474 733a 0a20 2020 2020 2020 2020  e_dts:.         
+00014ac0: 2020 2020 2020 2066 6f72 2074 696d 6570         for timep
+00014ad0: 6f69 6e74 2069 6e20 696d 6167 655f 6474  oint in image_dt
+00014ae0: 735b 6669 6c65 5d3a 0a20 2020 2020 2020  s[file]:.       
+00014af0: 2020 2020 2020 2020 2020 2020 2072 6573               res
+00014b00: 2e77 7269 7465 2866 696c 652b 225c 7422  .write(file+"\t"
+00014b10: 2b74 696d 6570 6f69 6e74 2e64 6174 6554  +timepoint.dateT
+00014b20: 696d 6528 292e 7374 7266 7469 6d65 286d  ime().strftime(m
+00014b30: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
+00014b40: 735b 276d 6172 6971 7427 5d29 2920 0a20  s['mariqt'])) . 
+00014b50: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014b60: 2020 2076 616c 203d 2074 696d 6570 6f69     val = timepoi
+00014b70: 6e74 2e79 6177 0a20 2020 2020 2020 2020  nt.yaw.         
+00014b80: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
+00014b90: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
+00014ba0: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
+00014bb0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
+00014bc0: 6d65 706f 696e 742e 7069 7463 680a 2020  mepoint.pitch.  
+00014bd0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00014be0: 2020 7265 732e 7772 6974 6528 225c 7422    res.write("\t"
+00014bf0: 2b73 7472 2876 616c 2929 0a20 2020 2020  +str(val)).     
+00014c00: 2020 2020 2020 2020 2020 2020 2020 2076                 v
+00014c10: 616c 203d 2074 696d 6570 6f69 6e74 2e72  al = timepoint.r
+00014c20: 6f6c 6c0a 2020 2020 2020 2020 2020 2020  oll.            
+00014c30: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00014c40: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
+00014c50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014c60: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00014c70: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
+00014c80: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
+00014c90: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00014ca0: 726f 762e 6164 6441 7267 756d 656e 7428  rov.addArgument(
+00014cb0: 2269 6e70 7574 4174 7469 7475 6465 4669  "inputAttitudeFi
+00014cc0: 6c65 222c 6174 745f 7061 7468 2c6f 7665  le",att_path,ove
+00014cd0: 7277 7269 7465 3d54 7275 6529 0a20 2020  rwrite=True).   
+00014ce0: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00014cf0: 6f76 2e6c 6f67 2822 7061 7273 6564 2066  ov.log("parsed f
+00014d00: 726f 6d20 696e 7075 7441 7474 6974 7564  rom inputAttitud
+00014d10: 6546 696c 653a 2022 202b 2073 7472 2866  eFile: " + str(f
+00014d20: 7261 6d65 5f61 7474 5f68 6561 6465 7229  rame_att_header)
+00014d30: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00014d40: 2020 2020 2020 2020 2020 2020 7365 6c66              self
+00014d50: 2e61 6464 5f69 7465 6d5f 696e 666f 5f74  .add_item_info_t
+00014d60: 6162 5f66 696c 6528 696e 745f 6174 7475  ab_file(int_attu
+00014d70: 7475 6465 5f66 696c 652c 225c 7422 2c6f  tude_file,"\t",o
+00014d80: 7574 7075 745f 6865 6164 6572 5f61 7474  utput_header_att
+00014d90: 290a 0a20 2020 2020 2020 2020 2020 2023  )..            #
+00014da0: 2057 7269 7465 2074 6f20 706f 7365 2074   Write to pose t
+00014db0: 7874 2066 696c 650a 2020 2020 2020 2020  xt file.        
+00014dc0: 2020 2020 2320 6865 6164 6572 0a20 2020      # header.   
+00014dd0: 2020 2020 2020 2020 2072 6573 203d 206f           res = o
+00014de0: 7065 6e28 696e 745f 706f 7365 5f66 696c  pen(int_pose_fil
+00014df0: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
+00014e00: 2020 2020 7265 732e 7772 6974 6528 6d69      res.write(mi
+00014e10: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
+00014e20: 6d61 7269 7174 275d 5b27 696d 6727 5d2b  mariqt']['img']+
+00014e30: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
+00014e40: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
+00014e50: 2775 7463 275d 290a 2020 2020 2020 2020  'utc']).        
+00014e60: 2020 2020 7265 732e 7772 6974 6528 225c      res.write("\
+00014e70: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+00014e80: 6465 725b 276d 6172 6971 7427 5d5b 2770  der['mariqt']['p
+00014e90: 6f73 6527 5d29 0a20 2020 2020 2020 2020  ose']).         
+00014ea0: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
+00014eb0: 2229 0a20 2020 2020 2020 2020 2020 2023  ").            #
+00014ec0: 2064 6174 6120 6c69 6e65 730a 2020 2020   data lines.    
+00014ed0: 2020 2020 2020 2020 6920 3d20 300a 2020          i = 0.  
+00014ee0: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
+00014ef0: 6c65 2069 6e20 696d 6167 655f 6474 733a  le in image_dts:
+00014f00: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00014f10: 2066 6f72 2074 696d 6570 6f69 6e74 2069   for timepoint i
+00014f20: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+00014f30: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00014f40: 2020 2020 2020 2069 6620 525f 6361 6d32         if R_cam2
+00014f50: 7574 6d5f 6c69 7374 5b69 5d20 3d3d 2022  utm_list[i] == "
+00014f60: 223a 0a20 2020 2020 2020 2020 2020 2020  ":.             
+00014f70: 2020 2020 2020 2020 2020 2069 202b 3d20             i += 
+00014f80: 310a 2020 2020 2020 2020 2020 2020 2020  1.              
+00014f90: 2020 2020 2020 2020 2020 636f 6e74 696e            contin
+00014fa0: 7565 0a20 2020 2020 2020 2020 2020 2020  ue.             
+00014fb0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00014fc0: 2866 696c 652b 225c 7422 2b74 696d 6570  (file+"\t"+timep
+00014fd0: 6f69 6e74 2e64 6174 6554 696d 6528 292e  oint.dateTime().
+00014fe0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
+00014ff0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
+00015000: 6971 7427 5d29 2920 0a20 2020 2020 2020  iqt'])) .       
+00015010: 2020 2020 2020 2020 2020 2020 2065 6e74               ent
+00015020: 7279 203d 2073 7472 287b 2770 6f73 652d  ry = str({'pose-
+00015030: 6162 736f 6c75 7465 2d6f 7269 656e 7461  absolute-orienta
+00015040: 7469 6f6e 2d75 746d 2d6d 6174 7269 7827  tion-utm-matrix'
+00015050: 3a52 5f63 616d 3275 746d 5f6c 6973 745b  :R_cam2utm_list[
+00015060: 695d 7d29 2e72 6570 6c61 6365 2827 5c6e  i]}).replace('\n
+00015070: 272c 2727 290a 2020 2020 2020 2020 2020  ','').          
+00015080: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00015090: 6974 6528 225c 7422 2b65 6e74 7279 290a  ite("\t"+entry).
+000150a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000150b0: 2020 2020 6920 2b3d 2031 0a20 2020 2020      i += 1.     
+000150c0: 2020 2020 2020 2020 2020 2020 2020 2072                 r
+000150d0: 6573 2e77 7269 7465 2822 5c6e 2229 0a20  es.write("\n"). 
+000150e0: 2020 2020 2020 2020 2020 2072 6573 2e63             res.c
+000150f0: 6c6f 7365 2829 0a20 2020 2020 2020 2020  lose().         
+00015100: 2020 2073 656c 662e 6164 645f 6974 656d     self.add_item
+00015110: 5f69 6e66 6f5f 7461 625f 6669 6c65 2869  _info_tab_file(i
+00015120: 6e74 5f70 6f73 655f 6669 6c65 2c22 5c74  nt_pose_file,"\t
+00015130: 222c 6f75 7470 7574 5f68 6561 6465 725f  ",output_header_
+00015140: 706f 7365 290a 2020 2020 2020 2020 2020  pose).          
+00015150: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
+00015160: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00015170: 7565 2c20 2241 7474 6974 7564 6520 6461  ue, "Attitude da
+00015180: 7461 2063 7265 6174 6564 2220 2b20 7061  ta created" + pa
+00015190: 7273 654d 7367 0a20 2020 2020 2020 2065  rseMsg.        e
+000151a0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
+000151b0: 2073 2e73 746f 7028 290a 2020 2020 2020   s.stop().      
+000151c0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+000151d0: 7365 2c20 224e 6f20 696d 6167 6520 6174  se, "No image at
+000151e0: 7469 7475 6465 7320 666f 756e 6422 202b  titudes found" +
+000151f0: 2070 6172 7365 4d73 670a 2020 2020 2020   parseMsg.      
+00015200: 2020 0a20 2020 2020 2020 200a 2020 2020    .        .    
+00015210: 6465 6620 6372 6561 7465 496d 6167 6541  def createImageA
+00015220: 7474 6974 7564 6546 696c 6528 7365 6c66  ttitudeFile(self
+00015230: 2c20 6174 745f 7061 7468 3a73 7472 2c20  , att_path:str, 
+00015240: 6672 616d 655f 6174 745f 6865 6164 6572  frame_att_header
+00015250: 3a64 6963 742c 2063 616d 6572 6132 4672  :dict, camera2Fr
+00015260: 616d 655f 7961 773a 666c 6f61 742c 6361  ame_yaw:float,ca
+00015270: 6d65 7261 3246 7261 6d65 5f70 6974 6368  mera2Frame_pitch
+00015280: 3a66 6c6f 6174 2c63 616d 6572 6132 4672  :float,camera2Fr
+00015290: 616d 655f 726f 6c6c 3a66 6c6f 6174 2c0a  ame_roll:float,.
+000152a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000152c0: 6461 7465 5f66 6f72 6d61 743d 6d69 7174  date_format=miqt
+000152d0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+000152e0: 7061 6e67 6165 6127 5d2c 2063 6f6e 7374  pangaea'], const
+000152f0: 5f76 616c 7565 7320 3d20 7b7d 2c20 6f76  _values = {}, ov
+00015300: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
+00015310: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
+00015320: 5c74 222c 0a20 2020 2020 2020 2020 2020  \t",.           
+00015330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015340: 2020 2020 2061 7474 5f70 6174 685f 616e       att_path_an
+00015350: 676c 6573 5f69 6e5f 7261 6420 3d20 4661  gles_in_rad = Fa
+00015360: 6c73 652c 2076 6964 656f 5361 6d70 6c65  lse, videoSample
+00015370: 5365 636f 6e64 733d 312c 7265 636f 7264  Seconds=1,record
+00015380: 7332 6265 496e 7665 7274 6564 3d5b 5d29  s2beInverted=[])
+00015390: 3a0a 2020 2020 2020 2020 2222 2220 4465  :.        """ De
+000153a0: 7072 6563 6174 6465 202d 2075 7365 2063  precatde - use c
+000153b0: 7265 6174 655f 696d 6167 655f 6174 7469  reate_image_atti
+000153c0: 7475 6465 5f66 696c 6520 2222 220a 2020  tude_file """.  
+000153d0: 2020 2020 2020 7265 7475 726e 2073 656c        return sel
+000153e0: 662e 6372 6561 7465 5f69 6d61 6765 5f61  f.create_image_a
+000153f0: 7474 6974 7564 655f 6669 6c65 2861 7474  ttitude_file(att
+00015400: 5f70 6174 682c 2066 7261 6d65 5f61 7474  _path, frame_att
+00015410: 5f68 6561 6465 722c 2063 616d 6572 6132  _header, camera2
+00015420: 4672 616d 655f 7961 772c 2063 616d 6572  Frame_yaw, camer
+00015430: 6132 4672 616d 655f 7069 7463 682c 2063  a2Frame_pitch, c
+00015440: 616d 6572 6132 4672 616d 655f 726f 6c6c  amera2Frame_roll
+00015450: 2c20 0a20 2020 2020 2020 2020 2020 2020  , .             
+00015460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015470: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015480: 2020 6461 7465 5f66 6f72 6d61 742c 2063    date_format, c
+00015490: 6f6e 7374 5f76 616c 7565 732c 206f 7665  onst_values, ove
+000154a0: 7277 7269 7465 2c20 636f 6c5f 7365 7061  rwrite, col_sepa
+000154b0: 7261 746f 722c 2061 7474 5f70 6174 685f  rator, att_path_
+000154c0: 616e 676c 6573 5f69 6e5f 7261 642c 2076  angles_in_rad, v
+000154d0: 6964 656f 5361 6d70 6c65 5365 636f 6e64  ideoSampleSecond
+000154e0: 732c 0a20 2020 2020 2020 2020 2020 2020  s,.             
+000154f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015510: 2020 7265 636f 7264 7332 6265 496e 7665    records2beInve
+00015520: 7274 6564 290a 2020 2020 2020 2020 0a0a  rted).        ..
+00015530: 2020 2020 6465 6620 6765 745f 525f 6361      def get_R_ca
+00015540: 6d53 7464 3275 746d 2873 656c 662c 525f  mStd2utm(self,R_
+00015550: 6361 6d32 6672 616d 653a 6e70 2e61 7272  cam2frame:np.arr
+00015560: 6179 2c52 5f66 7261 6d65 326e 6564 3a6e  ay,R_frame2ned:n
+00015570: 702e 6172 7261 7929 3a0a 2020 2020 2020  p.array):.      
+00015580: 2020 2222 2220 7265 7472 756e 2072 6f74    """ retrun rot
+00015590: 6174 696f 6e20 6d61 7472 6978 2052 2074  ation matrix R t
+000155a0: 7261 6e66 6f72 6d69 6e67 2066 726f 6d20  ranforming from 
+000155b0: 6361 6d53 7464 3a20 2878 2c79 2c7a 203d  camStd: (x,y,z =
+000155c0: 2072 6967 6874 2c62 7574 746f 6d2c 6c69   right,buttom,li
+000155d0: 6e65 206f 6620 7369 6768 7429 2074 6f20  ne of sight) to 
+000155e0: 7574 6d20 2878 2c79 2c7a 203d 2065 6173  utm (x,y,z = eas
+000155f0: 7469 6e67 2c6e 6f72 7468 696e 672c 7570  ting,northing,up
+00015600: 2920 2222 220a 2020 2020 2020 2020 525f  ) """.        R_
+00015610: 6361 6d69 4644 4f32 6361 6d53 7464 203d  camiFDO2camStd =
+00015620: 206d 6971 7467 2e52 5f59 6177 5069 7463   miqtg.R_YawPitc
+00015630: 6852 6f6c 6c28 3930 2c30 2c30 2920 2320  hRoll(90,0,0) # 
+00015640: 696e 2069 4644 4f20 6361 6d3a 2028 782c  in iFDO cam: (x,
+00015650: 792c 7a20 3d20 746f 702c 7269 6768 742c  y,z = top,right,
+00015660: 6c69 6e65 206f 6620 7369 6768 7429 2062  line of sight) b
+00015670: 7574 2066 6f72 2070 6f73 6520 7468 6520  ut for pose the 
+00015680: 2773 7461 6e64 6172 6427 2063 616d 5374  'standard' camSt
+00015690: 643a 2028 782c 792c 7a20 3d20 7269 6768  d: (x,y,z = righ
+000156a0: 742c 6275 7474 6f6d 2c6c 696e 6520 6f66  t,buttom,line of
+000156b0: 2073 6967 6874 2920 6973 2065 7870 6563   sight) is expec
+000156c0: 7465 640a 2020 2020 2020 2020 525f 6361  ted.        R_ca
+000156d0: 6d53 7464 3266 7261 6d65 203d 2052 5f63  mStd2frame = R_c
+000156e0: 616d 3266 7261 6d65 2e64 6f74 2852 5f63  am2frame.dot(R_c
+000156f0: 616d 6946 444f 3263 616d 5374 6429 0a20  amiFDO2camStd). 
+00015700: 2020 2020 2020 2052 5f63 616d 5374 6432         R_camStd2
+00015710: 6e65 6420 3d20 525f 6672 616d 6532 6e65  ned = R_frame2ne
+00015720: 642e 646f 7428 525f 6361 6d53 7464 3266  d.dot(R_camStd2f
+00015730: 7261 6d65 290a 2020 2020 2020 2020 525f  rame).        R_
+00015740: 6e65 6432 7574 6d20 3d20 6d69 7174 672e  ned2utm = miqtg.
+00015750: 525f 5859 5a28 3138 302c 302c 3930 2920  R_XYZ(180,0,90) 
+00015760: 2320 7769 7468 2075 746d 2078 2c79 2c7a  # with utm x,y,z
+00015770: 203d 2065 6173 7469 6e67 2c6e 6f72 7468   = easting,north
+00015780: 696e 672c 7570 0a20 2020 2020 2020 2052  ing,up.        R
+00015790: 5f63 616d 5374 6432 7574 6d20 3d20 525f  _camStd2utm = R_
+000157a0: 6e65 6432 7574 6d2e 646f 7428 525f 6361  ned2utm.dot(R_ca
+000157b0: 6d53 7464 326e 6564 292e 726f 756e 6428  mStd2ned).round(
+000157c0: 3529 0a20 2020 2020 2020 2072 6574 7572  5).        retur
+000157d0: 6e20 525f 6361 6d53 7464 3275 746d 0a0a  n R_camStd2utm..
+000157e0: 0a20 2020 2064 6566 2066 696e 644e 6176  .    def findNav
+000157f0: 4461 7461 466f 7249 6d61 6765 2873 656c  DataForImage(sel
+00015800: 662c 6461 7461 3a6d 6971 7467 2e4e 756d  f,data:miqtg.Num
+00015810: 4461 7461 5469 6d65 5374 616d 7065 642c  DataTimeStamped,
+00015820: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
+00015830: 6473 3d31 293a 0a20 2020 2020 2020 2022  ds=1):.        "
+00015840: 2222 2063 7265 6174 6573 2061 2064 6963  "" creates a dic
+00015850: 7420 2869 6d61 6765 5f64 7473 2920 7769  t (image_dts) wi
+00015860: 7468 2066 696c 6520 6e61 6d65 2061 7320  th file name as 
+00015870: 6b65 7920 616e 6420 6120 6c69 7374 206f  key and a list o
+00015880: 6620 6461 7461 2065 6c65 6d65 6e74 7320  f data elements 
+00015890: 6173 2076 616c 7565 2e20 0a20 2020 2020  as value. .     
+000158a0: 2020 2020 2020 2049 6e20 6361 7365 206f         In case o
+000158b0: 6620 7068 6f74 6f73 2074 6865 206c 6973  f photos the lis
+000158c0: 7420 6861 7320 6f6e 6c79 2061 2073 696e  t has only a sin
+000158d0: 676c 6520 656e 7472 792c 2066 6f72 2076  gle entry, for v
+000158e0: 6964 656f 7320 6974 2068 6173 2076 6964  ideos it has vid
+000158f0: 656f 2064 7572 6174 696f 6e20 5b73 6563  eo duration [sec
+00015900: 5d20 2f20 7669 6465 6f53 616d 706c 6553  ] / videoSampleS
+00015910: 6563 6f6e 6473 2065 6e74 7269 6573 2e0a  econds entries..
+00015920: 2020 2020 2020 2020 2020 2020 5265 7475              Retu
+00015930: 726e 7320 7375 6363 6573 732c 2069 6d61  rns success, ima
+00015940: 6765 5f64 7473 2c20 6d73 6720 2222 220a  ge_dts, msg """.
+00015950: 0a20 2020 2020 2020 2069 6620 7669 6465  .        if vide
+00015960: 6f53 616d 706c 6553 6563 6f6e 6473 203c  oSampleSeconds <
+00015970: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
+00015980: 2072 6169 7365 2045 7863 6570 7469 6f6e   raise Exception
+00015990: 2822 6669 6e64 4e61 7644 6174 6146 6f72  ("findNavDataFor
+000159a0: 496d 6167 653a 2076 6964 656f 5361 6d70  Image: videoSamp
+000159b0: 6c65 5365 636f 6e64 7320 6d75 7374 2062  leSeconds must b
+000159c0: 6520 6772 6561 7465 7220 3022 290a 0a20  e greater 0").. 
+000159d0: 2020 2020 2020 2023 2063 7265 6174 6520         # create 
+000159e0: 736f 7274 6564 2074 696d 6520 706f 696e  sorted time poin
+000159f0: 7473 0a20 2020 2020 2020 2074 696d 655f  ts.        time_
+00015a00: 706f 696e 7473 203d 206c 6973 7428 6461  points = list(da
+00015a10: 7461 2e6b 6579 7328 2929 0a20 2020 2020  ta.keys()).     
+00015a20: 2020 2074 696d 655f 706f 696e 7473 2e73     time_points.s
+00015a30: 6f72 7428 290a 2020 2020 2020 2020 756e  ort().        un
+00015a40: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
+00015a50: 7320 3d20 5b5d 0a20 2020 2020 2020 2069  s = [].        i
+00015a60: 6d61 6765 5f64 7473 203d 207b 7d0a 2020  mage_dts = {}.  
+00015a70: 2020 2020 2020 7374 6172 7453 6561 7263        startSearc
+00015a80: 6849 6e64 6578 203d 2030 0a20 2020 2020  hIndex = 0.     
+00015a90: 2020 2069 6d61 6765 7349 6e52 6177 203d     imagesInRaw =
+00015aa0: 2020 7365 6c66 2e69 6d61 6765 7349 6e49    self.imagesInI
+00015ab0: 6d61 6765 7344 6972 2829 0a20 2020 2020  magesDir().     
+00015ac0: 2020 2069 6d61 6765 7349 6e52 6177 536f     imagesInRawSo
+00015ad0: 7274 6564 4c69 7374 203d 2073 656c 662e  rtedList = self.
+00015ae0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+00015af0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
+00015b00: 2020 2020 2020 7072 6f67 203d 206d 6971        prog = miq
+00015b10: 7463 2e50 7269 6e74 4b6e 6f77 6e50 726f  tc.PrintKnownPro
+00015b20: 6772 6573 734d 7367 2822 496e 7465 7270  gressMsg("Interp
+00015b30: 6f6c 6174 696e 6720 6e61 7669 6761 7469  olating navigati
+00015b40: 6f6e 2066 6f72 2069 6d61 6765 222c 206c  on for image", l
+00015b50: 656e 2869 6d61 6765 7349 6e52 6177 292c  en(imagesInRaw),
+00015b60: 6d6f 6475 6c6f 3d31 290a 2020 2020 2020  modulo=1).      
+00015b70: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+00015b80: 6167 6573 496e 5261 7753 6f72 7465 644c  agesInRawSortedL
+00015b90: 6973 743a 0a20 2020 2020 2020 2020 2020  ist:.           
+00015ba0: 2070 726f 672e 7072 6f67 7265 7373 2829   prog.progress()
+00015bb0: 0a20 2020 2020 2020 2020 2020 2066 696c  .            fil
+00015bc0: 655f 6e61 6d65 203d 206f 732e 7061 7468  e_name = os.path
+00015bd0: 2e62 6173 656e 616d 6528 6669 6c65 290a  .basename(file).
+00015be0: 0a20 2020 2020 2020 2020 2020 2064 745f  .            dt_
+00015bf0: 696d 6167 6520 3d20 6d69 7174 632e 7061  image = miqtc.pa
+00015c00: 7273 6546 696c 6544 6174 6554 696d 6541  rseFileDateTimeA
+00015c10: 7355 5443 2866 696c 655f 6e61 6d65 290a  sUTC(file_name).
+00015c20: 2020 2020 2020 2020 2020 2020 6474 5f69              dt_i
+00015c30: 6d61 6765 5f74 7320 3d20 696e 7428 6474  mage_ts = int(dt
+00015c40: 5f69 6d61 6765 2e74 696d 6573 7461 6d70  _image.timestamp
+00015c50: 2829 202a 2031 3030 3029 0a0a 2020 2020  () * 1000)..    
+00015c60: 2020 2020 2020 2020 7275 6e54 696d 6520          runTime 
+00015c70: 3d20 696d 6167 6573 496e 5261 775b 6669  = imagesInRaw[fi
+00015c80: 6c65 5d5b 315d 2023 202d 3120 666f 7220  le][1] # -1 for 
+00015c90: 7068 6f74 6f73 0a20 2020 2020 2020 2020  photos.         
+00015ca0: 2020 2023 2076 6964 656f 0a20 2020 2020     # video.     
+00015cb0: 2020 2020 2020 2069 6620 696d 6167 6573         if images
+00015cc0: 496e 5261 775b 6669 6c65 5d5b 325d 2069  InRaw[file][2] i
+00015cd0: 6e20 6d69 7174 762e 7669 6465 6f5f 7479  n miqtv.video_ty
+00015ce0: 7065 7320 616e 6420 7275 6e54 696d 6520  pes and runTime 
+00015cf0: 3c3d 2030 3a20 2320 6578 740a 2020 2020  <= 0: # ext.    
+00015d00: 2020 2020 2020 2020 2020 2020 7072 696e              prin
+00015d10: 7428 2243 6175 7469 6f6e 2120 436f 756c  t("Caution! Coul
+00015d20: 6420 6e6f 7420 7265 6164 2076 6964 656f  d not read video
+00015d30: 2072 756e 2074 696d 6520 6672 6f6d 2066   run time from f
+00015d40: 696c 6522 2c66 696c 6529 2023 2054 4f44  ile",file) # TOD
+00015d50: 4f20 646f 6573 2074 6869 7320 6861 7070  O does this happ
+00015d60: 656e 3f20 4861 6e64 6c65 2062 6574 7465  en? Handle bette
+00015d70: 723f 0a0a 2020 2020 2020 2020 2020 2020  r?..            
+00015d80: 7361 6d70 6c65 5469 6d65 5365 6373 203d  sampleTimeSecs =
+00015d90: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
+00015da0: 6f73 5f6c 6973 7420 3d20 5b5d 0a20 2020  os_list = [].   
+00015db0: 2020 2020 2020 2020 2067 6f20 3d20 5472           go = Tr
+00015dc0: 7565 0a20 2020 2020 2020 2020 2020 2077  ue.            w
+00015dd0: 6869 6c65 2067 6f3a 0a20 2020 2020 2020  hile go:.       
+00015de0: 2020 2020 2020 2020 2074 7279 3a20 2020           try:   
 00015df0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e00: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00015e10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e20: 706f 735f 6c69 7374 2e61 7070 656e 6428  pos_list.append(
-00015e30: 706f 7329 0a20 2020 2020 2020 2020 2020  pos).           
-00015e40: 2020 2020 2065 7863 6570 7420 4578 6365       except Exce
-00015e50: 7074 696f 6e20 6173 2065 3a0a 2020 2020  ption as e:.    
-00015e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00015e70: 7265 7475 726e 2046 616c 7365 2c20 696d  return False, im
-00015e80: 6167 655f 6474 732c 2022 436f 756c 6420  age_dts, "Could 
-00015e90: 6e6f 7420 6669 6e64 2069 6d61 6765 2074  not find image t
-00015ea0: 696d 6520 222b 2064 6174 6574 696d 652e  ime "+ datetime.
-00015eb0: 6461 7465 7469 6d65 2e75 7463 6672 6f6d  datetime.utcfrom
-00015ec0: 7469 6d65 7374 616d 7028 2864 745f 696d  timestamp((dt_im
-00015ed0: 6167 655f 7473 202b 2073 616d 706c 6554  age_ts + sampleT
-00015ee0: 696d 6553 6563 7320 2a20 3130 3030 292f  imeSecs * 1000)/
-00015ef0: 3130 3030 292e 7374 7266 7469 6d65 286d  1000).strftime(m
-00015f00: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00015f10: 735b 276d 6172 6971 7427 5d29 202b 2220  s['mariqt']) +" 
-00015f20: 696e 2022 2b73 7472 2864 6174 612e 6c65  in "+str(data.le
-00015f30: 6e28 2929 2b22 2064 6174 6120 706f 7369  n())+" data posi
-00015f40: 7469 6f6e 7322 202b 2073 7472 2865 2e61  tions" + str(e.a
-00015f50: 7267 7329 0a20 2020 2020 2020 2020 2020  rgs).           
-00015f60: 2020 2020 2073 616d 706c 6554 696d 6553       sampleTimeS
-00015f70: 6563 7320 2b3d 2076 6964 656f 5361 6d70  ecs += videoSamp
-00015f80: 6c65 5365 636f 6e64 730a 2020 2020 2020  leSeconds.      
-00015f90: 2020 2020 2020 2020 2020 6966 2073 616d            if sam
-00015fa0: 706c 6554 696d 6553 6563 7320 3e20 7275  pleTimeSecs > ru
-00015fb0: 6e54 696d 653a 0a20 2020 2020 2020 2020  nTime:.         
-00015fc0: 2020 2020 2020 2020 2020 2067 6f20 3d20             go = 
-00015fd0: 4661 6c73 650a 2020 2020 2020 2020 2020  False.          
-00015fe0: 2020 0a20 2020 2020 2020 2020 2020 2069    .            i
-00015ff0: 6d61 6765 5f64 7473 5b66 696c 655f 6e61  mage_dts[file_na
-00016000: 6d65 5d20 3d20 706f 735f 6c69 7374 0a20  me] = pos_list. 
-00016010: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-00016020: 7228 290a 2020 2020 2020 2020 7265 7475  r().        retu
-00016030: 726e 4d73 6720 3d20 2222 0a20 2020 2020  rnMsg = "".     
-00016040: 2020 2069 6620 6c65 6e28 756e 6d61 7463     if len(unmatc
-00016050: 6865 6454 696d 6550 6f69 6e74 7329 2021  hedTimePoints) !
-00016060: 3d20 303a 0a20 2020 2020 2020 2020 2020  = 0:.           
-00016070: 2075 6e6d 6174 6368 6564 5469 6d65 506f   unmatchedTimePo
-00016080: 696e 7473 2e73 6f72 7428 290a 2020 2020  ints.sort().    
-00016090: 2020 2020 2020 2020 756e 6d61 7463 6865          unmatche
-000160a0: 6454 696d 6550 6f69 6e74 7320 3d20 5b64  dTimePoints = [d
-000160b0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-000160c0: 2e75 7463 6672 6f6d 7469 6d65 7374 616d  .utcfromtimestam
-000160d0: 7028 7473 292e 7374 7266 7469 6d65 286d  p(ts).strftime(m
-000160e0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-000160f0: 735b 276d 6172 6971 7427 5d29 2066 6f72  s['mariqt']) for
-00016100: 2074 7320 696e 2075 6e6d 6174 6368 6564   ts in unmatched
-00016110: 5469 6d65 506f 696e 7473 5d0a 2020 2020  TimePoints].    
-00016120: 2020 2020 2020 2020 7265 7475 726e 4d73          returnMs
-00016130: 6720 3d20 2243 6175 7469 6f6e 2120 4e61  g = "Caution! Na
-00016140: 7669 6761 7469 6f6e 206e 6f74 2066 6f75  vigation not fou
-00016150: 6e64 2066 6f72 2074 6865 2066 6f6c 6c6f  nd for the follo
-00016160: 7769 6e67 2069 6d61 6765 2074 696d 6520  wing image time 
-00016170: 706f 696e 7473 2e20 446f 7562 6c65 2063  points. Double c
-00016180: 6865 636b 206f 7220 7072 6f76 6964 6520  heck or provide 
-00016190: 6174 206c 6561 7374 2073 7461 7469 6320  at least static 
-000161a0: 6465 6661 756c 7420 6e61 7669 6761 7469  default navigati
-000161b0: 6f6e 2069 6e20 6865 6164 6572 2066 6965  on in header fie
-000161c0: 6c64 732e 220a 2020 2020 2020 2020 2020  lds.".          
-000161d0: 2020 7265 7475 726e 4d73 6720 2b3d 2022    returnMsg += "
-000161e0: 5c6e 2220 2b20 225c 6e22 2e6a 6f69 6e28  \n" + "\n".join(
-000161f0: 756e 6d61 7463 6865 6454 696d 6550 6f69  unmatchedTimePoi
-00016200: 6e74 7329 0a20 2020 2020 2020 2072 6574  nts).        ret
-00016210: 7572 6e20 5472 7565 2c20 696d 6167 655f  urn True, image_
-00016220: 6474 732c 2072 6574 7572 6e4d 7367 0a0a  dts, returnMsg..
-00016230: 0a20 2020 2064 6566 2063 7265 6174 655f  .    def create_
-00016240: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
-00016250: 5f66 696c 6528 7365 6c66 2c20 6e61 765f  _file(self, nav_
-00016260: 7061 7468 3a20 7374 722c 206e 6176 5f68  path: str, nav_h
-00016270: 6561 6465 723d 6d69 7174 762e 706f 735f  eader=miqtv.pos_
-00016280: 6865 6164 6572 5b27 7061 6e67 6165 6127  header['pangaea'
-00016290: 5d2c 2064 6174 655f 666f 726d 6174 3d6d  ], date_format=m
-000162a0: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-000162b0: 735b 2770 616e 6761 6561 275d 2c20 6f76  s['pangaea'], ov
-000162c0: 6572 7772 6974 653d 4661 6c73 652c 2063  erwrite=False, c
-000162d0: 6f6c 5f73 6570 6172 6174 6f72 203d 2022  ol_separator = "
-000162e0: 5c74 222c 2076 6964 656f 5361 6d70 6c65  \t", videoSample
-000162f0: 5365 636f 6e64 733d 312c 0a20 2020 2020  Seconds=1,.     
-00016300: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016310: 2020 2020 2020 2020 2020 2020 2020 206f                 o
-00016320: 6666 7365 745f 783d 302c 206f 6666 7365  ffset_x=0, offse
-00016330: 745f 793d 302c 206f 6666 7365 745f 7a3d  t_y=0, offset_z=
-00016340: 302c 616e 676c 6573 5f69 6e5f 7261 6420  0,angles_in_rad 
-00016350: 3d20 4661 6c73 652c 2072 6563 6f72 6473  = False, records
-00016360: 3262 6549 6e76 6572 7465 643d 5b5d 293a  2beInverted=[]):
-00016370: 0a20 2020 2020 2020 2022 2222 2043 7265  .        """ Cre
-00016380: 6174 6573 2069 6e20 2f69 6e74 6572 6d65  ates in /interme
-00016390: 6469 6174 6520 6120 7465 7874 2066 696c  diate a text fil
-000163a0: 6520 7769 7468 2034 2e35 4420 6e61 7669  e with 4.5D navi
-000163b0: 6761 7469 6f6e 2064 6174 6120 666f 7220  gation data for 
-000163c0: 6561 6368 2069 6d61 6765 2c20 692e 652e  each image, i.e.
-000163d0: 2061 2073 696e 676c 6520 726f 7720 7065   a single row pe
-000163e0: 7220 7068 6f74 6f2c 2076 6964 656f 2064  r photo, video d
-000163f0: 7572 6174 696f 6e20 5b73 6563 5d20 2f20  uration [sec] / 
-00016400: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-00016410: 6473 2072 6f77 7320 7065 7220 7669 6465  ds rows per vide
-00016420: 6f2e 0a20 2020 2020 2020 2020 2020 206e  o..            n
-00016430: 6176 5f68 6561 6465 7220 6d75 7374 2062  av_header must b
-00016440: 6520 6469 6374 2063 6f6e 7461 696e 696e  e dict containin
-00016450: 6720 7468 6520 6b65 7973 2027 7574 6327  g the keys 'utc'
-00016460: 2c27 6c61 7427 2c27 6c6f 6e27 2c27 6465  ,'lat','lon','de
-00016470: 7027 286f 7220 2761 6c74 2729 2c20 6f70  p'(or 'alt'), op
-00016480: 7469 6f6e 616c 3a20 2768 6774 272c 2775  tional: 'hgt','u
-00016490: 6e63 6572 7427 2077 6974 6820 7468 6520  ncert' with the 
-000164a0: 7265 7370 6563 7469 7665 2063 6f6c 756d  respective colum
-000164b0: 6e20 6865 6164 6572 7320 6173 2076 616c  n headers as val
-000164c0: 7565 7320 0a20 2020 2020 2020 2020 2020  ues .           
-000164d0: 2069 6620 6f6e 6520 6f66 2074 6865 2076   if one of the v
-000164e0: 6568 6963 6c65 2078 2c79 2c7a 206f 6666  ehicle x,y,z off
-000164f0: 7365 7473 205b 6d5d 2069 7320 6e6f 7420  sets [m] is not 
-00016500: 3020 616e 6420 6e61 765f 6865 6164 6572  0 and nav_header
-00016510: 2061 6c73 6f20 636f 6e74 6169 6e73 2027   also contains '
-00016520: 7961 7727 2c27 7069 7463 6827 2c27 726f  yaw','pitch','ro
-00016530: 6c6c 2720 6c65 7665 7261 726d 206f 6666  ll' leverarm off
-00016540: 7365 7473 2061 7265 2063 6f6d 7065 6e73  sets are compens
-00016550: 6174 6564 2066 6f72 2022 2222 0a0a 2020  ated for """..  
-00016560: 2020 2020 2020 6966 2073 656c 662e 696e        if self.in
-00016570: 7465 726d 6564 6961 7465 4e61 7646 696c  termediateNavFil
-00016580: 6545 7869 7374 7328 2920 616e 6420 6e6f  eExists() and no
-00016590: 7420 6f76 6572 7772 6974 653a 0a20 2020  t overwrite:.   
-000165a0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
-000165b0: 5472 7565 2c20 224f 7574 7075 7420 6669  True, "Output fi
-000165c0: 6c65 2065 7869 7374 733a 2022 2b73 656c  le exists: "+sel
-000165d0: 662e 6765 745f 696e 745f 6e61 765f 6669  f.get_int_nav_fi
-000165e0: 6c65 2829 0a0a 2020 2020 2020 2020 6966  le()..        if
-000165f0: 206e 6f74 206f 732e 7061 7468 2e65 7869   not os.path.exi
-00016600: 7374 7328 6e61 765f 7061 7468 293a 0a20  sts(nav_path):. 
-00016610: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00016620: 6e20 4661 6c73 652c 2022 4e61 7669 6761  n False, "Naviga
-00016630: 7469 6f6e 2066 696c 6520 6e6f 7420 666f  tion file not fo
-00016640: 756e 643a 2022 2b6e 6176 5f70 6174 680a  und: "+nav_path.
-00016650: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
-00016660: 6f73 2e70 6174 682e 6578 6973 7473 2873  os.path.exists(s
-00016670: 656c 662e 696d 6167 6573 4469 7229 3a0a  elf.imagesDir):.
-00016680: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016690: 726e 2046 616c 7365 2c20 2249 6d61 6765  rn False, "Image
-000166a0: 2066 6f6c 6465 7220 6e6f 7420 666f 756e   folder not foun
-000166b0: 643a 2022 2b20 7365 6c66 2e69 6d61 6765  d: "+ self.image
-000166c0: 7344 6972 0a0a 2020 2020 2020 2020 7320  sDir..        s 
-000166d0: 3d20 6d69 7174 632e 5072 696e 744c 6f61  = miqtc.PrintLoa
-000166e0: 6469 6e67 4d73 6728 2243 7265 6174 696e  dingMsg("Creatin
-000166f0: 6720 6974 656d 7327 206e 6176 6967 6174  g items' navigat
-00016700: 696f 6e20 6461 7461 2229 0a20 2020 2020  ion data").     
-00016710: 2020 2072 6574 7572 6e4d 7367 203d 2022     returnMsg = "
-00016720: 220a 2020 2020 2020 2020 636f 6d70 656e  ".        compen
-00016730: 7361 744f 6666 7365 7473 203d 2046 616c  satOffsets = Fal
-00016740: 7365 0a20 2020 2020 2020 2069 6620 286f  se.        if (o
-00016750: 6666 7365 745f 7821 3d30 206f 7220 6f66  ffset_x!=0 or of
-00016760: 6673 6574 5f79 213d 3020 6f72 206f 6666  fset_y!=0 or off
-00016770: 7365 745f 7a21 3d30 2920 616e 6420 2779  set_z!=0) and 'y
-00016780: 6177 2720 696e 206e 6176 5f68 6561 6465  aw' in nav_heade
-00016790: 7220 616e 6420 2770 6974 6368 2720 696e  r and 'pitch' in
-000167a0: 206e 6176 5f68 6561 6465 7220 616e 6420   nav_header and 
-000167b0: 2772 6f6c 6c27 2069 6e20 6e61 765f 6865  'roll' in nav_he
-000167c0: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-000167d0: 2020 636f 6d70 656e 7361 744f 6666 7365    compensatOffse
-000167e0: 7473 203d 2054 7275 650a 0a20 2020 2020  ts = True..     
-000167f0: 2020 2023 2063 6865 636b 2069 6620 666f     # check if fo
-00016800: 7220 6d69 7373 696e 6720 6669 656c 6473  r missing fields
-00016810: 2074 6865 7265 2061 7265 2063 6f6e 7374   there are const
-00016820: 2076 616c 7565 7320 696e 2068 6561 6465   values in heade
-00016830: 720a 2020 2020 2020 2020 636f 6e73 745f  r.        const_
-00016840: 7661 6c75 6573 203d 207b 7d0a 2020 2020  values = {}.    
-00016850: 2020 2020 666f 7220 6e61 7646 6965 6c64      for navField
-00016860: 2069 6e20 6d69 7174 762e 706f 735f 6865   in miqtv.pos_he
-00016870: 6164 6572 5b27 6d61 7269 7174 275d 3a0a  ader['mariqt']:.
-00016880: 2020 2020 2020 2020 2020 2020 7265 7370              resp
-00016890: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
-000168a0: 6420 3d20 6d69 7174 762e 636f 6c5f 6865  d = miqtv.col_he
-000168b0: 6164 6572 5b22 6d61 7269 7174 225d 5b6e  ader["mariqt"][n
-000168c0: 6176 4669 656c 645d 0a20 2020 2020 2020  avField].       
-000168d0: 2020 2020 2069 6620 6e61 7646 6965 6c64       if navField
-000168e0: 206e 6f74 2069 6e20 6e61 765f 6865 6164   not in nav_head
-000168f0: 6572 2061 6e64 2028 7265 7370 6563 7469  er and (respecti
-00016900: 7665 4865 6164 6572 4669 656c 6420 696e  veHeaderField in
-00016910: 2073 656c 662e 6966 646f 5f74 6d70 5b73   self.ifdo_tmp[s
-00016920: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
-00016930: 6572 4b65 795d 2061 6e64 2073 656c 662e  erKey] and self.
-00016940: 6669 6e64 546d 7046 6965 6c64 3228 7265  findTmpField2(re
-00016950: 7370 6563 7469 7665 4865 6164 6572 4669  spectiveHeaderFi
-00016960: 656c 6429 2021 3d20 2222 293a 200a 2020  eld) != ""): .  
-00016970: 2020 2020 2020 2020 2020 2020 2020 636f                co
-00016980: 6e73 745f 7661 6c75 6573 5b6e 6176 4669  nst_values[navFi
-00016990: 656c 645d 203d 2073 656c 662e 6669 6e64  eld] = self.find
-000169a0: 546d 7046 6965 6c64 2872 6573 7065 6374  TmpField(respect
-000169b0: 6976 6548 6561 6465 7246 6965 6c64 290a  iveHeaderField).
-000169c0: 0a20 2020 2020 2020 2020 2320 6861 6e64  .         # hand
-000169d0: 6c65 2061 6c74 2076 7320 6465 700a 2020  le alt vs dep.  
-000169e0: 2020 2020 2020 6966 2027 616c 7427 2069        if 'alt' i
-000169f0: 6e20 6e61 765f 6865 6164 6572 2061 6e64  n nav_header and
-00016a00: 2027 6465 7027 2069 6e20 6e61 765f 6865   'dep' in nav_he
-00016a10: 6164 6572 3a0a 2020 2020 2020 2020 2020  ader:.          
-00016a20: 2020 7261 6973 6520 6d69 7174 632e 4966    raise miqtc.If
-00016a30: 646f 4578 6365 7074 696f 6e28 2227 616c  doException("'al
-00016a40: 7427 2061 6e64 2027 6465 7027 2070 726f  t' and 'dep' pro
-00016a50: 7669 6465 642e 2052 6564 756e 6461 6e74  vided. Redundant
-00016a60: 2c20 616c 7420 3d20 2d20 6465 702e 2050  , alt = - dep. P
-00016a70: 726f 7669 6465 6420 6f6e 6c79 206f 6e65  rovided only one
-00016a80: 206f 6620 626f 7468 2e22 290a 2020 2020   of both.").    
-00016a90: 2020 2020 0a20 2020 2020 2020 2023 204c      .        # L
-00016aa0: 6f61 6420 6e61 7669 6761 7469 6f6e 2064  oad navigation d
-00016ab0: 6174 6120 2869 6620 2761 6c74 2720 696e  ata (if 'alt' in
-00016ac0: 7374 6561 6420 6f66 2027 6465 7027 2c20  stead of 'dep', 
-00016ad0: 6974 7320 6175 746f 6d61 7469 6361 6c6c  its automaticall
-00016ae0: 7920 696e 7665 7274 6564 290a 2020 2020  y inverted).    
-00016af0: 2020 2020 6e61 765f 6461 7461 2c20 7061      nav_data, pa
-00016b00: 7273 654d 7367 203d 206d 6971 746e 2e72  rseMsg = miqtn.r
-00016b10: 6561 6441 6c6c 506f 7369 7469 6f6e 7346  eadAllPositionsF
-00016b20: 726f 6d46 696c 6550 6174 6828 6e61 765f  romFilePath(nav_
-00016b30: 7061 7468 2c20 6e61 765f 6865 6164 6572  path, nav_header
-00016b40: 2c20 6461 7465 5f66 6f72 6d61 742c 636f  , date_format,co
-00016b50: 6c5f 7365 7061 7261 746f 723d 636f 6c5f  l_separator=col_
-00016b60: 7365 7061 7261 746f 722c 636f 6e73 745f  separator,const_
-00016b70: 7661 6c75 6573 3d63 6f6e 7374 5f76 616c  values=const_val
-00016b80: 7565 7329 0a20 2020 2020 2020 2069 6620  ues).        if 
-00016b90: 7061 7273 654d 7367 2021 3d20 2222 3a0a  parseMsg != "":.
-00016ba0: 2020 2020 2020 2020 2020 2020 7365 6c66              self
-00016bb0: 2e70 726f 762e 6c6f 6728 7061 7273 654d  .prov.log(parseM
-00016bc0: 7367 2c64 6f6e 7453 686f 773d 5472 7565  sg,dontShow=True
-00016bd0: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
-00016be0: 7475 726e 4d73 6720 3d20 225c 6e22 202b  turnMsg = "\n" +
-00016bf0: 2070 6172 7365 4d73 670a 0a20 2020 2020   parseMsg..     
-00016c00: 2020 2023 2066 696e 6420 666f 7220 6561     # find for ea
-00016c10: 6368 2069 6d61 6765 2074 6865 2072 6573  ch image the res
-00016c20: 7065 6374 6976 6520 6e61 7669 6761 7469  pective navigati
-00016c30: 6f6e 2064 6174 610a 2020 2020 2020 2020  on data.        
-00016c40: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00016c50: 2073 7563 6365 7373 2c20 696d 6167 655f   success, image_
-00016c60: 6474 732c 206d 7367 203d 2073 656c 662e  dts, msg = self.
-00016c70: 6669 6e64 4e61 7644 6174 6146 6f72 496d  findNavDataForIm
-00016c80: 6167 6528 6e61 765f 6461 7461 2c76 6964  age(nav_data,vid
-00016c90: 656f 5361 6d70 6c65 5365 636f 6e64 7329  eoSampleSeconds)
-00016ca0: 0a20 2020 2020 2020 2073 656c 662e 7072  .        self.pr
-00016cb0: 6f76 2e6c 6f67 286d 7367 2c64 6f6e 7453  ov.log(msg,dontS
-00016cc0: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
-00016cd0: 2020 6966 206d 7367 2021 3d20 2222 3a0a    if msg != "":.
-00016ce0: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-00016cf0: 726e 4d73 6720 2b3d 2022 5c6e 2220 2b20  rnMsg += "\n" + 
-00016d00: 6d73 670a 2020 2020 2020 2020 6966 206e  msg.        if n
-00016d10: 6f74 2073 7563 6365 7373 3a0a 2020 2020  ot success:.    
-00016d20: 2020 2020 2020 2020 7265 7475 726e 2046          return F
-00016d30: 616c 7365 2c20 7265 7475 726e 4d73 670a  alse, returnMsg.
-00016d40: 2020 2020 2020 2020 7320 3d20 6d69 7174          s = miqt
-00016d50: 632e 5072 696e 744c 6f61 6469 6e67 4d73  c.PrintLoadingMs
-00016d60: 6728 2243 7265 6174 696e 6720 6974 656d  g("Creating item
-00016d70: 7327 206e 6176 6967 6174 696f 6e20 6461  s' navigation da
-00016d80: 7461 2229 0a0a 2020 2020 2020 2020 2320  ta")..        # 
-00016d90: 696e 7665 7274 2076 616c 7565 7320 2869  invert values (i
-00016da0: 6620 6e65 6564 6564 2920 6265 666f 7265  f needed) before
-00016db0: 206c 6576 6572 6172 6d20 636f 6d70 656e   leverarm compen
-00016dc0: 7361 7469 6f6e 0a20 2020 2020 2020 2069  sation.        i
-00016dd0: 6620 7265 636f 7264 7332 6265 496e 7665  f records2beInve
-00016de0: 7274 6564 2021 3d20 5b5d 3a0a 2020 2020  rted != []:.    
-00016df0: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00016e00: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
-00016e10: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-00016e20: 6f73 6974 696f 6e73 203d 2069 6d61 6765  ositions = image
-00016e30: 5f64 7473 5b66 696c 655d 0a20 2020 2020  _dts[file].     
-00016e40: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00016e50: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
-00016e60: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
-00016e70: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-00016e80: 6620 276c 6174 2720 696e 2072 6563 6f72  f 'lat' in recor
-00016e90: 6473 3262 6549 6e76 6572 7465 643a 0a20  ds2beInverted:. 
-00016ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016eb0: 2020 2020 2020 2070 6f73 6974 696f 6e73         positions
-00016ec0: 5b69 5d2e 6c61 7420 2a3d 202d 310a 2020  [i].lat *= -1.  
-00016ed0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016ee0: 2020 6966 2027 6c6f 6e27 2069 6e20 7265    if 'lon' in re
-00016ef0: 636f 7264 7332 6265 496e 7665 7274 6564  cords2beInverted
-00016f00: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00016f10: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-00016f20: 6f6e 735b 695d 2e6c 6f6e 202a 3d20 2d31  ons[i].lon *= -1
-00016f30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00016f40: 2020 2020 2069 6620 2827 6465 7027 2069       if ('dep' i
-00016f50: 6e20 7265 636f 7264 7332 6265 496e 7665  n records2beInve
-00016f60: 7274 6564 2061 6e64 2027 6465 7027 2069  rted and 'dep' i
-00016f70: 6e20 6e61 765f 6865 6164 6572 2920 6f72  n nav_header) or
-00016f80: 2028 2761 6c74 2720 696e 2072 6563 6f72   ('alt' in recor
-00016f90: 6473 3262 6549 6e76 6572 7465 6420 616e  ds2beInverted an
-00016fa0: 6420 2761 6c74 2720 696e 206e 6176 5f68  d 'alt' in nav_h
-00016fb0: 6561 6465 7229 3a0a 2020 2020 2020 2020  eader):.        
-00016fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00016fd0: 706f 7369 7469 6f6e 735b 695d 2e64 6570  positions[i].dep
-00016fe0: 202a 3d20 2d31 0a20 2020 2020 2020 2020   *= -1.         
-00016ff0: 2020 2020 2020 2020 2020 2069 6620 2768             if 'h
-00017000: 6774 2720 696e 2072 6563 6f72 6473 3262  gt' in records2b
-00017010: 6549 6e76 6572 7465 643a 0a20 2020 2020  eInverted:.     
-00017020: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017030: 2020 2070 6f73 6974 696f 6e73 5b69 5d2e     positions[i].
-00017040: 6867 7420 2a3d 202d 310a 0a0a 2020 2020  hgt *= -1...    
-00017050: 2020 2020 2320 636f 6d70 656e 7361 7465      # compensate
-00017060: 206c 6576 6572 6172 6d20 6f66 6673 6574   leverarm offset
-00017070: 730a 2020 2020 2020 2020 6966 2063 6f6d  s.        if com
-00017080: 7065 6e73 6174 4f66 6673 6574 733a 0a0a  pensatOffsets:..
-00017090: 2020 2020 2020 2020 2020 2020 2320 6c6f              # lo
-000170a0: 6164 2066 7261 6d65 2061 7474 6974 7564  ad frame attitud
-000170b0: 6520 6461 7461 2066 726f 6d20 6669 6c65  e data from file
-000170c0: 0a20 2020 2020 2020 2020 2020 2061 7474  .            att
-000170d0: 5f64 6174 612c 2070 6172 7365 4d73 6720  _data, parseMsg 
-000170e0: 3d20 6d69 7174 6e2e 7265 6164 416c 6c41  = miqtn.readAllA
-000170f0: 7474 6974 7564 6573 4672 6f6d 4669 6c65  ttitudesFromFile
-00017100: 5061 7468 286e 6176 5f70 6174 682c 206e  Path(nav_path, n
-00017110: 6176 5f68 6561 6465 722c 2064 6174 655f  av_header, date_
-00017120: 666f 726d 6174 2c63 6f6c 5f73 6570 6172  format,col_separ
-00017130: 6174 6f72 3d63 6f6c 5f73 6570 6172 6174  ator=col_separat
-00017140: 6f72 2c63 6f6e 7374 5f76 616c 7565 733d  or,const_values=
-00017150: 636f 6e73 745f 7661 6c75 6573 2c61 6e67  const_values,ang
-00017160: 6c65 7349 6e52 6164 3d61 6e67 6c65 735f  lesInRad=angles_
-00017170: 696e 5f72 6164 290a 2020 2020 2020 2020  in_rad).        
-00017180: 2020 2020 6966 2070 6172 7365 4d73 6720      if parseMsg 
-00017190: 213d 2022 223a 0a20 2020 2020 2020 2020  != "":.         
-000171a0: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
-000171b0: 2e6c 6f67 2870 6172 7365 4d73 672c 646f  .log(parseMsg,do
-000171c0: 6e74 5368 6f77 3d54 7275 6529 0a20 2020  ntShow=True).   
-000171d0: 2020 2020 2020 2020 2020 2020 2072 6574               ret
-000171e0: 7572 6e4d 7367 202b 3d20 225c 6e22 202b  urnMsg += "\n" +
-000171f0: 2070 6172 7365 4d73 670a 0a20 2020 2020   parseMsg..     
-00017200: 2020 2020 2020 2069 6620 7265 636f 7264         if record
-00017210: 7332 6265 496e 7665 7274 6564 2021 3d20  s2beInverted != 
-00017220: 5b5d 3a0a 2020 2020 2020 2020 2020 2020  []:.            
-00017230: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
-00017240: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
-00017250: 2020 2020 2020 2020 2020 2020 2020 2061                 a
-00017260: 7474 6974 7564 6573 203d 2069 6d61 6765  ttitudes = image
-00017270: 5f64 7473 5f61 7474 5b66 696c 655d 0a20  _dts_att[file]. 
-00017280: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017290: 2020 2066 6f72 2069 2069 6e20 7261 6e67     for i in rang
-000172a0: 6528 6c65 6e28 706f 7369 7469 6f6e 7329  e(len(positions)
-000172b0: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-000172c0: 2020 2020 2020 2020 2020 2069 6620 2779             if 'y
-000172d0: 6177 2720 696e 2020 7265 636f 7264 7332  aw' in  records2
-000172e0: 6265 496e 7665 7274 6564 3a0a 2020 2020  beInverted:.    
-000172f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017300: 2020 2020 2020 2020 6174 7469 7475 6465          attitude
-00017310: 735b 695d 2e79 6177 202a 3d20 2d31 0a20  s[i].yaw *= -1. 
-00017320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017330: 2020 2020 2020 2069 6620 2770 6974 6368         if 'pitch
-00017340: 2720 696e 2020 7265 636f 7264 7332 6265  ' in  records2be
-00017350: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
-00017360: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017370: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
-00017380: 695d 2e70 6974 6368 202a 3d20 2d31 0a20  i].pitch *= -1. 
-00017390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173a0: 2020 2020 2020 2069 6620 2772 6f6c 6c27         if 'roll'
-000173b0: 2069 6e20 2072 6563 6f72 6473 3262 6549   in  records2beI
-000173c0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
-000173d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000173e0: 2020 2020 2061 7474 6974 7564 6573 5b69       attitudes[i
-000173f0: 5d2e 726f 6c6c 202a 3d20 2d31 0a0a 2020  ].roll *= -1..  
-00017400: 2020 2020 2020 2020 2020 2320 6669 6e64            # find
-00017410: 2066 6f72 2065 6163 6820 696d 6167 6520   for each image 
-00017420: 7468 6520 7265 7370 6563 7469 7665 206e  the respective n
-00017430: 6176 6967 6174 696f 6e20 6461 7461 0a20  avigation data. 
-00017440: 2020 2020 2020 2020 2020 2073 7563 6365             succe
-00017450: 7373 2c20 696d 6167 655f 6474 735f 6174  ss, image_dts_at
-00017460: 742c 206d 7367 203d 2073 656c 662e 6669  t, msg = self.fi
-00017470: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
-00017480: 6528 6174 745f 6461 7461 2c76 6964 656f  e(att_data,video
-00017490: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
-000174a0: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-000174b0: 7072 6f76 2e6c 6f67 286d 7367 2c64 6f6e  prov.log(msg,don
-000174c0: 7453 686f 773d 5472 7565 290a 2020 2020  tShow=True).    
-000174d0: 2020 2020 2020 2020 6966 206d 7367 2021          if msg !
-000174e0: 3d20 2222 3a0a 2020 2020 2020 2020 2020  = "":.          
-000174f0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
-00017500: 2b3d 2022 5c6e 2220 2b20 6d73 670a 2020  += "\n" + msg.  
-00017510: 2020 2020 2020 2020 2020 6966 206e 6f74            if not
-00017520: 2073 7563 6365 7373 3a0a 2020 2020 2020   success:.      
-00017530: 2020 2020 2020 2020 2020 7265 7475 726e            return
-00017540: 2046 616c 7365 2c20 7265 7475 726e 4d73   False, returnMs
-00017550: 670a 0a20 2020 2020 2020 2020 2020 2023  g..            #
-00017560: 2063 6f6d 7065 6e73 6174 650a 2020 2020   compensate.    
-00017570: 2020 2020 2020 2020 666f 7220 6669 6c65          for file
-00017580: 2069 6e20 696d 6167 655f 6474 733a 0a20   in image_dts:. 
-00017590: 2020 2020 2020 2020 2020 2020 2020 2070                 p
-000175a0: 6f73 6974 696f 6e73 203d 2069 6d61 6765  ositions = image
-000175b0: 5f64 7473 5b66 696c 655d 0a20 2020 2020  _dts[file].     
-000175c0: 2020 2020 2020 2020 2020 2061 7474 6974             attit
-000175d0: 7564 6573 203d 2069 6d61 6765 5f64 7473  udes = image_dts
-000175e0: 5f61 7474 5b66 696c 655d 0a20 2020 2020  _att[file].     
-000175f0: 2020 2020 2020 2020 2020 2066 6f72 2069             for i
-00017600: 2069 6e20 7261 6e67 6528 6c65 6e28 706f   in range(len(po
-00017610: 7369 7469 6f6e 7329 293a 0a20 2020 2020  sitions)):.     
-00017620: 2020 2020 2020 2020 2020 2020 2020 206c                 l
-00017630: 6174 203d 2070 6f73 6974 696f 6e73 5b69  at = positions[i
-00017640: 5d2e 6c61 740a 2020 2020 2020 2020 2020  ].lat.          
-00017650: 2020 2020 2020 2020 2020 6c6f 6e20 3d20            lon = 
-00017660: 706f 7369 7469 6f6e 735b 695d 2e6c 6f6e  positions[i].lon
-00017670: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017680: 2020 2020 2064 6570 203d 2070 6f73 6974       dep = posit
-00017690: 696f 6e73 5b69 5d2e 6465 700a 2020 2020  ions[i].dep.    
-000176a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000176b0: 7961 7720 3d20 6174 7469 7475 6465 735b  yaw = attitudes[
-000176c0: 695d 2e79 6177 0a20 2020 2020 2020 2020  i].yaw.         
-000176d0: 2020 2020 2020 2020 2020 2070 6974 6368             pitch
-000176e0: 203d 2061 7474 6974 7564 6573 5b69 5d2e   = attitudes[i].
-000176f0: 7069 7463 680a 2020 2020 2020 2020 2020  pitch.          
-00017700: 2020 2020 2020 2020 2020 726f 6c6c 203d            roll =
-00017710: 2061 7474 6974 7564 6573 5b69 5d2e 726f   attitudes[i].ro
-00017720: 6c6c 0a20 2020 2020 2020 2020 2020 2020  ll.             
-00017730: 2020 2020 2020 2069 6620 7961 7720 6973         if yaw is
-00017740: 204e 6f6e 6520 6f72 2070 6974 6368 2069   None or pitch i
-00017750: 7320 4e6f 6e65 206f 7220 726f 6c6c 2069  s None or roll i
-00017760: 7320 4e6f 6e65 3a0a 2020 2020 2020 2020  s None:.        
-00017770: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017780: 636f 6e74 696e 7565 0a20 2020 2020 2020  continue.       
-00017790: 2020 2020 2020 2020 2020 2020 206e 6577               new
-000177a0: 5f6c 6174 2c6e 6577 5f6c 6f6e 2c6e 6577  _lat,new_lon,new
-000177b0: 5f64 6570 203d 206d 6971 7467 2e61 6464  _dep = miqtg.add
-000177c0: 4c65 7665 7261 726d 7332 4c61 746c 6f6e  Leverarms2Latlon
-000177d0: 286c 6174 2c6c 6f6e 2c64 6570 2c6f 6666  (lat,lon,dep,off
-000177e0: 7365 745f 782c 6f66 6673 6574 5f79 2c6f  set_x,offset_y,o
-000177f0: 6666 7365 745f 7a2c 7961 772c 7069 7463  ffset_z,yaw,pitc
-00017800: 682c 726f 6c6c 290a 2020 2020 2020 2020  h,roll).        
-00017810: 2020 2020 2020 2020 2020 2020 706f 7369              posi
-00017820: 7469 6f6e 735b 695d 2e6c 6174 203d 206e  tions[i].lat = n
-00017830: 6577 5f6c 6174 0a20 2020 2020 2020 2020  ew_lat.         
-00017840: 2020 2020 2020 2020 2020 2070 6f73 6974             posit
-00017850: 696f 6e73 5b69 5d2e 6c6f 6e20 3d20 6e65  ions[i].lon = ne
-00017860: 775f 6c6f 6e0a 2020 2020 2020 2020 2020  w_lon.          
-00017870: 2020 2020 2020 2020 2020 706f 7369 7469            positi
-00017880: 6f6e 735b 695d 2e64 6570 203d 206e 6577  ons[i].dep = new
-00017890: 5f64 6570 0a0a 2020 2020 2020 2020 2020  _dep..          
-000178a0: 2020 7365 6c66 2e70 726f 762e 6c6f 6728    self.prov.log(
-000178b0: 2261 7070 6c69 6564 206c 6576 6572 2061  "applied lever a
-000178c0: 726d 2063 6f6d 7065 6e73 6174 696f 6e20  rm compensation 
-000178d0: 782c 792c 7a20 3d20 2220 2b20 7374 7228  x,y,z = " + str(
-000178e0: 6f66 6673 6574 5f78 2920 2b20 222c 2220  offset_x) + "," 
-000178f0: 2b20 7374 7228 6f66 6673 6574 5f79 2920  + str(offset_y) 
-00017900: 2b20 222c 2220 2b20 7374 7228 6f66 6673  + "," + str(offs
-00017910: 6574 5f7a 292c 646f 6e74 5368 6f77 3d54  et_z),dontShow=T
-00017920: 7275 6529 0a0a 2020 2020 2020 2020 6966  rue)..        if
-00017930: 206c 656e 2869 6d61 6765 5f64 7473 2920   len(image_dts) 
-00017940: 3e20 303a 0a20 2020 2020 2020 2020 2020  > 0:.           
-00017950: 2023 2043 6865 636b 2077 6865 7468 6572   # Check whether
-00017960: 2064 6570 7468 2061 6e64 2068 6569 6768   depth and heigh
-00017970: 7420 6172 6520 7365 740a 2020 2020 2020  t are set.      
-00017980: 2020 2020 2020 6c61 745f 6964 656e 7469        lat_identi
-00017990: 6361 6c2c 206c 6f6e 5f69 6465 6e74 6963  cal, lon_identic
-000179a0: 616c 2c20 6465 705f 6964 656e 7469 6361  al, dep_identica
-000179b0: 6c2c 2068 6774 5f69 6465 6e74 6963 616c  l, hgt_identical
-000179c0: 2c20 6465 705f 6e6f 745f 7a65 726f 2c20  , dep_not_zero, 
-000179d0: 6867 745f 6e6f 745f 7a65 726f 2c75 6e63  hgt_not_zero,unc
-000179e0: 6572 745f 6e6f 745f 7a65 726f 203d 206e  ert_not_zero = n
-000179f0: 6176 5f64 6174 612e 6368 6563 6b50 6f73  av_data.checkPos
-00017a00: 6974 696f 6e73 436f 6e74 656e 7428 290a  itionsContent().
-00017a10: 0a20 2020 2020 2020 2020 2020 2023 2057  .            # W
-00017a20: 7269 7465 2074 6f20 6e61 7669 6761 7469  rite to navigati
-00017a30: 6f6e 2074 7874 2066 696c 650a 2020 2020  on txt file.    
-00017a40: 2020 2020 2020 2020 2320 6865 6164 6572          # header
-00017a50: 0a20 2020 2020 2020 2020 2020 2072 6573  .            res
-00017a60: 203d 206f 7065 6e28 7365 6c66 2e67 6574   = open(self.get
-00017a70: 5f69 6e74 5f6e 6176 5f66 696c 6528 292c  _int_nav_file(),
-00017a80: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
-00017a90: 2020 7265 732e 7772 6974 6528 6d69 7174    res.write(miqt
-00017aa0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-00017ab0: 7269 7174 275d 5b27 696d 6727 5d2b 225c  riqt']['img']+"\
-00017ac0: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
-00017ad0: 6465 725b 276d 6172 6971 7427 5d5b 2775  der['mariqt']['u
-00017ae0: 7463 275d 290a 0a20 2020 2020 2020 2020  tc'])..         
-00017af0: 2020 2068 6173 5f61 6c74 203d 2054 7275     has_alt = Tru
-00017b00: 6520 6966 2064 6570 5f6e 6f74 5f7a 6572  e if dep_not_zer
-00017b10: 6f20 616e 6420 2820 2764 6570 2720 696e  o and ( 'dep' in
-00017b20: 206e 6176 5f68 6561 6465 7220 6f72 2027   nav_header or '
-00017b30: 616c 7427 2069 6e20 6e61 765f 6865 6164  alt' in nav_head
-00017b40: 6572 2029 2065 6c73 6520 4661 6c73 650a  er ) else False.
-00017b50: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-00017b60: 276c 6174 2720 696e 206e 6176 5f68 6561  'lat' in nav_hea
-00017b70: 6465 723a 0a20 2020 2020 2020 2020 2020  der:.           
-00017b80: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00017b90: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00017ba0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00017bb0: 6c61 7427 5d29 0a20 2020 2020 2020 2020  lat']).         
-00017bc0: 2020 2069 6620 276c 6f6e 2720 696e 206e     if 'lon' in n
-00017bd0: 6176 5f68 6561 6465 723a 0a20 2020 2020  av_header:.     
-00017be0: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00017bf0: 7269 7465 2822 5c74 222b 6d69 7174 762e  rite("\t"+miqtv.
-00017c00: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
-00017c10: 7174 275d 5b27 6c6f 6e27 5d29 0a20 2020  qt']['lon']).   
-00017c20: 2020 2020 2020 2020 2069 6620 6861 735f           if has_
-00017c30: 616c 743a 0a20 2020 2020 2020 2020 2020  alt:.           
-00017c40: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00017c50: 5c74 222b 6d69 7174 762e 636f 6c5f 6865  \t"+miqtv.col_he
-00017c60: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00017c70: 616c 7427 5d29 0a20 2020 2020 2020 2020  alt']).         
-00017c80: 2020 2069 6620 6867 745f 6e6f 745f 7a65     if hgt_not_ze
-00017c90: 726f 2061 6e64 2027 6867 7427 2069 6e20  ro and 'hgt' in 
-00017ca0: 6e61 765f 6865 6164 6572 3a0a 2020 2020  nav_header:.    
-00017cb0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00017cc0: 7772 6974 6528 225c 7422 2b6d 6971 7476  write("\t"+miqtv
-00017cd0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00017ce0: 6971 7427 5d5b 2768 6774 275d 290a 2020  iqt']['hgt']).  
-00017cf0: 2020 2020 2020 2020 2020 6966 2075 6e63            if unc
-00017d00: 6572 745f 6e6f 745f 7a65 726f 2061 6e64  ert_not_zero and
-00017d10: 2027 756e 6365 7274 2720 696e 206e 6176   'uncert' in nav
-00017d20: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
-00017d30: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
-00017d40: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
-00017d50: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00017d60: 275d 5b27 756e 6365 7274 275d 290a 2020  ']['uncert']).  
-00017d70: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
-00017d80: 6974 6528 225c 6e22 290a 2020 2020 2020  ite("\n").      
-00017d90: 2020 2020 2020 2320 6461 7461 206c 696e        # data lin
-00017da0: 6573 0a20 2020 2020 2020 2020 2020 2066  es.            f
-00017db0: 6f72 2066 696c 6520 696e 2069 6d61 6765  or file in image
-00017dc0: 5f64 7473 3a0a 2020 2020 2020 2020 2020  _dts:.          
-00017dd0: 2020 2020 2020 666f 7220 7469 6d65 706f        for timepo
-00017de0: 696e 7420 696e 2069 6d61 6765 5f64 7473  int in image_dts
-00017df0: 5b66 696c 655d 3a0a 2020 2020 2020 2020  [file]:.        
-00017e00: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-00017e10: 7772 6974 6528 6669 6c65 2b22 5c74 222b  write(file+"\t"+
-00017e20: 7469 6d65 706f 696e 742e 6461 7465 5469  timepoint.dateTi
-00017e30: 6d65 2829 2e73 7472 6674 696d 6528 6d69  me().strftime(mi
-00017e40: 7174 762e 6461 7465 5f66 6f72 6d61 7473  qtv.date_formats
-00017e50: 5b27 6d61 7269 7174 275d 2929 200a 2020  ['mariqt'])) .  
-00017e60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017e70: 2020 6966 2027 6c61 7427 2069 6e20 6e61    if 'lat' in na
-00017e80: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
-00017e90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017ea0: 2020 7661 6c20 3d20 7469 6d65 706f 696e    val = timepoin
-00017eb0: 742e 6c61 740a 2020 2020 2020 2020 2020  t.lat.          
-00017ec0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00017ed0: 732e 7772 6974 6528 225c 7422 2b73 7472  s.write("\t"+str
-00017ee0: 2876 616c 2929 0a20 2020 2020 2020 2020  (val)).         
-00017ef0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
-00017f00: 6f6e 2720 696e 206e 6176 5f68 6561 6465  on' in nav_heade
-00017f10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
-00017f20: 2020 2020 2020 2020 2020 2076 616c 203d             val =
-00017f30: 2074 696d 6570 6f69 6e74 2e6c 6f6e 0a20   timepoint.lon. 
-00017f40: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f50: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
-00017f60: 2822 5c74 222b 7374 7228 7661 6c29 290a  ("\t"+str(val)).
-00017f70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017f80: 2020 2020 6966 2068 6173 5f61 6c74 3a0a      if has_alt:.
-00017f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fa0: 2020 2020 2020 2020 7661 6c20 3d20 7469          val = ti
-00017fb0: 6d65 706f 696e 742e 6465 700a 2020 2020  mepoint.dep.    
-00017fc0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00017fd0: 2020 2020 2320 6465 7020 746f 2061 6c74      # dep to alt
-00017fe0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00017ff0: 2020 2020 2020 2020 2076 616c 202a 3d20           val *= 
-00018000: 2d31 0a20 2020 2020 2020 2020 2020 2020  -1.             
-00018010: 2020 2020 2020 2020 2020 2072 6573 2e77             res.w
-00018020: 7269 7465 2822 5c74 222b 7374 7228 7661  rite("\t"+str(va
-00018030: 6c29 290a 2020 2020 2020 2020 2020 2020  l)).            
-00018040: 2020 2020 2020 2020 6966 2068 6774 5f6e          if hgt_n
-00018050: 6f74 5f7a 6572 6f20 616e 6420 2768 6774  ot_zero and 'hgt
-00018060: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-00018070: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018080: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
-00018090: 696d 6570 6f69 6e74 2e68 6774 0a20 2020  imepoint.hgt.   
-000180a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180b0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-000180c0: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
-000180d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000180e0: 2020 6966 2075 6e63 6572 745f 6e6f 745f    if uncert_not_
-000180f0: 7a65 726f 2061 6e64 2027 756e 6365 7274  zero and 'uncert
-00018100: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
-00018110: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018120: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
-00018130: 696d 6570 6f69 6e74 2e75 6e63 6572 740a  imepoint.uncert.
-00018140: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018150: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
-00018160: 6528 225c 7422 2b73 7472 2876 616c 2929  e("\t"+str(val))
-00018170: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00018180: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
-00018190: 5c6e 2229 0a20 2020 2020 2020 2020 2020  \n").           
-000181a0: 2072 6573 2e63 6c6f 7365 2829 0a0a 2020   res.close()..  
-000181b0: 2020 2020 2020 2020 2020 2320 5772 6974            # Writ
-000181c0: 6520 746f 2067 656f 6a73 6f6e 2066 696c  e to geojson fil
-000181d0: 650a 2020 2020 2020 2020 2020 2020 6765  e.            ge
-000181e0: 6f6a 736f 6e20 3d20 7b27 7479 7065 273a  ojson = {'type':
-000181f0: 2027 4665 6174 7572 6543 6f6c 6c65 6374   'FeatureCollect
-00018200: 696f 6e27 2c20 276e 616d 6527 3a20 7365  ion', 'name': se
-00018210: 6c66 2e64 6972 2e65 7665 6e74 2829 2b22  lf.dir.event()+"
-00018220: 5f22 2b73 656c 662e 6469 722e 7365 6e73  _"+self.dir.sens
-00018230: 6f72 2829 2b22 5f69 6d61 6765 2d6e 6176  or()+"_image-nav
-00018240: 6967 6174 696f 6e22 2c20 2766 6561 7475  igation", 'featu
-00018250: 7265 7327 3a20 5b5d 7d0a 2020 2020 2020  res': []}.      
-00018260: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
-00018270: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
-00018280: 2020 2020 2020 2020 2020 2020 2023 2070               # p
-00018290: 686f 746f 0a20 2020 2020 2020 2020 2020  hoto.           
-000182a0: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
-000182b0: 655f 6474 735b 6669 6c65 5d29 203d 3d20  e_dts[file]) == 
-000182c0: 313a 0a20 2020 2020 2020 2020 2020 2020  1:.             
-000182d0: 2020 2020 2020 2069 6620 6465 705f 6e6f         if dep_no
-000182e0: 745f 7a65 726f 3a0a 2020 2020 2020 2020  t_zero:.        
-000182f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018300: 6765 6f6d 6574 7279 203d 2020 7b27 7479  geometry =  {'ty
-00018310: 7065 273a 2022 506f 696e 7422 2c20 2763  pe': "Point", 'c
-00018320: 6f6f 7264 696e 6174 6573 273a 200a 2020  oordinates': .  
-00018330: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018340: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018350: 2020 2020 2020 5b66 6c6f 6174 2869 6d61        [float(ima
-00018360: 6765 5f64 7473 5b66 696c 655d 5b30 5d2e  ge_dts[file][0].
-00018370: 6c6f 6e29 2c20 666c 6f61 7428 696d 6167  lon), float(imag
-00018380: 655f 6474 735b 6669 6c65 5d5b 305d 2e6c  e_dts[file][0].l
-00018390: 6174 292c 2066 6c6f 6174 2869 6d61 6765  at), float(image
-000183a0: 5f64 7473 5b66 696c 655d 5b30 5d2e 6465  _dts[file][0].de
-000183b0: 7029 5d0a 2020 2020 2020 2020 2020 2020  p)].            
-000183c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000183d0: 2020 2020 2020 2020 7d0a 2020 2020 2020          }.      
-000183e0: 2020 2020 2020 2020 2020 2020 2020 656c                el
-000183f0: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
-00018400: 2020 2020 2020 2020 2020 2020 6765 6f6d              geom
-00018410: 6574 7279 203d 2020 7b27 7479 7065 273a  etry =  {'type':
-00018420: 2022 506f 696e 7422 2c20 2763 6f6f 7264   "Point", 'coord
-00018430: 696e 6174 6573 273a 200a 2020 2020 2020  inates': .      
-00018440: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018450: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018460: 2020 5b66 6c6f 6174 2869 6d61 6765 5f64    [float(image_d
-00018470: 7473 5b66 696c 655d 5b30 5d2e 6c6f 6e29  ts[file][0].lon)
-00018480: 2c20 666c 6f61 7428 696d 6167 655f 6474  , float(image_dt
-00018490: 735b 6669 6c65 5d5b 305d 2e6c 6174 295d  s[file][0].lat)]
-000184a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000184b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000184c0: 2020 2020 207d 0a20 2020 2020 2020 2020       }.         
-000184d0: 2020 2020 2020 2020 2020 2069 6620 5472             if Tr
-000184e0: 7565 2069 6e20 5b6d 6174 682e 6973 6e61  ue in [math.isna
-000184f0: 6e28 7829 2066 6f72 2078 2069 6e20 6765  n(x) for x in ge
-00018500: 6f6d 6574 7279 5b27 636f 6f72 6469 6e61  ometry['coordina
-00018510: 7465 7327 5d5d 3a0a 2020 2020 2020 2020  tes']]:.        
-00018520: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018530: 636f 6e74 696e 7565 0a0a 2020 2020 2020  continue..      
-00018540: 2020 2020 2020 2020 2020 2320 7669 6465            # vide
-00018550: 6f0a 2020 2020 2020 2020 2020 2020 2020  o.              
-00018560: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-00018570: 2020 2020 2020 2020 2020 2020 6966 2064              if d
-00018580: 6570 5f6e 6f74 5f7a 6572 6f3a 0a20 2020  ep_not_zero:.   
-00018590: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185a0: 2020 2020 2067 656f 6d65 7472 7920 3d20       geometry = 
-000185b0: 207b 2774 7970 6527 3a20 224d 756c 7469   {'type': "Multi
+00015e00: 200a 2020 2020 2020 2020 2020 2020 2020   .              
+00015e10: 2020 2020 2020 706f 732c 2073 7461 7274        pos, start
+00015e20: 5365 6172 6368 496e 6465 7820 3d20 6461  SearchIndex = da
+00015e30: 7461 2e69 6e74 6572 706f 6c61 7465 4174  ta.interpolateAt
+00015e40: 5469 6d65 2864 745f 696d 6167 655f 7473  Time(dt_image_ts
+00015e50: 202b 2073 616d 706c 6554 696d 6553 6563   + sampleTimeSec
+00015e60: 7320 2a20 3130 3030 2c74 696d 655f 706f  s * 1000,time_po
+00015e70: 696e 7473 2c73 7461 7274 5365 6172 6368  ints,startSearch
+00015e80: 496e 6465 7829 0a20 2020 2020 2020 2020  Index).         
+00015e90: 2020 2020 2020 2020 2020 200a 2020 2020             .    
+00015ea0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015eb0: 2320 696e 7465 7270 6f6c 6174 6541 7454  # interpolateAtT
+00015ec0: 696d 6520 7265 7475 726e 7320 4e6f 6e65  ime returns None
+00015ed0: 2076 616c 7565 7320 6966 2074 696d 6520   values if time 
+00015ee0: 6f75 7420 6f66 2072 616e 6765 0a20 2020  out of range.   
+00015ef0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f00: 2069 6620 706f 732e 636f 7461 696e 734e   if pos.cotainsN
+00015f10: 6f6e 6556 616c 7565 7349 6e52 6571 7569  oneValuesInRequi
+00015f20: 7265 6446 6965 6c64 7328 293a 0a20 2020  redFields():.   
+00015f30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015f40: 2020 2020 2075 6e6d 6174 6368 6564 5469       unmatchedTi
+00015f50: 6d65 506f 696e 7473 2e61 7070 656e 6428  mePoints.append(
+00015f60: 2864 745f 696d 6167 655f 7473 202b 2073  (dt_image_ts + s
+00015f70: 616d 706c 6554 696d 6553 6563 7320 2a20  ampleTimeSecs * 
+00015f80: 3130 3030 292f 3130 3030 290a 2020 2020  1000)/1000).    
+00015f90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00015fa0: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00015fb0: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00015fc0: 735f 6c69 7374 2e61 7070 656e 6428 706f  s_list.append(po
+00015fd0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00015fe0: 2020 2065 7863 6570 7420 4578 6365 7074     except Except
+00015ff0: 696f 6e20 6173 2065 3a0a 2020 2020 2020  ion as e:.      
+00016000: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00016010: 7475 726e 2046 616c 7365 2c20 696d 6167  turn False, imag
+00016020: 655f 6474 732c 2022 436f 756c 6420 6e6f  e_dts, "Could no
+00016030: 7420 6669 6e64 2069 6d61 6765 2074 696d  t find image tim
+00016040: 6520 222b 2064 6174 6574 696d 652e 6461  e "+ datetime.da
+00016050: 7465 7469 6d65 2e75 7463 6672 6f6d 7469  tetime.utcfromti
+00016060: 6d65 7374 616d 7028 2864 745f 696d 6167  mestamp((dt_imag
+00016070: 655f 7473 202b 2073 616d 706c 6554 696d  e_ts + sampleTim
+00016080: 6553 6563 7320 2a20 3130 3030 292f 3130  eSecs * 1000)/10
+00016090: 3030 292e 7374 7266 7469 6d65 286d 6971  00).strftime(miq
+000160a0: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+000160b0: 276d 6172 6971 7427 5d29 202b 2220 696e  'mariqt']) +" in
+000160c0: 2022 2b73 7472 2864 6174 612e 6c65 6e28   "+str(data.len(
+000160d0: 2929 2b22 2064 6174 6120 706f 7369 7469  ))+" data positi
+000160e0: 6f6e 7322 202b 2073 7472 2865 2e61 7267  ons" + str(e.arg
+000160f0: 7329 0a20 2020 2020 2020 2020 2020 2020  s).             
+00016100: 2020 2073 616d 706c 6554 696d 6553 6563     sampleTimeSec
+00016110: 7320 2b3d 2076 6964 656f 5361 6d70 6c65  s += videoSample
+00016120: 5365 636f 6e64 730a 2020 2020 2020 2020  Seconds.        
+00016130: 2020 2020 2020 2020 6966 2073 616d 706c          if sampl
+00016140: 6554 696d 6553 6563 7320 3e20 7275 6e54  eTimeSecs > runT
+00016150: 696d 653a 0a20 2020 2020 2020 2020 2020  ime:.           
+00016160: 2020 2020 2020 2020 2067 6f20 3d20 4661           go = Fa
+00016170: 6c73 650a 2020 2020 2020 2020 2020 2020  lse.            
+00016180: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
+00016190: 6765 5f64 7473 5b66 696c 655f 6e61 6d65  ge_dts[file_name
+000161a0: 5d20 3d20 706f 735f 6c69 7374 0a20 2020  ] = pos_list.   
+000161b0: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+000161c0: 290a 2020 2020 2020 2020 7265 7475 726e  ).        return
+000161d0: 4d73 6720 3d20 2222 0a20 2020 2020 2020  Msg = "".       
+000161e0: 2069 6620 6c65 6e28 756e 6d61 7463 6865   if len(unmatche
+000161f0: 6454 696d 6550 6f69 6e74 7329 2021 3d20  dTimePoints) != 
+00016200: 303a 0a20 2020 2020 2020 2020 2020 2075  0:.            u
+00016210: 6e6d 6174 6368 6564 5469 6d65 506f 696e  nmatchedTimePoin
+00016220: 7473 2e73 6f72 7428 290a 2020 2020 2020  ts.sort().      
+00016230: 2020 2020 2020 756e 6d61 7463 6865 6454        unmatchedT
+00016240: 696d 6550 6f69 6e74 7320 3d20 5b64 6174  imePoints = [dat
+00016250: 6574 696d 652e 6461 7465 7469 6d65 2e75  etime.datetime.u
+00016260: 7463 6672 6f6d 7469 6d65 7374 616d 7028  tcfromtimestamp(
+00016270: 7473 292e 7374 7266 7469 6d65 286d 6971  ts).strftime(miq
+00016280: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00016290: 276d 6172 6971 7427 5d29 2066 6f72 2074  'mariqt']) for t
+000162a0: 7320 696e 2075 6e6d 6174 6368 6564 5469  s in unmatchedTi
+000162b0: 6d65 506f 696e 7473 5d0a 2020 2020 2020  mePoints].      
+000162c0: 2020 2020 2020 7265 7475 726e 4d73 6720        returnMsg 
+000162d0: 3d20 2243 6175 7469 6f6e 2120 4e61 7669  = "Caution! Navi
+000162e0: 6761 7469 6f6e 206e 6f74 2066 6f75 6e64  gation not found
+000162f0: 2066 6f72 2074 6865 2066 6f6c 6c6f 7769   for the followi
+00016300: 6e67 2069 6d61 6765 2074 696d 6520 706f  ng image time po
+00016310: 696e 7473 2e20 446f 7562 6c65 2063 6865  ints. Double che
+00016320: 636b 206f 7220 7072 6f76 6964 6520 6174  ck or provide at
+00016330: 206c 6561 7374 2073 7461 7469 6320 6465   least static de
+00016340: 6661 756c 7420 6e61 7669 6761 7469 6f6e  fault navigation
+00016350: 2069 6e20 6865 6164 6572 2066 6965 6c64   in header field
+00016360: 732e 220a 2020 2020 2020 2020 2020 2020  s.".            
+00016370: 7265 7475 726e 4d73 6720 2b3d 2022 5c6e  returnMsg += "\n
+00016380: 2220 2b20 225c 6e22 2e6a 6f69 6e28 756e  " + "\n".join(un
+00016390: 6d61 7463 6865 6454 696d 6550 6f69 6e74  matchedTimePoint
+000163a0: 7329 0a20 2020 2020 2020 2072 6574 7572  s).        retur
+000163b0: 6e20 5472 7565 2c20 696d 6167 655f 6474  n True, image_dt
+000163c0: 732c 2072 6574 7572 6e4d 7367 0a0a 0a20  s, returnMsg... 
+000163d0: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
+000163e0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
+000163f0: 696c 6528 7365 6c66 2c20 6e61 765f 7061  ile(self, nav_pa
+00016400: 7468 3a20 7374 722c 206e 6176 5f68 6561  th: str, nav_hea
+00016410: 6465 723d 6d69 7174 762e 706f 735f 6865  der=miqtv.pos_he
+00016420: 6164 6572 5b27 7061 6e67 6165 6127 5d2c  ader['pangaea'],
+00016430: 2064 6174 655f 666f 726d 6174 3d6d 6971   date_format=miq
+00016440: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00016450: 2770 616e 6761 6561 275d 2c20 6f76 6572  'pangaea'], over
+00016460: 7772 6974 653d 4661 6c73 652c 2063 6f6c  write=False, col
+00016470: 5f73 6570 6172 6174 6f72 203d 2022 5c74  _separator = "\t
+00016480: 222c 2076 6964 656f 5361 6d70 6c65 5365  ", videoSampleSe
+00016490: 636f 6e64 733d 312c 0a20 2020 2020 2020  conds=1,.       
+000164a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000164b0: 2020 2020 2020 2020 2020 2020 206f 6666               off
+000164c0: 7365 745f 783d 302c 206f 6666 7365 745f  set_x=0, offset_
+000164d0: 793d 302c 206f 6666 7365 745f 7a3d 302c  y=0, offset_z=0,
+000164e0: 616e 676c 6573 5f69 6e5f 7261 6420 3d20  angles_in_rad = 
+000164f0: 4661 6c73 652c 2072 6563 6f72 6473 3262  False, records2b
+00016500: 6549 6e76 6572 7465 643d 5b5d 293a 0a20  eInverted=[]):. 
+00016510: 2020 2020 2020 2022 2222 2043 7265 6174         """ Creat
+00016520: 6573 2069 6e20 2f69 6e74 6572 6d65 6469  es in /intermedi
+00016530: 6174 6520 6120 7465 7874 2066 696c 6520  ate a text file 
+00016540: 7769 7468 2034 2e35 4420 6e61 7669 6761  with 4.5D naviga
+00016550: 7469 6f6e 2064 6174 6120 666f 7220 6561  tion data for ea
+00016560: 6368 2069 6d61 6765 2c20 692e 652e 2061  ch image, i.e. a
+00016570: 2073 696e 676c 6520 726f 7720 7065 7220   single row per 
+00016580: 7068 6f74 6f2c 2076 6964 656f 2064 7572  photo, video dur
+00016590: 6174 696f 6e20 5b73 6563 5d20 2f20 7669  ation [sec] / vi
+000165a0: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+000165b0: 2072 6f77 7320 7065 7220 7669 6465 6f2e   rows per video.
+000165c0: 0a20 2020 2020 2020 2020 2020 206e 6176  .            nav
+000165d0: 5f68 6561 6465 7220 6d75 7374 2062 6520  _header must be 
+000165e0: 6469 6374 2063 6f6e 7461 696e 696e 6720  dict containing 
+000165f0: 7468 6520 6b65 7973 2027 7574 6327 2c27  the keys 'utc','
+00016600: 6c61 7427 2c27 6c6f 6e27 2c27 6465 7027  lat','lon','dep'
+00016610: 286f 7220 2761 6c74 2729 2c20 6f70 7469  (or 'alt'), opti
+00016620: 6f6e 616c 3a20 2768 6774 272c 2775 6e63  onal: 'hgt','unc
+00016630: 6572 7427 2077 6974 6820 7468 6520 7265  ert' with the re
+00016640: 7370 6563 7469 7665 2063 6f6c 756d 6e20  spective column 
+00016650: 6865 6164 6572 7320 6173 2076 616c 7565  headers as value
+00016660: 7320 0a20 2020 2020 2020 2020 2020 2069  s .            i
+00016670: 6620 6f6e 6520 6f66 2074 6865 2076 6568  f one of the veh
+00016680: 6963 6c65 2078 2c79 2c7a 206f 6666 7365  icle x,y,z offse
+00016690: 7473 205b 6d5d 2069 7320 6e6f 7420 3020  ts [m] is not 0 
+000166a0: 616e 6420 6e61 765f 6865 6164 6572 2061  and nav_header a
+000166b0: 6c73 6f20 636f 6e74 6169 6e73 2027 7961  lso contains 'ya
+000166c0: 7727 2c27 7069 7463 6827 2c27 726f 6c6c  w','pitch','roll
+000166d0: 2720 6c65 7665 7261 726d 206f 6666 7365  ' leverarm offse
+000166e0: 7473 2061 7265 2063 6f6d 7065 6e73 6174  ts are compensat
+000166f0: 6564 2066 6f72 2022 2222 0a0a 2020 2020  ed for """..    
+00016700: 2020 2020 6966 2073 656c 662e 696e 7465      if self.inte
+00016710: 726d 6564 6961 7465 4e61 7646 696c 6545  rmediateNavFileE
+00016720: 7869 7374 7328 2920 616e 6420 6e6f 7420  xists() and not 
+00016730: 6f76 6572 7772 6974 653a 0a20 2020 2020  overwrite:.     
+00016740: 2020 2020 2020 2072 6574 7572 6e20 5472         return Tr
+00016750: 7565 2c20 224f 7574 7075 7420 6669 6c65  ue, "Output file
+00016760: 2065 7869 7374 733a 2022 2b73 656c 662e   exists: "+self.
+00016770: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
+00016780: 2829 0a0a 2020 2020 2020 2020 6966 206e  ()..        if n
+00016790: 6f74 206f 732e 7061 7468 2e65 7869 7374  ot os.path.exist
+000167a0: 7328 6e61 765f 7061 7468 293a 0a20 2020  s(nav_path):.   
+000167b0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000167c0: 4661 6c73 652c 2022 4e61 7669 6761 7469  False, "Navigati
+000167d0: 6f6e 2066 696c 6520 6e6f 7420 666f 756e  on file not foun
+000167e0: 643a 2022 2b6e 6176 5f70 6174 680a 0a20  d: "+nav_path.. 
+000167f0: 2020 2020 2020 2069 6620 6e6f 7420 6f73         if not os
+00016800: 2e70 6174 682e 6578 6973 7473 2873 656c  .path.exists(sel
+00016810: 662e 696d 6167 6573 4469 7229 3a0a 2020  f.imagesDir):.  
+00016820: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016830: 2046 616c 7365 2c20 2249 6d61 6765 2066   False, "Image f
+00016840: 6f6c 6465 7220 6e6f 7420 666f 756e 643a  older not found:
+00016850: 2022 2b20 7365 6c66 2e69 6d61 6765 7344   "+ self.imagesD
+00016860: 6972 0a0a 2020 2020 2020 2020 7320 3d20  ir..        s = 
+00016870: 6d69 7174 632e 5072 696e 744c 6f61 6469  miqtc.PrintLoadi
+00016880: 6e67 4d73 6728 2243 7265 6174 696e 6720  ngMsg("Creating 
+00016890: 6974 656d 7327 206e 6176 6967 6174 696f  items' navigatio
+000168a0: 6e20 6461 7461 2229 0a20 2020 2020 2020  n data").       
+000168b0: 2072 6574 7572 6e4d 7367 203d 2022 220a   returnMsg = "".
+000168c0: 2020 2020 2020 2020 636f 6d70 656e 7361          compensa
+000168d0: 744f 6666 7365 7473 203d 2046 616c 7365  tOffsets = False
+000168e0: 0a20 2020 2020 2020 2069 6620 286f 6666  .        if (off
+000168f0: 7365 745f 7821 3d30 206f 7220 6f66 6673  set_x!=0 or offs
+00016900: 6574 5f79 213d 3020 6f72 206f 6666 7365  et_y!=0 or offse
+00016910: 745f 7a21 3d30 2920 616e 6420 2779 6177  t_z!=0) and 'yaw
+00016920: 2720 696e 206e 6176 5f68 6561 6465 7220  ' in nav_header 
+00016930: 616e 6420 2770 6974 6368 2720 696e 206e  and 'pitch' in n
+00016940: 6176 5f68 6561 6465 7220 616e 6420 2772  av_header and 'r
+00016950: 6f6c 6c27 2069 6e20 6e61 765f 6865 6164  oll' in nav_head
+00016960: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00016970: 636f 6d70 656e 7361 744f 6666 7365 7473  compensatOffsets
+00016980: 203d 2054 7275 650a 0a20 2020 2020 2020   = True..       
+00016990: 2023 2063 6865 636b 2069 6620 666f 7220   # check if for 
+000169a0: 6d69 7373 696e 6720 6669 656c 6473 2074  missing fields t
+000169b0: 6865 7265 2061 7265 2063 6f6e 7374 2076  here are const v
+000169c0: 616c 7565 7320 696e 2068 6561 6465 720a  alues in header.
+000169d0: 2020 2020 2020 2020 636f 6e73 745f 7661          const_va
+000169e0: 6c75 6573 203d 207b 7d0a 2020 2020 2020  lues = {}.      
+000169f0: 2020 666f 7220 6e61 7646 6965 6c64 2069    for navField i
+00016a00: 6e20 6d69 7174 762e 706f 735f 6865 6164  n miqtv.pos_head
+00016a10: 6572 5b27 6d61 7269 7174 275d 3a0a 2020  er['mariqt']:.  
+00016a20: 2020 2020 2020 2020 2020 7265 7370 6563            respec
+00016a30: 7469 7665 4865 6164 6572 4669 656c 6420  tiveHeaderField 
+00016a40: 3d20 6d69 7174 762e 636f 6c5f 6865 6164  = miqtv.col_head
+00016a50: 6572 5b22 6d61 7269 7174 225d 5b6e 6176  er["mariqt"][nav
+00016a60: 4669 656c 645d 0a20 2020 2020 2020 2020  Field].         
+00016a70: 2020 2069 6620 6e61 7646 6965 6c64 206e     if navField n
+00016a80: 6f74 2069 6e20 6e61 765f 6865 6164 6572  ot in nav_header
+00016a90: 2061 6e64 2028 7265 7370 6563 7469 7665   and (respective
+00016aa0: 4865 6164 6572 4669 656c 6420 696e 2073  HeaderField in s
+00016ab0: 656c 662e 6966 646f 5f74 6d70 5b73 656c  elf.ifdo_tmp[sel
+00016ac0: 662e 696d 6167 6553 6574 4865 6164 6572  f.imageSetHeader
+00016ad0: 4b65 795d 2061 6e64 2073 656c 662e 6669  Key] and self.fi
+00016ae0: 6e64 546d 7046 6965 6c64 3228 7265 7370  ndTmpField2(resp
+00016af0: 6563 7469 7665 4865 6164 6572 4669 656c  ectiveHeaderFiel
+00016b00: 6429 2021 3d20 2222 293a 200a 2020 2020  d) != ""): .    
+00016b10: 2020 2020 2020 2020 2020 2020 636f 6e73              cons
+00016b20: 745f 7661 6c75 6573 5b6e 6176 4669 656c  t_values[navFiel
+00016b30: 645d 203d 2073 656c 662e 6669 6e64 546d  d] = self.findTm
+00016b40: 7046 6965 6c64 2872 6573 7065 6374 6976  pField(respectiv
+00016b50: 6548 6561 6465 7246 6965 6c64 290a 0a20  eHeaderField).. 
+00016b60: 2020 2020 2020 2020 2320 6861 6e64 6c65          # handle
+00016b70: 2061 6c74 2076 7320 6465 700a 2020 2020   alt vs dep.    
+00016b80: 2020 2020 6966 2027 616c 7427 2069 6e20      if 'alt' in 
+00016b90: 6e61 765f 6865 6164 6572 2061 6e64 2027  nav_header and '
+00016ba0: 6465 7027 2069 6e20 6e61 765f 6865 6164  dep' in nav_head
+00016bb0: 6572 3a0a 2020 2020 2020 2020 2020 2020  er:.            
+00016bc0: 7261 6973 6520 6d69 7174 632e 4966 646f  raise miqtc.Ifdo
+00016bd0: 4578 6365 7074 696f 6e28 2227 616c 7427  Exception("'alt'
+00016be0: 2061 6e64 2027 6465 7027 2070 726f 7669   and 'dep' provi
+00016bf0: 6465 642e 2052 6564 756e 6461 6e74 2c20  ded. Redundant, 
+00016c00: 616c 7420 3d20 2d20 6465 702e 2050 726f  alt = - dep. Pro
+00016c10: 7669 6465 6420 6f6e 6c79 206f 6e65 206f  vided only one o
+00016c20: 6620 626f 7468 2e22 290a 2020 2020 2020  f both.").      
+00016c30: 2020 0a20 2020 2020 2020 2023 204c 6f61    .        # Loa
+00016c40: 6420 6e61 7669 6761 7469 6f6e 2064 6174  d navigation dat
+00016c50: 6120 2869 6620 2761 6c74 2720 696e 7374  a (if 'alt' inst
+00016c60: 6561 6420 6f66 2027 6465 7027 2c20 6974  ead of 'dep', it
+00016c70: 7320 6175 746f 6d61 7469 6361 6c6c 7920  s automatically 
+00016c80: 696e 7665 7274 6564 290a 2020 2020 2020  inverted).      
+00016c90: 2020 6e61 765f 6461 7461 2c20 7061 7273    nav_data, pars
+00016ca0: 654d 7367 203d 206d 6971 746e 2e72 6561  eMsg = miqtn.rea
+00016cb0: 6441 6c6c 506f 7369 7469 6f6e 7346 726f  dAllPositionsFro
+00016cc0: 6d46 696c 6550 6174 6828 6e61 765f 7061  mFilePath(nav_pa
+00016cd0: 7468 2c20 6e61 765f 6865 6164 6572 2c20  th, nav_header, 
+00016ce0: 6461 7465 5f66 6f72 6d61 742c 636f 6c5f  date_format,col_
+00016cf0: 7365 7061 7261 746f 723d 636f 6c5f 7365  separator=col_se
+00016d00: 7061 7261 746f 722c 636f 6e73 745f 7661  parator,const_va
+00016d10: 6c75 6573 3d63 6f6e 7374 5f76 616c 7565  lues=const_value
+00016d20: 7329 0a20 2020 2020 2020 2069 6620 7061  s).        if pa
+00016d30: 7273 654d 7367 2021 3d20 2222 3a0a 2020  rseMsg != "":.  
+00016d40: 2020 2020 2020 2020 2020 7365 6c66 2e70            self.p
+00016d50: 726f 762e 6c6f 6728 7061 7273 654d 7367  rov.log(parseMsg
+00016d60: 2c64 6f6e 7453 686f 773d 5472 7565 290a  ,dontShow=True).
+00016d70: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+00016d80: 726e 4d73 6720 3d20 225c 6e22 202b 2070  rnMsg = "\n" + p
+00016d90: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
+00016da0: 2023 2066 696e 6420 666f 7220 6561 6368   # find for each
+00016db0: 2069 6d61 6765 2074 6865 2072 6573 7065   image the respe
+00016dc0: 6374 6976 6520 6e61 7669 6761 7469 6f6e  ctive navigation
+00016dd0: 2064 6174 610a 2020 2020 2020 2020 732e   data.        s.
+00016de0: 7374 6f70 2829 0a20 2020 2020 2020 2073  stop().        s
+00016df0: 7563 6365 7373 2c20 696d 6167 655f 6474  uccess, image_dt
+00016e00: 732c 206d 7367 203d 2073 656c 662e 6669  s, msg = self.fi
+00016e10: 6e64 4e61 7644 6174 6146 6f72 496d 6167  ndNavDataForImag
+00016e20: 6528 6e61 765f 6461 7461 2c76 6964 656f  e(nav_data,video
+00016e30: 5361 6d70 6c65 5365 636f 6e64 7329 0a20  SampleSeconds). 
+00016e40: 2020 2020 2020 2073 656c 662e 7072 6f76         self.prov
+00016e50: 2e6c 6f67 286d 7367 2c64 6f6e 7453 686f  .log(msg,dontSho
+00016e60: 773d 5472 7565 290a 2020 2020 2020 2020  w=True).        
+00016e70: 6966 206d 7367 2021 3d20 2222 3a0a 2020  if msg != "":.  
+00016e80: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00016e90: 4d73 6720 2b3d 2022 5c6e 2220 2b20 6d73  Msg += "\n" + ms
+00016ea0: 670a 2020 2020 2020 2020 6966 206e 6f74  g.        if not
+00016eb0: 2073 7563 6365 7373 3a0a 2020 2020 2020   success:.      
+00016ec0: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
+00016ed0: 7365 2c20 7265 7475 726e 4d73 670a 2020  se, returnMsg.  
+00016ee0: 2020 2020 2020 7320 3d20 6d69 7174 632e        s = miqtc.
+00016ef0: 5072 696e 744c 6f61 6469 6e67 4d73 6728  PrintLoadingMsg(
+00016f00: 2243 7265 6174 696e 6720 6974 656d 7327  "Creating items'
+00016f10: 206e 6176 6967 6174 696f 6e20 6461 7461   navigation data
+00016f20: 2229 0a0a 2020 2020 2020 2020 2320 696e  ")..        # in
+00016f30: 7665 7274 2076 616c 7565 7320 2869 6620  vert values (if 
+00016f40: 6e65 6564 6564 2920 6265 666f 7265 206c  needed) before l
+00016f50: 6576 6572 6172 6d20 636f 6d70 656e 7361  everarm compensa
+00016f60: 7469 6f6e 0a20 2020 2020 2020 2069 6620  tion.        if 
+00016f70: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00016f80: 6564 2021 3d20 5b5d 3a0a 2020 2020 2020  ed != []:.      
+00016f90: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00016fa0: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00016fb0: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00016fc0: 6974 696f 6e73 203d 2069 6d61 6765 5f64  itions = image_d
+00016fd0: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
+00016fe0: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+00016ff0: 6e20 7261 6e67 6528 6c65 6e28 706f 7369  n range(len(posi
+00017000: 7469 6f6e 7329 293a 0a20 2020 2020 2020  tions)):.       
+00017010: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+00017020: 276c 6174 2720 696e 2072 6563 6f72 6473  'lat' in records
+00017030: 3262 6549 6e76 6572 7465 643a 0a20 2020  2beInverted:.   
+00017040: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017050: 2020 2020 2070 6f73 6974 696f 6e73 5b69       positions[i
+00017060: 5d2e 6c61 7420 2a3d 202d 310a 2020 2020  ].lat *= -1.    
+00017070: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017080: 6966 2027 6c6f 6e27 2069 6e20 7265 636f  if 'lon' in reco
+00017090: 7264 7332 6265 496e 7665 7274 6564 3a0a  rds2beInverted:.
+000170a0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170b0: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+000170c0: 735b 695d 2e6c 6f6e 202a 3d20 2d31 0a20  s[i].lon *= -1. 
+000170d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000170e0: 2020 2069 6620 2827 6465 7027 2069 6e20     if ('dep' in 
+000170f0: 7265 636f 7264 7332 6265 496e 7665 7274  records2beInvert
+00017100: 6564 2061 6e64 2027 6465 7027 2069 6e20  ed and 'dep' in 
+00017110: 6e61 765f 6865 6164 6572 2920 6f72 2028  nav_header) or (
+00017120: 2761 6c74 2720 696e 2072 6563 6f72 6473  'alt' in records
+00017130: 3262 6549 6e76 6572 7465 6420 616e 6420  2beInverted and 
+00017140: 2761 6c74 2720 696e 206e 6176 5f68 6561  'alt' in nav_hea
+00017150: 6465 7229 3a0a 2020 2020 2020 2020 2020  der):.          
+00017160: 2020 2020 2020 2020 2020 2020 2020 706f                po
+00017170: 7369 7469 6f6e 735b 695d 2e64 6570 202a  sitions[i].dep *
+00017180: 3d20 2d31 0a20 2020 2020 2020 2020 2020  = -1.           
+00017190: 2020 2020 2020 2020 2069 6620 2768 6774           if 'hgt
+000171a0: 2720 696e 2072 6563 6f72 6473 3262 6549  ' in records2beI
+000171b0: 6e76 6572 7465 643a 0a20 2020 2020 2020  nverted:.       
+000171c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000171d0: 2070 6f73 6974 696f 6e73 5b69 5d2e 6867   positions[i].hg
+000171e0: 7420 2a3d 202d 310a 0a0a 2020 2020 2020  t *= -1...      
+000171f0: 2020 2320 636f 6d70 656e 7361 7465 206c    # compensate l
+00017200: 6576 6572 6172 6d20 6f66 6673 6574 730a  everarm offsets.
+00017210: 2020 2020 2020 2020 6966 2063 6f6d 7065          if compe
+00017220: 6e73 6174 4f66 6673 6574 733a 0a0a 2020  nsatOffsets:..  
+00017230: 2020 2020 2020 2020 2020 2320 6c6f 6164            # load
+00017240: 2066 7261 6d65 2061 7474 6974 7564 6520   frame attitude 
+00017250: 6461 7461 2066 726f 6d20 6669 6c65 0a20  data from file. 
+00017260: 2020 2020 2020 2020 2020 2061 7474 5f64             att_d
+00017270: 6174 612c 2070 6172 7365 4d73 6720 3d20  ata, parseMsg = 
+00017280: 6d69 7174 6e2e 7265 6164 416c 6c41 7474  miqtn.readAllAtt
+00017290: 6974 7564 6573 4672 6f6d 4669 6c65 5061  itudesFromFilePa
+000172a0: 7468 286e 6176 5f70 6174 682c 206e 6176  th(nav_path, nav
+000172b0: 5f68 6561 6465 722c 2064 6174 655f 666f  _header, date_fo
+000172c0: 726d 6174 2c63 6f6c 5f73 6570 6172 6174  rmat,col_separat
+000172d0: 6f72 3d63 6f6c 5f73 6570 6172 6174 6f72  or=col_separator
+000172e0: 2c63 6f6e 7374 5f76 616c 7565 733d 636f  ,const_values=co
+000172f0: 6e73 745f 7661 6c75 6573 2c61 6e67 6c65  nst_values,angle
+00017300: 7349 6e52 6164 3d61 6e67 6c65 735f 696e  sInRad=angles_in
+00017310: 5f72 6164 290a 2020 2020 2020 2020 2020  _rad).          
+00017320: 2020 6966 2070 6172 7365 4d73 6720 213d    if parseMsg !=
+00017330: 2022 223a 0a20 2020 2020 2020 2020 2020   "":.           
+00017340: 2020 2020 2073 656c 662e 7072 6f76 2e6c       self.prov.l
+00017350: 6f67 2870 6172 7365 4d73 672c 646f 6e74  og(parseMsg,dont
+00017360: 5368 6f77 3d54 7275 6529 0a20 2020 2020  Show=True).     
+00017370: 2020 2020 2020 2020 2020 2072 6574 7572             retur
+00017380: 6e4d 7367 202b 3d20 225c 6e22 202b 2070  nMsg += "\n" + p
+00017390: 6172 7365 4d73 670a 0a20 2020 2020 2020  arseMsg..       
+000173a0: 2020 2020 2069 6620 7265 636f 7264 7332       if records2
+000173b0: 6265 496e 7665 7274 6564 2021 3d20 5b5d  beInverted != []
+000173c0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000173d0: 2020 666f 7220 6669 6c65 2069 6e20 696d    for file in im
+000173e0: 6167 655f 6474 733a 0a20 2020 2020 2020  age_dts:.       
+000173f0: 2020 2020 2020 2020 2020 2020 2061 7474               att
+00017400: 6974 7564 6573 203d 2069 6d61 6765 5f64  itudes = image_d
+00017410: 7473 5f61 7474 5b66 696c 655d 0a20 2020  ts_att[file].   
+00017420: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017430: 2066 6f72 2069 2069 6e20 7261 6e67 6528   for i in range(
+00017440: 6c65 6e28 706f 7369 7469 6f6e 7329 293a  len(positions)):
+00017450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00017460: 2020 2020 2020 2020 2069 6620 2779 6177           if 'yaw
+00017470: 2720 696e 2020 7265 636f 7264 7332 6265  ' in  records2be
+00017480: 496e 7665 7274 6564 3a0a 2020 2020 2020  Inverted:.      
+00017490: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174a0: 2020 2020 2020 6174 7469 7475 6465 735b        attitudes[
+000174b0: 695d 2e79 6177 202a 3d20 2d31 0a20 2020  i].yaw *= -1.   
+000174c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000174d0: 2020 2020 2069 6620 2770 6974 6368 2720       if 'pitch' 
+000174e0: 696e 2020 7265 636f 7264 7332 6265 496e  in  records2beIn
+000174f0: 7665 7274 6564 3a0a 2020 2020 2020 2020  verted:.        
+00017500: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017510: 2020 2020 6174 7469 7475 6465 735b 695d      attitudes[i]
+00017520: 2e70 6974 6368 202a 3d20 2d31 0a20 2020  .pitch *= -1.   
+00017530: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017540: 2020 2020 2069 6620 2772 6f6c 6c27 2069       if 'roll' i
+00017550: 6e20 2072 6563 6f72 6473 3262 6549 6e76  n  records2beInv
+00017560: 6572 7465 643a 0a20 2020 2020 2020 2020  erted:.         
+00017570: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017580: 2020 2061 7474 6974 7564 6573 5b69 5d2e     attitudes[i].
+00017590: 726f 6c6c 202a 3d20 2d31 0a0a 2020 2020  roll *= -1..    
+000175a0: 2020 2020 2020 2020 2320 6669 6e64 2066          # find f
+000175b0: 6f72 2065 6163 6820 696d 6167 6520 7468  or each image th
+000175c0: 6520 7265 7370 6563 7469 7665 206e 6176  e respective nav
+000175d0: 6967 6174 696f 6e20 6461 7461 0a20 2020  igation data.   
+000175e0: 2020 2020 2020 2020 2073 7563 6365 7373           success
+000175f0: 2c20 696d 6167 655f 6474 735f 6174 742c  , image_dts_att,
+00017600: 206d 7367 203d 2073 656c 662e 6669 6e64   msg = self.find
+00017610: 4e61 7644 6174 6146 6f72 496d 6167 6528  NavDataForImage(
+00017620: 6174 745f 6461 7461 2c76 6964 656f 5361  att_data,videoSa
+00017630: 6d70 6c65 5365 636f 6e64 7329 0a20 2020  mpleSeconds).   
+00017640: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+00017650: 6f76 2e6c 6f67 286d 7367 2c64 6f6e 7453  ov.log(msg,dontS
+00017660: 686f 773d 5472 7565 290a 2020 2020 2020  how=True).      
+00017670: 2020 2020 2020 6966 206d 7367 2021 3d20        if msg != 
+00017680: 2222 3a0a 2020 2020 2020 2020 2020 2020  "":.            
+00017690: 2020 2020 7265 7475 726e 4d73 6720 2b3d      returnMsg +=
+000176a0: 2022 5c6e 2220 2b20 6d73 670a 2020 2020   "\n" + msg.    
+000176b0: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
+000176c0: 7563 6365 7373 3a0a 2020 2020 2020 2020  uccess:.        
+000176d0: 2020 2020 2020 2020 7265 7475 726e 2046          return F
+000176e0: 616c 7365 2c20 7265 7475 726e 4d73 670a  alse, returnMsg.
+000176f0: 0a20 2020 2020 2020 2020 2020 2023 2063  .            # c
+00017700: 6f6d 7065 6e73 6174 650a 2020 2020 2020  ompensate.      
+00017710: 2020 2020 2020 666f 7220 6669 6c65 2069        for file i
+00017720: 6e20 696d 6167 655f 6474 733a 0a20 2020  n image_dts:.   
+00017730: 2020 2020 2020 2020 2020 2020 2070 6f73               pos
+00017740: 6974 696f 6e73 203d 2069 6d61 6765 5f64  itions = image_d
+00017750: 7473 5b66 696c 655d 0a20 2020 2020 2020  ts[file].       
+00017760: 2020 2020 2020 2020 2061 7474 6974 7564           attitud
+00017770: 6573 203d 2069 6d61 6765 5f64 7473 5f61  es = image_dts_a
+00017780: 7474 5b66 696c 655d 0a20 2020 2020 2020  tt[file].       
+00017790: 2020 2020 2020 2020 2066 6f72 2069 2069           for i i
+000177a0: 6e20 7261 6e67 6528 6c65 6e28 706f 7369  n range(len(posi
+000177b0: 7469 6f6e 7329 293a 0a20 2020 2020 2020  tions)):.       
+000177c0: 2020 2020 2020 2020 2020 2020 206c 6174               lat
+000177d0: 203d 2070 6f73 6974 696f 6e73 5b69 5d2e   = positions[i].
+000177e0: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
+000177f0: 2020 2020 2020 2020 6c6f 6e20 3d20 706f          lon = po
+00017800: 7369 7469 6f6e 735b 695d 2e6c 6f6e 0a20  sitions[i].lon. 
+00017810: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00017820: 2020 2064 6570 203d 2070 6f73 6974 696f     dep = positio
+00017830: 6e73 5b69 5d2e 6465 700a 2020 2020 2020  ns[i].dep.      
+00017840: 2020 2020 2020 2020 2020 2020 2020 7961                ya
+00017850: 7720 3d20 6174 7469 7475 6465 735b 695d  w = attitudes[i]
+00017860: 2e79 6177 0a20 2020 2020 2020 2020 2020  .yaw.           
+00017870: 2020 2020 2020 2020 2070 6974 6368 203d           pitch =
+00017880: 2061 7474 6974 7564 6573 5b69 5d2e 7069   attitudes[i].pi
+00017890: 7463 680a 2020 2020 2020 2020 2020 2020  tch.            
+000178a0: 2020 2020 2020 2020 726f 6c6c 203d 2061          roll = a
+000178b0: 7474 6974 7564 6573 5b69 5d2e 726f 6c6c  ttitudes[i].roll
+000178c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000178d0: 2020 2020 2069 6620 7961 7720 6973 204e       if yaw is N
+000178e0: 6f6e 6520 6f72 2070 6974 6368 2069 7320  one or pitch is 
+000178f0: 4e6f 6e65 206f 7220 726f 6c6c 2069 7320  None or roll is 
+00017900: 4e6f 6e65 3a0a 2020 2020 2020 2020 2020  None:.          
+00017910: 2020 2020 2020 2020 2020 2020 2020 636f                co
+00017920: 6e74 696e 7565 0a20 2020 2020 2020 2020  ntinue.         
+00017930: 2020 2020 2020 2020 2020 206e 6577 5f6c             new_l
+00017940: 6174 2c6e 6577 5f6c 6f6e 2c6e 6577 5f64  at,new_lon,new_d
+00017950: 6570 203d 206d 6971 7467 2e61 6464 4c65  ep = miqtg.addLe
+00017960: 7665 7261 726d 7332 4c61 746c 6f6e 286c  verarms2Latlon(l
+00017970: 6174 2c6c 6f6e 2c64 6570 2c6f 6666 7365  at,lon,dep,offse
+00017980: 745f 782c 6f66 6673 6574 5f79 2c6f 6666  t_x,offset_y,off
+00017990: 7365 745f 7a2c 7961 772c 7069 7463 682c  set_z,yaw,pitch,
+000179a0: 726f 6c6c 290a 2020 2020 2020 2020 2020  roll).          
+000179b0: 2020 2020 2020 2020 2020 706f 7369 7469            positi
+000179c0: 6f6e 735b 695d 2e6c 6174 203d 206e 6577  ons[i].lat = new
+000179d0: 5f6c 6174 0a20 2020 2020 2020 2020 2020  _lat.           
+000179e0: 2020 2020 2020 2020 2070 6f73 6974 696f           positio
+000179f0: 6e73 5b69 5d2e 6c6f 6e20 3d20 6e65 775f  ns[i].lon = new_
+00017a00: 6c6f 6e0a 2020 2020 2020 2020 2020 2020  lon.            
+00017a10: 2020 2020 2020 2020 706f 7369 7469 6f6e          position
+00017a20: 735b 695d 2e64 6570 203d 206e 6577 5f64  s[i].dep = new_d
+00017a30: 6570 0a0a 2020 2020 2020 2020 2020 2020  ep..            
+00017a40: 7365 6c66 2e70 726f 762e 6c6f 6728 2261  self.prov.log("a
+00017a50: 7070 6c69 6564 206c 6576 6572 2061 726d  pplied lever arm
+00017a60: 2063 6f6d 7065 6e73 6174 696f 6e20 782c   compensation x,
+00017a70: 792c 7a20 3d20 2220 2b20 7374 7228 6f66  y,z = " + str(of
+00017a80: 6673 6574 5f78 2920 2b20 222c 2220 2b20  fset_x) + "," + 
+00017a90: 7374 7228 6f66 6673 6574 5f79 2920 2b20  str(offset_y) + 
+00017aa0: 222c 2220 2b20 7374 7228 6f66 6673 6574  "," + str(offset
+00017ab0: 5f7a 292c 646f 6e74 5368 6f77 3d54 7275  _z),dontShow=Tru
+00017ac0: 6529 0a0a 2020 2020 2020 2020 6966 206c  e)..        if l
+00017ad0: 656e 2869 6d61 6765 5f64 7473 2920 3e20  en(image_dts) > 
+00017ae0: 303a 0a20 2020 2020 2020 2020 2020 2023  0:.            #
+00017af0: 2043 6865 636b 2077 6865 7468 6572 2064   Check whether d
+00017b00: 6570 7468 2061 6e64 2068 6569 6768 7420  epth and height 
+00017b10: 6172 6520 7365 740a 2020 2020 2020 2020  are set.        
+00017b20: 2020 2020 6c61 745f 6964 656e 7469 6361      lat_identica
+00017b30: 6c2c 206c 6f6e 5f69 6465 6e74 6963 616c  l, lon_identical
+00017b40: 2c20 6465 705f 6964 656e 7469 6361 6c2c  , dep_identical,
+00017b50: 2068 6774 5f69 6465 6e74 6963 616c 2c20   hgt_identical, 
+00017b60: 6465 705f 6e6f 745f 7a65 726f 2c20 6867  dep_not_zero, hg
+00017b70: 745f 6e6f 745f 7a65 726f 2c75 6e63 6572  t_not_zero,uncer
+00017b80: 745f 6e6f 745f 7a65 726f 203d 206e 6176  t_not_zero = nav
+00017b90: 5f64 6174 612e 6368 6563 6b50 6f73 6974  _data.checkPosit
+00017ba0: 696f 6e73 436f 6e74 656e 7428 290a 0a20  ionsContent().. 
+00017bb0: 2020 2020 2020 2020 2020 2023 2057 7269             # Wri
+00017bc0: 7465 2074 6f20 6e61 7669 6761 7469 6f6e  te to navigation
+00017bd0: 2074 7874 2066 696c 650a 2020 2020 2020   txt file.      
+00017be0: 2020 2020 2020 2320 6865 6164 6572 0a20        # header. 
+00017bf0: 2020 2020 2020 2020 2020 2072 6573 203d             res =
+00017c00: 206f 7065 6e28 7365 6c66 2e67 6574 5f69   open(self.get_i
+00017c10: 6e74 5f6e 6176 5f66 696c 6528 292c 2022  nt_nav_file(), "
+00017c20: 7722 290a 2020 2020 2020 2020 2020 2020  w").            
+00017c30: 7265 732e 7772 6974 6528 6d69 7174 762e  res.write(miqtv.
+00017c40: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+00017c50: 7174 275d 5b27 696d 6727 5d2b 225c 7422  qt']['img']+"\t"
+00017c60: 2b6d 6971 7476 2e63 6f6c 5f68 6561 6465  +miqtv.col_heade
+00017c70: 725b 276d 6172 6971 7427 5d5b 2775 7463  r['mariqt']['utc
+00017c80: 275d 290a 0a20 2020 2020 2020 2020 2020  '])..           
+00017c90: 2068 6173 5f61 6c74 203d 2054 7275 6520   has_alt = True 
+00017ca0: 6966 2064 6570 5f6e 6f74 5f7a 6572 6f20  if dep_not_zero 
+00017cb0: 616e 6420 2820 2764 6570 2720 696e 206e  and ( 'dep' in n
+00017cc0: 6176 5f68 6561 6465 7220 6f72 2027 616c  av_header or 'al
+00017cd0: 7427 2069 6e20 6e61 765f 6865 6164 6572  t' in nav_header
+00017ce0: 2029 2065 6c73 6520 4661 6c73 650a 0a20   ) else False.. 
+00017cf0: 2020 2020 2020 2020 2020 2069 6620 276c             if 'l
+00017d00: 6174 2720 696e 206e 6176 5f68 6561 6465  at' in nav_heade
+00017d10: 723a 0a20 2020 2020 2020 2020 2020 2020  r:.             
+00017d20: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00017d30: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00017d40: 6572 5b27 6d61 7269 7174 275d 5b27 6c61  er['mariqt']['la
+00017d50: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+00017d60: 2069 6620 276c 6f6e 2720 696e 206e 6176   if 'lon' in nav
+00017d70: 5f68 6561 6465 723a 0a20 2020 2020 2020  _header:.       
+00017d80: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+00017d90: 7465 2822 5c74 222b 6d69 7174 762e 636f  te("\t"+miqtv.co
+00017da0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
+00017db0: 275d 5b27 6c6f 6e27 5d29 0a20 2020 2020  ']['lon']).     
+00017dc0: 2020 2020 2020 2069 6620 6861 735f 616c         if has_al
+00017dd0: 743a 0a20 2020 2020 2020 2020 2020 2020  t:.             
+00017de0: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00017df0: 222b 6d69 7174 762e 636f 6c5f 6865 6164  "+miqtv.col_head
+00017e00: 6572 5b27 6d61 7269 7174 275d 5b27 616c  er['mariqt']['al
+00017e10: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+00017e20: 2069 6620 6867 745f 6e6f 745f 7a65 726f   if hgt_not_zero
+00017e30: 2061 6e64 2027 6867 7427 2069 6e20 6e61   and 'hgt' in na
+00017e40: 765f 6865 6164 6572 3a0a 2020 2020 2020  v_header:.      
+00017e50: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00017e60: 6974 6528 225c 7422 2b6d 6971 7476 2e63  ite("\t"+miqtv.c
+00017e70: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00017e80: 7427 5d5b 2768 6774 275d 290a 2020 2020  t']['hgt']).    
+00017e90: 2020 2020 2020 2020 6966 2075 6e63 6572          if uncer
+00017ea0: 745f 6e6f 745f 7a65 726f 2061 6e64 2027  t_not_zero and '
+00017eb0: 756e 6365 7274 2720 696e 206e 6176 5f68  uncert' in nav_h
+00017ec0: 6561 6465 723a 0a20 2020 2020 2020 2020  eader:.         
+00017ed0: 2020 2020 2020 2072 6573 2e77 7269 7465         res.write
+00017ee0: 2822 5c74 222b 6d69 7174 762e 636f 6c5f  ("\t"+miqtv.col_
+00017ef0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+00017f00: 5b27 756e 6365 7274 275d 290a 2020 2020  ['uncert']).    
+00017f10: 2020 2020 2020 2020 7265 732e 7772 6974          res.writ
+00017f20: 6528 225c 6e22 290a 2020 2020 2020 2020  e("\n").        
+00017f30: 2020 2020 2320 6461 7461 206c 696e 6573      # data lines
+00017f40: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+00017f50: 2066 696c 6520 696e 2069 6d61 6765 5f64   file in image_d
+00017f60: 7473 3a0a 2020 2020 2020 2020 2020 2020  ts:.            
+00017f70: 2020 2020 666f 7220 7469 6d65 706f 696e      for timepoin
+00017f80: 7420 696e 2069 6d61 6765 5f64 7473 5b66  t in image_dts[f
+00017f90: 696c 655d 3a0a 2020 2020 2020 2020 2020  ile]:.          
+00017fa0: 2020 2020 2020 2020 2020 7265 732e 7772            res.wr
+00017fb0: 6974 6528 6669 6c65 2b22 5c74 222b 7469  ite(file+"\t"+ti
+00017fc0: 6d65 706f 696e 742e 6461 7465 5469 6d65  mepoint.dateTime
+00017fd0: 2829 2e73 7472 6674 696d 6528 6d69 7174  ().strftime(miqt
+00017fe0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
+00017ff0: 6d61 7269 7174 275d 2929 200a 2020 2020  mariqt'])) .    
+00018000: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018010: 6966 2027 6c61 7427 2069 6e20 6e61 765f  if 'lat' in nav_
+00018020: 6865 6164 6572 3a0a 2020 2020 2020 2020  header:.        
+00018030: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018040: 7661 6c20 3d20 7469 6d65 706f 696e 742e  val = timepoint.
+00018050: 6c61 740a 2020 2020 2020 2020 2020 2020  lat.            
+00018060: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00018070: 7772 6974 6528 225c 7422 2b73 7472 2876  write("\t"+str(v
+00018080: 616c 2929 0a20 2020 2020 2020 2020 2020  al)).           
+00018090: 2020 2020 2020 2020 2069 6620 276c 6f6e           if 'lon
+000180a0: 2720 696e 206e 6176 5f68 6561 6465 723a  ' in nav_header:
+000180b0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000180c0: 2020 2020 2020 2020 2076 616c 203d 2074           val = t
+000180d0: 696d 6570 6f69 6e74 2e6c 6f6e 0a20 2020  imepoint.lon.   
+000180e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000180f0: 2020 2020 2072 6573 2e77 7269 7465 2822       res.write("
+00018100: 5c74 222b 7374 7228 7661 6c29 290a 2020  \t"+str(val)).  
+00018110: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018120: 2020 6966 2068 6173 5f61 6c74 3a0a 2020    if has_alt:.  
+00018130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018140: 2020 2020 2020 7661 6c20 3d20 7469 6d65        val = time
+00018150: 706f 696e 742e 6465 700a 2020 2020 2020  point.dep.      
+00018160: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018170: 2020 2320 6465 7020 746f 2061 6c74 0a20    # dep to alt. 
+00018180: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018190: 2020 2020 2020 2076 616c 202a 3d20 2d31         val *= -1
+000181a0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000181b0: 2020 2020 2020 2020 2072 6573 2e77 7269           res.wri
+000181c0: 7465 2822 5c74 222b 7374 7228 7661 6c29  te("\t"+str(val)
+000181d0: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+000181e0: 2020 2020 2020 6966 2068 6774 5f6e 6f74        if hgt_not
+000181f0: 5f7a 6572 6f20 616e 6420 2768 6774 2720  _zero and 'hgt' 
+00018200: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+00018210: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018220: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
+00018230: 6570 6f69 6e74 2e68 6774 0a20 2020 2020  epoint.hgt.     
+00018240: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018250: 2020 2072 6573 2e77 7269 7465 2822 5c74     res.write("\t
+00018260: 222b 7374 7228 7661 6c29 290a 2020 2020  "+str(val)).    
+00018270: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018280: 6966 2075 6e63 6572 745f 6e6f 745f 7a65  if uncert_not_ze
+00018290: 726f 2061 6e64 2027 756e 6365 7274 2720  ro and 'uncert' 
+000182a0: 696e 206e 6176 5f68 6561 6465 723a 0a20  in nav_header:. 
+000182b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182c0: 2020 2020 2020 2076 616c 203d 2074 696d         val = tim
+000182d0: 6570 6f69 6e74 2e75 6e63 6572 740a 2020  epoint.uncert.  
+000182e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000182f0: 2020 2020 2020 7265 732e 7772 6974 6528        res.write(
+00018300: 225c 7422 2b73 7472 2876 616c 2929 0a20  "\t"+str(val)). 
+00018310: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018320: 2020 2072 6573 2e77 7269 7465 2822 5c6e     res.write("\n
+00018330: 2229 0a20 2020 2020 2020 2020 2020 2072  ").            r
+00018340: 6573 2e63 6c6f 7365 2829 0a0a 2020 2020  es.close()..    
+00018350: 2020 2020 2020 2020 2320 5772 6974 6520          # Write 
+00018360: 746f 2067 656f 6a73 6f6e 2066 696c 650a  to geojson file.
+00018370: 2020 2020 2020 2020 2020 2020 6765 6f6a              geoj
+00018380: 736f 6e20 3d20 7b27 7479 7065 273a 2027  son = {'type': '
+00018390: 4665 6174 7572 6543 6f6c 6c65 6374 696f  FeatureCollectio
+000183a0: 6e27 2c20 276e 616d 6527 3a20 7365 6c66  n', 'name': self
+000183b0: 2e64 6972 2e65 7665 6e74 2829 2b22 5f22  .dir.event()+"_"
+000183c0: 2b73 656c 662e 6469 722e 7365 6e73 6f72  +self.dir.sensor
+000183d0: 2829 2b22 5f69 6d61 6765 2d6e 6176 6967  ()+"_image-navig
+000183e0: 6174 696f 6e22 2c20 2766 6561 7475 7265  ation", 'feature
+000183f0: 7327 3a20 5b5d 7d0a 2020 2020 2020 2020  s': []}.        
+00018400: 2020 2020 666f 7220 6669 6c65 2069 6e20      for file in 
+00018410: 696d 6167 655f 6474 733a 0a20 2020 2020  image_dts:.     
+00018420: 2020 2020 2020 2020 2020 2023 2070 686f             # pho
+00018430: 746f 0a20 2020 2020 2020 2020 2020 2020  to.             
+00018440: 2020 2069 6620 6c65 6e28 696d 6167 655f     if len(image_
+00018450: 6474 735b 6669 6c65 5d29 203d 3d20 313a  dts[file]) == 1:
+00018460: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00018470: 2020 2020 2069 6620 6465 705f 6e6f 745f       if dep_not_
+00018480: 7a65 726f 3a0a 2020 2020 2020 2020 2020  zero:.          
+00018490: 2020 2020 2020 2020 2020 2020 2020 6765                ge
+000184a0: 6f6d 6574 7279 203d 2020 7b27 7479 7065  ometry =  {'type
+000184b0: 273a 2022 506f 696e 7422 2c20 2763 6f6f  ': "Point", 'coo
+000184c0: 7264 696e 6174 6573 273a 200a 2020 2020  rdinates': .    
+000184d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000184f0: 2020 2020 5b66 6c6f 6174 2869 6d61 6765      [float(image
+00018500: 5f64 7473 5b66 696c 655d 5b30 5d2e 6c6f  _dts[file][0].lo
+00018510: 6e29 2c20 666c 6f61 7428 696d 6167 655f  n), float(image_
+00018520: 6474 735b 6669 6c65 5d5b 305d 2e6c 6174  dts[file][0].lat
+00018530: 292c 2066 6c6f 6174 2869 6d61 6765 5f64  ), float(image_d
+00018540: 7473 5b66 696c 655d 5b30 5d2e 6465 7029  ts[file][0].dep)
+00018550: 5d0a 2020 2020 2020 2020 2020 2020 2020  ].              
+00018560: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018570: 2020 2020 2020 7d0a 2020 2020 2020 2020        }.        
+00018580: 2020 2020 2020 2020 2020 2020 656c 7365              else
+00018590: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+000185a0: 2020 2020 2020 2020 2020 6765 6f6d 6574            geomet
+000185b0: 7279 203d 2020 7b27 7479 7065 273a 2022  ry =  {'type': "
 000185c0: 506f 696e 7422 2c20 2763 6f6f 7264 696e  Point", 'coordin
-000185d0: 6174 6573 273a 0a20 2020 2020 2020 2020  ates':.         
+000185d0: 6174 6573 273a 200a 2020 2020 2020 2020  ates': .        
 000185e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000185f0: 2020 2020 2020 2020 2020 2020 2020 205b                 [
-00018600: 5b66 6c6f 6174 2864 2e6c 6f6e 292c 2066  [float(d.lon), f
-00018610: 6c6f 6174 2864 2e6c 6174 292c 2066 6c6f  loat(d.lat), flo
-00018620: 6174 2864 2e64 6570 295d 2066 6f72 2064  at(d.dep)] for d
-00018630: 2069 6e20 696d 6167 655f 6474 735b 6669   in image_dts[fi
-00018640: 6c65 5d5d 0a20 2020 2020 2020 2020 2020  le]].           
+000185f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018600: 5b66 6c6f 6174 2869 6d61 6765 5f64 7473  [float(image_dts
+00018610: 5b66 696c 655d 5b30 5d2e 6c6f 6e29 2c20  [file][0].lon), 
+00018620: 666c 6f61 7428 696d 6167 655f 6474 735b  float(image_dts[
+00018630: 6669 6c65 5d5b 305d 2e6c 6174 295d 0a20  file][0].lat)]. 
+00018640: 2020 2020 2020 2020 2020 2020 2020 2020                  
 00018650: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018660: 2020 2020 2020 2020 207d 0a20 2020 2020           }.     
-00018670: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-00018680: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-00018690: 2020 2020 2020 2020 2020 2020 2067 656f               geo
-000186a0: 6d65 7472 7920 3d20 207b 2774 7970 6527  metry =  {'type'
-000186b0: 3a20 224d 756c 7469 506f 696e 7422 2c20  : "MultiPoint", 
-000186c0: 2763 6f6f 7264 696e 6174 6573 273a 0a20  'coordinates':. 
-000186d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000186f0: 2020 2020 2020 205b 5b66 6c6f 6174 2864         [[float(d
-00018700: 2e6c 6f6e 292c 2066 6c6f 6174 2864 2e6c  .lon), float(d.l
-00018710: 6174 295d 2066 6f72 2064 2069 6e20 696d  at)] for d in im
-00018720: 6167 655f 6474 735b 6669 6c65 5d5d 0a20  age_dts[file]]. 
+00018660: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
+00018670: 2020 2020 2020 2020 2069 6620 5472 7565           if True
+00018680: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
+00018690: 7829 2066 6f72 2078 2069 6e20 6765 6f6d  x) for x in geom
+000186a0: 6574 7279 5b27 636f 6f72 6469 6e61 7465  etry['coordinate
+000186b0: 7327 5d5d 3a0a 2020 2020 2020 2020 2020  s']]:.          
+000186c0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+000186d0: 6e74 696e 7565 0a0a 2020 2020 2020 2020  ntinue..        
+000186e0: 2020 2020 2020 2020 2320 7669 6465 6f0a          # video.
+000186f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018700: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+00018710: 2020 2020 2020 2020 2020 6966 2064 6570            if dep
+00018720: 5f6e 6f74 5f7a 6572 6f3a 0a20 2020 2020  _not_zero:.     
 00018730: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018740: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018750: 2020 207d 0a20 2020 2020 2020 2020 2020     }.           
-00018760: 2020 2020 2020 2020 2069 6620 5472 7565           if True
-00018770: 2069 6e20 5b6d 6174 682e 6973 6e61 6e28   in [math.isnan(
-00018780: 7829 2066 6f72 2078 2069 6e20 5b69 7465  x) for x in [ite
-00018790: 6d20 666f 7220 7375 626c 6973 7420 696e  m for sublist in
-000187a0: 2067 656f 6d65 7472 795b 2763 6f6f 7264   geometry['coord
-000187b0: 696e 6174 6573 275d 2066 6f72 2069 7465  inates'] for ite
-000187c0: 6d20 696e 2073 7562 6c69 7374 5d5d 3a0a  m in sublist]]:.
-000187d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000187e0: 2020 2020 2020 2020 636f 6e74 696e 7565          continue
-000187f0: 0a0a 2020 2020 2020 2020 2020 2020 2020  ..              
-00018800: 2020 6765 6f6a 736f 6e5b 2766 6561 7475    geojson['featu
-00018810: 7265 7327 5d2e 6170 7065 6e64 287b 2774  res'].append({'t
-00018820: 7970 6527 3a20 2746 6561 7475 7265 272c  ype': 'Feature',
-00018830: 2027 7072 6f70 6572 7469 6573 273a 207b   'properties': {
-00018840: 2769 6427 3a20 6669 6c65 7d2c 2027 6765  'id': file}, 'ge
-00018850: 6f6d 6574 7279 273a 2067 656f 6d65 7472  ometry': geometr
-00018860: 7920 7d29 0a20 2020 2020 2020 2020 2020  y }).           
-00018870: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-00018880: 2020 6f20 3d20 6f70 656e 2873 656c 662e    o = open(self.
-00018890: 6765 745f 696e 745f 6e61 765f 6669 6c65  get_int_nav_file
-000188a0: 2829 2e72 6570 6c61 6365 2822 2e74 7874  ().replace(".txt
-000188b0: 222c 2022 2e67 656f 6a73 6f6e 2229 2c0a  ", ".geojson"),.
-000188c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000188d0: 2020 2020 2022 7722 2c20 6572 726f 7273       "w", errors
-000188e0: 3d22 6967 6e6f 7265 222c 2065 6e63 6f64  ="ignore", encod
-000188f0: 696e 673d 2775 7466 2d38 2729 0a20 2020  ing='utf-8').   
-00018900: 2020 2020 2020 2020 206a 736f 6e2e 6475           json.du
-00018910: 6d70 2867 656f 6a73 6f6e 2c20 6f2c 2065  mp(geojson, o, e
-00018920: 6e73 7572 655f 6173 6369 693d 4661 6c73  nsure_ascii=Fals
-00018930: 652c 2069 6e64 656e 743d 3429 0a20 2020  e, indent=4).   
-00018940: 2020 2020 2020 2020 206f 2e63 6c6f 7365           o.close
-00018950: 2829 0a0a 2020 2020 2020 2020 2020 2020  ()..            
-00018960: 7365 6c66 2e70 726f 762e 6164 6441 7267  self.prov.addArg
-00018970: 756d 656e 7428 2269 6e70 7574 4e61 7669  ument("inputNavi
-00018980: 6761 7469 6f6e 4669 6c65 222c 6e61 765f  gationFile",nav_
-00018990: 7061 7468 2c6f 7665 7277 7269 7465 3d54  path,overwrite=T
-000189a0: 7275 6529 0a20 2020 2020 2020 2020 2020  rue).           
-000189b0: 2073 656c 662e 7072 6f76 2e6c 6f67 2822   self.prov.log("
-000189c0: 7061 7273 6564 2066 726f 6d20 696e 7075  parsed from inpu
-000189d0: 744e 6176 6967 6174 696f 6e46 696c 653a  tNavigationFile:
-000189e0: 2022 202b 2073 7472 286e 6176 5f68 6561   " + str(nav_hea
-000189f0: 6465 7229 2c64 6f6e 7453 686f 773d 5472  der),dontShow=Tr
-00018a00: 7565 290a 2020 2020 2020 2020 2020 2020  ue).            
-00018a10: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
-00018a20: 2020 2020 2072 6574 7572 6e20 5472 7565       return True
-00018a30: 2c20 224e 6176 6967 6174 696f 6e20 6461  , "Navigation da
-00018a40: 7461 2063 7265 6174 6564 2220 2b20 7265  ta created" + re
-00018a50: 7475 726e 4d73 670a 2020 2020 2020 2020  turnMsg.        
-00018a60: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
-00018a70: 2020 732e 7374 6f70 2829 0a20 2020 2020    s.stop().     
-00018a80: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-00018a90: 6c73 652c 2022 4e6f 2069 6d61 6765 2063  lse, "No image c
-00018aa0: 6f6f 7264 696e 6174 6573 2066 6f75 6e64  oordinates found
-00018ab0: 2220 2b20 7265 7475 726e 4d73 670a 0a20  " + returnMsg.. 
-00018ac0: 2020 2064 6566 2063 7265 6174 6549 6d61     def createIma
-00018ad0: 6765 4e61 7669 6761 7469 6f6e 4669 6c65  geNavigationFile
-00018ae0: 2873 656c 662c 206e 6176 5f70 6174 683a  (self, nav_path:
-00018af0: 2073 7472 2c20 6e61 765f 6865 6164 6572   str, nav_header
-00018b00: 3d6d 6971 7476 2e70 6f73 5f68 6561 6465  =miqtv.pos_heade
-00018b10: 725b 2770 616e 6761 6561 275d 2c20 6461  r['pangaea'], da
-00018b20: 7465 5f66 6f72 6d61 743d 6d69 7174 762e  te_format=miqtv.
-00018b30: 6461 7465 5f66 6f72 6d61 7473 5b27 7061  date_formats['pa
-00018b40: 6e67 6165 6127 5d2c 206f 7665 7277 7269  ngaea'], overwri
-00018b50: 7465 3d46 616c 7365 2c20 636f 6c5f 7365  te=False, col_se
-00018b60: 7061 7261 746f 7220 3d20 225c 7422 2c20  parator = "\t", 
-00018b70: 7669 6465 6f53 616d 706c 6553 6563 6f6e  videoSampleSecon
-00018b80: 6473 3d31 2c0a 2020 2020 2020 2020 2020  ds=1,.          
-00018b90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00018ba0: 2020 2020 2020 2020 2020 6f66 6673 6574            offset
-00018bb0: 5f78 3d30 2c20 6f66 6673 6574 5f79 3d30  _x=0, offset_y=0
-00018bc0: 2c20 6f66 6673 6574 5f7a 3d30 2c61 6e67  , offset_z=0,ang
-00018bd0: 6c65 735f 696e 5f72 6164 203d 2046 616c  les_in_rad = Fal
-00018be0: 7365 2c20 7265 636f 7264 7332 6265 496e  se, records2beIn
-00018bf0: 7665 7274 6564 3d5b 5d29 3a0a 2020 2020  verted=[]):.    
-00018c00: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
-00018c10: 6564 202d 2075 7365 2063 7265 6174 655f  ed - use create_
-00018c20: 696d 6167 655f 6e61 7669 6761 7469 6f6e  image_navigation
-00018c30: 5f66 696c 6520 2222 220a 2020 2020 2020  _file """.      
-00018c40: 2020 7265 7475 726e 2073 656c 662e 6372    return self.cr
-00018c50: 6561 7465 5f69 6d61 6765 5f6e 6176 6967  eate_image_navig
-00018c60: 6174 696f 6e5f 6669 6c65 286e 6176 5f70  ation_file(nav_p
-00018c70: 6174 682c 206e 6176 5f68 6561 6465 722c  ath, nav_header,
-00018c80: 2064 6174 655f 666f 726d 6174 2c20 6f76   date_format, ov
-00018c90: 6572 7772 6974 652c 2063 6f6c 5f73 6570  erwrite, col_sep
-00018ca0: 6172 6174 6f72 2c20 7669 6465 6f53 616d  arator, videoSam
-00018cb0: 706c 6553 6563 6f6e 6473 2c20 6f66 6673  pleSeconds, offs
-00018cc0: 6574 5f78 2c20 6f66 6673 6574 5f79 2c20  et_x, offset_y, 
-00018cd0: 6f66 6673 6574 5f7a 2c20 616e 676c 6573  offset_z, angles
-00018ce0: 5f69 6e5f 7261 642c 2072 6563 6f72 6473  _in_rad, records
-00018cf0: 3262 6549 6e76 6572 7465 6429 0a0a 0a20  2beInverted)... 
-00018d00: 2020 2064 6566 2063 7265 6174 655f 696d     def create_im
-00018d10: 6167 655f 7368 6132 3536 5f66 696c 6528  age_sha256_file(
-00018d20: 7365 6c66 2c72 6552 6561 6441 6c6c 3d54  self,reReadAll=T
-00018d30: 7275 6529 3a0a 2020 2020 2020 2020 2222  rue):.        ""
-00018d40: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
-00018d50: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
-00018d60: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
-00018d70: 6720 7065 7220 696d 6167 6520 6974 7320  g per image its 
-00018d80: 5348 4132 3536 2068 6173 682e 0a20 2020  SHA256 hash..   
-00018d90: 2020 2020 2020 2020 2049 6620 7265 5265           If reRe
-00018da0: 6164 416c 6c20 6973 2054 7275 6520 616c  adAll is True al
-00018db0: 6c20 696d 6167 6573 2720 6861 7368 6573  l images' hashes
-00018dc0: 2061 7265 2064 6574 6572 6d69 6e65 642e   are determined.
-00018dd0: 204f 7468 6572 7769 7365 206f 6e6c 7920   Otherwise only 
-00018de0: 666f 7220 7468 6f73 6520 6669 6c65 730a  for those files.
-00018df0: 2020 2020 2020 2020 2020 2020 7768 6963              whic
-00018e00: 6820 6172 6520 6e6f 7420 7965 7420 696e  h are not yet in
-00018e10: 2074 6865 2069 6e74 6572 6d65 6469 6174   the intermediat
-00018e20: 6520 6669 6c65 2063 6f6e 7461 696e 696e  e file containin
-00018e30: 6720 7468 6520 696d 6167 6520 6861 7368  g the image hash
-00018e40: 6573 2020 2222 220a 2020 2020 2020 2020  es  """.        
-00018e50: 6861 7368 6573 203d 207b 7d0a 2020 2020  hashes = {}.    
-00018e60: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
-00018e70: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
-00018e80: 6e74 5f68 6173 685f 6669 6c65 2829 293a  nt_hash_file()):
-00018e90: 0a20 2020 2020 2020 2020 2020 2068 6173  .            has
-00018ea0: 6865 7320 3d20 6d69 7174 662e 7461 6246  hes = miqtf.tabF
-00018eb0: 696c 6544 6174 6128 7365 6c66 2e67 6574  ileData(self.get
-00018ec0: 5f69 6e74 5f68 6173 685f 6669 6c65 2829  _int_hash_file()
-00018ed0: 2c20 5b6d 6971 7476 2e63 6f6c 5f68 6561  , [miqtv.col_hea
-00018ee0: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00018ef0: 6d67 275d 2c20 6d69 7174 762e 636f 6c5f  mg'], miqtv.col_
-00018f00: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-00018f10: 5b27 6861 7368 275d 5d2c 206b 6579 5f63  ['hash']], key_c
-00018f20: 6f6c 3d6d 6971 7476 2e63 6f6c 5f68 6561  ol=miqtv.col_hea
-00018f30: 6465 725b 276d 6172 6971 7427 5d5b 2769  der['mariqt']['i
-00018f40: 6d67 275d 290a 0a20 2020 2020 2020 2069  mg'])..        i
-00018f50: 6d61 6765 7349 6e52 6177 203d 2073 656c  magesInRaw = sel
-00018f60: 662e 696d 6167 6573 496e 496d 6167 6573  f.imagesInImages
-00018f70: 4469 7228 290a 2020 2020 2020 2020 6966  Dir().        if
-00018f80: 206c 656e 2869 6d61 6765 7349 6e52 6177   len(imagesInRaw
-00018f90: 2920 3e20 303a 0a0a 2020 2020 2020 2020  ) > 0:..        
-00018fa0: 2020 2020 6164 6465 645f 6861 7368 6573      added_hashes
-00018fb0: 203d 2030 0a20 2020 2020 2020 2020 2020   = 0.           
-00018fc0: 2070 726f 6720 3d20 6d69 7174 632e 5072   prog = miqtc.Pr
-00018fd0: 696e 744b 6e6f 776e 5072 6f67 7265 7373  intKnownProgress
-00018fe0: 4d73 6728 2243 6865 636b 696e 6720 6861  Msg("Checking ha
-00018ff0: 7368 6573 222c 206c 656e 2869 6d61 6765  shes", len(image
-00019000: 7349 6e52 6177 292c 6d6f 6475 6c6f 3d35  sInRaw),modulo=5
-00019010: 290a 2020 2020 2020 2020 2020 2020 666f  ).            fo
-00019020: 7220 6669 6c65 2069 6e20 696d 6167 6573  r file in images
-00019030: 496e 5261 773a 0a20 2020 2020 2020 2020  InRaw:.         
-00019040: 2020 2020 2020 2070 726f 672e 7072 6f67         prog.prog
-00019050: 7265 7373 2829 0a0a 2020 2020 2020 2020  ress()..        
-00019060: 2020 2020 2020 2020 6966 206e 6f74 2073          if not s
-00019070: 656c 662e 5f5f 616c 6c55 5549 4473 4368  elf.__allUUIDsCh
-00019080: 6563 6b65 6420 616e 6420 6e6f 7420 6d69  ecked and not mi
-00019090: 7174 692e 696d 6167 6543 6f6e 7461 696e  qti.imageContain
-000190a0: 7356 616c 6964 5555 4944 2866 696c 6529  sValidUUID(file)
-000190b0: 5b30 5d3a 0a20 2020 2020 2020 2020 2020  [0]:.           
-000190c0: 2020 2020 2020 2020 2023 2072 656d 6f76           # remov
-000190d0: 6520 6672 6f6d 2075 7569 6420 6669 6c65  e from uuid file
-000190e0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-000190f0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00019100: 6578 6973 7473 2873 656c 662e 6765 745f  exists(self.get_
-00019110: 696e 745f 7575 6964 5f66 696c 6528 2929  int_uuid_file())
-00019120: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019130: 2020 2020 2020 2020 2020 7265 7320 3d20            res = 
-00019140: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
-00019150: 745f 7575 6964 5f66 696c 6528 292c 2022  t_uuid_file(), "
-00019160: 7222 290a 2020 2020 2020 2020 2020 2020  r").            
-00019170: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-00019180: 7320 3d20 7265 732e 7265 6164 6c69 6e65  s = res.readline
-00019190: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
-000191a0: 2020 2020 2020 2020 2020 2020 7265 732e              res.
-000191b0: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
-000191c0: 2020 2020 2020 2020 2020 2020 656c 7365              else
-000191d0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-000191e0: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
-000191f0: 3d20 5b5d 0a20 2020 2020 2020 2020 2020  = [].           
-00019200: 2020 2020 2020 2020 2069 203d 2030 0a20           i = 0. 
-00019210: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019220: 2020 206c 696e 654e 7220 3d20 690a 2020     lineNr = i.  
-00019230: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019240: 2020 666f 7220 6c69 6e65 2069 6e20 6c69    for line in li
-00019250: 6e65 733a 0a20 2020 2020 2020 2020 2020  nes:.           
-00019260: 2020 2020 2020 2020 2020 2020 2069 6620               if 
-00019270: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-00019280: 2866 696c 6529 2069 6e20 6c69 6e65 3a0a  (file) in line:.
-00019290: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192a0: 2020 2020 2020 2020 2020 2020 6c69 6e65              line
-000192b0: 4e72 203d 2069 0a20 2020 2020 2020 2020  Nr = i.         
+00018740: 2020 2067 656f 6d65 7472 7920 3d20 207b     geometry =  {
+00018750: 2774 7970 6527 3a20 224d 756c 7469 506f  'type': "MultiPo
+00018760: 696e 7422 2c20 2763 6f6f 7264 696e 6174  int", 'coordinat
+00018770: 6573 273a 0a20 2020 2020 2020 2020 2020  es':.           
+00018780: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018790: 2020 2020 2020 2020 2020 2020 205b 5b66               [[f
+000187a0: 6c6f 6174 2864 2e6c 6f6e 292c 2066 6c6f  loat(d.lon), flo
+000187b0: 6174 2864 2e6c 6174 292c 2066 6c6f 6174  at(d.lat), float
+000187c0: 2864 2e64 6570 295d 2066 6f72 2064 2069  (d.dep)] for d i
+000187d0: 6e20 696d 6167 655f 6474 735b 6669 6c65  n image_dts[file
+000187e0: 5d5d 0a20 2020 2020 2020 2020 2020 2020  ]].             
+000187f0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018800: 2020 2020 2020 207d 0a20 2020 2020 2020         }.       
+00018810: 2020 2020 2020 2020 2020 2020 2065 6c73               els
+00018820: 653a 0a20 2020 2020 2020 2020 2020 2020  e:.             
+00018830: 2020 2020 2020 2020 2020 2067 656f 6d65             geome
+00018840: 7472 7920 3d20 207b 2774 7970 6527 3a20  try =  {'type': 
+00018850: 224d 756c 7469 506f 696e 7422 2c20 2763  "MultiPoint", 'c
+00018860: 6f6f 7264 696e 6174 6573 273a 0a20 2020  oordinates':.   
+00018870: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018880: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018890: 2020 2020 205b 5b66 6c6f 6174 2864 2e6c       [[float(d.l
+000188a0: 6f6e 292c 2066 6c6f 6174 2864 2e6c 6174  on), float(d.lat
+000188b0: 295d 2066 6f72 2064 2069 6e20 696d 6167  )] for d in imag
+000188c0: 655f 6474 735b 6669 6c65 5d5d 0a20 2020  e_dts[file]].   
+000188d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000188f0: 207d 0a20 2020 2020 2020 2020 2020 2020   }.             
+00018900: 2020 2020 2020 2069 6620 5472 7565 2069         if True i
+00018910: 6e20 5b6d 6174 682e 6973 6e61 6e28 7829  n [math.isnan(x)
+00018920: 2066 6f72 2078 2069 6e20 5b69 7465 6d20   for x in [item 
+00018930: 666f 7220 7375 626c 6973 7420 696e 2067  for sublist in g
+00018940: 656f 6d65 7472 795b 2763 6f6f 7264 696e  eometry['coordin
+00018950: 6174 6573 275d 2066 6f72 2069 7465 6d20  ates'] for item 
+00018960: 696e 2073 7562 6c69 7374 5d5d 3a0a 2020  in sublist]]:.  
+00018970: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018980: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
+00018990: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000189a0: 6765 6f6a 736f 6e5b 2766 6561 7475 7265  geojson['feature
+000189b0: 7327 5d2e 6170 7065 6e64 287b 2774 7970  s'].append({'typ
+000189c0: 6527 3a20 2746 6561 7475 7265 272c 2027  e': 'Feature', '
+000189d0: 7072 6f70 6572 7469 6573 273a 207b 2769  properties': {'i
+000189e0: 6427 3a20 6669 6c65 7d2c 2027 6765 6f6d  d': file}, 'geom
+000189f0: 6574 7279 273a 2067 656f 6d65 7472 7920  etry': geometry 
+00018a00: 7d29 0a20 2020 2020 2020 2020 2020 2020  }).             
+00018a10: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+00018a20: 6f20 3d20 6f70 656e 2873 656c 662e 6765  o = open(self.ge
+00018a30: 745f 696e 745f 6e61 765f 6669 6c65 2829  t_int_nav_file()
+00018a40: 2e72 6570 6c61 6365 2822 2e74 7874 222c  .replace(".txt",
+00018a50: 2022 2e67 656f 6a73 6f6e 2229 2c0a 2020   ".geojson"),.  
+00018a60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018a70: 2020 2022 7722 2c20 6572 726f 7273 3d22     "w", errors="
+00018a80: 6967 6e6f 7265 222c 2065 6e63 6f64 696e  ignore", encodin
+00018a90: 673d 2775 7466 2d38 2729 0a20 2020 2020  g='utf-8').     
+00018aa0: 2020 2020 2020 206a 736f 6e2e 6475 6d70         json.dump
+00018ab0: 2867 656f 6a73 6f6e 2c20 6f2c 2065 6e73  (geojson, o, ens
+00018ac0: 7572 655f 6173 6369 693d 4661 6c73 652c  ure_ascii=False,
+00018ad0: 2069 6e64 656e 743d 3429 0a20 2020 2020   indent=4).     
+00018ae0: 2020 2020 2020 206f 2e63 6c6f 7365 2829         o.close()
+00018af0: 0a0a 2020 2020 2020 2020 2020 2020 7365  ..            se
+00018b00: 6c66 2e70 726f 762e 6164 6441 7267 756d  lf.prov.addArgum
+00018b10: 656e 7428 2269 6e70 7574 4e61 7669 6761  ent("inputNaviga
+00018b20: 7469 6f6e 4669 6c65 222c 6e61 765f 7061  tionFile",nav_pa
+00018b30: 7468 2c6f 7665 7277 7269 7465 3d54 7275  th,overwrite=Tru
+00018b40: 6529 0a20 2020 2020 2020 2020 2020 2073  e).            s
+00018b50: 656c 662e 7072 6f76 2e6c 6f67 2822 7061  elf.prov.log("pa
+00018b60: 7273 6564 2066 726f 6d20 696e 7075 744e  rsed from inputN
+00018b70: 6176 6967 6174 696f 6e46 696c 653a 2022  avigationFile: "
+00018b80: 202b 2073 7472 286e 6176 5f68 6561 6465   + str(nav_heade
+00018b90: 7229 2c64 6f6e 7453 686f 773d 5472 7565  r),dontShow=True
+00018ba0: 290a 2020 2020 2020 2020 2020 2020 732e  ).            s.
+00018bb0: 7374 6f70 2829 0a20 2020 2020 2020 2020  stop().         
+00018bc0: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
+00018bd0: 224e 6176 6967 6174 696f 6e20 6461 7461  "Navigation data
+00018be0: 2063 7265 6174 6564 2220 2b20 7265 7475   created" + retu
+00018bf0: 726e 4d73 670a 2020 2020 2020 2020 656c  rnMsg.        el
+00018c00: 7365 3a0a 2020 2020 2020 2020 2020 2020  se:.            
+00018c10: 732e 7374 6f70 2829 0a20 2020 2020 2020  s.stop().       
+00018c20: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00018c30: 652c 2022 4e6f 2069 6d61 6765 2063 6f6f  e, "No image coo
+00018c40: 7264 696e 6174 6573 2066 6f75 6e64 2220  rdinates found" 
+00018c50: 2b20 7265 7475 726e 4d73 670a 0a20 2020  + returnMsg..   
+00018c60: 2064 6566 2063 7265 6174 6549 6d61 6765   def createImage
+00018c70: 4e61 7669 6761 7469 6f6e 4669 6c65 2873  NavigationFile(s
+00018c80: 656c 662c 206e 6176 5f70 6174 683a 2073  elf, nav_path: s
+00018c90: 7472 2c20 6e61 765f 6865 6164 6572 3d6d  tr, nav_header=m
+00018ca0: 6971 7476 2e70 6f73 5f68 6561 6465 725b  iqtv.pos_header[
+00018cb0: 2770 616e 6761 6561 275d 2c20 6461 7465  'pangaea'], date
+00018cc0: 5f66 6f72 6d61 743d 6d69 7174 762e 6461  _format=miqtv.da
+00018cd0: 7465 5f66 6f72 6d61 7473 5b27 7061 6e67  te_formats['pang
+00018ce0: 6165 6127 5d2c 206f 7665 7277 7269 7465  aea'], overwrite
+00018cf0: 3d46 616c 7365 2c20 636f 6c5f 7365 7061  =False, col_sepa
+00018d00: 7261 746f 7220 3d20 225c 7422 2c20 7669  rator = "\t", vi
+00018d10: 6465 6f53 616d 706c 6553 6563 6f6e 6473  deoSampleSeconds
+00018d20: 3d31 2c0a 2020 2020 2020 2020 2020 2020  =1,.            
+00018d30: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00018d40: 2020 2020 2020 2020 6f66 6673 6574 5f78          offset_x
+00018d50: 3d30 2c20 6f66 6673 6574 5f79 3d30 2c20  =0, offset_y=0, 
+00018d60: 6f66 6673 6574 5f7a 3d30 2c61 6e67 6c65  offset_z=0,angle
+00018d70: 735f 696e 5f72 6164 203d 2046 616c 7365  s_in_rad = False
+00018d80: 2c20 7265 636f 7264 7332 6265 496e 7665  , records2beInve
+00018d90: 7274 6564 3d5b 5d29 3a0a 2020 2020 2020  rted=[]):.      
+00018da0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
+00018db0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
+00018dc0: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
+00018dd0: 696c 6520 2222 220a 2020 2020 2020 2020  ile """.        
+00018de0: 7265 7475 726e 2073 656c 662e 6372 6561  return self.crea
+00018df0: 7465 5f69 6d61 6765 5f6e 6176 6967 6174  te_image_navigat
+00018e00: 696f 6e5f 6669 6c65 286e 6176 5f70 6174  ion_file(nav_pat
+00018e10: 682c 206e 6176 5f68 6561 6465 722c 2064  h, nav_header, d
+00018e20: 6174 655f 666f 726d 6174 2c20 6f76 6572  ate_format, over
+00018e30: 7772 6974 652c 2063 6f6c 5f73 6570 6172  write, col_separ
+00018e40: 6174 6f72 2c20 7669 6465 6f53 616d 706c  ator, videoSampl
+00018e50: 6553 6563 6f6e 6473 2c20 6f66 6673 6574  eSeconds, offset
+00018e60: 5f78 2c20 6f66 6673 6574 5f79 2c20 6f66  _x, offset_y, of
+00018e70: 6673 6574 5f7a 2c20 616e 676c 6573 5f69  fset_z, angles_i
+00018e80: 6e5f 7261 642c 2072 6563 6f72 6473 3262  n_rad, records2b
+00018e90: 6549 6e76 6572 7465 6429 0a0a 0a20 2020  eInverted)...   
+00018ea0: 2064 6566 2063 7265 6174 655f 696d 6167   def create_imag
+00018eb0: 655f 7368 6132 3536 5f66 696c 6528 7365  e_sha256_file(se
+00018ec0: 6c66 2c72 6552 6561 6441 6c6c 3d54 7275  lf,reReadAll=Tru
+00018ed0: 6529 3a0a 2020 2020 2020 2020 2222 2220  e):.        """ 
+00018ee0: 4372 6561 7465 7320 696e 202f 696e 7465  Creates in /inte
+00018ef0: 726d 6564 6961 7465 2061 2074 6578 7420  rmediate a text 
+00018f00: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
+00018f10: 7065 7220 696d 6167 6520 6974 7320 5348  per image its SH
+00018f20: 4132 3536 2068 6173 682e 0a20 2020 2020  A256 hash..     
+00018f30: 2020 2020 2020 2049 6620 7265 5265 6164         If reRead
+00018f40: 416c 6c20 6973 2054 7275 6520 616c 6c20  All is True all 
+00018f50: 696d 6167 6573 2720 6861 7368 6573 2061  images' hashes a
+00018f60: 7265 2064 6574 6572 6d69 6e65 642e 204f  re determined. O
+00018f70: 7468 6572 7769 7365 206f 6e6c 7920 666f  therwise only fo
+00018f80: 7220 7468 6f73 6520 6669 6c65 730a 2020  r those files.  
+00018f90: 2020 2020 2020 2020 2020 7768 6963 6820            which 
+00018fa0: 6172 6520 6e6f 7420 7965 7420 696e 2074  are not yet in t
+00018fb0: 6865 2069 6e74 6572 6d65 6469 6174 6520  he intermediate 
+00018fc0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
+00018fd0: 7468 6520 696d 6167 6520 6861 7368 6573  the image hashes
+00018fe0: 2020 2222 220a 2020 2020 2020 2020 6861    """.        ha
+00018ff0: 7368 6573 203d 207b 7d0a 2020 2020 2020  shes = {}.      
+00019000: 2020 6966 206f 732e 7061 7468 2e65 7869    if os.path.exi
+00019010: 7374 7328 7365 6c66 2e67 6574 5f69 6e74  sts(self.get_int
+00019020: 5f68 6173 685f 6669 6c65 2829 293a 0a20  _hash_file()):. 
+00019030: 2020 2020 2020 2020 2020 2068 6173 6865             hashe
+00019040: 7320 3d20 6d69 7174 662e 7461 6246 696c  s = miqtf.tabFil
+00019050: 6544 6174 6128 7365 6c66 2e67 6574 5f69  eData(self.get_i
+00019060: 6e74 5f68 6173 685f 6669 6c65 2829 2c20  nt_hash_file(), 
+00019070: 5b6d 6971 7476 2e63 6f6c 5f68 6561 6465  [miqtv.col_heade
+00019080: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+00019090: 275d 2c20 6d69 7174 762e 636f 6c5f 6865  '], miqtv.col_he
+000190a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+000190b0: 6861 7368 275d 5d2c 206b 6579 5f63 6f6c  hash']], key_col
+000190c0: 3d6d 6971 7476 2e63 6f6c 5f68 6561 6465  =miqtv.col_heade
+000190d0: 725b 276d 6172 6971 7427 5d5b 2769 6d67  r['mariqt']['img
+000190e0: 275d 290a 0a20 2020 2020 2020 2069 6d61  '])..        ima
+000190f0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
+00019100: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
+00019110: 7228 290a 2020 2020 2020 2020 6966 206c  r().        if l
+00019120: 656e 2869 6d61 6765 7349 6e52 6177 2920  en(imagesInRaw) 
+00019130: 3e20 303a 0a0a 2020 2020 2020 2020 2020  > 0:..          
+00019140: 2020 6164 6465 645f 6861 7368 6573 203d    added_hashes =
+00019150: 2030 0a20 2020 2020 2020 2020 2020 2070   0.            p
+00019160: 726f 6720 3d20 6d69 7174 632e 5072 696e  rog = miqtc.Prin
+00019170: 744b 6e6f 776e 5072 6f67 7265 7373 4d73  tKnownProgressMs
+00019180: 6728 2243 6865 636b 696e 6720 6861 7368  g("Checking hash
+00019190: 6573 222c 206c 656e 2869 6d61 6765 7349  es", len(imagesI
+000191a0: 6e52 6177 292c 6d6f 6475 6c6f 3d35 290a  nRaw),modulo=5).
+000191b0: 2020 2020 2020 2020 2020 2020 666f 7220              for 
+000191c0: 6669 6c65 2069 6e20 696d 6167 6573 496e  file in imagesIn
+000191d0: 5261 773a 0a20 2020 2020 2020 2020 2020  Raw:.           
+000191e0: 2020 2020 2070 726f 672e 7072 6f67 7265       prog.progre
+000191f0: 7373 2829 0a0a 2020 2020 2020 2020 2020  ss()..          
+00019200: 2020 2020 2020 6966 206e 6f74 2073 656c        if not sel
+00019210: 662e 5f5f 616c 6c55 5549 4473 4368 6563  f.__allUUIDsChec
+00019220: 6b65 6420 616e 6420 6e6f 7420 6d69 7174  ked and not miqt
+00019230: 692e 696d 6167 6543 6f6e 7461 696e 7356  i.imageContainsV
+00019240: 616c 6964 5555 4944 2866 696c 6529 5b30  alidUUID(file)[0
+00019250: 5d3a 0a20 2020 2020 2020 2020 2020 2020  ]:.             
+00019260: 2020 2020 2020 2023 2072 656d 6f76 6520         # remove 
+00019270: 6672 6f6d 2075 7569 6420 6669 6c65 0a20  from uuid file. 
+00019280: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019290: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+000192a0: 6973 7473 2873 656c 662e 6765 745f 696e  ists(self.get_in
+000192b0: 745f 7575 6964 5f66 696c 6528 2929 3a0a  t_uuid_file()):.
 000192c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192d0: 2020 2062 7265 616b 0a20 2020 2020 2020     break.       
-000192e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000192f0: 2069 202b 3d20 310a 2020 2020 2020 2020   i += 1.        
-00019300: 2020 2020 2020 2020 2020 2020 6966 206c              if l
-00019310: 696e 654e 7220 213d 2030 3a0a 2020 2020  ineNr != 0:.    
-00019320: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019330: 2020 2020 6465 6c20 6c69 6e65 735b 6c69      del lines[li
-00019340: 6e65 4e72 5d0a 2020 2020 2020 2020 2020  neNr].          
-00019350: 2020 2020 2020 2020 2020 2020 2020 7265                re
-00019360: 7320 3d20 6f70 656e 2873 656c 662e 6765  s = open(self.ge
-00019370: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
-00019380: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
-00019390: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000193a0: 7265 732e 7772 6974 656c 696e 6573 286c  res.writelines(l
-000193b0: 696e 6573 290a 2020 2020 2020 2020 2020  ines).          
-000193c0: 2020 2020 2020 2020 2020 2020 2020 7265                re
-000193d0: 732e 636c 6f73 6528 290a 2020 2020 2020  s.close().      
-000193e0: 2020 2020 2020 2020 2020 2020 2020 7261                ra
-000193f0: 6973 6520 4578 6365 7074 696f 6e28 2022  ise Exception( "
-00019400: 4669 6c65 2022 202b 2066 696c 6520 2b20  File " + file + 
-00019410: 2220 646f 6573 206e 6f74 2063 6f74 6169  " does not cotai
-00019420: 6e20 6120 7661 6c69 6420 5555 4944 2e20  n a valid UUID. 
-00019430: 5275 6e20 6372 6561 7465 5f75 7569 645f  Run create_uuid_
-00019440: 6669 6c65 2829 2066 6972 7374 2122 290a  file() first!").
-00019450: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-00019460: 2066 696c 655f 6e61 6d65 203d 206f 732e   file_name = os.
-00019470: 7061 7468 2e62 6173 656e 616d 6528 6669  path.basename(fi
-00019480: 6c65 290a 2020 2020 2020 2020 2020 2020  le).            
-00019490: 2020 2020 6966 206e 6f74 2072 6552 6561      if not reRea
-000194a0: 6441 6c6c 2061 6e64 2066 696c 655f 6e61  dAll and file_na
-000194b0: 6d65 2069 6e20 6861 7368 6573 3a0a 2020  me in hashes:.  
+000192d0: 2020 2020 2020 2020 7265 7320 3d20 6f70          res = op
+000192e0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+000192f0: 7575 6964 5f66 696c 6528 292c 2022 7222  uuid_file(), "r"
+00019300: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019310: 2020 2020 2020 2020 2020 6c69 6e65 7320            lines 
+00019320: 3d20 7265 732e 7265 6164 6c69 6e65 7328  = res.readlines(
+00019330: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019340: 2020 2020 2020 2020 2020 7265 732e 636c            res.cl
+00019350: 6f73 6528 290a 2020 2020 2020 2020 2020  ose().          
+00019360: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+00019370: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019380: 2020 2020 2020 2020 6c69 6e65 7320 3d20          lines = 
+00019390: 5b5d 0a20 2020 2020 2020 2020 2020 2020  [].             
+000193a0: 2020 2020 2020 2069 203d 2030 0a20 2020         i = 0.   
+000193b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193c0: 206c 696e 654e 7220 3d20 690a 2020 2020   lineNr = i.    
+000193d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000193e0: 666f 7220 6c69 6e65 2069 6e20 6c69 6e65  for line in line
+000193f0: 733a 0a20 2020 2020 2020 2020 2020 2020  s:.             
+00019400: 2020 2020 2020 2020 2020 2069 6620 6f73             if os
+00019410: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+00019420: 696c 6529 2069 6e20 6c69 6e65 3a0a 2020  ile) in line:.  
+00019430: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019440: 2020 2020 2020 2020 2020 6c69 6e65 4e72            lineNr
+00019450: 203d 2069 0a20 2020 2020 2020 2020 2020   = i.           
+00019460: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019470: 2062 7265 616b 0a20 2020 2020 2020 2020   break.         
+00019480: 2020 2020 2020 2020 2020 2020 2020 2069                 i
+00019490: 202b 3d20 310a 2020 2020 2020 2020 2020   += 1.          
+000194a0: 2020 2020 2020 2020 2020 6966 206c 696e            if lin
+000194b0: 654e 7220 213d 2030 3a0a 2020 2020 2020  eNr != 0:.      
 000194c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000194d0: 2020 6861 7368 6573 5b66 696c 655f 6e61    hashes[file_na
-000194e0: 6d65 5d20 3d20 6861 7368 6573 5b66 696c  me] = hashes[fil
-000194f0: 655f 6e61 6d65 5d5b 6d69 7174 762e 636f  e_name][miqtv.co
-00019500: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00019510: 275d 5b27 6861 7368 275d 5d0a 2020 2020  ']['hash']].    
-00019520: 2020 2020 2020 2020 2020 2020 656c 7365              else
-00019530: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-00019540: 2020 2020 2020 6861 7368 6573 5b66 696c        hashes[fil
-00019550: 655f 6e61 6d65 5d20 3d20 6d69 7174 632e  e_name] = miqtc.
-00019560: 7368 6132 3536 4861 7368 4669 6c65 2866  sha256HashFile(f
-00019570: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
-00019580: 2020 2020 2020 2020 2061 6464 6564 5f68           added_h
-00019590: 6173 6865 7320 2b3d 2031 0a20 2020 2020  ashes += 1.     
-000195a0: 2020 2020 2020 2070 726f 672e 636c 6561         prog.clea
-000195b0: 7228 290a 0a20 2020 2020 2020 2020 2020  r()..           
-000195c0: 2069 6620 7265 5265 6164 416c 6c20 6f72   if reReadAll or
-000195d0: 2061 6464 6564 5f68 6173 6865 7320 3e20   added_hashes > 
-000195e0: 303a 0a20 2020 2020 2020 2020 2020 2020  0:.             
-000195f0: 2020 2068 6173 685f 6669 6c65 203d 206f     hash_file = o
-00019600: 7065 6e28 7365 6c66 2e67 6574 5f69 6e74  pen(self.get_int
-00019610: 5f68 6173 685f 6669 6c65 2829 2c20 2277  _hash_file(), "w
-00019620: 2229 0a20 2020 2020 2020 2020 2020 2020  ").             
-00019630: 2020 2068 6173 685f 6669 6c65 2e77 7269     hash_file.wri
-00019640: 7465 2820 6d69 7174 762e 636f 6c5f 6865  te( miqtv.col_he
-00019650: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00019660: 696d 6727 5d2b 225c 7422 2b6d 6971 7476  img']+"\t"+miqtv
-00019670: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00019680: 6971 7427 5d5b 2768 6173 6827 5d2b 225c  iqt']['hash']+"\
-00019690: 6e22 290a 2020 2020 2020 2020 2020 2020  n").            
-000196a0: 2020 2020 666f 7220 6669 6c65 5f6e 616d      for file_nam
-000196b0: 6520 696e 2068 6173 6865 733a 0a20 2020  e in hashes:.   
-000196c0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-000196d0: 2068 6173 685f 6669 6c65 2e77 7269 7465   hash_file.write
-000196e0: 2866 696c 655f 6e61 6d65 2b22 5c74 222b  (file_name+"\t"+
-000196f0: 6861 7368 6573 5b66 696c 655f 6e61 6d65  hashes[file_name
-00019700: 5d2b 225c 6e22 290a 0a20 2020 2020 2020  ]+"\n")..       
-00019710: 2020 2020 2020 2020 2068 6173 685f 6669           hash_fi
-00019720: 6c65 2e63 6c6f 7365 2829 0a20 2020 2020  le.close().     
-00019730: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00019740: 6e20 5472 7565 2c20 2241 6464 6564 2022  n True, "Added "
-00019750: 2b73 7472 2861 6464 6564 5f68 6173 6865  +str(added_hashe
-00019760: 7329 2b22 2068 6173 6865 7320 746f 2068  s)+" hashes to h
-00019770: 6173 6820 6669 6c65 220a 2020 2020 2020  ash file".      
-00019780: 2020 2020 2020 656c 7365 3a0a 2020 2020        else:.    
-00019790: 2020 2020 2020 2020 2020 2020 7265 7475              retu
-000197a0: 726e 2054 7275 652c 2022 416c 6c20 6861  rn True, "All ha
-000197b0: 7368 6573 2065 7869 7374 220a 0a20 2020  shes exist"..   
-000197c0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
-000197d0: 2020 2020 2020 2072 6574 7572 6e20 4661         return Fa
-000197e0: 6c73 652c 2022 4e6f 2069 6d61 6765 7320  lse, "No images 
-000197f0: 666f 756e 6420 746f 2068 6173 6822 0a20  found to hash". 
-00019800: 2020 2020 2020 200a 2020 2020 6465 6620         .    def 
-00019810: 6372 6561 7465 496d 6167 6553 4841 3235  createImageSHA25
-00019820: 3646 696c 6528 7365 6c66 2c72 6552 6561  6File(self,reRea
-00019830: 6441 6c6c 3d54 7275 6529 3a0a 2020 2020  dAll=True):.    
-00019840: 2020 2020 2222 2220 4465 7072 6563 6174      """ Deprecat
-00019850: 6564 202d 2075 7365 2063 7265 6174 655f  ed - use create_
-00019860: 696d 6167 655f 7368 6132 3536 5f66 696c  image_sha256_fil
-00019870: 6520 2222 220a 2020 2020 2020 2020 7265  e """.        re
-00019880: 7475 726e 2073 656c 662e 6372 6561 7465  turn self.create
-00019890: 5f69 6d61 6765 5f73 6861 3235 365f 6669  _image_sha256_fi
-000198a0: 6c65 2872 6552 6561 6441 6c6c 290a 0a0a  le(reReadAll)...
-000198b0: 2020 2020 6465 6620 6372 6561 7465 5f73      def create_s
-000198c0: 7461 7274 5f74 696d 655f 6669 6c65 2873  tart_time_file(s
-000198d0: 656c 6629 3a0a 2020 2020 2020 2020 2222  elf):.        ""
-000198e0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
-000198f0: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
-00019900: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
-00019910: 6720 7065 7220 696d 6167 6520 6974 7320  g per image its 
-00019920: 7374 6172 7420 7469 6d65 2070 6172 7365  start time parse
-00019930: 6420 6672 6f6d 2074 6865 2066 696c 6520  d from the file 
-00019940: 6e61 6d65 2022 2222 0a0a 2020 2020 2020  name """..      
-00019950: 2020 7320 3d20 6d69 7174 632e 5072 696e    s = miqtc.Prin
-00019960: 744c 6f61 6469 6e67 4d73 6728 2243 7265  tLoadingMsg("Cre
-00019970: 6174 696e 6720 696e 7465 726d 6564 6961  ating intermedia
-00019980: 7465 2073 7461 7274 7469 6d65 2066 696c  te starttime fil
-00019990: 6520 2229 0a20 2020 2020 2020 2069 6d61  e ").        ima
-000199a0: 6765 7349 6e52 6177 203d 2073 656c 662e  gesInRaw = self.
-000199b0: 696d 6167 6573 496e 496d 6167 6573 4469  imagesInImagesDi
-000199c0: 7253 6f72 7465 644c 6973 7428 290a 2020  rSortedList().  
-000199d0: 2020 2020 2020 6966 206c 656e 2869 6d61        if len(ima
-000199e0: 6765 7349 6e52 6177 2920 3e20 303a 0a0a  gesInRaw) > 0:..
-000199f0: 2020 2020 2020 2020 2020 2020 6f20 3d20              o = 
-00019a00: 6f70 656e 2873 656c 662e 6765 745f 696e  open(self.get_in
-00019a10: 745f 7374 6172 7454 696d 6573 5f66 696c  t_startTimes_fil
-00019a20: 6528 292c 2022 7722 290a 2020 2020 2020  e(), "w").      
-00019a30: 2020 2020 2020 6f2e 7772 6974 6528 6d69        o.write(mi
-00019a40: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-00019a50: 6d61 7269 7174 275d 5b27 696d 6727 5d20  mariqt']['img'] 
-00019a60: 2b0a 2020 2020 2020 2020 2020 2020 2020  +.              
-00019a70: 2020 2020 2020 225c 7422 2b6d 6971 7476        "\t"+miqtv
-00019a80: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-00019a90: 6971 7427 5d5b 2775 7463 275d 2b22 5c6e  iqt']['utc']+"\n
-00019aa0: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-00019ab0: 666f 7220 6669 6c65 2069 6e20 696d 6167  for file in imag
-00019ac0: 6573 496e 5261 773a 0a20 2020 2020 2020  esInRaw:.       
-00019ad0: 2020 2020 2020 2020 2066 696c 655f 6e61           file_na
-00019ae0: 6d65 203d 206f 732e 7061 7468 2e62 6173  me = os.path.bas
-00019af0: 656e 616d 6528 6669 6c65 290a 0a20 2020  ename(file)..   
-00019b00: 2020 2020 2020 2020 2020 2020 2064 7420               dt 
-00019b10: 3d20 6d69 7174 632e 7061 7273 6546 696c  = miqtc.parseFil
-00019b20: 6544 6174 6554 696d 6541 7355 5443 2866  eDateTimeAsUTC(f
-00019b30: 696c 655f 6e61 6d65 290a 2020 2020 2020  ile_name).      
-00019b40: 2020 2020 2020 2020 2020 6f2e 7772 6974            o.writ
-00019b50: 6528 6669 6c65 5f6e 616d 652b 225c 7422  e(file_name+"\t"
-00019b60: 202b 2064 742e 7374 7266 7469 6d65 286d   + dt.strftime(m
-00019b70: 6971 7476 2e64 6174 655f 666f 726d 6174  iqtv.date_format
-00019b80: 735b 276d 6172 6971 7427 5d29 2b22 5c6e  s['mariqt'])+"\n
-00019b90: 2229 0a0a 2020 2020 2020 2020 2020 2020  ")..            
-00019ba0: 6f2e 636c 6f73 6528 290a 2020 2020 2020  o.close().      
-00019bb0: 2020 2020 2020 732e 7374 6f70 2829 0a20        s.stop(). 
-00019bc0: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-00019bd0: 6e20 5472 7565 2c20 2243 7265 6174 6564  n True, "Created
-00019be0: 2073 7461 7274 2074 696d 6520 6669 6c65   start time file
-00019bf0: 220a 2020 2020 2020 2020 656c 7365 3a0a  ".        else:.
-00019c00: 2020 2020 2020 2020 2020 2020 732e 7374              s.st
-00019c10: 6f70 2829 0a20 2020 2020 2020 2020 2020  op().           
-00019c20: 2072 6574 7572 6e20 4661 6c73 652c 2022   return False, "
-00019c30: 4e6f 2069 6d61 6765 7320 666f 756e 6420  No images found 
-00019c40: 746f 2072 6561 6420 7374 6172 7420 7469  to read start ti
-00019c50: 6d65 7322 0a20 2020 2020 2020 200a 2020  mes".        .  
-00019c60: 2020 6465 6620 6372 6561 7465 5374 6172    def createStar
-00019c70: 7454 696d 6546 696c 6528 7365 6c66 293a  tTimeFile(self):
-00019c80: 0a20 2020 2020 2020 2022 2222 2044 6570  .        """ Dep
-00019c90: 7265 6361 7465 6420 2d20 7573 6520 6372  recated - use cr
-00019ca0: 6561 7465 5f73 7461 7274 5f74 696d 655f  eate_start_time_
-00019cb0: 6669 6c65 2022 2222 0a20 2020 2020 2020  file """.       
-00019cc0: 2072 6574 7572 6e20 7365 6c66 2e63 7265   return self.cre
-00019cd0: 6174 655f 7374 6172 745f 7469 6d65 5f66  ate_start_time_f
-00019ce0: 696c 6528 290a 0a0a 2020 2020 6465 6620  ile()...    def 
-00019cf0: 6372 6561 7465 4163 7175 6973 6974 696f  createAcquisitio
-00019d00: 6e53 6574 7469 6e67 7345 5849 4646 696c  nSettingsEXIFFil
-00019d10: 6528 7365 6c66 2c6f 7665 7272 6964 653d  e(self,override=
-00019d20: 4661 6c73 6529 3a0a 2020 2020 2020 2020  False):.        
-00019d30: 2222 2220 4372 6561 7465 7320 696e 202f  """ Creates in /
-00019d40: 696e 7465 726d 6564 6961 7465 2061 2074  intermediate a t
-00019d50: 6578 7420 6669 6c65 2063 6f6e 7461 696e  ext file contain
-00019d60: 696e 6720 7065 7220 696d 6167 6520 6120  ing per image a 
-00019d70: 6469 6374 206f 6620 6578 6966 2074 6167  dict of exif tag
-00019d80: 7320 616e 6420 7468 6569 7220 7661 6c75  s and their valu
-00019d90: 6573 2070 6172 7365 6420 6672 6f6d 2074  es parsed from t
-00019da0: 6865 2069 6d61 6765 2022 2222 0a0a 2020  he image """..  
-00019db0: 2020 2020 2020 696e 745f 6163 7175 6973        int_acquis
-00019dc0: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
-00019dd0: 6520 3d20 7365 6c66 2e5f 5f67 6574 5f69  e = self.__get_i
-00019de0: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
-00019df0: 202b 2027 5f69 6d61 6765 2d61 6371 7569   + '_image-acqui
-00019e00: 7369 7469 6f6e 2d73 6574 7469 6e67 732e  sition-settings.
-00019e10: 7478 7427 0a20 2020 2020 2020 2068 6561  txt'.        hea
-00019e20: 6465 7220 3d20 7b20 206d 6971 7476 2e63  der = {  miqtv.c
-00019e30: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
-00019e40: 7427 5d5b 2769 6d67 275d 3a20 206d 6971  t']['img']:  miq
-00019e50: 7476 2e63 6f6c 5f68 6561 6465 725b 276d  tv.col_header['m
-00019e60: 6172 6971 7427 5d5b 2769 6d67 275d 2c0a  ariqt']['img'],.
-00019e70: 2020 2020 2020 2020 2020 2020 2020 2020                  
-00019e80: 2020 2020 6d69 7174 762e 636f 6c5f 6865      miqtv.col_he
-00019e90: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-00019ea0: 6163 7175 6927 5d3a 6d69 7174 762e 636f  acqui']:miqtv.co
-00019eb0: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-00019ec0: 275d 5b27 6163 7175 6927 5d7d 0a20 2020  ']['acqui']}.   
-00019ed0: 2020 2020 2069 6620 6f73 2e70 6174 682e       if os.path.
-00019ee0: 6578 6973 7473 2869 6e74 5f61 6371 7569  exists(int_acqui
-00019ef0: 7369 7469 6f6e 5365 7474 696e 675f 6669  sitionSetting_fi
-00019f00: 6c65 2920 616e 6420 6e6f 7420 6f76 6572  le) and not over
-00019f10: 7269 6465 3a0a 2020 2020 2020 2020 2020  ride:.          
-00019f20: 2020 7365 6c66 2e61 6464 5f69 7465 6d5f    self.add_item_
-00019f30: 696e 666f 5f74 6162 5f66 696c 6528 696e  info_tab_file(in
-00019f40: 745f 6163 7175 6973 6974 696f 6e53 6574  t_acquisitionSet
-00019f50: 7469 6e67 5f66 696c 652c 225c 7422 2c68  ting_file,"\t",h
-00019f60: 6561 6465 7229 0a20 2020 2020 2020 2020  eader).         
-00019f70: 2020 2072 6574 7572 6e20 5472 7565 2c20     return True, 
-00019f80: 2252 6573 756c 7420 6669 6c65 2065 7869  "Result file exi
-00019f90: 7374 7322 0a0a 2020 2020 2020 2020 696d  sts"..        im
-00019fa0: 6167 6573 496e 5261 7720 3d20 7365 6c66  agesInRaw = self
-00019fb0: 2e69 6d61 6765 7349 6e49 6d61 6765 7344  .imagesInImagesD
-00019fc0: 6972 536f 7274 6564 4c69 7374 2829 0a20  irSortedList(). 
-00019fd0: 2020 2020 2020 2069 6620 6c65 6e28 696d         if len(im
-00019fe0: 6167 6573 496e 5261 7729 203e 2030 3a0a  agesInRaw) > 0:.
-00019ff0: 0a20 2020 2020 2020 2020 2020 206f 203d  .            o =
-0001a000: 206f 7065 6e28 696e 745f 6163 7175 6973   open(int_acquis
-0001a010: 6974 696f 6e53 6574 7469 6e67 5f66 696c  itionSetting_fil
-0001a020: 652c 2022 7722 290a 2020 2020 2020 2020  e, "w").        
-0001a030: 2020 2020 6f2e 7772 6974 6528 6d69 7174      o.write(miqt
-0001a040: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
-0001a050: 7269 7174 275d 5b27 696d 6727 5d20 2b20  riqt']['img'] + 
-0001a060: 225c 7422 2b6d 6971 7476 2e63 6f6c 5f68  "\t"+miqtv.col_h
-0001a070: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001a080: 2761 6371 7569 275d 2b22 5c6e 2229 0a20  'acqui']+"\n"). 
-0001a090: 0a20 2020 2020 2020 2020 2020 2069 6d61  .            ima
-0001a0a0: 6765 7345 7869 6673 203d 206d 6971 7469  gesExifs = miqti
-0001a0b0: 2e67 6574 496d 6167 6573 416c 6c45 7869  .getImagesAllExi
-0001a0c0: 6656 616c 7565 7328 696d 6167 6573 496e  fValues(imagesIn
-0001a0d0: 5261 772c 7365 6c66 2e70 726f 7629 0a20  Raw,self.prov). 
-0001a0e0: 2020 2020 2020 2020 2020 2066 6f72 2066             for f
-0001a0f0: 696c 6520 696e 2069 6d61 6765 7345 7869  ile in imagesExi
-0001a100: 6673 3a0a 2020 2020 2020 2020 2020 2020  fs:.            
-0001a110: 2020 2020 6669 6c65 5f6e 616d 6520 3d20      file_name = 
-0001a120: 6f73 2e70 6174 682e 6261 7365 6e61 6d65  os.path.basename
-0001a130: 2866 696c 6529 0a20 2020 2020 2020 2020  (file).         
-0001a140: 2020 2020 2020 206f 2e77 7269 7465 2866         o.write(f
-0001a150: 696c 655f 6e61 6d65 2b22 5c74 222b 7374  ile_name+"\t"+st
-0001a160: 7228 696d 6167 6573 4578 6966 735b 6669  r(imagesExifs[fi
-0001a170: 6c65 5d29 2b22 5c6e 2229 0a0a 2020 2020  le])+"\n")..    
-0001a180: 2020 2020 2020 2020 6f2e 636c 6f73 6528          o.close(
-0001a190: 290a 0a20 2020 2020 2020 2020 2020 2073  )..            s
-0001a1a0: 656c 662e 6164 645f 6974 656d 5f69 6e66  elf.add_item_inf
-0001a1b0: 6f5f 7461 625f 6669 6c65 2869 6e74 5f61  o_tab_file(int_a
-0001a1c0: 6371 7569 7369 7469 6f6e 5365 7474 696e  cquisitionSettin
-0001a1d0: 675f 6669 6c65 2c22 5c74 222c 6865 6164  g_file,"\t",head
-0001a1e0: 6572 290a 2020 2020 2020 2020 2020 2020  er).            
-0001a1f0: 7265 7475 726e 2054 7275 652c 2022 4372  return True, "Cr
-0001a200: 6561 7465 6420 6163 7175 6973 6974 696f  eated acquisitio
-0001a210: 6e20 7365 7474 696e 6773 2066 696c 6522  n settings file"
-0001a220: 0a20 2020 2020 2020 2065 6c73 653a 0a20  .        else:. 
-0001a230: 2020 2020 2020 2020 2020 2072 6574 7572             retur
-0001a240: 6e20 4661 6c73 652c 2022 4e6f 2069 6d61  n False, "No ima
-0001a250: 6765 7320 666f 756e 6422 0a0a 0a20 2020  ges found"...   
-0001a260: 2064 6566 2069 6d61 6765 7349 6e49 6d61   def imagesInIma
-0001a270: 6765 7344 6972 2873 656c 6629 3a0a 2020  gesDir(self):.  
-0001a280: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
-0001a290: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
-0001a2a0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
-0001a2b0: 6972 290a 0a20 2020 2064 6566 2069 6d61  ir)..    def ima
-0001a2c0: 6765 7349 6e49 6d61 6765 7344 6972 536f  gesInImagesDirSo
-0001a2d0: 7274 6564 4c69 7374 2873 656c 6629 3a0a  rtedList(self):.
-0001a2e0: 2020 2020 2020 2020 7265 7475 726e 2063          return c
-0001a2f0: 6f70 792e 6465 6570 636f 7079 2873 656c  opy.deepcopy(sel
-0001a300: 662e 5f69 6d61 6765 7349 6e49 6d61 6765  f._imagesInImage
-0001a310: 7344 6972 536f 7274 6564 4c69 7374 290a  sDirSortedList).
-0001a320: 0a0a 2020 2020 6465 6620 7061 7273 6549  ..    def parseI
-0001a330: 7465 6d44 6174 6166 726f 6d54 6162 4669  temDatafromTabFi
-0001a340: 6c65 4461 7461 2873 656c 662c 2069 7465  leData(self, ite
-0001a350: 6d73 3a20 6469 6374 2c20 6669 6c65 3a20  ms: dict, file: 
-0001a360: 7374 722c 2063 6f6c 733a 206c 6973 742c  str, cols: list,
-0001a370: 206f 7074 696f 6e61 6c3a 206c 6973 7420   optional: list 
-0001a380: 3d20 5b5d 2c20 6461 7465 7469 6d65 5f66  = [], datetime_f
-0001a390: 6f72 6d61 743a 7374 723d 6d69 7174 762e  ormat:str=miqtv.
-0001a3a0: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
-0001a3b0: 7269 7174 275d 293a 0a20 2020 2020 2020  riqt']):.       
-0001a3c0: 2022 2222 2070 6172 7365 7320 6461 7461   """ parses data
-0001a3d0: 2066 726f 6d20 636f 6c75 6d6e 7320 696e   from columns in
-0001a3e0: 2063 6f6c 7320 616e 6420 7772 6974 6573   cols and writes
-0001a3f0: 2069 6e66 6f20 746f 2069 7465 6d73 2e20   info to items. 
-0001a400: 436f 6c75 6d6e 2027 696d 6167 652d 6669  Column 'image-fi
-0001a410: 6c65 6e61 6d65 2720 6d75 7374 2062 6520  lename' must be 
-0001a420: 696e 2066 696c 6520 616e 6420 646f 6573  in file and does
-0001a430: 206e 6f74 206e 6565 6420 746f 2062 6520   not need to be 
-0001a440: 7061 7373 6564 2069 6e20 636f 6c73 2e20  passed in cols. 
-0001a450: 0a20 2020 2020 2020 2020 2020 2046 696c  .            Fil
-0001a460: 6520 6d75 7374 2062 6520 7461 6220 7365  e must be tab se
-0001a470: 7061 7261 7465 6420 616e 6420 636f 6c75  parated and colu
-0001a480: 6d6e 7320 6e61 6d65 7320 6d75 7374 2065  mns names must e
-0001a490: 7175 616c 2069 7465 6d20 6669 656c 6420  qual item field 
-0001a4a0: 6e61 6d65 7322 2222 0a20 2020 2020 2020  names""".       
-0001a4b0: 2074 6d70 5f64 6174 6120 3d20 6d69 7174   tmp_data = miqt
-0001a4c0: 662e 7461 6246 696c 6544 6174 6128 6669  f.tabFileData(fi
-0001a4d0: 6c65 2c20 636f 6c73 2b5b 2769 6d61 6765  le, cols+['image
-0001a4e0: 2d66 696c 656e 616d 6527 5d2b 6f70 7469  -filename']+opti
-0001a4f0: 6f6e 616c 2c20 6b65 795f 636f 6c3d 2769  onal, key_col='i
-0001a500: 6d61 6765 2d66 696c 656e 616d 6527 2c20  mage-filename', 
-0001a510: 6f70 7469 6f6e 616c 3d6f 7074 696f 6e61  optional=optiona
-0001a520: 6c2c 636f 6e76 6572 743d 5472 7565 290a  l,convert=True).
-0001a530: 2020 2020 2020 2020 7365 6c66 2e77 7269          self.wri
-0001a540: 7465 5061 7273 6564 4461 7461 546f 4974  teParsedDataToIt
-0001a550: 656d 7328 746d 705f 6461 7461 2c69 7465  ems(tmp_data,ite
-0001a560: 6d73 2c73 656c 662e 6966 646f 5f74 6d70  ms,self.ifdo_tmp
-0001a570: 5b6d 6971 7476 2e69 6d61 6765 5f73 6574  [miqtv.image_set
-0001a580: 5f68 6561 6465 725f 6b65 795d 2c20 6461  _header_key], da
-0001a590: 7465 7469 6d65 5f66 6f72 6d61 743d 6461  tetime_format=da
-0001a5a0: 7465 7469 6d65 5f66 6f72 6d61 7429 0a0a  tetime_format)..
-0001a5b0: 0a20 2020 2064 6566 2070 7261 7365 4974  .    def praseIt
-0001a5c0: 656d 4461 7461 4672 6f6d 4669 6c65 2873  emDataFromFile(s
-0001a5d0: 656c 662c 6974 656d 733a 6469 6374 2c66  elf,items:dict,f
-0001a5e0: 696c 653a 7374 722c 7365 7061 7261 746f  ile:str,separato
-0001a5f0: 723a 7374 722c 6865 6164 6572 3a64 6963  r:str,header:dic
-0001a600: 742c 2064 6174 6574 696d 655f 666f 726d  t, datetime_form
-0001a610: 6174 3a73 7472 3d6d 6971 7476 2e64 6174  at:str=miqtv.dat
-0001a620: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
-0001a630: 7427 5d29 3a0a 2020 2020 2020 2020 2222  t']):.        ""
-0001a640: 2220 7061 7273 6573 2064 6174 6120 6672  " parses data fr
-0001a650: 6f6d 2066 726f 6d20 6669 6c65 2074 6f20  om from file to 
-0001a660: 6974 656d 732e 2068 6561 6465 7220 6469  items. header di
-0001a670: 6374 206d 7573 7420 6265 206f 6620 7374  ct must be of st
-0001a680: 7275 6374 7572 653a 207b 3c69 7465 6d2d  ructure: {<item-
-0001a690: 6669 656c 642d 6e61 6d65 3e3a 3c63 6f6c  field-name>:<col
-0001a6a0: 756d 6e2d 6e61 6d65 3e7d 0a20 2020 2020  umn-name>}.     
-0001a6b0: 2020 2020 2020 2061 6e64 206d 7573 7420         and must 
-0001a6c0: 636f 6e74 6169 6e20 656e 7472 7920 2769  contain entry 'i
-0001a6d0: 6d61 6765 2d66 696c 656e 616d 6527 2022  mage-filename' "
-0001a6e0: 2222 0a20 2020 2020 2020 2069 6620 6e6f  "".        if no
-0001a6f0: 7420 2769 6d61 6765 2d66 696c 656e 616d  t 'image-filenam
-0001a700: 6527 2069 6e20 6865 6164 6572 3a0a 2020  e' in header:.  
-0001a710: 2020 2020 2020 2020 2020 7261 6973 6520            raise 
-0001a720: 4578 6365 7074 696f 6e28 2268 6561 6465  Exception("heade
-0001a730: 7220 646f 6573 206e 6f74 2063 6f6e 7461  r does not conta
-0001a740: 696e 2027 696d 6167 652d 6669 6c65 6e61  in 'image-filena
-0001a750: 6d65 2722 290a 2020 2020 2020 2020 0a20  me'").        . 
-0001a760: 2020 2020 2020 2074 6d70 5f64 6174 6120         tmp_data 
-0001a770: 3d20 6d69 7174 662e 7461 6246 696c 6544  = miqtf.tabFileD
-0001a780: 6174 6128 6669 6c65 2c20 6865 6164 6572  ata(file, header
-0001a790: 2c63 6f6c 5f73 6570 6172 6174 6f72 3d73  ,col_separator=s
-0001a7a0: 6570 6172 6174 6f72 2c20 6b65 795f 636f  eparator, key_co
-0001a7b0: 6c3d 2769 6d61 6765 2d66 696c 656e 616d  l='image-filenam
-0001a7c0: 6527 2c63 6f6e 7665 7274 3d54 7275 6529  e',convert=True)
-0001a7d0: 0a20 2020 2020 2020 2073 656c 662e 7772  .        self.wr
-0001a7e0: 6974 6550 6172 7365 6444 6174 6154 6f49  iteParsedDataToI
-0001a7f0: 7465 6d73 2874 6d70 5f64 6174 612c 6974  tems(tmp_data,it
-0001a800: 656d 732c 7365 6c66 2e69 6664 6f5f 746d  ems,self.ifdo_tm
-0001a810: 705b 6d69 7174 762e 696d 6167 655f 7365  p[miqtv.image_se
-0001a820: 745f 6865 6164 6572 5f6b 6579 5d2c 2064  t_header_key], d
-0001a830: 6174 6574 696d 655f 666f 726d 6174 3d64  atetime_format=d
-0001a840: 6174 6574 696d 655f 666f 726d 6174 290a  atetime_format).
-0001a850: 0a0a 2020 2020 6465 6620 7772 6974 6550  ..    def writeP
-0001a860: 6172 7365 6444 6174 6154 6f49 7465 6d73  arsedDataToItems
-0001a870: 2873 656c 662c 6461 7461 3a64 6963 742c  (self,data:dict,
-0001a880: 6974 656d 733a 6469 6374 2c68 6561 6465  items:dict,heade
-0001a890: 723a 6469 6374 2c20 6461 7465 7469 6d65  r:dict, datetime
-0001a8a0: 5f66 6f72 6d61 743a 7374 723d 6d69 7174  _format:str=miqt
-0001a8b0: 762e 6461 7465 5f66 6f72 6d61 7473 5b27  v.date_formats['
-0001a8c0: 6d61 7269 7174 275d 293a 0a0a 2020 2020  mariqt']):..    
-0001a8d0: 2020 2020 2320 6576 616c 2073 7472 696e      # eval strin
-0001a8e0: 6773 2061 7320 6469 6374 206f 7220 6c69  gs as dict or li
-0001a8f0: 7374 0a20 2020 2020 2020 206d 6971 7463  st.        miqtc
-0001a900: 2e72 6563 7572 7369 7665 4576 616c 2864  .recursiveEval(d
-0001a910: 6174 6129 0a0a 2020 2020 2020 2020 2320  ata)..        # 
-0001a920: 706f 7465 6e74 6169 6c6c 7920 7265 6d6f  potentailly remo
-0001a930: 7665 2063 6f6e 7374 2064 6174 6120 6672  ve const data fr
-0001a940: 6f6d 2069 7465 6d73 2061 6e64 2070 7574  om items and put
-0001a950: 2069 6e20 6865 6164 6572 0a20 2020 2020   in header.     
-0001a960: 2020 2073 656c 662e 6578 7472 6163 7443     self.extractC
-0001a970: 6f6e 7374 4461 7461 5661 6c75 6573 2864  onstDataValues(d
-0001a980: 6174 612c 6865 6164 6572 290a 0a20 2020  ata,header)..   
-0001a990: 2020 2020 2064 6174 6120 3d20 6d69 7174       data = miqt
-0001a9a0: 632e 7265 6375 7273 6976 656c 7952 656d  c.recursivelyRem
-0001a9b0: 6f76 6545 6d70 7479 4669 656c 6473 2864  oveEmptyFields(d
-0001a9c0: 6174 612c 636f 6e74 656e 7432 6265 5265  ata,content2beRe
-0001a9d0: 6d6f 7665 643d 4e6f 6e65 290a 0a20 2020  moved=None)..   
-0001a9e0: 2020 2020 2023 2061 6464 2027 696d 6167       # add 'imag
-0001a9f0: 652d 6669 6c65 6e61 6d65 2720 6669 656c  e-filename' fiel
-0001aa00: 640a 2020 2020 2020 2020 666f 7220 696d  d.        for im
-0001aa10: 672c 2065 6e74 7279 2069 6e20 6461 7461  g, entry in data
-0001aa20: 2e69 7465 6d73 2829 3a0a 0a20 2020 2020  .items():..     
-0001aa30: 2020 2020 2020 2023 206c 6973 740a 2020         # list.  
-0001aa40: 2020 2020 2020 2020 2020 6966 2069 7369            if isi
-0001aa50: 6e73 7461 6e63 6528 656e 7472 792c 6c69  nstance(entry,li
-0001aa60: 7374 293a 0a20 2020 2020 2020 2020 2020  st):.           
-0001aa70: 2020 2020 2066 6f72 206c 6973 7449 7465       for listIte
-0001aa80: 6d20 696e 2065 6e74 7279 3a0a 2020 2020  m in entry:.    
-0001aa90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aaa0: 6c69 7374 4974 656d 5b27 696d 6167 652d  listItem['image-
-0001aab0: 6669 6c65 6e61 6d65 275d 203d 2069 6d67  filename'] = img
-0001aac0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001aad0: 2020 2020 2023 2063 6f76 6572 7420 6461       # covert da
-0001aae0: 7465 7469 6d65 2073 7472 696e 670a 2020  tetime string.  
-0001aaf0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ab00: 2020 6966 2027 696d 6167 652d 6461 7465    if 'image-date
-0001ab10: 7469 6d65 2720 696e 206c 6973 7449 7465  time' in listIte
-0001ab20: 6d3a 0a20 2020 2020 2020 2020 2020 2020  m:.             
-0001ab30: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
-0001ab40: 6461 7465 7469 6d65 2e64 6174 6574 696d  datetime.datetim
-0001ab50: 652e 7374 7270 7469 6d65 286c 6973 7449  e.strptime(listI
-0001ab60: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-0001ab70: 696d 6527 5d2c 2064 6174 6574 696d 655f  ime'], datetime_
-0001ab80: 666f 726d 6174 290a 2020 2020 2020 2020  format).        
-0001ab90: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001aba0: 6c69 7374 4974 656d 5b27 696d 6167 652d  listItem['image-
-0001abb0: 6461 7465 7469 6d65 275d 203d 2064 742e  datetime'] = dt.
-0001abc0: 7374 7266 7469 6d65 286d 6971 7476 2e64  strftime(miqtv.d
-0001abd0: 6174 655f 666f 726d 6174 735b 276d 6172  ate_formats['mar
-0001abe0: 6971 7427 5d29 0a20 2020 2020 2020 2020  iqt']).         
-0001abf0: 2020 2065 6c69 6620 6973 696e 7374 616e     elif isinstan
-0001ac00: 6365 2865 6e74 7279 2c64 6963 7429 3a0a  ce(entry,dict):.
-0001ac10: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001ac20: 656e 7472 795b 2769 6d61 6765 2d66 696c  entry['image-fil
-0001ac30: 656e 616d 6527 5d20 3d20 696d 670a 2020  ename'] = img.  
-0001ac40: 2020 2020 2020 2020 2020 2020 2020 2320                # 
-0001ac50: 636f 7665 7274 2064 6174 6574 696d 6520  covert datetime 
-0001ac60: 7374 7269 6e67 0a20 2020 2020 2020 2020  string.         
-0001ac70: 2020 2020 2020 2069 6620 2769 6d61 6765         if 'image
-0001ac80: 2d64 6174 6574 696d 6527 2069 6e20 656e  -datetime' in en
-0001ac90: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001aca0: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
-0001acb0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-0001acc0: 7374 7270 7469 6d65 2865 6e74 7279 5b27  strptime(entry['
-0001acd0: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
-0001ace0: 2c20 6461 7465 7469 6d65 5f66 6f72 6d61  , datetime_forma
-0001acf0: 7429 0a20 2020 2020 2020 2020 2020 2020  t).             
-0001ad00: 2020 2020 2020 2065 6e74 7279 5b27 696d         entry['im
-0001ad10: 6167 652d 6461 7465 7469 6d65 275d 203d  age-datetime'] =
-0001ad20: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
-0001ad30: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-0001ad40: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
-0001ad50: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
-0001ad60: 2020 2020 2020 2020 2020 2020 2072 6169               rai
-0001ad70: 7365 206d 6971 7463 2e49 6664 6f45 7863  se miqtc.IfdoExc
-0001ad80: 6570 7469 6f6e 2822 6461 7461 2065 6e74  eption("data ent
-0001ad90: 7269 6573 206d 7573 7420 6265 2064 6963  ries must be dic
-0001ada0: 7420 6f72 206c 6973 7420 6966 2064 6963  t or list if dic
-0001adb0: 7473 2229 0a0a 2020 2020 2020 2020 6d69  ts")..        mi
-0001adc0: 7174 632e 7265 6375 7273 6976 656c 7955  qtc.recursivelyU
-0001add0: 7064 6174 6544 6963 7473 2869 7465 6d73  pdateDicts(items
-0001ade0: 2c64 6174 6129 0a0a 0a20 2020 2040 7374  ,data)...    @st
-0001adf0: 6174 6963 6d65 7468 6f64 0a20 2020 2064  aticmethod.    d
-0001ae00: 6566 2065 7874 7261 6374 436f 6e73 7444  ef extractConstD
-0001ae10: 6174 6156 616c 7565 7328 6461 7461 3a64  ataValues(data:d
-0001ae20: 6963 742c 6865 6164 6572 3a64 6963 7429  ict,header:dict)
-0001ae30: 3a0a 2020 2020 2020 2020 2222 2220 5265  :.        """ Re
-0001ae40: 6d6f 7665 7320 6669 656c 6473 2074 6861  moves fields tha
-0001ae50: 7420 6172 6520 636f 6e73 7461 6e74 2066  t are constant f
-0001ae60: 6f72 2061 6c6c 2065 6e74 7269 6573 2066  or all entries f
-0001ae70: 726f 6d20 6461 7461 2064 6963 7420 616e  rom data dict an
-0001ae80: 6420 7075 7420 7468 656d 2069 6e20 6865  d put them in he
-0001ae90: 6164 6572 2064 6963 742e 200a 2020 2020  ader dict. .    
-0001aea0: 2020 2020 2020 2020 4561 6368 2065 6e74          Each ent
-0001aeb0: 7279 206f 6620 6461 7461 206d 7573 7420  ry of data must 
-0001aec0: 6265 2061 2064 6963 7420 7769 7468 2074  be a dict with t
-0001aed0: 6865 2073 616d 6520 7365 7420 6f66 206b  he same set of k
-0001aee0: 6579 732e 2022 2222 0a20 2020 200a 2020  eys. """.    .  
-0001aef0: 2020 2020 2020 6669 656c 6473 546f 4967        fieldsToIg
-0001af00: 6e6f 7265 203d 205b 2769 6d61 6765 2d64  nore = ['image-d
-0001af10: 6174 6574 696d 6527 5d0a 2020 2020 2020  atetime'].      
-0001af20: 2020 636f 6e73 7444 6174 6120 3d20 7b7d    constData = {}
-0001af30: 0a20 2020 2020 2020 2066 6972 7374 496d  .        firstIm
-0001af40: 6167 6520 3d20 5472 7565 0a20 2020 2020  age = True.     
-0001af50: 2020 2066 6f72 2069 6d61 6765 2c69 6d61     for image,ima
-0001af60: 6765 5f64 6174 6120 696e 2064 6174 612e  ge_data in data.
-0001af70: 6974 656d 7328 293a 0a20 2020 2020 2020  items():.       
-0001af80: 2020 2020 200a 2020 2020 2020 2020 2020       .          
-0001af90: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001afa0: 6e63 6528 696d 6167 655f 6461 7461 2c6c  nce(image_data,l
-0001afb0: 6973 7429 3a0a 2020 2020 2020 2020 2020  ist):.          
-0001afc0: 2020 2020 2020 696d 6167 655f 6461 7461        image_data
-0001afd0: 203d 205b 696d 6167 655f 6461 7461 5d0a   = [image_data].
-0001afe0: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001aff0: 6e6f 7420 6669 7273 7449 6d61 6765 2061  not firstImage a
-0001b000: 6e64 2063 6f6e 7374 4461 7461 203d 3d20  nd constData == 
-0001b010: 7b7d 3a0a 2020 2020 2020 2020 2020 2020  {}:.            
-0001b020: 2020 2020 6272 6561 6b0a 2020 2020 2020      break.      
-0001b030: 2020 2020 2020 0a20 2020 2020 2020 2020        .         
-0001b040: 2020 2066 6972 7374 5469 6d65 506f 696e     firstTimePoin
-0001b050: 7420 3d20 5472 7565 0a20 2020 2020 2020  t = True.       
-0001b060: 2020 2020 2066 6f72 2069 6d61 6765 5f74       for image_t
-0001b070: 705f 6461 7461 2069 6e20 696d 6167 655f  p_data in image_
-0001b080: 6461 7461 3a0a 2020 2020 2020 2020 2020  data:.          
-0001b090: 2020 2020 2020 2320 7665 7279 2066 6972        # very fir
-0001b0a0: 7374 2064 6174 6120 666f 7220 636f 6d70  st data for comp
-0001b0b0: 6172 6973 6f6e 0a20 2020 2020 2020 2020  arison.         
-0001b0c0: 2020 2020 2020 2069 6620 6669 7273 7449         if firstI
-0001b0d0: 6d61 6765 2061 6e64 2066 6972 7374 5469  mage and firstTi
-0001b0e0: 6d65 506f 696e 743a 0a20 2020 2020 2020  mePoint:.       
-0001b0f0: 2020 2020 2020 2020 2020 2020 2063 6f6e               con
-0001b100: 7374 4461 7461 203d 2063 6f70 792e 6465  stData = copy.de
-0001b110: 6570 636f 7079 2869 6d61 6765 5f74 705f  epcopy(image_tp_
-0001b120: 6461 7461 290a 2020 2020 2020 2020 2020  data).          
-0001b130: 2020 2020 2020 2020 2020 666f 7220 6669            for fi
-0001b140: 656c 6420 696e 2066 6965 6c64 7354 6f49  eld in fieldsToI
-0001b150: 676e 6f72 653a 0a20 2020 2020 2020 2020  gnore:.         
-0001b160: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b170: 6620 6669 656c 6420 696e 2063 6f6e 7374  f field in const
-0001b180: 4461 7461 3a0a 2020 2020 2020 2020 2020  Data:.          
-0001b190: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b1a0: 2020 6465 6c20 636f 6e73 7444 6174 615b    del constData[
-0001b1b0: 6669 656c 645d 0a20 2020 2020 2020 2020  field].         
-0001b1c0: 2020 2020 2020 2020 2020 2066 6972 7374             first
-0001b1d0: 5469 6d65 506f 696e 7420 3d20 4661 6c73  TimePoint = Fals
-0001b1e0: 650a 2020 2020 2020 2020 2020 2020 2020  e.              
-0001b1f0: 2020 2020 2020 636f 6e74 696e 7565 0a0a        continue..
-0001b200: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001b210: 636f 6e73 7444 6174 6120 3d20 6d69 7174  constData = miqt
-0001b220: 632e 6669 6e64 436f 6d6d 6f6e 4469 6374  c.findCommonDict
-0001b230: 456c 656d 656e 7473 2869 6d61 6765 5f74  Elements(image_t
-0001b240: 705f 6461 7461 2c63 6f6e 7374 4461 7461  p_data,constData
-0001b250: 290a 0a20 2020 2020 2020 2020 2020 2066  )..            f
-0001b260: 6972 7374 496d 6167 6520 3d20 4661 6c73  irstImage = Fals
-0001b270: 650a 0a20 2020 2020 2020 2023 2054 4f44  e..        # TOD
-0001b280: 4f20 6368 6563 6b20 7769 7468 696e 2069  O check within i
-0001b290: 6d61 6765 2074 696d 6573 202d 3e20 746f  mage times -> to
-0001b2a0: 2069 6d61 6765 2064 6566 6175 6c74 2e20   image default. 
-0001b2b0: 2874 7269 636b 7920 7369 6e63 6520 7765  (tricky since we
-0001b2c0: 2064 6f6e 2774 2068 6176 6520 7468 6520   don't have the 
-0001b2d0: 6461 6661 756c 7420 696e 6465 7820 6865  dafault index he
-0001b2e0: 7265 2e20 4f6e 6c79 2061 2073 7562 7365  re. Only a subse
-0001b2f0: 7420 6d69 6768 7420 6265 2075 7064 6174  t might be updat
-0001b300: 6520 6865 7265 290a 2020 2020 2020 2020  e here).        
-0001b310: 2320 6368 6563 6b20 7769 7468 696e 2069  # check within i
-0001b320: 6d61 6765 2069 7465 6d73 202d 3e20 6865  mage items -> he
-0001b330: 6164 6572 0a20 2020 2020 2020 2068 6561  ader.        hea
-0001b340: 6465 7255 7064 6174 6520 3d20 636f 7079  derUpdate = copy
-0001b350: 2e64 6565 7063 6f70 7928 636f 6e73 7444  .deepcopy(constD
-0001b360: 6174 6129 0a20 2020 2020 2020 2068 6561  ata).        hea
-0001b370: 6465 7255 7064 6174 6564 5465 7374 203d  derUpdatedTest =
-0001b380: 2063 6f70 792e 6465 6570 636f 7079 2868   copy.deepcopy(h
-0001b390: 6561 6465 7229 0a20 2020 2020 2020 206d  eader).        m
-0001b3a0: 6971 7463 2e72 6563 7572 7369 7665 6c79  iqtc.recursively
-0001b3b0: 5570 6461 7465 4469 6374 7328 6865 6164  UpdateDicts(head
-0001b3c0: 6572 5570 6461 7465 6454 6573 742c 6865  erUpdatedTest,he
-0001b3d0: 6164 6572 5570 6461 7465 290a 2020 2020  aderUpdate).    
-0001b3e0: 2020 2020 7570 6461 7465 4469 6666 203d      updateDiff =
-0001b3f0: 2044 6565 7044 6966 6628 6865 6164 6572   DeepDiff(header
-0001b400: 2c68 6561 6465 7255 7064 6174 6564 5465  ,headerUpdatedTe
-0001b410: 7374 290a 2020 2020 2020 2020 2320 6368  st).        # ch
-0001b420: 6563 6b20 6966 2068 6561 6465 7255 7064  eck if headerUpd
-0001b430: 6174 6520 776f 756c 6420 6f76 6572 7772  ate would overwr
-0001b440: 6974 6520 616e 7974 6869 6e67 2066 726f  ite anything fro
-0001b450: 6d20 6375 7272 656e 7420 6865 6164 6572  m current header
-0001b460: 2028 7368 6f75 6c64 206e 6f74 2068 6170   (should not hap
-0001b470: 7065 6e29 2c20 6966 2073 6f20 646f 6e74  pen), if so dont
-0001b480: 2072 656d 6f76 6520 6672 6f6d 2069 7465   remove from ite
-0001b490: 6d73 0a20 2020 2020 2020 2069 6620 6e6f  ms.        if no
-0001b4a0: 7420 2776 616c 7565 735f 6368 616e 6765  t 'values_change
-0001b4b0: 6427 2069 6e20 7570 6461 7465 4469 6666  d' in updateDiff
-0001b4c0: 2061 6e64 206e 6f74 2027 7479 7065 5f63   and not 'type_c
-0001b4d0: 6861 6e67 6573 2720 696e 2075 7064 6174  hanges' in updat
-0001b4e0: 6544 6966 6620 616e 6420 6e6f 7420 2764  eDiff and not 'd
-0001b4f0: 6963 7469 6f6e 6172 795f 6974 656d 5f72  ictionary_item_r
-0001b500: 656d 6f76 6564 2720 696e 2075 7064 6174  emoved' in updat
-0001b510: 6544 6966 663a 0a20 2020 2020 2020 2020  eDiff:.         
-0001b520: 2020 2068 6561 6465 722e 636c 6561 7228     header.clear(
-0001b530: 290a 2020 2020 2020 2020 2020 2020 6865  ).            he
-0001b540: 6164 6572 2e75 7064 6174 6528 6865 6164  ader.update(head
-0001b550: 6572 5570 6461 7465 6454 6573 7429 0a0a  erUpdatedTest)..
-0001b560: 2020 2020 2020 2020 2020 2020 2320 7265              # re
-0001b570: 6d6f 7665 2063 6f6e 7374 2076 616c 7565  move const value
-0001b580: 7320 6672 6f6d 2064 6174 610a 2020 2020  s from data.    
-0001b590: 2020 2020 2020 2020 6d69 7174 632e 7265          miqtc.re
-0001b5a0: 6375 7273 6976 654d 616b 654e 6f6e 6544  cursiveMakeNoneD
-0001b5b0: 6963 7446 6965 6c64 7345 6d70 7479 5374  ictFieldsEmptySt
-0001b5c0: 7228 636f 6e73 7444 6174 6129 0a20 2020  r(constData).   
-0001b5d0: 2020 2020 2020 2020 2066 6f72 2069 6d61           for ima
-0001b5e0: 6765 2c69 6d61 6765 5f64 6174 6120 696e  ge,image_data in
-0001b5f0: 2064 6174 612e 6974 656d 7328 293a 0a20   data.items():. 
-0001b600: 2020 2020 2020 2020 2020 2020 2020 2069                 i
-0001b610: 6620 6e6f 7420 6973 696e 7374 616e 6365  f not isinstance
-0001b620: 2869 6d61 6765 5f64 6174 612c 6c69 7374  (image_data,list
-0001b630: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
-0001b640: 2020 2020 2020 2069 6d61 6765 5f64 6174         image_dat
-0001b650: 6120 3d20 5b69 6d61 6765 5f64 6174 615d  a = [image_data]
-0001b660: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001b670: 2066 6f72 2069 6d61 6765 5f74 705f 6461   for image_tp_da
-0001b680: 7461 2069 6e20 696d 6167 655f 6461 7461  ta in image_data
-0001b690: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
-0001b6a0: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
-0001b6b0: 7273 6976 656c 7955 7064 6174 6544 6963  rsivelyUpdateDic
-0001b6c0: 7473 2869 6d61 6765 5f74 705f 6461 7461  ts(image_tp_data
-0001b6d0: 2c63 6f6e 7374 4461 7461 2920 2020 2020  ,constData)     
-0001b6e0: 2020 2020 200a 0a20 2020 2020 2020 2065       ..        e
-0001b6f0: 6c73 653a 0a20 2020 2020 2020 2020 2020  lse:.           
-0001b700: 2070 6173 730a 2020 2020 2020 2020 2020   pass.          
-0001b710: 2020 2320 544f 444f 206c 6f67 3f0a 2020    # TODO log?.  
-0001b720: 2020 200a 0a20 2020 2064 6566 2069 6e74     ..    def int
-0001b730: 6572 6d65 6469 6174 654e 6176 4669 6c65  ermediateNavFile
-0001b740: 4578 6973 7473 2873 656c 6629 3a0a 2020  Exists(self):.  
-0001b750: 2020 2020 2020 6966 206f 732e 7061 7468        if os.path
-0001b760: 2e65 7869 7374 7328 7365 6c66 2e67 6574  .exists(self.get
-0001b770: 5f69 6e74 5f6e 6176 5f66 696c 6528 2929  _int_nav_file())
-0001b780: 3a0a 2020 2020 2020 2020 2020 2020 7265  :.            re
-0001b790: 7475 726e 2054 7275 650a 2020 2020 2020  turn True.      
-0001b7a0: 2020 656c 7365 3a0a 2020 2020 2020 2020    else:.        
-0001b7b0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
-0001b7c0: 0a0a 0a20 2020 2064 6566 2068 6561 6465  ...    def heade
-0001b7d0: 7246 6965 6c64 4669 6c6c 6564 2873 656c  rFieldFilled(sel
-0001b7e0: 662c 6669 656c 643a 7374 7229 3a0a 2020  f,field:str):.  
-0001b7f0: 2020 2020 2020 6966 2073 656c 662e 6669        if self.fi
-0001b800: 6e64 546d 7046 6965 6c64 3228 6669 656c  ndTmpField2(fiel
-0001b810: 6429 203d 3d20 2222 3a0a 2020 2020 2020  d) == "":.      
-0001b820: 2020 2020 2020 7265 7475 726e 2046 616c        return Fal
-0001b830: 7365 0a20 2020 2020 2020 2072 6574 7572  se.        retur
-0001b840: 6e20 5472 7565 0a0a 2020 2020 6465 6620  n True..    def 
-0001b850: 636f 6e76 6572 7454 6f44 6566 6175 6c74  convertToDefault
-0001b860: 4461 7465 5469 6d65 466f 726d 6174 2873  DateTimeFormat(s
-0001b870: 656c 662c 6966 646f 293a 0a20 2020 2020  elf,ifdo):.     
-0001b880: 2020 2022 2222 2043 6865 636b 7320 6966     """ Checks if
-0001b890: 2061 6c6c 2069 7465 6d73 2720 2769 6d61   all items' 'ima
-0001b8a0: 6765 2d64 6174 6574 696d 6527 2066 6965  ge-datetime' fie
-0001b8b0: 6c64 7320 6d61 7463 6820 6465 6661 756c  lds match defaul
-0001b8c0: 7420 6461 7465 7469 6d65 2066 6f72 6d61  t datetime forma
-0001b8d0: 7420 6f72 2061 2063 7573 746f 6d20 6f6e  t or a custom on
-0001b8e0: 6520 6465 6669 6e65 6420 696e 2027 696d  e defined in 'im
-0001b8f0: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001b900: 6d61 7427 0a20 2020 2020 2020 2020 2020  mat'.           
-0001b910: 2061 6e64 2063 6f6e 7665 7274 7320 746f   and converts to
-0001b920: 2064 6566 6175 6c74 2066 6f72 6d61 742e   default format.
-0001b930: 2054 6872 6f77 7320 6578 6365 7074 696f   Throws exceptio
-0001b940: 6e20 6966 2064 6174 6574 696d 6520 6361  n if datetime ca
-0001b950: 6e6e 6f74 2062 6520 7061 7273 6564 2022  nnot be parsed "
-0001b960: 2222 0a20 2020 2020 2020 2063 7573 746f  "".        custo
-0001b970: 6d44 6174 6554 696d 6546 6f72 6d61 7446  mDateTimeFormatF
-0001b980: 6f75 6e64 203d 2046 616c 7365 0a20 2020  ound = False.   
-0001b990: 2020 2020 2068 6561 6465 7243 7573 746f       headerCusto
-0001b9a0: 6d44 6174 6554 696d 6546 6f72 6d61 7420  mDateTimeFormat 
-0001b9b0: 3d20 6669 6e64 4669 656c 6428 6966 646f  = findField(ifdo
-0001b9c0: 5b73 656c 662e 696d 6167 6553 6574 4865  [self.imageSetHe
-0001b9d0: 6164 6572 4b65 795d 2c27 696d 6167 652d  aderKey],'image-
-0001b9e0: 6461 7465 7469 6d65 2d66 6f72 6d61 7427  datetime-format'
-0001b9f0: 290a 2020 2020 2020 2020 6966 2068 6561  ).        if hea
-0001ba00: 6465 7243 7573 746f 6d44 6174 6554 696d  derCustomDateTim
-0001ba10: 6546 6f72 6d61 7420 213d 2022 223a 0a20  eFormat != "":. 
-0001ba20: 2020 2020 2020 2020 2020 2069 6664 6f5b             ifdo[
-0001ba30: 7365 6c66 2e69 6d61 6765 5365 7448 6561  self.imageSetHea
-0001ba40: 6465 724b 6579 5d5b 2769 6d61 6765 2d64  derKey]['image-d
-0001ba50: 6174 6574 696d 652d 666f 726d 6174 275d  atetime-format']
-0001ba60: 203d 2022 2220 2320 7265 6d6f 7665 2063   = "" # remove c
-0001ba70: 7573 746f 6d20 666f 726d 6174 0a20 2020  ustom format.   
-0001ba80: 2020 2020 2020 2020 2063 7573 746f 6d44           customD
-0001ba90: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
-0001baa0: 6e64 203d 2054 7275 650a 2020 2020 2020  nd = True.      
-0001bab0: 2020 7072 6f67 203d 206d 6971 7463 2e50    prog = miqtc.P
-0001bac0: 7269 6e74 4b6e 6f77 6e50 726f 6772 6573  rintKnownProgres
-0001bad0: 734d 7367 2822 4368 6563 6b69 6e67 2064  sMsg("Checking d
-0001bae0: 6174 6574 696d 6520 666f 726d 6174 222c  atetime format",
-0001baf0: 206c 656e 2869 6664 6f5b 7365 6c66 2e69   len(ifdo[self.i
-0001bb00: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-0001bb10: 292c 6d6f 6475 6c6f 3d31 290a 2020 2020  ),modulo=1).    
-0001bb20: 2020 2020 666f 7220 6669 6c65 2c69 7465      for file,ite
-0001bb30: 6d20 696e 2069 6664 6f5b 7365 6c66 2e69  m in ifdo[self.i
-0001bb40: 6d61 6765 5365 7449 7465 6d73 4b65 795d  mageSetItemsKey]
-0001bb50: 2e69 7465 6d73 2829 3a0a 2020 2020 2020  .items():.      
-0001bb60: 2020 2020 2020 7072 6f67 2e70 726f 6772        prog.progr
-0001bb70: 6573 7328 290a 2020 2020 2020 2020 2020  ess().          
-0001bb80: 2020 6966 206e 6f74 2069 7369 6e73 7461    if not isinsta
-0001bb90: 6e63 6528 6974 656d 2c6c 6973 7429 3a0a  nce(item,list):.
-0001bba0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bbb0: 2020 2020 6974 656d 203d 205b 6974 656d      item = [item
-0001bbc0: 5d0a 2020 2020 2020 2020 2020 2020 7375  ].            su
-0001bbd0: 6249 7465 6d44 6566 6175 6c74 203d 2069  bItemDefault = i
-0001bbe0: 7465 6d5b 305d 0a20 2020 2020 2020 2020  tem[0].         
-0001bbf0: 2020 2069 7465 6d43 7573 746f 6d44 6174     itemCustomDat
-0001bc00: 6554 696d 6546 6f72 6d61 7420 3d20 2222  eTimeFormat = ""
-0001bc10: 0a20 2020 2020 2020 2020 2020 2069 6620  .            if 
-0001bc20: 2769 6d61 6765 2d64 6174 6574 696d 652d  'image-datetime-
-0001bc30: 666f 726d 6174 2720 696e 2073 7562 4974  format' in subIt
-0001bc40: 656d 4465 6661 756c 743a 0a20 2020 2020  emDefault:.     
-0001bc50: 2020 2020 2020 2020 2020 2069 7465 6d43             itemC
-0001bc60: 7573 746f 6d44 6174 6554 696d 6546 6f72  ustomDateTimeFor
-0001bc70: 6d61 7420 3d20 7375 6249 7465 6d44 6566  mat = subItemDef
-0001bc80: 6175 6c74 5b27 696d 6167 652d 6461 7465  ault['image-date
-0001bc90: 7469 6d65 2d66 6f72 6d61 7427 5d0a 2020  time-format'].  
-0001bca0: 2020 2020 2020 2020 2020 2020 2020 7375                su
-0001bcb0: 6249 7465 6d44 6566 6175 6c74 5b27 696d  bItemDefault['im
-0001bcc0: 6167 652d 6461 7465 7469 6d65 2d66 6f72  age-datetime-for
-0001bcd0: 6d61 7427 5d20 3d20 2222 2023 2072 656d  mat'] = "" # rem
-0001bce0: 6f76 6520 6375 7374 6f6d 2066 6f72 6d61  ove custom forma
-0001bcf0: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001bd00: 2020 6375 7374 6f6d 4461 7465 5469 6d65    customDateTime
-0001bd10: 466f 726d 6174 466f 756e 6420 3d20 5472  FormatFound = Tr
-0001bd20: 7565 0a20 2020 2020 2020 2020 2020 2066  ue.            f
-0001bd30: 6f72 2073 7562 4974 656d 2069 6e20 6974  or subItem in it
-0001bd40: 656d 3a0a 2020 2020 2020 2020 2020 2020  em:.            
-0001bd50: 2020 2020 7472 793a 0a20 2020 2020 2020      try:.       
-0001bd60: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001bd70: 6d61 7420 3d20 6d69 7174 762e 6461 7465  mat = miqtv.date
-0001bd80: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-0001bd90: 275d 0a20 2020 2020 2020 2020 2020 2020  '].             
-0001bda0: 2020 2020 2020 2064 6174 6574 696d 652e         datetime.
-0001bdb0: 6461 7465 7469 6d65 2e73 7472 7074 696d  datetime.strptim
-0001bdc0: 6528 7375 6249 7465 6d5b 2769 6d61 6765  e(subItem['image
-0001bdd0: 2d64 6174 6574 696d 6527 5d2c 666f 726d  -datetime'],form
-0001bde0: 6174 290a 2020 2020 2020 2020 2020 2020  at).            
-0001bdf0: 2020 2020 6578 6365 7074 3a0a 2020 2020      except:.    
-0001be00: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001be10: 7472 793a 0a20 2020 2020 2020 2020 2020  try:.           
-0001be20: 2020 2020 2020 2020 2020 2020 2066 6f72               for
-0001be30: 6d61 7420 3d20 6865 6164 6572 4375 7374  mat = headerCust
-0001be40: 6f6d 4461 7465 5469 6d65 466f 726d 6174  omDateTimeFormat
-0001be50: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
-0001be60: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
-0001be70: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
-0001be80: 7374 7270 7469 6d65 2873 7562 4974 656d  strptime(subItem
-0001be90: 5b27 696d 6167 652d 6461 7465 7469 6d65  ['image-datetime
-0001bea0: 275d 2c66 6f72 6d61 7429 0a20 2020 2020  '],format).     
-0001beb0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bec0: 2020 2073 7562 4974 656d 5b27 696d 6167     subItem['imag
-0001bed0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
-0001bee0: 6174 6574 696d 652e 6461 7465 7469 6d65  atetime.datetime
-0001bef0: 2e73 7472 6674 696d 6528 6474 2c6d 6971  .strftime(dt,miq
-0001bf00: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
-0001bf10: 276d 6172 6971 7427 5d29 0a20 2020 2020  'mariqt']).     
-0001bf20: 2020 2020 2020 2020 2020 2020 2020 2065                 e
-0001bf30: 7863 6570 743a 0a20 2020 2020 2020 2020  xcept:.         
-0001bf40: 2020 2020 2020 2020 2020 2020 2020 2074                 t
-0001bf50: 7279 3a0a 2020 2020 2020 2020 2020 2020  ry:.            
-0001bf60: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001bf70: 666f 726d 6174 203d 2069 7465 6d43 7573  format = itemCus
-0001bf80: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
-0001bf90: 740a 2020 2020 2020 2020 2020 2020 2020  t.              
-0001bfa0: 2020 2020 2020 2020 2020 2020 2020 6474                dt
-0001bfb0: 203d 2064 6174 6574 696d 652e 6461 7465   = datetime.date
-0001bfc0: 7469 6d65 2e73 7472 7074 696d 6528 7375  time.strptime(su
-0001bfd0: 6249 7465 6d5b 2769 6d61 6765 2d64 6174  bItem['image-dat
-0001bfe0: 6574 696d 6527 5d2c 666f 726d 6174 290a  etime'],format).
+000194d0: 2020 6465 6c20 6c69 6e65 735b 6c69 6e65    del lines[line
+000194e0: 4e72 5d0a 2020 2020 2020 2020 2020 2020  Nr].            
+000194f0: 2020 2020 2020 2020 2020 2020 7265 7320              res 
+00019500: 3d20 6f70 656e 2873 656c 662e 6765 745f  = open(self.get_
+00019510: 696e 745f 7575 6964 5f66 696c 6528 292c  int_uuid_file(),
+00019520: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+00019530: 2020 2020 2020 2020 2020 2020 2020 7265                re
+00019540: 732e 7772 6974 656c 696e 6573 286c 696e  s.writelines(lin
+00019550: 6573 290a 2020 2020 2020 2020 2020 2020  es).            
+00019560: 2020 2020 2020 2020 2020 2020 7265 732e              res.
+00019570: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
+00019580: 2020 2020 2020 2020 2020 2020 7261 6973              rais
+00019590: 6520 4578 6365 7074 696f 6e28 2022 4669  e Exception( "Fi
+000195a0: 6c65 2022 202b 2066 696c 6520 2b20 2220  le " + file + " 
+000195b0: 646f 6573 206e 6f74 2063 6f74 6169 6e20  does not cotain 
+000195c0: 6120 7661 6c69 6420 5555 4944 2e20 5275  a valid UUID. Ru
+000195d0: 6e20 6372 6561 7465 5f75 7569 645f 6669  n create_uuid_fi
+000195e0: 6c65 2829 2066 6972 7374 2122 290a 0a20  le() first!").. 
+000195f0: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+00019600: 696c 655f 6e61 6d65 203d 206f 732e 7061  ile_name = os.pa
+00019610: 7468 2e62 6173 656e 616d 6528 6669 6c65  th.basename(file
+00019620: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019630: 2020 6966 206e 6f74 2072 6552 6561 6441    if not reReadA
+00019640: 6c6c 2061 6e64 2066 696c 655f 6e61 6d65  ll and file_name
+00019650: 2069 6e20 6861 7368 6573 3a0a 2020 2020   in hashes:.    
+00019660: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019670: 6861 7368 6573 5b66 696c 655f 6e61 6d65  hashes[file_name
+00019680: 5d20 3d20 6861 7368 6573 5b66 696c 655f  ] = hashes[file_
+00019690: 6e61 6d65 5d5b 6d69 7174 762e 636f 6c5f  name][miqtv.col_
+000196a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+000196b0: 5b27 6861 7368 275d 5d0a 2020 2020 2020  ['hash']].      
+000196c0: 2020 2020 2020 2020 2020 656c 7365 3a0a            else:.
+000196d0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+000196e0: 2020 2020 6861 7368 6573 5b66 696c 655f      hashes[file_
+000196f0: 6e61 6d65 5d20 3d20 6d69 7174 632e 7368  name] = miqtc.sh
+00019700: 6132 3536 4861 7368 4669 6c65 2866 696c  a256HashFile(fil
+00019710: 6529 0a20 2020 2020 2020 2020 2020 2020  e).             
+00019720: 2020 2020 2020 2061 6464 6564 5f68 6173         added_has
+00019730: 6865 7320 2b3d 2031 0a20 2020 2020 2020  hes += 1.       
+00019740: 2020 2020 2070 726f 672e 636c 6561 7228       prog.clear(
+00019750: 290a 0a20 2020 2020 2020 2020 2020 2069  )..            i
+00019760: 6620 7265 5265 6164 416c 6c20 6f72 2061  f reReadAll or a
+00019770: 6464 6564 5f68 6173 6865 7320 3e20 303a  dded_hashes > 0:
+00019780: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+00019790: 2068 6173 685f 6669 6c65 203d 206f 7065   hash_file = ope
+000197a0: 6e28 7365 6c66 2e67 6574 5f69 6e74 5f68  n(self.get_int_h
+000197b0: 6173 685f 6669 6c65 2829 2c20 2277 2229  ash_file(), "w")
+000197c0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+000197d0: 2068 6173 685f 6669 6c65 2e77 7269 7465   hash_file.write
+000197e0: 2820 6d69 7174 762e 636f 6c5f 6865 6164  ( miqtv.col_head
+000197f0: 6572 5b27 6d61 7269 7174 275d 5b27 696d  er['mariqt']['im
+00019800: 6727 5d2b 225c 7422 2b6d 6971 7476 2e63  g']+"\t"+miqtv.c
+00019810: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00019820: 7427 5d5b 2768 6173 6827 5d2b 225c 6e22  t']['hash']+"\n"
+00019830: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+00019840: 2020 666f 7220 6669 6c65 5f6e 616d 6520    for file_name 
+00019850: 696e 2068 6173 6865 733a 0a20 2020 2020  in hashes:.     
+00019860: 2020 2020 2020 2020 2020 2020 2020 2068                 h
+00019870: 6173 685f 6669 6c65 2e77 7269 7465 2866  ash_file.write(f
+00019880: 696c 655f 6e61 6d65 2b22 5c74 222b 6861  ile_name+"\t"+ha
+00019890: 7368 6573 5b66 696c 655f 6e61 6d65 5d2b  shes[file_name]+
+000198a0: 225c 6e22 290a 0a20 2020 2020 2020 2020  "\n")..         
+000198b0: 2020 2020 2020 2068 6173 685f 6669 6c65         hash_file
+000198c0: 2e63 6c6f 7365 2829 0a20 2020 2020 2020  .close().       
+000198d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+000198e0: 5472 7565 2c20 2241 6464 6564 2022 2b73  True, "Added "+s
+000198f0: 7472 2861 6464 6564 5f68 6173 6865 7329  tr(added_hashes)
+00019900: 2b22 2068 6173 6865 7320 746f 2068 6173  +" hashes to has
+00019910: 6820 6669 6c65 220a 2020 2020 2020 2020  h file".        
+00019920: 2020 2020 656c 7365 3a0a 2020 2020 2020      else:.      
+00019930: 2020 2020 2020 2020 2020 7265 7475 726e            return
+00019940: 2054 7275 652c 2022 416c 6c20 6861 7368   True, "All hash
+00019950: 6573 2065 7869 7374 220a 0a20 2020 2020  es exist"..     
+00019960: 2020 2065 6c73 653a 0a20 2020 2020 2020     else:.       
+00019970: 2020 2020 2072 6574 7572 6e20 4661 6c73       return Fals
+00019980: 652c 2022 4e6f 2069 6d61 6765 7320 666f  e, "No images fo
+00019990: 756e 6420 746f 2068 6173 6822 0a20 2020  und to hash".   
+000199a0: 2020 2020 200a 2020 2020 6465 6620 6372       .    def cr
+000199b0: 6561 7465 496d 6167 6553 4841 3235 3646  eateImageSHA256F
+000199c0: 696c 6528 7365 6c66 2c72 6552 6561 6441  ile(self,reReadA
+000199d0: 6c6c 3d54 7275 6529 3a0a 2020 2020 2020  ll=True):.      
+000199e0: 2020 2222 2220 4465 7072 6563 6174 6564    """ Deprecated
+000199f0: 202d 2075 7365 2063 7265 6174 655f 696d   - use create_im
+00019a00: 6167 655f 7368 6132 3536 5f66 696c 6520  age_sha256_file 
+00019a10: 2222 220a 2020 2020 2020 2020 7265 7475  """.        retu
+00019a20: 726e 2073 656c 662e 6372 6561 7465 5f69  rn self.create_i
+00019a30: 6d61 6765 5f73 6861 3235 365f 6669 6c65  mage_sha256_file
+00019a40: 2872 6552 6561 6441 6c6c 290a 0a0a 2020  (reReadAll)...  
+00019a50: 2020 6465 6620 6372 6561 7465 5f73 7461    def create_sta
+00019a60: 7274 5f74 696d 655f 6669 6c65 2873 656c  rt_time_file(sel
+00019a70: 6629 3a0a 2020 2020 2020 2020 2222 2220  f):.        """ 
+00019a80: 4372 6561 7465 7320 696e 202f 696e 7465  Creates in /inte
+00019a90: 726d 6564 6961 7465 2061 2074 6578 7420  rmediate a text 
+00019aa0: 6669 6c65 2063 6f6e 7461 696e 696e 6720  file containing 
+00019ab0: 7065 7220 696d 6167 6520 6974 7320 7374  per image its st
+00019ac0: 6172 7420 7469 6d65 2070 6172 7365 6420  art time parsed 
+00019ad0: 6672 6f6d 2074 6865 2066 696c 6520 6e61  from the file na
+00019ae0: 6d65 2022 2222 0a0a 2020 2020 2020 2020  me """..        
+00019af0: 7320 3d20 6d69 7174 632e 5072 696e 744c  s = miqtc.PrintL
+00019b00: 6f61 6469 6e67 4d73 6728 2243 7265 6174  oadingMsg("Creat
+00019b10: 696e 6720 696e 7465 726d 6564 6961 7465  ing intermediate
+00019b20: 2073 7461 7274 7469 6d65 2066 696c 6520   starttime file 
+00019b30: 2229 0a20 2020 2020 2020 2069 6d61 6765  ").        image
+00019b40: 7349 6e52 6177 203d 2073 656c 662e 696d  sInRaw = self.im
+00019b50: 6167 6573 496e 496d 6167 6573 4469 7253  agesInImagesDirS
+00019b60: 6f72 7465 644c 6973 7428 290a 2020 2020  ortedList().    
+00019b70: 2020 2020 6966 206c 656e 2869 6d61 6765      if len(image
+00019b80: 7349 6e52 6177 2920 3e20 303a 0a0a 2020  sInRaw) > 0:..  
+00019b90: 2020 2020 2020 2020 2020 6f20 3d20 6f70            o = op
+00019ba0: 656e 2873 656c 662e 6765 745f 696e 745f  en(self.get_int_
+00019bb0: 7374 6172 7454 696d 6573 5f66 696c 6528  startTimes_file(
+00019bc0: 292c 2022 7722 290a 2020 2020 2020 2020  ), "w").        
+00019bd0: 2020 2020 6f2e 7772 6974 6528 6d69 7174      o.write(miqt
+00019be0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+00019bf0: 7269 7174 275d 5b27 696d 6727 5d20 2b0a  riqt']['img'] +.
+00019c00: 2020 2020 2020 2020 2020 2020 2020 2020                  
+00019c10: 2020 2020 225c 7422 2b6d 6971 7476 2e63      "\t"+miqtv.c
+00019c20: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+00019c30: 7427 5d5b 2775 7463 275d 2b22 5c6e 2229  t']['utc']+"\n")
+00019c40: 0a0a 2020 2020 2020 2020 2020 2020 666f  ..            fo
+00019c50: 7220 6669 6c65 2069 6e20 696d 6167 6573  r file in images
+00019c60: 496e 5261 773a 0a20 2020 2020 2020 2020  InRaw:.         
+00019c70: 2020 2020 2020 2066 696c 655f 6e61 6d65         file_name
+00019c80: 203d 206f 732e 7061 7468 2e62 6173 656e   = os.path.basen
+00019c90: 616d 6528 6669 6c65 290a 0a20 2020 2020  ame(file)..     
+00019ca0: 2020 2020 2020 2020 2020 2064 7420 3d20             dt = 
+00019cb0: 6d69 7174 632e 7061 7273 6546 696c 6544  miqtc.parseFileD
+00019cc0: 6174 6554 696d 6541 7355 5443 2866 696c  ateTimeAsUTC(fil
+00019cd0: 655f 6e61 6d65 290a 2020 2020 2020 2020  e_name).        
+00019ce0: 2020 2020 2020 2020 6f2e 7772 6974 6528          o.write(
+00019cf0: 6669 6c65 5f6e 616d 652b 225c 7422 202b  file_name+"\t" +
+00019d00: 2064 742e 7374 7266 7469 6d65 286d 6971   dt.strftime(miq
+00019d10: 7476 2e64 6174 655f 666f 726d 6174 735b  tv.date_formats[
+00019d20: 276d 6172 6971 7427 5d29 2b22 5c6e 2229  'mariqt'])+"\n")
+00019d30: 0a0a 2020 2020 2020 2020 2020 2020 6f2e  ..            o.
+00019d40: 636c 6f73 6528 290a 2020 2020 2020 2020  close().        
+00019d50: 2020 2020 732e 7374 6f70 2829 0a20 2020      s.stop().   
+00019d60: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+00019d70: 5472 7565 2c20 2243 7265 6174 6564 2073  True, "Created s
+00019d80: 7461 7274 2074 696d 6520 6669 6c65 220a  tart time file".
+00019d90: 2020 2020 2020 2020 656c 7365 3a0a 2020          else:.  
+00019da0: 2020 2020 2020 2020 2020 732e 7374 6f70            s.stop
+00019db0: 2829 0a20 2020 2020 2020 2020 2020 2072  ().            r
+00019dc0: 6574 7572 6e20 4661 6c73 652c 2022 4e6f  eturn False, "No
+00019dd0: 2069 6d61 6765 7320 666f 756e 6420 746f   images found to
+00019de0: 2072 6561 6420 7374 6172 7420 7469 6d65   read start time
+00019df0: 7322 0a20 2020 2020 2020 200a 2020 2020  s".        .    
+00019e00: 6465 6620 6372 6561 7465 5374 6172 7454  def createStartT
+00019e10: 696d 6546 696c 6528 7365 6c66 293a 0a20  imeFile(self):. 
+00019e20: 2020 2020 2020 2022 2222 2044 6570 7265         """ Depre
+00019e30: 6361 7465 6420 2d20 7573 6520 6372 6561  cated - use crea
+00019e40: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
+00019e50: 6c65 2022 2222 0a20 2020 2020 2020 2072  le """.        r
+00019e60: 6574 7572 6e20 7365 6c66 2e63 7265 6174  eturn self.creat
+00019e70: 655f 7374 6172 745f 7469 6d65 5f66 696c  e_start_time_fil
+00019e80: 6528 290a 0a0a 2020 2020 6465 6620 6372  e()...    def cr
+00019e90: 6561 7465 4163 7175 6973 6974 696f 6e53  eateAcquisitionS
+00019ea0: 6574 7469 6e67 7345 5849 4646 696c 6528  ettingsEXIFFile(
+00019eb0: 7365 6c66 2c6f 7665 7272 6964 653d 4661  self,override=Fa
+00019ec0: 6c73 6529 3a0a 2020 2020 2020 2020 2222  lse):.        ""
+00019ed0: 2220 4372 6561 7465 7320 696e 202f 696e  " Creates in /in
+00019ee0: 7465 726d 6564 6961 7465 2061 2074 6578  termediate a tex
+00019ef0: 7420 6669 6c65 2063 6f6e 7461 696e 696e  t file containin
+00019f00: 6720 7065 7220 696d 6167 6520 6120 6469  g per image a di
+00019f10: 6374 206f 6620 6578 6966 2074 6167 7320  ct of exif tags 
+00019f20: 616e 6420 7468 6569 7220 7661 6c75 6573  and their values
+00019f30: 2070 6172 7365 6420 6672 6f6d 2074 6865   parsed from the
+00019f40: 2069 6d61 6765 2022 2222 0a0a 2020 2020   image """..    
+00019f50: 2020 2020 696e 745f 6163 7175 6973 6974      int_acquisit
+00019f60: 696f 6e53 6574 7469 6e67 5f66 696c 6520  ionSetting_file 
+00019f70: 3d20 7365 6c66 2e5f 5f67 6574 5f69 6e74  = self.__get_int
+00019f80: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+00019f90: 2027 5f69 6d61 6765 2d61 6371 7569 7369   '_image-acquisi
+00019fa0: 7469 6f6e 2d73 6574 7469 6e67 732e 7478  tion-settings.tx
+00019fb0: 7427 0a20 2020 2020 2020 2068 6561 6465  t'.        heade
+00019fc0: 7220 3d20 7b20 206d 6971 7476 2e63 6f6c  r = {  miqtv.col
+00019fd0: 5f68 6561 6465 725b 276d 6172 6971 7427  _header['mariqt'
+00019fe0: 5d5b 2769 6d67 275d 3a20 206d 6971 7476  ]['img']:  miqtv
+00019ff0: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
+0001a000: 6971 7427 5d5b 2769 6d67 275d 2c0a 2020  iqt']['img'],.  
+0001a010: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001a020: 2020 6d69 7174 762e 636f 6c5f 6865 6164    miqtv.col_head
+0001a030: 6572 5b27 6d61 7269 7174 275d 5b27 6163  er['mariqt']['ac
+0001a040: 7175 6927 5d3a 6d69 7174 762e 636f 6c5f  qui']:miqtv.col_
+0001a050: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001a060: 5b27 6163 7175 6927 5d7d 0a20 2020 2020  ['acqui']}.     
+0001a070: 2020 2069 6620 6f73 2e70 6174 682e 6578     if os.path.ex
+0001a080: 6973 7473 2869 6e74 5f61 6371 7569 7369  ists(int_acquisi
+0001a090: 7469 6f6e 5365 7474 696e 675f 6669 6c65  tionSetting_file
+0001a0a0: 2920 616e 6420 6e6f 7420 6f76 6572 7269  ) and not overri
+0001a0b0: 6465 3a0a 2020 2020 2020 2020 2020 2020  de:.            
+0001a0c0: 7365 6c66 2e61 6464 5f69 7465 6d5f 696e  self.add_item_in
+0001a0d0: 666f 5f74 6162 5f66 696c 6528 696e 745f  fo_tab_file(int_
+0001a0e0: 6163 7175 6973 6974 696f 6e53 6574 7469  acquisitionSetti
+0001a0f0: 6e67 5f66 696c 652c 225c 7422 2c68 6561  ng_file,"\t",hea
+0001a100: 6465 7229 0a20 2020 2020 2020 2020 2020  der).           
+0001a110: 2072 6574 7572 6e20 5472 7565 2c20 2252   return True, "R
+0001a120: 6573 756c 7420 6669 6c65 2065 7869 7374  esult file exist
+0001a130: 7322 0a0a 2020 2020 2020 2020 696d 6167  s"..        imag
+0001a140: 6573 496e 5261 7720 3d20 7365 6c66 2e69  esInRaw = self.i
+0001a150: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+0001a160: 536f 7274 6564 4c69 7374 2829 0a20 2020  SortedList().   
+0001a170: 2020 2020 2069 6620 6c65 6e28 696d 6167       if len(imag
+0001a180: 6573 496e 5261 7729 203e 2030 3a0a 0a20  esInRaw) > 0:.. 
+0001a190: 2020 2020 2020 2020 2020 206f 203d 206f             o = o
+0001a1a0: 7065 6e28 696e 745f 6163 7175 6973 6974  pen(int_acquisit
+0001a1b0: 696f 6e53 6574 7469 6e67 5f66 696c 652c  ionSetting_file,
+0001a1c0: 2022 7722 290a 2020 2020 2020 2020 2020   "w").          
+0001a1d0: 2020 6f2e 7772 6974 6528 6d69 7174 762e    o.write(miqtv.
+0001a1e0: 636f 6c5f 6865 6164 6572 5b27 6d61 7269  col_header['mari
+0001a1f0: 7174 275d 5b27 696d 6727 5d20 2b20 225c  qt']['img'] + "\
+0001a200: 7422 2b6d 6971 7476 2e63 6f6c 5f68 6561  t"+miqtv.col_hea
+0001a210: 6465 725b 276d 6172 6971 7427 5d5b 2761  der['mariqt']['a
+0001a220: 6371 7569 275d 2b22 5c6e 2229 0a20 0a20  cqui']+"\n"). . 
+0001a230: 2020 2020 2020 2020 2020 2069 6d61 6765             image
+0001a240: 7345 7869 6673 203d 206d 6971 7469 2e67  sExifs = miqti.g
+0001a250: 6574 496d 6167 6573 416c 6c45 7869 6656  etImagesAllExifV
+0001a260: 616c 7565 7328 696d 6167 6573 496e 5261  alues(imagesInRa
+0001a270: 772c 7365 6c66 2e70 726f 7629 0a20 2020  w,self.prov).   
+0001a280: 2020 2020 2020 2020 2066 6f72 2066 696c           for fil
+0001a290: 6520 696e 2069 6d61 6765 7345 7869 6673  e in imagesExifs
+0001a2a0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001a2b0: 2020 6669 6c65 5f6e 616d 6520 3d20 6f73    file_name = os
+0001a2c0: 2e70 6174 682e 6261 7365 6e61 6d65 2866  .path.basename(f
+0001a2d0: 696c 6529 0a20 2020 2020 2020 2020 2020  ile).           
+0001a2e0: 2020 2020 206f 2e77 7269 7465 2866 696c       o.write(fil
+0001a2f0: 655f 6e61 6d65 2b22 5c74 222b 7374 7228  e_name+"\t"+str(
+0001a300: 696d 6167 6573 4578 6966 735b 6669 6c65  imagesExifs[file
+0001a310: 5d29 2b22 5c6e 2229 0a0a 2020 2020 2020  ])+"\n")..      
+0001a320: 2020 2020 2020 6f2e 636c 6f73 6528 290a        o.close().
+0001a330: 0a20 2020 2020 2020 2020 2020 2073 656c  .            sel
+0001a340: 662e 6164 645f 6974 656d 5f69 6e66 6f5f  f.add_item_info_
+0001a350: 7461 625f 6669 6c65 2869 6e74 5f61 6371  tab_file(int_acq
+0001a360: 7569 7369 7469 6f6e 5365 7474 696e 675f  uisitionSetting_
+0001a370: 6669 6c65 2c22 5c74 222c 6865 6164 6572  file,"\t",header
+0001a380: 290a 2020 2020 2020 2020 2020 2020 7265  ).            re
+0001a390: 7475 726e 2054 7275 652c 2022 4372 6561  turn True, "Crea
+0001a3a0: 7465 6420 6163 7175 6973 6974 696f 6e20  ted acquisition 
+0001a3b0: 7365 7474 696e 6773 2066 696c 6522 0a20  settings file". 
+0001a3c0: 2020 2020 2020 2065 6c73 653a 0a20 2020         else:.   
+0001a3d0: 2020 2020 2020 2020 2072 6574 7572 6e20           return 
+0001a3e0: 4661 6c73 652c 2022 4e6f 2069 6d61 6765  False, "No image
+0001a3f0: 7320 666f 756e 6422 0a0a 0a20 2020 2064  s found"...    d
+0001a400: 6566 2069 6d61 6765 7349 6e49 6d61 6765  ef imagesInImage
+0001a410: 7344 6972 2873 656c 6629 3a0a 2020 2020  sDir(self):.    
+0001a420: 2020 2020 7265 7475 726e 2063 6f70 792e      return copy.
+0001a430: 6465 6570 636f 7079 2873 656c 662e 5f69  deepcopy(self._i
+0001a440: 6d61 6765 7349 6e49 6d61 6765 7344 6972  magesInImagesDir
+0001a450: 290a 0a20 2020 2064 6566 2069 6d61 6765  )..    def image
+0001a460: 7349 6e49 6d61 6765 7344 6972 536f 7274  sInImagesDirSort
+0001a470: 6564 4c69 7374 2873 656c 6629 3a0a 2020  edList(self):.  
+0001a480: 2020 2020 2020 7265 7475 726e 2063 6f70        return cop
+0001a490: 792e 6465 6570 636f 7079 2873 656c 662e  y.deepcopy(self.
+0001a4a0: 5f69 6d61 6765 7349 6e49 6d61 6765 7344  _imagesInImagesD
+0001a4b0: 6972 536f 7274 6564 4c69 7374 290a 0a0a  irSortedList)...
+0001a4c0: 2020 2020 6465 6620 7061 7273 6549 7465      def parseIte
+0001a4d0: 6d44 6174 6166 726f 6d54 6162 4669 6c65  mDatafromTabFile
+0001a4e0: 4461 7461 2873 656c 662c 2069 7465 6d73  Data(self, items
+0001a4f0: 3a20 6469 6374 2c20 6669 6c65 3a20 7374  : dict, file: st
+0001a500: 722c 2063 6f6c 733a 206c 6973 742c 206f  r, cols: list, o
+0001a510: 7074 696f 6e61 6c3a 206c 6973 7420 3d20  ptional: list = 
+0001a520: 5b5d 2c20 6461 7465 7469 6d65 5f66 6f72  [], datetime_for
+0001a530: 6d61 743a 7374 723d 6d69 7174 762e 6461  mat:str=miqtv.da
+0001a540: 7465 5f66 6f72 6d61 7473 5b27 6d61 7269  te_formats['mari
+0001a550: 7174 275d 293a 0a20 2020 2020 2020 2022  qt']):.        "
+0001a560: 2222 2070 6172 7365 7320 6461 7461 2066  "" parses data f
+0001a570: 726f 6d20 636f 6c75 6d6e 7320 696e 2063  rom columns in c
+0001a580: 6f6c 7320 616e 6420 7772 6974 6573 2069  ols and writes i
+0001a590: 6e66 6f20 746f 2069 7465 6d73 2e20 436f  nfo to items. Co
+0001a5a0: 6c75 6d6e 2027 696d 6167 652d 6669 6c65  lumn 'image-file
+0001a5b0: 6e61 6d65 2720 6d75 7374 2062 6520 696e  name' must be in
+0001a5c0: 2066 696c 6520 616e 6420 646f 6573 206e   file and does n
+0001a5d0: 6f74 206e 6565 6420 746f 2062 6520 7061  ot need to be pa
+0001a5e0: 7373 6564 2069 6e20 636f 6c73 2e20 0a20  ssed in cols. . 
+0001a5f0: 2020 2020 2020 2020 2020 2046 696c 6520             File 
+0001a600: 6d75 7374 2062 6520 7461 6220 7365 7061  must be tab sepa
+0001a610: 7261 7465 6420 616e 6420 636f 6c75 6d6e  rated and column
+0001a620: 7320 6e61 6d65 7320 6d75 7374 2065 7175  s names must equ
+0001a630: 616c 2069 7465 6d20 6669 656c 6420 6e61  al item field na
+0001a640: 6d65 7322 2222 0a20 2020 2020 2020 2074  mes""".        t
+0001a650: 6d70 5f64 6174 6120 3d20 6d69 7174 662e  mp_data = miqtf.
+0001a660: 7461 6246 696c 6544 6174 6128 6669 6c65  tabFileData(file
+0001a670: 2c20 636f 6c73 2b5b 2769 6d61 6765 2d66  , cols+['image-f
+0001a680: 696c 656e 616d 6527 5d2b 6f70 7469 6f6e  ilename']+option
+0001a690: 616c 2c20 6b65 795f 636f 6c3d 2769 6d61  al, key_col='ima
+0001a6a0: 6765 2d66 696c 656e 616d 6527 2c20 6f70  ge-filename', op
+0001a6b0: 7469 6f6e 616c 3d6f 7074 696f 6e61 6c2c  tional=optional,
+0001a6c0: 636f 6e76 6572 743d 5472 7565 290a 2020  convert=True).  
+0001a6d0: 2020 2020 2020 7365 6c66 2e77 7269 7465        self.write
+0001a6e0: 5061 7273 6564 4461 7461 546f 4974 656d  ParsedDataToItem
+0001a6f0: 7328 746d 705f 6461 7461 2c69 7465 6d73  s(tmp_data,items
+0001a700: 2c73 656c 662e 6966 646f 5f74 6d70 5b6d  ,self.ifdo_tmp[m
+0001a710: 6971 7476 2e69 6d61 6765 5f73 6574 5f68  iqtv.image_set_h
+0001a720: 6561 6465 725f 6b65 795d 2c20 6461 7465  eader_key], date
+0001a730: 7469 6d65 5f66 6f72 6d61 743d 6461 7465  time_format=date
+0001a740: 7469 6d65 5f66 6f72 6d61 7429 0a0a 0a20  time_format)... 
+0001a750: 2020 2064 6566 2070 7261 7365 4974 656d     def praseItem
+0001a760: 4461 7461 4672 6f6d 4669 6c65 2873 656c  DataFromFile(sel
+0001a770: 662c 6974 656d 733a 6469 6374 2c66 696c  f,items:dict,fil
+0001a780: 653a 7374 722c 7365 7061 7261 746f 723a  e:str,separator:
+0001a790: 7374 722c 6865 6164 6572 3a64 6963 742c  str,header:dict,
+0001a7a0: 2064 6174 6574 696d 655f 666f 726d 6174   datetime_format
+0001a7b0: 3a73 7472 3d6d 6971 7476 2e64 6174 655f  :str=miqtv.date_
+0001a7c0: 666f 726d 6174 735b 276d 6172 6971 7427  formats['mariqt'
+0001a7d0: 5d29 3a0a 2020 2020 2020 2020 2222 2220  ]):.        """ 
+0001a7e0: 7061 7273 6573 2064 6174 6120 6672 6f6d  parses data from
+0001a7f0: 2066 726f 6d20 6669 6c65 2074 6f20 6974   from file to it
+0001a800: 656d 732e 2068 6561 6465 7220 6469 6374  ems. header dict
+0001a810: 206d 7573 7420 6265 206f 6620 7374 7275   must be of stru
+0001a820: 6374 7572 653a 207b 3c69 7465 6d2d 6669  cture: {<item-fi
+0001a830: 656c 642d 6e61 6d65 3e3a 3c63 6f6c 756d  eld-name>:<colum
+0001a840: 6e2d 6e61 6d65 3e7d 0a20 2020 2020 2020  n-name>}.       
+0001a850: 2020 2020 2061 6e64 206d 7573 7420 636f       and must co
+0001a860: 6e74 6169 6e20 656e 7472 7920 2769 6d61  ntain entry 'ima
+0001a870: 6765 2d66 696c 656e 616d 6527 2022 2222  ge-filename' """
+0001a880: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001a890: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0001a8a0: 2069 6e20 6865 6164 6572 3a0a 2020 2020   in header:.    
+0001a8b0: 2020 2020 2020 2020 7261 6973 6520 4578          raise Ex
+0001a8c0: 6365 7074 696f 6e28 2268 6561 6465 7220  ception("header 
+0001a8d0: 646f 6573 206e 6f74 2063 6f6e 7461 696e  does not contain
+0001a8e0: 2027 696d 6167 652d 6669 6c65 6e61 6d65   'image-filename
+0001a8f0: 2722 290a 2020 2020 2020 2020 0a20 2020  '").        .   
+0001a900: 2020 2020 2074 6d70 5f64 6174 6120 3d20       tmp_data = 
+0001a910: 6d69 7174 662e 7461 6246 696c 6544 6174  miqtf.tabFileDat
+0001a920: 6128 6669 6c65 2c20 6865 6164 6572 2c63  a(file, header,c
+0001a930: 6f6c 5f73 6570 6172 6174 6f72 3d73 6570  ol_separator=sep
+0001a940: 6172 6174 6f72 2c20 6b65 795f 636f 6c3d  arator, key_col=
+0001a950: 2769 6d61 6765 2d66 696c 656e 616d 6527  'image-filename'
+0001a960: 2c63 6f6e 7665 7274 3d54 7275 6529 0a20  ,convert=True). 
+0001a970: 2020 2020 2020 2073 656c 662e 7772 6974         self.writ
+0001a980: 6550 6172 7365 6444 6174 6154 6f49 7465  eParsedDataToIte
+0001a990: 6d73 2874 6d70 5f64 6174 612c 6974 656d  ms(tmp_data,item
+0001a9a0: 732c 7365 6c66 2e69 6664 6f5f 746d 705b  s,self.ifdo_tmp[
+0001a9b0: 6d69 7174 762e 696d 6167 655f 7365 745f  miqtv.image_set_
+0001a9c0: 6865 6164 6572 5f6b 6579 5d2c 2064 6174  header_key], dat
+0001a9d0: 6574 696d 655f 666f 726d 6174 3d64 6174  etime_format=dat
+0001a9e0: 6574 696d 655f 666f 726d 6174 290a 0a0a  etime_format)...
+0001a9f0: 2020 2020 6465 6620 7772 6974 6550 6172      def writePar
+0001aa00: 7365 6444 6174 6154 6f49 7465 6d73 2873  sedDataToItems(s
+0001aa10: 656c 662c 6461 7461 3a64 6963 742c 6974  elf,data:dict,it
+0001aa20: 656d 733a 6469 6374 2c68 6561 6465 723a  ems:dict,header:
+0001aa30: 6469 6374 2c20 6461 7465 7469 6d65 5f66  dict, datetime_f
+0001aa40: 6f72 6d61 743a 7374 723d 6d69 7174 762e  ormat:str=miqtv.
+0001aa50: 6461 7465 5f66 6f72 6d61 7473 5b27 6d61  date_formats['ma
+0001aa60: 7269 7174 275d 293a 0a0a 2020 2020 2020  riqt']):..      
+0001aa70: 2020 2320 6576 616c 2073 7472 696e 6773    # eval strings
+0001aa80: 2061 7320 6469 6374 206f 7220 6c69 7374   as dict or list
+0001aa90: 0a20 2020 2020 2020 206d 6971 7463 2e72  .        miqtc.r
+0001aaa0: 6563 7572 7369 7665 4576 616c 2864 6174  ecursiveEval(dat
+0001aab0: 6129 0a0a 2020 2020 2020 2020 6461 7461  a)..        data
+0001aac0: 203d 206d 6971 7463 2e72 6563 7572 7369   = miqtc.recursi
+0001aad0: 7665 6c79 5265 6d6f 7665 456d 7074 7946  velyRemoveEmptyF
+0001aae0: 6965 6c64 7328 6461 7461 2c63 6f6e 7465  ields(data,conte
+0001aaf0: 6e74 3262 6552 656d 6f76 6564 3d4e 6f6e  nt2beRemoved=Non
+0001ab00: 6529 0a0a 2020 2020 2020 2020 2320 706f  e)..        # po
+0001ab10: 7465 6e74 6169 6c6c 7920 7265 6d6f 7665  tentailly remove
+0001ab20: 2063 6f6e 7374 2064 6174 6120 6672 6f6d   const data from
+0001ab30: 2069 7465 6d73 2061 6e64 2070 7574 2069   items and put i
+0001ab40: 6e20 6865 6164 6572 0a20 2020 2020 2020  n header.       
+0001ab50: 2073 656c 662e 6578 7472 6163 7443 6f6e   self.extractCon
+0001ab60: 7374 4461 7461 5661 6c75 6573 2864 6174  stDataValues(dat
+0001ab70: 612c 6865 6164 6572 290a 0a20 2020 2020  a,header)..     
+0001ab80: 2020 2023 2061 6464 2027 696d 6167 652d     # add 'image-
+0001ab90: 6669 6c65 6e61 6d65 2720 6669 656c 640a  filename' field.
+0001aba0: 2020 2020 2020 2020 666f 7220 696d 672c          for img,
+0001abb0: 2065 6e74 7279 2069 6e20 6461 7461 2e69   entry in data.i
+0001abc0: 7465 6d73 2829 3a0a 0a20 2020 2020 2020  tems():..       
+0001abd0: 2020 2020 2023 206c 6973 740a 2020 2020       # list.    
+0001abe0: 2020 2020 2020 2020 6966 2069 7369 6e73          if isins
+0001abf0: 7461 6e63 6528 656e 7472 792c 6c69 7374  tance(entry,list
+0001ac00: 293a 0a20 2020 2020 2020 2020 2020 2020  ):.             
+0001ac10: 2020 2066 6f72 206c 6973 7449 7465 6d20     for listItem 
+0001ac20: 696e 2065 6e74 7279 3a0a 2020 2020 2020  in entry:.      
+0001ac30: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0001ac40: 7374 4974 656d 5b27 696d 6167 652d 6669  stItem['image-fi
+0001ac50: 6c65 6e61 6d65 275d 203d 2069 6d67 0a20  lename'] = img. 
+0001ac60: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001ac70: 2020 2023 2063 6f76 6572 7420 6461 7465     # covert date
+0001ac80: 7469 6d65 2073 7472 696e 670a 2020 2020  time string.    
+0001ac90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001aca0: 6966 2027 696d 6167 652d 6461 7465 7469  if 'image-dateti
+0001acb0: 6d65 2720 696e 206c 6973 7449 7465 6d3a  me' in listItem:
+0001acc0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001acd0: 2020 2020 2020 2020 2064 7420 3d20 6461           dt = da
+0001ace0: 7465 7469 6d65 2e64 6174 6574 696d 652e  tetime.datetime.
+0001acf0: 7374 7270 7469 6d65 286c 6973 7449 7465  strptime(listIte
+0001ad00: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001ad10: 6527 5d2c 2064 6174 6574 696d 655f 666f  e'], datetime_fo
+0001ad20: 726d 6174 290a 2020 2020 2020 2020 2020  rmat).          
+0001ad30: 2020 2020 2020 2020 2020 2020 2020 6c69                li
+0001ad40: 7374 4974 656d 5b27 696d 6167 652d 6461  stItem['image-da
+0001ad50: 7465 7469 6d65 275d 203d 2064 742e 7374  tetime'] = dt.st
+0001ad60: 7266 7469 6d65 286d 6971 7476 2e64 6174  rftime(miqtv.dat
+0001ad70: 655f 666f 726d 6174 735b 276d 6172 6971  e_formats['mariq
+0001ad80: 7427 5d29 0a20 2020 2020 2020 2020 2020  t']).           
+0001ad90: 2065 6c69 6620 6973 696e 7374 616e 6365   elif isinstance
+0001ada0: 2865 6e74 7279 2c64 6963 7429 3a0a 2020  (entry,dict):.  
+0001adb0: 2020 2020 2020 2020 2020 2020 2020 656e                en
+0001adc0: 7472 795b 2769 6d61 6765 2d66 696c 656e  try['image-filen
+0001add0: 616d 6527 5d20 3d20 696d 670a 2020 2020  ame'] = img.    
+0001ade0: 2020 2020 2020 2020 2020 2020 2320 636f              # co
+0001adf0: 7665 7274 2064 6174 6574 696d 6520 7374  vert datetime st
+0001ae00: 7269 6e67 0a20 2020 2020 2020 2020 2020  ring.           
+0001ae10: 2020 2020 2069 6620 2769 6d61 6765 2d64       if 'image-d
+0001ae20: 6174 6574 696d 6527 2069 6e20 656e 7472  atetime' in entr
+0001ae30: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001ae40: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
+0001ae50: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001ae60: 7270 7469 6d65 2865 6e74 7279 5b27 696d  rptime(entry['im
+0001ae70: 6167 652d 6461 7465 7469 6d65 275d 2c20  age-datetime'], 
+0001ae80: 6461 7465 7469 6d65 5f66 6f72 6d61 7429  datetime_format)
+0001ae90: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001aea0: 2020 2020 2065 6e74 7279 5b27 696d 6167       entry['imag
+0001aeb0: 652d 6461 7465 7469 6d65 275d 203d 2064  e-datetime'] = d
+0001aec0: 742e 7374 7266 7469 6d65 286d 6971 7476  t.strftime(miqtv
+0001aed0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+0001aee0: 6172 6971 7427 5d29 0a20 2020 2020 2020  ariqt']).       
+0001aef0: 2020 2020 2065 6c73 653a 0a20 2020 2020       else:.     
+0001af00: 2020 2020 2020 2020 2020 2072 6169 7365             raise
+0001af10: 206d 6971 7463 2e49 6664 6f45 7863 6570   miqtc.IfdoExcep
+0001af20: 7469 6f6e 2822 6461 7461 2065 6e74 7269  tion("data entri
+0001af30: 6573 206d 7573 7420 6265 2064 6963 7420  es must be dict 
+0001af40: 6f72 206c 6973 7420 6966 2064 6963 7473  or list if dicts
+0001af50: 2229 0a0a 2020 2020 2020 2020 6d69 7174  ")..        miqt
+0001af60: 632e 7265 6375 7273 6976 656c 7955 7064  c.recursivelyUpd
+0001af70: 6174 6544 6963 7473 2869 7465 6d73 2c64  ateDicts(items,d
+0001af80: 6174 6129 0a0a 0a20 2020 2040 7374 6174  ata)...    @stat
+0001af90: 6963 6d65 7468 6f64 0a20 2020 2064 6566  icmethod.    def
+0001afa0: 2065 7874 7261 6374 436f 6e73 7444 6174   extractConstDat
+0001afb0: 6156 616c 7565 7328 6461 7461 3a64 6963  aValues(data:dic
+0001afc0: 742c 6865 6164 6572 3a64 6963 7429 3a0a  t,header:dict):.
+0001afd0: 2020 2020 2020 2020 2222 2220 5265 6d6f          """ Remo
+0001afe0: 7665 7320 6669 656c 6473 2074 6861 7420  ves fields that 
+0001aff0: 6172 6520 636f 6e73 7461 6e74 2066 6f72  are constant for
+0001b000: 2061 6c6c 2065 6e74 7269 6573 2066 726f   all entries fro
+0001b010: 6d20 6461 7461 2064 6963 7420 616e 6420  m data dict and 
+0001b020: 7075 7420 7468 656d 2069 6e20 6865 6164  put them in head
+0001b030: 6572 2064 6963 742e 200a 2020 2020 2020  er dict. .      
+0001b040: 2020 2020 2020 4561 6368 2065 6e74 7279        Each entry
+0001b050: 206f 6620 6461 7461 206d 7573 7420 6265   of data must be
+0001b060: 2061 2064 6963 7420 7769 7468 2074 6865   a dict with the
+0001b070: 2073 616d 6520 7365 7420 6f66 206b 6579   same set of key
+0001b080: 732e 2022 2222 0a20 2020 200a 2020 2020  s. """.    .    
+0001b090: 2020 2020 6669 656c 6473 546f 4967 6e6f      fieldsToIgno
+0001b0a0: 7265 203d 205b 2769 6d61 6765 2d64 6174  re = ['image-dat
+0001b0b0: 6574 696d 6527 5d0a 2020 2020 2020 2020  etime'].        
+0001b0c0: 636f 6e73 7444 6174 6120 3d20 7b7d 0a20  constData = {}. 
+0001b0d0: 2020 2020 2020 2066 6972 7374 496d 6167         firstImag
+0001b0e0: 6520 3d20 5472 7565 0a20 2020 2020 2020  e = True.       
+0001b0f0: 2066 6f72 2069 6d61 6765 2c69 6d61 6765   for image,image
+0001b100: 5f64 6174 6120 696e 2064 6174 612e 6974  _data in data.it
+0001b110: 656d 7328 293a 0a20 2020 2020 2020 2020  ems():.         
+0001b120: 2020 200a 2020 2020 2020 2020 2020 2020     .            
+0001b130: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+0001b140: 6528 696d 6167 655f 6461 7461 2c6c 6973  e(image_data,lis
+0001b150: 7429 3a0a 2020 2020 2020 2020 2020 2020  t):.            
+0001b160: 2020 2020 696d 6167 655f 6461 7461 203d      image_data =
+0001b170: 205b 696d 6167 655f 6461 7461 5d0a 0a20   [image_data].. 
+0001b180: 2020 2020 2020 2020 2020 2069 6620 6e6f             if no
+0001b190: 7420 6669 7273 7449 6d61 6765 2061 6e64  t firstImage and
+0001b1a0: 2063 6f6e 7374 4461 7461 203d 3d20 7b7d   constData == {}
+0001b1b0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001b1c0: 2020 6272 6561 6b0a 2020 2020 2020 2020    break.        
+0001b1d0: 2020 2020 0a20 2020 2020 2020 2020 2020      .           
+0001b1e0: 2066 6972 7374 5469 6d65 506f 696e 7420   firstTimePoint 
+0001b1f0: 3d20 5472 7565 0a20 2020 2020 2020 2020  = True.         
+0001b200: 2020 2066 6f72 2069 6d61 6765 5f74 705f     for image_tp_
+0001b210: 6461 7461 2069 6e20 696d 6167 655f 6461  data in image_da
+0001b220: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0001b230: 2020 2020 2320 7665 7279 2066 6972 7374      # very first
+0001b240: 2064 6174 6120 666f 7220 636f 6d70 6172   data for compar
+0001b250: 6973 6f6e 0a20 2020 2020 2020 2020 2020  ison.           
+0001b260: 2020 2020 2069 6620 6669 7273 7449 6d61       if firstIma
+0001b270: 6765 2061 6e64 2066 6972 7374 5469 6d65  ge and firstTime
+0001b280: 506f 696e 743a 0a20 2020 2020 2020 2020  Point:.         
+0001b290: 2020 2020 2020 2020 2020 2063 6f6e 7374             const
+0001b2a0: 4461 7461 203d 2063 6f70 792e 6465 6570  Data = copy.deep
+0001b2b0: 636f 7079 2869 6d61 6765 5f74 705f 6461  copy(image_tp_da
+0001b2c0: 7461 290a 2020 2020 2020 2020 2020 2020  ta).            
+0001b2d0: 2020 2020 2020 2020 666f 7220 6669 656c          for fiel
+0001b2e0: 6420 696e 2066 6965 6c64 7354 6f49 676e  d in fieldsToIgn
+0001b2f0: 6f72 653a 0a20 2020 2020 2020 2020 2020  ore:.           
+0001b300: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b310: 6669 656c 6420 696e 2063 6f6e 7374 4461  field in constDa
+0001b320: 7461 3a0a 2020 2020 2020 2020 2020 2020  ta:.            
+0001b330: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b340: 6465 6c20 636f 6e73 7444 6174 615b 6669  del constData[fi
+0001b350: 656c 645d 0a20 2020 2020 2020 2020 2020  eld].           
+0001b360: 2020 2020 2020 2020 2066 6972 7374 5469           firstTi
+0001b370: 6d65 506f 696e 7420 3d20 4661 6c73 650a  mePoint = False.
+0001b380: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b390: 2020 2020 636f 6e74 696e 7565 0a0a 2020      continue..  
+0001b3a0: 2020 2020 2020 2020 2020 2020 2020 636f                co
+0001b3b0: 6e73 7444 6174 6120 3d20 6d69 7174 632e  nstData = miqtc.
+0001b3c0: 6669 6e64 436f 6d6d 6f6e 4469 6374 456c  findCommonDictEl
+0001b3d0: 656d 656e 7473 2869 6d61 6765 5f74 705f  ements(image_tp_
+0001b3e0: 6461 7461 2c63 6f6e 7374 4461 7461 290a  data,constData).
+0001b3f0: 0a20 2020 2020 2020 2020 2020 2066 6972  .            fir
+0001b400: 7374 496d 6167 6520 3d20 4661 6c73 650a  stImage = False.
+0001b410: 0a20 2020 2020 2020 2023 2054 4f44 4f20  .        # TODO 
+0001b420: 6368 6563 6b20 7769 7468 696e 2069 6d61  check within ima
+0001b430: 6765 2074 696d 6573 202d 3e20 746f 2069  ge times -> to i
+0001b440: 6d61 6765 2064 6566 6175 6c74 2e20 2874  mage default. (t
+0001b450: 7269 636b 7920 7369 6e63 6520 7765 2064  ricky since we d
+0001b460: 6f6e 2774 2068 6176 6520 7468 6520 6461  on't have the da
+0001b470: 6661 756c 7420 696e 6465 7820 6865 7265  fault index here
+0001b480: 2e20 4f6e 6c79 2061 2073 7562 7365 7420  . Only a subset 
+0001b490: 6d69 6768 7420 6265 2075 7064 6174 6520  might be update 
+0001b4a0: 6865 7265 290a 2020 2020 2020 2020 2320  here).        # 
+0001b4b0: 6368 6563 6b20 7769 7468 696e 2069 6d61  check within ima
+0001b4c0: 6765 2069 7465 6d73 202d 3e20 6865 6164  ge items -> head
+0001b4d0: 6572 0a20 2020 2020 2020 2068 6561 6465  er.        heade
+0001b4e0: 7255 7064 6174 6520 3d20 636f 7079 2e64  rUpdate = copy.d
+0001b4f0: 6565 7063 6f70 7928 636f 6e73 7444 6174  eepcopy(constDat
+0001b500: 6129 0a20 2020 2020 2020 2068 6561 6465  a).        heade
+0001b510: 7255 7064 6174 6564 5465 7374 203d 2063  rUpdatedTest = c
+0001b520: 6f70 792e 6465 6570 636f 7079 2868 6561  opy.deepcopy(hea
+0001b530: 6465 7229 0a20 2020 2020 2020 206d 6971  der).        miq
+0001b540: 7463 2e72 6563 7572 7369 7665 6c79 5570  tc.recursivelyUp
+0001b550: 6461 7465 4469 6374 7328 6865 6164 6572  dateDicts(header
+0001b560: 5570 6461 7465 6454 6573 742c 6865 6164  UpdatedTest,head
+0001b570: 6572 5570 6461 7465 290a 2020 2020 2020  erUpdate).      
+0001b580: 2020 7570 6461 7465 4469 6666 203d 2044    updateDiff = D
+0001b590: 6565 7044 6966 6628 6865 6164 6572 2c68  eepDiff(header,h
+0001b5a0: 6561 6465 7255 7064 6174 6564 5465 7374  eaderUpdatedTest
+0001b5b0: 290a 2020 2020 2020 2020 2320 6368 6563  ).        # chec
+0001b5c0: 6b20 6966 2068 6561 6465 7255 7064 6174  k if headerUpdat
+0001b5d0: 6520 776f 756c 6420 6f76 6572 7772 6974  e would overwrit
+0001b5e0: 6520 616e 7974 6869 6e67 2066 726f 6d20  e anything from 
+0001b5f0: 6375 7272 656e 7420 6865 6164 6572 2028  current header (
+0001b600: 7368 6f75 6c64 206e 6f74 2068 6170 7065  should not happe
+0001b610: 6e29 2c20 6966 2073 6f20 646f 6e74 2072  n), if so dont r
+0001b620: 656d 6f76 6520 6672 6f6d 2069 7465 6d73  emove from items
+0001b630: 0a20 2020 2020 2020 2069 6620 6e6f 7420  .        if not 
+0001b640: 2776 616c 7565 735f 6368 616e 6765 6427  'values_changed'
+0001b650: 2069 6e20 7570 6461 7465 4469 6666 2061   in updateDiff a
+0001b660: 6e64 206e 6f74 2027 7479 7065 5f63 6861  nd not 'type_cha
+0001b670: 6e67 6573 2720 696e 2075 7064 6174 6544  nges' in updateD
+0001b680: 6966 6620 616e 6420 6e6f 7420 2764 6963  iff and not 'dic
+0001b690: 7469 6f6e 6172 795f 6974 656d 5f72 656d  tionary_item_rem
+0001b6a0: 6f76 6564 2720 696e 2075 7064 6174 6544  oved' in updateD
+0001b6b0: 6966 663a 0a20 2020 2020 2020 2020 2020  iff:.           
+0001b6c0: 2068 6561 6465 722e 636c 6561 7228 290a   header.clear().
+0001b6d0: 2020 2020 2020 2020 2020 2020 6865 6164              head
+0001b6e0: 6572 2e75 7064 6174 6528 6865 6164 6572  er.update(header
+0001b6f0: 5570 6461 7465 6454 6573 7429 0a0a 2020  UpdatedTest)..  
+0001b700: 2020 2020 2020 2020 2020 2320 7265 6d6f            # remo
+0001b710: 7665 2063 6f6e 7374 2076 616c 7565 7320  ve const values 
+0001b720: 6672 6f6d 2064 6174 610a 2020 2020 2020  from data.      
+0001b730: 2020 2020 2020 6d69 7174 632e 7265 6375        miqtc.recu
+0001b740: 7273 6976 654d 616b 654e 6f6e 6544 6963  rsiveMakeNoneDic
+0001b750: 7446 6965 6c64 7345 6d70 7479 5374 7228  tFieldsEmptyStr(
+0001b760: 636f 6e73 7444 6174 6129 0a20 2020 2020  constData).     
+0001b770: 2020 2020 2020 2066 6f72 2069 6d61 6765         for image
+0001b780: 2c69 6d61 6765 5f64 6174 6120 696e 2064  ,image_data in d
+0001b790: 6174 612e 6974 656d 7328 293a 0a20 2020  ata.items():.   
+0001b7a0: 2020 2020 2020 2020 2020 2020 2069 6620               if 
+0001b7b0: 6e6f 7420 6973 696e 7374 616e 6365 2869  not isinstance(i
+0001b7c0: 6d61 6765 5f64 6174 612c 6c69 7374 293a  mage_data,list):
+0001b7d0: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001b7e0: 2020 2020 2069 6d61 6765 5f64 6174 6120       image_data 
+0001b7f0: 3d20 5b69 6d61 6765 5f64 6174 615d 0a20  = [image_data]. 
+0001b800: 2020 2020 2020 2020 2020 2020 2020 2066                 f
+0001b810: 6f72 2069 6d61 6765 5f74 705f 6461 7461  or image_tp_data
+0001b820: 2069 6e20 696d 6167 655f 6461 7461 3a0a   in image_data:.
+0001b830: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001b840: 2020 2020 6d69 7174 632e 7265 6375 7273      miqtc.recurs
+0001b850: 6976 656c 7955 7064 6174 6544 6963 7473  ivelyUpdateDicts
+0001b860: 2869 6d61 6765 5f74 705f 6461 7461 2c63  (image_tp_data,c
+0001b870: 6f6e 7374 4461 7461 2920 2020 2020 2020  onstData)       
+0001b880: 2020 200a 0a20 2020 2020 2020 2065 6c73     ..        els
+0001b890: 653a 0a20 2020 2020 2020 2020 2020 2070  e:.            p
+0001b8a0: 6173 730a 2020 2020 2020 2020 2020 2020  ass.            
+0001b8b0: 2320 544f 444f 206c 6f67 3f0a 2020 2020  # TODO log?.    
+0001b8c0: 200a 0a20 2020 2064 6566 2069 6e74 6572   ..    def inter
+0001b8d0: 6d65 6469 6174 654e 6176 4669 6c65 4578  mediateNavFileEx
+0001b8e0: 6973 7473 2873 656c 6629 3a0a 2020 2020  ists(self):.    
+0001b8f0: 2020 2020 6966 206f 732e 7061 7468 2e65      if os.path.e
+0001b900: 7869 7374 7328 7365 6c66 2e67 6574 5f69  xists(self.get_i
+0001b910: 6e74 5f6e 6176 5f66 696c 6528 2929 3a0a  nt_nav_file()):.
+0001b920: 2020 2020 2020 2020 2020 2020 7265 7475              retu
+0001b930: 726e 2054 7275 650a 2020 2020 2020 2020  rn True.        
+0001b940: 656c 7365 3a0a 2020 2020 2020 2020 2020  else:.          
+0001b950: 2020 7265 7475 726e 2046 616c 7365 0a0a    return False..
+0001b960: 0a20 2020 2064 6566 2068 6561 6465 7246  .    def headerF
+0001b970: 6965 6c64 4669 6c6c 6564 2873 656c 662c  ieldFilled(self,
+0001b980: 6669 656c 643a 7374 7229 3a0a 2020 2020  field:str):.    
+0001b990: 2020 2020 6966 2073 656c 662e 6669 6e64      if self.find
+0001b9a0: 546d 7046 6965 6c64 3228 6669 656c 6429  TmpField2(field)
+0001b9b0: 203d 3d20 2222 3a0a 2020 2020 2020 2020   == "":.        
+0001b9c0: 2020 2020 7265 7475 726e 2046 616c 7365      return False
+0001b9d0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
+0001b9e0: 5472 7565 0a0a 2020 2020 6465 6620 636f  True..    def co
+0001b9f0: 6e76 6572 7454 6f44 6566 6175 6c74 4461  nvertToDefaultDa
+0001ba00: 7465 5469 6d65 466f 726d 6174 2873 656c  teTimeFormat(sel
+0001ba10: 662c 6966 646f 293a 0a20 2020 2020 2020  f,ifdo):.       
+0001ba20: 2022 2222 2043 6865 636b 7320 6966 2061   """ Checks if a
+0001ba30: 6c6c 2069 7465 6d73 2720 2769 6d61 6765  ll items' 'image
+0001ba40: 2d64 6174 6574 696d 6527 2066 6965 6c64  -datetime' field
+0001ba50: 7320 6d61 7463 6820 6465 6661 756c 7420  s match default 
+0001ba60: 6461 7465 7469 6d65 2066 6f72 6d61 7420  datetime format 
+0001ba70: 6f72 2061 2063 7573 746f 6d20 6f6e 6520  or a custom one 
+0001ba80: 6465 6669 6e65 6420 696e 2027 696d 6167  defined in 'imag
+0001ba90: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
+0001baa0: 7427 0a20 2020 2020 2020 2020 2020 2061  t'.            a
+0001bab0: 6e64 2063 6f6e 7665 7274 7320 746f 2064  nd converts to d
+0001bac0: 6566 6175 6c74 2066 6f72 6d61 742e 2054  efault format. T
+0001bad0: 6872 6f77 7320 6578 6365 7074 696f 6e20  hrows exception 
+0001bae0: 6966 2064 6174 6574 696d 6520 6361 6e6e  if datetime cann
+0001baf0: 6f74 2062 6520 7061 7273 6564 2022 2222  ot be parsed """
+0001bb00: 0a20 2020 2020 2020 2063 7573 746f 6d44  .        customD
+0001bb10: 6174 6554 696d 6546 6f72 6d61 7446 6f75  ateTimeFormatFou
+0001bb20: 6e64 203d 2046 616c 7365 0a20 2020 2020  nd = False.     
+0001bb30: 2020 2068 6561 6465 7243 7573 746f 6d44     headerCustomD
+0001bb40: 6174 6554 696d 6546 6f72 6d61 7420 3d20  ateTimeFormat = 
+0001bb50: 6669 6e64 4669 656c 6428 6966 646f 5b73  findField(ifdo[s
+0001bb60: 656c 662e 696d 6167 6553 6574 4865 6164  elf.imageSetHead
+0001bb70: 6572 4b65 795d 2c27 696d 6167 652d 6461  erKey],'image-da
+0001bb80: 7465 7469 6d65 2d66 6f72 6d61 7427 290a  tetime-format').
+0001bb90: 2020 2020 2020 2020 6966 2068 6561 6465          if heade
+0001bba0: 7243 7573 746f 6d44 6174 6554 696d 6546  rCustomDateTimeF
+0001bbb0: 6f72 6d61 7420 213d 2022 223a 0a20 2020  ormat != "":.   
+0001bbc0: 2020 2020 2020 2020 2069 6664 6f5b 7365           ifdo[se
+0001bbd0: 6c66 2e69 6d61 6765 5365 7448 6561 6465  lf.imageSetHeade
+0001bbe0: 724b 6579 5d5b 2769 6d61 6765 2d64 6174  rKey]['image-dat
+0001bbf0: 6574 696d 652d 666f 726d 6174 275d 203d  etime-format'] =
+0001bc00: 2022 2220 2320 7265 6d6f 7665 2063 7573   "" # remove cus
+0001bc10: 746f 6d20 666f 726d 6174 0a20 2020 2020  tom format.     
+0001bc20: 2020 2020 2020 2063 7573 746f 6d44 6174         customDat
+0001bc30: 6554 696d 6546 6f72 6d61 7446 6f75 6e64  eTimeFormatFound
+0001bc40: 203d 2054 7275 650a 2020 2020 2020 2020   = True.        
+0001bc50: 7072 6f67 203d 206d 6971 7463 2e50 7269  prog = miqtc.Pri
+0001bc60: 6e74 4b6e 6f77 6e50 726f 6772 6573 734d  ntKnownProgressM
+0001bc70: 7367 2822 4368 6563 6b69 6e67 2064 6174  sg("Checking dat
+0001bc80: 6574 696d 6520 666f 726d 6174 222c 206c  etime format", l
+0001bc90: 656e 2869 6664 6f5b 7365 6c66 2e69 6d61  en(ifdo[self.ima
+0001bca0: 6765 5365 7449 7465 6d73 4b65 795d 292c  geSetItemsKey]),
+0001bcb0: 6d6f 6475 6c6f 3d31 290a 2020 2020 2020  modulo=1).      
+0001bcc0: 2020 666f 7220 6669 6c65 2c69 7465 6d20    for file,item 
+0001bcd0: 696e 2069 6664 6f5b 7365 6c66 2e69 6d61  in ifdo[self.ima
+0001bce0: 6765 5365 7449 7465 6d73 4b65 795d 2e69  geSetItemsKey].i
+0001bcf0: 7465 6d73 2829 3a0a 2020 2020 2020 2020  tems():.        
+0001bd00: 2020 2020 7072 6f67 2e70 726f 6772 6573      prog.progres
+0001bd10: 7328 290a 2020 2020 2020 2020 2020 2020  s().            
+0001bd20: 6966 206e 6f74 2069 7369 6e73 7461 6e63  if not isinstanc
+0001bd30: 6528 6974 656d 2c6c 6973 7429 3a0a 2020  e(item,list):.  
+0001bd40: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bd50: 2020 6974 656d 203d 205b 6974 656d 5d0a    item = [item].
+0001bd60: 2020 2020 2020 2020 2020 2020 7375 6249              subI
+0001bd70: 7465 6d44 6566 6175 6c74 203d 2069 7465  temDefault = ite
+0001bd80: 6d5b 305d 0a20 2020 2020 2020 2020 2020  m[0].           
+0001bd90: 2069 7465 6d43 7573 746f 6d44 6174 6554   itemCustomDateT
+0001bda0: 696d 6546 6f72 6d61 7420 3d20 2222 0a20  imeFormat = "". 
+0001bdb0: 2020 2020 2020 2020 2020 2069 6620 2769             if 'i
+0001bdc0: 6d61 6765 2d64 6174 6574 696d 652d 666f  mage-datetime-fo
+0001bdd0: 726d 6174 2720 696e 2073 7562 4974 656d  rmat' in subItem
+0001bde0: 4465 6661 756c 743a 0a20 2020 2020 2020  Default:.       
+0001bdf0: 2020 2020 2020 2020 2069 7465 6d43 7573           itemCus
+0001be00: 746f 6d44 6174 6554 696d 6546 6f72 6d61  tomDateTimeForma
+0001be10: 7420 3d20 7375 6249 7465 6d44 6566 6175  t = subItemDefau
+0001be20: 6c74 5b27 696d 6167 652d 6461 7465 7469  lt['image-dateti
+0001be30: 6d65 2d66 6f72 6d61 7427 5d0a 2020 2020  me-format'].    
+0001be40: 2020 2020 2020 2020 2020 2020 7375 6249              subI
+0001be50: 7465 6d44 6566 6175 6c74 5b27 696d 6167  temDefault['imag
+0001be60: 652d 6461 7465 7469 6d65 2d66 6f72 6d61  e-datetime-forma
+0001be70: 7427 5d20 3d20 2222 2023 2072 656d 6f76  t'] = "" # remov
+0001be80: 6520 6375 7374 6f6d 2066 6f72 6d61 740a  e custom format.
+0001be90: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001bea0: 6375 7374 6f6d 4461 7465 5469 6d65 466f  customDateTimeFo
+0001beb0: 726d 6174 466f 756e 6420 3d20 5472 7565  rmatFound = True
+0001bec0: 0a20 2020 2020 2020 2020 2020 2066 6f72  .            for
+0001bed0: 2073 7562 4974 656d 2069 6e20 6974 656d   subItem in item
+0001bee0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001bef0: 2020 7472 793a 0a20 2020 2020 2020 2020    try:.         
+0001bf00: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+0001bf10: 7420 3d20 6d69 7174 762e 6461 7465 5f66  t = miqtv.date_f
+0001bf20: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0001bf30: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001bf40: 2020 2020 2064 6174 6574 696d 652e 6461       datetime.da
+0001bf50: 7465 7469 6d65 2e73 7472 7074 696d 6528  tetime.strptime(
+0001bf60: 7375 6249 7465 6d5b 2769 6d61 6765 2d64  subItem['image-d
+0001bf70: 6174 6574 696d 6527 5d2c 666f 726d 6174  atetime'],format
+0001bf80: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001bf90: 2020 6578 6365 7074 3a0a 2020 2020 2020    except:.      
+0001bfa0: 2020 2020 2020 2020 2020 2020 2020 7472                tr
+0001bfb0: 793a 0a20 2020 2020 2020 2020 2020 2020  y:.             
+0001bfc0: 2020 2020 2020 2020 2020 2066 6f72 6d61             forma
+0001bfd0: 7420 3d20 6865 6164 6572 4375 7374 6f6d  t = headerCustom
+0001bfe0: 4461 7465 5469 6d65 466f 726d 6174 0a20  DateTimeFormat. 
 0001bff0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c000: 2020 2020 2020 2020 2020 2020 7375 6249              subI
-0001c010: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-0001c020: 696d 6527 5d20 3d20 6461 7465 7469 6d65  ime'] = datetime
-0001c030: 2e64 6174 6574 696d 652e 7374 7266 7469  .datetime.strfti
-0001c040: 6d65 2864 742c 6d69 7174 762e 6461 7465  me(dt,miqtv.date
-0001c050: 5f66 6f72 6d61 7473 5b27 6d61 7269 7174  _formats['mariqt
-0001c060: 275d 290a 2020 2020 2020 2020 2020 2020  ']).            
-0001c070: 2020 2020 2020 2020 2020 2020 6578 6365              exce
-0001c080: 7074 3a0a 2020 2020 2020 2020 2020 2020  pt:.            
-0001c090: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0a0: 7072 6f67 2e63 6c65 6172 2829 0a20 2020  prog.clear().   
-0001c0b0: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c0c0: 2020 2020 2020 2020 2072 6169 7365 206d           raise m
-0001c0d0: 6971 7463 2e49 6664 6f45 7863 6570 7469  iqtc.IfdoExcepti
-0001c0e0: 6f6e 2827 496e 7661 6c69 6420 6461 7465  on('Invalid date
-0001c0f0: 7469 6d65 2076 616c 7565 272c 7375 6249  time value',subI
-0001c100: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
-0001c110: 696d 6527 5d2c 2022 646f 6573 206e 6f74  ime'], "does not
-0001c120: 206d 6174 6368 2066 6f72 6d61 7420 6465   match format de
-0001c130: 6661 756c 7420 6f72 2063 7573 746f 6d20  fault or custom 
-0001c140: 666f 726d 6174 2229 0a20 2020 2020 2020  format").       
-0001c150: 2069 6620 6375 7374 6f6d 4461 7465 5469   if customDateTi
-0001c160: 6d65 466f 726d 6174 466f 756e 643a 0a20  meFormatFound:. 
-0001c170: 2020 2020 2020 2020 2020 2073 656c 662e             self.
-0001c180: 7072 6f76 2e6c 6f67 2822 4375 7374 6f6d  prov.log("Custom
-0001c190: 2064 6174 6574 696d 6520 666f 726d 6174   datetime format
-0001c1a0: 7320 666f 756e 642e 2054 6865 7920 7769  s found. They wi
-0001c1b0: 6c6c 2062 6520 7265 706c 6163 6564 2062  ll be replaced b
-0001c1c0: 7920 7468 6520 6465 6661 756c 7420 666f  y the default fo
-0001c1d0: 726d 6174 2e22 2920 2020 0a20 2020 2020  rmat.")   .     
-0001c1e0: 2020 2070 726f 672e 636c 6561 7228 2920     prog.clear() 
-0001c1f0: 2020 200a 0a0a 2020 2020 6465 6620 5f5f     ...    def __
-0001c200: 696e 6974 496e 7465 726d 6564 6961 7465  initIntermediate
-0001c210: 4669 6c65 7328 7365 6c66 293a 0a20 2020  Files(self):.   
-0001c220: 2020 2020 2073 656c 662e 696e 7465 726d       self.interm
-0001c230: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
-0001c240: 6f72 6520 3d20 7b0a 2020 2020 2020 2020  ore = {.        
-0001c250: 2020 2020 2768 6173 6865 7327 3a20 7b0a      'hashes': {.
-0001c260: 2020 2020 2020 2020 2020 2020 2020 2020                  
-0001c270: 2763 7265 6174 696f 6e46 6374 273a 2027  'creationFct': '
-0001c280: 6372 6561 7465 5f69 6d61 6765 5f73 6861  create_image_sha
-0001c290: 3235 365f 6669 6c65 2829 272c 0a20 2020  256_file()',.   
-0001c2a0: 2020 2020 2020 2020 2020 2020 2027 7375               'su
-0001c2b0: 6666 6978 273a 2027 5f69 6d61 6765 2d68  ffix': '_image-h
-0001c2c0: 6173 6865 732e 7478 7427 2c0a 2020 2020  ashes.txt',.    
-0001c2d0: 2020 2020 2020 2020 2020 2020 2763 6f6c              'col
-0001c2e0: 7327 3a20 5b6d 6971 7476 2e63 6f6c 5f68  s': [miqtv.col_h
-0001c2f0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001c300: 2768 6173 6827 5d5d 2c0a 2020 2020 2020  'hash']],.      
-0001c310: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
-0001c320: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
-0001c330: 2020 2020 2020 2027 7575 6964 7327 3a20         'uuids': 
-0001c340: 7b0a 2020 2020 2020 2020 2020 2020 2020  {.              
-0001c350: 2020 2763 7265 6174 696f 6e46 6374 273a    'creationFct':
-0001c360: 2027 6372 6561 7465 5f75 7569 645f 6669   'create_uuid_fi
-0001c370: 6c65 2829 272c 0a20 2020 2020 2020 2020  le()',.         
-0001c380: 2020 2020 2020 2027 7375 6666 6978 273a         'suffix':
-0001c390: 2027 5f69 6d61 6765 2d75 7569 6473 2e74   '_image-uuids.t
-0001c3a0: 7874 272c 0a20 2020 2020 2020 2020 2020  xt',.           
-0001c3b0: 2020 2020 2027 636f 6c73 273a 205b 6d69       'cols': [mi
-0001c3c0: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-0001c3d0: 6d61 7269 7174 275d 5b27 7575 6964 275d  mariqt']['uuid']
-0001c3e0: 5d2c 0a20 2020 2020 2020 2020 2020 2020  ],.             
-0001c3f0: 2020 2027 6f70 7469 6f6e 616c 273a 205b     'optional': [
-0001c400: 5d7d 2c0a 2020 2020 2020 2020 2020 2020  ]},.            
-0001c410: 2764 6174 6574 696d 6527 3a20 7b0a 2020  'datetime': {.  
-0001c420: 2020 2020 2020 2020 2020 2020 2020 2763                'c
-0001c430: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
-0001c440: 6561 7465 5f73 7461 7274 5f74 696d 655f  eate_start_time_
-0001c450: 6669 6c65 2829 272c 0a20 2020 2020 2020  file()',.       
-0001c460: 2020 2020 2020 2020 2027 7375 6666 6978           'suffix
-0001c470: 273a 2027 5f69 6d61 6765 2d73 7461 7274  ': '_image-start
-0001c480: 2d74 696d 6573 2e74 7874 272c 0a20 2020  -times.txt',.   
-0001c490: 2020 2020 2020 2020 2020 2020 2027 636f               'co
-0001c4a0: 6c73 273a 205b 6d69 7174 762e 636f 6c5f  ls': [miqtv.col_
-0001c4b0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
-0001c4c0: 5b27 7574 6327 5d5d 2c0a 2020 2020 2020  ['utc']],.      
-0001c4d0: 2020 2020 2020 2020 2020 276f 7074 696f            'optio
-0001c4e0: 6e61 6c27 3a20 5b5d 7d2c 0a20 2020 2020  nal': []},.     
-0001c4f0: 2020 2020 2020 2027 6e61 7669 6761 7469         'navigati
-0001c500: 6f6e 273a 207b 0a20 2020 2020 2020 2020  on': {.         
-0001c510: 2020 2020 2020 2027 6372 6561 7469 6f6e         'creation
-0001c520: 4663 7427 3a20 2763 7265 6174 655f 696d  Fct': 'create_im
-0001c530: 6167 655f 6e61 7669 6761 7469 6f6e 5f66  age_navigation_f
-0001c540: 696c 6528 2927 2c0a 2020 2020 2020 2020  ile()',.        
-0001c550: 2020 2020 2020 2020 2773 7566 6669 7827          'suffix'
-0001c560: 3a20 275f 696d 6167 652d 6e61 7669 6761  : '_image-naviga
-0001c570: 7469 6f6e 2e74 7874 272c 0a20 2020 2020  tion.txt',.     
-0001c580: 2020 2020 2020 2020 2020 2027 636f 6c73             'cols
-0001c590: 273a 205b 6d69 7174 762e 636f 6c5f 6865  ': [miqtv.col_he
-0001c5a0: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
-0001c5b0: 7574 6327 5d5d 2c0a 2020 2020 2020 2020  utc']],.        
-0001c5c0: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
-0001c5d0: 6c27 3a20 5b6d 6971 7476 2e63 6f6c 5f68  l': [miqtv.col_h
-0001c5e0: 6561 6465 725b 276d 6172 6971 7427 5d5b  eader['mariqt'][
-0001c5f0: 276c 6f6e 275d 2c20 6d69 7174 762e 636f  'lon'], miqtv.co
-0001c600: 6c5f 6865 6164 6572 5b27 6d61 7269 7174  l_header['mariqt
-0001c610: 275d 5b27 6c61 7427 5d2c 206d 6971 7476  ']['lat'], miqtv
-0001c620: 2e63 6f6c 5f68 6561 6465 725b 276d 6172  .col_header['mar
-0001c630: 6971 7427 5d5b 2761 6c74 275d 2c20 6d69  iqt']['alt'], mi
-0001c640: 7174 762e 636f 6c5f 6865 6164 6572 5b27  qtv.col_header['
-0001c650: 6d61 7269 7174 275d 5b27 6867 7427 5d2c  mariqt']['hgt'],
-0001c660: 206d 6971 7476 2e63 6f6c 5f68 6561 6465   miqtv.col_heade
-0001c670: 725b 276d 6172 6971 7427 5d5b 2775 6e63  r['mariqt']['unc
-0001c680: 6572 7427 5d5d 7d2c 0a20 2020 2020 2020  ert']]},.       
-0001c690: 207d 0a0a 2020 2020 2020 2020 7365 6c66   }..        self
-0001c6a0: 2e6e 6f6e 436f 7265 4669 656c 6449 6e74  .nonCoreFieldInt
-0001c6b0: 6572 6d65 6469 6174 6549 7465 6d49 6e66  ermediateItemInf
-0001c6c0: 6f46 696c 6573 203d 205b 5d0a 0a20 2020  oFiles = []..   
-0001c6d0: 2064 6566 205f 5f67 6574 5f69 6e74 5f66   def __get_int_f
-0001c6e0: 696c 655f 7072 6566 6978 2873 656c 6629  ile_prefix(self)
-0001c6f0: 3a0a 2020 2020 2020 2020 2222 2220 6465  :.        """ de
-0001c700: 7065 6e64 7320 6f6e 2027 696d 6167 652d  pends on 'image-
-0001c710: 6576 656e 7427 2061 6e64 2027 696d 6167  event' and 'imag
-0001c720: 652d 7365 6e73 6f72 2720 736f 2069 7420  e-sensor' so it 
-0001c730: 6361 6e20 6368 616e 6765 2064 7572 696e  can change durin
-0001c740: 6720 7570 6174 6520 2222 220a 2020 2020  g upate """.    
-0001c750: 2020 2020 7265 7475 726e 206f 732e 7061      return os.pa
-0001c760: 7468 2e6a 6f69 6e28 7365 6c66 2e64 6972  th.join(self.dir
-0001c770: 2e74 6f28 7365 6c66 2e64 6972 2e64 742e  .to(self.dir.dt.
-0001c780: 696e 7465 726d 6564 6961 7465 292c 2073  intermediate), s
-0001c790: 656c 662e 6669 6e64 546d 7046 6965 6c64  elf.findTmpField
-0001c7a0: 2827 696d 6167 652d 7365 742d 6e61 6d65  ('image-set-name
-0001c7b0: 2729 290a 0a20 2020 2064 6566 2067 6574  '))..    def get
-0001c7c0: 5f69 6e74 5f68 6173 685f 6669 6c65 2873  _int_hash_file(s
-0001c7d0: 656c 6629 3a0a 2020 2020 2020 2020 7265  elf):.        re
-0001c7e0: 7475 726e 2073 656c 662e 5f5f 6765 745f  turn self.__get_
-0001c7f0: 696e 745f 6669 6c65 5f70 7265 6669 7828  int_file_prefix(
-0001c800: 2920 2b20 7365 6c66 2e69 6e74 6572 6d65  ) + self.interme
-0001c810: 6469 6174 6546 696c 6573 4465 665f 636f  diateFilesDef_co
-0001c820: 7265 5b27 6861 7368 6573 275d 5b27 7375  re['hashes']['su
-0001c830: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
-0001c840: 6765 745f 696e 745f 7575 6964 5f66 696c  get_int_uuid_fil
-0001c850: 6528 7365 6c66 293a 0a20 2020 2020 2020  e(self):.       
-0001c860: 2072 6574 7572 6e20 7365 6c66 2e5f 5f67   return self.__g
-0001c870: 6574 5f69 6e74 5f66 696c 655f 7072 6566  et_int_file_pref
-0001c880: 6978 2829 202b 2073 656c 662e 696e 7465  ix() + self.inte
-0001c890: 726d 6564 6961 7465 4669 6c65 7344 6566  rmediateFilesDef
-0001c8a0: 5f63 6f72 655b 2775 7569 6473 275d 5b27  _core['uuids']['
-0001c8b0: 7375 6666 6978 275d 0a0a 2020 2020 6465  suffix']..    de
-0001c8c0: 6620 6765 745f 696e 745f 7374 6172 7454  f get_int_startT
-0001c8d0: 696d 6573 5f66 696c 6528 7365 6c66 293a  imes_file(self):
-0001c8e0: 0a20 2020 2020 2020 2072 6574 7572 6e20  .        return 
-0001c8f0: 7365 6c66 2e5f 5f67 6574 5f69 6e74 5f66  self.__get_int_f
-0001c900: 696c 655f 7072 6566 6978 2829 202b 2073  ile_prefix() + s
-0001c910: 656c 662e 696e 7465 726d 6564 6961 7465  elf.intermediate
-0001c920: 4669 6c65 7344 6566 5f63 6f72 655b 2764  FilesDef_core['d
-0001c930: 6174 6574 696d 6527 5d5b 2773 7566 6669  atetime']['suffi
-0001c940: 7827 5d0a 0a20 2020 2064 6566 2067 6574  x']..    def get
-0001c950: 5f69 6e74 5f6e 6176 5f66 696c 6528 7365  _int_nav_file(se
-0001c960: 6c66 293a 0a20 2020 2020 2020 2072 6574  lf):.        ret
-0001c970: 7572 6e20 7365 6c66 2e5f 5f67 6574 5f69  urn self.__get_i
-0001c980: 6e74 5f66 696c 655f 7072 6566 6978 2829  nt_file_prefix()
-0001c990: 202b 2073 656c 662e 696e 7465 726d 6564   + self.intermed
-0001c9a0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
-0001c9b0: 655b 276e 6176 6967 6174 696f 6e27 5d5b  e['navigation'][
-0001c9c0: 2773 7566 6669 7827 5d0a 0a              'suffix']..
+0001c000: 2020 2020 2020 2064 7420 3d20 6461 7465         dt = date
+0001c010: 7469 6d65 2e64 6174 6574 696d 652e 7374  time.datetime.st
+0001c020: 7270 7469 6d65 2873 7562 4974 656d 5b27  rptime(subItem['
+0001c030: 696d 6167 652d 6461 7465 7469 6d65 275d  image-datetime']
+0001c040: 2c66 6f72 6d61 7429 0a20 2020 2020 2020  ,format).       
+0001c050: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c060: 2073 7562 4974 656d 5b27 696d 6167 652d   subItem['image-
+0001c070: 6461 7465 7469 6d65 275d 203d 2064 6174  datetime'] = dat
+0001c080: 6574 696d 652e 6461 7465 7469 6d65 2e73  etime.datetime.s
+0001c090: 7472 6674 696d 6528 6474 2c6d 6971 7476  trftime(dt,miqtv
+0001c0a0: 2e64 6174 655f 666f 726d 6174 735b 276d  .date_formats['m
+0001c0b0: 6172 6971 7427 5d29 0a20 2020 2020 2020  ariqt']).       
+0001c0c0: 2020 2020 2020 2020 2020 2020 2065 7863               exc
+0001c0d0: 6570 743a 0a20 2020 2020 2020 2020 2020  ept:.           
+0001c0e0: 2020 2020 2020 2020 2020 2020 2074 7279               try
+0001c0f0: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c100: 2020 2020 2020 2020 2020 2020 2020 666f                fo
+0001c110: 726d 6174 203d 2069 7465 6d43 7573 746f  rmat = itemCusto
+0001c120: 6d44 6174 6554 696d 6546 6f72 6d61 740a  mDateTimeFormat.
+0001c130: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c140: 2020 2020 2020 2020 2020 2020 6474 203d              dt =
+0001c150: 2064 6174 6574 696d 652e 6461 7465 7469   datetime.dateti
+0001c160: 6d65 2e73 7472 7074 696d 6528 7375 6249  me.strptime(subI
+0001c170: 7465 6d5b 2769 6d61 6765 2d64 6174 6574  tem['image-datet
+0001c180: 696d 6527 5d2c 666f 726d 6174 290a 2020  ime'],format).  
+0001c190: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c1a0: 2020 2020 2020 2020 2020 7375 6249 7465            subIte
+0001c1b0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001c1c0: 6527 5d20 3d20 6461 7465 7469 6d65 2e64  e'] = datetime.d
+0001c1d0: 6174 6574 696d 652e 7374 7266 7469 6d65  atetime.strftime
+0001c1e0: 2864 742c 6d69 7174 762e 6461 7465 5f66  (dt,miqtv.date_f
+0001c1f0: 6f72 6d61 7473 5b27 6d61 7269 7174 275d  ormats['mariqt']
+0001c200: 290a 2020 2020 2020 2020 2020 2020 2020  ).              
+0001c210: 2020 2020 2020 2020 2020 6578 6365 7074            except
+0001c220: 3a0a 2020 2020 2020 2020 2020 2020 2020  :.              
+0001c230: 2020 2020 2020 2020 2020 2020 2020 7072                pr
+0001c240: 6f67 2e63 6c65 6172 2829 0a20 2020 2020  og.clear().     
+0001c250: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c260: 2020 2020 2020 2072 6169 7365 206d 6971         raise miq
+0001c270: 7463 2e49 6664 6f45 7863 6570 7469 6f6e  tc.IfdoException
+0001c280: 2827 496e 7661 6c69 6420 6461 7465 7469  ('Invalid dateti
+0001c290: 6d65 2076 616c 7565 272c 7375 6249 7465  me value',subIte
+0001c2a0: 6d5b 2769 6d61 6765 2d64 6174 6574 696d  m['image-datetim
+0001c2b0: 6527 5d2c 2022 646f 6573 206e 6f74 206d  e'], "does not m
+0001c2c0: 6174 6368 2066 6f72 6d61 7420 6465 6661  atch format defa
+0001c2d0: 756c 7420 6f72 2063 7573 746f 6d20 666f  ult or custom fo
+0001c2e0: 726d 6174 2229 0a20 2020 2020 2020 2069  rmat").        i
+0001c2f0: 6620 6375 7374 6f6d 4461 7465 5469 6d65  f customDateTime
+0001c300: 466f 726d 6174 466f 756e 643a 0a20 2020  FormatFound:.   
+0001c310: 2020 2020 2020 2020 2073 656c 662e 7072           self.pr
+0001c320: 6f76 2e6c 6f67 2822 4375 7374 6f6d 2064  ov.log("Custom d
+0001c330: 6174 6574 696d 6520 666f 726d 6174 7320  atetime formats 
+0001c340: 666f 756e 642e 2054 6865 7920 7769 6c6c  found. They will
+0001c350: 2062 6520 7265 706c 6163 6564 2062 7920   be replaced by 
+0001c360: 7468 6520 6465 6661 756c 7420 666f 726d  the default form
+0001c370: 6174 2e22 2920 2020 0a20 2020 2020 2020  at.")   .       
+0001c380: 2070 726f 672e 636c 6561 7228 2920 2020   prog.clear()   
+0001c390: 200a 0a0a 2020 2020 6465 6620 5f5f 696e   ...    def __in
+0001c3a0: 6974 496e 7465 726d 6564 6961 7465 4669  itIntermediateFi
+0001c3b0: 6c65 7328 7365 6c66 293a 0a20 2020 2020  les(self):.     
+0001c3c0: 2020 2073 656c 662e 696e 7465 726d 6564     self.intermed
+0001c3d0: 6961 7465 4669 6c65 7344 6566 5f63 6f72  iateFilesDef_cor
+0001c3e0: 6520 3d20 7b0a 2020 2020 2020 2020 2020  e = {.          
+0001c3f0: 2020 2768 6173 6865 7327 3a20 7b0a 2020    'hashes': {.  
+0001c400: 2020 2020 2020 2020 2020 2020 2020 2763                'c
+0001c410: 7265 6174 696f 6e46 6374 273a 2027 6372  reationFct': 'cr
+0001c420: 6561 7465 5f69 6d61 6765 5f73 6861 3235  eate_image_sha25
+0001c430: 365f 6669 6c65 2829 272c 0a20 2020 2020  6_file()',.     
+0001c440: 2020 2020 2020 2020 2020 2027 7375 6666             'suff
+0001c450: 6978 273a 2027 5f69 6d61 6765 2d68 6173  ix': '_image-has
+0001c460: 6865 732e 7478 7427 2c0a 2020 2020 2020  hes.txt',.      
+0001c470: 2020 2020 2020 2020 2020 2763 6f6c 7327            'cols'
+0001c480: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
+0001c490: 6465 725b 276d 6172 6971 7427 5d5b 2768  der['mariqt']['h
+0001c4a0: 6173 6827 5d5d 2c0a 2020 2020 2020 2020  ash']],.        
+0001c4b0: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
+0001c4c0: 6c27 3a20 5b5d 7d2c 0a20 2020 2020 2020  l': []},.       
+0001c4d0: 2020 2020 2027 7575 6964 7327 3a20 7b0a       'uuids': {.
+0001c4e0: 2020 2020 2020 2020 2020 2020 2020 2020                  
+0001c4f0: 2763 7265 6174 696f 6e46 6374 273a 2027  'creationFct': '
+0001c500: 6372 6561 7465 5f75 7569 645f 6669 6c65  create_uuid_file
+0001c510: 2829 272c 0a20 2020 2020 2020 2020 2020  ()',.           
+0001c520: 2020 2020 2027 7375 6666 6978 273a 2027       'suffix': '
+0001c530: 5f69 6d61 6765 2d75 7569 6473 2e74 7874  _image-uuids.txt
+0001c540: 272c 0a20 2020 2020 2020 2020 2020 2020  ',.             
+0001c550: 2020 2027 636f 6c73 273a 205b 6d69 7174     'cols': [miqt
+0001c560: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001c570: 7269 7174 275d 5b27 7575 6964 275d 5d2c  riqt']['uuid']],
+0001c580: 0a20 2020 2020 2020 2020 2020 2020 2020  .               
+0001c590: 2027 6f70 7469 6f6e 616c 273a 205b 5d7d   'optional': []}
+0001c5a0: 2c0a 2020 2020 2020 2020 2020 2020 2764  ,.            'd
+0001c5b0: 6174 6574 696d 6527 3a20 7b0a 2020 2020  atetime': {.    
+0001c5c0: 2020 2020 2020 2020 2020 2020 2763 7265              'cre
+0001c5d0: 6174 696f 6e46 6374 273a 2027 6372 6561  ationFct': 'crea
+0001c5e0: 7465 5f73 7461 7274 5f74 696d 655f 6669  te_start_time_fi
+0001c5f0: 6c65 2829 272c 0a20 2020 2020 2020 2020  le()',.         
+0001c600: 2020 2020 2020 2027 7375 6666 6978 273a         'suffix':
+0001c610: 2027 5f69 6d61 6765 2d73 7461 7274 2d74   '_image-start-t
+0001c620: 696d 6573 2e74 7874 272c 0a20 2020 2020  imes.txt',.     
+0001c630: 2020 2020 2020 2020 2020 2027 636f 6c73             'cols
+0001c640: 273a 205b 6d69 7174 762e 636f 6c5f 6865  ': [miqtv.col_he
+0001c650: 6164 6572 5b27 6d61 7269 7174 275d 5b27  ader['mariqt']['
+0001c660: 7574 6327 5d5d 2c0a 2020 2020 2020 2020  utc']],.        
+0001c670: 2020 2020 2020 2020 276f 7074 696f 6e61          'optiona
+0001c680: 6c27 3a20 5b5d 7d2c 0a20 2020 2020 2020  l': []},.       
+0001c690: 2020 2020 2027 6e61 7669 6761 7469 6f6e       'navigation
+0001c6a0: 273a 207b 0a20 2020 2020 2020 2020 2020  ': {.           
+0001c6b0: 2020 2020 2027 6372 6561 7469 6f6e 4663       'creationFc
+0001c6c0: 7427 3a20 2763 7265 6174 655f 696d 6167  t': 'create_imag
+0001c6d0: 655f 6e61 7669 6761 7469 6f6e 5f66 696c  e_navigation_fil
+0001c6e0: 6528 2927 2c0a 2020 2020 2020 2020 2020  e()',.          
+0001c6f0: 2020 2020 2020 2773 7566 6669 7827 3a20        'suffix': 
+0001c700: 275f 696d 6167 652d 6e61 7669 6761 7469  '_image-navigati
+0001c710: 6f6e 2e74 7874 272c 0a20 2020 2020 2020  on.txt',.       
+0001c720: 2020 2020 2020 2020 2027 636f 6c73 273a           'cols':
+0001c730: 205b 6d69 7174 762e 636f 6c5f 6865 6164   [miqtv.col_head
+0001c740: 6572 5b27 6d61 7269 7174 275d 5b27 7574  er['mariqt']['ut
+0001c750: 6327 5d5d 2c0a 2020 2020 2020 2020 2020  c']],.          
+0001c760: 2020 2020 2020 276f 7074 696f 6e61 6c27        'optional'
+0001c770: 3a20 5b6d 6971 7476 2e63 6f6c 5f68 6561  : [miqtv.col_hea
+0001c780: 6465 725b 276d 6172 6971 7427 5d5b 276c  der['mariqt']['l
+0001c790: 6f6e 275d 2c20 6d69 7174 762e 636f 6c5f  on'], miqtv.col_
+0001c7a0: 6865 6164 6572 5b27 6d61 7269 7174 275d  header['mariqt']
+0001c7b0: 5b27 6c61 7427 5d2c 206d 6971 7476 2e63  ['lat'], miqtv.c
+0001c7c0: 6f6c 5f68 6561 6465 725b 276d 6172 6971  ol_header['mariq
+0001c7d0: 7427 5d5b 2761 6c74 275d 2c20 6d69 7174  t']['alt'], miqt
+0001c7e0: 762e 636f 6c5f 6865 6164 6572 5b27 6d61  v.col_header['ma
+0001c7f0: 7269 7174 275d 5b27 6867 7427 5d2c 206d  riqt']['hgt'], m
+0001c800: 6971 7476 2e63 6f6c 5f68 6561 6465 725b  iqtv.col_header[
+0001c810: 276d 6172 6971 7427 5d5b 2775 6e63 6572  'mariqt']['uncer
+0001c820: 7427 5d5d 7d2c 0a20 2020 2020 2020 207d  t']]},.        }
+0001c830: 0a0a 2020 2020 2020 2020 7365 6c66 2e6e  ..        self.n
+0001c840: 6f6e 436f 7265 4669 656c 6449 6e74 6572  onCoreFieldInter
+0001c850: 6d65 6469 6174 6549 7465 6d49 6e66 6f46  mediateItemInfoF
+0001c860: 696c 6573 203d 205b 5d0a 0a20 2020 2064  iles = []..    d
+0001c870: 6566 205f 5f67 6574 5f69 6e74 5f66 696c  ef __get_int_fil
+0001c880: 655f 7072 6566 6978 2873 656c 6629 3a0a  e_prefix(self):.
+0001c890: 2020 2020 2020 2020 2222 2220 6465 7065          """ depe
+0001c8a0: 6e64 7320 6f6e 2027 696d 6167 652d 6576  nds on 'image-ev
+0001c8b0: 656e 7427 2061 6e64 2027 696d 6167 652d  ent' and 'image-
+0001c8c0: 7365 6e73 6f72 2720 736f 2069 7420 6361  sensor' so it ca
+0001c8d0: 6e20 6368 616e 6765 2064 7572 696e 6720  n change during 
+0001c8e0: 7570 6174 6520 2222 220a 2020 2020 2020  upate """.      
+0001c8f0: 2020 7265 7475 726e 206f 732e 7061 7468    return os.path
+0001c900: 2e6a 6f69 6e28 7365 6c66 2e64 6972 2e74  .join(self.dir.t
+0001c910: 6f28 7365 6c66 2e64 6972 2e64 742e 696e  o(self.dir.dt.in
+0001c920: 7465 726d 6564 6961 7465 292c 2073 656c  termediate), sel
+0001c930: 662e 6669 6e64 546d 7046 6965 6c64 2827  f.findTmpField('
+0001c940: 696d 6167 652d 7365 742d 6e61 6d65 2729  image-set-name')
+0001c950: 290a 0a20 2020 2064 6566 2067 6574 5f69  )..    def get_i
+0001c960: 6e74 5f68 6173 685f 6669 6c65 2873 656c  nt_hash_file(sel
+0001c970: 6629 3a0a 2020 2020 2020 2020 7265 7475  f):.        retu
+0001c980: 726e 2073 656c 662e 5f5f 6765 745f 696e  rn self.__get_in
+0001c990: 745f 6669 6c65 5f70 7265 6669 7828 2920  t_file_prefix() 
+0001c9a0: 2b20 7365 6c66 2e69 6e74 6572 6d65 6469  + self.intermedi
+0001c9b0: 6174 6546 696c 6573 4465 665f 636f 7265  ateFilesDef_core
+0001c9c0: 5b27 6861 7368 6573 275d 5b27 7375 6666  ['hashes']['suff
+0001c9d0: 6978 275d 0a0a 2020 2020 6465 6620 6765  ix']..    def ge
+0001c9e0: 745f 696e 745f 7575 6964 5f66 696c 6528  t_int_uuid_file(
+0001c9f0: 7365 6c66 293a 0a20 2020 2020 2020 2072  self):.        r
+0001ca00: 6574 7572 6e20 7365 6c66 2e5f 5f67 6574  eturn self.__get
+0001ca10: 5f69 6e74 5f66 696c 655f 7072 6566 6978  _int_file_prefix
+0001ca20: 2829 202b 2073 656c 662e 696e 7465 726d  () + self.interm
+0001ca30: 6564 6961 7465 4669 6c65 7344 6566 5f63  ediateFilesDef_c
+0001ca40: 6f72 655b 2775 7569 6473 275d 5b27 7375  ore['uuids']['su
+0001ca50: 6666 6978 275d 0a0a 2020 2020 6465 6620  ffix']..    def 
+0001ca60: 6765 745f 696e 745f 7374 6172 7454 696d  get_int_startTim
+0001ca70: 6573 5f66 696c 6528 7365 6c66 293a 0a20  es_file(self):. 
+0001ca80: 2020 2020 2020 2072 6574 7572 6e20 7365         return se
+0001ca90: 6c66 2e5f 5f67 6574 5f69 6e74 5f66 696c  lf.__get_int_fil
+0001caa0: 655f 7072 6566 6978 2829 202b 2073 656c  e_prefix() + sel
+0001cab0: 662e 696e 7465 726d 6564 6961 7465 4669  f.intermediateFi
+0001cac0: 6c65 7344 6566 5f63 6f72 655b 2764 6174  lesDef_core['dat
+0001cad0: 6574 696d 6527 5d5b 2773 7566 6669 7827  etime']['suffix'
+0001cae0: 5d0a 0a20 2020 2064 6566 2067 6574 5f69  ]..    def get_i
+0001caf0: 6e74 5f6e 6176 5f66 696c 6528 7365 6c66  nt_nav_file(self
+0001cb00: 293a 0a20 2020 2020 2020 2072 6574 7572  ):.        retur
+0001cb10: 6e20 7365 6c66 2e5f 5f67 6574 5f69 6e74  n self.__get_int
+0001cb20: 5f66 696c 655f 7072 6566 6978 2829 202b  _file_prefix() +
+0001cb30: 2073 656c 662e 696e 7465 726d 6564 6961   self.intermedia
+0001cb40: 7465 4669 6c65 7344 6566 5f63 6f72 655b  teFilesDef_core[
+0001cb50: 276e 6176 6967 6174 696f 6e27 5d5b 2773  'navigation']['s
+0001cb60: 7566 6669 7827 5d0a 0a                   uffix']..
```

## Comparing `mariqt-0.5.5.dist-info/LICENSE` & `mariqt-0.5.6.dist-info/LICENSE`

 * *Files identical despite different names*

## Comparing `mariqt-0.5.5.dist-info/METADATA` & `mariqt-0.5.6.dist-info/METADATA`

 * *Files 1% similar despite different names*

```diff
@@ -1,10 +1,10 @@
 Metadata-Version: 2.1
 Name: mariqt
-Version: 0.5.5
+Version: 0.5.6
 Summary: The MareHub & Marine Imaging Community Image QA/QC and curation toolbox
 Author: Timm Schoening
 Author-email: tschoening@geomar.de
 Classifier: Programming Language :: Python :: 3
 Classifier: License :: OSI Approved :: GNU General Public License v3 (GPLv3)
 Classifier: Operating System :: OS Independent
 License-File: LICENSE
```

## Comparing `mariqt-0.5.5.dist-info/RECORD` & `mariqt-0.5.6.dist-info/RECORD`

 * *Files 5% similar despite different names*

```diff
@@ -2,30 +2,30 @@
 mariqt/core.py,sha256=gIMyi8GQ4c-0EJkalBVnn3_dLdrCMuVXmmPNhdPcMV4,14710
 mariqt/directories.py,sha256=ZRJmUxFO5oD4JCECorwr3DYQel-U57GsrgfLutzT2hU,8485
 mariqt/equipment.py,sha256=WgZ2NfRqbHFHNpbcnTfRk8waOCQn9fDgdr4JTZR9wPk,465
 mariqt/files.py,sha256=V-7J_ekTjWbZ7tyGE7SayZxQwf658KNtl_rUyStnzV8,16621
 mariqt/geo.py,sha256=K89tqXN4Ntu2qBzii68WVB86kGqTxpJvHzWARlR3k60,28565
 mariqt/image.py,sha256=j41GAzx22_fuqeIXVRwwfVnNz19cUHxeImZiOOpQAbA,23207
 mariqt/misc.py,sha256=BF_ItP_gnkS1Z6zb9P7O4cRi3XMgJR-Bm2OmzX7AK9M,3090
-mariqt/navigation.py,sha256=d_SkjrlxDP3xGkFYLDrDkdbLmcbfpOJUpoFm_-ZeXVo,40159
+mariqt/navigation.py,sha256=pooHc9PeTTQ6dwX3fXaAwWpkDg1UMgMNjQkRzoVcjxM,40325
 mariqt/provenance.py,sha256=daR6sIK6tSFaBsanKvIuFyjR78NNOTzd4N3AdQRxdFw,7345
 mariqt/reports.py,sha256=YP03HvFe0BG0y4efvQhRpeGifijqqPpCB_gg4qX-MVw,22316
 mariqt/settings.py,sha256=bqjUJnTiKwFsbGP4cRQiwHQhsTi4191pb36R8GSKp58,4376
 mariqt/tests.py,sha256=BWJy4ejhsSINzhR_88HGfYeXVnPKbdMwDE-u2qLl6C0,8323
 mariqt/variables.py,sha256=TtGb3UVwJnE5tmDEOxuZlCFofebgEWiKr7Soh_DFk5g,9613
-mariqt/version.py,sha256=nrKeY2xA6SXRPdgHDxi2HLkFNpXRuW6MkqwC0reZpy8,21
+mariqt/version.py,sha256=XpYTVp-spxaj-_hEt5Sd6Jk_-9z0kN_g6e-v78KrljU,21
 mariqt/resources/fair-marine-images/docs/schemas/annotation-v2.0.0.json,sha256=HyHwLO2Wc6KWE3YBctExeEHtDNz4HQldPkczvTdpFp0,6175
 mariqt/resources/fair-marine-images/docs/schemas/ifdo-v2.0.0.json,sha256=qKNwXPjk7NSpYI3PYGEItxsoyPUDTzJUNaJlqloWIHA,42461
 mariqt/resources/fair-marine-images/docs/schemas/provenance-v0.1.0.json,sha256=krwoig3eWpFjG61HIsdX7N-7QXFJ3v9mRZ63vham7rM,3218
 mariqt/sources/dship.py,sha256=5PxhsraSImnSchTG0h0HlLHorJQZPSDSOzspRGhD6bg,12135
 mariqt/sources/dship_settings.py,sha256=2vAlW0oh4iHwRCkBQnbCZ4yhXNzVi7aKPnqNrN5RwI0,4684
 mariqt/sources/elements.py,sha256=5Cgchy_MJq4CiLVi2xqpxlOGqL5-PKl426XnzoCIEVI,2177
-mariqt/sources/ifdo.py,sha256=m38NKMRm6CmvoKQ5BxxJTyXHCGylRkDiF2jo_sS1dI4,117195
+mariqt/sources/ifdo.py,sha256=fyTlaQL1vs61AaJqRNkTeJr3C_mX1e5_tiUIFHMgBp4,117609
 mariqt/sources/ofop.py,sha256=mSMZLvWszr_Yfd7rDf_4V4jIz3DMQh7Qe7eHLUnMOK8,5533
 mariqt/sources/svgs.py,sha256=T089b6F0wYLbUZQ8XhvCqqNmZqrvyTpx3kqRojlg_pM,650149
 mariqt/sources/underway.py,sha256=mIweaYmKbxPvmZHSFd3k5JY4mnFZ-7X3u_MdCPNjQL0,3728
-mariqt-0.5.5.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
-mariqt-0.5.5.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
-mariqt-0.5.5.dist-info/METADATA,sha256=ODt3-tf9vfHIIy6lrn2KWAXcp5x6BCx-S76sd65Wc-I,1133
-mariqt-0.5.5.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
-mariqt-0.5.5.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
-mariqt-0.5.5.dist-info/RECORD,,
+mariqt-0.5.6.dist-info/AUTHORS.md,sha256=_mki0OpAav0xO0ztc3R5aVhIpmexyqWmY1mAXBoOxMU,162
+mariqt-0.5.6.dist-info/LICENSE,sha256=-MKfBTtig35o5_D2OxsbEq-rOcOx7S4Wd3WsEedeV8o,35140
+mariqt-0.5.6.dist-info/METADATA,sha256=x8k7J2stalRYJ_u8tWeDIxSbLk14undn4jCUIqujJUU,1133
+mariqt-0.5.6.dist-info/WHEEL,sha256=a-zpFRIJzOq5QfuhBzbhiA1eHTzNCJn8OdRvhdNX0Rk,110
+mariqt-0.5.6.dist-info/top_level.txt,sha256=tdkmp0KxobBWy4IKaBeGYtc2HjD0OpeWrGNe21Q8Tfo,7
+mariqt-0.5.6.dist-info/RECORD,,
```

